*          DATA SET SPLDCPTR   AT LEVEL 038 AS OF 08/03/20                      
*CATALP SPLDCPTR                                                                
SPLDCPTR TITLE 'SPOT LOAD/DUMP - CREATE DIRECTORY POINTERS'                     
*        PARA1 A(RECORD)                                                        
*        PARA2 A(AREA TO CREATE DIRECTORY POINTERS)                             
*              LAST POINTER FOLLOWED BY X'00'                                   
*                                                                               
* JUL28/04 JSHA ADD NEW ESTIMATE POINTER FOR STATS                              
* JAN30/04 BGRI ADD NEW TRAFFIC PASSIVE PTR FOR COMMLS                          
* SEP07/07 MHER 2-BYTE BUYLINES/NOP CODE FOR ADVTSR POINTERS                    
*               AND SYND POINTERS                                               
*               ADD NEW TRAFFIC PASSIVES                                        
* JUL25/08 MHER LOAD TRPACK/CREATE ADID PTRS FOR 8 CHAR CMML                    
* OCT01/09 AKAT TEST FOR P4 AS NOT ALL PROGS PASS IT IN!                        
         PRINT NOGEN                                                            
LDCPTR   CSECT                                                                  
         NMOD1 WORKX-WORKD,SPLDCPTR                                             
         USING WORKD,RC                                                         
*                                                                               
         BC    0,LDCPTR0                                                        
         OI    *-3,X'F0'                                                        
                                                                                
         ST    R1,SAVER1                                                        
         ICM   R4,15,12(R1)        HAVE LOAD DEF ADDRESS?                       
         BZ    LDCPTR0             NO! NOT ALL PROGS PASS IT!!                  
         LR    R0,R1               PRESERVE R1                                  
         USING LDDEFND,R4                                                       
         L     RF,LLOADER                                                       
         GOTO1 (RF),DMCB,=CL8'T00AFE',0   LOAD TRPACK                           
         ICM   RE,15,4(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         STY   RE,VTRPACK                                                       
         LR    R1,R0               RESTORE R1                                   
*                                                                               
LDCPTR0  L     R7,0(R1)            GET REC ADDRESS                              
         USING REC,R7                                                           
         MVC   DUB(2),REC+13       MOVE REC LENGTH                              
         LH    RE,DUB                                                           
         AR    RE,R7                                                            
         MVI   0(RE),0             SET E-O-R FLAG                               
         MVI   1(RE),0                                                          
         L     R8,4(R1)            GET KEY BUFFER ADDRESS                       
         ST    R8,NEXTDIR                                                       
         EJECT                                                                  
         XC    KEY,KEY                                                          
         ICM   RF,15,=V(DATCON)                                                 
         BZ    MAIN                                                             
         OC    TDYLSS2W,TDYLSS2W   DID WE GET A DATE ALREADY?                   
         BNZ   MAIN                                                             
         GOTO1 =V(DATCON),DMCB,(5,0),(0,PRDLIST)                                
         GOTO1 =V(ADDAY),DMCB,PRDLIST,SVTDYLS1,-14                              
         GOTO1 =V(DATCON),DMCB,(0,SVTDYLS1),(2,TDYLSS2W)                        
*                                                                               
         GOTO1 =V(ADDAY),DMCB,PRDLIST,SVTDYLS1,-7                               
         GOTO1 =V(DATCON),DMCB,(0,SVTDYLS1),(2,TDYLSS1W)                        
*                                                                               
MAIN     CLI   REC,X'FF'           TEST FOR TRAILER                             
         BE    ADD10                                                            
*                                                                               
         CLI   REC,X'10'           TEST BUY                                     
         BH    ADDBUY                                                           
*                                                                               
         CLI   REC,X'02'           TEST GOAL                                    
         BNE   *+12                                                             
         BRAS  RE,ADDGOAL                                                       
         B     EXIT                                                             
*                                                                               
         CLC   REC(2),=X'0A21'     TEST TRAFFIC CMML                            
         BNE   *+12                                                             
         BRAS  RE,ADDCML                                                        
         B     EXIT                                                             
*                                                                               
         CLC   REC(2),=X'0A2B'     TEST TRAFFIC FEED ACTIVITY                   
         BE    ADDTFD                                                           
*                                                                               
         CLC   REC(2),=X'0A2E'     TEST TRAFFIC BUY ACTIVITY                    
         BE    ADDTBA                                                           
*                                                                               
         CLC   REC(2),=X'0A31'     TEST TRAFFIC STATION LIST                    
         BE    ADDSTL                                                           
*                                                                               
         CLC   REC(2),=X'0A32'     TEST TRAFFIC BUY                             
         BE    ADDTBY                                                           
*                                                                               
         CLC   REC(2),=X'0A37'     TEST TRAFFIC PROD EQUIV                      
         BE    ADDTPE                                                           
*                                                                               
         CLC   REC(2),=X'0D03'     TEST MKT ASSGN                               
         BE    ADDMKA                                                           
*                                                                               
         CLC   REC(2),=X'0D04'     TEST CLIENT GROUP                            
         BE    ADDCGRP                                                          
*                                                                               
         CLC   REC(2),=X'0D05'     TEST STATION GROUP                           
         BE    ADDSGRP                                                          
*                                                                               
         CLC   REC(2),=X'0D11'     TEST CANAD NETDEF RECORD                     
         BE    ADDNDEF                                                          
*                                                                               
         CLC   REC(2),=X'0D20'     TEST NTWK PGM                                
         BE    ADDNTWK                                                          
*                                                                               
         CLC   REC(2),=X'0D31'     TEST ADDS RECORD                             
         BNE   *+12                                                             
         BRAS  RE,ADDADDS                                                       
         B     EXIT                                                             
*                                                                               
         CLC   REC(2),=X'0D34'     TEST DARE RECORD                             
         BNE   *+12                                                             
         BRAS  RE,ADDDARE                                                       
         B     EXIT                                                             
*                                                                               
         CLC   REC(2),=X'0D35'     TEST DARE BATCH RECORD                       
         BNE   *+12                                                             
         BRAS  RE,ADDDBTC                                                       
         B     EXIT                                                             
*                                                                               
         CLC   REC(2),=X'0D65'     TEST NEW BWS BUYER REC                       
         BE    ADDBWSB                                                          
*                                                                               
         CLC   REC(2),=X'0D66'     TEST NEW BUYER'S WORKSHEET CAMPAIGN          
         BE    ADDBWSC                                                          
*                                                                               
         CLC   REC(2),=X'0D67'     TEST NEW BUYER'S WORKSHEET HDR REC           
         BE    ADDBWSH                                                          
*                                                                               
         CLC   REC(2),=X'0D73'     TEST STATION LOCKIN                          
         BNE   *+12                                                             
         BRAS  RE,ADDSLOK                                                       
         B     EXIT                                                             
*                                                                               
         CLC   REC(2),=X'0D76'     TEST CLEARANCE STATUS                        
         BE    ADDCLST                                                          
*                                                                               
         CLC   REC(2),=X'0D7E'     CTA MAINT                                    
         BNE   *+12                                                             
         BRAS  RE,ADDCTA                                                        
         B     EXIT                                                             
*                                                                               
         CLC   REC(2),=X'0D61'     SUPERDESK SUPERVISOR                         
         BE    ADDSPV                                                           
*                                                                               
         CLC   REC(2),=X'0D62'     SUPERDESK BUYER                              
         BE    ADDBYR                                                           
*                                                                               
         CLC   REC(2),=X'0E01'     STATION BUCKET PSVS FOR NET                  
         BNE   *+12                                                             
         BRAS  RE,ADDSTAB                                                       
         B     EXIT                                                             
*                                                                               
         CLI   REC,0               TEST HEADER                                  
         BNE   ADD10               NO                                           
*                                                                               
         OC    REC+4(3),REC+4      TEST FOR PRD                                 
         BNZ   ADD2                                                             
         BRAS  RE,ADDCLT           NO - MUST BE CLTHDR                          
         B     EXIT                                                             
*                                                                               
ADD2     OC    REC+7(6),REC+7      TEST FOR EST OR BILL DATA                    
         BNZ   ADD4                                                             
         BRAS  RE,ADDPRD                                                        
         B     EXIT                                                             
*                                                                               
ADD4     OC    REC+8(5),REC+8      TEST FOR BILL DATA                           
         BNZ   ADD6                                                             
         BRAS  RE,ADDEST                                                        
         B     EXIT                                                             
*                                                                               
ADD6     OC    REC+8(5),REC+8      TEST FOR BILL DATA                           
         BNZ   ADDBILL                                                          
*                                                                               
* NOT A SPECIAL CASE. ADD PTR EQUAL TO REC KEY                                  
*                                                                               
ADD10    MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
         B     EXIT                                                             
         EJECT                                                                  
* BUY RECORDS                                                                   
*                                                                               
ADDBUY   MVC   KEY(10),REC                                                      
         MVC   KEY+11(1),REC+10    LINE NUMBER                                  
*                                                                               
         TM    REC+15,BUYRLN2      TEST 2-BYTE LINE NUMBERS                     
         BZ    *+10                                                             
         MVC   KEY+11(2),REC+10                                                 
                                                                                
* SEARCH FOR PBELEM IF NON-POOL                                                 
                                                                                
         CLI   REC+3,X'FF'                                                      
         BE    ADDB10                                                           
*                                                                               
         CLI   BDTIME,0            TEST PIGGYBACK                               
         BZ    ADDB2                                                            
*                                                                               
         MVI   ELCODE,4                                                         
         LA    R4,BDELEM                                                        
         BAS   R9,NEXTEL                                                        
         BE    ADDB4                                                            
*                                                                               
* NON-POOL, NON-PIGGYBACK                                                       
*                                                                               
ADDB2    MVI   KEY+12,1            SET REGULAR                                  
         BRAS  R9,ADDKEY                                                        
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
* PIGGYBACK BUY                                                                 
*                                                                               
ADDB4    MVI   KEY+12,2                                                         
         BRAS  R9,ADDKEY                                                        
*                                                                               
* NOW ADD PIGGYBACK KEY                                                         
*                                                                               
         SR    RE,RE                                                            
         IC    RE,1(R4)                                                         
         SRDA  RE,32                                                            
         D     RE,=F'7'                                                         
         LR    R5,RF               SET R5 FOR BCT                               
         LA    R4,2(R4)                                                         
*                                                                               
ADDB6    MVC   KEY(10),REC                                                      
         MVC   KEY+3(1),0(R4)      PIGGYBACK PRD                                
         MVC   KEY+9(1),1(R4)      PIGGYBACK EST                                
         MVC   KEY+10(1),REC+3     ACTIVE PRD                                   
         MVC   KEY+11(1),REC+9     ACTIVE EST                                   
         MVC   KEY+12(1),REC+10    BUY NUMBER                                   
*                                                                               
         BRAS  R9,ADDKEY                                                        
*                                                                               
         LA    R4,7(R4)                                                         
         BCT   R5,ADDB6                                                         
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
* POOL BUY                                                                      
ADDB10   TM    REC+15,BUYRLN2      TEST 2-BYTE LINE NUMBERS                     
         BO    ADDB11                                                           
*                                                                               
         XC    BUYMCLT(4),BUYMCLT                                               
         MVI   ELCODE,X'61'        SEARCH FOR TRAFFIC MASTER CLT                
         LA    R4,BDELEM                                                        
         BAS   R9,NEXTEL                                                        
         BNE   *+10                                                             
         MVC   BUYMCLT(3),2(R4)    SAVE CODE/SEQ                                
         CLI   1(R4),6             TEST PRD CODE IN ELEMENT                     
         BL    *+10                NOT IF LESS THAN 6 BYTES                     
         MVC   BUYMPRD,5(R4)       SAVE PRODUCT                                 
*                                                                               
ADDB11   XC    BUYID,BUYID                                                      
         CLI   BDXFRAGY,0          TEST COPIED BUYREC                           
         BNE   ADDB14              YES - NO ID ELEM SEARCH                      
         TM    BDCANAD,X'80'       NOT FOR CANADA                               
         BO    ADDB14                                                           
*                                                                               
         MVI   ELCODE,X'70'        SEARCH FOR ID ELEMENT                        
         LA    R4,BDELEM                                                        
         BAS   R9,NEXTEL                                                        
         BNE   ADDB14                                                           
*                                  CHECK RIGHT KIND OF ID ELEM                  
         CLI   3(R4),C'A'          MGR SCHEME CODE MUST BE 'A'                  
         BL    ADDB14                                                           
         CLI   3(R4),C'K'          THRU 'K'                                     
         BH    ADDB14                                                           
*                                                                               
         LA    R5,4(R4)            MUST THEN HAVE 4 NUMERICS                    
         LA    R0,4                NOTE- 0000 WILL NOT PRODUCE ID PTR           
*                                                                               
ADDB12   DS    0H                                                               
         CLI   0(R5),C'0'                                                       
         BL    ADDB14                                                           
         CLI   0(R5),C'9'                                                       
         BH    ADDB14                                                           
         LA    R5,1(R5)                                                         
         BCT   R0,ADDB12                                                        
*                                  HAVE VALID ID                                
         PACK  DUB(3),4(5,R4)      PWOS                                         
         MVC   BUYID,DUB                                                        
*                                                                               
ADDB14   TM    REC+15,BUYRLN2      TEST 2-BYTE LINE NUMBERS                     
         BO    *+8                                                              
         MVI   KEY+12,1            SET 'REGULAR'                                
*                                                                               
         CLI   BDXFRAGY,0          TEST COPIED BUYREC                           
         BE    *+10                NO                                           
         MVC   KEY+12(1),BDXFRAGY  PUT AGY NUM IN DIR KEY                       
*                                                                               
         BRAS  R9,ADDKEY                                                        
*                                                                               
         MVC   KEYSAVE,KEY                                                      
         BAS   RE,ADDSPLL                                                       
         MVC   KEY,KEYSAVE                                                      
         TM    BDCANAD,X'80'       TEST CANADA                                  
         BZ    ADDB18                                                           
*                                                                               
         IC    R0,KEY                                                           
         N     R0,=X'0000000F'     DROP AGY                                     
         CHI   R0,1                TEST TV                                      
         BE    ADDB16                                                           
         CHI   R0,3                TEST NETWORK TV                              
         BNE   ADDB18                                                           
*                                                                               
ADDB16   BRAS  RE,ADDCMBD                                                       
         BAS   RE,ADDSPLL                                                       
*                                                                               
ADDB18   MVC   KEY,KEYSAVE                                                      
*                                                                               
         CLC   BDMASPRD(1),BDMASPRD+1 CHECK FOR DUP                             
         BNE   *+8                                                              
         MVI   BDMASPRD+1,0                                                     
*                                                                               
         XC    PRDLIST,PRDLIST                                                  
         MVC   PRDLIST(2),BDMASPRD   SET MASTER PRD CODES IN LIST               
*                                                                               
ADDB20   LA    R4,BDELEM                                                        
*                                                                               
ADDB22   SR    R0,R0                                                            
         ICM   R0,1,1(R4)                                                       
         BZ    ADDB40              GET OUT ON BAD LENGTH                        
         AR    R4,R0                                                            
         CLI   0(R4),0             TEST E-O-R                                   
         BE    ADDB40              GO ADD POINTERS                              
         CLI   0(R4),X'0B'                                                      
         BL    ADDB22                                                           
         CLI   0(R4),X'0E'                                                      
         BH    ADDB22                                                           
         IC    R0,1(R4)                                                         
         SH    R0,=H'10'                                                        
         BNP   ADDB22                                                           
         SRL   R0,2                SET R0 FOR BCT                               
*                                                                               
         LA    R5,10(R4)           POINT TO FIRST ALLOCATION                    
*                                                                               
ADDB24   LA    R1,PRDLIST                                                       
ADDB26   CLI   0(R1),0             TEST END OF LIST                             
         BE    ADDB28              YES - ADD PRD TO LIST                        
         CLC   0(1,R1),0(R5)       TEST PRD ALREADY IN LIST                     
         BE    ADDB30              YES                                          
         LA    R1,1(R1)                                                         
         B     ADDB26                                                           
ADDB28   MVC   0(1,R1),0(R5)       ADD PRD TO LIST                              
*                                                                               
ADDB30   LA    R5,4(R5)            NEXT PRD ALLOCATION                          
         BCT   R0,ADDB24                                                        
*                                                                               
         B     ADDB22                                                           
         EJECT                                                                  
* ADD A POINTER FOR EACH PRDLIST ENTRY                                          
*                                                                               
ADDB40   LA    R4,PRDLIST                                                       
         B     ADDB56                                                           
*                                                                               
ADDB42   MVC   KEY(10),REC                                                      
         MVC   KEY+3(1),0(R4)                                                   
         MVI   KEY+10,X'FF'                                                     
         MVC   KEY+12(1),REC+10    BUY NUMBER                                   
         MVI   KEY+11,0                                                         
*                                                                               
         TM    REC+15,BUYRLN2      TEST 2-BYTE LINE NUMBERS                     
         BZ    *+10                                                             
         MVC   KEY+11(2),REC+10                                                 
*                                                                               
         CLI   BDXFRAGY,0          TEST COPIED BUYREC                           
         BE    *+10                NO                                           
         MVC   KEY+11(1),BDXFRAGY                                               
*                                                                               
         BRAS  R9,ADDKEY                                                        
*                                                                               
         MVC   KEYSAVE,KEY                                                      
         BAS   RE,ADDSPLL                                                       
         MVC   KEY,KEYSAVE                                                      
         TM    BDCANAD,X'80'       TEST CANADA                                  
         BZ    ADDB46                                                           
*                                                                               
         IC    R0,KEY                                                           
         N     R0,=X'0000000F'     DROP AGY                                     
         CHI   R0,1                TEST TV                                      
         BE    ADDB44                                                           
         CHI   R0,3                TEST NETWORK TV                              
         BNE   ADDB46                                                           
*                                                                               
ADDB44   BRAS  RE,ADDCMBD                                                       
         BAS   RE,ADDSPLL                                                       
*                                                                               
ADDB46   MVC   KEY,KEYSAVE                                                      
*                                                                               
ADDB54   LA    R4,1(R4)                                                         
*                                                                               
ADDB56   CLI   0(R4),0                                                          
         BE    EXIT                                                             
         CLI   0(R4),X'FF'                                                      
         BE    ADDB54              NEVER ADD BRAND FF, BUT CALLS AT             
         B     ADDB42              NIGHT ARE NO FUN, SO NO DC H'0' !            
         SPACE 2                                                                
ADDSPLL  NTR1                                                                   
*                                                                               
         MVI   ELCODE,3                                                         
         LA    R4,BDELEM                                                        
*                                                                               
ADDSPLL2 BAS   R9,NEXTEL                                                        
         BNE   ADDSPLLX                                                         
*                                                                               
         CLC   KEYSAVE+4(2),4(R4)  MAKE SURE SPILL MARKET                       
         BE    ADDSPLL2            NOT SAME AS REAL MARKET                      
         MVC   KEY+4(2),4(R4)      SET SPILL MKT                                
         CLI   KEY+10,X'FF'        NOTE THIS WILL LEAVE MEDIA IN                
         BNE   *+8                   KEY+10 FOR CMBD PTRS                       
         MVI   KEY+10,0                                                         
         OI    KEY+10,X'80'        SET SPILL PTR IND                            
*                                                                               
         BRAS  R9,ADDKEY                                                        
         B     ADDSPLL2                                                         
*                                                                               
ADDSPLLX XIT1                                                                   
         EJECT                                                                  
* MARKET ASSIGNMENT RECORDS                                                     
*                                                                               
ADDMKA   MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
* ADD MKTGRP PASSIVE POINTERS                                                   
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0D82'     RECORD ID                                    
         MVC   KEY+2(3),REC+8      A/M/CLT                                      
         MVC   KEY+11(2),REC+11    MARKET                                       
*                                                                               
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'05'                                                     
         CLC   0(1,R4),ELCODE                                                   
         BE    ADDMKA4                                                          
*                                                                               
ADDMKA2  BAS   R9,NEXTEL                                                        
         BNE   EXIT                                                             
*                                                                               
ADDMKA4  MVC   KEY+5(6),2(R4)      MOVE PRDGRP/MKTGRP                           
         BRAS  R9,ADDKEY                                                        
         B     ADDMKA2                                                          
         EJECT                                                                  
* CLIENT GROUP RECORDS                                                          
*                                                                               
ADDCGRP  MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         OC    REC+4(2),REC+4      CLIENT GROUP DEFINITION RECORD?              
         BZ    EXIT                YES -- THESE HAVE NO PASSIVES                
*                                                                               
* ADD CLIENT GROUP PASSIVE POINTERS                                             
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0D84'     RECORD ID                                    
         MVC   KEY+2(1),REC+2      A/M                                          
         MVC   KEY+9(1),REC+3      GROUP ID                                     
         MVC   KEY+10(2),REC+4     GROUP CODE                                   
*                                                                               
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'30'        CLIENT ELEMENTS                              
         CLC   0(1,R4),ELCODE                                                   
         BE    ADDCGRP4                                                         
*                                                                               
ADDCGRP2 BAS   R9,NEXTEL                                                        
         BNE   EXIT                                                             
*                                                                               
ADDCGRP4 MVC   KEY+3(6),2(R4)      MOVE CLIENT                                  
         BRAS  R9,ADDKEY                                                        
         B     ADDCGRP2                                                         
         EJECT                                                                  
* STATION GROUP RECORDS                                                         
*                                                                               
ADDSGRP  MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         OC    REC+4(2),REC+4      STATION GROUP DEFINITION RECORD?             
         BZ    EXIT                YES -- THESE HAVE NO PASSIVES                
*                                                                               
* ADD STATION GROUP PASSIVE POINTERS                                            
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0D85'     RECORD ID                                    
         MVC   KEY+2(1),REC+2      A/M                                          
         MVC   KEY+9(1),REC+3      GROUP ID                                     
         MVC   KEY+10(2),REC+4     GROUP CODE                                   
*                                                                               
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'30'        STATION ELEMENTS                             
         CLC   0(1,R4),ELCODE                                                   
         BE    ADDSGRP4                                                         
*                                                                               
ADDSGRP2 BAS   R9,NEXTEL                                                        
         BNE   EXIT                                                             
*                                                                               
ADDSGRP4 MVC   KEY+3(6),2(R4)      MOVE STATION                                 
         BRAS  R9,ADDKEY                                                        
         B     ADDSGRP2                                                         
         EJECT                                                                  
ADDNDEF  MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         OC    REC+8(3),REC+8      TEST DEFAULT NETWORK                         
         BNZ   EXIT                NO - SKIP IF CLT OR EST PRESENT              
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0D91'     RECORD ID                                    
         MVC   KEY+2(2),REC+2      AGY                                          
         MVC   KEY+5(4),REC+4      NETWORK                                      
*                                                                               
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'02'        FIND SEQUENCE NUMBER ELEMENT                 
         BAS   R9,NEXTEL2                                                       
         BNE   EXIT                                                             
         MVC   KEY+4(1),2(R4)      MOVE SEQUENCE NUMBER                         
         BRAS  R9,ADDKEY                                                        
         B     EXIT                                                             
         EJECT                                                                  
* BILL HEADER                                                                   
*                                                                               
ADDBILL  MVC   KEY(13),REC                                                      
         OC    REC+29(2),REC+29    BILPOST                                      
         BZ    *+8                                                              
         OI    REC+15,X'01'                                                     
         BRAS  R9,ADDKEY                                                        
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
* NTWK PGM RECORDS                                                              
*                                                                               
ADDNTWK  MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
* FIND X'77' ELEMENT                                                            
* 77 ELEMENT ONLY FOUND ON BJNY TRANSFER RECORD                                 
* THESE RECORDS SHOULD NOT HAVE PASSIUE POINTERS                                
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'77'                                                     
         BAS   R9,NEXTEL                                                        
         BE    EXIT                                                             
*                                                                               
* FIND X'92' ELEMENT                                                            
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'92'                                                     
         BAS   R9,NEXTEL                                                        
         BNE   EXIT                ELEM SHOULD BE THERE BUT CANT STOP           
*                                                                               
         CLI   77(R4),C'Y'         CABLE UPLOAD PROGRAM                         
         BE    EXIT                YES NO PASSIVE POINTER                       
*                                                                               
         OI    KEY+1,X'80'                                                      
         MVC   KEY+5(6),2(R4)      MOVE DAY/TIME                                
         MVC   KEY+5(1),27(R4)     USE REP STYLE DATES                          
         MVC   KEY+10(1),66(R4)    MOVE UNIQUE ID                               
         BRAS  R9,ADDKEY                                                        
         B     EXIT                                                             
         EJECT                                                                  
* NEW BUYER'S WORKSHEET BUYER RECORD                                            
*                                                                               
ADDBWSB  MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(3),REC                                                       
         OI    KEY+1,X'80'                                                      
         LA    R9,REC                                                           
         MVC   KEY+3(1),BYRCODE-BYRRECD(R9)                                     
         OC    KEY+2(1),BYRMASK-BYRRECD(R9)                                     
         BRAS  R9,ADDKEY                                                        
         B     EXIT                                                             
         SPACE 2                                                                
* NEW BUYER'S WORKSHEET CAMPAIGN RECORD                                         
*                                                                               
ADDBWSC  MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(3),REC                                                       
         OI    KEY+1,X'80'                                                      
         LA    R9,REC                                                           
         MVC   KEY+3(2),CAMCLT-CAMRECD(R9)                                      
         MVC   KEY+5(1),CAMPRD-CAMRECD(R9)                                      
         MVC   KEY+6(1),CAMEST-CAMRECD(R9)                                      
         MVC   KEY+7(1),CAMKBYR-CAMRECD(R9)                                     
         MVC   KEY+8(2),CAMKCAM-CAMRECD(R9)                                     
         BRAS  R9,ADDKEY                                                        
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(3),REC                                                       
         MVI   KEY+1,X'E8'                                                      
         LA    R9,REC                                                           
         MVC   KEY+3(1),CAMKBYR-CAMRECD(R9)                                     
         MVC   KEY+4(2),CAMCLT-CAMRECD(R9)                                      
         MVC   KEY+6(1),CAMPRD-CAMRECD(R9)                                      
         MVC   KEY+7(1),CAMEST-CAMRECD(R9)                                      
         MVC   KEY+8(2),CAMKCAM-CAMRECD(R9)                                     
         BRAS  R9,ADDKEY                                                        
         B     EXIT                                                             
         SPACE 2                                                                
* NEW BUYER'S WORKSHEET HEADER RECORD                                           
*                                                                               
ADDBWSH  MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(4),REC                                                       
         OI    KEY+1,X'80'                                                      
         LA    R9,REC                                                           
         MVC   KEY+4(2),BWHKSEQ-BWHRECD(R9)                                     
         BRAS  R9,ADDKEY                                                        
         B     EXIT                                                             
                                                                                
*===========================================================                    
* CLEARANCE STATUS RECORDS                                                      
*===========================================================                    
                                                                                
ADDCLST  MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         LA    R4,REC+24           GENERATE PASSIVE IF ANY UNCLRS               
         MVI   ELCODE,X'01'                                                     
         BAS   R9,NEXTEL2                                                       
         BE    ADDCLST4                                                         
         B     EXIT                                                             
*                                                                               
ADDCLST2 BAS   R9,NEXTEL                                                        
         BNE   EXIT                                                             
*                                                                               
         USING CLSTEL01,R4                                                      
ADDCLST4 TM    CLSTSTAT,X'01'      TEST UNCLEARANCE                             
         BZ    ADDCLST2                                                         
*                                                                               
         OI    KEY+1,X'80'         GENERATE PASSIVE POINTER                     
         BRAS  R9,ADDKEY                                                        
         B     EXIT                                                             
         DROP  R4                                                               
         SPACE 2                                                                
*============================================================                   
* NOTE ROUTINE REQUIRES NO BASE REGISTER - CAREFUL                              
*============================================================                   
NEXTEL   SR    R0,R0                                                            
         ICM   R0,1,1(R4)                                                       
         JZ    NEXTELX             EXIT IF BAD ELEMENT LEN                      
         AR    R4,R0                                                            
NEXTEL2  CLI   0(R4),0                                                          
         JE    NEXTELX                                                          
         CLC   0(1,R4),ELCODE                                                   
         BER   R9                  EXIT WITH CC =                               
         J     NEXTEL                                                           
NEXTELX  LTR   R9,R9               SET CC NOT =                                 
         BR    R9                                                               
         EJECT                                                                  
*==========================================================                     
* TRAFFIC STATION LIST RECCORDS                                                 
*==========================================================                     
                                                                                
ADDSTL   MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
                                                                                
* REFORMAT FOR MARKET SEQUENCE KEY *                                            
                                                                                
         OI    KEY+1,X'80'                                                      
         MVC   KEY+3(2),REC+8      MARKET                                       
         MVC   KEY+5(5),REC+3      CLT/PRD                                      
         BRAS  R9,ADDKEY                                                        
         B     EXIT                                                             
                                                                                
*==========================================================                     
* TRAFFIC FEED RECCORDS                                                         
*==========================================================                     
                                                                                
ADDTFD   MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
                                                                                
* REFORMAT FOR CLIENT SEQUENCE KEY *                                            
                                                                                
         OI    KEY+1,X'80'                                                      
         MVC   KEY+3(2),REC+7      CLIENT                                       
         MVC   KEY+5(4),REC+3      NETWORK                                      
         BRAS  R9,ADDKEY                                                        
         B     EXIT                                                             
                                                                                
*==========================================================                     
* TRAFFIC BUY RECORDS                                                           
*==========================================================                     
                                                                                
ADDTBY   MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
                                                                                
* MOVE PRODUCT TO KEY+11 AND REPLACE PRODUCT WITH X'FF'                         
                                                                                
         MVI   KEY+1,X'B2'                                                      
         MVC   KEY+11(1),KEY+5     MOVE PRODUCT                                 
         MVI   KEY+5,X'FF'                                                      
         BRAS  R9,ADDKEY                                                        
         B     EXIT                                                             
         EJECT                                                                  
*==================================================================             
* TRAFFIC BUY ACTIVITY RECORDS                                                  
* ADD PASSIVE POINTER FOR FIRST WEEK WITH ACTIVITY UP TO 7 DAYS AGO             
* SET THE X'02' BIT IN THE ACTIVITY ELEMENT FOR THE CHOSEN WEEK                 
* AND MAKE SURE NO OTHER X'02' BITS ARE ON                                      
*==================================================================             
                                                                                
ADDTBA   MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         LA    R4,REC+24           POINT TO FIRST ELEMENT                       
         MVI   ELCODE,X'05'                                                     
         BRAS  R9,NEXTEL2          FIND FIRST ACTIVITY ELEM                     
         BNE   EXIT                                                             
*                                                                               
ADDTBA4  TM    TBADTAAC-TBADTAEL(R4),TBADTA8A  TEST USE FOR 8A PTR              
         BO    ADDTBA10                                                         
*                                                                               
         BRAS  R9,NEXTEL                                                        
         BE    ADDTBA4                                                          
         B     EXIT                                                             
*                                                                               
ADDTBA10 GOTO1 =V(DATCON),DMCB,(2,2(R4)),DUB   UNPACK ACTIVE DATE               
         GOTO1 =V(PERVERT),DMCB,SVTDYLS1,DUB   GET DAYS BETWEEN DATES           
         CLC   8(2,R1),=H'195'              MORE THAN 195 DAYS AWAY             
         BH    ADDTBA12                     YES -FORGET IT                      
*                                                                               
         MVI   KEY,X'8A'           TYPE                                         
         MVC   KEY+1(3),REC+2      A-M/CLT                                      
         LH    R0,8(R1)            GET DAYS INCLUSIVE                           
         BCTR  R0,0                ADJUST TO DAYS BETWEEN DATES                 
         STC   R0,KEY+4            AND SET DAYS TO FIRST AIR DATE               
         MVC   KEY+5(8),REC+5      MKT/STA/PRD/...                              
         BRAS  R9,ADDKEY                                                        
*                                                                               
ADDTBA12 B     EXIT                                                             
                                                                                
*==========================================================                     
* TRAFFIC PRODUCT EQUIVALENCY RECORDS                                           
*==========================================================                     
                                                                                
ADDTPE   MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
         SPACE 1                                                                
* MOVE PRODUCT TO KEY+9 AND REPLACE PRODUCT WITH EQUIV PROD                     
         SPACE 1                                                                
         OI    KEY+1,X'80'                                                      
         MVC   KEY+9(3),KEY+5      MOVE PRODUCT                                 
         SPACE 1                                                                
* FIND X'10' ELEMENT(S)                                                         
         SPACE 1                                                                
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'10'                                                     
         CLI   0(R4),X'10'                                                      
         B     *+8                                                              
ADDTPE10 BAS   R9,NEXTEL                                                        
         BNE   EXIT                ELEM SHOULD BE THERE BUT CANT STOP           
*                                                                               
         MVC   KEY+5(3),2(R4)      MOVE EQUIV PRODUCT                           
         BRAS  R9,ADDKEY                                                        
         B     ADDTPE10                                                         
         EJECT                                                                  
* SUPERDESK SUPERVISOR  - X'0D61'                                               
*                                                                               
ADDSPV   MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
         SPACE 1                                                                
* ADD PASSIVE POINTER KEY *                                                     
         SPACE 1                                                                
         MVI   KEY+1,X'E1'         X'0DE1'                                      
         MVC   KEY+8(4),REC+5      SUPV                                         
*                                                                               
         OI    KEY+2,X'01'         TV CLIENTS                                   
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'02'                                                     
ASPV05   BAS   R9,NEXTEL                                                        
         BNE   ASPV10                                                           
         MVC   KEY+5(3),2(R4)      CLIENT                                       
         BRAS  R9,ADDKEY                                                        
         B     ASPV05                                                           
*                                                                               
ASPV10   NI    KEY+2,X'F0'         CLEAR MEDIA AND SET FOR                      
         OI    KEY+2,X'02'         RADIO CLIENTS                                
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'03'                                                     
ASPV15   BAS   R9,NEXTEL                                                        
         BNE   ASPV20                                                           
         MVC   KEY+5(3),2(R4)      CLIENT CODE                                  
         BRAS  R9,ADDKEY                                                        
         B     ASPV15                                                           
*                                                                               
ASPV20   NI    KEY+2,X'F0'         CLEAR MEDIA AND SET FOR                      
         OI    KEY+2,X'04'         MEDIA X CLIENTS                              
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'04'                                                     
ASPV25   BAS   R9,NEXTEL                                                        
         BNE   ASPV30                                                           
         MVC   KEY+5(3),2(R4)      CLIENT                                       
         BRAS  R9,ADDKEY                                                        
         B     ASPV25                                                           
*                                                                               
ASPV30   NI    KEY+2,X'F0'        CLEAR MEDIA AND SET FOR                       
         OI    KEY+2,X'03'        NETWORK CLIENTS                               
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'05'                                                     
ASPV35   BAS   R9,NEXTEL                                                        
         BNE   EXIT                                                             
         MVC   KEY+5(3),2(R4)        CLIENT CODE                                
         BRAS  R9,ADDKEY                                                        
         B    ASPV35                                                            
         EJECT                                                                  
* SUPERDESK BUYER - X'0D62'                                                     
*                                                                               
ADDBYR   MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
* ADD PASSIVE POINTER KEYS                                                      
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'30'        BUYER/BILLER NAME ELEM                       
         BAS   R9,NEXTEL2                                                       
         BNE   ABYR01                                                           
         CLC   4(10,R4),=CL10' '   SKIP BLANK KEYS                              
         BNH   ABYR01                                                           
         MVI   KEY+1,X'E4'         X'0DE4'                                      
         MVC   KEY+3(10),4(R4)     BUBL NAME                                    
         BRAS  R9,ADDKEY                                                        
*                                                                               
ABYR01   MVC   KEY(13),REC                                                      
         MVI   KEY+1,X'E3'         X'0DE3'                                      
         MVC   KEY+9(4),REC+5      BUYER                                        
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'01'                                                     
         BAS   R9,NEXTEL2                                                       
         BNE   ABYR02                                                           
         MVC   KEY+5(4),26(R4)     SUPV                                         
         BRAS  R9,ADDKEY                                                        
*                                                                               
ABYR02   MVC   KEY(13),REC                                                      
         MVI   KEY+1,X'E2'         X'0DE2'                                      
         MVC   KEY+7(4),REC+5      BUYER                                        
         OI    KEY+2,X'01'         TV MARKETS                                   
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'02'                                                     
ABYR05   BAS   R9,NEXTEL                                                        
         BNE   ABYR10                                                           
         MVC   KEY+5(2),2(R4)      MARKET                                       
         BRAS  R9,ADDKEY                                                        
         B     ABYR05                                                           
*                                                                               
ABYR10   NI    KEY+2,X'F0'         CLEAR MEDIA AND SET FOR                      
         OI    KEY+2,X'02'         RADIO MARKETS                                
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'03'                                                     
ABYR15   BAS   R9,NEXTEL                                                        
         BNE   ABYR20                                                           
         MVC   KEY+5(2),2(R4)      MARKET                                       
         BRAS  R9,ADDKEY                                                        
         B     ABYR15                                                           
*                                                                               
ABYR20   NI    KEY+2,X'F0'         CLEAR MEDIA AND SET FOR                      
         OI    KEY+2,X'04'         MEDIA X MARKETS                              
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'04'                                                     
ABYR25   BAS   R9,NEXTEL                                                        
         BNE   EXIT                                                             
         MVC   KEY+5(2),2(R4)      MARKETS                                      
         BRAS  R9,ADDKEY                                                        
         B     ABYR25                                                           
         EJECT                                                                  
*==============================================================                 
* NOTE THAT THIS ROUTINE REQUIRES NO BASE REGISTER - CAREFUL !                  
*==============================================================                 
         SPACE 1                                                                
ADDKEY   MVC   KEY+13(1),15(R7)    SET CONTROL BYTE                             
*                                                                               
         L     R8,NEXTDIR                                                       
         MVC   0(18,R8),KEY        MOVE TO BUFFER                               
         LA    R8,18(R8)           UPDATE POINTER                               
         MVI   0(R8),0             SET END BUFFER FLAG                          
         ST    R8,NEXTDIR                                                       
         BR    R9                                                               
         SPACE 2                                                                
EXIT     XIT1                                                                   
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
**********************************************************************          
* CONSTANTS                                                          *          
**********************************************************************          
                                                                                
TDYLSS2W DC    XL2'0000'           COMPRESSED (TODAY'S DATE LESS 2 WKS)         
TDYLSS1W DC    XL2'0000'           COMPRESSED (TODAY'S DATE LESS 1 WK)          
SVTDYLS1 DC    XL6'0000'           YYMMDD OF ONE WEEK AGO                       
         EJECT                                                                  
*=========================================================                      
* CLIENT HEADERS                                                                
*=========================================================                      
                                                                                
ADDCLT   NTR1  BASE=*,LABEL=*                                                   
         MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY           ADD ACTIVE POINTER                           
* ADD OFFICE PASSIVE POINTER                                                    
         CLI   COFFICE,C' '                                                     
         BNH   ADDCLT10                                                         
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0D80'                                                  
         MVC   KEY+2(1),REC+1      A/M                                          
         MVC   KEY+9(1),COFFICE                                                 
         MVC   KEY+11(2),REC+2     CLT                                          
         BRAS  R9,ADDKEY                                                        
*                                                                               
* ADD NETWORK CLTGRP PASSIVE POINTERS                                           
*                                                                               
ADDCLT10 XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0D86'                                                  
         MVC   KEY+2(1),REC+1      A/M                                          
         MVC   KEY+8(2),REC+2      CLT                                          
*                                                                               
         XC    WORK,WORK                                                        
         MVC   WORK(15),CGRP1      FIRST 5 GROUPS HERE                          
*                                                                               
         OC    CGRP5,CGRP5         TEST THERE IS A FIFTH GROUP                  
         JNZ   *+10                IF SO, 6-10 ARE ASSUMED TO BE OK             
         XC    CGRP6(15),CGRP6     BUT IF NOT 5, CAN'T BE 6-10                  
*                                                                               
         MVC   WORK+15(15),CGRP6   THEN NEXT 5 HERE                             
*                                                                               
         LA    R4,WORK                                                          
         LA    R5,10               MAXIMUM OF 10 ASSIGNMENTS                    
*                                                                               
ADDCLT12 OC    0(3,R4),0(R4)       TEST FOR ANOTHER ASSIGNMENT                  
         JZ    EXIT                NO - DONE                                    
*                                                                               
         MVC   KEY+5(3),0(R4)                                                   
         BRAS  R9,ADDKEY           ADD PASSIVE KEY                              
         LA    R4,3(R4)                                                         
         BCT   R5,ADDCLT12                                                      
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
*=============================================================                  
* PRODUCT HEADERS                                                               
*=============================================================                  
                                                                                
ADDPRD   NTR1  BASE=*,LABEL=*                                                   
         MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
* ADD PASSIVE FOR PRDLIST                                                       
*                                                                               
K        USING PLSTPSSV,KEY                                                     
         XC    KEY,KEY                                                          
         MVI   K.PLSTTYPE,X'0D'                                                 
         MVI   K.PLSTSUB,X'F1'                                                  
         MVC   K.PLSTAM,PKEYAM     A-M                                          
         MVC   K.PLSTCLT,PKEYCLT   CLT                                          
         MVC   K.PLSTPRD,PKEYPRD   ALPHA PRD                                    
         CLC   PKEYPRD,=C'POL'                                                  
         BNE   *+8                                                              
         MVI   K.PLSTXFF,X'FF'                                                  
         MVC   K.PLSTBPRD,PCODE    BPRD                                         
         BRAS  R9,ADDKEY                                                        
         DROP  K                                                                
*                                                                               
* ADD PRDGRP PASSIVE POINTERS                                                   
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0D81'                                                  
         MVC   KEY+2(3),REC+1      A/M/CLT                                      
         MVC   KEY+8(3),REC+4     PRD                                           
*                                                                               
         LA    R4,PGRP1                                                         
         LA    R5,3                                                             
*                                                                               
ADDPRD2  OC    0(3,R4),0(R4)       TEST FOR ASSGNMNT                            
         BZ    ADDPRD3             NO                                           
*                                                                               
         MVC   KEY+5(3),0(R4)                                                   
         BRAS  R9,ADDKEY                                                        
*                                                                               
ADDPRD3  LA    R4,3(R4)                                                         
         BCT   R5,ADDPRD2                                                       
*                                                                               
* NOW ADD POINTERS FOR PGRP4 AND PGRP5 -- NOTE DISCONTINUITY                    
*                                                                               
         LA    R4,PGRP4                                                         
         LA    R5,2                                                             
*                                                                               
ADDPRD4  OC    0(3,R4),0(R4)       TEST FOR ASSGNMNT                            
         BZ    ADDPRD5             NO                                           
*                                                                               
         MVC   KEY+5(3),0(R4)                                                   
         BRAS  R9,ADDKEY                                                        
*                                                                               
ADDPRD5  LA    R4,3(R4)                                                         
         BCT   R5,ADDPRD4                                                       
*                                                                               
* AND LASTLY PGRP6-PGRP10                                                       
*                                                                               
         LA    R4,PGRP6                                                         
         LHI   R5,5                                                             
*                                                                               
ADDPRD6  OC    0(3,R4),0(R4)       TEST FOR ASSGNMNT                            
         BZ    ADDPRD7             NO                                           
*                                                                               
         MVC   KEY+5(3),0(R4)                                                   
         BRAS  R9,ADDKEY                                                        
*                                                                               
ADDPRD7  AHI   R4,3                                                             
         BCT   R5,ADDPRD6                                                       
         J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
**********************************************************************          
* ESTIMATE HEADERS                                                   *          
**********************************************************************          
                                                                                
ADDEST   NTR1  BASE=*,LABEL=*                                                   
         MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         USING ESTD,R4                                                          
         LR    R4,R7               R2=A(REC)                                    
*                                                                               
         USING ESTAD,R2                                                         
         LA    R2,KEY                                                           
         XC    KEY,KEY                                                          
         MVI   EPKEYTYP,EPKEYTYQ       X'0D'                                    
         MVI   EPKEYSUB,EPKEYSBQ       X'F2'                                    
         MVC   EPKEYAM,EKEYAM          AGENCY/MEDIA                             
         MVC   EPKEYCLT,EKEYCLT        CLIENT CODE                              
         MVC   EPKEYEST,EKEYEST        ESTIMATE                                 
         MVC   EPKEYPRD,EKEYPRD        PRODUCT                                  
         XC    EPKEYSDT,EPKEYSDT                                                
         GOTOR CHKEDT,ESTART       VALIDATE ESTIMATE START DATE                 
         JNE   ADDESTE                                                          
         GOTO1 =V(DATCON),DMCB,(0,ESTART),(2,EPKEYSDT)                          
         GOTOR CHKEDT,EEND         VALIDATE ESTIMATE END DATE                   
         JNE   ADDESTE                                                          
         GOTO1 =V(DATCON),DMCB,(0,EEND),(2,EPKEYEDT)                            
*                                                                               
         BRAS  R9,ADDKEY                                                        
         J     EXIT                                                             
*                                                                               
ADDESTE  LT    RA,=V(CPRINT)       PRINT INVALID ESTIMATE DATES                 
         JZ    EXIT                                                             
         USING DPRINT,RA                                                        
         LT    RF,=V(HEXOUT)                                                    
         JZ    EXIT                                                             
         LT    RF,=V(PRINTER)                                                   
         JZ    EXIT                                                             
         MVC   P,SPACES                                                         
         MVC   P(12),=C'INV EST DATE'                                           
         GOTO1 =V(HEXOUT),DMCB,(R7),P+17,13,=C'MIX'                             
         MVC   P+45(4),=C'PRO='                                                 
         MVC   P+49(3),REC+4                                                    
         MVC   P+53(6),=C'DATES='                                               
         MVC   P+59(12),ESTART                                                  
         MVC   P+72(19),=C'PASSIVE NOT CREATED'                                 
         GOTO1 =V(PRINTER)                                                      
         J     EXIT                                                             
         DROP  R2,R4,RA                                                         
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO TEST FOR VALID EBCDIC DATE                                         
* ROUTINE TO TEST FOR VALID EBCDIC DATE.                                        
* MAX YEAR IS 2027 FOR OLD STYLE COMPRESSED DATES.                              
***********************************************************************         
                                                                                
CHKEDT   CLI   0(R1),X'F0'         FIRST BYTE BETWEEN X'F0' AND X'FC'           
         BLR   RE                                                               
*                                                                               
         CLI   0(R1),X'FA'         EBCDIC DATE IN DECADES 2000?                 
         BE    CHKEDT04                                                         
         CLI   0(R1),X'FB'                                2010?                 
         BE    CHKEDT04                                                         
         CLI   0(R1),X'FC'                                2020?                 
         BHR   RE                  GREATER THAN THIS IS NO GOOD                 
         BL    CHKEDT01            LESS MEANS DATE IN THE CENTURY 1900          
         CLI   1(R1),C'7'          X'FCF7F1F2F3F1' IS MAX 2027-12-31            
         BHR   RE                  CAN'T BE HIGHER, YET                         
         B     CHKEDT04                                                         
***************                                                                 
* EBCDIC DATE YYMMDD'S FIRST CHARACTER IS C'0'-C'9'                             
***************                                                                 
CHKEDT01 CLC   0(2,R1),=C'64'      64-99 ASSUMED TO BE 1964-1999                
         BH    CHKEDT04                                                         
         CLC   0(2,R1),=C'27'      TREAT YEARS 00-27 AS 2000-2027               
         BHR   RE                  YEARS 28-63 ARE INVALID                      
***************                                                                 
* EBCDIC DATE YYMMDD HAS A VALID FIRST CHARACTER                                
***************                                                                 
CHKEDT04 LA    RF,1(R1)            REMAINING CHRS MUST BE NUMERIC               
         LHI   R0,L'ESTART-1                                                    
CHKEDT06 CLI   0(RF),C'0'                                                       
         BLR   RE                                                               
         CLI   0(RF),C'9'                                                       
         BHR   RE                                                               
         AHI   RF,1                                                             
         JCT   R0,CHKEDT06                                                      
         CR    RE,RE                                                            
         BR    RE                                                               
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO TEST FOR VALID SHORT JULIAN DATE                         *         
***********************************************************************         
                                                                                
CHKJDT   ICM   R0,7,0(R1)                                                       
         SLL   R0,32-12                                                         
         SRL   R0,32-12                                                         
         CHI   R0,X'366'                                                        
         BHR   RE                                                               
         LTR   R0,R0                                                            
         JNZ   *+8                                                              
         LTR   RE,RE                                                            
         BR    RE                                                               
                                                                                
         ICM   R0,7,0(R1)                                                       
         LHI   RF,6                                                             
CHKJDT02 SRDL  R0,4                                                             
         SRL   R1,32-4                                                          
         CHI   R1,9                                                             
         BHR   RE                                                               
         JCT   RF,CHKJDT02                                                      
         CR    RE,RE                                                            
         BR    RE                                                               
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
                                                                                
         LTORG                                                                  
         EJECT                                                                  
*============================================================                   
* GOAL RECORDS                                                                  
*============================================================                   
                                                                                
ADDGOAL  NTR1  BASE=*,LABEL=*                                                   
         MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         TM    GKEYAGY,X'40'       TEST GKEYPRD2 NOT A PRODUCT                  
         JO    EXIT                YES - EXIT (NO ADVERTISER POINTERS)          
*                                                                               
         CLI   GKEYPRD2,0          TEST PIGGYBACK                               
         BE    ADDG2               NO                                           
         SPACE 1                                                                
* CREATE PASSIVE POINTER *                                                      
         SPACE 1                                                                
         MVC   KEY+4(1),GKEYPRD2   SET PRD1 CODE = PRD2                         
         ZIC   R1,GKEYSEC          GET TOTAL SECONDS                            
         ZIC   R0,GKEYSLN          GET PRD1 SLN                                 
         SR    R1,R0                                                            
         STC   R1,KEY+9            SET PRD2 LEN                                 
         OI    KEY+11,X'80'        INDICATE PASSIVE                             
         MVC   KEY+12(1),GKEYPRD   SET PRD2 CODE = PRD1                         
*                                                                               
         BRAS  R9,ADDKEY                                                        
*                                                                               
ADDG2    CLI   GADVAGY,0           CHECK FOR ADVTSR                             
         JE    EXIT                                                             
*                                                                               
         MVC   KEY(13),REC         RESTORE KEY                                  
         SR    RE,RE                                                            
         IC    RE,KEY+1            GET AGY/MED CODE                             
         SRDL  RE,4                ISOLATE AGY IN RE/MED IN RF                  
         STC   RE,KEY+11                                                        
*                                                                               
         IC    RE,GADVAGY                                                       
         SLDL  RE,4                                                             
         STC   RE,KEY+1                                                         
*                                                                               
         BRAS  R9,ADDKEY                                                        
*                                                                               
         TM    GKEYAGY,X'40'       TEST PACKAGE SWITCH                          
         JO    EXIT                YES, NOT A PIGGY                             
*                                                                               
         CLI   GKEYPRD2,0          TEST PIGGYBACK                               
         JE    EXIT                NO                                           
         SPACE 1                                                                
* CREATE PASSIVE POINTER *                                                      
         SPACE 1                                                                
         MVC   KEY+4(1),GKEYPRD2   SET PRD1 CODE = PRD2                         
         ZIC   R1,GKEYSEC          GET TOTAL SECONDS                            
         ZIC   R0,GKEYSLN          GET PRD1 SLN                                 
         SR    R1,R0                                                            
         STC   R1,KEY+9            SET PRD2 LEN                                 
         OI    KEY+11,X'80'        INDICATE PASSIVE                             
         MVC   KEY+12(1),GKEYPRD   SET PRD2 CODE = PRD1                         
*                                                                               
         BRAS  R9,ADDKEY                                                        
         J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
*===============================================================                
* ADDS RECORDS                                                                  
*===============================================================                
         SPACE 1                                                                
ADDADDS  NTR1  BASE=*,LABEL=*                                                   
         MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         OC    REC+6(7),REC+6      BUYER RECORD?                                
         BNZ   ADDADDS8            NO                                           
*                                                                               
* ADD BUYER PASSIVE POINTERS                                                    
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0DC1'     RECORD ID                                    
         MVC   KEY+2(1),REC+2      A/M                                          
         MVC   KEY+8(3),REC+3      BUYER                                        
*                                                                               
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'30'        MARKET ELEMENTS                              
         CLC   0(1,R4),ELCODE                                                   
         BE    ADDADDS4                                                         
*                                                                               
ADDADDS2 BRAS  R9,NEXTEL                                                        
         JNE   EXIT                                                             
*                                                                               
ADDADDS4 MVC   KEY+3(2),2(R4)      MOVE MARKET                                  
         MVC   KEY+5(3),4(R4)      MOVE DATE                                    
         BRAS  R9,ADDKEY                                                        
         B     ADDADDS2                                                         
*                                                                               
ADDADDS8 OC    REC+8(5),REC+8      AVAIL RECORD?                                
         JZ    EXIT                NO                                           
*                                                                               
* ADD AVAIL PASSIVE POINTER                                                     
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0DB1'     RECORD ID                                    
         MVC   KEY+2(1),REC+2      A/M                                          
         MVC   KEY+3(3),REC+10     REFERENCE NUMBER                             
         MVC   KEY+6(7),REC+3      BUYER/CLT/PRD/EST                            
         BRAS  R9,ADDKEY                                                        
         J     EXIT                                                             
         LTORG                                                                  
*===============================================================                
* ADD STATION BUCKET POINTER BY 3 CHAR PRODUCT                                  
*===============================================================                
         SPACE 1                                                                
ADDSTAB  NTR1  BASE=*,LABEL=*                                                   
         MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
         SPACE 1                                                                
         TM    REC+15,X'02'        MAKE SURE ITS NETWORK                        
         BZ    ADDSTAX                                                          
* REFORMAT FOR 3CHAR PRODUCT KEY *                                              
         SPACE 1                                                                
         OI    KEY+1,X'80'                                                      
         XC    KEY+5(8),KEY+5      CLEAR AFTER CLIENT                           
         MVC   KEY+5(3),REC+9      3 CHAR PRODUCT                               
         MVC   KEY+8(1),REC+6      ESTIMATE                                     
         BRAS  R9,ADDKEY                                                        
ADDSTAX  J     EXIT                                                             
         LTORG                                                                  
*===============================================================                
* ADD CTA CONTRACT PARTICIPANT PASSIVE POINTER                                  
*===============================================================                
         SPACE 1                                                                
ADDCTA   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
         USING CTPARD,R4                                                        
*                                                                               
* MAKE SURE CONTRACT NUMBER IS NUMERIC                                          
*                                                                               
         LA    R1,KEY                                                           
         USING CTAPASS,R1                                                       
*                                                                               
         UNPK  DUB,CTAPCNUM(4)     UNPACK ONE EXTRA BYTE                        
         LA    RE,DUB+1            POINT TO FIRST DIGIT OF CONTRACT             
         LA    RF,6                                                             
ADDCTA4  CLI   0(RE),C'0'                                                       
         JL    EXIT                CAN'T AFFORD TO DIE !                        
         CLI   0(RE),C'9'                                                       
         JH    EXIT                                                             
         LA    RE,1(RE)                                                         
         BCT   RF,ADDCTA4                                                       
*                                                                               
         OI    CTAPTYP+1,X'80'     SET  PASSIVE FLAG                            
         ZAP   DUB(4),=P'999999'                                                
         ZAP   DUB+4(4),=P'999999'                                              
*                                                                               
         MVO   DUB+4(4),CTAPCNUM                                                
         SP    DUB(4),DUB+4(4)                                                  
         SRP   DUB(4),1,0                                                       
         MVC   CTAPCNUM,DUB                                                     
*                                                                               
* FIND X'05' PARTICIPANT ELEMENTS                                               
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'05'                                                     
*                                                                               
ADDCTA6  BRAS  R9,NEXTEL                                                        
         BNE   ADDCTA10            ELEM SHOULD BE THERE BUT CANT STOP           
         MVC   CTAPMKT(5),CTPARMKT SET MARKET AND STATION                       
         BRAS  R9,ADDKEY                                                        
         B     ADDCTA6                                                          
* ADD CONTRACTOR PASSIVE FOR BEALS                                              
ADDCTA10 MVI   CTCPSUB,CTCPSUBQ    SET SUBTYPE                                  
         LA    R4,REC+24                                                        
         USING CTDSCEL,R4                                                       
         MVC   CTCPCNTR,CTDSCNTR   SET CONTRACTOR                               
         MVC   CTCPCNUM,DUB        SET CONTRACT NUMBER                          
         MVI   CTCPCNUM+L'CTCPCNUM,0                                            
         BRAS  R9,ADDKEY                                                        
         J     EXIT                                                             
         DROP  R1,R4                                                            
         LTORG                                                                  
         EJECT                                                                  
* DARE RECORDS                                                                  
*                                                                               
ADDDARE  NTR1  BASE=*,LABEL=*                                                   
         MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         CLI   REC+DOKCMT-DOKEY,0   COMMENT RECORD?                             
         JNE   EXIT                 YES, NO PASSIVE PTRS FOR COMMENTS           
*                                                                               
* ADD BUYER PASSIVE POINTERS                                                    
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0DB4'     RECORD ID                                    
         MVC   KEY+2(1),REC+4      A/M                                          
*                                                                               
         LA    R4,REC+24                                                        
         USING DOIDELD,R4                                                       
*                                                                               
         MVC   KEY+3(3),DOIDBYR    MOVE BUYER                                   
         MVC   KEY+6(4),REC+5      MOVE ORDER NUMBER                            
         MVC   KEY+10(3),REC+9      MOVE STATION                                
         BRAS  R9,ADDKEY                                                        
*                                                                               
* ADD STATION PASSIVE POINTERS                                                  
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0DB7'     RECORD ID                                    
         MVC   KEY+2(1),REC+4      A/M                                          
         MVC   KEY+3(3),DOIDBYR    MOVE BUYER                                   
         MVC   KEY+6(3),REC+9      MOVE STATION                                 
         MVC   KEY+9(4),REC+5      MOVE ORDER NUMBER                            
         BRAS  R9,ADDKEY                                                        
*                                                                               
* ADD CLIENT PASSIVE POINTER (R4 STILL POINTS TO 01 ELEMENT)                    
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0DB5'     RECORD ID                                    
         MVC   KEY+2(1),REC+4      A/M                                          
         MVC   KEY+3(3),DOIDCLT    CLT/PRD                                      
         MVC   KEY+6(4),DOIDEST    EST/STATION                                  
         MVC   KEY+10(1),DOIDPRD2  PIGGY                                        
         MVC   KEY+11(1),DOIDFLTN  FLIGHT NUMBER                                
         LR    RF,R4                                                            
         XR    R9,R9                                                            
ADARE05  IC    R9,1(RF)            LOOK FOR THE SUPPLEMENTARY ELEM              
         AR    RF,R9                                                            
         CLI   0(RF),0                                                          
         BE    ADARE10                                                          
         CLI   0(RF),DOSPELQ                                                    
         BH    ADARE10             IF NONE, THEN NO TRADE FLAG                  
         BNE   ADARE05                                                          
         TM    DOSPFLG1-DOSPELD(RF),DOSPTRDE                                    
         BZ    *+8                                                              
         OI    KEY+12,DCKFTRDE     X'80' TRADE FLAG                             
*                                                                               
         TM    DOSPDKYF-DOSPELD(RF),DOSPFNSN  X'02' - ORDER NEVER SENT?         
         BZ    *+8                                                              
         OI    KEY+12,DCKFNSNT     X'02' - NEVER SENT                           
*                                                                               
         TM    DOSPDKYF-DOSPELD(RF),DOSPFCCD  X'04' - CONCEDED TO ANOT?         
         BZ    *+8                                                              
         OI    KEY+12,DCKFCCDE     X'04' YES, CONECEDE TO ANOTHER ORD           
*                                                                               
         OC    DOSPFSTA-DOSPELD(L'DOSPFSTA,RF),DOSPFSTA-DOSPELD(RF)             
         BZ    ADARE10             NO FIRST EDI SEND STATION                    
         CLC   DOSPFSTA-DOSPELD(L'DOSPFSTA,RF),KEY+7  THERE IS                  
         BE    *+8                 BUT IT MATCHES STATION ON ORDER              
         OI    KEY+12,DCKFSCSW     X'01' STATION CALL LETTER SWITCH             
ADARE10  BRAS  R9,ADDKEY                                                        
*                                                                               
* ADD STATUS COLOR PASSIVE POINTER (R4 STILL POINTS TO 01 ELEMENT)              
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0DB8'     RECORD ID                                    
         MVC   KEY+2(1),REC+4      A/M                                          
         MVC   KEY+3(3),DOIDBYR    BUYER                                        
         MVC   KEY+9(4),REC+5      ORDER NUMBER                                 
         LR    RF,R4                                                            
         XR    R9,R9                                                            
ADARE12  IC    R9,1(RF)            LOOK FOR A COLOR ELEM                        
         AR    RF,R9                                                            
         CLI   0(RF),0                                                          
         BE    ADARE14                                                          
         CLI   0(RF),COLELQ                                                     
         BNE   ADARE12                                                          
         USING COLOREL,RF                                                       
         MVC   KEY+6(1),COLCOL                                                  
         MVC   KEY+7(2),COLDATE                                                 
         B     ADARE45                                                          
         DROP  RF                                                               
*                                                                               
ADARE14  LR    RF,R4                                                            
         XR    R9,R9                                                            
ADARE15  IC    R9,1(RF)            LOOK FOR A TRANSMISSION ELEM                 
         AR    RF,R9                                                            
         CLI   0(RF),0                                                          
         BE    ADARE35                                                          
         CLI   0(RF),DOXMTELQ                                                   
         BH    ADARE35             NONE, GREEN STATE W/O A DATE                 
         BNE   ADARE15                                                          
*                                                                               
         LR    R9,RF                                                            
         USING DOXMTELD,R9                                                      
         LA    R1,DOXMTSTD         USE STATUS DATE                              
         CLI   DOXMTSTA,0          ANY STATUS?                                  
         BNE   *+8                 YES                                          
         LA    R1,DOXMTYMD         NONE, USE SEND DATE                          
         ST    R1,DMCB                                                          
         MVI   DMCB,8                                                           
         GOTOR CHKJDT                                                           
         JNE   EXIT                                                             
         GOTO1 =V(DATCON),DMCB,,(2,KEY+7)   PUT INTO THIS KEY                   
*                                                                               
         CLI   DOXMTSTA,0          ANY STATUS?                                  
         BNE   ADARE20             YES                                          
         CLC   =X'FFFF',DOXMTDID   NO, FAX REP?                                 
         BE    ADARE35                 YES, CAN STILL SEND                      
         OC    DOXMTDND,DOXMTDND   ANY DELIVERY DATE?                           
         BZ    ADARE35                 NONE, GREEN SO AGY KNOW PROBLEM          
         MVI   KEY+6,C'R'          YES, STILL ON REP SIDE                       
         B     ADARE40                                                          
*                                                                               
ADARE20  MVI   KEY+6,C'R'          STATUS                                       
         LA    RF,REDSTTBL                                                      
ADARE23  CLI   0(RF),X'FF'         END OF THIS TABLE                            
         BE    ADARE28                                                          
         CLC   DOXMTSTA,0(RF)                                                   
         BNE   ADARE26                                                          
         CLI   KEY+6,C'K'          QUIET ORDERS?                                
         BNE   ADARE40                                                          
         L     RE,=A(TDYLSS2W)                                                  
         CLC   KEY+7(2),0(RE)      BEFORE 2 WEEKS AGO                           
         BL    ADARE60                                                          
         B     ADARE40                                                          
ADARE26  LA    RF,1(RF)                                                         
         B     ADARE23                                                          
         DROP  R9                                                               
*                                                                               
ADARE28  LA    R0,BLKSTTBL                                                      
         CR    RF,R0                                                            
         BNL   ADARE35                                                          
         MVI   KEY+6,C'K'          STATUS                                       
         LA    RF,BLKSTTBL                                                      
         B     ADARE23                                                          
*                                                                               
REDSTTBL DC    AL1(QAPP)                                                        
         DC    AL1(QRECALL)                                                     
         DC    AL1(QRCLCONF)                                                    
         DC    AL1(QRCLREJD)                                                    
*****    DC    AL1(QRCLUNKN)                                                    
         DC    X'FF'                                                            
*                                                                               
BLKSTTBL DC    AL1(QCFMDPND)                                                    
         DC    AL1(QCFMD)                                                       
         DC    AL1(QNODARE)                                                     
         DC    AL1(QUNDARE)                                                     
         DC    AL1(QFAXDLVD)                                                    
         DC    X'FF'                                                            
*                                                                               
ADARE35  MVI   KEY+6,C'G'          GREEN STATE - AGENCY'S TURN, NO DATE         
ADARE40  XC    KEY+7(2),=X'FFFF'   MOST RECENT FIRST                            
*                                                                               
ADARE45  CLC   KEY+7(2),=X'34BE'   ACTIVITY ON OR AFTER OCT01/01?               
         BH    ADARE60             NO, BEFORE OCT01/01  (COMPLEMENTED)          
         BRAS  R9,ADDKEY                                                        
*                                                                               
* ADD BYR(PACKED)/CLT/MKT AND BYR(PACKED)/MKT/CLT PASSIVE KEYS                  
*                                                                               
ADARE60  LA    R6,KEY                                                           
         USING DOKEY,R6                                                         
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0DBE'     BYR(PACKED)/CLT/MKT PASSIVE                  
         MVC   DBCKAGMD,REC+4      A/M                                          
         LA    R2,DOIDBYR                                                       
         MVC   DBCKCLT,DOIDCLT     CLT                                          
         LR    R9,R4                                                            
ADARE62  CLI   0(R9),0             DOSPELQ NOT FOUND?                           
         BE    ADARE80                                                          
         CLI   0(R9),DOSPELQ       DIE WE FIND X'03'                            
         BE    ADARE64                                                          
         ZIC   R0,1(R9)            BUMP TO NEXT ELEM                            
         AR    R9,R0                                                            
         B     ADARE62                                                          
*                                                                               
PACKIT   BAS   R8,PACKIT0          GET THE VALUE OF 1ST CHAR IN R3              
         MHI   R3,37*37            MULTIPLY BY  37*37                           
         LR    R5,R3               SAVE TOTAL IN R5                             
         LA    R2,1(R2)            BUMP TO 2ND CHAR                             
         BAS   R8,PACKIT0          GET THE VALUE OF 2ND CHAR IN R3              
         MHI   R3,37               MULTIPLY BY 37                               
         AR    R5,R3               ADD TO TOTAL IN R5                           
         LA    R2,1(R2)            BUMP TO 3RD CHAR                             
         BAS   R8,PACKIT0          GET THE VALUE OF 3RD CHAR IN R3              
         AR    R5,R3               ADD TO TOTAL IN R5                           
         BR    RE                  PACKED BUYER IN R5                           
*                                                                               
PACKIT0  LA    R3,PACKTAB                                                       
PACKIT1  CLI   0(R3),X'FF'         END OF TRANSLATE TABLE?                      
         BE    ADARE80             YES, SKIP THIS KEY                           
         CLC   0(1,R2),0(R3)                                                    
         BE    PACKIT2                                                          
         LA    R3,1(R3)                                                         
         B     PACKIT1                                                          
PACKIT2  LA    R0,PACKTAB                                                       
         SR    R3,R0                                                            
         BR    R8                                                               
*                                                                               
PACKTAB  DC    C' ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'                         
         DC    X'FF'                                                            
*                                                                               
         USING DOSPELD,R9                                                       
ADARE64  OC    DOSPMKT,DOSPMKT     DO WE HAVE MARKET?                           
         BZ    ADARE80             NO, THEN DON'T ADD BAD KEYS                  
         MVC   DBCKMKT,DOSPMKT     MARKET                                       
         DROP  R9                                                               
*                                                                               
         LA    R2,DOIDBYR                                                       
         BAS   RE,PACKIT           GET THE PACKED BUYER CODE                    
         STCM  R5,3,DBCKBYR        STORE PACKED BUYER CODE                      
*                                                                               
         MVC   DBCKORDR,REC+5      MOVE ORDER NUMBER                            
         BRAS  R9,ADDKEY                                                        
*                                                                               
         MVC   KEY(2),=X'0DBF'     BYR(PACKED)/MKT/CLT PASSIVE                  
         MVC   DBMKMKT,DBCKMKT     MARKET                                       
         MVC   DBMKCLT,DOIDCLT     CLT                                          
         BRAS  R9,ADDKEY                                                        
*                                                                               
* ADD CLIENT/PRODUCT/ESTIMATE/MARKET/ORDER PASSIVE KEY                          
*                                                                               
ADARE70  MVC   KEY(2),=X'0DBD'                                                  
         MVC   DCMKMKT,DBMKMKT                                                  
         MVC   DCMKCLT,DOIDCLT                                                  
         MVC   DCMKPRD,DOIDPRD                                                  
         MVC   DCMKEST,DOIDEST                                                  
         BRAS  R9,ADDKEY                                                        
         DROP  R6                                                               
*                                                                               
* ADD POL ORDER PASSIVE POINTER (R4 STILL POINTS TO 01 ELEMENT)                 
*                                                                               
ADARE80  ZIC   R0,1(R4)            R4 = A(ELEMENT AFTER X'01' ELEM)             
         AR    R4,R0                                                            
         CLI   0(R4),DOI2ELQ       IS THIS A POL/BRAND ORDER?                   
         JNE   EXIT                                                             
         USING DOI2ELD,R4                                                       
         OC    DOI2OORD,DOI2OORD   BRAND ORDER WITH ORIGINAL POL ORD #?         
         JZ    EXIT                NO                                           
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0DB6'               RECORD TYPE                        
         MVC   KEY+2(1),REC+4                A/M                                
         MVC   KEY+3(L'DOI2OORD),DOI2OORD    POL   ORDER #                      
         MVC   KEY+7(L'DOI2OORD),REC+5       BRAND ORDER #                      
         DROP  R4                                                               
         BRAS  R9,ADDKEY                                                        
         J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
*=============================================                                  
* DARE BATCH RECORDS                                                            
*=============================================                                  
                                                                                
ADDDBTC  NTR1  BASE=*,LABEL=*                                                   
         MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
* ADD DATE/TIME PASSIVE                                                         
         XC    KEY,KEY                                                          
         MVI   KEY,DDTKTYPQ        X'0D'                                        
         MVI   KEY+1,DDTKSTYQ      X'BC'                                        
         MVC   KEY+2(DBTKSTA-DBTKAGMD),REC+DBTKAGMD-DBTKEY  AGMD & MKT          
         MVC   KEY+5(L'DBTKCLT),REC+DBTKCLT-DBTKEY          CLT                 
         LA    R9,REC+DBTRFRST-DBTKEY                                           
         CLI   0(R9),DBINFELQ      X'01'-INFO ELEM?                             
         JNE   EXIT                                                             
         USING DBINFELD,R9                                                      
         LA    R1,DBINFDTC           USE CASH DATE AND TIME                     
         LA    R2,DBINFTMC                                                      
         CLC   DBINFDTC,DBINFDTT       UNLESS TRADE IS MORE RECENT              
         BNL   ADBTC10                                                          
         LA    R1,DBINFDTT                                                      
         LA    R2,DBINFTMT                                                      
         DROP  R9                                                               
ADBTC10  OC    0(L'DBINFTMC,R2),0(R2)    DO WE HAVE A TIME?                     
         JZ    EXIT                      NO, DON'T BOTHER                       
         MVC   KEY+9(L'DBINFTMC),0(R2)                                          
*                                                                               
         ST    R1,DMCB                                                          
         MVI   DMCB,8                                                           
         GOTO1 =V(DATCON),DMCB,,(2,KEY+7)   PUT INTO THIS KEY                   
         XC    KEY+7(2),=X'FFFF'            FF COMPLEMENT IT                    
*                                                                               
         BRAS  R9,ADDKEY                                                        
         J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
*=============================================                                  
* STATION LOCKIN RECORDS                                                        
*=============================================                                  
                                                                                
ADDSLOK  NTR1  BASE=*,LABEL=*                                                   
         MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
         LA    R1,KEY                                                           
         USING SLKRECD,R1                                                       
         CLI   SLKKPRD2,0          TEST PARTNER PRODUCT                         
         JE    EXIT                                                             
         IC    R9,SLKKPRD          YES-ADD PASSIVE WITH PRODUCTS                
         MVC   SLKKPRD,SLKKPRD2        REVERSED                                 
         STC   R9,SLKKPRD2                                                      
         IC    R9,SLKKLEN                                                       
         MVC   SLKKLEN,SLKKLEN2                                                 
         STC   R9,SLKKLEN2                                                      
         OI    SLKKIND,SLKKIPSV                                                 
         DROP  R1                                                               
         BRAS  R9,ADDKEY                                                        
         J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
*===========================================================                    
* ADD CANADIAN COMBINED POINTERS                                                
*===========================================================                    
                                                                                
ADDCMBD  NTR1  BASE=*,LABEL=*                                                   
         MVC   KEY+10(1),KEY       MOVE AGY/MED                                 
         NI    KEY+10,X'0F'        LEAVE MEDIA ONLY                             
*                                                                               
         NI    KEY,X'F0'           DROP MEDIA                                   
         OI    KEY,X'08'           SET MEDIA TO CMBD                            
         BRAS  R9,ADDKEY                                                        
*                                                                               
ADDCMBDX J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
*====================================================                           
* TRAFFIC COMMERCIAL RECORDS                                                    
*====================================================                           
                                                                                
ADDCML   NTR1  BASE=*,LABEL=*                                                   
         MVC   KEY(13),REC                                                      
         BRAS  R9,ADDKEY                                                        
*                                                                               
         OC    REC+5(8),REC+5      TEST FOR DUMMY CMML SEQ REC                  
         JZ    EXIT                YES - EXIT                                   
                                                                                
* FIND X'10' ELEMENT                                                            
                                                                                
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'10'                                                     
         BRAS  R9,NEXTEL2                                                       
         BNE   ADDCML2             ELEM SHOULD BE THERE BUT CANT STOP           
*                                                                               
         MVC   KEY(2),=X'0AA1'     MAKE KEY X'0AA1'                             
         XC    KEY+5(8),KEY+5      CLEAR LOW KEY                                
         MVC   KEY+5(3),2(R4)      MOVE SEQ NUMBER                              
         BRAS  R9,ADDKEY                                                        
                                                                                
* CREATE ADID POINTER FOR 8 BYTE CMML (MHER 7/08)                               
                                                                                
ADDCML2  MVC   KEY(13),REC                                                      
         MVC   ADID(8),KEY+5       MOVE 8 CHAR CMML                             
         MVC   ADID+8(4),=C'    '  LAST 4 CHAR ARE SPACES!                      
         GOTO1 VTRPACK,DMCB,(C'P',ADID),DUB                                     
         BNE   ADDCML4             SKIP IF INVALID                              
         MVC   KEY(2),=X'0AC1'                                                  
         MVC   KEY+5(8),DUB                                                     
         BRAS  R9,ADDKEY                                                        
                                                                                
* NEW 02/24/98 - NEW TELECASTER NUMBER PASSIVE KEY                              
                                                                                
ADDCML4  DS    0H                                                               
*        MVI   ELCODE,X'40'                                                     
*        BRAS  R9,NEXTEL                                                        
*        BNE   ADDCML10                                                         
*        MVC   KEY(2),=X'0AE1'                                                  
*        MVC   KEY+5(8),2(R4)                                                   
*        BRAS  R9,ADDKEY                                                        
                                                                                
* NEW 01/30/94- NEW AD-ID PACKED COMML PASSIVE KEY                              
* FIND X'A0' ELEMENT FOR POSSIBLE AD-ID                                         
                                                                                
ADDCML10 DS    0H                                                               
         LA    R4,REC+24                                                        
         MVI   ELCODE,X'A0'                                                     
         BRAS  R9,NEXTEL2                                                       
         BNE   ADDCML20            NO AD-ID                                     
*                                                                               
         MVC   KEY(2),=X'0AC1'                                                  
         OI    KEY+1,X'C0'                                                      
         MVC   KEY+5(8),2+12(R4)   USE PACKED AD-ID CODE                        
         BRAS  R9,ADDKEY                                                        
*                                                                               
ADDCML20 LA    R4,REC+24                                                        
         MVI   ELCODE,X'24'                                                     
         BRAS  R9,NEXTEL2                                                       
         JNE   EXIT                                                             
*                                                                               
         MVC   KEY(2),=X'0AC2'                                                  
         OC    CMLXHDPK-CMLXDTEL(8,R4),CMLXHDPK-CMLXDTEL(R4)                    
         BZ    *+14                                                             
         MVC   KEY+5(8),CMLXHDPK-CMLXDTEL(R4)  HIDEF PASSIVE                    
         BRAS  R9,ADDKEY                                                        
*                                                                               
         MVC   KEY(2),=X'0AC3'                                                  
         OC    CMLXCCPK-CMLXDTEL(8,R4),CMLXCCPK-CMLXDTEL(R4)                    
         BZ    *+14                                                             
         MVC   KEY+5(8),CMLXCCPK-CMLXDTEL(R4)   CENTERCUT PASSIVE               
         BRAS  R9,ADDKEY                                                        
*                                                                               
         J     EXIT                                                             
VTRPACK  DS    A                                                                
         LTORG                                                                  
         EJECT                                                                  
WORKD    DSECT                                                                  
*                                                                               
DUB      DS    D                                                                
WORK     DS    XL48                                                             
SAVER1   DS    F                                                                
*                                                                               
NEXTDIR  DS    A                                                                
DMCB     DS    6F                                                               
KEY      DS    CL20                                                             
KEYSAVE  DS    CL20                                                             
KEYSAV2  DS    CL20                                                             
BUYID    DS    H                                                                
BUYMCLT  DS    XL2                                                              
BUYMSEQ  DS    XL1                                                              
BUYMPRD  DS    XL1                                                              
ELCODE   DS    CL1                                                              
PRDLIST  DS    CL128                                                            
         ORG   PRDLIST                                                          
ADID     DS    CL12                                                             
         ORG                                                                    
*                                                                               
WORKX    EQU   *                                                                
                                                                                
         EJECT                                                                  
REC      DSECT                                                                  
         PRINT OFF                                                              
       ++INCLUDE SPGENBUY                                                       
         ORG   REC                                                              
       ++INCLUDE SPGENPRD                                                       
         ORG   REC                                                              
       ++INCLUDE SPGENCLT                                                       
         ORG   REC                                                              
       ++INCLUDE SPGENGOAL                                                      
       ++INCLUDE SPGENPRG                                                       
       ++INCLUDE SPGENSYN                                                       
       ++INCLUDE SPGENMKG                                                       
       ++INCLUDE SPGENMKA                                                       
       ++INCLUDE SPGENPROG                                                      
       ++INCLUDE SPNWSBYR                                                       
       ++INCLUDE SPNWSCAM                                                       
       ++INCLUDE SPNWSHDR                                                       
         DSECT                                                                  
       ++INCLUDE SPGENBILL                                                      
       ++INCLUDE SPGENGRP                                                       
       ++INCLUDE SPGENSLK                                                       
       ++INCLUDE SPGENDRORD                                                     
       ++INCLUDE SPGENDRBTC                                                     
       ++INCLUDE SPGENCTA                                                       
       ++INCLUDE SPGENCLRST                                                     
       ++INCLUDE SPTRCMML                                                       
       ++INCLUDE SPTRTBAE                                                       
ESTD     DSECT                                                                  
       ++INCLUDE SPGENEST                                                       
ESTAD    DSECT                                                                  
       ++INCLUDE SPGENESTD                                                      
       ++INCLUDE DMLDDEFN                                                       
       ++INCLUDE DDDPRINT                                                       
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'038SPLDCPTR  08/03/20'                                      
         END                                                                    

*          DATA SET PPREPB12C  AT LEVEL 046 AS OF 05/01/02                      
*CATALP PPB12C                                                                  
*        TITLE 'RDBUFF - READ BUFFER'                                           
***********************************************************************         
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                 *** THIS MODULE IS DEAD ***                                   
*                                                                               
*                                                                               
*              IT HAS BEEN REPLACED BY PPREPB102                                
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
***********************************************************************         
*                                                                               
*  CHANGE LOG                                                                   
*                                                                               
*  BPLA   12/00    PUBFRST CSECT RENAMED TO FSTPUB                              
*                  TO AVOID DUPLICATE TAGS                                      
*                  CHANGE ALSO MADE IN PPREPB12A                                
*                  IN V(PUBFRST) - NOW V(FSTPUB)                                
*                                                                               
*  BPLA   08/00    COPY OF PPREPB12C AT LEVEL 40 7/20/00                        
*                  COPY MADE 8/16/00                                            
*                  CHANGES TO CATALP AND PPREPB1WKN                             
*                  (WHICH INCLUDES PNNEWFILE IN PLACE OF                        
*                  PPNEWFILE)                                                   
*                  PNNEWFILE INCLUDES PNBILREC IN PLACE                         
*                  OF PBILLREC                                                  
*                                                                               
*   BPLA   07/00  FIX BUG IN COST2 CHECKING                                     
*                                                                               
*   BPLA   07/00  CHANGES FOR NEW PPNEWFILE - SEE **PPNEW                       
*                                                                               
*   BPLA   05/00  USE AORWRK  INSTEAD OF PCONREC                                
*                                                                               
*   BPLA   01/00  CHECK FOR NEW VALUE FOR PAYOPT (D)                            
*                                                                               
*   BPLA   12/99  ALLOW THE DISPLAY OF ON-SALE DATES FOR                        
*                 NEWSPAPERS (THEY MAY NOW EXIST) IN LDESC                      
*                                                                               
*   BPLA   9/99   CHANGE SO VARIOUS ABREVIATIONS FOR INTERACTIVE                
*                 WILL ALL PRINT AS "INTERACTIVE" (IN FMED)                     
*                 FMED MOVED TO IT'S OWN CSECT                                  
*                                                                               
*   BPLA   6/99   CHANGES FOR COST2 FEATURE                                     
*                                                                               
*   BPLA   6/99   COPY OF PPB12C LEVEL 21 MADE 6/15/99                          
*                                                                               
*   BPLA   5/99   SAVE FORMULA EVEN IF USING BILLING FORMULA                    
*                 RECORDS - I STILL NEED COMMENTS                               
*                                                                               
*   BPLA   1/99   NEW OPTION ON B2B PROFILE (+11)                               
*                 TO DISPLAY NEWSPAPER UNIT RATES AT NET                        
*                 (LIKE OPTION ON P52, PEC, P53)                                
*                                                                               
*   BPLA   10/98  CODE TO CHECK FOR PRINTABLE USER FIELDS                       
*                 AT FRONT OF INVOICE                                           
*                                                                               
*   BPLA   10/98  RENAMED FROM PPB12CE                                          
*                                                                               
*   BPLA   8/98   CHANGES FOR SFM BILLING FORMULA RECS                          
*                                                                               
*   BPLA   3/98   ADD MEDIA COUNT FOR MULTI-MEDIA REQ                           
*                 AND SUPPRESS AD CODE TOTALS IF ONLY ONE MEDIA                 
*                                                                               
*   BPLA   1/98   CHANGES FOR EDI BILLING                                       
*                                                                               
*   BPLA  12/97   ADD DUMMY CSECT AT END                                        
*                                                                               
*   BPLA  9/97    IN GETAOR USE AMED FOR MEDIA                                  
*                IN MULT-MEDIA REQUESTS                                         
*                 IF PRD AND/OR ESTIMATE ARE                                    
*                 ON SEPERATE BILLS FOR MULTI-MEDIA                             
*                 REQUEST I MUST GO TO AGETAOR IN FMED                          
*                                                                               
*   BPLA 5/97     FOR WESTERN OPTION DISPLAY COLOR                              
*                 PREMIUM WITHOUT COST                                          
*                                                                               
*   BPLA   5/97   FIX DISPLAY OF PRODUCT ACCOUNT (IN X)                         
*                                                                               
*   BPLA   5/97   WESTERN OPTIONS TO SUPPRESS COSTS                             
*                                                                               
*   BPLA   5/97   FOR MULTI-MEDIA REQUESTS I MUST                               
*                 READ FOR AAA FORMULAS AT FMED                                 
*                 - CODE COPIED FROM PPB12AO IN CFIRST                          
*                                                                               
*   BPLA  10/96   NEW VERSION TO SUPPORT                                        
*                 1) STANDARD COMMENTS ON AOR BILLS                             
*                 2) SUPPRESSING ZONE/EDITION (NOZEOPT)                         
*                 3) RETAIL DRAFT BILLING - ERRORS ONLY                         
*                    RD1OPT = "E"                                               
*                                                                               
*   BPLA  9/96    PPB12CO SOURCE MADE LIVE - NOW INCLUDES PPREPB1WRK            
*                 NEEDS PPB1ACC                                                 
*                                                                               
*   BPLA 7/96     IF UPASS = "S" (CORP SUMMARY)                                 
*                 SKIP DIV IN FPGR1 AND LPGR1                                   
*                 IF QPUB+1 = RD=                                               
*                                                                               
*   BPLA 4/96     SPECIAL CHANGE FOR ZENITH - MOLSON                            
*                                                                               
*   BPLA 3/95     IF MARKETS ARE ON SEPERATE INVS                               
*                 PRINT MARKET AT RB16I INSTEAD OF FMKT                         
*                                                                               
*   BPLA 6/94     AT LPERG RESET PERCTL TO 'T' IF PRIOR IS 'M'                  
*                 SINCE IT AMY HAVE BEEN ALTERED TO 'S' AT FPERG                
*                                                                               
*   BPLA 6/94     SPECIAL CODE AROUND SOME GOTO GETNUMS                         
*                                                                               
*   BPLA 6/94     CHANGES IN FPRD AND FEST                                      
*                 FPRD MOVED TO ITS OWN CSECT                                   
*                 IN FPRD IF EST IS HIGHER THAN PRD                             
*                 READ EST FOR BILL FORMULA                                     
*                 ALSO FPRD NAD FEST NOW ALWAYS SET BILL FORMULAS               
*                 THEY USED NOT TO IF THEY WERE NOT BEING SHOWN                 
*                                                                               
*   BPLA 1/94     CHANGES FOR PST                                               
*                                                                               
*  BPLA 10/18/93  AT PUBFRST CLEAR PUB LINES                                    
*                                                                               
*  BPLA 10/14/93  CHANGE IN LPUB TO HANDLE DETAIL BACK-UP AT                    
*                 PUB LEVEL (PROGPRO2+7=7)                                      
*                                                                               
*  BPLA 10/20/92  CADDRS MOVED FROM BILWRK TO RDBUFF (AFTER LTORG)              
*                 SINCE I RAN OUT OF ROOM IN SPACEND (BILWRK)                   
*  BPLA 9/21/92  "FREE" DATE CHECK CHANGED FROM AUG01/92 TO SEP01/92            
*                                                                               
*  BPLA 7/9/92   CHANGES TO CHECK PBBILST (IN PBILELEM) FOR UFC BILLING         
*                INSTEAD OF X'46' ELEMENTS                                      
*                                                                               
*  BPLA 6/16/92  REMOVE CHK FOR SCBNCSW = C'N' IN GETAOR                        
*                                                                               
*  BPLA 4/30/92  ROUND PERCENTAGE BILLING + COMMISSION BILLING CHANGES          
*                                                                               
*  BPLA 4/20/92  CHANGES FOR "FREE" INSERTIONS                                  
*                                                                               
*  BPLA 4/20/92  COPY OF PPB12CL                                                
*                                                                               
*  BPLA 4/1/92   IN RB6B4 DON'T APPLY MANPCT TO PREVIOUS IF PCTCTL = F          
*                ALSO DON'T APPLY TO PREVIOUS MANUAL BILLING                    
*                                                                               
*  BPLA 1/24/92  GOTO FOR AGETAOR MOVED FROM BEGINNING OF FPRD TO FPRD3         
*  BPLA 1/21/92  CHANGES TO HANDLE MIX TO AOR PCTS                              
*  BPLA 7/29/91  NEW VALUES FOR PEOVOPT                                         
*               S= USE PRD/EST CHAB DATA AND SUBTRACT CD FROM STRIP-OFF         
*               D= SAME AS 'S' BUT DON'T SUBTRACT CD FROM STRIP-OFF             
*      NOTE -   Y STILL USES AGENCY HEADER PROFILE                              
*                                                                               
*  BPLA 5/16/91  GRANT'S AOR CHANGES FOR AOR KILLDATE AND VAT CODE              
*                ALSO SAVE PRINTING BILL FORMULA OVERRIDES                      
*                IN TOTAL ROW  (BFPBASB AND BFPCOMP)                            
*                                                                               
*                                                                               
*  BPLA 3/26/91  DRAFT REBATE BILLING - RD                                      
*                                                                               
*  BPLA 3/12/91  GRANT'S AOR CHANGES AORLOPT,AORTXOPT                           
*                                                                               
         PRINT NOGEN                                                            
*                                  READ BUFFER                                  
         SPACE 2                                                                
RDBUFF   CSECT                                                                  
         NMOD1 0,RDBUFF                                                         
         USING PPWORKD,RA                                                       
         L     R9,PPWORK2C                                                      
         USING PPWORK2D,R9                                                      
         LA    RC,SPACEND                                                       
         USING BILWRKD,RC                                                       
         LA    R8,4095(RB)         2ND BASE REG                                 
         LA    R8,1(R8)                                                         
         USING RDBUFF+4096,R8                                                   
         SPACE 2                                                                
         MVI   UPASS,0                                                          
         MVC   SVMKTCTL,MKTCTL                                                  
*                                  SET LENGTH OF INV BRK                        
         L     R3,AINVBRK                                                       
         USING BRKTABD,R3                                                       
         L     RF,BRKDISP                                                       
         A     RF,BRKLENM1                                                      
         ST    RF,INVBKLEN                                                      
*                                                                               
RB0      DS    0H                                                               
         CLI   SORTTRCE,C'Y'                                                    
         BNE   *+8                                                              
         MVI   RCTRACE,C'Y'                                                     
         XC    SORTREC,SORTREC                                                  
         XC    THISREC(200),THISREC                                             
         XC    PASSREC,PASSREC                                                  
**NEW 3/12/91                                                                   
         CLI   AORLOPT,C'C'                                                     
         BE    *+10                                                             
**NEW 3/12/91                                                                   
         XC    PEPTABN,PEPTABN     CLEAR PRD-EST-PER TAB                        
         XC    PRDFORM,PRDFORM                                                  
         XC    ESTFORM,ESTFORM                                                  
         XC    AAEFORM,AAEFORM                                                  
         XC    CVATPSWS,CVATPSWS    CLEAR PRD VAT MIX SWITCHES                  
         MVC   LASTPRD,=X'FFFFFF'                                               
*                                                                               
         CLC   AMKTBRK,AINVBRK                                                  
         BNH   RB1                                                              
         OC    AMGR1BRK,AMGR1BRK                                                
         BZ    RB1B                                                             
         CLC   AMGR1BRK,AINVBRK                                                 
         BH    RB1B                                                             
RB1      DS    0H                  IF MKT OR MGR ON SEP BILL                    
         MVI   ORIGTYPE,C'0'       OVERRIDE OPTION NOT TO DETAIL MARK           
RB1B     DS    0H                                                               
         MVI   BILSW,C'N'                                                       
         MVI   NDUES,0                                                          
*                                                                               
         BAS   RE,SETPASS0         ALWAYS START WITH PASS 0                     
*                                                                               
RB2      DS    0H                                                               
         GOTO1 BUFFALO,DMCB,=C'HIGH',ABUFFC,THISREC,0                           
         B     RB4B                                                             
RB4      DS    0H                                                               
         GOTO1 BUFFALO,DMCB,=C'SEQ',ABUFFC,THISREC,0                            
RB4B     DS    0H                                                               
         LA    R3,BRKTAB                                                        
         USING BRKTABD,R3                                                       
         TM    DMCB+8,X'80'        EOF                                          
         BZ    RB6                                                              
         MVI   THISREC,X'FF'                                                    
         MVC   THISREC+1(L'THISREC-1),THISREC                                   
         OC    SORTREC,SORTREC                                                  
         BZ    RB20                DONE IF NO DATA                              
         B     RB8                                                              
*                                                                               
RB6      DS    0H                                                               
*                                 SEE IF SKIPPING UNPAID ESTS                   
*                                 PAYOPTS E,F,G                                 
         CLI   PAYOPT,C'E'                                                      
         BL    RB6A                                                             
         CLI   PAYOPT,C'G'                                                      
         BH    RB6A                                                             
         BAS   RE,CHKSKIP          CHK IF EST IS IN UPETAB                      
         CLI   DUB,1                                                            
         BE    RB4                 MEANS SKIP THIS RECORD                       
*                                                                               
RB6A     L     RF,ASORTDTA         POINT TO DATA                                
         LA    R0,SORTREC                                                       
         SR    RF,R0                                                            
         LA    RF,THISREC(RF)      POINT TO DATA IN THISREC                     
*                                                                               
         CLI   UPASS,C'S'          FOR SUMMARY PASS                             
         BNE   RB6B                                                             
         MVC   SORTREC,THISREC                                                  
         L     R6,ASORTCOM         SKIP ANYTHING WITHOUT INV. NO                
         CLC   0(2,R6),TODAYB      TODAY'S DATE (Y/M)                           
         BNE   RB5                                                              
         L     R6,APUB                                                          
         OC    0(6,R6),0(R6)                                                    
         BNZ   RB5                 PUB MUST ALSO BE BLANK                       
         L     R6,APRD             ALSO FILTER ON PRODUCT                       
         CLC   SAVPRD,0(R6)                                                     
         BE    RB6B                                                             
*                                                                               
RB5      DS    0H                                                               
         B     RB4                                                              
*                                                                               
RB6B     DS    0H                                                               
         OC    0(ROW2L,RF),0(RF)   SKIP NULL ITEMS                              
         BZ    RB4                                                              
         CLI   PASSNO,2            SEE IF BACK-UP PASS                          
         BNE   RB6B2                                                            
         OC    ARECAP,ARECAP       JUST IN CASE                                 
         BZ    RB6B2                                                            
         CLI   ZUOPT,C'B'          SEE IF SHOWING                               
         BNE   RB6B2               ONLY BILLABLE ITEMS ON BACK-UP               
         CLC   0(16,RF),BGDSP(RF)                                               
         BNE   RB6B2                                                            
         CLC   OGDSP(16,RF),OBGDSP(RF) CHK FOR OPEN BILLABLE                    
         BE    RB4                 TOTALLY BILLED SO SKIP                       
***TAX   NOTE - CHECK ABOVE DOES NOT CATCH ONLY BILLABLE TAX                    
***TAX          THIS SHOULD NOT OCCUR SINCE THE TAX PCT.                        
***TAX          WILL NOT BE PERMITTED TO CHANGE ON BILLED INSERTIONS            
***TAX        ALSO THERE MAY BE DISCREPANCIES IN TAX DUE TO ROUNDING            
*                                                                               
*                                                                               
RB6B2    DS    0H                                                               
         OC    MANPCT,MANPCT       TEST PCT= REQUEST                            
         BZ    RB6C                NO                                           
*                                  YES - TAKE PCT OF GROSS + NET                
         MVI   X,0                                                              
RB6B4    CLI   X,2                                                              
         BE    RB6C                                                             
         L     R5,GDSP(RF)         GROSS                                        
         M     R4,MANPCT                                                        
         BAS   RE,PCMDIV                                                        
         ST    R5,GDSP(RF)                                                      
****     CLI   PCTNET,C'N'                                                      
****     BE    *+20                                                             
         L     R5,NDSP(RF)         NET                                          
         M     R4,MANPCT                                                        
         BAS   RE,PCMDIV                                                        
         ST    R5,NDSP(RF)                                                      
         L     R5,CDSP(RF)         CD                                           
         M     R4,MANPCT                                                        
         BAS   RE,PCMDIV                                                        
         ST    R5,CDSP(RF)                                                      
         L     R5,ADSP(RF)         AC                                           
         M     R4,MANPCT                                                        
         BAS   RE,PCMDIV                                                        
         ST    R5,ADSP(RF)                                                      
***TAX                                                                          
         L     R5,TDSP(RF)          TAX                                         
         M     R4,MANPCT                                                        
         BAS   RE,PCMDIV                                                        
         ST    R5,TDSP(RF)                                                      
***TAX                                                                          
*                                                                               
         CLI   PCTCTL,C'F'            SEE IF NOT APPLYING PCT TO PREV           
         BE    RB6B8                                                            
*                                                                               
         L     R5,APUB          DON'T APPLY PCT TO PREVIOUS MANUAL              
         CLC   0(6,R5),XXPUB          BILLING                                   
         BE    RB6B8                                                            
*                                                                               
         L     R5,ROWHL(RF)           BILLED GRS                                
         M     R4,MANPCT                                                        
         BAS   RE,PCMDIV                                                        
         ST    R5,ROWHL(RF)                                                     
*****    CLI   PCTNET,C'N'            SKIP NET                                  
*****    BE    *+20                                                             
         L     R5,ROWHL+NDSP(RF)        BILLED NET                              
         M     R4,MANPCT                                                        
         BAS   RE,PCMDIV                                                        
         ST    R5,ROWHL+NDSP(RF)                                                
         L     R5,ROWHL+CDSP(RF)        BILLED CD                               
         M     R4,MANPCT                                                        
         BAS   RE,PCMDIV                                                        
         ST    R5,ROWHL+CDSP(RF)                                                
         L     R5,ROWHL+ADSP(RF)        BILLED AC                               
         M     R4,MANPCT                                                        
         BAS   RE,PCMDIV                                                        
         ST    R5,ROWHL+ADSP(RF)                                                
***TAX                                                                          
         L     R5,ROWHL+TDSP(RF)         BILLED TAX                             
         M     R4,MANPCT                                                        
         BAS   RE,PCMDIV                                                        
         ST    R5,ROWHL+TDSP(RF)                                                
*                                                                               
RB6B8    ZIC   R1,X                                                             
         LA    R1,1(R1)                                                         
         STC   R1,X                                                             
         LA    RF,ROWTL(RF)            NOW DO OPEN ACCUMS                       
         B     RB6B4                                                            
*                                                                               
PCMDIV   L     R2,=F'10000'                                                     
         DRNDR (R4),(R2)                                                        
         BR    RE                                                               
*                                                                               
*                                                                               
RB6C     DS    0H                                                               
         MVC   SORTREC,THISREC                                                  
RB7      DS    0H                                                               
         OC    OLDKEY,OLDKEY       IF FIRST TIME                                
         BZ    RB15                BYPASS BREAK TEST                            
         OC    BRKCODE,BRKCODE                                                  
         BNZ   *+6                                                              
         DC    H'0'                DUPE KEY                                     
         L     R6,BRKDISP                                                       
         LA    R7,OLDKEY(R6)                                                    
         LA    RE,THISKEY(R6)                                                   
         L     RF,BRKLENM1                                                      
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R7),0(RE)                                                    
         BNE   RB8                                                              
         LA    R3,BRKL(R3)                                                      
         B     RB7                                                              
*                                                                               
RB8      DS    0H                                                               
*                                  'LAST' BREAKS                                
         ST    R3,ATHISBRK         SAVE THIS BRK                                
         CLI   PASSNO,0            IF PASS 0                                    
         BNE   RB8B                                                             
         C     R3,AINVBRK          AND INV BRK                                  
         BH    RB18                                                             
*                                                                               
*                                  END OF INVOICE ON PASS 0                     
*                                  (MEANS THIS IS A 'ZERO' BILL)                
*                                                                               
*                                  SHOULD I PRODUCE IT                          
*                                                                               
         CLC   TYPE,ZBOPT          NOT IF NOT RIGHT TUPE                        
         BNE   RB8A4                                                            
*                                                                               
         CLI   PRIOR,C'T'          NOT IF MULTI MONTH BILLS                     
         BE    RB8A4                                                            
         CLI   PRIOR,C'1'                                                       
         BNL   RB8A4                                                            
*                                                                               
*                                  ONLY FOR REQUESTED MONTH                     
         L     RE,APER                                                          
         LA    RE,OLDREC-SORTREC(RE)      USE 'OLDREC' PERIOD                   
         ZIC   RF,0(RE)                                                         
         MH    RF,=H'8'                                                         
         LA    RF,PERLIST(RF)                                                   
         CLC   CURPER,0(RF)                                                     
         BNE   RB8A4                                                            
*                                                                               
*                                  PRODUCE ZERO BILL                            
         BAS   RE,SETPASS1                                                      
         BAS   RE,SETRET                                                        
         MVI   ZEROSW,C'Y'         SET PRODUCING ZERO BILL NOW                  
         B     RB14D                                                            
*                                                                               
RB8A4    DS    0H                  DO NOT PRODUCE BILL                          
         MVC   PASSREC,THISREC     SET RESTART POINT                            
         B     RB18                                                             
RB8B     DS    0H                                                               
         L     R3,ALOWBRK                                                       
         MVC   SORTREC,OLDREC                                                   
         CLI   UPASS,C'T'          SKIP 'LASTS' FOR TEST PASS                   
         BE    RB10B                                                            
         CLI   RETSKIP,C'Y'        OR IF NO SHARE FOR OUTLET/SCHEME             
         BE    RB10B                                                            
*                                  AT LOWEST LEVEL PUT INTO TOTALS              
         L     R1,APER                                                          
         ZIC   RF,0(R1)                                                         
         MH    RF,=Y(ROWL)         RF = DISP INTO ACCUM                         
         L     RE,BRKCODE                                                       
         A     RF,ATOTS(RE)      POINT TO THIS ACCUM                            
         L     R7,ASORTDTA                                                      
*                                                                               
RB8C     DS    0H                                                               
         MVC   0(ROW2L,RF),0(R7)  FOR FINANCIAL MOVE CONTRACT+OPEN              
*                                                                               
         L     R7,ATOTS(RE)                                                     
         AH    R7,=Y(MAXMOS*ROWL)       POINT TO TOTAL ROW                      
*                                                                               
         LA    R0,24                                                            
RB9      DS    0H                                                               
         L     R1,0(R7)                                                         
         A     R1,0(RF)                                                         
         ST    R1,0(R7)                                                         
         LA    R7,4(R7)                                                         
         LA    RF,4(RF)                                                         
         BCT   R0,RB9                                                           
*                                                                               
         CLI   PASSNO,1            FOR PASS 1                                   
         BNE   RB9B                                                             
         CLI   CVATCOD,0           AND IF DOING VAT                             
         BE    RB9B                                                             
         GOTO1 =V(VBADD),DMCB,SORTREC,BRKTABD  ADD TO GST/PST BASES             
*                                                                               
RB9B     DS    0H                                                               
*                                                                               
*                                  AND PUT INV NO. INTO INV LIST                
         L     R5,APER                                                          
         ZIC   RF,0(R5)                                                         
         MH    RF,=H'8'                                                         
         LA    RF,INVLIST(RF)                                                   
         L     R5,ASORTCOM         A(INV NO)                                    
         OC    0(4,R5),0(R5)       NO INV NO.                                   
         BZ    RB9D                                                             
         CLC   0(2,R5),TODAYB      INV NO. WILL MATCH TODAY                     
         BNE   RB9D                                                             
         L     R1,APUB                                                          
         OC    0(6,R1),0(R1)       WILL ALSO HAVE PUB BLANK                     
         BNZ   RB9D                                                             
         MVC   0(4,RF),0(R5)                                                    
*                                                                               
RB9D     B     *+8                                                              
RB10     DS    0H                                                               
         SH    R3,=Y(BRKL)         BACK UP THRU LIST                            
RB10B    DS    0H                                                               
         C     R3,ATHISBRK                                                      
         BL    RB14J                NO MORE                                     
*                                                                               
RB11     DS    0H                                                               
         MVC   SORTREC,OLDREC                                                   
         CLI   UPASS,C'T'          SKIP 'LASTS' FOR TEST PASS                   
         BE    RB11B                                                            
         CLI   RETSKIP,C'Y'        OR IF NO SHARE FOR OUTLET/SCHEME             
         BE    RB11B                                                            
         C     R3,APMSELO          AT LOWEST OF PRD,MKT,PUB,EST                 
         BNE   RB11B                                                            
         CLC   ORIGTYPE,TYPE       OPTION NOT TO DETAIL MARK FILE               
         BE    RB11B                                                            
         GOTO1 AWNBILL                                                          
*                                                                               
RB11B    DS    0H                                                               
         C     R3,APRDBRK                                                       
         BH    *+10                                                             
         MVC   RETSKIP,PRDSKIP                                                  
*                                                                               
         C     R3,AINVBRK                                                       
         BL    RB11D               BYPASS LAST'S IF 'ABOVE' INV BRK             
         BH    *+10                                                             
*                                                                               
         MVC   RETSKIP,INVSKIP     ON INVBRK USE INVSKIP                        
         MVI   BYTE,C'L'                                                        
         BAS   RE,RBTRCE                                                        
*                                                                               
         CLI   UPASS,C'T'          SKIP 'LASTS' FOR TEST PASS                   
         BE    RB11D                                                            
*                                                                               
         CLI   BRKCTL1,C'S'        NO SEPARATES                                 
         BNE   RB11C                                                            
         CLI   UPASS,C'S'          ON SUMMARY PASS                              
         BE    RB11D                                                            
RB11C    DS    0H                                                               
         CLI   RETSKIP,C'Y'        OR IF NO SHARE FOR OUTLET/SCHEME             
         BE    RB11D                                                            
         MVI   INVSKIP,C'N'        SET NOT TO SKIP INV                          
         MVI   PRDSKIP,C'N'        OR PRODUCT                                   
*                                  IF ANY EST NOT SKIPPED                       
         MVI   PRSW,C'H'           SET TO HOLD LINES                            
         L     RF,BRKCODE                                                       
         BAS   RE,LASTTAB-4(RF)                                                 
RB11D    DS    0H                                                               
RB13     DS    0H                                                               
         C     R3,AINVBRK                                                       
         BNE   RB13D                                                            
         CLI   INVSKIP,C'Y'                                                     
         BE    RB14B                                                            
         CLI   UPASS,C'T'          SKIP 'LASTS' FOR TEST PASS                   
         BE    RB14B                                                            
         GOTO1 AENDINV                                                          
*                                                                               
         MVI   FININVSW,0      CLEAR FINANCIAL INVOICE SWITCH                   
*                                                                               
         L     RF,BRKCODE                                                       
         L     RE,ATOTS(RF)                                                     
         LH    RF,TOTSIZH                                                       
*                             CLEAR INV ACCUM                                   
         XCEF                                                                   
*                                                                               
         OC    ARECAP,ARECAP      SEE IF DOING DETAIL BACK-UP                   
         BZ    RB13C        N0 - THEN CLEAR INV LEVEL VATS                      
         CLI   PASSNO,1                                                         
         BE    RB14B        DON'T CLEAR INV LEVEL VATS YET                      
*                                                                               
RB13C    GOTO1 =V(VBROLL),DMCB,BRKTABD   TRY VBROLL TO CLEAR                    
*                                        INVOICE LEVEL VAT TABLES               
         B     RB14B                                                            
*                                                                               
RB13D    DS    0H                                                               
         BAS   RE,ROLLUP                                                        
         GOTO1 =V(VBROLL),DMCB,BRKTABD   AND GST/PST TABLES                     
*                                                                               
         B     RB10                                                             
*                                                                               
RB14     DS    0H                                                               
RB14B    DS    0H                                                               
         CLI   RETPROF,0           TEST RETAIL                                  
         BE    RB14B2              NO                                           
         CLI   RETERR,0            TEST RETAIL ERROR                            
         BNE   RB14H               YES - NEXT INV - BACK TO PASS 0              
         CLI   UPASS,C'S'                                                       
         BE    RB14H               DONE AFTER SUMMARY PASS                      
         CLI   UPASS,1             AND QFTER CORP PASS (PASS 1)                 
         BE    RB14H                                                            
         CLI   UPASS,C'T'          IS IT TEST PASS                              
         BNE   *+8                 NO                                           
         MVI   UPASS,1             START AT 2 (DO PASS 1 (CORP) LAST)           
         ZIC   RF,UPASS            BUMP UNDERPASS                               
         LA    RF,1(RF)                                                         
         STC   RF,UPASS                                                         
         MVI   RETSKIP,C'N'                                                     
         MVI   CORPZ,C'N'          NOT A CORP INV                               
         CLI   RETPROF,0                                                        
         BE    *+12                                                             
         MVI   INVSKIP,C'Y'                                                     
         MVI   PRDSKIP,C'Y'                                                     
*                                                                               
RB14B1   DS    0H                                                               
         L     R4,AGDAREA                                                       
         USING GDSECT,R4                                                        
         MVC   GDOUTNO,UPASS                                                    
         MVC   GDSCHM,SPACES                                                    
         GOTO1 AFINDOUT,DMCB,(R4)                                               
         OC    GDOUTAD,GDOUTAD            TEST END OF OUTLES                    
         BNZ   RB14B1A                                                          
*                                                                               
         CLI   UPASS,1                                                          
         BE    RB14H                                                            
         CLI   RETDRAFT,C'Y'                                                    
         BE    RB14H               NO CORP PASS FOR DRAFT                       
*                                                                               
         MVI   UPASS,1             DO CORP PASS                                 
         CLI   SUMOPT,C'Y'         IF WILL DO SUMMARY                           
         BNE   *+8                                                              
         MVI   CORPZ,C'Y'          CORP BILL NOT AN INVOICE                     
         B     RB14B1                                                           
*                                                                               
RB14B1A  DS    0H                                                               
*                                  SET ADDRESS                                  
         L     R4,GDOUTAD                                                       
         BAS   RE,SETADDR                                                       
         CLI   UPASS,1                                                          
         BNE   *+18                                                             
         L     RF,ACADDRS         SAVE CORP ADDR                                
         L     RE,ABADDRS                                                       
         MVC   0(ADDRLEN,RF),0(RE)                                              
         B     RB14D                                                            
         DROP  R4                                                               
*                                                                               
RB14B2   DS    0H                                                               
         ZIC   RF,PASSNO           BUMP PASS NO                                 
         LA    RF,1(RF)                                                         
         STC   RF,PASSNO                                                        
*                                                                               
         CLI   PASSNO,2                                                         
         BH    RB14H                                                            
         OC    ARECAP,ARECAP                                                    
         BZ    RB14B                                                            
         MVC   FORMAT,DFORMAT                                                   
         MVC   STRIP,DSTRIP                                                     
         MVC   ORDSW(3),DORDSW                                                  
         MVC   DOLNUM,DDOLNUM                                                   
         MVC   TYPNUM,DTYPNUM                                                   
         MVC   APAGBRK,SVPAGBRK    RESTORE BRK CONTROLS                         
         MVC   ALOWTOG,SVLOWTOG                                                 
         MVC   SPOTCTL,SPOTSW      SPOT DETAIL ON BACKUP                        
         MVI   FMTSW,0                                                          
         CLI   SPOTCTL,C'Y'                                                     
         BNE   *+8                                                              
         MVI   FMTSW,C'D'                                                       
         BAS   RE,SETCOLS                                                       
RB14D    DS    0H                                                               
         XC    OLDREC,OLDREC                                                    
         MVC   THISREC,PASSKEY                                                  
         B     RB2                                                              
*                                                                               
RB14H    DS    0H                                                               
         MVC   PASSREC,THISREC                                                  
         BAS   RE,SETPASS0         BACK TO PASS 0                               
         MVI   BILSW,C'N'                                                       
*                                                                               
RB14J    DS    0H                                                               
         L     R3,ATHISBRK         RESTORE R3                                   
RB15     DS    0H                                                               
         CLC   FFS,THISKEY         AT EOF DONT DO 'FIRSTS'                      
         BNE   RB16                                                             
         CLC   FFS,THISKEY+6       TO INSURE THIS IS EOF REC                    
         BE    RB20                                                             
*                                  'FIRSTS'                                     
RB16     DS    0H                                                               
         MVC   SORTREC,THISREC                                                  
         L     RF,BRKCODE                                                       
         LTR   RF,RF                                                            
         BZ    RB19                                                             
         MVI   BYTE,C'F'                                                        
         BAS   RE,RBTRCE                                                        
         CLI   PASSNO,1                                                         
         BE    RB16A                                                            
         BL    RB18                                                             
*****    C     R3,AINVBRK   NO-OPED 3/3/89                                      
*****    BL    RB17         SINCE I NEED TO GO TO FEST ON RECAP PASS            
*                                                                               
RB16A    DS    0H                                                               
         CLI   UPASS,C'T'          FOR TEST PASS                                
         BNE   RB16B                                                            
         C     R3,AESTBRK          DO ONLY EST FIRST                            
         BNE   RB17                                                             
         B     RB16C                                                            
RB16B    DS    0H                                                               
         CLI   RETSKIP,C'Y'        IF SKIP                                      
         BNE   RB16C                                                            
         C     R3,AESTBRK          BYPASS BRKS 'BELOW' EST                      
         BH    RB17                                                             
RB16C    DS    0H                                                               
         MVI   PRSW,C'H'           SET TO HOLD LINES                            
         L     RF,BRKCODE                                                       
         BAS   RE,FRSTTAB-4(RF)                                                 
*                                                                               
RB16D    DS    0H                                                               
         CLI   RETSKIP,C'Y'        TEST SKIP BECAUSE OF ZERO PCT                
         BE    RB17                                                             
*                                                                               
RB16E    DS    0H                                                               
         C     R3,APAGBRK                                                       
         BNE   RB16F                                                            
**NEW 5/5/89                                                                    
         CLI   PASSNO,2            SEE IF DETAIL PASS                           
         BNE   RB16E3                                                           
         B     RB16E5                                                           
*                                  THEN I CAN SKIP SPECIAL HEADLINES            
*                                  PROBLEM WAS THEY CLEARED P1-P5               
*                                  AND REMOVED MKT/JOB/PUB                      
**NEW 5/5/89                                                                    
RB16E3   MVI   RCSUBPRG,100        SET SPECIAL HEADLINES                        
         GOTO1 APRNT                                                            
RB16E5   MVI   FORCEHED,C'Y'                                                    
RB16F    DS    0H                                                               
         C     R3,AINVBRK                                                       
         BNE   RB17                                                             
*                             SPECIAL COMMENTS FOR SPECIAL BILLS                
         B     RB16FX         MESSAGE NOW IN HEADLINES                          
*                                                                               
RB16FX   L     R6,=V(DICSECT)                                                   
         USING DICSECT,R6                                                       
         CLI   PAYOPT,C'E'    SKIP UPAID ESTS (WITH MESSAGE)                    
         BE    RB16FX5                                                          
*                                                                               
         CLI   PAYOPT,C'D'     SPECIAL DELETED PAID BUY OPTION                  
         BE    RB16FX5         STILL DO MESSAGE                                 
*                                                                               
         CLI   PAYOPT,C'Y'                                                      
         BNE   RB16G                                                            
RB16FX5  DS    0H                                                               
*--->    MVC   P1(57),=C'** ORDERED AMOUNTS ARE BASED ON PUB INVOICE CL         
*--->          EARANCES **'                                                     
         MVC   P1(L'PP@ORD01),PP@ORD01                                          
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
*                                                                               
RB16G    DS    0H                                                               
         OC    MANPCT,MANPCT                                                    
         BZ    RB16H                                                            
*--->    MVC   P1(14),=C'** AMOUNTS ARE'                                        
         MVC   P1(L'PP@AMT01),PP@AMT01                                          
         LA    R4,P1+15                                                         
*--->    EDIT (B4,MANPCT),(6,0(R4)),2,ALIGN=LEFT                                
         CURED (B4,MANPCT),(6,0(R4)),CURTAB,ALIGN=LEFT                          
         MVI   CURTAB+3,2                                                       
         AR    R4,R0                                                            
*--->    MVC   1(21,R4),=C'PERCENT OF ORDERED **'                               
         MVC   1(L'PP@PCORD,R4),PP@PCORD                                        
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
*                                                                               
RB16H    DS    0H                                                               
         OC    MANRVNO,MANRVNO                                                  
         BZ    RB16I                                                            
*--->    MVC   P1(36),=C'** REVERSAL OF INVOICE NN-NNNN DATED'                  
         MVC   P1(L'PP@REV01),PP@REV01                                          
         MVC   W(2),MANRVDTP                                                    
*                                                                               
         MVC   SVSVIMO,SVINVMO            SAVE INV MTH                          
*                                                                               
         GOTO1 AGETNUM,DMCB,(1,MANRVNO),WORK                                    
*                                                                               
         MVC   SVINVMO,SVSVIMO            RESTORE INV MTH                       
*                                                                               
         DROP  R6                                                               
*                                        DON'T MOVE MEDIA EXPANSION             
         MVC   P1+23(7),WORK+2                                                  
         CLI   WORK+9,C' '               SEE IF INVOICE 10 LONG                 
         BE    *+10                                                             
         MVC   P1+23(7),WORK+3                                                  
*                                                                               
         GOTO1 DATCON,DMCB,(3,MANRVDTP),(5,WORK)                                
         MVC   P1+37(8),WORK                                                    
         MVC   P1+37+9(2),=C'**'                                                
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
*                                                                               
RB16I    DS    0H                                                               
*                                                                               
         MVI   PUMODE,C'F'   USER FIELDS AT FRONT OF BILL                       
         GOTO1 APRTUSER                                                         
*                                                                               
         LA    RF,P1                                                            
         CLI   MKTCTL,C'S'           MARKETS ON SEPERATE INV                    
         BNE   RB16I3                                                           
         OC    AMKT,AMKT                                                        
         BZ    RB16I3                                                           
         L     RE,AMKT                                                          
         MVC   P1+0(20),0(RE)                                                   
         MVC   P2+0(20),DASHES                                                  
         LA    R4,P1+20                                                         
         LA    R5,P2+20                                                         
RB16I2   CLI   0(R4),C' '                                                       
         BH    RB16I2X                                                          
         MVI   0(R5),C' '                                                       
         BCTR  R4,0                                                             
         BCTR  R5,0                                                             
         B     RB16I2                                                           
*                                                                               
RB16I2X  DS    0H                                                               
         IF    JOBCTL,NE,C'S',AND,PUBCTL,NE,C'S',RB16K                          
         MVI   P3,0                 SKIP A LINE                                 
         LA    RF,P4                                                            
*                                                                               
RB16I3   DS    0H                                                               
         CLI   JOBCTL,C'S'           JOB ON SEPERATE INV                        
         BNE   RB16J                                                            
         MVC   000(25,RF),JOBL1                                                 
         MVC   132(25,RF),JOBL2                                                 
         MVC   264(25,RF),JOBL3                                                 
         MVC   396(25,RF),JOBL4                                                 
         MVC   528(25,RF),JOBL5                                                 
         LA    RF,264(RF)                                                       
         CLC   JOBL3,SPACES                                                     
         BE    RB16I5                                                           
         LA    RF,132(RF)         BUMP ANOTHER LINE                             
         CLC   JOBL4,SPACES                                                     
         BE    RB16I5                                                           
         LA    RF,132(RF)          BUMP ANOTHER LINE                            
         B     RB16I5                                                           
*                                                                               
****  OLD CODE ****                                                             
****     MVC   P1+0(25),JOBL1       MUST RESTORE P1 - P5                        
****     MVC   P2+0(25),JOBL2                                                   
****     MVC   P3+0(30),JOBL3                                                   
****     MVC   P4+0(30),JOBL4                                                   
****     MVC   P5+0(30),JOBL5                                                   
****     LA    RF,P3                                                            
****     CLC   P3(25),SPACES                                                    
****     BE    RB16I5                                                           
****     LA    RF,P4                                                            
****     CLC   P4(25),SPACES                                                    
****     BE    RB16I5                                                           
****     LA    RF,P5                                                            
*                                                                               
RB16I5   DS    0H                                                               
         CLI   PUBCTL,C'S'                                                      
         BNE   RB16K                                                            
         MVI   0(RF),0                                                          
         LA    RF,132(RF)           SKIP A LINE                                 
*                                                                               
RB16J    CLI   PUBCTL,C'S'           PUB ON SEPERATE INV                        
         BNE   RB16K                                                            
         MVC   0(60,RF),PPUBL1                                                  
         MVC   132(20,RF),PPUBL2                                                
*                                                                               
RB16K    DS    0H                                                               
*                                                                               
RB17     DS    0H                                                               
         LA    R3,BRKL(R3)                                                      
         B     RB16                                                             
*                                                                               
RB18     DS    0H                                                               
*                                  PASS 0                                       
***E***                                                                         
         CLC   QPROG,=C'E1'        FOR ESTIMATES DON'T CHK BILLABLE             
         BE    RB18C                                                            
***E***                                                                         
         L     R6,ASORTDTA                                                      
         CLC   0(16,R6),BGDSP(R6)   TEST ANY BILLABLE                           
         BNE   RB18C                                                            
         CLC   OGDSP(16,R6),OBGDSP(R6)  TEST OPEN BILLABLE                      
         BNE   RB18C                                                            
         OC    0(16,R6),0(R6)        CHECK FOR ANY ORDERED                      
         BNZ   RB19              IF FOUND SKIP - ITEM HAS BEEN BILLED           
         OC    OGDSP(16,R6),OGDSP(R6) CHECK FOR ANY OPEN ORDERED                
         BNZ   RB19              IF FOUND SKIP - ITEM HAS BEEN BILLED           
*                                                                               
*    SINCE I'M NOW BILLING "FREE" BUYS I MUST CONSIDER THEM BILLABLE            
*                                                                               
***TAX   NOTE THAT THE CHECKS ABOVE WILL NOT DETECT A BILLABLE TAX              
***TAX        THIS SHOULD NOT OCCUR SINCE THE TAX PCT. WILL NOT BE              
***TAX        ALLOWED TO CHANGE FOR BILLED INSERTIONS                           
***TAX        ALSO THERE MAY BE DISCREPANCIES IN TAX DUE TO ROUNDING            
*                                                                               
RB18C    MVI   BILSW,C'Y'          SET ACTIVITY                                 
         MVI   ZEROSW,C'N'         RESET ZERO-BILLING SSWOTCH                   
         BAS   RE,SETPASS1         AND DO PASS 1                                
         BAS   RE,SETRET                                                        
         B     RB14D                                                            
RB19     DS    0H                                                               
         CLC   FFS,THISKEY                                                      
         BNE   RB19C                                                            
         CLC   FFS,THISKEY+6                                                    
         BE    RB20                                                             
RB19C    MVC   OLDREC,THISREC                                                   
         B     RB4                                                              
*                                                                               
RB20     DS    0H                                                               
*                                                                               
         CLI   SUMOPT,C'Y'         TEST DOING CORP SUMMARY (RETAIL)             
         BNE   RB30                NO                                           
         CLI   UPASS,C'S'          TEST ALREADY DONE                            
         BE    RB26                YES                                          
         MVI   UPASS,C'S'                                                       
         MVI   CORPZ,C'N'          CORP INV CONTROL                             
*                                                                               
         L     RF,ABADDRS                                                       
         L     RE,ACADDRS                                                       
         MVC   0(ADDRLEN,RF),0(RE)                                              
         L     RF,AAADDRS                                                       
         MVC   0(ADDRLEN,RF),0(RE)   RESTORE ADDRESSES                          
*                                                                               
*                                  CLEAR VARIOUS BREAK CLTS                     
         LA    RF,BRKTAB                                                        
         ST    RF,APAGBRK                                                       
         ST    RF,SVPAGBRK                                                      
         MVC   AINVBRK,APERGBRK                                                 
         XC    ALOWTOG,ALOWTOG                                                  
         XC    AHITOG,AHITOG                                                    
*                                  RESET BREAK CONTROLS                         
         LA    R3,BRKTAB                                                        
*                                                                               
RB21     DS    0H                                                               
         OC    BRKCODE,BRKCODE                                                  
         BZ    RB25B                                                            
         C     R3,APERGBRK         DUMMY 'SEPARATE'                             
         BE    RB25                                                             
         C     R3,APRDBRK          FORCE PRD SEPARATE                           
         BNE   *+12                                                             
         MVI   BRKCTL1,C'S'                                                     
         B     RB24B                                                            
         C     R3,AESTBRK          FORCE EST TOGETHER                           
         BNE   *+8                                                              
         MVI   BRKCTL1,C'S'                                                     
         C     R3,APERBRK          FORCE PERIOD TOGETHER                        
         BNE   *+8                                                              
         MVI   BRKCTL1,C'S'                                                     
         CLI   BRKCTL1,C'S'        SEPARATE                                     
         BNE   RB22                                                             
         MVI   BRKCTL1,C'T'        TO TOGETHER                                  
*                                                                               
         C     R3,APERBRK                                                       
         BE    RB21B                                                            
*                                                                               
         ST    R3,ALOWTOG                                                       
         ST    R3,SVLOWTOG                                                      
*                                                                               
RB21B    DS    0H                                                               
         OC    AHITOG,AHITOG                                                    
         BNZ   *+8                                                              
         ST    R3,AHITOG                                                        
         B     RB24                                                             
*                                                                               
RB22     DS    0H                                                               
         CLI   BRKCTL1,C'T'        TOGETHER                                     
         BE    RB23                                                             
         CLI   BRKCTL1,C'P'                                                     
         BNE   RB24                                                             
RB23     DS    0H                                                               
         MVI   BRKCTL1,C'N'        TO NO                                        
*                                                                               
RB24     DS    0H                                                               
RB24B    DS    0H                                                               
         LA    RF,LEVCTLS                                                       
         A     RF,BRKCODE                                                       
         MVC   0(1,RF),BRKCTL1                                                  
*                                                                               
RB25     DS    0H                                                               
         LA    R3,BRKL(R3)                                                      
         B     RB21                                                             
*                                                                               
RB25B    DS    0H                                                               
         XC    SAVPRD,SAVPRD       START WITH FIRST PRODUCT                     
RB26     DS    0H                                                               
RB26B    DS    0H                                                               
         L     RF,APDLIST                                                       
RB26C    DS    0H                                                               
         CLI   0(RF),X'FF'         TEST IF I ALREADY DID THIS PRD               
         BE    RB26C5              YES                                          
         CLI   0(RF),0             LAST PRD                                     
         BE    RB28                                                             
         B     RB26D                                                            
*                                                                               
RB26C5   LA    RF,3(RF)            NO - NEXT PRD                                
         B     RB26C                                                            
*                                                                               
*                                                                               
RB26D    DS    0H                                                               
         MVC   SAVPRD,0(RF)                                                     
         L     RE,APRD             SET PRD HERE                                 
         MVC   0(3,RE),0(RF)                                                    
         MVI   0(RF),X'FF'         SO I WON'T REDO THIS PRD                     
         L     R3,APRDBRK                                                       
         BAS   RE,FPRD                                                          
         B     RB0                                                              
*                                                                               
RB28     DS    0H                                                               
         GOTO1 ABLDTAB             REBUILD BREAK TABLES                         
         MVI   UPASS,0                                                          
*                                                                               
RB30     DS    0H                                                               
RDBUFFX  DS    0H                                                               
         MVI   PRSW,C'F'           PRINT ANY LEFTOVER LINES                     
         GOTO1 APRNT                                                            
         MVC   RCTRACE,SAVTRACE                                                 
         XC    INVLIST,INVLIST                                                  
         XC    INVTABN,INVTABN                                                  
         L     RF,AINVTAB          CLEAR INVTAB                                 
         XC    0(256,RF),0(RF)                                                  
         MVI   INVSKIP,C'N'                                                     
         MVI   PRDSKIP,C'N'                                                     
RBEXT    DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
SETPASS0 DS    0H                                                               
         MVI   PASSNO,0                                                         
         B     *+8                                                              
SETPASS1 DS    0H                                                               
         MVI   PASSNO,1            SET FOR PASS 1                               
         MVI   RETSKIP,C'N'        RESET SKIP SWITCHES                          
         CLI   RETPROF,0                                                        
         BE    *+12                                                             
         MVI   INVSKIP,C'Y'                                                     
         MVI   PRDSKIP,C'Y'                                                     
         MVC   FORMAT,BFORMAT      CATS                                         
         MVC   STRIP,BSTRIP                                                     
         MVC   ORDSW(3),BORDSW     TYPES                                        
         MVC   DOLNUM,BDOLNUM      NUMBER OF DOL  CATS                          
         MVC   TYPNUM,BTYPNUM      NUMBER OF DOL TYPES                          
         MVC   APAGBRK,SVPAGBRK    RESTORE                                      
         MVC   ALOWTOG,SVLOWTOG                                                 
         MVC   SPOTCTL,SPOTSW                                                   
         OC    ARECAP,ARECAP                                                    
         BZ    SP1B                                                             
         MVC   APAGBRK,AINVBRK     FOR RECAP NO PAGE BRKS                       
         MVC   ALOWTOG,ARECAP                                                   
         MVI   SPOTCTL,C'N'        IF RECAP THEN NO SPOT DETAILS                
         B     SP1C                                                             
*                                  ON MAIN BILL                                 
SP1B     DS    0H                                                               
         CLI   PUBCTL,C'N'         SEE IF NOT SHOWING PUB                       
         BNE   SP1C                                                             
         MVI   SPOTCTL,C'N'        THEN CAN'T HAVE INSERTION DETAILS            
*                                                                               
SP1C     MVI   FMTSW,0                                                          
         CLI   SPOTCTL,C'Y'                                                     
         BNE   SP1D                                                             
         MVI   FMTSW,C'D'          FOR SPOT DETAILS - FORMAT = 0                
SP1D     DS    0H                                                               
*                                                                               
*                                  SET COLS USABLE FOR DESCRIPTIONS             
SETCOLS  DS    0H                                                               
         MVI   TWOCOL,C'Y'         2 COLS AVALIBLE                              
         MVC   WORK(1),DOLNUM                                                   
         MVC   WORK+1(1),TYPNUM                                                 
         LA    RF,COLTAB                                                        
SETCOL3  CLI   0(RF),X'FF'         END OF TABLE                                 
         BER   RE                                                               
         CLC   0(2,RF),WORK                                                     
         BE    SETCOL5                                                          
         LA    RF,2(RF)                                                         
         B     SETCOL3                                                          
*                                                                               
SETCOL5  MVI   TWOCOL,C'N'         2 COLS NOT AVAILABLE                         
         BR    RE                                                               
*                                                                               
*                                  BELOW COMBOS USE 4 COLUMNS                   
COLTAB   DC    X'0302'             DOLNUM,TYPNUM                                
         DC    X'0303'                                                          
         DC    X'0401'                                                          
         DC    X'0403'                                                          
         DC    X'0503'                                                          
         DC    X'0603'                                                          
         DC    X'FFFF'                                                          
         SPACE 3                                                                
RBTRCE   DS    0H                                                               
         CLI   SORTTRCE,C'Y'                                                    
         BNER  RE                                                               
*                                                                               
         MVC   P1+1(1),PASSNO                                                   
         OI    P1+1,C'0'                                                        
         CLI   UPASS,0                                                          
         BE    RBT2                                                             
         MVC   P1+2(1),UPASS                                                    
         CLI   UPASS,C'S'                                                       
         BNL   RBT2                                                             
         OI    P1+2,C'0'                                                        
RBT2     DS    0H                                                               
         MVC   P1+4(1),BYTE                                                     
         LA    RF,BRKLIST-4                                                     
         A     RF,BRKCODE                                                       
         MVC   P1+5(4),0(RF)                                                    
         LR    R0,RE                                                            
         GOTO1 HEXOUT,DMCB,SORTREC,P1+10,SORTRLEN,=C'N'                         
         GOTO1 APRNT                                                            
         LR    RE,R0                                                            
         BR    RE                                                               
         SPACE 3                                                                
SETRET   DS    0H                                                               
         CLI   RETPROF,0                                                        
         BER   RE                                                               
         CLI   UPASS,C'S'                                                       
         BER   RE                                                               
         LR    R0,RE                                                            
         GOTO1 =A(SETR)                                                         
         LR    RE,R0                                                            
         BR    RE                                                               
         SPACE 3                                                                
*                                                                               
*        THIS ROUTINE USED FOR PAYOPTS E,F,G                                    
*        (SKIP ESTS WITH UNPAID INSERTIONS)                                     
CHKSKIP  DS    0H             SEE IF EST IS IN UPETAB                           
         NTR1                 IF FOUND SET DUB TO 1                             
*                             MEANS SKIP THIS RECORD IN BUFF READS              
         MVI   DUB,0                                                            
         XC    X(20),X                                                          
         LA    R5,X                                                             
         USING UPED,R5                                                          
         L     RE,APRD                                                          
         LA    R0,SORTREC                                                       
         SR    RE,R0           POINT TO PRD IN THISREC                          
         LA    RE,THISREC(RE)                                                   
         MVC   UPEPRD,0(RE)                                                     
         L     RE,AEST                                                          
         LA    R0,SORTREC                                                       
         SR    RE,R0           POINT TO EST IN THISREC                          
         LA    RE,THISREC(RE)                                                   
         MVC   UPEEST,0(RE)                                                     
         GOTO1 BINSRCH,UPEPARS,X                                                
         CLI   0(R1),1           SEE IF IN TABLE                                
         BE    CHKSKX                                                           
         MVI   DUB,1             YES THEN SKIP                                  
CHKSKX   XIT1                                                                   
         SPACE 2                                                                
SETADDR  DS    0H                                                               
         USING GDOUTD,R4                                                        
         L     RF,AAADDRS                                                       
         MVC   0(132,RF),SPACES                                                 
         MVC   132(ADDRLEN-132,RF),SPACES                                       
*                                                                               
         MVC   144+36-L'GDOCODE(L'GDOCODE,RF),GDOCODE  OUTLET CODE              
         LA    R1,GDONAME                                                       
         CLI   MOLSON,C'Y'            FOR MOLSON                                
         BNE   SETAD4                                                           
         CLC   GDOCODE(6),=C'000001'  CORPORATE                                 
         BNE   SETAD4                                                           
         LA    R1,MOLSADDR         USE SPECIAL ADDRESS                          
         MVC   144+36-L'GDOCODE(6,RF),=C'000005'  AND DIFFERENT OUTLET          
*                                                 (FOR RECIEVABLES)             
SETAD4   DS    0H                                                               
         MVC   000(36,RF),GDONAME-GDONAME(R1)                                   
         MVC   036(26,RF),GDOAL1-GDONAME(R1)                                    
         MVC   072(26,RF),GDOAL2-GDONAME(R1)                                    
         MVC   108(26,RF),GDOAL3-GDONAME(R1)                                    
         MVC   144(26,RF),GDOAL4-GDONAME(R1)                                    
*                                                                               
*        OLD CODE                                                               
*                                                                               
****     MVC   000(36,RF),GDONAME                                               
****     MVC   036(26,RF),GDOAL1                                                
****     MVC   072(26,RF),GDOAL2                                                
****     MVC   108(26,RF),GDOAL3                                                
****     MVC   144(26,RF),GDOAL4                                                
****     MVC   144+36-L'GDOCODE(L'GDOCODE,RF),GDOCODE                           
*                                                                               
         L     R1,ABADDRS          SET IN BADDRS ALSO                           
         MVC   0(ADDRLEN,R1),0(RF)                                              
         BR    RE                                                               
         DROP  R4                                                               
         EJECT                                                                  
*        'FIRSTS'                                                               
         SPACE 2                                                                
FRSTTAB  DS    0F                                                               
         B     FMED                                                             
         B     FPGR1                                                            
         B     FPGR2                                                            
         B     FPGR3                                                            
         B     FPRD                                                             
         B     FEST                                                             
         B     FMGR1                                                            
         B     FMGR2                                                            
         B     FMGR3                                                            
         B     FMKT                                                             
         B     FJOB                                                             
         B     FPUB                                                             
         B     FDESC                                                            
         B     FPER                                                             
         B     FPERG                                                            
         B     FCTYP                                                            
         B     FCRDB                                                            
         SPACE 3                                                                
*        'LASTS'                                                                
         SPACE 2                                                                
LASTTAB  DS    0F                                                               
         B     LMED                                                             
         B     LPGR1                                                            
         B     LPGR2                                                            
         B     LPGR3                                                            
         B     LPRD                                                             
         B     LEST                                                             
         B     LMGR1                                                            
         B     LMGR2                                                            
         B     LMGR3                                                            
         B     LMKT                                                             
         B     LJOB                                                             
         B     LPUB                                                             
         B     LDESC                                                            
         B     LPER                                                             
         B     LPERG                                                            
         B     LCTYP                                                            
         B     LCRDB                                                            
         EJECT                                                                  
*        FIRST FOR MEDIA                                                        
         DC    F'0'                                                             
FMED     ST    RE,FMED-4                                                        
*                                                                               
         GOTO1 =A(FSTMED)             FMED NOW IN IT'S OWN CSECT                
         L     RE,FMED-4                                                        
         BR    RE                                                               
*                                                                               
         EJECT                                                                  
*        FIRST FOR PRODUCT GROUP                                                
         SPACE 2                                                                
FPGR1    DS    0H                                                               
         LA    R5,PGR1             PGR1 DATA                                    
         L     R6,APGR1                                                         
         B     FPGRA                                                            
         SPACE 2                                                                
FPGR2    DS    0H                                                               
         LA    R5,PGR2             PGR2 DATA                                    
         L     R6,APGR2            FUTURE USE                                   
         B     FPGRA                                                            
         SPACE 3                                                                
FPGR3    DS    0H                                                               
         LA    R5,PGR3             PGR3 DATA                                    
         L     R6,APGR3            FUTURE USE                                   
         SPACE 3                                                                
FPGRA    NTR1                                                                   
         SPACE 2                                                                
*                                                                               
         CLI   UPASS,C'S'           SEE IF CORP SUMMARY PASS                    
         BNE   FPGRA1                                                           
         CLC   QPUB+1(3),=C'RD='   AND DRD OVERCIDE CLT                         
         BE    FPGRAX              THE SKIP DIV                                 
*                                                                               
FPGRA1   OC    ALOWTOG,ALOWTOG                                                  
         BZ    *+12                                                             
         C     R3,ALOWTOG          TEST IF TO APPEAR                            
         BH    FPGRAX              NO                                           
*                                                                               
         MVC   0(3,R5),0(R6)       MOVE CODE                                    
*              READ DIVISION FOR NAME                                           
*              THEN SAVE IT IN PGRNAME                                          
         L     RF,PPFILEC                                                       
         USING PPFILED,RF                                                       
         XC    KEY,KEY                                                          
         MVC   KEY(10),PCLTREC     AGY/MED/CODE/CLT/DIV                         
         OC    AMED,AMED           FOR MULTI-MEDIA REQ GET MEDIA                
         BZ    FPGRA3              FROM AMED                                    
         L     R1,AMED                                                          
         MVC   KEY+2(1),0(R1)                                                   
FPGRA3   MVI   KEY+3,X'03'         DIVISION                                     
         MVC   KEY+7(3),0(R6)                                                   
FPGRA5   GOTO1 HIGH                                                             
         CLC   KEY(10),KEYSAVE                                                  
         BE    FPGRA8                                                           
         CLC   KEYSAVE+7(3),=C'999'                                             
         BE    FPGRA8                                                           
         DC    H'0'                DIVISION NOT FOUND                           
*                                                                               
FPGRA8   GOTO1 GETDIV                                                           
         L     RF,PPFILEC                                                       
         MVC   PGR1NM(20),PDIVNAME                                              
         B     FPGRA15                                                          
*                                                                               
         DROP  RF                                                               
*                                                                               
FPGRA10  B     FPGRAX                                                           
FPGRA15  DS    0H                                                               
         C     R3,APAGBRK          TEST PGR 'HIGHER' THAN PAGE BRK              
         BNH   FPGRA18             YES                                          
*                                  PGR 'TOGETHER'                               
         CLC   P1,SPACES                                                        
         BE    FPGRA17                                                          
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
*                                                                               
FPGRA17  DS    0H                                                               
         OC    18(24,R5),SPACES                                                 
         CLC   ALOWTOG,AHITOG                                                   
         BNE   FPGRA17B                                                         
*                                  IS ONLY TOGETHER                             
         MVC   P1(5),0(R5)                                                      
         CLI   TWOCOL,C'Y'                                                      
         BNE   *+14                                                             
         MVC   P1+6(24),18(R5)                                                  
         B     FPGRA10                                                          
         GOTO1 ACHOPPER,DMCB,(24,18(R5)),(14,P1+6),(C'P',2)                     
         B     FPGRA10                                                          
FPGRA17B  DS    0H                                                              
         MVC   P1(12),6(R5)        DESC                                         
         LA    RF,P1+12                                                         
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         MVC   2(5,RF),0(R5)       NUMBER                                       
*                                                                               
         CLI   TWOCOL,C'Y'                                                      
         BNE   *+14                                                             
         MVC   P2(24),18(R5)                                                    
         B     FPGR17D                                                          
         GOTO1 ACHOPPER,DMCB,(24,18(R5)),(20,P2),(C'P',2)                       
FPGR17D  DS    0H                                                               
         C     R3,ALOWTOG                                                       
         BE    *+8                                                              
         BAS   RE,ULINE                                                         
         B     FPGRA20                                                          
*                                  PGR IN HEADS                                 
FPGRA18  DS    0H                                                               
FPGRA20  DS    0H                                                               
**EDI**                                                                         
         GOTO1 ABILLEDI,DMCB,('EDMPGR',0)     EDI CALL                          
**EDI**                                                                         
*                                                                               
FPGRAX   DS    0H                                                               
         B     RBEXT                                                            
         EJECT                                                                  
*        FIRST FOR ESTIMATE                                                     
         SPACE 2                                                                
FEST     NTR1                                                                   
         SPACE 2                                                                
         GOTO1 AGETAOR              GET ANY AOR INFO                            
*                                                                               
         MVC   SVPFORMT,FORMAT       FORMAT AND STRIP                           
         MVC   SVPSTRIP,STRIP                                                   
         MVC   SVPDOLN,DOLNUM                                                   
         MVC   SVP2COL,TWOCOL                                                   
*                                                                               
         BAS   RE,ESETEST          READ EST AND SET FORMULAS                    
*                                                                               
         GOTO1 ATSTRET             DO RETAIL TEST                               
         BNZ   FESTX                                                            
*                                                                               
         CLI   ESTCTL,C'N'         NOT PRINTING EST                             
         BE    FESTX                                                            
         OC    ALOWTOG,ALOWTOG                                                  
         BZ    *+12                                                             
         C     R3,ALOWTOG          TEST IF TO APPEAR                            
         BH    FESTX               NO                                           
*                                                                               
*                                                                               
**************** NOTE THAT EST IS READ EST SET AND FORMULAS SET                 
**************** IN ESETEST                                                     
****************                                                                
FEST3    DS    0H                                                               
         L     RF,ADEST                                                         
         MVC   ESTNM(20),PESTNAME-PESTREC(RF)                                   
         MVC   ESTNAM2,PESTNAM2-PESTREC(RF)                                     
         MVC   ESTREV,PESTREVN-PESTREC(RF)                                      
*                                                                               
FEST3A6  DS    0H                                                               
         CLI   PRDCTL,C'S'        IF IF PRD AND EST ARE SEPERATE                
         BNE   FEST3AX                                                          
         CLI   ESTCTL,C'S'        SEE IF EST SEPERATE                           
         BNE   FEST3AX                                                          
         CLI   PEOVOPT,C'S'        SEE IF USING COLUMNS OVERRIDE                
         BE    FEST3A8             FROM B2 PROFILE+11 (STRIP-CD)                
*                                  AND SUBTRACT CD FROM STRIP-OFF               
         CLI   PEOVOPT,C'D'        SEE IF USING COLUMNS OVERRIDE                
         BE    FEST3A8             FROM B2 PROFILE+11 (STRIP-CD)                
*                            AND DON'T SUBTRACT CD FROM STRIP-OFF               
         CLI   PEOVOPT,C'Y'        SEE IF USING COLUMNS OVERRIDE                
         BNE   FEST3AX             FROM B2 PROFILE+11                           
FEST3A8  CLI   ESTFORM+9,C'A'      SEE IF OVERRIDING COLUMNS AT EST             
         BL    FEST3AX                                                          
         LA    RF,ESTFORM+9                                                     
         ST    RF,FULL                                                          
         GOTO1 =A(FMTOVER)                                                      
FEST3AX  C     R3,APAGBRK          IS EST 'HIGHER' THAN PAGE BRK                
         BNH   FEST8               YES                                          
         CLC   P1,SPACES                                                        
         BE    FEST3B                                                           
         MVI   SPACING,2                                                        
         GOTO1 APRNT               CLEAR P                                      
FEST3B   DS    0H                                                               
         OC    ESTNM,SPACES                                                     
         OC    ESTNAM2,SPACES                                                   
         CLC   ALOWTOG,AHITOG      IS EST ONLY 'TOGETHER'                       
         BE    FEST5               YES                                          
*                                  EST NOT ONLY                                 
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   P1(8),=C'ESTIMATE'                                               
         MVC   P1(L'PP@EST),PP@EST                                              
         DROP  RE                                                               
         MVC   P1+9(3),EST                                                      
         MVC   P2(20),ESTNM                                                     
         CLC   ESTNAM2,SPACES                                                   
         BE    *+10                                                             
         MVC   P3(20),ESTNAM2                                                   
         B     FEST3D                                                           
FEST3D   DS    0H                                                               
         C     R3,ALOWTOG                                                       
         BE    *+8                                                              
         BAS   RE,ULINE                                                         
         B     FEST10                                                           
*                                  EST IS ONLY TOG                              
FEST5    DS    0H                                                               
         MVC   P1(3),EST                                                        
         CLI   TWOCOL,C'Y'                                                      
         BNE   FEST7                                                            
         MVC   P1+4(20),ESTNM                                                   
         MVC   P2+4(20),ESTNAM2                                                 
         B     FEST10                                                           
*                                                                               
FEST7    GOTO1 ACHOPPER,DMCB,(20,ESTNM),(16,P1+4),(C'P',2)                      
         LA    R4,P2+4                                                          
         CLC   P2+4(16),SPACES     SEE IF I CAN USE P2                          
         BE    *+8                                                              
         LA    R4,P3+4             NO - MUST USE P3                             
         GOTO1 ACHOPPER,DMCB,(20,ESTNAM2),(16,0(R4)),(C'P',2)                   
         B     FEST10                                                           
*                                                                               
FEST8    DS    0H                                                               
FEST10   DS    0H                                                               
**EDI**                                                                         
         GOTO1 ABILLEDI,DMCB,('EDMEST',0)    EDI CALL                           
**EDI**                                                                         
FESTX    DS    0H                                                               
         B     RBEXT                                                            
         EJECT                                                                  
*        GET ESTHDR AND SET FORMULA                                             
*                                                                               
ESETEST  NTR1                                                                   
         L     RF,ADCLT            BUILD EST KEY                                
         XC    KEY,KEY                                                          
         MVC   KEY(25),0(RF)                                                    
         OC    AMED,AMED           SEE IF MULTI-MEDIA REQUEST                   
         BZ    ESEST1                                                           
         L     RF,AMED                                                          
         MVC   KEY+2(1),0(RF)                                                   
*                                                                               
ESEST1   DS    0H                                                               
         L     RE,APRD                                                          
         MVC   KEY+7(3),0(RE)                                                   
         MVI   KEY+3,X'07'                                                      
         L     RF,AEST                                                          
         MVC   KEY+10(2),0(RF)                                                  
         L     R4,ADEST                                                         
         CLC   KEY(12),0(R4)       TEST ALREADY HAVE ESTHDR                     
         BE    ESEST2                                                           
         GOTO1 HIGH                                                             
         CLC   KEY(12),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                ESTIMATE NOT FOUND                           
         GOTO1 GETEST                                                           
*                                                                               
ESEST2   DS    0H                                                               
         L     RF,ADEST                                                         
         MVC   HALF,PESTKEST-PESTREC(RF)                                        
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  EST,DUB                                                          
*                                                                               
         MVC   ESTFORM,PESTBILP-PESTREC(RF)    HOLD PROFILE                     
         OC    ESTFORM,ESTFORM                                                  
         BZ    ESEST2C                                                          
         OC    ESTFORM(5),ESTFORM                                               
         BNZ   ESEST2C                                                          
         MVC   ESTFORM(2),=X'0505'                SET DEFAULT                   
*                                                                               
ESEST2C  MVC   ESTFORM2,PESTREVN+3-PESTREC(RF)    2ND FORMULA                   
         MVC   ESTFORM3,PESTREVN+10-PESTREC(RF)    3RD FORMULA                  
*                                                                               
         XC    AAEFORM,AAEFORM                                                  
         XC    AAEFORM2,AAEFORM2                                                
         XC    AAEFORM3,AAEFORM3                                                
*                                                                               
         L     RE,AAELIST          SET AAA EST FORM IF ANY                      
ESEST3   DS    0H                                                               
         CLC   0(6,RE),FFS         EOL                                          
         BE    ESEST5                                                           
         CLC   10(2,RF),0(RE)      EST =                                        
         BE    ESEST4                                                           
         LA    RE,53(RE)                                                        
         B     ESEST3                                                           
ESEST4   DS    0H                                                               
         MVC   AAEFORM,2(RE)                                                    
         MVC   AAEFORM2,39(RE)       2ND FORMULA                                
         MVC   AAEFORM3,46(RE)       3RD FORMULA                                
*                                                                               
ESEST5   DS    0H                                                               
*                 SET CAROPT OPTION                                             
*                 NOTE - ALSO SET AT ESTF IN PPREPB12A                          
*                                                                               
         MVI   CAROPT,C'N'                                                      
         CLI   CAROPTC,C'Y'      SEE IF COST 2 CLIENT                           
         BNE   ESEST7            SKIP                                           
         L     RF,ADEST                                                         
         CLC   PESTCF-PESTREC(5,RF),=PL5'0' SEE IF EST OVERRIDE                 
         BE    ESEST7       OF ZERO - MEANS NON-COST2 ESTIMATE                  
*                                                                               
         MVI   CAROPT,C'Y'    SET ON SWITCH                                     
         OC    PESTCF-PESTREC(5,RF),PESTCF-PESTREC(RF)                          
         BZ    ESEST7       NO OVERRIDE ENTERED                                 
*                           NO DO CP INSTRUCTION                                
         CP    PESTCF-PESTREC(5,RF),=P'0'   ONE MORE CHECK                      
         BNL   *+6                                                              
         DC    H'0'         SOMETHING VERY WRONG                                
*                                                                               
ESEST7   DS    0H                                                               
ESESTX   DS    0H                                                               
         XIT1                                                                   
         EJECT                                                                  
*        FIRST FOR MARKET GROUP                                                 
         SPACE 2                                                                
FMGR1    DS    0H                                                               
         LA    R5,MGR1             REGION                                       
         L     R6,AMGR1                                                         
         B     FMGRA                                                            
         SPACE 2                                                                
FMGR2    DS    0H                                                               
         LA    R5,MGR2             DISTRICT                                     
         L     R6,AMGR2                                                         
         B     FMGRA                                                            
         SPACE 2                                                                
FMGR3    DS    0H                  FUTURE USE                                   
         LA    R5,MGR3                                                          
         L     R6,AMGR3                                                         
         SPACE 2                                                                
FMGRA    LR    R0,RE                                                            
         GOTO1 =A(FMGRALL)                                                      
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
         EJECT                                                                  
*        FIRST FOR MARKET                                                       
         SPACE 2                                                                
FMKT     NTR1                                                                   
         SPACE 2                                                                
         CLC   AMKTBRK,AINVBRK     IF MKT SEPARATE                              
         BH    FMKT3                                                            
         CLC   AESTBRK,AINVBRK     AND EST SEPARATE                             
         BH    FMKT3                                                            
         GOTO1 ATSTRET             DO RETAIL TEST                               
         BNZ   FMKTX               SKIP                                         
*                                                                               
FMKT3    DS    0H                                                               
         CLI   MKTCTL,0                                                         
         BE    FMKTX               NO MARKETS                                   
         CLI   MKTCTL,C'N'                                                      
         BE    FMKTX                                                            
         OC    ALOWTOG,ALOWTOG                                                  
         BZ    *+12                                                             
         C     R3,ALOWTOG          TEST IF TO APPEAR                            
         BH    FMKTX               NO                                           
         L     RF,AMKT                                                          
         OC    0(2,RF),0(RF)       IF NO MARKET-SKIP ALL MKT CODE               
         BNZ   *+12                                                             
         MVI   MKTCTL,C'N'         (MKTCTL RESET AT ENDINV)                     
         B     FMKTX                                                            
         CLC   XXMKT,0(RF)         SKIP PREV BILL MKT                           
         BNE   FMKT8                                                            
         MVI   SPACING,2                                                        
         CLC   BORDSW(3),=C'YNN'      IF FORMAT (ORDERED ONLY)                  
         BE    FMKTX                                                            
*                                                                               
*              READ MARKET AND PRINT IT                                         
*                                  MKT IN HEADS                                 
FMKT8    DS    0H                                                               
         CLC   P1,SPACES                                                        
         BE    FMKT8C                                                           
         MVI   SPACING,2                                                        
         LR    R0,RF               SAVE RF                                      
         GOTO1 APRNT                                                            
         LR    RF,R0               RESTORE RF                                   
*                                                                               
FMKT8C   DS    0H                                                               
         CLI   MKTCTL,C'S'     SEE IF MARKETS ARE ON SEPERATE INVS              
         BE    FMKT10          DON'T PUT INTO P1 AND P2                         
*                              MARKET WILL PRINT AT RB16I                       
*                                                                               
         MVC   P1+0(20),0(RF)                                                   
         MVC   P2+0(20),DASHES                                                  
         LA    R4,P1+20                                                         
         LA    R5,P2+20                                                         
FMKT9    CLI   0(R4),C' '                                                       
         BH    FMKT10                                                           
         MVI   0(R5),C' '                                                       
         BCTR  R4,0                                                             
         BCTR  R5,0                                                             
         B     FMKT9                                                            
FMKT10   DS    0H                                                               
**EDI**                                                                         
         GOTO1 ABILLEDI,DMCB,('EDMMKT',0)    EDI CALL                           
**EDI**                                                                         
FMKTX    DS    0H                                                               
         B     RBEXT                                                            
         SPACE 2                                                                
FPERG    DS    0H                                                               
         CLI   UPASS,C'S'     IGNORE PERCTL RESET FOR SUMMARY PASS              
         BER   RE                                                               
         CLI   PRIOR,C'M'                                                       
         BNER  RE                                                               
         MVI   PERCTL,C'T'         RESET PERCTL                                 
         L     RF,APERG                                                         
         CLI   0(RF),C'5'          TEST A SEPARATE CURRENT MONTH                
         BNER  RE                  NO                                           
         MVI   PERCTL,C'S'         YES - TREAT AS SEP                           
         BR    RE                                                               
         SPACE 3                                                                
FCTYP    DS    0H                                                               
         BR    RE                                                               
         SPACE 3                                                                
FCRDB    DS    0H                                                               
         BR    RE                                                               
         SPACE 2                                                                
FPUB     LR    R0,RE                                                            
         GOTO1 APUBF                                                            
         LR    RE,R0                                                            
         XC    ITEMCNT,ITEMCNT       USED TO COUNT ITEMS                        
         BR    RE                                                               
         SPACE 2                                                                
FPRD     LR    R0,RE                                                            
         GOTO1 =A(FSTPRD)         FPRD NOW IN ITS OWN CSECT                     
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
         SPACE 2                                                                
FJOB     DS    0H                                                               
         LR    R0,RE               SAVE RETURN REG                              
         GOTO1 AFJOB                                                            
         LR    RE,R0                                                            
         XC    MEDCNT,MEDCNT          USED TO COUNT MEDIA                       
*                                     FOR MULTI-MEDIA REQUEST                   
         BR    RE                                                               
         SPACE 2                                                                
*                                                                               
FDESC    DS    0H                                                               
         L     R1,ITEMCNT            COUNT DETIALS                              
         LA    R1,1(R1)              CLEARED AT FPUB                            
         ST    R1,ITEMCNT            CHECKED IN LPUB - LPUB8                    
         BR    RE                                                               
         SPACE 2                                                                
FPER     DS    0H                                                               
         BR    RE                                                               
         SPACE 2                                                                
         EJECT                                                                  
LMED     NTR1                                                                   
         SPACE 2                                                                
*                                                                               
         GOTO1 ABILCALC                                                         
         CLI   MEDCTL,C'N'                                                      
         BE    LMED10                                                           
         C     R3,ALOWTOG          IS THIS LOWEST TOGETHER                      
         BE    LMED8               YES                                          
         BH    LMEDX               BYPASS IF 'LOWER' (ON RECAPS)                
*                                  EST IS NOT LOWEST                            
         CLC   P1,SPACES                                                        
         BE    LMED5                                                            
         MVI   SPACING,2                                                        
         GOTO1 APRNT               SINCE I MAY NOT HAVE PRINTED                 
*                                  EST NAME YET                                 
LMED5    DS    0H                                                               
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   P1+2(12),=C'MEDIA TOTALS'                                        
         MVC   P1+2(L'PP@MDTOT),PP@MDTOT                                        
         DROP  RE                                                               
         CLI   PRDMKT,C'M'                                                      
         BE    LMED8                                                            
*--->    MVI   P1+1,C'*'          NOT NEEDED SINCE PP@MDTOT HAS *'S             
*--->    MVI   P1+14,C'*'                                                       
         MVC   TOTSTAR,=C'* '                                                   
         SPACE 2                                                                
LMED8    DS    0H                                                               
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   TOTNAME,=CL12'MEDIA'                                             
         MVC   TOTNAME,SPACES                                                   
         MVC   TOTNAME(L'PP@MED),PP@MED                                         
         DROP  RE                                                               
         GOTO1 ATOTOUT                                                          
         MVC   TOTSTAR,SPACES                                                   
*                                                                               
         GOTO1 APRTADJ             PRINT ADJUSTMENTS                            
         B     LMEDX                                                            
LMED10   DS    0H                                                               
LMEDX    DS    0H                                                               
         B     RBEXT                                                            
         EJECT                                                                  
*        LAST FOR PRODUCT GROUP                                                 
         SPACE 2                                                                
LPGR1    DS    0H                                                               
         LA    R5,PGR1             PGR1 DATA                                    
         B     LPGRA                                                            
         SPACE 2                                                                
LPGR2    DS    0H                                                               
         LA    R5,PGR2             PGR2 DATA                                    
         B     LPGRA                                                            
         SPACE 2                                                                
LPGR3    DS    0H                                                               
         LA    R5,PGR3             PGR3 DATA                                    
         B     LPGRA                                                            
         SPACE 2                                                                
LPGRA    NTR1                                                                   
         SPACE 2                                                                
*                                                                               
         CLI   UPASS,C'S'           SEE IF CORP SUMMARY PASS                    
         BNE   LPGRA5              SKIP DIV                                     
         CLC   QPUB+1(3),=C'RD='   AND USING DRD OVERRIDE CLT                   
         BE    LPGRX               SKIP DIV                                     
*                                                                               
LPGRA5   DS    0H                                                               
         C     R3,ALOWTOG          IS THIS LOWEST TOG                           
         BE    LPGRA8              YES                                          
         BH    LPGRX               BYPASS IF 'LOWER' (ON RECAPS)                
*                                  PGR NOT LOWEST                               
         MVC   P1(2),=C'**'                                                     
         MVC   P1+2(12),6(R5)      DESC                                         
         LA    RF,P1+14                                                         
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
*                                                                               
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   2(8,RF),=C'TOTALS**'                                             
         MVC   2(L'PP8TOTAL,RF),PP8TOTAL                                        
         DROP  RE                                                               
         MVC   TOTSTAR,=C'* '                                                   
         SPACE 2                                                                
LPGRA8   DS    0H                                                               
         MVC   TOTNAME,6(R5)       SAVE DESCRIPTION                             
         GOTO1 ATOTOUT                                                          
         MVC   TOTSTAR,SPACES                                                   
         GOTO1 APRTADJ                                                          
LPGRX    DS    0H                                                               
         B     RBEXT                                                            
         EJECT                                                                  
*        LAST FOR PRODUCT                                                       
         SPACE 2                                                                
LPRD     NTR1                                                                   
         SPACE 2                                                                
*                                                                               
         GOTO1 ABILCALC                                                         
         CLI   PRDCTL,C'N'                                                      
         BE    LPRD10                                                           
*                                                                               
         L     R5,=V(DICSECT)                                                   
         USING DICSECT,R5                                                       
         C     R3,ALOWTOG          IS THIS LOWEST TOGETHER                      
         BE    LPRD8               YES                                          
         BH    LPRDX               BYPASS IF 'LOWER' (ON RECAPS)                
*                                  PRD NOT LOWEST                               
         CLC   P1,SPACES                                                        
         BE    LPRD5                                                            
         MVI   SPACING,2                                                        
         GOTO1 APRNT               SINCE I MAY NOT HAVE PRINTED                 
*                                  PRD NAME YET                                 
LPRD5    DS    0H                                                               
*--->    MVC   P1+2(14),=C'PRODUCT TOTALS'                                      
         MVC   P1+2(L'PP@PRDTL),PP@PRDTL                                        
         CLI   PRDMKT,C'M'                                                      
         BE    LPRD8                                                            
         MVI   P1+1,C'*'                                                        
         MVI   P1+16,C'*'                                                       
         MVC   TOTSTAR,=C'* '                                                   
         SPACE 2                                                                
LPRD8    DS    0H                                                               
*--->    MVC   TOTNAME,=CL12'PRODUCT'                                           
         MVC   TOTNAME,SPACES                                                   
         MVC   TOTNAME(L'PP7PRO),PP7PRO                                         
         DROP  R5                                                               
         GOTO1 ATOTOUT                                                          
         MVC   TOTSTAR,SPACES                                                   
*                                  TEST NEED TO SAVE CORP DATA NOW              
         CLI   SUMLEV,C'P'                                                      
         BE    LPRD9                                                            
         CLI   SUMLEV,0                                                         
         BH    LPRD9B                                                           
         MVI   SUMLEV,C'P'         CORP DATE SAVED AT PRD LEVEL                 
LPRD9    DS    0H                                                               
         GOTO1 ASAVCORP                                                         
*                                                                               
LPRD9B   DS    0H                                                               
         GOTO1 APRTADJ                                                          
*                                                                               
         B     LPRDX                                                            
LPRD10   DS    0H                                                               
LPRDX    DS    0H                                                               
         MVC   FORMAT,SVFORMAT      RESTORE FORMAT,STRIP + DOLNUM               
         MVC   STRIP,SVSTRIP                                                    
         MVC   DOLNUM,SVDOLN                                                    
         MVC   TWOCOL,SV2COL                                                    
         B     RBEXT                                                            
         EJECT                                                                  
*        LAST FOR ESTIMATE                                                      
         SPACE 2                                                                
LEST     NTR1                                                                   
         SPACE 2                                                                
*                                                                               
         GOTO1 ABILCALC                                                         
         CLI   ESTCTL,C'N'                                                      
         BE    LEST10                                                           
*                                                                               
         L     R5,=V(DICSECT)                                                   
         USING DICSECT,R5                                                       
         C     R3,ALOWTOG          IS THIS LOWEST TOGETHER                      
         BE    LEST8               YES                                          
         BH    LESTX               BYPASS IF 'LOWER' (ON RECAPS)                
*                                  EST IS NOT LOWEST                            
         CLC   P1,SPACES                                                        
         BE    LEST5                                                            
         MVI   SPACING,2                                                        
         GOTO1 APRNT               SINCE I MAY NOT HAVE PRINTED                 
*                                  EST NAME YET                                 
LEST5    DS    0H                                                               
*--->    MVC   P1+2(15),=C'ESTIMATE TOTALS'                                     
         MVC   P1+2(L'PP@ESTOT),PP@ESTOT                                        
         CLI   PRDMKT,C'M'                                                      
         BE    LEST8                                                            
         MVI   P1+1,C'*'                                                        
         MVI   P1+17,C'*'                                                       
         MVC   TOTSTAR,=C'* '                                                   
         SPACE 2                                                                
LEST8    DS    0H                                                               
*--->    MVC   TOTNAME,=CL12'ESTIMATE'                                          
         MVC   TOTNAME,SPACES                                                   
         MVC   TOTNAME(L'PP@EST),PP@EST                                         
         GOTO1 ATOTOUT                                                          
         MVC   TOTSTAR,SPACES                                                   
         DROP  R5                                                               
*                                                                               
         GOTO1 ASAVCORP                                                         
         MVI   SUMLEV,C'E'         CORP DATA SAVED AT EST LEVEL                 
         GOTO1 APRTADJ             PRINT ADJUSTMENTS                            
         B     LESTX                                                            
LEST10   DS    0H                                                               
LESTX    DS    0H                                                               
         MVC   FORMAT,SVPFORMT       RESTORE FORMAT,STRIP AND DOLNUM            
         MVC   STRIP,SVPSTRIP                                                   
         MVC   DOLNUM,SVPDOLN                                                   
         MVC   TWOCOL,SVP2COL                                                   
         B     RBEXT                                                            
         EJECT                                                                  
*        LAST FOR MARKET GROUP                                                  
         SPACE 2                                                                
LMGR1    DS    0H                                                               
         LA    R5,MGR1             MGR1 DATA                                    
         L     R6,AMGR1                                                         
         B     LMGRA                                                            
         SPACE 2                                                                
LMGR2    DS    0H                                                               
         LA    R5,MGR2             MGR2 DATA                                    
         L     R6,AMGR2                                                         
         B     LMGRA                                                            
         SPACE 2                                                                
LMGR3    DS    0H                                                               
         LA    R5,MGR3             MGR3 DATA                                    
         L     R6,AMGR3                                                         
         B     LMGRA                                                            
         SPACE 2                                                                
LMGRA    NTR1                                                                   
         SPACE 2                                                                
         C     R3,ALOWTOG          IS THIS LOWEST TOGETHER                      
         BE    LMGRA8              YES                                          
         BH    LMGRX               BYPASS IF 'LOWER' (ON RECAPS)                
*                                  MGR NOT LOWEST                               
         MVC   P1,SPACES                                                        
         MVC   P2,SPACES                                                        
         MVC   P3,SPACES                                                        
         MVC   P1(2),=C'**'                                                     
         C     R3,AINVBRK          IF END OF INV                                
         BE    *+10                SKIP DESC IN TOTAL                           
         MVC   P1+3(12),6(R5)                                                   
         LA    R4,P1+14                                                         
LMGRA6   CLI   0(R4),C' '                                                       
         BH    LMGRA7                                                           
         BCT   R4,LMGRA6                                                        
LMGRA7   MVC   2(3,R4),0(R6)       MOVE CODE                                    
         LA    RF,P1+18                                                         
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
*                                                                               
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   2(9,RF),=C'TOTALS **'                                            
         MVC   2(L'PP9TOTAL,RF),PP9TOTAL                                        
         DROP  RE                                                               
         MVC   TOTSTAR,=C'* '                                                   
         C     R3,AINVBRK                                                       
         BE    LMGR17D                                                          
         MVI   P3,0                                                             
         CLI   TWOCOL,C'Y'            DISPLAY NAME HERE ALSO                    
         BNE   *+14                                                             
         MVC   P2(24),18(R5)                                                    
         B     LMGR17D                                                          
         GOTO1 ACHOPPER,DMCB,(24,18(R5)),(20,P2),(C'P',2)                       
LMGR17D  DS    0H                                                               
*                                                                               
LMGRA8   DS    0H                                                               
         MVC   TOTNAME,6(R5)       SAVE DESCRIPTION                             
         GOTO1 ATOTOUT                                                          
         MVC   TOTSTAR,SPACES                                                   
*                                                                               
LMGRX    DS    0H                                                               
         B     RBEXT                                                            
         EJECT                                                                  
*        LAST FOR MARKET                                                        
         SPACE 2                                                                
LMKT     NTR1                                                                   
         SPACE 2                                                                
         CLI   MKTCTL,C'N'                                                      
         BE    LMKT10              NO MKT ON BILL                               
         CLI   MKTCTL,0                                                         
         BE    LMKT10              NO MKT ON BILL                               
*                                                                               
         L     R5,=V(DICSECT)                                                   
         USING DICSECT,R5                                                       
         CLI   UPASS,C'S'          FOR RETAIL SUMMARY                           
         BNE   LMKT2                                                            
         GOTO1 ABILCALC            DO CALCS NOW                                 
LMKT2    DS    0H                                                               
         C     R3,ALOWTOG          IS THIS LOWEST BREAK                         
         BE    LMKT6               YES                                          
         BH    LMKTX               BYPASS IF 'LOWER' (ON RECAPS)                
*                                  MKT NOT LOWEST                               
         L     RE,AMKT                                                          
         CLC   XXMKT,0(RE)                                                      
         BE    LMKT10              BYPASS PRINTING FOR DUMMY MARKET             
         CLC   P1,SPACES                                                        
         BE    LMKT3                                                            
         GOTO1 APRNT               MIGHT STILL NEED TO PRINT MKT                
*                                                                               
LMKT3    CLI   PERCTL,C'T'                                                      
         BNE   LMKT4                                                            
         LA    RF,P1+2                                                          
*--->    MVC   0(13,RF),=C'MARKET TOTALS'                                       
         MVC   0(L'PPAMKTST,RF),PPAMKTST                                        
         B     LMKT6                                                            
LMKT4    DS    0H                                                               
*--->    MVC   P1+07(15),=C'MARKET  *TOTAL*'                                    
         MVC   P1+07(L'PPBMKTST),PPBMKTST                                       
         B     LMKT6                                                            
LMKT4B   DS    0H                                                               
*--->    MVC   P1+01(12),=C'MKT  *TOTAL*'                                       
         MVC   P1+01(L'PPCMKTST),PPCMKTST                                       
*                                                                               
LMKT6    DS    0H                                                               
         MVC   TOTSTAR,=C'* '                                                   
*--->    MVC   TOTNAME,=CL12'MARKET'                                            
         MVC   TOTNAME,SPACES                                                   
         MVC   TOTNAME(L'PP@MARKT),PP@MARKT                                     
         GOTO1 ATOTOUT                                                          
         MVC   TOTSTAR,SPACES                                                   
         DROP  R5                                                               
LMKT10   DS    0H                                                               
LMKTX    DS    0H                                                               
         B     RBEXT                                                            
         EJECT                                                                  
*        LAST FOR PUB                                                           
         SPACE 2                                                                
LPUB     NTR1                                                                   
         SPACE 2                                                                
         CLI   PUBCTL,C'N'        NO PUB ON BILL                                
         BE    LPUB10                                                           
         L     R4,APUB                                                          
         CLC   0(6,R4),XXPUB       SPECIAL CODE FOR MANAUL BILLS                
         BE    LPUB10                                                           
         CLC   0(6,R4),=X'FFFFFFFFFFFF'   SPECIAL CODE FOR PREV                 
         BE    LPUB10              BILLED INS FOR ALL PUBS                      
*                                  DON'T PRINT VENDOR TOTALS                    
*                                                                               
         L     R7,=V(DICSECT)                                                   
         USING DICSECT,R7                                                       
         C     R3,ALOWTOG                                                       
         BH    LPUBX               BYPASS IF 'LOWER' (ON RECAPS)                
         BL    LPUB8                                                            
         LA    R5,P1+0                                                          
LPUB6    DS    0H                                                               
         LR    RF,R5                                                            
         SH    RF,=H'2'                                                         
         CLC   0(20,RF),SPACES      SEE IF CAN PRINT ON SAME LINE               
         BNE   LPUB6B              NO                                           
         CLC   P2,SPACES                                                        
         BE    LPUB7                                                            
LPUB6B   DS    0H                                                               
         GOTO1 APRNT                                                            
LPUB7    DS    0H                                                               
         L     R4,APUB                                                          
         CLC   XXPUB,0(R4)                                                      
         BNE   LPUB7A                                                           
         CLC   BORDSW(3),=C'YNN'   FOR 'ORDERED ONLY' FORMATS                   
         BE    LPUBX               SKIP PREV BILL MKT                           
         CLI   PRDMKT,C'M'         IF MKT HIGHER THAN PRD                       
         BNE   LPUB7B                                                           
         MVI   0(R5),C'.'             FORCE PRINTING                            
         B     LPUB7B                                                           
LPUB7A   DS    0H                                                               
         CLI   PUBCTL,C'S'            SEE IF PUB ON SEPERATE INVOIVE            
         BE    LPUB7B                 SKIP - PUB WILL PRINT AT RB16J            
*                                                                               
         CLI   PROGPRO2+7,7           CHECK IF DETAIL BACK-UP AT PUB            
         BE    LPUB7B                 SKIP PUB WILL AREADY HAVE PRINTED         
*                                                                               
         MVC   0(60,R5),PPUBL1                                                  
         CLI   PPUBL2,C' '                                                      
         BNH   *+10                                                             
         MVC   132(20,R5),PPUBL2                                                
*                                      SEE IF I MUST PRINT PUB NOW              
         CLC   40(10,R5),SPACES                                                 
         BNE   LPUB7A5                                                          
         CLI   TWOCOL,C'Y'                                                      
         BE    LPUB7B                                                           
         CLC   20(10,R5),SPACES                                                 
         BE    LPUB7B                                                           
*                                                                               
LPUB7A5  GOTO1 APRNT                                                            
*                                                                               
LPUB7B   DS    0H                                                               
         MVC   TOTSTAR,=C'* '                                                   
*--->    MVC   TOTNAME,=CL12'VENDOR'                                            
         MVC   TOTNAME,SPACES                                                   
         MVC   TOTNAME(L'PP@VEND),PP@VEND                                       
         GOTO1 ATOTOUT                                                          
         MVC   TOTSTAR,SPACES                                                   
         B     LPUBX                                                            
*                                  PUB NOT LOWEST TOG (SPOT DETS)               
LPUB8    DS    0H                                                               
         GOTO1 APRNT               SINCE PUB TAKES A LINE                       
         OC    ARECAP,ARECAP       SEE IF DOING RECAP PASS                      
         BNZ   LPUB8A                                                           
         CLI   NOINSSW,C'Y'        FIRST CHK IF NOT SHOWING                     
         BE    LPUB8B              INSERT DETAILS ON MAIN BILL                  
*                          IF YES - ALWAYS PRINT VENDOR TOTALS                  
*                                                                               
         CLI   PROFB1A+5,C'Y'      EDI CLIENT?                                  
         BE    LPUB8B              YES, BYPASS ITEM COUNT CHECK                 
         CLI   PROFB1A+5,C'F'                                                   
         BE    LPUB8B                                                           
*                                                                               
LPUB8A   CLC   ITEMCNT,=F'1'      NO TOTALS IF ONLY ONE INSERTION               
         BNH   LPUBX                                                            
*                                                                               
LPUB8B   DS    0H                                                               
*--->    MVC   P1+4(14),=CL14'VENDOR  TOTALS'                                   
         MVC   P1+4(L'PP@VNTOT),PP@VNTOT                                        
***E***                                                                         
         CLI   NOPMBRK,C'Y'                                                     
         BE    LPUB8C                                                           
***E***                                                                         
         CLI   PERCTL,C'T'                                                      
         BE    LPUB8D                                                           
LPUB8C   MVC   P1+4(L'PP@VSTOT),PP@VSTOT                                        
LPUB8D   DS    0H                                                               
*                                                                               
         B     LPUB7B                                                           
*                                                                               
LPUB10   DS    0H                                                               
LPUBX    DS    0H                                                               
         DROP  R7                                                               
         B     RBEXT                                                            
*                                                                               
*        LAST FOR DESCRIPTION - MOVED TO ITS OWN CSECT                          
LDESC    LR    R0,RE               SAVE RETURN REG                              
         GOTO1 ALASTD                                                           
         LR    RE,R0                                                            
         BR    RE                                                               
         SPACE 2                                                                
*                                                                               
LJOB     NTR1                                                                   
         CLI   JOBCTL,C'N'         SEE IF NO SHOWING JOB                        
         BE    LJOBX               AS A CONTROL                                 
         CLI   JOBCTL,0                                                         
         BE    LJOBX                                                            
*                                                                               
LJOB1    DS    0H                                                               
         OC    AMED,AMED          SEE IF MULTI-MEDIA REQUEST                    
         BZ    LJOB1D                                                           
         CLI   JOBCTL,C'S'        SEE IF JOB ON SEPERATE INV                    
         BNE   LJOB1D                                                           
         CLC   MEDCNT,=F'1'       SEE IF ONLY ONE MEDIA                         
         BNE   LJOB1D             SKIP JOB TOTALS                               
         C     R3,AINVBRK         MUST ALSO BE INVOICE BREAK                    
         BNE   LJOB1D                                                           
         B     LJOBX                                                            
*                                                                               
LJOB1D   DS    0H                                                               
         L     R7,=V(DICSECT)                                                   
         USING DICSECT,R7                                                       
         C     R3,ALOWTOG                                                       
         BH    LJOBX               BYPASS IF 'LOWER' (ON RECAPS)                
         BL    LJOB8                                                            
*                                                                               
LJOB2    DS    0H                                                               
*--->    MVC   TOTNAME,=CL12'AD CODE'                                           
         MVC   TOTNAME,SPACES                                                   
         MVC   TOTNAME(L'PPAADCOD),PPAADCOD                                     
         MVC   TOTSTAR,=C'* '                                                   
         GOTO1 ATOTOUT                                                          
         MVC   TOTSTAR,SPACES                                                   
         B     LJOBX                                                            
LJOB8    DS    0H                                                               
         GOTO1 APRNT               SINCE JOB TAKES A LINE                       
LJOB8B   DS    0H                                                               
*--->    MVC   P1+3(15),=CL15'AD CODE  TOTALS'                                  
         MVC   P1+3(L'PPAADCOD),PPAADCOD                                        
         LA    RE,P1+3                                                          
         LA    RE,L'PPAADCOD(RE)                                                
         LA    RE,1(RE)                                                         
         MVC   0(L'PP6TOTAL,RE),PP6TOTAL     TOTALS                             
***E***                                                                         
         CLI   NOPMBRK,C'Y'                                                     
         BE    LJOB8C                                                           
***E***                                                                         
         CLI   PERCTL,C'T'                                                      
         BE    LJOB8D                                                           
*--->    MVI   P1+11,C'*'           LABEL WAS LJOB8C                            
*--->    MVI   P1+17,C'*'                                                       
LJOB8C   MVC   0(L'PP8TOTS,RE),PP8TOTS       *TOTALS*                           
*                                                                               
LJOB8D   DS    0H                                                               
*                                                                               
         B     LJOB2                                                            
*                                                                               
*                                                                               
LJOBX    MVI   JOBACTSW,C'N'                                                    
         B     RBEXT                                                            
*        LAST FOR PERIOD                                                        
LPER     DS    0H                                                               
*                                                                               
LPERG    DS    0H                                                               
         C     R3,AINVBRK          IF INVOICE BREAK                             
         BNE   LPERGX                                                           
         CLI   PASSNO,2            AND PASS 2                                   
         BNE   LPERGX                                                           
         L     R7,=V(DICSECT)                                                   
         USING DICSECT,R7                                                       
*                                  PRINT TOTALS                                 
*--->    MVC   P1(12),=C'** TOTALS **'                                          
         MVC   P1(L'PP@TOTS),PP@TOTS                                            
         LR    R0,RE                                                            
         MVC   TOTSTAR,=C'**'                                                   
         GOTO1 ATOTOUT                                                          
         MVC   TOTSTAR,SPACES                                                   
         LR    RE,R0                                                            
*                                                                               
         CLI   PRIOR,C'M'          SEE IF PRIOR ON SEPERATE INV                 
         BNE   LPERGX                                                           
         MVI   PERCTL,C'T'         RESET PERCTL TO  TOGETHER                    
*                                  NEEDED SINCE PERCTL IS CHECKED               
*                                  IN BUYBK                                     
LPERGX   BR    RE                                                               
         DROP  R7                                                               
         SPACE 2                                                                
LCTYP    DS    0H                                                               
LCRDB    DS    0H                                                               
         C     R3,AINVBRK          IF INVOICE BREAK                             
         BNER  RE                                                               
         CLI   PASSNO,2            AND PASS 2                                   
         BNER  RE                                                               
*                                  PRINT TOTALS                                 
         L     R7,=V(DICSECT)                                                   
         USING DICSECT,R7                                                       
*--->    MVC   P1(12),=C'** TOTALS **'                                          
         MVC   P1(L'PP@TOTS),PP@TOTS                                            
         LR    R0,RE                                                            
         MVC   TOTSTAR,=C'**'                                                   
         DROP  R7                                                               
         GOTO1 ATOTOUT                                                          
         MVC   TOTSTAR,SPACES                                                   
         LR    RE,R0                                                            
         BR    RE                                                               
         EJECT                                                                  
*                             ROLLUP - ADD TO NEXT ACCUM                        
ROLLUP   NTR1                                                                   
         SPACE 2                                                                
*                                                                               
         L     RF,BRKCODE                                                       
         L     R4,ATOTS(RF)                                                     
         LA    R5,MAXMOS+1                                                      
RU2      DS    0H                                                               
         OC    0(ROWTL,R4),0(R4)    **NOTE- LEN WAS ROWL                        
         BZ    RU6                                                              
         LA    R0,ROWL/4                                                        
         LR    RE,R4                                                            
         LH    R2,TOTSIZH          USED AS INDEX REG                            
RU4      DS    0H                                                               
         L     RF,0(R2,R4)                                                      
         A     RF,0(R4)                                                         
         ST    RF,0(R2,R4)                                                      
         LA    R4,4(R4)                                                         
         BCT   R0,RU4                                                           
         XC    000(256,RE),000(RE)                                              
         XC    256(256,RE),256(RE)                                              
         XC    512(ROWL-512,RE),512(RE)                                         
         B     *+8                                                              
RU6      DS    0H                                                               
         LA    R4,ROWL(R4)                                                      
         BCT   R5,RU2                                                           
*                                                                               
         L     RF,BRKCODE                                                       
         L     R4,ATOTS(RF)      POINT TO ACCUM                                 
         AH    R4,=Y(TOTSIZE-BFORML)    POINT TO FORMULA INFO                   
         LR    R5,R4                                                            
         AH    R5,TOTSIZH          R5 POINTS TO NEXT ACCUMS FORMULA             
         USING BFORMD,R4                                                        
*                                  ROLL UP BILL FORMULA                         
         OC    0(BFORML,R5),0(R5)  ANY ALREADY THERE?                           
         BNZ   *+14                                                             
         MVC   0(BFORML,R5),BFBASA NO, JUST MOVE THIS ONE UP                    
         B     RU16                                                             
*                                                                               
         CLC   BFBASA,BFBASA-BFORMD(R5) IS BASE THE SAME?                       
         BE    *+8                                                              
         MVI   BFBASA-BFORMD(R5),X'FF'   NO, SET HAVE UNEQUAL BASES             
*                                                                               
         CLC   BFCOMP,BFCOMP-BFORMD(R5)  IS COMMISSION THE SAME?                
         BE    *+10                                                             
         MVC   BFCOMP-BFORMD(4,R5),FFS   NO, SET UNEQUAL COMMISSIONS            
*                                                                               
         CLC   BFRETSHR,BFRETSHR-BFORMD(R5)  RETAIL SHARE =?                    
         BE    *+10                                                             
         MVC   BFRETSHR-BFORMD(3,R5),FFS   UNEQUAL RETAIL SHRS                  
*                                                                               
         OC    BFTAXMIX-BFORMD(1,R5),BFTAXMIX   MIXED TX STATUS                 
*                                                                               
         CLC   BFAORPCT,BFAORPCT-BFORMD(R5)                                     
         BE    *+10                                                             
         MVC   BFAORPCT-BFORMD(3,R5),FFS     UNEQUAL AOR PCTS                   
*                                                                               
         LA    RE,BFVATCOD         DO VAT CODES INDIVIDUALLY                    
         LA    RF,BFVATCOD-BFORMD(R5)                                           
         LA    R0,NPROVS+1                                                      
         B     RU8A             ?? FOR GST SKIP ALREADY THERE CHECK             
RU8      DS    0H                                                               
         CLI   0(RF),C' '          IF NOTHING ALREADY THERE                     
         BH    *+14                                                             
         MVC   0(1,RF),0(RE)       USE CURRENT VALUE                            
         B     RU8A2                                                            
RU8A     DS    0H                                                               
         CLC   0(1,RE),0(RF)                                                    
         BE    *+8                                                              
         MVI   0(RF),X'FF'         UNEQUAL                                      
RU8A2    DS    0H                                                               
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)                                                         
         BCT   R0,RU8                                                           
*                                                                               
         LA    RE,BFVATSW          DO VAT SWS INDIVIDUALLY                      
         LA    RF,BFVATSW-BFORMD(R5)                                            
         LA    R0,NPROVS+1                                                      
RU8B     DS    0H                                                               
         CLC   0(1,RE),0(RF)                                                    
         BE    *+8                                                              
         MVI   0(RF),X'FF'         UNEQUAL                                      
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)                                                         
         BCT   R0,RU8B                                                          
*                                                                               
RU16     DS    0H                                                               
         XC    BFBASA(BFORML),BFBASA    CLEAR OLD ONE                           
*                                                                               
RUX      DS    0H                                                               
         B     RBEXT                                                            
         EJECT                                                                  
*        ULINE IN FIRST BLANK LINE                                              
ULINE    NTR1                                                                   
*                                  FIND FIRST BLANK LINE                        
         LA    R3,P1                                                            
         SR    RE,RE                                                            
UL2      DS    0H                                                               
         OC    0(40,R3),SPACES                                                  
         CLC   0(40,R3),SPACES                                                  
         BE    UL4                                                              
         LA    R3,132(R3)                                                       
         LA    RE,1(RE)                                                         
         B     UL2                                                              
*                                                                               
UL4      DS    0H                                                               
         LTR   RE,RE                                                            
         BNP   ULX                                                              
*                                                                               
         LA    RF,P1+40                                                         
UL5      DS    0H                                                               
         LR    R1,RF                                                            
         LR    R0,RE                                                            
UL6      DS    0H                                                               
         CLI   0(R1),C' '                                                       
         BH    UL8                 FIRST NON-BLACK CHAR                         
         LA    R1,132(R1)                                                       
         BCT   R0,UL6                                                           
*                                                                               
         BCT   RF,UL5                                                           
*                                                                               
UL8      DS    0H                                                               
         LA    R0,P1                                                            
         SR    RF,R0                                                            
         BM    ULX                                                              
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),DASHES                                                   
*                                                                               
ULX      DS    0H                                                               
         B     RBEXT                                                            
         SPACE 3                                                                
ITEMCNT  DS    F                                                                
         LTORG                                                                  
         SPACE 3                                                                
BRKLIST  DS    0C                                                               
         DC    C'MED '                                                          
         DC    C'PGR1'                                                          
         DC    C'PGR2'                                                          
         DC    C'PGR3'                                                          
         DC    C'PRD '                                                          
         DC    C'EST '                                                          
         DC    C'MGR1'                                                          
         DC    C'MGR2'                                                          
         DC    C'MGR3'                                                          
         DC    C'MKT '                                                          
         DC    C'JOB '                                                          
         DC    C'PUB '                                                          
         DC    C'DESC'                                                          
         DC    C'PER '                                                          
         DC    C'PERG'                                                          
         DC    C'CRDB'                                                          
*                                                                               
         DROP  R8                                                               
*                                                                               
*                                                                               
MOLSADDR DS    0C                                                               
         DC    CL36'MOLSON BREWERIES USA, INC.'                                 
         DC    CL26'11911 FREEDOM DRIVE'                                        
         DC    CL26'RESTON, VA.  22090-5609'                                    
         DC    CL26' '                                                          
         DC    CL26' '                                                          
         EJECT                                                                  
FSTMED   CSECT                                                                  
         NMOD1 0,FSTMED                                                         
         LA    RC,SPACEND                                                       
*                                                                               
         L     RF,AMED                                                          
         MVC   FINANSW,1(RF)        SET FINANCIAL SWITCH FROM BUFFER            
*                                                                               
         OC    FININVSW,FINANSW     OR ON FINANCIAL INVOICE SWITCH              
*                                   SO FININVSW WILL BE SET TO                  
*                                   FINANCIAL IF ANY OF THE MEDIAS              
*                                   ARE FINANCIAL                               
*                                   THIS IS USED FOR AOR,ADJ, AND CD            
*                                   INVOICES                                    
*                                   THIS SWITCH WILL BE RESET TO X'00'          
*                                   AFTER GOTO AENDINV                          
*                                                                               
         CLI   MEDCTL,C'N'                                                      
         BE    FMEDX                                                            
         CLI   JOBCTL,C'S'          SEE IF JOB SEPERATE                         
         BNE   FMED2                                                            
         OC    AMED,AMED                                                        
         BZ    FMED2               SEE IF MULTIMEDIA REQUEST                    
         L     RF,MEDCNT                                                        
         AH    RF,=H'1'                                                         
         ST    RF,MEDCNT                                                        
*                                                                               
FMED2    DS    0H                                                               
         CLC   P1,SPACES                                                        
         BE    FMED5                                                            
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
*                                                                               
FMED5    XC    KEY,KEY                                                          
         MVC   KEY(2),QAGENCY                                                   
         L     RF,AMED                                                          
         MVC   KEY+2(1),0(RF)                                                   
         MVI   KEY+3,X'01'                                                      
         GOTO1 HIGH                                                             
         CLC   KEY(4),KEYSAVE                                                   
         BE    *+6                                                              
         DC    H'0'             FATAL ERROR                                     
*                                                                               
         GOTO1 GETAGY                                                           
         L     RF,PPFILEC                                                       
         USING PPFILED,RF                                                       
         MVC   P1(10),PAGYMED                                                   
         OC    P1(10),SPACES                                                    
*                                                                               
         CLC   P1(10),=C'INTERACTIV'                                            
         BE    FMED5B                                                           
         CLC   P1(9),=C'INTERACTV'  COVERS INTERACTV AND INTERACTVE             
         BE    FMED5B                                                           
         CLC   P1(6),=C'INTRAC'   INTRACTIVE AND OTHERS                         
         BE    FMED5B                                                           
         B     FMED5C                                                           
*                                                                               
FMED5B   MVC   P1(11),=C'INTERACTIVE'   11 CHARACTERS                           
*                                                                               
FMED5C   DS    0H                                                               
         BAS   RE,FMDULINE                                                      
*                                                                               
*                                  READ AAA PRDHDR                              
*                                  FOR ADDRESS AND FORMULA                      
         L     RE,AAADDRS                                                       
         MVC   0(132,RE),SPACES                                                 
         MVC   132(ADDRLEN-132,RE),SPACES                                       
*                                                                               
         XC    AAAFORM,AAAFORM                                                  
         XC    AAAFORM2,AAAFORM2                                                
         XC    AAAFORM3,AAAFORM3                                                
         L     RF,AAELIST                                                       
         MVC   0(6,RF),FFS                                                      
*                                                                               
         MVC   KEY1,KEY                                                         
         L     RF,ADCLT                                                         
         MVC   KEY(25),0(RF)                                                    
         L     RF,AMED                                                          
         MVC   KEY+2(1),0(RF)                                                   
         MVI   KEY+3,X'06'                                                      
         MVC   KEY+7(3),=C'AAA'                                                 
         GOTO1 HIGH                                                             
         CLC   KEY(25),KEYSAVE                                                  
         BNE   FMEDF5                                                           
         MVC   AREC,ADWKREC        READ INTO WORK REC                           
         GOTO1 GETPRT                                                           
         L     RF,AREC                                                          
         LA    RF,PPRDBILL-PPRDREC(RF)                                          
         CLC   =C'NONE',0(RF)                                                   
         BE    FMEDF4A                                                          
         CLC   =C'XX',0(RF)                                                     
         BE    FMEDF4A                                                          
         CLC   =C'X ',0(RF)                                                     
         BE    FMEDF4A                                                          
         CLI   0(RF),C'A'                                                       
         BL    FMEDF4A                                                          
         L     RE,AAADDRS       CORP ADDRESS                                    
         MVC   000(20,RE),00(RF)                                                
         MVC   036(30,RE),20(RF)                                                
         MVC   072(30,RE),50(RF)                                                
         MVC   108(24,RE),80(RF)                                                
**NEW 3/7/89                                                                    
*                        CHECK FOR SECOND BILL RECEIPT NAME LINE                
*                                                                               
         L     R1,AREC              DID USE RE  NOW USE R1                      
         LA    R1,PPRDBIL2-PPRDREC(R1)  AND LEAVE RE SET TOAAADDRS              
*                                       RF IS STILL SET TO PPRDBILL             
         CLI   0(R1),C'A'                                                       
         BL    FMEDF4A                                                          
         CLC   =C'NONE',0(R1)                                                   
         BE    FMEDF4A                                                          
         CLC   =C'XX',0(R1)                                                     
         BE    FMEDF4A                                                          
         CLC   =C'X ',0(R1)                                                     
         BE    FMEDF4A                                                          
         MVC   036(30,RE),SPACES      CLEAR                                     
         MVC   036(20,RE),0(R1)                                                 
         MVC   072(30,RE),20(RF)                                                
         MVC   108(30,RE),50(RF)                                                
         MVC   144(24,RE),80(RF)                                                
**NEW 3/7/89                                                                    
*                                                                               
FMEDF4A  DS    0H                                                               
         L     RF,AREC                                                          
         MVC   AAAFORM,PPRDBILP-PPRDREC(RF)    DATE, BASE + COMMISSION          
         MVC   AAAFORM2,PPRDBILP+37-PPRDREC(RF)   2ND FORMULA + DATE            
         MVC   AAAFORM3,PPRDBILP+44-PPRDREC(RF)   3ND FORMULA + DATE            
*                                                                               
*                                  BUILD LIST OF ANY AAA EST FORMULAS           
         L     R6,AAELIST          START                                        
         L     RF,AREC                                                          
         MVC   KEY,0(RF)                                                        
         L     RF,AMED                                                          
         MVC   KEY+2(1),0(RF)                                                   
         MVI   KEY+3,7                                                          
FMEDF4B  DS    0H                                                               
         GOTO1 SEQ                                                              
         CLC   KEY(10),KEYSAVE                                                  
         BNE   FMEDF5              DONE                                         
*                                                                               
         GOTO1 GETREC                                                           
         L     RF,AREC                                                          
         MVC   0(2,R6),10(RF)      EST NO.                                      
         MVC   2(37,R6),PESTBILP-PESTREC(RF)    FORMULA                         
         OC    2(37,R6),2(R6)                                                   
         BZ    FMEDF4D                                                          
         OC    2(5,R6),2(R6)                                                    
         BNZ   FMEDF4D                                                          
         MVC   2(2,R6),=X'0505'              SET DEFAULT                        
*                                     IF CHAB WITH NO FORMULA                   
*                                                                               
FMEDF4D  MVC   39(14,R6),PESTREVN+3-PESTREC(RF)    FORMULAS 2 + 3               
*                                                                               
**             2ND AND 3RD FORMULAS                                             
*                                                                               
         LA    R6,53(R6)                                                        
         MVC   0(6,R6),FFS         SET EOL                                      
         L     RE,AAELIST                                                       
         AH    RE,=H'5300'         MAX 100 ESTS                                 
         CR    R6,RE                                                            
         BL    FMEDF4B                                                          
         DC    H'0'                TABLE FULL                                   
*                                                                               
FMEDF5   DS    0H                                                               
         CLI   AORSW,C'Y'          IF DOING AOR                                 
         BNE   FMEDX                                                            
*                                  IF PRD AND EST ARE SEPERATE                  
*                                  I MUST GO TO GETAOR HERE                     
         CLI   PRDCTL,C'S'                                                      
         BNE   FMEDX                                                            
         CLI   ESTCTL,C'S'                                                      
         BNE   FMEDX                                                            
         GOTO1 AGETAOR                                                          
*                                                                               
FMEDX    DS    0H                                                               
         XMOD1                                                                  
         EJECT                                                                  
*        ULINE IN FIRST BLANK LINE                                              
FMDULINE NTR1                                                                   
*                                  FIND FIRST BLANK LINE                        
         LA    R3,P1                                                            
         SR    RE,RE                                                            
FMDUL2   DS    0H                                                               
         OC    0(40,R3),SPACES                                                  
         CLC   0(40,R3),SPACES                                                  
         BE    FMDUL4                                                           
         LA    R3,132(R3)                                                       
         LA    RE,1(RE)                                                         
         B     FMDUL2                                                           
*                                                                               
FMDUL4   DS    0H                                                               
         LTR   RE,RE                                                            
         BNP   FMDULX                                                           
*                                                                               
         LA    RF,P1+40                                                         
FMDUL5   DS    0H                                                               
         LR    R1,RF                                                            
         LR    R0,RE                                                            
FMDUL6   DS    0H                                                               
         CLI   0(R1),C' '                                                       
         BH    FMDUL8              FIRST NON-BLACK CHAR                         
         LA    R1,132(R1)                                                       
         BCT   R0,FMDUL6                                                        
*                                                                               
         BCT   RF,FMDUL5                                                        
*                                                                               
FMDUL8   DS    0H                                                               
         LA    R0,P1                                                            
         SR    RF,R0                                                            
         BM    FMDULX                                                           
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),DASHES                                                   
*                                                                               
FMDULX   DS    0H                                                               
         XIT1                                                                   
         DROP  RF                                                               
         LTORG                                                                  
*                                                                               
         EJECT                                                                  
*                                                                               
FSTPRD   CSECT                                                                  
         NMOD1 0,FSTPRD                                                         
         LA    RC,SPACEND                                                       
*                                                                               
         SPACE 2                                                                
         MVC   SVFORMAT,FORMAT                                                  
         MVC   SVSTRIP,STRIP                                                    
         MVC   SVDOLN,DOLNUM                                                    
         MVC   SV2COL,TWOCOL                                                    
*                                                                               
FPRD2    DS    0H                     MUST ALWAYS READ PRD                      
         L     R4,APRD                                                          
         L     RF,ADCLT                                                         
         MVC   KEY(25),0(RF)                                                    
         OC    AMED,AMED           FOR MULTI-MEDIA REQ GET MEDIA                
         BZ    FPRD2B              FROM AMED                                    
         L     RF,AMED                                                          
         MVC   KEY+2(1),0(RF)                                                   
*                                                                               
FPRD2B   MVC   KEY+7(3),0(R4)      3 CHAR PRD CODE                              
         MVI   KEY+3,X'06'                                                      
         L     RF,ADPRD                                                         
         CLC   KEY(10),0(RF)       TEST ALREADY HAVE PRDREC                     
         BE    FPRD2X                                                           
         GOTO1 HIGH                                                             
         CLC   KEY(10),KEYSAVE                                                  
         BE    FPRD2C                                                           
         DC    H'0'               PRODUCT MUST BE ON FILE                       
*                                                                               
FPRD2C   L     RF,ADPRD                                                         
         ST    RF,AREC                                                          
         GOTO1 GETPRT                                                           
*                                                                               
FPRD2X   DS    0H                                                               
         L     RF,ADPRD                                                         
         B     FPRD3           SKIP VAT LOGIC ITS DONE ELSEWHERE                
*                                                                               
FPRD3    DS    0H                            ALWAYS SET FORMULA                 
*                                                                               
         L     RF,ADPRD                                                         
*                                                                               
******   CLI   BFROPT,C'N'         IF NOT DOING NEW BFR'S                       
******   BNE   FPRD3X                                                           
*                                                                               
         MVC   PRDFORM,PPRDBILP-PPRDREC(RF)    HOLD PROFILE                     
         OC    PRDFORM,PRDFORM                                                  
         BZ    FPRD3A                                                           
         OC    PRDFORM(5),PRDFORM                                               
         BNZ   FPRD3A                                                           
         MVC   PRDFORM(2),=X'0505'        SET DEFAULT IF CHAB THERE             
*                                         WITH NO FORMULA                       
FPRD3A   DS    0H                                                               
         CLC   AESTBRK,APRDBRK        SEE IF EST 'HIGHER' THAM PRD              
         BNL   *+8                                                              
         BAS   RE,SETEST         IF SO TRY FOR ESTIMATE FORMULA                 
*                                                                               
*                                                                               
*        MOVED FROM BEGINNING OF FPRD TO HERE                                   
**NEW 11/6/89                                                                   
FPRD3X   DS    0H                                                               
         GOTO1 AGETAOR             MUST TRY TO GET AOR INFO                     
*                                  HERE IN CASE REQUEST IS FOR                  
*                                  ONE EST AND ALL PRDS                         
*                                                                               
         CLI   PRDCTL,C'N'         NOT PRINTING PRD                             
         BE    FPRDX                                                            
         CLI   RETPROF,0                                                        
         BE    *+8                                                              
         MVI   PRDSKIP,C'Y'                                                     
         CLI   UPASS,C'S'                                                       
         BE    FPRD4                                                            
         OC    ALOWTOG,ALOWTOG                                                  
         BZ    *+12                                                             
         C     R3,ALOWTOG          TEST IF TO APPEAR                            
         BH    FPRDX               NO                                           
*                                                                               
FPRD4    DS    0H                                                               
         L     RF,ADPRD                                                         
*                                         FORMULA NOW SET AT FPRD3              
FPRD4A   MVC   PRD,PPRDKPRD-PPRDREC(RF)                                         
         MVC   PRDNM(20),PPRDNAME-PPRDREC(RF)                                   
*                                                                               
         CLI   RETPROF,0           SKIP PRD ADDR IF RETAIL                      
         BNE   FPRD6                                                            
         LA    RF,PPRDBILL-PPRDREC(RF)                                          
         L     RE,ABADDRS                                                       
         MVC   0(132,RE),SPACES                                                 
         MVC   132(ADDRLEN-132,RE),SPACES                                       
         CLC   =C'NONE',0(RF)                                                   
         BE    FPRD6                                                            
         CLC   =C'XX',0(RF)                                                     
         BE    FPRD6                                                            
         MVC   WORK(5),0(RF)                                                    
         OC    WORK(5),SPACES     SINCE THERE MAY BE BINARY ZEROS               
         CLC   WORK(5),=C'X    '                                                
         BE    FPRD6                                                            
         CLI   0(RF),C'A'                                                       
         BL    FPRD6                                                            
*                                                                               
         MVC   000(20,RE),00(RF)    BILL RECIEPT NAME                           
         MVC   036(30,RE),20(RF)    PPRDLIN1                                    
         MVC   072(30,RE),50(RF)    PPRDLIN2                                    
         MVC   108(24,RE),80(RF)    PPRDATTN                                    
*                                                                               
****     MVC   BADDR1(20),00(RF)    BILL RECIEPT NAME                           
****     MVC   BADDR2(30),20(RF)    PPRDLIN1                                    
****     MVC   BADDR3(30),50(RF)    PPRDLIN2                                    
****     MVC   BADDR4(24),80(RF)    PPRDATTN                                    
**NEW 3/7/89                                                                    
*                                                                               
*                            CHECK FOR 2ND BILL RECEIPT NAME LINE               
*                                                                               
         L     R1,ADPRD                                                         
         LA    R1,PPRDBIL2-PPRDREC(R1)                                          
         CLC   =C'NONE',0(R1)                                                   
         BE    FPRD6                                                            
         CLC   =C'XX',0(R1)                                                     
         BE    FPRD6                                                            
*                                                                               
         MVC   WORK(5),0(R1)                                                    
         OC    WORK(5),SPACES     SINCE THERE MAY BE BINARY ZEROS               
         CLC   WORK(5),=C'X    '                                                
         BE    FPRD6                                                            
*                                                                               
         CLI   0(R1),C'A'                                                       
         BL    FPRD6                                                            
         MVC   036(30,RE),SPACES                                                
         MVC   036(20,RE),0(R1)                                                 
         MVC   072(30,RE),20(RF)                                                
         MVC   108(30,RE),50(RF)                                                
         MVC   144(24,RE),80(RF)                                                
*                                                                               
****     MVC   BADDR2(30),SPACES           FIRST CLEAR                          
****     MVC   BADDR2(20),0(RE)                                                 
****     MVC   BADDR3(30),20(RF)                                                
****     MVC   BADDR4(30),50(RF)                                                
****     MVC   BADDR5(24),80(RF)                                                
**NEW 3/7/89                                                                    
FPRD6    DS    0H                                                               
         C     R3,APAGBRK          IS PRD 'HIGHER' THAN PAGE BRK                
         BNH   FPRD8               YES                                          
         CLI   PRDCTL,C'S'                                                      
         BE    FPRD8                                                            
         CLC   P1,SPACES                                                        
         BE    FPRD7                                                            
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    CLC   P1(8),=C'PRODUCT-'  PREVENT PRINTING OF UNUSED                   
         CLC   P1(L'PP8PRO),PP8PRO                                              
         BNE   FPRD6B              PRODUCT (CAN HAPPEN IN RETAIL)               
*                                                                               
         DROP  RE                                                               
*                                                                               
         MVC   P1,SPACES                                                        
         MVC   P2,SPACES                                                        
         MVC   P3,SPACES                                                        
         B     FPRD7                                                            
*                                                                               
FPRD6B   DS    0H                                                               
         MVI   SPACING,2                                                        
         GOTO1 APRNT               CLEAR P                                      
FPRD7    DS    0H                                                               
         MVC   X(7),SPACES     CLEAR X (PRD ACCOUNT PUT THERE)                  
*                                                                               
         CLI   AGMCLNO,C'C'        NO ACCT NO IF C OR X                         
         BE    FPRD7D                                                           
         CLI   AGMCLNO,C'X'        NO ACCT NO IF C OR X                         
         BE    FPRD7D                                                           
*                                  PUT ACCT NO (IF ANY) IN X(7)                 
         L     RF,ADPRD                                                         
         MVC   FULL,PPRDACCT-PPRDREC(RF)                                        
         CLI   FULL,C' '                                                        
         BNH   FPRD7D                                                           
         MVI   X,C'('                                                           
         MVC   X+1(4),FULL                                                      
         MVI   X+5,C')'                                                         
         CLI   FULL,X'FF'                                                       
         BNE   FPRD7D                                                           
         MVI   FULL,0                                                           
         EDIT  (B4,FULL),(5,X+1),ALIGN=LEFT                                     
         LA    R1,X+1                                                           
         AR    R1,R0               ADD EDITED LENGHT                            
         MVI   0(R1),C')'                                                       
*                                                                               
FPRD7D   DS    0H                                                               
         OC    PRDNM,SPACES                                                     
         CLC   ALOWTOG,AHITOG      IS PRD ONLY 'TOGETHER'                       
         BE    FPRD5               YES                                          
*                                  PRD NOT ONLY                                 
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   P1(8),=C'PRODUCT-'                                               
         MVC   P1(L'PP8PRO),PP8PRO                                              
         DROP  RE                                                               
         MVC   P1+9(3),PRD                                                      
         MVC   P1+14(7),X          ACCT NO.                                     
         CLI   TWOCOL,C'Y'                                                      
         BNE   *+14                                                             
         MVC   P2(24),PRDNM                                                     
         B     FPRD7F                                                           
         GOTO1 ACHOPPER,DMCB,(24,PRDNM),(20,P2),(C'P',2)                        
FPRD7F   DS    0H                                                               
         C     R3,ALOWTOG                                                       
         BE    *+8                                                              
         BAS   RE,PULINE                                                        
         B     FPRD10                                                           
*                                  PRD ONLY 'TOGETHER'                          
FPRD5    DS    0H                                                               
         MVC   P1(3),PRD                                                        
         MVC   W,SPACES                                                         
         MVC   W(24),PRDNM                                                      
         LA    RF,W+24             FLOAT ACCT NO AFTER                          
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         MVC   2(7,RF),X                                                        
         CLI   TWOCOL,C'Y'                                                      
         BNE   *+14                                                             
         MVC   P1+4(33),W                                                       
         B     FPRD10                                                           
         GOTO1 ACHOPPER,DMCB,(33,W),(16,P1+4),(C'P',3)                          
         B     FPRD10                                                           
FPRD8    DS    0H                                                               
         CLI   PRDCTL,C'S'                                                      
         BNE   FPRD10                                                           
         CLI   PEOVOPT,C'S'     SEE IF USING COLUMNS OVERRIDE                   
         BE    FPRD8C           FROM B2 PROFILE+11                              
*                               AND SUBTRACT CD FROM STRIP-OFF                  
         CLI   PEOVOPT,C'D'     SEE IF USING COLUMNS OVERRIDE                   
         BE    FPRD8C           FROM B2 PROFILE+11                              
*                               AND DON'T SUBTRACT CD FROM STRIP-OFF            
         CLI   PEOVOPT,C'Y'        SEE IF USING COLUMNS OVERRIDE                
         BNE   FPRD10              FROM B2 PROFILE+11                           
FPRD8C   CLI   PRDFORM+9,C'A'      SEE IF OVERIDING COLUMNS TO PRINT            
         BL    FPRD9               LOOK AT AAAFORM                              
         LA    RF,PRDFORM+9                                                     
         ST    RF,FULL                                                          
         GOTO1 =A(FMTOVER)                                                      
         B     FPRD10                                                           
*                                                                               
FPRD9    OC    PRDFORM,PRDFORM     SEE IF PRD CHAB FOUND                        
         BNZ   FPRD10              YES - DON'T LOOK AT AAAFORM                  
         CLI   AAAFORM+9,C'A'      SEE IF OVERIDING COLUMNS TO PRINT            
         BL    FPRD10                                                           
         LA    RF,AAAFORM+9                                                     
         ST    RF,FULL                                                          
         GOTO1 =A(FMTOVER)                                                      
FPRD10   DS    0H                                                               
**EDI**                                                                         
         GOTO1 ABILLEDI,DMCB,('EDMPRD',0)    EDI CALL                           
**EDI**                                                                         
FPRDX    DS    0H                                                               
         XMOD1                                                                  
         EJECT                                                                  
*                                                                               
         SPACE 2                                                                
*        GET ESTHDR AND SET FORMULA                                             
*                                                                               
SETEST   NTR1                                                                   
         L     RF,ADCLT            BUILD EST KEY                                
         XC    KEY,KEY                                                          
         MVC   KEY(25),0(RF)                                                    
         OC    AMED,AMED           SEE IF MULTI-MEDIA REQUEST                   
         BZ    SEST1                                                            
         L     RF,AMED                                                          
         MVC   KEY+2(1),0(RF)                                                   
*                                                                               
SEST1    DS    0H                                                               
         L     RE,APRD                                                          
         MVC   KEY+7(3),0(RE)                                                   
         MVI   KEY+3,X'07'                                                      
         L     RF,AEST                                                          
         MVC   KEY+10(2),0(RF)                                                  
         L     R4,ADEST                                                         
         CLC   KEY(12),0(R4)       TEST ALREADY HAVE ESTHDR                     
         BE    SEST2                                                            
         GOTO1 HIGH                                                             
         CLC   KEY(12),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                ESTIMATE NOT FOUND                           
         GOTO1 GETEST                                                           
*                                                                               
SEST2    DS    0H                                                               
         L     RF,ADEST                                                         
         MVC   ESTFORM,PESTBILP-PESTREC(RF)    HOLD PROFILE                     
         OC    ESTFORM,ESTFORM                                                  
         BZ    SEST2C                                                           
         OC    ESTFORM(5),ESTFORM                                               
         BNZ   SEST2C                                                           
         MVC   ESTFORM(2),=X'0505'                SET DEFAULT                   
*                                                                               
SEST2C   MVC   ESTFORM2,PESTREVN+3-PESTREC(RF)    2ND FORMULA                   
         MVC   ESTFORM3,PESTREVN+10-PESTREC(RF)    3RD FORMULA                  
*                                                                               
         XC    AAEFORM,AAEFORM                                                  
         XC    AAEFORM2,AAEFORM2                                                
         XC    AAEFORM3,AAEFORM3                                                
*                                                                               
         L     RE,AAELIST          SET AAA EST FORM IF ANY                      
SEST3    DS    0H                                                               
         CLC   0(6,RE),FFS         EOL                                          
         BE    SEST5                                                            
         CLC   10(2,RF),0(RE)      EST =                                        
         BE    SEST4                                                            
         LA    RE,53(RE)                                                        
         B     SEST3                                                            
SEST4    DS    0H                                                               
         MVC   AAEFORM,2(RE)                                                    
         MVC   AAEFORM2,39(RE)       2ND FORMULA                                
         MVC   AAEFORM3,46(RE)       3RD FORMULA                                
*                                                                               
SEST5    DS    0H                                                               
SESTX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        PULINE IN FIRST BLANK LINE                                             
PULINE   NTR1                                                                   
*                                  FIND FIRST BLANK LINE                        
         LA    R3,P1                                                            
         SR    RE,RE                                                            
PUL2     DS    0H                                                               
         OC    0(40,R3),SPACES                                                  
         CLC   0(40,R3),SPACES                                                  
         BE    PUL4                                                             
         LA    R3,132(R3)                                                       
         LA    RE,1(RE)                                                         
         B     PUL2                                                             
*                                                                               
PUL4     DS    0H                                                               
         LTR   RE,RE                                                            
         BNP   PULX                                                             
*                                                                               
         LA    RF,P1+40                                                         
PUL5     DS    0H                                                               
         LR    R1,RF                                                            
         LR    R0,RE                                                            
PUL6     DS    0H                                                               
         CLI   0(R1),C' '                                                       
         BH    PUL8                FIRST NON-BLACK CHAR                         
         LA    R1,132(R1)                                                       
         BCT   R0,PUL6                                                          
*                                                                               
         BCT   RF,PUL5                                                          
*                                                                               
PUL8     DS    0H                                                               
         LA    R0,P1                                                            
         SR    RF,R0                                                            
         BM    PULX                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),DASHES                                                   
*                                                                               
PULX     DS    0H                                                               
         XIT1                                                                   
         LTORG                                                                  
*                                  WAS IN BILWRK MOVED HERE                     
         EJECT                                                                  
FMTOVER  CSECT                                                                  
         NMOD1 0,FMTOVER                                                        
         LA    RC,SPACEND                                                       
         LA    R5,OVERTAB                                                       
         L     RF,FULL                                                          
*                                                                               
FMTOV5   CLI   0(R5),X'FF'     END OF TABEL                                     
         BE    FMTOVX                                                           
         CLC   0(1,R5),0(RF)                                                    
         BE    FMTOV10                                                          
         LA    R5,9(R5)                                                         
         B     FMTOV5                                                           
*                                                                               
FMTOV10  MVC   FORMAT,1(R5)                                                     
         MVC   STRIP,7(R5)                                                      
         MVC   DOLNUM,8(R5)                                                     
         CLI   PEOVOPT,C'D'        DON'T SUBTRACT CD                            
         BE    FMTOV20                                                          
*                                                                               
         CLI   PEOVOPT,C'S'        SUBTRACT CD FROM STRIP-OFF                   
         BE    FMTOV12                                                          
*                                  IF 'Y', STILL DO THE OLD WAY                 
         L     RE,ADAGY                                                         
         CLI   PAGYPROF+14-PAGYREC(RE),C'0'                                     
         BNE   FMTOV20          NOT 0 MEANS SUBTRACT FOR STRIP                  
FMTOV12  CLI   STRIP,C'G'                                                       
         BNE   FMTOV15                                                          
         MVI   STRIP,C'1'       SET TO G-CD                                     
         B     FMTOV20                                                          
*                                                                               
FMTOV15  CLI   STRIP,C'N'                                                       
         BNE   FMTOV20                                                          
         MVI   STRIP,C'2'       SET TO N-CD                                     
*                                                                               
FMTOV20  MVI   TWOCOL,C'Y'        RECALULATE TWOCOL                             
         CLI   DOLNUM,3                                                         
         BNE   FMTOVX                                                           
         CLI   TYPNUM,2                                                         
         BL    FMTOVX                                                           
         MVI   TWOCOL,C'N'                                                      
*                                                                               
FMTOVX   XMOD1                                                                  
         SPACE 3                                                                
*                                                                               
OVERTAB  DC    C'1',C'YNNNNN',C'N',X'01'                                        
         DC    C'2',C'NYNNNN',C'G',X'01'                                        
         DC    C'3',C'YYNNNN',X'00',X'02'                                       
         DC    C'4',C'YNYYNN',C'N',X'03'                                        
         DC    C'5',C'NYYNYN',C'G',X'03'                                        
         DC    C'6',C'YYYNNN',X'00',X'03'                                       
         DC    C'7',C'YYNYNN',C'N',X'03'                                        
         DC    C'8',C'YYNNYN',C'G',X'03'                                        
         DC    C'9',C'YNYNYN',C'N',X'03'                                        
         DC    C'A',C'YNNYYN',C'N',X'03'                                        
         DC    C'B',C'YNYYNN',C'G',X'03'                                        
         DC    C'C',C'NYYNYN',C'N',X'03'                                        
         DC    C'D',C'YNYNNN',C'N',X'02'                                        
         DC    C'E',C'NYYNNN',C'G',X'02'                                        
         DC    X'FFFF'                                                          
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
FMGRALL  CSECT                                                                  
         NMOD1 0,FMGRALL                                                        
         LA    RC,SPACEND                                                       
         SPACE 2                                                                
         CLC   AESTBRK,AINVBRK     IF EST SEPARATE                              
         BH    FMGRA3                                                           
         GOTO1 ATSTRET             DO RETAIL TEST                               
         BNZ   FMGRAX                                                           
*                                                                               
FMGRA3   DS    0H                                                               
         OC    ALOWTOG,ALOWTOG                                                  
         BZ    *+12                                                             
         C     R3,ALOWTOG          TEST IF TO APPEAR                            
         BH    FMGRAX              NO                                           
*                                                                               
         MVC   0(3,R5),0(R6)       MOVE CODE                                    
*              READ REGION/DISTRICT FOR NAME                                    
*              THEN SAVE IT IN MGRNAMES                                         
         L     RF,PPFILEC                                                       
         USING PPFILED,RF                                                       
         XC    KEY,KEY                                                          
         MVC   KEY(7),PCLTREC                                                   
         OC    AMED,AMED           FOR MULTI-MEDIA REQ GET MEDIA                
         BZ    FMGRA3B             FROM AMED                                    
         L     R1,AMED                                                          
         MVC   KEY+2(1),0(R1)                                                   
FMGRA3B  OC    APGR1,APGR1           SEE IF DOING DIVISIONS                     
         BZ    FMGRA3C                                                          
         L     R1,APGR1                                                         
         MVC   KEY+7(3),0(R1)        SET DIVISION IN KEY                        
         B     FMGRA4                                                           
*        NOTE CAN NOT RELY ON PROPER DIVISION IN PDIVREC                        
*        SINCE I GET HERE BEFORE FPGR1 IF REG/DST IS 'S'                        
*        AND DIVISION IS 'T'                                                    
******   CLC   PDIVREC(3),KEY          BE SURE PDIVREC IS RIGHT AGY/MED         
******   BNE   FMGRA3C                 NO - MUST USE DIVISION FROM PRD          
******   CLC   PDIVREC+4(3),KEY+4      BE SURE PDIVREC IS RIGHT CLIENT          
******   BNE   FMGRA3C                 NO - MUST USE DIV FROM PRD               
******   MVC   KEY(10),PDIVREC     AGY/MED/CODE/CLT/DIV                         
******   OC    KEY(10),KEY                                                      
******   BNZ   FMGRA4                                                           
*                                                                               
FMGRA3C  DS    0H                                                               
*                                                                               
*      MUST READ PRD HERE TO GET DIVISION                                       
*                                                                               
         L     R4,APRD                                                          
         L     RF,ADCLT                                                         
         MVC   KEY(25),0(RF)                                                    
         OC    AMED,AMED           FOR MULTI-MEDIA REQ GET MEDIA                
         BZ    FMGRA3E             FROM AMED                                    
         L     RF,AMED                                                          
         MVC   KEY+2(1),0(RF)                                                   
*                                                                               
FMGRA3E  MVC   KEY+7(3),0(R4)      3 CHAR PRD CODE                              
         MVI   KEY+3,X'06'                                                      
         L     RF,ADPRD                                                         
         CLC   KEY(10),0(RF)       TEST ALREADY HAVE PRDREC                     
         BE    FMGRA3H                                                          
         GOTO1 HIGH                                                             
         CLC   KEY(10),KEYSAVE                                                  
         BE    FMGRA3F                                                          
         DC    H'0'               PRODUCT MUST BE ON FILE                       
*                                                                               
FMGRA3F  L     RF,ADPRD                                                         
         ST    RF,AREC                                                          
         GOTO1 GETPRT                                                           
*                                                                               
FMGRA3H  DS    0H                                                               
FMGRA3M  L     R1,ADPRD                                                         
         MVC   KEY(7),0(R1)                   IF NOTHING IN DIVREC              
         MVC   KEY+7(3),PPRDDIV-PPRDREC(R1)   USE DIV FROM PRD                  
*                                                                               
FMGRA4   MVI   KEY+3,X'04'         REGION                                       
         CLC   QPUB+1(3),=C'RD='   CHK FOR CLIENT OVERRIDE                      
         BNE   *+16                                                             
         MVC   KEY+4(3),QPUB+4     USE OVERRIDE CLIENT                          
         MVC   KEY+7(3),=C'000'                                                 
         MVC   KEY+10(3),0(R6)                                                  
         C     R6,AMGR1            SEE IF DOING REGIONS                         
         BE    FMGRA5                                                           
*              MUST BE DISTRICTS                                                
*                                                                               
         L     RF,PPFILEC          MUST RESET RF                                
         MVC   KEY(13),PREGREC     USE REGION REC                               
         CLC   QPUB+1(3),=C'RD='   CHK FOR CLIENT OVERRIDE                      
         BNE   *+16                                                             
         MVC   KEY+4(3),QPUB+4     USE OVERRIDE CLIENT                          
         MVC   KEY+7(3),=C'000'                                                 
         MVI   KEY+3,X'05'                                                      
         MVC   KEY+13(3),0(R6)     DISTRICTS                                    
FMGRA5   GOTO1 HIGH                                                             
         C     R6,AMGR1                                                         
         BNE   FMGRA8                                                           
         CLC   KEY(13),KEYSAVE                                                  
         BE    FMGRA7                                                           
         CLC   KEYSAVE+10(3),=C'999'                                            
         BE    FMGRA7                                                           
         DC    H'0'                REGION NOT FOUND                             
*                                                                               
FMGRA7   GOTO1 GETREG                                                           
         L     RF,PPFILEC                                                       
         MVC   MGR1NM(20),PREGNAME                                              
         B     FMGRA15                                                          
*                                                                               
FMGRA8   C     R6,AMGR2                                                         
         BNE   FMGRA10                                                          
         CLC   KEY(16),KEYSAVE                                                  
         BE    FMGRA9                                                           
         CLC   KEYSAVE+13(3),=C'999'                                            
         BE    FMGRA9                                                           
         DC    H'0'                DISTRICT NOT FOUND                           
*                                                                               
FMGRA9   GOTO1 GETDIST                                                          
         L     RF,PPFILEC                                                       
         MVC   MGR2NM(20),PDSTNAME                                              
         B     FMGRA15                                                          
*                                                                               
         DROP  RF                                                               
*                                                                               
FMGRA10  B     FMGRAX                                                           
*                                                                               
FMGRA15  DS    0H                                                               
         C     R3,APAGBRK          TEST MGR 'HIGHER' THAN PAGE BRK              
         BNH   FMGRA18             YES                                          
*                                  MGR 'TOGETHER'                               
         CLC   P1,SPACES                                                        
         BE    FMGRA17                                                          
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
*                                                                               
FMGRA17  DS    0H                                                               
         OC    18(24,R5),SPACES                                                 
         CLC   ALOWTOG,AHITOG                                                   
         BNE   FMGRA17B                                                         
*                                  IS ONLY TOGETHER                             
         MVC   P1(5),0(R5)                                                      
         CLI   TWOCOL,C'Y'                                                      
         BNE   *+14                                                             
         MVC   P1+6(24),18(R5)                                                  
         B     FMGRA10                                                          
         GOTO1 ACHOPPER,DMCB,(24,18(R5)),(14,P1+6),(C'P',2)                     
         B     FMGRA10                                                          
FMGRA17B  DS    0H                                                              
         MVC   P1(12),6(R5)        DESC                                         
         LA    RF,P1+12                                                         
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         MVC   2(5,RF),0(R5)       NUMBER                                       
*                                                                               
         CLI   TWOCOL,C'Y'                                                      
         BNE   *+14                                                             
         MVC   P2(24),18(R5)                                                    
         B     FMGR17D                                                          
         GOTO1 ACHOPPER,DMCB,(24,18(R5)),(20,P2),(C'P',2)                       
FMGR17D  DS    0H                                                               
         C     R3,ALOWTOG                                                       
         BE    *+8                                                              
         BAS   RE,FMULINE                                                       
         B     FMGRA20                                                          
*                                  MGR IN HEADS                                 
FMGRA18  DS    0H                                                               
FMGRA20  DS    0H                                                               
**EDI**                                                                         
         GOTO1 ABILLEDI,DMCB,('EDMMGR',0)    EDI CALL                           
**EDI**                                                                         
         B     FMGRAX                                                           
*                                                                               
FMGRAX   DS    0H                                                               
         XMOD1                                                                  
*        UNDERLINE FIRST BLANK LINE                                             
FMULINE  NTR1                                                                   
*                                  FIND FIRST BLANK LINE                        
         LA    R3,P1                                                            
         SR    RE,RE                                                            
FMUL2    DS    0H                                                               
         OC    0(40,R3),SPACES                                                  
         CLC   0(40,R3),SPACES                                                  
         BE    FMUL4                                                            
         LA    R3,132(R3)                                                       
         LA    RE,1(RE)                                                         
         B     FMUL2                                                            
*                                                                               
FMUL4    DS    0H                                                               
         LTR   RE,RE                                                            
         BNP   FMULX                                                            
*                                                                               
         LA    RF,P1+40                                                         
FMUL5    DS    0H                                                               
         LR    R1,RF                                                            
         LR    R0,RE                                                            
FMUL6    DS    0H                                                               
         CLI   0(R1),C' '                                                       
         BH    FMUL8               FIRST NON-BLACK CHAR                         
         LA    R1,132(R1)                                                       
         BCT   R0,FMUL6                                                         
*                                                                               
         BCT   RF,FMUL5                                                         
*                                                                               
FMUL8    DS    0H                                                               
         LA    R0,P1                                                            
         SR    RF,R0                                                            
         BM    FMULX                                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),DASHES                                                   
*                                                                               
FMULX    DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
         LTORG                                                                  
SETR     CSECT                                                                  
         NMOD1 0,SETR                                                           
         LA    RC,SPACEND                                                       
         SPACE 2                                                                
         MVI   CORPZ,C'N'          CLEAR CORP INV IND                           
         L     R4,AGDAREA                                                       
         USING GDSECT,R4                                                        
         MVC   GDCLUST,SPACES                                                   
         CLI   GDMGRLEN,0                                                       
         BE    SR4                                                              
         CLI   RETPROF+14,C'*'     TEST PSEUDO MGR (ACCT PREFIX)                
         BNH   SR3                                                              
         MVC   GDMGR(1),RETPROF+14                                              
         B     SR4                                                              
SR3      DS    0H                                                               
         CLI   SVREGLEN,0                                                       
         BE    SR3D               NO REGION                                     
         ZIC   RF,SVREGLEN                                                      
         ZIC   RE,MGR1LEN                                                       
         SR    RE,RF                                                            
         BNM   *+6                                                              
         SR    RE,RE                                                            
         A     RE,AMGR1            USE LAST 'GDMGRLEN' POSITIONS                
         BCTR  RF,R0                                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   GDMGR(0),0(RE)                                                   
SR3D     CLI   SVDSTLEN,0                                                       
         BE    SR4                 NO DISTRICT                                  
         ZIC   RF,SVDSTLEN                                                      
         ZIC   RE,MGR2LEN                                                       
         SR    RE,RF                                                            
         BNM   *+6                                                              
         SR    RE,RE                                                            
         A     RE,AMGR2            USE LAST 'GDMGRLEN' POSITIONS                
         BCTR  RF,R0                                                            
         LA    R6,GDMGR                                                         
         ZIC   R0,SVREGLEN                                                      
         AR    R6,R0                                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R6),0(RE)                                                    
*                                                                               
SR4      DS    0H                                                               
         CLI   GDMKTLEN,0                                                       
         BE    SR6                                                              
         L     RF,AMKT                                                          
         LH    R0,0(RF)                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  GDMKT,DUB                                                        
*                                                                               
SR6      DS    0H                                                               
         CLI   UPASS,C'S'                                                       
         BE    SR10                                                             
         MVI   GDOUTNO,0                                                        
         MVC   GDSCHM,SPACES                                                    
         GOTO1 AFINDOUT,DMCB,GDSECT                                             
*                                                                               
         MVI   UPASS,C'T'                                                       
         MVI   RETERR,0                                                         
         OC    GDNOUTS,GDNOUTS                                                  
         BNZ   SR10                                                             
         MVI   RETERR,1                                                         
         MVI   PRSW,C'N'                                                        
*                                                                               
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   P1(05),=C'** NO'                                                 
         MVC   P1(L'PP@NO),PP@NO                                                
         MVC   P1+6(15),GDOUTDSC                                                
*--->    MVC   P1+22(3),=C'FOR'                                                 
         MVC   P1+22(L'PP@FOR),PP@FOR                                           
         MVC   P1+26(15),GDMGRDSC                                               
         CLI   GDMKTLEN,0                                                       
         BE    *+10                                                             
         MVC   P1+26(15),GDMKTDSC                                               
         MVC   P1+42(6),GDMGR                                                   
         MVC   P1+49(2),GDMKT     *** NOT USED FOR PRINT                        
*                                                                               
*--->    MVC   P1+55(9),=C'(EST NNN)'                                           
         MVC   P1+55(L'PP@ESTN),PP@ESTN                                         
         DROP  RE                                                               
*                                                                               
         L     RF,AEST                                                          
         MVC   HALF,0(RF)                                                       
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P1+60(3),DUB                                                     
*                                                                               
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 APRNT                                                            
         MVC   PAGE,=H'1'                                                       
*                                                                               
SR10     DS    0H                                                               
         XMOD1                                                                  
*                                                                               
         LTORG                                                                  
         DROP  R4                                                               
         EJECT                                                                  
FSTPUB   CSECT                                                                  
         NMOD1 0,FSTPUB                                                         
         LA    RC,SPACEND                                                       
**PPNEW  L     RF,PPFILEC                                                       
**PPNEW  LA    R8,4095(RF)                                                      
**PPNEW  LA    R8,1(R8)                                                         
**PPNEW  USING PPFILED+4096,R8     NEEDED FOR PJOBREC                           
*                                                                               
         L     R8,PPFILEC          **PPNEW                                      
         USING PPFILED,R8          **PPNEW                                      
*                                                                               
         SPACE 2                                                                
         CLI   PUBCTL,C'N'                                                      
         BE    FPUBX                                                            
         MVC   WRKPMED,QMEDIA                                                   
         OC    AMED,AMED           FOR MULTI-MEDIA REQ GET MEDIA                
         BZ    FPUB0               FROM AMED                                    
         L     RF,AMED                                                          
         MVC   WRKPMED,0(RF)                                                    
*                                                                               
FPUB0    DS    0H                                                               
         MVC   PPUBL1,SPACES                                                    
         MVC   PPUBL2,SPACES                                                    
         L     R4,APUB                                                          
         CLC   0(6,R4),XXPUB       SPECIAL FOR MANUAL BILLS                     
         BE    FPUBX               SPECIAL CODE FOR PREV BILLED                 
         CLC   0(6,R4),=X'FFFFFFFFFFFF'                                         
         BE    FPUBX               SPECIAL CODE FOR PREV BILLED                 
*                                  INSERTIONS FOR ALL PUBS                      
*                                  DON'T PRINT ANYTHING                         
*                                                                               
**                                                                              
*        READ PUB HERE                                                          
*                                                                               
         CLI   NOZEOPT,C'Y'        SEE IF SUPPRESSING ZONE/EDITION              
         BE    FPUB1                                                            
*        MUST SEARCH FOR FIRST MATCH ON BASE NUMBER                             
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(1),WRKPMED                                                   
         MVC   KEY+1(6),0(R4)                                                   
         MVC   KEY+7(2),QAGENCY                                                 
         MVI   KEY+9,X'81'                                                      
         GOTO1 HIGHPUB                                                          
         CLC   KEY(25),KEYSAVE                                                  
         BE    FPUB2                                                            
         L     RF,ADAGY                                                         
         CLI   PAGYPROF+16-PAGYREC(RF),C'0'   SEE IF I SHOULD LOOK              
         BE    FPUB1S              FOR DEFALUT                                  
         MVC   KEYSAVE+7(2),=C'ZZ' TEST ALREADY FOUND DEFAULT                   
         CLC   KEYSAVE(25),KEY                                                  
         BE    FPUB2                LOOK FOR DEFAULT                            
         B     FPUB1S                                                           
*                                                                               
*         I GET HERE IF SUPPRESSING ZONE/EDITION                                
*         (NOZEOPT=Y)                                                           
*                                                                               
FPUB1    DS    0H         LOOK FOR FIRST THAT MATCHES BASE NUMBER               
         XC    KEY,KEY                                                          
         MVC   KEY(1),WRKPMED                                                   
         MVC   KEY+1(4),0(R4)       BASE PUB -                                  
         MVC   KEY+7(2),QAGENCY                                                 
         MVI   KEY+9,X'81'                                                      
         GOTO1 HIGHPUB                                                          
         B     FPUB1C                                                           
*                                                                               
FPUB1B   GOTO1 SEQPUB                                                           
*                                                                               
FPUB1C   CLC   KEY(25),KEYSAVE                                                  
         BE    FPUB2                                                            
         CLC   KEY(5),KEYSAVE      CHECK FOR RIGHT BASE                         
         BNE   FPUB1G                                                           
         CLC   KEY+7(2),QAGENCY    CHECK RIGHT AGENCY                           
         BE    FPUB2               READ IT                                      
         L     RF,ADAGY                                                         
         CLI   PAGYPROF+16-PAGYREC(RF),C'0'  SEE IF USING DEFAULT               
         BE    FPUB1B              NO - DO SEQ READ                             
         CLC   KEY+7(2),=C'ZZ'                                                  
         BE    FPUB2               FOUND DEFAULT - READ IT                      
         B     FPUB1B              NO - KEEP LOOKING                            
*                                                                               
FPUB1G   DC    H'0'   CAN'T FIND ANY PUB FOR THIS NUMBER                        
*                     FOR MY AGENCY OR ZZ (IF APPLICABLE)                       
*                                                                               
FPUB1S   MVC   KEY,KEYSAVE    TRY TO READ MY PUB OR DEFAULT                     
         GOTO1 READPUB        WILL GET DATAMGR ERROR IF NOT FOUND               
*                                                                               
FPUB2    GOTO1 GETNAME             READ PUBREC                                  
*                                                                               
         L     RF,ADPUB                                                         
         MVC   PPUBL1(20),PUBNAME-PUBREC(RF)                                    
*                                                                               
         CLI   WRKPMED,C'O'        SEE IF OUTDOOR                               
         BNE   FPUB2B                                                           
         CLI   MKTCTL,0            SEE IF SHOWING MARKET                        
         BE    FPUB2B              NO - THEN SHOW HERE                          
         CLI   MKTCTL,C'N'         SEE IF SHOWING MARKET                        
         BE    FPUB2B              NO - THEN SHOW HERE                          
         B     FPUB3               MKT WILL BE SEPERATE LINE                    
*                                                                               
FPUB2B   DS    0H                                                               
         CLI   NOZEOPT,C'Y'  NO ZONE/MKT IF SUPPRESSING ZONE/EDIT               
         BE    *+10                                                             
         MVC   PPUBL2(20),PUBZNAME-PUBREC(RF)                                   
*                                                                               
         CLI   WRKPMED,C'N'                                                     
         BNE   FPUB3                                                            
         CLI   MKTCTL,0           SEE IF SHOWING MARKET                         
         BE    FPUB2C                                                           
         CLI   MKTCTL,C'N'        SEE IF SHOWING MARKET                         
         BE    FPUB2C                                                           
         B     FPUB3                                                            
*                                                                               
FPUB2C   CLI   PUBCITY-PUBREC(RF),C' '                                          
         BE    FPUB3                                                            
         CLI   PUBSTATE-PUBREC(RF),C' '                                         
         BNH   FPUB3                                                            
         MVC   PPUBL1,SPACES                                                    
         MVC   PPUBL1(2),PUBSTATE-PUBREC(RF)                                    
         MVI   PPUBL1+2,C','                                                    
         MVC   PPUBL1+3(16),PUBCITY-PUBREC(RF)                                  
         LA    R5,PPUBL1+20                                                     
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
         LA    R5,3(R5)                                                         
         MVC   0(20,R5),PUBNAME-PUBREC(RF)                                      
*                                                                               
FPUB3    L     RF,ADAGY                                                         
         IC    R5,PAGYPROF+12-PAGYREC(RF)                                       
         LA    R6,PPUBL1+40                                                     
FPUB3A   CLI   0(R6),C' '                                                       
         BH    FPUB3B                                                           
         BCTR  R6,0                                                             
         B     FPUB3A                                                           
*                                                                               
FPUB3B   LA    R6,2(R6)                                                         
         GOTO1 PUBEDIT,DMCB,((R5),0(R4)),1(R6)                                  
         MVI   0(R6),C'('                                                       
         LA    R5,PPUBL1+58                                                     
FPUB3E   CLI   0(R5),C' '                                                       
         BH    FPUB3F                                                           
         BCTR  R5,0                                                             
         B     FPUB3E                                                           
*                                                                               
FPUB3F   MVI   1(R5),C')'                                                       
*                                                                               
*                                                                               
FPUB4M   DS    0H                                                               
         OC    PPUBL1,SPACES                                                    
         OC    PPUBL2,SPACES                                                    
         C     R3,ALOWTOG                                                       
         BH    FPUBX               SKIP IF LOWEST TOG OR NOT TO APPEAR          
**NEW 5/5/89                       WAS BNL                                      
***NO-OP                                                                        
*******  C     R3,APAGBRK          TEST PUB 'HIGHER' THAN PAGE BRK              
*******  BNH   FPUB8               YES                                          
*                                  PUB TOGETHER (WITH INS DETAILS)              
         CLC   P1,SPACES                                                        
         BE    FPUB5                                                            
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
*                                                                               
FPUB5    DS    0H                                                               
         MVC   P1+0(60),PPUBL1                                                  
         MVC   P2+0(20),PPUBL2                                                  
**NEW 1/20/89                                                                   
         CLI   PUBCTL,C'S'          SEE IF PUB SEPERATE                         
         BNE   FPUB8                                                            
         MVC   P1+0(60),SPACES                                                  
         MVC   P2+0(20),SPACES      DON'T PUT PUB IN P1 AND P2                  
*                                    WILL BE DONE AT RB16J                      
*                                                                               
FPUB8    DS    0H                                                               
**EDI**                                                                         
         GOTO1 ABILLEDI,DMCB,('EDMPUB',0)   EDI CALL                            
**EDI**                                                                         
*                                                                               
FPUBX    DS    0H                                                               
         XMOD1                                                                  
*                                                                               
WRKPMED  DC    C' '                                                             
*                                                                               
         LTORG                                                                  
         TITLE 'FIRST FOR JOB ROUTINE'                                          
JOBFRST  CSECT                                                                  
         NMOD1 0,JOBFRST                                                        
         LA    RC,SPACEND                                                       
**PPNEW  L     RF,PPFILEC                                                       
**PPNEW  LA    R8,4095(RF)                                                      
**PPNEW  LA    R8,1(R8)                                                         
**PPNEW  USING PPFILED+4096,R8     NEEDED FOR PJOBREC                           
*                                                                               
         L     R8,PPFILEC          **PPNEW                                      
         USING PPFILED,R8          **PPNEW                                      
*                                                                               
         CLI   JOBCTL,C'N'         SEE IF NOT SHOWING JOB                       
         BE    FJOBX                                                            
         CLI   JOBCTL,0            SEE IF NOT SHOWING JOB                       
         BE    FJOBX                                                            
*                                                                               
         MVC   JOBL1,SPACES                                                     
         MVC   JOBL2,SPACES                                                     
         MVC   JOBL3,SPACES                                                     
         MVC   JOBL4,SPACES                                                     
         MVC   JOBL5,SPACES                                                     
*                                                                               
         L     RF,AJADDRS          CLEAR JOB - REP ADDRESS                      
         MVC   0(132,RF),SPACES                                                 
         MVC   132(ADDRLEN-132,RF),SPACES                                       
*                                                                               
*                                                                               
FJOB5    DS    0H                                                               
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   JOBL1+0(8),=C'AD CODE='                                          
         MVC   JOBL1+0(L'PP@ADCOD),PP@ADCOD                                     
         L     RF,AJOB                                                          
         MVC   JOBL1+8(6),3(RF)    PAST PRD                                     
         CLI   0(RF),X'FF'         FOR NO AD CODE                               
         BNE   FJOB8                                                            
*--->    MVC   JOBL1+8(6),=C'*NONE*'                                            
         MVC   JOBL1+8(L'PP@NONE),PP@NONE                                       
         DROP  RE                                                               
FJOB8    DS    0H                                                               
         LA    RF,JOBL1+8+6                                                     
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         LA    R0,JOBL1+8                                                       
         SR    RF,R0                                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   JOBL2+8(0),DASHES                                                
*                                                                               
         L     RF,AJOB                                                          
         CLI   0(RF),X'FF'                                                      
         BE    FJOB19              NO JOB                                       
         XC    WORK(25),WORK                                                    
         L     RF,ADCLT                                                         
         MVC   WORK(7),0(RF)       AGY/MED/CODE/CLT                             
         OC    AMED,AMED           FOR MULTI-MEDIA REQ GET MEDIA                
         BZ    FJOB8B              FROM AMED                                    
         L     RF,AMED                                                          
         MVC   WORK+2(1),0(RF)                                                  
*                                                                               
FJOB8B   MVI   WORK+3,X'15'                                                     
         L     RF,AJOB                                                          
         MVC   WORK+7(9),0(RF)      HAS PRD AND JOB                             
         CLC   PJOBREC(25),WORK                                                 
         BE    FJOB18CX                                                         
         MVC   JSAVKEY,KEY                                                      
         MVC   KEY(25),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
         CLC   KEY(25),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         GOTO1 GETJOB                                                           
*                                                                               
         MVC   KEY,JSAVKEY                                                      
         GOTO1 HIGH                                                             
*                                                                               
FJOB18CX DS    0H                                                               
         CLI   JOBOPT,C'N'            NO JOB INFO                               
         BE    FJOB18H                                                          
         CLI   JOBOPT,C'A'            OR AD NUMBER ONLY                         
         BE    FJOB18H                                                          
         MVC   JOBL2(20),SPACES    BLANK OUT UNDERLINING                        
         TM    JOBOPT,X'30'                                                     
         BZ    FJOB18D                                                          
*                                       COPY NO.                                
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   JOBL2+0(6),=C'COPY ='                                            
         MVC   JOBL2+0(L'PP@COPY),PP@COPY                                       
         DROP  RE                                                               
         MVC   JOBL2+7(17),PJOBCPY                                              
         MVI   SPACING,2                                                        
         B     FJOB18F                                                          
*                                       AD. NO.                                 
FJOB18D  DS    0H                                                               
*                                                                               
FJOB18F  DS    0H                                                               
*                                                                               
         TM    JOBOPT,X'02'                                                     
         BZ    FJOB18H                                                          
         LA    R2,JOBL2                                                         
         LA    R1,JOBL3                                                         
         CLC   0(15,R2),SPACES                                                  
         BE    FJOB18G                                                          
         LA    R2,JOBL3                                                         
         LA    R1,JOBL4                                                         
*                                  CAPTION                                      
FJOB18G  MVC   0(25,R2),PJOBCAP1                                                
         MVC   0(25,R1),PJOBCAP2                                                
         MVI   SPACING,2                                                        
*                                                                               
FJOB18H  DS    0H                                                               
         OC    PJOBBLCC,PJOBBLCC        BILLING CONTACT                         
         BZ    FJOB18M                                                          
         LA    R2,JOBL3                                                         
         CLC   0(15,R2),SPACES                                                  
         BE    FJOB18I                                                          
         LA    R2,JOBL4                                                         
         CLC   0(15,R2),SPACES                                                  
         BE    FJOB18I                                                          
         LA    R2,JOBL5                                                         
FJOB18I  MVC   0(30,R2),PJOBBLCC                                                
         MVI   SPACING,2                                                        
*                                                                               
FJOB18M  DS    0H                 CHECK FOR BILLING REP                         
         CLI   PJOBBREP,C' '                                                    
         BNH   FJOB19                                                           
*                                                                               
*                                 READ REP AND SET ADDRESS                      
*                                 INTO JADDRS                                   
         MVC   JSAVKEY,KEY                                                      
         XC    KEY,KEY                                                          
         MVC   KEY(3),WORK        AGY,MED                                       
         MVI   KEY+3,X'11'                                                      
         MVC   KEY+4(4),PJOBBREP                                                
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   KEY(25),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'               MUST FIND REP                                 
         LA    R0,PREPREC                                                       
         ST    R0,AREC                                                          
         GOTO1 GETPRT                                                           
*                                                                               
         MVC   KEY,JSAVKEY                                                      
         GOTO1 HIGH                                                             
*                                                                               
         L     RF,AJADDRS                                                       
         MVC   0(30,RF),PREPNAME                                                
         MVC   36(30,RF),PREPLIN1                                               
         MVC   72(30,RF),PREPLIN2                                               
         LA    RE,108(RF)                                                       
         OC    PREPATTN,PREPATTN     SEE IF I HAVE AN ATTENTION                 
         BZ    FJOB18P                                                          
         MVC   108(5,RF),=C'ATTN:'                                              
         MVC   114(20,RF),PREPATTN                                              
         LA    RE,144(RF)                                                       
*                                                                               
FJOB18P  OC    PJOBBLCC,PJOBBLCC    SEE IF I HAVE A BILLING CONTACT             
         BZ    *+10                                                             
         MVC   0(30,RE),PJOBBLCC                                                
*                                                                               
         DROP  R8                                                               
*                                  PREVIOUS BILLING                             
FJOB19   DS    0H                                                               
         C     R3,ALOWTOG                                                       
         BH    FJOBX                                                            
**NEW 5/5/89                      WAS BNL                                       
         CLC   P1,SPACES                                                        
         BE    FJOB25                                                           
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
FJOB25   MVC   P1(25),JOBL1                                                     
         MVC   P2(25),JOBL2                                                     
         MVC   P3(30),JOBL3                                                     
         MVC   P4(30),JOBL4                                                     
         MVC   P5(30),JOBL5                                                     
         IF    JOBCTL,NE,C'S',OR,PUBCTL,NE,C'S',FJOB25X                         
*                                  IF PUB AND JOB CLTS ARE BOTH                 
*                                  'S' THEN DON'T PUT JOBLINES IN P1            
         MVC   P1(25),SPACES                                                    
         MVC   P2(25),SPACES                                                    
         MVC   P3(30),SPACES                                                    
         MVC   P4(30),SPACES                                                    
         MVC   P5(30),SPACES                                                    
**EDI**                                                                         
FJOB25X  DS    0H                                                               
         GOTO1 ABILLEDI,DMCB,('EDMJOB',0)     EDI CALL                          
**EDI**                                                                         
*                                                                               
FJOBX    DS    0H                                                               
         XMOD1                                                                  
*                                                                               
JSAVKEY  DS    CL32                                                             
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
         TITLE 'SPECIAL ROUTINE FOR LAST FOR DESCRIPTION'                       
LASTDSC  CSECT                                                                  
         NMOD1 0,LASTDSC                                                        
         LA    RC,SPACEND                                                       
         LA    R8,LASTDSC+4095                                                  
         LA    R8,1(R8)                                                         
         USING LASTDSC+4096,R8     R8 SECOND BASE REGISTER                      
         SPACE 2                                                                
         OC    ACTYP,ACTYP         CHECK IF HAVE A(SPECIAL CHAGE LEV)           
         BNZ   *+6                                         (*YKVA*)             
         DC    H'0'                NO, DIE FOR NOW (SHOULD NOT HAPPEN)          
         MVC   WRKMED,QMEDIA                                                    
         OC    AMED,AMED                                                        
         BZ    LDESC1                                                           
         L     RF,AMED                                                          
         MVC   WRKMED,0(RF)                                                     
*                                                                               
LDESC1   DS    0H                                                               
*                                                                               
         CLI   PASSNO,1            AND IF PASS 1                                
         BNE   LDESC4                                                           
*                                                                               
         L     RF,ADESC                                                         
         CLI   0(RF),X'FA'         TEST MANUAL RECORD                           
         BNH   LDESC2                                                           
         B     LDESC4                                                           
*                                                                               
LDESC2   DS    0H                                                               
*                                                                               
         CLI   UPASS,C'S'          IF RETAIL SUMMARY PASS                       
         BE    LDESCX                                                           
*                                                                               
         L     R7,BRKCODE                                                       
         L     R7,ATOTS(R7)        POINT TO ACCUM FOR THIS LEVEL                
         ST    R7,SAVR1            SAVE ADDRESS OF ACCUM                        
*                                  RE-WRITE RECORDS                             
         CLI   UPASS,1       FOR RETAIL ONLY RE-RWRITE RECS FOR CORP            
         BH    LDESC2D       SKIP TO TOTALING IN WORK                           
*                                                                               
         SPACE 2                                                                
*                                                                               
         L     R6,ASORTCOM         DISK ADDR IN COMMENT                         
         OC    0(4,R6),0(R6)       NO DA MEANS LINE IS TOTALLY BILLED           
         BZ    LDESC2X             (MAY BE MULTIPLE UNITS)                      
         MVC   KEY+27(4),0(R6)                                                  
         MVC   AREC,ADWKREC                                                     
         GOTO1 GETPRT                                                           
         L     R7,ADWKREC                                                       
         USING PBUYREC,R7                                                       
         LA    R2,PBDELEM                                                       
         MVI   ELCODE,X'30'                                                     
         TM    FINANSW,X'01'      SEE IF DOING FINANCIAL BILL                   
         BNO   LDESC2A            OLD STYLE OR RJ PALMER                        
         BAS   RE,NEXTEL                                                        
         BE    LDESC2AX                                                         
         DC    H'0'                NO FINANCIAL ELEM                            
*                                                                               
LDESC2A  BAS   RE,NEXTEL                                                        
         BNE   LDESC2AX                                                         
         DC    H'0'            FINANCIAL ELEM ON NON-FINANCIAL BILL             
*                                                                               
LDESC2AX L     RF,APRD                                                          
         MVC   WPRD,0(RF)                                                       
*                                                                               
         CLI   MANRVDTP,0          IF A REVERSAL                                
         BE    LDESC2D                                                          
*                                  FIND ELEMS TO REVERSE                        
         LA    R2,PBDELEM                                                       
         MVI   ELCODE,X'26'        BILL ELEM                                    
***R***                                                                         
         CLC   QPROG,=C'R1'        FINANCIAL REBATE REVERSAL                    
         BNE   *+8                                                              
         MVI   ELCODE,X'29'                                                     
         CLC   QPROG,=C'RD'        FINANCIAL REBATE REVERSAL - DRAFT            
         BNE   *+8                                                              
         MVI   ELCODE,X'29'                                                     
***R***                                                                         
*                                                                               
LDESC2B  DS    0H                                                               
         BAS   RE,NEXTEL                                                        
         BNE   LDESC2C                                                          
*                                                                               
         USING PBILELEM,R2                                                      
         CLC   PBPRD,WPRD           SAVE WPRD                                   
         BNE   LDESC2B                                                          
*                                                                               
         L     R1,ACTYP                                                         
         CLI   1(R2),23            IF ADDIT CHG ELEM, LEN = 25                  
         BNH   *+18                                                             
         CLC   PBACCODE,0(R1)      IS IT SPECIAL CHG WE NEED?                   
         BNE   LDESC2B             NO, GET NEXT ELEM                            
         B     *+14                                                             
         OC    0(L'PBACCODE,R1),0(R1) DO WE HAVE SPEC CHARGE?                   
         BNZ   LDESC2B               YES, GET NEXT ELEM                         
*                                                                               
         CLC   PBLDATE,MANRVDTP   TEST ELEM FOR REVSRL DATE                     
         BNE   LDESC2B             NO-SKIP                                      
         CLC   PBINVNO,MANRVNO     TEST RIGHT INV NUMBER                        
         BNE   LDESC2B                                                          
         CLI   SCBNCSW,C'C'        UFC COMM BILLING                             
         BNE   LDESC2B5                                                         
         TM    PBBILST,X'01'       SEE IF RIGHT TYPE                            
         BZ    LDESC2B                                                          
         B     LDESC2B7                                                         
*                                                                               
LDESC2B5 DS    0H                                                               
         CLI   SCBNCSW,C'N'        UFC NET BILLING                              
         BNE   LDESC2B7                                                         
         TM    PBBILST,X'02'       SEE IF RIGHT TYPE                            
         BZ    LDESC2B                                                          
*                                                                               
LDESC2B7 OI    PBBILST,X'80'       SET REVERSED                                 
         B     LDESC2B             NEXT ELEM                                    
*                                                                               
LDESC2C  DS    0H                                                               
         CLI   FINANSW,0           FOR FINANCIAL CLIENTS REVERSE                
         BE    LDESC2D             OPEN BILLING ELEMS                           
***R***                                                                         
         CLC   QPROG,=C'R1'        UNLESS REBATE REVERSAL                       
         BE    LDESC2D                                                          
         CLC   QPROG,=C'RD'        UNLESS REBATE REVERSAL - DRAFT               
         BE    LDESC2D                                                          
***R***                                                                         
         LA    R2,PBDELEM                                                       
         MVI   ELCODE,X'28'        BILL ELEM                                    
*                                                                               
LDESC2C5 DS    0H                                                               
         BAS   RE,NEXTEL                                                        
         BNE   LDESC2D                                                          
*                                                                               
         USING PBILELEM,R2                                                      
         CLC   PBPRD,WPRD           SAVE WPRD                                   
         BNE   LDESC2C5                                                         
*                                                                               
         L     R1,ACTYP                                                         
         CLI   1(R2),23            IF ADDIT CHG ELEM, LEN = 25                  
         BNH   *+18                                                             
         CLC   PBACCODE,0(R1)      IS IT SPECIAL CHG WE NEED?                   
         BNE   LDESC2C5            NO, GET NEXT ELEM                            
         B     *+14                                                             
         OC    0(L'PBACCODE,R1),0(R1) DO WE HAVE SPEC CHARGE?                   
         BNZ   LDESC2C5               YES, GET NEXT ELEM                        
*                                                                               
         CLC   PBLDATE,MANRVDTP   TEST ELEM FOR REVSRL DATE                     
         BNE   LDESC2C5            NO-SKIP                                      
         CLC   PBINVNO,MANRVNO     TEST RIGHT INV NUMBER                        
         BNE   LDESC2C5                                                         
*                                                                               
         OI    PBBILST,X'80'       SET REVERSED                                 
         B     LDESC2C5            NEXT ELEM                                    
*                                  FIND WHERE TO PUT BILLING ELEMS              
LDESC2D  DS    0H                                                               
         MVI   BILLPASS,0       SET FOR FIRST BILL ELEM PASS                    
LDESC2D5 CLI   UPASS,1          SEE IF DOING RETAIL - ONLY                      
         BH    LDESC2G          ONLY REWRITE RECS FOR CORP PASS                 
*                                                                               
         MVI   BYTE,0                                                           
         L     R7,ADWKREC                                                       
         LA    R2,PBDELEM                                                       
         MVI   ELCODE,X'26'                                                     
***R***                                                                         
         CLC   QPROG,=C'R1'      FINANCIAL REBATE BILL                          
         BNE   *+8                                                              
         MVI   ELCODE,X'29'      SPECIAL BILL ELEM CODE                         
         CLC   QPROG,=C'RD'      FINANCIAL REBATE BILL DRAFT                    
         BNE   *+8                                                              
         MVI   ELCODE,X'29'      SPECIAL BILL ELEM CODE                         
***R***                                                                         
LDESC2D7 DS    0H                                                               
         CLI   BILLPASS,0        SEE IF DOING FIRST BILL ELEM PASS              
         BE    *+8                                                              
         MVI   ELCODE,X'28'                                                     
LDESC2E  BAS   RE,NEXTEL                                                        
         BE    LDESC2F                                                          
         B     LDESC2G                                                          
*                                                                               
LDESC2F  DS    0H                                                               
         CLI   1(R2),X'17'         IGNORE BAD ELEMS                             
         BNE   LDESC2E             FROM JWT CONVERSION                          
*                                                                               
         USING PBILELEM,R2                                                      
         L     R1,ACTYP                                                         
         CLI   1(R2),23            IF ADDIT CHG ELEM, LEN = 25                  
         BNH   *+18                                                             
         CLC   PBACCODE,0(R1)      IS IT SPECIAL CHG WE NEED?                   
         BNE   LDESC2E             NO, GET NEXT ELEM                            
         B     *+14                                                             
         OC    0(L'PBACCODE,R1),0(R1) DO WE HAVE SPEC CHARGE?                   
         BNZ   LDESC2E                YES, GET NEXT ELEM                        
*                                                                               
         OC    5(3,R2),5(R2)       CHK FOR DATE                                 
         BZ    LDESC2F5                                                         
         CLC   QREGION(6),SPACES                                                
         BE    LDESC2E                                                          
*                                 FOR REG/DST BILLING                           
*                                 SUM ELEMS FOR MULTIPLE                        
*                                 REG/DST ASSIGNS                               
         CLC   5(3,R2),TODAYB                                                   
         BNE   LDESC2E                                                          
         CLC   2(3,R2),WPRD                                                     
         BNE   LDESC2E                                                          
         CLC   8(2,R2),INVNO                                                    
         BNE   LDESC2E                                                          
         MVI   BYTE,2             MEANS TO ADD TO EXISTING ELEM                 
         B     LDESC2G                                                          
LDESC2F5 MVI   BYTE,1                                                           
*                                                                               
LDESC2G  L     R5,SAVR1            START OF TOTALS                              
         AH    R5,=Y(MAXMOS*ROWL)                                               
*****    LA    R5,MAXMOS*ROWL(R5)  POINT TO TOTAL ROW                           
*                                                                               
         XC    WORK,WORK                                                        
*                                                                               
         CLI   BILLPASS,0                                                       
         BE    *+8                                                              
         LA    R5,ROWTL(R5)          OPEN GROSS,NET,CD                          
         L     R0,0(R5)                                                         
         S     R0,ROWHL(R5)                                                     
         ST    R0,WORK                                                          
         L     R0,4(R5)                                                         
         S     R0,ROWHL+4(R5)                                                   
         ST    R0,WORK+4                                                        
         L     R0,8(R5)                                                         
         S     R0,ROWHL+8(R5)                                                   
         ST    R0,WORK+8                                                        
*                                                                               
         OC    WORK(12),WORK        TEST ANYTHING BILLABLE                      
         BNZ   LDESC2G4            YES- PROCESS, ELSE SKIP                      
*                                                                               
***TAX   NOTE - CHECK ABOVE DOES NOT CATCH ONLY BILLABLE TAX                    
***TAX          THIS SHOULD NOT OCCUR SINCE THE TAX PCT.                        
***TAX          WILL NOT BE PERMITTED TO CHANGE ON BILLED INSERTIONS            
***TAX          ALSO THERE MAY BE DESCRIPANCIES DUE TO ROUNDING                 
*                                                                               
         CLI   FREEOPT,C'Y'         SEE IF BILLING FREE INSERTIONS              
         BNE   LDESC2IX                                                         
         L     RE,ADWKREC                                                       
         CLC   PBUYKDAT-PBUYREC(3,RE),=X'5C0901' MUST BE AFTER 9/1/92           
         BL    LDESC2IX                                                         
*                                                                               
*                           CHECK IF I HAVE BILLING ELEM WITH DATE              
*                           IF FOUND I CAN SKIP                                 
         ST    R2,SAVER2                                                        
*                                                                               
         L     R7,ADWKREC                                                       
         LA    R2,PBDELEM                                                       
         MVI   ELCODE,X'26'                                                     
***R***                                                                         
         CLC   QPROG,=C'R1'      FINANCIAL REBATE BILL                          
         BNE   *+8                                                              
         MVI   ELCODE,X'29'      SPECIAL BILL ELEM CODE                         
         CLC   QPROG,=C'RD'      FINANCIAL REBATE BILL DRAFT                    
         BNE   *+8                                                              
         MVI   ELCODE,X'29'      SPECIAL BILL ELEM CODE                         
***R***                                                                         
         CLI   BILLPASS,0        SEE IF DOING FIRST BILL ELEM PASS              
         BE    *+8                                                              
         MVI   ELCODE,X'28'                                                     
LDESC2G0 BAS   RE,NEXTEL                                                        
         BE    LDESC2G1                                                         
         B     LDESC2G2                                                         
*                                                                               
LDESC2G1 DS    0H                                                               
*                                                                               
         USING PBILELEM,R2                                                      
         L     R1,ACTYP                                                         
         CLI   1(R2),23            IF ADDIT CHG ELEM, LEN = 25                  
         BNH   *+18                                                             
         CLC   PBACCODE,0(R1)      IS IT SPECIAL CHG WE NEED?                   
         BNE   LDESC2G0            NO, GET NEXT ELEM                            
         B     *+14                                                             
         OC    0(L'PBACCODE,R1),0(R1) DO WE HAVE SPEC CHARGE?                   
         BNZ   LDESC2G0               YES, GET NEXT ELEM                        
*                                                                               
         CLC   2(3,R2),WPRD        SEE IF RIGHT PRODUCT                         
         BNE   LDESC2G0            NO - SKIP                                    
         OC    5(3,R2),5(R2)       CHECK FOR DATE                               
         BZ    LDESC2G2                                                         
         CLC   5(3,R2),EXDATE      SEE IF MATCHES IGNORE DATE                   
         BE    LDESC2G0            SKIP THIS ELEM                               
         TM    PBBILST,X'C0'       SKIP REVERSED AND REVERALS                   
         BNZ   LDESC2G0                                                         
         CLI   SCBNCSW,C'C'        UFC COMM BILLING                             
         BNE   *+16                                                             
         TM    PBBILST,X'01'       SEE IF RIGHT TYPE                            
         BZ    LDESC2G0                                                         
         B     LDESC2G3                                                         
*                                                                               
         CLI   SCBNCSW,C'N'         UFC NET BILLING                             
         BNE   LDESC2G3                                                         
         TM    PBBILST,X'02'        SEE IF RIGHT TYPE                           
         BZ    LDESC2G0                                                         
*                                                                               
*                                                                               
LDESC2G2 DS    0H                                                               
         L     R2,SAVER2                                                        
         B     LDESC2G4            MUST ADD BILLELEM WITH 0 DOLLARS             
*                                  SO I WON'T PROCESS AGAIN                     
*                                                                               
LDESC2G3 DS    0H                  DON'T ADD ELEMENT                            
         L     R2,SAVER2                                                        
         B     LDESC2IX            MUST STILL CHK OPEN BILLABLE                 
*                                                                               
*                                                                               
*                                                                               
LDESC2G4 CLI   UPASS,1        RETAIL - ONLY MARK REC ON CORP PASS               
         BH    LDESC2I            SKIP TO DBTOTS TOTALLING                      
*                                                                               
*                                                                               
         CLI   BYTE,1              SEE IF BILL ELEM ALREADY THERE               
         BE    LDESC2G5                                                         
         CLI   BYTE,2              SEE IF SUMMING TO EXISTING BILL ELEM         
         BNE   LDESC2H                                                          
LDESC2G5 LR    R4,R2                                                            
         B     LDESC2H5                                                         
LDESC2H  XC    X,X                                                              
         LA    R4,X                                                             
         USING PBILELEM,R4                                                      
LDESC2H5 MVC   PBILELEM(2),=X'2617' SET CODE AND LENGHT                         
***R***                                                                         
*                                                                               
         L     R1,ACTYP                                                         
         OC    0(L'PBACCODE,R1),0(R1) DO WE HAVE SPECIAL CHG?                   
         BZ    LDESC2H6            NO, NOTHING SPECIAL                          
         MVI   1(R4),X'19'         YES, BUMP UP LEN BY 2                        
         MVC   PBACCODE,0(R1)      PUT CHARGE CODE                              
*                                                                               
LDESC2H6 CLC   QPROG,=C'R1'        FINANCIAL REBATE REVERSAL                    
         BNE   *+8                                                              
         MVI   PBILELEM,X'29'                                                   
         CLC   QPROG,=C'RD'        FINANCIAL REBATE REVERSAL - DRAFT            
         BNE   *+8                                                              
         MVI   PBILELEM,X'29'                                                   
***R***                                                                         
LDESC2H7 CLI   BILLPASS,0                                                       
         BE    *+8                                                              
         MVI   PBILELEM,X'28'                                                   
*                                                                               
         CLI   BYTE,2              SEE IF SUMMING TO EXISTING ELEM              
         BNE   LDESC2H9                                                         
         L     R0,PBGROSS                                                       
         A     R0,WORK                                                          
         ST    R0,PBGROSS                                                       
         L     R0,WORK                                                          
         S     R0,WORK+4                                                        
         ST    R0,FULL                                                          
         L     R0,PBAGYCOM                                                      
         A     R0,FULL                                                          
         ST    R0,PBAGYCOM                                                      
         L     R0,PBCSHDSC                                                      
         A     R0,WORK+8                                                        
         ST    R0,PBCSHDSC                                                      
         B     LDESC2HX                                                         
LDESC2H9 MVC   PBLDATE,TODAYB                                                   
         MVC   PBPRD,WPRD                                                       
         MVC   PBINVNO,INVNO                                                    
         MVC   PBGROSS,WORK        GROSS                                        
         L     R0,WORK                                                          
         S     R0,WORK+4                                                        
         ST    R0,FULL                                                          
         MVC   PBAGYCOM,FULL       GROSS-NET = AC                               
         MVC   PBCSHDSC,WORK+8     CD                                           
LDESC2HX CLI   MANRVDTP,0          TEST REVERSAL                                
         BE    *+8                                                              
         OI    PBBILST,X'40'       SET REVERSAL ELEM                            
*                                                                               
         CLI   SCBNCSW,C'C'        UFC COMM BILLING                             
         BNE   *+8                                                              
         OI    PBBILST,X'01'                                                    
*                                                                               
         CLI   SCBNCSW,C'N'        UFC NET BILLING                              
         BNE   *+8                                                              
         OI    PBBILST,X'02'                                                    
*                                                                               
         CLI   BYTE,1              SEE IF ELEM ALREADY EXISTED                  
         BE    LDESC2I                                                          
         CLI   BYTE,2              SEE IF ELEM ALREADY EXISTED                  
         BE    LDESC2I                                                          
*                                                                               
         GOTO1 RECUP,DMCB,(1,PBUYREC),X,(R2)                                    
*                                                                               
*                                                                               
LDESC2I  CLI   BILLPASS,0       SEE IF DOING FIRST BILL ELEM PASS               
         BE    LDESC2I5                                                         
         B     LDESC2IX                                                         
*                                                                               
LDESC2I5 L     R0,DBTOTS           ADD TO OVERALL BILLED TOTALS                 
         A     R0,WORK             GROSS                                        
         ST    R0,DBTOTS                                                        
         L     R0,DBTOTS+4                                                      
         A     R0,WORK+4           NET                                          
         ST    R0,DBTOTS+4                                                      
         L     R0,DBTOTS+8                                                      
         A     R0,WORK+8           CD                                           
         ST    R0,DBTOTS+8                                                      
*                                                                               
LDESC2IX CLI   BILLPASS,1          SEE IF I ALREADY DID 2ND PASS                
         BE    LDESC2K                                                          
         CLI   FINANSW,0           SEE IF DOING FINANCIAL CLIENT                
         BE    LDESC2K                                                          
*                                                                               
         CLI   SCBNCSW,C'C'     SEE IF COMMISSION BILL                          
         BE    LDESC2K          THEN NO BILLPASS=1 EVEN IF FINANCIAL            
*                                                                               
***R***                                                                         
         CLC   QPROG,=C'R1'        NO OPEN ELEMS FOR REBATE BILL                
         BE    LDESC2K                                                          
         CLC   QPROG,=C'RD'    NO OPEN ELEMS FOR REBATE BILL - DRAFT            
         BE    LDESC2K                                                          
***R***                                                                         
         MVI   BILLPASS,1          SET TO DO OPEN ELEMS                         
         B     LDESC2D5                                                         
*                                                                               
LDESC2K  CLI   UPASS,1             RETAIL - CORP PASS                           
         BH    LDESC2X             NO - SKIP RE-WRITE OF BUYREC                 
*                                                                               
         CLI   TEST,C'T'           DONT WRITE IF TEST MODE                      
         BE    LDESC2KB                                                         
         CLI   RCWRITE,C'N'                                                     
         BE    LDESC2KB                                                         
         MVC   AREC,ADWKREC                                                     
         GOTO1 PUTPRT                                                           
LDESC2KB DS    0H                                                               
*                                                                               
         CLI   SORTTRCE,C'Y'       TEST TO DUMP RECORD                          
         BNE   LDESC2X                                                          
*                                                                               
         MVC   HALF,PBUYLEN                                                     
         LH    R5,HALF                                                          
         CH    R5,=H'858'                                                       
         BNH   *+8                                                              
         LH    R5,=H'858'                                                       
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   P1(19),=C'PRINTPAK BUY RECORD'                                   
         MVC   P1(L'PP@PBR),PP@PBR                                              
         DROP  RE                                                               
         GOTO1 HEXOUT,DMCB,KEY+27,P1+22,4,=C'N'                                 
         GOTO1 (RF),DMCB,PBUYREC,P2,(R5)                                        
         GOTO1 APRNT                                                            
*                                                                               
         DROP  R4                                                               
*                                                                               
LDESC2X  DS    0H                                                               
*                                                                               
LDESC4   DS    0H                                                               
         CLI   SPOTCTL,C'Y'                                                     
         BE    LDESC4A                                                          
         L     RF,ADESC                                                         
         CLI   0(RF),X'F9'                                                      
         BH    LDESC7B             MAY STILL NEED TO MARK MANUAL BILLS          
         B     LDESCX                                                           
*                                                                               
LDESC4A  L     RF,ADESC                                                         
         CLI   0(RF),X'FA'         SKIP PREV UNITS                              
         BNE   LDESC4B                                                          
         CLI   ZUOPT,C'C'          UNLESS COMBINING                             
         BE    LDESC4B                                                          
         CLI   ZUOPT,C'P'          OR COMBINING ACROSS PUBS                     
         BE    LDESC4B                                                          
         CLC   P1(20),SPACES        ELSE CLEAR PRINT ANY RESIDUE                
         BE    LDESCX                                                           
         GOTO1 APRNT                                                            
         B     LDESCX                                                           
*                                                                               
LDESC4B  DS    0H                                                               
         CLI   0(RF),X'FB'         SKIP CURRENT MANUAL                          
         BE    LDESCX                                                           
*                                                                               
         CLI   0(RF),X'FC'         DONT SET ON ACTIVITY SWS                     
         BE    LDESC4C             FOR PREVIOUS MANUAL                          
*                                                                               
         MVI   PUBACTSW,C'Y'      SET ON ACTIVITY SWITCHES                      
         MVI   JOBACTSW,C'Y'      SET ON ACTIVITY SWITCHES                      
*                                                                               
LDESC4C  DS    0H                                                               
         CLI   0(RF),X'F9'                                                      
         BH    LDESC7B                                                          
         L     RE,ASORTCOM                                                      
         OC    0(4,RE),0(RE)       CHK FOR DISK ADDR                            
         BZ    LDESC7B                                                          
***                                                                             
         OC    ARECAP,ARECAP       SEE IF DOING RECAP PASS                      
         BNZ   LDESC4D                                                          
         CLI   NOINSSW,C'Y'        SEE IF NOT SHOWING INS DETAIL                
         BE    LDESCX              ON MAIN BILL                                 
*                                  SEE IF I MUST PRINT PUB NOW                  
***                                                                             
LDESC4D  MVC   KEY+27(4),0(RE)                                                  
*                                                                               
         CLC   P1(20),SPACES                                                    
         BE    LDESC4E                                                          
         GOTO1 APRNT                                                            
LDESC4E  DS    0H                                                               
         MVC   AREC,ADWKREC        USE WKREC NOT BUYREC                         
         GOTO1 GETPRT              READ BUY FOR DESC AND COMMENTS               
*                                                                               
         L     R7,ADWKREC                                                       
         USING PBUYREC,R7                                                       
LDESC4F  CLI   WRKMED,C'N'          NEED GETINS FOR NEWSPAPERS                  
         BE    LDESC4F5                                                         
****R***                                                                        
         CLC   QPROG,=C'R1'        FOR REBATE BILLING NEED GROSS                
         BE    LDESC4F5                                                         
         CLC   QPROG,=C'RD'  FOR REBATE BILLING DRAFT NEED GROSS                
         BNE   LDESC4G                                                          
LDESC4F5 XC    W(70),W             USE FOR PVALUES                              
         GOTO1 GETINS,DMCB,PBUYREC,W,PBUYKPRD                                   
*                                                                               
LDESC4G  L     R6,APPBYOWK                                                      
         USING PPBYOUTD,R6                                                      
         MVC   PBYOINPT,ADWKREC                                                 
         MVC   PBYODTCN,DATCON                                                  
         LA    R0,W                                                             
         ST    R0,PBYOVALS                                                      
         MVI   PBYOCTL,X'28'                                                    
         L     RE,ADAGY                                                         
         CLI   PAGYPROF+1-PAGYREC(RE),C'L'    LINE NUMBER CONTROL               
         BE    *+8                                                              
         OI    PBYOCTL,X'02'       SUPPRESS LINE NUMBER                         
*                                                                               
         MVC   SVCTYP,PBDCTYP      SAVE REAL COST TYPE                          
         CLI   PROFB2B+11,C'Y'     SEE IF NEWSPAPER UNIT RATES                  
         BNE   LDESC4G0                                                         
         CLI   PBUYKMED,C'N'       SEE IF NEWSPAPERS                            
         BNE   LDESC4G0                                                         
         OI    PBYOCTL,X'01'       UNIT RATES AT NET                            
         MVI   PBDCTYP,C'N'        FOOL PPBYOUT                                 
*                                                                               
LDESC4G0 DS    0H                                                               
         GOTO1 PPBYOUT,DMCB,PPBYOUTD                                            
         MVC   PBDCTYP,SVCTYP       RESTORE REAL COST TYPE                      
         MVC   MYOUR,SPACES                                                     
         MVC   MYOUR(8),PBYOUR                                                  
         CLI   PROFB2B+11,C'Y'    SEE IF SHOWING UNIT RATES AT NEW              
         BNE   LD20                                                             
         CLC   PBYOUR,SPACES                                                    
         BE    LD20                                                             
         MVC   MYOUR+1(8),PBYOUR                                                
         MVI   MYOUR,C' '                                                       
         LA    R1,MYOUR+5        DOESN'T LOOK RIGHT BUT IS                      
*                                SINCE UNIT RATES WILL ALWAYS                   
*                                NOT HAVE A SPACE HERE                          
LD15     CLI   0(R1),C' '                                                       
         BNH   LD18                                                             
         BCT   R1,LD15                                                          
*                                                                               
LD18     MVI   0(R1),C'N'         FLOAT "N" BEFORE RATE                         
LD20     DS    0H                                                               
**                                                                              
*                                                                               
         L     R2,ACTYP           POINT TO SPECIAL CHG IN SORTREC               
         OC    0(2,R2),0(R2)      DO WE HAVE A SPECIAL CHARGE ?                 
         BZ    LD30                                                             
*                                                                               
         L     RE,ASORTCOM                                                      
         CLC   SVDA,0(RE)                                                       
         BE    LD23                                                             
         MVC   SVDA,0(RE)          SAVE DA FOR NEXT PASS                        
         MVC   P1(11),PBYOMDY                                                   
         MVI   PRSW,C'F'           FLUSH PRINT LINES                            
         GOTO1 APRNT                                                            
*                                                                               
LD23     GOTO1 =V(PPGETCG),DMCB,PBUYREC,DATAMGR                                 
         CLI   0(R1),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         ZIC   R0,0(R1)            GET NUMBER OF LINES (SPEC. CHGS)             
         L     R4,0(R1)            GET ADDRESS OF OUTPUT BLOCK                  
         USING ADDCHGD,R4                                                       
LD25     CLC   ADCCOD1,0(R2)       FIND THE RIGHT CHARGE                        
         BE    *+14                                                             
         LA    R4,ADCLNLEN(R4)     BUMP TO NEXT ROW                             
         BCT   R0,LD25                                                          
         DC    H'0'                CHARGE HAS TO BE THERE !                     
         MVC   P1+2(L'ADCCOD1+1+L'ADCDES1),0(R4)                                
         GOTO1 APRNT                                                            
         B     LDESC8                                                           
         DROP  R4                                                               
*                                                                               
*********   SPECIAL FOR DOREMUS TRADE (PRODUCTION CHARGES)                      
*********   SUPPRESS INSERTION DATE                                             
*********                                                                       
*                                                                               
LD30     L     RE,ASORTCOM                                                      
         MVC   SVDA,0(RE)          SAVE DA FOR NEXT PASS                        
         MVC   P1(11),PBYOMDY                                                   
         MVC   P2+1(8),PBYOMDY2                                                 
*                                                                               
         CLC   QAGENCY,=C'DM'                                                   
         BNE   LDEC4G2                                                          
         CLI   WRKMED,C'T'                                                      
         BNE   LDEC4G2                                                          
*                                                                               
         MVC   P1(11),SPACES                                                    
         MVC   P2+1(8),SPACES                                                   
*                                                                               
LDEC4G2  DS    0H                                                               
         CLI   ORDSW,C'Y'          SEE IF SHOWING ORDERED                       
         BE    LDESC4G8            YES THEN USE OLD SPACE DISPLAY               
         CLI   TWOCOL,C'Y'         OR IF I HAVE 2 COLUMNS                       
         BE    LDESC4G8                                                         
*                                                                               
         CLI   ORDSW+1,C'Y'        SEE IF SHOWING PREV BILLING                  
         BNE   LDESC4G8            NO THEN CAN STILL USE OLD                    
         CLI   WRKMED,C'N'                                                      
         BNE   LDESC4G8                                                         
         MVC   P1+12(11),PBYOSPC                                                
         CLI   PBYOSPC,C' '                                                     
         BH    *+10                                                             
         MVC   P1+12(7),PBYOUNTS                                                
         CLI   FINANSW,1            IF FINANCIAL CLIENT                         
         BNE   LDESC4G4             DISPLAY OPEN RATE                           
*                                  NOTE - ONLY "OLD" STYLE FINANCIAL            
*                                  BILLING DISPLAYS OPEN RATES                  
*                                  THE CLI ABOVE IS CORRECT                     
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'30'                                                     
         BAS   RE,NEXTEL                                                        
         BE    *+6                                                              
         DC    H'0'                 MUST HAVE OPEN RATE ELEM                    
         USING PORELED,R2                                                       
         CLC   QPROG,=C'R1'        ON REBATE BILL SHOW BOTH                     
         BE    LDESC4G1            OPEN AND CONTRACT                            
         CLC   QPROG,=C'RD'        ON REBATE BILL DRAFT SHOW BOTH               
         BE    LDESC4G1            OPEN AND CONTRACT                            
*                                                                               
         CLI   WIOPT,C'Y'           WESTERN COST SUPPRESSION                    
         BE    LDESC4G4                                                         
*                                                                               
         CLI   PORCOSTY,C'U'        SEE IF UNIT RATE GIVEN                      
         BNE   LDESC4G5                                                         
         MVI   CURTAB+3,5                                                       
         EDIT  (P5,PORCOS),(9,P2+12),5,ALIGN=LEFT,DROP=3                        
         B     LDESC4G5                                                         
***R***                                                                         
LDESC4G1 DS    0H                                                               
         L     R4,=V(DICSECT)                                                   
         USING DICSECT,R4                                                       
         CLI   PORCOSTY,C'U'        SEE IF UNIT RATE GIVEN                      
         BNE   LDEC4G3B                                                         
*--->    MVC   P2+12(3),=C'OR='                                                 
         MVC   P2+12(L'PP@OR),PP@OR                                             
         EDIT  (P5,PORCOS),(9,P2+15),5,ALIGN=LEFT,DROP=3                        
*                                                                               
         LA    R5,P2+15                                                         
         AR    R5,R0                                                            
LDESC4G2 CLI   0(R5),C' '                                                       
         BNE   LDESC4G3                                                         
         BCTR  R5,0                                                             
         B     LDESC4G2                                                         
LDESC4G3 DS    0H                                                               
*--->    MVC   1(4,R5),=C'/CR='                                                 
         MVC   1(L'PP@CR,R5),PP@CR                                              
         MVC   5(9,R5),MYOUR       CONTRACT RATE                                
         B     LDESC4G5                                                         
*                                                                               
LDEC4G3B DS    0H                                                               
*--->    MVC   P2+12(3),=C'OC='                                                 
         MVC   P2+12(L'PP@OC),PP@OC                                             
*--->    EDIT  (P5,PORCOS),(14,P2+15),2,ALIGN=LEFT,COMMAS=YES,MINUS=YES         
         CURED (P5,PORCOS),(14,P2+15),CURTAB,ALIGN=LEFT,COMMAS=YES,    X        
               FLOAT=-                                                          
*                                                                               
         DROP  R2                                                               
         LA    R5,P2+15                                                         
         AR    R5,R0                                                            
LDEC4G3C CLI   0(R5),C' '                                                       
         BNE   LDEC4G3D                                                         
         BCTR  R5,0                                                             
         B     LDEC4G3C                                                         
LDEC4G3D DS    0H                                                               
*--->    MVC   1(4,R5),=C'/CC='                                                 
         MVC   1(L'PP@CC,R5),PP@CC                                              
         DROP  R4                                                               
*--->    EDIT  (B4,W),(14,5(R5)),2,ALIGN=LEFT,COMMAS=YES,MINUS=YES              
         CURED (B4,W),(14,5(R5)),CURTAB,ALIGN=LEFT,COMMAS=YES,FLOAT=-           
         B     LDESC4G5                                                         
***R***                                                                         
*                                                                               
LDESC4G4 DS    0H                                                               
         CLI   WIOPT,C'Y'      CHECK FOR WESTERN OPTION                         
         BE    LDESC4G5        NO UNIT RATES                                    
*                                                                               
         MVC   P2+12(9),MYOUR       UNIT RATE                                   
*                                                                               
LDESC4G5 LA    R5,P2+12                                                         
         CLI   P2+12,C' '                                                       
         BE    *+8                                                              
         LA    R5,P3+12                                                         
         MVC   0(17,R5),PBYOSPC2                                                
         LA    R5,P2+12                                                         
         CLI   P2+12,C' '                                                       
         BE    LDESC4G6                                                         
         LA    R5,P3+12                                                         
         CLI   0(R5),C' '                                                       
         BE    LDESC4G6                                                         
         LA    R5,P4+12                                                         
*                                                                               
LDESC4G6 CLI   PBYOPRM,C' '                                                     
         BNH   LDESC41                                                          
*                                                                               
         CLC   QPROG,=C'R1'      SHOW ON REBATE                                 
         BE    LDESC4G7                                                         
         CLC   QPROG,=C'RD'      SHOW ON REBATE- DRAFT                          
         BE    LDESC4G7                                                         
         CLI   WIOPT,C'Y'       CHECK WESTERN OPTION                            
         BNE   LDESC4G7         NO UNIT RATES OR PREMIUMS                       
*                                                                               
         CLI   PBYOPRM+1,C'C'        CHECK FOR A COLOR                          
         BNE   LDESC41              NO - DISPLAY NOTHING                        
         MVC   0(2,R5),PBYOPRM      YES - ONLY DISPLAY NC                       
         B     LDESC41                                                          
*                                                                               
LDESC4G7 MVC   0(11,R5),PBYOPRM     PREMIUM                                     
         B     LDESC41                                                          
*                                                                               
LDESC4G8 MVC   P1+12(20),PBYOSPC                                                
         MVC   P2+12(17),PBYOSPC2                                               
         CLI   PBYOSPC,C' '        IF NO SPACE - USE PBYOUNTS                   
         BH    *+10                                                             
         MVC   P1+12(7),PBYOUNTS                                                
         CLI   FINANSW,1            SEE IF FINANCIAL CLIENT                     
         BNE   LDESC40                                                          
*                                  NOTE - ONLY "OLD" STYLE FINANCIAL            
*                                  BILLING DISPLAYS OPEN RATES                  
*                                  THE CLI ABOVE IS CORRECT                     
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'30'                                                     
         BAS   RE,NEXTEL                                                        
         BE    *+6                                                              
         DC    H'0'                 MUST HAVE OPEN RATE ELEM                    
         USING PORELED,R2                                                       
*                                                                               
         CLC   QPROG,=C'R1'        ON REBATE BILL SHOW BOTH                     
         BE    LDESC4GK            OPEN AND CONTRACT RATES                      
         CLC   QPROG,=C'RD'        ON REBATE BILL DRAFT SHOW BOTH               
         BE    LDESC4GK            OPEN AND CONTRACT RATES                      
*                                                                               
         CLI   WIOPT,C'Y'      WESTERN OPTION                                   
         BE    LDESC40         NO COST OR PREMIUM (UNLESS REBATE)               
*                                                                               
         CLI   PORCOSTY,C'U'        SEE IF UNIT RATE GIVEN                      
         BNE   LDESC40B                                                         
         EDIT  (P5,PORCOS),(9,P1+21),5,ALIGN=LEFT,DROP=3                        
         B     LDESC40B                                                         
***R***                                                                         
LDESC4GK DS    0H                                                               
         L     R4,=V(DICSECT)                                                   
         USING DICSECT,R4                                                       
         CLI   PORCOSTY,C'U'        SEE IF UNIT RATE GIVEN                      
         BNE   LDESC4GH                                                         
*--->    MVC   P1+21(3),=C'OR='                                                 
         MVC   P1+21(L'PP@OR),PP@OR                                             
         EDIT  (P5,PORCOS),(9,P1+24),5,ALIGN=LEFT,DROP=3                        
         LA    R5,P1+24                                                         
         AR    R5,R0                                                            
LDESC4G9 CLI   0(R5),C' '                                                       
         BNE   LDESC4GA                                                         
         BCTR  R5,0                                                             
         B     LDESC4G9                                                         
LDESC4GA DS    0H                                                               
*--->    MVC   1(4,R5),=C'/CR='                                                 
         MVC   1(L'PP@CR,R5),PP@CR                                              
         MVC   5(9,R5),MYOUR       CONTRACT RATE                                
         B     LDESC40B                                                         
*                                                                               
LDESC4GH DS    0H                                                               
*--->    MVC   P1+21(3),=C'OC='                                                 
         MVC   P1+21(L'PP@OC),PP@OC                                             
*--->    EDIT  (P5,PORCOS),(14,P1+24),2,ALIGN=LEFT,COMMAS=YES                   
         CURED (P5,PORCOS),(14,P1+24),CURTAB,ALIGN=LEFT,COMMAS=YES              
         DROP  R2                                                               
         LA    R5,P1+24                                                         
         AR    R5,R0                                                            
LDESC4GI CLI   0(R5),C' '                                                       
         BNE   LDESC4GJ                                                         
         BCTR  R5,0                                                             
         B     LDESC4GI                                                         
LDESC4GJ DS    0H                                                               
*--->    MVC   1(4,R5),=C'/CC='                                                 
         MVC   1(L'PP@CC,R5),PP@CC                                              
*--->    EDIT  (B4,W),(14,5(R5)),2,ALIGN=LEFT,COMMAS=YES,MINUS=YES              
         CURED (B4,W),(14,5(R5)),CURTAB,ALIGN=LEFT,COMMAS=YES,FLOAT=-           
         B     LDESC40B                                                         
         DROP  R4                                                               
***R***                                                                         
*                                                                               
*                                                                               
LDESC40  DS    0H                                                               
*                                                                               
         CLI   WIOPT,C'Y'          WESTERN OPTION                               
         BNE   LDESC40A            NO COST OR PREMIUM $                         
*                                                                               
         CLI   PBYOPRM+1,C'C'        CHECK FOR A COLOR                          
         BNE   LDESC41              NO - DISPLAY NOTHING                        
         MVC   P1+21(2),PBYOPRM     YES - ONLY DISPLAY NC                       
         B     LDESC41                                                          
*                                                                               
*                                                                               
LDESC40A CLC   MYOUR,SPACES       CHK FOR RATE                                  
         BNH   *+10                                                             
         MVC   P1+21(9),MYOUR      ALSO SHOW RATE                               
LDESC40B CLI   PBYOPRM,C' '        CHK FOR PREMIUM                              
         BNH   *+10                                                             
         MVC   P2+12(11),PBYOPRM   AND PREMIUM                                  
*                                                                               
LDESC41  CLI   PBYOMDY2,C' '                                                    
         BE    *+8                                                              
         MVI   P2,C'-'                                                          
*****    CLI   WRKMED,C'N'    NO-OPED SINCE ON-SALE DATES                       
*****    BE    LDESC43        MAY NOW EXIST FOR NEWSPAPERS                      
         OC    PBDSDATE,PBDSDATE                                                
         BZ    LDESC43                                                          
         CLI   OSDOPT,C'Y'         SEE IF SHOWING ON-SALE DATE                  
         BNE   LDESC43                                                          
         LA    R5,P2                                                            
         CLI   P2,C' '             SEE IF P2 USED                               
         BE    *+8                                                              
         LA    R5,P3                                                            
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   0(12,R5),=C'ON-SALE DTE='                                        
         MVC   0(L'PP@OSDAT,R5),PP@OSDAT                                        
         DROP  RE                                                               
         GOTO1 DATCON,DMCB,(3,PBDSDATE),(5,12(R5))                              
*                                                                               
LDESC43  OC    PBDJOB,PBDJOB                                                    
         BZ    FB19                                                             
         CLI   JOBCTL,C'N'                                                      
         BE    FB18B                                                            
         CLI   JOBCTL,0                                                         
         BE    FB18B                                                            
         B     FB19                JOB INFO DONE AT FJOB                        
*                                                                               
FB18B    CLI   JOBOPT,C'N'    NO AD INFOR                                       
         BE    FB19                                                             
**PPNEW  L     RF,PPFILEC                                                       
**PPNEW  LA    R5,4095(RF)                                                      
**PPNEW  LA    R5,1(R5)                                                         
**PPNEW  USING PPFILED+4096,R5     NEEDED FOR PJOBREC                           
*                                                                               
         L     R5,PPFILEC         **PPNEW                                       
         USING PPFILED,R5         **PPNEW                                       
*                                                                               
*                                                                               
         L     R4,=V(DICSECT)      ** NOTE USE OF R4 TO COVER DICSECT           
         USING DICSECT,R4                                                       
*                                                                               
         CLI   JOBOPT,C'A'                                                      
         BE    FB18D               AD NO ONLY                                   
         XC    WORK(25),WORK                                                    
         MVC   WORK(10),PBUYKEY                                                 
         MVI   WORK+3,X'15'                                                     
         MVC   WORK+10(6),PBDJOB                                                
         CLC   PJOBREC(25),WORK                                                 
         BE    FB18CX                                                           
         MVC   LSAVKEY,KEY                                                      
         MVC   KEY(25),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
         CLC   KEY(25),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         GOTO1 GETJOB                                                           
*                                                                               
         MVC   KEY,LSAVKEY                                                      
         GOTO1 HIGH                                                             
*                                                                               
FB18CX   DS    0H                                                               
*                                                                               
         TM    JOBOPT,X'30'                                                     
         BZ    FB18D                                                            
*                                       COPY NO.                                
         LA    R2,P2                                                            
         BAS   RE,FNEXTP                FIND FIRST AVAILABLE PLINE              
         CLI   TWOCOL,C'Y'                                                      
         BE    FB18CX9                                                          
         MVC   WORK(26),SPACES                                                  
*--->    MVC   WORK(5),=C'COPY='                                                
         MVC   WORK(L'PP5COPY),PP5COPY                                          
         MVC   WORK+5(17),PJOBCPY                                               
         BAS   RE,GETANNO   GET NO.OF LINES WITH ANNO RETURN IN FULL            
         L     R0,FULL                                                          
         LA    R1,P1                                                            
         SH    R1,=H'132'                                                       
FB18C6   LA    R1,132(R1)                                                       
         BCT   R0,FB18C6                                                        
         CR    R2,R1                                                            
         BH    FB18CX9          NO ANNO IN THIS LINE - USE NORMAL               
         LA    R6,19            MUST CHOP FOR LINES THAT HAVE ANNO              
*                                                                               
FB18C7   GOTO1 ACHOPPER,DMCB,(25,WORK),((R6),4(R2)),(C'P',2)                    
         LA    R2,132(R2)                                                       
         CLI   4(R2),C' '     SEE IF I USED 2 LINES                             
         BNH   *+8                                                              
         LA    R2,132(R2)                                                       
         B     FB18F                                                            
*                                                                               
FB18CX9  LA    R2,4(R2)                                                         
*--->    MVC   0(5,R2),=C'COPY='                                                
         MVC   0(L'PP5COPY,R2),PP5COPY                                          
         MVC   5(17,R2),PJOBCPY                                                 
         B     FB18F                                                            
*                                       AD. NO.                                 
FB18D    DS    0H                                                               
         LA    R2,P2                                                            
         BAS   RE,FNEXTP                FIND FIRST AVAILABLE PLINE              
FB18D5   LA    R2,4(R2)                                                         
*--->    MVC   0(7,R2),=C'AD NO.='                                              
         MVC   0(L'PP@ADNO,R2),PP@ADNO                                          
         MVC   8(6,R2),PBDJOB                                                   
*                                                                               
FB18F    DS    0H                                                               
         DROP  R4                                                               
*                                                                               
         TM    JOBOPT,X'02'                                                     
         BZ    FB19                                                             
         LA    R2,P2                                                            
         BAS   RE,FNEXTP                FIND FIRST AVAILABLE PLINE              
*                                  CAPTION                                      
FB18F5   DS    0H                                                               
         CLI   TWOCOL,C'Y'          SEE IF I HAVE 2 COLUMNS                     
         BE    FB18F8                                                           
         BAS   RE,GETANNO   GET NO.OF LINES WITH ANNO RETURN IN FULL            
         L     R0,FULL                                                          
         LA    R1,P1                                                            
         SH    R1,=H'132'                                                       
FB18F6   LA    R1,132(R1)                                                       
         BCT   R0,FB18F6                                                        
         CR    R2,R1                                                            
         BH    FB18F8                                                           
         LA    R6,19                  USE DIFFERENT CHOP FOR                    
*                                     LINES THAT HAVE TYPE ANNO                 
FB18F7   GOTO1 ACHOPPER,DMCB,(25,PJOBCAP1),((R6),4(R2)),(C'P',2)                
         LA    R2,132(R2)                                                       
         CLI   4(R2),C' '     SEE IF I USED 2 LINES                             
         BNH   *+8                                                              
         LA    R2,132(R2)                                                       
         BAS   RE,GETANNO   GET NO.OF LINES WITH ANNO RETURN IN FULL            
         L     R0,FULL                                                          
         LA    R1,P1                                                            
         SH    R1,=H'132'                                                       
FB18F7D  LA    R1,132(R1)                                                       
         BCT   R0,FB18F7D                                                       
         CR    R2,R1                                                            
         BH    FB18F9                                                           
         LA    R6,19                  USE DIFFERENT CHOP FOR                    
*                                     LINES THAT HAVE TYPE ANNO                 
FB18F7F  GOTO1 ACHOPPER,DMCB,(25,PJOBCAP2),((R6),4(R2)),(C'P',2)                
         LA    R2,132(R2)                                                       
         CLI   4(R2),C' '     SEE IF I USED 2 LINES                             
         BNH   *+8                                                              
         LA    R2,132(R2)                                                       
         B     FB19                                                             
*                                                                               
FB18F8   LA    R2,4(R2)                                                         
         MVC   0(25,R2),PJOBCAP1                                                
         MVC   132(25,R2),PJOBCAP2                                              
         B     FB19                                                             
*                                                                               
FB18F9   LA    R2,4(R2)                                                         
         MVC   0(25,R2),PJOBCAP2                                                
         DROP  R5                                                               
*                                                                               
FB19     DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'83'       SEARCH FOR REFERENCE NUMBER ELEM              
         BAS   RE,NEXTEL                                                        
         BNE   FB19D                                                            
         ST    R2,FULL                                                          
         LA    R2,P2              FIND FIRST AVAILABLE PLINE                    
         BAS   RE,FNEXTP                                                        
         MVC   4(5,R2),=C'REF#='                                                
         L     RE,FULL            ADDRESS OF REF NUMBER ELEMENT                 
         MVC   9(10,R2),2(RE)                                                   
*                                                                               
         DROP  R7                                                               
*                                                                               
FB19D    DS    0H                                                               
         L     R6,APPBYOWK        MUST RESET R6 TO COVER PPBYOUT WRK            
         LA    R4,PBYOCOMS                                                      
         LA    R5,5                                                             
         LA    R2,P2                                                            
         BAS   RE,FNEXTP         FIND NEXT AVAILABLE PLINE                      
LDESC4I  CLC   0(47,R4),SPACES                                                  
         BE    LDESC4J                                                          
         CLI   JOBOPT,C'2'                                                      
         BE    LDESC4I2                                                         
         CLI   JOBOPT,C'1'                                                      
         BE    SKIPCAP                                                          
         CLC   =C'COPY',0(R4)                                                   
         BE    LDESC4J                                                          
         CLI   JOBOPT,C'B'                                                      
         BE    LDESC4I2                                                         
SKIPCAP  CLC   =C'CAP',0(R4)                                                    
         BE    LDESC4J                                                          
LDESC4I2 CLI   AGMSCOM,C'N'    SEE IF NOT PRINTING CERTAIN COMMENTS             
         BE    LDESC4I3                                                         
         CLC   0(1,R4),AGMSCOM    IF MATCHES FIRST CHARACTER - SKIP             
         BE    LDESC4J                                                          
LDESC4I3 LA    R6,35                                                            
         LA    R1,P14                                                           
         CR    R2,R1                                                            
         BNL   LDESC4JX             MUST STOP - CAN'T FIT IN PLINES             
*                                                                               
         CLI   TWOCOL,C'Y'                                                      
         BE    LDESC4I8                                                         
         LA    R1,P1                                                            
         SH    R1,=H'132'                                                       
         BAS   RE,GETANNO     RETURNS NO. OF LINES WITH ANNO IN FULL            
         L     R0,FULL                                                          
LDESC4I6 LA    R1,132(R1)                                                       
         BCT   R0,LDESC4I6                                                      
         CR    R2,R1                                                            
         BH    LDESC4I8                                                         
         LA    R6,19                  USE DIFFERENT CHOP FOR                    
*                                     LINES THAT HAVE TYPE ANNO                 
LDESC4I8 GOTO1 ACHOPPER,DMCB,(47,0(R4)),((R6),4(R2)),(C'P',3)                   
         LA    R2,132(R2)                                                       
         CLI   4(R2),C' '     SEE IF I USED 2 LINES                             
         BNH   *+8                                                              
         LA    R2,132(R2)                                                       
         CLI   4(R2),C' '     SEE IF I USED 3 LINES                             
         BNH   *+8                                                              
         LA    R2,132(R2)                                                       
*                                                                               
LDESC4J  LA    R4,47(R4)                                                        
         BCT   R5,LDESC4I                                                       
LDESC4JX L     R5,ADESC                                                         
         B     LDESC8                                                           
*                                                                               
LDESC7B  DS    0H                                                               
         LA    R7,P1+0                                                          
         CLI   0(RF),X'FA'                                                      
         BNE   LDESC7C                                                          
         CLI   SPOTCTL,C'Y'        SEE IF SHOWING DETAIL                        
         BNE   LDESCX                                                           
         CLC   P1(20),SPACES       SINCE I MAY NOT HAVE PRINTED PUB             
         BE    LDESC7B5                                                         
         GOTO1 APRNT                                                            
LDESC7B5 DS    0H                                                               
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   1(10,R7),=C'PREVIOUSLY'                                          
         MVC   1(L'PP@PREV,R7),PP@PREV                                          
*--->    MVC   132+1(17,R7),=C'BILLED INSERTIONS'                               
         MVC   132+1(L'PP@BLDIN,R7),PP@BLDIN                                    
         CLI   WRKMED,C'0'                                                      
         BNE   LDESC7W                                                          
*--->    MVC   132+8(10,R7),=CL10'POSTINGS'                                     
         MVC   132+8(L'PP@POST,R7),PP@POST                                      
         DROP  RE                                                               
         B     LDESC7W                                                          
*                                                                               
LDESC7C  DS    0H                                                               
         CLI   0(RF),X'FB'         CURRENT MANUAL                               
         BE    LDESCX                                                           
*                                                                               
LDESC7D  DS    0H                                                               
         CLI   0(RF),X'FC'                                                      
         BNE   LDESC7W                                                          
         CLI   SPOTCTL,C'Y'         SEE IF SHOWING DETAIL                       
         BNE   LDESC7D8                                                         
         CLC   P1(20),SPACES       SINCE I MAY NOT HAVE PRINTED PUB             
         BE    LDESC7D5                                                         
         GOTO1 APRNT                                                            
         L     RF,ADESC            MUST RESET RF                                
LDESC7D5 DS    0H                                                               
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   1(14,R7),=C'PREV. ONE-LINE'                                      
*--->    MVC   132+1(4,R7),=C'BILL'                                             
         MVC   1(L'PP@PRV01,R7),PP@PRV01                                        
         MVC   132+1(L'PP@BILL,R7),PP@BILL                                      
         DROP  RE                                                               
         MVC   W+1(1),1(RF)        MONTH                                        
         MVC   HALF,2(RF)          INVOICE NUMBER                               
*                                                                               
         MVC   SVSVIMO,SVINVMO     SAVE 'REAL' INV MTH                          
*                                                                               
         GOTO1 AGETNUM,DMCB,(1,HALF),132+6(R7)                                  
*                                                                               
         MVC   SVINVMO,SVSVIMO     RESTORE 'REAL' INV MTH                       
*                                                                               
         MVI   264+1(R7),0                                                      
*                                                                               
LDESC7D8 CLI   PASSNO,1            ONLY MARK MANUAL BILL ON PASS 1              
         BNE   LDESC7H                                                          
*                                                                               
         L     R6,ASORTCOM         DISK ADDR IN COMMENT                         
         OC    0(4,R6),0(R6)                                                    
         BZ    LDESC7W             DISK ADDR SHOULD BE THERE                    
         MVC   KEY+27(4),0(R6)                                                  
         MVC   AREC,ADWKREC                                                     
         GOTO1 GETPRT                                                           
***            REREAD PREV MANUAL BILL AND MARK IT                              
         L     R7,ADWKREC                                                       
         USING PBILLREC,R7                                                      
         OC    MANRVNO,MANRVNO          SEE IF DOING REVERSAL                   
         BZ    LDESC7D9                                                         
         MVC   PBILMCAN,ZEROS           RESET TO ZEROS                          
         MVC   PBILMDAT,ZEROS           SO MANUAL BILL CAN BE                   
         B     LDESC7DA                 CREDITED AGAIN                          
*                                                                               
LDESC7D9 MVC   PBILMDAT,TODAY                                                   
         LH    R0,INVNO                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBILMCAN+2(4),DUB                                                
         MVC   PBILMCAN(2),TODAY+2 MONTH                                        
*                                                                               
LDESC7DA L     R5,BRKCODE                                                       
         L     R5,ATOTS(R5)                                                     
         AH    R5,=Y(MAXMOS*ROWL)                                               
***      LA    R5,MAXMOS*ROWL(R5)  POINT OT TOTAL ROW                           
*                                                                               
         XC    WORK,WORK                                                        
*                                                                               
         L     R0,0(R5)                                                         
         S     R0,ROWHL(R5)                                                     
         ST    R0,WORK                                                          
         L     R0,4(R5)                                                         
         S     R0,ROWHL+4(R5)                                                   
         ST    R0,WORK+4                                                        
         L     R0,8(R5)                                                         
         S     R0,ROWHL+8(R5)                                                   
         ST    R0,WORK+8                                                        
*                                                                               
         L     R0,DBTOTS           ADD TO OVERALL BILLED TOTALS                 
         A     R0,WORK             GROSS                                        
         ST    R0,DBTOTS                                                        
         L     R0,DBTOTS+4                                                      
         A     R0,WORK+4           NET                                          
         ST    R0,DBTOTS+4                                                      
         L     R0,DBTOTS+8                                                      
         A     R0,WORK+8           CD                                           
         ST    R0,DBTOTS+8                                                      
*                                                                               
         CLI   TEST,C'T'           DON'T WRITE BACK IF TEST MODE                
         BE    LDESC7F                                                          
         CLI   RCWRITE,C'N'                                                     
         BE    LDESC7F                                                          
         MVC   AREC,ADWKREC                                                     
         GOTO1 PUTPRT                                                           
LDESC7F  DS    0H                                                               
*                                                                               
         CLI   SORTTRCE,C'Y'       TEST TO DUMP RECORD                          
         BNE   LDESC7H                                                          
*                                                                               
         MVC   HALF,PBILLLEN                                                    
         LH    R5,HALF                                                          
         CH    R5,=H'858'                                                       
         BNH   *+8                                                              
         LH    R5,=H'858'                                                       
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   P1(19),=C'PREV MANUAL BILLREC'                                   
         MVC   P1(L'PP@PRV02),PP@PRV02                                          
         DROP  RE                                                               
         GOTO1 HEXOUT,DMCB,KEY+27,P1+22,4,=C'N'                                 
         GOTO1 (RF),DMCB,PBILLREC,P2,(R5)                                       
         GOTO1 APRNT                                                            
*                                                                               
LDESC7H  DS    0H                                                               
         CLI   SPOTCTL,C'Y'        SEE IF SHOWING DETAIL                        
         BNE   LDESCX                                                           
         B     LDESC7W                                                          
*                                                                               
LDESC7W  DS    0H                                                               
         CLI   PERCTL,C'T'         IF MONTHS TOGETHER                           
         BNE   LDESC8                                                           
*                                                                               
         L     RF,APER             SHOW MONTH HERE                              
         ZIC   R6,0(RF)                                                         
         MH    R6,=H'8'                                                         
         LA    R6,PERLIST(R6)                                                   
*                                                                               
         GOTO1 DATCON,DMCB,(3,(R6)),(6,WORK)                                    
         MVC   264+1(6,R7),WORK                                                 
         MVI   396+1(R7),0         SPACE                                        
*                                                                               
LDESC8   DS    0H                                                               
         GOTO1 ATOTOUT                                                          
LDESCX   DS    0H                                                               
         XMOD1                                                                  
*                                                                               
         DROP  R7                                                               
*                                                                               
GETANNO  NTR1                                                                   
         L     R7,ADWKREC                                                       
         USING PBUYREC,R7                                                       
         ZIC   R6,DOLNUM                                                        
         CLI   DOLNUM,5                                                         
         BE    GETANX                                                           
         ZIC   R6,TYPNUM                                                        
         CLI   LSTOPT,C'I'         SEE IF LISTING INVOICE DETAILS               
         BE    GETAN5              HERE AND AT END                              
         CLI   LSTOPT,C'B'         SEE IF LISTING INVOICE DETAILS               
         BE    GETAN5              HERE AND AT END (+RESTATE AMTDUE)            
         CLI   LSTOPT,C'D'         SEE IF LISTING INVOICE DETAILS               
         BNE   GETANX              HERE                                         
*                                                                               
GETAN5   LA    R2,PBUYREC+33                                                    
         SR    R5,R5                                                            
         MVI   ELCODE,X'26'        MUST COUNT BILLING ELEMS                     
*                                                                               
         CLI   FINANSW,0           SEE IF DOING FINANCIAL BILL                  
         BE    GETAN8                                                           
         MVI   ELCODE,X'28'                                                     
***R***                                                                         
         CLC   QPROG,=C'R1'        SEE IF FINANCIAL REBATE                      
         BNE   *+8                                                              
         MVI   ELCODE,X'29'                                                     
         CLC   QPROG,=C'RD'        SEE IF FINANCIAL REBATE DRAFT                
         BNE   *+8                                                              
         MVI   ELCODE,X'29'                                                     
***R***                                                                         
         USING PBILELEM,R2                                                      
GETAN8   BAS   RE,NEXTEL                                                        
         BNE   GETAN10                                                          
         OC    PBLDATE,PBLDATE                                                  
         BZ    GETAN8                                                           
         CLC   PBLDATE,TODAYB                                                   
         BE    GETAN8                                                           
         CLI   MANRVDTP,0          SEE IF DOING A REVERSAL                      
         BE    GETAN9                                                           
         CLC   PBINVNO,MANRVNO     ONLY SHOW BILL I'M REVERSING                 
         BE    GETAN9B                                                          
         B     GETAN8                                                           
*                                                                               
GETAN9   TM    PBBILST,X'C0'       OMIT REVERSED AND REVERSALS                  
         BNZ   GETAN8                                                           
*                                                                               
         CLI   SCBNCSW,C'C'        SEE IF UFC COMM BILLING                      
         BNE   GETAN9A                                                          
         TM    PBBILST,X'01'       SEE IF RIGHT TYPE                            
         BZ    GETAN8                                                           
         B     GETAN9B                                                          
*                                                                               
GETAN9A  DS    0H                                                               
         CLI   SCBNCSW,C'N'        SEE IF UFC NET BILLING                       
         BNE   GETAN9B                                                          
         TM    PBBILST,X'02'                                                    
         BZ    GETAN8                                                           
*                                                                               
GETAN9B  LA    R5,1(R5)                                                         
         B     GETAN8                                                           
*                                                                               
GETAN10  CH    R5,=H'1'                                                         
         BNH   GETANX                                                           
         BCTR  R5,0                                                             
         AR    R6,R5                                                            
GETANX   ST    R6,FULL                                                          
         XIT1                                                                   
*                                                                               
         DROP  R2                                                               
*                                                                               
         SPACE 2                                                                
NEXTEL   DS    0H                                                               
         SR    R0,R0                                                            
         IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTEL2                                                          
         CLC   0(1,R2),ELCODE                                                   
         BER   RE                                                               
         B     NEXTEL                                                           
NEXTEL2  DS    0H                                                               
         LTR   RE,RE                                                            
         BR    RE                                                               
*                                                                               
*                                                                               
FNEXTP   CLC   0(15,R2),SPACES                                                  
         BER   RE                                                               
         LA    R2,132(R2)                                                       
         B     FNEXTP                                                           
*                                                                               
BILLPASS DC    X'00'                                                            
WRKMED   DC    C' '                                                             
*                                                                               
SVCTYP   DS    CL1           SAVED COST TYPE                                    
*                                                                               
MYOUR    DS    CL9           POSSIBILY ALTERED PBYOUR                           
*                            IF PROFB2B+11 IS "Y"                               
*                            "N" WILL BE FLOATED BEFORE UNIT RATE               
*                                                                               
SAVER2   DC    F'0'                                                             
LSAVKEY  DS    CL32                                                             
SVDA     DS    XL4                 SAVE DISK ADDR                               
         LTORG                                                                  
         SPACE 2                                                                
         TITLE 'TSTRET'                                                         
TSTRET   CSECT                                                                  
         NMOD1 0,TSTRET                                                         
         LA    RC,SPACEND                                                       
*                                                                               
         MVI   RETSKIP,C'N'                                                     
         CLI   UPASS,0                                                          
         BE    TRYES               OK OF NON-RETAIL                             
         L     R4,AGDAREA                                                       
         USING GDSECT,R4                                                        
         L     RF,ADEST                                                         
         MVC   GDSCHM,PESTRSCH-PESTREC(RF)  RETAIL SCHEME                       
         CLC   GDSCHM,SPACES                                                    
         BNH   TR2A                                                             
         MVI   GDTEST,C'Y'         SET TEST MODE                                
         MVI   GDOUTNO,0                                                        
         CLI   UPASS,C'T'                                                       
         BE    *+10                                                             
         MVC   GDOUTNO,UPASS                                                    
         GOTO1 AFINDOUT,DMCB,(R4)                                               
         MVI   GDTEST,C'N'                                                      
         CLI   UPASS,C'T'                                                       
         BNE   TR2D                                                             
         CLC   GDSHRP,=F'10000'    100 PCT                                      
         BE    TR2B                                                             
*                                                                               
TR2A     DS    0H                                                               
         L     RE,=V(DICSECT)                                                   
         USING DICSECT,RE                                                       
*--->    MVC   P1(28),=C'** SCHEME XX NOT CORRECT FOR'                          
         MVC   P1(L'PP@SCHM),PP@SCHM                                            
         MVC   P1+10(2),GDSCHM                                                  
         MVC   P1+29(15),GDMGRDSC                                               
         CLI   GDMKTLEN,0                                                       
         BE    *+10                                                             
         MVC   P1+29(15),GDMKTDSC                                               
         MVC   P1+45(6),GDMGR                                                   
         MVC   P1+50(2),GDMKT                                                   
*--->    MVC   P1+55(09),=C'(EST NNN)'                                          
         MVC   P1+55(L'PP@ESTN),PP@ESTN                                         
         DROP  RE                                                               
         MVC   P1+55+5(3),EST                                                   
*                                                                               
         CLC   GDSCHM,SPACES                                                    
         BH    *+14                                                             
         MVC   P1+10(2),=C'00'                                                  
         B     TR2A2                                                            
*                                                                               
         OC    GDSHRP,GDSHRP                                                    
         BZ    TR2A2                                                            
*--->    EDIT  (B4,GDSHRP),(7,P1+65),2                                          
         CURED (B4,GDSHRP),(7,P1+65),CURTAB                                     
         MVC   P1+73(3),=C'PCT'                                                 
TR2A2     DS    0H                                                              
         MVI   PRSW,C'N'                                                        
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 APRNT                                                            
         MVI   RETERR,1                                                         
         MVC   PAGE,=H'1'                                                       
TR2B     DS    0H                                                               
         B     TRNO                                                             
TR2D     DS    0H                                                               
         CLI   UPASS,1             DONT SKIP IF CORT OUTLET                     
         BE    TRYES                                                            
         CLI   UPASS,C'S'                                                       
         BE    TRYES                                                            
         MVI   RETSKIP,C'N'                                                     
         OC    GDSHRP,GDSHRP                                                    
         BNZ   TRYES                                                            
*                                                                               
         MVI   RETSKIP,C'Y'        SKIP THIS EST - NO SHR PCT                   
*                                                                               
TRNO     DS    0H                                                               
         LTR   RE,RE                                                            
         B     TRX                                                              
TRYES    DS    0H                                                               
         SR    RE,RE                                                            
TRX      DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
*                                                                               
         EJECT                                                                  
*                             GETAOR - GET AOR INFO                             
         SPACE 2                                                                
GETAOR   CSECT                                                                  
         NMOD1 0,GETAOR                                                         
         LA    RC,SPACEND                                                       
*                                                                               
         XC    SVAORS,SVAORS                                                    
*                                                                               
         L     RF,AAORADDR                                                      
         MVC   0(132,RF),SPACES                                                 
         MVC   132(ADDRLEN-132,RF),SPACES                                       
*                                                                               
         CLI   AORSW,C'Y'          FIRST TEST NEED AOR                          
         BNE   GETAORX                                                          
*                                                                               
         XC    KEY,KEY                                                          
*                                                                               
         L     RF,ADCLT                                                         
         MVC   KEY(7),0(RF)       AGY/MED/CLT                                   
*                                                                               
         OC    AMED,AMED           FOR MULTI-MEDIA REQ GET MEDIA                
         BZ    GA02                FROM AMED                                    
         L     RF,AMED                                                          
         MVC   KEY+2(1),0(RF)                                                   
*                                                                               
GA02     L     RF,APRD                                                          
         MVC   KEY+7(3),0(RF)                                                   
         L     RF,AEST                                                          
         MVC   KEY+10(2),0(RF)                                                  
         MVI   KEY+3,X'14'                                                      
         GOTO1 HIGH                                                             
         CLC   KEY(12),KEYSAVE                                                  
         BE    GAO4                                                             
         MVC   KEYSAVE+10(2),FFS                                                
         CLC   KEY(12),KEYSAVE          SEE IF I FOUND ALL EST REC              
         BE    GAO4                                                             
         MVC   KEY(25),KEYSAVE                                                  
         GOTO1 HIGH                     TRY FOR ALL EST RECORD                  
         CLC   KEY(12),KEYSAVE                                                  
         BNE   GETAORX            NOT FOUND                                     
*                                                                               
*                                                                               
GAO4     DS    0H                                                               
         MVC   SVAORDA,KEY+27      SAVE AOR DISK ADDR                           
                                                                                
*****    L     RF,PPFILEC                                                       
*****    USING PPFILED,RF                                                       
*****    LA    R7,PCONREC          USE CONTRACT RECORD AREA                     
*****                                                                           
*****    DROP  RF                                                               
*****                                                                           
*                                                                               
         LA    R7,AORWRK            USE AORWRK INSTEAD OF PCONREC               
         ST    R7,AREC                                                          
         USING AORREC,R7                                                        
         GOTO1 GETPRT                                                           
*                                                                               
         CLI   CVATCOD,0           IF VAT ACTIVE NEED TO SET CLT/PRD            
         BE    GA05                VAT CODES, BECAUSE MAY NOT HAVE BEEN         
         GOTO1 =V(SETCPVC),DMCB                                                 
*                                                                               
GA05     DS    0H                                                               
         LA    R2,AORELS                                                        
*                                                                               
GAO6     DS    0H                                                               
         CLI   0(R2),X'02'         ADDRESS ELEM                                 
         BE    GAO7                                                             
         CLI   0(R2),X'03'         AOR INFO ELEM                                
         BE    GAO8                                                             
         CLI   0(R2),0             EOR                                          
         BE    GAO9                                                             
*                                                                               
GAO6D    DS    0H                                                               
         ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         B     GAO6                                                             
*                                                                               
GAO7     DS    0H                  AOR ADDRESS ELEM                             
         USING AORADREL,R2                                                      
         L     RF,AAORADDR                                                      
         MVC   000(30,RF),AORLIN1                                               
         MVC   036(30,RF),AORLIN2                                               
         MVC   072(30,RF),AORLIN3                                               
         MVC   108(30,RF),AORLIN4                                               
*                                                                               
****     MVC   AORADR1(30),AORLIN1                                              
****     MVC   AORADR2(30),AORLIN2                                              
****     MVC   AORADR3(30),AORLIN3                                              
****     MVC   AORADR4(30),AORLIN4                                              
         B     GAO6D                                                            
*                                                                               
GAO8     DS    0H                  AOR INFO ELEM                                
         USING AORELEM,R2                                                       
**NEW 5/16/91                                                                   
******   CLI   AORRCVBL,C' '       IF NO ACCOUNT - REJECT WHOLE RECORD          
******   BNH   GAO9                THIS CHECK WAS NO-OPED 4/7/92                
*                                                                               
         CLI   PROFAOR+4,C'Y'      IS 0 PCT AOR O.K.?                           
         BE    GAO8B                                                            
         OC    AORPCT,AORPCT       CHK FOR AOR PCT                              
         BZ    GAO9                ZERO-SO SKIP                                 
*                                                                               
GAO8B    DS    0H                                                               
**NEW 5/16/91                                                                   
**NEW 10/18/89                                                                  
         MVC   SVAORPCT,AORPCT     PCT                                          
         MVC   SVAORBAS,AORBAS     BASIS X'00'= GROSS X'80'= AC                 
         MVC   SVAORACT,AORRCVBL   RCVBL/PAYABLE ACCOUNT                        
         CLC   SVAORACT,SPACES     SEE IF I HAVE AN ACCOUNT                     
         BH    *+10                                                             
         MVC   SVAORACT,AORLIN1    USE AGENCY NAME                              
*                             NEEDED FOR THOSE AGENCIES NOT ON ACC              
*                             THAT LEAVE ACCOUNT FIELD BLANK                    
**NEW 10/18/89                                                                  
         MVC   SVAOREFF,AOREFF     EFFECTIVE DATE                               
**NEW 5/16/91                                                                   
         MVC   SVAORKIL,AORKILL    KILL DATE                                    
         OC    AORKILL,AORKILL                                                  
         BNZ   *+10                                                             
         MVC   SVAORKIL,=X'FFFF'                                                
*                                                                               
         MVC   SVAORVCS,SPACES          CLEAR                                   
*                                                                               
         MVC   SVAORVCD,CVATCOD    SET DEFAULT TO CLIENT VAT CODE               
         CLI   AORGSTCD,C' '                                                    
         BNH   *+10                                                             
         MVC   SVAORVCD,AORGSTCD                                                
         OC    AORPST,SPACES                                                    
         CLC   AORPST,SPACES                                                    
         BNH   *+10                                                             
         MVC   SVAORVCS+1(L'SVAORVCS-1),AORPST                                  
         B     GAO6D                                                            
*                                                                               
GAO9     DS    0H                                                               
GETAORX  DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
*                                                                               
AORWRK   DS    XL500          AOR RECORD AREA                                   
         EJECT                                                                  
*                                                                               
       ++INCLUDE PPBDICS                                                        
PORELED  DSECT                                                                  
       ++INCLUDE PORELEM                                                        
*                                                                               
       ++INCLUDE PAORREC                                                        
*                                                                               
       ++INCLUDE DDBUFFALOD                                                     
       ++INCLUDE PPREPB1WRK                                                     
       ++INCLUDE PPGETCGD                                                       
*                                                                               
GETAOR   CSECT                                                                  
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'046PPREPB12C 05/01/02'                                      
         END                                                                    

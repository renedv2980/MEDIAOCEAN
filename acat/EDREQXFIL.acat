*          DATA SET EDREQXFIL  AT LEVEL 004 AS OF 11/02/15                      
*CATALP REQXFIL                                                                 
         TITLE 'XFILES- READ CROSS FILE REQUESTS AND GENERATE JOBS'             
         PRINT NOGEN                                                            
REQXFIL  CSECT                                                                  
         ENTRY SSB                                                              
         ENTRY UTL                                                              
         NBASE 000,*REQXFIL,RA,R9,WORK=A(WORKAREA)                              
         L     RC,=A(COMMON)                                                    
         USING COMMON,RC           RC=A(COMMOM STORAGE AREA)                    
         L     R8,=V(CPRINT)                                                    
         USING DPRINT,R8                                                        
         MVC   TITLE(15),=C'X-FILE REQUESTS'                                    
         GOTO1 =V(DATCON),PARA,(5,0),(0,TODAY)                                  
         B     INIT                                                             
EXIT     XIT1                                                                   
EOJ      XBASE                                                                  
         EJECT                                                                  
***********************************************************************         
*INITIALISATION ROUTINES                                              *         
***********************************************************************         
INIT     L     RF,=A(GETPARMS)     READ INPUT PARAMETER CARDS                   
         BASR  RE,RF                                                            
         BNE   EOJ                 ERROR IN PARAMETER CARDS                     
         CLI   DUMP,C'O'                                                        
         BE    INIT10                                                           
         GOTO1 =V(STXITER),PARA,DUMPLIST                                        
*                                                                               
INIT10   GOTO1 =V(DATCON),PARA,TODAY,(15,TODAYJUL)                              
         GOTO1 =V(DATCON),PARA,TODAY,(10,TODAYDMY)                              
*                                                                               
         L     RF,=A(FILOPEN)      OPEN FILES                                   
         BASR  RE,RF                                                            
*                                                                               
         GOTO1 =V(DMSYSFIL),PARA                                                
         MVC   ASYSTAB,0(R1)                                                    
         CLI   DSPACE,C' '                                                      
         BH    INITXIT                                                          
         L     RF,=A(SSB)                                                       
         USING SSBD,RF                                                          
         MVC   DSPACE,SSODSPAC                                                  
         DROP  RF                                                               
*                                                                               
INITXIT  DS    0H                                                               
         EJECT                                                                  
***********************************************************************         
*READ XFILE GROUP RECORDS AND CREATE A JOB FOR EACH ACTIVE RECORD     *         
***********************************************************************         
GETGRP   LA    R4,XDIRREC          SET KEY OF XFILE GROUP RECORDS               
         USING XFILED,R4                                                        
         XC    XFKEY,XFKEY                                                      
         MVC   XFKEY(2),=X'0012'                                                
         GOTO1 =V(DATAMGR),PARA,HIGH,GENDIR,XDIRREC,XDIRREC                     
         JNE   *+2                                                              
         CLC   XFKEY(2),=X'0012'                                                
         BNE   FINAL               EXIT IF NO XFILE REQUESTS ON FILE            
*                                                                               
         CLI   BEFJCL,C' '         OPTIONAL JCL BEFORE PRODUCTION               
         BE    GETG10                                                           
         MVC   THISJCL,BEFJCL                                                   
         MVI   OUTSIN,C'Y'         SET NOT TO LOOK FOR JOBS/EXECS ETC           
         MVI   JCLPARM,0           SET BEFORE PRODUCTION JCL                    
         BAS   RE,JCLOUT                                                        
         MVI   OUTSIN,C'X'                                                      
         B     GETG10                                                           
*                                                                               
GETGNEXT LA    R4,XDIRREC          GET NEXT XFILE GROUP RECORD                  
         GOTO1 =V(DATAMGR),PARA,SEQ,GENDIR,XDIRREC,XDIRREC                      
         JNE   *+2                                                              
*                                                                               
GETG10   CLC   XFKEY(2),=X'0012'   STILL AN XFILE RECORD                        
         BNE   FINAL                                                            
         L     R7,=A(XFILREC)                                                   
         GOTO1 =V(DATAMGR),PARA,GETREC,GENFILE,XFKDA,(R7),MYDMWORK              
         BNE   GETGNEXT                                                         
         MVI   ELCODE,X'01'        HEADING ELEMENT                              
         BAS   RE,GETEL                                                         
         USING XFPHD,R7                                                         
         MVC   SVXDEST,XFUSER      SET DESTINATION ID                           
         OC    XFPHDEST,XFPHDEST                                                
         BZ    *+10                                                             
         MVC   SVXDEST,XFPHDEST                                                 
*                                                                               
         MVC   SVLAST,SVTHIS                                                    
         MVC   SVXAGY(12),XFAGY    SAVE AGENCY/USERID/GROUPID                   
         MVI   SVSE#,0                                                          
         MVI   SVSYS,0                                                          
         MVC   SVSYSL(12),SPACES   INIT SYSTEM/GROUP/REQID                      
         CLC   SVUSERID,SVXDEST    SAME USER ID                                 
         BE    GETG12                                                           
         MVC   SVUSERID,SVXDEST                                                 
         L     RF,=A(GETUSER)      READ USER ID RECORD                          
         BASR  RE,RF                                                            
         BNE   GETGNEXT            IGNORE XFILE REC IF INV USER ID              
*                                                                               
GETG12   MVI   OUTJOB,C' '         SET NEW JOB FOR XFILE GROUP                  
         L     RE,=A(LDIRECT)      SET LAST DIRECT=... CARD TO NONE             
         MVI   0(RE),C' '                                                       
         XC    SVPQDATA,SVPQDATA   SET NO PQ REPORT ALLOCATED                   
         MVC   SVPQID,SPACES                                                    
         MVC   QJOBOSID,SPACES                                                  
         XC    QJOBOSNO,QJOBOSNO                                                
         MVC   QJOBPQDS(3),=C'XF=' SET DEFAULT PQ DESC FROM GROUP NAME          
         MVC   QJOBPQDS+3(8),SVXFG                                              
         OC    QJOBPQDS,SPACES                                                  
         ZAP   DIRCOUNT,=P'0'      SET JOB DIRECT= COUNT                        
         ZAP   REQCOUNT,=P'0'      SET GROUP REQUEST COUNT                      
         ZAP   REQJOBCT,=P'0'      SET JOB REQUEST TOTAL                        
         DROP  R4                                                               
*                                                                               
         L     R7,=A(XFILREC)                                                   
         MVI   ELCODE,X'01'        HEADING ELEMENT                              
         BAS   RE,GETEL                                                         
         USING XFPHD,R7                                                         
         OC    XFPHEND,XFPHEND     DONT CHECK BIT ARRAY IF TWO DATES            
         BZ    GETG20                                                           
         L     R7,=A(XFILREC)                                                   
         MVI   ELCODE,X'10'        DATE RANGE ELEMENT                           
         BAS   RE,GETEL                                                         
         USING XFDRD,R7                                                         
*                                                                               
         ICM   RF,15,TODAYJUL      TODAY'S DATE: 0CYYDDDF                       
         SLL   RF,16                                                            
         SRL   RF,16               RF = PACKED DAY NUMBER                       
         XC    DUB,DUB                                                          
         ST    RF,DUB+4                                                         
         CVB   RF,DUB              RF = BINARY DAY NUMBER                       
         SR    RE,RE                                                            
         D     RE,=F'8'                                                         
         LA    R1,XFDRTS                                                        
         AR    R1,RF               NOW R1 PTS TO THE BYTE WITH EOM              
*                                                                               
         LA    RF,X'80'                                                         
         LTR   RE,RE                                                            
         BZ    GETG16                                                           
         SRL   RF,1                                                             
         BCT   RE,*-4                                                           
*                                                                               
GETG16   EX    RF,*+8                                                           
         B     *+8                                                              
         TM    0(R1),0                                                          
         BZ    GETG26              BIT IS OFF SO DONT RUN TODAY                 
*                                                                               
GETG20   L     R7,=A(XFILREC)      GET HEADING ELEMENT                          
         MVI   ELCODE,X'01'                                                     
         BAS   RE,GETEL                                                         
         USING XFPHD,R7                                                         
         OC    XFPHEND,XFPHEND     ANY END DATE PRESENT                         
         BNZ   GETG22              YES                                          
         CLC   TODAYJUL,XFPHNXTR   RUN TODAY                                    
         BNE   GETG26              NO                                           
         B     GETG30                                                           
*                                                                               
GETG22   CLC   TODAYJUL,XFPHNXTR   TEST IF IN REQUEST PERIOD                    
         BL    GETG26                                                           
         CLC   TODAYJUL,XFPHEND                                                 
         BNH   GETG30                                                           
*                                                                               
GETG26   TM    TESTMODE,X'80'      DOESNT RUN TODAY - TEST MODE                 
         BZ    GETGNEXT                                                         
         TM    TRACE,X'01'         MODE SAYS TO IGNORE DATES                    
         BZ    *+10                                                             
         MVC   P+30(10),=C'NOT TODAY '                                          
*                                                                               
GETG30   TM    TRACE,X'01'         TEST IF TRACING XFILE RECORDS                
         BZ    GETG32                                                           
         MVC   P(8),=CL8'XFILEREC'                                              
         MVC   P+10(10),SVXAGY                                                  
         GOTO1 =V(PRINTER)                                                      
*                                                                               
GETG32   L     R7,=A(XFILREC)      GET FIRST SYSTEM/GROUP ELEMENT               
         MVI   ELCODE,X'30'                                                     
         USING XFSGRPD,R7                                                       
         BAS   RE,GETEL                                                         
         BNE   GETGNEXT            IGNORE IF NO SYSTEM/GROUP ELEMENTS           
         ST    R7,AELEM            GET NEXT SYSTEM/GROUP RECORD                 
*                                                                               
GETGMORE DS    0H                                                               
GETG50   MVC   SVGRP,XFSGGRP       GROUP                                        
         MVC   SVSYSL,XFSGSYSL     SYSTEM LETTER                                
         MVC   SVSYS,XFSGSYS                                                    
         LLC   R1,SVSYS            USE OVERLAY NUMBER TO                        
         LARL  RE,LSTSE#           INDEX INTO TABLE OF SE#                      
         AR    RE,R1                                                            
         MVC   SVSE#,0(RE)         SAVE CURRENT SE# PROCESSING                  
         LLC   RF,SVSE#                                                         
         MHI   RF,16                                                            
         A     RF,ASYSTAB          TABLE OF SE#, ENTRY IS 16 BYTES              
*                                                                               
         USING SYSTABD,RF                                                       
         MVC   QSYSTEM(3),DMSYNAM1                                              
         MVC   SYSNAMS,DMSYNAM1    SHORT NAME SXX                               
         MVC   SYSNAML,DMSYNAM     LONG  NAME SPTXX                             
         DROP  RF                                                               
*                                                                               
         TM    TRACE,X'02'         TEST IF TRACING GROUPS                       
         BZ    GETG52                                                           
         MVC   P(8),=CL8'RFPGROUP'                                              
         MVC   P+10(1),SVSYSL                                                   
         MVI   P+11,C'/'                                                        
         MVC   P+12(8),SVGRP                                                    
         GOTO1 =V(PRINTER)                                                      
*                                                                               
GETG52   MVI   INGRP,C'N'                                                       
         B     GETREQ              GO GET REQUEST FOR THIS GROUP                
         DROP  R7                                                               
*                                                                               
GETGEND  CLI   OUTJOB,C'Y'         DID WE OUTPUT A //JOB CARD                   
         BNE   GETG92                                                           
         L     RF,=A(FMVSJCL)      YES-THEN OUTPUT END-OF-JOB JCL               
         BASR  RE,RF                                                            
         MVI   OUTJOB,C' '                                                      
*                                                                               
GETG92   GOTO1 =V(DATAMGR),PARA,HIGH,GENDIR,XDIRREC,XDIRREC                     
         B     GETGNEXT                                                         
         EJECT                                                                  
***********************************************************************         
*FINAL ROUTINES                                                       *         
***********************************************************************         
FINAL    EQU   *                   ALL JOB JCL HAS BEEN OUTPUT                  
*                                                                               
FINAL1   CLC   AFTJCL,SPACES       OPTION TO WRITE OUT MORE JCL                 
         BE    FINAL3                                                           
         CLI   SINGLE,0                                                         
         BE    FINAL2                                                           
         TM    PUTTYP,X'02'        TEST IF LAST CARD WAS EOJ CARD               
         BO    FINAL2                                                           
         MVI   JOBIND,C'I'         SET INCLUDING THIS JOB                       
         L     RE,=A(MVSEOJ)                                                    
         MVC   JCL,0(RE)                                                        
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
FINAL2   MVI   JOBIND,C'I'         SET INCLUDING THIS JOB                       
         MVC   THISJCL,AFTJCL                                                   
         MVI   OUTSIN,C'Y'         SET NOT TO LOOK FOR JOBS/EXECS ETC           
         MVI   JCLPARM,0           SET JCL THAT FOLLOWS PRODUCTION              
         BAS   RE,JCLOUT                                                        
         MVI   OUTSIN,C'X'                                                      
*                                                                               
FINAL3   CLI   ANYOUT,C'Y'         TEST IF ANY OUTPUT                           
         BNE   FINAL6                                                           
         CLI   SINGLE,0                                                         
         BE    FINAL4                                                           
         TM    PUTTYP,X'02'        TEST IF LAST CARD WAS EOJ CARD               
         BO    FINAL4                                                           
         MVI   JOBIND,C'I'         SET INCLUDING THIS JOB                       
         L     RE,=A(MVSEOJ)                                                    
         MVC   JCL,0(RE)                                                        
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
FINAL4   CLI   NETID,C' '          TEST FOR LAST NETWORK                        
         BE    FINAL5                                                           
         OI    NETFRST,X'02'       SET LAST JOB                                 
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
FINAL5   MVI   LASTOUT,C'Y'        SET NO MORE OUTPUT                           
*                                                                               
FINAL6   L     RF,=A(FILCLOSE)     CLOSE OUTPUT FILES                           
         BASR  RE,RF                                                            
         B     EOJ                                                              
         EJECT                                                                  
***********************************************************************         
*MISCELLANEOUS ROUTINES CALLED BY BASE CODE                           *         
***********************************************************************         
         GETEL R7,DATADISP,ELCODE                                               
         EJECT                                                                  
***********************************************************************         
*INPUT ROUTINES - READ RPF GROUP REQUESTS POINTED TO BY XFILE         *         
***********************************************************************         
GETREQ   GOTO1 =A(GRPRECS),PARA,REQINHN  GET NEXT RFP GROUP RECORD              
         BE    GETRQ20                                                          
         L     R7,AELEM            GET NEXT SYSTEM/GROUP RECORD                 
         MVI   ELCODE,X'30'                                                     
         BAS   RE,NEXTEL           GET NEXT ELEMENT                             
         BE    GETRQ10                                                          
         CP    REQCOUNT,=P'0'      TEST IF FIRST OF REQUESTS FOR GROUP          
         BE    GETGEND             NO, SO END THE JOB                           
         MVI   JCLPARM,2           END OF REQUESTS THEN                         
         BAS   RE,JCLOUT           OUTPUT REST OF JCL BOOK                      
         ZAP   REQCOUNT,=P'0'                                                   
         B     GETGEND             END OF JOB FOR GROUP                         
*                                                                               
         USING XFSGRPD,R7                                                       
GETRQ10  ST    R7,AELEM            A(ELEMENT)                                   
         MVC   SLSYSL,SVSYSL                                                    
         MVC   SLGRP,SVGRP                                                      
         CLC   SVSYSL,XFSGSYSL                                                  
         BE    GETGMORE                                                         
         MVI   NEWSYS,C'Y'                                                      
         B     GETGMORE            END OF REQUEST FOR THIS GROUP                
         DROP  R7                                                               
*                                                                               
GETRQ20  TM    TRACE,X'04'         TEST IF TRACING REQUESTS INPUT               
         BZ    GETRQ22                                                          
         GOTO1 =A(GRPTRACE),PARA,REQINHN,1                                      
*                                                                               
GETRQ22  CLC   REQINCD1(2),=C'99'  IGNORE CANCELS                               
         BE    GETREQ                                                           
         CLI   REQINCD1,X'FF'      AND END OF CHAINS                            
         BE    GETREQ                                                           
*                                                                               
         LA    R6,REQINHN          GET DATE OF REQUEST FROM HEADER              
         USING REQHDRD,R6                                                       
         MVC   DATE,TODAY          DEFAULT TO TODAYS DATE                       
         OC    RQHPJDT,RQHPJDT     TEST FOR JULIAN DATE IN NEW HDR              
         BZ    GETRQ30                                                          
         SR    R1,R1               CONVERT TO MVS FORMAT                        
         ICM   R1,7,RQHPJDT                                                     
         SLL   R1,4                                                             
         ST    R1,FULL                                                          
         OI    FULL+3,X'0F'                                                     
         GOTO1 =V(DATCON),PARA,(6,FULL),(0,DATE)                                
*                                                                               
GETRQ30  CLC   SAVENODT,SPACES     EXCLUDE DATE FILTER                          
         BE    GETRQ32                                                          
         CLC   SAVENODT,DATE                                                    
         BNE   GETRQ34                                                          
         B     GETRQ40                                                          
*                                                                               
* * THIS CODE MUST NOT WORK TOO WELL, ALL END UP AT GETRQ40                     
*                                                                               
GETRQ32  CLC   SAVEDATE,SPACES     INCLUDE DATE FILTER                          
         BE    GETRQ34                                                          
         CLC   SAVEDATE,DATE                                                    
         BE    GETRQ34                                                          
         B     GETRQ40                                                          
*                                                                               
GETRQ34  CLC   DATE,TODAY          IF NOTHING SPECIFIED                         
         BE    GETRQ40             TODAYS DATE IS OK                            
*                                                                               
GETRQ40  CP    REQJOBCT,=P'0'      TEST IF FIRST REQUEST OF JOB                 
         BNE   GETRQ50                                                          
         MVC   SVREQID,REQINCD1                                                 
         MVC   SVREQOT,REQINHN+(RQHOUT-RQHHDR)                                  
         B     GETRQ54                                                          
*                                                                               
GETRQ50  CLI   NEWSYS,C'Y'         SAME SYSTEM AS LAST?                         
         BNE   GETRQ52                                                          
         MVC   SVREQID,REQINCD1    PROGRAM CODE IS 1ST TWO CHRS OF REQ          
         MVI   NEWSYS,C'N'                                                      
         B     GETRQ56                                                          
*                                                                               
GETRQ52  CLC   SVREQID,REQINCD1    TEST IF THIS REQ SAME AS LAST                
         BE    GETRQ90                                                          
         MVC   SVREQID,REQINCD1    PROGRAM CODE IS 1ST TWO CHRS OF REQ          
*                                                                               
GETRQ54  CP    REQCOUNT,=P'0'      TEST IF FIRST OF REQUESTS FOR GROUP          
         BE    GETRQ60                                                          
*                                                                               
GETRQ56  MVI   JCLPARM,2           SET END OF REQUESTS                          
         BAS   RE,JCLOUT           OUTPUT REST OF JCL BOOK                      
         ZAP   REQCOUNT,=P'0'                                                   
*                                                                               
GETRQ60  MVC   QPROGRAM,SVREQID    PROGRAM FROM REQUEST CARD                    
         L     RF,=A(GETSYS)                                                    
         BASR  RE,RF                                                            
         BE    GETREQ              SYSTEM NOT DEFINED IN SYSTBL                 
*                                                                               
         MVC   QJOBMVS(1),QSYSTEM                                               
         MVC   QJOBMVS+1(2),QPROGRAM                                            
         MVI   QJOBMVS+3,C'0'                                                   
         MVC   QJOBJES+4(4),QJOBMVS                                             
*                                                                               
         MVC   QOUTTYPE,=CL6'DOWN' DEFAULT TO DOWN                              
         CLI   SVREQOT,C'@'                                                     
         BNE   *+10                                                             
         MVC   QOUTTYPE,SVREQOT    UNLESS @XXXXX SQL IN FIRST REQUEST           
*                                                                               
         MVC   THISJCL,SPACES      SET UP JCL KEY FOR THIS JOB                  
         MVC   THISJCL(2),QJOBSYS                                               
         CLC   THISJCL(2),=C'PR'   PRINT USES PP NOT PR                         
         BNE   *+10                                                             
         MVC   THISJCL(2),=C'PP'                                                
         CLC   THISJCL(2),=C'NE'   NETWORK USES SP                              
         BNE   *+10                                                             
         MVC   THISJCL(2),=C'SP'                                                
         MVI   THISJCL+2,C'0'                                                   
         MVC   THISJCL+3(2),QPROGRAM                                            
         MVC   THISJCL+5(1),JCLOPT                                              
         CLI   QJOBJCL,C' '        OPTIONAL JCL SPECIFIED                       
         BE    *+10                                                             
         MVC   THISJCL,QJOBJCL                                                  
         MVI   JCLPARM,1           SET JCL FOR REQUEST                          
         BAS   RE,JCLOUT           OUTPUT JCL THAT PRECEEDS REQUESTS            
*                                                                               
GETRQ90  BAS   RE,PUTREQ           OUTPUT REQUEST CARDS                         
         B     GETREQ                                                           
         EJECT                                                                  
***********************************************************************         
*ROUTINE TO READ JCL STATEMENTS FROM PAN LIBRARY                      *         
***********************************************************************         
JCLOUT   NTR1                                                                   
         LLC   R2,JCLPARM          SET TO 0,1,2,3                               
         MVI   JCLIF,C'Y'          PRESET CONDITIONAL SWITCH                    
         MVI   IS_SYSIN,C'N'       PRESET TO NO                                 
         MVC   NOTFJCL,SPACES                                                   
         L     RF,=A(SETSUB)                                                    
         BASR  RE,RF                                                            
         CLI   JCLPARM,1           TEST JCL THAT PRECEEDS REQUESTS              
         BNE   JCLOUT1                                                          
*                                                                               
         MVI   SYSPMODE,C' '       SET SYSPRINT MODE TO NORMAL                  
         CLI   SYSPOUT,C'O'                                                     
         BNE   *+8                                                              
         MVI   SYSPMODE,C'O'       SET IF SYSPRINT=OUTPUT                       
         CLI   AFP,C' '                                                         
         BE    *+8                                                              
         MVI   SYSPMODE,C'O'       SET IF AFP=XXXXXXXX                          
         CLI   SYSPOUT,C'D'                                                     
         BNE   *+8                                                              
         MVI   SYSPMODE,C'D'       SET IF SYSPRINT=DUMMY                        
*                                                                               
         MVI   OUTAFP,C'N'         SET MVS AFP CARD NOT OUTPUT                  
         MVI   OUTSYP,C'N'         SET MVS SYSPRINT CARD NOT OUTPUT             
         ZAP   FSTEXEC,=P'0'       SET MVS FIRST EXEC CARD                      
         ZAP   OUTCRDN,=P'0'       SET MVS FIRST OUTPUT CARD NUMBER             
         ZAP   OUTCRDF,=P'0'                                                    
         ZAP   OUTCRDL,=P'0'                                                    
         MVI   THSJCL,0            SET MVS THIS JCL CARD FLAG                   
         MVI   LSTJCL,0            SET MVS LAST JCL CARD FLAG                   
         MVC   STEPNAME,SPACES     SET MVS STEPNAME                             
         MVC   STEPNAMF,SPACES     SET MVS STEPNAME FIRST                       
         MVC   STEPNAMP,SPACES     SET MVS STEPNAME PREVIOUS                    
         L     RF,=A(IMVSJCL)      INITIALISE MVS JCL                           
         BASR  RE,RF                                                            
         BAS   RE,PUTJOBC          RELEASE MVS // JOB CARD                      
*                                                                               
JCLOUT1  CLC   JCL(13),=C'REQUESTS HERE'                                        
         BNE   JCLOUT2                                                          
         MVC   JCL,SPACES          IF PREVIOUSLY MERGING REQUESTS               
         MVC   JCL(2),=C'**'                                                    
         L     RF,=A(PUTJCL)       SET END OF REQUESTS                          
         BASR  RE,RF                                                            
*                                                                               
JCLOUT2  CLI   JCLPARM,1           TEST IF NEED TO SET UP JCL KEY               
         BH    JCLOUT4                                                          
         MVC   PANBOOK(2),=C'JC'   MVS SET KEY FOR PAN LIBRARY                  
         MVC   PANBOOK+2(8),THISJCL                                             
*NOP*    CLC   THISJCL(2),=C'NE'   IS IT NET?                                   
*NOP*    BNE   JCLOUT4                                                          
*NOP*    MVC   THISJCL(2),=C'SP'   USE SPOT JCL INSTEAD                         
*                                                                               
JCLOUT4  MVC   JCL,SPACES          GET NEXT PAN JCL BOOK STATEMENT              
*                                                                               
JCLOUTP  GOTO1 =V(PANIC),PARA,(X'80',=C'READ'),=C'PAN',PANBOOK,JCL              
         TM    PARA+8,X'10'        WAS BOOK FOUND OK                            
         BZ    JCLOUTP2                                                         
         CLI   NOTFJCL,C' '        NO-SAVE NAME OF FIRST ATTEMPT                
         BNE   *+10                                                             
         MVC   NOTFJCL,THISJCL                                                  
         CLI   JCLPARM,1           TEST IF JCL FOR REQUEST                      
         BNE   JCLOUTP2                                                         
JCLOUTP1 CLC   THISJCL+3(2),=C'00' TEST IF DEFAULT PROGRAM                      
         BE    JCLOUTP2                                                         
         MVC   THISJCL+3(2),=C'00' TRY DEFAULT PROGRAM                          
         B     JCLOUT2                                                          
*                                                                               
JCLOUTP2 MVC   JCL+72(8),SPACES    SEQUENCE NUMBERS LOOK MESSY                  
         TM    PARA+8,X'80'        CHECK END OF BOOK                            
         BO    JCLOUT5                                                          
         CLI   PARA+8,0            ANY ERROR CONDITIONS                         
         BE    JCLOUT6                                                          
         MVC   P,SPACES                                                         
         GOTO1 =V(PRINTER)                                                      
         MVC   P(15),=C'PAN ERROR BOOK='                                        
         MVC   P+15(10),NOTFJCL                                                 
         MVC   P+26(10),=C'NOT FOUND '                                          
         TM    PARA+8,X'10'                                                     
         BO    *+10                                                             
         MVC   P+26(10),=C'DISK ERROR'                                          
         BASR  RE,RF                                                            
         BASR  RE,RF                                                            
*                                                                               
JCLOUT5  B     JCLOUTX1            END OF JCL BOOK                              
*                                                                               
JCLOUT6  OC    JCL,SPACES          PROCESS JCL CARD                             
         CLC   JCL,SPACES                                                       
         BE    JCLOUT4             IGNORE BLANK CARD                            
*                                                                               
         CLI   DSPACE,C'A'         PRODUCTION                                   
         BE    JCLOUTZ9            DON'T HAVE TO INSERT DSPACE                  
         CLC   JCL(8),=C'//SYSIN ' JCL STATEMENTS?                              
         BNE   JCLOUTZ8                                                         
         MVI   IS_SYSIN,C'Y'       SYSIN FOUND                                  
         B     JCLOUTZ9                                                         
*                                                                               
JCLOUTZ8 CLC   JCL(2),=C'//'                                                    
         BE    JCLOUTZ9                                                         
         CLI   IS_SYSIN,C'Y'       YES HAD SYSIN                                
         BNE   JCLOUTZ9                                                         
         MVI   SETDSPC,C'Y'        SET DSPACE CARD                              
*                                                                               
JCLOUTZ9 CLC   JCL(7),=C'SPACEND'  REP SPACEND CARD                             
         BNE   JCLOUT6A                                                         
         CLI   REPSPACE,C'N'       IF SO, WRAP CONTROL CARD CAN STOP IT         
         BE    JCLOUT4                                                          
*                                                                               
JCLOUT6A MVI   RCMSW,C'N'                                                       
         CLC   JCL(13),=C'REQUESTS HERE'                                        
         BE    JCLOUT6B            SPECIAL CARD TELLS US TO GET OUT             
         MVI   RCMSW,C'O'                                                       
         CLC   JCL(8),=C'OLD SPOT REQUESTS'                                     
         BNE   JCLOUT7                                                          
JCLOUT6B L     RF,=A(EXTRA)                                                     
         BASR  RE,RF                                                            
         B     JCLOUTX2                                                         
*                                                                               
JCLOUT7  CLC   JCL(12),=C'DESTINATION='                                         
         BNE   JCLOUT7A                                                         
         MVC   JCL+12(33),QJOBDNAM SUBSTITUTION FOR DESTINATION CARD            
         MVC   JCL+45(33),QJOBDADD                                              
JCLOUT7A CLC   JCL(6),=C'DEST2='                                                
         BNE   JCLOUT8                                                          
         MVC   JCL+6(33),QJOBDAD2  SUBSTITUTION FOR DEST2 CARD                  
         MVC   JCL+39(33),QJOBDAD3                                              
*                                                                               
JCLOUT8  CLC   JCL(05),=C'LOGO='                                                
         BNE   JCLOUT9                                                          
         MVC   JCL+5(7),QJOBLOG1   SUBSTITUTION FOR LOGO CARD                   
         MVC   JCL+12(7),QJOBLOG2                                               
         MVC   JCL+19(8),QJOBJES                                                
         EDIT  (2,QDEST),(5,JCL+27),FILL=0                                      
         MVC   JCL+33(7),=C'ORIGIN='                                            
         EDIT  (2,QORIGIN),(5,JCL+40),FILL=0                                    
*                                                                               
JCLOUT9  CLC   JCL(07),=C'DITTOD=' DITTO LAST GENERATED DIRECT=... CARD         
         BNE   JCLOUT10                                                         
         L     RE,=A(LDIRECT)                                                   
         CLI   0(RE),C' '                                                       
         BE    JCLOUT4             IGNORE IF NOT GENERATED PREVIOUSLY           
         MVC   DUB(3),JCL+7        SAVE PQ REPORT NAME                          
         MVC   JCL,0(RE)                                                        
         CLI   DUB,C' '                                                         
         BE    *+10                                                             
         MVC   JCL+7(3),DUB        SET REPORT ID FROM DITTOD=XYZ CARD           
*                                                                               
JCLOUT10 L     RF,=A(SUBTABLE)     CHECK FOR USER SELECTED SCAN/REPS            
         OC    0(4,RF),0(RF)       TEST NO VALUES IN TABLE                      
         BZ    JCLOUT11                                                         
         GOTO1 =V(REPLACE),PARA,(80,JCL),(66,(RF))                              
*                                                                               
JCLOUT11 L     RF,=A(SOFTABLE)     LOOK FOR SOFT JCL                            
         OC    0(4,RF),0(RF)       TEST NO VALUES IN TABLE                      
         BZ    JCLOUT12                                                         
         GOTO1 =V(REPLACE),PARA,(80,JCL),(RF)                                   
*                                                                               
JCLOUT12 L     RF,LOADADDR                                                      
         GOTO1 (RF),PARA,JCL       GO TO OPTIONAL LOADED FIX                    
         CLC   JCL(6),=C'IF END'   CHECK FOR CONDITIONAL END                    
         BNE   JCLOUT13                                                         
         MVI   JCLIF,C'Y'                                                       
         B     JCLOUT4                                                          
*                                                                               
JCLOUT13 CLC   JCL(3),=C'IF '      CHECK FOR IF CONDITIONAL                     
         BNE   JCLOUT14                                                         
         MVI   JCLIF,C'N'                                                       
         B     IF                                                               
*                                                                               
JCLOUT14 CLC   JCL(3),=C'OR '      CHECK FOR OR CONDITIONAL                     
         BE    IF                                                               
         CLC   JCL(4),=C'AND '     CHECK FOR AND CONDITION                      
         BNE   JCLOUT15                                                         
         CLI   JCLIF,C'N'          PREVIOUS IF CONDITION MUST                   
         BE    JCLOUT4             HAVE BEEN SATISFIED                          
         MVC   JCL(79),JCL+1       MAKE IT NOW ND CONDITION                     
         MVI   JCLIF,C'N'                                                       
         B     IF                                                               
*                                                                               
JCLOUT15 EQU   *                                                                
*                                                                               
JCLOUT16 CLC   JCL(08),=C'LOGDATA='                                             
         BNE   JCLOUT18                                                         
         MVC   JCL(1),JCL+8        GENERATE DATA CARD FOR S/A LOGO              
         EDIT  (2,QDEST),(5,JCL+1),FILL=0                                       
         MVC   JCL+6(8),QJOBJES                                                 
*                                                                               
JCLOUT18 CLC   JCL(8),=C'ORIGIN= '                                              
         BNE   JCLOUT20                                                         
         MVC   JCL+7(33),QJOBONAM                                               
         MVC   JCL+40(33),QJOBOADD                                              
*                                                                               
JCLOUT20 CLC   JCL(16),=CL16'CHECKPOINT'                                        
         BNE   JCLOUT22                                                         
         MVC   JCL+15(22),=C'PAGES=500,TIME=30,KEY='                            
         MVC   JCL+37(8),QJOBJES                                                
*                                                                               
JCLOUT22 CLI   JCLIF,C'Y'          IS SELECTIVE JCL IN OPERATION                
         BNE   JCLOUT4                                                          
         L     RF,=A(JCLCHK)       CHECK MVS JCL                                
         BASR  RE,RF                                                            
         BNE   JCLOUT4             AND BYPASS IF DELETED                        
         L     RF,=A(PUTJCL)       LET HER RIP                                  
         BASR  RE,RF                                                            
         B     JCLOUT4                                                          
*                                                                               
JCLOUTX1 LTR   RB,RB               EXIT WITH CC EQL                             
         B     *+6                                                              
JCLOUTX2 CR    RB,RB               EXIT WITH CC NEQ                             
         XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
*CONDITIONAL STATEMENT CONTROL FLOW                                   *         
***********************************************************************         
IF       CLC   JCL+3(7),=C'AGENCY='                                             
         BE    IF2                                                              
         CLC   JCL+3(8),=C'AGENCY!='                                            
         BE    IF3                                                              
         CLC   JCL+3(6),=C'MEDIA='                                              
         BE    IF4                                                              
         CLC   JCL+3(8),=C'COMPANY='                                            
         BE    IF6                                                              
         CLC   JCL+3(7),=C'OUTPUT='                                             
         BE    IF8                                                              
         CLC   JCL+3(12),=C'DESTINATION='                                       
         BE    IF10                                                             
         CLC   JCL+3(08),=C'PROGRAM='                                           
         BE    IF12                                                             
         CLC   JCL+3(8),=C'SPECIAL='                                            
         BE    IF14                                                             
         CLC   JCL+3(7),=C'SYSTEM='                                             
         BE    IF16                                                             
         CLC   JCL+3(8),=C'HEXCOMP='                                            
         BE    IF18                                                             
         CLC   JCL+3(7),=C'LEDGER='                                             
         BE    IF20                                                             
         CLC   JCL+3(7),=C'ORIGIN='                                             
         BE    IF22                                                             
         B     IFX                                                              
*                                                                               
IF2      CLC   JCL+10(2),QUSER     MATCH ON AGENCY                              
         BNE   IFX                                                              
         B     IFYES                                                            
*                                                                               
IF3      CLC   JCL+10(2),QUSER     MATCH ON NOT AGENCY                          
         BE    IFX                                                              
         B     IFYES                                                            
*                                                                               
IF4      CLC   JCL+9(1),QSUBUSER   MATCH ON MEDIA                               
         BNE   IFX                                                              
         B     IFYES                                                            
*                                                                               
IF6      L     RE,=A(SOFTCOMP)     MATCH ON COMPANY                             
         CLC   JCL+11(1),0(RE)                                                  
         BNE   IFX                                                              
         B     IFYES                                                            
*                                                                               
IF8      CLC   JCL+10(6),QOUTTYPE  MATCH ON OUTPUT TYPE                         
         BNE   IFX                                                              
         B     IFYES                                                            
*                                                                               
IF10     MVC   DUB(2),QDEST        DESTINATION=NNNNNN                           
         LH    R0,DUB                                                           
         CVD   R0,DUB                                                           
         UNPK  WORK(6),DUB                                                      
         OI    WORK+5,X'F0'                                                     
         CLC   WORK(6),JCL+15                                                   
         BNE   IFX                                                              
         B     IFYES                                                            
*                                                                               
IF12     CLC   JCL+11(2),QPROGRAM                                               
         BNE   IFX                                                              
         B     IFYES                                                            
*                                                                               
IF14     CLC   JCL+11(1),QOUTSPEC                                               
         BNE   IFX                                                              
         B     IFYES                                                            
*                                                                               
IF16     CLC   JCL+10(3),QSYSTEM                                                
         BNE   IFX                                                              
         B     IFYES                                                            
*                                                                               
IF18     L     RE,=A(SOFTCOMP)                                                  
         ST    RE,PARA                                                          
         GOTO1 =V(HEXOUT),PARA,,DUB,1                                           
         CLC   JCL+11(2),DUB                                                    
         BNE   IFX                                                              
         B     IFYES                                                            
*                                                                               
IF20     CLC   JCL+10(1),QSUBUSER                                               
         BNE   IFX                                                              
         B     IFYES                                                            
*                                                                               
IF22     MVC   DUB(2),QORIGIN      ORIGIN=NNNNNN                                
         LH    R0,DUB                                                           
         CVD   R0,DUB                                                           
         UNPK  WORK(6),DUB                                                      
         OI    WORK+5,X'F0'                                                     
         CLC   WORK(6),JCL+10                                                   
         BNE   IFX                                                              
         B     IFYES                                                            
*                                                                               
IFYES    MVI   JCLIF,C'Y'          SET IF CONDITION TRUE                        
*                                                                               
IFX      B     JCLOUT4             GO GET NEXT JCL INPUT                        
         EJECT                                                                  
***********************************************************************         
*PUT JCL CARDS                                                        *         
***********************************************************************         
PUTJOBC  NTR1                      PUT MVS JOB CARD                             
         CLI   OUTJOB,C'Y'                                                      
         BE    PUTJOBCX                                                         
         MVI   OUTJOB,C'Y'                                                      
         AP    TOTJOB,=P'1'        BUMP JOB NUMBER                              
         UNPK  DUB,TOTJOB                                                       
         OI    DUB+7,C'0'                                                       
         L     R1,=A(JJ1)                                                       
         MVC   7(3,R1),DUB+5       MOVE JOB NUMBER TO JOB CARD                  
         CLI   USEMYJOB,C'Y'                                                    
         BE    PUTJOBC5                                                         
*                                                                               
PUTJOBC1 CLI   0(R1),C' '          EXIT ON FIRST BLANK CARD                     
         BE    PUTJOBC2                                                         
         MVC   JCL,0(R1)                                                        
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
         LA    R1,80(R1)                                                        
         B     PUTJOBC1                                                         
*                                                                               
PUTJOBC2 CLI   USEMYJOB,C'A'       TEST TO APPEND INPUT JOB CARDS               
         BNE   PUTJOBCX                                                         
         L     R1,=A(JCLIN)        POINT TO INPUT EXTRA JOB CARDS               
PUTJOBC3 CLI   0(R1),C' '          EXIT ON FIRST BLANK CARD                     
         BE    PUTJOBCX                                                         
         MVC   JCL,0(R1)                                                        
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
         LA    R1,80(R1)                                                        
         B     PUTJOBC3                                                         
*                                                                               
PUTJOBC5 L     R1,=A(JCLIN)        USE INPUT JOB CARDS                          
         SR    R0,R0                                                            
         CLI   0(R1),C' '                                                       
         BNE   PUTJOBC6                                                         
         L     R1,=A(JJ1)          USE GENERATED IF NONE INPUT                  
         B     PUTJOBC1                                                         
PUTJOBC6 CLI   0(R1),C' '          EXIT ON FIRST BLANK CARD                     
         BE    PUTJOBCX                                                         
         MVC   JCL,0(R1)                                                        
         LTR   R0,R0               TEST FIRST INPUT JOB CARD                    
         BNZ   PUTJOBC7                                                         
         LA    R0,1                                                             
         L     RF,=A(JJ1)          MOVE MY JOB NAME TO FIRST CARD               
         MVC   JCL+2(8),2(RF)                                                   
PUTJOBC7 L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
         LA    R1,80(R1)                                                        
         B     PUTJOBC6                                                         
*                                                                               
PUTJOBCX XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
*ADD ON SOME EXTRA CONTROLLER CARDS TO JCL WHEN "REQUESTS HERE" FOUND *         
***********************************************************************         
EXTRA    NTR1                                                                   
         L     RF,=A(JCLCHK)       CHECK MVS JCL CARD                           
         BASR  RE,RF                                                            
         CLC   JCL(8),=C'OLD SPOT REQUESTS'                                     
         BE    EXTRA4                                                           
*                                                                               
EXTRA0   MVC   JCL,SPACES          ALWAYS OUTPUT A DATE= CARD                   
         MVC   JCL(5),=C'DATE='                                                 
         MVC   JCL+5(8),TODAYDMY   USE TODAYS DATE OR DATE= CARD VALUE          
         CLI   TODAYJOB,C'Y'       TEST IF DATE=CREATE INPUT                    
         BNE   EXTRA0A             NO                                           
         CLI   QJOBDATE,C'0'       TEST IF JOB RECORD HAS CREATION DATE         
         BL    EXTRA0A                                                          
         MVC   JCL+5(8),QJOBDATE   YES-USE JOB CREATION DATE                    
EXTRA0A  L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
EXTRA0B  CLI   ACCEMU,C'E'         TEST IF EMULATING ACCOUNT FILE               
         BNE   EXTRA0C                                                          
         MVC   JCL,SPACES                                                       
         MVC   JCL(10),=C'DMPARM=EMU'                                           
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
EXTRA0C  CLI   PORFDEFS,0          TEST IF PAGEDEF OR FORMDEF OUTPUT            
*&&UK*&& BE    EXTRA1                                                           
*&&US*&& B     EXTRA1                                                           
         CLC   QJOBFMD(5),=C'BASIC'                                             
         BE    EXTRA1                                                           
         MVC   JCL,SPACES                                                       
         MVC   JCL(9),=C'FORMDEF=Y'                                             
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
EXTRA1   MVC   JCL,SPACES                                                       
         MVC   JCL(2),QJOBSYS                                                   
*&&US                                                                           
         CLI   SVSYSL,C'N'         NET                                          
         BNE   *+10                                                             
         MVC   JCL(2),=C'NE'                                                    
         CLC   JCL(2),=C'PR'                                                    
         BNE   *+10                                                             
         MVC   JCL(2),=C'PP'                                                    
*&&                                                                             
         MVI   JCL+2,X'F0'                                                      
         MVC   JCL+3(2),QPROGRAM                                                
         CLC   JCL(2),=C'CO'       CONTROL USES CTNN                            
         BNE   *+16                                                             
         MVC   JCL(2),=C'CT'                                                    
         MVC   JCL+2(3),JCL+3                                                   
*                                                                               
         L     R1,=A(PGMEQTAB)                                                  
EXTRA1A  CLI   0(R1),X'FF'                                                      
         BE    EXTRA1X                                                          
         CLC   JCL(5),0(R1)                                                     
         BE    *+12                                                             
         LA    R1,L'PGMEQTAB(R1)                                                
         B     EXTRA1A                                                          
         MVC   JCL(5),5(R1)                                                     
EXTRA1X  DS    0H                                                               
         MVC   JCL+5(3),QUSER                                                   
         CLI   JCL+7,C' '                                                       
         BH    *+8                                                              
         MVI   JCL+7,C' '                                                       
         CLI   JCL,C'P'            PRINT DOESNT NEED MEDIA FILTER               
         BNE   *+8                                                              
         MVI   JCL+7,C' '                                                       
         CLC   QJOBSYS(2),=C'ME'   MEDLINE USES SSPP CARD (NOT SS0PP)           
         BE    EXTRA2                                                           
         CLC   QJOBSYS(2),=C'PE'   PERSON USES SSPP CARD (NOT SS0PP)            
         BE    EXTRA2                                                           
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
EXTRA2   CLI   ANYLOGO,C'N'        OPTION TO SKIP LOGOS                         
         BE    EXTRAB                                                           
*                                                                               
EXTRA4   MVC   JCL,SPACES                                                       
         MVC   JCL(5),=C'LOGO='                                                 
         MVC   JCL+5(14),QJOBLOG1                                               
         MVC   JCL+19(8),QJOBJES                                                
         EDIT  (2,QDEST),(5,JCL+27),FILL=0                                      
         MVC   JCL+33(7),=C'ORIGIN='                                            
         EDIT  (2,QORIGIN),(5,JCL+40),FILL=0                                    
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
EXTRA5   CLI   LOGOADR,C' '                                                     
         BE    EXTRA6                                                           
         MVC   JCL,SPACES                                                       
         MVC   JCL(8),=C'LOGOADR='                                              
         MVC   JCL+8(1),LOGOADR                                                 
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
EXTRA6   MVC   JCL(12),=C'DESTINATION='                                         
         MVC   JCL+12(33),QJOBDNAM                                              
         MVC   JCL+45(33),QJOBDADD                                              
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         MVC   JCL,SPACES                                                       
         MVC   JCL(6),=C'DEST2='                                                
         MVC   JCL+6(33),QJOBDAD2                                               
         MVC   JCL+39(33),QJOBDAD3                                              
         CLC   JCL+6(66),SPACES                                                 
         BE    *+10                                                             
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         MVC   JCL,SPACES                                                       
         MVC   JCL(5),=C'SHIP='                                                 
         MVC   JCL+5(75),QJOBSHIP                                               
         CLI   RCMSW,C'O'                                                       
         BNE   *+14                                                             
         MVI   JCL+7,C' '                                                       
         MVC   JCL+8(72),QJOBPACK                                               
         CLC   JCL+5(75),SPACES                                                 
         BE    *+10                                                             
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         MVC   JCL,SPACES                                                       
         MVC   JCL(5),=C'SHP2='                                                 
         MVC   JCL+5(75),QJOBSHIP+75                                            
         CLC   JCL+5(75),SPACES                                                 
         BE    *+10                                                             
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         MVC   JCL,SPACES                                                       
         MVC   JCL(5),=C'BRK1='                                                 
         MVC   JCL+5(75),QJOBPACK                                               
         CLC   JCL+5(75),SPACES                                                 
         BE    *+10                                                             
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         MVC   JCL,SPACES                                                       
         MVC   JCL(5),=C'BRK2='                                                 
         MVC   JCL+5(75),QJOBPACK+75                                            
         CLC   JCL+5(75),SPACES                                                 
         BE    *+10                                                             
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         L     R1,=A(MVSSPOOL)     OPTIONAL SPOOL TO TAPE                       
         MVC   JCL(80),0(R1)                                                    
         CLI   ANYSPLTP,C'Y'                                                    
         BNE   *+10                                                             
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
         MVI   ANYSPLTP,C'N'                                                    
*                                                                               
         MVC   JCL,SPACES          RETAIN CLASS                                 
         MVC   JCL(7),=C'RETAIN='                                               
         MVC   JCL+7(1),QJOBRETC                                                
         CLI   QJOBRETC,X'41'                                                   
         BL    *+10                                                             
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         CLI   QSYSTEM,C'S'                                                     
         BE    EXTRAA                                                           
         CLI   QSYSTEM,C'P'                                                     
         BE    EXTRAA                                                           
         CLI   QSYSTEM,C'A'                                                     
         BNE   EXTRAB                                                           
         B     EXTRAB                                                           
*                                                                               
EXTRAA   MVC   JCL,SPACES                                                       
         MVC   JCL(7),=C'ORIGIN='                                               
         MVC   JCL+7(33),QJOBONAM                                               
         MVC   JCL+40(33),QJOBOADD                                              
         CLC   JCL+7(66),SPACES                                                 
         BE    *+10                                                             
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
         CLI   RCMSW,C'O'                                                       
         BE    EXTRAS                                                           
*                                                                               
EXTRAB   MVC   JCL,SPACES                                                       
         MVC   JCL(10),=C'INPUT=CARD'                                           
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         MVC   JCL,SPACES          XFILE REQUESTS ARE READ ONLY                 
         MVC   JCL(8),=C'WRITE=NO'                                              
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         L     RF,=A(ANYDIR)                                                    
         BASR  RE,RF                                                            
         MVC   JCL,SPACES                                                       
         LA    R2,QJOBPHS                                                       
         LA    R3,1                                                             
EXTRAB2  CLI   0(R2),X'41'                                                      
         BL    EXTRAB4                                                          
         MVC   JCL(8),=C'TEST=00X'                                              
         STC   R3,JCL+6                                                         
         OI    JCL+6,X'F0'                                                      
         MVC   JCL+7(1),0(R2)                                                   
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
         MVC   JCL,SPACES                                                       
*                                                                               
EXTRAB4  LA    R2,1(R2)                                                         
         LA    R3,1(R3)                                                         
         CHI   R3,5                                                             
         BL    EXTRAB2                                                          
*                                                                               
         CLC   QJOBSYS(2),=C'ME'                                                
         BE    *+14                                                             
         CLC   QJOBSYS(2),=C'PE'                                                
         BNE   EXTRAB6                                                          
*                                  MEDIA/PERSON SYSTEMS EXTRA CARDS             
         MVC   JCL,SPACES                                                       
         MVC   JCL(2),QJOBSYS                                                   
         MVC   JCL+2(2),QPROGRAM                                                
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         MVC   JCL,SPACES                                                       
         MVC   JCL(7),=C'AGENCY='                                               
         MVC   JCL+7(2),QUSER                                                   
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         MVC   JCL,SPACES                                                       
         CLI   QSUBUSER,X'41'                                                   
         BL    EXTRAB6                                                          
         MVC   JCL(6),=C'MEDIA='                                                
         MVC   JCL+6(1),QSUBUSER                                                
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
EXTRAB6  MVC   JCL,SPACES                                                       
         MVC   JCL(2),=C'/*'                                                    
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
         MVC   JCL(13),=C'REQUESTS HERE'                                        
         B     EXTRAX                                                           
*                                                                               
EXTRAS   MVC   JCL,SPACES                                                       
         L     RF,=A(ANYDIR)                                                    
         BASR  RE,RF                                                            
         MVC   JCL(4),=C'CARD'                                                  
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         MVC   JCL(7),=C'PRINTER'                                               
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         MVC   JCL,SPACES                                                       
         MVC   JCL(2),QJOBSYS                                                   
         MVI   JCL+2,C'0'                                                       
         MVC   JCL+3(2),QPROGRAM                                                
         MVC   JCL+5(2),QUSER                                                   
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*                                                                               
         MVC   JCL(13),=C'REQUESTS HERE'                                        
EXTRAX   XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
*OUTPUT REQUEST CARD(S) FROM XFILE REQUEST RECORD                     *         
***********************************************************************         
PUTREQ   NTR1                                                                   
         CLI   JOBIND,C'E'         EXIT IF EXCLUDING THIS JOB                   
         BE    PUTREQX                                                          
         MVC   LPUTTYP,PUTTYP      SAVE LAST PUTTYP                             
         MVI   PUTTYP,X'00'                                                     
         LA    R4,REQINCD1         R4=A(NEXT REQUEST CARD)                      
         CLI   QCARDS,0                                                         
         BE    PUTREQX                                                          
         MVI   QCTR,0              SET NUMBER OF CARDS OUTPUT                   
*                                                                               
PUTREQ1  CLI   RFHWANT,C'Y'        TEST IF WANT RFHDR= CARD                     
         BNE   PUTREQ2                                                          
         MVC   JESIOA(6),=C'RFHDR='                                             
         GOTO1 =V(HEXOUT),PARA,REQINHN+12,JESIOA+6,36,=C'TOG'                   
         L     RF,=A(PUTALL)                                                    
         BASR  RE,RF                                                            
*                                                                               
PUTREQ2  MVC   JESIOA,0(R4)        MOVE NEXT CARD TO OUTPUT AREA                
         CLI   QCTR,0              TEST FIRST REQUEST CARD                      
         BNE   PUTREQ3                                                          
         CLI   QSYSTEM,C'A'        GIVE BACK COL 80 TO ACCOUNT                  
         BE    PUTREQ3                                                          
         TM    JESIOA+79,X'40'     COL 80 OF 1ST REQ CARD IS DDS FLAG           
         BO    PUTREQ3                                                          
         OI    JESIOA+79,X'40'                                                  
*                                                                               
PUTREQ3  L     RF,=A(PUTALL)       OUTPUT REQUEST CARD                          
         BASR  RE,RF                                                            
         LA    R4,80(R4)           BUMP TO NEXT CARD                            
         LLC   RF,QCTR             BUMP NUMBER OF REQUEST CARDS                 
         LA    RF,1(RF)                                                         
         STC   RF,QCTR                                                          
         CLM   RF,1,QCARDS                                                      
         BL    PUTREQ2             BACK FOR NEXT REQUEST CARD                   
         AP    REQCOUNT,=P'1'                                                   
         AP    REQJOBCT,=P'1'                                                   
*                                                                               
PUTREQX  XIT1                                                                   
         EJECT                                                                  
ENDMAIN  DS    0C                  ALL SUBROUTINES NOW BASE=* MODE              
         DROP  RA,R9                                                            
***********************************************************************         
*ROUTINE TO CREATE A PQ REPORT FOR XFILE JOB TO USE                   *         
***********************************************************************         
GETPQ    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
GETPQ1   TM    TESTMODE,X'40'      TEST TO USE DUMMY PQ ID FOR TESTING          
         BZ    GETPQ2                                                           
         MVC   SVPQUSR,SVXDEST                                                  
         MVC   SVPQID,=C'XFI'                                                   
         MVC   SVPQNO,=H'1234'                                                  
         MVC   SVPQDA,=H'1235'                                                  
         MVI   DMCB+8,0            SIMULATE GOOD PQ I/O                         
         CLI   DMCB+8,0                                                         
         B     GETPQX                                                           
*                                                                               
GETPQ2   L     R5,APQLINE          POINT TO FULL PRINT LINE FOR OPEN            
         USING PQPLD,R5                                                         
         XC    0(133,R5),0(R5)     MUST CLEAR ALL FIELDS IN WHOLE LINE          
         MVI   QLEXTRA,X'FF'       SET NEW CALL FLAG FOR EXTRA INFO             
*                                                                               
GETPQ3   MVC   QLSRCID,SVXDEST     SET REPORT USER ID                           
         MVC   QLSUBID,=C'XFI'     SET REPORT ID                                
         MVI   QLCLASS,C'X'        SET REPORT CLASS                             
         MVI   QLSTAT,X'00'        SET REPORT STATUS                            
         MVI   QLTYPE,QLTYDL       SET REPORT TYPE TO DOWN LOADABLE             
         CLI   QOUTTYPE,C'@'       UNLESS ITS AN SQL REPORT                     
         BNE   *+8                                                              
         MVI   QLTYPE,QLTYSQL                                                   
         MVI   QLATTB,X'00'        SET REPORT ATTRIBUTES                        
         MVI   QLLINET,X'C0'       SET LINE HAS CC CHR & FIXED LENGTH           
         MVI   QLLINEW,132         SET 132 CHR FIXED LENGTH PRINT LINE          
         MVC   QLRETNL,=H'21'      SET LIVE RETENTION HOURS                     
         MVC   QLRETND,=H'13'      SET DEAD RETENTION HOURS                     
         MVC   QLDESC,QJOBPQDS     SET DESCRIPTION TO XFILE CONVENTION          
*                                                                               
GETPQ4   GOTO1 =V(DATAMGR),DMCB,=C'DMPRINT',=C'PRTQU',0,(R5),APQBUFF            
         CLI   DMCB+8,0                                                         
         BE    GETPQ5                                                           
         TM    DMCB+8,X'80'        EOF - CANT ADD REPORT FOR USER ID            
         BO    GETPQE                                                           
         TM    DMCB+8,X'41'        FMT - INVALID OPEN INFO PASSED               
         BO    GETPQF                                                           
         B     GETPQD              DSK - DISK ERROR ON OPEN                     
*                                                                               
GETPQ5   MVC   SVPQUSR,QLSRCID     SAVE RETURNED REPORT USER ID                 
         MVC   SVPQID,QLSUBID      SAVE RETURNED REPORT SUB ID                  
         MVC   SVPQNO,QLREPRNO     SAVE RETURNED REPORT SEQ NUM                 
         MVC   SVPQDA,QLREPRCI     SAVE RETURNED DISK ADDR                      
*                                                                               
GETPQ6   MVI   0(R5),X'89'         SET SKIP TO TOP OF PAGE                      
         MVC   1(132,R5),SPACES                                                 
         GOTO1 =V(DATAMGR),DMCB,=C'DMPRINT',=C'PRTQU',0,(R5),APQBUFF            
         CLI   DMCB+8,0                                                         
         BNE   GETPQD              ERROR ON 1ST LINE - PROBABLY DISK            
*                                                                               
GETPQ7   MVI   0(R5),X'09'         SET SINGLE SPACE WRITE                       
         MVC   1(132,R5),SPACES                                                 
         MVC   1(037,R5),=CL37'XFILE REPORT SCHEDULED FOR PROCESSING'           
         GOTO1 =V(DATAMGR),DMCB,=C'DMPRINT',=C'PRTQU',0,(R5),APQBUFF            
         CLI   DMCB+8,0                                                         
         BNE   GETPQD              ERROR ON 2ND LINE - PROBABLY DISK            
*                                                                               
GETPQ8   MVI   0(R5),X'FF'         SET END OF REPORT                            
         GOTO1 =V(DATAMGR),DMCB,=C'DMPRINT',=C'PRTQU',0,(R5),APQBUFF            
         CLI   DMCB+8,0                                                         
         BE    GETPQX                                                           
         TM    DMCB+8,X'41'        FMT - PROBLEM WITH PRTQUE STRUCTURE          
         BO    GETPQF                                                           
         B     GETPQD              DSK - DISK ERROR ON WRITE                    
*                                                                               
GETPQD   LA    R1,1                DISK ERROR                                   
         B     GETPQERR                                                         
GETPQE   LA    R1,2                EOF - PRINT QUEUE FULL                       
         B     GETPQERR                                                         
GETPQF   LA    R1,3                FORMAT ERROR                                 
         B     GETPQERR                                                         
GETPQERR LTR   R1,R1                                                            
*                                                                               
GETPQX   MVC   SVPQERR,DMCB+8                                                   
         XIT1                      EXIT WITH CC EQL IF REPORT ADDED OK          
         DROP  R5                                                               
*                                                                               
         LTORG                                                                  
***********************************************************************         
*ROUTINE TO OUTPUT REQUESTS AND JCL                                   *         
***********************************************************************         
PUTJCL   NTR1  BASE=*,LABEL=*      OUTPUT JCL CARD                              
         CLI   JOBIND,C'E'                                                      
         BE    PUTJCLX             EXIT IF EXCLUDING THIS JOB                   
         MVC   LPUTTYP,PUTTYP      SAVE LAST PUTTYP                             
         MVI   PUTTYP,X'01'                                                     
         MVC   P,SPACES                                                         
         CLI   SETDSPC,C'Y'        INSERT DSPACE= CARD NOW                      
         BNE   PUTJCL0             NO                                           
         MVI   SETDSPC,C'N'        RESET                                        
         MVI   IS_SYSIN,C'N'                                                    
         MVC   JESIOA,SPACES                                                    
         MVC   JESIOA(7),=C'DSPACE='                                            
         MVC   JESIOA+7(1),DSPACE                                               
         L     RF,=A(PUTALL)                                                    
         BASR  RE,RF                                                            
*                                                                               
PUTJCL0  MVC   JESIOA,JCL                                                       
         CLC   FRSTNAME,SPACES     WAS FIRST JOB NAME INPUT                     
         BE    PUTJCL0B                                                         
         CLI   FRSTNAMF,C'Y'       TEST IF WE ALREADY DID THIS                  
         BNE   PUTJCL0B                                                         
         CLC   JCL(2),=C'//'       TEST IF JCL STATEMENT                        
         BNE   PUTJCL0B                                                         
         LA    RE,JCL+2            TEST IF JOB CARD                             
         LA    R0,16                                                            
         CLC   0(5,RE),=C' JOB '                                                
         BE    PUTJCL0A                                                         
         LA    RE,1(RE)                                                         
         BCT   R0,*-14                                                          
         B     PUTJCL0B                                                         
PUTJCL0A MVI   FRSTNAMF,C'N'       SET NOT FIRST JOB CARD ANYMORE               
         MVC   JCL+2(8),FRSTNAME   AND SET INPUT FIRST NAME                     
         MVC   JESIOA+2(8),JCL+2                                                
PUTJCL0B EQU  *                                                                 
*                                                                               
         CLI   NETID,C' '          TEST IF JES NETWORK REQUIRED                 
         BE    PUTJCL3                                                          
         TM    NETFRST,X'02'       TEST IF SPECIAL LAST CALL                    
         BO    PUTJCL2                                                          
         CLC   JCL(2),=C'//'       TEST IF JCL STATEMENT                        
         BNE   PUTJCL3                                                          
         CLI   JCL+2,C'*'                                                       
         BE    PUTJCL3                                                          
         CLC   JCL+2(40),SPACES    TEST EOJ STATEMENT                           
         BNE   PUTJCL1                                                          
         OI    NETEOJ,X'01'        SET EOJ CARD HELD FOR NETWORK CARD           
         B     PUTJCLX                                                          
*                                                                               
PUTJCL1  LA    RE,JCL+2            TEST IF JOB CARD                             
         LA    R0,16                                                            
         CLC   0(5,RE),=C' JOB '                                                
         BE    PUTJCL2                                                          
         LA    RE,1(RE)                                                         
         BCT   R0,*-14                                                          
         B     PUTJCL3                                                          
*                                                                               
PUTJCL2  MVC   JCLSAVE,JCL         SAVE THIS JOB CARD                           
         TM    NETEOJ,X'01'                                                     
         BZ    PUTJCL3             EXIT IF NO EOJ CARD PENDING                  
         MVC   JCL,SPACES                                                       
         LA    RE,JCL                                                           
         L     RF,=A(JESNET)                                                    
         MVC   0(18,RE),0(RF)                                                   
         MVC   18(8,RE),NETID      SET NETWORK ID                               
         LA    RE,18(RE)                                                        
         CLI   0(RE),C' '                                                       
         BE    *+12                                                             
         LA    RE,1(RE)                                                         
         B     *-12                                                             
         MVC   0(4,RE),=C',HC='                                                 
         LA    RE,4(RE)                                                         
         MVC   0(2,RE),=C'01'                                                   
PUTJCL2A TM    NETFRST,X'01'       TEST AND SET FIRST JOB                       
         BO    *+14                                                             
         MVC   0(2,RE),NETHC       HOLD COUNT FOR FIRST JOB                     
         OI    NETFRST,X'01'                                                    
         LA    RE,2(RE)                                                         
         CLI   NETOH,C'Y'          OH=YES REQUIRED                              
         BNE   *+14                                                             
         MVC   0(7,RE),=C',OH=YES'                                              
         LA    RE,7(RE)                                                         
         TM    NETFRST,X'02'       TEST LAST JOB                                
         BO    PUTJCL2B                                                         
         MVC   0(4,RE),=C',RL='                                                 
         MVC   4(8,RE),JCLSAVE+2   SET JOB NAME FROM THIS JOB CARD              
         B     PUTJCL2C                                                         
PUTJCL2B CLI   NETRL,C' '          TEST IF NETRL INPUT FOR LAST JOB             
         BE    PUTJCL2C                                                         
         MVC   0(4,RE),=C',RL='    RELEASE JOBNAME                              
         CLI   NETRL,C'('                                                       
         BNE   *+10                                                             
         MVC   0(4,RE),=C',NR='    RELEASE (NETNAME,JOBNAME)                    
         MVC   4(19,RE),NETRL      SET JOB NAME FROM NETRL VALUE                
PUTJCL2C MVC   JESIOA,JCL                                                       
         L     RF,=A(PUTALL)                                                    
         BASR  RE,RF               OUTPUT //*NET CARD                           
         MVC   JCL,SPACES                                                       
         MVC   JCL(2),=C'//'       OUTPUT // EOJ CARD                           
         MVC   JESIOA,JCL                                                       
         L     RF,=A(PUTALL)                                                    
         BASR  RE,RF                                                            
         NI    NETEOJ,X'FE'        RESET EOJ CARD SUSPENDED                     
         TM    NETFRST,X'02'                                                    
         BO    PUTJCLX                                                          
         MVC   JCL,JCLSAVE         RESTORE // JOB CARD                          
         MVC   JESIOA,JCL                                                       
         B     PUTJCLP                                                          
*                                                                               
PUTJCL3  CLI   SINGLE,0            MVS SINGLE JOB                               
         BE    PUTJCL4                                                          
         LA    RE,JCL                                                           
         L     RF,=A(JESKEEP1)     TEST FOR //*FORMAT... FOR KEEP               
         CLC   0(30,RE),0(RF)                                                   
         BNE   PUTJCL4                                                          
         CLI   STEPNAME,C' '                                                    
         BE    PUTJCL4                                                          
         MVC   WORK(40),22(RE)                                                  
         MVC   22(40,RE),SPACES                                                 
         MVC   22(08,RE),STEPNAME  DDNAME=STEPNAME.SYSPRINT                     
         LA    RE,22(RE)                                                        
         CLI   0(RE),C' '                                                       
         BE    *+12                                                             
         LA    RE,1(RE)                                                         
         B     *-12                                                             
         MVI   0(RE),C'.'                                                       
         MVC   1(40,RE),WORK                                                    
         MVC   JESIOA,JCL                                                       
         B     PUTJCLP                                                          
*                                                                               
PUTJCL4  EQU   *                   SPOT TAPES TO NET TAPES                      
*&&US                                                                           
         CLI   SVSYSL,C'N'         NETWORK?                                     
         BNE   PUTJCL4A            YES                                          
*&&                                                                             
         B     PUTJCL5                                                          
PUTJCL4A LA    RE,JCL+10           SEARCH FOR DSN=SPTTAPE.SP.....               
         LA    RF,50                                                            
PUTJCL4B CLC   0(4,RE),=C'DSN='                                                 
         BNE   PUTJCL4C                                                         
         CLC   4(10,RE),=C'SPTTAPE.SP'                                          
         BE    PUTJCL4D                                                         
PUTJCL4C LA    RE,1(RE)                                                         
         BCT   RF,PUTJCL4B                                                      
         B     PUTJCL5                                                          
PUTJCL4D MVC   12(2,RE),=C'NE'    CHANGE TO DSN=SPTTAPE.NE....                  
         MVC   JESIOA,JCL                                                       
         B     PUTJCLP                                                          
*                                                                               
PUTJCL5  EQU   *                                                                
*                                                                               
PUTJCLP  L     RF,=A(PUTALL)                                                    
         BASR  RE,RF                                                            
PUTJCLX  XIT1                                                                   
***********************************************************************         
*PUT ALL                                                              *         
***********************************************************************         
PUTALL   NTR1  BASE=*,LABEL=*                                                   
         NI    PUTTYP,X'01'        SET PUT REC TYPE BITS                        
*                                                                               
PUTALL0  CLI   SPOOL,C'Y'          JCL DIRECT TO OPERATING SYSTEM               
         BNE   PUTALL2                                                          
         GOTO1 =V(POWWOW),PARA,=C'PUT',=C'POWER',POWKEY,JESIOA-8                
         TM    PARA+8,X'80'        TEST IF RETURN JES JOBID                     
         BZ    PUTALLA                                                          
         MVC   P+83(4),=C'JES='                                                 
         MVC   P+87(8),POWKEY      DISPLAY JOBID ON // EOJ CARD                 
         MVC   LGJESID,POWKEY                                                   
         B     PUTALLA                                                          
*                                                                               
PUTALL2  CLI   SPOOL,C'P'          JCL TO CARD PUNCH                            
         BNE   PUTALL4                                                          
         GOTO1 =V(CARDS),PARA,JESIOA,=C'PE00'                                   
         B     PUTALLA                                                          
*                                                                               
PUTALL4  CLI   SPOOL,C'T'          JCL TO TAPE                                  
         BNE   PUTALL6                                                          
         L     R1,=A(JCLTAPE)                                                   
         PUT   (1),JESIOA                                                       
         B     PUTALLA                                                          
*                                                                               
PUTALL6  EQU   *                                                                
*                                                                               
PUTALLA  MVI   ANYOUT,C'Y'         SET WE HAVE SOME OUTPUT                      
         TM    TRACE,X'80'         PRINT CARD IF TRACE=Y                        
         BZ    PUTALLAX                                                         
         L     RE,=A(RFHDR)        TEST IF REQ FILE HEADER CARD                 
         CLC   JESIOA(6),0(RE)                                                  
         BNE   *+12                                                             
         TM    TRACE,X'40'                                                      
         BZ    PUTALLAX                                                         
         MVC   P(80),JESIOA                                                     
         OC    P(80),SPACES                                                     
         GOTO1 =V(PRINTER)                                                      
         L     RE,=A(MVSEOJ)                                                    
         CLC   JESIOA(40),0(RE)                                                 
         BNE   PUTALLA0                                                         
         MVI   P,C'='                                                           
         MVC   P+1(79),P                                                        
         GOTO1 =V(PRINTER)         PRINT END OF JOB LINES                       
         BASR  RE,RF                                                            
         B     PUTALLAX                                                         
PUTALLA0 CLI   QSYSTEM,C'A'        TEST IF SYSTEM HAS LOWER CASE                
         BE    PUTALLA1                                                         
         CLI   QSYSTEM,C'M'                                                     
         BE    PUTALLA1                                                         
         B     PUTALLAX                                                         
PUTALLA1 LA    R2,JESIOA                                                        
         LA    R3,P                                                             
         LA    R4,80                                                            
PUTALLA2 TM    0(R2),X'40'         UNDERLINE LOWER CASE FIELDS                  
         BO    *+8                                                              
         MVI   0(R3),C'-'                                                       
         LA    R2,1(R2)                                                         
         LA    R3,1(R3)                                                         
         BCT   R4,PUTALLA2                                                      
         CLC   P,SPACES                                                         
         BE    PUTALLAX                                                         
         GOTO1 =V(PRINTER)                                                      
PUTALLAX EQU   *                                                                
*                                                                               
PUTALLC  TM    PUTTYP,X'01'        TEST IF JCL CARD                             
         BZ    PUTALLP                                                          
         CLC   JESIOA(2),=C'//'                                                 
         BE    PUTALLD                                                          
         B     PUTALLP                                                          
*                                                                               
PUTALLD  L     RE,=A(MVSEOJ)       TEST FOR EOJ CARD                            
         CLC   JESIOA(40),0(RE)                                                 
         BNE   *+12                                                             
         OI    PUTTYP,X'02'        SET CARD IS EOJ CARD                         
         B     PUTALLP                                                          
*                                                                               
PUTALLE  LA    RE,JESIOA+2         TEST IF JOB CARD                             
         CLI   0(RE),C'*'                                                       
         BE    PUTALLF                                                          
         LA    R0,16                                                            
         CLC   0(5,RE),=C' JOB '                                                
         BE    PUTALLE1                                                         
         LA    RE,1(RE)                                                         
         BCT   R0,*-14                                                          
         B     PUTALLF                                                          
PUTALLE1 OI    PUTTYP,X'04'        SET JOB CARD FLAG                            
         MVC   LGJOBID,JESIOA+2    EXTRACT MVS JOB NAME                         
         AP    LGJOBNO,=P'1'                                                    
         ZAP   LGEXENOJ,=P'0'                                                   
         B     PUTALLP                                                          
*                                                                               
PUTALLF  L     RE,=A(MVSOUT)       TEST FOR //OUNNN FORMAT CARD                 
         CLC   JESIOA(4),0(RE)                                                  
         BNE   PUTALLG                                                          
         CLC   JESIOA+7(8),7(RE)                                                
         BNE   PUTALLG                                                          
         CLC   JESIOA+15(6),=C'CLASS='                                          
         BNE   PUTALLF2                                                         
         CLC   LGSYSPR(6),=C'CLASS='                                            
         BE    PUTALLF2                                                         
PUTALLF1 LA    RF,JESIOA+23        FIND END OF FORMS= PARAM                     
         CLI   0(RF),C','                                                       
         BE    *+12                                                             
         LA    RF,1(RF)                                                         
         B     *-12                                                             
         LA    R1,JESIOA+15                                                     
         SR    RF,R1                                                            
         CHI   RF,20                                                            
         BNH   *+8                                                              
         LHI   RF,20                                                            
         BCTR  RF,0                                                             
         EX    RF,*+8              MOVE OUT CLASS=X,FORMS=XXXX                  
         B     PUTALLF2                                                         
         MVC   LGSYSPR(0),JESIOA+15                                             
PUTALLF2 LA    RF,JESIOA+15                                                     
         LA    R0,50                                                            
PUTALLF3 CLC   0(9,RF),=C'DEST=KEEP'                                            
         BNE   *+8                                                              
         MVI   LGSYSDI,C'K'        SET KEEP DISPOSITION                         
         LA    RF,1(RF)                                                         
         BCT   R0,PUTALLF3                                                      
PUTALLFX B     PUTALLP                                                          
*                                                                               
PUTALLG  CLI   LGSYSPR,C' '        TEST IF FIRST SYSPRINT CARD                  
         BE    *+14                                                             
         CLC   LGSYSPR(6),=C'CLASS='                                            
         BNE   PUTALLH                                                          
         L     RE,=A(JESKEEP2)     TEST FOR //*FORMAT                           
         CLC   JESIOA(22),0(RE)                                                 
         BNE   *+12                                                             
         MVI   LGSYSDI,C'K'        SET FIRST KEEP DISPOSITION                   
         B     PUTALLP                                                          
         L     RE,=A(MVSSYP)                                                    
         CLC   JESIOA(10),0(RE)                                                 
         BNE   PUTALLH                                                          
         OI    PUTTYP,X'08'        SET FIRST SYSPRINT CARD                      
         LA    RE,JESIOA+10                                                     
         LA    R0,20                                                            
PUTALLG0 CLC   0(9,RE),=C'UNIT=TAPE'                                            
         BNE   *+12                                                             
         MVI   LGSYSDI,C'T'        SET FIRST TAPE DISPOSITION                   
         B     PUTALLP                                                          
         LA    RE,1(RE)                                                         
         BCT   R0,PUTALLG0                                                      
         CLI   LGSYSDI,C' '                                                     
         BNE   PUTALLG2                                                         
         MVI   LGSYSDI,C'D'        SET FIRST DEFAULT DISP                       
         LA    RE,JESIOA+10                                                     
         LA    R0,60                                                            
PUTALLG1 CLC   0(8,RE),=C'HOLD=YES'                                             
         BNE   *+12                                                             
         MVI   LGSYSDI,C'H'        SET FIRST HOLD DISP                          
         B     PUTALLG2                                                         
         LA    RE,1(RE)                                                         
         BCT   R0,PUTALLG1                                                      
PUTALLG2 LA    RE,JESIOA+10                                                     
         LA    R0,20                                                            
PUTALLG3 CLC   0(7,RE),=C'SYSOUT=' SEARCH FOR SYSOUT= PARM                      
         BE    PUTALLG4                                                         
         LA    RE,1(RE)                                                         
         BCT   R0,PUTALLG3                                                      
         CLI   LGSYSPR,C' '                                                     
         BNE   PUTALLP                                                          
         MVC   LGSYSPR(7),=C'UNKNOWN'                                           
         B     PUTALLP                                                          
PUTALLG4 CLC   7(3,RE),=C'(,)'     TEST FOR NULL SYSOUT                         
         BE    PUTALLP                                                          
         MVI   DUB,C','            SET END OF PARM CHR                          
         CLI   7(RE),C'('                                                       
         BNE   *+8                                                              
         MVI   DUB,C')'                                                         
         LA    R0,L'LGSYSPR                                                     
         LA    RF,LGSYSPR                                                       
PUTALLG5 MVC   0(1,RF),0(RE)       COPY PARM TO LGSYSPR                         
         CLC   0(1,RF),DUB                                                      
         BE    PUTALLG6                                                         
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)                                                         
         BCT   R0,PUTALLG5                                                      
PUTALLG6 CLI   0(RF),C','                                                       
         BNE   *+8                                                              
         MVI   0(RF),C' '                                                       
         B     PUTALLP                                                          
*                                                                               
PUTALLH  TM    LPUTTYP,X'08'       TEST IF LAST WAS //SYSPRINT                  
         BZ    PUTALLJ                                                          
         CLI   LGSYSDI,C'T'        TEST IF UNIT=TAPE                            
         BNE   PUTALLJ                                                          
         L     RE,=A(MVSSYPT2)                                                  
         CLC   JESIOA(19),0(RE)    TEST IF // DSN=                              
         BNE   PUTALLJ                                                          
         MVC   LGSYSPR(15),JESIOA+19                                            
         MVC   LGSYSPR+16(4),JESIOA+55                                          
         OI    JOBTAPES,X'80'      SET TAPE OUTPUT SYSPRINT                     
         B     PUTALLP                                                          
*                                                                               
PUTALLJ  CLI   LGOUTTP,C' '        TEST FIRST TAPE ONLY                         
         BNE   PUTALLK                                                          
         L     RE,=A(MVSSYPT1)                                                  
         CLC   JESIOA+12(19),12(RE) DD UNIT=TAPE,DISP=(....                     
         BNE   PUTALLJ2                                                         
         CLC   JESIOA+31(3),=C'NEW'                                             
         BE    PUTALLJ1                                                         
         CLC   JESIOA+31(3),=C'MOD'                                             
         BNE   PUTALLJ2                                                         
PUTALLJ1 OI    PUTTYP,X'10'        SET FIRST STANDARD TAPE                      
         B     PUTALLP                                                          
PUTALLJ2 TM    LPUTTYP,X'10'                                                    
         BZ    PUTALLK                                                          
         L     RE,=A(MVSSYPT2)                                                  
         CLC   JESIOA(19),0(RE)    TEST IF // DSN=                              
         BNE   PUTALLK                                                          
         MVC   LGOUTTP,JESIOA+19                                                
         OI    JOBTAPES,X'40'      SET TAPE OUTPUT STANDARD                     
         B     PUTALLP                                                          
*                                                                               
PUTALLK  LA    RE,JESIOA+2         TEST IF EXEC CARD                            
         CLI   0(RE),C'*'                                                       
         BE    PUTALLL                                                          
         LA    R0,16                                                            
         CLC   0(6,RE),=C' EXEC '                                               
         BE    PUTALLK1                                                         
         LA    RE,1(RE)                                                         
         BCT   R0,*-14                                                          
         B     PUTALLL                                                          
PUTALLK1 OI    PUTTYP,X'40'        SET EXEC CARD FLAG                           
         MVC   LGEXEIDL,LGEXEID    SAVE LAST EXEC EXECUTE NAME                  
         MVC   LGEXEID,JESIOA+2    EXTRACT MVS EXECUTE NAME                     
         AP    LGEXENO,=P'1'                                                    
         AP    LGEXENOJ,=P'1'                                                   
         B     PUTALLP                                                          
*                                                                               
PUTALLL  EQU   *                                                                
*                                                                               
PUTALLP  CLI   WJCLID,C' '         JCL REC TO DISK                              
         BE    PUTALLPX                                                         
         L     R1,=A(WJCL)                                                      
         PUT   (1),JESIOA                                                       
PUTALLPX EQU   *                                                                
*                                                                               
PUTALLQ  CLI   WLOGID,C' '         JCL LOG TO DISK                              
         BE    PUTALLQX                                                         
         TM    PUTTYP,X'40'        TEST IF THIS IS AN EXEC CARD                 
         BZ    PUTALLQ1                                                         
         CP    LGEXENOJ,=P'1'      IS IT THE FIRST OF A JOB                     
         BE    PUTALLQX                                                         
         B     PUTALLQA                                                         
*                                                                               
PUTALLQ1 TM    PUTTYP,X'02'        TEST IF THIS IS EOJ CARD                     
         BZ    PUTALLQX                                                         
*                                                                               
PUTALLQA MVC   LOGSYSID,SYSTEM     SET SYSTEM ID                                
         AP    LGRECNO,=P'1'                                                    
         UNPK  LOGRECNO,LGRECNO    SET RECORD NUMBER (ONE PER EXEC)             
         OI    LOGRECNO+3,X'F0'                                                 
         MVC   LOGJESID,LGJESID    SET JES SPOOL ID                             
         MVC   LOGJOBID,LGJOBID    SET JOB ID                                   
         MVC   LOGEXEID,LGEXEIDL   SET PREVIOUS STEP ID                         
         TM    PUTTYP,X'02'        OR THIS STEP ID IF EOJ                       
         BZ    *+10                                                             
         MVC   LOGEXEID,LGEXEID                                                 
         MVC   LOGSYSDI,LGSYSDI    SET SYSPRINT DISPOSITION                     
         CLI   LOGSYSDI,C' '                                                    
         BNE   *+8                 DEFAULT IS D FOR DELETE                      
         MVI   LOGSYSDI,C'D'                                                    
         MVC   LOGSYSPR,LGSYSPR    SET SYSPRINT SYSOUT= OR TAPE DSN             
         MVC   LOGOUTTP,LGOUTTP    SET FIRST OUTPUT TAPE DSN                    
*&&UK*&& MVC   LOGLOGO2,QJOBLOG2   SET LOGO2 (UK BIN NUMBER)                    
         L     R1,=A(WLOG)                                                      
         PUT   (1),LOGREC                                                       
*                                                                               
PUTALLQB MVC   LOGREC,SPACES       CLEAR FOR NEXT JOB OR STEP                   
         MVI   LGSYSDI,C' '                                                     
         MVC   LGSYSPR,SPACES                                                   
         MVC   LGOUTTP,SPACES                                                   
         TM    PUTTYP,X'02'        TEST FOR EOJ                                 
         BZ    PUTALLQX                                                         
         ZAP   LGEXENOJ,=P'0'                                                   
         MVC   LGJESID,SPACES                                                   
         MVC   LGJOBID,SPACES                                                   
         MVC   LGEXEID,SPACES                                                   
PUTALLQX EQU   *                                                                
*                                                                               
PUTALLX  XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
*LITERALS, CONSTANTS AND WORKING STORAGE FOR MAIN                     *         
***********************************************************************         
         LTORG                                                                  
*                                                                               
DUMPLIST DS    0D                                                               
         DC    A(REQXFIL)                                                       
         DC    A(REQXFILX)                                                      
         ORG   *-4                                                              
         DC    X'80'                                                            
         ORG                                                                    
         EJECT                                                                  
***********************************************************************         
*INITIALISE MVS JCL FOR JOB                                           *         
***********************************************************************         
IMVSJCL  NTR1  BASE=*,LABEL=*                                                   
         L     R2,=A(JJ1)          CLEAR ALL JCL CARDS                          
IMVSJCL1 CLC   0(8,R2),=8X'FF'                                                  
         BE    IMVSJCL2                                                         
         MVC   0(80,R2),SPACES                                                  
         LA    R2,80(R2)                                                        
         B     IMVSJCL1                                                         
*                                                                               
IMVSJCL2 CLI   JOBIND,C'E'                                                      
         BE    IMVSJCLX                                                         
         MVC   JCL,SPACES                                                       
*                                                                               
IMVJC    L     R3,=A(JJ1)          JOB-CARD-1=JOBNAME/ACCINFO                   
         MVC   0(2,R3),=C'//'                                                   
         MVC   2(4,R3),QJOBJES     UUUUX001                                     
         MVC   6(4,R3),=C'X001'                                                 
         MVC   11(3,R3),=C'JOB'                                                 
         LA    R2,15(R3)                                                        
IMVJC1A  DS    0H                                                               
*&&US                                                                           
         MVC   0(6,R2),=C'''XFIL'''                                             
         AHI   R2,6                                                             
*&&                                                                             
*&&UK                                                                           
         MVC   0(4,R2),QJOBJES     ACCT INFO UUUUX0011                          
         MVC   4(4,R2),=C'X001'                                                 
         MVI   8(R2),C'1'                                                       
         CLI   QSUBSYS,C' '                                                     
         BE    *+10                                                             
         MVC   8(2,R2),QSUBSYS                                                  
*                                                                               
IMVJC1A1 CLI   4(R2),C'M'          TEST MEDIA SYSTEM                            
         BNE   IMVJC1A4                                                         
         LA    RE,IMVJC1A3                                                      
IMVJC1A2 CLI   0(RE),C' '          SEARCH MEDIA SYS SPECIALS                    
         BE    IMVJC1A4                                                         
         CLC   6(2,R2),0(RE)       TEST IF PROGRAM PP IN LIST                   
         BE    *+12                                                             
         LA    RE,3(RE)                                                         
         B     IMVJC1A2                                                         
         MVC   5(1,R2),2(RE)       SET MEDIA SUB CHR AFTER THE M                
         B     IMVJC1A4                                                         
*                                                                               
IMVJC1A3 DC    C'CR1CT1FC1FG1FQ1FT1NC1NG1NT1YQ1' CRAFT REQUESTS                 
         DC    C'   '                                                           
IMVJC1A4 DS    0H                                                               
         LA    R2,9(R2)                                                         
*&&                                                                             
IMVJC1B  MVI   0(R2),C','          PROGRAMMERS NAME                             
         AHI   R2,1                                                             
         CLC   PGMRNAME,SPACES                                                  
         BNH   IMVJC1C                                                          
         MVI   0(R2),C''''                                                      
         AHI   R2,1                                                             
         MVC   0(L'PGMRNAME,R2),PGMRNAME                                        
         AHI   R2,L'PGMRNAME                                                    
         MVI   0(R2),C''''                                                      
         AHI   R2,1                                                             
*                                                                               
IMVJC1C  MVC   0(16,R2),=C',MSGLEVEL=(1,1),'                                    
         MVC   11(1,R2),MSGLEV1                                                 
         MVC   13(1,R2),MSGLEV1                                                 
         AHI   R2,16                                                            
*                                                                               
         MVC   0(11,R2),=C'MSGCLASS=A,'                                         
         MVC   9(1,R2),MSGCLA      SET MSGCLASS                                 
         CLI   QJOBCLAS,C' '                                                    
         BE    *+10                                                             
         MVC   9(1,R2),QJOBCLAS                                                 
         AHI   R2,11                                                            
*                                                                               
         MVC   0(8,R2),=C'CLASS=C,'                                             
         MVC   6(1,R2),JCLASS                                                   
         CLI   QJOBCLAS,C' '                                                    
         BE    *+10                                                             
         MVC   6(1,R2),QJOBCLAS                                                 
*                                                                               
         L     R3,=A(JJ2)          JOB-CARD-2 RD/TYPRUN/PRTY/USER               
         MVC   0(2,R3),=C'//'                                                   
         LA    R2,14(,R3)                                                       
         MVC   0(5,R2),=C'RD=XX'                                                
         MVC   3(L'RESTART,R2),RESTART                                          
         LA    R2,3(,R2)                                                        
         CLI   0(R2),C' '                                                       
         BE    IMVJC3B                                                          
         LA    R2,1(R2)                                                         
         B     *-12                                                             
*                                                                               
IMVJC3B  CLI   DISP,C'H'                                                        
         BE    IMVJC3B1                                                         
         CLI   TYPRUN,C' '                                                      
         BE    IMVJC3C                                                          
IMVJC3B1 MVC   0(12,R2),=C',TYPRUN=HOLD'                                        
         CLI   TYPRUN,C' '                                                      
         BE    *+10                                                             
         MVC   8(8,R2),TYPRUN                                                   
         LA    R2,8(R2)                                                         
         CLI   0(R2),C' '                                                       
         BE    IMVJC3C                                                          
         LA    R2,1(R2)                                                         
         B     *-12                                                             
*                                                                               
*        MVC   6(5,R2),SYSNAML                                                  
IMVJC3C  CLI   QOUTPRI,C' '                                                     
         BNH   IMVJC3D                                                          
         MVC   0(7,R2),=C',PRTY=N'                                              
         MVC   6(1,R2),QOUTPRI                                                  
         CLI   QOUTPRI,C'1'                                                     
         BL    IMVJC3D                                                          
         LA    RE,10               INVERT PRIORITY                              
         IC    RF,QOUTPRI                                                       
         SLL   RF,28                                                            
         SRL   RF,28                                                            
         SR    RE,RF                                                            
         STC   RE,6(R2)                                                         
         OI    6(R2),X'F0'                                                      
         LA    R2,7(R2)                                                         
*                                                                               
IMVJC3D  CLC   NOTIFY,SPACES                                                    
         BNH   IMVJC3F                                                          
         MVC   0(12,R2),=C',NOTIFY=XXXX'                                        
         MVC   8(L'NOTIFY,R2),NOTIFY                                            
         AHI   R2,12                                                            
*                                                                               
IMVJC3F  CLC   USER,SPACES                                                      
         BNH   IMVJC3Q                                                          
         MVC   0(14,R2),=C',USER=XXXXXXXX'                                      
         MVC   6(L'USER,R2),USER                                                
         LA    R2,5(,R2)                                                        
         CLI   0(R2),C' '                                                       
         BE    IMVJC3Q                                                          
         LA    R2,1(R2)                                                         
         B     *-12                                                             
*                                                                               
IMVJC3Q  CLI   SINGLE,1            SINGLE MVS JOB JCL                           
         BL    IMVPC                                                            
         BH    IMVJC3R                                                          
         MVI   SINGLE,2                                                         
         L     RF,=A(PUTSGLC)                                                   
         BASR  RE,RF               PUT INPUT $$ JCL CARDS                       
*                                                                               
IMVJC3R  L     RE,=A(JJ1)                                                       
         LA    R0,3                                                             
         MVC   0(2,RE),SPACES      SET GENERATED JOB CARDS TO UNWANTED          
         LA    RE,80(RE)                                                        
         BCT   R0,*-10                                                          
*                                                                               
         CLI   JCLINJLN,0          IS MAXSTEPS IN OPERATION                     
         BE    IMVPC               NO                                           
         CLI   MAXTAPES,0          IS MAXTAPES IN OPERATION                     
         BE    IMVJC3T                                                          
         CLI   JOBTAPES,0          YES=TEST IF OUTPUT TAPES MATCH               
         BE    IMVJC3T                                                          
         MVC   TSTTAPES,MAXTAPES                                                
         NC    TSTTAPES,JOBTAPES                                                
         BNZ   IMVJC3U                                                          
IMVJC3T  CP    JOBEXEC,MAXSTEPS    IS MAXSTEPS EXCEEDED                         
         BL    IMVPC                                                            
IMVJC3U  ZAP   JOBEXEC,=P'0'       RESET STEPS IN JOB COUNT                     
         MVI   JOBTAPES,0          RESET TAPES IN JOB COUNT                     
         L     RE,=A(SPLPOOL)      SET NO ENTRIES IN SPOOL TAPE POOL            
         XC    4(4,RE),4(RE)                                                    
         AP    JCLINJNO,=P'1'      BUMP NUM OF JOBS COUNT                       
         L     RE,=A(JCLIN)                                                     
         LLC   RF,JCLINJLN         GET LENGTH OF INPUT JOB ID                   
         LA    RE,2(RE,RF)                                                      
         UNPK  0(2,RE),JCLINJNO    SET JOB NO IN JOB ID                         
         OI    1(RE),X'F0'                                                      
         L     RF,=A(PUTSGLC)                                                   
         BASR  RE,RF               OUTPUT NEXT SET OF JCL CARDS                 
*                                                                               
IMVPC    MVC   FLASH,=C'NONE'      INITIALISE FOR SYSPRINT                      
         MVC   FORMS,QJOBPOWO                                                   
         MVC   CLASS,QCLASS                                                     
         MVI   PORFDEFS,0                                                       
*&&UK                                                                           
         CLC   QJOBPOWO,=C'1SML'   USE FLASH=STRP TO GET STRIPES                
         BNE   *+16                                                             
         MVC   FORMS,=C'1PLN'                                                   
         MVC   FLASH,=C'STRP'                                                   
*&&                                                                             
IMVPC0A1 CLI   QJOBPTYP,C'Q'       FORCE REMOTES TO CLASS Q                     
         BNE   *+8                                                              
         MVI   CLASS,C'Q'                                                       
         CLC   QJOBPROC(20),=CL20'PRINTING DIRECT'                              
         BNE   *+8                                                              
         MVI   CLASS,C'Q'                                                       
*                                                                               
IMVPC0A2 MVC   IDIOTOTY,QJOBORUT   TEST FOR IDI OUTPUT TYPE OVERRIDE            
         MVC   IDIOTSYS,QSYSTEM                                                 
         MVC   IDIOTPRG,QPROGRAM                                                
         L     RF,=A(IDIOT)                                                     
         BASR  RE,RF                                                            
         BNE   IMVPC0A9                                                         
IMVPC0A6 CLI   AFP,C' '            IGNORE IF AFP STYLE OUTPUT                   
         BNE   IMVPC0A9                                                         
         CLI   QSYSTEM,C'A'        ACCOUNT SYSTEM IN LIST                       
         BNE   IMVPC0A8                                                         
         L     R1,=A(XCEPTLST)     SKIP POSTING AND CONFIDENTIAL JOBS           
IMVPC0A7 CLI   0(R1),X'FF'                                                      
         BE    IMVPC0A8            GO AHEAD IF NOT FOUND                        
         CLC   QPROGRAM,0(R1)                                                   
         BE    IMVPC0A9            SKIP IT                                      
         LA    R1,2(R1)                                                         
         B     IMVPC0A7                                                         
IMVPC0A8 MVI   CLASS,C'Q'          SET CLASS TO REMOTE                          
*                                                                               
IMVPC0A9 CLI   SYSPMODE,C'D'       TEST IF SYSPRINT=DUMMY INPUT                 
         BNE   IMVPC0AA                                                         
         L     R3,=A(JP1)          //SYSPRINT DD                                
         L     RF,=A(MVSSYP)                                                    
         MVC   0(15,R3),0(RF)                                                   
         MVC   15(5,R3),=C'DUMMY'                                               
         B     IMVSJCLX                                                         
IMVPC0AA CLI   QJOBDISP,C'T'       TEST IF SYSPRINT/OUTPUT CARDS                
         BE    *+12                                                             
         CLI   SYSPMODE,C'O'       TEST IF WANT // OUTPUT CARDS                 
         BE    IMVOC               YES                                          
*                                                                               
IMVPC1   L     R3,=A(JP1)          //SYSPRINT DD                                
         L     RF,=A(MVSSYP)                                                    
         MVC   0(15,R3),0(RF)                                                   
         LA    R2,15(R3)                                                        
*                                                                               
IMVPC1A  MVC   0(11,R2),=C'SYSOUT=(C,,'                                         
         MVC   8(1,R2),CLASS                                                    
         MVC   11(4,R2),FORMS                                                   
         LA    R2,11(R2)                                                        
         CLI   0(R2),C' '          TERMINATE SYSOUT WITH )                      
         BE    *+12                                                             
         LA    R2,1(R2)                                                         
         B     *-12                                                             
         MVI   0(R2),C')'                                                       
         LA    R2,1(R2)                                                         
*                                                                               
IMVPC1B  CLI   CLASS,C'Q'          IS OUTPUT CLASS Q                            
         BNE   *+12                                                             
         CLI   QJOBDISP,C'T'       YES-SET DISP HOLD EXCEPT FOR TAPE            
         BNE   IMVPC1BH                                                         
         CLI   QJOBDISP,C'H'       TEST OUTPUT DISP HOLD                        
         BE    IMVPC1BH                                                         
         CLI   QJOBDISP,C'T'       TEST OUTPUT DISP SPOOL TO TAPE               
         BE    IMVPC1BT                                                         
         CLI   QJOBDISP,C'K'       TEST OUTPUT DISP KEEP                        
         BE    IMVPC1BK                                                         
         CLI   QJOBKEEP,C'Y'       TEST IF KEEP SET                             
         BE    IMVPC1BK                                                         
         B     IMVPC1BX            IGNORE OTHER OUTPUT DISPOSITIONS             
*                                                                               
IMVPC1BH MVC   0(7,R2),=C',HOLD=Y'                                              
         LA    R2,7(R2)                                                         
         B     IMVPC1BX                                                         
*                                                                               
IMVPC1BT MVI   ANYSPLTP,C'Y'       WE'LL NEED A SPOOL CONTROL LATER             
         L     R1,=A(SYSEQTAB)     GET SYSTEM NAME ENTRY                        
IMVPC1BU CLI   0(R1),X'FF'                                                      
         JE    *+2                                                              
         CLC   QSYSTEM,0(R1)                                                    
         BE    *+12                                                             
         LA    R1,L'SYSEQTAB(R1)                                                
         B     IMVPC1BU                                                         
*                                                                               
         L     R3,=A(MVSSPOOL)                                                  
         LA    RE,6(R3)            POINT TO SYSID FIELD OF SPOOL                
         MVC   0(3,RE),3(R1)       SPOOL=SSSTAPE.SS0PPAA                        
*&&UK                                                                           
         CLC   0(3,RE),=C'MED'     SPOOL=MEFTAPE.SS0PPAA                        
         BNE   *+8                                                              
         MVI   2(RE),C'F'                                                       
         CLC   0(3,RE),=C'ACC'     SPOOL=ACFTAPE.SS0PPAA                        
         BNE   *+8                                                              
         MVI   2(RE),C'F'                                                       
*&&                                                                             
*&&US                                                                           
         CLI   SVSYSL,C'N'                                                      
         BNE   *+10                                                             
         MVC   0(3,RE),=C'NET'                                                  
*&&                                                                             
         LA    RE,14(R3)           POINT TO JOBID FIELD                         
         MVC   0(2,RE),1(R1)       BUILD SS0PPAA - (AA=AGYALPH)                 
*&&US                                                                           
         CLI   SVSYSL,C'N'         NETWORK?                                     
         BNE   *+10                                                             
         MVC   0(2,RE),=C'NET'     SET SS TO NE FOR NETWORK                     
*&&                                                                             
         MVI   2(RE),C'0'                                                       
         MVC   3(2,RE),QPROGRAM                                                 
         MVC   5(2,RE),QUSER                                                    
*                                                                               
         L     RF,=A(GETSPLCT)     DIG OUT GEN NUMBER                           
         BASR  RE,RF                                                            
         LA    RE,40(R3)           SHOW GEN=NNN IN COL 41                       
         MVC   0(4,RE),=C'GEN='                                                 
         EDIT  (1,SPLCOUNT),(3,4(RE)),FILL=0                                    
*                                                                               
         CLC   QJOBCC,=C'NONE'     SHOW ORIGINAL FCB                            
         BE    IMVPC4                                                           
         CLC   QJOBCC,SPACES                                                    
         BE    IMVPC4                                                           
         LA    RE,50(R3)                                                        
         MVC   0(5,RE),=C'*FCB='                                                
         MVC   5(4,RE),QJOBCC                                                   
         B     IMVPC4                                                           
*                                                                               
IMVPC1BK L     RE,=A(JES1)         OUTPUT JES CARDS FOR KEEP                    
         L     RF,=A(JESKEEP1)                                                  
         MVC   0(80,RE),0(RF)                                                   
         L     RE,=A(JES2)                                                      
         L     RF,=A(JESKEEP2)                                                  
         MVC   0(80,RE),0(RF)                                                   
IMVPC1BX EQU   *                                                                
*                                                                               
IMVPC1C  MVC   0(11,R2),=C',COPIES=001'                                         
         CLI   QJOBCOPY,C' '       TEST IF DEFINED AS SPACE CHR                 
         BE    IMVPC1C2                                                         
         CLI   QJOBCOPY,C'0'       TEST IF DEFINED AS A CHARACTER               
         BL    IMVPC1C1                                                         
         MVC   10(1,R2),QJOBCOPY                                                
         B     IMVPC1C2                                                         
IMVPC1C1 LLC   R1,QJOBCOPY         DEFINED AS BINARY VALUE                      
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  8(3,R2),DUB                                                      
IMVPC1C2 LA    R2,11(R2)                                                        
*                                                                               
IMVPC1D  CLC   QJOBCC,=C'NONE'                                                  
         BE    IMVPC1D2                                                         
         CLC   QJOBCC,SPACES                                                    
         BE    IMVPC1D2                                                         
IMVPC1D1 MVC   0(5,R2),=C',FCB='                                                
         MVC   5(4,R2),QJOBCC                                                   
         LA    R2,5(R2)                                                         
         CLI   0(R2),C' '                                                       
         BE    IMVPC1D2                                                         
         LA    R2,1(R2)                                                         
         B     *-12                                                             
IMVPC1D2 EQU   *                                                                
*                                                                               
IMVPC1E  MVC   WORK,RJEOPT         RJE SUPPORT                                  
         CLC   QJOBORUT(3),=C'RJE'                                              
         BNE   *+10                                                             
         MVC   WORK(3),QJOBORUT+3                                               
         CLC   WORK(3),SPACES                                                   
         BE    IMVPC1E1                                                         
         CLC   QJOBJES+4(3),=C'A55'                                             
         BE    IMVPC1E1                                                         
         MVC   0(6,R2),=C',DEST='                                               
         MVC   6(3,R2),WORK                                                     
         LA    R2,9(R2)                                                         
IMVPC1E1 EQU   *                                                                
*                                                                               
IMVPC1F  L     RF,=A(FREEZE)       TEST IF OK TO OUTPUT FREE=CLOSE              
         BASR  RE,RF                                                            
         BNE   IMVPC1F1                                                         
         L     RF,=A(JP1)          YES-TEST IF ROOM                             
         LA    RF,71(RF)                                                        
         SR    RF,R2                                                            
         CHI   RF,12                                                            
         BL    IMVPC1F1                                                         
         MVC   0(11,R2),=C',FREE=CLOSE'                                         
         LA    R2,11(R2)                                                        
IMVPC1F1 EQU   *                                                                
*                                                                               
IMVPC2   CLC   QJOBCHRS,SPACES     SYSPRINT-2=LASER PRINTER PARMS               
         BNE   IMVPC2A                                                          
         CLC   FLASH,=C'NONE'                                                   
         BE    IMVPC3                                                           
         CLI   FLASH,C' '                                                       
         BE    IMVPC3                                                           
IMVPC2A  MVI   0(R2),C','                                                       
         L     R3,=A(JP2)                                                       
         MVC   0(2,R3),=C'//'                                                   
         LA    R2,15(R3)                                                        
*                                                                               
IMVPC2B  CLI   FLASH,C' '                                                       
         BE    IMVPC2C                                                          
         CLC   FLASH,=C'NONE'                                                   
         BE    IMVPC2C                                                          
         MVC   0(6,R2),=C'FLASH='                                               
         MVC   6(4,R2),FLASH                                                    
         MVI   10(R2),C','                                                      
         LA    R2,11(R2)                                                        
*                                                                               
IMVPC2C  CLC   QJOBCHRS,SPACES     SINGLE CHARS=                                
         BE    IMVPC2X                                                          
         CLC   QJOBCHR2,SPACES                                                  
         BNE   IMVPC2D                                                          
         MVC   0(10,R2),=C'CHARS=    '                                          
         MVC   6(4,R2),QJOBCHRS                                                 
         LA    R2,10(R2)                                                        
         B     IMVPC2X                                                          
*                                                                               
IMVPC2D  MVC   0(7,R2),=C'CHARS=(' CHARS=(CHR1,CHR2,CHR3,CHR4)                  
         MVC   7(4,R2),QJOBCHRS                                                 
         LA    R2,11(R2)                                                        
         MVI   0(R2),C','                                                       
         MVC   1(4,R2),QJOBCHR2                                                 
         LA    R2,5(R2)                                                         
         CLC   QJOBCHR3,SPACES                                                  
         BE    IMVPC2E                                                          
         MVI   0(R2),C','                                                       
         MVC   1(4,R2),QJOBCHR3                                                 
         LA    R2,5(R2)                                                         
         CLC   QJOBCHR4,SPACES                                                  
         BE    IMVPC2E                                                          
         MVI   0(R2),C','                                                       
         MVC   1(4,R2),QJOBCHR4                                                 
         LA    R2,5(R2)                                                         
IMVPC2E  MVI   0(R2),C')'                                                       
*                                                                               
IMVPC2X  BCTR  R2,0                REMOVE TRAILING COMMA                        
         CLI   0(R2),C','                                                       
         BNE   *+8                                                              
         MVI   0(R2),C' '                                                       
*                                                                               
IMVPC3   CLI   QJOBFCH,C' '        TEST FICHE CLASS DEFINED                     
         BE    IMVPC4                                                           
         L     RE,=A(JES1)                                                      
         CLI   0(RE),C' '                                                       
         BE    *+8                                                              
         L     RE,=A(JES3)                                                      
         L     RF,=A(JESFICHE)                                                  
         MVC   0(80,RE),0(RF)      //*FORMAT  PR,DDNAME=SYSPRINT,....           
*                                                                               
IMVPC4   B     IMVSJCLX                                                         
*                                                                               
IMVOC    L     R3,=A(AFP1)         //OU001 OUTPUT CARD#1                        
         L     RF,=A(MVSOUT)                                                    
         ST    R3,AFRSTO           SAVE A(FIRST OUTPUT CARD)                    
         ST    R3,ALASTO                                                        
         MVC   NFRSTO,=H'1'        SET NUMBER OF CARDS IN SET                   
         MVC   NSETS,=H'1'         SET NUMBER OF SETS                           
         XC    AFRSTCLA,AFRSTCLA                                                
         XC    AFRSTCOP,AFRSTCOP                                                
         XC    AFRSTDES,AFRSTDES                                                
         XC    AFRSTFOR,AFRSTFOR                                                
         XC    AFRSTPAG,AFRSTPAG                                                
         MVC   0(80,R3),0(RF)      //OU001 OUTPUT CLASS=X                       
         AP    OUTCRDN,=P'1'                                                    
         ZAP   OUTCRDF,OUTCRDN     SAVE NUM OF FIRST OF THIS SET                
         ZAP   OUTCRDL,OUTCRDN                                                  
         UNPK  4(3,R3),OUTCRDN                                                  
         OI    6(R3),C'0'                                                       
         LA    R2,15(R3)                                                        
         ST    R2,AFRSTCLA                                                      
*                                                                               
IMVOC1A  MVC   6(1,R2),CLASS       SET CLASS                                    
         LA    R2,7(R2)                                                         
*                                                                               
IMVOC1B  CLC   FORMS,SPACES        SET FORMS                                    
         BE    IMVOC1B2                                                         
         MVC   0(7,R2),=C',FORMS='                                              
         MVC   7(4,R2),FORMS                                                    
         LA    R2,7(R2)            BUMP TO END OF FORMS                         
         CLI   0(R2),C' '                                                       
         BE    IMVOC1B2                                                         
         LA    R2,1(R2)                                                         
         B     *-12                                                             
IMVOC1B2 EQU   *                                                                
*                                                                               
IMVOC1C  MVC   0(11,R2),=C',COPIES=001'                                         
         CLI   QJOBCOPY,C' '       TEST IF DEFINED AS SPACE CHR                 
         BE    IMVOC1C2                                                         
         CLI   QJOBCOPY,C'0'       TEST IF DEFINED AS A CHARACTER               
         BL    IMVOC1C1                                                         
         MVC   10(1,R2),QJOBCOPY                                                
         B     IMVOC1C2                                                         
IMVOC1C1 LLC   R1,QJOBCOPY         DEFINED AS BINARY VALUE                      
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  8(3,R2),DUB                                                      
IMVOC1C2 LA    R2,1(R2)                                                         
         ST    R2,AFRSTCOP                                                      
         LA    R2,10(R2)                                                        
*                                                                               
IMVOC1D  CLC   QJOBCC,=C'NONE'                                                  
         BE    IMVOC1D2                                                         
         CLC   QJOBCC,SPACES                                                    
         BE    IMVOC1D2                                                         
IMVOC1D1 MVC   0(5,R2),=C',FCB='                                                
         MVC   5(4,R2),QJOBCC                                                   
         LA    R2,5(R2)                                                         
         CLI   0(R2),C' '                                                       
         BE    IMVOC1D2                                                         
         LA    R2,1(R2)                                                         
         B     *-12                                                             
IMVOC1D2 LA    RF,1(R2)                                                         
         ST    RF,AFRSTDES                                                      
*                                                                               
IMVOC1E  CLI   AFP,C' '            APF DESTINATION INPUT                        
         BE    IMVOC1F                                                          
         MVC   0(6,R2),=C',DEST='                                               
         MVC   6(8,R2),AFP                                                      
         LA    R2,6(R2)                                                         
         CLI   0(R2),C' '                                                       
         BE    IMVOC2                                                           
         LA    R2,1(R2)                                                         
         B     *-12                                                             
*                                                                               
IMVOC1F  MVC   WORK,RJEOPT         RJE SUPPORT                                  
         CLC   QJOBORUT(3),=C'RJE'                                              
         BNE   *+10                                                             
         MVC   WORK(3),QJOBORUT+3                                               
         CLC   WORK(3),SPACES                                                   
         BE    IMVOC1F1                                                         
         CLC   QJOBJES+4(3),=C'A55'                                             
         BE    IMVOC1F1                                                         
         MVC   0(6,R2),=C',DEST='                                               
         MVC   6(3,R2),WORK                                                     
         LA    R2,9(R2)                                                         
IMVOC1F1 EQU   *                                                                
*                                                                               
IMVOC2   MVI   0(R2),C','          // OUTPUT CARD#2                             
         LH    R3,NFRSTO                                                        
         LA    R3,1(R3)                                                         
         STH   R3,NFRSTO           BUMP NUMBER OF CARDS IN FIRST SET            
         L     R3,ALASTO                                                        
         LA    R3,80(R3)                                                        
         ST    R3,ALASTO                                                        
         MVC   0(2,R3),=C'//'                                                   
         LA    R2,15(R3)                                                        
*                                                                               
IMVOC2B  MVC   0(6,R2),=C'FLASH='                                               
         MVC   6(4,R2),FLASH                                                    
         CLI   FLASH,C' '                                                       
         BNE   *+10                                                             
         MVC   6(4,R2),=C'NONE'                                                 
         MVI   10(R2),C','                                                      
         LA    R2,11(R2)                                                        
*                                                                               
IMVOC2C  CLI   QJOBCHRS,C' '       SINGLE CHARS=                                
         BE    IMVOC2X                                                          
         CLI   QJOBCHR2,C' '                                                    
         BNE   IMVOC2D                                                          
         MVC   0(6,R2),=C'CHARS='                                               
         MVC   6(4,R2),QJOBCHRS                                                 
         MVI   10(R2),C','                                                      
         LA    R2,11(R2)                                                        
         B     IMVOC2X                                                          
*                                                                               
IMVOC2D  MVC   0(7,R2),=C'CHARS=(' CHARS=(CHR1,CHR2,CHR3,CHR4)                  
         MVC   7(4,R2),QJOBCHRS                                                 
         LA    R2,11(R2)                                                        
         MVI   0(R2),C','                                                       
         MVC   1(4,R2),QJOBCHR2                                                 
         LA    R2,5(R2)                                                         
         CLI   QJOBCHR3,C' '                                                    
         BE    IMVOC2E                                                          
         MVI   0(R2),C','                                                       
         MVC   1(4,R2),QJOBCHR3                                                 
         LA    R2,5(R2)                                                         
         CLI   QJOBCHR4,C' '                                                    
         BE    IMVOC2E                                                          
         MVI   0(R2),C','                                                       
         MVC   1(4,R2),QJOBCHR4                                                 
         LA    R2,5(R2)                                                         
IMVOC2E  MVI   0(R2),C')'          TERMINATE CHARS=( STRING                     
         MVI   1(R2),C','                                                       
         LA    R2,2(R2)                                                         
*                                                                               
IMVOC2X  BCTR  R2,0                REMOVE TRAILING COMMA                        
         CLI   0(R2),C','                                                       
         BNE   *+8                                                              
         MVI   0(R2),C' '                                                       
*                                                                               
IMVOC3   CLI   QJOBFMN,0           TEST IF ANY FORMDEF/PAGEDEF INFO             
         BNE   IMVOC3A                                                          
*&&UK*&& B     IMVOC4                                                           
IMVOC3A  MVI   0(R2),C','          SET CONTINUATION ON PREVIOUS CARD            
         LH    R3,NFRSTO                                                        
         LA    R3,1(R3)                                                         
         STH   R3,NFRSTO           BUMP NUMBER OF CARDS IN FIRST SET            
         L     R3,ALASTO                                                        
         LA    R3,80(R3)                                                        
         ST    R3,ALASTO                                                        
         MVC   0(2,R3),=C'//'                                                   
         LA    R2,15(R3)                                                        
*                                                                               
IMVOC3B  CLI   QJOBFMD,C' '                                                     
         BE    IMVOC3C                                                          
         OI    PORFDEFS,X'01'      SET FORMDEF OUTPUT                           
         ST    R2,AFRSTFOR                                                      
         MVC   0(8,R2),=C'FORMDEF='                                             
         MVC   8(5,R2),QJOBFMD                                                  
         MVI   13(R2),C'1'                                                      
         LA    R2,14(R2)                                                        
         MVI   0(R2),C','                                                       
         LA    R2,1(R2)                                                         
*                                                                               
IMVOC3C  LA    RF,QJOBPGD          OUPUT PAGEDEF AND SAVE LOCATION              
         CLI   QJOBPGD,C' '                                                     
         BNE   IMVOC3C1                                                         
         LA    RF,=CL6'DSPAGE'     USE DUMMY PAGEDEF NAME                       
IMVOC3C1 OI    PORFDEFS,X'02'      SET PAGEDEF OUTPUT                           
         ST    R2,AFRSTPAG                                                      
         MVC   0(8,R2),=C'PAGEDEF='                                             
         MVC   8(5,R2),0(RF)       SET ACTUAL PAGEDEF NAME                      
         MVI   13(R2),C'1'                                                      
         CLC   0(6,RF),=CL6'DSPAGE'                                             
         BNE   *+14                                                             
         MVC   8(6,R2),0(RF)       SET DUMMY PAGEDEF NAME                       
         NI    PORFDEFS,255-X'02'  AND TURN OFF PAGEDEF OUTPUT FLAG             
         LA    R2,14(R2)                                                        
         MVI   0(R2),C','                                                       
         LA    R2,1(R2)                                                         
*                                                                               
IMVOC3D  EQU   *                                                                
IMVOC3X  BCTR  R2,0                REMOVE TRAILING COMMA                        
         CLI   0(R2),C','                                                       
         BNE   *+8                                                              
         MVI   0(R2),C' '                                                       
*                                                                               
IMVOC4   EQU   *                                                                
*                                                                               
IMVOCA   CLC   NSETS+1(1),QJOBFMN  TEST IF MULTIPLE SETS REQUIRED               
         BNL   IMVOCAX                                                          
         LH    RF,NSETS            BUMP FOR NEXT SETS                           
         LA    RF,1(RF)                                                         
         STH   RF,NSETS                                                         
         L     R3,ALASTO                                                        
         LA    R3,80(R3)                                                        
         ST    R3,ANEXTO                                                        
         L     RE,AFRSTO           GET A(FIRST CARD IN SET)                     
         LH    RF,NFRSTO           GET NUMBER OF CARDS IN SET                   
IMVOCA2  MVC   0(80,R3),0(RE)                                                   
         ST    R3,ALASTO                                                        
         LA    R3,80(R3)                                                        
         LA    RE,80(RE)                                                        
         BCT   RF,IMVOCA2                                                       
         L     R3,ANEXTO                                                        
         AP    OUTCRDN,=P'1'                                                    
         ZAP   OUTCRDL,OUTCRDN     SAVE NUM OF LAST IN THIS SET                 
         UNPK  4(3,R3),OUTCRDN                                                  
         OI    6(R3),C'0'                                                       
*                                                                               
IMVOCA3  ICM   RF,15,AFRSTFOR      LOCATE FORMDEF=.....N                        
         BZ    IMVOCA4                                                          
         S     RF,AFRSTO                                                        
         AR    RF,R3                                                            
         LH    RE,NSETS                                                         
         IC    RE,NUMSLETS(RE)                                                  
         STC   RE,13(RF)           PLUG IN NEXT NUMBER OR LETTER                
*                                                                               
IMVOCA4  ICM   RF,15,AFRSTPAG      LOCATE PAGEDEF=.....N                        
         BZ    IMVOCA5                                                          
         S     RF,AFRSTO                                                        
         AR    RF,R3                                                            
         CLC   8(6,RF),=CL6'DSPAGE'                                             
         BE    IMVOCA5                                                          
         LH    RE,NSETS                                                         
         IC    RE,NUMSLETS(RE)                                                  
         STC   RE,13(RF)           PLUG IN NEXT NUMBER OR LETTER                
         CLI   QJOBPGN,1                                                        
         BNE   *+8                                                              
         MVI   13(RF),C'1'         ONLY ONE PAGEDEF                             
*                                                                               
IMVOCA5  B     IMVOCA              BACK FOR NEXT SET                            
IMVOCAX  EQU   *                                                                
*                                                                               
IMVOCC   CLI   QJOBDISP,C'K'       TEST OUTPUT DISP KEEP                        
         BE    *+12                                                             
         CLI   QJOBKEEP,C'Y'                                                    
         BNE   IMVOCCX                                                          
         MVI   WHATDEST,C'K'       SET WANT DEST=KEEP OUTPUT CARD(S)            
         XC    NSETS,NSETS                                                      
*                                                                               
*WHEN BETA WORKS PROPERLY AND DONT NEED DEST=KEEP SET                           
*REPLACE THE ABOVE SINGLE XC INST BY THE FOLLOWING THREE INSTS                  
*                                                                               
*NOP*    CLI   BETAKEEP,C' '       TEST BETAKEEP= INPUT                         
*NOP*    BE    IMVOCC1                                                          
*NOP*    MVI   WHATDEST,C'B'       YES-SET ONLY WANT DEST=BETAKEEP(S)           
*                                                                               
IMVOCC1  LH    RF,NSETS            BUMP FOR NEXT SETS                           
         LA    RF,1(RF)                                                         
         STH   RF,NSETS                                                         
         L     R3,ALASTO                                                        
         LA    R3,80(R3)                                                        
         ST    R3,ANEXTO                                                        
         L     RE,AFRSTO           GET A(FIRST CARD IN SET)                     
         LH    RF,NFRSTO           GET NUMBER OF CARDS IN SET                   
IMVOCC2  MVC   0(80,R3),0(RE)                                                   
         ST    R3,ALASTO                                                        
         LA    R3,80(R3)                                                        
         LA    RE,80(RE)                                                        
         BCT   RF,IMVOCC2                                                       
         L     R3,ANEXTO                                                        
         AP    OUTCRDN,=P'1'                                                    
         ZAP   OUTCRDL,OUTCRDN     SAVE NUM OF LAST IN THIS SET                 
         UNPK  4(3,R3),OUTCRDN                                                  
         OI    6(R3),C'0'                                                       
*                                                                               
IMVOCC3  ICM   RF,15,AFRSTFOR      LOCATE FORMDEF=.....N                        
         BZ    IMVOCC4                                                          
         S     RF,AFRSTO                                                        
         AR    RF,R3                                                            
         LH    RE,NSETS                                                         
         IC    RE,NUMSLETS(RE)                                                  
         STC   RE,13(RF)           PLUG IN NEXT NUMBER OR LETTER                
*                                                                               
IMVOCC4  ICM   RF,15,AFRSTPAG      LOCATE PAGEDEF=.....N                        
         BZ    IMVOCC5                                                          
         S     RF,AFRSTO                                                        
         AR    RF,R3                                                            
         CLC   8(6,RF),=CL6'DSPAGE'                                             
         BE    IMVOCC5                                                          
         LH    RE,NSETS                                                         
         IC    RE,NUMSLETS(RE)                                                  
         STC   RE,13(RF)           PLUG IN NEXT NUMBER OR LETTER                
         CLI   QJOBPGN,1                                                        
         BNE   IMVOCC5                                                          
         MVI   13(RF),C'1'         ONLY ONE PAGEDEF                             
*                                                                               
IMVOCC5  ICM   RF,15,AFRSTCOP      LOCATE COPIES=NNN                            
         BZ    IMVOCC6                                                          
         S     RF,AFRSTO                                                        
         AR    RF,R3                                                            
         B     *+10                LEAVE SAME AS ORIGINAL VALUE                 
         MVC   7(3,RF),=C'001'     SET TO ONE COPY                              
*                                                                               
IMVOCC6  ICM   RF,15,AFRSTDES      LOCATE DEST=XXXXXXXX                         
         BZ    IMVOCC7                                                          
         S     RF,AFRSTO                                                        
         AR    RF,R3                                                            
         BCTR  RF,0                                                             
         MVC   0(15,RF),=C',DEST=KEEP,    '                                     
         CLI   WHATDEST,C'K'                                                    
         BE    IMVOCC6A                                                         
         MVC   0(15,RF),=C',DEST=BETA,    '                                     
*                                                                               
IMVOCC6A ICM   RF,15,AFRSTCLA      LOCATE CLASS=                                
         BZ    IMVOCC7                                                          
         S     RF,AFRSTO                                                        
         AR    RF,R3                                                            
IMVOCC6B CLI   WHATDEST,C'K'       TEST DEST=KEEP                               
         BNE   IMVOCC6C                                                         
         CLI   AFPKEEP,C' '        TEST AFPKEEP= ENTERED                        
         BE    IMVOCC7                                                          
         MVC   6(1,RF),AFPKEEP                                                  
         B     IMVOCC7                                                          
IMVOCC6C CLI   WHATDEST,C'B'       TEST DEST=BETA                               
         BNE   IMVOCC7                                                          
         CLI   BETAKEEP,C' '       TEST BETAKEEP= ENTERED                       
         BE    IMVOCC7                                                          
         MVC   6(1,RF),BETAKEEP                                                 
         B     IMVOCC7                                                          
*                                                                               
IMVOCC7  CLC   NSETS+1(1),QJOBFMN  TEST IF MULTIPLE SETS REQUIRED               
         BL    IMVOCC1             YES-BACK FOR NEXT SET                        
*                                                                               
IMVOCC8  CLI   BETAKEEP,C' '       TEST BETAKEEP= INPUT                         
         BE    IMVOCCX                                                          
         CLI   WHATDEST,C'B'                                                    
         BE    IMVOCCX                                                          
         MVI   WHATDEST,C'B'       SET WANT DEST=BETA OUTPUT CARDS(S)           
         XC    NSETS,NSETS                                                      
         LLC   R0,QJOBFMN          SET ONLY WANT ONE SET OF DEST=BETA           
         AHI   R0,-1                                                            
         BNP   *+8                                                              
         STC   R0,NSETS+1          INIT COUNT TO QJOBFMN-1                      
         B     IMVOCC1                                                          
IMVOCCX  EQU   *                                                                
*                                                                               
IMVOCE   CLI   QJOBFCH,C' '        TEST FICHE CLASS DEFINED                     
         BE    IMVOCEX                                                          
         L     R3,ALASTO                                                        
         LA    R3,80(R3)                                                        
         ST    R3,ALASTO                                                        
         L     RF,=A(MVSFICHE)                                                  
         MVC   0(80,R3),0(RF)      //OU003 OUTPUT CLASS=S,DEST=FICHE            
         MVC   21(1,R3),QJOBFCH                                                 
         AP    OUTCRDN,=P'1'                                                    
         ZAP   OUTCRDL,OUTCRDN     SAVE NUM OF LAST IN THIS SET                 
         UNPK  4(3,R3),OUTCRDN                                                  
         OI    6(R3),C'0'                                                       
IMVOCEX  EQU   *                                                                
*                                                                               
INVOCS   L     R3,=A(JP1)          SYSPRINT-1 OUTPUT MODE                       
         L     RF,=A(MVSSYP)                                                    
         MVC   0(15,R3),0(RF)      //SYSPRINT  DD                               
         LA    R2,15(R3)                                                        
         MVC   0(10,R2),=C'SYSOUT=(,)'                                          
         LA    R2,10(R2)                                                        
*                                                                               
IMVOCS1  CLI   CLASS,C'Q'          IS OUTPUT CLASS Q                            
         BNE   IMVOCS1A                                                         
         CLI   QJOBDISP,C'T'       AND DISPOSITION NOT TAPE                     
         BE    IMVOCS1A                                                         
*&&UK*&& B     IMVOCS1N            UK SET HOLD=N                                
*&&US*&& B     IMVOCS1Y            US SET HOLD=Y                                
IMVOCS1A CLI   QJOBDISP,C'H'       TEST OUTPUT DISP HOLD                        
         BNE   IMVOCS2                                                          
IMVOCS1Y MVC   0(7,R2),=C',HOLD=Y'                                              
         B     *+10                                                             
IMVOCS1N MVC   0(7,R2),=C',HOLD=N'                                              
         LA    R2,7(R2)                                                         
*                                                                               
IMVOCS2  L     RF,=A(FREEZE)       TEST IF OK TO OUTPUT FREE=CLOSE              
         BASR  RE,RF                                                            
         BNE   IMVOCS2A                                                         
         MVC   0(11,R2),=C',FREE=CLOSE'                                         
         LA    R2,11(R2)                                                        
IMVOCS2A EQU   *                                                                
*                                                                               
IMVOCS3  MVC   0(9,R2),=C',OUTPUT=('                                            
         LA    R2,9(R2)                                                         
         ZAP   HALF,OUTCRDF        SET HALF TO FIRST CARD NUM                   
*                                                                               
IMVOCS4  CP    HALF,OUTCRDL        TEST IF DONE LAST ONE                        
         BNH   *+14                                                             
         BCTR  R2,0                                                             
         MVI   0(R2),C')'          TERMINATE OUTPUT= PARAM                      
         B     IMVSJCLX            HOO FUCKING RAH                              
         LA    RF,71(R3)                                                        
         SR    RF,R2                                                            
         CHI   RF,8                TEST IF ENOUGH ROOM                          
         BL    IMVOCS6                                                          
IMVOCS5  MVC   0(8,R2),=C'*.OU000,'                                             
         UNPK  4(3,R2),HALF                                                     
         OI    6(R2),C'0'                                                       
         AP    HALF,=P'1'                                                       
         LA    R2,8(R2)                                                         
         B     IMVOCS4                                                          
*                                                                               
IMVOCS6  LA    R3,80(R3)           CREATE CONTINUATION CARD                     
         MVC   0(2,R3),=C'//'                                                   
         LA    R2,15(R3)                                                        
         B     IMVOCS5                                                          
*                                                                               
IMVSJCLX XIT1                                                                   
*                                                                               
NUMSLETS DC    C'0123456789ABCDEFGHILJKMNOPQRSTUVWXYZ'                          
*                                                                               
XCEPTLST DC    0CL2' '             LIST OF JOBS TO EXCLUDE FROM DISP=H          
         DC    C'A1'                                                            
         DC    C'A2'                                                            
         DC    C'B2'                                                            
         DC    C'B3'                                                            
         DC    C'C2'                                                            
         DC    C'C6'                                                            
         DC    C'FA'                                                            
         DC    C'M2'                                                            
         DC    C'PA'                                                            
         DC    C'PC'                                                            
         DC    C'T4'                                                            
         DC    C'T5'                                                            
         DC    C'21'                                                            
         DC    C'23'                                                            
         DC    C'25'                                                            
         DC    C'55'                                                            
         DC    C'89'                                                            
         DC    C'9A'                                                            
         DC    C'90'                                                            
         DC    C'91'                                                            
         DC    C'92'                                                            
         DC    C'93'                                                            
         DC    C'94'                                                            
         DC    C'95'                                                            
         DC    C'96'                                                            
         DC    C'98'                                                            
         DC    X'FFFF'                                                          
         EJECT                                                                  
***********************************************************************         
*SINGLE INPUT JCL CARD                                                *         
***********************************************************************         
PUTSGLC  NTR1  BASE=*              PUT MVS SINGLE INPUT JCL CARDS               
         MVI   HALF1,0             SET IF PRTY=X DETECTED                       
         L     R1,=A(JCLIN)                                                     
         MVI   OUTSIN,C'Y'                                                      
         CP    MAXSTEPS,=P'1'      IF SINGLE AND MAXSTEPS=1 THEN....            
         BNE   PUTSGLC1                                                         
         L     RF,=A(JJ1)                                                       
         MVC   2(8,R1),2(RF)       OVERRIDE INPUT JOB NAME                      
         LA    R2,8(R1)                                                         
         LA    R0,72               SCAN FOR PRTY=X                              
*                                                                               
PUTSGLCA CLC   0(7,R2),=C',PRTY=X'                                              
         BE    PUTSGLCB                                                         
         LA    R2,1(R2)                                                         
         BCT   R0,PUTSGLCA                                                      
         B     PUTSGLC1                                                         
*                                                                               
PUTSGLCB MVC   HALF1(1),6(R2)      MOVE IN ORIGNINAL CHR (X)                    
         LA    RE,X'FA'            INVERT PRIORITY                              
         LLC   RF,QOUTPRI                                                       
         SR    RE,RF                                                            
         STC   RE,6(R2)                                                         
         OI    6(R2),X'F0'                                                      
*                                                                               
PUTSGLC1 CLI   0(R1),C' '          EXIT ON FIRST BLANK CARD                     
         BE    PUTSGLC2                                                         
         MVC   JCL,0(R1)                                                        
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
         LA    R1,80(R1)                                                        
         B     PUTSGLC1                                                         
PUTSGLC2 MVI   OUTSIN,C'X'         SET END OF SPECIALS                          
         CLI   HALF1,0             TEST PRTY=X OVERWITTEN                       
         BE    *+10                                                             
         MVC   6(1,R2),HALF1       RESTORE                                      
         TM    TRACE,X'80'                                                      
         BZ    PUTSGLCX                                                         
         GOTO1 =V(PRINTER)                                                      
PUTSGLCX XIT1                                                                   
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*PUT FINAL EOJ CARDS                                                  *         
***********************************************************************         
FMVSJCL  NTR1  BASE=*,LABEL=*      PUT MVS EOJ CARD                             
         MVC   JCL,SPACES                                                       
         CLI   SINGLE,0                                                         
         BNE   FMVSJCL2                                                         
FMVSJCL1 MVC   JCL(2),=C'//'                                                    
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
         B     FMVSJCLX                                                         
*                                                                               
FMVSJCL2 CLI   JCLINJLN,0          TEST IF MAXSTEPS SPECIFIED                   
         BE    FMVSJCLX                                                         
         CLI   MAXTAPES,0          IS MAXTAPES IN OPERATION                     
         BE    FMVSJCL3                                                         
         CLI   JOBTAPES,0          YES-TEST IF OUTPUT TAPES MATCH               
         BE    FMVSJCL3                                                         
         MVC   TSTTAPES,MAXTAPES                                                
         NC    TSTTAPES,JOBTAPES                                                
         BNZ   FMVSJCL1                                                         
FMVSJCL3 CP    JOBEXEC,MAXSTEPS    TEST IF MAXSTEPS EXCEEDED                    
         BL    FMVSJCLX                                                         
         B     FMVSJCL1                                                         
FMVSJCLX XIT1                                                                   
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*SUBROUTINE TO CHECK IF IDI OUTPUT TYPE OVERRRIDE APPLIES             *         
*CALLS SETS OUTPUT TYPE/SYSTEM/PROGRAM                                *         
***********************************************************************         
IDIOT    NTR1  BASE=*,LABEL=*                                                   
         MVI   IDIOTRCD,C' '                                                    
IDIOT1   CLC   IDIOTOTY(2),=C'S1'  OUTPUT TYPE S1.... (MAX 4 SYS CHRS)          
         BNE   IDIOT2                                                           
         LA    RE,IDIOTOTY+2                                                    
         LA    RF,4                                                             
         B     IDIOT4                                                           
IDIOT2   CLI   IDIOTOTY,C'#'       OUTPUT TYPE #..... (MAX 5 SYS CHRS)          
         BNE   IDIOTX                                                           
         CLC   IDIOTOTY+1(5),SPACES                                             
         BE    IDIOT5                                                           
         LA    RE,IDIOTOTY+1                                                    
         LA    RF,5                                                             
IDIOT4   CLC   0(1,RE),IDIOTSYS    CHECK IF SYSTEM IN OUTPUT TYPE NAME          
         BE    IDIOT5                                                           
         LA    RE,1(RE)                                                         
         BCT   RF,IDIOT4                                                        
         B     IDIOTX                                                           
IDIOT5   LA    RF,IDIOTLST         CHECK FOR SYSTEM/PROGRAM EXCEPTIONS          
IDIOT5A  CLI   0(RF),C' '                                                       
         BE    IDIOTQ                                                           
         CLC   0(3,RF),IDIOTSYS    IGNORE IF IN LIST                            
         BE    IDIOTX                                                           
         LA    RF,3(RF)                                                         
         B     IDIOT5A                                                          
*                                                                               
IDIOTQ   MVI   IDIOTRCD,C'Q'                                                    
IDIOTX   CLI   IDIOTRCD,C'Q'       EXIT WITH CC EQL IF IDI OVERRIDE             
         XIT1                                                                   
*                                                                               
IDIOTLST DS    0C                                                               
*&&UK                                                                           
         DC    C'A07',C'A55',C'A77'                                             
         DC    C'M05',C'M31',C'M74',C'M75'                                      
*&&                                                                             
*&&US                                                                           
         DC    C'A55',C'AT5',C'A56'                                             
*&&                                                                             
IDIOTLSX DC    C' '                                                             
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*SUBROUTINE TO CHECK IF FREE=CLOSE IS VALID FOR THIS JOB              *         
***********************************************************************         
FREEZE   NTR1  BASE=*,LABEL=*                                                   
         SR    R0,R0               SET OK TO OUTPUT FREE=NO                     
         CLI   FREE,C'N'           FREE=N PARAMATER CARD INPUT                  
         BE    FREEZENO                                                         
         LA    RF,FREEBAN          SEARCH TABLE OF BANNED REQUESTS              
*                                                                               
FREEZE1  CLI   0(RF),C' '          END OF TABLE                                 
         BE    FREEZE2                                                          
         CLC   QJOBJES+4(3),0(RF)                                               
         BE    FREEZENO                                                         
         LA    RF,L'FREEBAN(RF)                                                 
         B     FREEZE1                                                          
*                                                                               
FREEZE2  CLI   QPRIPO,C'I'         TEST PRG OUTPUT TYPE FOR NOT OK              
         BE    FREEZENO                                                         
         CLI   QPRIPO,C'R'                                                      
         BE    FREEZENO                                                         
         CLI   QPRIPO,C'Y'                                                      
         BE    FREEZENO                                                         
         CLI   QPRIPO,C'Z'                                                      
         BE    FREEZENO                                                         
         CLI   QPRIPO,C'9'                                                      
         BE    FREEZENO                                                         
         B     FREEZEX                                                          
*                                                                               
FREEZENO LA    R0,1                SET NO FREE=CLOSE ALLOWED                    
FREEZEX  LTR   R0,R0                                                            
         XIT1                      EXIT WITH CC=EQ IF FREE=CLOSE OK             
*                                                                               
FREEBAN  DS    0CL3                REQS THAT CHANGE BOXWIDTH                    
*&&UK*&& DC    C'MDR'                                                           
*&&UK*&& DC    C'MGR'                                                           
*&&UK*&& DC    C'MBA'                                                           
*&&UK*&& DC    C'MMT'                                                           
*&&UK*&& DC    C'ARW'                                                           
*&&UK*&& DC    C'LWR'                                                           
*&&UK*&& DC    C'AM2'                                                           
*&&UK*&& DC    C'AM3'                                                           
*&&UK*&& DC    C'AT2'                                                           
*&&UK*&& DC    C'AES'                                                           
*&&UK*&& DC    C'AEY'                                                           
*&&UK*&& DC    C'AIL'                                                           
*&&UK*&& DC    C'APL'                                                           
*&&UK*&& DC    C'ARL'                                                           
*&&UK*&& DC    C'AVL'                                                           
*&&UK*&& DC    C'AXL'                                                           
*&&UK*&& DC    C'A1L'                                                           
*&&UK*&& DC    C'AE1'                                                           
*&&UK*&& DC    C'AE2'                                                           
*&&UK*&& DC    C'ATC'                                                           
*&&UK*&& DC    C'ATG'                                                           
*&&UK*&& DC    C'AFI'                                                           
*&&UK*&& DC    C'BWR'                                                           
*&&UK*&& DC    C'ACC'                                                           
*&&UK*&& DC    C'MRM'                                                           
*&&UK*&& DC    C'ATE'                                                           
FREEBANX DC    C'   '                                                           
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*CHECK EACH JCL CARD AND MODIFY IF NECESSARY                          *         
***********************************************************************         
JCLCHK   NTR1  BASE=*,LABEL=*                                                   
         MVI   DELJCL,0            SET DO NOT DELETE FLAG                       
         MVI   THSJCL,0                                                         
         CLI   OUTSIN,C'Y'         EXIT IF SPECIAL                              
         BE    JCLCHKX                                                          
         CLC   JCL(2),=C'//'       TEST IF JCL STATEMENT                        
         BNE   JCLCHKX                                                          
         CLI   JCL+2,C'*'          SKIP COMMENT CARD                            
         BE    JCLCHKX                                                          
         CLC   JCL+2(40),SPACES    SKIP IF NO DATA                              
         BE    JCLCHKX                                                          
*                                                                               
JCLCHKA  LA    RE,JCL+2            TEST IF EXEC CARD                            
         LA    R0,16                                                            
JCLCHKAZ CLC   0(6,RE),=C' EXEC '                                               
         BE    JCLCHKA1                                                         
         CLC   0(5,RE),=C' NJB '                                                
         BE    JCLCHKA0                                                         
         LA    RE,1(RE)                                                         
         BCT   R0,JCLCHKAZ                                                      
         B     JCLCHKC                                                          
*                                                                               
JCLCHKA0 CLC   JCL+2(5),=C'XXXXX'  TEST IF I CREATE NJB NAME                    
         BNE   JCLCHKC                                                          
         MVC   JCL+2(8),QJOBJES    SET JOB NAME                                 
         CLI   JCL+9,C' '                                                       
         BE    JCLCHKC                                                          
         CLI   JCL+10,C' '                                                      
         BE    JCLCHKC                                                          
         MVC   WORK(70),JCL+10     JOB NAME TOO LONG                            
         MVC   JCL+10(70),SPACES                                                
         MVC   JCL+11(69),WORK                                                  
         B     JCLCHKC                                                          
*                                                                               
JCLCHKA1 CLI   ACCEMU,C'E'         CHANGE MONACC TO ACCEMU                      
         BNE   JCLCHKA2                                                         
         ST    RE,SAVERE           SAVE CURRENT LOCATION                        
         BAS   RE,CHMONACC                                                      
         L     RE,SAVERE                                                        
JCLCHKA2 MVC   STEPNAMP,STEPNAME   SAVE STEPNAME PREVIOUS                       
         MVC   STEPNAME,JCL+2      SAVE STEPNAME                                
         AP    FSTEXEC,=P'1'       BUMP EXEC CARD WITHIN JOB                    
         AP    JOBEXEC,=P'1'       BUMP EXEC CARD WITHIN MAXSTEPS               
         AP    TOTEXEC,=P'1'       BUMP EXEC CARD WITHIN WRAP                   
         MVI   OUTSYP,C'N'                                                      
         CP    FSTEXEC,=P'1'                                                    
         BNE   *+10                                                             
         MVC   STEPNAMF,STEPNAME   SAVE STEPNAME FIRST                          
         CLC   JCL+2(5),=C'XXXXX'  TEST IF I CREATE STEP NAME                   
         BNE   JCLCHKX                                                          
JCLCHKA3 MVC   JCL+2(4),QJOBJES    SET STEP NAME AND NUMBER                     
         UNPK  JCL+6(3),FSTEXEC                                                 
         OI    JCL+8,C'0'                                                       
         MVC   STEPNAME,JCL+2                                                   
         CLI   SINGLE,0            TEST IF SINGLE JOB                           
         BE    JCLCHKX             NO                                           
JCLCHKA4 MVC   JCL+2(8),QJOBJES    SET FIRST STEP NAME TO JOB NAME              
         CLI   JCL+9,C' '                                                       
         BE    JCLCHKA5                                                         
         CLI   JCL+10,C' '                                                      
         BE    JCLCHKA5                                                         
         MVC   WORK(70),JCL+10     STEP NAME TOO LONG                           
         MVC   JCL+10(70),SPACES                                                
         MVC   JCL+11(69),WORK                                                  
JCLCHKA5 CP    FSTEXEC,=P'1'                                                    
         BE    JCLCHKA6                                                         
         UNPK  JCL+6(3),TOTEXEC    SET OTHER STEP NAMES TO ABS NUM              
         OI    JCL+8,C'0'                                                       
         MVI   JCL+9,C' '                                                       
JCLCHKA6 MVC   STEPNAME,JCL+2      SAVE STEPNAME                                
         CP    FSTEXEC,=P'1'                                                    
         BNE   *+10                                                             
         MVC   STEPNAMF,STEPNAME   SAVE STEPNAME OF FIRST MULTI STEP            
*                                                                               
JCLCHKB  CLI   SINGLE,0            EXIT IF NOT SINGLE JOB WRAP                  
         BE    JCLCHKX                                                          
         MVC   CONDPARM,CONDPPRO   SET COND/ACCT PARMS FOR PROC=                
         MVC   ACCTPARM,ACCTPPRO                                                
         LA    RE,6(RE)            FIND END OF EXEC CARD DATA                   
         LA    R0,10                                                            
JCLCHKB1 CLI   0(RE),C' '                                                       
         BNE   JCLCHKB2                                                         
         LA    RE,1(RE)                                                         
         BCT   R0,JCLCHKB1                                                      
         B     JCLCHKX                                                          
JCLCHKB2 CLI   0(RE),C' '                                                       
         BE    JCLCHKB3                                                         
         CLC   0(4,RE),=C'PGM='                                                 
         BNE   *+16                                                             
         MVC   CONDPARM,CONDPPGM   SET COND/ACCT PARMS FOR PGM=                 
         MVC   ACCTPARM,ACCTPPGM                                                
         CLC   0(6,RE),CONDPPRO    TEST IF CARD ALREAD HAS COND=                
         BE    JCLCHKB4                                                         
         CLC   0(6,RE),CONDPPGM                                                 
         BE    JCLCHKB4                                                         
         LA    RE,1(RE)                                                         
         B     JCLCHKB2                                                         
JCLCHKB3 LR    RF,RE               TEST IF THIS IS SINGLE EXEC CARD             
         BCTR  RF,0                                                             
         CLI   0(RF),C','                                                       
         BE    JCLCHKX                                                          
         MVC   0(11,RE),CONDPARM                                                
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
         L     RE,=A(MVSEOJ)                                                    
         MVC   JCL,0(RE)                                                        
         MVC   JCL+15(05),ACCTPARM                                              
         L     RF,=A(JJ1)                                                       
         MVC   JCL+20(9),15(RF)    EXTRACT ACCT INFO FROM JOB CARD              
         B     JCLCHKX                                                          
JCLCHKB4 B     JCLCHKX                                                          
*                                                                               
JCLCHKC  L     RE,=A(MVSSYP)       TEST IF //SYSPRINT DD CARD                   
         CLC   JCL(11),0(RE)                                                    
         BNE   JCLCHKD                                                          
         LA    RF,JCL+11           SEARCH FOR SYSOUT PARM                       
         LA    R0,10                                                            
         CLC   0(7,RF),=C'SYSOUT=(C,,'                                          
         BE    *+16                                                             
         LA    RF,1(RF)                                                         
         BCT   R0,*-14                                                          
         B     JCLCHKD                                                          
         LA    RF,7(RF)                                                         
         CLI   0(RF),C'('          NON BASICS HAVE SYSOUT=(C,,...               
         BE    JCLCHKCA                                                         
         CLC   1(20,RF),SPACES     TEST FOR EMPTY BASIC CARD                    
         BNE   JCLCHKC2                                                         
*                                                                               
JCLCHKC1 CLI   OUTSYP,C'Y'         EMPTY BASIC SYSPRINT CARD                    
         BE    JCLCHDEL                                                         
         L     RE,=A(JP1)                                                       
         CLI   0(RE),C' '          TEST IF HAVE REAL CARD SAVED                 
         BE    JCLCHKCA            NO                                           
         BAS   RE,PUTJESC          OUTPUT ANY SAVED JES CARDS                   
         BAS   RE,PUTAFPC          OUTPUT ANY SAVED OUTPUT CARDS                
         BAS   RE,PUTSPRC          OUTPUT REAL SYSPRINT CARD                    
         B     JCLCHDEL                                                         
*                                                                               
JCLCHKC2 L     RE,=A(JP1)          NON EMPTY BASIC CONTAINS LASER DATA          
         CLI   0(RE),C' '                                                       
         BE    JCLCHKCA            OUTPUT THIS CARD IF NO REAL SYSPRINT         
         LA    RE,15(RE)                                                        
         CLI   0(RE),C' '          SET CONTINUATION IF NECESSARY                
         BE    *+12                                                             
         LA    RE,1(RE)                                                         
         B     *-12                                                             
         BCTR  RE,0                                                             
         CLI   0(RE),C','                                                       
         BE    *+8                                                              
         MVI   1(RE),C','                                                       
*                                                                               
JCLCHKC3 L     RE,=A(JP2)          INITIALISE SAVE CONTINUATION CARD            
         MVC   0(80,RE),SPACES                                                  
         MVC   0(2,RE),=C'//'                                                   
         LA    R1,JCL+67           SET LEN FOR EXECUTED MOVE                    
         SR    R1,RF                                                            
         BM    JCLCHKC4                                                         
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   15(0,RE),2(RF)      COPY LASER PARMS                             
JCLCHKC4 CLI   OUTSYP,C'Y'         HAS SYSPRINT CARD BEEN OUTPUT                
         BE    JCLCHDEL            YES-THEN DELETE THIS BASIC                   
         BAS   RE,PUTJESC          OUTPUT ANY SAVED JES CARDS                   
         BAS   RE,PUTAFPC          OUTPUT ANY SAVED OUTPUT CARDS                
         BAS   RE,PUTSPRC          OUTPUT NEW REAL SYSPRINT CARD                
         B     JCLCHDEL                                                         
*                                                                               
JCLCHKCA CLI   OUTSYP,C'Y'         HAS SYSPRINT CARD BEEN OUTPUT                
         BNE   *+12                                                             
         OI    THSJCL,X'11'        YES-SET DELETED SYSPRINT CARD                
         B     JCLCHDEL                                                         
         L     RE,=A(JP1)          SAVE NEW //SYSPRINT CARD                     
         MVC   0(80,RE),JCL                                                     
         MVC   80(80,RE),SPACES                                                 
         MVI   OUTSYP,C'Y'                                                      
         OI    THSJCL,X'10'        SET THIS JCL IS MVS //SYSPRINT               
         B     JCLCHKX                                                          
*                                                                               
JCLCHKD  TM    LSTJCL,X'10'        TEST IF LAST CARD WAS //SYSPRINT             
         BZ    JCLCHKE                                                          
         CLI   JCL+2,C' '          IS THIS A CONTINUATION                       
         BNE   JCLCHKE                                                          
         TM    LSTJCL,X'01'        TEST IF WE DELETED LAST CARD                 
         BO    JCLCHDEL                                                         
         L     RE,=A(JP2)          SAVE CONTINUATION                            
         MVC   0(80,RE),JCL                                                     
         B     JCLCHKX                                                          
JCLCHKE  B     JCLCHKX                                                          
*                                                                               
JCLCHDEL MVI   DELJCL,1            DELETE THIS JCL CARD                         
         B     JCLCHKX                                                          
JCLCHKX  MVC   LSTJCL,THSJCL       SAVE JCL FLAG                                
         CLI   DELJCL,0            EXIT WITH CC=EQL IF OK CARD                  
         XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
*CHECK FOR PROC                                                       *         
***********************************************************************         
CHMONACC NTR1                      CHANGE MONACC TO ACCEMU                      
         LA    R1,JCL+2                                                         
         LA    R0,30                                                            
CHMONAC2 CLC   0(6,R1),=C'MONACC'                                               
         BE    CHMONAC4                                                         
         CLC   0(5,R1),=C'SPOOF'                                                
         BE    CHMONAC6                                                         
         LA    R1,1(R1)                                                         
         BCT   R0,CHMONAC2                                                      
         B     CHMONACX                                                         
CHMONAC4 MVC   0(6,R1),=C'ACCEMU'                                               
         B     CHMONACX                                                         
CHMONAC6 MVC   0(5,R1),=C'SFEMU'                                                
CHMONACX XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
*PUT MVS JCL CARDS                                                    *         
***********************************************************************         
PUTJESC  NTR1                      PUT MVS JES CARD                             
         L     R1,=A(JES1)                                                      
         MVI   OUTJES,C'Y'                                                      
         B     PUTMVSC                                                          
PUTAFPC  NTR1                      PUT MVS SYSPRINT CARD                        
         L     R1,=A(AFP1)                                                      
         MVI   OUTAFP,C'Y'                                                      
         B     PUTMVSC                                                          
PUTSPRC  NTR1                      PUT MVS SYSPRINT CARD                        
         L     R1,=A(JP1)                                                       
         MVI   OUTSYP,C'Y'                                                      
PUTMVSC  CLI   0(R1),C' '          EXIT ON FIRST BLANK CARD                     
         BE    PUTMVSCX                                                         
         MVC   JCL,0(R1)                                                        
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
         LA    R1,80(R1)                                                        
         B     PUTMVSC                                                          
PUTMVSCX XIT1                                                                   
*                                                                               
SAVERE   DS    F                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*ALL XFILE REQUEST GO TO THE PRINT QUEUE.                             *         
*THE FIRST REQUEST IN A JOB WILL THE CREATION OF A NEW EMPTY REPORT.  *         
*THE FIRST DIRECT=CARD WILL DEFINE THAT WE REPLACE THE NEW REPORT.    *         
*SUBSEQUENT DIRECT=CARDS WILL DEFINE THAT WE APPEND TO THE END.       *         
*SUBSEQUENT DIRECT=CARDS WILL DEFINE THAT WE APPEND TO THE END.       *         
*                                                                     *         
*123456789012345678901234567890123456789012345678901234567890123456789*         
*                                                                     *         
*IRECT=SPP,FFFF,UUUUU,P,DI ,C,C,C,XF=XXXXXXXXXXXXXXXXXX,DDDDDDDDDDD,XX*         
***********************************************************************         
ANYDIR   NTR1  BASE=*,LABEL=*                                                   
         CLI   SYSPMODE,C'D'       TEST SYSPRINT=DUMMY (NO OUTPUT)              
         BE    ANYDIRX                                                          
*                                                                               
ANYDIR0  CP    DIRCOUNT,=P'0'      TEST IF FIRST DIRECT=CARD THIS JOB           
         BNE   ANYDIR1                                                          
ANYDIR0A CLI   QOUTTYPE,C'@'       YES-TEST DIRECT/SQL REPORT                   
         BNE   ANYDIR0B                                                         
         MVC   QJOBPQDS,SPACES     SET C'SPP  @ABCDE' AS PQ DESC                
         MVC   QJOBPQDS+0(1),QSYSTEM                                            
         MVC   QJOBPQDS+1(2),QPROGRAM                                           
         MVC   QJOBPQDS+5(6),QOUTTYPE                                           
ANYDIR0B L     RF,=A(GETPQ)        HAVE TO GET A PQ REPORT                      
         BASR  RE,RF                                                            
         BNE   ANYDIRX                                                          
         MVC   QJOBOSID,SVPQID     SET REPORT ID                                
         MVC   QJOBOSNO,SVPQNO     SET REPORT NUMBER                            
         B     ANYDIR10                                                         
*                                                                               
ANYDIR1  L     RE,=A(LDIRECT)      COPY LAST DIRECT=CARD TO CREATE THIS         
         MVC   JCL,0(RE)                                                        
         MVC   JCL+51(4),=C'0001'  SET APPEND DATA TO EXISTING REPORT           
         B     ANYDIR24                                                         
*                                                                               
ANYDIR10 MVC   JCL,SPACES                                                       
         MVC   JCL(21),=C'DIRECT=SPP,FFFF,NNNNN'                                
         MVC   JCL+7(3),QJOBOSID   USE THIS AS THE REPORT ID                    
         MVC   JCL+11(4),QJOBPOWO                                               
         B     ANYDIR12                                                         
ANYDIR11 MVC   JCL,SPACES                                                       
         MVC   JCL(21),=C'DIRECT=SPP,COLR,NNNNN'                                
         MVC   JCL+7(3),QJOBPOWO                                                
         MVC   JCL+11(4),QJOBPROC+41                                            
*                                                                               
ANYDIR12 MVC   DUB,QDEST                                                        
         LH    R1,DUB                                                           
         CVD   R1,DUB                                                           
         UNPK  JCL+16(5),DUB                                                    
         OI    JCL+20,X'F0'                                                     
*                                                                               
ANYDIR13 MVC   JCL+21(8),=C',Q,   ,A'                                           
         CLI   QJOBPTYP,C'B'                                                    
         BNE   *+8                                                              
         MVI   JCL+22,C'P'                                                      
         MVC   JCL+28(1),QCLASS                                                 
         MVC   JCL+29(4),=C',N,1'                                               
ANYDIR14 CLC   QOUTTYPE(4),=C'DOWN'                                             
         BE    *+14                                                             
         CLC   QOUTTYPE(5),=C'DIRDL'                                            
         BNE   *+12                                                             
         MVI   JCL+24,C'D'         SET DIRECT/DOWNLOADABLE REPORT               
         B     ANYDIR20            AND DONT SENT LOGOS                          
         CLC   QOUTTYPE(3),=C'SQL'                                              
         BE    *+14                                                             
         CLC   QOUTTYPE(6),=C'DIRSQL'                                           
         BNE   *+12                                                             
         MVI   JCL+24,C'S'         SET DIRECT/SQL REPORT                        
         B     ANYDIR20            AND DONT SENT LOGOS                          
ANYDIR15 CLI   QOUTTYPE,C'@'                                                    
         BNE   ANYDIR16                                                         
         MVI   JCL+24,C'S'         SET DIRECT/SQL REPORT                        
         MVI   JCL+55,C','                                                      
         MVC   JCL+56(1),QSYSTEM   SET C'SPP  @ABCDE' AS REPORT DESC            
         MVC   JCL+57(2),QPROGRAM                                               
         MVC   JCL+61(6),QOUTTYPE                                               
         B     ANYDIR20            NO LOGOS FOR SQL REPORTS                     
ANYDIR16 CLI   QOUTTYPE,C'/'                                                    
         BNE   ANYDIR17                                                         
         MVI   JCL+55,C','                                                      
         MVC   JCL+56(1),QSYSTEM   SET C'SPP  /SPPXX' AS REPORT DESC            
         MVC   JCL+57(2),QPROGRAM                                               
         MVC   JCL+61(6),QOUTTYPE                                               
         CLC   QOUTTYPE+3(3),SPACES                                             
         BNE   *+22                                                             
         MVC   JCL+62(1),QSYSTEM                                                
         MVC   JCL+63(2),QPROGRAM                                               
         MVC   JCL+65(2),QOUTTYPE+1                                             
         B     ANYDIR20            NO LOGOS FOR AFP REPORTS                     
ANYDIR17 CLC   QJOBORUT(2),=C'S1'  DIRECT GETS LOGOS                            
         BE    *+12                                                             
         CLI   QJOBORUT,C'#'       DIRECT GETS LOGOS                            
         BNE   ANYDIR20                                                         
*&&UK*&& B     ANYDIR20                                                         
         MVI   JCL+30,C'Y'                                                      
         L     R1,=A(NOLOGTAB)                                                  
ANYDIR18 CLC   QJOBJES(4),0(R1)    UNLESS ID IS IN TABLE                        
         BE    ANYDIR19                                                         
         CLI   0(R1),X'FF'                                                      
         BE    ANYDIR20                                                         
         LA    R1,4(R1)                                                         
         B     ANYDIR18                                                         
ANYDIR19 MVI   JCL+30,C'N'                                                      
ANYDIR20 CLI   QJOBOSID,C' '       TEST OVERNIGHT SOON OR XFILE REQ             
         BNH   ANYDIR22                                                         
         MVI   JCL+33,C','         OUTPUT PQ REPORT INFO                        
         MVC   JCL+34(3),=C'XF='                                                
         GOTO1 =V(HEXOUT),PARA,QDEST,JCL+37,2,=C'TOG'                           
         GOTO1 (RF),(R1),QJOBOSID,JCL+41,5                                      
         MVC   JCL+51(4),=C'0000'  ZERO CI DISK ADDRESS                         
ANYDIR22 MVC   JCL+32(1),QJOBCOPY                                               
         CLI   JCL+56,C' '         TEST IF DESCRIPTION ALREADY SET              
         BH    ANYDIR23                                                         
         CLI   QJOBPQDS,C' '                                                    
         BNH   ANYDIR23                                                         
         MVI   JCL+55,C','                                                      
         MVC   JCL+56(11),QJOBPQDS                                              
*                                                                               
ANYDIR23 CLI   QJOBPQFM,C' '       SET REMOTE AFP FORM CODE                     
         BNH   *+14                                                             
         MVI   JCL+67,C','                                                      
         MVC   JCL+68(2),QJOBPQFM                                               
         CLI   QOUTTYPE,C'/'                                                    
         BNE   ANYDIR24                                                         
         MVI   JCL+67,C','                                                      
         MVC   JCL+68(2),QOUTTYPE+1                                             
         CLC   QOUTTYPE+3(3),SPACES                                             
         BE    *+10                                                             
         MVC   JCL+68(2),QOUTTYPE+4                                             
*                                                                               
ANYDIR24 L     RE,=A(LDIRECT)      SAVE LAST GENERATED DIRECT=... CARD          
         MVC   0(80,RE),JCL                                                     
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
         AP    DIRCOUNT,=P'1'      BUMP NUMBER OF DIRECT=CARDS THIS JOB         
*&&US                                                                           
         CLI   QSYSTEM,C'T'        TALENT SYSTEM                                
         BNE   ANYDIRX                                                          
         MVC   JCL,SPACES                                                       
         MVC   JCL(10),=C'LOGOS=USER'  WILL START LOGOS FROM GENCON             
         L     RF,=A(PUTJCL)                                                    
         BASR  RE,RF                                                            
*&&                                                                             
ANYDIRX  XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
NOLOGTAB DS    0CL4                                                             
*&&US                                                                           
         DC    CL4'BJAT'                                                        
         DC    CL4'BJCH'                                                        
         DC    CL4'BJCP'                                                        
         DC    CL4'BJDA'                                                        
         DC    CL4'BJPA'                                                        
         DC    CL4'BJPD'                                                        
         DC    CL4'BJDE'                                                        
         DC    CL4'BJLA'                                                        
         DC    CL4'BJJM'                                                        
         DC    CL4'BJFL'                                                        
         DC    CL4'BJOA'                                                        
         DC    CL4'BJOM'                                                        
         DC    CL4'BJIT'                                                        
         DC    CL4'BJRE'                                                        
         DC    CL4'USUN'                                                        
         DC    CL4'USNY'                                                        
         DC    CL4'USPA'                                                        
         DC    CL4'USPD'                                                        
         DC    CL4'USDA'                                                        
         DC    CL4'USCP'                                                        
         DC    CL4'USOM'                                                        
*&&                                                                             
         DC    X'FFFF'                                                          
         EJECT                                                                  
***********************************************************************         
*ROUTINE TO USER ID RECORD AND EXTRACT REQUIRED EOD INFO              *         
***********************************************************************         
GETUSER  NTR1  BASE=*,LABEL=*                                                   
         MVC   QUSER,SVXAGY        SET AGENCY ALPHA ID                          
         MVC   QORIGIN,SVXUID      SET ORIGIN USER ID NUM                       
         MVC   QDEST,SVXDEST       SET DESTINATION ID NUM                       
         XC    LSTSE#(LSTSELNQ),LSTSE#                                          
*                                                                               
         L     R4,=A(USERREC)      READ USERID RECORD                           
         USING CTIREC,R4                                                        
         XC    CTIKEY,CTIKEY                                                    
         MVI   CTIKTYP,C'I'                                                     
         MVC   CTIKNUM,SVUSERID                                                 
         GOTO1 =V(DATAMGR),PARA,READ,CTFILE,(R4),(R4)                           
         BNE   GETUSERX                                                         
         LA    R4,CTIDATA                                                       
*                                                                               
         USING CTSYSD,R4                                                        
GETU10   CLI   0(R4),0             SEARCH FOR REQUIRED ELEMENTS                 
         BE    GETUSERX                                                         
         CLI   0(R4),CTSYSELQ      X'21' AUTHORIZATION ELEMENT                  
         BE    GETU20                                                           
         CLI   0(R4),CTDSTELQ      X'30' DESTINATION DETAIL                     
         BE    GETU30                                                           
*                                                                               
GETU18   LLC   RF,1(R4)            BUMP TO NEXT ELEMENT                         
         AR    R4,RF                                                            
         B     GETU10                                                           
*                                                                               
GETU20   CLI   CTSYSNUM,X'02'      SPOT                                         
         BNE   *+10                                                             
         MVC   SPTSE#,CTSYSSE                                                   
         CLI   CTSYSNUM,X'03'      NET                                          
         BNE   *+10                                                             
         MVC   NETSE#,CTSYSSE                                                   
         CLI   CTSYSNUM,X'04'      PRINT                                        
         BNE   *+10                                                             
         MVC   PRTSE#,CTSYSSE                                                   
         CLI   CTSYSNUM,X'06'      ACCOUNT                                      
         BNE   *+10                                                             
         MVC   ACCSE#,CTSYSSE                                                   
         CLI   CTSYSNUM,X'07'      TALENT                                       
         BNE   *+10                                                             
         MVC   TALSE#,CTSYSSE                                                   
         CLI   CTSYSNUM,X'08'      REP                                          
         BNE   *+10                                                             
         MVC   REPSE#,CTSYSSE                                                   
         CLI   CTSYSNUM,X'0D'      TRAFFIC                                      
         BNE   *+10                                                             
         MVC   STRSE#,CTSYSSE                                                   
         B     GETU18                                                           
*                                                                               
         USING CTDSTD,R4           DESTINATION DETAIL ELEMENT                   
GETU30   MVC   QJOBLOG1,CTDSTLG1                                                
         OC    QJOBLOG1,SPACES                                                  
         MVC   QJOBLOG2,CTDSTLG2                                                
         OC    QJOBLOG2,SPACES                                                  
         MVC   QJOBDNAM,CTDSTNAM                                                
         MVC   QJOBDADD,CTDSTADD                                                
         CLI   CTDSTLEN,166                                                     
         BL    *+16                                                             
         MVC   QJOBDAD2,CTDSTAD2                                                
         MVC   QJOBDAD3,CTDSTAD3                                                
         MVC   QJOBJES(4),CTDSTPOW POWER CODE IS 1ST 4 CHRS OF JES NAME         
         LA    RE,QJOBJES                                                       
         LA    RF,4                                                             
GETU32   CLI   0(RE),C' '          PAD OUT GAPS WITH X                          
         BH    *+8                                                              
         MVI   0(RE),C'X'                                                       
         LA    RE,1(RE)                                                         
         BCT   RF,GETU32                                                        
         MVC   QJOBMVS+4(4),QJOBJES                                             
         B     GETU18                                                           
*                                                                               
GETUSERX XIT1                      EXIT WITH CC EQL IS ALL OK                   
         DROP  R4                                                               
*                                                                               
***********************************************************************         
*LIST OF SE# FOR EACH SYSTEM BASED ON USER ID                         *         
***********************************************************************         
LSTSE#   DS    0X                                                               
         DC    X'00'               NONE                                         
         DC    X'00'               01 SERVICE                                   
SPTSE#   DS    X                   02 SPOT                                      
NETSE#   DS    X                   03 NET                                       
PRTSE#   DS    X                   04 PRINT                                     
         DC    X'00'               05                                           
ACCSE#   DS    X                   06 ACCOUNT                                   
TALSE#   DS    X                   07 TALENT                                    
REPSE#   DS    X                   08 REP                                       
         DC    X'00'               09                                           
         DC    X'00'               0A CONTROL                                   
         DC    X'00'               0B                                           
         DC    X'00'               0C                                           
STRSE#   DS    X                   0D TRAFFIC                                   
         DC    X'00'               0E                                           
         DC    X'00'               0F                                           
LSTSELNQ EQU   *-LSTSE#                                                         
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*ROUTINE TO GET TWO CHR SYSTEM NAME FROM ONE CHR SYSTEM LETTER        *         
***********************************************************************         
GETSYS   NTR1  BASE=*,LABEL=*                                                   
         LA    RE,SYSTAB                                                        
*                                                                               
GETSYS1  CLI   0(RE),C' '          END OF TABLE                                 
         BE    GETSYS2                                                          
         CLC   0(1,RE),SVSYSL                                                   
         BE    GETSYS2                                                          
         LA    RE,L'SYSTAB(RE)                                                  
         B     GETSYS1                                                          
*                                                                               
GETSYS2  MVC   QSYSTEM,1(RE)       SAVE ONE CHR SYSTEM ID                       
         MVC   QJOBSYS(2),2(RE)    SAVE TWO CHR SYSTEM ID                       
         MVC   RFHWANT,12(RE)      SAVE RFHDR= REQUIREMENT FOR SYSTEM           
         CLI   QSYSTEM,C' '                                                     
GETSYSX  XIT1                                                                   
*                                                                               
SYSTAB   DS    0CL14                                                            
*&&UK*&& DC    C'A',C'A',C'AC',C'ACCPAK  ',C'Y '                                
*&&US*&& DC    C'A',C'A',C'AC',C'ACCPAK  ',C'N '                                
         DC    C'B',C'B',C'MB',C'MBASE   ',C'  '                                
         DC    C'C',C'C',C'CT',C'CONTROL ',C'Y '                                
         DC    C'E',C'E',C'PE',C'PERSON  ',C'  '                                
         DC    C'L',C'L',C'MP',C'MPL     ',C'  '                                
*&&US*&& DC    C'D',C'D',C'CP',C'CPP     ',C'  '                                
*&&US*&& DC    C'N',C'S',C'NE',C'NETPAK  ',C'  '                                
*&&US*&& DC    C'S',C'S',C'SP',C'SPOTPAK ',C'  '                                
*&&US*&& DC    C'P',C'P',C'PR',C'PRINTPAK',C'Y '                                
*&&US*&& DC    C'R',C'R',C'RE',C'REPPAK  ',C'  '                                
*&&US*&& DC    C'T',C'T',C'TA',C'TALENT  ',C'  '                                
*&&US*&& DC    C'F',C'F',C'TR',C'STRAFFIC',C'  '                                
*&&UK*&& DC    C'M',C'M',C'ME',C'MEDLINE ',C'Y '                                
*&&UK*&& DC    C'F',C'F',C'FE',C'FEES    ',C'  '                                
SYSTABX  DC    C' ',C' ',C'XX',C'UNKNOWN ',C'  '                                
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*ROUTINE TO SET UP THE SUBSIDIARY SCAN TABLE                          *         
***********************************************************************         
SETSUB   NTR1  BASE=*,LABEL=*                                                   
         L     R4,=A(SOFTABLE)                                                  
         USING SOFTABLE,R4                                                      
*                                                                               
         MVC   SOFTMED(1),QSUBUSER                                              
         MVC   SOFTAGY(2),QUSER                                                 
*                                                                               
         MVC   SOFTLEDG(1),QSUBUSER                                             
         MVC   SOFTREP(2),QUSER                                                 
         LA    R1,TODAYDMY                                                      
*&&UK*&& MVC   SOFTDAY,0(R1)                                                    
*&&US*&& MVC   SOFTDAY,3(R1)                                                    
         MVC   SOFTIPL(8),0(R1)                                                 
         MVC   SOFTPROG(2),QPROGRAM                                             
         MVC   SOFTSYS(3),QSYSTEM                                               
         MVC   SOFTLOG1(7),QJOBLOG1                                             
         MVC   SOFTLOG2(7),QJOBLOG2                                             
         EDIT  (2,QORIGIN),(5,SOFTORIG),FILL=0                                  
         EDIT  (2,QDEST),(5,SOFTDEST),FILL=0                                    
*                                                                               
         GOTO1 =V(HEXOUT),PARA,SOFTCOMP,SOFTHEX,1                               
         XIT1                                                                   
         DROP  R4                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*ROUTINE TO DIG OUT GENERATION NUMBER FOR SPOOL TAPES                 *         
***********************************************************************         
GETSPLCT NTR1  BASE=*,LABEL=*                                                   
         LA    R2,6(R3)            THIS IS THE A(SSSTAPE.SS0PPAA)               
         L     R3,=A(SPLPOOL)                                                   
         L     R0,4(R3)                                                         
         LA    R4,8(R3)                                                         
         LTR   R0,R0                                                            
         BZ    GSCNEW                                                           
*                                                                               
GSC2     CLC   0(15,R2),0(R4)      LOOK FOR MATCH                               
         BE    GSCOLD                                                           
         LA    R4,16(R4)                                                        
         BCT   R0,GSC2                                                          
*                                                                               
GSCNEW   MVC   0(15,R4),0(R2)      NEW ENTRY                                    
         MVI   15(R4),1            GEN 1                                        
         L     R1,4(R3)            UPDATE N'ENTRIES                             
         LA    R1,1(R1)                                                         
         C     R1,0(R3)                                                         
         JH    *+2                                                              
         ST    R1,4(R3)                                                         
         MVI   SPLCOUNT,1                                                       
         B     GSCX                                                             
*                                                                               
GSCOLD   LLC   R1,15(R4)           OLD ENTRY - BUMP                             
         LA    R1,1(R1)                                                         
         STC   R1,15(R4)                                                        
         STC   R1,SPLCOUNT                                                      
*                                                                               
GSCX     XIT1                                                                   
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*ROUTINE TO READ PARAMETER CARDS                                      *         
***********************************************************************         
GETPARMS NTR1  BASE=*,LABEL=*                                                   
         MVI   PARMSOK,C'Y'                                                     
*                                                                               
GETP1    GOTO1 =V(CARDS),PARA,C,=C'RE00'                                        
         CLC   C(2),=C'XX'                                                      
         BE    GETPXIT                                                          
         CLC   C(2),=C'/*'                                                      
         BE    GETPXIT                                                          
         MVC   P(72),C                                                          
*                                                                               
GETP2    CLC   C(6),=C'DSPACE='    DSPACE=                                      
         BNE   GETP2A                                                           
         L     RF,=V(SSB)                                                       
         USING SSBD,RF                                                          
         MVC   SSODSPAC,C+7                                                     
         MVC   DSPACE,C+7                                                       
         B     GETPNXT                                                          
         DROP  RF                                                               
*                                                                               
GETP2A   CLC   C(6),=C'DDSIO='     DDSIO=XXXXXXXX TO CHANGE DATAMGR             
         BNE   GETP2X                                                           
         L     RF,=V(DDSIO)                                                     
         MVC   0(8,RF),C+6                                                      
         B     GETPNXT                                                          
GETP2X   EQU   *                                                                
*                                                                               
GETP3    CLC   C(6),=C'SPOOL='     SPOOL=Y TO SUBMIT JCL TO JES                 
         BNE   GETP3A                                                           
         MVC   SPOOL,C+6                                                        
         B     GETPNXT                                                          
*                                                                               
GETP3A   CLC   C(6),=C'DUMP=OS'    DUMP=OS, SKIP STIXTER                        
         BNE   GETP3X                                                           
         MVI   DUMP,C'O'                                                        
         B     GETPNXT                                                          
GETP3X   EQU   *                                                                
*                                                                               
GETP4    CLC   C(6),=C'TRACE='     TRACE= TO SET TRACE OPTIONS                  
         BNE   GETP4X                                                           
         LA    RE,C+6                                                           
         LA    RF,8                                                             
GETP4A   CLI   0(RE),C' '          END OF TRACE OPTIONS                         
         BE    GETPNXT                                                          
         CLI   0(RE),C'Y'          Y MEANS JCL AND NOTHING ELSE                 
         BNE   *+12                                                             
         MVI   TRACE,X'80'                                                      
         B     GETPNXT                                                          
         CLI   0(RE),C'J'          J MEANS TRACE JCL STATEMENTS                 
         BNE   *+12                                                             
         OI    TRACE,X'80'                                                      
         B     GETP4B                                                           
         CLI   0(RE),C'H'          H MEANS TRACE RFH REQ HDR CARDS              
         BNE   *+12                                                             
         OI    TRACE,X'40'                                                      
         B     GETP4B                                                           
         CLI   0(RE),C'X'          X MEANS TRACE XFILE RECORDS                  
         BNE   *+12                                                             
         OI    TRACE,X'01'                                                      
         B     GETP4B                                                           
         CLI   0(RE),C'G'          G MEANS TRACE GROUP RECORDS                  
         BNE   *+12                                                             
         OI    TRACE,X'02'                                                      
         B     GETP4B                                                           
         CLI   0(RE),C'R'          R MEANS TRACE REQUEST RECORDS                
         BNE   *+12                                                             
         OI    TRACE,X'04'                                                      
         B     GETP4B                                                           
GETP4B   LA    RE,1(RE)            BUMP TO NEXT TRACE LETTER                    
         BCT   RF,GETP4A                                                        
         B     GETPNXT                                                          
GETP4X   EQU   *                                                                
*                                                                               
GETP5    CLC   C(9),=C'TESTMODE='  TESTMODE= TO SET TESTING OPTIONS             
         BNE   GETP5X                                                           
         LA    RE,C+9                                                           
         LA    RF,8                                                             
GETP5A   CLI   0(RE),C' '          END OF MODE OPTIONS                          
         BE    GETPNXT                                                          
         CLI   0(RE),C'D'          DATES ARE UNIMPORTANT                        
         BNE   *+12                                                             
         OI    TESTMODE,X'80'                                                   
         B     GETP5B                                                           
*                                                                               
         CLI   0(RE),C'Q'          USE DUMMY PQ ID                              
         BNE   *+12                                                             
         OI    TESTMODE,X'40'                                                   
         B     GETP5B                                                           
*                                                                               
GETP5B   LA    RE,1(RE)            BUMP TO NEXT MODE LETTER                     
         BCT   RF,GETP5A                                                        
         B     GETPNXT                                                          
GETP5X   EQU   *                                                                
*                                                                               
GETP6    CLC   C(6),=C'TODAY='     TODAY= TO SET TODAY'S DATE                   
         BNE   GETP6X                                                           
         GOTO1 =V(DATVAL),PARA,(0,C+6),DUB                                      
         OC    0(4,R1),0(R1)                                                    
         BZ    GETPERR                                                          
         MVC   TODAY,DUB                                                        
         B     GETPNXT                                                          
GETP6X   EQU   *                                                                
*                                                                               
GETP7    CLC   C(5),=C'DATE='      DATE= TO SET INCLUDE DATE FILTER             
         BNE   GETP7X                                                           
         GOTO1 =V(DATVAL),PARA,(0,C+5),DUB                                      
         OC    0(4,R1),0(R1)                                                    
         BZ    GETPERR                                                          
         MVC   SAVEDATE,DUB                                                     
         B     GETPNXT                                                          
GETP7X   EQU   *                                                                
*                                                                               
GETP8    CLC   C(7),=C'NODATE='    NODATE= TO SET EXCLUDE DATE FILTER           
         BNE   GETP8X                                                           
         GOTO1 =V(DATVAL),PARA,(0,C+7),DUB                                      
         OC    0(4,R1),0(R1)                                                    
         BZ    GETPERR                                                          
         MVC   SAVENODT,DUB                                                     
         B     GETPNXT                                                          
GETP8X   EQU   *                                                                
*                                                                               
GETP9    CLC   C(7),=C'BEFORE='    BEFORE= TO SET BEFORE JCL                    
         BNE   GETP9X                                                           
         MVC   BEFJCL,C+7                                                       
         B     GETPNXT                                                          
GETP9X   EQU   *                                                                
*                                                                               
GETP10   CLC   C(6),=C'AFTER='     AFTER= TO SET BEFORE JCL                     
         BNE   GETP10X                                                          
         MVC   AFTJCL,C+6                                                       
         B     GETPNXT                                                          
GETP10X  EQU   *                                                                
*                                                                               
GETP11   CLC   C(2),=C'$$'         //JOB JCL CARDS                              
         BNE   GETP11X                                                          
         L     RF,AJCLIN                                                        
         CLI   0(RF),X'FF'         TEST IF STILL ROOM                           
         BE    GETPERR                                                          
         MVC   0(80,RF),C                                                       
         MVC   0(02,RF),=C'//'                                                  
         LA    RF,80(RF)                                                        
         ST    RF,AJCLIN                                                        
         B     GETPNXT                                                          
GETP11X  EQU   *                                                                
*                                                                               
GETP12   CLC   C(8),=C'JCLDISK='   JCLDISK= TO NAME OUPUT JCL FILE              
         BNE   GETP12X                                                          
         MVC   WJCLID,C+8                                                       
         B     GETPNXT                                                          
GETP12X  EQU   *                                                                
*                                                                               
GETP13   CLC   C(8),=C'LOGDISK='   LOGDISK= TO NAME OUTPUT JOB LOG              
         BNE   GETP13X                                                          
         MVC   WLOGID,C+8                                                       
         B     GETPNXT                                                          
GETP13X  EQU   *                                                                
*                                                                               
GETP14   CLC   C(6),=C'NETID='     NETID= TO NAME JES NETWORK ID                
         BNE   GETP14X                                                          
         MVC   NETID,C+6                                                        
         B     GETPNXT                                                          
GETP14X  EQU   *                                                                
*                                                                               
GETP15   CLC   C(6),=C'NETRL='     NETRL= TO NAME LAST JES CARD                 
         BNE   GETP15X                                                          
         MVC   NETRL,C+6                                                        
         B     GETPNXT                                                          
GETP15X  EQU   *                                                                
*                                                                               
GETP16   CLC   C(7),=C'NETOH=Y'    NETRL= TO SET JES OH= REQUIRED               
         BNE   GETP16X                                                          
         MVI   NETOH,C'Y'                                                       
         B     GETPNXT                                                          
GETP16X  EQU   *                                                                
*                                                                               
GETP17   CLC   C(6),=C'NETHC='     NETHC= TO SET JES HOLD COUNT                 
         BNE   GETP17X                                                          
         LA    R2,C+6                                                           
         LA    R3,DUB                                                           
         BAS   RE,NUMBER                                                        
         BNE   GETPERR                                                          
         CP    DUB(4),=P'99'                                                    
         BH    GETPERR                                                          
         UNPK  NETHC,DUB(4)                                                     
         OI    NETHC+1,X'F0'                                                    
         B     GETPNXT                                                          
GETP17X  EQU   *                                                                
*                                                                               
GETP18   CLC   C(5),=C'DISP='      DISP= TO SET JOB DISPOSITION                 
         BNE   GETP18X                                                          
         MVC   DISP,C+5                                                         
         B     GETPNXT                                                          
GETP18X  EQU   *                                                                
*                                                                               
GETP19   CLC   C(9),=C'JOBCLASS='  JOBCLASS= TO SET JOB CLASS                   
         BNE   GETP19X                                                          
         MVC   JCLASS,C+9                                                       
         B     GETPNXT                                                          
GETP19X  EQU   *                                                                
*                                                                               
GETP20   CLC   C(9),=C'MSGCLASS='  MSGCLASS= TO SET JOB MESSAGE CLASS           
         BNE   GETP20X                                                          
         MVC   MSGCLA,C+9                                                       
         B     GETPNXT                                                          
GETP20X  EQU   *                                                                
*                                                                               
GETP21   CLC   C(9),=C'MSGLEVEL='  MSGLEVEL= TO SET JOB MESSAGE LEVEL           
         BNE   GETP21X                                                          
         CLI   C+09,C' '                                                        
         BE    GETP21A                                                          
         CLI   C+09,C'*'                                                        
         BE    GETP21A                                                          
         CLI   C+09,C'0'                                                        
         BL    GETPERR                                                          
         CLI   C+09,C'2'                                                        
         BH    GETPERR                                                          
         MVC   MSGLEV1,C+09                                                     
GETP21A  CLI   C+10,C' '                                                        
         BE    GETP21B                                                          
         CLI   C+10,C'*'                                                        
         BE    GETP21B                                                          
         CLI   C+10,C'0'                                                        
         BL    GETPERR                                                          
         CLI   C+10,C'1'                                                        
         BH    GETPERR                                                          
         MVC   MSGLEV2,C+10                                                     
GETP21B  B     GETPNXT                                                          
GETP21X  EQU   *                                                                
*                                                                               
GETP22   CLC   C(6),=C'CLASS='     CLASS= TO SET SYSPRINT CLASS                 
         BNE   GETP22X                                                          
         MVC   CLASS,C+6                                                        
         B     GETPNXT                                                          
GETP22X  EQU   *                                                                
*                                                                               
GETP23   CLC   C(5),=C'FREE='      FREE= TO SET FREE=CLOSE ON SYSPRINT          
         BNE   GETP23X                                                          
         MVC   FREE,C+5                                                         
         B     GETPNXT                                                          
GETP23X  EQU   *                                                                
*                                                                               
GETP24   CLC   C(5),=C'PGMR='      PROGRAMMER NAME                              
         BNE   GETP24X                                                          
         MVC   PGMRNAME,C+5                                                     
         B     GETPNXT                                                          
GETP24X  EQU   *                                                                
*                                                                               
GETP25   CLC   C(7),=C'NOTIFY='    NOTIFY=                                      
         BNE   GETP25X                                                          
         MVC   NOTIFY,C+7                                                       
         B     GETPNXT                                                          
GETP25X  EQU   *                                                                
*                                                                               
GETP26   CLC   C(5),=C'USER='      USER=                                        
         BNE   GETP26X                                                          
         MVC   USER,C+5                                                         
         B     GETPNXT                                                          
GETP26X  EQU   *                                                                
*                                                                               
GETP27   CLC   C(8),=C'RESTART='   RESTART (JCL IS RD=)                         
         BNE   GETP27A                                                          
         MVC   RESTART,C+8                                                      
         B     GETPNXT                                                          
*                                                                               
GETP27A  CLC   C(3),=C'RD='                                                     
         BNE   GETP27X                                                          
         MVC   RESTART,C+3                                                      
         B     GETPNXT                                                          
GETP27X  EQU   *                                                                
*                                                                               
GETP28   CLC   C(9),=C'PRIORITY='  PRIORITY (JCL IS PRTY=)                      
         BNE   GETP28A                                                          
         MVC   QOUTPRI,C+9                                                      
         B     GETPNXT                                                          
*                                                                               
GETP28A  CLC   C(5),=C'PRTY='      PRTY=                                        
         BNE   GETP28X                                                          
         MVC   QOUTPRI,C+5                                                      
         B     GETPNXT                                                          
GETP28X  EQU   *                                                                
*                                                                               
GETP34   CLC   C(9),=C'USEMYJOB='  USEMYJOB=Y TO ACTIVATE INPUT $$..            
         BNE   GETP34X                                                          
         MVC   USEMYJOB,C+9                                                     
         CLI   USEMYJOB,C'N'       N TO NOT USE $$.. CARDS                      
         BE    GETPNXT                                                          
         CLI   USEMYJOB,C'Y'       Y TO USE $$.. CARDS                          
         BE    GETPNXT                                                          
         CLI   USEMYJOB,C'A'       A TO ADD $$.. CARDS TO GENERATED             
         BE    GETPNXT                                                          
         B     GETPERR                                                          
GETP34X  EQU   *                                                                
*                                                                               
GETPERR  MVI   PARMSOK,C'N'        SET ERROR IN PARAMETER CARD                  
         MVC   P+72(8),=C'**ERROR '                                             
*                                                                               
GETPNXT  GOTO1 =V(PRINTER)         PRINT PARAMETER CARD                         
         B     GETP1                                                            
*                                                                               
GETPXIT  MVC   P,SPACES            END OF PARAMETER CARDS                       
         CLI   PARMSOK,C'Y'                                                     
         BE    *+16                                                             
         MVC   P(38),=C'ERROR IN PARAMETER CARDS - RUN ABORTED'                 
         MVC   P+72(8),=C'**ERROR '                                             
         GOTO1 =V(PRINTER)                                                      
         CLI   PARMSOK,C'Y'        EXIT WITH CC EQL IF ALL OK                   
         XIT1                                                                   
*                                                                               
NUMBER   NTR1                      ROUTINE TO VALIDATE NUMERIC DATA             
         LA    R4,1(R2)            R2=A(SOURCE DATA)                            
         SR    R1,R1               R3=A(OBJECT PL4 FIELD)                       
*                                                                               
NUM2     CLI   0(R4),C' '          R1=L'FIELD-1                                 
         BE    NUM4                                                             
         LA    R4,1(R4)                                                         
         LA    R1,1(R1)                                                         
         B     NUM2                                                             
*                                                                               
NUM4     MVC   DUB,=8X'F0'                                                      
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVZ   DUB(0),0(R2)                                                     
         CLC   DUB,=8X'F0'                                                      
         BNE   NUMERR                                                           
         EX    R1,*+8                                                           
         B     NUMOK                                                            
         PACK  0(4,R3),0(0,R2)                                                  
*                                                                               
NUMOK    CR    RB,RB               OK EXIT SET CC EQL                           
         B     NUMXIT                                                           
NUMERR   LTR   RB,RB               NOT OK EXIT SET CC NEQ                       
NUMXIT   XIT1                                                                   
*                                                                               
AJCLIN   DC    A(JCLIN)            A(NEXT INPUT JCL STATEMENT)                  
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*ROUTINE TO OPEN AND CLOSE FILES                                      *         
***********************************************************************         
FILOPEN  NTR1  BASE=*,LABEL=*                                                   
         GOTO1 =V(DATAMGR),PARA,OPEN,OPENSYS,OPENLIST                           
*                                                                               
FILOPN1  CLI   SPOOL,C'T'          OPEN OUTPUT FILES AS REQUIRED                
         BNE   FILOPN2                                                          
         L     R2,=A(JCLTAPE)                                                   
         OPEN  ((2),(OUTPUT))                                                   
*                                                                               
FILOPN2  CLI   WJCLID,C' '                                                      
         BE    FILOPN3                                                          
         L     R2,=A(WJCL)                                                      
         MVC   40(7,R2),WJCLID                                                  
         OPEN  ((2),(OUTPUT))                                                   
*                                                                               
FILOPN3  CLI   WLOGID,C' '                                                      
         BE    FILOPN4                                                          
         L     R2,=A(WLOG)                                                      
         MVC   40(7,R2),WLOGID                                                  
         OPEN  ((2),(OUTPUT))                                                   
         MVC   LOGREC,SPACES       SET HEADER RECORD                            
         MVC   LOGSYSID,SYSTEM     SET SYSTEM ID                                
         MVC   LOGRECNO,=C'0000'   SET RECORD NUMBER TO ZERO FOR HDR            
         MVC   LOGJESID,TODAY      SET TODAYS DATE                              
         THMS                                                                   
         ST    R1,FULL1                                                         
         OI    FULL1+3,X'0F'                                                    
         UNPK  DUB(6),FULL1                                                     
         MVC   LOGJOBID+0(2),DUB   SET TIME NOW                                 
         MVI   LOGJOBID+2,C'.'                                                  
         MVC   LOGJOBID+3(2),DUB+2                                              
         MVI   LOGJOBID+5,C'.'                                                  
         MVC   LOGJOBID+6(2),DUB+4                                              
*                                                                               
FILOPN4  EQU   *                                                                
FILOPNX  XIT1                                                                   
*                                                                               
OPENSYS  DC    CL8'CONTROL'                                                     
OPENLIST DC    CL8'NCTFILE'                                                     
         DC    CL8'NGENDIR'                                                     
         DC    CL8'NGENFIL'                                                     
         DC    CL8'X'                                                           
         LTORG                                                                  
*                                                                               
FILCLOSE NTR1  BASE=*,LABEL=*                                                   
         GOTO1 =V(PRINT),PARA,=C'CLOSE'                                         
*                                                                               
FILCLS1  CLI   SPOOL,C'T'                                                       
         BNE   FILCLS2                                                          
         L     R2,=A(JCLTAPE)                                                   
         CLOSE ((2))                                                            
*                                                                               
FILCLS2  CLI   WJCLID,C' '                                                      
         BE    FILCLS3                                                          
         L     R2,=A(WJCL)                                                      
         CLOSE ((2))                                                            
*                                                                               
FILCLS3  CLI   WLOGID,C' '                                                      
         BE    FILCLS4                                                          
         L     R2,=A(WLOG)                                                      
         CLOSE ((2))                                                            
*                                                                               
FILCLS4  EQU   *                                                                
FILCLSX  XIT1                                                                   
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*ROUTINE TO READ RFP GROUP RECORDS FROM CONTROL SYSTEM                *         
***********************************************************************         
GRPRECS  NTR1  BASE=*,LABEL=*                                                   
         L     R3,0(R1)            R3=A(REQUEST BUFFER)                         
         L     R6,=A(RFPIOBLK)                                                  
         USING RFPIOD,R6                                                        
         CLI   INGRP,C'Y'                                                       
         BE    GRP100                                                           
*                                                                               
GRP90    MVI   INGRP,C'Y'          INITIALISE FOR NEW GROUP                     
         MVI   RFPINIT,0                                                        
         MVC   RFPAMIN,=A(MINIOWRK)  AREA FOR MINIO BLOCK AND BUFFERS           
         MVC   RFPARECP,=V(RECUP)    A(RECUP)                                   
*                                                                               
         L     RF,=A(MYAIO)                                                     
         USING XFILED,RF                                                        
         MVC   RFPFUID,XFUSER      USER ID                                      
         MVC   RFPFAGY,XFAGY       ALPHA AGENCY                                 
         DROP  RF                                                               
*                                                                               
         L     RF,=A(SVSYSL)       SYSTEM LETTER                                
         MVC   RFPFSYS,0(RF)                                                    
         L     RF,=A(SVGRP)        GROUP                                        
         MVC   RFPFGRP,0(RF)                                                    
*                                                                               
         MVI   RFPMODE,RFPVALGP    VALIDATE GROUP                               
         GOTO1 =V(RFPIO),PARA,(R6)                                              
         CLI   RFPERROR,RFPNOERR   ANY ERROR?                                   
         JNE   *+2                                                              
*                                                                               
         L     RF,=A(SVSYSL)       SYSTEM LETTER                                
         MVC   RFPFSYS,0(RF)                                                    
         L     RF,=A(SVGRP)        GROUP                                        
         MVC   RFPFGRP,0(RF)                                                    
*                                                                               
         MVI   RFPMODE,RFPVALGP    VALIDATE GROUP                               
         GOTO1 =V(RFPIO),PARA,(R6)                                              
         CLI   RFPERROR,RFPNOERR   ANY ERROR?                                   
         BE    GRP95                                                            
         LA    R2,1                                                             
         B     GROUPXIT                                                         
*                                                                               
GRP95    MVI   RFPMODE,RFPRETRQ    RETURN REQUEST                               
         OI    RFPFFLAG,RFPF1STR   START WITH FIRST REQUEST                     
*                                                                               
GRP100   GOTO1 =V(RFPIO),PARA,(R6)                                              
         CLI   RFPERROR,RFPNOERR   ANY ERROR?                                   
         JNE   *+2                                                              
*                                                                               
         CLI   RFPRET,RFPEOF       NO MORE REQUESTS FOR THIS GROUP?             
         BE    GRP200              RIGHT- GET NEXT GROUP                        
*                                                                               
         NI    RFPFFLAG,X'FF'-RFPF1STR  GET REQUESTS IN SEQUENCE NOW            
         CLI   RFPVREQD,C'D'       IS THIS REQUEST DISABLED?                    
         BE    GRP100              YES-SKIP IT                                  
*                                                                               
         LLC   R2,RFPVNUMC         NUMBER OF REQUEST CARDS. . .                 
         BCTR  R2,0                . . . WITHOUT THE REQUEST HEADER             
         LA    R5,RFPVREQC                                                      
*                                                                               
GRP110   ST    R5,FULL             SAVE A(START OF CARD)                        
*                                                                               
GRP120   CLC   4(5,R5),=C'&&&&DST' IS THIS DESTINATION/OUTPUT TYPE              
         BE    *+14                                                             
         CLC   4(5,R5),=C'&&&&OUT'                                              
         BNE   GRP122                                                           
         PACK  DUB,2(2,R5)         GET FIELD LENGTH                             
         CVB   R1,DUB                                                           
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     GRP140                                                           
         MVC   4(0,R5),SPACES                                                   
*                                                                               
GRP122   CLI   0(R5),X'20'         IS THIS AN ESCAPE CHARACTER?                 
         BL    GRP140                                                           
         CLI   0(R5),X'2D'                                                      
         BH    GRP140                                                           
         TM    3(R5),X'F0'         TEST FOR GOOD ESCAPE SEQUENCE                
         BO    GRP140                                                           
         MVC   WORK(4),0(R5)                                                    
         LLC   R0,RFPVNUMS         FIND IT IN THE SYMBOL TABLE                  
         GOTO1 =V(BINSRCH),PARA,WORK,RFPVSYMS,(R0),                    *        
               RFPVSYML,(0,3),RFPMAXSQ                                          
         LLC   R1,WORK+3           LENGTH OF THE FIELD                          
         BCTR  R1,0                MINUS ONE FOR EX                             
         TM    PARA,X'01'          WAS SYMBOL FOUND?                            
         BO    GRP134                                                           
*                                                                               
         SR    RF,RF                                                            
         ICM   R4,7,PARA+1         A(SYMBOL TABLE ENTRY)                        
         USING RFPVSYME,R4                                                      
*                                                                               
         CLI   RFPVVRUL,36         IS THIS THE 'TODAY' SYMBOL?                  
         BNE   GRP130                                                           
         EX    R1,*+8              YES-SO ALWAYS FORCE TODAY'S. . .             
         B     GRP136               . . . DATE INTO REQUEST CARD                
         MVC   0(0,R5),TODAY                                                    
*                                                                               
GRP130   CLI   RFPVCVAL,C'!'       TEST SOFT DATE EXPRESSION                    
         BNE   GRP132                                                           
         LR    R0,R1               R0=L'OUTPUT-1                                
         GOTOR DOSOFT,PARA,(RFPVVRUL,RFPVCVAL),(R0)                             
         LR    R1,R0                                                            
*                                                                               
GRP132   EX    R1,*+8              REPLACE ESCAPE SEQUENCE WITH. . .            
         B     *+10                . . . CURRENT VALUE                          
         MVC   0(0,R5),RFPVCVAL                                                 
         EX    R1,*+8              TEST DATE WAS RESOLVED                       
         BNZ   GRP136                                                           
         OC    0(0,R5),0(R5)                                                    
*                                                                               
GRP134   L     RF,=A(RFPMARK)      BAD SYMBOL OR DATE . . .                     
         EX    R1,*+8                                                           
         B     GRP140                                                           
         MVC   0(0,R5),0(RF)       . . . FORCE REQUEST TO DIE                   
*                                                                               
GRP136   LA    R5,3(R5)            BUMP PAST LAST CHARACTER IN SEQUENCE         
         DROP  R4                                                               
*                                                                               
GRP140   LA    R5,1(R5)            BUMP TO NEXT CHARACTER IN CARD               
         L     R1,FULL             A(START OF CARD)                             
         LA    R0,L'RFPVREQC(R1)   R0 POINTS JUST BEYOND CARD                   
         CR    R5,R0                                                            
         BL    GRP120              WE HAVEN'T HIT END OF CARD YET               
*                                                                               
         LA    R5,80(R1)           BUMP TO NEXT CARD                            
         BCT   R2,GRP110                                                        
*                                                                               
         MVC   HDRLEN,=H'80'       SET NEW STYLE REQUEST HEADER                 
         LA    RE,RFPVREQC         POINT TO FIRST CARD                          
         CLC   0(2,RE),=C'99'      TEST DELETED REQUEST                         
         BE    GRP100              YES-READ NEXT                                
*                                                                               
         AHI   RE,-11              POINT TO CARD COUNT BYTE IN HEADER           
         LLC   RF,0(RE)                                                         
         SRL   RF,4                DROP IND                                     
         LA    RF,1(RF)            ACTUAL COUNT IS ONE MORE                     
         STC   RF,QCARDS           SET NUMBER OF CARDS THIS REQ                 
         MVI   QCTR,0              RESET CARDS PROCESSED COUNTER                
*                                                                               
         LA    RE,RFPVREQH                                                      
         MVC   0(80,R3),0(RE)      PASS BACK REQUEST HEADER                     
         USING REQHDRD,R3                                                       
         GOTO1 =V(DATCON),PARA,TODAY,(19,RQHPJDT)  ALWAYS USE TODAY             
         TM    RQHFLAG1,RQHFDEST   ANY DESTINATION ID PRESENT?                  
         BO    GRP160                                                           
         MVC   RQHDEST,RFPVDEST    NO-GET OVERRIDE FROM GROUP                   
         OC    RQHDEST,RQHDEST                                                  
         BZ    GRP160              THERE WAS NO OVERRIDE                        
         OI    RQHFLAG1,RQHFDEST                                                
GRP160   TM    RQHFLAG1,RQHFOUT    ANY OUTPUT TYPE PRESENT?                     
         BO    GRP170                                                           
         MVC   RQHOUT,RFPVOTYP     NO-GET OVERRIDE FROM GROUP                   
         OC    RQHOUT,RQHOUT                                                    
         BZ    GRP170              THERE WAS NO OVERRIDE                        
         OI    RQHFLAG1,RQHFOUT                                                 
         DROP  R3                                                               
*                                                                               
GRP170   LA    RE,RFPVREQC         POINT TO FIRST REQUEST CARD                  
         LA    R3,80(R3)                                                        
         MVC   0(80,R3),0(RE)      MOVE IT TO BUFFER                            
         CLI   QCARDS,1                                                         
         BNE   GRP180                                                           
         MVC   80(80,R3),SPACES    ONLY ONE CARD, FORCE 2ND TO SPACES           
         LA    R3,160(R3)                                                       
         MVI   QCTR,2                                                           
         B     GRP190                                                           
*                                                                               
GRP180   LA    R3,80(R3)           POINT TO NEXT REQUEST CARD                   
         LA    RE,80(RE)                                                        
         LLC   RF,QCTR                                                          
         LA    RF,1(RF)            BUMP COUNT OF CARDS PROCESSED                
         STC   RF,QCTR                                                          
         CLC   QCTR,QCARDS                                                      
         BE    GRP190              NO MORE CARDS                                
         L     RF,=A(REQINEND)     MAKE SURE NOT TO GO BEYOND END               
         CR    R3,RF                                                            
         BL    GRP186              OKAY SO FAR                                  
         LR    RF,RE                                                            
         BRAS  RE,OVERFLOW         REPORT ERROR                                 
         LR    RE,RF                                                            
         B     GRP190                                                           
*                                                                               
GRP186   MVC   0(80,R3),0(RE)      MOVE CARD TO BUFFER                          
         B     GRP180                                                           
*                                                                               
GRP190   CLI   QCTR,QDATAMAX       CLEAR REST OF INPUT BUFFER                   
         BE    GRPOK                                                            
         XC    0(80,R3),0(R3)                                                   
         LA    R3,80(R3)                                                        
         IC    RF,QCTR                                                          
         LA    RF,1(RF)            BUMP COUNT OF CARDS PROCESSED                
         STC   RF,QCTR                                                          
         B     GRP190                                                           
*                                                                               
GRP200   DS    0H                                                               
*                                                                               
GRPEOF   MVI   INGRP,C'N'          NO MORE GROUP REQS FOR THIS SYSTEM           
         LA    R2,1                                                             
         B     GROUPXIT                                                         
*                                                                               
GRPOK    LA    R3,REQINHN                                                       
         OC    160(80,R3),160(R3)                                               
         BNZ   *+10                                                             
         MVC   160(80,R3),SPACES                                                
         SR    R2,R2               WE'RE RETURNING A REQUEST CARD               
*                                                                               
GROUPXIT LTR   R2,R2                                                            
         XIT1                                                                   
         EJECT                                                                  
OVERFLOW NTR1                                                                   
         WTO   'TOO MANY CARD IN REQUEST.'                                      
         J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*RESOLVE SOFT DATE EXPRESSIONS                                        *         
***********************************************************************         
DOSOFT   NTR1  BASE=*,LABEL=*,WORK=(R9,DOSWORKL)                                
         USING DOSWORKD,R9         R9=A(LOCAL WORKING STORAGE)                  
         MVC   DOSPARM(DOSPARML),0(R1)                                          
*                                                                               
         LA    R2,DVLTAB                                                        
         USING DVLTABD,R2          R2=A(DATE VALIDATION TABLE)                  
         LHI   R0,DVLTABN          LOOK UP VALIDATION RULE IN TABLE             
         BASR  RE,0                                                             
         CLC   DVLTTYPE,DOSRULE    MATCH ON RULE NUMBER                         
         BE    *+14                                                             
         AHI   R2,DVLTABL          BUMP TO NEXT TABLE ENTRY                     
         BCTR  R0,RE                                                            
         B     DOSOFTER                                                         
*                                                                               
         XC    DOSFLDH,DOSFLDH     BUILD DUMMY TWA FIELD FOR SOFDAT             
         MVI   DOSFLDH,L'DOSFLDH+L'DOSFLD                                       
         MVC   DOSFLD,SPACES                                                    
         ICM   RF,7,DOSAINP                                                     
         MVC   DOSFLD(L'RFPVCVAL),0(RF)                                         
*                                                                               
         MVC   DOSWORK,SPACES                                                   
         CLI   DVLTSOFT,SOFITYM+SOFITYMD                                        
         BE    DOSOFT02                                                         
         GOTOR GOSOFT,DOSP,(DVLTSOFT,DOSFLDH),(DVLTSOFO,DOSWORK),      *        
               (DVLTSOFI,0)                                                     
         BNE   DOSOFTER                                                         
         B     DOSOFT04                                                         
*                                                                               
DOSOFT02 GOTOR GOSOFT,DOSP,('SOFITYM',DOSFLDH),(DVLTSOFO,DOSWORK),     *        
               (DVLTSOFI,0)                                                     
         BE    DOSOFT04                                                         
*                                                                               
         GOTOR GOSOFT,DOSP,('SOFITYMD',DOSFLDH),(DVLTSOFO,DOSWORK),    *        
               (DVLTSOFI,0)                                                     
         BNE   DOSOFTER                                                         
*                                                                               
DOSOFT04 TM    DVLTINDS,DVLTID01   TEST SET DAYS TO 01                          
         BZ    DOSOFT06                                                         
         MVC   DOSWORK+04(2),=C'01'                                             
         MVC   DOSWORK+10(2),=C'01'                                             
*                                                                               
DOSOFT06 TM    DVLTINDS,DVLTIDSP   TEST SET DAYS TO SPACES                      
         BZ    *+16                                                             
         MVC   DOSWORK+04(2),SPACES                                             
         MVC   DOSWORK+10(2),SPACES                                             
*&&US                                                                           
DOSOFT08 CLI   RFPFSYS,RFPFSRPL    TEST REP SYSTEM                              
         BNE   DOSOFT10                                                         
         CLI   DVLTSOFO,SOFOTSD2   YES-TEST EBCDIC OUTPUT TYPE                  
         BNE   DOSOFT10                                                         
         LLC   RE,DOSWORK+0                                                     
         AHI   RE,-10              RE=Y2K ADJUSTED YEAR (START DATE)            
         CLI   DOSWORK,C'9'        TEST Y2K START YEAR                          
         BNH   *+8                                                              
         STC   RE,DOSWORK+0        YES-SET ADJUSTED VALUE                       
         IC    RE,DOSWORK+6                                                     
         AHI   RE,-10              RE=Y2K ADJUSTED YEAR (END DATE)              
         CLI   DOSWORK+6,C'9'      TEST Y2K END YEAR                            
         BNH   DOSOFT10                                                         
         STC   RE,DOSWORK+6        YES-SET ADJUSTED VALUE                       
*&&                                                                             
DOSOFT10 ICM   R1,7,DOSAINP        MOVE RESOLVED DATE TO OUTPUT AREA            
         ICM   RF,15,DOSLINP                                                    
         LA    RE,DOSWORK                                                       
         TM    DVLTINDS,DVLTIPRT   TEST OUTPUT IS PRINTABLE                     
         BZ    *+8                                                              
         LA    RE,DOSFLD                                                        
         MVC   0(L'RFPVCVAL,R1),SPACES                                          
         EX    RF,*+8                                                           
         B     DOSOFTX                                                          
         MVC   0(0,R1),0(RE)                                                    
*                                                                               
DOSOFTER ICM   R1,7,DOSAINP        BRANCH HERE ON ERRORS                        
         XC    0(L'RFPVCVAL,R1),0(R1)                                           
*                                                                               
DOSOFTX  XIT1                                                                   
         DROP  R2,R9                                                            
*                                                                               
DVLTAB   DS    0XL(DVLTABL)        DATE VALIDATION TABLE                        
*                                                                               
         DC    AL1(RRULYM)                                                      
         DC    AL1(0)                                                           
         DC    AL1(SOFITYM)                                                     
         DC    AL1(SOFIIANY+SOFIIONE+SOFIIRES+SOFIIOUT)                         
         DC    AL1(SOFOTSD1)                                                    
*                                                                               
         DC    AL1(RRULYMD)                                                     
         DC    AL1(0)                                                           
         DC    AL1(SOFITYMD)                                                    
         DC    AL1(SOFIIANY+SOFIIONE+SOFIIRES+SOFIIOUT)                         
         DC    AL1(SOFOTSD2)                                                    
*                                                                               
         DC    AL1(RRULDATE)                                                    
         DC    AL1(0)                                                           
         DC    AL1(SOFITYM+SOFITYMD)                                            
         DC    AL1(SOFIIANY+SOFIIONE+SOFIIRES+SOFIIOUT)                         
         DC    AL1(SOFOTSD2)                                                    
*                                                                               
         DC    AL1(RRULYMP)                                                     
         DC    AL1(0)                                                           
         DC    AL1(SOFITYM)                                                     
         DC    AL1(SOFIIANY+SOFIIF1O+SOFIIRES+SOFIIOUT)                         
         DC    AL1(SOFOTSD1)                                                    
*                                                                               
         DC    AL1(RRULYMDP)                                                    
         DC    AL1(0)                                                           
         DC    AL1(SOFITYMD)                                                    
         DC    AL1(SOFIIANY+SOFIIRES+SOFIIOUT)                                  
         DC    AL1(SOFOTSD2)                                                    
*                                                                               
         DC    AL1(RRULPERD)                                                    
         DC    AL1(DVLTIPRT)                                                    
         DC    AL1(SOFITYM+SOFITYMD)                                            
         DC    AL1(SOFIIANY+SOFIIRES+SOFIIOUT)                                  
         DC    AL1(SOFOTSD2)                                                    
*                                                                               
         DC    AL1(RRULPDSP)                                                    
         DC    AL1(DVLTIDSP)                                                    
         DC    AL1(SOFITYM)                                                     
         DC    AL1(SOFIIANY+SOFIIRES+SOFIIOUT)                                  
         DC    AL1(SOFOTSD2)                                                    
*                                                                               
         DC    AL1(RRULPD01)                                                    
         DC    AL1(DVLTID01)                                                    
         DC    AL1(SOFITYM)                                                     
         DC    AL1(SOFIIANY+SOFIIRES+SOFIIOUT)                                  
         DC    AL1(SOFOTSD2)                                                    
*                                                                               
         DC    AL1(RRULPVAL)                                                    
         DC    AL1(DVLTIPRT)                                                    
         DC    AL1(SOFITYMD)                                                    
         DC    AL1(SOFIIANY+SOFIIRES+SOFIIOUT)                                  
         DC    AL1(SOFOTSD2)                                                    
*                                                                               
         DC    AL1(RRULPV1D)                                                    
         DC    AL1(DVLTIPRT)                                                    
         DC    AL1(SOFITYMD)                                                    
         DC    AL1(SOFIIANY+SOFIIONE+SOFIIRES+SOFIIOUT)                         
         DC    AL1(SOFOTSD2)                                                    
*                                                                               
         DC    AL1(RRULPV1M)                                                    
         DC    AL1(DVLTIPRT)                                                    
         DC    AL1(SOFITYM)                                                     
         DC    AL1(SOFIIANY+SOFIIONE+SOFIIRES+SOFIIOUT)                         
         DC    AL1(SOFOTSD2)                                                    
*                                                                               
         DC    AL1(RRULPVPM)                                                    
         DC    AL1(DVLTIPRT)                                                    
         DC    AL1(SOFITYM)                                                     
         DC    AL1(SOFIIANY+SOFIIRES+SOFIIOUT)                                  
         DC    AL1(SOFOTSD2)                                                    
*                                                                               
         DC    AL1(RRULREP1)                                                    
         DC    AL1(DVLTIDSP)                                                    
         DC    AL1(SOFITYM)                                                     
         DC    AL1(SOFIIANY+SOFIIRES+SOFIIOUT)                                  
         DC    AL1(SOFOTSD2)                                                    
*                                                                               
         DC    AL1(RRULREPQ)                                                    
         DC    AL1(DVLTIDSP)                                                    
         DC    AL1(SOFITYM)                                                     
         DC    AL1(SOFIIANY+SOFIIRES+SOFIIOUT)                                  
         DC    AL1(SOFOTSD2)                                                    
*                                                                               
DVLTABN  EQU   (*-DVLTAB)/L'DVLTAB                                              
*                                                                               
DVLTABD  DSECT                     DATE VALIDATION/DISPLAY TABLE                
*                                                                               
DVLTTYPE DS    XL(L'RFPVVRUL)      VALIDATION RULE NUMBER                       
DVLTEOTQ EQU   0                   END OF TABLE                                 
*                                                                               
DVLTINDS DS    X                   INDICATOR BYTE                               
DVLTID01 EQU   X'80'               SET DAYS TO 01                               
DVLTIPRT EQU   X'40'               OUTPUT IS IN PRINTABLE FORMAT                
DVLTIDSP EQU   X'20'               SET DAYS TO SPACES                           
*                                                                               
DVLTSOFT DS    XL(L'SOFITYPE)      SOFDAT INPUT TYPE                            
DVLTSOFI DS    XL(L'SOFIINDS)      SOFDAT INPUT INDICATORS                      
DVLTSOFO DS    XL(L'SOFOTYPE)      SOFDAT OUTPUT TYPE                           
*                                                                               
DVLTABL  EQU   *-DVLTABD           LENGTH OF TABLE ENTRY                        
*                                                                               
DOSWORKD DSECT                     DOSOFT S/R LOCAL W/S                         
*                                                                               
DOSPARM  DS    0X                  INPUT PARAMETER LIST                         
DOSRULE  DS    X                   RULE NUMBER                                  
DOSAINP  DS    AL3                 A(INPUT STRING)                              
DOSLINP  DS    AL4                 L'INPUT STRING                               
DOSPARML EQU   *-DOSPARM                                                        
*                                                                               
DOSP     DS    6F                  PARAMETER LIST                               
DOSWORK  DS    CL(L'RFPVCVAL)      WORK AREA                                    
*                                                                               
DOSFLDH  DS    XL8                 DUMMY FIELD HEADER FOR SOFDAT                
DOSFLD   DS    CL(L'RFPVCVAL)      DUMMY FIELD FOR SOFDAT                       
DOSWORKL EQU   *-DOSWORKD                                                       
         EJECT                                                                  
REQXFIL  CSECT                                                                  
                                                                                
***********************************************************************         
*ROUTINE TO INTERFACE TO SOFDAT                                       *         
*NTRY -  R1=A(PARAMETER LIST AS FOLLOWS):-                            *         
*        P1/B0  =SOFDAT INPUT TYPE (SOFITYPE)                         *         
*        P1/B1-3=A(INPUT AREA)                                        *         
*        P2/B0  =SOFDAT OUTPUT TYPE (SOFOTYPE)                        *         
*        P2/B1-3=A(OUTPUT AREA)                                       *         
*        P3/B0  =SOFDAT INPUT INDICATORS (SOFIINDS)                   *         
*EXIT -  CC=SET BY SOFDAT                                             *         
***********************************************************************         
GOSOFT   NTR1  LABEL=NO,WORK=(R9,GOSWORKL)                                      
         USING GOSWORKD,R9         R9=A(LOCAL WORKING STORAGE)                  
         USING SOFDATD,GOSSOFTD                                                 
         XC    SOFDATD(SOFXTNL),SOFDATD                                         
         MVC   SOFITYPE,0(R1)                                                   
         OI    SOFITYPE,SOFITXTN   SET EXTENSION BLOCK PASSED                   
         MVC   SOFAINP+1(L'SOFAINP-1),1(R1)                                     
         MVC   SOFOTYPE,4(R1)                                                   
         MVC   SOFAOUT+1(L'SOFAOUT-1),5(R1)                                     
         MVC   SOFIINDS,8(R1)                                                   
         MVC   SOFTODAY,TODAY      TODAY IS GROUP SUBMIT DATE                   
*                                                                               
         LA    R0,COMFACS                                                       
         ST    R0,SOFACOM                                                       
         LA    R0,SOFTBUFF                                                      
         ST    R0,SOFABUFF                                                      
*                                                                               
         MVI   SOFSYSN,0           SET SYSTEM NUMBER                            
         LHI   R0,SOFSYS#                                                       
         LTR   R0,R0                                                            
         BZ    GOSOFT04                                                         
         LA    RF,SOFSYS                                                        
         CLC   RFPFSYS,0(RF)                                                    
         BE    *+16                                                             
         AHI   RF,L'SOFSYS                                                      
         BCT   R0,*-14                                                          
         B     GOSOFT04                                                         
         MVC   SOFSYSN,1(RF)                                                    
*                                                                               
GOSOFT04 OC    ASOFDAT,ASOFDAT     TEST SOFDAT LOADED                           
         JNZ   GOSOFT06            YES                                          
         LOAD  EPLOC=SOFDAT,ERRET=GOSOFTER                                      
         ST    R0,ASOFDAT                                                       
*                                                                               
GOSOFT06 GOTOR ASOFDAT,SOFDATD     CALL SOFDAT TO RESOLVE DATE(S)               
         XIT1                      AND RETURN WITH SOFDAT CC INTACT             
*                                                                               
GOSOFTER DC    H'0'                CAN'T LOAD SOFDAT                            
         DROP  R6,R9,RB                                                         
*                                                                               
         LTORG                                                                  
*                                                                               
SOFSYS   DS    0XL2                SYSTEM CONVERSION TABLE                      
*&&US*&& DC    AL1(RFPFSSPL,RFPFSSPN)                                           
*&&US*&& DC    AL1(RFPFSNEL,RFPFSNEN)                                           
*&&US*&& DC    AL1(RFPFSPPL,RFPFSPPN)                                           
SOFSYS#  EQU   (*-SOFSYS)/L'SOFSYS                                              
*                                                                               
ASOFDAT  DC    A(0)                A(SOFDAT)                                    
SOFDAT   DC    C'T00AAE  '         SOFDAT PHASE NAME                            
*                                                                               
COMFACS  DS    0A                                                               
       ++INCLUDE DDCOMFACSC                                                     
*                                                                               
SOFTBUFF DC    (SOFBUFFL)X'00'     SOFDAT OPTIMIZATION BUFFER                   
*                                                                               
GOSWORKD DSECT                     GOSOFT S/R LOCAL W/S                         
GOSSOFTD DS    XL(SOFXTNL)         SOFDAT CONTROL BLOCK                         
GOSWORKL EQU   *-GOSWORKD                                                       
*                                                                               
REQXFIL  CSECT                                                                  
         EJECT                                                                  
***********************************************************************         
*ROUTINE TO TRACE RPF REQUEST INPUT                                   *         
***********************************************************************         
GRPTRACE NTR1  BASE=*,LABEL=*                                                   
         L     R3,0(R1)            R3=A(REQUEST BUFFER)                         
         GOTO1 =V(HEXOUT),GRPTPARA,(R3),GRPTHDR,80,=C'SEP'                      
         MVC   P(29),=CL29'RFP REQ   XXXXXXXX/S/GGGGGGGG'                       
         MVC   P+10(8),SVXFG                                                    
         MVC   P+19(1),SVSYSL                                                   
         MVC   P+21(8),SVGRP                                                    
         GOTO1 =V(PRINTER)                                                      
         MVC   P(29),=29C'-'                                                    
         GOTO1 =V(PRINTER)                                                      
         MVC   P(80),GRPTHDR       REQ HDR IN HEX                               
         GOTO1 =V(PRINTER)                                                      
         MVC   P(80),GRPTHDR+80                                                 
         GOTO1 =V(PRINTER)                                                      
         MVC   P(80),80(R3)        REQ FIRST CARD                               
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
*DEBUG                                                                          
*                                                                               
GRPTRX   XIT1                                                                   
*                                                                               
GRPTPARA DS    6F                                                               
GRPTHDR  DS    2XL80                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*CONSTANTS AND WORKING STORAGE FOR COMMON STORAGE AREA                *         
***********************************************************************         
         DS    0D                  START OF COMMON STORAGE AREA                 
         DC    CL8'COMMON'                                                      
COMMON   DS    0D                                                               
*                                                                               
OPEN     DC    CL8'DMOPEN'                                                      
READ     DC    CL8'DMREAD'                                                      
HIGH     DC    CL8'DMRDHI'                                                      
SEQ      DC    CL8'DMRSEQ'                                                      
GETREC   DC    CL8'GETREC'                                                      
CTFILE   DC    CL8'CTFILE'                                                      
GENDIR   DC    CL8'GENDIR'                                                      
GENFILE  DC    CL8'GENFIL'                                                      
*                                                                               
ASYSTAB  DC    A(0)                                                             
AELEM    DC    A(0)                A(XFILE GROUP ELEMENT)                       
LOADADDR DC    A(LOADAREA)                                                      
APQBUFF  DC    A(PQBUFF)                                                        
APQLINE  DC    A(PQLINE)                                                        
SVUSERID DC    H'0'                                                             
DATADISP DC    H'42'               DISPLACEMENT TO FIRST ELEMENT                
HDRLEN   DC    H'80'               LENGTH OF REQUEST HEADER                     
*                                                                               
SVXDEST  DS    XL2'0000'           XFILE DESTINATION ID                         
*                                                                               
SVTHIS   DS    0CL34               THIS REQUEST SAVE DATA                       
SVXAGY   DC    CL2' '              XFILE AGENCY ALPHA                           
SVXUID   DC    XL2'0000'           XFILE USER ID NUMBER                         
SVXFG    DC    CL8' '              XFILE GROUP ID                               
SVSE#    DC    XL1'00'             RFP SYSTEM SE#                               
SVSYS    DC    XL1'00'             RFP SYSTEM OVERLAY NUMBER                    
SVSYSL   DC    CL1' '              RFP SYSTEM                                   
SVGRP    DC    CL8' '              RPF GROUP                                    
SVREQID  DC    CL2' '              RFP REQUEST ID                               
SVREQOT  DC    CL6' '              RFP OUTPUT TYPE                              
         DC    CL3' '              N/D                                          
*                                                                               
SVLAST   DS    0CL34               LAST REQUEST SAVE DATA                       
SLXAGY   DC    CL2' '              XFILE AGENCY ALPHA                           
SLXUID   DC    XL2'0000'           XFILE USER ID NUMBER                         
SLXFG    DC    CL8' '              XFILE GROUP ID                               
SLSE#    DC    XL1'00'             RFP SYSTEM SE#                               
SLSYS    DC    XL1'00'             RFP SYSTEM OVERLAY NUMBER                    
SLSYSL   DC    CL1' '              RFP SYSTEM                                   
SLGRP    DC    CL8' '              RPF GROUP                                    
SLREQID  DC    CL2' '              RFP REQUEST ID                               
SLREQOT  DC    CL6' '              RFP OUTPUT TYPE                              
         DC    CL3' '              N/D                                          
*                                                                               
SVPQDATA DS    0CL10               PQ REPORT DATA                               
SVPQUSR  DC    XL2'0000'           PQ REPORT USER ID                            
SVPQID   DC    CL3' '              PQ REPORT ID                                 
SVPQNO   DC    XL2'0000'           PQ REPORT NUMBER                             
SVPQDA   DC    XL2'0000'           PQ REPORT DISK ADDR OF FIRST CI              
SVPQERR  DC    X'00'               PQ REPORT ERROR AT DMCB+8                    
*                                                                               
INGRP    DC    C'N'                PROCESSING RFP GROUP REQUESTS                
NEWSYS   DC    C'N'                                                             
TRACE    DC    X'00'                                                            
TESTMODE DC    X'00'                                                            
RFHWANT  DC    C'N'                                                             
SPOOL    DC    C'N'                                                             
ACCEMU   DC    X'00'                                                            
ELCODE   DC    X'00'                                                            
QCARDS   DC    X'00'               NUMBER OF CARDS THIS REQUEST                 
QCTR     DC    X'00'               NEXT CARD NUMBER TO PROCESS                  
PUTTYP   DC    X'00'                                                            
LPUTTYP  DC    X'00'                                                            
REQJOBCT DC    PL2'0'                                                           
REQCOUNT DC    PL2'0'                                                           
DIRCOUNT DC    PL2'0'                                                           
*                                                                               
TODAY    DC    CL6' '              FORMAT C'YYMMDD'                             
SAVEDATE DC    CL6' '                                                           
SAVENODT DC    CL6' '                                                           
DATE     DC    CL6' '                                                           
TODAYJUL DC    PL4'0'                                                           
TODAYDMY DC    CL8' '              FORMAT C'DD/MM/YY' OR C'MM/DD/YY'            
TODAYJOB DS    C'N'                                                             
*                                                                               
DUB      DS    D                                                                
FULL     DS    F                                                                
FULL1    DS    F                                                                
HALF     DS    H                                                                
HALF1    DS    H                                                                
PARA     DS    6F                                                               
DMCB     DS    6F                                                               
WORK     DS    CL32                                                             
C        DS    CL80                                                             
MYDMWORK DS    XL40                FOR GETREC/PUTREC                            
*                                                                               
SPOTNETS DS    0CL8                                                             
SPOTSNUM DS    CL2                 SPOT SYSTEM NUM (SET BY CALLER)              
NETSNUM  DS    CL2                 SPOT NET SYSTEM NUM                          
NETSNAME DS    CL3                 SPOT NET SYSTEM NAME                         
DUMP     DC    C'Y'                DUMP=Y (DEFAULT) OR DUMP=OS                  
*                                                                               
IDIOTRCD DS    C                   DATA USED BY IDIOT ROUTINE                   
IDIOTOTY DS    CL6                                                              
IDIOTSYS DS    CL1                                                              
IDIOTPRG DS    CL2                                                              
*                                                                               
PARMSOK  DC    C'Y'                                                             
JCLOPT   DC    C' '                                                             
JCLPARM  DC    AL1(0)                                                           
SINGLE   DC    AL1(0)                                                           
PANBOOK  DC    CL10' '                                                          
THISJCL  DC    CL10' '                                                          
NOTFJCL  DC    CL10' '                                                          
POWKEY   DC    CL10' '                                                          
BEFJCL   DC    CL10' '                                                          
AFTJCL   DC    CL10' '                                                          
AFP      DC    CL8' '                                                           
AFPKEEP  DC    C' '                                                             
RJEOPT   DC    CL3' '                                                           
LOGOADR  DC    C' '                                                             
IS_SYSIN DC    C'N'                                                             
SETDSPC  DC    C'N'                                                             
DSPACE   DC    C' '                                                             
JCLIF    DC    C'Y'                                                             
OUTJOB   DC    C' '                                                             
OUTJES   DC    C' '                                                             
OUTAFP   DC    C' '                                                             
OUTSYP   DC    C' '                                                             
OUTSIN   DC    C' '                                                             
SYSPMODE DC    C' '                SET TO C'O' IF //  OUTPUT CARDS              
SYSPOUT  DC    C' '                                                             
RCMSW    DC    C'N'                                                             
ANYOUT   DC    C'N'                                                             
LASTOUT  DC    C'N'                                                             
REPSPACE DC    C'Y'                                                             
DISP     DC    C'D'                                                             
FREE     DC    C'Y'                                                             
JCLASS   DC    C'A'                                                             
USEMYJOB DC    C'N'                                                             
SYSTEM   DC    CL2' '                                                           
OUTCRDN  DC    PL2'0'                                                           
OUTCRDF  DC    PL2'0'                                                           
OUTCRDL  DC    PL2'0'                                                           
FSTEXEC  DC    PL4'0'                                                           
JOBEXEC  DC    PL4'0'                                                           
TOTEXEC  DC    PL4'0'                                                           
TOTJOB   DC    PL4'0'                                                           
THSJCL   DS    X                                                                
LSTJCL   DS    X                                                                
DELJCL   DS    X                                                                
JCLINJID DC    CL8' '                                                           
JCLINJLN DC    AL1(0)                                                           
JCLINJNO DC    PL4'0'                                                           
SPLCOUNT DC    AL1(1)              COUNT OF SPOOL TAPES IS JOB                  
STEPNAME DC    CL8' '              MVS THIS JOB STEP NAME                       
STEPNAMF DC    CL8' '              MVS FIRST JOB STEP NAME                      
STEPNAMP DC    CL8' '              MVS PREVIOUS JOB STEP NAME                   
WJCLID   DC    CL8' '              WRAP JCL DATA DISK FILE ID                   
WLOGID   DC    CL8' '              WRAP LOG DATA DISK FILE ID                   
NETID    DC    CL8' '              JES NETWORK ID                               
NETRL    DC    CL19' '             JES NETWORK LAST NET CARD RL= OR NR=         
NETHC    DC    C'00'               JES NETWORK FRST NET CARD HC=                
NETOH    DC    C' '                JES NETWORK OH=YES REQUIRED                  
NETEOJ   DC    X'00'                                                            
NETFRST  DC    X'00'                                                            
*                                                                               
AFRSTO   DS    A                   A(FIRST CARD OUTPUT CARD)                    
NFRSTO   DS    H                   NUMBER OF CARDS IN FIRST SET                 
NSETS    DS    H                   NUMBER OF SETS OUTPUT                        
AFRSTCLA DS    A                                                                
AFRSTCOP DS    A                                                                
AFRSTDES DS    A                                                                
AFRSTFOR DS    A                                                                
AFRSTPAG DS    A                                                                
ANEXTO   DS    A                                                                
ALASTO   DS    A                   A(LAST OUTPUT CARD)                          
*                                                                               
SYSNAMS  DS    CL3                 SHORT SYSTEM NAME                            
SYSNAML  DS    CL5                 LONG  SYSTEM NAME                            
PGMRNAME DC    CL4' '              PROGRAMMER NAME                              
PRTY     DC    C'1'                                                             
NOTIFY   DC    CL4' '                                                           
USER     DC    CL8' '                                                           
RESTART  DC    CL2'R '                                                          
MSGLEV1  DC    C'1'                                                             
MSGLEV2  DC    C'1'                                                             
MSGCLA   DC    C'A'                                                             
FLASH    DC    CL4' '                                                           
FORMS    DC    CL4' '                                                           
CLASS    DC    CL1' '                                                           
BETAKEEP DC    CL1' '                                                           
WHATDEST DC    CL1' '                                                           
PORFDEFS DC    XL1'00'                                                          
JOBSTART DC    CL8' '                                                           
JOBEND   DC    CL8' '                                                           
TYPRUN   DC    CL8' '                                                           
FRSTNAME DC    CL8' '                                                           
FRSTNAMF DC    C'Y'                                                             
ANYLOGO  DC    C'Y'                                                             
ANYSPLTP DC    C'N'                                                             
JOBIND   DC    C'I'                                                             
MAXTAPES DC    X'00'                                                            
JOBTAPES DC    X'00'                                                            
TSTTAPES DC    X'00'                                                            
*                                                                               
CONDPARM DC    CL11' '                                                          
ACCTPARM DC    CL05' '   '                                                      
CONDPPRO DC    CL11',CONE=EVEN,'                                                
ACCTPPRO DC    CL05'ACCU='                                                      
CONDPPGM DC    CL11',COND=EVEN,'                                                
ACCTPPGM DC    CL05'ACCT='                                                      
MAXSTEPS DC    PL4'255'                                                         
         DS    0D                                                               
         DC    CL8'JCLSAVE '                                                    
JCLSAVE  DC    CL80' '                                                          
JCL      DC    CL80' '                                                          
JESIOA   DC    CL80' '                                                          
*                                                                               
LGRECNO  DC    PL4'0'                                                           
LGJOBNO  DC    PL4'0'                                                           
LGEXENO  DC    PL4'0'                                                           
LGEXENOJ DC    PL4'0'                                                           
LGJESID  DC    CL8' '                                                           
LGJOBID  DC    CL8' '                                                           
LGEXEID  DC    CL8' '                                                           
LGEXEIDL DC    CL8' '                                                           
LGSYSDI  DC    CL1' '                                                           
LGSYSPR  DC    CL20' '                                                          
LGOUTTP  DC    CL16' '                                                          
*&&UK                                                                           
LGLOGO1  DC    CL7' '                                                           
*&&                                                                             
         DC    D'0'                                                             
LOGREC   DC    CL80' '                                                          
         ORG   LOGREC                                                           
LOGSYSID DS    CL2                 SYSTEM ID                                    
         DS    CL1                                                              
LOGRECNO DS    CL4                 RECORD NUMBER                                
         DS    CL1                                                              
LOGJESID DS    CL8                 JES ID IF SPOOLED TO MVS DIRECT              
         DS    CL1                                                              
LOGJOBID DS    CL8                 NAME ON JOB CARD                             
         DS    CL1                                                              
LOGEXEID DS    CL8                 NAME ON EXECUTE CARD                         
         DS    CL1                                                              
LOGSYSDI DS    CL1                 SYSPRINT DISPOSITION                         
         DS    CL1                                                              
*&&US                                                                           
LOGSYSPR DS    CL20                SYSPRINT SYSOUT= OR TAPE DSN=                
         DS    CL1                                                              
LOGOUTTP DS    CL16                FIRST OUTPUT TAPE DSN=                       
         DS    CL6                 SPARE                                        
*&&                                                                             
*&&UK                                                                           
LOGSYSPR DS    CL20                SYSPRINT SYSOUT= OR TAPE DSN=                
LOGOUTTP DS    CL16                FIRST OUTPUT TAPE DSN=                       
LOGLOGO2 DS    CL7                 LOGO2 (USED IN UK FOR BIN NUMBER)            
*&&                                                                             
LOGRECX  EQU   *                                                                
         ORG                                                                    
*                                                                               
         DS    0D                                                               
         DC    CL8'XDIRREC '                                                    
XDIRREC  DS    CL40                XFILE DIRECECTORY RECORD                     
*                                                                               
         DS    0D                                                               
         DC    CL8'QJOBDATA'                                                    
QJOBDATA DS    0C                  VARIOUS EOD FIELDS (FROM EDREQD)             
*                                                                               
QJOBKEY  DS    0CL30               JOB DEFINITION KEY                           
QSYSTEM  DC    CL1' '              A=ACCPAK ETC                                 
QSUBSYS  DC    CL2' '              ACC1=1   ETC                                 
QPRISC   DC    CL1' '              PRIORITY SORT CODE                           
QOUTPRI  DC    CL1' '              OUTPUT PRIORITY FROM OUTPUT TYPE REC         
QCLASS   DC    CL1' '              OUTPUT CLASS                                 
QOUTSPEC DC    CL1' '              SPECIAL OUTPUT HANDLING                      
QOUTTYPE DC    CL6'DOWN'           OUTPUT TYPE                                  
QORIGIN  DC    XL2'0000'           ORIGIN ID NUM                                
QPROGRAM DC    CL2' '              PROGRAM CODE                                 
QDEST    DC    XL2'0000'           DESTINATION ID NUM                           
QUSER    DC    CL2' '              AGENCY/REP/COMPANY ETC                       
QSUBUSER DC    CL1' '              MEDIA ETC                                    
QSUB2    DC    CL1' '              JOURNALS G OR P/CLEARANCES S OR P            
QSHIPUNT DC    CL2' '              SHIPPING UNIT                                
QAGCTRY  DC    XL1'00'             AGENCY COUNTRY CODE                          
QCTRY    DC    XL1'00'             ACTUAL COUNTRY CODE                          
QLANG    DC    XL1'00'             LANGUAGE CODE                                
QSPLTR   DC    CL1' '              RESERVED FOR SPLITTING REQUESTS              
QPRIPT   DC    CL1' '              PGM TYPE CODE   (FILE MARKERS A-I)           
QPRIPO   DC    CL1' '              PGM OUTPUT CODE (CONFIDENTIAL A-I)           
*                                                                               
QJOBMVS  DC    CL8' '              MVS JOB NAME                                 
QJOBJES  DC    CL8' '              JES JOB NAME                                 
QJOBSYS  DC    CL8' '              SYSTEM MAME                                  
QJOBJCL  DC    CL10' '             SPECIAL JCL BOOK                             
QJOBPHS  DC    CL4' '              SPECIAL PHASES                               
QJOBDATE DC    CL8' '              DATE JOB CREATED                             
QJOBFMN  DC    XL1'00'             NUMBER OF FORM DEFS                          
QJOBFMD  DC    CL6' '              FORM DEFINITION                              
QJOBPGN  DC    XL1'00'             NUMBER OF PAGE DEFS                          
QJOBPGD  DC    CL6' '              PAGE DEFINITION                              
QJOBCC   DC    CL4' '              CARRIAGE CONTROL                             
QJOBKEEP DC    CL1' '              SET TO Y IF EXTRA KEEP COPY                  
QJOBCOPY DC    CL1' '              NUMBER OF COPIES                             
QJOBDISP DC    CL1' '              OUTPUT DISPOSITION                           
QJOBRETC DC    CL1' '              RETAIN CLASS                                 
QJOBPQDS DC    CL11' '             PQ REPORT DESCRIPTION                        
QJOBPQFM DC    CL5' '              PQ REPORT FORM                               
QJOBOSID DC    CL3' '              OVERNIGHT SOON REPORT ID                     
QJOBOSNO DC    XL2'00'             OVERNIGHT SOON REPORT NUM                    
QJOBORUT DC    CL6' '              OUTPUT ROUTE                                 
QJOBPTYP DC    CL1'Q'              P=PRINT,Q=QUEUE,B=BOTH                       
QJOBPOWO DC    CL4' '              OUTPUT JES CODE                              
QJOBCHRS DC    CL4' '              LASER CHR SET                                
QJOBCHR2 DC    CL4' '              LASER CHR SET                                
QJOBCHR3 DC    CL4' '              LASER CHR SET                                
QJOBCHR4 DC    CL4' '              LASER CHR SET                                
QJOBFCH  DC    CL1' '              FICHE CLASS                                  
QJOBCLAS DC    CL1' '              INPUT CLASS                                  
QJOBLOG1 DC    CL7' '              DESTINATION LOG1                             
QJOBLOG2 DC    CL7' '              DESTINATION LOG2                             
QJOBONAM DC    CL33' '             ORIGIN NAME                                  
QJOBOADD DC    CL33' '             ORIGIN ADDRESS                               
QJOBDNAM DC    CL33' '             DESTINATION NAME                             
QJOBDADD DC    CL33' '             DESTINATION ADDRESS                          
QJOBDAD2 DC    CL33' '             DESTINATION ADDRESS                          
QJOBDAD3 DC    CL33' '             DESTINATION ADDRESS                          
QJOBPACK DC    CL152' '            PACKING INSTRUCTIONS                         
QJOBSHIP DC    CL152' '            SHIPING INSTRUCTIONS                         
QJOBPROC DC    CL152' '            PROCESSING INSTRUCTIONS                      
*                                                                               
QDATAMAX EQU   14                  MAXIMUM NUMBER OF REQUEST CARDS              
         DS    0D                                                               
         DC    CL8'*RPFREQ*'                                                    
REQIN    DS    0C                  INPUT REQUEST                                
REQINHN  DS    CL54                NEW REQUEST REC HDR                          
REQINHO  DS    CL26                OLD REQUEST REC HDR                          
REQINCDS DS    (QDATAMAX)CL80      MAXIMUM REQUEST DATA CARDS                   
         ORG   REQINCDS                                                         
REQINCD1 DS    CL80                OLD STYLE 2 CARD REQUEST DATA                
REQINCD2 DS    CL80                                                             
         DS    09CL80                                                           
         ORG                                                                    
REQINEND DS    0H                                                               
*                                                                               
RFPMARK  DC    C'*RFP*RFP*RFP*RFP*RFP*RFP'                                      
*                                                                               
JCLTAPE  DCB   DDNAME=JCLTAPE,DSORG=PS,RECFM=FB,                       X        
               LRECL=80,BLKSIZE=80,MACRF=PM                                     
*                                                                               
WJCL     DCB   DDNAME=WJCL,DSORG=PS,RECFM=FB,                          X        
               LRECL=80,BLKSIZE=00,MACRF=PM                                     
*                                                                               
WLOG     DCB   DDNAME=WLOG,DSORG=PS,RECFM=FB,                          X        
               LRECL=80,BLKSIZE=00,MACRF=PM                                     
         EJECT                                                                  
***********************************************************************         
*UTL AND SSB                                                          *         
***********************************************************************         
         DS    0D                                                               
         DC    CL16'*UTL**UTL**UTL**'                                           
UTL      DC    (TUTLXALN)X'00'                                                  
         ORG   UTL+(TSYS-UTLD)                                                  
         DC    X'0A'               SYSTEM 10 (CONTROL)                          
         ORG                                                                    
UTLL     EQU   *-UTL                                                            
*                                                                               
         DS    0D                                                               
         DC    CL16'*SSB**SSB**SSB**'                                           
SSB      DC    XL(SSOOFFX-SSOOFF)'00'                                           
         ORG   SSB+(SSOXTND-SSBD)                                               
         DC    X'FF'               SET EXTENDED OFFLINE SSB                     
         ORG   SSB+(SSOSTAT2-SSBD)                                              
         DC    AL1(SSOSNRCV)       SET RECOVERY OFF                             
         ORG                                                                    
SSBL     EQU   *-SSB                                                            
         EJECT                                                                  
***********************************************************************         
*IO AREAS                                                             *         
***********************************************************************         
         DC    0D'0'                                                            
         DC    CL8'USERREC '                                                    
USERREC  DS    2000C                                                            
*                                                                               
         DC    0D'0'                                                            
         DC    CL8'XFILREC '                                                    
XFILREC  EQU   *                                                                
MYAIO    DS    2000C                                                            
*                                                                               
         DC    0D'0'                                                            
         DC    CL8'SPLPOOL '                                                    
SPLPOOL  DC    F'200'                                                           
         DC    F'0'                                                             
         DS    3200C                                                            
*                                                                               
         DC    0D'0'                                                            
         DC    CL8'SUBTABLE'                                                    
SUBTABLE DC    F'0'                                                             
         DC    100CL66' '                                                       
*                                                                               
         DC    0D'0'                                                            
         DC    CL8'SOFTABLE'                                                    
SOFTABLE DC    AL4((SOFTABLX-SOFTABLE)/33) NUM OF TABLE ENTRIES                 
         DC    AL1(7),AL1(2),CL15'&&AGENCY'                                     
SOFTAGY  DC    CL15' '                                                          
         DC    AL1(6),AL1(1),CL15'&&MEDIA'                                      
SOFTMED  DC    CL15' '                                                          
         DC    AL1(8),AL1(1),CL15'&&COMPANY'                                    
SOFTCOMP DC    CL15' '                                                          
         DC    AL1(7),AL1(1),CL15'&&LEDGER'                                     
SOFTLEDG DC    CL15' '                                                          
         DC    AL1(4),AL1(2),CL15'&&REP'                                        
SOFTREP  DC    CL15' '                                                          
         DC    AL1(4),AL1(8),CL15'&&IPL'                                        
SOFTIPL  DC    CL15' '                                                          
         DC    AL1(8),AL1(2),CL15'&&PROGRAM'                                    
SOFTPROG DC    CL15' '                                                          
         DC    AL1(7),AL1(3),CL15'&&SYSTEM'                                     
SOFTSYS  DC    CL15' '                                                          
         DC    AL1(6),AL1(7),CL15'&&LOGO1'                                      
SOFTLOG1 DC    CL15' '                                                          
         DC    AL1(6),AL1(7),CL15'&&LOGO2'                                      
SOFTLOG2 DC    CL15' '                                                          
         DC    AL1(7),AL1(5),CL15'&&ORIGIN'                                     
SOFTORIG DC    CL15' '                                                          
         DC    AL1(5),AL1(5),CL15'&&DEST'                                       
SOFTDEST DC    CL15' '                                                          
         DC    AL1(4),AL1(2),CL15'&&DAY'                                        
SOFTDAY  DC    CL15' '                                                          
         DC    AL1(8),AL1(2),CL15'&&HEXCOMP'                                    
SOFTHEX  DC    CL15' '                                                          
SOFTABLX EQU   *                                                                
*                                                                               
PGMEQTAB DS    0CL10               PROGRAM/PROGRAM EQUATE                       
         DC    C'RE011RE010'                                                    
         DC    C'RE086RE085'                                                    
         DC    C'PP013PP012'                                                    
         DC    C'PP021PP020'                                                    
         DC    C'PP053PP052'                                                    
         DC    C'PP072PP071'                                                    
         DC    C'PP073PP071'                                                    
         DC    C'PP075PP071'                                                    
         DC    X'FF'                                                            
*                                                                               
SYSEQTAB DS    0CL8                QSYSTEM/2BYTE NAME/3BYTE NAME/INDICS         
*&&US*&& DC    C'SSPSPT',AL1(0,0)                                               
*&&US*&& DC    C'PPPPRT',AL1(0,0)                                               
*&&US*&& DC    C'RREREP',AL1(0,0)                                               
*&&US*&& DC    C'TTATAL',AL1(0,0)                                               
*&&UK*&& DC    C'MMEMED',AL1(0,0)                                               
*&&UK*&& DC    C'FFEFEE',AL1(0,0)                                               
         DC    C'AACACC',AL1(0,0)                                               
         DC    C'BMBMBA',AL1(0,0)                                               
         DC    C'CCTCON',AL1(0,0)                                               
         DC    C'EPEPER',AL1(0,0)                                               
         DC    C'LMPMPL',AL1(0,0)                                               
         DC    X'FF'                                                            
*                                                                               
LDIRECT  DC    CL80' '             LAST DIRECT=... CARD                         
*                                                                               
*                   0000000000111111111122222222223333333333444444              
*                   0123456789012345678901234567890123456789012345              
*                                                                               
*VSJMS   DC    CL80'//             MSGLEVEL=(1,1),MSGCLASS=A        '           
MVSSYI   DC    CL80'//SYSIN     DD *                                '           
MVSSYP   DC    CL80'//SYSPRINT  DD SYSOUT=*                         '           
MVSSYPT1 DC    CL80'//SYSPRINT  DD UNIT=TAPE,DISP=(MOD,CATLG,CATLG),'           
MVSSYPT2 DC    CL80'//             DSN=XXXTAPE.                     '           
MVSEOJ   DC    CL80'//'                                                         
MVSSPOOL DC    CL80'SPOOL=XXXTAPE.SS0PPAA'                                      
*                                                                               
MVSOUT   DC    CL80'//OU001 OUTPUT CLASS=X'                                     
MVSFICHE DC    CL80'//OU001 OUTPUT CLASS=S,FORMS=FICHE,COPIES=001,DEST=X        
               FICHE'                                                           
*                                                                               
JESKEEP1 DC    CL80'//*FORMAT   PR,DDNAME=SYSPRINT,DEST=ANYLOCAL'               
JESKEEP2 DC    CL80'//*FORMAT   PR,DDNAME=SYSPRINT,DEST=KEEP'                   
JESFICHE DC    CL80'//*FORMAT   PR,DDNAME=SYSPRINT,DEST=FICHE,FORMS=FICX        
               HE'                                                              
JESNET   DC    CL80'//*NET         ID=XXXXXXXX,HC=01,RL=XXXXXXXX'               
*                                                                               
RFHDR    DC    CL80'RFHDR='                                                     
*                                                                               
         DC    0D'0'                                                            
         DC    CL8'MVSJOB  '                                                    
JJ1      DC    CL80' '             MVS //XXXXXXXX JOB CARDS                     
JJ2      DC    CL80' '                                                          
JJ3      DC    CL80' '                                                          
JJX      DC    CL80' '                                                          
*                                                                               
JES1     DC    CL80' '             MVS //*JES CARDS                             
JES2     DC    CL80' '                                                          
JES3     DC    CL80' '                                                          
JESX     DC    CL80' '                                                          
*                                                                               
AFP1     DC    CL80' '             MVS //OUTPUT CARDS                           
AFP2     DC    CL80' '                                                          
AFP3     DC    CL80' '                                                          
         DC    400CL80' '                                                       
*                                                                               
JP1      DC    CL80' '             MVS //SYSPRINT  DD CARDS                     
JP2      DC    CL80' '                                                          
JP3      DC    CL80' '                                                          
         DC    20CL80' '                                                        
JPX      DC    CL80' '                                                          
*                                                                               
         DC    80X'FF'             MVS END OF JCL CARD GEN AREA                 
*                                                                               
         DC    0D'0'                                                            
         DC    CL8'JCLIN   '                                                    
JCLIN    DC    20CL80' '                                                        
         DC    X'FF'                                                            
*                                                                               
         DC    0D'0'                                                            
         DC    CL8'REQIO   '                                                    
REQLEN   DC    H'0'                                                             
         DC    H'0'                                                             
REQIO    DS    2000C                                                            
*                                                                               
         DC    0D'0'                                                            
         DC    CL8'RFPIOBLK'                                                    
RFPIOBLK DS    (RFPBLKLN)C                                                      
*                                                                               
         DC    0D'0'                                                            
         DC    CL8'MINIOWRK'                                                    
MINIOWRK DS    5120C                                                            
*                                                                               
         DC    0D'0'                                                            
         DC    CL8'PQLINE  '                                                    
PQLINE   DS    CL256                                                            
*                                                                               
         DC    0D'0'                                                            
         DC    CL8'PQBUFF  '                                                    
PQBUFF   DS    14336C                                                           
*                                                                               
         DC    0D'0'                                                            
         DC    CL8'LOADAREA'                                                    
LOADAREA BR    RE                                                               
         DS    4000C                                                            
         DC    0D'0'                                                            
*                                                                               
         DC    CL8'WORKAREA'                                                    
WORKAREA DS    8000D                                                            
*                                                                               
REQXFILX EQU   *                   END OF DUMP AREA                             
         EJECT                                                                  
***********************************************************************         
*INCLUDED DSECTS                                                      *         
***********************************************************************         
REQHDRD  DSECT                                                                  
*DMREQHDRA                                                                      
       ++INCLUDE DMREQHDRA                                                      
         EJECT                                                                  
*CTGENRFP                                                                       
       ++INCLUDE CTGENRFP                                                       
         EJECT                                                                  
RFPIOD   DSECT                                                                  
*GERFPIOD                                                                       
       ++INCLUDE GERFPIOD                                                       
         EJECT                                                                  
*DMDTFPH                                                                        
       ++INCLUDE DMDTFPH                                                        
         EJECT                                                                  
*DDDPRINT                                                                       
       ++INCLUDE DDDPRINT                                                       
         EJECT                                                                  
*CTGENFILE                                                                      
*DDCNTRL                                                                        
*DMGREQUS                                                                       
*DMPRTQD                                                                        
*DMPRTQL                                                                        
         PRINT OFF                                                              
       ++INCLUDE FASSB                                                          
         ORG SSBD                                                               
       ++INCLUDE FASSBOFF                                                       
         ORG                                                                    
       ++INCLUDE FAUTL                                                          
*                                                                               
       ++INCLUDE CTGENFILE                                                      
       ++INCLUDE DDCNTRL                                                        
       ++INCLUDE DMSYSTABD                                                      
       ++INCLUDE DDSOFDATD                                                      
       ++INCLUDE DMGREQUS                                                       
       ++INCLUDE DMPRTQD                                                        
       ++INCLUDE DMPRTQL                                                        
         PRINT ON                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'004EDREQXFIL 11/02/15'                                      
         END                                                                    

*          DATA SET DMDALDDU   AT LEVEL 003 AS OF 04/20/12                      
*CATALP DMDALDDU                                                                
                                                                                
***********************************************************************         
*P1      PASS X'FF'/X'FE' TO FORCE WRITE OF LAST TRACK (EOF=X'FF')    *         
*P1      PASS X'01' IN P1+1(1) TO INDICATE WANT UNBLOCKED MODE        *         
*P2      A(RECORD)                                                    *         
*P3      PASS FILE NUM 1-4 IN P3(1) AND RECORD LENGTH IN P3+2(2)      *         
*P3      RETURN ERROR INDICATORS IN P3(2)                             *         
*P4      A(DTFPH)                                                     *         
*P5      RETURN TTBR OF RECORD                                        *         
*P6      RETURN TT00 OF TRACK WHEN ACTUALLY WRITTEN ELSE ZEROS        *         
***********************************************************************         
                                                                                
DALDDU   TITLE 'DALDDU - DIRECT ACCESS LOAD MODULE - UNBLOCKED RECS'            
         PRINT NOGEN                                                            
DALDDU   CSECT                                                                  
         ENTRY DALFILU1                                                         
         ENTRY DALFILU2                                                         
         ENTRY DALFILU3                                                         
         ENTRY DALFILU4                                                         
*                                                                               
         NMOD1 0,DALDDU                                                         
         LR    RA,R1               RA=A(PARAM LIST)                             
         USING PARAMS,RA                                                        
         L     R2,P4               R2=A(DAFILE DTF)                             
         USING DTFPHD,R2                                                        
         SR    RE,RE                                                            
         IC    RE,P3                                                            
         CH    RE,=H'4'            FILE NUMBER SHOULD BE 1 THRU 4               
         BNH   *+6                                                              
         DC    H'0'                                                             
         SLL   RE,2                                                             
         L     R7,DALUADRS(RE)     R7=A(DAFILE DATA)                            
         USING DALFILED,R7                                                      
                                                                                
         L     R8,DALFADRS(RE)     R8=A(DAFILE DATA IN DMDALDDS)                
         LTR   R8,R8                                                            
         BNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   THISMODE(4),THISMODE-DALFILED(R8)                                
         MVC   UNBLKLEN(2),UNBLKLEN-DALFILED(R8)                                
         CLC   NEXTTRK,NEXTTRK-DALFILED(R8)                                     
         BH    *+10                                                             
         MVC   NEXTTRK,NEXTTRK-DALFILED(R8)                                     
         CLC   THISMODE(2),=X'0100'                                             
         BE    DALDDU1                                                          
         XC    P6,P6               CLEAR TRK WRITTEN RETURN VALUE               
                                                                                
DALDDU1  XC    P3(2),P3            CLEAR ERROR RETURN FIELD                     
         OC    HIBLK,HIBLK                                                      
         BZ    INIT                INITIALISE IF FIRST CALL                     
                                                                                
DALDDU2  B     DAL1                                                             
                                                                                
DALDDUX  XMOD1 1                                                                
         EJECT                                                                  
***********************************************************************         
*EACH UNBLOCKED RECORD MUST HAVE THE SAME LENGTH AS THE FIRST ONE     *         
*THEY WILL BE LOADED A TRACK AT A TIME                                *         
*EACH V/L RECORD STARTS WITH XL2 REC LEN FOLLOWED BY RECORD KEY/DATA  *         
***********************************************************************         
                                                                                
DAL1     CLI   P1,X'FE'            TEST WRITE TRACK OR EOF CALL                 
         BNL   DALWRT                                                           
         SR    R6,R6                                                            
         ICM   R6,3,P3+2           GET REC LEN AND RANGE CHECK                  
         BZ    LENERR                                                           
         CH    R6,UNBLKLEN                                                      
         BNE   LENERR                                                           
         STH   R6,RECLEN                                                        
         L     R3,P2               R3=A(DAFILE RECORD TO BE LOADED)             
         LA    R3,0(R3)                                                         
                                                                                
DAL2     LH    R4,BLKNUM           BUMP TO NEXT UNBLOCKED RECORD                
         LA    R4,1(R4)                                                         
         CH    R4,HIBLK                                                         
         BH    DALWRT              MAX RECORDS PER TRACK EXCEEDED               
         STH   R4,BLKNUM                                                        
*                                                                               
         L     R0,NEXTREC          MOVE RECORD TO SLOT IN TRACK BUFFER          
         LH    R1,UNBLKLEN                                                      
         LR    RE,R3                                                            
         LR    RF,R1                                                            
         MVCL  R0,RE                                                            
                                                                                
DAL3     L     R4,THISCCW          BUMP FOR NEXT UNBLOCKED RECORD               
         LA    R4,8(R4)                                                         
         ST    R4,THISCCW                                                       
         L     R4,0(R4)            GET A(COUNT FIELD)                           
         LA    R4,0(R4)            CLEAR HOB                                    
         ST    R4,BLKADDR                                                       
         AH    R4,UNBLKLEN                                                      
         LA    R4,8(R4)            ADD LENGTH OF COUNT FIELD                    
         ST    R4,BLKADDRX         SET END BLK ADDRESS + 1                      
         L     R4,BLKADDR                                                       
         LA    R4,8(R4)            COUNT                                        
         ST    R4,NEXTREC          SET INITIAL DATA ADDRESS                     
                                                                                
DAL4     MVC   P5(3),NEXTTRK       UNBLOCKED DISK ADDR 16/18-BIT                
         OC    P5+2(1),BLKNUM+1                                                 
         MVI   P5+3,0                                                           
         TM    DTFTYPE,DTFTBIGF    TEST 20-BIT OR 22-BIT BIG FILE               
         BZ    DAL5                                                             
         MVC   P5(3),NEXTTRK                                                    
         MVC   P5+3(1),BLKNUM+1    UNBLOCKED BLOCKED NUM IN LAST BYTE           
                                                                                
DAL5     OI    WRTFLG,X'02'        SET UNBLOCKED TRACK WRITE PENDING            
         OI    WRTFLG-DALFILED(R8),X'02'                                        
         B     DALDDUX                                                          
         EJECT                                                                  
***********************************************************************         
*WRITE WHOLE TRACK OF BLOCKED RECORDS TO DISK                         *         
***********************************************************************         
                                                                                
DALWRT   MVC   P6(3),NEXTTRK       RETURN REL TRK ADDR TO USER                  
         TM    WRTFLG,X'02'        TEST IF WRITE PENDING                        
         BZ    DALWRT8                                                          
         GOTO1 =V(DADDS),DAPL1     TRANSLATE TO ACTUAL DISK ADDR                
         OC    8(2,R1),8(R1)                                                    
         BZ    *+12                DADDS HAS SAVED EXCP DATA IN DTF             
         CLI   WRITESW,C'N'        TEST WRITE=NO SET                            
         BNE   EOFERR                                                           
*                                                                               
         L     R4,ABUFFER          CREATE COUNT AND ID FIELDS                   
         LA    R5,1                                                             
         LH    R6,UNBLKLEN                                                      
*                                                                               
DALWRT2  MVC   0(4,R4),SRCH        BUILD COUNT FIELD C'CCHHR0LL'                
         STC   R5,4(R4)                                                         
         STH   R6,6(R4)                                                         
*                                                                               
         LA    R4,8(R4,R6)         BUMP TO NEXT BLK                             
         LA    R5,1(R5)            BUMP BLK COUNTER                             
         CH    R5,HIBLK                                                         
         BNH   DALWRT2             WRITE FULL TRACK OF UNBLOCKED RECS           
         MVC   BLKNUM,HIBLK                                                     
*                                                                               
DALWRT3  LH    R0,BLKNUM           NUMBER OF BLKS                               
         LA    R1,CCW-8            A(DATA CCWS)                                 
         LA    R1,8(R1)                                                         
         BCT   R0,*-4                                                           
         NI    4(R1),X'BF'         TURN OFF CC IN LAST CCW                      
*                                                                               
DALWRT4  BAS   R9,EXCP             WRITE TRACK TO DISK                          
         B     DSKERR              ERROR RETURN                                 
*                                                                               
DALWRT6  ICM   RE,15,NEXTTRK                                                    
         TM    DTFTYPE,DTFTBIG+DTFTBIGF                                         
         BZ    DALWRT7             16-BIT                                       
         BO    DALWRT6C            22-BIT                                       
         TM    DTFTYPE,DTFTBIGF                                                 
         BO    DALWRT6B                                                         
DALWRT6A A     RE,=X'00004000'     ADD 1 TO LOW ORDER BIT OF 18-BIT             
         B     DALWRT6D                                                         
DALWRT6B A     RE,=X'00001000'     ADD 1 TO LOW ORDER BIT OF 20-BIT             
         B     DALWRT6D                                                         
DALWRT6C A     RE,=X'00000400'     ADD 1 TO LOW ORDER BIT OF 22-BIT             
DALWRT6D STCM  RE,15,NEXTTRK                                                    
         B     DALWRT8                                                          
*                                                                               
DALWRT7  SR    RE,RE               NORMAL FILE - 16-BIT TRACK NUMBER            
         ICM   RE,3,NEXTTRK                                                     
         LA    RE,1(RE)                                                         
         STH   RE,NEXTTRK          BUMP TO NEXT TRACK                           
*                                                                               
DALWRT8  NI    WRTFLG,255-X'02'    SET UNBLOCKED TRACK WRITTEN                  
         NI    WRTFLG-DALFILED(R8),255-X'02'                                    
         MVC   NEXTTRK-DALFILED(4,R8),NEXTTRK                                   
*                                                                               
DALWRT9  CLI   P1,X'FE'            EXIT IF CALLED TO DO EOF WRITE               
         BL    DALWRT11                                                         
         BE    DALWRT10                                                         
         XC    HIBLK,HIBLK         FORCE INIT NEXT TIME                         
         B     DALDDUX             AND EXIT                                     
*                                                                               
DALWRT10 BAS   R9,CLRBUFF          INITIALISE FOR NEW TRACK FOR X'FE'           
         B     DALDDUX             AND EXIT                                     
*                                                                               
DALWRT11 BAS   R9,CLRBUFF          INITIALISE FOR NEW TRACK                     
         B     DALDDU2             AND START AGAIN                              
*                                                                               
EOFERR   ABEND 102                 DIRECT ACCESS DISK END OF FILE               
*                                                                               
DSKERR   ABEND 104                 DIRECT ACCESS DISK WRITE ERROR               
*                                                                               
LENERR   ABEND 106                 DIRECT ACCESS BAD RECORD LENGTH              
         EJECT                                                                  
***********************************************************************         
*MVS EXCP TO WRITE OUT TRACK FULL OF BLOCKS                           *         
***********************************************************************         
                                                                                
EXCP     XC    IOB,IOB             INITIALISE IOB                               
         MVI   IOB,X'C3'           SET DC/CC/NOTRELATED/NOAPPENDG               
         LA    R1,ECB                                                           
         ST    R1,IOB+4                                                         
         LA    R1,DALCCWS                                                       
         LA    R1,8(R1)            REMOVE LONG SEEK                             
         ST    R1,IOB+16                                                        
         L     R1,DTFADCB          SET DCB ADDR                                 
         STCM  R1,7,IOB+21                                                      
         MVC   IOB+32(8),DTFSEEK   SEEK SAVED IN DTF BY V(DATRNS)               
*                                                                               
EXCP1    LA    R1,IOB              EXECUTE CHANNEL PROGRAM                      
         CLI   WRITESW,C'N'        TEST WRITE=NO                                
         BE    4(R9)               YES - RETURN NORMAL COMPLETION               
         XC    ECB,ECB                                                          
         EXCP  IOB                                                              
         WAIT  ECB=ECB                                                          
*                                                                               
EXCP2    CLI   IOB+4,X'7F'         EXIT IF NORMAL COMPLETION                    
         BE    4(R9)                                                            
         CLI   IOB+4,X'41'         TEST PERMANENT ERROR                         
         BE    EXCP3                                                            
         CLI   IOB+4,X'42'         TEST OUTSIDE EXTENTS                         
         BNE   *+10                                                             
         MVI   P3+1,X'01'          REFERENCE OUTSIDE EXTENTS                    
         BR    R9                                                               
         DC    H'0'                DIE IF HORRIBLE COMPLETION CODE              
*                                                                               
EXCP3    TM    IOB+12,X'02'        TEST CSW UNIT STATUS FOR UNIT CHECK          
         BO    EXCP4                                                            
         TM    IOB+12,X'01'        TEST CSW UNIT STATUS FOR UNIT EXCPN          
         BZ    *+10                                                             
         MVI   P3+1,X'04'          SET EOF                                      
         BR    R9                                                               
         TM    IOB+12,X'FF'        TEST CSW UNIT STATUS                         
         BZ    *+6                                                              
         DC    H'0'                                                             
         TM    IOB+13,X'FF'        TEST CSW CHNL STATUS                         
         BZ    EXCP4                                                            
ERR80    MVI   P1,X'80'            SET UNRECOVERABLE ERROR                      
         BR    R9                  ERROR RETURN                                 
*                                                                               
EXCP4    TM    IOB+2,X'04'         TEST SENSE BYTE 0 ON UNIT CHECK              
         BNZ   ERR80               TRACK OVERRUN                                
         CLI   IOB+2,0                                                          
         BNE   ERR80               UNRECOVERABLE ERROR                          
         TM    IOB+3,X'04'         TEST SENSE BYTE 1 ON UNIT CHECK              
         BZ    *+10                                                             
         MVI   P3+1,X'08'          SET NO RECORD FOUND                          
         BR    R9                                                               
         B     ERR80               UNRECOVERABLE ERROR                          
         EJECT                                                                  
***********************************************************************         
*INITIALISE ALL CONTROL BLOCKS ON FIRST CALL                          *         
***********************************************************************         
                                                                                
INIT     L     R0,BUFFLEN          GET BUFFER                                   
         GETMAIN RU,LV=(0),BNDRY=PAGE                                           
         ST    R1,ABUFFER                                                       
         LTR   RF,RF                                                            
         BZ    INIT1                                                            
         DC    H'0'                CANNOT ACQUIRE BUFFER                        
BUFFLEN  DC    A(8*8000)                                                        
*                                                                               
INIT1    MVC   NEXTTRK,NEXTTRK-DALFILED(R8)                                     
*                                                                               
INIT2    MVI   WRITESW,C'Y'        SET WRITE OPTION                             
         ICM   RF,15,=V(LDWRITE)                                                
         BZ    *+10                                                             
         MVC   WRITESW,0(RF)                                                    
         MVC   DAPL1+12(4),P4      SET A(DTF) IN V(DADDS) PARAM LISTS           
         MVC   DAPL2+12(4),P4                                                   
         MVC   DAPL2+10(2),UNBLKLEN                                             
         GOTO1 =V(DADDS),DAPL2     GET DISK DEVICE DATA AND RECS/TRACK          
         OC    8(2,R1),8(R1)                                                    
         BZ    *+6                                                              
         DC    H'0'                DIE IF CANT COMPUTE RECS/TRACK               
         L     RE,4(R1)                                                         
         MVC   DEVDATA,0(RE)       EXTRACT DEVICE DATA                          
         MVC   HIBLK,10(R1)        EXTRACT RECS/TRK                             
                                                                                
INIT8    MVC   MAXLEN,UNBLKLEN     SET MAXIMUM RECORD LENGTH                    
                                                                                
INIT20   LA    R0,SEEK                                                          
         STCM  R0,7,DALCCWSK+1     SET SEEK ADDR                                
         LA    R0,SECTOR                                                        
         STCM  R0,7,DALCCWSS+1     SET SECTOR ADDR                              
         LA    R0,SRCH                                                          
         STCM  R0,7,DALCCWSE+1     SET SEARCH ADDR                              
         LA    R0,DALCCWSE                                                      
         STCM  R0,7,DALCCWTI+1     SET TIC ADDR                                 
                                                                                
INIT30   LH    R1,HIBLK            BUILD CCWS FOR BLKS ON TRACK                 
         L     R4,ABUFFER          START OF I/O AREA                            
         LH    R5,UNBLKLEN                                                      
         LA    R5,8(R5)            ADD LENGTH OF COUNT FIELD                    
         LA    R6,CCW              START OF CCW CHAIN                           
                                                                                
INIT40   ST    R4,0(R6)            SET BLK ADDRESS                              
         MVI   0(R6),X'1D'         SET WCKD                                     
         OI    4(R6),X'40'         SET COMMAND CHAIN                            
         STH   R5,6(R6)            SET BLK LENGTH                               
         LA    R4,0(R4,R5)         BUMP TO NEXT BLK                             
         LA    R6,8(R6)            BUMP TO NEXT CCW                             
         BCT   R1,INIT40                                                        
                                                                                
INIT50   SH    R6,=H'8'            BACK UP TO LAST                              
         NI    4(R6),X'BF'         TURN OFF CC                                  
         BAS   R9,CLRBUFF          INITIALISE FOR NEW TRACK                     
         B     DALDDU2             BACK TO START                                
         EJECT                                                                  
***********************************************************************         
*SUBROUTINE TO CLEAR BUFFER READY FOR NEW LOGICAL RECORDS             *         
***********************************************************************         
                                                                                
CLRBUFF  L     R0,ABUFFER          INITIALISE TO NULLS                          
         L     R1,BUFFLEN                                                       
         LR    RE,R0                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
CLRBUF1  LA    R4,0                SET NEW BLKNUM=0                             
         STH   R4,BLKNUM                                                        
         MVI   RECNUM,0                                                         
         LA    R4,CCW                                                           
         ST    R4,THISCCW                                                       
         L     R4,0(R4)            GET A(COUNT)                                 
         LA    R4,0(R4)            CLEAR HOB                                    
         ST    R4,BLKADDR                                                       
         AH    R4,UNBLKLEN                                                      
         LA    R4,8(R4)            ADD LENGTH OF COUNT FIELD                    
         ST    R4,BLKADDRX         SET END OF BLK ADDRESS + 1                   
         L     R4,BLKADDR                                                       
         LA    R4,8(R4)                                                         
         ST    R4,NEXTREC          SET INITIAL DATA ADDRESS                     
*                                                                               
CLRBUFX  BR    R9                                                               
                                                                                
DALUADRS DC    A(DALFILU1)                                                      
         DC    A(DALFILU1),A(DALFILU2),A(DALFILU3),A(DALFILU4)                  
DALFADRS DC    V(DALFILE1)                                                      
         DC    V(DALFILE1),V(DALFILE2),V(DALFILE3),V(DALFILE4)                  
                                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*FILE #1 CSECT FOR CONSTANTS AND WORK AREAS                           *         
*THIS AREA IS COVERED BY THE DALFILED DSECT                           *         
***********************************************************************         
                                                                                
DALFILU1 DS    0D                                                               
         DC    CL8'*DAFILU1'       FILE1 LABEL                                  
         DC    XL16'00'            DEVICE DATA                                  
                                                                                
         DC    A(DATRNS),A(0),A(0),A(0),A(NEXTTRK1),A(SRCH1)                    
         DC    A(DARPT),A(0),A(0),A(0)                                          
                                                                                
         DS    0D                                                               
         DC    CL8'*DAIOB1'                                                     
         DC    XL40'00'                                                         
                                                                                
         DS    0D                                                               
         DC    CL8'*DACCWS1'                                                    
         DC    X'0700000040000006' SEEK                                         
         DC    X'2300000040000001' SET SECTOR                                   
         DC    X'3100000040000005' SEARCH ID EQL                                
         DC    X'0800000040000001' TIC                                          
         DC    100XL8'00'                                                       
                                                                                
         DC    XL2'00'             SEEK ADDRESS                                 
SRCH1    DC    XL5'00'                                                          
         DC    XL1'00'                                                          
                                                                                
         DC    F'0'                ECB                                          
         DC    F'0'                                                             
         DC    F'0'                                                             
                                                                                
         DC    H'0'                NUMBER OF BLKS/TRK                           
         DC    H'0'                MAXIMUM LOGICAL RECORD LENGTH                
         DC    H'0'                RECORD LENGTH                                
         DC    H'2'                HEADER LENGTH                                
         DC    XL4'00'             RECORD HEADER                                
                                                                                
         DC    X'00'               THIS LOAD MODE 0=BLOCKED,1=UNBLOCKED         
         DC    X'00'               LAST LOAD MODE                               
         DC    H'0'                UNBLOCKED RECORD LENGTH (FIXED)              
                                                                                
         DC    H'0'                KEY LENGTH FOR COMPRESSION                   
         DC    H'0'                KEY LENGTH -1                                
         DC    C'N'                COMPESSION REQUIRED                          
         DC    C'N'                COMPRESS KEY FROM LEFT                       
         DC    C'N'                COMPRESS KEY FROM RIGHT                      
         DC    C'Y'                NEW BLOCK                                    
         DC    C'Y'                WRITE TO FILE Y/N                            
         DC    XL3'00'                                                          
         DC    H'0'                NUM OF MATCHING LEFT BYTES                   
         DC    H'0'                NUM OF MATCHING RIGHT BYTES                  
         DC    XL64'00'                                                         
         DC    XL64'00'                                                         
                                                                                
NEXTTRK1 DC    X'00000000'         NEXT TRACK DISK ADDR                         
         DC    H'0'                CURRENT BLOCK NUMBER                         
         DC    AL1(0)              CURRENT RECORD NUMBER                        
         DC    X'00'                                                            
                                                                                
         DC    A(0)                CURRENT CCW POINTER                          
         DC    A(0)                CURRENT BLK START                            
         DC    A(0)                CURRENT BLK END + 1                          
         DC    A(0)                NEXT RECORD ADDRESS                          
         DC    A(0)                BUFFER ADDDRESS                              
         EJECT                                                                  
***********************************************************************         
*FILE #2 CSECT FOR CONSTANTS AND WORK AREAS                           *         
*THIS AREA IS COVERED BY THE DALFILED DSECT                           *         
***********************************************************************         
                                                                                
DALFILU2 DS    0D                                                               
         DC    CL8'*DAFILU2'       FILE2 LABEL                                  
         DC    XL16'00'            DEVICE DATA                                  
                                                                                
         DC    A(DATRNS),A(0),A(0),A(0),A(NEXTTRK2),A(SRCH2)                    
         DC    A(DARPT),A(0),A(0),A(0)                                          
                                                                                
         DS    0D                                                               
         DC    CL8'*DAIOB2'                                                     
         DC    XL40'00'                                                         
                                                                                
         DS    0D                                                               
         DC    CL8'*DACCWS2'                                                    
         DC    X'0700000040000006' SEEK                                         
         DC    X'2300000040000001' SET SECTOR                                   
         DC    X'3100000040000005' SEARCH ID EQL                                
         DC    X'0800000040000001' TIC                                          
         DC    100XL8'00'                                                       
                                                                                
         DC    XL2'00'             SEEK ADDRESS                                 
SRCH2    DC    XL5'00'                                                          
         DC    XL1'00'                                                          
                                                                                
         DC    F'0'                ECB                                          
         DC    F'0'                                                             
         DC    F'0'                                                             
                                                                                
         DC    H'0'                NUMBER OF BLKS/TRK                           
         DC    H'0'                MAXIMUM LOGICAL RECORD LENGTH                
         DC    H'0'                RECORD LENGTH                                
         DC    H'2'                HEADER LENGTH                                
         DC    XL4'00'             RECORD HEADER                                
                                                                                
         DC    X'00'               THIS LOAD MODE 0=BLOCKED,1=UNBLOCKED         
         DC    X'00'               LAST LOAD MODE                               
         DC    H'0'                UNBLOCKED RECORD LENGTH (FIXED)              
                                                                                
         DC    H'0'                KEY LENGTH FOR COMPRESSION                   
         DC    H'0'                KEY LENGTH -1                                
         DC    C'N'                COMPESSION REQUIRED                          
         DC    C'N'                COMPRESS KEY FROM LEFT                       
         DC    C'N'                COMPRESS KEY FROM RIGHT                      
         DC    C'Y'                NEW BLOCK                                    
         DC    C'Y'                WRITE TO FILE Y/N                            
         DC    XL3'00'                                                          
         DC    H'0'                NUM OF MATCHING LEFT BYTES                   
         DC    H'0'                NUM OF MATCHING RIGHT BYTES                  
         DC    XL64'00'                                                         
         DC    XL64'00'                                                         
                                                                                
NEXTTRK2 DC    X'00000000'         NEXT TRACK DISK ADDR                         
         DC    H'0'                CURRENT BLOCK NUMBER                         
         DC    AL1(0)              CURRENT RECORD NUMBER                        
         DC    X'00'                                                            
                                                                                
         DC    A(0)                CURRENT CCW POINTER                          
         DC    A(0)                CURRENT BLK START                            
         DC    A(0)                CURRENT BLK END + 1                          
         DC    A(0)                NEXT RECORD ADDRESS                          
         DC    A(0)                BUFFER ADDDRESS                              
         EJECT                                                                  
***********************************************************************         
*FILE #3 CSECT FOR CONSTANTS AND WORK AREAS                           *         
*THIS AREA IS COVERED BY THE DALFILED DSECT                           *         
***********************************************************************         
                                                                                
DALFILU3 DS    0D                                                               
         DC    CL8'*DAFILU3'       FILE3 LABEL                                  
         DC    XL16'00'            DEVICE DATA                                  
                                                                                
         DC    A(DATRNS),A(0),A(0),A(0),A(NEXTTRK3),A(SRCH3)                    
         DC    A(DARPT),A(0),A(0),A(0)                                          
                                                                                
         DS    0D                                                               
         DC    CL8'*DAIOB3'                                                     
         DC    XL40'00'                                                         
                                                                                
         DS    0D                                                               
         DC    CL8'*DACCWS3'                                                    
         DC    X'0700000040000006' SEEK                                         
         DC    X'2300000040000001' SET SECTOR                                   
         DC    X'3100000040000005' SEARCH ID EQL                                
         DC    X'0800000040000001' TIC                                          
         DC    100XL8'00'                                                       
                                                                                
         DC    XL2'00'             SEEK ADDRESS                                 
SRCH3    DC    XL5'00'                                                          
         DC    XL1'00'                                                          
                                                                                
         DC    F'0'                ECB                                          
         DC    F'0'                                                             
         DC    F'0'                                                             
                                                                                
         DC    H'0'                NUMBER OF BLKS/TRK                           
         DC    H'0'                MAXIMUM LOGICAL RECORD LENGTH                
         DC    H'0'                RECORD LENGTH                                
         DC    H'2'                HEADER LENGTH                                
         DC    XL4'00'             RECORD HEADER                                
                                                                                
         DC    X'00'               THIS LOAD MODE 0=BLOCKED,1=UNBLOCKED         
         DC    X'00'               LAST LOAD MODE                               
         DC    H'0'                UNBLOCKED RECORD LENGTH (FIXED)              
                                                                                
         DC    H'0'                KEY LENGTH FOR COMPRESSION                   
         DC    H'0'                KEY LENGTH -1                                
         DC    C'N'                COMPESSION REQUIRED                          
         DC    C'N'                COMPRESS KEY FROM LEFT                       
         DC    C'N'                COMPRESS KEY FROM RIGHT                      
         DC    C'Y'                NEW BLOCK                                    
         DC    C'Y'                WRITE TO FILE Y/N                            
         DC    XL3'00'                                                          
         DC    H'0'                NUM OF MATCHING LEFT BYTES                   
         DC    H'0'                NUM OF MATCHING RIGHT BYTES                  
         DC    XL64'00'                                                         
         DC    XL64'00'                                                         
                                                                                
NEXTTRK3 DC    X'00000000'         NEXT TRACK DISK ADDR                         
         DC    H'0'                CURRENT BLOCK NUMBER                         
         DC    AL1(0)              CURRENT RECORD NUMBER                        
         DC    X'00'                                                            
                                                                                
         DC    A(0)                CURRENT CCW POINTER                          
         DC    A(0)                CURRENT BLK START                            
         DC    A(0)                CURRENT BLK END + 1                          
         DC    A(0)                NEXT RECORD ADDRESS                          
         DC    A(0)                BUFFER ADDDRESS                              
         EJECT                                                                  
***********************************************************************         
*FILE #4 CSECT FOR CONSTANTS AND WORK AREAS                           *         
*THIS AREA IS COVERED BY THE DALFILED DSECT                           *         
***********************************************************************         
                                                                                
DALFILU4 DS    0D                                                               
         DC    CL8'*DAFILU4'       FILE4 LABEL                                  
         DC    XL16'00'            DEVICE DATA                                  
                                                                                
         DC    A(DATRNS),A(0),A(0),A(0),A(NEXTTRK4),A(SRCH4)                    
         DC    A(DARPT),A(0),A(0),A(0)                                          
                                                                                
         DS    0D                                                               
         DC    CL8'*DAIOB4'                                                     
         DC    XL40'00'                                                         
                                                                                
         DS    0D                                                               
         DC    CL8'*DACCWS4'                                                    
         DC    X'0700000040000006' SEEK                                         
         DC    X'2300000040000001' SET SECTOR                                   
         DC    X'3100000040000005' SEARCH ID EQL                                
         DC    X'0800000040000001' TIC                                          
         DC    100XL8'00'                                                       
                                                                                
         DC    XL2'00'             SEEK ADDRESS                                 
SRCH4    DC    XL5'00'                                                          
         DC    XL1'00'                                                          
                                                                                
         DC    F'0'                ECB                                          
         DC    F'0'                                                             
         DC    F'0'                                                             
                                                                                
         DC    H'0'                NUMBER OF BLKS/TRK                           
         DC    H'0'                MAXIMUM LOGICAL RECORD LENGTH                
         DC    H'0'                RECORD LENGTH                                
         DC    H'2'                HEADER LENGTH                                
         DC    XL4'00'             RECORD HEADER                                
                                                                                
         DC    X'00'               THIS LOAD MODE 0=BLOCKED,1=UNBLOCKED         
         DC    X'00'               LAST LOAD MODE                               
         DC    H'0'                UNBLOCKED RECORD LENGTH (FIXED)              
                                                                                
         DC    H'0'                KEY LENGTH FOR COMPRESSION                   
         DC    H'0'                KEY LENGTH -1                                
         DC    C'N'                COMPESSION REQUIRED                          
         DC    C'N'                COMPRESS KEY FROM LEFT                       
         DC    C'N'                COMPRESS KEY FROM RIGHT                      
         DC    C'Y'                NEW BLOCK                                    
         DC    C'Y'                WRITE TO FILE Y/N                            
         DC    XL3'00'                                                          
         DC    H'0'                NUM OF MATCHING LEFT BYTES                   
         DC    H'0'                NUM OF MATCHING RIGHT BYTES                  
         DC    XL64'00'                                                         
         DC    XL64'00'                                                         
                                                                                
NEXTTRK4 DC    X'00000000'         NEXT TRACK DISK ADDR                         
         DC    H'0'                CURRENT BLOCK NUMBER                         
         DC    AL1(0)              CURRENT RECORD NUMBER                        
         DC    X'00'                                                            
                                                                                
         DC    A(0)                CURRENT CCW POINTER                          
         DC    A(0)                CURRENT BLK START                            
         DC    A(0)                CURRENT BLK END + 1                          
         DC    A(0)                NEXT RECORD ADDRESS                          
         DC    A(0)                BUFFER ADDDRESS                              
         EJECT                                                                  
***********************************************************************         
*DSECT TO COVER CONSTANTS AND WORK AREAS FOR AN INDIVIDUAL FILE       *         
***********************************************************************         
                                                                                
DALFILED DSECT                                                                  
FILEID   DS    CL8                                                              
DEVDATA  DS    0CL16                                                            
DEVTYP   DS    X                                                                
DEVSUB   DS    X                                                                
DEVTRKS  DS    H                                                                
DEVIRG   DS    H                                                                
DEVCAPL  DS    H                                                                
DEVCAPP  DS    H                                                                
DEVRZERO DS    H                                                                
DEVSCT   DS    H                                                                
DEVMOD   DS    H                                                                
                                                                                
DAPL1    DC    A(DATRNS),A(0),A(0),A(0),A(NEXTTRK),A(SRCH)                      
DAPL2    DC    A(DARPT),A(0),A(0),A(0)                                          
                                                                                
         DS    0D                                                               
         DC    CL8'*DAIOBN'                                                     
IOB      DC    XL40'00'                                                         
                                                                                
         DS    0D                                                               
         DC    CL8'DACCWS1'                                                     
DALCCWS  DS    0D                                                               
DALCCWSK DC    X'0700000040000006'      SEEK                                    
DALCCWSS DC    X'2300000040000001'      SET SECTOR                              
DALCCWSE DC    X'3100000040000005'      SEARCH ID EQL                           
DALCCWTI DC    X'0800000040000001'      TIC                                     
CCW      DC    100XL8'00'                                                       
                                                                                
SEEK     DS    0XL8                                                             
         DS    XL2                                                              
SRCH     DS    0XL5                                                             
SKCYL    DS    XL2                                                              
SKTRK    DS    XL2                                                              
SKREC    DS    XL1                                                              
         DS    XL1                                                              
                                                                                
ECB      DC    F'0'                                                             
         DC    F'0'                                                             
SECTOR   DC    F'0'                                                             
                                                                                
HIBLK    DC    H'0'                NUMBER OF BLKS/TRK                           
MAXLEN   DC    H'0'                MAXIMUM LOGICAL RECORD LENGTH                
RECLEN   DC    H'0'                RECORD LENGTH                                
HDRLEN   DC    H'2'                                                             
RECHDR   DC    XL4'00'                                                          
                                                                                
THISMODE DC    XL1'00'             0=BLOCKED,1=UNBLOCKED                        
LASTMODE DC    XL1'00'                                                          
UNBLKLEN DC    H'0'                LENGTH OF UNBLOCKED RECORDS                  
                                                                                
KEYLEN   DC    H'0'                KEY LENGTH FOR COMPRESSION                   
KEYLEN1  DC    H'0'                KEY LENGTH -1                                
COMPRESS DC    C'N'                COMPESSION REQUIRED                          
LEFT     DC    C'N'                COMPRESS KEY FROM LEFT                       
RIGHT    DC    C'N'                COMPRESS KEY FROM RIGHT                      
NEWBLOCK DC    C'Y'                NEW BLOCK                                    
WRITESW  DC    C'Y'                WRITE TO FILE Y/N                            
         DC    XL3'00'             N/D                                          
SAMEL    DC    H'0'                NUM OF MATCHING LEFT BYTES                   
SAMER    DC    H'0'                NUM OF MATCHING RIGHT BYTES                  
THISKEY  DC    XL64'00'                                                         
LASTKEY  DC    XL64'00'                                                         
                                                                                
NEXTTRK  DC    X'00010000'         NEXT TRACK DISK ADDR                         
BLKNUM   DC    H'0'                CURRENT BLOCK NUMBER                         
RECNUM   DC    AL1(0)              CURRENT RECORD NUMBER                        
WRTFLG   DC    X'00'               WRITE FLAG 01=BLOCKED,02=UNBLOCKED           
                                                                                
THISCCW  DS    A                   CURRENT CCW POINTER                          
BLKADDR  DS    A                   CURRENT BLK START                            
BLKADDRX DS    A                   CURRENT BLK END + 1                          
NEXTREC  DS    A                   NEXT RECORD ADDRESS                          
ABUFFER  DS    A                   BUFFER ADDRESS (VIA GETMAIN)                 
                                                                                
PARAMS   DSECT                                                                  
P1       DS    A                                                                
P2       DS    A                                                                
P3       DS    F                                                                
P4       DS    A                                                                
P5       DS    F                                                                
P6       DS    F                                                                
         EJECT                                                                  
*DMDTFPH                                                                        
       ++INCLUDE DMDTFPH                                                        
         EJECT                                                                  
*DMGREQUS                                                                       
       ++INCLUDE DMGREQUS                                                       
                                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'003DMDALDDU  04/20/12'                                      
         END                                                                    

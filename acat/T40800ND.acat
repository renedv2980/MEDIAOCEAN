*          DATA SET T40800ND   AT LEVEL 071 AS OF 05/01/02                      
*CATALP T40800ND                                                                
T40800   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 1700,T40800                                                      
         USING GENOLD,RC                                                        
         USING T408FFD,RA                                                       
         SPACE 2                                                                
         BAS   RE,INITL                                                         
         RELOC RELO                                                             
*                                                                               
         XC    CMTMSG,CMTMSG                                                    
         FOUT  CMTMSGH                                                          
*                                                                               
         L     RF,=V(NODIO)                                                     
         A     RF,RELO                                                          
         ST    RF,NODIO                                                         
         L     RF,=V(RECUP)                                                     
         A     RF,RELO                                                          
         ST    RF,RECUP                                                         
         L     RF,=V(HEXIN)                                                     
         A     RF,RELO                                                          
         ST    RF,HEXIN                                                         
         L     RF,=V(HEXOUT)                                                    
         A     RF,RELO                                                          
         ST    RF,HEXOUT                                                        
         L     RF,=V(TSCAN)                                                     
         A     RF,RELO                                                          
         ST    RF,TSCAN                                                         
*                                                                               
         LA    R2,CMTCM7H                                                       
         LA    R0,10                                                            
MP2      DS    0H                                                               
         XC    8(70,R2),8(R2)                                                   
         FOUT  (R2)                                                             
         LA    R2,78(R2)                                                        
         BCT   R0,MP2                                                           
         LA    R4,NDWKA                                                         
         USING NODBLKD,R4                                                       
*                                                                               
         CLI   FIRSTSW,0                                                        
         BNE   MP2D                                                             
*                                                                               
         LA    RE,NDWKA                                                         
         LH    RF,=Y(NDWKL)                                                     
         XCEF                                                                   
*                                                                               
         MVI   FIRSTSW,1                                                        
         MVC   NDKEY(2),=X'030D'                                                
         MVC   NDKLEN,=H'25'                                                    
         MVC   NDCNTL,=H'27'                                                    
         MVC   NDELSTRT,=H'33'                                                  
         MVC   NDRLEN,=H'25'                                                    
         MVC   NDRMAX,=H'1976'                                                  
         MVC   NDDISK,=H'27'                                                    
         MVC   NDDIRNAM,=C'PUBDIR  '                                            
         MVC   NDFILNAM,=C'PUBFILE '                                            
         MVC   NDDMGR,VDATAMGR                                                  
         MVI   NDMXLEVS,6                                                       
*                                                                               
MP2D     DS    0H                                                               
         MVC   NDHEXOUT,HEXOUT                                                  
         MVC   NDRECUP,RECUP                                                    
         MVC   NDTSCAN,TSCAN                                                    
         XC    NDSETDSC,NDSETDSC                                                
         XC    NDSETACD,NDSETACD                                                
         XC    NDSETAND,NDSETAND                                                
         LA    RF,AIO1                                                          
         ST    RF,NDIOA                                                         
         LA    RF,L'AIO1(RF)                                                    
         ST    RF,NDIOA2                                                        
*                                                                               
         XC    OPARS(24),OPARS                                                  
         LA    RF,CMTCM8H+8                                                     
         ST    RF,NXTSEQ                                                        
         MVI   NSEQS,0                                                          
         MVI   NSQDSP,0                                                         
         MVI   SKIPLV,9                                                         
*                                                                               
         LA    R2,CMTCM1H                                                       
         LA    R0,6                                                             
MP3      DS    0H                                                               
         BAS   RE,EDLIN                                                         
         CLI   ERR,0                                                            
         BE    MP3B                                                             
         ZIC   R3,ERR                                                           
         B     ERROR                                                            
MP3B     DS    0H                                                               
         LA    R2,78(R2)                                                        
         BCT   R0,MP3                                                           
         LA    R2,CMTCM1H                                                       
*                                                                               
         B     EXIT                                                             
         SPACE 3                                                                
EDLIN    NTR1                                                                   
         MVI   ERR,0                                                            
         LA    RF,77(R2)                                                        
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
*                                                                               
         LA    R0,7(R2)                                                         
         SR    RF,R0                                                            
         STC   RF,5(R2)                                                         
         BNM   *+8                                                              
         MVI   5(R2),0                                                          
*                                                                               
         CLI   5(R2),0                                                          
         BE    EDLX                                                             
*                                                                               
EDL4     DS    0H                                                               
         CLI   8(R2),C'*'          IGNORE IF *                                  
         BE    EDLX                                                             
*                                                                               
         CLC   =C'C=',8(R2)                                                     
         BNE   EDL6                                                             
*                                                                               
         CLC   =C'TRACE',10(R2)                                                 
         BE    EDL5M                                                            
*                                                                               
         CLC   =C'ADD',10(R2)      FOR ADD-CLEAR REC LEN                        
         BNE   EDL4A                                                            
         L     RF,NDIOA                                                         
         AH    RF,NDRLEN                                                        
         XC    0(2,RF),0(RF)                                                    
*                                                                               
EDL4A    DS    0H                                                               
         CLC   =C'ADX',10(R2)      CHANGE ADX TO ADD                            
         BNE   *+10                                                             
         MVC   10(3,R2),=C'ADD'                                                 
         LA    RF,14(R2)                                                        
         CLI   0(RF),C'0'         TEST FOLLOWING NUMBER                         
         BNL   EDL4A2                                                           
         LA    RF,15(R2)                                                        
         CLI   0(RF),C'0'         TEST FOLLOWING NUMBER                         
         BL    EDL4B                                                            
EDL4A2   MVC   NDSQHILV,0(RF)                                                   
         NI    NDSQHILV,X'0F'                                                   
*                                                                               
EDL4B    DS    0H                                                               
*                                                                               
EDL4D    DS    0H                                                               
         LA    R5,NODROUT                                                       
         ST    R5,NDHOOK                                                        
         GOTO1 NODIO,OPARS,NODBLKD,(POSPOS,10(R2)),KEY                          
*                                                                               
         SR    R5,R5                                                            
         BAS   RE,HXPRT                                                         
         B     EDLX                                                             
*                                                                               
NODROUT  NTR1                                                                   
         CLC   =C'SEQ',10(R2)                                                   
         BE    EDL5                                                             
         CLC   =C'LSEQ',10(R2)                                                  
         BE    EDL5                                                             
         CLC   =C'BSEQ',10(R2)                                                  
         BE    EDL5                                                             
         B     NODRX                                                            
*                                                                               
EDL5     DS    0H                  SPECIAL FOR ALL SEQS                         
         CLI   NDERR,0                                                          
         BE    EDL5A                                                            
*                                                                               
         CLI   NSEQS,NSQLNS*3      TEST NO MORE ROOM                            
         BL    EDL5A0                                                           
         MVI   NDMODE,NDEND                                                     
         B     NODRX                                                            
*                                                                               
EDL5A0   DS    0H                                                               
         GOTO1 HEXOUT,DMCB,NDLEV,OUTLIN,3                                       
         L     R6,NXTSEQ                                                        
         XC    0(21,R6),0(R6)                                                   
         MVC   0(17,R6),=C'LEVEL=XX,ERROR=XX'                                   
         MVC   6(2,R6),OUTLIN                                                   
         MVC   15(2,R6),OUTLIN+4                                                
         B     EDL5E                                                            
*                                                                               
EDL5A    DS    0H                                                               
         CLI   NDMODE,NDFRST                                                    
         BNE   EDL5D4                                                           
         MVI   NDSKIP,C'N'                                                      
         ZIC   RF,NDLEV                                                         
         LA    RF,1(RF)                                                         
         STC   RF,BYTE                                                          
         CLC   BYTE,SKIPLV                                                      
         BNE   *+8                                                              
         MVI   NDSKIP,C'Y'                                                      
         B     NODRX                                                            
*                                                                               
EDL5D4   DS    0H                                                               
         CLI   NDMODE,NDPROC                                                    
         BNE   NODRX                                                            
*                                                                               
         CLI   NSEQS,NSQLNS*3      TEST NO MORE ROOM                            
         BL    EDL5D6                                                           
         MVI   NDMODE,NDEND                                                     
         B     NODRX                                                            
*                                                                               
EDL5D6   DS    0H                                                               
         L     R6,NXTSEQ                                                        
         XC    0(21,R6),0(R6)                                                   
         CLI   NDCKEYL,0                                                        
         BE    EDL5E                                                            
         ZIC   RF,NDCKEYL                                                       
         CLI   NDCKEYL,20                                                       
         BNH   *+8                                                              
         LA    RF,20                                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R6),KEY                                                      
*                                                                               
EDL5E    DS    0H                                                               
         ZIC   RF,NSEQS                                                         
         LA    RF,1(RF)                                                         
         STC   RF,NSEQS                                                         
         CLI   NSEQS,NSQLNS                                                     
         BE    EDL5F                                                            
         CLI   NSEQS,NSQLNS*2                                                   
         BE    EDL5F                                                            
*                                                                               
         LA    R6,78(R6)                                                        
         ST    R6,NXTSEQ                                                        
         B     NODRX                                                            
*                                                                               
EDL5F    DS    0H                                                               
         LA    R6,CMTCM8H+8                                                     
         ZIC   R5,NSQDSP                                                        
         LA    R5,21(R5)                                                        
         STC   R5,NSQDSP                                                        
         AR    R6,R5                                                            
         ST    R6,NXTSEQ                                                        
         B     NODRX                                                            
*                                                                               
NODRX    XIT1                                                                   
*                                                                               
EDL5M    DS    0H                  TRACE                                        
         GOTO1 NODIO,OPARS,NODBLKD,10(R2),KEY                                   
         SR    R5,R5                                                            
         BAS   RE,HXPRT                                                         
         XC    CMTCM8H+8(70),CMTCM8H+8                                          
         FOUT  CMTCM8H                                                          
         CLI   NDCKEYL,0                                                        
         BE    EDLX                                                             
         ZIC   RF,NDCKEYL                                                       
         CLI   NDCKEYL,20                                                       
         BNH   *+8                                                              
         LA    RF,20                                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CMTCM8H+8(0),KEY                                                 
         B     EDLX                                                             
*                                                                               
EDL6     DS    0H                                                               
         CLC   =C'K=',8(R2)                                                     
         BNE   EDL7                                                             
         MVC   KEY,10(R2)                                                       
         B     EDLX                                                             
*                                                                               
EDL7     DS    0H                                                               
         CLC   =C'SKIP=',8(R2)                                                  
         BNE   EDL8                                                             
         MVC   SKIPLV,13(R2)                                                    
         NI    SKIPLV,X'0F'                                                     
         B     EDLX                                                             
*                                                                               
EDL8     DS    0H                                                               
EDL9     DS    0H                                                               
         CLC   =C'ATT=',8(R2)                                                   
         BNE   EDL10                                                            
         LA    R6,12(R2)                                                        
         LA    R5,8                                                             
         BAS   RE,HXIN                                                          
         MVC   NDSETAND,HXLIN                                                   
         MVC   NDSETACD,21(R2)                                                  
         CLC   =C'FF',NDSETACD                                                  
         BNE   *+8                                                              
         MVI   NDSETACD,X'FF'      SET TO NONE                                  
         B     EDLX                                                             
*                                                                               
EDL10    DS    0H                                                               
         CLC   =C'DSC=',8(R2)                                                   
         BNE   EDL12                                                            
         MVC   NDSETDSC,12(R2)                                                  
         B     EDLX                                                             
*                                                                               
EDL12    DS    0H                                                               
         CLC   =C'POS',8(R2)       POSITION CONTROL- PARAM 4                    
         BNE   EDL13                                                            
         MVI   POSPOS,0                                                         
         CLC   =C'END',12(R2)      FOR END NO PARAM 4                           
         BE    EDLX                                                             
         SR    R5,R5                                                            
         CLC   =C'START',12(R2)                                                 
         BNE   EDL12F                                                           
         XC    ADDPOS,ADDPOS                                                    
         B     EDL12M                                                           
*                                                                               
EDL12F   DS    0H                  B,CODE OR A,CODE                             
         MVC   ADDPOS,14(R2)                                                    
         CLI   ADDPOS,C' '                                                      
         BNH   EDLERR                                                           
         ZIC   R5,5(R2)                                                         
         SH    R5,=H'6'                                                         
         MVC   POSPOS,12(R2)       B(BEFORE) OR A(AFTER)                        
         CLI   POSPOS,C'A'                                                      
         BE    EDL12M                                                           
         CLI   POSPOS,C'B'                                                      
         BNE   EDLERR                                                           
*                                                                               
EDL12M   DS    0H                                                               
         LA    RF,ADDPOS                                                        
         ST    RF,OPARS+12                                                      
         STC   R5,OPARS+12         LENGTH IN PARAM4                             
         B     EDLX                                                             
*                                                                               
EDL13    DS    0H                                                               
         CLC   =C'NEW',8(R2)       NEW FOR RENAME                               
         BNE   EDL14                                                            
         LA    RF,12(R2)           SET ADDRESS IN PARAM LIST                    
         ZIC   R5,5(R2)                                                         
         SH    R5,=H'4'                                                         
         ST    RF,OPARS+12                                                      
         STC   R5,OPARS+12                                                      
         B     EDLX                                                             
*                                                                               
EDL14    DS    0H                                                               
         CLC   =C'OUT',8(R2)                                                    
         BNE   EDL15                                                            
         L     R6,NDIOA                                                         
         CLI   12(R2),C' '                                                      
         BNH   EDL14B                                                           
         CLI   12(R2),C'1'                                                      
         BE    *+8                                                              
         L     R6,NDIOA2                                                        
EDL14B   DS    0H                                                               
         LR    RF,R6                                                            
         AH    RF,NDRLEN                                                        
         LH    R5,0(RF)                                                         
         BAS   RE,HXPRT                                                         
         B     EDLX                                                             
*                                                                               
EDL15    DS    0H                                                               
EDL16    DS    0H                                                               
         CLC   =C'DUMP',8(R2)      DUMP                                         
         BNE   EDL18                                                            
         MVC   NDDUMP,13(R2)                                                    
         B     EDLX                                                             
*                                                                               
EDL18    DS    0H                                                               
         CLC   =C'MAST',8(R2)      NEW MASTER KEY                               
         BNE   EDL19                                                            
         LA    R6,13(R2)                                                        
         LA    R5,4                                                             
         BAS   RE,HXIN                                                          
         MVC   NDKEY(2),HXLIN                                                   
         MVI   NDOPENSW,C'N'                                                    
         B     EDLX                                                             
*                                                                               
EDL19    DS    0H                                                               
EDL22    DS    0H                                                               
         CLC   =C'XX',8(R2)                                                     
         BNE   EDL28                                                            
         DC    H'0'                                                             
*                                                                               
EDL28    DS    0H                                                               
EDLERR   DS    0H                                                               
         MVI   ERR,2                                                            
EDLX     DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
HXPRT    NTR1                                                                   
         XC    OUTLIN(250),OUTLIN                                               
         XC    OUTLIN+250(250),OUTLIN+250                                       
         XC    OUTLIN+500(60),OUTLIN+500                                        
         LA    R7,CMTCM7H+8                                                     
         ZIC   R3,NDLEV                                                         
         MH    R3,=Y(NDLVTABL)                                                  
         LA    R3,NDLVTAB(R3)                                                   
         USING NDLVTABD,R3                                                      
         GOTO1 HEXOUT,DMCB,NDLVDA,OUTLIN,4                                      
         DROP  R3                                                               
         MVC   0(3,R7),=C'DA='                                                  
         MVC   3(8,R7),OUTLIN                                                   
         GOTO1 HEXOUT,DMCB,NDLEV,OUTLIN,3                                       
         LA    R7,13(R7)                                                        
         MVC   0(25,R7),=C'LEVEL=XX,MODE=XX,ERROR=XX'                           
         MVC   6(2,R7),OUTLIN                                                   
         MVC   14(2,R7),OUTLIN+2                                                
         MVC   23(2,R7),OUTLIN+4                                                
         MVC   26(25,R7),NDERRMSG                                               
*                                                                               
         LTR   R5,R5                                                            
         BNP   HXPX                                                             
         CH    R5,=Y(L'OUTLIN/2)                                                
         BNH   *+8                                                              
         LA    R5,L'OUTLIN/2                                                    
         LA    RE,OUTLIN                                                        
         LA    RF,L'OUTLIN                                                      
         XCEF                                                                   
         GOTO1 HEXOUT,DMCB,(R6),OUTLIN,(R5),=C'N'                               
         LA    R4,OUTLIN                                                        
         LA    R3,CMTCM8H+8                                                     
         LA    R0,8                                                             
HXP5     DS    0H                                                               
         MVC   0(70,R3),0(R4)                                                   
         LA    R3,78(R3)                                                        
         LA    R4,70(R4)                                                        
         FOUT (R3)                                                              
         BCT   R0,HXP5                                                          
*                                                                               
HXPX     DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
HXIN     NTR1                                                                   
         XC    HXLIN,HXLIN                                                      
         GOTO1 HEXIN,DMCB,(R6),HXLIN,(R5)                                       
         SR    R0,R0                                                            
         OC    DMCB+12(4),DMCB+12                                               
         BZ    HXIN2                                                            
         SR    R0,R0                                                            
         B     *+6                                                              
HXIN2    DS    0H                                                               
         LTR   RE,RE                                                            
         XIT1                                                                   
         SPACE 3                                                                
NUMIN    NTR1                                                                   
         XC    FULL,FULL                                                        
         SH    R5,=H'1'                                                         
         BM    NUMX                                                             
         EX    R5,*+8                                                           
         B     *+10                                                             
         PACK  DUB,0(0,R6)                                                      
         CVB   R0,DUB                                                           
         ST    R0,FULL                                                          
         SR    R0,R0                                                            
NUMX     DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
         EJECT                                                                  
*                  INITIALISATION CODE                                          
         SPACE 3                                                                
INITL    LR    R4,RC               SET UP TO CLEAR WORK SPACE                   
         LR    R5,RD                                                            
         SR    R5,R4                                                            
         LR    R0,RE                                                            
         BAS   RE,CLEARWRK                                                      
         LM    R2,R4,0(R1)                                                      
         PACK  AGYNUM,0(1,R1)      AGENCY NUMBER                                
         LH    R5,0(R2)                                                         
         AR    R5,R3                                                            
         ST    R5,FRSTFLD .        A(FIRST INPUT FIELD HEADER)                  
         LH    R5,2(R2)                                                         
         AR    R5,R3                                                            
         ST    R5,LASTFLD .        A(LAST INPUT FIELD)                          
         MVC   NUMFLD,4(R2) .      NUMBER OF FIELDS                             
         ST    R3,VTWA .           A(TWA)                                       
         MVC   VDATAMGR(36),0(R4)  FACILITY LIST                                
         LR    RA,R3                                                            
         MVC   TERMNAL,0(RA) .     TERMINAL NUMBER                              
         MVC   AGYALPHA,14(RA)     ALPHA AGENCY CODE                            
         LA    R3,64(R3)                                                        
         ST    R3,ERRAREA          PRESET ERRAREA TO A(FIRST HEADER)            
         MVI   DMINBTS,X'C0'       PRESET DATAMGR CONTROL BITS                  
         MVI   DMOUTBTS,X'FD'      PRESET DATAMGR ERROR CHECK BITS              
         LR    RE,R0                                                            
         BR    RE                                                               
         SPACE 2                                                                
CLEARWRK LTR   R5,R5               CLEAR STORAGE TO ZEROS                       
         BCR   8,RE                                                             
         CH    R5,=H'250'                                                       
         BNH   CLEAREST                                                         
         XC    0(250,R4),0(R4)                                                  
         LA    R4,250(R4)                                                       
         SH    R5,=H'250'                                                       
         B     CLEARWRK                                                         
         SPACE 2                                                                
CLEAREST BCTR  R5,R0                                                            
         EX    R5,VARCLEAR                                                      
         BR    RE                                                               
         SPACE 2                                                                
VARCLEAR XC    0(0,R4),0(R4)                                                    
         EJECT                                                                  
*                  FARMABLE CODE                                                
         SPACE 3                                                                
ANY      CLI   5(R2),0                                                          
         BNE   ANY2                                                             
         LA    R3,1                                                             
         B     ERROR                                                            
         SPACE 2                                                                
ANY2     TM    4(R2),X'10' .       IS IT VALID NUMERIC                          
         BCR   8,RE .              IF APPLICABLE                                
         LA    R3,3                                                             
         B     ERROR                                                            
*                  EXITS FROM PROGRAM                                           
         SPACE 3                                                                
LOCK     OI    6(R2),X'02'         LOCK SCREEN                                  
         SPACE 2                                                                
ERROR    L     R4,ERRAREA                                                       
         MVI   ERRAREA,X'FF'                                                    
         MVC   DMCB+20(4),VDATAMGR                                              
         MVC   DMCB+20(1),TERMNAL                                               
         GOTO1 VGETMSG,DMCB+12,((R3),8(R4)),(4,DMCB)                            
         SPACE 2                                                                
EXIT     OI    6(R2),OI1C .        INSERT CURSOR                                
         L     R4,ERRAREA                                                       
         FOUT  (R4)                                                             
*                                                                               
*                                                                               
EXXMOD   DS    0H                                                               
         XMOD1 1                                                                
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
         SPACE 2                                                                
*                                                                               
HXLIN    DS    CL35                                                             
OUTLIN   DS    CL560                                                            
*                                                                               
         ORG   T40800+4070                                                      
         DC    X'0000'                                                          
*                                                                               
       ++INCLUDE FLDIND                                                         
*                                                                               
       ++INCLUDE GENOLD                                                         
         SPACE 2                                                                
RELO     DS    F                                                                
OPARS    DS    XL24                                                             
AORWK    DS    A                                                                
ADDPOS   DS    XL10                                                             
POSPOS   DS    C                                                                
ERR      DS    X                                                                
SKIPLV   DS    X                                                                
NSQLNS   EQU   9                                                                
NXTSEQ   DS    A                                                                
NSEQS    DS    X                                                                
NSQDSP   DS    X                                                                
HEXIN    DS    A                                                                
HEXOUT   DS    A                                                                
RECUP    DS    A                                                                
TSCAN    DS    A                                                                
NODIO    DS    A                                                                
TMPWRKX  DS    X                                                                
         ORG                                                                    
*                                                                               
         EJECT                                                                  
*                                                                               
       ++INCLUDE T408FFD                                                        
*                                                                               
FIRSTSW  DS    X                                                                
NDWKA    DS    0D                                                               
         ORG   *+NODBLKL                                                        
NDTAB    DS    0X                                                               
         ORG   *+8*NDLVTABL                                                     
NDWKL    EQU   *-NDWKA                                                          
AIO1     DS    XL250                                                            
AIO2     DS    XL250                                                            
TWAX     EQU   *                                                                
*                                                                               
CMTCM7H  EQU   CMTCM1H+(78*6)                                                   
CMTCM8H  EQU   CMTCM7H+78                                                       
CMTCM9H  EQU   CMTCM8H+78                                                       
         EJECT                                                                  
       ++INCLUDE NODBLKD                                                        
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'071T40800ND  05/01/02'                                      
         END                                                                    

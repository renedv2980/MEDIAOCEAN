*          DATA SET PTXBROTS   AT LEVEL 023 AS OF 01/28/19                      
*CATALP PTXBROTS                                                                
         TITLE 'EXTRACT ROUTINES FOR PRINTXTRACT'                               
**********************************************************************          
*  ID  LVL   DATE    TICKET            COMMENTS                      *          
* ---- --- ------- ------------ -------------------------------------*          
* JSAY 001 13DEC18 <SPEC-30370> BLOCKCHAIN PRINT EXTRACT             *          
**********************************************************************          
         PRINT NOGEN                                                            
PTXBROTS CSECT                                                                  
*                                                                               
         ENTRY PRIBUY              BUY                                          
*                                                                               
YES      SR    RC,RC               RETURN CC EQUAL                              
NO       LTR   RC,RC               RETURN CC NOT EQUAL                          
EXIT     XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
* PRIBUY - BUY                                                                  
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIBUY   NMOD1 WORKL,*PRIBUY*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIBYLIT                                                      
         USING LITERAL,RA                                                       
         L     R8,16(R1)                                                        
         L     R9,20(R1)           PASS ADDRESS FROM BLK                        
         USING ADDRESSD,R9                                                      
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PXG$BUY,R2          R2=A(EXTRACT RECORD)                         
         USING PBUYRECD,R3         R3=A(PRINT   RECORD)                         
*                                                                               
         MVC   MODETYP,0(R1)       MODE                                         
*                                                                               
         BRAS  RE,LOADER           GET GETINS ADDRESS                           
*                                                                               
         BRAS  RE,LOADER2          GET OFFICER ADDRESS                          
*                                                                               
         BRAS  RE,LOADER3          GET EDITOR ADDRESS                           
*                                                                               
         MVC   GENSWICH,12(R1)     "X" MEANS EXCLUDE BUY CUST COL DATA          
*                                                                               
         MVC   VERSIONA,16(R1)     VERSION NUMBER PASSED FROM PTXTRBLK          
*                                                                               
         CLI   8(R1),1                                                          
         JE    BUYBUILD            BUILD SERIES OF RECORDS                      
         J     BUYNEXTR            OUTPUT NEXT RECORD                           
*                                                                               
PRIBYLIT DC    A(LITERAL)                                                       
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
**  BUYNEXTR                                                        **          
**********************************************************************          
         SPACE 1                                                                
BUYNEXTR L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK?                         
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         LA    R0,PXG$BUY          RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1               LENGHT OF NEXT RECORD                        
         ICM   R1,3,PXG$LEN-PXG$BUY(RE)                                         
         LA    RF,0(R1,RE)         SAVE NEXT ADDRESS                            
         ST    RF,ANEXT                                                         
         LR    RF,R1               SET LENGTH                                   
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
         SPACE 1                                                                
**********************************************************************          
**  BUYBUILD                                                        **          
**********************************************************************          
BUYBUILD DS    0H                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,PTXBUYC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
BUILD001 DS    0H                                                               
*                                                                               
         BRAS  RE,BUYTABLE         BUY TABLE                                    
*                                                                               
BUILD002 DS    0H                                                               
*                                                                               
         LA    R7,POOLTAB          POINT R7 TO THE TABLE WITH PRD               
*                                                                               
BUILD003 DS    0H                                                               
         CLI   0(R7),X'FF'         CHECK IF END OF TABLE                        
         BE    BUILD004            YES --                                       
         BRAS  RE,BUYSMMRY         BUY SUMMARY TABLE                            
*                                                                               
         MVC   PXG$BNET,TMPBSBGR   ORDER GROSS                                  
         TR    PXG$BNET,MXTRT                                                   
*                                                                               
         MVC   PXG$BINC,TMPBSBCM   COMMISSION                                   
         TR    PXG$BINC,MXTRT                                                   
*                                                                               
         MVC   PXG$TAXA,TMPBSTAX   TAX AMOUNT                                   
         TR    PXG$BINC,MXTRT                                                   
*                                                                               
         MVC   PXG$BGRS,TMPBSBGR   BILLING GROSS                                
         TR    PXG$BGRS,MXTRT                                                   
*                                                                               
         MVC   PXG$GRS,TMPGRAMT    GROSS AMOUNT                                 
         TR    PXG$GRS,MXTRT                                                    
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,PXG$LEN                                                     
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
BUILD004 DS    0H                                                               
         J     EXIT                DONE                                         
*                                                                               
PTXBUYC  DC    A(BUFFER1)          OUTPUT RECORD SAVE AREA                      
*                                                                               
         LTORG                                                                  
*                                                                               
         EJECT                                                                  
**********************************************************************          
         SPACE 1                                                                
BUYTABLE NTR1  BASE=*,LABEL=*                                                   
         LA    R0,PXG$BUY          CLEAR THE RECORD                             
         LA    R1,PXG$BUYL                                                      
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    PXG$LEN,PXG$LEN     RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PXG$LEN(2),=AL2(PXG$BUYL)                                        
         MVC   PXG$TYP,PRBLQ                                                    
         MVI   PXG$ACT-1,MXTRTQ                                                 
*                                                                               
X        USING PXG$BUY,R5          R5=A(INITIALIZED EXTRACT RECORD)             
         CLI   X.PXG$ACT,C'A'                                                   
         BNE   *+10                                                             
         MVC   PXG$ACN,=CL8'ADD     '                                           
*                                                                               
         CLI   X.PXG$ACT,C'D'                                                   
         BNE   *+10                                                             
         MVC   PXG$ACN,=CL8'DELETE  '                                           
*                                                                               
         CLI   X.PXG$ACT,C'C'                                                   
         BNE   *+10                                                             
         MVC   PXG$ACN,=CL8'CHANGE  '                                           
*                                                                               
         MVC   PXG$ACT,X.PXG$ACT                                                
         MVC   PXG$DAT,X.PXG$DAT                                                
         MVC   PXG$TME,X.PXG$TME                                                
         DROP  X                                                                
*                                                                               
         MVI   PXG$TME-1,MXTRTQ                                                 
         MVI   PXG$DAT-1,MXTRTQ                                                 
         MVI   PXG$ACN-1,MXTRTQ                                                 
         MVI   PXG$SEQ-1,MXTRTQ                                                 
         MVI   PXG$RTYP-1,MXTRTQ                                                
         MVI   PXG$TTYP-1,MXTRTQ                                                
         MVI   PXG$ACCD-1,MXTRTQ                                                
         MVI   PXG$CONT-1,MXTRTQ                                                
         MVI   PXG$OFFC-1,MXTRTQ                                                
         MVI   PXG$TRDT-1,MXTRTQ                                                
         MVI   PXG$TRRF-1,MXTRTQ                                                
         MVI   PXG$TRSR-1,MXTRTQ                                                
         MVI   PXG$SYS-1,MXTRTQ                                                 
         MVI   PXG$MED-1,MXTRTQ                                                 
         MVI   PXG$CNT-1,MXTRTQ                                                 
         MVI   PXG$PRD-1,MXTRTQ                                                 
         MVI   PXG$EST-1,MXTRTQ                                                 
         MVI   PXG$DR-1,MXTRTQ                                                  
         MVI   PXG$CR-1,MXTRTQ                                                  
         MVI   PXG$MOA-1,MXTRTQ                                                 
         MVI   PXG$ACDT-1,MXTRTQ       NEW ONE                                  
         MVI   PXG$BREF-1,MXTRTQ       NEW ONE                                  
         MVI   PXG$MOS-1,MXTRTQ                                                 
         MVI   PXG$BNET-1,MXTRTQ                                                
         MVI   PXG$BINC-1,MXTRTQ                                                
         MVI   PXG$INAC-1,MXTRTQ                                                
         MVI   PXG$CKDT-1,MXTRTQ                                                
         MVI   PXG$CHEK-1,MXTRTQ                                                
         MVI   PXG$VDDT-1,MXTRTQ                                                
         MVI   PXG$DPDT-1,MXTRTQ                                                
         MVI   PXG$CLDT-1,MXTRTQ                                                
         MVI   PXG$DUDT-1,MXTRTQ                                                
         MVI   PXG$INV-1,MXTRTQ                                                 
         MVI   PXG$OFDT-1,MXTRTQ                                                
         MVI   PXG$STDT-1,MXTRTQ                                                
         MVI   PXG$BKCD-1,MXTRTQ                                                
         MVI   PXG$WOAC-1,MXTRTQ                                                
         MVI   PXG$WONU-1,MXTRTQ                                                
         MVI   PXG$WODT-1,MXTRTQ                                                
         MVI   PXG$XFAC-1,MXTRTQ                                                
         MVI   PXG$XFDT-1,MXTRTQ                                                
         MVI   PXG$AOAC-1,MXTRTQ                                                
         MVI   PXG$AOR$-1,MXTRTQ                                                
         MVI   PXG$AOBL-1,MXTRTQ                                                
         MVI   PXG$WKCD-1,MXTRTQ                                                
         MVI   PXG$NARR-1,MXTRTQ                                                
         MVI   PXG$CURR-1,MXTRTQ                                                
         MVI   PXG$STYP-1,MXTRTQ                                                
         MVI   PXG$NETW-1,MXTRTQ                                                
         MVI   PXG$BGRS-1,MXTRTQ                                                
         MVI   PXG$EDSC-1,MXTRTQ                                                
         MVI   PXG$PRD1-1,MXTRTQ                                                
         MVI   PXG$PRD2-1,MXTRTQ                                                
         MVI   PXG$EST1-1,MXTRTQ                                                
         MVI   PXG$EST2-1,MXTRTQ                                                
         MVI   PXG$SECA-1,MXTRTQ                                                
         MVI   PXG$PID-1,MXTRTQ                                                 
         MVI   PXG$ITMN-1,MXTRTQ                                                
         MVI   PXG$VNDC-1,MXTRTQ                                                
         MVI   PXG$VNDN-1,MXTRTQ                                                
         MVI   PXG$GRS-1,MXTRTQ                                                 
         MVI   PXG$NET-1,MXTRTQ                                                 
         MVI   PXG$TAXA-1,MXTRTQ                                                
         MVI   PXG$TAXC-1,MXTRTQ                                                
         MVI   PXG$INSO-1,MXTRTQ                                                
         MVI   PXG$CMPG-1,MXTRTQ                                                
         MVI   PXG$AGY-1,MXTRTQ                                                 
         MVI   PXG$MEDA-1,MXTRTQ                                                
         MVI   PXG$ESTU-1,MXTRTQ                                                
         MVI   PXG$BUYU-1,MXTRTQ                                                
         MVI   PXG$VOUC-1,MXTRTQ                                                
         MVI   PXG$PLID-1,MXTRTQ                                                
*                                                                               
         AP    WSSEQ,=P'1'                                                      
         OI    WSSEQ+5,X'0F'                                                    
         UNPK  PXG$SEQ,WSSEQ       SEQNUM                                       
*                                                                               
         MVC   PXG$RTYP,USRPRM     RECORD TYPE (PAY/RCV)                        
*                                                                               
         XC    PXG$TTYP,PXG$TTYP   TRANSACTION TYPE                             
*                                                                               
         XC    PXG$CONT,PXG$CONT   CONTRA ACCOUNT CODE                          
*                                                                               
         XC    PXG$TRRF,PXG$TRRF   REFNUM                                       
*                                                                               
         XC    PXG$TRSR,PXG$TRSR   SUB-REFNUM                                   
*                                                                               
         MVC   PXG$BREF,SPACES     BATCH REF                                    
*                                                                               
         MVC   PXG$INAC,SPACES     INCOME ACCOUNT                               
*                                                                               
         MVC   PXG$CKDT,SPACES     CHECK DATE                                   
*                                                                               
         MVC   PXG$CHEK,SPACES     CHECK NUMBER                                 
*                                                                               
         MVC   PXG$VDDT,SPACES     VOID DATE                                    
*                                                                               
         MVC   PXG$DPDT,SPACES     DEPOSIT DATE                                 
*                                                                               
         MVC   PXG$CLDT,SPACES     CLEARED DATE                                 
*                                                                               
         MVC   PXG$DUDT,SPACES     DUE DATE                                     
*                                                                               
         MVC   PXG$OFDT,SPACES     OFFSET DATE                                  
*                                                                               
         MVC   PXG$STDT,SPACES     STATEMENT DATE                               
*                                                                               
         MVC   PXG$BKCD,SPACES     BANK CODE                                    
*                                                                               
         MVC   PXG$WOAC,SPACES     WRITEOFF ACCOUNT                             
*                                                                               
         MVC   PXG$WONU,SPACES     WRITEOFF NUMBER                              
*                                                                               
         MVC   PXG$WODT,SPACES     WRITEOFF DATE                                
*                                                                               
         MVC   PXG$XFAC,SPACES     TRANSFER ACCOUNT                             
*                                                                               
         MVC   PXG$XFDT,SPACES     TRANSFER DATE                                
*                                                                               
         MVC   PXG$AOAC,SPACES     AOR ACCOUNT                                  
*                                                                               
         MVC   PXG$AOR$,SPACES     AOR AMOUNT                                   
*                                                                               
         MVC   PXG$AOBL,SPACES     AOR BILL NUMBER                              
*                                                                               
         MVC   PXG$WKCD,SPACES     WORK CODE                                    
*                                                                               
         XC    PXG$NARR,PXG$NARR   NARRATIVE                                    
*                                                                               
         MVC   PXG$CURR,SPACES     SAP CURRENCY (USD/CND)                       
*                                                                               
         MVC   PXG$STYP,SPACES     SAP TRANSACTION TYPE (INV/CRM)               
*                                                                               
         MVC   PXG$EDSC,SPACES     ESTIMATE DESCRIPTION                         
*                                                                               
         MVC   PXG$PRD1,SPACES     USER FIELD  - PRODUCT 1                      
*                                                                               
         MVC   PXG$PRD2,SPACES     USER FIELD  - PRODUCT 2                      
*                                                                               
         MVC   PXG$EST1,SPACES     USER FIELD  - ESTIMATE 1                     
*                                                                               
         MVC   PXG$EST2,SPACES     USER FIELD  - ESTIMATE 2                     
*                                                                               
         MVC   PXG$PID,SPACES      PID (PERSONAL IDENTIFICATION NUMBER)         
*                                                                               
         MVC   PXG$ITMN,SPACES     ITEM NUMBER                                  
*                                                                               
         MVC   PXG$VNDN,SPACES     VENDOR NAME                                  
*                                                                               
         MVC   PXG$AGY,PBUYKAGY    AGENCY                                       
         TR    PXG$AGY,MXTRT                                                    
*                                                                               
         MVC   PXG$SECA,PBUYKAGY    AGENCY                                      
         TR    PXG$SECA,MXTRT                                                   
*                                                                               
         MVC   PXG$MED,PBUYKMED    MEDIA                                        
         TR    PXG$MED,MXTRT                                                    
*                                                                               
         MVI   PXG$SYS,C'P'        SYSTEM                                       
         TR    PXG$SYS,MXTRT                                                    
*                                                                               
         MVC   PXG$CNT,PBUYKCLT    CLIENT                                       
         TR    PXG$CNT,MXTRT                                                    
*                                                                               
         MVC   PXG$PRD(L'PBUYKCLT),PBUYKCLT    PRODUCT                          
         MVC   PXG$PRD+(L'PBUYKCLT)(L'PBUYKPRD),PBUYKPRD    PRODUCT             
         TR    PXG$PRD,MXTRT                                                    
*                                                                               
         XC    CHAR15,CHAR15                                                    
         MVC   CHAR6,PBUYKPUB                                                   
         MVI   PRIMDPUB,X'08'                                                   
         GOTO1 =V(PUBEDIT),DMCB,(PRIMDPUB,CHAR6),(C'S',CHAR15)                  
*                                                                               
         MVC   PXG$ACCD,CHAR8      PUB NUMBER                                   
         TR    PXG$ACCD,MXTRT                                                   
*                                                                               
         CLI   CHAR6+4,0           ANY ZONE ?                                   
         BNH   PUBBUYE             NO                                           
         MVC   PXG$ACCD+8(2),CHAR2       ZONE                                   
         MVC   PXG$ACCD+10(3),CHAR3 EDITION - MAY BE NULLS                      
         B     PUBBUYX             FINISH PUB NUMBER WORK                       
PUBBUYE  DS    0H                                                               
         MVC   PXG$ACCD+10(3),CHAR2                                             
PUBBUYX  DS    0H                                                               
         TR    PXG$ACCD+8(2),MXTRT                                              
         TR    PXG$ACCD+10(3),MXTRT                                             
*                                                                               
         MVC   PXG$NETW,PXG$ACCD                                                
         TR    PXG$NETW,MXTRT                                                   
*                                                                               
         MVC   PXG$VNDC,PXG$ACCD    VENDOR CODE                                 
         TR    PXG$VNDC,MXTRT                                                   
*                                                                               
         GOTO1 DATCON,PLIST,(3,PBUYKDAT),(20,TMPTRDT) TRANSACTION DATE          
*                                                                               
         MVC   PXG$MOA(2),TMPTRDT+2         YY                                  
         MVC   PXG$MOA+2(2),TMPTRDT+4       MM                                  
         TR    PXG$MOA,MXTRT                                                    
         MVC   PXG$MOS+0(2),TMPTRDT+2       YY                                  
         MVC   PXG$MOS+2(2),TMPTRDT+4       MM                                  
         TR    PXG$MOS,MXTRT                                                    
*                                                                               
         EDIT  PBUYKEST,PXG$EST,FILL=0                                          
         TR    PXG$EST,MXTRT                                                    
*                                                                               
         XC    PXG$DR,PXG$DR       DEBIT DOLLARS                                
         TR    PXG$DR,MXTRT                                                     
*                                                                               
*                                                                               
PBUY0000 DS    0H                                                               
*                                                                               
         LA    R6,PBUYRECD+33      SERIAL NUMBER                                
         MVI   ELCODE,X'99'                                                     
         BRAS  RE,NEXTEL                                                        
         JE    *+6                                                              
         DC    H'0'                MUST HAVE SERIAL# ELEMENT                    
*                                                                               
         USING PSERELD,R6                                                       
         EDIT  (P5,PSERNUM),(9,PXG$BUYU),FILL=0                                 
         TR    PXG$BUYU,MXTRT                                                   
*                                                                               
* USE BUY SERIAL# KEY AND INVOICE NUMNER AS VOUCHER                             
* MED/CLT/SERIAL# (EXACT 13 BYTES) AND INVOICE# (UP TO 20 BYTES)                
*                                                                               
         MVC   PXG$VOUC+0(1),PBUYREC+2                                          
         MVC   PXG$VOUC+1(3),PBUYREC+4                                          
         EDIT  (P5,PSERNUM),(9,PXG$VOUC+4),FILL=0                               
         DROP  R6                                                               
*                                                                               
         MVC   PXG$ESTU,SPACES                                                  
         TR    PXG$ESTU,MXTRT                                                   
*                                                                               
PBUY001A DS    0H                                                               
         LA    R6,PBUYRECD+33                                                   
         MVI   ELCODE,X'20'                                                     
*                                                                               
         USING PBDELEM,R6                                                       
*                                                                               
         XC    PXG$ACDT,PXG$ACDT                                                
         GOTO1 DATCON,PLIST,(3,PBDBUYDT),(20,TMPELEM)                           
         MVC   PXG$ACDT+0(2),TMPELEM+6   DD                                     
         MVC   PXG$ACDT+2(2),TMPELEM+4   MM                                     
         MVC   PXG$ACDT+4(4),TMPELEM+0   YYYY                                   
         TR    PXG$ACDT,MXTRT                                                   
*                                                                               
         MVC   PXG$TAXC,=C'MI'  GST CODE                                        
         TR    PXG$TAXC,MXTRT                                                   
*                                                                               
PBUY001B DS    0H                                                               
         MVC   PXG$INSO,SPACES                                                  
         MVC   PXG$MEDA,SPACES                                                  
         MVC   PXG$PLID,SPACES                                                  
         MVC   TMPINV,SPACES                                                    
*                                                                               
         LA    R6,PBUYRECD+33                                                   
         MVI   ELCODE,X'CC'                                                     
*                                                                               
PBUY001C BRAS  RE,NEXTEL                                                        
         JNE   PBUY0005                                                         
*                                                                               
         SR    R4,R4                                                            
         USING BYCCELD,R6                                                       
         LA    R4,PXG$INSO                                                      
         CLC   =H'8204',BYCCSQN    INSERTION ORDER NUMBER                       
         JE    PBUY0002                                                         
         LA    R4,PXG$CMPG                                                      
         CLC   =H'8215',BYCCSQN    CAMPAIGN                                     
         JE    PBUY0002                                                         
         LA    R4,PXG$MEDA                                                      
         CLC   =H'8249',BYCCSQN    MEDIA AUTHORIZATION NUMBER                   
         JE    PBUY0002                                                         
         LA    R4,PXG$PLID                                                      
         CLC   =H'8202',BYCCSQN    PRISMA PLACEMENT ID                          
         JE    PBUY001C                                                         
         LA    R4,TMPINV                                                        
         CLC   =H'8213',BYCCSQN    CC INV# (20 MAX)?                            
         JE    PBUY0002                                                         
         LA    R4,PXG$NET                                                       
         CLC   =H'8214',BYCCSQN    CC INV$ (13 MAX)?                            
         JE    PBUY0003                                                         
*                                                                               
         J     PBUY001C                                                         
*                                                                               
PBUY0002 DS    0H                                                               
*                                                                               
         SR    R1,R1                                                            
         IC    R1,BYCCLEN                                                       
         SHI   R1,BYCCHDRL+1                                                    
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   0(0,R4),BYCCDATA                                                 
         J     PBUY001C                                                         
*                                                                               
PBUY0003 DS    0H                  FORMAT INVOICE AMOUNT                        
*                                                                               
         EDIT  (P8,BYCCDATA),PXG$NET,2,ALIGN=LEFT                               
         J     PBUY001C                                                         
*                                                                               
PBUY0005 DS    0H                                                               
*                                                                               
         CLC   PXG$PLID,SPACES     IF NO PLACEMENT ID, GENERATE ONE             
         JH    PBUY0016            USING M/C/P/E                                
         MVC   PXG$PLID+00(1),PBUYKMED                                          
         MVI   PXG$PLID+01,C'/'                                                 
         MVC   PXG$PLID+02(3),PBUYKCLT                                          
         MVI   PXG$PLID+05,C'/'                                                 
         MVC   PXG$PLID+06(3),PBUYKPRD                                          
         MVI   PXG$PLID+09,C'/'                                                 
         EDIT  PBUYKEST,(3,PXG$PLID+10),FILL=0                                  
*                                                                               
PBUY0016 DS    0H                                                               
         MVC   PXG$INV,TMPINV      DEFAULT TO CUSTOM COLUMN INV#                
         MVC   PXG$VOUC+13(L'PXG$INV),PXG$INV                                   
         TR    PXG$VOUC,MXTRT                                                   
*                                                                               
* FOR CUSTOM COLUMN, THERE'S NO INVOCIE DATE, DEFAULT TO TODAY'S DATE           
*                                                                               
         CLC   PXG$INV,SPACES      HAVE INVOICE?                                
         JNH   PBUY0018                                                         
         GOTO1 DATCON,PLIST,(5,0),(20,TMPTRDT)                                  
         MVC   PXG$TRDT+0(2),TMPTRDT+6   DD                                     
         MVC   PXG$TRDT+2(2),TMPTRDT+4   MM                                     
         MVC   PXG$TRDT+4(4),TMPTRDT+0   YYYY                                   
*                                                                               
         J     PBUY0018            INVOICES ARE HANDLED IN PTXTRBLK             
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         LA    R6,PBUYRECD+33                                                   
         MVI   ELCODE,X'51'                                                     
         BRAS  RE,NEXTEL                                                        
         JNE   PBUY0018                                                         
         USING PBNVELMD,R6                                                      
*                                                                               
         MVC   PXG$INV(L'PBNVINV#),PBNVINV#                                     
*                                                                               
PBUY0017 DS    0H                                                               
         CLC   PXG$INV,SPACES                                                   
         BNH   PBUY0018                                                         
*                                                                               
         LA    R5,IOKEY                                                         
         USING PNVRECD,R5                                                       
         XC    PNVKEY,PNVKEY                                                    
         MVC   PNVKAGY,PBUYKAGY                                                 
         MVC   PNVKMED,PBUYKMED                                                 
         MVI   PNVKRCD,PNVKRCDQ                                                 
         MVC   PNVKSER#,PBNVSER#                                                
         GOTO1 VDATAMGR,DMCB,(X'00',DMRDHI),PRTDIR,IOKEY,(R5),DMWORK            
         CLI   8(R1),0                                                          
         JNE   PBUY0018                                                         
*                                                                               
         CLC   IOKEY(PNVKSER#-PNVKEY),0(R5)                                     
         JNE   NO                                                               
*                                                                               
         MVC   DISKADD,27(R5)                                                   
         LA    R5,TMPAIO                                                        
*                                                                               
         GOTO1 VDATAMGR,DMCB,(X'00',GETREC),PRTFIL,DISKADD,(R5),DMWORK          
         CLI   8(R1),0                                                          
         JNE   PBUY0018                                                         
                                                                                
         LA    R5,TMPAIO+33                                                     
         USING PNVHDRD,R5                                                       
                                                                                
PBUY017A CLI   PNVHKCDE,X'00'                                                   
         BE    PBUY0018                                                         
         CLI   PNVHKCDE,PNVHKIDQ                                                
         BE    PBUY017B                                                         
*                                                                               
         LLC   R0,PNVHKLEN                                                      
         AR    R5,R0                                                            
         B     PBUY017A                                                         
*                                                                               
PBUY017B GOTO1 DATCON,PLIST,(3,PNVHDATE),(20,TMPELEM)                           
         MVC   PXG$TRDT+0(2),TMPELEM+6   DD                                     
         MVC   PXG$TRDT+2(2),TMPELEM+4   MM                                     
         MVC   PXG$TRDT+4(4),TMPELEM+0   YYYY                                   
         B     PBUY0018                                                         
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
PBUY0018 DS    0H                                                               
*                                                                               
PBUY0019 DS    0H                                                               
         LA    R5,IOKEY                                                         
         USING PCLTRECD,R5                                                      
         XC    PCLTKEY,PCLTKEY                                                  
         MVC   PCLTKAGY,PBUYKAGY                                                
         MVC   PCLTKMED,PBUYKMED                                                
         MVI   PCLTKRCD,PCLTKIDQ                                                
         MVC   PCLTKCLT,PBUYKCLT                                                
         MVC   IOSVKEY,IOKEY                                                    
         GOTO1 VDATAMGR,DMCB,(X'00',DMRDHI),PRTDIR,IOKEY,(R5),DMWORK            
         CLI   8(R1),0                                                          
         JNE   PBUY0020                                                         
*                                                                               
         CLC   IOKEY(PCLTLEN-PCLTKEY),IOSVKEY                                   
         JNE   NO                                                               
*                                                                               
         MVC   DISKADD,27(R5)                                                   
         LA    R5,TMPAIO                                                        
*                                                                               
         GOTO1 VDATAMGR,DMCB,(X'00',GETREC),PRTFIL,DISKADD,(R5),DMWORK          
         CLI   8(R1),0                                                          
         JNE   PBUY0020                                                         
                                                                                
         LA    R5,TMPAIO+33                                                     
         USING PCLTELEM,R5                                                      
*                                                                               
         XC    WORK,WORK                                                        
OFFD     USING OFFICED,WORK        2-CHR OFFICE LOGIC                           
         MVI   OFFD.OFCSYS,C'P'                                                 
         MVC   OFFD.OFCAGY,PBUYKAGY                                             
         MVC   OFFD.OFCPMED,PBUYKMED                                            
         MVC   OFFD.OFCOFC,PCLTOFF                                              
*                                                                               
         GOTOR OFFICER,DMCB,(C'2',WORK),(0,COMFACS)                             
         CLI   0(R1),0                                                          
         BNE   PBUY0020                                                         
*                                                                               
         MVC   PXG$OFFC,OFFD.OFCOFC2 POPULATE 1-CHAR OFFICE FIELD               
*                                                                               
         DROP  OFFD                                                             
*                                                                               
PBUY0020 DS    0H                                                               
         J     EXIT                                                             
*                                                                               
***********************************************************************         
*NEXTEL - GET NEXT ELEMENT                                            *         
***********************************************************************         
NEXTEL   DS    0H                                                               
*                                                                               
NXTELLP  LLC   R0,1(R6)                                                         
         AR    R6,R0                                                            
*                                                                               
         CLI   0(R6),0                                                          
         JE    NXTELX1                                                          
*                                                                               
         CLC   ELCODE,0(R6)                                                     
         BER   RE                                                               
*                                                                               
         J     NXTELLP                                                          
*                                                                               
NXTELX1  LTR   R6,R6                                                            
         BR    RE                                                               
*                                                                               
         EJECT                                                                  
*                                                                               
         SPACE 3                                                                
         LTORG                                                                  
*                                                                               
***********************************************************************         
* BUYSUMMARY                                                                    
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
BUYSMMRY NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   TMPBSPRD,PBUYKPRD   PRODUCT                                      
*                                                                               
         CLI   ZZZFLAG,X'01'       CHECK IF WE IN POOL                          
         BNE   PBUS0009                                                         
*                                                                               
         MVC   TMPBSPRD,0(R7)                                                   
         AHI   R7,3                BUMP TO THE NEXT ENTRY IN POOLTAB            
*                                                                               
PBUS0009 DS    0H                                                               
         TR    TMPBSPRD,MXTRT                                                   
*                                                                               
PBUS0010 DS    0H                                                               
*                                                                               
         CLC   TMPBSPRD,=C'ZZZ'       IF NOT IN POOL DON'T LOOK                 
         JNE   PBUS0030               FOR 21 ELEMENT                            
*                                                                               
         LA    R6,PBUYRECD+33                                                   
         MVI   ELCODE,X'21'                                                     
         BRAS  RE,NEXTEL                                                        
         JNE   PBUS0030                                                         
*                                                                               
         USING ZZZPOOLD,R6                                                      
         LA    R7,POOLTAB                                                       
PBUS0015 MVC   0(3,R7),PPRCODE                                                  
         AHI   R7,3                                                             
*                                                                               
         BRAS  RE,NEXTEL                                                        
         JNE   PBUS0029                                                         
         J     PBUS0015                                                         
*                                                                               
*                                                                               
PBUS0029 DS    0H                                                               
         MVI   0(R7),X'FF'                                                      
         LA    R7,POOLTAB                                                       
*                                                                               
PBUS0030 DS    0H                                                               
*                                                                               
         GOTO1 GETINS,DMCB,PBUYREC,PVALUES,TMPBSPRD,(0,0),0,0                   
*                                                                               
         EDIT  PGROSS,PXG$CR,FILL=0                                             
         TM    PGROSS,X'80'                                                     
         BZ    *+8                                                              
         MVI   PXG$CR,C'-'                                                      
         EDIT  BGROSS,TMPBSBGR,FILL=0                                           
         TM    BGROSS,X'80'                                                     
         BZ    *+8                                                              
         MVI   TMPBSBGR,C'-'                                                    
         EDIT  BAGYCOM,TMPBSBCM,FILL=0                                          
         TM    BAGYCOM,X'80'                                                    
         BZ    *+8                                                              
         MVI   TMPBSBCM,C'-'                                                    
*                                                                               
         EDIT  (B4,GROSS),TMPGRAMT,2,ALIGN=LEFT,FLOAT=-                         
*                                                                               
         L     R1,GROSS                                                         
         S     R1,AGYCOM                                                        
         STCM  R1,15,FULL                                                       
         EDIT  (B4,FULL),TMPNBAMT,2,ALIGN=LEFT,FLOAT=-                          
*                                                                               
PBUS0050 DS    0H                                                               
*                                                                               
PBUSEND  DS    0H                                                               
         XIT1  REGS=(R7)                                                        
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
         SPACE 3                                                                
         DS    0F                                                               
SAVER6   DS    F                                                                
SAVER1   DS    F                                                                
SAVPARMS DS    XL8                                                              
ANXTCOM  DS    A                                                                
WWWW     DS    CL36                                                             
KEY      DS    CL33                                                             
KEYSAVE  DS    CL33                                                             
SVBUYKEY DS    CL33                                                             
SVELCOD  DS    CL1                                                              
REGCOMTP DS    CL1                                                              
ELCDLO   DS    X                                                                
ELCDHI   DS    X                                                                
*                                                                               
BIGTABLE DC    A(BIGTABD)          5000 BYTE RECORD AREA                        
         SPACE 3                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* LITERALS AND CONSTANTS REQUIRED FOR ALL ROUTINES                    *         
***********************************************************************         
         SPACE 1                                                                
LITERAL  DS    0D                                                               
GETBROAD DC    V(GETBROAD)                                                      
DATCON   DC    V(DATCON)                                                        
VGETDAY  DC    V(GETDAY)                                                        
VADDAY   DC    V(ADDAY)                                                         
VLOADER  DC    V(LOADER)                                                        
COMFACS  DC    V(COMFACS)                                                       
GETINS   DC    A(0)                                                             
OFFICER  DC    A(0)                                                             
EDITOR   DC    A(0)                                                             
ANEXT    DC    F'0'                                                             
VERSIONA DC    X'00'               VERSION NUMBER PASSED FROM PTXTRBLK          
GENSWICH DC    C' '                                                             
LOADSW   DC    C' '                                                             
CAPSWICH DC    X'01'             SWICH FOR CAP1= X'01' CAP2= X'02'              
DATADISP DC    X'0021'                                                          
WSSEQ    DC    PL6'0'                                                           
**********************************************************************          
*                                                                               
LOADER   ICM   RF,15,GETINS                                                     
         BNZR  RE                                                               
         NTR1  ,                                                                
         MVC   WORK,=CL8'T00AAB'                                                
         XC    PLIST(6*4),PLIST                                                 
         GOTO1 VLOADER,PLIST,WORK,0                                             
         MVC   GETINS,4(R1)                                                     
         J     EXIT                                                             
         LTORG                                                                  
*                                                                               
**********************************************************************          
*                                                                               
LOADER2  ICM   RF,15,OFFICER                                                    
         BNZR  RE                                                               
         NTR1  ,                                                                
         MVC   WORK,=CL8'T00A38'                                                
         XC    PLIST(6*4),PLIST                                                 
         GOTO1 VLOADER,PLIST,WORK,0                                             
         MVC   OFFICER,4(R1)                                                    
         J     EXIT                                                             
         LTORG                                                                  
*                                                                               
*                                                                               
LOADER3  ICM   RF,15,EDITOR                                                     
         BNZR  RE                                                               
         NTR1  ,                                                                
         MVC   WORK,=CL8'T00A71'                                                
         XC    PLIST(6*4),PLIST                                                 
         GOTO1 VLOADER,PLIST,WORK,0                                             
         MVC   EDITOR,4(R1)                                                     
         J     EXIT                                                             
         LTORG                                                                  
*                                                                               
**********************************************************************          
*                                                                               
*                                                                               
*MXTRT                                                                          
       ++INCLUDE MXTRT                                                          
*                                                                               
*PTXBRCID                                                                       
       ++INCLUDE PTXBRCID                                                       
*                                                                               
*SPCGRTAB                                                                       
       ++INCLUDE SPCGRTAB                                                       
*GETEL                                                                          
*        GETEL R6,DATADISP,ELCODE                                               
*                                                                               
GETCONC  DC    XL(GETCONLQ)'00'    PPGETCON CONTROL BLOCK                       
COMREC   DS    CL3000                                                           
BIGTABD  DS    CL5000                                                           
*                                                                               
         DC    CL8'BUFFER01'                                                    
BUFFER1  DC    3000XL8'00'         HOLDS RECORDS FOR WRITING TO FILE            
BUFFER1L EQU   *-BUFFER1                                                        
*                                                                               
***********************************************************************         
* WORKING STORAGE REQUIREMENTS                                        *         
***********************************************************************         
         SPACE 1                                                                
WORKD    DSECT                                                                  
DUB      DS    D                                                                
DUB1     DS    D                                                                
DOUBLE   DS    D                                                                
APARM    DS    A                   A(PARAMETER LIST)                            
*                                                                               
PARM     DS    0XL24               PARAMETER LIST                               
AXREC    DS    A                   A(EXTRACT RECORD)                            
         DS    A                                                                
         DS    A                                                                
         DS    A                                                                
         DS    A                                                                
APTXPARM DS    A                                                                
*                                                                               
DMCB     DS    0F                                                               
PLIST    DS    6F                                                               
ADCONLST DS    0A                  FORCE RESETVAL TO ASSEMBLE                   
VSPNDCTL DS    A                   USED BY RESETVAL TO FIND STATION REC         
ASTAREC  DS    A                                                                
REG1SV   DS    F                                                                
MPSTTAX  DS    F                   ORDERED PST TAX                              
MPSTTAXP DS    F                   PAID    PST TAX                              
MPSTTAXB DS    F                   BILLED  PST TAX                              
FULL     DS    F                                                                
HALF     DS    H                                                                
BYTE     DS    X                                                                
ELCODE   DS    X                                                                
CCRECSW  DS    X                                                                
KILLMODE DS    C                                                                
PRIMDPUB DS    X                                                                
ZZZFLAG  DS    X                 01---- FLAG IS ON                              
SV70ELM  DS    CL9                                                              
CHAR6    DS    CL6                                                              
CHAR15   DS    0CL15                                                            
CHAR8    DS    CL8                                                              
         DS    C                                                                
CHAR2    DS    CL2                                                              
         DS    C                                                                
CHAR3    DS    CL3                                                              
*                                                                               
       ++INCLUDE PVALUES                                                        
       ++INCLUDE GVALUES                                                        
FULL666  DS    F                                                                
*                                                                               
POOLTAB  DS    30CL3                                                            
ACGTAB   DS    CL22                ADDITIONAL CHARGE CODES (10 MAX.)            
BUYOUT   DS    600C                                                             
         DS    10C                                                              
*                                                                               
         DS    D                                                                
WORK     DS    XL256                                                            
         DS    XL024               DBLOCK IS BUILT AT WORK+10 FOR 280           
*                                                                               
WKKEY    DS    CL32                                                             
WKKEYSAV DS    CL32                                                             
SVGRPID  DS    C                                                                
SVGRPCOD DS    XL2                                                              
CODECHAR DS    CL5                                                              
SVBK1LN  DS    X                                                                
SVBK2LN  DS    X                                                                
SVELADR  DS    F                                                                
WORK12D  DS    12D                                                              
*                                                                               
ADCONSD  DS    0A                                                               
*                                                                               
MODETYP  DS    X                                                                
*                                                                               
TMPINVNO DS    XL10                INVOICE NUMBER                               
TMPBSPRD DS    CL3                 BRAND DETAIL                                 
TMPBSBGR DS    CL16                GROSS                                        
TMPBSBCM DS    CL16                COMMISSION                                   
TMPBSTAX DS    CL16                TAX AMOUNT                                   
TMPGRAMT DS    CL16                GROSS AMOUNT                                 
TMPNBAMT DS    CL16                NET BUY AMOUNT                               
TMPNIAMT DS    CL16                NET INVOICE AMOUNT                           
TMPINV   DS    CL20                INV# - MAX 20 FOR CUSOTM COLUMNS             
TMPTRDT  DS    CL8                 TMP TRANSACTION DATE                         
TMPELEM  DS    XL256                                                            
DISKADD  DS    XL4                 DISK ADDRESS                                 
*                                                                               
IOKEY    DS    CL64                                                             
IOSVKEY  DS    XL25                                                             
*                                                                               
DMWORK   DS    12D                                                              
*                                                                               
TMPAIO   DS    4000X                                                            
*                                                                               
WORKL    EQU   *-WORKD                                                          
         EJECT                                                                  
***********************************************************************         
* OTHER INCLUDED DSECTS                                               *         
***********************************************************************         
         SPACE 1                                                                
*PPBYOUT                                                                        
       ++INCLUDE PPBYOUTD                                                       
*PTXUSERD                                                                       
       ++INCLUDE RXUSERD                                                        
*PTXBRECD                                                                       
       ++INCLUDE PTXBRECD                                                       
*DXDSECTS                                                                       
       ++INCLUDE DXDSECTS                                                       
*PPGETCOND                                                                      
       ++INCLUDE PPGETCOND                                                      
         PRINT ON                                                               
       ++INCLUDE PRGENFILE                                                      
       ++INCLUDE PUCOMREC                                                       
PCOS2FD  DSECT                                                                  
       ++INCLUDE PCOS2FACEL                                                     
         PRINT OFF                                                              
       ++INCLUDE DEDBLOCK                                                       
*      ++INCLUDE FASYSFAC                                                       
CMMNT    DSECT                                                                  
       ++INCLUDE PCOMELEM                                                       
ZZZPOOLD DSECT                                                                  
       ++INCLUDE PPRELEM                                                        
*OFFICED                                                                        
       ++INCLUDE DDOFFICED                                                      
EBLOCKD  DSECT                                                                  
       ++INCLUDE DDEBLOCK                                                       
                                                                                
       ++INCLUDE SEACSFILE                                                      
                                                                                
       ++INCLUDE PTXPARM                                                        
                                                                                
         PRINT ON                                                               
       ++INCLUDE PTXRBWRK                                                       
         PRINT OFF                                                              
                                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'023PTXBROTS  01/28/19'                                      
         END                                                                    

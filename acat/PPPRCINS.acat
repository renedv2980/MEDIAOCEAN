*          DATA SET PPPRCINS   AT LEVEL 196 AS OF 01/27/17                      
*CATALP PPPRCINS                                                                
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         TITLE 'PINSOR - PRINTPAK INSERTION ORDER MODULE'                       
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* KWAN 03/24/15 FIX BAD BRANCH AT SETL5A (BZ INSTRUCTION)                       
*                                                                               
* KWAN 01/19/12 INSOR COMMENT FORMAT PROFILE VALUE                              
*                                                                               
* KWAN 03/21/11 EIO BY ESTIMATE PERIOD                                          
*                                                                               
* KWAN 11/24/10 SUPPRESS LANGUAGE FLAG FOR EIO                                  
*                                                                               
* KWAN 06/01/09 CORRECT MATJOB SWITCH FOR AD-ID ONLY RECORDS                    
*                                                                               
* KWAN 08/28/08 &&INSERTION&& NOTATION IS NOT SUPPORTED IN EIO                  
*                                                                               
* KWAN 03/14/08 COPY SPLIT                                                      
*                                                                               
* KWAN 04/11/06 MARK EIO ELEM FOR DELETED BUY MOVE CHANGE ORDERS                
*                                                                               
* KWAN 10/19/05 FIX LEGAL WARNING COMMENTS FOR EIO                              
*                                                                               
* KWAN 02/07/05 ISSUE A CHANGE ELEM WHEN WEB IO IS GENERATED                    
*                                                                               
* KWAN 09/30/04 2ND ADDRESS PROFILE FIX FOR WEB IO                              
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
PINSOR   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 PRCINSDX-PRCINSD,*PRCINS*,RR=RE,CLEAR=YES                        
*                                                                               
         LR    R6,RC                                                            
         USING PRCINSD,R6          R6 = A(LOCAL STORAGE)                        
*                                                                               
         ST    RE,RELO                                                          
         L     RC,0(R1)                                                         
         USING POLWRKD,RC                                                       
         USING T41FFFD,RA                                                       
         USING IOWORKD,R8                                                       
         L     R9,PPFILEC                                                       
         LA    R7,1(R9)                                                         
         LA    R7,4095(R7)                                                      
         USING POLFILED,R9,R7                                                   
*                                                                               
         L     RE,=V(DICSECTP)                                                  
         A     RE,RELO                                                          
         ST    RE,ADICSECT                                                      
*                                                                               
         XC    SVPID,SVPID         PASSWORD ID NUMBER CLEARED                   
         L     RF,VCOMFACS                                                      
         USING COMFACSD,RF                                                      
         GOTO1 CGETFACT,DMCB,(2,0),0,0                                          
         DROP  RF                                                               
         L     R1,0(R1)                                                         
         USING FACTSD,R1                                                        
         MVC   SVSECAGY,FATAGYSC                                                
         TM    FATFLAG,X'08'       CHECK IF SECRET CODE IS THERE                
         BZ    *+10                                                             
         MVC   SVPID,FAPASSWD      SAVE PASSWORD ID NUMBER                      
         DROP  R1                                                               
*                                                                               
         XC    DMCB(24),DMCB                                                    
         CLI   PBUYKEY,X'FF'       TEST EOF                                     
         BE    PIN11                                                            
         XC    ERR(2),ERR                                                       
*                                                                               
* INSURE THAT AUTO'S AND REQ'S DO NOT APPEAR ON SAME IO                         
*                                                                               
         CLC   QOPT3,QOPT3-QRECORD+SAVEQ                                        
         BE    *+8                                                              
         MVI   TSBFD-STATDIF,X'FF' FORCE BREAK                                  
         BRAS  RE,SETLAST                                                       
         CLI   LASTIOEL,X'FF'      SEE IF IGNORING THIS BUY                     
         BNE   PIN2                NO                                           
         XC    LASTIOEL,LASTIOEL                                                
         B     EXIT                                                             
*                                                                               
PIN2     DS    0H                                                               
         L     R2,LASTIOEL                                                      
         USING PIOELEM,R2                                                       
*                                                                               
PIN2A    DS    0H                                                               
         XC    THISSTAT,THISSTAT                                                
         MVC   TSAGY(3),PBUYKAGY                                                
         MVC   TSCLT(6),PBUYKCLT                                                
*                                                                               
         CLI   MULTIAD,C'Y'        SEE IF DPOING MULTIPLE AD I/O                
         BE    *+10                IF SO - DON'T SET AD IN THISSTAT             
*                                                                               
         MVC   TSJOB,PBDJOB                                                     
         MVC   TSPUB,PBUYKPUB                                                   
         CLI   ZEOPT,C'Y'          IF MULTI Z/E                                 
         BNE   *+10                                                             
         XC    TSPUB+4(2),TSPUB+4  CLEAR ZONE/EDIT                              
         CLI   MULTOPT,C'Y'        MULTI INSERTS PER IO                         
         BE    *+8                 YES                                          
         MVI   TSBFD-STATDIF,X'FF' INSURE 1 INSERT PER IO                       
*                                                                               
         MVC   TSCHGSW,CHANGSW                                                  
         MVC   TSPBFREQ,PBDFREQ                                                 
         LTR   R2,R2                                                            
         BZ    PIN2B                                                            
         MVC   TSLIODAT,PIODATE                                                 
         MVC   TSLIONUM(4),PIONUM                                               
         MVI   TSLIONUM+2,0        REMOVE POSITIONAL NUMBER                     
*                                                                               
         CLI   REVOPT,C'Y'         SEE IF SUPPRESSING REASON FOR REV            
         BE    PIN2A5              MESSAGES                                     
         CLC   PBDJOB,PIOJOB                                                    
         BE    PIN2A5                                                           
         MVI   TSLJOB,C'Y'         SET JOB CHANGE IN THIS STATUS                
*                                                                               
PIN2A5   DS    0H                                                               
PIN2B    DS    0H                                                               
         CLI   LASTSTAT,0                                                       
         BE    PIN2D                                                            
*                                                                               
* TEST SAME A/M/C/P/JOB/PUB/                                                    
*                                                                               
         CLC   TSAGY(21),TSAGY-STATDIF                                          
         BNE   PIN11               NO - FINISH LAST IO NOW                      
*                                                                               
         L     R4,BUYDALST                                                      
         L     RE,ABUYMAX          LAST POSSIBLE ADDRESS                        
         CR    R4,RE                                                            
         BL    PIN2D                                                            
         B     PIN11               TOO MANY BUYS FOR ONE I/O                    
*                                                                               
PIN2D    DS    0H                  MUST FINISH LAST I/O NOW                     
*                                                                               
         MVC   FULL(1),PUBLANG     SETTING DICTIONARY USING PUBLANG             
         BRAS  RE,SET_LANG                                                      
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(10),RCSVAGY                                                  
         MVI   KEY+3,X'15'                                                      
         MVC   KEY+10(6),PBDJOB                                                 
         CLC   PJOBKEY,KEY         CHECK ALREADY HAVE                           
         BE    PIN4                                                             
         GOTOR READ                                                             
         BRAS  RE,TSTERR                                                        
*                                                                               
         LA    R0,PJOBREC                                                       
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN4     DS    0H                                                               
         CLC   PJOBCAP1(8),=C'INACTIVE'                                         
         BNE   PIN4B                                                            
         CLC   QPROG,=C'73'        DO 'INACTIVES' FOR PPROOF RUN                
         BE    PIN4B                                                            
*                                  BYPASS 'INACTIVE' BUYS                       
         CLI   BUYSW,C'F'                                                       
         BNE   PIN11               FINISH LAST IO NOW                           
         XC    LASTSTAT,LASTSTAT   PREVENT REPEAT OF END                        
         MVI   BUYSW,0                                                          
         B     EXIT                                                             
*                                                                               
PIN4B    DS    0H                  GET INS REC                                  
         MVC   KEY+16(6),PBUYKPUB                                               
         CLI   ZEOPT,C'Y'          MULTI ZONE/EDIT?                             
         BNE   *+10                                                             
         XC    KEY+20(2),KEY+20    USE ONLY BASE PUB                            
         CLC   KEY(25),PINSREC     ALREADY HAVE                                 
         BE    PIN5B                                                            
         GOTOR HIGH                                                             
         BRAS  RE,TSTERR                                                        
         TM    KEY+25,X'80'        DELETED?                                     
         BNZ   PIN4C                                                            
         CLC   KEY(22),KEYSAVE                                                  
         BE    PIN5                                                             
*                                                                               
PIN4C    DS    0H                                                               
         MVC   KEYSAVE+16(6),=6X'FF'                                            
         CLC   KEY(22),KEYSAVE     FF DEFAULT?                                  
         BE    PIN5                                                             
         CLI   PBDJOB,C'!'         MASTER AD CODE?                              
         BNE   *+12                                                             
         OI    WKEIOFLG,E_NOINSQ   MASTER AD CODE W/O INSTRUCTION REC           
         B     PIN5B                                                            
         MVC   KEY,KEYSAVE                                                      
         GOTOR READ                                                             
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN5     DS    0H                                                               
         CLC   KEY(25),PINSREC                                                  
         BE    PIN5B               ALREADY HAVE                                 
         LA    R0,PINSREC                                                       
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN5B    DS    0H                                                               
         LA    R0,SPACEND                                                       
         LHI   R1,1600                                                          
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LA    R0,11               SET AT LEAST 11 LINES TO PRINT               
         LA    R1,SPACEND                                                       
         MVI   0(R1),C' '                                                       
         LA    R1,80(R1)                                                        
         BCT   R0,*-8                                                           
*                                                                               
         CLI   CHANGSW,C'C'                                                     
         BNE   PIN5D                                                            
*                                                                               
* BUILD LIST OF REASONS FOR CHANGE IN SPACEND                                   
* AND SET CHANGE STATUS FIELDS                                                  
*                                                                               
         OC    LASTIOEL,LASTIOEL                                                
         BZ    PIN5D                                                            
         GOTO1 ABLDREV,DMCB,(RC),LASTIOEL                                       
*                                                                               
PIN5D    DS    0H                                                               
         CLI   BUYSW,C'F'                                                       
         BE    PIN6                                                             
         CLC   THISSTAT,LASTSTAT                                                
         BNE   PIN11               FINISH LAST IO                               
         B     PIN10               CONTINUE SAME I.O.                           
*                                                                               
PIN6     BRAS  RE,FNDCLTV#         FIND AND SAVE CLT VEN NUMBER                 
*                                                                               
         BRAS  RE,CKCHNGSW         CK FOR REVISION, DELETE OR ORIGINAL          
*                                                                               
         BRAS  RE,CKCPENAM         CK FOR CLT, PRD, EST NAME                    
*                                                                               
         BRAS  RE,CKPUBREP         CK FOR PUB/REP ADDRESS                       
*                                                                               
         LA    R2,PINSREC+33       FIRST BUY ON INSERTION ORDER                 
         MVI   BUYSW,0                                                          
         MVI   MATSW,0                                                          
         XC    BRPTDAT,BRPTDAT                                                  
         XC    RPTPUB,RPTPUB       ALSO CLEAR REPEAT PUB                        
*                                                                               
         TM    WKEIOFLG,E_NOINSQ   MASTER AD CODE W/O INSTRUCTION REC?          
         BZ    *+12                                                             
         NI    WKEIOFLG,X'FF'-E_NOINSQ                                          
         B     PIN9F                                                            
*                                                                               
         MVI   ELCODE,X'66'                                                     
         CLI   0(R2),X'66'                                                      
         BE    PIN9D                                                            
*                                                                               
PIN9B    DS    0H                                                               
         BRAS  RE,NXTEL                                                         
         BNE   PIN9F                                                            
*                                                                               
PIN9D    DS    0H                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         BNZ   PIN9B                                                            
         CLC   =C'//INSERTION//',2(R2)                                          
         BE    PIN9H               DO BUY LATER                                 
         B     PIN9B                                                            
*                                                                               
PIN9F    DS    0H                                                               
         BRAS  RE,GETPHOUS         GET PRODUCTION HOUSE INFORMATION             
*                                                                               
         BRAS  RE,WEBIOHDR         REPLY WEB IO HEADER                          
         BRAS  RE,EIOHCOMM         REPLY EIO HEADER COMMENT                     
*                                                                               
         GOTOR AFMTBUY,DMCB,(RC)   DO BUY NOW                                   
*                                                                               
         CLI   MULTIAD,C'Y'        SEE IF MULTI-AD OPTION IS ON                 
         BNE   *+8                                                              
         BRAS  RE,ADDADS           IF SO - ADD TO TABLE OF AD CODES             
*                                                                               
         BRAS  RE,ADDDOLS                                                       
         BRAS  RE,ADDESTN          ADD EST TO TABLE                             
         BRAS  RE,ADDCON           ADD CONTRACT TO TABLE                        
         B     PIN30                                                            
*                                                                               
PIN9H    DS    0H                                                               
         MVI   BUYSW,C'M'          BUY PRINT BETWEEN COMMENTS                   
         MVI   SPACING,2                                                        
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                  START ON COMMENTS                            
         LA    R2,PINSREC+33                                                    
         CLI   0(R2),X'66'                                                      
         BE    PIN9M                                                            
*                                                                               
PIN9K    DS    0H                                                               
         MVI   ELCODE,X'66'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   PIN30               DONE                                         
*                                                                               
PIN9M    DS    0H                                                               
         CLC   =C'//INSERTION//',2(R2)                                          
         BNE   PIN9R                                                            
         MVI   SPACING,2                                                        
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
         GOTOR AFMTBUY,DMCB,(RC)                                                
*                                                                               
         CLI   MULTIAD,C'Y'        SEE IF MULTI-AD OPTION IS ON                 
         BNE   *+8                                                              
         BRAS  RE,ADDADS           IF SO - ADD TO TABLE OF AD CODES             
*                                                                               
         BRAS  RE,ADDDOLS                                                       
         BRAS  RE,ADDESTN                                                       
         BRAS  RE,ADDCON                                                        
         B     PIN30                                                            
*                                                                               
PIN9R    DS    0H                                                               
         CLC   =C'COM=',2(R2)                                                   
         BNE   PIN9T                                                            
         GOTOR ASTDCOM,DMCB,(RC),(R2)                                           
*                                                                               
         BRAS  RE,TSTERR                                                        
         B     PIN9K                                                            
*                                                                               
PIN9T    DS    0H                                                               
         GOTOR ACOMLIN,DMCB,(RC),(R2)                                           
*                                                                               
         BRAS  RE,TSTERR                                                        
         B     PIN9K                                                            
*                                                                               
PIN10    DS    0H                  CONTINUATION BUY ON I.O.                     
         GOTOR AFMTBUY,DMCB,(RC)                                                
*                                                                               
         CLI   MULTIAD,C'Y'        SEE IF MULTI-AD OPTION IS ON                 
         BNE   *+8                                                              
         BRAS  RE,ADDADS           IF SO - ADD TO TABLE OF AD CODES             
*                                                                               
         BRAS  RE,ADDDOLS                                                       
         BRAS  RE,ADDESTN          ADD TO ESTIMATE TABLE                        
         BRAS  RE,ADDCON                                                        
         B     PIN30                                                            
*                                                                               
PIN11    DS    0H                  FINISH I.O.                                  
         MVC   FULL(1),SVLANG      SETTING DICTIONARY USING SVLANG              
         BRAS  RE,SET_LANG                                                      
                                                                                
         CLI   LASTSTAT,0                                                       
         BE    PIN25                                                            
         MVI   SPACING,2                                                        
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
         CLI   OLDOPT,C'Y'         TEST OLD FMT - NO MSGS HERE                  
         BE    PIN12                                                            
         CLI   TSCHGSW-STATDIF,0                                                
         BE    PIN12                                                            
         L     RF,ADICSECT                                                      
         USING DICSECTP,RF                                                      
*--->    MVC   P+5(28),=C'** THIS IS A CHANGE ORDER **'                         
         MVC   P+5(L'PP@IOP5),PP@IOP5                                           
*--->    MVC   PSECOND+18(6),DASHES                                             
         CLI   SVLANG,C'F'         IF FRENCH - NO UNDERLINING                   
         BE    *+10                                                             
         MVC   PSECOND+18(6),DASHES                                             
         CLI   TSCHGSW-STATDIF,C'C'                                             
         BE    PIN11C                                                           
*--->    MVC   P+18(21),=C'CANCELLATION ORDER **'                               
         MVC   P+5(L'PP@IOP6),PP@IOP6                                           
*--->    MVC   PSECOND+18(12),DASHES                                            
         DROP  RF                                                               
*                                                                               
         CLI   SVLANG,C'F'         IF FRENCH - NO UNDERLINING                   
         BE    *+10                                                             
         MVC   PSECOND+18(12),DASHES                                            
*                                                                               
PIN11C   DS    0H                                                               
         MVI   SPACING,2                                                        
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
         CLI   TSLIONUM+3-STATDIF,1                                             
         BNH   PIN12                                                            
         L     RF,BUYDALST                                                      
         LA    R0,BUYDALST+4                                                    
         SR    RF,R0                                                            
         SRL   RF,2                                                             
         STC   RF,BYTE                                                          
         CLC   BYTE,TSLIONUM+3-STATDIF                                          
         BE    PIN12                                                            
*                                                                               
* MESSAGE ABOUT PARTIAL CHANGES/CANCELS                                         
*                                                                               
         MVC   W,SPACES                                                         
*--->    MVC   W(17),=C'NOTE- THIS CHANGE'                                      
*--->    LA    R3,W+18                                                          
*--->    CLI   TSCHGSW-STATDIF,C'C'                                             
*--->    BE    *+14                                                             
*--->    MVC   W+11(12),=C'CANCELLATION'                                        
*--->    LA    R3,W+24                                                          
*--->    MVC   0(18,R3),=C'ORDER AFFECTS ONLY'                                  
*--->    LA    R3,19(R3)                                                        
*                                                                               
         L     RF,ADICSECT                                                      
         USING DICSECTP,RF                                                      
         MVC   W(L'PP@IOP7),PP@IOP7                                             
         LA    R3,W+L'PP@IOP7+1                                                 
         CLI   TSCHGSW-STATDIF,C'C'                                             
         BE    *+14                                                             
         MVC   W(L'PP@IOP8),PP@IOP8                                             
         LA    R3,W+L'PP@IOP8+1                                                 
         DROP  RF                                                               
*                                                                               
PIN11C5  CLI   0(R3),C' '          SCAN BACKWARD FOR LAST LETTER                
         BH    *+8                                                              
         BCT   R3,PIN11C5                                                       
*                                                                               
         LA    R3,2(R3)            THEN BUMP 2 SPACES                           
         ZIC   RF,BYTE                                                          
         BRAS  RE,EDLEFT                                                        
         AR    R3,R0                                                            
*                                                                               
         L     RF,ADICSECT                                                      
         USING DICSECTP,RF                                                      
*--->    MVC   1(6,R3),=C'OF THE'                                               
         MVC   1(L'PP@OFTHE,R3),PP@OFTHE                                        
         DROP  RF                                                               
*                                                                               
         LA    R3,8(R3)                                                         
         CLI   SVLANG,C'F'         SEE IF FRENCH                                
         BNE   *+8                                                              
         AHI   R3,-3               BACKUP 3 CHARS SINCE FRENCH IS "DES"         
*                                                                               
         IC    RF,TSLIONUM+3-STATDIF                                            
         BRAS  RE,EDLEFT                                                        
         MVC   P+5(80),W                                                        
         MVC   W,SPACES                                                         
*                                                                               
         L     RF,ADICSECT                                                      
         USING DICSECTP,RF                                                      
*--->    MVC   PSECOND+11(32),=C'INSERTIONS ON THE ORIGINAL ORDER'              
         MVC   PSECOND+11(L'PP@IOP9),PP@IOP9                                    
         DROP  RF                                                               
         MVI   SPACING,2                                                        
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
PIN12    DS    0H                                                               
         MVI   HPSW,1              SET DEFAULT TO INS HDR ALREADY PRNTD         
         CLI   MULTIAD,C'Y'                                                     
         BNE   PIN12A5                                                          
*                                                                               
         B     PIN12A                                                           
*                                                                               
PIN12A   DS    0H                                                               
         MVI   MATSW,0             MUST RESET                                   
         BRAS  RE,GETPINS          GET INSTRUCTIONS FOR NEXT AD                 
         CLC   MATJOB,=6X'FF'      LAST AD?                                     
         BE    PIN12J2             WILL HAVE SKIPPED A LINE                     
*                                                                               
         MVI   HPSW,0                                                           
*                                                                               
         L     RE,AADLIST                                                       
         OC    17(6,RE),17(RE)     SEE IF ONLY ONE AD                           
         BZ    PIN12A5             YES -THEN SKIP THIS MESSAGE                  
*                                                                               
         CLI   SVLANG,C'F'         SEE IF FRENCH I/O                            
         BNE   PIN12A3                                                          
*                                                                               
         MVC   P+10(40),=C'**CES INSTRUCTIONS SONT POR NO.D''ANNONCE'           
         MVC   P+51(6),MATJOB      GETPINS RETURNS CODE IN MATJOB               
         MVC   P+57(2),=C'**'                                                   
         B     PIN12A5                                                          
                                                                                
PIN12A3  MVC   P+10(32),=C'**THESE INSTRUCTIONS APPLY TO AD'                    
         MVC   P+43(6),MATJOB      GETPINS RETURNS CODE IN MATJOB               
         MVC   P+49(2),=C'**'                                                   
*                                                                               
PIN12A5  DS    0H                                                               
         LA    R2,PINSREC+33                                                    
         MVI   ELCODE,X'66'                                                     
         CLI   0(R2),X'66'                                                      
         BE    PIN12D                                                           
*                                                                               
PIN12B   DS    0H                                                               
         MVI   ELCODE,X'66'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   PIN12J                                                           
*                                                                               
PIN12D   DS    0H                                                               
         CLI   HPSW,1              SEE IF I HAVE PRINTED INS HEADER             
         BE    PIN12D5                                                          
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
         BRAS  RE,RPYADCOM         REPLY HARD CODED AD COMMENT                  
*                                                                               
         MVI   HPSW,1              SET INS HEADER PRINTED                       
*                                                                               
PIN12D5  DS    0H                                                               
         CLC   =C'//INSERTION//',2(R2)                                          
         BNE   PIN12F                                                           
         MVI   BUYSW,0                                                          
         B     PIN12B                                                           
*                                                                               
PIN12F   DS    0H                                                               
         CLI   BUYSW,0                                                          
         BNE   PIN12B                                                           
*                                                                               
         CLC   =C'COM=',2(R2)                                                   
         BNE   PIN12H                                                           
         GOTOR ASTDCOM,DMCB,(RC),(R2)                                           
*                                                                               
         BRAS  RE,TSTERR                                                        
         B     PIN12B                                                           
*                                                                               
PIN12H   DS    0H                                                               
         MVC   PINLANG,PUBLANG     SAVE 'REAL' PUBLANG                          
         MVC   PUBLANG,SVLANG      SINCE MATCOM NEEDS LANG IN PUBLANG           
*                                                                               
         GOTOR ACOMLIN,DMCB,(RC),(R2)                                           
*                                                                               
         MVC   PUBLANG,PINLANG     RESTORE "REAL" PUBLANG                       
*                                                                               
         BRAS  RE,TSTERR                                                        
         B     PIN12B                                                           
*                                                                               
PIN12J   DS    0H                                                               
         CLI   MULTIAD,C'Y'        SEE IF MULTI-AD I/O                          
         BNE   PIN12J2                                                          
         MVC   P,SPACES            BE SURE P LINE IS CLEAR                      
         CLI   HPSW,1              DID I PRINT INS HEADER?                      
         BNE   PIN12A              NO - THEN DON'T SKIP                         
         GOTOR AIOPRNT,DMCB,(RC)   SKIP A LINE                                  
*                                                                               
         BRAS  RE,PHOUSE           FOR MULTIPLE ADCODE                          
*                                                                               
         B     PIN12A              DO NEXT AD                                   
*                                                                               
PIN12J2  DS    0H                  BUILD ELEM FOR STDCOM                        
         CLI   MULTIAD,C'Y'        SEE IF MULTI-AD I/O                          
         BE    PIN12J2H                                                         
*                                                                               
         BRAS  RE,PHOUSE           FOR SINGLE ADCODE                            
*                                                                               
PIN12J2H XC    PPGKEY(24),PPGKEY                                                
*                                                                               
* SAVE CANCEL INDICATOR SO COMMENTS WILL ALWAYS BE PRINTED                      
*                                                                               
         MVC   PPGKEY+25(1),TSCHGSW-STATDIF                                     
         MVI   TSCHGSW-STATDIF,0                                                
         MVI   PPGKEY,X'66'                                                     
         MVI   PPGKEY+1,X'0C'                                                   
         MVC   PPGKEY+2(4),=C'COM='                                             
         LA    R1,PPGKEY+6                                                      
         OC    SCPSCOM1,SCPSCOM1   CK FOR PUB/CLT STANDARD COMMENT 1            
         BZ    PIN12J3                                                          
         MVC   PPGKEY+6(6),SCPSCOM1                                             
         LA    R1,PPGKEY+17                                                     
PIN12J3  OC    SCPSCOM2,SCPSCOM2                                                
         BZ    PIN12J5                                                          
         MVC   0(6,R1),SCPSCOM2                                                 
         OC    SCPSCOM1,SCPSCOM1   FIRST COMMENT?                               
         BZ    PIN12J5 NO                                                       
         MVI   PPGKEY+1,X'16'                                                   
         MVI   PPGKEY+12,C','                                                   
         MVC   PPGKEY+13(4),=C'COM='                                            
*                                                                               
PIN12J5  OC    PPGKEY+6(6),PPGKEY+6                                             
         BZ    PIN12J7                                                          
         GOTOR ASTDCOM,DMCB,(RC),PPGKEY                                         
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN12J7  DS    0H                  NOW CK STANDARD COMMENT ON CLT               
         LA    R2,PCLTELEM                                                      
         MVI   ELCODE,X'11'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   PIN12J9                                                          
         XC    PPGKEY(20),PPGKEY                                                
         MVI   PPGKEY,X'66'        PRINT                                        
         MVI   PPGKEY+1,X'0C'                                                   
         MVC   PPGKEY+2(4),=C'COM='                                             
         MVC   PPGKEY+6(6),2(R2)                                                
         GOTOR ASTDCOM,DMCB,(RC),PPGKEY                                         
         BRAS  RE,TSTERR                                                        
*                                                                               
         MVI   ELCODE,X'11'        TRY FOR ANOTHER                              
         BRAS  RE,NXTEL                                                         
         BNE   PIN12J9                                                          
         GOTOR AIOPRNT,DMCB,(RC)   SKIP A LINE                                  
         XC    PPGKEY(20),PPGKEY                                                
         MVI   PPGKEY,X'66'                                                     
         MVI   PPGKEY+1,X'0C'                                                   
         MVC   PPGKEY+2(4),=C'COM='                                             
         MVC   PPGKEY+6(6),2(R2)                                                
         GOTOR ASTDCOM,DMCB,(RC),PPGKEY                                         
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN12J9  BRAS  RE,IOCOMPRT                                                      
*                                                                               
         TM    ADBSW,AS_WEBIO      EIO?                                         
         BNZ   *+12                IF EIO, IGNORE MULTOPT CK                    
         CLI   MULTOPT,C'Y'        MULTI INSERTS PER I/O?                       
         BE    *+8                 YES                                          
         BRAS  RE,LEGALW           LEGAL WARNINGS & QUARTERLY COMMENTS          
*                                                                               
         MVC   TSCHGSW-STATDIF(1),PPGKEY+25                                     
*                                                                               
         CLI   TOTOPT,C'N'         IF PRINTING TOTALS                           
         BNE   PIN12J95                                                         
         CLI   VNOOPT,C'Y'         IF PRINTING VEN NUMBER                       
         BE    PIN12J95                                                         
         CLI   ESTOPT,C'D'         OR EST AND NAME                              
         BE    PIN12J95                                                         
         CLI   ESTOPT,C'Y'         OR EST NUMBER                                
         BNE   PIN13                                                            
*                                                                               
PIN12J95 GOTOR AIOPRNT,DMCB,(RC)   SKIP A LINE                                  
*                                                                               
         OC    SVCVNUM,SVCVNUM                                                  
         BZ    PIN12K                                                           
         CLI   VNOOPT,C'Y'         TEST PRINTING VEN NUMBER                     
         BNE   PIN12K                                                           
         L     RF,ADICSECT                                                      
         USING DICSECTP,RF                                                      
*--->    MVC   P+5(18),=C'CLIENT VENDOR NO.='                                   
         MVC   P+5(L'PP@CVNO),PP@CVNO                                           
*--->    MVC   P+24(12),SVCVNUM                                                 
         MVC   P+6+L'PP@CVNO(12),SVCVNUM                                        
         DROP  RF                                                               
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
PIN12K   DS    0H                                                               
         CLI   ONEEOPT,C'Y'        IN HEADLINES FOR ONE EST REQ                 
         BNE   PIN12KC                                                          
         CLC   PRQEST,=C'ALL'      SEE IF ONE EST REQ                           
         BNE   PIN13               YES - SKIP EST HERE                          
*                                                                               
PIN12KC  DS    0H                                                               
         CLI   ESTOPT,C'D'         NUMBER AND DESCRIPTION?                      
         BNE   *+12                                                             
         BRAS  RE,DISPESTN         DO EST # AND NAME                            
         B     PIN13                                                            
*                                                                               
         CLI   ESTOPT,C'Y'         PRINTING EST NUMBER?                         
         BNE   PIN13                                                            
         BRAS  RE,DISPEST#         DO EST #                                     
*                                                                               
PIN13    BRAS  RE,DISPCONT         DO CONTRACT INFO                             
*                                                                               
         BRAS  RE,DISPTOTL         DO TOTAL                                     
*                                                                               
         LA    R0,CONTAB                                                        
         LHI   R1,400                                                           
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    IOCNTS,IOCNTS       CLEAR ALL IO COUNTERS                        
         MVI   FORCEFUT,C'Y'       INSURE SIGNATURE PRINT                       
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
         BRAS  RE,MARKBUYR         MARK BUY RECORD                              
         BRAS  RE,MARKADCR         MARK AD CODE RECORD                          
*                                                                               
         LH    RF,REFNO                                                         
         LA    RF,1(RF)                                                         
         STH   RF,REFNO            BUMP IO NUMBER                               
*                                                                               
         CLI   MULTOPT,C'Y'        MULTIPLE INSERTIONS ON ONE ORDER?            
         BNE   PIN25                                                            
*                                                                               
* BLD REVSION NOW TO SET DATE,SPACE JOB OF LASTIO INTO THISSTAT                 
* BEFORE IT GETS MOVED INTO LASTSTAT                                            
*                                                                               
         CLI   CHANGSW,C'C'        ONLY NEEDED FOR CHANGES                      
         BNE   PIN25                                                            
*                                                                               
         OC    LASTIOEL,LASTIOEL   JUST IN CASE                                 
         BZ    PIN25                                                            
*                                                                               
         L     RF,LASTIOEL                                                      
         CLI   0(RF),X'70'         BE SURE IT REALLY IS AN I/O ELEM             
         BNE   PIN25                                                            
*                                                                               
         OC    2(3,RF),2(RF)       CHECK FOR DATE                               
         BZ    PIN25                                                            
*                                                                               
* BLD REVISION TO SET THISSTAT                                                  
*                                                                               
         GOTO1 ABLDREV,DMCB,(RC),LASTIOEL                                       
*                                                                               
         LA    R0,SPACEND                                                       
         LHI   R1,1600                                                          
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
PIN25    DS    0H                                                               
         XC    LASTSTAT,LASTSTAT                                                
*                                                                               
PIN26    DS    0H                                                               
         CLI   PBUYKEY,X'FF'                                                    
         BE    PIN90                                                            
*                                                                               
         MVC   LASTSTAT,THISSTAT                                                
         MVC   HLIN1,SPACES        CLEAR HEADLINES                              
         XC    LASTBUY,LASTBUY                                                  
         LA    R4,BUYDALST+4                                                    
         ST    R4,BUYDALST                                                      
         XC    0(4,R4),0(R4)                                                    
         MVI   BUYSW,C'F'          SET END OF I.O.                              
         MVC   SAVEQ,QRECORD                                                    
         MVC   SVIGNDAT,BIGNDAT                                                 
         B     PIN2D                                                            
*                                                                               
PIN30    DS    0H                  ADD TO BUYREC DISK ADDR LIST                 
         CLC   QPROG-QRECORD+SAVEQ,=C'72'                                       
         BH    PIN90                                                            
         MVC   KEY(25),PBUYKEY                                                  
         GOTOR READ                                                             
         BRAS  RE,TSTERR                                                        
*                                                                               
         L     R4,BUYDALST                                                      
         L     RE,ABUYMAX          LAST POSSIBLE ADDRESS                        
         CR    R4,RE                                                            
         BL    *+6                                                              
         DC    H'0'                TOO MANY BUYS FOR ONE I/O                    
*                                                                               
         MVC   0(4,R4),KEY+27                                                   
         LA    R4,4(R4)                                                         
         XC    0(4,R4),0(R4)                                                    
         ST    R4,BUYDALST                                                      
*                                                                               
PIN90    DS    0H                                                               
*                                                                               
EXIT     XIT1                                                                   
         EJECT                                                                  
*                                  DATAMGR LINKS                                
TSTERR   DS    0H                                                               
         OC    ERR(2),ERR                                                       
         JNZ   TSTERR2                                                          
         MVC   BYTE,DMCB+8                                                      
         NC    BYTE,DMOUTBTS                                                    
         BZR   RE                                                               
         MVC   ERR+1(1),DMCB+8                                                  
TSTERR2  LR    R0,RE                                                            
         DC    H'0'                                                             
         GOTO1 AERRMOD                                                          
         J     EXIT                                                             
         EJECT                                                                  
*                                                                               
NXTEL    ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLC   ELCODE,0(R2)                                                     
         JE    NXTELX              CC IS EQUAL                                  
         CLI   0(R2),0                                                          
         JNE   NXTEL                                                            
         LTR   R2,R2               CC IS NOT EQUAL                              
NXTELX   BR    RE                                                               
*                                                                               
EDLEFT   DS    0H                                                               
         EDIT  (RF),(3,0(R3)),ALIGN=LEFT                                        
         BR    RE                                                               
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FNDCLTV# NTR1   BASE=*,LABEL=*     FIND AND SAVE CLT VEN NUMBER                 
*                                                                               
         XC    SVCVNUM,SVCVNUM                                                  
         LA    R0,ESTLIST                                                       
         LHI   R1,400                                                           
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         L     R0,AADLIST          CLR AD LIST (MAX OF 200 ADS)                 
         LHI   R1,3216                                                          
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    IOCNTS,IOCNTS       CLEAR I/O COUNTERS                           
*                                                                               
         LA    R0,CONTAB           BUY COUNT GROSS AND NET                      
         LHI   R1,400                                                           
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LA    R2,PUBREC+33                                                     
         MVI   ELCODE,X'14'                                                     
PIN6B    BRAS  RE,NXTEL                                                         
         BNE   PIN6C                                                            
         CLC   2(3,R2),PCLTKCLT                                                 
         BNE   PIN6B                                                            
         CLI   17(R2),X'99'                                                     
         BNH   PIN6C               COULD BE A PUB NUMBER                        
         MVC   SVCVNUM,17(R2)                                                   
*                                                                               
PIN6C    DS    0H                                                               
         MVC   SVRPTDT,QRPTDAT     SAVE REQ RPT DATE                            
*                                                                               
         MVC   SVFRSTDT,PBUYKDAT                                                
         MVI   FORCEHED,C'Y'                                                    
         MVI   FORCEFUT,C'N'                                                    
         MVC   PAGE,=H'1'                                                       
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
CKCHNGSW NTR1   BASE=*,LABEL=*     CK FOR REVISION, DELETE OR ORIGINAL          
*                                                                               
         L     R3,ADICSECT                                                      
         USING DICSECTP,R3                                                      
*                                                                               
         CLI   CHANGSW,0                                                        
         BE    PIN6D                                                            
*                                                                               
*-->     MVC   P+1(07),=C'REVISES'                                              
         MVC   P+1(L'PP@REVIE),PP@REVIE                                         
         CLI   CHANGSW,C'C'                                                     
         BE    *+10                                                             
*--->    MVC   P+1(07),=C'CANCELS'                                              
         MVC   P+1(L'PP@CAN),PP@CAN                                             
*--->    MVC   P+09(09),=C'ORDER NO.'                                           
         MVC   P+09(L'PP@ORDNO),PP@ORDNO                                        
         MVC   P+19(1),PAGYKMED                                                 
         MVI   P+20,C'-'                                                        
*                                                                               
         L     R2,LASTIOEL                                                      
         USING PIOELEM,R2                                                       
         GOTO1 DATCON,DMCB,(3,PIODATE),(0,WORK)                                 
         MVC   P+21(5),WORK+1                                                   
         MVI   P+26,C'-'                                                        
         MVC   HALF,PIONUM                                                      
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+27(4),DUB                                                      
*                                                                               
         LA    R1,PSECOND                                                       
         MVC   1(17,R1),DASHES                                                  
*--->    MVC   19(05,R1),=C'DATED'                                              
         MVC   19(L'PP@DATED,R1),PP@DATED                                       
*                                                                               
         GOTO1  DATCON,DMCB,(0,WORK),(5,WORK)                                   
*                                                                               
         CLI   PUBLANG,C'F'        SEE IF FRENCH                                
         BNE   *+8                                                              
         BRAS  RE,FRDATE                                                        
*                                                                               
         LA    R1,PSECOND                                                       
         MVC   26(08,R1),WORK                                                   
         DROP  R2                                                               
         B     PIN7                                                             
*                                  ORIGINAL ORDER                               
PIN6D    DS    0H                                                               
*--->    MVC   P+1(13),=C'PLEASE INSERT'                                        
         MVC   P+1(L'PP@IOP1),PP@IOP1                                           
         CLI   QMEDIA,C'O'                                                      
         BNE   PIN6E                                                            
         MVC   P+1(L'PP@IOP1),SPACES                                            
*--->    MVC   P+8(6),=C'POST  '                                                
         MVC   P+1(L'PP@IOP2),PP@IOP2                                           
         CLI   PBUYKEY+15,C'P'     TEST PAINT                                   
         BNE   PIN6E               NO                                           
         MVC   P+1(L'PP@IOP2),SPACES                                            
*--->    MVC   P+8(6),=C'PAINT '                                                
         MVC   P+1(L'PP@IOP3),PP@IOP3                                           
*                                                                               
PIN6E    DS    0H                                                               
*--->    MVC   PSECOND+1(15),=C'ADVERTISING OF-'                                
         MVC   PSECOND+1(L'PP@IOP4),PP@IOP4                                     
*                                                                               
PIN7     DS    0H                                                               
         MVI   SPACING,1                                                        
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R3                                                            
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
CKCPENAM NTR1   BASE=*,LABEL=*     CK FOR CLT, PRD, EST NAME                    
*                                                                               
         L     R3,ADICSECT                                                      
         USING DICSECTP,R3                                                      
*                                                                               
         CLI   CHANGSW,0                                                        
         BNE   CKCPENX                                                          
         LA    R1,SPACEND                                                       
         LA    R1,83(R1)                                                        
*--->    MVC   00(06,R1),=C'CLIENT'                                             
         MVC   00(L'PP@CLI,R1),PP@CLI                                           
         MVC   09(03,R1),PCLTKCLT                                               
         MVC   13(20,R1),PCLTNAME                                               
*--->    MVC   80(07,R1),=C'PRODUCT'                                            
         MVC   80(L'PP@PRO,R1),PP@PRO                                           
         MVC   89(03,R1),PPRDKPRD                                               
         MVC   93(20,R1),PPRDNAME                                               
*                                                                               
         CLI   ONEEOPT,C'Y'                                                     
         BNE   CKCPENX                                                          
         CLC   PRQEST,=C'ALL'      SEE IF ONE ESTIMATE                          
         BE    CKCPENX                                                          
         MVC   160(08,R1),=C'ESTIMATE'                                          
         MVC   169(03,R1),PRQEST                                                
         MVC   173(20,R1),PESTNAME                                              
         MVC   253(20,R1),PESTNAM2                                              
*                                                                               
CKCPENX  J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R3                                                            
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
CKPUBREP NTR1   BASE=*,LABEL=*     CK FOR PUB/REP ADDRESS                       
*                                                                               
         LA    R1,SPACEND                                                       
         LA    R1,45(R1)           1ST LINE, POS 46                             
*                                                                               
         MVI   ADR2SW,C'N'         CLEAR 2ND ADDRESS SWITCH                     
*                                                                               
         MVC   BYTE,PREPKEY        SAVE FIRST BYTE OF PREPKEY                   
*                                                                               
         CLI   PREPKEY,0           CHECK FOR REP OR ADDR,TRA                    
         BNE   PIN8F               IF FOUND DO FIRST                            
*                                                                               
PIN8A    MVC   000(20,R1),PUBNAME                                               
         MVC   080(20,R1),PUBZNAME                                              
         CLI   PUBZNAME,C' '                                                    
         BNH   *+8                                                              
         LA    R1,80(R1)                                                        
         MVC   080(30,R1),PUBLINE1                                              
         MVC   160(30,R1),PUBLINE2                                              
         MVI   240(R1),C' '                                                     
         LA    R2,PUBREC+33                                                     
         CLI   0(R2),X'11'                                                      
         BE    PIN8B                                                            
         MVI   ELCODE,X'11'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   PIN8B5                                                           
*                                                                               
PIN8B    DS    0H                                                               
         USING PUBSADEL,R2                                                      
         OC    PUBATTN,SPACES                                                   
         CLC   PUBATTN,SPACES                                                   
         BE    PIN8B5                                                           
*                                                                               
         XC    80(30,R1),80(R1)    CLEAR PUBLINE 1+2                            
         XC    160(30,R1),160(R1)  AND PRINT AFTER ATTN:                        
         MVC   80(5,R1),=C'ATTN-'                                               
         MVC   86(24,R1),PUBATTN                                                
         MVC   160(30,R1),PUBLINE1                                              
         MVC   240(30,R1),PUBLINE2                                              
*                                                                               
         MVI   320(R1),C' '        SO I WON'T ABUT INSERTION HEADS              
*                                                                               
* SEE IF ONLY DOING PUB - NO REP OR OTHER ADDRESS                               
*                                                                               
PIN8B5   DS    0H                                                               
         CLI   ADR2SW,C'Y'         (BYTE WILL BE 0)                             
         BNE   PIN8G               DONE - ALREADY HAVE BEEN PRINTED             
*                                                                               
         CLI   0(R2),X'11'         MUST HAVE FOUND PUBSADEL                     
         BNE   PIN8G               NO-DONE                                      
         CLI   TLFXOPT2,C'T'       TELEPHONE OF 2ND ADDRESS?                    
         BE    PIN8B6                                                           
         CLI   TLFXOPT2,C'B'       OR TEL AND FAX OF 2ND ADDDRESS?              
         BE    PIN8B6                                                           
         B     PIN8B8                                                           
*                                                                               
PIN8B6   OC    PUBTEL,SPACES                                                    
         CLC   PUBTEL,SPACES       SEE IF I HAVE ONE                            
         BE    PIN8B8                                                           
         MVC   400(3,R1),=C'TEL'                                                
         MVC   400+4(L'PUBTEL,R1),PUBTEL                                        
*                                                                               
PIN8B8   CLI   TLFXOPT2,C'F'       FAX OF 2ND ADDRESS                           
         BE    PIN8B9                                                           
         CLI   TLFXOPT2,C'B'       OR TELEPHONE AND FAX                         
         BNE   PIN8B9X             NO - THEN DONE                               
*                                                                               
PIN8B9   OC    PUBSFAXN,SPACES                                                  
         CLC   PUBSFAXN,SPACES     SEE IF I HAVE A FAX                          
         BE    PIN8B9X             NO - THEN DONE                               
         MVC   400+L'PUBTEL+6(3,R1),=C'FAX'                                     
         MVC   400+L'PUBTEL+10(L'PUBSFAXN,R1),PUBSFAXN                          
*                                                                               
PIN8B9X  MVI   480(R1),C' '                                                     
         B     PIN8G                                                            
*                                                                               
PIN8F    DS    0H                  USE REP                                      
         MVC   000(30,R1),PREPNAME                                              
         MVC   080(30,R1),PREPLIN1                                              
         MVC   160(30,R1),PREPLIN2                                              
         OC    PREPATTN,SPACES                                                  
         CLC   PREPATTN,SPACES                                                  
         BE    PIN8F5                                                           
*                                                                               
         XC    80(30,R1),80(R1)    CLEAR PREPLIN1 + 2                           
         XC    160(30,R1),160(R1)  PRINT AFTER ATTN:                            
         MVC   80(5,R1),=C'ATTN-'                                               
         MVC   86(20,R1),PREPATTN                                               
         MVC   160(30,R1),PREPLIN1                                              
         MVC   240(30,R1),PREPLIN2                                              
*                                                                               
PIN8F5   DS    0H                                                               
PIN8G    DS    0H                                                               
         MVI   ADR2SW,C'Y'         SET DOING 2ND ADDRESS                        
*                                                                               
         CLI   ADDROPT,C'S'        SEE IF DOING TRA AND SHIP                    
         BE    PIN8G10                                                          
         CLI   ADDROPT,C'L'        SEE IF DOING TRA AND SHIP + LABEL            
         BE    PIN8G10                                                          
*                                                                               
         CLI   ADDROPT,C'C'        SEE IF DOING TRA AND CONTRACT                
         BE    GETCONR             REP                                          
*                                                                               
         CLI   ADDROPT,C'2'        MEANS SHIPPING AND PUB                       
         BE    PIN8G3                                                           
*                                                                               
         CLI   ADDROPT,C'Y'        SEE IF DOING PUB ADD ALSO                    
         BNE   PIN8I               NO                                           
PIN8G3   CLI   PREPKEY,0           SEE IF I JUST DID REP OR ADDR,TRA            
         BE    PIN8H               NO - THEN DONE                               
*                                                                               
PIN8G5   OI    240(R1),C' '        SKIP 3 LINES TO GET OUT OF WINDOW            
         MVI   320(R1),C' '                                                     
         MVI   400(R1),C' '                                                     
         LA    R1,480(R1)                                                       
         MVI   PREPKEY,0                                                        
         B     PIN8A               GO DO PUB NAME                               
*                                                                               
PIN8G10  DS    0H                  SEARCH FOR SHIPPING ADDRESS                  
         MVI   ADRTYP,C'S'         TRY FOR AOV ADDRESS                          
         MVC   CLTAGY,PUBKAGY      AGY                                          
         MVC   CLTMED,QMEDIA       MED                                          
         MVC   CLTCODE,PCLTKCLT    CLIENT CODE                                  
         MVC   CLTOFF,PCLTOFF      CLIENT OFFICE                                
*                                                                               
         ST    R1,WORD             SAVE PRINT O/P POINTER                       
*                                                                               
         GOTO1 APPGETAD,DMCB,(ADRTYP,CLTDATA),PUBREC,VDATAMGR                   
         LR    RE,R1                                                            
         L     R1,WORD             RESTORE PRINT O/P POINTER                    
*                                                                               
         CLI   0(RE),X'FF'         ERROR IN CALL ?                              
         BNE   *+6                 NO                                           
         DC    H'0'                                                             
*                                                                               
         CLI   0(RE),0             ADDRESS RECORD FOUND ?                       
         BE    PIN8G30             NO                                           
*                                                                               
         MVC   WORK+3(4),0(RE)     "RESULT"/ADDRESS LEVEL (2-4)                 
         L     R2,4(RE)            A(ADDRESS INFO FROM CALL)                    
         ST    R2,FULL             SAVE A(ADDRESS)                              
*                                                                               
         CLI   WORK+3,X'0B'        SEE IF SHIPPING ADDRESS                      
         BNE   PIN8G30             NO                                           
*                                                                               
PIN8G25  DS    0H                                                               
         USING PGETADRD,R2                                                      
         OI    240(R1),C' '        SKIP 3 LINES TO GET OUT OF WINDOW            
         MVI   320(R1),C' '                                                     
         MVI   400(R1),C' '                                                     
*                                                                               
         CLI   ADDROPT,C'L'        LABEL WITH SHIP ADDR?                        
         BNE   PIN8G29                                                          
*                                                                               
         LA    RE,449(R1)                                                       
         OC    0(18,RE),0(RE)      SOMETHING THERE?                             
         BZ    PIN8G27                                                          
         LA    RE,80(RE)                                                        
         OC    0(18,RE),0(RE)      SOMETHING THERE?                             
         BZ    PIN8G27                                                          
         LA    RE,80(RE)                                                        
         OC    0(18,RE),0(RE)      SOMETHING THERE?                             
         BNZ   PIN8G29             ONLY TRY 3 LINES                             
*                                                                               
* IF I STILL CAN'T PRINT IT JUST SKIP PRINTING LABEL                            
*                                                                               
PIN8G27  MVC   1(18,RE),=C'SHIP MATERIALS TO:'                                  
         CLI   PUBLANG,C'F'        SEE IF FRENCH PUB                            
         BNE   *+10                                                             
         MVC   1(22,RE),=C'ENVOYEZ LE MATERIEL A:'                              
*                                                                               
PIN8G29  LA    R1,480(R1)           PRINT ADDRESS                               
         MVC   000(30,R1),PGADNAME                                              
         MVC   080(30,R1),PGADLIN1                                              
         MVC   160(30,R1),PGADLIN2                                              
         MVI   240(R1),C' '                                                     
         OC    PGADATTN,SPACES                                                  
         CLC   PGADATTN,SPACES                                                  
         BE    PN8G4                                                            
         XC    80(30,R1),80(R1)                                                 
         XC    160(30,R1),160(R1)  PRINT AFTER ATTN:                            
         MVC   80(5,R1),=C'ATTN-'                                               
         MVC   86(20,R1),PGADATTN                                               
         MVC   160(30,R1),PGADLIN1                                              
         MVC   240(30,R1),PGADLIN2                                              
         MVI   320(R1),C' '                                                     
*                                                                               
PN8G4    CLI   ADR2SW,C'Y'         SECOND ADDRESS?                              
         BNE   PIN8I                                                            
         CLI   TLFXOPT2,C' '                                                    
         BNH   PIN8I               TEL/FAX FROM 2ND ADDR?                       
         MVI   320(R1),C' '        SKIP A LINE                                  
         CLI   TLFXOPT2,C'T'       TELEPHONE ONLY-2ND ADDRESS                   
         BE    PN8G6                                                            
         CLI   TLFXOPT2,C'B'       OR TELEPHONE AND FAX                         
         BE    PN8G6                                                            
         B     PN8G8                                                            
*                                                                               
PN8G6    MVC   400(3,R1),=C'TEL'                                                
         MVC   400+4(L'PGADTEL,R1),PGADTEL                                      
*                                                                               
PN8G8    DS    0H                                                               
         CLI   TLFXOPT2,C'F'       FAX ONLY- 2ND ADDRESS                        
         BE    PN8G9                                                            
         CLI   TLFXOPT2,C'B'       OR FAX AND TELEPHONE                         
         BNE   PN8G9X              NO - DONE                                    
PN8G9    CLC   PGADFAX,SPACES                                                   
         BNH   PN8G9X              NO FAX THEN DONE                             
         MVC   400+L'PGADTEL+6(3,R1),=C'FAX'                                    
         MVC   400+L'PGADTEL+10(L'PGADFAX,R1),PGADFAX                           
*                                                                               
PN8G9X   MVI   480(R1),C' '                                                     
         B     PIN8I                                                            
*                                                                               
PIN8G30  DS    0H                  NO SHIPPING ADDRESS FOUND -                  
         EJECT                                                                  
*                                                                               
GETCONR  DS    0H                  FIND AND PRINT CONTRACT REP                  
         B     GETC5               (ADDROPT = C)                                
*                                                                               
GETC5    DS    0H                  TRY FOR REP                                  
         MVI   ELCODE,X'14'                                                     
         LA    R2,PUBREC+33                                                     
*                                                                               
GETC27B  DS    0H                                                               
         BRAS  RE,NXTEL                                                         
         BNE   PIN8I                                                            
         USING PUBREPEL,R2                                                      
         CLC   PUBRPOFF,=3X'FF'                                                 
         BE    GETC27D                                                          
         CLC   PUBRPOFF,PCLTKCLT                                                
         BE    GETC27D                                                          
         CLI   PUBRPOFF,X'FF'                                                   
         BNE   GETC27B                                                          
         CLC   PUBRPOFF+1(1),PCLTOFF                                            
         BNE   GETC27B                                                          
*                                                                               
GETC27D  DS    0H                                                               
*                                                                               
* TEST ANY OVERRIDES                                                            
*                                                                               
GETC27G  OC    PUBPAREP(12),PUBPAREP                                            
         BZ    GETC27B                                                          
         LA    RF,PUBCNREP                                                      
         OC    0(4,RF),0(RF)       CHK FOR CON REP                              
         BZ    PIN8I               NONE                                         
*                                                                               
         XC    WORK(32),WORK                                                    
         MVC   WORK(2),PUBKAGY                                                  
         MVC   WORK+2(1),PRQMED                                                 
         MVI   WORK+3,X'11'                                                     
         MVC   WORK+4(4),0(RF)                                                  
         CLC   WORK(25),PREPKEY                                                 
         BE    GETC30                                                           
         MVC   KEY,WORK                                                         
         GOTOR HIGH                                                             
         CLC   KEY(8),KEYSAVE                                                   
         BNE   PIN8I               REP NOT FOUND                                
*                                                                               
         LA    R0,PREPREC                                                       
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         B     GETC30                                                           
*                                                                               
GETC30   DS    0H                                                               
         OI    240(R1),C' '        SKIP 3 LINES TO GET OUT OF WINDOW            
         MVI   320(R1),C' '                                                     
         MVI   400(R1),C' '                                                     
         LA    R1,480(R1)                                                       
*                                                                               
         MVC   000(30,R1),PREPNAME                                              
         MVC   080(30,R1),PREPLIN1                                              
         MVC   160(30,R1),PREPLIN2                                              
         MVI   240(R1),C' '                                                     
         CLI   PREPATTN,0                                                       
         BE    GETC30X                                                          
         CLI   PREPATTN,C' '                                                    
         BE    GETC30X                                                          
*                                                                               
* ATTENTION NOW BEFORE ADDRESS, SO ZIP WILL BE IN LAST LINE                     
*                                                                               
         XC    080(30,R1),080(R1)                                               
         XC    160(30,R1),160(R1)                                               
         MVC   080(5,R1),=C'ATTN-'                                              
         MVC   086(20,R1),PREPATTN                                              
         MVC   160(30,R1),PREPLIN1                                              
         MVC   240(30,R1),PREPLIN2                                              
         MVI   320(R1),C' '                                                     
*                                                                               
GETC30X  DS    0H                                                               
         CLI   TLFXOPT2,C' '                                                    
         BNH   PIN8I                                                            
         CLI   TLFXOPT2,C'N'                                                    
         BE    PIN8I                                                            
         CLI   TLFXOPT2,C'T'       TELEPHONE FOR 2ND ADDRESS                    
         BE    GETC40                                                           
         CLI   TLFXOPT2,C'B'       OR BOTH TELEPHONE AND FAX                    
         BE    GETC40                                                           
         B     GETC50                                                           
*                                                                               
GETC40   OC    PREPTEL,SPACES                                                   
         CLC   PREPTEL,SPACES      SEE IF THERE                                 
         BE    GETC50                                                           
         MVC   400(3,R1),=C'TEL'                                                
         MVC   400+4(L'PREPTEL,R1),PREPTEL                                      
*                                                                               
GETC50   CLI   TLFXOPT2,C'F'       FAX FOR 2ND ADDRESS                          
         BE    GETC60                                                           
         CLI   TLFXOPT2,C'B'       OR BOTH TELEPHONE AND FAX                    
         BE    GETC60                                                           
         B     GETC70                                                           
*                                                                               
GETC60   OC    PREPFAX,SPACES                                                   
         CLC   PREPFAX,SPACES      SEE IF THERE                                 
         BE    GETC70                                                           
         MVC   400+L'PREPTEL+6(3,R1),=C'FAX'                                    
         MVC   400+L'PREPTEL+10(L'PREPFAX,R1),PREPFAX                           
*                                                                               
GETC70   MVI   480(R1),C' '                                                     
         B     PIN8I                                                            
*                                                                               
PIN8H    DS    0H                  GET HERE IF ADDROPT WAS 2 OR Y               
*                                                                               
* FIRST BYTE OF REP MAY HAVE BEEN SET TO 0 AT PIN8G5                            
*                                                                               
         MVC   PREPKEY(1),BYTE     RESTORE                                      
*                                                                               
PIN8I    LA    R3,SPACEND          PRINT REASONS + ADDRESS                      
*                                                                               
PIN8J    DS    0H                                                               
         OC    0(80,R3),0(R3)                                                   
         BZ    CKPBRPX                                                          
         MVC   P(80),0(R3)                                                      
         GOTOR AIOPRNT,DMCB,(RC)                                                
         LA    R3,80(R3)                                                        
         B     PIN8J                                                            
*                                                                               
CKPBRPX  J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R2                                                            
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* ADD BUY DOLLARS TO I/O TOTALS (EVEN IF TOTOPT IS "N")                         
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
ADDDOLS  NTR1   BASE=*,LABEL=*                                                  
*                                                                               
         L     R1,IOBUYS                                                        
         LA    R1,1(R1)                                                         
         ST    R1,IOBUYS                                                        
         L     R1,IOGROSS                                                       
         A     R1,GROSS                                                         
         ST    R1,IOGROSS                                                       
         L     R1,IONET                                                         
         A     R1,GROSS                                                         
         S     R1,AGYCOM                                                        
         ST    R1,IONET                                                         
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
ADDESTN  NTR1   BASE=*,LABEL=*                                                  
*                                                                               
         CLI   ESTOPT,C'D'         NUMBER AND NAME                              
         BE    ADDEN1                                                           
         CLI   ESTOPT,C'Y'                                                      
         BNE   ADDESTNX                                                         
*                                                                               
ADDEN1   LA    RE,ESTLIST          ADD EST NUMBER TO LIST                       
         LA    RF,200              FOR BCT MAX ESTS                             
*                                                                               
ADDEN2   CLC   0(2,RE),PBUYKEST                                                 
         BE    ADDESTNX                                                         
         OC    0(2,RE),0(RE)                                                    
         BZ    ADDEN3                                                           
         LA    RE,2(RE)                                                         
         BCT   RF,ADDEN2                                                        
         DC    H'0'                TOO MANY ESTS                                
*                                                                               
ADDEN3   MVC   0(2,RE),PBUYKEST                                                 
*                                                                               
ADDESTNX J     EXIT                                                             
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
ADDADS   NTR1   BASE=*,LABEL=*                                                  
*                                                                               
ADDAN1   L     RE,AADLIST          ADD AD CODES TO LIST                         
         LA    RF,200              FOR BCT MAX ADS  (200)                       
*                                                                               
ADDAN2   CLC   1(6,RE),PBDJOB                                                   
         BE    ADDASTNX                                                         
         OC    0(7,RE),0(RE)                                                    
         BZ    ADDAN3                                                           
         LA    RE,16(RE)                                                        
         BCT   RF,ADDAN2                                                        
         DC    H'0'                TOO MANY ADS                                 
*                                                                               
ADDAN3   MVC   1(6,RE),PBDJOB                                                   
*                                                                               
ADDASTNX J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
SETLAST  NTR1   BASE=*,LABEL=*     FIND LAST IO ELEM                            
*                                                                               
         MVI   FULL,1              SET FOR DATE COMPARISON                      
         XC    LASTIOEL,LASTIOEL                                                
*                                                                               
* MAKE SURE THIS BUY NOT ALREADY ON THIS INSERTION ORDER                        
*                                                                               
         OC    BUYDALST+4(4),BUYDALST+4                                         
         BZ    SETL1                                                            
         MVC   KEY(25),PBUYKEY                                                  
         GOTOR READ                                                             
         BRAS  RE,TSTERR                                                        
         LA    R4,BUYDALST+4                                                    
SETL0    CLC   KEY+27(4),0(R4)                                                  
         BE    SETL10                                                           
         LA    R4,4(R4)                                                         
         C     R4,BUYDALST         TEST EOL                                     
         BNH   SETL0                                                            
*                                                                               
SETL1    LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,PWIOELCQ     WEB IO ELEM CODE                             
         BRAS  RE,NXTEL                                                         
         BNE   SETL2                                                            
         ST    R2,LASTIOEL         SAVE LATEST                                  
         BRAS  RE,NXTEL                                                         
         BNE   SETL4                                                            
         B     *-12                                                             
*                                                                               
SETL2    LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'70'                                                     
SETL2H   BRAS  RE,NXTEL                                                         
         BNE   SETL4                                                            
         USING PIOELEM,R2                                                       
         CLC   PIODATE,FULL        TEST LATEST                                  
         BL    SETL2H                                                           
         CLC   PIODATE,BIGNDAT     TEST VS CONTROL DATE                         
         BNL   SETL2H                                                           
*                                  TEST RIGHT MULTI Z/E STATUS                  
         MVI   BYTE,C'N'                                                        
         TM    PIOSTAT,X'80'       TEST IO ELEM FROM MULTI                      
         BZ    *+8                                                              
         MVI   BYTE,C'Y'                                                        
         CLC   ZEOPT,BYTE                                                       
         BNE   SETL2H                                                           
*                                                                               
SETL3    ST    R2,LASTIOEL         SAVE LATEST                                  
         B     SETL2H                                                           
         DROP  R2                                                               
*                                                                               
SETL4    DS    0H                                                               
         TM    PBUYCNTL,X'80'                                                   
         BZ    SETL5                                                            
         OC    LASTIOEL,LASTIOEL                                                
         BZ    SETL10                                                           
         CLI   QOPT2,C'Y'          TEST 'NEEDED ONLY' REQ                       
         BNE   SETL4B                                                           
         L     R2,LASTIOEL                                                      
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         BZ    *+16                                                             
         USING PWIOELEM,R2                                                      
         CLI   PWIOMODC,C'D'                                                    
         BE    SETL10                                                           
         B     SETL4B                                                           
         DROP  R2                                                               
*                                                                               
         USING PIOELEM,R2                                                       
         CLI   PIOTYP,C'D'                                                      
         BE    SETL10                                                           
         DROP  R2                                                               
*                                                                               
SETL4B   DS    0H                                                               
         MVI   CHANGSW,C'D'                                                     
         J     EXIT                                                             
*                                                                               
SETL5    DS    0H                                                               
         MVI   CHANGSW,0                                                        
         OC    LASTIOEL,LASTIOEL                                                
         JZ    EXIT                                                             
         L     R2,LASTIOEL                                                      
         CLI   QOPT2,C'Y'          IF 'NEEDED ONLY' REQ                         
         BE    SETL5B                                                           
*                                                                               
* TEST ANY REAL CHANGE, PREVENT DUPLICATE ON SAME DAY                           
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         BZ    *+18                                                             
         USING PWIOELEM,R2                                                      
         CLC   PWIODATE,BTODAY     TEST IO TODAY                                
         BNE   SETL5D                                                           
         B     SETL5A                                                           
         DROP  R2                                                               
*                                                                               
         USING PIOELEM,R2                                                       
         CLC   PIODATE,BTODAY      TEST IO TODAY                                
         BNE   SETL5D                                                           
         DROP  R2                                                               
*                                                                               
SETL5A   CLI   QOPT3,C'T'          OK IF REMOTE                                 
         BE    SETL5D                                                           
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         BZ    *+16                                                             
         USING PWIOELEM,R2                                                      
         CLI   PWIOMIND,0                                                       
         BNE   SETL5D                                                           
         B     SETL5B                                                           
         DROP  R2                                                               
*                                                                               
         USING PIOELEM,R2                                                       
         CLI   PIOTURN,0                                                        
         BNE   SETL10                                                           
         DROP  R2                                                               
*                                  TEST IF ANY 'REAL' CHANGE                    
SETL5B   DS    0H                                                               
         XC    TSLDATE(44),TSLDATE                                              
         GOTO1 ABLDREV,DMCB,(RC),(R2)                                           
*                                                                               
         TM    NEEDOIND,X'80'      "NEEDED ONLY" FOR LEGALW REVISION?           
         BO    SETL5D                                                           
*                                                                               
         OC    TSLDATE(44),TSLDATE                                              
         BZ    SETL10              NO 'REAL' CHANGE                             
*                                                                               
SETL5D   DS    0H                                                               
         MVI   CHANGSW,C'C'                                                     
         J     EXIT                                                             
*                                                                               
SETL10   DS    0H                                                               
         MVI   LASTIOEL,X'FF'                                                   
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
GETPINS  NTR1 BASE=*,LABEL=*       INSTRUCTION REC FOR ADS IN ADLIST            
*                                                                               
         MVC   MATJOB,=6X'FF'      END OF LIST RETURN                           
         L     R2,AADLIST          SEARCH ADLIST                                
GPIN1    OC    0(7,R2),0(R2)       END OF LIST                                  
         BE    GETPINX                                                          
         CLI   0(R2),X'FF'         SEE IF I ALREAD DONE                         
         BNE   GPIN2                                                            
         LA    R2,16(R2)           TRY NEXT AD                                  
         B     GPIN1                                                            
*                                                                               
GPIN2    DS    0H                                                               
         MVC   MATJOB(6),1(R2)                                                  
         MVI   0(R2),X'FF'         SET ALREADY PROCESSED                        
         XC    KEY,KEY                                                          
         MVC   KEY(10),RCSVAGY                                                  
         MVI   KEY+3,X'15'                                                      
         MVC   KEY+10(6),MATJOB                                                 
         MVC   KEY+16(6),TSPUB-STATDIF                                          
         CLI   ZEOPT,C'Y'          IF MULTI ZONE/EDIT                           
         BNE   *+10                                                             
         XC    KEY+20(2),KEY+20    USE ONLY BASE PUB                            
         CLC   KEY(25),PINSREC     ALREADY HAVE                                 
         BE    GPIN5B                                                           
         GOTOR HIGH                                                             
         BRAS  RE,TSTERR                                                        
         TM    KEY+25,X'80'        SEE IF DELETED                               
         BNZ   GPIN4C                                                           
         CLC   KEY(22),KEYSAVE                                                  
         BE    GPIN5                                                            
*                                                                               
GPIN4C   DS    0H                                                               
         MVC   KEYSAVE+16(6),=6X'FF'                                            
         CLC   KEY(22),KEYSAVE     TEST HAVE FF DEFAULT                         
         BE    GPIN5                                                            
         MVC   KEY,KEYSAVE                                                      
         CLI   KEY+(PJOBKJOB-PJOBKEY),C'!'                                      
         BE    GETPINX                                                          
         GOTOR READ                                                             
         BRAS  RE,TSTERR                                                        
*                                                                               
GPIN5    DS    0H                                                               
         CLC   KEY(25),PINSREC                                                  
         BE    GPIN5B              ALREADY HAVE                                 
         LA    R0,PINSREC                                                       
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         BRAS  RE,TSTERR                                                        
*                                                                               
GPIN5B   DS    0H                                                               
GETPINX  DS    0H                                                               
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
ADDCON   NTR1  BASE=*,LABEL=*      FIND CONTRACT AND ADD TO CONTAB              
*                                                                               
         CLI   CONOPT,C'N'                                                      
         BE    ADDCX                                                            
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(3),PBUYREC                                                   
         MVI   KEY+3,X'10'                                                      
         MVC   KEY+4(3),PBUYKCLT                                                
         CLI   PCLTPROF+5,C'2'     SEE IF SLAVE                                 
         BNE   *+10                                                             
         MVC   KEY+4(3),PCLTPROF+6 USE MASTER CLIENT                            
*                                                                               
         MVC   KEY+7(6),PBUYKPUB                                                
         GOTOR HIGH                                                             
         B     ADDC5                                                            
ADDC4    GOTOR SEQ                                                              
*                                                                               
ADDC5    CLC   KEYSAVE(13),KEY                                                  
         BNE   ADDCX                                                            
         GOTO1 DATAMGR,DMCB,GETREC,PRTFILE,KEY+27,PLISREC,DMWORK                
         LA    R5,PLISREC                                                       
         USING PCONRECD,R5                                                      
         CLC   PCONSDT,PBUYKDAT                                                 
         BH    ADDC4                                                            
         CLC   PCONEDT,PBUYKDAT                                                 
         BL    ADDC4                                                            
         CLI   PCONPRD,C' '        SEE IF A PRODUCT CONTRACT                    
         BNH   ADDC8                                                            
         CLC   PCONPRD,PBUYKPRD                                                 
         BNE   ADDC4                                                            
*                                                                               
ADDC8    DS    0H                                                               
         LA    R4,CONTAB                                                        
ADDC9    CLC   0(2,R4),PCONNUM     SEE IF IN TABLE                              
         BE    ADDCX                                                            
         CLC   0(2,R4),=X'0000'                                                 
         BE    ADDC10                                                           
         LA    R4,CONLEN(R4)                                                    
         LA    RE,CONTABX                                                       
         CR    R4,RE                                                            
         BL    ADDC9                                                            
         DC    H'0'                NO MORE ROOM IN CONTAB                       
*                                                                               
ADDC10   MVC   0(2,R4),PCONNUM                                                  
         MVC   2(6,R4),PCONSDT     SAVE START AND END DATE                      
*                                                                               
         MVI   ELCODE,X'20'                                                     
         LA    R2,PCONREC+33                                                    
         BRAS  RE,NXTEL                                                         
         BNE   ADDCX                                                            
*                                                                               
         USING PRBELEM,R2                                                       
         MVC   8(1,R4),PRBLIND                                                  
         MVC   9(5,R4),PRBLEVEL                                                 
         MVC   14(3,R4),PRBDATE    EFFECTIVE DATE                               
*                                                                               
ADDCX    J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R2,R5                                                         
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
SET_LANG NTR1  BASE=*,LABEL=*      SET DATA DICTIONARY                          
*                                                                               
         L     R3,ADICSECT                                                      
         USING DICSECTP,R3                                                      
         XC    DMCB,DMCB                                                        
         LA    R1,DMCB                                                          
         USING DICTATED,R1                                                      
         MVI   DDACTN,DDACTNL      TRANSLATE LIST                               
         MVI   DDRETN,DDCASEU                                                   
         MVI   DDSYS,4                                                          
         MVI   DDLANG,0            DEFAULT TO ENGLISH                           
         CLI   FULL,C'F'                                                        
         BNE   *+8                                                              
         MVI   DDLANG,4            4 IS FRENCH                                  
         LA    RF,DCLIST                                                        
         STCM  RF,7,DDIADR                                                      
         LA    RF,DSLIST                                                        
         STCM  RF,7,DDOADR                                                      
         L     RF,VCOMFACS                                                      
         USING COMFACSD,RF                                                      
         GOTO1 CDICTATE                                                         
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R1,R3,RF                                                      
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
DISPESTN NTR1  BASE=*,LABEL=*      DISPLAY EST # AND NAMES                      
*                                                                               
         SR    R4,R4               COUNTER - ENTRIES FOR SORTER                 
         LA    R5,ESTLIST                                                       
*                                                                               
PIN12Q2  OC    0(2,R5),0(R5)                                                    
         BZ    PIN12Q4             LAST                                         
         LA    R5,2(R5)                                                         
         LA    R4,1(R4)                                                         
         B     PIN12Q2                                                          
*                                                                               
PIN12Q4  DS    0H                                                               
         GOTO1 XSORT,DMCB,(0,ESTLIST),(R4),2,2,0                                
*--->    LA    R4,P+14             PRINT EST NUMBERS                            
*--->    MVC   P+5(8),=C'EST NO.='                                              
*                                                                               
         LA    R5,ESTLIST                                                       
*                                                                               
PIN12Q5  L     RF,ADICSECT                                                      
         USING DICSECTP,RF                                                      
*                                                                               
         MVC   P+5(L'PP@IOP11),PP@IOP11                                         
         DROP  RF                                                               
*                                                                               
* MUST READ ESTIMATE USING AGY/MED/CLT/PRD OF PJOBREC                           
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(10),RCSVAGY                                                  
         MVI   KEY+3,X'07'                                                      
         MVC   KEY+10(2),0(R5)     EST                                          
         CLC   PESTREC(13),KEY     SEE IF I ALREADY HAVE                        
         BE    PIN12Q7                                                          
         GOTOR READ                                                             
         BRAS  RE,TSTERR                                                        
*                                                                               
         LA    R0,PESTREC          READ INTO PESTREC                            
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN12Q7  DS    0H                                                               
         LH    R0,0(R5)            EST                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+15(3),DUB                                                      
         MVC   P+20(L'PESTNAME),PESTNAME                                        
         MVC   PSECOND+20(L'PESTNAM2),PESTNAM2                                  
         GOTOR AIOPRNT,DMCB,(RC)                                                
         LA    R5,2(R5)            NEXT ESTIMATE                                
         OC    0(2,R5),0(R5)       END OF LIST                                  
         BNZ   PIN12Q5                                                          
*                                                                               
         LA    R0,ESTLIST                                                       
         LHI   R1,400                                                           
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
DISPEST# NTR1  BASE=*,LABEL=*      DISPLAY EST #                                
*                                                                               
         SR    R4,R4               COUNTER - ENTRIES FOR SORTER                 
         LA    R5,ESTLIST                                                       
*                                                                               
PIN12K2  OC    0(2,R5),0(R5)                                                    
         BZ    PIN12K4             LAST                                         
         LA    R5,2(R5)                                                         
         LA    R4,1(R4)                                                         
         B     PIN12K2                                                          
*                                                                               
PIN12K4  DS    0H                                                               
         GOTO1 XSORT,DMCB,(0,ESTLIST),(R4),2,2,0                                
*                                                                               
*--->    LA    R4,P+14             PRINT EST NUMBERS                            
*--->    MVC   P+5(8),=C'EST NO.='                                              
*                                                                               
         L     RF,ADICSECT                                                      
         USING DICSECTP,RF                                                      
*                                                                               
         MVC   P+5(L'PP@IOP11),PP@IOP11                                         
         OC    ESTLIST+2(2),ESTLIST+2                                           
         BZ    PIN12L                                                           
*                                                                               
PIN12K6  DS    0H                                                               
*--->    LA    R4,P+15                                                          
*--->    MVC   P+5(9),=C'EST NOS.='                                             
         MVC   P+5(L'PP@IOP12),PP@IOP12                                         
         DROP  RF                                                               
*                                                                               
PIN12L   DS    0H                                                               
         LA    R4,P+16                                                          
PIN12L2  CLI   0(R4),C' '                                                       
         BH    PIN12L5                                                          
         BCT   R4,PIN12L2                                                       
*                                                                               
PIN12L5  DS    0H                                                               
         LA    R4,2(R4)                                                         
         LA    R5,ESTLIST                                                       
*                                                                               
PIN12M   OC    0(2,R5),0(R5)                                                    
         BZ    PIN12N              DONE                                         
         LH    R0,0(R5)                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(3,R4),DUB                                                      
         OC    2(2,R5),2(R5)       SEE IF ANY MORE ESTS                         
         BZ    PIN12N              NO - DONE                                    
         MVI   3(R4),C','                                                       
         LA    R4,4(R4)                                                         
         LA    R5,2(R5)                                                         
         B     PIN12M              DO NEXT EST                                  
*                                                                               
PIN12N   GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
         LA    R0,ESTLIST                                                       
         LHI   R1,400                                                           
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
DISPCONT NTR1  BASE=*,LABEL=*      DISPLAY CONTRACT INFO                        
*                                                                               
         L     RF,ADICSECT                                                      
         USING DICSECTP,RF                                                      
*                                                                               
         CLI   CONOPT,C'N'         SEE IF DISPLAY CONTRACT INFO                 
         BE    PIN14                                                            
         CLC   CONTAB(2),=X'0000'                                               
         BE    PIN14               NO CONTRACTS                                 
*--->    MVC   P+5(9),=C'CONTRACT='                                             
         MVC   P+5(L'PP@CONTR),PP@CONTR                                         
         CLC   CONTAB+CONLEN(2),=X'0000'                                        
         BE    PIN13B                                                           
*--->    MVC   P+5(10),=C'CONTRACTS='                                           
         MVC   P+5(L'PP@CONTS),PP@CONTS                                         
         DROP   RF                                                              
*                                                                               
PIN13B   DS    0H                                                               
         LA    R5,CONTAB                                                        
PIN13C   CLC   0(2,R5),=X'0000'                                                 
         BE    PIN13X                                                           
*                                                                               
         LA    R4,P+15                                                          
         CLC   CONTAB+CONLEN(2),=X'0000'                                        
         BE    *+8                                                              
         LA    R4,P+16                                                          
*                                                                               
         CLI   CONOPT,C'L'         SEE IF ONLY SHOWING LEVEL                    
         BNE   PIN13D                                                           
         CLI   8(R5),0             CHECK FOR LEVEL IND                          
         BE    PIN13I              SKIP THIS CONTRACT                           
*                                                                               
PIN13D   MVC   HALF,0(R5)                                                       
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(3,R4),DUB                                                      
*                                                                               
         LA    R4,4(R4)                                                         
         CLI   CONOPT,C'L'         SEE IF ONLY SHOWING LEVEL                    
         BE    PIN13E                                                           
         GOTO1 DATCON,DMCB,(3,2(R5)),(5,WORK)                                   
         CLI   SVLANG,C'F'                                                      
         BNE   *+8                                                              
         BRAS  RE,FRDATE                                                        
         MVC   0(8,R4),WORK                                                     
         MVI   8(R4),C'-'                                                       
         GOTO1 DATCON,DMCB,(3,5(R5)),(5,WORK)                                   
         CLI   SVLANG,C'F'                                                      
         BNE   *+8                                                              
         BRAS  RE,FRDATE                                                        
         MVC   9(8,R4),WORK                                                     
         CLI   CONOPT,C'D'         SEE IF ONLY SHOWING DATES                    
         BE    PIN13H                                                           
         LA    R4,18(R4)                                                        
*                                                                               
PIN13E   DS    0H                                                               
         CLI   8(R5),X'00'         CHECK FOR LEVEL IND                          
         BE    PIN13H                                                           
         CLI   8(R5),C'S'          SPECIAL                                      
         BNE   PIN13F                                                           
         MVC   0(7,R4),=C'SPECIAL'                                              
         B     PIN13H                                                           
*                                                                               
PIN13F   CP    9(5,R5),=P'0'       CHECK FOR NO LEVEL                           
         BE    PIN13H                                                           
         CLI   8(R5),C'$'          $ VOLUME                                     
         BE    PIN13F5                                                          
         CLI   8(R5),C'N'          OR NET $ VOLUME                              
         BE    PIN13F5             DISPLAY EITHER WITH $ IN FRONT               
         B     PIN13F8                                                          
*                                                                               
PIN13F5  DS    0H                                                               
         EDIT  (P5,9(R5)),(10,0(R4)),0,COMMAS=YES,ALIGN=LEFT,FLOAT=$            
         B      PIN13H                                                          
*                                                                               
PIN13F8  DS    0H                                                               
         EDIT  (P5,9(R5)),(10,0(R4)),0,COMMAS=YES,ALIGN=LEFT                    
         LA    RE,0(R4)                                                         
         AR    RE,R0                                                            
*                                                                               
         L     RF,ADICSECT                                                      
         USING DICSECTP,RF                                                      
*                                                                               
*--->    MVC   2(5,RE),=C'TIMES'                                                
         MVC   2(L'PP@TIMS,RE),PP@TIMS                                          
         CLI   8(R5),C'X'                                                       
         BE    PIN13H                                                           
*--->    MVC   2(5,RE),=C'LINES'                                                
         MVC   2(L'PP@LINE,RE),PP@LINE                                          
         CLI   8(R5),C'L'                                                       
         BE    PIN13H                                                           
         MVC   2(5,RE),=C'PAGES'                                                
         CLI   8(R5),C'P'                                                       
         BE    PIN13H                                                           
*--->    MVC   2(6,RE),=C'INCHES'                                               
         MVC   2(L'PP@INCH,RE),PP@INCH                                          
         CLI   8(R5),C'I'                                                       
         BE    PIN13H                                                           
         MVC   2(6,RE),=C'ISSUES'                                               
         CLI   8(R5),C'U'                                                       
         BE    PIN13H                                                           
         MVC   2(6,RE),SPACES      UNKNOWN LEVEL INDICATOR                      
         MVC   2(1,RE),8(R5)       JUST DISPLAY IT - DON'T DIE                  
         B     PIN13H                                                           
         DROP  RF                                                               
*                                                                               
PIN13H   GOTOR AIOPRNT,DMCB,(RC)                                                
PIN13I   LA    R5,CONLEN(R5)                                                    
         B     PIN13C                                                           
*                                                                               
PIN13X   MVC   P(30),SPACES        CLEAR IN CASE NOTHING IS PRINTED             
*                                                                               
PIN14    DS    0H                                                               
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
DISPTOTL NTR1  BASE=*,LABEL=*      DISPLAY TOTAL INFO                           
*                                                                               
         CLI   TOTOPT,C'N'         PRINTING TOTALS?                             
         BE    PIN16                                                            
         OC    IOGROSS(8),IOGROSS  ANY $ GROSS AND NET?                         
         BZ    PIN16               SKIP TOTALS                                  
         MVC   P+5(5),=C'TOTAL'                                                 
         CLI   TOTOPT,C'B'         SHOW BOTH GROSS AND NET?                     
         BNE   PIN14B                                                           
         MVI   P+10,C'S'                                                        
         CLI   SVLANG,C'F'         SEE IF FRENCH I/O                            
         BNE   PIN14B                                                           
         MVC   P+5(6),=C'TOTAUX'                                                
*                                                                               
PIN14B   DS    0H                                                               
         LA    R5,P+12                                                          
         CLI   TOTOPT,C'T'         ONLY SHOWING NET                             
         BE    PIN14N                                                           
*                                                                               
* NOTE CAN'T USE CURED SINCE IT GETS COUNTRY AND LANGUAGE FROM =V(SSB)          
*                                                                               
         EDIT  (B4,IOGROSS),(14,0(R5)),2,ALIGN=LEFT,CR=YES,COMMAS=YES           
         CLI   SVLANG,C'F'         SEE IF FRENCH                                
         BNE   PIN14BX                                                          
         LR    R1,R5                                                            
         LA    RE,14               FOR BCT                                      
PIN14B2  CLI   0(R1),C','                                                       
         BNE   PIN14B4                                                          
         MVI   0(R1),C' '          CHANGE COMMA TO SPACE                        
PIN14B4  LA    R1,1(R1)                                                         
         BCT   RE,PIN14B2                                                       
*                                                                               
         LR    R1,R5                                                            
         LA    RE,14               FOR BCT                                      
PIN14B6  CLI   0(R1),C'.'                                                       
         BNE   PIN14B8                                                          
         MVI   0(R1),C','          CHANGE PERIOD TO COMMA                       
PIN14B8  LA    R1,1(R1)                                                         
         BCT   RE,PIN14B6                                                       
*                                                                               
PIN14BX  DS    0H                                                               
         LA    R5,P+26                                                          
         CLI   0(R5),C' '          SCAN BACKWARD FOR NONE SPACE                 
         BH    *+8                                                              
         BCT   R5,*-8                                                           
*                                                                               
         L     RF,ADICSECT                                                      
         USING DICSECTP,RF                                                      
*                                                                               
         MVC   2(L'PP@GROSP,R5),PP@GROSP                                        
         CLI   TOTOPT,C'G'         SEE IF SHOW ONLY GROSS                       
         BE    PIN14P              THEN DONE                                    
         LA    R5,L'PP@GROSP+3(R5)                                              
*                                                                               
PIN14N   DS    0H                                                               
         EDIT  (B4,IONET),(14,0(R5)),2,ALIGN=LEFT,CR=YES,COMMAS=YES             
         CLI   SVLANG,C'F'         SEE IF FRENCH                                
         BNE   PIN14NX                                                          
         LR    R1,R5                                                            
         LA    RE,14               FOR BCT                                      
PIN14N2  CLI   0(R1),C','                                                       
         BNE   PIN14N4                                                          
         MVI   0(R1),C' '          CHANGE COMMA TO SPACE                        
PIN14N4  LA    R1,1(R1)                                                         
         BCT   RE,PIN14N2                                                       
*                                                                               
         LR    R1,R5                                                            
         LA    RE,14               FOR BCT                                      
PIN14N6  CLI   0(R1),C'.'                                                       
         BNE   PIN14N8                                                          
         MVI   0(R1),C','          CHANGE PERIOD TO COMMA                       
PIN14N8  LA    R1,1(R1)                                                         
         BCT   RE,PIN14N6                                                       
*                                                                               
PIN14NX  DS    0H                                                               
         LA    R5,14(R5)                                                        
         CLI   0(R5),C' '          SCAN BACKWARD FOR NONE SPACE                 
         BH    *+8                                                              
         BCT   R5,*-8                                                           
*                                                                               
         L     RF,ADICSECT                                                      
         MVC   2(L'PP@NETP,R5),PP@NETP                                          
         DROP  RF                                                               
*                                                                               
PIN14P   DS    0H                                                               
         GOTOR AIOPRNT,DMCB,(RC)                                                
         XC    IOCNTS,IOCNTS       CLEAR ALL IO COUNTERS                        
*                                                                               
PIN16    DS    0H                                                               
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
MARKBUYR NTR1  BASE=*,LABEL=*      MARK BUY RECORD                              
*                                                                               
         MOVE  (SPACEND,4000),PBUYREC                                           
*                                                                               
         L     R5,BUYDALST                                                      
         LA    R0,BUYDALST+4                                                    
         SR    R5,R0                                                            
         SRL   R5,2                R5 = NUMBER OF RECORDS                       
         LA    R3,1                R3 = THIS RECCORD NUMBER                     
         LA    R4,BUYDALST+4       FIRST DA                                     
         LA    R0,PBUYREC                                                       
         ST    R0,AREC                                                          
*                                                                               
PIN18    DS    0H                                                               
         OC    0(4,R4),0(R4)                                                    
         BZ    PIN24               EOL                                          
         MVC   KEY+27(4),0(R4)                                                  
         OI    DMINBTS,X'C0'                                                    
         GOTOR GETPRT                                                           
         BRAS  RE,TSTERR                                                        
*                                                                               
* IF MULTI-AD MODE GET REPEAT DATE AND PUB FROM ADLIST                          
*                                                                               
         CLI   MULTIAD,C'Y'                                                     
         BNE   PIN20                                                            
         L     RE,AADLIST                                                       
         OC    17(6,RE),17(RE)     SEE IF ONLY ONE AD                           
         BZ    PIN20                                                            
*                                                                               
* SET REPEAT DATE AND PUB FROM ADLIST                                           
*                                                                               
PIN18A2  CLC   1(6,RE),PBDJOB                                                   
         BE    PIN18A4                                                          
         LA    RE,16(RE)           NEXT ENTRY                                   
         OC    0(7,RE),0(RE)       END OF TABLE                                 
         BNZ   PIN18A2                                                          
*                                                                               
         DC    H'0'                AD CODE NOT IN TABLE - HOW?                  
*                                                                               
PIN18A4  MVC   BRPTDAT,7(RE)       SET REPEAT DATE AND PUB FROM ADLIST          
         MVC   RPTPUB,10(RE)                                                    
*                                                                               
PIN20    DS    0H                  CREATE NEW PIOELEM                           
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         BZ    *+12                                                             
         BRAS  RE,BLDWIOEL                                                      
         B     PIN22F5                                                          
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'70'                                                     
*                                                                               
PIN20B   DS    0H                                                               
         BRAS  RE,NXTEL                                                         
         BNE   PIN21                                                            
         USING PIOELEM,R2                                                       
         OC    PIODATE,PIODATE                                                  
         BNZ   PIN20B                                                           
*                                                                               
* SEE IF A REPEAT PUB IS PRESENT AND IF SO, DOES IT MATCH BUY?                  
*                                                                               
         OC    RPTPUB,RPTPUB       CHECK FOR REPEAT PUB                         
         BZ    PIN22                                                            
         CLC   RPTPUB,PBUYKPUB     SEE IF IT MATCHES BUY                        
         BE    PIN22                                                            
*                                                                               
* MUST DELETE SMALL EMPTY ELEM AND ADD BIG ONE                                  
*                                                                               
         GOTOR VRECUP,DMCB,(1,PBUYREC),(R2),0                                   
*                                                                               
         MVC   HALF,PBUYREC+25                                                  
         LH    RE,HALF                                                          
         LA    RF,PBUYREC                                                       
         AR    RF,RE                                                            
         XC    0(2,RF),0(RF)       CLEAR END OF RECORD                          
*                                                                               
         B     PIN20                                                            
*                                                                               
PIN21    DS    0H                                                               
         XC    W,W                                                              
         MVI   W,X'70'             ELEM CODE                                    
         MVI   W+1,50              ELEM LENGTH                                  
*                                                                               
         OC    RPTPUB,RPTPUB       CHECK FOR REPEAT PUB                         
         BZ    PIN21C                                                           
         CLC   RPTPUB,PBUYKPUB     SEE IF IT MATCHES BUY                        
         BE    PIN21C                                                           
         MVI   W+1,56              TO STORE REPEAT PUB (BIG ELEMENT)            
*                                                                               
PIN21C   DS    0H                                                               
         CLC   PBUYREC+25(2),=H'3900'                                           
         BL    *+6                                                              
         DC    H'0'                RECORD IS 100 BYTES TO MAX                   
*                                                                               
         GOTOR VRECUP,DMCB,(1,PBUYREC),W,(R2)                                   
*                                                                               
PIN22    DS    0H                                                               
         MVC   PIODATE,BTODAY                                                   
         MVC   PIONUM(2),REFNO                                                  
         STC   R3,PIONUM+2         THIS REC NO                                  
         STC   R5,PIONUM+3         NO. OF RECS                                  
         MVI   PIOTYP,C'N'                                                      
         CLI   TSCHGSW-STATDIF,0                                                
         BE    *+10                                                             
         MVC   PIOTYP,TSCHGSW-STATDIF                                           
         MVI   PIOTURN,C'T'                                                     
         CLI   QOPT3-QRECORD+SAVEQ,C'A'                                         
         BE    PIN22A                                                           
         MVI   PIOTURN,0                                                        
         CLI   QOPT3-QRECORD+SAVEQ,C'T'                                         
         BE    PIN22A                                                           
         MVI   PIOTURN,C'R'        REQUEST                                      
*                                                                               
PIN22A   DS    0H                                                               
         CLI   QOPT7-QRECORD+SAVEQ,C'F'                                         
         BNE   *+8                                                              
         MVI   PIOFAX,C'F'                                                      
*                                                                               
         MVC   PIORPTDT,BRPTDAT                                                 
         CLI   SVIGNDAT,X'FF'      NO CONTROL DATE                              
         BE     *+10                                                            
         MVC   PIOCDATE,SVIGNDAT                                                
*                                                                               
PIN22B   DS    0H                                                               
         MVC   PIOIDATE,PBUYKDAT                                                
         CLI   PBUYKMED,C'N'                                                    
         BE    PIN22D                                                           
*                                                                               
         MVC   PIOSPACE,PBDSPACE                                                
         B     PIN22F                                                           
*                                                                               
PIN22D   DS    0H                                                               
         ZAP   PIOUNITS,PBDUNITS                                                
         ZAP   PIOCLMS,PBDCLMS                                                  
         MVC   PIOUIND,PBDUIND                                                  
         MVC   PIOPRM(1),PBDCL                                                  
         MVC   PIOSAU,PBDSPACE                                                  
*                                                                               
PIN22F   DS    0H                                                               
         MVC   PIOJOB,PBDJOB                                                    
         CLI   ZEOPT,C'Y'          TEST MULTI Z/E                               
         BNE   *+8                                                              
         OI    PIOSTAT,X'80'                                                    
*                                                                               
* NOTE: LEGAL WARNING CODES CAN BE A,B,C,D OR NULL (X IS NOT RECORDED!)         
*       QUARTERLY CODES CAN BE     1,2,3,4 OR NULL (X IS NOT RECORDED!)         
*                                                                               
         CLI   MULTOPT,C'Y'        MULTI INSERTS PER IO                         
         BE    PIN22F4             YES                                          
         MVC   PIOLWCD,LWCCODE     LEGAL WARNING CODE (IF PRESENT)              
         MVC   PIOQUCD,QUCCODE     QUARTERLY CODE (IF PRESENT)                  
*                                                                               
PIN22F4  OC    RPTPUB,RPTPUB       CHECK FOR REPEST PUB                         
         BZ    PIN22F5                                                          
         CLC   RPTPUB,PBUYKPUB     SEE IF IT MATCHES BUY                        
         BE    PIN22F5                                                          
         CLI   PIOELEM+1,56        BE SURE IT IS A BIG ELEM                     
         BL    PIN22F5                                                          
*                                                                               
* SHOULDN'T HAPPEN, BUT IF IT DOES, REPEAT PUB WILL NOT BE SAVED                
*                                                                               
         MVC   PIORPUB,RPTPUB      STORE REPEAT PUB - IN BIG ELEMENT            
*                                                                               
PIN22F5  DS    0H                  FINISH BUILDING IO ELEM                      
         XC    PBDIODAT,PBDIODAT                                                
*                                                                               
         BRAS  RE,BLDSUBAC         BUILD SUB AD CODE ELEM                       
*                                                                               
         CLI   RCWRITE,C'Y'                                                     
         BNE   PIN22H                                                           
         GOTOR PUTPRT              WRITE BUY REC                                
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN22H   DS    0H                                                               
         LA    R4,4(R4)            NEXT DISK ADDRESS                            
         LA    R3,1(R3)                                                         
         GOTO1 AWFMOD,DMCB,(R2)    POST TO REGISTER                             
         B     PIN18                                                            
*                                                                               
PIN24    DS    0H                                                               
*                                                                               
* DO NOT RESOTRE CURRENT BUY REC IF SAME KEY AS LAST POSTED                     
*                                                                               
         CLC   PBUYREC(25),SPACEND                                              
         BNE   PIN24A                                                           
         CLI   0(R2),X'70'         BE SURE IT POINTS TO AN I/O ELEM             
         BNE   PIN24B                                                           
         OC    2(3,R2),2(R2)       CHECK FOR DATE                               
         BZ    PIN24B                                                           
*                                                                               
         ST    R2,LASTIOEL         BEFORE STORING IN LASTIOEL                   
         B     PIN24B                                                           
*                                                                               
PIN24A   MOVE  (PBUYREC,4000),SPACEND                                           
*                                                                               
PIN24B   DS    0H                                                               
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R2                                                            
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
BLDWIOEL NTR1  BASE=*,LABEL=*      BUILD WEB IO ELEM                            
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                                                             
*                                                                               
         CLI   RCWRITE,C'Y'                                                     
         BNE   WIOEL10             NO NEED TO CK IF WRITE=NO                    
*                                                                               
         NI    WKEIOFLG,X'FF'-(E_IOBMFQ+E_IOBMTQ)                               
         LA    R2,PBUYREC+33                                                    
         USING PBYMELEM,R2                                                      
         MVI   ELCODE,PBYMELCQ     BUY MOVE ELEM CODE                           
WIOEL02  BRAS  RE,NXTEL                                                         
         BNE   WIOEL03                                                          
         TM    PBYMSTAT,PBYMFROQ   MOVED "FROM"?                                
         BZ    *+8                                                              
         OI    WKEIOFLG,E_IOBMFQ   CONTAIN BUY MOVE "FROM" ELEM                 
         TM    PBYMSTAT,PBYMTO_Q   MOVED "TO"?                                  
         BZ    *+8                                                              
         OI    WKEIOFLG,E_IOBMTQ   CONTAIN BUY MOVE "TO"   ELEM                 
         B     WIOEL02                                                          
*                                                                               
WIOEL03  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'70'        REMOVE BLANK IO ELEM                         
WIOEL05  BRAS  RE,NXTEL                                                         
         BNE   WIOEL10                                                          
         OC    2(3,R2),2(R2)       CONTAIN NONE WEB IO ELEM?                    
         BNZ   WIOEL05                                                          
         GOTOR VRECUP,DMCB,(1,PBUYREC),(R2),0                                   
         B     WIOEL05                                                          
*                                                                               
WIOEL10  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,PWIOELCQ                                                  
WIOEL16  BRAS  RE,NXTEL                                                         
         BNE   WIOEL20                                                          
         USING PWIOELEM,R2                                                      
         OC    PWIODATE,PWIODATE                                                
         BNZ   WIOEL16                                                          
         B     WIOEL30                                                          
*                                                                               
WIOEL20  XC    TMPWK1,TMPWK1                                                    
         MVI   TMPWK1+0,PWIOELCQ ELEM CODE                                      
         MVI   TMPWK1+1,PWIOELLQ ELEM LENGTH                                    
*                                                                               
         GOTOR VRECUP,DMCB,(1,PBUYREC),TMPWK1,(R2)                              
*                                                                               
WIOEL30  MVC   PWIODATE,BTODAY                                                  
         MVC   PWIO#YER,SVW#IOYR                                                
         MVC   PWIO#SQ#,SVW#IOSQ                                                
         MVC   PWIO#REV,SVW#REV#                                                
*                                                                               
         BRAS  RE,GETMODCD         GET MODIFICATION CODE FROM TABLE             
         MVC   PWIOMODC,TMPWK1                                                  
*                                                                               
         MVI   PWIOMIND,C'W'       WEB DELIVERY METHOD                          
*                                                                               
         MVC   PWIOINDT,PBUYKDAT   INSERTION DATE                               
         MVC   PWIOINSL,PBUYKLIN   INSERTION LINE NUMBER                        
         CLI   PBUYKMED,C'N'                                                    
         BE    *+14                                                             
         MVC   PWIOSPAC,PBDSPACE                                                
         B     WIOEL36                                                          
*                                                                               
         ZAP   PWIOUNIT,PBDUNITS                                                
         ZAP   PWIOCOLM,PBDCLMS                                                 
         MVC   PWIOUIND,PBDUIND                                                 
         MVC   PWIO#COL,PBDCL                                                   
         MVC   PWIOSAUN,PBDSPACE                                                
*                                                                               
WIOEL36  MVC   PWIOADCD,PBDJOB                                                  
*                                                                               
         CLI   ZEOPT,C'Y'          MULTIPLE ZONE/EDITION?                       
         BNE   *+8                                                              
         OI    PWIOSTAT,PWIOSZEQ                                                
         CLI   MATOPT,C'Y'         MAT= REPEAT ACROSS Z/E?                      
         BNE   *+8                                                              
         OI    PWIOSTAT,PWIOSMAQ                                                
*                                                                               
         MVC   PWIOLWCD,LWCCODE    LEGAL WARNING CODE (IF PRESENT)              
         MVC   PWIOQUCD,QUCCODE    QUARTERLY CODE (IF PRESENT)                  
*                                                                               
         TM    WKEIOFLG,E_IOBMTQ   BUY MOVE "TO" ELEM PRESENT?                  
         BZ    *+8                                                              
         OI    PWIOSTAT,PWIODBMQ   DELETED BUY MOVE CHANGE ORDER ISSUED         
*                                                                               
         TM    WKEIOFLG,E_IOBMFQ   BUY MOVE "FROM" ELEM PRESENT?                
         BZ    *+8                                                              
         OI    PWIOSTAT,PWIOBMOQ   BUY MOVE INSERTION ORDER ISSUED              
*                                                                               
         CLI   INSORTYP,IOT1ESTQ   INSERTION ORDER BY ESTIMATE?                 
         BE    *+12                                                             
         CLI   INSORTYP,IOTSTWEQ   STEWARD INSERTION ORDER BY ESTIMATE?         
         BNE   *+8                                                              
         OI    PWIOSTAT,PWIOESTQ   INSERTION ORDER BY ESTIMATE                  
*                                                                               
         CLI   INSORTYP,IOT1ESPQ   EIO BY ESTIMATE PERIOD?                      
         JE    *+12                                                             
         CLI   INSORTYP,IOT1SWPQ   STEWARDSHIP EIO BY ESTIMATE PERIOD?          
         JNE   *+8                                                              
         OI    PWIOSTAT,PWIOEPRQ   EIO BY ESTIMATE PERIOD                       
*                                                                               
         BRAS  RE,NXTEL            BY PASS NEW EIO ELEM                         
*                                                                               
         GOTOR DATCON,DMCB,(3,BTODAY),(2,HALF2)                                 
*                                                                               
         LA    RE,TMPWK1           CREATE A CHG ELEM RIGHT AFTER                
         USING PCHGELEM,RE                                                      
         XC    TMPWK1,TMPWK1                                                    
         MVI   PCHGELCD,PCHGELEQ                                                
         MVI   PCHGLEN,PCHGNEWS                                                 
         MVC   PCHGDAT,HALF2       COMPRESSED TODAY'S DATE                      
         OI    PCHGIND4,X'02'      WEB IO IS GENERATED                          
         MVC   8(2,RE),SVPID       PID                                          
*                                                                               
         GOTOR VRECUP,DMCB,(1,PBUYREC),TMPWK1,(R2)                              
*                                                                               
******** LA    RE,PBUYREC+33                                                    
******** USING PBDELEM,RE                                                       
******** MVC   PBDDATE,BTODAY      NEED TO UPDATE LAST CHANGE DATE              
*                                                                               
WIOELX   J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R2,RE                                                         
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
BLDSUBAC NTR1  BASE=*,LABEL=*      BUILD SUB AD CODE ELEM                       
*                                                                               
         CLI   PBDJOB,C'!'         MASTER AD CODE?                              
         BNE   SACELX                                                           
SACEL10  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,PSADELCQ     SUB AD CODE ELEM CODE                        
         BRAS  RE,NXTEL                                                         
         BNE   SACEL12                                                          
*                                                                               
         GOTOR VRECUP,DMCB,(1,PBUYREC),(R2),0                                   
         B     SACEL10                                                          
*                                                                               
SACEL12  MVC   TMPSVKEY,KEY                                                     
         MVC   TMPSVAIO,AREC                                                    
         XC    KEY,KEY             RETRIEVE MASTER AD CODE RECORD               
         LA    RE,KEY                                                           
         USING PJOBKEY,RE                                                       
         MVC   PJOBKAGY,PBUYKAGY                                                
         MVC   PJOBKMED,PBUYKMED                                                
         MVI   PJOBKRCD,X'15'                                                   
         MVC   PJOBKCLT,PBUYKCLT                                                
         MVC   PJOBKPRD,PBUYKPRD                                                
         MVC   PJOBKJOB,PBDJOB                                                  
         DROP  RE                                                               
         GOTOR HIGH                                                             
         CLC   KEY(L'PJOBKEY),KEYSAVE                                           
         BE    *+6                                                              
         DC    H'0'                                                             
         LA    R0,TMPWKAIO                                                      
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         XC    TMPWK2,TMPWK2       PREPARE TO LOOK UP ALL SUB AD CODES          
         LA    R3,TMPWK2                                                        
         SR    R4,R4                                                            
         LA    R2,TMPWKAIO+(PJOBELEM-PJOBREC)                                   
         MVI   ELCODE,PJSUBIDQ                                                  
         USING PJSUBEL,R2                                                       
SACEL16  BRAS  RE,NXTEL                                                         
         BNE   SACEL20                                                          
         AHI   R4,1                FOUND ONE SUB AD CODE                        
         MVC   0(L'PJSUBCOD,R3),PJSUBCOD                                        
         LA    R3,L'PJSUBCOD(R3)                                                
         B     SACEL16                                                          
*                                                                               
SACEL20  OC    TMPWK2,TMPWK2       SUB AD CODE(S) PRESENT?                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   KEY,PBUYREC         RESTORE DATAMGR SEQUENCE                     
         GOTOR HIGH                                                             
         GOTOR GETPRT                                                           
         MVC   KEY,TMPSVKEY        RESTORE ORIGINAL KEY AND AIO                 
         MVC   AREC,TMPSVAIO                                                    
*                                                                               
         XC    TMPWK1,TMPWK1       PREPARE TO BUILD SUB AD CODE ELEM            
         LA    R2,TMPWK1                                                        
         USING PSADELEM,R2                                                      
         MVI   PSADELEM,PSADELCQ                                                
         STC   R4,PSAD#ADC                                                      
         MHI   R4,L'PSADADCS                                                    
         BCTR  R4,0                                                             
         EX    R4,*+8                                                           
         B     *+10                                                             
         MVC   PSADADCS(0),TMPWK2                                               
         AHI   R4,PSADELLQ+1       ELEM OVERHEAD AND ONE FROM EX                
         STC   R4,PSADELLN                                                      
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'FF'                                                     
         BRAS  RE,NXTEL            POINT TO END OF RECORD                       
*                                                                               
         GOTOR VRECUP,DMCB,(1,PBUYREC),TMPWK1,(R2)                              
*                                                                               
SACELX   J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R2                                                            
         EJECT                                                                  
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FRDATE   NTR1  BASE=*,LABEL=*      CONVERT DATE IN WORK (MMMDD/YY)              
*                                                                               
         LA    R1,DATETAB                                                       
FRDAT2   CLI   0(R1),X'FF'         END OF TABLE                                 
         BNE   *+6                                                              
         DC    H'0'                SOMEHTING VERY WRONG                         
*                                                                               
         CLC   WORK(3),0(R1)                                                    
         BE    FRDAT10                                                          
         LA    R1,6(R1)                                                         
         B     FRDAT2                                                           
*                                  TO FRENCH                                    
FRDAT10  MVC   WORK(3),3(R1)                                                    
         J     EXIT                                                             
*                                                                               
DATETAB  DC    C'JANJAN'                                                        
         DC    C'FEBFEV'                                                        
         DC    C'MARMAR'                                                        
         DC    C'APRAVR'                                                        
         DC    C'MAYMAI'                                                        
         DC    C'JUNJUN'                                                        
         DC    C'JULJUL'                                                        
         DC    C'AUGAOU'                                                        
         DC    C'SEPSEP'                                                        
         DC    C'OCTOCT'                                                        
         DC    C'NOVNOV'                                                        
         DC    C'DECDEC'                                                        
         DC    X'FF'                                                            
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
GETMODCD NTR1  BASE=*,LABEL=*      GET MODIFICATION CODE FROM TABLE             
*                                                                               
         XC    TMPWK1,TMPWK1       INIT RETURN VALUE                            
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'99'                                                     
         BRAS  RE,NXTEL                                                         
         BE    *+6                                                              
         DC    H'0'                INSERTION SHOULD HAVE SERIAL#                
         USING PSERELEM,R2                                                      
         L     R4,ASER#TAB         POINT TO TABLE OF SERIAL#S                   
         USING SER#TABD,R4                                                      
         SR    RE,RE                                                            
         ICM   RE,3,NUMSER#S                                                    
GTMC20   CP    PSERNUM,S#SERIAL    FOUND IN TABLE?                              
         BE    GTMC30                                                           
         LA    R4,SER#TBLQ(R4)                                                  
         BCT   RE,GTMC20                                                        
         DC    H'0'                SERIAL# HAS TO BE IN TABLE!                  
*                                                                               
GTMC30   MVC   TMPWK1(L'S#MODCOD),S#MODCOD                                      
         OC    TMPWK1,TMPWK1                                                    
         BNZ   *+6                                                              
         DC    H'0'                MODIFICATION NOT IN TABLE!                   
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R2,R4                                                         
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
IOCOMPRT NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   TMPWK1(25),KEY      SAVE ORIGINAL KEY                            
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),QAGENCY                                                   
         MVC   KEY+2(1),QMEDIA                                                  
         MVI   KEY+3,X'42'         IO COMMENT RECORD CODE                       
         MVC   KEY+4(3),QCLIENT                                                 
         MVC   KEYSAVE,KEY                                                      
         GOTOR HIGH                                                             
         CLC   KEY(7),KEYSAVE                                                   
         BE    ICOMP30             GET RECORD AND PROCESS                       
*                                                                               
         MVC   KEYSAVE+4(3),=X'FF4040'                                          
         MVC   KEYSAVE+5(1),PCLTOFF                                             
         MVC   KEY,KEYSAVE                                                      
         GOTOR HIGH                OFFICE CODE                                  
         CLC   KEY(7),KEYSAVE                                                   
         BE    ICOMP30             GET RECORD AND PROCESS                       
*                                                                               
         MVC   KEYSAVE+4(3),=X'FFFFFF'                                          
         MVC   KEY,KEYSAVE                                                      
         GOTOR HIGH                ALL CLIENTS                                  
         CLC   KEY(7),KEYSAVE                                                   
         BNE   ICOMP80             NOTHING MORE TO CHECK                        
*                                                                               
ICOMP30  DS    0H                                                               
         LA    R0,TMPWKAIO                                                      
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         BRAS  RE,TSTERR                                                        
         GOTOR AIOPRNT,DMCB,(RC)   SKIP A LINE                                  
         LA    R2,TMPWKAIO+33                                                   
         MVI   ELCODE,X'40'                                                     
         CLC   ELCODE,0(R2)                                                     
         BE    ICOMP70                                                          
*                                                                               
ICOMP50  BRAS  RE,NXTEL                                                         
         BNE   ICOMP80             RETURN                                       
ICOMP70  CLC   =C'COM=',2(R2)      EMBEDDED COMMENT?                            
         BNE   ICOMP70H                                                         
         GOTOR ASTDCOM,DMCB,(RC),(R2)                                           
         BRAS  RE,TSTERR                                                        
         B     ICOMP50                                                          
ICOMP70H GOTOR ACOMLIN,DMCB,(RC),(R2)                                           
         B     ICOMP50                                                          
*                                                                               
ICOMP80  DS    0H                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(25),TMPWK1      RESTORE ORIGINAL KEY                         
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
LEGALW   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         TM    ADBSW,AS_WEBIO      EIO?                                         
         BZ    *+12                                                             
         CLI   PBUYKEY,X'FF'       PROCESSING LAST INSERTION                    
         BNE   LEGW_X                                                           
*                                                                               
         MVC   TMPWK1(32),KEY      SAVE ORIGINAL KEY                            
*                                                                               
         CLI   LWCCODE,0           ANY LEGAL WARNING COMMENT TO PROC?           
         BE    LEGW90                                                           
         MVI   TMPBYTE1,X'45'      LEGAL WARNINGS COMMENT RECORD CODE           
         MVC   TMPBYTE2,LWCCODE    LEGAL WARNINGS COMMENT CODE                  
         BRAS  RE,LWPROC           PROCESS COMMENT RECORD                       
*                                                                               
         CLI   QUCCODE,0           ANY QUARTERLY COMMENT TO PROC?               
         BE    LEGW90                                                           
         MVI   TMPBYTE1,X'46'      QUARTERLY COMMENT RECORD CODE                
         MVC   TMPBYTE2,QUCCODE    QUARTERLY COMMENT CODE                       
         BRAS  RE,LWPROC           PROCESS COMMENT RECORD                       
*                                                                               
LEGW90   DS    0H                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(32),TMPWK1      RESTORE ORIGINAL KEY                         
LEGW_X   J     EXIT                                                             
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
LWPROC   DS    0H                                                               
         ST    RE,TMPFULL1                                                      
         XC    KEY,KEY                                                          
         MVC   KEY(2),QAGENCY                                                   
         MVC   KEY+2(1),QMEDIA                                                  
         MVC   KEY+3(1),TMPBYTE1   COMMENT RECORD CODE                          
         MVC   KEY+4(3),QCLIENT                                                 
         MVC   KEY+7(1),TMPBYTE2   COMMENT CODE                                 
         MVC   KEYSAVE,KEY                                                      
         GOTOR HIGH                                                             
         CLC   KEY(8),KEYSAVE      RECORD FOUND?                                
         BE    LWPROC30            YES                                          
*                                                                               
         MVC   KEYSAVE+4(3),=X'FF4040'                                          
         MVC   KEYSAVE+5(1),PCLTOFF                                             
         MVC   KEY,KEYSAVE                                                      
         MVC   KEY+7(1),TMPBYTE2   COMMENT CODE                                 
         GOTOR HIGH                                                             
         CLC   KEY(8),KEYSAVE      RECORD FOUND?                                
         BE    LWPROC30            YES                                          
*                                                                               
         MVC   KEYSAVE+4(3),=X'FFFFFF'                                          
         MVC   KEY,KEYSAVE                                                      
         MVC   KEY+7(1),TMPBYTE2   COMMENT CODE                                 
         GOTOR HIGH                                                             
         CLC   KEY(8),KEYSAVE      RECORD FOUND?                                
         BNE   LWPROCX             NO                                           
*                                                                               
LWPROC30 LA    R0,TMPWKAIO                                                      
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         BRAS  RE,TSTERR                                                        
         GOTOR AIOPRNT,DMCB,(RC)   SKIP A LINE                                  
         LA    R2,TMPWKAIO+33                                                   
         MVI   ELCODE,X'40'                                                     
         CLC   ELCODE,0(R2)        FIRST ELEM IS X'40'?                         
         BE    LWPROC50            YES, PROCESS IT                              
*                                                                               
LWPROC40 BRAS  RE,NXTEL                                                         
         BNE   LWPROCX                                                          
LWPROC50 TM    ADBSW,AS_WEBIO      EIO?                                         
         BZ    *+8                                                              
         OI    ADRPYSW3,PRCLWCMQ   PROCESSING LEGAL WARNING COMMENT             
         GOTOR ACOMLIN,DMCB,(RC),(R2)                                           
         B     LWPROC40                                                         
*                                                                               
LWPROCX  L     RE,TMPFULL1                                                      
         BR    RE                                                               
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
GETPHOUS NTR1  BASE=*,LABEL=*      GET PRODUCTION HOUSE INFORMATION             
*                                                                               
         L     R4,AWIODSST         POINT TO WIO STORAGE BLOCK                   
         USING WIODSD,R4           WEB IO STORAGE BLOCK                         
*                                                                               
         MVC   SVPHCODE,SPACES     PRODUCTION HOUSE CODE                        
         MVC   SVRPNAME,SPACES     REP NAME                                     
         MVC   SVRPTELN,SPACES     REP TEL NUMBER                               
         MVC   SVRPFAXN,SPACES     REP FAX NUMBER                               
*                                                                               
         CLI   PHOUSOPT,C'N'       PROFILE SAYS TO PRINT NOTHING?               
         JE    EXIT                                                             
*                                                                               
         MVC   TMPWK1(25),KEY      SAVE ORIGINAL KEY                            
         XC    KEY,KEY                                                          
         MVC   KEY(16),PINSREC     AGY/MED/REC CODE/CLT/PRD/ADCODE              
         GOTOR HIGH                                                             
         CLC   KEY(16),KEYSAVE     RECORD FOUND?                                
         BNE   GETPH80             NO SUCH PRODUCTION HOUSE CODE                
         LA    R0,TMPWKAIO                                                      
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         BRAS  RE,TSTERR                                                        
*                                                                               
         LA    R2,TMPWKAIO+33                                                   
         CLI   0(R2),X'15'                                                      
         BE    GETPH20                                                          
         MVI   ELCODE,X'15'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   GETPH80                                                          
         USING PJOBELEM,R2                                                      
*                                                                               
GETPH20  OC    PJOBPROD,PJOBPROD   PRODUCTION HOUSE CODE PRESENT?               
         BZ    GETPH80             NOT PRESENT, NO NEED TO GO FURTHER           
         MVC   SVPHCODE,PJOBPROD   SAVE OFF PRODUCTION HOUSE CODE               
         DROP  R2                                                               
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(3),PINSREC      AGENCY AND MEDIA                             
         MVI   KEY+3,X'11'         REP RECORD CODE                              
         MVC   KEY+4(4),SVPHCODE   PRODUCTION HOUSE CODE (REP CODE)             
         GOTOR HIGH                                                             
         CLC   KEY(8),KEYSAVE      RECORD FOUND?                                
         BE    *+6                                                              
         DC    H'0'                BAD PRODUCTION HOUSE CODE DETECTED           
*                                                                               
         LA    R0,TMPWKAIO                                                      
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         BRAS  RE,TSTERR                                                        
         LA    R2,TMPWKAIO+33                                                   
         MVI   ELCODE,X'11'                                                     
         CLC   ELCODE,0(R2)                                                     
         BE    GETPH60                                                          
         BRAS  RE,NXTEL                                                         
         BNE   GETPH80                                                          
         USING PREPELEM,R2                                                      
*                                                                               
GETPH60  OC    PREPNAME,PREPNAME                                                
         BZ    *+10                                                             
         MVC   SVRPNAME,PREPNAME                                                
         OC    PREPTEL,PREPTEL                                                  
         BZ    *+10                                                             
         MVC   SVRPTELN,PREPTEL                                                 
         OC    PREPFAX,PREPFAX                                                  
         BZ    GETPH80                                                          
         MVC   SVRPFAXN,PREPFAX    FAX NUM IS LEFT JUST AND NULL PADDED         
         CLC   PREPFAX(3),=C'FX='  NEED TO READ CONTROL FILE?                   
         BNE   GETPH80                                                          
*                                                                               
         MVC   TMPWK1(L'SVRPFAXN),SVRPFAXN                                      
         BRAS  RE,TFAXCODE                                                      
         MVC   SVRPFAXN,TMPWK1                                                  
*                                                                               
GETPH80  DS    0H                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(25),TMPWK1      RESTORE ORIGINAL KEY                         
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R4,R2                                                         
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* TMPWK1 = FAX CODE TO BE LOOKED UP, WILL RETURN NUMBER IF FOUND                
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
TFAXCODE NTR1  BASE=*,LABEL=*      TRANSLATE FAX CODE TO NUMBER                 
*                                                                               
         OC    TMPWK1+3(7),TMPWK1+3                                             
         BNZ   *+14                                                             
         MVC   TMPWK1(L'CTFX1NUM),SPACES                                        
         B     TFXC_X              NO VALID FAX CODE IS FOUND                   
         XC    KEY,KEY                                                          
         LA    RE,KEY                                                           
         USING CTFXKEY,RE                                                       
         MVI   CTFXKTYP,CTFXEQU    RECORD TYPE                                  
         MVC   CTFXAGY,QAGENCY                                                  
         MVC   CTFXCODE,TMPWK1+3                                                
         OC    CTFXCODE,SPACES     LEFT JUST AND SPACE PADDED                   
         DROP  RE                                                               
*                                                                               
         MVC   KEYSAVE,KEY                                                      
         GOTO1 DATAMGR,DMCB,(0,=C'DMREAD'),=C'CTFILE',KEY,TMPWKAIO              
*                                                                               
         MVC   TMPWK1(L'CTFX1NUM),SPACES                                        
         CLC   KEY(18),KEYSAVE     COMPARE UP TO FAX CODE                       
         BNE   TFXC_X              FAX CODE IS NOT FOUND IN CNTL FILE           
         LA    R2,TMPWKAIO+28      POINT TO FIRST ELEM IN CNTL FILE             
         MVI   ELCODE,CTFX1ELQ                                                  
         CLC   ELCODE,0(R2)        FIRST ELEM IS CNTL FILE FAX NUM?             
         BE    *+12                                                             
         BRAS  RE,NXTEL                                                         
         BNE   TFXC_X                                                           
         ZIC   RE,1(R2)                                                         
         AHI   RE,-3               2 FOR ELEM OVERHEAD AND 1 FOR EX             
         CHI   RE,0                                                             
         BNL   *+6                                                              
         DC    H'0'                BAD ELEM LENGTH IN CNTL FILE                 
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   TMPWK1(0),2(R2)     GET FAX NUMBER IN CNTL FILE                  
*                                                                               
TFXC_X   J     EXIT                                                             
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
PHOUSE   NTR1  BASE=*,LABEL=*      PRINTING PRODUCTION HOUSE ITEMS              
*                                                                               
         L     R4,AWIODSST         POINT TO WIO STORAGE BLOCK                   
         USING WIODSD,R4           WEB IO STORAGE BLOCK                         
*                                                                               
         CLC   SVPHCODE,SPACES     ANY PRODUCTION HOUSE CODE TO PRINT?          
         BE    PHOUS_X             NO, DONE                                     
         MVC   P+05(24),=C'MATERIALS SHIPPED FROM: '                            
         MVC   P+29(25),=C'(REP NAME IS NOT DEFINED)'                           
         CLC   SVRPNAME,SPACES                                                  
         BE    *+16                                                             
         MVC   P+29(25),SPACES                                                  
         MVC   P+29(30),SVRPNAME                                                
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
         CLI   PHOUSOPT,C'T'       PROFILE SAYS TO PRINT TEL?                   
         BE    *+12                                                             
         CLI   PHOUSOPT,C'B'       BOTH TEL AND FAX?                            
         BNE   PHOUS30                                                          
         CLC   SVRPTELN,SPACES     NO TEL TO BE PRINTED?                        
         BE    PHOUS30                                                          
         OC    SVRPTELN,SPACES     GET RID OF TRAILING NULLS                    
         MVC   P+29(12),=C'TEL NUMBER: '                                        
         MVC   P+41(12),SVRPTELN                                                
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
PHOUS30  CLI   PHOUSOPT,C'F'       PROFILE SAYS TO PRINT FAX?                   
         BE    *+12                                                             
         CLI   PHOUSOPT,C'B'       BOTH TEL AND FAX?                            
         BNE   PHOUS_X                                                          
         CLC   SVRPFAXN,SPACES     FAX TO BE PRINTED?                           
         BE    PHOUS_X                                                          
         MVC   P+29(12),=C'FAX NUMBER: '                                        
         MVC   P+41(20),SVRPFAXN                                                
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
PHOUS_X  J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R4                                                            
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
WEBIOHDR NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         TM    ADBSW,AS_ADBRQ      ADBUYER REQUEST?                             
         JZ    EXIT                                                             
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                                                             
         TM    ADRPYREC,RPYHEADQ   HEADER ALREADY REPLIED?                      
         JNZ   EXIT                                                             
*                                                                               
         L     R4,AWIODSST         POINT TO WIO STORAGE BLOCK                   
         USING WIODSD,R4           WEB IO STORAGE BLOCK                         
         BRAS  RE,SETWIOHR         SET WEB IO HEADER VALUES                     
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#IO2HDR)              
         OI    ADRPYREC,RPYHEADQ                                                
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#IOLKEY),    +        
               ('LD_CHARQ',H_IOLKEY),('H_IOLKYL',0)                             
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#YEARYY),    +        
               ('LD_CHARQ',SVYEARYY),(L'SVYEARYY,0)                             
*                                                                               
         CLC   LIOBPCV1,=AL1(03,04,00,05)                                       
         BL    WIOH120                                                          
         CLI   INSORTYP,C' '                                                    
         BNH   WIOH120                                                          
         MVC   TMPBYTE1,INSORTYP                                                
         CLI   TMPBYTE1,IOTSTWEQ                                                
         BNE   *+8                                                              
         MVI   TMPBYTE1,IOTSTEWQ                                                
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#INSCLA),    +        
               ('LD_CHARQ',TMPBYTE1),(L'INSORTYP,0)                             
*                                                                               
WIOH120  GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#IOSEQ#),    +        
               ('LD_UBINQ',SVW#IOSQ),(L'SVW#IOSQ,0)                             
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#REVNUM),    +        
               ('LD_UBINQ',SVW#REV#),(L'SVW#REV#,0)                             
*                                                                               
         CLI   NAMOPT,C'Y'         SUPPRESS AGENCY NAME AND ADDRESS?            
         BE    WIOH140                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#AGYNAM),    +        
               ('LD_CHARQ',PAGYNAME),(L'PAGYNAME,0)                             
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#AGYADR),    +        
               ('LD_CHARQ',PAGYADDR),(L'PAGYADDR,0)                             
*                                                                               
WIOH140  GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ALPHID),    +        
               ('LD_CHARQ',QAGENCY),(L'QAGENCY,0)                               
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#MEDCOD),    +        
               ('LD_CHARQ',QMEDIA),(L'QMEDIA,0)                                 
*                                                                               
         LA    R2,PCLTREC+33                                                    
         MVI   ELCODE,X'41'        LOOK FOR MEDIA NAME OVERRIDE ELEM            
         BRAS  RE,NXTEL                                                         
         JNE   WIOH142                                                          
         USING PCLTMEL,R2                                                       
         CLC   PCLTMNAM,SPACES     HAVE MEDIA NAME OVERRIDE?                    
         JNH   WIOH142                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#MEDNOV),    +        
               ('LD_CHARQ',PCLTMNAM),(L'PCLTMNAM,0)                             
         DROP  R2                                                               
*                                                                               
WIOH142  MVC   TMPWK1(17),SPACES                                                
         GOTOR DATCON,DMCB,(0,QSTART),(10,TMPWK1)                               
         MVI   TMPWK1+8,C'-'                                                    
         GOTOR DATCON,DMCB,(0,QEND),(10,TMPWK1+9)                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#STEND),     +        
               ('LD_CHARQ',TMPWK1),(17,0)                                       
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PERTYP),    +        
               ('LD_CHARQ',H_PERTYP),(L'H_PERTYP,0)                             
*                                                                               
WIOH160  GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PUBCOD),    +        
               ('LD_CHARQ',QPUB),(L'QPUB,0)                                     
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PUBNAM),    +        
               ('LD_CHARQ',PUBNAME),(L'PUBNAME,0)                               
*                                                                               
WIOH172  OC    BPUB+4(1),BPUB+4    PUB ZONE PRESENT?                            
         BZ    WIOH172B                                                         
         XC    TMPWK1,TMPWK1                                                    
         GOTOR APUBEDIT,DMCB,(X'08',BPUB),(C'S',TMPWK1)                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PUBZON),    +        
               ('LD_CHARQ',TMPWK1+8+1),(2,0)                                    
WIOH172B MVC   TMPWK2(L'PUBZNAME),PUBZNAME                                      
         OC    TMPWK2(L'PUBZNAME),SPACES                                        
         CLC   TMPWK2(L'PUBZNAME),SPACES                                        
         BE    WIOH172D                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PZNAME),    +        
               ('LD_CHARQ',TMPWK2),(L'PUBZNAME,0)                               
*                                                                               
WIOH172D OC    BPUB+5(1),BPUB+5    PUB EDITION PRESENT?                         
         BZ    WIOH178                                                          
         OC    BPUB+4(1),BPUB+4    PUB ZONE PRESENT?                            
         BNZ   WIOH172H                                                         
         XC    TMPWK1,TMPWK1                                                    
         GOTOR APUBEDIT,DMCB,(X'08',BPUB),(C'S',TMPWK1)                         
         LA    RF,TMPWK1+8+1                                                    
         B     WIOH172M                                                         
*                                                                               
WIOH172H LA    RF,TMPWK1+8+1+2+1                                                
*                                                                               
WIOH172M GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PUBEDT),    +        
               ('LD_CHARQ',0(RF)),(3,0)                                         
         GOTOR APUBEDIT,DMCB,(X'08',BPUB),(C'E',TMPWK1)                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#EDTEXP),    +        
               ('LD_CHARQ',TMPWK1),(11,0)                                       
*                                                                               
WIOH178  GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#IORDAT),    +        
               ('LD_BDATQ',BTODAY),(L'BTODAY,0)                                 
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CLTCOD),    +        
               ('LD_CHARQ',PCLTKCLT),(L'PCLTKCLT,0)                             
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CLTNAM),    +        
               ('LD_CHARQ',PCLTNAME),(L'PCLTNAME,0)                             
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PRDCOD),    +        
               ('LD_CHARQ',PPRDKPRD),(L'PPRDKPRD,0)                             
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PRDNAM),    +        
               ('LD_CHARQ',PPRDNAME),(L'PPRDNAME,0)                             
*                                                                               
         CLI   INSORTYP,IOT1ESTQ   EIO BY ESTIMATE?                             
         JE    WIOH178H                                                         
         CLI   INSORTYP,IOTSTWEQ   EIO BY STEWARD ESTIMATE?                     
         JE    WIOH178H                                                         
         CLI   INSORTYP,IOT1ESPQ   EIO BY ESTIMATE PERIOD?                      
         JE    WIOH178H                                                         
         CLI   INSORTYP,IOT1SWPQ   STEWARDSHIP EIO BY ESTIMATE PERIOD?          
         JE    WIOH178H                                                         
         J     WIOH178M                                                         
WIOH178H LA    R2,PESTREC                                                       
         USING PESTREC,R2                                                       
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ESTNUM),    +        
               ('LD_UBINQ',PESTKEST),(L'PESTKEST,0)                             
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ESTNAM),    +        
               ('LD_CHARQ',PESTNAME),(L'PESTNAME,0)                             
         CLC   PESTNAM2,SPACES                                                  
         BNH   WIOH178M                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ESTNM2),    +        
               ('LD_CHARQ',PESTNAM2),(L'PESTNAM2,0)                             
         DROP  R2                                                               
*                                                                               
WIOH178M GOTOR VT41F05,DMCB,(RC),(RA),('SETUPRCQ',0)                            
*                                                                               
         CLC   LIOBPCV1,=AL1(03,03,00,02)                                       
         BL    WIOH180                                                          
         MVC   TMPBYTE3,COSTOPT                                                 
         CLI   TMPBYTE3,0                                                       
         BNE   *+8                                                              
         MVI   TMPBYTE3,C'N'       SET TO NO COST                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#SHWCOS),    +        
               ('LD_CHARQ',TMPBYTE3),(L'TMPBYTE3,0)                             
*                                                                               
         CLC   LIOBPCV1,=AL1(04,00,00,16)                                       
         BL    WIOH180                                                          
         MVC   TMPBYTE3,ICOMMOPT                                                
         CLI   TMPBYTE3,0                                                       
         BNE   *+8                                                              
         MVI   TMPBYTE3,C'N'       SET TO DO NOT USE INSOR COMM FORMAT          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ICMFMT),    +        
               ('LD_CHARQ',TMPBYTE3),(L'TMPBYTE3,0)                             
*                                                                               
WIOH180  BRAS  RE,WIOH_PUB         REPLY PUBLICATION INFORMATION                
*                                                                               
         GOTOR VT41F05,DMCB,(RC),(RA),('VCCLISTQ',0)                            
*                                                                               
         GOTOR VT41F05,DMCB,(RC),(RA),('ACCLISTQ',0)                            
*                                                                               
         XC    DMCB,DMCB                                                        
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R3,R4                                                         
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
EIOHCOMM NTR1  BASE=*,LABEL=*      REPLY EIO HEADER COMMENT                     
*                                                                               
         TM    ADBSW,AS_ADBRQ      ADBUYER REQUEST?                             
         JZ    EXIT                                                             
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                                                             
         TM    ADRPYREC,RPYHEADQ   HEADER ALREADY REPLIED?                      
         JNZ   *+6                                                              
         DC    H'0'                REPLY RECORD OUT OF SYNC                     
*                                                                               
         L     R4,AWIODSST         POINT TO WIO STORAGE BLOCK                   
         USING WIODSD,R4           WEB IO STORAGE BLOCK                         
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         LA    R2,EIO#RTAB                                                      
         USING EIO#RTBD,R2                                                      
         OC    0(E#R_LENQ,R2),0(R2)                                             
         BZ    EIOHC_X                                                          
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#EIOHTC)              
         OI    ADRPYSW1,RPYHCONQ                                                
*                                                                               
         MVC   TMPWK1(L'SPACES),SPACES                                          
         MVC   TMPWK1(L'IOESTTX2),IOESTTX2                                      
*                                                                               
         LHI   R5,E#R_MAXQ                                                      
EIOHC24  OC    0(E#R_LENQ,R2),0(R2)                                             
         BZ    EIOHC30                                                          
         MVC   TMPWK2(L'SPACES),SPACES                                          
         MVC   TMPWK2(1),QMEDIA                                                 
         MVI   TMPWK2+1,C'-'                                                    
         MVC   FULL(L'BTODAY),BTODAY                                            
         MVC   FULL(L'E#R_YEAR),E#R_YEAR                                        
         GOTOR DATCON,DMCB,(3,FULL),(10,WORK)                                   
         MVC   TMPWK2+2(2),WORK+6                                               
         MVC   TMPWK2+2+2(3),QCLIENT                                            
         CLI   TMPWK2+2+2+2,C' '     TWO CHARACTER CLIENT CODE?                 
         BNE   *+8                                                              
         MVI   TMPWK2+2+2+2,C'-'                                                
         EDITR (B3,E#R_NUMB),(4,TMPWK2+2+2+3),0,FILL=0                          
         CLI   E#R_REV#,0                                                       
         BE    EIOHC28                                                          
         MVI   TMPWK2+2+2+3+4,C'-'                                              
         MVC   TMPWK2+2+2+3+4+1(3),=C'REV'                                      
         EDITR (B1,E#R_REV#),(3,TMPWK2+2+2+3+4+1+3),0,FILL=0                    
*                                                                               
EIOHC28  CHI   R5,E#R_MAXQ                                                      
         BE    EIOHC28H                                                         
         MVC   TMPWK1(L'SPACES),SPACES                                          
         MVC   TMPWK1+(H_IOLKYL),TMPWK2                                         
         B     EIOHC28K                                                         
EIOHC28H MVC   TMPWK1+L'IOESTTX2+1(H_IOLKYL),TMPWK2                             
EIOHC28K LA    RF,TMPWK1+L'SPACES-1                                             
         BRAS  RE,LAST_CHR                                                      
         LA    RF,2(RF)                                                         
         MVC   0(L'IOESTTX3,RF),IOESTTX3                                        
         LA    RF,(L'IOESTTX3+1)(RF)                                            
         GOTOR DATCON,DMCB,(3,E#R_DATE),(21,0(RF))                              
         BRAS  RE,RPYHTRCM                                                      
         LA    R2,E#R_LENQ(R2)                                                  
         BCT   R5,EIOHC24                                                       
*                                                                               
EIOHC30  MVC   TMPWK1(L'SPACES),SPACES                                          
         MVC   TMPWK1(L'IOESTTX4),IOESTTX4                                      
         LA    RF,TMPWK1+L'IOESTTX4+1                                           
         MVC   0(1,RF),PBUYREC+(PBUYKMED-PBUYKEY)                               
         MVI   1(RF),C'/'                                                       
         MVC   2(3,RF),PBUYREC+(PBUYKCLT-PBUYKEY)                               
         MVI   5(RF),C'/'                                                       
         MVC   6(3,RF),PBUYREC+(PBUYKPRD-PBUYKEY)                               
         CLI   INSORTYP,IOT1ESTQ   EIO BY ESTIMATE?                             
         JE    EIOHC32                                                          
         CLI   INSORTYP,IOTSTWEQ   EIO BY ESTIMATE?                             
         JE    EIOHC32                                                          
         CLI   INSORTYP,IOT1ESPQ   EIO BY ESTIMATE PERIOD?                      
         JE    EIOHC32                                                          
         CLI   INSORTYP,IOT1SWPQ   STEWARDSHIP EIO BY ESTIMATE PERIOD?          
         JE    EIOHC32                                                          
         MVC   TMPHALF1,E#R_ESTC   ESTIMATE NUMBER                              
         MVI   TMPWK1+L'IOESTTX4+10,C'/'                                        
         EDIT  (B2,TMPHALF1),(3,TMPWK1+L'IOESTTX4+11),                 +        
               0,ALIGN=RIGHT,ZERO=NOBLANK,FILL=0                                
EIOHC32  LA    RF,TMPWK1+L'SPACES-1                                             
         BRAS  RE,LAST_CHR                                                      
         MVI   1(RF),C'.'                                                       
         BRAS  RE,RPYHTRCM                                                      
*                                                                               
         MVC   TMPWK1(L'SPACES),SPACES                                          
         MVC   TMPWK1(L'IOESTTX5),IOESTTX5                                      
         BRAS  RE,RPYHTRCM                                                      
*                                                                               
EIOHC_X  XC    DMCB,DMCB                                                        
         J     EXIT                                                             
*                                                                               
RPYHTRCM LR    R0,RE               REPLY TRANSITION COMMENT                     
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COMMNT),    +        
               ('LD_CHARQ',TMPWK1),(L'EIOCOMLN,0)                               
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
LAST_CHR CLI   0(RF),0                                                          
         JE    *+8                                                              
         CLI   0(RF),C' '                                                       
         JNE   *+10                                                             
         BCTR  RF,0                                                             
         J     *-18                                                             
         BR    RE                                                               
*                                                                               
IOESTTX2 DC    C'PLEASE BE ADVISED THAT'                                        
IOESTTX3 DC    C'SENT ON'                                                       
IOESTTX4 DC    C'MAY ALSO CONTAIN INSERTIONS FOR'                               
IOESTTX5 DC    C'CONTACT THE SENDER IF YOU HAVE ANY QUESTIONS ABOUT THO+        
               SE ORDERS.'                                                      
*                                                                               
         LTORG                                                                  
         DROP  RB,R3,R4,R2                                                      
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
SETWIOHR NTR1  BASE=*,LABEL=*      SET WEB IO HEADER VALUES                     
*                                                                               
         USING WIODSD,R4           WEB IO STORAGE BLOCK                         
*                                                                               
         MVI   H_IOLKEY,C'-'                                                    
         MVC   H_IOLKEY+1(H_IOLKYL-1),H_IOLKEY                                  
         MVC   H_LKYMED,QMEDIA                                                  
         MVC   FULL(L'BTODAY),BTODAY                                            
         MVC   FULL(L'SVW#IOYR),SVW#IOYR                                        
         GOTOR DATCON,DMCB,(3,FULL),(10,WORK)                                   
         MVC   SVYEARYY,WORK+6                                                  
         MVC   H_LKYYER,WORK+6                                                  
         MVC   H_LKYCLT,QCLIENT                                                 
         CLI   H_LKYCLT+2,C' '     TWO CHARACTER CLIENT CODE?                   
         BNE   *+8                                                              
         MVI   H_LKYCLT+2,C'-'                                                  
         EDIT  (B3,SVW#IOSQ),H_LKYRNO,0,FILL=0                                  
         CLI   SVW#REV#,0                                                       
         BE    SWIOH12             NO REVISION #                                
         MVC   H_LKYRET,=C'REV'                                                 
         EDIT  (B1,SVW#REV#),H_LKYRE#,0,FILL=0                                  
         B     SWIOH14                                                          
*                                                                               
SWIOH12  MVI   H_LKYRNO+L'H_LKYRNO,0                                            
         XC    H_LKYRET,H_LKYRET                                                
         XC    H_LKYRE#,H_LKYRE#                                                
*                                                                               
SWIOH14  SR    RE,RE                                                            
         ICM   RE,7,SVW#IOSQ                                                    
         CHI   RE,9999                                                          
         BH    SWIOH16                                                          
         MVC   H_IOLKEY+DISPER#Q(LNAERF#Q),H_IOLKEY+DISP_R#Q                    
         MVI   H_IOLKEY+(H_IOLKYL-L'H_LKYR#E),C' '                              
*                                                                               
SWIOH16  MVI   H_PERTYP,C'M'       MONTHLY (NOT USED YET)                       
*                                                                               
         XC    DMCB,DMCB                                                        
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R4                                                            
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
WIOH_PUB NTR1  BASE=*,LABEL=*      PUBLICATION INFORMATION                      
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         MVC   TMPBYTE2,PREPKEY    SAVE FOR MODIFIED COMPARISON                 
         MVI   TMPBYTE3,0          FOR MAIN PUB ADDRESS REPLY                   
*                                                                               
         CLI   ADDROPT,C'1'        SHIPPING ADDRESS ONLY?                       
         BE    WPUB20                                                           
         MVI   TMPBYTE1,C'1'       REPLY 1ST ADDRESS                            
         LA    R2,PUBREC+33                                                     
         BRAS  RE,WPUB_SET                                                      
         CLI   ADDROPT,C'N'        REP TRAFFIC ADDR OR MAIN PUB ADDR?           
         BE    WPUB90                                                           
         CLI   ADDROPT,C'Y'        REP TRAFFIC ADDR AND MAIN PUB ADDR?          
         BNE   *+12                                                             
         BRAS  RE,WPUB_SET                                                      
         B     WPUB90                                                           
*                                                                               
WPUB20   MVI   TMPBYTE1,C'2'       REPLY 2ND ADDRESS                            
         BRAS  RE,WPUB_SET         REPLY SHIPPING INFORMATION                   
*                                                                               
WPUB90   MVC   PREPKEY(1),TMPBYTE2 RESTORE                                      
         XC    DMCB,DMCB                                                        
         J     EXIT                                                             
*                                                                               
WPUB_SET ST    RE,TMPFULL1                                                      
*                                                                               
         LA    R0,H_PUBINF                                                      
         LHI   R1,H_PUBINL                                                      
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE               CLEAR REPLY INFORMATION BLOCK                
*                                                                               
         CLI   ADDROPT,C'L'        NEED HARD CODED TEXT?                        
         BNE   *+10                                                             
         MVC   H_PUBCM1(L'WPUB_TX1),WPUB_TX1                                    
*                                                                               
         CLI   TMPBYTE1,C'1'       1ST ADDRESS?                                 
         BNE   WPUB_S40                                                         
         CLI   ADDROPT,C'2'        SHIPPING ADDR AND MAIN PUB ADDR?             
         BE    WPUB_S16                                                         
         CLI   PREPKEY,0           HAS REP ADDRESS?                             
         BE    WPUB_S16                                                         
         MVI   H_PUBTYP,C'R'       ADDRESS TYPE IS REP                          
         MVC   H_PUBNAM(L'PREPNAME),PREPNAME                                    
         MVC   H_PUBAL1(L'PREPLIN1),PREPLIN1                                    
         MVC   H_PUBAL2(L'PREPLIN2),PREPLIN2                                    
         MVC   H_PUBATT(L'PREPATTN),PREPATTN                                    
         MVC   H_PUBPH#(L'PREPTEL),PREPTEL                                      
         MVC   H_PUBSTA(L'PREPSTAC),PREPSTAC                                    
         MVC   H_PUBAL3(L'PREPLIN3),PREPLIN3                                    
         MVC   H_PUBFX#(L'PREPFAX),PREPFAX                                      
         MVI   PREPKEY,0           INDICATE ALREADY REPLIED                     
         B     WPUB_S50                                                         
*                                                                               
WPUB_S16 CLI   TMPBYTE3,C'M'       MAIN PUB ADDRESS IS ALREADY REPLIED?         
         BE    WPUB_SX                                                          
         CLI   0(R2),X'10'         MAIN NAME ELEM?                              
         BE    *+6                                                              
         DC    H'0'                                                             
         USING PUBNAMEL,R2                                                      
         MVI   H_PUBTYP,C'M'       ADDRESS TYPE IS MAIN                         
         MVC   H_PUBNAM(L'PUBNAME),PUBNAME                                      
         MVC   H_PUBAL1(L'PUBLINE1),PUBLINE1                                    
         MVC   H_PUBAL2(L'PUBLINE2),PUBLINE2                                    
         MVC   H_PUBAL3(L'PUBLINE3),PUBLINE3                                    
         MVC   H_PUBCIT(L'PUBCITY),PUBCITY                                      
         MVC   H_PUBSTA(L'PUBSTATE),PUBSTATE                                    
         MVC   H_PUBZIP(L'PUBNWZIP),PUBNWZIP                                    
         CLI   FROPT,C'Y'          USING PUB'S LANGUAGE?                        
         JE    *+8                                                              
         MVI   PUBLANG,0           NOT USING PUB'S LANG, SET TO ENG             
         MVC   H_PUBLAN,PUBLANG                                                 
         MVI   TMPBYTE3,C'M'       MAIN PUB ADDRESS IS SET                      
*                                                                               
         MVI   ELCODE,X'11'        PUBLICATION SUPPLEMENT ELEM                  
         BRAS  RE,NXTEL                                                         
         BNE   WPUB_S20                                                         
         USING PUBSADEL,R2                                                      
         CLI   TLFXOPT2,C'T'       TELEPHONE OF 2ND ADDRESS?                    
         BE    *+12                                                             
         CLI   TLFXOPT2,C'B'       OR TEL AND FAX OF 2ND ADDDRESS?              
         BNE   *+10                                                             
         MVC   H_PUBPH#,PUBTEL                                                  
         MVC   H_PUBATT,PUBATTN                                                 
         CLI   TLFXOPT2,C'F'       FAX OF 2ND ADDRESS?                          
         BE    *+12                                                             
         CLI   TLFXOPT2,C'B'       OR TEL AND FAX OF 2ND ADDDRESS?              
         BNE   *+10                                                             
         MVC   H_PUBFX#,PUBSFAXN                                                
*                                                                               
WPUB_S20 MVI   ELCODE,X'70'        PUBLICATION WEB ADDRESS ELEM                 
         BRAS  RE,NXTEL                                                         
         BNE   WPUB_S50                                                         
         USING PUBWEBEL,R2                                                      
         SR    RE,RE                                                            
         IC    RE,1(R2)                                                         
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   H_PUBWEB(0),PUBWEBS                                              
         B     WPUB_S50                                                         
*                                                                               
WPUB_S40 CLI   TMPBYTE1,C'2'       DOING 2ND ADDRESS                            
         BE    *+6                                                              
         DC    H'0'                INVALID CALL                                 
*                                                                               
         MVI   ADRTYP,C'S'         SHIPPING ADDRESS                             
         CLI   ADDROPT,C'C'                                                     
         BNE   *+8                                                              
         MVI   ADRTYP,C'C'         CONTRACT ADDRESS                             
         MVC   CLTAGY,PUBKAGY      AGY                                          
         MVC   CLTMED,QMEDIA       MED                                          
         MVC   CLTCODE,PCLTKCLT    CLIENT CODE                                  
         MVC   CLTOFF,PCLTOFF      CLIENT OFFICE                                
*                                                                               
         GOTOR APPGETAD,DMCB,(ADRTYP,CLTDATA),PUBREC,VDATAMGR                   
         CLI   0(R1),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                ERROR OCCURED                                
         CLI   0(R1),0                                                          
         BE    WPUB_SX             NO ADDRESS FOUND                             
*                                                                               
         L     RE,4(R1)            POINT TO ADDRESS                             
         USING PGETADRD,RE                                                      
         MVC   H_PUBTYP,ADRTYP     ADDRESS TYPE                                 
         MVC   H_PUBNAM(L'PGADNAME),PGADNAME                                    
         MVC   H_PUBAL1(L'PGADNAME),PGADLIN1                                    
         MVC   H_PUBAL2(L'PGADLIN1),PGADLIN2                                    
         MVC   H_PUBAL3(L'PGADLIN2),PGADLIN3                                    
         MVC   H_PUBATT(L'PGADATTN),PGADATTN                                    
         MVC   H_PUBPH#(L'PGADTEL),PGADTEL                                      
         MVC   H_PUBFX#(L'PGADFAX),PGADFAX                                      
         MVC   H_PUBEML(L'PGADEADD),PGADEADD                                    
*                                                                               
WPUB_S50 GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#PUB)                 
*                                                                               
         CLI   H_PUBTYP,0                                                       
         BE    WPUB_S52                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PBATYP),    +        
               ('LD_CHARQ',H_PUBTYP),(L'H_PUBTYP,0)                             
*                                                                               
WPUB_S52 OC    H_PUBNAM,H_PUBNAM                                                
         BZ    WPUB_S54                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PUBNAM),    +        
               ('LD_CHARQ',H_PUBNAM),(L'H_PUBNAM,0)                             
*                                                                               
WPUB_S54 GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ADDRL1),    +        
               ('LD_CHARQ',H_PUBAL1),(L'H_PUBAL1,0)                             
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ADDRL2),    +        
               ('LD_CHARQ',H_PUBAL2),(L'H_PUBAL2,0)                             
*                                                                               
         OC    H_PUBAL3,H_PUBAL3                                                
         BZ    WPUB_S64                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ADDRL3),    +        
               ('LD_CHARQ',H_PUBAL3),(L'H_PUBAL3,0)                             
*                                                                               
WPUB_S64 OC    H_PUBCIT,H_PUBCIT                                                
         BZ    WPUB_S68                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CITY),      +        
               ('LD_CHARQ',H_PUBCIT),(L'H_PUBCIT,0)                             
*                                                                               
WPUB_S68 OC    H_PUBSTA,H_PUBSTA                                                
         BZ    WPUB_S72                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#STATE),     +        
               ('LD_CHARQ',H_PUBSTA),(L'H_PUBSTA,0)                             
*                                                                               
WPUB_S72 OC    H_PUBZIP,H_PUBZIP                                                
         BZ    WPUB_S76                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ZIPCOD),    +        
               ('LD_CHARQ',H_PUBZIP),(L'H_PUBZIP,0)                             
*                                                                               
WPUB_S76 OC    H_PUBPH#,H_PUBPH#                                                
         BZ    WPUB_S80                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#TELNUM),    +        
               ('LD_CHARQ',H_PUBPH#),(L'H_PUBPH#,0)                             
*                                                                               
WPUB_S80 OC    H_PUBATT,H_PUBATT                                                
         BZ    WPUB_S84                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ATTENT),    +        
               ('LD_CHARQ',H_PUBATT),(L'H_PUBATT,0)                             
*                                                                               
WPUB_S84 OC    H_PUBFX#,H_PUBFX#                                                
         BZ    WPUB_S86                                                         
         MVC   TMPWK2(L'SPACES),SPACES                                          
         MVC   TMPWK2(L'H_PUBFX#),H_PUBFX#                                      
         CLC   H_PUBFX#(3),=C'FX=' NEED TO READ CONTROL FILE?                   
         BNE   *+20                                                             
         MVC   TMPWK1(L'H_PUBFX#),H_PUBFX#                                      
         BRAS  RE,TFAXCODE                                                      
         MVC   TMPWK2,TMPWK1                                                    
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#FAXNUM),    +        
               ('LD_CHARQ',TMPWK2),(L'CTFX1NUM,0)                               
*                                                                               
WPUB_S86 OC    H_PUBWEB,H_PUBWEB                                                
         BZ    WPUB_S88                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#WEDADR),    +        
               ('LD_CHARQ',H_PUBWEB),(L'H_PUBWEB,0)                             
*                                                                               
WPUB_S88 OC    H_PUBEML,H_PUBEML                                                
         BZ    WPUB_S90                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#E_MAIL),    +        
               ('LD_CHARQ',H_PUBEML),(L'H_PUBEML,0)                             
*                                                                               
WPUB_S90 OC    H_PUBCM1,H_PUBCM1                                                
         BZ    WPUB_S92                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COMMNT),    +        
               ('LD_CHARQ',H_PUBCM1),(L'H_PUBCM1,0)                             
*                                                                               
WPUB_S92 CLI   H_PUBLAN,C' '                                                    
         JNH   WPUB_S94                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PUBLAN),    +        
               ('LD_CHARQ',H_PUBLAN),(L'H_PUBLAN,0)                             
*                                                                               
WPUB_S94 DS    0H                                                               
*                                                                               
WPUB_SX  L     RE,TMPFULL1                                                      
         BR    RE                                                               
*                                                                               
WPUB_TX1 DC    C'SHIP MATERIALS TO SHIPPING ADDRESS'                            
*                                                                               
         LTORG                                                                  
         DROP  RB,R2,R3,RE                                                      
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
RPYADCOM NTR1  BASE=*,LABEL=*      REPLY HARD CODED AD COMMENT                  
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                NO                                           
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         TM    ADRPYSW2,RPYVARCQ   SUB REC REPLY CODE REPLIED?                  
         BO    RPYADC14                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#COMVAR)              
         OI    ADRPYSW2,RPYVARCQ                                                
*                                                                               
RPYADC14 XC    TMPWK1,TMPWK1                                                    
         MVC   TMPWK1(L'R_ADCTX1),R_ADCTX1                                      
         MVC   TMPWK1+L'R_ADCTX1+1(6),MATJOB                                    
         MVC   TMPWK1+L'R_ADCTX1+1+6+1(2),R_ADCTX1                              
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COMMNT),    +        
               ('LD_CHARQ',TMPWK1),(L'R_ADCTX1+1+6+1+2,0)                       
*                                                                               
         XC    DMCB,DMCB                                                        
         J     EXIT                                                             
*                                                                               
R_ADCTX1 DC    C'**THESE INSTRUCTIONS APPLY TO AD'                              
*                                                                               
         LTORG                                                                  
         DROP  RB,R3                                                            
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
MARKADCR NTR1  BASE=*,LABEL=*      MARK AD CODE RECORD                          
*                                                                               
         MVC   TMPSVKEY,KEY                                                     
         MVC   TMPSVAIO,AREC                                                    
         CLI   RCWRITE,C'Y'                                                     
         BNE   MKADCR_X                                                         
*                                                                               
         L     R3,AADLIST          POINT TO AD CODE TABLE                       
         SR    R4,R4               LOOP COUNTER                                 
*                                                                               
MKADC20  CHI   R4,ADLS_MXQ         ALL AD CODES IN TABLE PROCESSED?             
         BH    MKADCR_X                                                         
         OC    0(ADLS_LNQ,R3),0(R3)                                             
         BZ    MKADCR_X                                                         
         CLI   (ADLS_ADC-ADLS_IND)(R3),C'!'                                     
         BE    MKADC32                                                          
MKADC26  LA    R3,(ADLS_LNQ)(R3)   NEXT AD CODE ENTRY                           
         AHI   R4,1                LOOP COUNTER INCREMENT                       
         B     MKADC20                                                          
*                                                                               
MKADC32  XC    KEY,KEY             RETRIEVE MASTER AD CODE RECORD               
         LA    RE,KEY                                                           
         USING PJOBKEY,RE                                                       
         MVC   PJOBKAGY,QAGENCY                                                 
         MVC   PJOBKMED,QMEDIA                                                  
         MVI   PJOBKRCD,X'15'                                                   
         MVC   PJOBKCLT,QCLIENT                                                 
         MVC   PJOBKPRD,QPRODUCT                                                
         MVC   PJOBKJOB,(ADLS_ADC-ADLS_IND)(R3)                                 
         DROP  RE                                                               
*                                                                               
         GOTOR HIGH                                                             
         CLC   KEY(L'PJOBKEY),KEYSAVE                                           
         BE    *+6                                                              
         DC    H'0'                                                             
         LA    R0,TMPWKAIO                                                      
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
*                                                                               
         LA    R2,TMPWKAIO+(PJOBELEM-PJOBREC)                                   
         MVI   ELCODE,PJSAIDQ                                                   
         BRAS  RE,NXTEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         USING PJSAELM,R2                                                       
         TM    PJSACH1,PJSAUSED    ALREADY MARKED AS USED ON EIO?               
         BNZ   MKADC26                                                          
         OI    PJSACH1,PJSAUSED    MARK ACTIVITY BIT AS USED ON EIO             
         GOTOR PUTPRT                                                           
         BRAS  RE,TSTERR                                                        
         B     MKADC26             CHECK FOR MORE                               
*                                                                               
MKADCR_X MVC   TMPSVKEY,KEY                                                     
         MVC   TMPSVAIO,AREC                                                    
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R2                                                            
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
PRCINSD  DSECT                                                                  
*                                                                               
RELO     DS    F                                                                
ADICSECT DS    A                                                                
*                                                                               
HPSW     DS    CL1                 INS HEADER PRINTED SWITCH                    
*                                                                               
PINLANG  DS    CL1                 TEMP STORAGE FOR "REAL" PUB LANGUAGE         
*                                                                               
ADRTYP   DS    CL1                 TYPE OF ADDR REC-PAY,TRAFFIC,ETC.            
CLTDATA  DS    0CL7                PASS KEY INFO TO PPGETADR MODULE             
CLTAGY   DS    CL2                                                              
CLTMED   DS    CL1                                                              
CLTCODE  DS    CL3                                                              
CLTOFF   DS    CL1                                                              
*                                                                               
SVYEARYY DS    CL2                 SAVE YEAR (YY) FROM WEB IO LONG KEY          
SVTMPKEY DS    XL(L'KEY)                                                        
SVPID    DS    XL(L'FAPASSWD)      SAVE PASSWORD ID NUMBER                      
*                                                                               
WKEIOFLG DS    X                   EIO WORK FLAG                                
E_NOINSQ EQU   X'80'               MASTER AD CODE W/O INSTRUCTION REC           
*        EQU   X'40'                                                            
E_IOBMFQ EQU   X'20'               CONTAIN BUY MOVE "FROM" INSERTION            
E_IOBMTQ EQU   X'10'               CONTAIN BUY MOVE "TO"   INSERTION            
*                                                                               
TMPSVKEY DS    XL(L'KEY)           TEMP SAVE KEY STORAGE                        
TMPSVAIO DS    XL(L'AREC)                                                       
*                                                                               
H_PUBINF DS    0X                  PUBLICATION INFO                             
H_PUBTYP DS    C                   ADDRESS TYPE                                 
H_PUBNAM DS    CL(L'PREPNAME)      NAME                                         
H_PUBAL1 DS    CL(L'PUBLINE1)      ADDRESS LINE 1                               
H_PUBAL2 DS    CL(L'PUBLINE2)      ADDRESS LINE 2                               
H_PUBAL3 DS    CL(L'PUBLINE3)      ADDRESS LINE 3                               
H_PUBCIT DS    CL(L'PUBCITY)       CITY                                         
H_PUBSTA DS    CL(L'PUBSTATE)      STATE                                        
H_PUBZIP DS    CL(L'PUBNWZIP)      ZIP CODE                                     
H_PUBATT DS    CL(L'PUBATTN)       PHONE NUMBER                                 
H_PUBPH# DS    CL(L'PUBTEL)        ATTENTION                                    
H_PUBFX# DS    CL(L'PUBSFAXN)      FAX NUMBER                                   
H_PUBWEB DS    CL(L'PUBWEBS+255-6) WEB ADDRESS                                  
H_PUBEML DS    CL(L'PGADEADD)      E-MAIL                                       
H_PUBCM1 DS    CL(L'P)             COMMENT                                      
H_PUBLAN DS    CL(L'PUBLANG)       PUBLICATION LANGUAGE                         
H_PUBINL EQU   *-H_PUBINF                                                       
*                                                                               
TMPFULL1 DS    F                                                                
TMPFULL2 DS    F                                                                
TMPHALF1 DS    H                                                                
TMPHALF2 DS    H                                                                
TMPBYTE1 DS    X                                                                
TMPBYTE2 DS    X                                                                
TMPBYTE3 DS    X                                                                
*                                                                               
TMPWK1   DS    XL256                                                            
TMPWK2   DS    XL256                                                            
*                                                                               
TMPWKAIO DS    XL4096              TEMP WORKING AIO                             
*                                                                               
PRCINSDX EQU   *                                                                
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         PRINT OFF                                                              
*                                                                               
* DICTIONARY FOR PP72PINS AND PPPRCINS                                          
*                                                                               
       ++INCLUDE PPIOPIND                                                       
         EJECT                                                                  
*                                                                               
       ++INCLUDE PPINSWRK1                                                      
         EJECT                                                                  
*                                                                               
       ++INCLUDE POLFILE                                                        
         EJECT                                                                  
*                                                                               
       ++INCLUDE PPINSWRK2                                                      
         EJECT                                                                  
*                                                                               
         PRINT ON                                                               
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'196PPPRCINS  01/27/17'                                      
         END                                                                    

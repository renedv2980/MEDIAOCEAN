*          DATA SET MPXVERTS   AT LEVEL 002 AS OF 05/01/02                      
*          DATA SET MPXVERT    AT LEVEL 038 AS OF 05/29/84                      
*CATALP MPXVERT                                                                 
         TITLE 'XVERT    - FILE INVERTER FOR CROSS TAB'                         
XVERT    CSECT                                                                  
         PRINT NOGEN                                                            
         NBASE 500,XVERT,=V(REGSAVE)                                            
         LR    RA,RC                                                            
         USING WORKD,RA                                                         
*                                  ADDRESS CONSTANTS                            
         LA    R1,ACONS                                                         
         LA    R2,RCONS                                                         
         LA    R0,ACONSN                                                        
ST4      DS    0H                                                               
         MVC   0(4,R2),0(R1)                                                    
         LA    R1,4(R1)                                                         
         LA    R2,4(R2)                                                         
         BCT   R0,ST4                                                           
*                                                                               
         L     R9,CPRINT                                                        
         USING DPRINT,R9                                                        
         MVI   DASHES,C'-'                                                      
         MVC   DASHES+1(L'DASHES-1),DASHES                                      
         ZAP   MAXPAGE,=P'0'                                                    
*                                                                               
         LA    RF,WORKD                                                         
         ST    RF,DUB                                                           
         L     RF,=A(CTABX)       **TEMPORARY UNTIL SOFT**                      
         ST    RF,HICORE                                                        
*                                                                               
         ST    RF,DUB+4                                                         
         OI    DUB+4,X'80'         EOL                                          
         GOTO1 STXITER,DMCB,DUB    NOTE STXITER WILL BE RESET                   
*                                  IN SETRUN IF SORTING                         
ST5      DS    0H                                                               
         MVC   TITLE(26),=C'XVERT - XTAB FILE INVERTER'                         
*                                                                               
         GOTO1 ASETRUN                                                          
         GOTO1 ABCT                                                             
*                                                                               
         LA    R3,PRTVS1           PRINT COUNTERS FOR SPEC PHASE                
         LA    R4,PRTWDS1                                                       
         BAS   RE,PRTCNTS                                                       
*                                                                               
         TM    ERRLEV,X'80'        TEST ERROR SEVERITY                          
         BZ    MP4                                                              
         MVC   P(43),=C'**ERRORS IN SPECIFICATIONS, RUN CANCELLED**'            
         GOTO1 PRINTER                                                          
         CLI   DMPSW,C'Y'                                                       
         BNE   *+6                                                              
         DC    H'0'                                                             
         B     EOJ                                                              
*                                                                               
MP4      DS    0H                                                               
         GOTO1 PRINTER                                                          
         MVC   P(11),=C'INPUT PHASE'                                            
         GOTO1 PRINTER                                                          
         MVC   P(11),DASHES                                                     
         GOTO1 PRINTER                                                          
*                                                                               
         CLI   WORKF,C'I'          TEST INPUT WORKFILE                          
         BE    MP30                                                             
*                                                                               
MP6      DS    0H                                                               
         GOTO1 AGETRESP                                                         
         CLI   LASTRNO,X'FF'                                                    
         BE    MP10                                                             
         GOTO1 APOSTR                                                           
*                                                                               
         CLC   RGCNT,GULPSZE                                                    
         BL    MP6                                                              
*                                                                               
MP10     DS    0H                                                               
         GOTO1 AFLSHTAB                                                         
         CLI   LASTRNO,X'FF'                                                    
         BNE   MP6                                                              
*                                                                               
         LA    R3,PRTVS2           PRINT INPUT PHASE COUNTERS                   
         LA    R4,PRTWDS2                                                       
         BAS   RE,PRTCNTS                                                       
*                                                                               
         MVC   P(12),=C'OUTPUT PHASE'                                           
         GOTO1 PRINTER                                                          
         MVC   P(12),DASHES                                                     
         GOTO1 PRINTER                                                          
*                                                                               
         CLI   WORKF,C'S'                                                       
         BNE   MP90                                                             
*                                                                               
MP22     DS    0H                                                               
         GOTO1 SORTER,DMCB,=C'GET'                                              
         L     R4,DMCB+4                                                        
         LTR   R4,R4                                                            
         BNZ   *+8                                                              
         LA    R4,=X'FF'           SET EOF                                      
         ST    R4,AWTREC                                                        
*                                                                               
         GOTO1 AOPPROC                                                          
         CLI   0(R4),X'FF'         TEST DONE                                    
         BNE   MP22                                                             
         B     MP90                                                             
*                                                                               
MP30     DS    0H                  PROCESS WORKFILE AS INPUT TAPE               
         GOTO1 AIPPROC                                                          
         GOTO1 AOPPROC                                                          
         L     RF,AWTREC                                                        
         CLI   0(RF),X'FF'         EOF                                          
         BNE   MP30                                                             
*                                                                               
MP90     DS    0H                                                               
         LA    R3,PRTVS3           PRINT OUTPUT PHASE COUNTERS                  
         LA    R4,PRTWDS3                                                       
         BAS   RE,PRTCNTS                                                       
*                                                                               
DONE     DS    0H                                                               
         CLI   DMPSW,C'Y'                                                       
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
EOJ      DS    0H                                                               
         XBASE                                                                  
         SPACE 3                                                                
*                                  PRINT SET OF COUNTERS                        
PRTCNTS  NTR1                                                                   
         GOTO1 PRINTER                                                          
         ZIC   R5,0(R4)            NUMBER OF COUNTERS                           
         LA    R4,1(R4)                                                         
*                                                                               
PRTCNT2  DS    0H                                                               
         MVC   P(35),0(R4)                                                      
         EDIT  (B4,0(R3)),(9,P+35),COMMAS=YES                                   
         MVC   P+50(30),35(R4)                                                  
         GOTO1 PRINTER                                                          
*                                                                               
         LA    R3,4(R3)                                                         
         LA    R4,65(R4)                                                        
         BCT   R5,PRTCNT2                                                       
*                                                                               
         GOTO1 PRINTER                                                          
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
         SPACE 3                                                                
ACONS    DS    0F                                                               
         DC    V(CARDS)                                                         
         DC    V(SCANNER)                                                       
         DC    A(BCT)                                                           
         DC    V(SORTER)                                                        
         DC    A(SETRUN)                                                        
         DC    V(HEXOUT)                                                        
         DC    V(XSORT)                                                         
         DC    V(STXITER)                                                       
         DC    A(CVEBC)                                                         
         DC    V(CBTBL)                                                         
         DC    A(PRNTR)                                                         
         DC    V(PRINTER)                                                       
         DC    V(CPRINT)                                                        
         DC    A(GETERR)                                                        
         DC    A(CTAB)                                                          
         DC    A(WTAPI)                                                         
         DC    A(WTAPO)                                                         
         DC    A(INTAPE)                                                        
         DC    A(LDTAPE)                                                        
         DC    A(MASKTAB)                                                       
         DC    A(IPPROC)                                                        
         DC    A(OPPROC)                                                        
         DC    A(DMPREC)                                                        
         DC    A(SETSORT)                                                       
         DC    A(FLSHTAB)                                                       
         DC    V(NUMVAL)                                                        
         DC    A(GETRESP)                                                       
         DC    A(POSTR)                                                         
ACONSN   EQU   (*-ACONS)/4                                                      
         SPACE 2                                                                
PRTWDS1  DS    0C                                                               
         DC    AL1(5)                                                           
         DC    CL35'(A) VALID CONDITIONS...............'                        
         DC    CL30' '                                                          
         DC    CL35'(B) ADJUSTED CONDITON COUNT........'                        
         DC    CL30'(FOR NUM/ALPHA RESPONSES)'                                  
         DC    CL35'(C) CORE AVAILABLE FOR STRINGS.....'                        
         DC    CL30' '                                                          
         DC    CL35'(D) PROJECTED ''GULP'' SIZE..........'                      
         DC    CL30'(C / B) * 8  MAX 32704'                                     
         DC    CL35'(E) PROJECTED WORKFILE RECLEN......'                        
         DC    CL30'(D / 8) + 8(WKEYLEN)  MAX 4096'                             
         SPACE 2                                                                
PRTWDS2  DS    0C                                                               
         DC    AL1(7)                                                           
         DC    CL35'(F) ACTUAL ''GULP'' SIZE.............'                      
         DC    CL30' '                                                          
         DC    CL35'(G) ACTUAL WORKFILE RECLEN.........'                        
         DC    CL30'(F / 8) + 8(WKEYLEN)'                                       
         DC    CL35'(H) INPUT FILE RECORD COUNT........'                        
         DC    CL30' '                                                          
         DC    CL35'(I) VALID RESPONDENT COUNT.........'                        
         DC    CL30' '                                                          
         DC    CL35'(J) ''GULP'' COUNT...................'                      
         DC    CL30'(I / F)'                                                    
         DC    CL35'(K) DATA INPUT ERRORS..............'                        
         DC    CL30' '                                                          
         DC    CL35'(L) WORKFILE OUTPUT COUNT..........'                        
         DC    CL30' '                                                          
         SPACE 2                                                                
PRTWDS3  DS    0C                                                               
         DC    AL1(3)                                                           
         DC    CL35'(M) WORK FILE INPUT COUNT..........'                        
         DC    CL30' '                                                          
         DC    CL35'(N) LOAD FILE RECORD COUNT.........'                        
         DC    CL30' '                                                          
         DC    CL35'(O) LOAD FILE BYTE COUNT...........'                        
         DC    CL30' '                                                          
*                                                                               
*                                  COLUMN BINARY CONVERSION TABLE               
MASKTAB  DS    0C                                                               
         DC    C'X',X'20'                                                       
         DC    C'Y',X'10'                                                       
         DC    C'0',X'08'                                                       
         DC    C'1',X'04'                                                       
         DC    C'2',X'02'                                                       
         DC    C'3',X'01'                                                       
         DC    C'4',X'A0'          X'80' = BYTE 2                               
         DC    C'5',X'90'                                                       
         DC    C'6',X'88'                                                       
         DC    C'7',X'84'                                                       
         DC    C'8',X'82'                                                       
         DC    C'9',X'81'                                                       
*                                                                               
         EJECT                                                                  
*                                  SET RUN PARAMETERS                           
SETRUN   CSECT                                                                  
         NMOD1 0,SETRUN                                                         
         SPACE 2                                                                
         GOTO1 PRINTER                                                          
         MVC   P(18),=C'RUN SPECIFICATIONS'                                     
         GOTO1 PRINTER                                                          
         MVC   P(18),DASHES                                                     
         GOTO1 PRINTER                                                          
*                                                                               
         MVI   ERR,SPECERR                                                      
*                                                                               
         MVI   RECCODE,X'01'                                                    
         MVC   CNUMLST,=C'1234567890XY'    CARD NOS 1 - 12                      
         MVC   MAXGULP,=A((4096-L'WTKEY)*8) MAX PER GULP                        
*                                         (FIXES MAX OF WTREC AT 4096)          
         MVC   LDRMAX,=F'4000'     DEFAULT LOAD REC LEN                         
SR2      DS    0H                                                               
         GOTO1 CARDS,DMCB,CARD,=C'RE00'                                         
         MVC   P(80),CARD                                                       
         GOTO1 PRINTER                                                          
         CLC   =C'/*',CARD                                                      
         BE    SR60                                                             
         CLI   CARD,C'*'           IGNORE CARDS WITH *                          
         BE    SR2                                                              
         LA    RE,CEDTWRK                                                       
         LA    RF,L'CEDTWRK                                                     
*        XCEF                                                                   
*                                                                               
         GOTO1 SCANNER,DMCB,(C'C',CARD),CEDTWRK                                 
         LA    R2,CEDTWRK                                                       
*                                                                               
SR3      DS    0H                                                               
         CLI   0(R2),0             END OF FIELDS                                
         BE    SR2                 NEXT CARD                                    
*                                                                               
         CLC   =C'DUMP',12(R2)                                                  
         BNE   SR8                                                              
         MVI   DMPSW,C'Y'                                                       
         B     SR40                                                             
*                                                                               
SR8      DS    0H                                                               
         CLC   =C'NCARDS',12(R2)   NUMBER OF CARDS/RESP                         
         BNE   SR9                                                              
         OC    8(4,R2),8(R2)                                                    
         BZ    SRERRC                                                           
         MVC   NCARDS,8(R2)                                                     
         B     SR40                                                             
*                                                                               
SR9      DS    0H                                                               
         CLC   =C'NCOLS',12(R2)    NUMBER OF COLUMNS/CARD                       
         BNE   SR10                                                             
         OC    8(4,R2),8(R2)                                                    
         BZ    SRERRC                                                           
         MVC   NCOLS,8(R2)                                                      
         B     SR40                                                             
*                                                                               
SR10     DS    0H                                                               
         CLC   =C'BLKSIZE',12(R2)  INPUT FILE BLOCK SIZE                        
         BNE   SR11                                                             
         OC    8(4,R2),8(R2)                                                    
         BZ    SRERRC                                                           
         MVC   BLKSIZE,8(R2)                                                    
         B     SR40                                                             
*                                                                               
SR11     DS    0H                                                               
         CLC   =C'RESPNCOL',12(R2)   COLUMN FOR RESP NUMBER                     
         BNE   SR12                                                             
         OC    8(4,R2),8(R2)                                                    
         BZ    SRERRC                                                           
         MVC   RESPCOL,8(R2)                                                    
         B     SR40                                                             
*                                                                               
SR12     DS    0H                                                               
         CLC   =C'RESPNLEN',12(R2)   LENGTH OF RESPONDENT NUMBER                
         BNE   SR13                                                             
         OC    8(4,R2),8(R2)                                                    
         BZ    SRERRC                                                           
         CLC   RESPLEN,=F'10'                                                   
         BH    SRERRC                                                           
         MVC   RESPLEN,8(R2)                                                    
         B     SR40                                                             
*                                                                               
SR13     DS    0H                                                               
         CLC   =C'CARDNCOL',12(R2)   COLUMN FOR CARD NUMBER                     
         BNE   SR14                                                             
         OC    8(4,R2),8(R2)                                                    
         BZ    SRERRC                                                           
         MVC   CARDCOL,8(R2)                                                    
         B     SR40                                                             
*                                                                               
SR14     DS    0H                                                               
         CLC   =C'CARDNLEN',12(R2)   LENGTH OF CARD NUMBER FIELD                
         BNE   SR15                                                             
         OC    8(4,R2),8(R2)                                                    
         BZ    SRERRC                                                           
         MVC   CARDLEN,8(R2)                                                    
         B     SR40                                                             
*                                                                               
SR15     DS    0H                                                               
         CLC   =C'PRINTWI',12(R2)   PRINT WORK INPUT TAPE RECS                  
         BNE   SR15B                                                            
         MVC   PRINTWI,22(R2)                                                   
         B     SR40                                                             
*                                                                               
SR15B    DS    0H                                                               
         CLC   =C'PRINTWO',12(R2)  PRINT WORK OUTPUT RECS                       
         BNE   SR16                                                             
         MVC   PRINTWO,22(R2)                                                   
         B     SR40                                                             
*                                                                               
SR16     DS    0H                                                               
         CLC   =C'PRINTI',12(R2)                                                
         BNE   SR17                                                             
         MVC   PRINTI,22(R2)                                                    
         B     SR40                                                             
*                                                                               
SR17     DS    0H                                                               
         CLC   =C'PRINTE',12(R2)   PRINT ERROR RESPONDENTS                      
         BNE   SR18                                                             
         MVC   PRINTE,22(R2)                                                    
         B     SR40                                                             
*                                                                               
SR18     DS    0H                                                               
         CLC   =C'PRINTO',12(R2)   PRINT OUTPUT RECORDS                         
         BNE   SR18B                                                            
         MVC   PRINTO,22(R2)                                                    
         B     SR40                                                             
*                                                                               
SR18B    DS    0H                                                               
         CLC   =C'PRINTALL',12(R2)                                              
         BNE   SR19                                                             
         MVC   PRINTI,22(R2)                                                    
         MVC   PRINTE,22(R2)                                                    
         MVC   PRINTO,22(R2)                                                    
         MVC   PRINTWI,22(R2)                                                   
         MVC   PRINTWO,22(R2)                                                   
         B     SR40                                                             
*                                                                               
SR19     DS    0H                                                               
         CLC   =C'WORKFILE',12(R2)  WORKFILE OPTION                             
         BNE   SR20                                                             
         MVC   WORKF,22(R2)                                                     
         B     SR40                                                             
*                                                                               
SR20     DS    0H                                                               
         CLC   =C'CORE',12(R2)     LIMIT CORE FOR TESTING                       
         BNE   SR22                                                             
         MVC   CORELIM,8(R2)                                                    
         B     SR40                                                             
*                                                                               
SR22     DS    0H                                                               
         CLC   =C'SORTSIZE',12(R2)                                              
         BNE   SR23                                                             
         MVC   SORTSIZE,8(R2)                                                   
         B     SR40                                                             
*                                                                               
SR23     DS    0H                                                               
         CLC   =C'NRESPS',12(R2)   PRE-SET NUMBER OF RESPONDENTS                
         BNE   SR24                                                             
         MVC   NRESPS,8(R2)                                                     
         B     SR40                                                             
*                                                                               
SR24     DS    0H                                                               
         CLC   =C'INCARD',12(R2)   REPLICATION FACTOR FOR CARD INPUT            
         BNE   SR24D                                                            
         MVC   INCARD,8(R2)                                                     
         MVC   INCARDC,8(R2)                                                    
         B     SR40                                                             
*                                                                               
SR24D    DS    0H                                                               
         CLC   =C'INPUT',12(R2)    INPUT MODE                                   
         BNE   SR25                                                             
         MVC   INPUT,22(R2)                                                     
         B     SR40                                                             
*                                                                               
SR25     DS    0H                                                               
         CLC   =C'LOADTAPE',12(R2)                                              
         BNE   SR26                                                             
         MVC   LOADTAPE,22(R2)                                                  
         B     SR40                                                             
*                                                                               
SR26     DS    0H                                                               
         CLC   =C'INCOND',12(R2)   CONDITION REPLICATOR FOR TESTING             
         BNE   SR27                                                             
         MVC   INCOND,8(R2)                                                     
         B     SR40                                                             
*                                                                               
SR27     DS    0H                                                               
         CLC   =C'PAGES',12(R2)                                                 
         BNE   SR28                                                             
         L     RF,8(R2)                                                         
         CVD   RF,DUB                                                           
         ZAP   MAXPAGE,DUB                                                      
         B     SR40                                                             
*                                                                               
SR28     DS    0H                                                               
         CLC   =C'COMPRESS',12(R2)                                              
         BNE   SR29                                                             
         MVC   CMPRES,22(R2)                                                    
         B     SR40                                                             
*                                                                               
SR29     DS    0H                                                               
         CLC   =C'LDRECSIZE',12(R2)                                             
         BNE   SR30                                                             
         MVC   LDRMAX,8(R2)                                                     
         B     SR40                                                             
*                                                                               
SR30     DS    0H                                                               
         CLC   =C'FILECODE',12(R2)                                              
         BNE   SR31                                                             
         MVC   FILCODE,22(R2)                                                   
         B     SR40                                                             
*                                                                               
SR31     DS    0H                                                               
         B     SRERRC              UNKNOWN SPEC                                 
*                                                                               
SR40     DS    0H                                                               
         LA    R2,32(R2)           NEXT SCANNER                                 
         B     SR3                                                              
*                                  CHECK ALL FIELDS FOR CONSISTENCY             
SR60     DS    0H                                                               
         GOTO1 PRINTER                                                          
         SR    R2,R2               SO SRERR WILL NOT PRINT FROM CARD            
*                                                                               
         MVI   ERR,NCRDERR                                                      
         OC    NCARDS,NCARDS                                                    
         BNZ   *+8                                                              
         BAS   RE,SRERR                                                         
*                                                                               
         MVI   ERR,NCOLERR                                                      
         OC    NCOLS,NCOLS                                                      
         BNZ   *+8                                                              
         BAS   RE,SRERR                                                         
*                                                                               
         L     RF,NCOLS            NO. OF COLUMNS                               
         SLL   RF,1                X 2 FOR COLUMN BINARY                        
         ST    RF,CRECL            =ACTUAL 'CARD' SIZE                          
*                                                                               
         OC    BLKSIZE,BLKSIZE                                                  
         BNZ   SR62                                                             
         L     RF,NCOLS                                                         
         SLL   RF,1                NCOLS X 2 FOR COL BINARY                     
         ST    RF,BLKSIZE                                                       
         B     SR64                                                             
*                                                                               
SR62     DS    0H                                                               
         L     R1,BLKSIZE                                                       
         SR    R0,R0                                                            
         L     RF,NCOLS                                                         
         SLL   RF,1                X 2 FOR COL BINARY                           
         DR    R0,RF                                                            
         LTR   R0,R0                                                            
         BZ    SR64                                                             
         MVI   ERR,BLKERR          BLKSIZE NOT MULTIPLE OF CARD SIZE            
         BAS   RE,SRERR                                                         
*                                                                               
SR64     DS    0H                                                               
         OC    RESPCOL,RESPCOL     IF RESP NO. USED                             
         BZ    SR68                                                             
         MVI   ERR,RSPLERR                                                      
         OC    RESPLEN,RESPLEN     LENGTH MUST BE GIVEN                         
         BNZ   *+8                                                              
         BAS   RE,SRERR                                                         
*                                                                               
         L     RF,RESPCOL                                                       
         A     RF,RESPLEN                                                       
         BCTR  RF,R0                                                            
         C     RF,NCOLS                                                         
         BNH   *+8                                                              
         BAS   RE,SRERR                                                         
*                                                                               
SR68     DS    0H                                                               
         MVI   ERR,CRDLERR                                                      
         OC    CARDCOL,CARDCOL     IF CARD NO. USED                             
         BZ    SR72                                                             
         OC    CARDLEN,CARDLEN     LENGTH MUST BE GIVEN                         
         BNZ   *+8                                                              
         BAS   RE,SRERR                                                         
         CLC   CARDLEN,=F'4'                                                    
         BNH   *+8                                                              
         BAS   RE,SRERR                                                         
*                                                                               
         L     RF,CARDCOL                                                       
         A     RF,CARDLEN                                                       
         BCTR  RF,R0                                                            
         C     RF,NCOLS                                                         
         BNH   *+8                                                              
         BAS   RE,SRERR                                                         
*                                                                               
*                                                                               
SR72     DS    0H                                                               
         L     RF,NCARDS                                                        
         M     RE,NCOLS                                                         
         SLL   RF,1                X 2 FOR COLUMN BINARY                        
         C     RF,=F'65535'                                                     
         BNH   SR73                                                             
         MVI   ERR,CXCERR                                                       
         BAS   RE,SRERR                                                         
SR73     DS    0H                                                               
         ST    RF,LREC             LENGTH OF RESPONDENT SET                     
*                                                                               
         CLI   WORKF,C'S'          IF SORT RUN                                  
         BNE   SR74                                                             
         OC    SORTSIZE,SORTSIZE   AND SIZE NOT SET                             
         BNZ   SR74                                                             
         MVC   SORTSIZE,=F'45'     DEFAULT IS 45 K                              
*                                  SET SORT AREA AT END OF PARTITION            
         L     RF,SORTSIZE         SIZE IN K                                    
         SLL   RF,10               TO BYTES                                     
         L     RE,HICORE                                                        
         SR    RE,RF                                                            
         SRL   RE,3                                                             
         SLL   RE,3                                                             
         MVC   0(8,RE),=C'**SORT**'                                             
         LA    RE,8(RE)                                                         
         ST    RE,ASORTWK                                                       
         ST    RE,DUB+4            FOR STXITER                                  
         SH    RE,=H'16'                                                        
         ST    RE,HICORE                                                        
         OI    DUB+4,X'80'         SET EOL                                      
         LA    RF,WORKD                                                         
         ST    RF,DUB                                                           
         GOTO1 STXITER,DMCB,DUB                                                 
*                                                                               
*                                                                               
SR74     DS    0H                                                               
         CLI   FILCODE,C' '        TEST HAVE FILE CODE                          
         BH    SR75                                                             
         MVI   ERR,FILECERR                                                     
         BAS   RE,SRERR                                                         
*                                                                               
SR75     DS    0H                                                               
         OC    INCOND,INCOND       IF CONDITION REPLICATOR NOT SET              
         BNZ   *+10                                                             
         MVC   INCOND,=F'1'        SET TO ONE                                   
*                                                                               
         MVC   WTBLKSZE,=F'4096'   BLOCK SIZE FOR WORK TAPES                    
*                                                                               
SRX      DS    0H                                                               
         XIT1                                                                   
SRERR    NTR1                                                                   
         GOTO1 AGETERR,DMCB,(ERR,P)                                             
         LA    R6,P+2                                                           
         A     R6,DMCB+4                                                        
         LTR   R2,R2               TEST HAVE SCANNER FIELD                      
         BZ    *+10                                                             
         MVC   0(12,R6),12(R2)                                                  
         GOTO1 PRINTER                                                          
         XIT1                                                                   
*                                                                               
SRERRC   DS    0H                                                               
         BAS   RE,SRERR                                                         
         B     SR40                                                             
         SPACE 3                                                                
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                  BUILD CONDITION TABLE                        
         SPACE 2                                                                
BCT      CSECT                                                                  
         NMOD1 0,BCT                                                            
*                                                                               
         GOTO1 PRINTER                                                          
         MVC   P(32),=C'CARD/COLUMN/PUNCH SPECIFICATIONS'                       
         GOTO1 PRINTER                                                          
         MVC   P(32),DASHES                                                     
         GOTO1 PRINTER                                                          
*                                                                               
         MVC   CRDNO,=F'1'                                                      
         MVC   COLNO,=F'1'                                                      
         MVI   ERR,SPECERR                                                      
         L     R4,ACTAB                                                         
         MVC   0(8,R4),=C'*CONTAB*'                                             
         LA    R4,8(R4)                                                         
         ST    R4,ACTAB                                                         
         USING CTABD,R4                                                         
*                                                                               
BCT2     DS    0H                                                               
         GOTO1 CARDS,DMCB,CARD,=C'RE00'                                         
         MVC   P(80),CARD                                                       
         GOTO1 PRINTER                                                          
         CLC   =C'/*',CARD                                                      
         BE    BCT60                                                            
         CLI   CARD,C'*'           IGNORE CARDS WITH *                          
         BE    BCT2                                                             
         LA    RE,CEDTWRK                                                       
         LA    RF,L'CEDTWRK                                                     
         XCEF                                                                   
         GOTO1 SCANNER,DMCB,(C'C',CARD),CEDTWRK                                 
*                                                                               
         LA    R2,CEDTWRK                                                       
BCT3     DS    0H                                                               
         CLI   0(R2),0             END OF FIELDS                                
         BE    BCT2                NEXT CARD                                    
*                                                                               
         CLC   =C'ACCESS',12(R2)     CARD POINTER                               
         BNE   BCT12                                                            
         OC    8(4,R2),8(R2)                                                    
         BZ    BCTERRC                                                          
         CLC   8(4,R2),=F'255'                                                  
         BH    BCTERRC                                                          
         MVC   ACCESS,11(R2)                                                    
         B     BCT40                                                            
*                                                                               
BCT12    DS    0H                                                               
*                                                                               
         CLC   =C'CARD',12(R2)     CARD POINTER                                 
         BNE   BCT13                                                            
         OC    8(4,R2),8(R2)                                                    
         BZ    BCTERRC                                                          
         CLC   8(4,R2),NCARDS                                                   
         BH    BCTERRC                                                          
         MVC   CRDNO,8(R2)                                                      
         B     BCT40                                                            
*                                                                               
BCT13    DS    0H                                                               
         CLC   =C'COL',12(R2)      COLUMN POINTER                               
         BNE   BCT14                                                            
         OC    8(4,R2),8(R2)                                                    
         BZ    BCTERRC                                                          
         CLC   8(4,R2),NCOLS                                                    
         BH    BCTERRC                                                          
         MVC   COLNO,8(R2)                                                      
         B     BCT40                                                            
*                                                                               
BCT14    DS    0H                                                               
         CLI   12(R2),C'N'         N= NUMERIC FIELD                             
         BNE   BCT15                                                            
         ZIC   R3,0(R2)            LENGTH OF INPUT                              
         BCTR  R3,R0                                                            
         GOTO1 NUMVAL,DMCB,13(R2),(R3)                                          
         CLI   DMCB,0                                                           
         BNE   BCTERRC                                                          
         L     R0,DMCB+4                                                        
         STC   R0,CTNLEN                                                        
*                                                                               
         A     R0,COLNO                                                         
         BCTR  R0,R0                                                            
         C     R0,NCOLS                                                         
         BNH   BCT14B                                                           
         MVI   ERR,COLERR          PAST END OF CARD                             
         B     BCTERRC                                                          
BCT14B   DS    0H                                                               
*                                                                               
*                                  SET BINARY LENGTH                            
*                                  BASED ON FIELD LENGTH                        
         LA    R1,1                                                             
         CLI   CTNLEN,2                                                         
         BNH   BCT14D                                                           
         LA    R1,2                                                             
         CLI   CTNLEN,4                                                         
         BNH   BCT14D                                                           
         LA    R1,3                                                             
         CLI   CTNLEN,7                                                         
         BNH   BCT14D                                                           
         LA    R1,4                                                             
*                                                                               
BCT14D   DS    0H                                                               
         STC   R1,CTTYP            SET TYPE = BINARY LENGTH                     
         SLL   R1,3                                                             
         ST    R1,CFACT            SET FACTOR FOR CORE NEED                     
         B     BCT30                                                            
*                                                                               
BCT15    DS    0H                  PUNCH SPEC                                   
         CLI   0(R2),1             LENGTH MUST BE 1                             
         BNE   BCTERRC                                                          
*                                  CONVERT TO COLUMN BINARY MASK                
         LA    R0,12                                                            
         L     R1,AMASKTAB                                                      
BCT15B   DS    0H                                                               
         CLC   12(1,R2),0(R1)                                                   
         BE    BCT15D                                                           
         LA    R1,2(R1)                                                         
         BCT   R0,BCT15B                                                        
         B     BCTERRC                                                          
*                                                                               
BCT15D   DS    0H                                                               
         MVC   CTMASK,1(R1)        SET IN TAB                                   
         MVI   CTTYP,0             PUNCH CONDITION                              
         MVI   CFACT+3,1           FACTOR FOR CORE NEEDS                        
         B     BCT30                                                            
*                                                                               
BCT30    DS    0H                                                               
         L     RF,CRDNO            CARD NO                                      
         BCTR  RF,R0               MINUS 1                                      
         M     RE,NCOLS            X NCOLS                                      
         A     RF,COLNO            + COLUMN NO                                  
         BCTR  RF,R0               MINUS 1                                      
         SLL   RF,1                X 2 FOR COLUMN BINARY                        
         STCM  RF,3,CTDISP         =DISPLACEMENT INTO RESP                      
         L     R6,INCOND           BCT FOR REPLICATING CONDITIONS               
*                                                                               
BCT38    DS    0H                                                               
         L     RF,CNEED            BUMP CORE NEED                               
         A     RF,CFACT                                                         
         ST    RF,CNEED                                                         
*                                  BUMP CONDITION COUNT BY TYPE                 
         ZIC   RF,CTTYP                                                         
         SLL   RF,2                                                             
         L     RE,NCONDS(RF)                                                    
         LA    RE,1(RE)                                                         
         ST    RE,NCONDS(RF)                                                    
*                                                                               
         L     RE,NCONDT           TOTAL CONDITIONS                             
         LA    RE,1(RE)                                                         
         ST    RE,NCONDT                                                        
*                                                                               
         MVC   CTABL(CTABL,R4),0(R4) REPEAT                                     
         LA    R4,CTABL(R4)        NEXT CONDITION                               
         BCT   R6,BCT38                                                         
*                                                                               
BCT40    DS    0H                                                               
         LA    R2,32(R2)           NEXT SCANNER                                 
         B     BCT3                                                             
         SPACE 3                                                                
BCT60    DS    0H                                                               
*                                  SORT CONDITON TABLE                          
         CLC   NCONDT,=F'1'                                                     
         BNH   BCT60F                                                           
         CLC   INCOND,=F'1'                                                     
         BH    BCT60F              SKIP IF REPLICATING CONDITIONS               
         L     R5,NCONDT                                                        
         ST    R5,DMCB+4                                                        
         GOTO1 XSORT,DMCB,ACTAB,,4,4,0                                          
*                                  CHECK FOR DUPES                              
         L     R5,ACTAB                                                         
         L     R0,NCONDT                                                        
         BCTR  R0,R0                                                            
*                                                                               
BCT60B   DS    0H                                                               
         CLC   0(CTABL,R5),CTABL(R5)  TEST VS NEXT                              
         BE    BCT60D                                                           
         LA    R5,CTABL(R5)                                                     
         BCT   R0,BCT60B                                                        
         B     BCT60F                                                           
BCT60D   DS    0H                                                               
         MVI   ERR,CTDUPERR                                                     
         BAS   RE,BCTERR                                                        
*                                                                               
BCT60F   DS    0H                                                               
         MVI   0(R4),X'FF'         END OF CONDITION TABLE                       
         LA    R4,8(R4)            PUT ON DOUBLE WORD BOUNDARY                  
*                                  BUMP BY 8 (NOT 7) FOR EOF FF                 
         SRL   R4,3                                                             
         SLL   R4,3                                                             
         MVC   0(8,R4),=C'**RESP**'                                             
         LA    R4,8(R4)                                                         
         ST    R4,AREC             A(DATA RECORD SET)                           
*                                                                               
         LR    RF,R4                                                            
         A     RF,LREC                                                          
         LA    RF,7(RF)            PUT ON DOUBLE WORD BOUNDARY                  
         SRL   RF,3                                                             
         SLL   RF,3                                                             
         MVC   0(8,RF),=C'*INPIOW*'                                             
         LA    RF,8(RF)                                                         
         ST    RF,ARECWRK          AREA FOR RECORD READS                        
         L     RF,NCOLS                                                         
         SLL   RF,1                X 2 FOR COLUMN BINARY                        
         A     RF,ARECWRK                                                       
*                                                                               
         LA    RF,7(RF)            PUT ON DOUBLE WORD BOUNDARY                  
         SRL   RF,3                                                             
         SLL   RF,3                                                             
         MVC   0(8,RF),=C'**WTREC*'                                             
         LA    RF,8(RF)                                                         
         ST    RF,AWTREC           WORK RECORD AREA                             
*                                                                               
         AH    RF,=H'4096'         PLUS WORK RECORD MAX LENGTH                  
         LA    RF,7(RF)            PUT ON DOUBLE WORD BOUNDARY                  
         SRL   RF,3                                                             
         SLL   RF,3                                                             
         MVC   0(8,RF),=C'*CONWTB*'                                             
         LA    RF,8(RF)                                                         
         ST    RF,ADTAB            ADDRESS FOR CONDITION WORK AREA              
*                                                                               
         LR    R4,RF                                                            
         L     RF,HICORE                                                        
         SR    RF,R4                                                            
         OC    CORELIM,CORELIM     TEST CORESIZE SET FOR TEST                   
         BZ    BCT62B                                                           
         C     RF,CORELIM                                                       
         BNH   BCT62B                                                           
         L     RF,CORELIM                                                       
*                                                                               
BCT62B   DS    0H                                                               
         ST    RF,CWKSIZE          CORE AVAILABLE FOR STRINGS                   
         SLL   RF,3                X 8 BEFORE DIVISION                          
         SR    RE,RE                                                            
         L     R1,CNEED            CNEED IS 8 X (BITS NOT BYTES)                
         LA    R1,2(R1)            BUMP BY 2 (ROOM FOR WTREC AREA)              
         DR    RE,R1                                                            
         ST    RF,GULPSZE          SIZE OF GULP - RESPONDENTS THAT              
*                                  CAN BE PROCESSED IN ONE SHOT                 
*                                  ADJUST GULPSZE                               
         OC    NRESPS,NRESPS       IS NUMBER OF RESPS KNOWN                     
         BZ    BCT63               NO                                           
         L     RF,NRESPS                                                        
         LA    RF,7(RF)            FORCE UP TO MULTIPE OF 8                     
         SRL   RF,3                                                             
         SLL   RF,3                                                             
*                                                                               
         C     RF,GULPSZE          IS IT LOWER THAN CALCULATED SIZE             
         BH    *+12                                                             
         ST    RF,GULPSZE          YES-USE KNOWN SIZE                           
         B     BCT63                                                            
*                                  IF HIGHER ADJUST GULPSZE FOR                 
*                                  EVEN SIZED GULPS                             
         SR    R0,R0                                                            
         LR    R1,RF                                                            
         D     R0,GULPSZE                                                       
         LTR   R0,R0                                                            
         BZ    BCT63               ALREADY EVEN                                 
         LA    RE,1(R1)                                                         
         LR    R1,RF                                                            
         AR    R1,RE                                                            
*                                                                               
         SR    R0,R0                                                            
         DR    R0,RE                                                            
         ST    R1,GULPSZE          EVENED UP GULPSZE                            
*                                                                               
BCT63    DS    0H                                                               
         CLC   GULPSZE,MAXGULP  TEST VS MAXIMUM                                 
         BNH   *+10                                                             
         MVC   GULPSZE,MAXGULP                                                  
         L     RF,GULPSZE                                                       
         SRL   RF,3                ENSURE DIVISIBILITY BY 8                     
         SLL   RF,3                                                             
         ST    RF,GULPSZE                                                       
*                                                                               
         LTR   RF,RF                                                            
         BP    BCT62D                                                           
         MVI   ERR,CORERR                                                       
         BAS   RE,BCTERR                                                        
         B     BCTX                                                             
BCT62D   DS    0H                                                               
*                                  SET CONDITION AREA WORK LENGTHS              
         L     RF,GULPSZE                                                       
         SRL   RF,3                1 BYTE FOR 8 RESPS                           
         ST    RF,CONDLTAB+0       FOR COND TYPE 0 (PUNCH)                      
         L     RF,GULPSZE          1 BYTE PER RESP                              
         ST    RF,CONDLTAB+4       FOR TYPE 1                                   
         A     RF,GULPSZE          2 PER                                        
         ST    RF,CONDLTAB+8       FOR TYPE 2                                   
         A     RF,GULPSZE          3 PER                                        
         ST    RF,CONDLTAB+12      FOR TYPE 3                                   
         A     RF,GULPSZE          4 PER                                        
         ST    RF,CONDLTAB+16      FOR TYPE 4                                   
*                                                                               
         MVC   CONDSZE,CONDLTAB+0  REPEAT FOR TYPE 0                            
         L     RF,CONDSZE                                                       
         CH    RF,=H'4'            MUST BE AT LEAST 4                           
         BNL   *+8                 FOR WORK REC                                 
         LH    RF,=H'4'                                                         
         LA    RF,L'WTKEY(RF)                                                   
         ST    RF,LWTREC           LENGTH OF WORK RECORD                        
*                                                                               
         B     BCTX                                                             
*                                                                               
BCTX     DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
BCTERR   NTR1                                                                   
         GOTO1 AGETERR,DMCB,(ERR,P)                                             
         LA    R6,P+2                                                           
         A     R6,DMCB+4                                                        
         LTR   R2,R2               TEST HAVE SCANNER FIELD                      
         BZ    *+10                                                             
         MVC   0(12,R6),12(R2)                                                  
         GOTO1 PRINTER                                                          
         XIT1                                                                   
BCTERRC  DS    0H                                                               
         BAS   RE,BCTERR                                                        
         B     BCT40                                                            
*                                                                               
         SPACE 3                                                                
         LTORG                                                                  
         SPACE 3                                                                
         EJECT                                                                  
*                             GET RESPONDENT AND CHECK VALIDITY                 
         SPACE 2                                                                
GETRESP  CSECT                                                                  
         NMOD1 0,GETRESP                                                        
         CLI   INPSW,0        TEST FIRST TIME                                   
         BNE   GR12                                                             
         MVI   INPSW,1                                                          
*                                  ADJUST INPUT DTF                             
         L     R6,AINTAPE                                                       
         MVC   62(2,R6),BLKSIZE+2  BLKSIZE                                      
         MVC   82(2,R6),CRECL+2    'CARD' REC SIZE                              
         OPEN  (INTAPE,INPUT)                                                   
*                                                                               
*                             DO INITIAL READ                                   
         XC    CRDCNT,CRDCNT                                                    
         BAS   RE,GRGET                                                         
         B     GR13B                                                            
*                                                                               
GR12     DS    0H                                                               
         ICM   RF,15,INCARDC       FOR CARD TEST RUN CHECK REPLICATION          
         BZ    GR13                ZERO MEANS NO REPLICATION                    
         BCTR  RF,R0                                                            
         ST    RF,INCARDC                                                       
         LTR   RF,RF                                                            
         BP    GR15                RETURN WITH SAME RESPONDENT                  
         MVC   INCARDC,INCARD      RESET REPLICATION FACTOR                     
*                                                                               
GR13     DS    0H                                                               
         MVI   ERR,0                                                            
GR13B    DS    0H                                                               
         MVC   LASTRNO,THISRNO                                                  
         CLI   LASTRNO,X'FF'                                                    
         BE    GRX                                                              
*                                                                               
         L     RE,AREC             CLEAR RESPONDENT AREA                        
         L     RF,LREC                                                          
         XCEF                                                                   
*                                                                               
GR14     DS    0H                                                               
         L     R2,ARECWRK          THIS 'CARD'                                  
         L     R3,AREC                                                          
         A     R3,CDISP            DISP FOR THIS CARD                           
*                                  TEST FOR DUPE CARD                           
         ICM   RF,15,RESPCOL                                                    
         BZ    GR14B               NO RESP NO                                   
         BCTR  RF,R0                                                            
         SLL   RF,1                X 2 FOR COL BIN                              
         AR    RF,R3                                                            
         OC    0(2,RF),0(RF)       TEST ALREADY THERE                           
         BZ    GR14B                                                            
         MVI   ERR,DUPCERR                                                      
         BAS   RE,GRERR                                                         
         B     GR14D                                                            
*                                                                               
GR14B    DS    0H                                                               
         L     R1,NCOLS                                                         
         SLL   R1,1                X 2 FOR COL BIN                              
         MOVE  ((R3),(R1)),(R2)                                                 
*                                                                               
GR14D    DS    0H                                                               
         BAS   RE,GRGET                                                         
         CLC   THISRNO,LASTRNO                                                  
         BE    GR14                SAME RESP                                    
*                                                                               
GR15     DS    0H                                                               
         L     RF,RESPCNT          BUMP RESP COUNT                              
         LA    RF,1(RF)                                                         
         ST    RF,RESPCNT                                                       
         L     RF,RGCNT            BUMP RESP/GULP COUNT                         
         LA    RF,1(RF)                                                         
         ST    RF,RGCNT                                                         
         MVC   CRDCNT,=F'1'        RESET CARDS/RESP COUNT                       
*                                                                               
         OC    NRESPS,NRESPS       TEST GIVEN RESP COUNT                        
         BZ    GR16                NO                                           
         CLC   RESPCNT,NRESPS      IS IT EXCEEDED                               
         BNH   GR16                                                             
         MVI   ERR,RCNTERR                                                      
         MVI   PRINTE,C'Y'         SET TO PRINT ERRORS                          
         BAS   RE,GRERR                                                         
         MVI   INPSW,X'FF'         SET EOF                                      
         MVI   THISRNO,X'FF'                                                    
         MVC   LASTRNO,THISRNO                                                  
         B     GRX                                                              
*                                                                               
*                             SET WORK AREA DISPS FOR THIS RESP                 
GR16     DS    0H                                                               
         BCTR  RF,R0                                                            
         SRL   RF,3           1 BYTE FOR 8 RESPS                                
         ST    RF,RESPDPTB+0  FOR COND TYPE 0                                   
         L     RF,RGCNT                                                         
         BCTR  RF,R0                                                            
         LR    RE,RF                 1 BYTE PER RESP                            
         ST    RE,RESPDPTB+4      FOR TYPE 1                                    
         AR    RE,RF              2 PER                                         
         ST    RE,RESPDPTB+8      FOR TYPE 2                                    
         AR    RE,RF              3 PER                                         
         ST    RE,RESPDPTB+12     FOR TYPE 3                                    
         AR    RE,RF              4 PER                                         
         ST    RE,RESPDPTB+16     FOR TYPE 4                                    
*                                                                               
         L     R0,RGCNT                                                         
         SR    R1,R1                                                            
         SRDL  R0,3                                                             
         SRL   R1,29               R1 = COUNT MOD 8                             
         LA    R1,RBTAB(R1)                                                     
         MVC   RESPBMSK,0(R1)      BIT MASK FOR THIS RESP                       
*                                                                               
GRX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
RBTAB    DC    X'0180402010080402'   REMAINDER 0 - 8                            
         EJECT                                                                  
GRGET    NTR1                                                                   
         SPACE 2                                                                
GRG2     DS    0H                                                               
         CLI   INPSW,X'FF'         TEST HAVE EOF                                
         BE    GRGX                                                             
         CLI   INPUT,C'C'          TEST CARD INPUT                              
         BNE   GRG2B                                                            
         BAS   RE,GRCARD                                                        
         CLI   INPSW,X'FF'         TEST EOF                                     
         BE    GRGX                                                             
         B     GRG2D                                                            
*                                                                               
GRG2B    DS    0H                                                               
         L     R1,AINTAPE                                                       
         L     R0,ARECWRK                                                       
         GET   (1),(0)                                                          
*                                                                               
GRG2D    DS    0H                                                               
         L     RF,RECCNT           BUMP RECORD COUNT                            
         LA    RF,1(RF)                                                         
         ST    RF,RECCNT                                                        
*                                                                               
         L     RF,CRDCNT           BUMP CARD COUNT WITHIN RESP                  
         LA    RF,1(RF)                                                         
         ST    RF,CRDCNT                                                        
*                                                                               
*                                                                               
         CLI   PRINTI,C'Y'                                                      
         BNE   GRG3                                                             
         L     R2,NCOLS                                                         
         SLL   R2,1                                                             
         GOTO1 ADMPREC,DMCB,ARECWRK,(R2),=CL6'INPUT'                            
*                                                                               
GRG3     DS    0H                                                               
         ICM   R2,15,RESPCOL       TEST HAVE RESP NO                            
         BNZ   GRG3D                                                            
*                                  NO RESP NO                                   
         CLC   CRDCNT,NCARDS       TEST END OF RESP SET                         
         BNH   GRG4                                                             
*                                                                               
         MVC   THISRNO,LASTRNO     YES FORCE 'RESPNO' CHANGE                    
         XI    THISRNO+1,X'FF'                                                  
         B     GRGX                                                             
*                                                                               
GRG3D    DS    0H                                                               
         MVC   THISRNO,SPACES                                                   
         BCTR  R2,R0                                                            
         SLL   R2,1                                                             
         A     R2,ARECWRK                                                       
         L     R3,RESPLEN                                                       
         GOTO1 ACVEBC,DMCB,((R3),(R2)),THISRNO                                  
*                                                                               
*                                                                               
GRG4     DS    0H                                                               
         XC    CDISP,CDISP                                                      
         ICM   R2,15,CARDCOL       IF NO CARD NUMBER                            
         BNZ   GRG4D                                                            
*                                                                               
         L     RF,CRDCNT         USE SEQ OF CARD READ AS CARD NO                
         C     RF,NCARDS         MUST NOT EXCEED EXPECTED CARDS/RESP            
         BNH   GRG14                                                            
         B     GRG20                                                            
*                                                                               
GRG4D    DS    0H                                                               
         BCTR  R2,R0                                                            
         SLL   R2,1                                                             
         A     R2,ARECWRK                                                       
         L     R3,CARDLEN                                                       
         GOTO1 ACVEBC,DMCB,((R3),(R2)),THISCNO                                  
*                                                                               
         CH    R3,=H'1'            LENGTH OF NUMBER                             
         BH    GRG10                                                            
*                                                                               
         LA    R4,CNUMLST          IF 1 LOOKUP VALUE IN LIST                    
         LA    R0,L'CNUMLST                                                     
*                                                                               
GRG6     DS    0H                                                               
         CLC   THISCNO(1),0(R4)                                                 
         BE    GRG7                                                             
         LA    R4,1(R4)                                                         
         BCT   R0,GRG6                                                          
         B     GRG20               ERROR                                        
GRG7     DS    0H                                                               
         LA    RF,L'CNUMLST+1                                                   
         SR    RF,R0               RF HAS ACTUAL CARD NUM                       
         B     GRG14                                                            
*                             MULTIPLE COLUMN CARD NUMBER                       
GRG10    DS    0H                                                               
         GOTO1 NUMVAL,DMCB,THISCNO,(R3)                                         
         CLI   DMCB,0                                                           
         BNE   GRG20               ERROR                                        
         L     RF,DMCB+4           CARD NUM                                     
*                                                                               
GRG14    DS    0H                                                               
         LTR   RF,RF                                                            
         BNP   GRG20                                                            
         C     RF,NCARDS                                                        
         BH    GRG20                                                            
*                                                                               
         BCTR  RF,R0               CARD NO - 1                                  
         L     RE,NCOLS                                                         
         SLL   RE,1                                                             
         MR    RE,RE                                                            
         ST    RF,CDISP                                                         
         MVI   ERR,0                                                            
GRGX     DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
*                                                                               
GRG20    DS    0H                                                               
         MVI   ERR,CNUMERR    INVALID CARD NUMBER                               
         BAS   RE,GRERR                                                         
         B     GRG2           BYPASS CARD                                       
         SPACE 3                                                                
GRERR    NTR1                                                                   
         L     RF,IERRCNT          BUMP ERROR COUNTER                           
         LA    RF,1(RF)                                                         
         ST    RF,IERRCNT                                                       
*                                                                               
         CLI   PRINTE,C'Y'                                                      
         BNE   GRERRX                                                           
         GOTO1 AGETERR,DMCB,(ERR,P)                                             
         LA    R6,P+2                                                           
         A     R6,DMCB+4                                                        
         MVC   0(10,R6),THISRNO                                                 
         MVC   11(4,R6),THISCNO                                                 
         GOTO1 PRINTER                                                          
GRERRX   DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
INEOT    DS    0H                                                               
         CLOSE  (INTAPE,)                                                       
         MVI   THISRNO,X'FF'                                                    
         MVI   INPSW,X'FF'                                                      
         B     GRGX                                                             
         EJECT                                                                  
*                                  CARD INPUT ROUTINE                           
GRCARD   NTR1                                                                   
         SPACE 2                                                                
         GOTO1 CARDS,DMCB,CARD,=C'RE00'                                         
         CLC   =C'/*',CARD                                                      
         BNE   GRC2                                                             
         MVI   INPSW,X'FF'                                                      
         MVI   THISRNO,X'FF'                                                    
         B     GRCX                                                             
*                                  EBCDIC TO COL BINARY                         
GRC2     DS    0H                                                               
         MVC   P(6),=C'**CARD'                                                  
         MVC   P+10(80),CARD                                                    
         GOTO1 PRINTER                                                          
         LA    R3,CARD                                                          
         L     R4,ARECWRK                                                       
         LA    R0,80                                                            
*                                                                               
GRC4     DS    0H                                                               
         LA    R6,GRCTAB                                                        
GRC6     DS    0H                                                               
         CLC   0(1,R3),0(R6)                                                    
         BE    GRC7                                                             
         LA    R6,3(R6)                                                         
         CLI   0(R6),X'FF'         UNTRANSLATED                                 
         BNE   GRC6                                                             
*                                                                               
GRC7     DS    0H                                                               
         MVC   0(2,R4),1(R6)                                                    
         LA    R3,1(R3)                                                         
         LA    R4,2(R4)                                                         
         BCT   R0,GRC4                                                          
*                                                                               
GRCX     DS    0H                                                               
         XIT1                                                                   
*                                  BRIEF EBCDIC TO COLBIN TABLE                 
GRCTAB   DS    0X                                                               
         DC    C'&&',X'2000'                                                    
         DC    C'-',X'1000'                                                     
         DC    C'0',X'0800'                                                     
         DC    C'1',X'0400'                                                     
         DC    C'2',X'0200'                                                     
         DC    C'3',X'0100'                                                     
         DC    C'4',X'0020'                                                     
         DC    C'5',X'0010'                                                     
         DC    C'6',X'0008'                                                     
         DC    C'7',X'0004'                                                     
         DC    C'8',X'0002'                                                     
         DC    C'9',X'0001'                                                     
         DC    X'FF',X'0000'                                                    
         SPACE 3                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                  CONVERT 360 COLUMN BINARY TO EBCDIC          
*                                  PARAM1 =A(INPUT) - BYTE 0 = LENGTH           
*                                  PARAM2 =A(OUTPUT)                            
         SPACE 2                                                                
CVEBC    CSECT                                                                  
         NMOD1 0,CVEBC                                                          
         SPACE 2                                                                
         LM    R2,R3,0(R1)         R2 = A(INPUT)                                
*                                  R3 = A(OUTPUT)                               
         ZICM  R0,0(R1),(1)        R0 = LENGTH OF INPUT (POSITIONS)             
         BZ    CVEX                                                             
*                                                                               
*                                                                               
CVE4     DS    0H                                                               
         ZIC   R4,0(R2)            6 BITS FROM BYTE 1                           
         SLL   R4,6                                                             
         ZIC   R5,1(R2)            6 BITS FROM BYTE 2                           
         OR    R5,R4               R5 = 12 BIT RESULT                           
*                                                                               
         A     R5,ACBTBL           DISPLACE INTO TRANSLATE TABLE                
         MVC   0(1,R3),0(R5)       SET IN OUTPUT                                
*                                                                               
         LA    R2,2(R2)            NEXT POSITION                                
         LA    R3,1(R3)                                                         
         BCT   R0,CVE4                                                          
*                                                                               
CVEX     DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                             FLUSH DATA TABLE                                  
         SPACE 2                                                                
FLSHTAB  CSECT                                                                  
         NMOD1 0,FLSHTAB                                                        
         SPACE 2                                                                
         OC    RGCNT,RGCNT                                                      
         BZ    FTX                 NO RESPS FOR THIS GULP                       
*                                                                               
         L     RF,GULPCNT                                                       
         LA    RF,1(RF)                                                         
         ST    RF,GULPCNT                                                       
*                                                                               
         CLC   GULPCNT,=F'1'                                                    
         BNE   FT3                                                              
         CLI   INPSW,X'FF'                                                      
         BNE   FT3                                                              
*                                  IF ONLY 1 GULP SET TRUE SIZE                 
         L     RF,RGCNT                                                         
         LA    RF,7(RF)            FORCE TO HIGHER MULTIPLE OF 8                
         SRL   RF,3                                                             
         SLL   RF,3                                                             
         ST    RF,GULPSZE          SET REAL GULPSZE                             
         SRL   RF,3                                                             
         ST    RF,CONDSZE                                                       
         CH    RF,=H'4'            MUST BE AT LEAST 4                           
         BNL   *+8                 FOR WORK REC                                 
         LH    RF,=H'4'                                                         
         LA    RF,L'WTKEY(RF)                                                   
         ST    RF,LWTREC                                                        
*                                                                               
FT3      DS    0H                                                               
*                                                                               
         L     R4,ACTAB                                                         
         USING CTABD,R4                                                         
         L     R5,ADTAB                                                         
         L     R6,AWTREC                                                        
         USING WTRECD,R6                                                        
         XC    WTKEY,WTKEY                                                      
*                                                                               
         CLI   INPSW,X'FF'         AT END OF INPUT                              
         BNE   FT3D                WRITE A ZERO KEY CONTROL REC                 
         LA    RE,WTDATA                                                        
         L     RF,CONDSZE                                                       
         XCEF                                                                   
         MVC   WTDATA(4),RESPCNT   SET RESPONDENT COUNT                         
         BAS   RE,FTPUT                                                         
*                                                                               
FT3D     DS    0H                                                               
         MVC   WTGULP,GULPCNT+2                                                 
*                                                                               
*                                                                               
FT4      DS    0H                                                               
         CLI   0(R4),X'FF'         END OF CONDITIONS                            
         BE    FT40                                                             
*                                                                               
*                                  SET CONDITION IN KEY                         
         ZICM  RF,CTDISP,2         DISPLACEMENT                                 
         SRL   RF,1                                                             
         LA    RF,1(RF)                                                         
         A     RF,NCOLS                                                         
         SR    RE,RE                                                            
         D     RE,NCOLS                                                         
         STCM  RF,3,WTCRD          CARD NUMBER                                  
         STCM  RE,3,WTCOL            REMAINDER IS COL NUM                       
*                                                                               
         CLI   CTTYP,0             PUNCH CONDITION                              
         BNE   FT4F                                                             
         LA    R0,12                                                            
         L     RF,AMASKTAB         GET TRANSLATION                              
FT4B     DS    0H                                                               
         CLC   1(1,RF),CTMASK                                                   
         BE    FT4D                                                             
         LA    RF,2(RF)                                                         
         BCT   R0,FT4B                                                          
         DC    H'0'                                                             
*                                                                               
FT4D     DS    0H                                                               
         MVC   WTPNCH,0(RF)        PUNCH CODE (0-9,X,Y)                         
         B     FT4M                                                             
*                                                                               
FT4F     DS    0H                                                               
         MVC   WTNLEN,CTNLEN       NUMERIC FIELD LENGTH                         
*                                                                               
FT4M     DS    0H                                                               
         ZIC   R2,CTTYP            R2 TO HAVE NO. OF RECS                       
         IC    R2,TCTAB(R2)        FOR THIS TYPE OF COND                        
         LA    R3,1                FOR SEQ                                      
         LR    R7,R5                                                            
*                                                                               
FT6      DS    0H                                                               
         STC   R3,WTSEQ                                                         
         L     R1,CONDSZE          FOR EXEC MVC                                 
         MOVE  (WTDATA,(R1)),0(R7)    SET DATA                                  
         LR    RE,R7               CLEAR THIS CONDITION AREA                    
         L     RF,CONDSZE                                                       
         XCEF                                                                   
*                                                                               
         BAS   RE,FTPUT                                                         
*                                                                               
         LA    R3,1(R3)            BUMP SEQ                                     
         A     R7,CONDSZE          NEXT PART OF CONDITION AREA                  
         BCT   R2,FT6                                                           
*                                                                               
         ZIC   R2,CTTYP            BUMP BY LENGTH FOR THIS TYPE                 
         SLL   R2,2                                                             
         A     R5,CONDLTAB(R2)     NEXT COND AREA                               
         LA    R4,CTABL(R4)        NEXT COND                                    
         B     FT4                                                              
*                                                                               
FT40     DS    0H                                                               
*                                                                               
FTX      DS    0H                                                               
         XC    RGCNT,RGCNT         ZERO RESPS/GULP                              
         XIT1                                                                   
*                                                                               
TCTAB    DC    AL1(1,8,16,24,32)   NUMBER OF WORK RECS FOR                      
*                                  EACH COND TYPE                               
         SPACE 3                                                                
*                             FLUSH OUTPUT ROUTINE                              
FTPUT    NTR1                                                                   
         SPACE 2                                                                
         CLI   FLSHSW,0                                                         
         BNE   FTP2                                                             
         BAS   RE,FTFRST                                                        
*                                                                               
FTP2     DS    0H                                                               
         L     RF,WRKOCNT         BUMP COWRK OUTPUT COUNTER                     
         LA    RF,1(RF)                                                         
         ST    RF,WRKOCNT                                                       
*                                                                               
         CLI   WORKF,C'S'          SORT                                         
         BNE   FTP4                                                             
         GOTO1 SORTER,DMCB,=C'PUT',WTRECD                                       
         B     FTP20                                                            
*                                                                               
FTP4     DS    0H                                                               
         CLI   WORKF,C'O'          WRITE WORK TAPE                              
         BNE   FTP6                                                             
         L     R1,AWTAPO                                                        
         LA    R0,WTRECD                                                        
         PUT   (1),(0)                                                          
         B     FTP20                                                            
*                                                                               
FTP6     DS    0H                                                               
         SPACE 2                                                                
FTP20    DS    0H                                                               
         CLI   PRINTWO,C'Y'                                                     
         BNE   FTPX                                                             
*                                                                               
         L     R0,LWTREC                                                        
         GOTO1 ADMPREC,DMCB,WTRECD,(R0),=CL6'WORKO'                             
*                                                                               
FTPX     DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
*                             INITIALIZE FLUSH OUTPUTS                          
FTFRST   NTR1                                                                   
         SPACE 2                                                                
         MVI   FLSHSW,1                                                         
         CLI   WORKF,C'S'                                                       
         BNE   FTPF4                                                            
*                                                                               
         GOTO1 ASETSORT                                                         
         B     FTPFX                                                            
*                                                                               
FTPF4    DS    0H                                                               
         CLI   WORKF,C'O'          WORK TAPE OUTPUT                             
         BNE   FTPFX                                                            
*                                  ADJUST DCB                                   
         MVC   62(2,R6),WTBLKSZE+2   BLKSIZE                                    
         MVC   82(2,R6),LWTREC+2     RECSIZE                                    
         OPEN  (WTAPO,OUTPUT)                                                   
         B     FTPFX                                                            
FTPFX    DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                             POST A RESPONDENT TO CONDITION WORK AREAS         
         SPACE 2                                                                
POSTR    CSECT                                                                  
         NMOD1 0,POSTR                                                          
         USING CTABD,R4                                                         
         L     R4,ACTAB            A(CONDITION TABLE)                           
         L     R5,ADTAB            A(DATA TABLE AREA)                           
*                                                                               
PR4      DS    0H                                                               
         CLI   0(R4),X'FF'    END OF CONDITIONS                                 
         BE    PRX                                                              
         ZICM  R6,CTDISP,2         DISP INTO RESPONDENT RECORD                  
         A     R6,AREC                                                          
         CLI   CTTYP,0                                                          
         BNE   PR8                                                              
*                                  PUNCH CONDITION                              
         MVC   BYTE,CTMASK                                                      
         NI    BYTE,X'3F'          STRIP 2 HOBS                                 
         TM    CTMASK,X'80'                                                     
         BZ    *+8                                                              
         LA    R6,1(R6)            USE 2ND BYTE                                 
         IC    RF,BYTE                                                          
         EX    RF,*+8                                                           
         B     *+8                                                              
         TM    0(R6),0                                                          
         BZ    PR40                                                             
*                                                                               
         LR    RF,R5                                                            
         A     RF,RESPDPTB+0       DISP INTO COND WORK AREA FOR PUNCH           
         OC    0(1,RF),RESPBMSK    SET RESPONDENTS BIT                          
*                                                                               
         B     PR40                                                             
*                                  NUMERIC VALUE CONDITIONS                     
PR8      DS    0H                                                               
         ZIC   R3,CTNLEN           LENGTH OF FIELD                              
         GOTO1 ACVEBC,DMCB,((R3),(R6)),X     GET EBCDIC                         
         GOTO1 NUMVAL,(R1),X,(R3)            GET VALUE                          
         CLI   DMCB,0                                                           
         BE    PR10                                                             
         MVI   ERR,NVALERR                                                      
         BAS   RE,PRERR                                                         
         B     PR40                                                             
*                                                                               
PR10     DS    0H                                                               
         L     RE,DMCB+4           VALUE                                        
         ZIC   R1,CTTYP                                                         
         SLL   R1,2                                                             
         LR    RF,R5                                                            
         A     RF,RESPDPTB(R1)     DISPL INTO COND AREA                         
         IC    R1,CTTYP                                                         
         IC    R2,STCMSKS-1(R1)                                                 
         EX    R2,*+8                                                           
         B     PR12                                                             
         STCM  RE,0,0(RF)          SET VALUE IN AREA                            
*                                                                               
STCMSKS  DC    X'0103070F'         MASKS FOR STCM 1,2,3,4 BYTES                 
*                                                                               
PR12     DS    0H                                                               
*                                                                               
PR40     DS    0H                                                               
         ZIC   R1,CTTYP            BUMP WORK AREA POINTER BY                    
         SLL   R1,2                LENGTH FOR THIS CONDITION TYPE               
         A     R5,CONDLTAB(R1)                                                  
         LA    R4,CTABL(R4)        NEXT CONDITION                               
         B     PR4                                                              
*                                                                               
PRX      DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
PRERR    NTR1                                                                   
         L     RF,IERRCNT          BUMP INPUT ERROR COUNT                       
         LA    RF,1(RF)                                                         
         ST    RF,IERRCNT                                                       
*                                                                               
         CLI   PRINTE,C'Y'                                                      
         BNE   PRERRX                                                           
         GOTO1 AGETERR,DMCB,(ERR,P)                                             
         LA    R6,P+2                                                           
         A     R6,DMCB+4                                                        
         MVC   0(10,R6),LASTRNO                                                 
*                                  ***NEED TO SPECIFY WHICH FIELD***            
         GOTO1 PRINTER                                                          
PRERRX   DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                             ROUTINE TO PRINT RECORD HEX                       
         SPACE 2                                                                
DMPREC   CSECT                                                                  
         NMOD1 0,DMPREC                                                         
         L     RF,8(R1)                                                         
         MVC   P(2),=C'**'                                                      
         MVC   P+2(6),0(RF)                                                     
         L     R2,4(R1)            LENGTH OF RECORD                             
         L     R3,0(R1)            A(RECORD)                                    
DMPREC4  DS    0H                                                               
         LR    R4,R2                                                            
         C     R4,=F'60'                                                        
         BNH   *+8                                                              
         LA    R4,60                                                            
*                                                                               
         GOTO1 HEXOUT,DMCB,(R3),P+10,(R4),=C'N'                                 
         GOTO1 PRINTER                                                          
         AR    R3,R4                                                            
         SR    R2,R4                                                            
         BP    DMPREC4                                                          
*                                                                               
*                                                                               
DMPRECX  DS    0H                                                               
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
*                             PROCESS WORK RECORDS FOR OUTPUT                   
         SPACE 2                                                                
OPPROC   CSECT                                                                  
         NMOD1 0,OPPROC                                                         
         SPACE 2                                                                
         L     R6,AWTREC                                                        
         USING WTRECD,R6                                                        
         CLI   PRINTWI,C'Y'                                                     
         BNE   OPP4                                                             
         L     R0,LWTREC                                                        
         GOTO1 ADMPREC,DMCB,WTREC,(R0),=CL6'WORKI'                              
*                                                                               
OPP4     DS    0H                                                               
         CLI   WTKEY,X'FF'         EXCEPT AT EOF                                
         BE    OPP4A                                                            
         L     RF,WRKICNT          BUMP WORK INPUT COUNT                        
         LA    RF,1(RF)                                                         
         ST    RF,WRKICNT                                                       
*                                                                               
OPP4A    DS    0H                                                               
         OC    WTKEY,WTKEY         IF CONTROL RECORD                            
         BNZ   OPP4B                                                            
         MVC   RESPWC,WTDATA       SET WORK FILE RESP COUNT                     
         B     OPPX                AND EXIT                                     
*                                                                               
OPP4B    DS    0H                                                               
         CLI   OPSW,0              FIRST TIME                                   
         BNE   OPP6                                                             
         MVI   OPSW,1                                                           
         CLI   LOADTAPE,C'N'                                                    
         BE    OPP5                                                             
         OPEN  (LDTAPE,OUTPUT)                                                  
*                                                                               
OPP5     DS    0H                                                               
*                                                                               
*                                                                               
         L     RF,ADTAB            FOR NOW USE CONDITION WORK AREA              
         ST    RF,ALDREC           FOR LOAD REC AREA                            
         A     RF,=F'8008'                                                      
         ST    RF,ALDWRKA          AND LOAD WORK AREA                           
         B     OPP18                                                            
*                                                                               
OPP6     DS    0H                                                               
         CLC   WTCOND,LASTWKEY  TEST SAME CONDITION                             
         BE    OPP20                                                            
*                                  BUILD OUTPUT RECORD                          
*                                  AND FLUSH WORK AREA                          
         LA    R6,LASTWKEY         RESET WTREC BASE REG TO LAST KEY             
         L     R7,ALDREC                                                        
         LA    R7,4(R7)                                                         
         USING XVTRECD,R7                                                       
         XC    XVTREC(256),XVTREC                                               
         MVC   XVTKRCD,RECCODE     RECORD CODE                                  
         MVC   XVTKFC,FILCODE      FILE CODE                                    
         MVC   XVTKCRD(5),WTCOND    CONDITION ID                                
*                                                                               
OPP11    DS    0H                                                               
         MVI   XVTKSEQ,1           SEQ 1                                        
*                                  CONTROL ELEM                                 
         MVI   XVTCNTEL,X'01'                                                   
         MVI   XVTCNTEL+1,10                                                    
         MVI   XVTCDLEN,0          DATA LEN IS 0 (1 BIT)                        
         CLI   WTPNCH,X'50'        FOR ALL PUNCH CONDITIONS                     
         BNL   OPP11A                                                           
         ZIC   R1,WTPNCH         ELSE GET FROM FIELD LENGTH                     
         LA    R1,DLENTAB-1(R1)                                                 
         MVC   XVTCDLEN,0(R1)                                                   
OPP11A   DS    0H                                                               
         MVC   XVTRLEN,=Y(XVTSTREL-XVTREC)    SET REC LENGTH                    
*                                                                               
         L     R6,AWTREC           RESTORE WTREC BASE REG                       
         BAS   RE,OPCMPRES         DO STRING COMPRESSION                        
*                                  AND WRITE LOAD RECORDS                       
OPP18    DS    0H                                                               
         L     R4,ALDWRKA          RESET WORK AREA POINTER                      
         ST    R4,OPSVR4                                                        
*                                                                               
OPP20    DS    0H                  SOME KEY-SET DATA IN WORK AREA               
         MVC   LASTWKEY,WTKEY                                                   
         CLI   WTKEY,X'FF'         TEST EOF                                     
         BE    OPP30                                                            
         L     R1,CONDSZE                                                       
         L     R4,OPSVR4                                                        
         MOVE  ((R4),(R1)),WTDATA                                               
         A     R4,CONDSZE          BUMP WORK AREA POINER                        
         ST    R4,OPSVR4                                                        
*                                                                               
         B     OPPX                                                             
*                                                                               
OPP30    DS    0H                                                               
         CLI   LOADTAPE,C'N'                                                    
         BE    OPP30B                                                           
         CLOSE  (LDTAPE,)                                                       
*                                                                               
OPP30B   DS    0H                                                               
*                                                                               
OPPX     DS    0H                                                               
         XIT1                                                                   
*                          DATA LENGTH FOR FIELD LENGTHS                        
DLENTAB  DC    X'010102020303030404040404040404'                                
         EJECT                                                                  
*                             COMPRESS STRING AND WRITE LOAD RECORDS            
         SPACE 2                                                                
OPCMPRES NTR1                                                                   
         SPACE 2                                                                
         XC    DLN,DLN             COMPARAND LENGTH                             
         OC    DLN+3(1),XVTCDLEN   = RESPONSE LENGTH IN BYTES                   
         BNZ   *+8                                                              
         MVI   DLN+3,1             BUT 1 FOR BIT RESPONSES AS WELL              
*                                                                               
         L     RF,DLN                                                           
         SR    RE,RE                                                            
         IC    RE,EQLST-1(RF)                                                   
         ST    RE,EQNEED           BYTES NEEDED FOR REPEAT                      
*                                                                               
*                                  SET DATA LENGTH AND END                      
         L     RF,RESPWC                                                        
         CLI   XVTCDLEN,0          FOR BIT STRINGS                              
         BNE   OPC6                                                             
*                                                                               
         LA    RF,7(RF)            LENGTH EQUALS                                
         SRL   RF,3                RESP COUNT/8 - FORCED UP                     
         B     OPC9                                                             
*                                                                               
OPC6     DS    0H                                                               
         MH    RF,DLN+2            ELSE = RESPONSE LENGTH X RESP COUNT          
*                                                                               
OPC9     DS    0H                                                               
         A     RF,ALDWRKA                                                       
         ST    RF,EOL              SET END OF DATA                              
*                                  COUNT RESPONSES                              
         CLI   XVTCDLEN,0                                                       
         BNE   OPC14                                                            
*                                  FOR BIT STRINGS COUNT YESSES                 
         L     R3,ALDWRKA          START OF STRING                              
         SR    R6,R6                                                            
         SR    R4,R4                                                            
*                                                                               
OPC10    DS    0H                                                               
         ICM   R4,1,0(R3)                                                       
         BZ    OPC13               SKIP NULL BYTES                              
*                                                                               
OPC11    DS    0H                                                               
         LA    R5,X'80'            SET BIT FINDER MASK                          
*                                                                               
OPC12    DS    0H                                                               
         LR    RE,R5                                                            
         NR    RE,R4                                                            
         BZ    *+8                                                              
         LA    R6,1(R6)            BUMP COUNTER                                 
         SRA   R5,1                NEXT BIT                                     
         BNZ   OPC12                                                            
*                                                                               
OPC13    DS    0H                                                               
         LA    R3,1(R3)            NEXT BYTE                                    
         C     R3,EOL                                                           
         BL    OPC10                                                            
         B     OPC18                                                            
*                                  NUMERIC RESPONSES                            
OPC14    DS    0H                                                               
         SR    R6,R6                                                            
         L     R5,DLN                                                           
         IC    R5,ICMSKS-1(R5)     MASK FOR EXECUTED ICM'S                      
         L     R3,ALDWRKA          START OF DATA                                
*                                                                               
OPC15    DS    0H                                                               
         SR    R1,R1                                                            
         EX    R5,OPCICM                                                        
         AR    R6,R1               ADD TO TOTAL                                 
         A     R3,DLN              NEXT ITEM                                    
         C     R3,EOL                                                           
         BL    OPC15                                                            
*                                                                               
         B     OPC18                                                            
*                                                                               
ICMSKS   DC    X'0103070F'         MASKS FOR EXECUTED ICM                       
OPCICM   ICM   R1,0,0(R3)                                                       
*                                                                               
OPC18    DS    0H                                                               
         STCM  R6,15,XVTCOUNT      RESULT OF COUNT                              
*                                                                               
         L     R4,ALDWRKA          START OF DATA                                
         ST    R4,PTR1                                                          
         ST    R4,PTR2                                                          
*                                  SET DATA LENGTH AND EOL                      
         L     R6,DLN                                                           
         BCTR  R6,R0               R6 FOR EXECUTED CLC'S                        
*                                                                               
         MVC   ELMAX,=F'255'                                                    
         MVC   ELMAXB,=F'253'                                                   
         XC    EQHAVE,EQHAVE                                                    
*                                                                               
         ZICM  RF,XVTRLEN,2                                                     
         AR    R7,RF               SET FIRST START FOR ELEMS                    
*                                                                               
*                                                                               
OPC20    DS    0H                                                               
         LR    R5,R4                                                            
         A     R5,DLN              POINT ONE POS AHEAD                          
         C     R5,EOL                                                           
         BNL   OPC24                                                            
*                                                                               
         CLI   CMPRES,C'N'         COMPRESSION TESTING SWITCH                   
         BE    OPC24                                                            
*                                                                               
         EX    R6,CMPCLC           TEST BREAK IN STRING OF EQUALS               
         BE    OPC40                                                            
*                                                                               
*                                  BREAK                                        
OPC24    DS    0H                                                               
         LR    R1,R5                                                            
         S     R1,PTR2                                                          
         C     R1,EQNEED           TEST VS MINIMUM                              
         BL    OPC30                                                            
         ST    R1,EQHAVE           SAVE EQ LEN AND SET REPEAT PENDING           
*                                  ENOUGH TO DO A REPEATER                      
         BAS   RE,SETNORM          DO NORMAL ELEM                               
         BAS   RE,SETRPT           DO REPEAT ELEM                               
         B     OPC34                                                            
*                                     INSUFFICIENTLY LONG EQUAL STRING          
OPC30    DS    0H                                                               
         ST    R5,PTR2             SET STARTER FOR NEW EQUAL STRING             
         C     R5,EOL              AT EOL FORCE COMPLETION                      
         BE    OPC32                                                            
         LR    R1,R5                                                            
         S     R1,PTR1             LENGTH OF CURRENT UNEQUAL STRING             
         A     R1,DLN                                                           
         BCTR  R1,R0                                                            
         C     R1,ELMAXB           TEST VS MAX FOR ELEM                         
         BL    OPC40               LOW - OK TO CONTINUE                         
OPC32    DS    0H                                                               
         BAS   RE,SETNORM          ELSE DO NORMAL ELEM                          
OPC34    DS    0H                                                               
         C     R5,EOL              TEST DONE                                    
         BNL   OPC60                                                            
         ST    R5,PTR1             SET STARTER FOR NEW UNEQUAL                  
         ST    R5,PTR2             AND EQUAL                                    
*                                  NO BREAK IN EQUAL STRING                     
OPC40    DS    0H                                                               
         A     R4,DLN              CONTINUE                                     
         B     OPC20                                                            
*                                                                               
OPC60    DS    0H                                                               
         MVI   EOL,X'FF'                                                        
         BAS   RE,CHKREC           DO LAST RECORD                               
*                                                                               
OPCX     DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
*                                  ADD NORMAL ELEM                              
SETNORM  DS    0H                                                               
         L     RF,PTR2             START OF EQUAL STRING                        
         S     RF,PTR1             LESS START OF UNEQUALS                       
         BNP   CHKREC                                                           
*                                  IS LENGTH OF UNEQUALS                        
         MVI   0(R7),X'02'         NORMAL ELEM CODE                             
         L     R3,PTR1             START OF UNEQUALS                            
         BCTR  RF,R0                                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   2(0,R7),0(R3)                                                    
         LA    RF,3(RF)                                                         
         STC   RF,1(R7)            ELEM LENGTH                                  
         AR    R7,RF               BUMP ELEM POINTER                            
         B     CHKREC                                                           
         SPACE 2                                                                
*                                  ADD REPEATER ELEM                            
SETRPT   DS    0H                                                               
         L     R1,EQHAVE           SAVED NUMBER OF EQUALS                       
         SR    R0,R0                                                            
         D     R0,DLN              DIV BY LENGTH = NO. OF REPEATS               
         MVI   0(R7),X'03'         REPEATER ELEM CODE                           
         STCM  R1,3,2(R7)          SET NO. OF REPEATS                           
         L     R3,PTR2             START OF EQUALS                              
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   4(0,R7),0(R3)       PUT ONE EQUAL IN ELEM                        
         L     RF,DLN              DATA RESPONSE LENGTH                         
         LA    RF,4(RF)            PLUS 4                                       
         STC   RF,1(R7)            =   ELEM LENGTH                              
*                                                                               
         AR    R7,RF               BUMP ELEM POINTER                            
         XC    EQHAVE,EQHAVE                                                    
         B     CHKREC                                                           
         SPACE 2                                                                
*                                  TEST RECORD FULL                             
         DS    F                                                                
CHKREC   DS    0H                                                               
         ST    RE,CHKREC-4                                                      
         LR    RF,R7                                                            
         S     RF,ALDREC                                                        
         CLI   EOL,X'FF'           TEST FORCE LAST RECORD                       
         BE    CKR10                                                            
         L     R1,LDRMAX                                                        
         SR    R1,RF               R1 = LEFT IN RECORD                          
*                                  TEST ROOM FOR ANOTHER ELEM                   
         L     R3,DLN                                                           
         LA    R3,2(R3)            DATA LEN +2                                  
         OC    EQHAVE,EQHAVE       IF NO REPEATER PENDING                       
         BZ    CKR8                                                             
         LA    R3,2(R3)            ELSE DATA LEN + 4                            
*                                                                               
CKR8     DS    0H                                                               
         CR    R1,R3               TEST ROOM                                    
         BNH   CKR10               NO - PUT AND START NEW REC                   
*                                                                               
         C     R1,ELMAX                                                         
         BNH   *+8                                                              
         L     R1,ELMAX                                                         
         SH    R1,=H'2'                                                         
         ST    R1,ELMAXB           SET NEW MAX DATA LENGTH                      
*                                                                               
         B     CHKRECX                                                          
*                                  PUT LOAD RECORD                              
CKR10    DS    0H                                                               
         CH    RF,=Y(XVTELEMS-XVTREC+4)                                         
         BNH   CHKRECX             SKIP NULL RECORD                             
         L     R7,ALDREC                                                        
         XC    0(4,R7),0(R7)                                                    
         STH   RF,0(R7)                                                         
         LA    R7,4(R7)                                                         
         SH    RF,=H'4'                                                         
         STCM  RF,3,XVTRLEN        SET RECORD LENGTH                            
         A     RF,LDBCNT           BUMP BYTE COUNTER                            
         ST    RF,LDBCNT                                                        
*                                                                               
         CLI   LOADTAPE,C'N'                                                    
         BE    CKR11                                                            
         L     R1,ALDTAPE                                                       
         L     R0,ALDREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
CKR11    DS    0H                                                               
         CLI   PRINTO,C'Y'                                                      
         BNE   CKR12                                                            
         L     RF,ALDREC                                                        
         LH    RF,0(RF)                                                         
         ST    RF,DMCB+4                                                        
         GOTO1 ADMPREC,DMCB,ALDREC,,=CL6'LOAD'                                  
*                                                                               
CKR12    DS    0H                                                               
         L     RF,LDRCNT           BUMP COUNTER                                 
         LA    RF,1(RF)                                                         
         ST    RF,LDRCNT                                                        
*                                                                               
         ZIC   RF,XVTKSEQ          BUMP REC SEQUENCE NUMBER                     
         LA    RF,1(RF)                                                         
         STC   RF,XVTKSEQ                                                       
*                                                                               
         LA    R7,XVTELEMS         POINT TO ELEM START AREA                     
         MVC   ELMAXB,=F'253'                                                   
CHKRECX  L     RE,CHKREC-4                                                      
         BR    RE                                                               
*                                                                               
CMPCLC   CLC   0(0,R4),0(R5)                                                    
EQLST    DC    AL1(6,8,9,12)    BYTES NEEDED FOR REPEAT FOR                     
*                               VARIOUS DATA LENGTHS                            
         SPACE 3                                                                
         LTORG                                                                  
         EJECT                                                                  
*                             INPUT PROC FOR WORKFILE TAPE                      
         SPACE 2                                                                
IPPROC   CSECT                                                                  
         NMOD1 0,IPPROC                                                         
         SPACE 2                                                                
         CLI   IPSW,0                                                           
         BNE   IPP6                                                             
         MVI   IPSW,1                                                           
*                                   ADJUST DCB                                  
         MVC   62(2,R6),WTBLKSZE+2   BLKSIZE                                    
         MVC   82(2,R6),LWTREC+2     RECSIZE                                    
         OPEN  (WTAPI,INPUT)                                                    
*                                                                               
IPP6     DS    0H                                                               
         L     R1,AWTAPI                                                        
         L     R0,AWTREC                                                        
         GET   (1),(0)                                                          
*                                                                               
IPPX     DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
WKEOT    DS    0H                                                               
         L     RF,AWTREC                                                        
         MVI   0(RF),X'FF'                                                      
         B     IPPX                                                             
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                             INITIALIZE SORT                                   
         SPACE 2                                                                
SETSORT  CSECT                                                                  
         NMOD1 0,SETSORT                                                        
         SPACE 2                                                                
         L     R3,LWTREC           SET SORT REC LENGTH                          
         CVD   R3,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  SRD+21(4),DUB                                                    
*                                                                               
         LA    R3,L'WTKEY          SET SORT KEY LENGTH                          
         CVD   R3,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  SFD+15(2),DUB                                                    
*                                                                               
         XC    DMCB+8(4),DMCB+8                                                 
         CLI   WORKF,C'I'          IF SORTING INPUT WORKFILE                    
         BE    SSRT8               LET SORT HAVE WHOLE PARTITION                
         L     R4,ASORTWK          ELSE SET SORT SIZE                           
         ST    R4,DMCB+8                                                        
         MVC   DMCB+8(1),SORTSIZE+3                                             
SSRT8    DS    0H                                                               
         GOTO1 SORTER,DMCB,SFD,SRD                                              
         B     SSRTX                                                            
SRD      DC    C'RECORD TYPE=F,LENGTH=NNNN '                                    
SFD      DC    C'SORT FIELDS=(1,NN,A),FORMAT=BI,WORK=1 '                        
*                                                                               
SSRTX    DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                  PRINTER INTERFACE                            
*                                                                               
PRNTR    CSECT                                                                  
         NMOD1 0,PRNTR                                                          
*                                                                               
         CP    MAXPAGE,=P'0'                                                    
         BE    PRNT2                                                            
         CP    PAGE,MAXPAGE                                                     
         BNH   *+6                                                              
         DC    H'0'                                                             
PRNT2    DS    0H                                                               
         GOTO1 VPRINTER                                                         
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
         SPACE 2                                                                
GETERR   CSECT                                                                  
         NMOD1 0,GETERR                                                         
         LA    R4,ERRLST                                                        
GE4      DS    0H                                                               
         CLC   0(1,R1),0(R4)       ERR NO IN HOB OF 1ST PARM                    
         BE    GE8                                                              
         ZIC   R0,1(R4)                                                         
         AR    R4,R0                                                            
         CLI   0(R4),0                                                          
         BNE   GE4                                                              
         DC    H'0'                BAD ERROR                                    
*                                                                               
GE8      DS    0H                                                               
         XC    4(4,R1),4(R1)                                                    
         ZIC   RF,1(R4)                                                         
         SH    RF,=H'3'                                                         
         STC   RF,7(R1)            SET MSG LEN IN PARM2                         
         BCTR  RF,R0                                                            
         L     RE,0(R1)            OUTPUT IN PARM 1                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,RE),3(R4)       SET MSG                                      
         MVC   0(1,R1),2(R4)       SET SEVERITY LEVEL                           
         OC    ERRLEV,2(R4)        KEEP TRACK OF SEVERITY LEVEL                 
*                                                                               
GEX      DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
ERRLST   DS    0X                                                               
         DC    AL1(SPECERR),AL1(L'ERR001+3),X'80'                               
ERR001   DC    C'INVALID SPECIFICATION'                                         
         DC    AL1(COLERR),AL1(L'ERR002+3),X'80'                                
ERR002   DC    C'COLUMN SPEC EXTENDS PAST CARD END'                             
         DC    AL1(NCRDERR),AL1(L'ERR003+3),X'80'                               
ERR003   DC    C'NUMBER OF CARDS INVALID'                                       
         DC    AL1(NCOLERR),AL1(L'ERR004+3),X'80'                               
ERR004   DC    C'NUMBER OF COLUMNS/CARD INVALID'                                
         DC    AL1(BLKERR),AL1(L'ERR005+3),X'80'                                
ERR005   DC    C'BLKSIZE NOT MULTIPLE OF CARD SIZE'                             
         DC    AL1(RSPCERR),AL1(L'ERR006+3),X'80'                               
ERR006   DC    C'RESPONDENT NUMBER SPEC INVALID'                                
         DC    AL1(CRDCERR),AL1(L'ERR007+3),X'80'                               
ERR007   DC    C'COLUMN FOR CARD NUMBER SPEC INVALID'                           
         DC    AL1(CXCERR),AL1(L'ERR008+3),X'80'                                
ERR008   DC    C'NCARDS X NCOLS EXCEEDS 65535'                                  
         DC    AL1(CNUMERR),AL1(L'ERR009+3),X'00'                               
ERR009   DC    C'INVALID CARD NUMBER FOR RESPONDENT -'                          
         DC    AL1(RCNTERR),AL1(L'ERR010+3),X'00'                               
ERR010   DC    C'RESPONDENT COUNT EXCEEDS THAT GIVEN-EXTRAS IGNORED'            
         DC    AL1(NVALERR),AL1(L'ERR011+3),X'00'                               
ERR011   DC    C'INVALID NUMERIC FIELD (SET TO ZERO) FOR RESPONDENT-'           
         DC    AL1(DUPCERR),AL1(L'ERR012+3),X'00'                               
ERR012   DC    C'DUPLICATE CARD FOR RESPONDENT-'                                
         DC    AL1(CTDUPERR),AL1(L'ERR013+3),X'80'                              
ERR013   DC    C'DUPLICATE CONDITON SPECS'                                      
         DC    AL1(CORERR),AL1(L'ERR014+3),X'80'                                
ERR014   DC    C'INSUFFICIENT CORE'                                             
         DC    AL1(FILECERR),AL1(L'ERR015+3),X'80'                              
ERR015   DC    C'FILECODE INVALID OR MISSING'                                   
         DC    X'FF'                                                            
         SPACE 3                                                                
SPECERR  EQU   1                                                                
COLERR   EQU   2                                                                
NCRDERR  EQU   3                                                                
NCOLERR  EQU   4                                                                
BLKERR   EQU   5                                                                
RSPCERR  EQU   6                                                                
RSPLERR  EQU   6                                                                
CRDCERR  EQU   7                                                                
CRDLERR  EQU   7                                                                
CXCERR   EQU   8                                                                
CNUMERR  EQU   9                                                                
RCNTERR  EQU   10                                                               
NVALERR  EQU   11                                                               
DUPCERR  EQU   12                                                               
CTDUPERR EQU   13                                                               
CORERR   EQU   14                                                               
FILECERR EQU   15                                                               
*                                                                               
WTAPI    DCB   DDNAME=WTAPI,                                           X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=200,                                              X        
               BLKSIZE=200,                                            X        
               MACRF=GM,                                               X        
               EODAD=WKEOT                                                      
         SPACE 3                                                                
WTAPO    DCB   DDNAME=WTAPO,                                           X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=200,                                              X        
               BLKSIZE=200,                                            X        
               MACRF=PM                                                         
         SPACE 3                                                                
INTAPE   DCB   DDNAME=INTAPE,                                          X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=160,                                              X        
               BLKSIZE=160,                                            X        
               MACRF=GM,                                               X        
               EODAD=INEOT                                                      
         SPACE 3                                                                
LDTAPE   DCB   DDNAME=LDTAPE,                                          X        
               DSORG=PS,                                               X        
               RECFM=VB,                                               X        
               LRECL=7996,                                             X        
               BLKSIZE=8000,                                           X        
               MACRF=PM                                                         
         SPACE 3                                                                
         LTORG                                                                  
         SPACE 3                                                                
WORKD    DSECT                                                                  
RCONS    DS    0F                                                               
CARDS    DS    A                                                                
SCANNER  DS    A                                                                
ABCT     DS    A                                                                
SORTER   DS    A                                                                
ASETRUN  DS    A                                                                
HEXOUT   DS    A                                                                
XSORT    DS    A                                                                
STXITER  DS    A                                                                
ACVEBC   DS    A                                                                
ACBTBL   DS    A                                                                
PRINTER  DS    A                                                                
VPRINTER DS    A                                                                
CPRINT   DS    A                                                                
AGETERR  DS    A                                                                
ACTAB    DS    A                                                                
AWTAPI   DS    A                                                                
AWTAPO   DS    A                                                                
AINTAPE  DS    A                                                                
ALDTAPE  DS    A                                                                
AMASKTAB DS    A                                                                
AIPPROC  DS    A                                                                
AOPPROC  DS    A                                                                
ADMPREC  DS    A                                                                
ASETSORT DS    A                                                                
AFLSHTAB DS    A                                                                
NUMVAL   DS    A                                                                
AGETRESP DS    A                                                                
APOSTR   DS    A                                                                
RCONSX   EQU   *                                                                
*                                                                               
AREC     DS    A                                                                
AWTREC   DS    A                                                                
ADTAB    DS    A                                                                
ASORTWK  DS    A                                                                
DMCB     DS    6F                                                               
FULL     DS    F                                                                
DUB      DS    D                                                                
WORK     DS    XL64                                                             
X        DS    256X                                                             
BYTE     DS    X                                                                
CARD     DS    CL80                                                             
*                                                                               
NCARDS   DS    F                                                                
NCOLS    DS    F                                                                
BLKSIZE  DS    F                                                                
RESPCOL  DS    F                                                                
RESPLEN  DS    F                                                                
CARDCOL  DS    F                                                                
CARDLEN  DS    F                                                                
MAXPAGE  DS    PL3                                                              
*                                                                               
INPUT    DS    C                                                                
PRINTWI  DS    C                                                                
PRINTWO  DS    C                                                                
PRINTI   DS    C                                                                
PRINTE   DS    C                                                                
PRINTO   DS    C                                                                
WORKF    DS    C                                                                
LOADTAPE DS    C                                                                
WTBLKSZE DS    F                                                                
INPSW    DS    X                                                                
IPSW     DS    X                                                                
OPSW     DS    X                                                                
FLSHSW   DS    X                                                                
SORTSIZE DS    F                                                                
NRESPS   DS    F                                                                
INCARD   DS    F                                                                
INCARDC  DS    F                                                                
INCOND   DS    F                                                                
FILCODE  DS    CL2                                                              
RECCODE  DS    XL1                                                              
THISRNO  DS    CL10                                                             
LASTRNO  DS    CL10                                                             
LASTWKEY DS    CL20                                                             
CDISP    DS    F                                                                
THISCNO  DS    CL4                                                              
CNUMLST  DS    XL12                                                             
RGCNT    DS    F                                                                
*                                                                               
CONDSZE  DS    F                                                                
CONDLTAB DS    XL20                TABLE OF WORK AREA LEN REQ FOR EACH          
*                                  TYPE OF CONDITION (5 FULLS)                  
RESPDPTB DS    XL20                FOR A RESP,DISP INTO CONDITION               
*                                  WORK AREA BY TYPE OF CONDITION               
RESPBMSK DS    XL1                 MASK FOR THIS RESP                           
*                                                                               
CRDNO    DS    F                                                                
COLNO    DS    F                                                                
CFACT    DS    F                                                                
HICORE   DS    F                                                                
LREC     DS    F                                                                
CRECL    DS    F                                                                
LDWRKL   DS    F                                                                
LDRECDL  DS    F                                                                
*                                                                               
LDRMAX   DS    F                   MAX SIZE FOR LOAD REC                        
PTR1     DS    A                   FIRST BYTE OF UNEQUAL STRING                 
PTR2     DS    A                   FIRST BYTE OF EQUAL STRING                   
DLN      DS    F                   LENGTH OF COMPARAND                          
EOL      DS    A                   END OF DATA                                  
EQNEED   DS    F                   BYTES NEEDED TO JUSTIFY COMPRESSION          
EQHAVE   DS    F                   EQUAL BYTE COUNT                             
ELMAX    DS    F                   MAX ELEM SIZE                                
ELMAXB   DS    F                   MAX BYTES FOR CURRENT ELEM                   
*                                                                               
RESPWC   DS    F                                                                
ALDREC   DS    A                                                                
ALDWRKA  DS    A                                                                
OPSVR4   DS    F                                                                
ARECWRK  DS    A                                                                
CORELIM  DS    F                                                                
ERR      DS    X                                                                
ERRLEV   DS    X                                                                
DMPSW    DS    X                                                                
ACCESS   DS    X                                                                
CMPRES   DS    C                                                                
         DS    0F                                                               
NCONDS   DS    XL20                COND COUNTS BY TYPE                          
*                                                                               
PRTVS1   DS    0F                  VALUES TO BE PRINTED AFTER SPECS             
NCONDT   DS    F                                                                
CNEED    DS    F                                                                
CWKSIZE  DS    F                                                                
*                                                                               
PRTVS2   DS    0F                  PRINTED AFTER INPUT PHASE                    
*                                  NOTE GULPSZE + LWTREC IN 2 SETS              
GULPSZE  DS    F                                                                
LWTREC   DS    F                                                                
*                                                                               
RECCNT   DS    F                                                                
RESPCNT  DS    F                                                                
GULPCNT  DS    F                                                                
IERRCNT  DS    F                                                                
WRKOCNT  DS    F                                                                
         SPACE 2                                                                
PRTVS3   DS    0F                  PRINTED AFTER OUTPUT PHASE                   
WRKICNT  DS    F                                                                
LDRCNT   DS    F                                                                
LDBCNT   DS    F                                                                
         SPACE 2                                                                
CRDCNT   DS    F                                                                
MAXGULP  DS    F                                                                
DASHES   DS    CL40'-'                                                          
*                                                                               
CEDTWRK  DS    XL1200                                                           
*                                                                               
*                                                                               
CTABD    DSECT                     DESECT FOR CONDITION TABLE                   
CTDISP   DS    XL2                 DISPLACEMENT INTO RESP                       
CTTYP    DS    XL1                 0=PUNCH, 1-4 = BINARY NUMERIC LENGTH         
CTMASK   DS    XL1                 BIT MASK  X'80'= 2ND BYTE                    
CTNLEN   EQU   CTMASK              OR NUMERIC FIELD LENGTH                      
CTABL    EQU   *-CTABD                                                          
         SPACE 3                                                                
*                                  DSECT FOR WORK TAPE RECORDS                  
WTRECD   DSECT                                                                  
WTREC    DS    0X                                                               
WTKEY    DS    0XL8                                                             
WTCOND   DS    0XL5                CONDITION                                    
WTCRD    DS    XL2                 CARD NUM                                     
WTCOL    DS    XL2                 COLUMN NUM                                   
WTPNCH   DS    XL1                 PUNCH CODE                                   
WTNLEN   EQU   WTPNCH              OR NUMERIC FIELD LEN                         
WTGULP   DS    XL2                 GULP NUMBER                                  
WTSEQ    DS    XL1                 SEQUENCE WITHIN GULP                         
*                                                                               
WTDATA   DS    0X                  DATA AREA                                    
         EJECT                                                                  
*                                                                               
       ++INCLUDE MPGENXVT                                                       
         EJECT                                                                  
*                                                                               
       ++INCLUDE DDDPRINT                                                       
*                                                                               
         EJECT                                                                  
CTAB     CSECT                                                                  
         ORG   *+400000          **TEMPORARY UNTIL SOFT**                       
CTABX    DS    X                                                                
         DC    X'0000'                                                          
*                                                                               
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'002MPXVERTS  05/01/02'                                      
         END                                                                    

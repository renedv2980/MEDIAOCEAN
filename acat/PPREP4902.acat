*          DATA SET PPREP4902  AT LEVEL 135 AS OF 03/20/14                      
*CATALP PP4902                                                                  
         TITLE 'PP049-02  PRINTPAK AGENCY SUMMARY'                              
*                                                                               
*        OPTIONS                                                                
*        -------                                                                
* COL 58       Y=REPORT NET INSTEAD OF GROSS (QOPT2 MUST BE "R")                
*                                                                               
* COL 59       O=OPEN RATES OR COST 2                                           
*              P=PLANNED COSTS                                                  
*              B=PLANNED COSTS AND COST 2                                       
*                                                                               
* COL 60       T=INCLUDE TEST ESTIMATES/BUYS                                    
*                                                                               
* COL 61       B=READ BUYS NOT BUCKETS (DEFAULT)                                
*              K=READ BUCKETS - IGNORING DAY                                    
*                                                                               
* QOPT 1       P=PRIOR                                                          
*              S=SUBS                                                           
*              B=BOTH                                                           
*                                                                               
* QOPT 2       C=CLOSE-OUT RUN                                                  
*              R=REQUESTED  - DON'T ADD TO DDSTOTALS                            
*                                                                               
* QOPT 3       1=PRINT ALL-MEDIA TOTALS AFTER                                   
*              2=PRINT ONLY ALL-MEDIA TOTALS                                    
*                                                                               
*                                                                               
* QOPT 4       C=SUPPRESS C.D. FOR BILL/PAID                                    
*                                                                               
* QOPT 5       S=PRINT SPECIAL TOTALS                                           
*                                                                               
* QOPT 6       Y=RUN BY OFFICE                                                  
*              BLANK=NO OFFICE, OTHERWISE USED AS OFFICE FILTER                 
*                                                                               
* QOPT 7       P=PRODUCTION RUN - USE PP49WF                                    
*              C=SUPPRESS CLIENT TOTALS (NON-PRODUCTION ONLY)                   
*                                                                               
*                                                                               
         TITLE 'PP049-02  PRINTPAK AGENCY SUMMARY - CHANGE LOG'                 
***********************************************************************         
*                                                                     *         
*        CHANGE LOG                                                   *         
*                                                                     *         
***********************************************************************         
*                                                                               
*  BPLA 03/14     CHANGES FRO MEDIA L - SOCIAL                                  
*                                                                               
*  BPLA 01/14     CHANGES FOR 2 CHARACTER SYSTEMS                               
*                                                                               
*  BPLA 09/09     FIX PLANNED COST CODE - ON HOLD (**HOLD**) EXCEPT             
*                 B2B PROFILE READING BUG                                       
*                 CHANGES SO THAT BUYS ARE ONLY READ ON FRIDAYS                 
*                 INSTEAD OF FRI/SAT/SUN AND NOW ONLY FOR PRODUCTION            
*                 RUNS.                                                         
*                                                                               
*  BOBY 11/06     ADD PLANNED COSTS TO REPORT                                   
*                                                                               
*  SMYE 03/06     HANDLE "NON-TOTAL" BILLION DOLLARS BY EDITING                 
*                   OUTPUT WITHOUT COMMAS                                       
*                                                                               
*  SMYE 08/05     USE CORE-RESIDENT OFFICER                                     
*                                                                               
*  BOBY 02/04     TOTALS DON'T PRINT BILLION DOLLARS CORRECTLY                  
*                    LEADING DIGIT CHOPPED OFF                                  
*                 NOW ALLOTED 18 CHARACTERS AND PERCENT ON LINE 2               
*                                                                               
*  KWAN 08/00     NEW PBILLREC AND PPBVAL DSECT                                 
*                                                                               
*  SMYE 05/00     CHANGES FOR PPNEWFILE (LARGER PCONREC, ETC.)                  
*                                                                               
*  BPLA  4/00     WHEN READING JW AND OM MANUAL BILLS                           
*                 SKIP REVERSED BILLS                                           
*                                                                               
*  BPLA  3/00     CLIENT TABLE EXPANDED WAS 3000 CLIENTS -                      
*                 EXPANDED TO 4000                                              
*                                                                               
*  BPLA  3/00     READ ONLY MANUAL BILLS FOR JW AND OG                          
*                 THEY DO NEED TO BE PROCESSED                                  
*                 THEY HAD BEEN SKIPPED SINCE NO BILLS WERE                     
*                 READ FOR THOSE AGENCIES SINCE CONVERTED                       
*                 BUYS HAD BILLING BUT NO BILLRECS                              
*                                                                               
*  BPLA  6/98     NEW VALUE FOR QOPT7 C= SUPPRESS CLIENT TOTALS                 
*                 (NON-PRODUCTION RUN ONLY)                                     
*                                                                               
*  BPLA 7/8/94    IF JW OR OG I MUST ALWAYS READ BUYS SINCE THEY                
*                 HAVE CONVERTED FILES THAT DON'T HAVE PBILLRECS                
*                                                                               
*  BPLA 12/1/92   LOGIC FOR OFFICE LIST REQUESTS ($N IN QCLIENT)                
*                                                                               
*  BPLA 10/12/92  USE PPBVAL TO EXTRACT "EFFECTIVE" VALUES FROM                 
*                 BILLS AND BILLING ELEMENTS                                    
*                                                                               
*  BPLA 4/27/92   REPORT NET INSTEAD OF GROSS                                   
*                 (AVAILABLE ONLY IF QOPT2 = "R" (REQUESTED))                   
*                                                                               
*  BPLA 3/20/92   CODE TO STAGGER TOTAL LINE FOR AGY/OFF/DDS TOTALS             
*                                                                               
*  BPLA 10/21/91  ADD CODE FOR START AND END PERIOD (REQUESTED P49)             
*                                                                               
*  BPLA 8/21/91 DISPLAY OFFICE AND ACC OFFICE UNDER CLIENT                      
*               UNLESS OFFICE REQUEST IN WHICH CASE JUST SHOW ACC OFF           
*                                                                               
*  BPLA 4/19/91   GST LOGIC NO-OPED - SEE ***GST STATEMENTS                     
*                 CLTTAB EXPANDED TO 3000 FROM 2000                             
*                 MAXCLTS CHANGED FROM 2000 TO 3000                             
*                                                                               
*  BPLA 1/18/90   READ NEW X'31' TODAY BUCKETS WHICH INCLUDE GST                
*                 USE GETINS TO RETURN PAID TODAY DATA                          
*                 ADDUP NOW IN A CSECT                                          
*                                                                               
*  BPLA 2/6/91    ALLOW FOR ONE CLIENT REQUESTS                                 
*                                                                               
         PRINT NOGEN                                                            
         TITLE 'PP049-02  PRINTPAK AGENCY SUMMARY'                              
PP4902   CSECT                                                                  
         NMOD1 0,PP4902                                                         
         SPACE 2                                                                
         L     RA,0(R1)                                                         
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC                                                       
         LA    R8,SPACEND                                                       
         USING PP49WRKD,R8                                                      
*                                                                               
         L     RF,PPWORK2C                                                      
         USING PPWORK2D,RF                                                      
         MVC   ACONIO1,ACONIO      (A)PCONREC                                   
         DROP  RF                                                               
         SPACE 2                                                                
         CLI   MODE,RUNFRST                                                     
         BE    INIT                                                             
         CLI   MODE,RUNLAST                                                     
         BE    LAST                                                             
         CLI   MODE,PROCREQ                                                     
         BNE   EXIT                                                             
         BAS   RE,PROCAGYM                                                      
*                                                                               
EXIT     DS    0H                                                               
         XIT1                                                                   
         EJECT                                                                  
*                                  INITIALIZATION                               
INIT     DS    0H                                                               
         SPACE 1                                                                
*                                  RELOCATE ACONS                               
*        LA    R0,12             WAS ACONX-ACONS/4                              
         LA    R0,(ACONX-ACONS)/4                                               
         LA    R1,ACONS                                                         
         LA    R2,ACLTTOTS                                                      
         RELOC (R4)                                                             
INIT0    DS    0H                                                               
         L     R3,0(R1)                                                         
         AR    R3,R4                                                            
         ST    R3,0(R2)                                                         
         LA    R1,4(R1)                                                         
         LA    R2,4(R2)                                                         
         BCT   R0,INIT0                                                         
*                                                                               
         XC    WFID,WFID                                                        
*                                                                               
*                                                                               
         MVC   TODAY1+0(2),RCDATE+6      YR                                     
         MVC   TODAY1+2(2),RCDATE+0      MO                                     
         MVC   TODAY1+4(2),RCDATE+3      DA                                     
*                                                                               
         GOTO1 DATCON,DMCB,TODAY1,(3,BTODAY)                                    
         GOTO1 DATCON,DMCB,(3,BTODAY),(0,TODAY1)                                
         GOTO1 GETDAY,DMCB,TODAY1,WORK                                          
         MVC   DAY,DMCB            SAVER DAY OF WEEK                            
*                                                                               
         SPACE 3                                                                
         XC    OLDKEY,OLDKEY                                                    
         OI    DMINBTS,X'08'       SET TO PASS DELETES                          
         MVI   DMOUTBTS,X'FD'                                                   
         L     R2,ADDSTOTS         CLEAR DDSTOTS                                
         BAS   RE,CLEAR                                                         
         SPACE 1                                                                
         MVC   MLISTX(10),=C'AMTGTNMGMN'                                        
         SPACE 1                                                                
*                                                                               
         XC    DMCB(4),DMCB        NEED ADDRESS OF OFFICER                      
         MVC   DMCB+4(4),=X'D9000A38'                                           
         L     RF,VCOMFACS                                                      
         L     RF,(CCALLOV-COMFACSD)(RF)                                        
         GOTO1 (RF),DMCB                                                        
         MVC   VOFFICER,DMCB                                                    
         SPACE 1                                                                
*                                                                               
INITX    B     EXIT                                                             
         EJECT                                                                  
*                                                                               
*        DO FOR EACH NEW REQUEST                                                
*                                                                               
RQINIT   NTR1                                                                   
         L     R2,ACLTTOTS         CLEAR CLTTOTS                                
         BAS   RE,CLEAR                                                         
*                                                                               
         L     R2,AAGYTOTS         CLEAR AGYTOTS                                
         BAS   RE,CLEAR                                                         
*                                                                               
         MVC   PAGE,=H'1'                                                       
         MVI   FORCEHED,C'Y'                                                    
         MVC   P,SPACES                                                         
*                                                                               
         MVC   BQEND,=3X'FF'       SET ENDING DATE                              
*                                                                               
         CLI   QEND,C' '                                                        
         BNH   RQINIT3                                                          
*                                                                               
         GOTO1 DATCON,DMCB,QEND,(3,BQEND)                                       
*                                                                               
         MVI   QPAY+2,C' '       MONTHS AHEAD TO BE CALCULATED                  
*                                  BUILD MLIST FROM RUN DATE                    
RQINIT3  DS    0H                                                               
*                                                                               
         MVC   WORK(6),QSTART      USE QSTART IF THERE                          
*                                                                               
         CLI   QSTART,C' '                                                      
         BNE   RQINIT4                                                          
*                                                                               
         MVC   WORK(2),RCDATE+6   YR                                            
         MVC   WORK+2(2),RCDATE   MO                                            
         MVC   WORK+4(2),RCDATE+3 DA                                            
*                                                                               
RQINIT4  DS    0H                                                               
*                                                                               
         MVC   WORK+4(2),=C'01'      SET DAY TO 01                              
*                                                                               
         GOTO1 DATCON,DMCB,WORK,(3,BSTART)                                      
*                                                                               
         MVC   MBKOPT,=H'36'                                                    
         MVC   MUPOPT,=H'23'                                                    
*                                                                               
         CLI   QEND,C' '           SEE IF RANGE GIVEN                           
         BE    RQINIT4B                                                         
*                                                                               
         MVC   MBKOPT,=H'1'                                                     
         MVC   MUPOPT,=H'58'                                                    
*                                                                               
RQINIT4B DS    0H                                                               
*                                                                               
         XC    MLIST,MLIST                                                      
*                                                                               
         LH    R3,MBKOPT           NUMBER OF MONTHS BACK OPTION                 
         SLL   R3,1                X 2                                          
*                                                                               
         LA    R2,MLIST(R3)        R2 = A(THIS MONTH)                           
         LR    RF,R2               SAVE R2                                      
         MVC   0(2,R2),BSTART                                                   
*                                                                               
         LH    R3,MBKOPT                                                        
*                                                                               
         BAS   RE,MNTHBACK         BACK UP 1 MONTH                              
         BCT   R3,*-4                                                           
*                                                                               
         LH    R3,MUPOPT           NUMBER OF MONTHS UP OPTION                   
         LR    R2,RF               RESTORE R2                                   
*                                                                               
         SR    R4,R4                                                            
*                                                                               
RQINIT6  DS    0H                                                               
*                                                                               
         CLC   0(2,R2),BQEND       TEST HAVE REACHED REQ'D END                  
         BL    RQINIT7                                                          
*                                                                               
         CLI   QPAY+2,C' '         SET MONTHS AHEAD                             
         BNE   RQINIT7                                                          
*                                                                               
         CVD   R4,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  QPAY+2(2),DUB                                                    
*                                                                               
RQINIT7  DS    0H                                                               
*                                                                               
         LA    R4,1(R4)                                                         
         BAS   RE,MNTHUP           BUMP 1 MONTH                                 
         BCT   R3,RQINIT6                                                       
*                                                                               
RQINITX  DS    0H                                                               
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
LAST     DS    0H                                                               
         OC    WFID,WFID                                                        
         BZ    EXIT                NO WORKER FILES                              
         CLC   PAGYKAGY,=C'ZZ'      CROSS AGENCY RUN?                           
         BNL   DDSSUM10                                                         
         GOTO1 AWFMOD,DMCB,=C'CLOSE'                                            
*                                                                               
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
*                                  PROCESS AN AGY/MED                           
PROCAGYM NTR1                                                                   
         SPACE 1                                                                
         CLC   QAGENCY(3),PAGYKAGY                                              
         BNE   EXIT                                                             
         BAS   RE,RQINIT                                                        
*                                                                               
         CLC   QCLIENT(2),=C'$*'        ALL OFFICE REQUEST                      
         BNE   *+10                                                             
         MVC   QCLIENT(2),=C'* '        THIS IS THE WAY P49                     
*                                       IS SET TO HANDLE THIS REQUEST           
*                                                                               
         MVC   NETOPT,QOPT1-4      COL 58 = NET OPTION                          
*                                                                               
         MVC   OPNOPT,QOPT1-3      COL 59 = OPEN RATE OPTION                    
         MVC   TSTOPT,QOPT1-2      COL 60 = TEST ESTIMATE OPT                   
*                                                                               
         MVC   BUYOPT,QOPT1-1      COL 61 = BUY READ OPTION                     
         CLI   BUYOPT,C' '                                                      
         BNE   PRA02                                                            
*                                                                               
         CLI   QOPT7,C'P'          SEE IF PRODUCTION RUN                        
         BNE   PRA02                                                            
*                                                                               
         CLI   DAY,5             IF FRI,SAT OR SUN THEN READ BUYS               
         BNE   PRA02             NOW ONLY DO ON FRIDAY (WAS BNH VS 4)           
         MVI   BUYOPT,C'B'                                                      
         B     PRA04                                                            
*                                                                               
PRA02    DS    0H                                                               
         CLC   QAGENCY,=C'JW'      SEE IF JWT                                   
         BE    PRA03                                                            
         CLC   QAGENCY,=C'OG'      OR IF OGILVY                                 
         BNE   PRA04                                                            
PRA03    MVI   BUYOPT,C'B'         MUST ALWAYS READ BUYS                        
*                                  SINCE THEY HAVE CONVERTED DATA               
*                                  THAT HAS BILL ELEMENTS BUT                   
*                                  NO BILLRECS                                  
PRA04    DS    0H                                                               
         MVI   FCRDCLOS,C'N'                                                    
         CLI   QOPT2,C'C'          TEST TO READ CLOSEOUTS                       
         BNE   *+8                                                              
         MVI   FCRDCLOS,C'Y'                                                    
*                                                                               
         MVI   FORCEHED,C'Y'                                                    
         MVI   RCSUBPRG,10                                                      
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+8                                                              
         MVI   RCSUBPRG,11                                                      
*                                                                               
         CLI   OPNOPT,C'P'         PLANNED COSTS                                
         BE    *+8                                                              
         CLI   OPNOPT,C'B'         PLANNED COSTS WITH COST2                     
         BNE   PRA041                                                           
*                                                                               
         MVI   RCSUBPRG,40         PLANNED COST IN GROSS $'S                    
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+8                                                              
         MVI   RCSUBPRG,41         PLANNED COST IN NET   $'S                    
*                                                                               
PRA041   DS    0H                                                               
*                                                                               
         MVC   PAGE,=H'1'                                                       
         MVI   PSTART,0                                                         
         BAS   RE,SETSW                                                         
         CLC   QAGENCY,=C'ZZ'      CROSS AGENCY RUN?                            
         BL    *+12                                                             
         BAS   RE,DDSSUM                                                        
         B     PRAGX                                                            
*                                  IF QOPT6 (OLD OFFICE CONTROL) USED           
*                                  MAKE QCLIENT AGREE WITH IT                   
         CLI   QOPT6,C' '                                                       
         BE    PRA1B                                                            
         MVC   QCLIENT,=C'*  '                                                  
         CLI   QOPT6,C'Y'                                                       
         BE    PRA1B                                                            
         MVC   QCLIENT+1(1),QOPT6                                               
PRA1B    DS    0H                                                               
         CLI   QOPT3,C'1'                                                       
         BH    PRAG30                                                           
         CLI   QOPT2,C'R'              SEE IF REQUESTED P49                     
         BE    PRA1B2                                                           
*                                                                               
         CLC   QAGENCY(6),OLDKEY       A/M/CLT                                  
         BE    PRAG23                                                           
*                                                                               
PRA1B2   CLC   QAGENCY(2),OLDKEY                                                
         BE    PRAG1                                                            
*                                                                               
         L     R2,ADDSTOTS                                                      
         BAS   RE,CLEAR                                                         
PRAG1    DS    0H                                                               
         L     R2,AAGYTOTS                                                      
         BAS   RE,CLEAR                                                         
*                                                                               
*                                                                               
*                                                                               
*                                  BUILD LIST OF ALL CLIENTS AND                
*                                  SORT IN OFFICE ORDER                         
*                                                                               
*                                                                               
         XC    SVOFCLST,SVOFCLST                                                
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(3),PAGYKEY                                                   
         MVI   KEY+3,2                                                          
         CLC   QCLIENT,=C'ALL'                                                  
         BE    PRAG1B                                                           
         CLI   QCLIENT,C'*'                                                     
         BE    PRAG1B                                                           
*                                                                               
         CLI   QCLIENT,C'$'           OFFICE LIST                               
         BE    PRAG1B                                                           
*                                                                               
         MVC   KEY+4(3),QCLIENT       DOING ONE CLIENT                          
*                                                                               
PRAG1B   L     R4,ACLTTAB                                                       
         GOTO1 HIGH                                                             
         B     PRAG1CA                                                          
PRAG1C   DS    0H                                                               
         GOTO1 SEQ                                                              
PRAG1CA  DS    0H                                                               
         CLC   KEY(4),KEYSAVE                                                   
         BNE   PRAG1C4                                                          
*                                                                               
         CLI   QCLIENT,C'$'        PROC BY OFFICE LIST                          
         BNE   PRAG1CC                                                          
*                                                                               
         GOTO1 GETCLI                                                           
         XC    DUB,DUB                                                          
         LA    R1,DUB                                                           
         USING OFFICED,R1                                                       
         MVI   OFCSYS,C'P'                                                      
         MVC   OFCAUTH,QCLIENT                                                  
         MVC   OFCAGY,PCLTKAGY                                                  
         MVC   OFCOFC,PCLTOFF                                                   
         DROP  R1                                                               
*NOP*    GOTO1 =V(OFFICER),DMCB,DUB,(X'80',VCOMFACS),SVOFCLST                   
         GOTO1 VOFFICER,DMCB,DUB,(X'80',VCOMFACS),SVOFCLST                      
         CLI   0(R1),0             TEST AUTHORIZED                              
         BE    PRAG1C1             YES - PROCESS                                
         B     PRAG1C              GO CHECK NEXT CLIENT                         
*                                                                               
         SPACE                                                                  
PRAG1CC  DS    0H                                                               
         CLI   QCLIENT,C'*'        PROC BY OFFICE                               
         BNE   PRAG1C2             NO                                           
         GOTO1 GETCLI                                                           
         CLI   QCLIENT+1,C' '      ALL OFFICES                                  
         BE    PRAG1C1             YES                                          
         CLI   QCLIENT+1,C'-'      ALL BUT                                      
         BE    PRAG1CD                                                          
         CLC   PCLTOFF(1),QCLIENT+1                                             
         BL    PRAG1C                                                           
         BE    PRAG1C1             OK                                           
         CLI   QCLIENT+2,C' '      TEST RANGE                                   
         BE    PRAG1C              NO                                           
         CLC   PCLTOFF(1),QCLIENT+2   TEST WITHIN RANGE                         
         BH    PRAG1C                                                           
         B     PRAG1C1                                                          
PRAG1CD  DS    0H                                                               
         CLC   PCLTOFF(1),QCLIENT+2    ALL BUT                                  
         BE    PRAG1C              BYPASS IF =                                  
PRAG1C1  DS    0H                                                               
         XC    0(2,R4),0(R4)                                                    
*                                                                               
*        GET 2 CHARACTER CODE                                                   
*                                                                               
         MVC   SAVCOFF,SPACES                                                   
         MVC   SAVCOFF(1),PCLTOFF                                               
*                                                                               
         XC    WORK,WORK                                                        
OFFD     USING OFFICED,WORK                                                     
         MVI   OFFD.OFCSYS,C'P'                                                 
*                                                                               
         MVC   OFFD.OFCAGY,PCLTKAGY                                             
         MVC   OFFD.OFCOFC,PCLTOFF                                              
         GOTO1 VOFFICER,DMCB,(C'2',WORK),(0,VCOMFACS)                           
         CLI   0(R1),0                                                          
         BNE   PRAG1C1B                                                         
         MVC   SAVCOFF,OFFD.OFCOFC2                                             
*                                                                               
         DROP  OFFD                                                             
*                                                                               
PRAG1C1B DS    0H                                                               
         MVC   0(2,R4),SAVCOFF                                                  
         CLC   0(2,R4),SPACES                                                   
         BH    *+10                                                             
         MVC   0(2,R4),=X'FEFF'    SPECIAL FOR NO OFFICE CODE                   
         B     *+10                                                             
PRAG1C2  DS    0H                                                               
         XC    0(2,R4),0(R4)                                                    
         MVC   2(3,R4),PCLTKCLT                                                 
         MVC   5(4,R4),KEY+27                                                   
         LA    R4,16(R4)                                                        
         MVI   0(R4),X'FF'                                                      
*                                                                               
         CLI   QCLIENT,C'$'           OFFICE LIST                               
         BE    PRAG1C                                                           
         CLI   QCLIENT,C'*'                                                     
         BE    PRAG1C                                                           
         CLC   QCLIENT,=C'ALL'                                                  
         BE    PRAG1C                                                           
*                                  MUST BE ONE CLIENT                           
*                                                                               
PRAG1C4  DS    0H                                                               
         S     R4,ACLTTAB                                                       
         BNP   PRAG20               NO CLIENTS                                  
         SRL   R4,4                DEV BY 16 = NO. OF CLTS                      
         CH    R4,=Y(MAXCLTS)                                                   
         BNH   *+6                                                              
         DC    H'0'                                                             
         GOTO1 XSORT,DMCB,ACLTTAB,(R4),16,5,0                                   
*                                                                               
         L     R2,AOFFTOTS                                                      
         BAS   RE,CLEAR                                                         
         MVC   ACLIENT,ACLTTAB                                                  
         L     R4,ACLIENT                                                       
         MVC   LASTOFF,0(R4)                                                    
         B     PRAG7B                                                           
*                                                                               
*                                                                               
PRAG2    GOTO1 HIGH                                                             
         B     PRAG6                                                            
*                                                                               
PRAG4    EQU   *                                                                
*                                                                               
         GOTO1 SEQ                                                              
*                                                                               
PRAG6    EQU   *                                                                
         CLC   KEY(7),KEYSAVE                                                   
         BNE   PRAG6A6                                                          
         CLI   KEY+25,X'FF'         TEST FF DELETE                              
         BE    PRAG4                                                            
         CLI   QOPT2,C'C'          TEST CLOSE-OUT RUN                           
         BNE   PRAG6A              NO                                           
*                                                                               
         TM    KEY+25,X'C0'        YES- MUST BE CLOSED OUT                      
         BO    PRAG6A4                                                          
         B     PRAG4                                                            
*                                                                               
PRAG6A   DS    0H                                                               
         TM    KEY+25,X'40'                                                     
         BNZ   PRAG4               CLOSED OUT                                   
*                                                                               
PRAG6A4  DS    0H                                                               
         CLC   KEY(7),KEYSAVE      TEST A/M/C                                   
         BE    PRAG16              YES                                          
*                                  FINISH OLD CLIENT                            
PRAG6A6  DS    0H                                                               
         CLI   CLTACT,C'Y'                                                      
         BNE   PRAG6B                                                           
         MVC   MID1,SPACES                                                      
         MVC   MID1(3),PCLTKCLT                                                 
         MVC   MID1+4(20),PCLTNAME                                              
         LA    R2,MID2                                                          
         CLI   QCLIENT,C'*'           SEE IF OFFICE                             
         BE    PRAG6A8                                                          
         CLI   QCLIENT,C'$'           OR OFFICE LIST REQUEST                    
         BE    PRAG6A8                IF SO - SKIP OFFICE HERE                  
*                                     IT WILL BE IN HEADLINES                   
         CLC   SAVCOFF,SPACES                                                   
         BE    PRAG6A8                                                          
         MVC   MID2(6),=C'OFFICE'                                               
         MVC   MID2+7(2),SAVCOFF                                                
         LA    R2,MID2+10                                                       
PRAG6A8  CLI   PCLTAOFC,C' '                                                    
         BNH   PRAG6A9                                                          
         MVC   0(10,R2),=C'ACC OFFICE'                                          
         MVC   11(2,R2),PCLTAOFC                                                
*                                                                               
PRAG6A9  MVI   FORCEMID,C'Y'                                                    
         L     R2,ACLTTOTS                                                      
         L     R3,AOFFTOTS                                                      
         BAS   RE,ROLLUP                                                        
*                                                                               
         CLI   QOPT7,C'C'         SEE IF SUPPRESSING CLIENT TOTALS              
         BE    PRAG6B                                                           
*                                                                               
         GOTO1 APRNT,DMCB,ACLTTOTS                                              
*                                                                               
PRAG6B   DS    0H                                                               
         MVC   MID1,SPACES       THERE MIGHT BE SOMETING LEFT HERE              
         MVC   MID2,SPACES                                                      
*                                                                               
         L     R4,ACLIENT                                                       
         LA    R4,16(R4)                                                        
         ST    R4,ACLIENT                                                       
         CLC   LASTOFF,0(R4)                                                    
         BE    PRAG7                                                            
         OC    LASTOFF,LASTOFF     ANY OFFICE IN TABLE?                         
         BE    PRAG6D                                                           
*                                  END OF OFFICE                                
         MVC   MID1,SPACES                                                      
         MVC   MID1(13),=C'OFFICE TOTALS'                                       
         MVC   MID2(13),=C'-------------'                                       
         MVI   FORCEMID,C'Y'                                                    
         GOTO1 APRNT,DMCB,AOFFTOTS                                              
*                                                                               
         MVI   FORCEHED,C'Y'                                                    
PRAG6D   DS    0H                                                               
         L     R2,AOFFTOTS                                                      
         L     R3,AAGYTOTS                                                      
         BAS   RE,ROLLUP                                                        
         L     R2,AOFFTOTS                                                      
         BAS   RE,CLEAR                                                         
         CLI   0(R4),X'FF'                                                      
         BE    PRAG20                                                           
         MVC   LASTOFF,0(R4)                                                    
PRAG7    EQU   *                                                                
PRAG7B   DS    0H             GET NEW CLIENT HDR                                
         MVI   CLTACT,C'N'                                                      
         MVC   KEY+27(4),5(R4)                                                  
         GOTO1 GETCLI                                                           
*                                                                               
*        GET 2 CHARACTER CODE                                                   
*                                                                               
         MVC   SAVCOFF,SPACES                                                   
         MVC   SAVCOFF(1),PCLTOFF                                               
         MVI   C2ACTIVE,C'N'       DEFAULT TO NO OLA AND/OR AGY NOT             
*                                  USING 2 CHARACTER OFFICE CODES               
         XC    WORK,WORK                                                        
OFFD     USING OFFICED,WORK                                                     
         MVI   OFFD.OFCSYS,C'P'                                                 
*                                                                               
         MVC   OFFD.OFCAGY,PCLTKAGY                                             
         MVC   OFFD.OFCOFC,PCLTOFF                                              
         GOTO1 VOFFICER,DMCB,(C'2',WORK),(0,VCOMFACS)                           
         CLI   0(R1),0                                                          
         BNE   PRAG50                                                           
         TM    OFFD.OFCINDS,OFCINOLA NO OLA RECS AND/OR AGY NOT USING           
         BNZ   *+8                 2 CHARACTER OFFICES                          
         MVI   C2ACTIVE,C'Y'       SET ACTIVE                                   
*                                                                               
         MVC   SAVCOFF,OFFD.OFCOFC2                                             
*                                                                               
         DROP  OFFD                                                             
*                                                                               
PRAG50   MVI   HAVPRI,0                                                         
         MVI   HAVPRI,0                                                         
         MVI   HAVSUB,0                                                         
         MVC   LASTPRD,SPACES                                                   
         L     R2,ACLTTOTS         CLEAR CLTTOTS                                
         BAS   RE,CLEAR                                                         
*                                                                               
*        GET B2B PROFILE FOR CLIENT                                             
*                                                                               
         XC    B2BPROF,B2BPROF     INIT B2BPROF                                 
*                                                                               
         CLI   OPNOPT,C'P'         SKIP IF NOT DOING PLANNED COSTS              
         BE    *+8                                                              
         CLI   OPNOPT,C'B'                                                      
         BNE   PRAG50A                                                          
*                                                                               
         XC    WORK,WORK           CLEAR WORK AREA                              
         MVI   WORK,C'P'           SET SYSTEM                                   
         NI    WORK,X'FF'-X'40'    FORCE LOWERCASE TO INDICATE                  
*                                     PROF ID IS 3 LONG                         
         MVC   WORK+1(3),=C'B2B'   B2B PROFILE FOR PLANNED COSTS                
         MVC   WORK+4(3),PCLTKEY   AGENCY/MEDIA                                 
         MVC   WORK+7(3),PCLTKCLT  CLIENT                                       
*                                                                               
         CLI   PCLTOFF,C' '        SKIP IF NO CLIENT OFFICE                     
         BNH   *+14                                                             
         MVI   WORK+10,C'*'                                                     
         MVC   WORK+11(1),PCLTOFF  CLIENT OFFICE                                
*                                                                               
         GOTO1 GETPROF,DMCB,(X'C0',WORK),B2BPROF,DATAMGR,0,0,0                  
*                                                                               
PRAG50A  DS    0H                                                               
*                                                                               
*        READ BILL RECORDS                                                      
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(7),PCLTKEY                                                   
         MVI   KEY+3,X'08'                                                      
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         B     PRAG10                                                           
*                                                                               
PRAG8    EQU   *                                                                
*                                                                               
         GOTO1 SEQ                                                              
*                                                                               
PRAG10   EQU   *                                                                
*                                                                               
         CLC   KEY(7),KEYSAVE      A/M/C                                        
         BNE   PRAG14                                                           
*                                                                               
         CLI   QOPT2,C'C'          TEST CLOSE OUT RUN                           
         BNE   PRAG11              NO                                           
*                                                                               
         TM    KEY+25,X'C0'        YES- MUST BE CLOSED OUT                      
         BO    PRAG12                                                           
         B     PRAG8                                                            
*                                                                               
PRAG11   DS    0H                                                               
*                                                                               
         TM    KEY+25,X'80'        SKIP DELETES                                 
         BNZ   PRAG8                                                            
*                                                                               
PRAG12   DS    0H                                                               
*                                                                               
         MVI   CLTACT,C'Y'                                                      
*                                                                               
         OC    KEY+10(2),KEY+10      IGNORE EST 0 BILLS                         
         BZ    PRAG8                                                            
*                                                                               
         GOTO1 GETBILL                                                          
*                                                                               
         CLC   PBILLDAT,TODAY1     SKIP BILLS ADDED AFTER 'TODAY1'              
         BH    PRAG8                                                            
         CLI   PBRETAIL,X'41'      SKIP RETAIL SUMMARY BILL                     
         BE    PRAG8                                                            
*                                  SET TO READ BILLS                            
***OG***                                                                        
         CLC   PCLTKEY(2),=C'OG'      SPECIAL FOR OG                            
         BE    PRAG13                  DON'T READ BILLRECS                      
***OG***                                                                        
***JW***                                                                        
         CLC   PCLTKEY(2),=C'JW'      SPECIAL FOR JW                            
         BE    PRAG13                  DON'T READ BILLRECS                      
***JW***                                                                        
         B     PRAG13X                                                          
*                                                                               
PRAG13   DS    0H                                                               
         CLI   PBILLTYP,C'M'  FOR JW AND OG ONLY PROCESS MANUAL BILLS           
         BNE   PRAG8                                                            
*                                                                               
         CLI   PBILLCDT,C'0'  SEE IF REVERSED                                   
         BH    PRAG8                                                            
*                                                                               
PRAG13X  DS    0H                                                               
*                                                                               
         GOTO1 =V(PPBVAL),DMCB,(C'B',PBILLREC),PPBVALD                          
*                                                                               
*   SET "EFFECTIVE" VALUES INTO PBILLREC                                        
*                                                                               
         MVC   PBILLGRS,PPBVEBG                                                 
         MVC   PBILLBIL,PPBVEBB                                                 
         MVC   PBILLNET,PPBVEBN                                                 
*                                                                               
*        USE PPBVEBC FOR "EFFECTIVE" CD                                         
*                                                                               
         GOTO1 AADDUP                                                           
*                                                                               
         B     PRAG8                                                            
*                                                                               
PRAG14   EQU   *                   READ ESTHDR BUCKETS                          
*                                                                               
         CLI   BUYOPT,C'B'         SEE IF READING BUYS                          
         BE    PRAG19                                                           
*                                                                               
*        NOW READ ESTIMATE BUCKET RECORDS                                       
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(7),PCLTKEY                                                   
         MVI   KEY+3,X'09'                                                      
*                                                                               
         B     PRAG2                                                            
*                                  PROCESS BUCKET RECORD                        
PRAG16   EQU   *                                                                
*                                  PROCESS BUCKET RECORD                        
         CLC   LASTPRD,KEY+7       TEST PRD BREAK                               
         BE    PRAG17                                                           
*                                                                               
         MVC   LASTPRD,KEY+7                                                    
*                                                                               
         CLI   OPNOPT,C'P'         SKIP IF NOT DOING PLANNED COSTS              
         BE    *+8                                                              
         CLI   OPNOPT,C'B'                                                      
         BNE   PRAG169                                                          
*                                                                               
         XC    SVPRDEFD,SVPRDEFD   INIT PC BILLING EFF DTE                      
*                                                                               
         MVC   WORK(64),KEY        SAVE CURRENT KEY                             
*                                                                               
         XC    KEY+10(15),KEY+10   SAVE AGY/MED/CLT/PRD                         
         MVI   KEY+3,6             SET FOR PRODUCT RECORD                       
*                                                                               
         GOTO1 HIGH                READ PRODUCT RECORD                          
*                                                                               
         CLC   KEY(25),KEYSAVE     SKIP IF PRODUCT NOT FOUND                    
         BNE   PRAG168                                                          
*                                                                               
         GOTO1 GETPROD             READ IN PRODUCT RECORD                       
*                                                                               
         LA    RE,PPRDELEM         POINT TO FIRST ELEMENT                       
         SR    RF,RF                                                            
*                                                                               
PRAG16LP DS    0H                  FIND PLANNED COST EFFECTIVE DATE             
*                                                                               
         USING PPRDBPCE,RE         ESTABLISH EFFECTIVE DATE ELM                 
*                                                                               
         CLI   PPBPCELC,0          DONE AT END OF RECORD                        
         BE    PRAG16DN                                                         
*                                                                               
         CLI   PPBPCELC,PPBPCECQ   SKIP IF NOT EFF DTE ELM                      
         BNE   PRAG16CN                                                         
*                                                                               
         B     PRAG16FD            ELEMENT FOUND                                
*                                                                               
PRAG16CN DS    0H                                                               
         IC    RF,PPBPCELN         GET ELEMENT LENGTH                           
         LA    RE,PPBPCELC(RF)     BUMP TO NEXT ELEMENT                         
         B     PRAG16LP                                                         
*                                                                               
PRAG16FD DS    0H                                                               
*                                                                               
         MVC   SVPRDEFD,PPBPCEFF   SAVE PLANNED COST BILLING                    
*                                                                               
PRAG16DN DS    0H                                                               
*                                                                               
PRAG168  DS    0H                                                               
*                                                                               
         MVC   KEY(64),WORK        RESTORE KEY                                  
*                                                                               
         GOTO1 HIGH                RESTORE FILE POINTERS                        
*                                                                               
         DROP  RE                                                               
*                                                                               
PRAG169  DS    0H                                                               
*                                                                               
         BRAS  RE,BLDELST          BUILD ESTIMATE LIST                          
*                                                                               
PRAG17   DS    0H                                                               
*                                                                               
         CLI   BUYOPT,C'B'         SEE IF READING BUYS                          
         BE    PRAG19C                                                          
*                                  PROCESS BUCKET RECORD                        
         MVI   CLTACT,C'Y'                                                      
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,3,KEY+10         EST                                          
         A     RF,AESTLST                                                       
         TM    0(RF),X'80'         IS IT A TEST EST                             
         BNZ   PRAG4                                                            
*                                                                               
PRAG17D  DS    0H                                                               
         L     RF,ACONIO1          READ BUCKET INTO CONREC AREA                 
         ST    RF,AREC                                                          
         GOTO1 GETPRT                                                           
         SPACE 1                                                                
*                                                                               
*                                                                               
PRAG18   DS    0H                                                               
         GOTO1 AADDUP                                                           
         B     PRAG4                                                            
*                                                                               
PRAG19   EQU   *                                                                
         XC    KEY,KEY                                                          
         MVC   KEY(7),PCLTKEY                                                   
         MVI   KEY+3,X'20'                                                      
         B     PRAG2                                                            
*                                                                               
PRAG19C  EQU   *                                                                
         OC    KEY+21(3),KEY+21    TEST POL PASSIVE                             
         BNZ   PRAG4                                                            
         MVI   CLTACT,C'Y'                                                      
*                                                                               
PRAG19H  DS    0H                                                               
         GOTO1 GETBUY                                                           
***TEST                                                                         
         CLI   TSTOPT,C'T'       SEE IF INCLUDING TEST BUYS                     
         BE    PRAG19I                                                          
         CLI   PBDBFD,C'T'       EXCLUDE TEST BUYS ON LIVE ESTS                 
         BE    PRAG4                                                            
***TEST                                                                         
PRAG19I  SR    R2,R2                                                            
         CLI   OPNOPT,C'O'   TEST DOING OPEN RATES                              
         BNE   *+8                                                              
         LA    R2,C'O'                                                          
         GOTO1 GETINS,DMCB,PBUYKEY,((R2),GROSS),PBUYKPRD,0,0,0                  
         GOTO1 AADDUP                                                           
         B     PRAG4                                                            
*                                                                               
PRAG20   EQU   *                                                                
         XC    LASTOFF,LASTOFF                                                  
         MVC   MID1,SPACES                                                      
         MVC   MID1(13),=C'AGENCY TOTALS'                                       
         MVI   FORCEMID,C'Y'                                                    
*                                                                               
         CLI   QOPT7,C'P'                                                       
         BNE   PRAG22                                                           
*                                  SAVE AGYNAME & TOTS                          
*                                            WRITE FROM AGYTOTS                 
         GOTO1 AWFMOD,DMCB,=C'WA',AAGYTOTS                                      
*                                                                               
PRAG22   EQU   *                                                                
*                                                                               
         CLI   QOPT2,C'R'          SEE IF REQUESTED P49                         
         BE    PRAG22C             DON'T ADD TO DDSTOTS                         
*                                                                               
         L     R2,AAGYTOTS                                                      
         L     R3,ADDSTOTS                                                      
         BAS   RE,ROLLUP           ADD TO CROSS MEDIA TOTALS                    
*                                                                               
PRAG22C  CLI   QCLIENT,C'*'                                                     
         BNE   PRAG23                                                           
         CLI   QCLIENT+2,C' '         BYPASS AGY TOTS IF ONLY 1 OFFICE          
         BNE   PRAG23C                                                          
         CLI   QCLIENT+1,C' '                                                   
         BNE   PRAG24                                                           
         B     PRAG23C                                                          
*                                                                               
PRAG23   DS    0H                                                               
         CLI   QCLIENT,C'$'          SEE IF OFFICE LIST REQUEST                 
         BE    PRAG23C                                                          
*                                                                               
         CLC   QCLIENT,=C'ALL'                                                  
         BNE   PRAG24           SKIP AGY TOTS FOR ONE CLIENT REQUEST            
PRAG23C  DS    0H                                                               
         GOTO1 APRNT,DMCB,AAGYTOTS                                              
*                                                                               
PRAG24   DS    0H                                                               
         CLI   QOPT3,C'1'                                                       
         BE    PRAG30                                                           
         B     PRAGX                                                            
*                                                                               
*                                                                               
PRAG30   DS    0H                                                               
         MVC   MID1(13),=C'AGENCY TOTALS'                                       
         CLI   QCLIENT,C'*'                                                     
         BNE   PRAG31                                                           
         CLI   QCLIENT+2,C' '      TEST                                         
         BNE   PRAG31                  ONLY                                     
         CLI   QCLIENT+1,C' '              ONE OFFICE                           
         BE    PRAG31              NO                                           
         MVC   MID1(6),=C'OFFICE'                                               
PRAG31   DS    0H                                                               
         MVC   SVMEDNM,PAGYMED                                                  
         MVC   SVMEDCD,PAGYKMED                                                 
         MVC   PAGYMED,=C'ALL MEDIA '                                           
         MVI   PAGYKMED,C' '                                                    
         MVI   FORCEHED,C'Y'                                                    
         GOTO1 APRNT,DMCB,ADDSTOTS                                              
         CLI   QOPT3,C'2'                                                       
         BE    PRAG32                                                           
*                                                                               
         CLI   QOPT7,C'P'                                                       
         BNE   PRAG32                                                           
         MVI   PAGYKMED,C'Z'                                                    
         GOTO1 AWFMOD,DMCB,=C'WA',ADDSTOTS                                      
*                                                                               
PRAG32   DS    0H                                                               
         MVC   PAGYMED,SVMEDNM                                                  
         MVC   PAGYKMED,SVMEDCD                                                 
         L     R2,ADDSTOTS         CLEAR DDSTOTS AFTER PRINT                    
         BAS   RE,CLEAR                                                         
*                                                                               
PRAGX    EQU   *                                                                
         MVC   OLDKEY,QAGENCY                                                   
         MVI   FORCEHED,C'Y'                                                    
         MVI   FCRDCLOS,C'N'       MUST RESET TO N                              
         XIT1                                                                   
         SPACE 3                                                                
         EJECT                                                                  
DDSSUM   NTR1                                                                   
         SPACE 2                                                                
*                                  SET DDS IN AGYHDR                            
         MVC   PAGYNAME,=CL33'DONOVAN DATA SYSTEMS, INC.'                       
         MVC   PAGYADDR,SPACES                                                  
         MVC   PAGYADDR(26),=C'*PRNTNN* DDS AGENCY SUMMARY'                     
         MVC   PAGYADDR+5(2),SYSNAID                                            
         MVC   PAGYABBR,=CL7'DDSPNN'                                            
         MVC   PAGYABBR+4(2),SYSNAID                                            
         XC    LASTOFF,LASTOFF                                                  
*                                                                               
         SPACE 1                                                                
DDSSUM1  DS    0H                                                               
         MVI   CURMED,C'I'         START WITH MEDIA I                           
         MVI   PAGYKMED,C'I'                                                    
DDSSUM2  DS    0H                                                               
         XC    WFID,WFID                                                        
DDSSUM2B DS    0H                                                               
         GOTO1 AWFMOD,DMCB,=C'RA'                                               
*                                                                               
         CLI   HLDAGYN,X'FF'       END OF MEDIA                                 
         BNE   DDSSUM8                                                          
         MVC   MID1,SPACES                                                      
         MVC   MID1(10),=C'DDS TOTALS'                                          
         MVI   FORCEMID,C'Y'                                                    
         GOTO1 APRNT,DMCB,ADDSTOTS                                              
*                                                                               
         CLI   CURMED,C'Z'                                                      
         BE    EXIT                                                             
         CLI   CURMED,C'T'                                                      
         BNE   *+12                                                             
         MVI   CURMED,C'Z'                                                      
         B     DDSS4                                                            
         CLI   CURMED,C'S'                                                      
         BNE   *+12                                                             
         MVI   CURMED,C'T'                                                      
         B     DDSS4                                                            
         CLI   CURMED,C'O'                                                      
         BNE   *+12                                                             
         MVI   CURMED,C'S'                                                      
         B     DDSS4                                                            
         CLI   CURMED,C'N'                                                      
         BNE   *+12                                                             
         MVI   CURMED,C'O'                                                      
         B     DDSS4                                                            
         CLI   CURMED,C'M'                                                      
         BNE   *+12                                                             
         MVI   CURMED,C'N'                                                      
         B     DDSS4                                                            
         CLI   CURMED,C'L'          IF I JUST DID L                             
         BNE   *+12                                                             
         MVI   CURMED,C'M'          SET TO M                                    
         B     DDSS4                                                            
         CLI   CURMED,C'I'          IF I JUST DID I                             
         BNE   *+12                                                             
         MVI   CURMED,C'L'          SET TO L                                    
         B     DDSS4                                                            
*                                                                               
         DC    H'0'                                                             
DDSS4    DS    0H                                                               
         MVC   PAGYKMED,CURMED                                                  
         CLI   PAGYKMED,C'Z'                                                    
         BNE   *+8                                                              
         MVI   PAGYKMED,C' '                                                    
         MVI   FORCEHED,C'Y'                                                    
         L     R2,ADDSTOTS         CLEAR DDSTOTS                                
         BAS   RE,CLEAR                                                         
         B     DDSSUM2                                                          
DDSSUM8  DS    0H                                                               
         L     R2,ACLTTOTS                                                      
         L     R3,ADDSTOTS                                                      
         BAS   RE,ROLLUP                                                        
         MVC   MID1,SPACES                                                      
         MVC   MID1(2),HLDAGYC       AGY                                        
         MVC   PAGYMED,HLDMEDN                                                  
         MVC   MID1+4(33),HLDAGYN AGENCY NAME                                   
         MVI   FORCEMID,C'Y'                                                    
         MVI   RCSUBPRG,30                                                      
DDSSUM8B DS    0H                                                               
         GOTO1 APRNT,DMCB,ACLTTOTS                                              
*                                                                               
         CLI   PAGYKMED,C' '                                                    
         BNE   *+8                                                              
         MVI   PAGYKMED,C'Z'                                                    
         B     DDSSUM2B                                                         
         SPACE 2                                                                
DDSSUM10 EQU   *                                                                
         B     EXIT                                                             
*                                                                               
         TITLE 'PP049-02  PRINTPAK AGENCY SUMMARY'                              
         SPACE 3                                                                
CRDERR   EQU   *                                                                
         MVC   P(80),QRECORD                                                    
         MVC   P+85(15),=C'INVALID REQUEST'                                     
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 REPORT                                                           
         SPACE 1                                                                
         DC    H'0'                                                             
         EJECT                                                                  
*                                  BUMP NM AT 0(R2)                             
*                                  PUT NEW YM AT 2(R2)                          
         SPACE 2                                                                
MNTHUP   EQU   *                                                                
         LH    R0,0(R2)                                                         
         LA    R1,1                                                             
         CLI   1(R2),12            DEC                                          
         BNE   *+8                                                              
         LA    R1,245                                                           
         AR    R0,R1                                                            
         STH   R0,2(R2)                                                         
         LA    R2,2(R2)                                                         
         BR    RE                                                               
         SPACE 2                                                                
*                                  BACK UP YM AT 0(R2)                          
*                                  PUT NEW YM AT -2(R2)                         
         SPACE 2                                                                
MNTHBACK EQU   *                                                                
         BCTR  R2,R0                                                            
         BCTR  R2,R0                                                            
         LH    R0,2(R2)                                                         
         LA    R1,1                                                             
         CLI   3(R2),1             JAN                                          
         BNE   *+8                                                              
         LA    R1,245                                                           
         SR    R0,R1                                                            
         STH   R0,0(R2)                                                         
         BR    RE                                                               
         SPACE 2                                                                
         SPACE 3                                                                
*                                  ROLL ACCUM AT R2                             
*                                  TO ACCUM AT R3                               
ROLLUP   EQU   *                                                                
         LA    R0,ACCN*2                                                        
ROLLUP2  AP    0(7,R3),0(7,R2)                                                  
         LA    R2,7(R2)                                                         
         LA    R3,7(R3)                                                         
         BCT   R0,ROLLUP2                                                       
         BR    RE                                                               
         SPACE 3                                                                
*                                  SET PRIOR & SUBSEQUENT                       
SETSW    EQU   *                                                                
         MVI   CDSW,1                                                           
         CLI   QOPT4,C'C'                                                       
         BE    *+8                                                              
         MVI   CDSW,0                                                           
         MVI   PRIOR,0                                                          
         MVI   SUBSQ,0                                                          
         CLI   QOPT1,C' '                                                       
         BCR   8,RE                                                             
         CLI   QOPT1,C'P'                                                       
         BE    SETSW2                                                           
         MVI   SUBSQ,1                                                          
         CLI   QOPT1,C'S'                                                       
         BCR   8,RE                                                             
SETSW2   MVI   PRIOR,1                                                          
         BR    RE                                                               
         SPACE 3                                                                
*                                  ZAP  AREA AT R2                              
         SPACE 2                                                                
CLEAR    EQU   *                                                                
         LA    R3,ACCN*2           NUMBER                                       
         ZAP   0(ACMACML,R2),=P'0'                                              
         LA    R2,ACMACML(R2)                                                   
         BCT   R3,*-10                                                          
         BR    RE                                                               
         EJECT                                                                  
*                                                                               
         SPACE 3                                                                
         LTORG                                                                  
ACONS    DS    0F                                                               
         DC    A(CLTTOTS)                                                       
         DC    A(AGYTOTS)                                                       
         DC    A(DDSTOTS)                                                       
         DC    A(WRKTOTS)                                                       
         DC    A(OFFTOTS)                                                       
         DC    A(AGYNAMS)                                                       
         DC    A(CLTTAB)                                                        
         DC    A(ESTLST)                                                        
         DC    A(ACTDTES)                                                       
         DC    A(PP49WFM)                                                       
         DC    A(PRNT)                                                          
         DC    A(WRKRBUFF)                                                      
         DC    A(ADDUP)                                                         
ACONX    EQU   *                                                                
*                                                                               
         TITLE 'PP049-02  PRINTPAK AGENCY SUMMARY - BLDELST'                    
***********************************************************************         
*                                                                     *         
*        BLDELST- BUILD ESTIMATE LISTS                                *         
*              TABLES OF LIVE/TEST STATUS AND ACTUALIZATION DATES     *         
*                                                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
BLDELST  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     RE,AESTLST          CLEAR EST LIST                               
         LA    RF,1000                                                          
         XCEF                                                                   
*                                                                               
         L     RE,AACTDTES         CLEAR ACTUALIZATION DATES                    
         LA    RF,4000                                                          
         XCEF                                                                   
*                                                                               
         MVC   WORK(64),KEY        SAVE CURRENT KEYS                            
         XC    KEY+10(15),KEY+10   LEAVE A/M/C/P                                
         MVI   KEY+3,7             STARTING KEY FOR ESTREC READS                
*                                                                               
         GOTO1 HIGH                READ 1ST EST FOR PRD                         
*                                                                               
BELLOOP  DS    0H                                                               
*                                                                               
         CLC   KEY(10),KEYSAVE     TEST THRU PRODUCT                            
         BNE   BELDONE                                                          
*                                                                               
         GOTO1 GETEST              READ IN ESTIMATE RECORD                      
*                                                                               
BELTEST  DS    0H                                                               
*                                                                               
         CLI   TSTOPT,C'T'         SKIP IF INCLUDING TEST ESTIMATES             
         BE    BELTESTX                                                         
*                                                                               
         TM    PESTTEST,X'80'      SKIP IF NOT A TEST ESTIMATE                  
         BZ    BELTESTX                                                         
*                                                                               
         LH    RF,KEY+10           GET ESTIMATE NUMBER                          
*                                                                               
         CH    RF,=H'999'          ESTIMATE NUMBER TOO LARGE                    
         BH    BELTESTX                                                         
*                                                                               
         A     RF,AESTLST          INDEX INTO TABLE                             
         OI    0(RF),X'80'         SET AS TEST EST                              
*                                                                               
BELTESTX DS    0H                                                               
*                                                                               
*        SAVE ACTUALIZATION DATES IF PLANNED COST ESTIMATE                      
*                                                                               
BELADTS  DS    0H                                                               
*                                                                               
         CLI   OPNOPT,C'P'         SKIP IF NOT DOING PLANNED COSTS              
         BE    *+8                                                              
         CLI   OPNOPT,C'B'                                                      
         BNE   BELADTSX                                                         
*                                                                               
         CLI   B2BPROF+12,C'Y'     SKIP IF CLIENT NOT DOING PC BILLING          
         BNE   BELADTSX                                                         
*                                                                               
         LH    RF,KEY+10           GET ESTIMATE NUMBER                          
*                                                                               
         CH    RF,=H'999'          ESTIMATE NUMBER TOO LARGE                    
         BH    BELADTSX                                                         
**HOLD** MHI   RF,4                   CALCULATE INDEX INTO TABLE                
*                                                                               
         A     RF,AACTDTES         INDEX INTO TABLE                             
*                                                                               
         LA    R1,PESTELEM         POINT TO FIRST ELEMENT IN ESTREC             
         SR    RE,RE                                                            
*                                                                               
BELADTLP DS    0H                                                               
*                                                                               
         CLI   0(R1),0             DONE AT END OF RECORD                        
         BE    BELADTDN                                                         
*                                                                               
         USING PESTBPCE,R1         ESTABLISH PLANNED COST EFF DATE ELM          
*                                                                               
         CLI   PEBPCELC,PEBPCECQ   SKIP IF NOT EFF DATE ELM                     
         BNE   BELADT10                                                         
*                                                                               
         MVC   0(2,RF),PEBPCEFF    SAVE PC BILLING EFFECTIVE DATE               
*                                                                               
         B     BELADTCN                                                         
*                                                                               
BELADT10 DS    0H                                                               
*                                                                               
*        FIND ACTUALIZATION DATE                                                
*                                                                               
         USING PESTACTD,R1         ESTABLISH PC ACTUALIZATION DATE ELM          
*                                                                               
         CLI   PEACTELC,PEACTECQ   SKIP IF NOT ACT DATE ELM                     
         BNE   BELADT20                                                         
*                                                                               
         MVC   2(2,RF),PEACTDAT    SAVE ACTUALIZATION DATE                      
*                                                                               
         B     BELADTCN                                                         
*                                                                               
BELADT20 DS    0H                                                               
*                                                                               
         DROP  R1                                                               
*                                                                               
BELADTCN DS    0H                                                               
         IC    RE,1(R1)            GET ELEMENT LENGTH                           
         LA    R1,0(RE,R1)         BUMP TO NEXT ELEMENT                         
         B     BELADTLP                                                         
*                                                                               
BELADTDN DS    0H                                                               
*                                                                               
         OC    0(2,RF),0(RF)       IF NO EST OVERRIDE OF EFF DTE                
         BNZ   *+10                                                             
         MVC   0(2,RF),SVPRDEFD       USE PRODUCT'S OVERRIDE                    
*                                                                               
         OC    0(2,RF),0(RF)       IF NO OVERRIDE OF EFF DTE                    
         BNZ   BELADTSX                                                         
*                                                                               
         MVC   0(2,RF),B2BPROF+13     USE CLIENT'S FROM B2B PROFILE             
*                                                                               
         OC    0(2,RF),0(RF)          SKIP IF NONE                              
         BZ    BELADTSX                                                         
*                                                                               
         CLI   0(RF),80               SET CENTURY                               
         BNL   BELADTSX                                                         
*                                                                               
         SR    RE,RE                                                            
         IC    RE,0(RF)                                                         
         AHI   RE,100                                                           
         STC   RE,0(RF)               21ST CENTURY                              
*                                                                               
BELADTSX DS    0H                                                               
*                                                                               
BELCONT  DS    0H                                                               
         GOTO1 SEQ                 READ NEXT ESTIMATE KEY                       
         B     BELLOOP                                                          
*                                                                               
BELDONE  DS    0H                                                               
*                                                                               
         MVC   KEY,WORK            RESTORE SEQ                                  
         GOTO1 HIGH                                                             
         MVC   KEYSAVE,WORK+32                                                  
*                                                                               
BLDELSTX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         TITLE 'PP049-02  PRINTPAK AGENCY SUMMARY - PRNT'                       
***********************************************************************         
*                                                                     *         
*        PRINT ROUTINE                                                *         
*                                                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
PRNT     CSECT                                                                  
         NMOD1 0,PRNT                                                           
         SPACE 2                                                                
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP49WRKD,R8                                                      
         SPACE 2                                                                
*                                 R2 = A(ACCUM)                                 
         MVI   STAGSW,C'Y'                                                      
         L     R2,0(R1)                                                         
*                                                                               
         USING ACMD,R2             ESTABLISH ACCUMULATORS                       
*                                                                               
         L     RF,AAGYTOTS                                                      
         CR    R2,RF                                                            
         BE    PRNT0                                                            
*                                                                               
         L     RF,AOFFTOTS                                                      
         CR    R2,RF                                                            
         BE    PRNT0                                                            
*                                                                               
         L     RF,ADDSTOTS                                                      
         CR    R2,RF                                                            
         BE    PRNT0                                                            
*                                                                               
         CLC   QAGENCY,=C'ZZ'     CROSS AGENCY RUN?                             
         BNL   *+8                                                              
         MVI   STAGSW,C'N'                                                      
*                                                                               
PRNT0    DS    0H                                                               
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         IC    RF,LINE                                                          
         IC    RE,MAXLINES                                                      
         SR    RE,RF                                                            
*                                                                               
         CH    RE,=H'6'                                                         
         BH    *+8                                                              
         MVI   FORCEHED,C'Y'       NEW PAGE NEEDED                              
*                                                                               
         CLI   CDSW,0              IF SUPPRESSING CD                            
         BE    *+8                                                              
         LA    R2,ACCL(R2)            USE SECOND SET OF BUCKETS                 
*                                                                               
         ST    R2,SAVR2                                                         
*                                                                               
         BAS   RE,ROLLDOWN         ADD TO TOTAL ROW                             
*                                  AND MOVE TO WORK AREA                        
         L     R2,AWRKTOTS                                                      
         LA    R2,ROWL(R2)         POINT TO FIRST MO ROW                        
         LA    R3,MLIST                                                         
         MVI   TOTSW,0                                                          
*                                                                               
PRNT2    EQU   *                                                                
*                                                                               
         MVC   HLDDAT,SPACES                                                    
         MVC   HLDPCT,SPACES                                                    
*                                                                               
PRNT6    EQU   *                                                                
*                                                                               
         CLC   0(2,R3),=C'AM'                                                   
         BNE   PRNT7                                                            
*                                                                               
         MVC   HLDDAT(5),=C'TOTAL'                                              
         MVI   TOTSW,1                                                          
*                                                                               
         LA    R2,ROWL(R2)         BUMP TO TOTAL ROW                            
         B     PRNT10                                                           
*                                                                               
PRNT7    EQU   *                                                                
*                                                                               
         CLC   0(2,R3),=C'MG'                                                   
         BL    PRNT7A                                                           
         CLC   0(2,R3),=C'TG'                                                   
         BNE   *+8                                                              
         BAS   RE,REPRT            SKIP A LINE                                  
*                                                                               
         CLI   QOPT5,C'S'                                                       
         BNE   PRNT21                                                           
*                                                                               
         MVI   TOTSW,0                                                          
         B     PRNT10                                                           
*                                                                               
PRNT7A   DS    0H                                                               
*                                                                               
         GOTO1 DATCON,DMCB,(3,0(R3)),(6,HLDDAT)                                 
*                                                                               
         CLC   0(2,R3),BSTART                                                   
         BNE   PRNT8                                                            
*                                  CHECK PRIOR                                  
         CLI   PRIOR,0                                                          
         BE    PRNT10                                                           
*                                  CHECK PRIOR                                  
         LA    R0,ACMDN            NUMBER OF ACCUMULATORS                       
         L     R5,AWRKTOTS         POINT TO PRIOR ROW                           
         LR    RF,R2                                                            
         MVI   BYTE,0                                                           
*                                                                               
PRNT7B   EQU   *                                                                
*                                                                               
         CP    0(ACMACML,R5),=P'0'                                              
         BE    PRNT7D                                                           
*                                                                               
         AP    0(ACMACML,RF),0(ACMACML,R5)                                      
         MVI   BYTE,1                                                           
*                                                                               
PRNT7D   EQU   *                                                                
*                                                                               
         LA    R5,ACMACML(R5)                                                   
         LA    RF,ACMACML(RF)                                                   
         BCT   R0,PRNT7B                                                        
*                                                                               
         CLI   BYTE,0                                                           
         BE    *+16                                                             
         MVC   HLDDAT(6),PSTART                                                 
         MVC   HLDDAT+6(2),=C'+P'                                               
*                                                                               
PRNT8    EQU   *                                                                
*                                                                               
         CLC   0(2,R3),BEND                                                     
         BNE   PRNT10                                                           
*                                  CHECK SUBSQ                                  
         CLI   SUBSQ,0                                                          
         BE    PRNT10                                                           
*                                                                               
         LA    R0,ACMDN            NUMBER OF ACCUMULATORS                       
         LR    R5,R2                                                            
         L     R6,AWRKTOTS                                                      
         LA    R6,(NMOS+1)*ROWL(R6)     SUBSQ ROW                               
         MVI   BYTE,0                                                           
*                                                                               
PRNT8B   EQU   *                                                                
*                                                                               
         CP    0(ACMACML,R6),=P'0'                                              
         BE    PRNT8D                                                           
         AP    0(ACMACML,R5),0(ACMACML,R6)                                      
         MVI   BYTE,1                                                           
PRNT8D   EQU   *                                                                
         LA    R5,ACMACML(R5)                                                   
         LA    R6,ACMACML(R6)                                                   
         BCT   R0,PRNT8B                                                        
*                                                                               
         CLI   BYTE,0                                                           
         BE    *+16                                                             
         MVC   HLDDAT(6),PEND                                                   
         MVC   HLDDAT+6(2),=C'+S'                                               
*                                                                               
PRNT10   EQU   *                   DO PCT PAID                                  
*                                  CHECK ANY TO PRINT                           
         CLC   0(2,R3),=C'AM'                                                   
         BE    PRNT10D                                                          
*                                                                               
         LR    R5,R2                                                            
         LA    R0,ACMDN            NUMBER OF ACCUMULATORS                       
*                                                                               
PRNT10B  EQU   *                                                                
*                                                                               
         CP    0(ACMACML,R5),=P'0'                                              
         BNE   PRNT10D                                                          
*                                                                               
         LA    R5,ACMACML(R5)                                                   
         BCT   R0,PRNT10B                                                       
         B     PRNT21              NONE                                         
*                                                                               
PRNT10D  EQU   *                                                                
*                                  PCT PAID                                     
         MVC   HLDPCT,SPACES       INIT PRINT AREA                              
*                                                                               
         ZAP   DUBDUB,ACMPAID      PAID                                         
         BZ    PRNT12              NOTHING PAID                                 
*                                                                               
         MP    DUBDUB,=P'10000'                                                 
         ZAP   WORK(ACMACML),ACMGRSBM BILLING MO GROSS                          
*                                                                               
         CLI   CDSW,0                                                           
         BNE   *+10                                                             
         SP    WORK(ACMACML),ACMCD LESS CD                                      
*                                                                               
         CP    WORK(ACMACML),=P'0'                                              
         BE    PRNT12                                                           
*                                                                               
         DP    DUBDUB,WORK(ACMACML)                                             
         AP    DUBDUB(9),=P'5'                                                  
         MVO   DUBDUB(9),DUBDUB(8)                                              
*                                                                               
         CP    DUBDUB(9),=P'0'                                                  
         BE    PRNT12                                                           
*                                                                               
         LA    R1,DUBDUB+6                                                      
         EDIT  (P3,0(R1)),(5,HLDPCT),1                                          
*                                                                               
PRNT12   EQU   *                                                                
*                                                                               
         LA    R4,P                                                             
*                                                                               
PM       EQU   *                                                                
*                                                                               
         USING MLINED,R4           ESTABLISH PRINT LINES                        
*                                                                               
         MVC   MDATE(8),HLDDAT     MOVE DATE + P OR S                           
         MVC   MPCT,HLDPCT                                                      
*                                                                               
         CLI   STAGSW,C'Y'         MUST MOVE PCT OVER 1 BYTE                    
         BNE   PM1                 IF STAGSW = 'Y' AND TOTSW = 1                
         CLI   TOTSW,1                                                          
         BNE   PM1                                                              
*                                                                               
         MVC   MPCT,SPACES         PRINT PERCENT ON 2ND LINE                    
         MVC   TPCT,HLDPCT                                                      
*                                                                               
PM1      DS    0H                                                               
*                                                                               
         LA    R5,ACMGRSIM         INSERTION MONTH GROSS                        
*                                                                               
         CLI   OPNOPT,C'P'         IF PLANNED COSTS REPORT                      
         BE    *+8                                                              
         CLI   OPNOPT,C'B'                                                      
         BNE   *+8                                                              
         LA    R5,ACMPCGIM            USE PC/ORDERED DATA                       
*                                                                               
         LA    R6,MINORD           INS MO GROSS                                 
         BAS   RE,EDIT                                                          
*                                                                               
         LA    R5,ACMGRSBM         BILLED MONTH GROSS                           
*                                                                               
         CLI   OPNOPT,C'P'         IF PLANNED COSTS REPORT                      
         BE    *+8                                                              
         CLI   OPNOPT,C'B'                                                      
         BNE   *+8                                                              
         LA    R5,ACMPCGBM            USE PC/ORDERED DATA                       
*                                                                               
         LA    R6,MBLORD           BILL MON GROSS                               
*                                                                               
         CLI   STAGSW,C'Y'                                                      
         BNE   PM2                                                              
*                                                                               
         CLI   TOTSW,1                                                          
         BNE   *+8                                                              
         LA    R6,TBLORD                                                        
*                                                                               
PM2      BAS   RE,EDIT                                                          
*                                                                               
         LA    R5,ACMCD            CASH DISCOUNT                                
*                                                                               
         CLI   OPNOPT,C'P'         IF PLANNED COSTS REPORT                      
         BE    *+8                                                              
         CLI   OPNOPT,C'B'                                                      
         BNE   *+8                                                              
         LA    R5,ACMPCCD             USE PC/ORDERED DATA                       
*                                                                               
         CP    0(ACMACML,R5),=P'0'                                              
         BE    PM4                                                              
         CLI   STAGSW,C'Y'                                                      
         BNE   PM2D                                                             
         CLI   TOTSW,1                                                          
         BNE   PM2D                                                             
*                                  IF STAGGERING TOTALS                         
*                                  I CAN DISPLAY NORMALLY                       
         EDIT  (P7,0(R5)),(15,MCD-3),2,COMMAS=YES,FLOAT=-                       
         MVI   MCD+12,C'*'                                                      
         B     PM4                                                              
*                                                                               
PM2D     EDIT  (P7,0(R5)),(13,WORK),2,COMMAS=YES,FLOAT=-                        
         CLI   WORK,C' '                                                        
         BE    PM3                                                              
*                                                                               
         MVC   WORK+2(1),WORK+1                                                 
         MVC   WORK+1(1),WORK                                                   
*                                                                               
PM3      DS    0H                                                               
*                                                                               
         MVC   MCD+1(11),WORK+2                                                 
*                                                                               
         CLI   WORK+1,C' '         DONT CLOBBER * WITH SPACE                    
         BE    *+10                                                             
         MVC   MCD(1),WORK+1                                                    
*                                                                               
         CLI   TOTSW,1                                                          
         BNE   *+8                                                              
         MVI   MCD+12,C'*'                                                      
*                                                                               
PM4      EQU   *                                                                
*                                                                               
         ZAP   WORK(ACMACML),ACMGRSBM                                           
         SP    WORK(ACMACML),ACMCD                                              
*                                                                               
         CLI   OPNOPT,C'P'         IF PLANNED COSTS REPORT                      
         BE    *+8                                                              
         CLI   OPNOPT,C'B'                                                      
         BNE   *+16                                                             
         ZAP   WORK(ACMACML),ACMPCGBM                                           
         SP    WORK(ACMACML),ACMPCCD                                            
*                                                                               
         LA    R5,WORK                                                          
         LA    R6,MNET             GROSS LESS CD                                
*                                                                               
         CLI   STAGSW,C'Y'                                                      
         BNE   PM4C                                                             
*                                                                               
         CLI   TOTSW,1                                                          
         BNE   *+8                                                              
         LA    R6,TNET                                                          
*                                                                               
PM4C     BAS   RE,EDIT                                                          
*                                                                               
         LA    R5,ACMPAID                                                       
         LA    R6,MPD              PAID                                         
         BAS   RE,EDIT                                                          
*                                                                               
         CLC   0(2,R3),=C'MG'                                                   
         BNL   PM6                                                              
*                                                                               
         ZAP   WORK(ACMACML),ACMGRSBM                                           
*                                                                               
         CLI   CDSW,0                                                           
         BNE   *+10                                                             
         SP    WORK(ACMACML),ACMCD       LESS C.D.                              
*                                                                               
         SP    WORK(ACMACML),ACMPAID                                            
         LA    R5,WORK                                                          
         LA    R6,MUNPD            UNPAID                                       
*                                                                               
         CLI   STAGSW,C'Y'                                                      
         BNE   PM5                                                              
*                                                                               
         CLI   TOTSW,1                                                          
         BNE   *+8                                                              
         LA    R6,TUNPD                                                         
*                                                                               
PM5      BAS   RE,EDIT                                                          
*                                                                               
PM6      DS    0H                                                               
*                                                                               
         LA    R5,ACMBLD                                                        
         LA    R6,MBLD             BILLED                                       
         BAS   RE,EDIT                                                          
*                                                                               
         CLC   0(2,R3),=C'MG'                                                   
         BNL   PM8                                                              
*                                                                               
         ZAP   WORK(ACMACML),ACMGRSBM                                           
*                                                                               
         CLI   CDSW,0                                                           
         BNE   *+10                                                             
         SP    WORK(ACMACML),ACMCD       LESS C.D.                              
*                                                                               
         SP    WORK(ACMACML),ACMBLD                                             
         LA    R5,WORK                                                          
         LA    R6,MUNBLD           UNBILLED                                     
*                                                                               
         CLI   STAGSW,C'Y'                                                      
         BNE   PM7                                                              
*                                                                               
         CLI   TOTSW,1                                                          
         BNE   *+8                                                              
         LA    R6,TUNBLD                                                        
*                                                                               
PM7      BAS   RE,EDIT                                                          
*                                                                               
PM8      DS    0H                                                               
         B     PRNT20                                                           
         DROP  R4                                                               
*                                                                               
PRNT20   EQU   *                                                                
         CLC   0(2,R3),=C'MG'      SPECIAL TOTAL                                
         BL    PRNT20B                                                          
         MVC   P(13),=C'TODAY        '                                          
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+10                                                             
         MVC   P+6(7),=C'(GROSS)'                                               
*                                                                               
         CLC   0(2,R3),=C'TG'                                                   
         BE    PRNT20B                                                          
         MVC   P(13),=C'TODAY (NET)  '                                          
         CLC   0(2,R3),=C'TN'                                                   
         BE    PRNT20B                                                          
         MVC   P(13),=C'MONTH        '                                          
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+10                                                             
         MVC   P+6(7),=C'(GROSS)'                                               
*                                                                               
         CLC   0(2,R3),=C'MG'                                                   
         BE    PRNT20B                                                          
         MVC   P(13),=C'MONTH (NET)  '                                          
*                                                                               
PRNT20B  DS    0H                                                               
         BAS   RE,REPRT                                                         
*                                                                               
PRNT21   DS    0H                                                               
         CLC   0(2,R3),=C'MN'      END                                          
         BE    PRNT24                                                           
*                                                                               
PRNT22   EQU   *                                                                
*                                                                               
         LA    R3,2(R3)            BUMP MONTH                                   
         LA    R2,ROWL(R2)                                                      
*                                                                               
         CLI   0(R3),0             END OF BUCKETS                               
         BE    PRNT24                                                           
         B     PRNT2                                                            
*                                                                               
PRNT24   DS    0H                                                               
*                                                                               
         BAS   RE,REPRT            SKIP A LINE                                  
*                                                                               
         CLI   BUYOPT,C'B'         SEE IF DOING BUYS                            
         BNE   PRNTX               NO - CAN'T CHK SUM VS. DETAIL ITEMS          
*                                  CHECK SUM VS DETAIL ITEMS                    
         L     R2,AWRKTOTS                                                      
         CP    ACCL-ROWL(ACMACML,R2),ACCL-ROWL+ACMACML(ACMACML,R2)              
         BE    PRNT26                                                           
*                                                                               
         MVC   P(L'SUMMSG),SUMMSG                                               
         BAS   RE,REPRT                                                         
         BAS   RE,REPRT                                                         
*                                                                               
PRNT26   EQU   *                                                                
         B     PRNTX                                                            
*                                                                               
PRNTX    EQU   *                                                                
         XIT1                                                                   
         SPACE 3                                                                
*                                  ADD TO TOTAL ROW                             
*                                  AND MOVE TO WORK AREA                        
ROLLDOWN NTR1                                                                   
         SPACE 2                                                                
         OC    QPAY(4),=4C'0'                                                   
         PACK  DUB,QPAY(2)         MONTHS BACK                                  
         CVB   R5,DUB                                                           
*                                                                               
         LA    R0,36                                                            
         CLI   QEND,C' '          SEE IF DATE REQUESTED                         
         BE    *+8                                                              
         LA    R0,1                                                             
         SR    R5,R0                                                            
         BNP   *+6                                                              
         SR    R5,R5                                                            
         LCR   R5,R5                                                            
         SLL   R5,1                                                             
         LA    R3,MLIST(R5)                                                     
*                                                                               
         GOTO1 DATCON,DMCB,(3,0(R3)),(6,PSTART)                                 
*                                                                               
         MVC   BSTART,0(R3)                                                     
         SRL   R5,1                                                             
         MH    R5,=Y(ROWL)                                                      
         LA    R5,ROWL(R2,R5)                                                   
         ST    R5,WORK             A(FIRST MONTH THAT COUNTS)                   
         PACK  DUB,QPAY+2(2)       MONTHS UP                                    
         CVB   R5,DUB                                                           
         LA    R0,23                                                            
         CLI   QEND,C' '           SEE IF DATES GIVEN                           
         BE    *+8                                                              
         LA    R0,58               USE 58                                       
         CR    R5,R0                                                            
         BNH   *+6                                                              
         LR    R5,R0                                                            
         SLL   R5,1                                                             
         LA    R3,MLIST+36*2(R5)                                                
*                                                                               
         CLI   QEND,C' '           SEE IF DATES GIVEN                           
         BE    *+8                                                              
         LA    R3,MLIST+1*2(R5)    ONE MONTH INTO  LIST                         
*                                                                               
         GOTO1 DATCON,DMCB,(3,0(R3)),(6,PEND)                                   
*                                                                               
         MVC   BEND,0(R3)                                                       
         SRL   R5,1                                                             
         MH    R5,=Y(ROWL)                                                      
         LA    R3,36*ROWL+ROWL(R2,R5)                                           
         CLI   QEND,C' '                SEE IF DATES GIVEN                      
         BE    *+8                                                              
         LA    R3,1*ROWL+ROWL(R2,R5)    USE ONE MONTH                           
         ST    R3,WORK+4                A(LAST MONTH THAT COUNTS)               
*                                                                               
*                                                                               
RD3      DS    0H                                                               
*                                  CLEAR WRKTOTS                                
         LA    R3,ACCN                                                          
         L     R2,AWRKTOTS                                                      
*                                  CLEAR WRKTOTS                                
         ZAP   0(ACMACML,R2),=P'0'                                              
         LA    R2,ACMACML(R2)                                                   
         BCT   R3,*-10                                                          
*                                                                               
         LA    R5,NMOS+2                                                        
         L     R3,AWRKTOTS                                                      
         L     R2,SAVR2                                                         
*                                                                               
RD4      DS    0H                                                               
*                                                                               
         C     R2,WORK                                                          
         BL    RD8                                                              
         C     R2,WORK+4                                                        
         BH    RD9                                                              
*                                                                               
         STM   R2,R3,DUB           SAVE TOTALS POINTERS                         
         LA    R0,ACMDN            NUMBER OF BASIC BUCKETS                      
*                                                                               
         ZAP   0(ACMACML,R3),0(ACMACML,R2)  ROLL BUCKET                         
         LA    R3,ACMACML(R3)      NEXT BUCKET                                  
         LA    R2,ACMACML(R2)                                                   
         BCT   R0,*-14                                                          
*                                                                               
         LM    R2,R3,DUB           RESTORE POINTERS                             
*                                                                               
RD5      DS    0H                                                               
         L     RF,AWRKTOTS                                                      
         LA    RF,(NMOS+2)*ROWL(RF)     TOTAL ROW                               
*                                                                               
         ST    R2,DUB              SAVE TOTALS POINTERS                         
         ST    RF,DUB+4                                                         
         LA    R0,ACMDN            NUMBER OF BASIC BUCKETS                      
*                                                                               
         AP    0(ACMACML,RF),0(ACMACML,R2)  ROLL BUCKET                         
         LA    RF,ACMACML(RF)      NEXT BUCKET                                  
         LA    R2,ACMACML(R2)                                                   
         BCT   R0,*-14                                                          
*                                                                               
         L     R2,DUB              RESTORE TOTALS POINTERS                      
         L     RF,DUB+4                                                         
*                                                                               
RD6      DS    0H                                                               
         LA    R2,ROWL(R2)                                                      
         LA    R3,ROWL(R3)                                                      
         BCT   R5,RD4                                                           
         B     RD10                                                             
*                                                                               
RD8      DS    0H                                                               
         CLI   PRIOR,0                                                          
         BE    RD6                                                              
         L     RF,AWRKTOTS         PRIOR                                        
*                                                                               
         ST    R2,DUB              SAVE TOTALS POINTERS                         
         ST    RF,DUB+4                                                         
         LA    R0,ACMDN            NUMBER OF BASIC BUCKETS                      
*                                                                               
         AP    0(ACMACML,RF),0(ACMACML,R2)  ROLL BUCKET                         
         LA    RF,ACMACML(RF)      NEXT BUCKET                                  
         LA    R2,ACMACML(R2)                                                   
         BCT   R0,*-14                                                          
*                                                                               
         L     R2,DUB              RESTORE TOTALS POINTERS                      
         L     RF,DUB+4                                                         
*                                                                               
         B     RD5                                                              
*                                                                               
RD9      DS    0H                                                               
         CLI   SUBSQ,0                                                          
         BE    RD10                                                             
         L     RF,AWRKTOTS                                                      
         LA    RF,(NMOS+1)*ROWL(RF)     SUBSQ ROW                               
*                                                                               
         ST    R2,DUB              SAVE TOTALS POINTERS                         
         ST    RF,DUB+4                                                         
         LA    R0,ACMDN            NUMBER OF BASIC BUCKETS                      
*                                                                               
         AP    0(ACMACML,RF),0(ACMACML,R2)  ROLL BUCKET                         
         LA    RF,ACMACML(RF)      NEXT BUCKET                                  
         LA    R2,ACMACML(R2)                                                   
         BCT   R0,*-14                                                          
*                                                                               
         L     R2,DUB              RESTORE TOTALS POINTERS                      
         L     RF,DUB+4                                                         
*                                                                               
         B     RD5                                                              
*                                                                               
RD10     DS    0H                                                               
*                                  SPECIAL TOTALS                               
         L     R3,AWRKTOTS                                                      
         LA    R3,TGROW(R3)        FIRST SPECIAL ROW                            
         L     R2,SAVR2                                                         
         LA    R2,TGROW(R2)                                                     
         LA    R4,5*ROWL/ACMACML   5 ROWS                                       
RD11     DS    0H                                                               
         AP    0(ACMACML,R3),0(ACMACML,R2)                                      
         LA    R2,ACMACML(R2)                                                   
         LA    R3,ACMACML(R3)                                                   
         BCT   R4,RD11                                                          
*                                                                               
         XIT1                                                                   
         SPACE 3                                                                
EDIT     EQU   *                                                                
         CP    0(ACMACML,R5),=P'0'                                              
         BCR   8,RE                                                             
*                                                                               
         CLI   STAGSW,C'Y'                                                      
         BNE   EDIT5                                                            
         CLI   TOTSW,1                                                          
         BE    EDIT10                                                           
*                                                                               
EDIT5    DS    0H                                                               
         CP    0(ACMACML,R5),=P'100000000000' 1 BILLION OR MORE ?               
         BL    EDIT7                                                            
*                                                                               
         ZAP   DUB,0(ACMACML,R5)                                                
         MVC   WORK(18),=X'4040404020202020202020202020214B2020'                
         LA    R1,WORK+15                                                       
         EDMK  WORK(18),DUB+1                                                   
         BCTR  R1,R0                                                            
         CP    DUB,=P'0'                                                        
         BNL   *+8                 TO MVC WORK(15) . .                          
         MVI   0(R1),C'-'                                                       
         MVC   WORK(15),WORK+3                                                  
         MVC   0(15,R6),WORK                                                    
         BR    RE                                                               
*                                                                               
EDIT7    DS    0H                                                               
         EDIT  (P7,0(R5)),(15,0(R6)),2,COMMAS=YES,FLOAT=-                       
         BR    RE                                                               
*                                                                               
EDIT10   SH    R6,=H'3'          DECREMENT R6 TO MAKE LARGER                    
         ZAP   DUB,0(ACMACML,R5)                                                
         MVC   WORK(18),=X'4020206B2020206B2020206B2020214B2020'                
         LA    R1,WORK+15                                                       
         EDMK  WORK(18),DUB+1                                                   
         BCTR  R1,R0                                                            
         CP    DUB,=P'0'                                                        
         BNL   *+8                                                              
         MVI   0(R1),C'-'                                                       
*****    MVC   WORK(16),WORK+2     NOT NEEDED - PRINT AREA NOW 18               
         MVC   0(18,R6),WORK         LONG                                       
         MVI   18(R6),C'*'         TOTAL                                        
         BR    RE                                                               
*                                  EDIT MACRO NOT USED BECAUSE OF               
*                                                                               
******   EDIT  (P7,0(R5)),(16,0(R6)),2,COMMAS=YES,FLOAT=-                       
******   MVI   16(R6),C'*'         TOTAL                                        
******   BR    RE                                                               
*                                  EDIT MACRO NOT USED BECAUSE OF               
*                                  SPECIAL COMMAS                               
EDITEDIT DS    0H                                                               
         ZAP   DUB,0(ACMACML,R5)                                                
         MVC   WORK(17),=X'4020202020206B2020206B2020214B2020'                  
         LA    R1,WORK+14                                                       
         EDMK  WORK(17),DUB+1                                                   
         BCTR  R1,R0                                                            
         CP    DUB,=P'0'                                                        
         BNL   *+8                                                              
         MVI   0(R1),C'-'                                                       
         MVC   WORK(16),WORK+1                                                  
*                                                                               
         MVC   1(14,R6),WORK+2                                                  
         CLI   WORK+1,C' '         DONT CLOBBER * WITH SPACE                    
         BE    *+10                                                             
         MVC   0(1,R6),WORK+1                                                   
*                                                                               
         CLI   TOTSW,1                                                          
         BCR   7,RE                                                             
         MVI   15(R6),C'*'         TOTAL                                        
         BR    RE                                                               
         SPACE 3                                                                
REPRT    NTR1                                                                   
         SPACE 2                                                                
         CLC   QUESTOR,SPACES                                                   
         BE    REP2                                                             
         MVC   HEAD2(09),=C'REQUESTOR'                                          
         MVC   HEAD2+13(12),QUESTOR                                             
REP2     DS    0H                                                               
         MVC   HEAD3+64(6),PSTART                                               
         MVC   HEAD3+74(6),PEND                                                 
         CLI   OPNOPT,C'P'         SKIP IF PLANNED COSTS                        
         BE    *+8                                                              
         CLI   OPNOPT,C'B'                                                      
         BE    REP5                                                             
*                                                                               
         MVC   HEAD7+74(57),GLCDWDS                                             
         CLI   CDSW,0                                                           
         BE    *+10                                                             
         MVC   HEAD7+74(57),GROSWDS                                             
         CLI   NETOPT,C'Y'                                                      
         BNE   REP5                                                             
         MVC   HEAD7+74(57),NLCDWDS                                             
         CLI   CDSW,0                                                           
         BE    *+10                                                             
         MVC   HEAD7+74(57),NETWDS                                              
*                                                                               
REP5     DS    0H                                                               
         LA    RF,HEAD3                                                         
         CLI   QCLIENT,C'$'       OFFICE LIST REQUEST                           
         BNE   REP5C                                                            
         MVC   HEAD3(11),=C'OFFICE LIST'                                        
         MVC   HEAD3+12(1),QCLIENT+1                                            
         LA    RF,HEAD4                                                         
*                                                                               
REP5C    OC    LASTOFF,LASTOFF                                                  
         BE    REP6                                                             
         MVC   0(6,RF),=C'OFFICE'                                               
         MVC   9(2,RF),LASTOFF                                                  
         CLC   LASTOFF,=X'FEFF'                                                 
         BNE   *+10                                                             
         MVC   9(10,RF),=C'UNASSIGNED'                                          
*                                                                               
REP6     DS    0H                                                               
         CLI   QOPT1,C'C'                                                       
         BNE   REP7                                                             
         MVC   HEAD5(20),=C'**CLOSED-OUT ITEMS**'                               
         B     REP40                                                            
*                                                                               
REP7     DS    0H                                                               
         CLI   OPNOPT,C'O'         OPEN RATE OPTION                             
         BNE   REP8                                                             
         MVC   HEAD5(14),=C'**OPEN RATES**'                                     
*                                                                               
REP8     DS    0H                                                               
         CLI   OPNOPT,C'C'         CONTRACT RATES                               
         BNE   REP9                                                             
         MVC   HEAD5(18),=C'**CONTRACT RATES**'                                 
*                                                                               
REP9     DS    0H                                                               
         LA    RF,HEAD5                                                         
         CLI   0(RF),C' '                                                       
         BNH   *+8                                                              
         LA    RF,HEAD6                                                         
         MVC   0(32,RF),=C'**TEST ESTIMATES/BUYS INCLUDED**'                    
         CLI   TSTOPT,C'T'         TEST EST OPTION                              
         BE    REP10                                                            
         MVC   0(32,RF),=C'**TEST ESTIMATES/BUYS EXCLUDED**'                    
*                                                                               
REP10    DS    0H                                                               
*                                                                               
REP40    DS    0H                                                               
         GOTO1 REPORT                                                           
         B     PRNTX                                                            
GLCDWDS  DC    CL57'-----------------GROSS LESS CASH DISCOUNT----------X        
               -----'                                                           
GROSWDS  DC    CL57'-----------------G R O S S    A M O U N T----------X        
               -----'                                                           
*                                                                               
NLCDWDS  DC    CL57'------------------NET LESS CASH DISCOUNT-----------X        
               -----'                                                           
NETWDS   DC    CL57'-------------------N E T    A M O U N T------------X        
               -----'                                                           
*                                                                               
SUMMSG   DC    C'**ERROR - DETAIL BILLS PLUS REVERSALS NOT EQUAL TO SUMX        
                OF DETAIL BILLED ITEMS ON FILE **'                              
*                                                                               
         SPACE 3                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                  WORK FILE MODULE                             
         SPACE 2                                                                
PP49WFM  CSECT                                                                  
         NMOD1 0,WFMOD                                                          
*                                                                               
         USING PPWORKD,RA                                                       
*                                                                               
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP49WRKD,R8                                                      
*                                                                               
         MVC   WFWRKTTL,=CL8'WRKTOTS' AREA MARKER                               
*                                                                               
         LM    R2,R3,0(R1)                                                      
         CLC   =C'CLOSE',0(R2)                                                  
         BE    WF30                                                             
         CLC   QAGENCY,=C'ZZ'       CROSS AGENCY RUN?                           
         BE    WF8                                                              
*                                                                               
WF4      DS    0H                                                               
         OC    WFID,WFID           TEST FIRST TIME                              
         BNZ   WF4A                                                             
*                                  SET INDEX                                    
         LA    R6,WFID                                                          
         USING UKRECD,R6                                                        
*                                                                               
         MVC   UKUSRID,RCORIGID                                                 
         MVC   UKSYSPRG,=C'P49'                                                 
         MVC   UKSUBPRG,SYSNAID    SPOT FILE SYSTEM ID                          
         CLI   SYSNAID+1,C' '      SPACE?                                       
         BNH   *+10                                                             
         MVC   UKEXTRA,SYSNAID+1   2ND CHAR FILE SYSTEM ID                      
         MVI   UKDAY,1                                                          
         MVI   UKCLASS,C'R'                                                     
         DROP  R6                                                               
*                                                                               
         GOTO1 WORKER,DMCB,=C'INDEX',PP49WFN,WFID                               
*                                                                               
WF4A     DS    0H                                                               
         LA    RE,WFREC                                                         
         LH    RF,=Y(WFRECL)                                                    
         XCEF                                                                   
*                                                                               
         XC    WFREC-4(4),WFREC-4                                               
         MVC   WFREC-4(2),=Y(WFRECL+4)                                          
         MVC   WFAGY(3),PAGYKAGY                                                
         MVC   WFAGYNAM,PAGYNAME                                                
         MVC   WFAGYADR,PAGYADDR                                                
         MVC   WFAGYABR,PAGYABBR                                                
         MVC   WFMEDNAM,PAGYMED                                                 
         MVC   WFDATE,BTODAY       SET TODAY                                    
         MVI   WFTYP,C'A'                                                       
*                                                                               
         GOTO1 WORKER,DMCB,=C'ADD',PP49WFN,WFID,WFREC-4                         
*                                                                               
*        CREATE DUPLICATE OF OLD STYLE COUNTERS                                 
*              DROPPING PLANNED COSTS COUNTERS                                  
*                                                                               
         LR    R5,R3               POINT TO INCOMING COUNTERS                   
*                                                                               
         LA    R0,2*(NMOS+8)       NUMBER OF SETS OF COUNTER                    
*                                  ONE W/O CD AND ONE WITH CD                   
         LA    RF,WFWRKTOT         RECEIVING AREA                               
*                                                                               
         MVC   0((5*ACMACML),RF),0(R5)  WANT 1ST 5 COUNTERS                     
         LA    RF,5*ACMACML(RF)    BUMP POINTERS                                
         LA    R5,ACMDN*ACMACML(R5)                                             
         BCT   R0,*-14                                                          
*                                                                               
         LA    R4,8                SPLIT INTO 8 RECS                            
         LA    R5,WFWRKTOT                                                      
         LA    R6,1                                                             
*                                                                               
WF4B     DS    0H                                                               
         STC   R6,WFTYP                                                         
         LA    R1,L'WFTOTS                                                      
         LR    RE,R5                                                            
         MOVE  (WFTOTS,(R1)),(RE)                                               
         GOTO1 WORKER,DMCB,=C'ADD',PP49WFN,WFID,WFREC-4                         
*                                                                               
         LA    R5,L'WFTOTS(R5)                                                  
         LA    R6,1(R6)                                                         
         BCT   R4,WF4B                                                          
         B     WFEXIT                                                           
         EJECT                                                                  
*                                                                               
* ONLY GETS HERE IF CROSS FILE                                                  
*                                                                               
WF8      DS    0H                                                               
         GOTO1 WORKER,DMCB,=C'INDEX',PP49WFN,WFID                               
         TM    DMCB+8,X'80'                                                     
         BZ    WF9                                                              
         MVI   HLDAGYN,X'FF'       END OF MEDIA                                 
         B     WFEXIT                                                           
WF9      DS    0H                                                               
         CLC   WFID+2(3),=C'P49'                                                
         BNE   WF8                                                              
         CLC   WFID+UKSUBPRG-UKRECD(1),SYSNAID                                  
         BNE   WF8                                                              
         CLI   WFID+UKEXTRA-UKRECD,0                                            
         BNE   WF9A                                                             
         CLI   SYSNAID+1,C' '                                                   
         BE    WF9B                                                             
WF9A     CLC   WFID+UKEXTRA-UKRECD(1),SYSNAID+1                                 
         BNE   WF8                                                              
*                                                                               
WF9B     DS    0H                                                               
         GOTO1 WORKER,DMCB,=C'READ',,,WFREC-4                                   
*                                                                               
         TM    DMCB+8,X'80'                                                     
         BNZ   WF8                 NEXT AGY                                     
         CLC   WFMED,CURMED                                                     
         BNE   WF9                                                              
         CLC   WFDATE,BTODAY       TEST TODAY'S FILE                            
         BNE   WF9                                                              
*                                                                               
         CLI   WFTYP,C'A'                                                       
         BNE   WF10                                                             
         MVC   HLDAGYN,WFAGYNAM                                                 
         MVC   HLDMEDN,WFMEDNAM                                                 
         MVC   HLDAGYC,WFAGY                                                    
*                                                                               
         B     WF9B                                                             
*                                                                               
WF10     DS    0H                                                               
*                                  WFTYP IS INDEX (1 - 8)                       
         SR    RF,RF                                                            
         IC    RF,WFTYP                                                         
         BCTR  RF,0                                                             
         MHI   RF,L'WFTOTS                                                      
         LA    RF,WFWRKTOT(RF)     POINT TO STORAGE AREA                        
         LHI   R1,L'WFTOTS                                                      
*                                                                               
         MOVE  ((RF),(R1)),WFTOTS                                               
*                                                                               
         CLI   WFTYP,8                                                          
         BNE   WF9B                                                             
*                                                                               
*        MOVE THESE OLDSTYLE COUNTERS TO NEW CLTTOTS                            
*                                                                               
         L     R2,ACLTTOTS         CLEAR CLIENT TOTALS                          
         LA    R0,ACCN*2           NUMBER                                       
*                                                                               
         ZAP   0(ACMACML,R2),=P'0'                                              
         LA    R2,ACMACML(R2)                                                   
         BCT   R0,*-10                                                          
*                                                                               
         L     R5,ACLTTOTS         POINT TO CLIENT TOTALS                       
*                                                                               
         LA    R0,2*(NMOS+8)       NUMBER OF SETS OF COUNTER                    
*                                  ONE W/O CD AND ONE WITH CD                   
         LA    RF,WFWRKTOT         COUNTERS JUST READ IN                        
*                                                                               
         MVC   0((5*ACMACML),R5),0(RF)  FILL 1ST 5 COUNTERS                     
         LA    RF,5*ACMACML(RF)    BUMP POINTERS                                
         LA    R5,ACMDN*ACMACML(R5)                                             
         BCT   R0,*-14                                                          
*                                                                               
         B     WFEXIT                                                           
*                                                                               
WF30     DS    0H                                                               
         GOTO1 WORKER,DMCB,=C'CLOSE',PP49WFN                                    
*                                                                               
WFEXIT   DS    0H                                                               
         XIT1                                                                   
         EJECT                                                                  
         SPACE 2                                                                
EOF      DC    H'0'                                                             
         SPACE 2                                                                
         LTORG                                                                  
         SPACE 2                                                                
         DS    F                                                                
*                                                                               
WFREC    DS    0C                                                               
WFAGY    DS    CL2                                                              
WFMED    DS    CL1                                                              
WFDATE   DS    XL3                                                              
WFTYP    DS    XL1                                                              
WFTOTS   DS    0XL595              ACCL*2/4 = 1/8 OF ACCUMS PER REC             
WFAGYNAM DS    CL33                                                             
WFAGYADR DS    CL33                                                             
WFAGYABR DS    CL7                                                              
WFMEDNAM DS    CL11                                                             
         DS    XL511                                                            
WFRECL   EQU   602                                                              
         SPACE 2                                                                
WFWRKTTL DS    CL8                 AREA MARKER                                  
WFWRKTOT DS    (2*5*(NMOS+8))PL(ACMACML) WORK SET OF TOTALS                     
*                                  EQUALS OLD NUMBER OF COUNTERS                
*                                  THERE WERE ONLY 5 BASE COUNTERS              
*                                                                               
         TITLE 'PP049-02  PRINTPAK AGENCY SUMMARY - ADDUP'                      
***********************************************************************         
*                                                                     *         
*        ACCUMULATE AMOUNTS FOR BILLS AND BUYS                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
*                                                                               
ADDUP    CSECT                                                                  
         NMOD1 0,ADDUP                                                          
*                                                                               
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP49WRKD,R8                                                      
*                                  ACCUMULATING FOR BILLS & BUYS                
*                                                                               
         CLI   KEY+3,X'20'         TEST BUY REC                                 
         BE    ADDUPBUY            YES                                          
*                                                                               
         CLI   KEY+3,X'09'         TEST BUCKET REC                              
         BE    ADDUPBK             YES                                          
*                                                                               
*        DOING BILL REC                                                         
*                                                                               
         LA    R1,PBILKMOS         MONTH OF SERVICE                             
         BAS   RE,FINDMO                                                        
*                                   R2 HAS A(ROW)                               
         USING ACMD,R2             ESTABLISH BASIC ACCUMULATORS                 
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   ADDUP0                                                           
*                                                                               
         AP    ACMBLD,PBILLNET         NET                                      
         AP    ACMBLD+ACCL,PBILLNET                                             
         AP    ACMBLD+ACCL,PPBVEBC     ADD "EFFECTIVE" CD                       
         B     ADDUP0C                                                          
*                                                                               
ADDUP0   AP    ACMBLD,PBILLBIL     GROSS LESS CD                                
         AP    ACMBLD+ACCL,PBILLGRS                                             
*                                                                               
ADDUP0C  DS    0H                                                               
         CLI   PBILLTYP,C'4'       DETAIL BILL                                  
         BE    ADDUP1              YES                                          
         CLI   PBILLTYP,C'B'       OR NEW BILLING                               
         BE    ADDUP1              YES                                          
         CLI   PBILLCDT,C'0'       ELSE TEST REVERSED                           
         BNH   ADDUP2              NO                                           
*                                                                               
ADDUP1   DS    0H                                                               
         L     R2,ACLTTOTS                                                      
         CLI   NETOPT,C'Y'                                                      
         BNE   ADDUP1B                                                          
         AP    ACCL-ROWL(ACMACML,R2),PBILLNET                                   
         LA    R2,ACCL(R2)                                                      
         AP    ACCL-ROWL(ACMACML,R2),PBILLNET                                   
         AP    ACCL-ROWL(ACMACML,R2),PPBVEBC   ADD "EFFECTIVE" CD               
         B     ADDUP2                                                           
*                                                                               
ADDUP1B  AP    ACCL-ROWL(ACMACML,R2),PBILLBIL   DET BILLS PLUS RVRSLS           
         LA    R2,ACCL(R2)                                                      
         AP    ACCL-ROWL(ACMACML,R2),PBILLGRS                                   
*                                                                               
         DROP  R2                                                               
*                                                                               
ADDUP2   DS    0H                                                               
*                                                                               
         CLC   PBILLDAT(4),TODAY1       TEST THIS MONTH                         
         BNE   ADDUPX                                                           
*                                                                               
         BAS   RE,GETBGST     GET BILLED GST AND RETURN IN MYGST                
*                                                                               
         L     R7,ACLTTOTS                                                      
         LA    R7,MGROW(R7)                                                     
*                                                                               
         USING ACMD,R7             ESTABLISH ACCUMULATORS                       
*                                                                               
         AP    ACMBLD,PBILLBIL                                                  
         AP    ACMBLD+ACCL,PBILLGRS                                             
*                                                                               
         AP    ACMBLD,MYGST        ADD GST TO GROSS-CD AND GROSS                
         AP    ACMBLD+ACCL,MYGST                                                
*                                                                               
         LA    R7,ROWL(R7)              NET                                     
*                                                                               
         AP    ACMBLD,PBILLNET        NET                                       
         AP    ACMBLD+ACCL,PBILLNET                                             
         AP    ACMBLD+ACCL,PPBVEBC    ADD "EFFECTIVE" CD                        
*                                                                               
         AP    ACMBLD,MYGST            ADD GST TO NET-CD AND NET                
         AP    ACMBLD+ACCL,MYGST                                                
*                                                                               
*                                                                               
         CLC   PBILLDAT,TODAY1                                                  
         BNE   ADDUPX                                                           
*                                                                               
         L     R7,ACLTTOTS                                                      
         LA    R7,TGROW(R7)                                                     
*                                                                               
         AP    ACMBLD,PBILLBIL                                                  
         AP    ACMBLD+ACCL,PBILLGRS                                             
*                                                                               
         AP    ACMBLD,MYGST           ADD GST TO GROSS-CD AND GROSS             
         AP    ACMBLD+ACCL,MYGST                                                
*                                                                               
*                                                                               
         LA    R7,ROWL(R7)         NET                                          
*                                                                               
         AP    ACMBLD,PBILLNET        NET-CD                                    
         AP    ACMBLD+ACCL,PBILLNET                                             
         AP    ACMBLD+ACCL,PPBVEBC    ADD "EFFECTIVE" CD                        
*                                                                               
         AP    ACMBLD,MYGST           ADD GST TO GROSS-CD AND GROSS             
         AP    ACMBLD+ACCL,MYGST                                                
*                                                                               
         B     ADDUPX                                                           
*                                                                               
         DROP  R7                                                               
*                                                                               
*        BUY RECORD                                                             
*                                                                               
ADDUPBUY EQU   *                                                                
*                                                                               
         USING ACMD,R2             ESTABLISH ACCUMULATORS                       
*                                                                               
         XC    PCVALUES(20),PCVALUES  INIT PC AMOUNTS                           
         MVI   PCYN,C'N'           INIT PC SWITCH                               
*                                                                               
         CLI   OPNOPT,C'P'         IF DOING PLANNED COSTS                       
         BE    *+8                                                              
         CLI   OPNOPT,C'B'         IF DOING PLANNED COSTS                       
         BNE   ADDUP4A                                                          
*                                                                               
*        FIND PLANNED COSTS FOR BUY                                             
*                                                                               
         SR    R0,R0                                                            
         IC    R0,OPNOPT           GET PLANNED COST OPTION                      
        GOTO1 GETINS,DMCB,(C'P',PBUYREC),((R0),PCVALUES),PBUYKPRD,0,0,0         
*                                                                               
*        AMOUNTS ARE GROSS IF NO PLANNED COSTS                                  
*                                                                               
         MVI   PCYN,C'Y'           ASSUME THERE ARE PLANNED COSTS               
*                                                                               
         CLI   4(R1),C'X'          IF NO PLANNED COSTS                          
         BNE   *+8                                                              
         MVI   PCYN,C'N'              SET FLAG                                  
*                                                                               
ADDUP4A  DS    0H                                                               
*                                                                               
         CLI   QOPT2,C'C'          TEST CLOSE OUT RUN                           
         BNE   ADDUP4B                                                          
*                                                                               
         TM    KEY+25,X'20'                                                     
         BZ    ADDUP5                                                           
         B     ADDUP4C                                                          
*                                                                               
ADDUP4B  DS    0H                                                               
*                                                                               
         TM    KEY+25,X'80'      TEST DELETED                                   
         BZ    ADDUP5              NO                                           
*                                                                               
ADDUP4C  DS    0H                                                               
         XC    GROSS(20),GROSS         YES - CLEAR ORDERED                      
         XC    PCVALUES(20),PCVALUES   YES - CLEAR PLANNED COSTS                
*                                                                               
ADDUP5   DS    0H                                                               
*                                                                               
         LA    R1,PBUYKDAT         INS DATE                                     
         BAS   RE,FINDMO                                                        
*                                   R2 = A(ROW OF ACCUMULATORS)                 
         L     R0,GROSS                                                         
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+8                                                              
         S     R0,AGYCOM           NET                                          
*                                                                               
         CVD   R0,DUB                                                           
         AP    ACMGRSIM,DUB        GROSS - INS. MO                              
         AP    ACMGRSIM+ACCL,DUB   AND ALTERNATE TOTALS                         
*                                                                               
*        PLANNED COSTS INSERTION MONTH                                          
*              EQUALS GROSS FOR BILLABLE MONTH                                  
*              IF MONTH BEFORE PC BILL START DATE                               
*              OR NOT AFTER ESTIMATE ACTUALIZATION DATE                         
*                                                                               
         CLI   PCYN,C'N'           USE GROSS IF NO PLANNED COSTS                
         BE    ADDUP50A                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,3,PBUYKEST          GET ESTIMATE #                            
         MHI   RF,4                   CALCULATE INDEX INTO TABLE                
         A     RF,AACTDTES            POINT TO ACTUALIZATION DATES              
*                                                                               
         OC    0(2,RF),0(RF)          IF NO BILLING EFFECTIVE DATE              
         BZ    ADDUP50A                  USE GROSS ORDERED                      
*                                                                               
         CLC   PBUYKDAT(2),0(RF)      BEFORE BILLING EFD                        
         BL    ADDUP50A                  USE GROSS ORDERED                      
*                                                                               
         CLC   PBUYKDAT(2),2(RF)         AFTER ACTUALIZATION DATE               
         BH    ADDUP50C                  YES - SKIP & USE PLANNED COST          
*                                                                               
ADDUP50A DS    0H                                                               
*                                                                               
         L     R0,GROSS                                                         
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+8                                                              
         S     R0,AGYCOM           NET                                          
*                                                                               
         CVD   R0,DUB                                                           
         AP    ACMPCGIM,DUB        PCORD IS GROSS FOR INS. MONTH                
         AP    ACMPCGIM+ACCL,DUB                                                
*                                                                               
         B     ADDUP50X                                                         
*                                                                               
ADDUP50C DS    0H                                                               
*                                                                               
*        PLANNED COST - INSERTION MONTH                                         
*                                                                               
         CLI   PCYN,C'N'           SKIP IF NO PLANNED COSTS                     
         BE    ADDUP50X                                                         
*                                                                               
         L     R0,GROSS-GROSS+PCVALUES      PLANNED COST                        
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+8                                                              
         S     R0,AGYCOM-GROSS+PCVALUES     NET                                 
*                                                                               
         CVD   R0,DUB                                                           
         AP    ACMPCGIM,DUB        PLANNED COST - BILL MO.                      
         AP    ACMPCGIM+ACCL,DUB   AND ALTERNATE TOTALS                         
*                                                                               
         B     ADDUP50X                                                         
*                                                                               
ADDUP50X DS    0H                                                               
*                                                                               
*        BILLABLE MONTH                                                         
*                                                                               
         LA    R1,BLBLDT           BILL MO.                                     
         BAS   RE,FINDMO                                                        
*                                    R2 = A(ROW)                                
         L     R0,GROSS                                                         
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+8                                                              
         S     R0,AGYCOM           NET                                          
*                                                                               
         CVD   R0,DUB                                                           
         AP    ACMGRSBM,DUB        GROSS - BILL MO.                             
         AP    ACMGRSBM+ACCL,DUB   AND ALTERNATE TOTALS                         
*                                                                               
         L     R0,CSHDSC                                                        
         CVD   R0,DUB                                                           
         AP    ACMCD,DUB           C.D. - BILL MO.                              
         AP    ACMCD+ACCL,DUB                                                   
*                                                                               
*        PLANNED COSTS BILLABLE MONTH                                           
*              EQUALS GROSS FOR BILLABLE MONTH                                  
*              IF MONTH BEFORE PC BILL START DATE                               
*              OR NOT AFTER ESTIMATE ACTUALIZATION DATE                         
*                                                                               
         CLI   PCYN,C'N'           USE GROSS IF NO PLANNED COSTS                
         BE    ADDUP5AB                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,3,PBUYKEST          GET ESTIMATE #                            
         MHI   RF,4                   CALCULATE INDEX INTO TABLE                
         A     RF,AACTDTES            POINT TO ACTUALIZATION DATES              
*                                                                               
         OC    0(2,RF),0(RF)       SKIP IF NO BILLING EFFECTIVE DATE            
         BZ    ADDUP5AB                                                         
*                                                                               
         CLC   PBUYKDAT(2),0(RF)      BEFORE BILLING EFD                        
         BL    ADDUP5AB                  USE GROSS ORDERED                      
*                                                                               
         CLC   PBUYKDAT(2),2(RF)         AFTER ACTUALIZATION DATE               
         BH    ADDUP5AC                  YES - SKIP & USE PLANNED COST          
*                                                                               
ADDUP5AB DS    0H                                                               
*                                                                               
         L     R0,GROSS                                                         
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+8                                                              
         S     R0,AGYCOM           NET                                          
*                                                                               
         CVD   R0,DUB                                                           
         AP    ACMPCGBM,DUB        PCORD IS GROSS FOR BILL MONTH                
         AP    ACMPCGBM+ACCL,DUB                                                
*                                                                               
         L     R0,CSHDSC                                                        
         CVD   R0,DUB                                                           
         AP    ACMPCCD,DUB           C.D. - BILL MO.                            
         AP    ACMPCCD+ACCL,DUB                                                 
*                                                                               
         B     ADDUP5AX                                                         
*                                                                               
ADDUP5AC DS    0H                                                               
*                                                                               
*        PLANNED COST - BILLABLE MONTH                                          
*                                                                               
         CLI   PCYN,C'N'           SKIP IF NO PLANNED COSTS                     
         BE    ADDUP5AE                                                         
*                                                                               
         L     R0,GROSS-GROSS+PCVALUES      PLANNED COST                        
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+8                                                              
         S     R0,AGYCOM-GROSS+PCVALUES     NET                                 
*                                                                               
         CVD   R0,DUB                                                           
         AP    ACMPCGBM,DUB        PLANNED COST - BILL MO.                      
         AP    ACMPCGBM+ACCL,DUB   AND ALTERNATE TOTALS                         
*                                                                               
         L     R0,CSHDSC-GROSS+PCVALUES                                         
         CVD   R0,DUB                                                           
         AP    ACMPCCD,DUB           C.D. - BILL MO.                            
         AP    ACMPCCD+ACCL,DUB                                                 
*                                                                               
         B     ADDUP5AX                                                         
*                                                                               
ADDUP5AE DS    0H                                                               
*                                                                               
ADDUP5AX DS    0H                                                               
*                                                                               
         L     R0,PGROSS           PAID GROSS                                   
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+8                                                              
         S     R0,PAGYCOM          PAID NET                                     
*                                                                               
         CVD   R0,DUB                                                           
         AP    ACMPAID+ACCL,DUB    PAID - PART OF ALTERNATE TOTALS              
*                                                                               
         S     R0,PCSHDSC                                                       
         CVD   R0,DUB                                                           
         AP    ACMPAID,DUB         PAID (GROSS LESS C.D.) - BILL MO.            
*                                                                               
         L     R2,ACLTTOTS                                                      
         L     R0,BGROSS           BILLED GROSS                                 
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+8                                                              
         S     R0,BAGYCOM                                                       
*                                                                               
         CVD   R0,DUB                                                           
         LA    R2,ACCL(R2)                                                      
         AP    ACMGRSBM+ACCL-ROWL,DUB    SUM OF DET BILLED ITEMS                
*                                  LAST ROW OF SET OF ACCUMS                    
*                                  ALTERNATE TOTALS                             
***JW***                                                                        
         CLC   PBUYREC(2),=C'JW'        SPECIAL FOR JW SINCE THEY               
         BE    ADDUP5D                  HAVE NO BILLRECS                        
***JW***                                                                        
***OG***                                                                        
         CLC   PBUYREC(2),=C'OG'        SPECIAL FOR OG SINCE THEY               
         BNE   ADDUP6                   HAVE NO BILLRECS                        
*                                                                               
ADDUP5D  AP    ACMGRSIM+ACCL-ROWL,DUB    SUM OF DET BILLED ITEMS                
         LA    R1,PBDBDATE                                                      
         BAS   RE,FINDMO                                                        
         AP    ACMBLD+ACCL,DUB                                                  
***OG***                                                                        
ADDUP6   L     R2,ACLTTOTS                                                      
         L     R0,BGROSS                                                        
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+8                                                              
         S     R0,BAGYCOM                                                       
*                                                                               
         S     R0,BCSHDSC                                                       
         CVD   R0,DUB                                                           
         AP    ACMGRSBM+ACCL-ROWL,DUB                                           
***JW***                                                                        
         CLC   PBUYREC(2),=C'JW'        SPECIAL FOR JW SINCE THEY               
         BE    ADDUP6D                  HAVE NO BILLRECS                        
***JW***                                                                        
***OG***                                                                        
         CLC   PBUYREC(2),=C'OG'        SPECIAL FOR OG SINCE THEY               
         BNE   ADDUP7X                  HAVE NO BILLRECS                        
*                                                                               
ADDUP6D  AP    ACMGRSIM+ACCL-ROWL,DUB    SUM OF DET BILLED ITEMS                
         LA    R1,PBDBDATE                                                      
         BAS   RE,FINDMO                                                        
         AP    ACMBLD,DUB               GROSS-CD                                
*                                                                               
ADDUP7   LA    R2,PBUYREC+33       FIND BILLED TODAY (ONLY FOR OG)              
         MVI   ELCODE1,X'26'                                                    
*                                                                               
ADDUP7B  DS    0H                                                               
*                                                                               
         BAS   RE,NEXTEL                                                        
         BNE   ADDUP7X                                                          
*                                                                               
         USING PBILELEM,R2         ESTABLISH BILL ELEMENT                       
*                                                                               
         CLC   PBLDATE(2),BTODAY   SKIP IF BILLED DATE NOT TODAY                
         BNE   ADDUP7B                                                          
*                                                                               
*        FIND BILLING DATA                                                      
*                                                                               
         GOTO1 =V(PPBVAL),DMCB,(C'E',PBILELEM),PPBVALD                          
*                                                                               
*        SET PBGROSS ETC., TO "EFFECTIVE" VALUES                                
*                                                                               
         MVC   PBGROSS(12),PPBVEEG                                              
*                                                                               
         L     R6,ACLTTOTS         POINT TO CLIENT TOTALS                       
         LA    R7,MGROW(R6)        MONTH GROSS TOTALS                           
         LA    R6,TGROW(R6)        TODAY GROSS TOTALS                           
*                                                                               
*                                  BILLED AMOUNTS                               
         ICM   R0,15,PBGROSS                                                    
         CVD   R0,WORK                  GRS                                     
*                                                                               
         MVC   FULL,PBCSHDSC                                                    
         S     R0,FULL                                                          
         CVD   R0,WORK+8                GRS - CD                                
*                                                                               
         ICM   R0,15,PBGROSS                                                    
         MVC   FULL,PBAGYCOM                                                    
         S     R0,FULL                  NET                                     
         CVD   R0,WORK+16                                                       
*                                                                               
         MVC   FULL,PBCSHDSC                                                    
         S     R0,FULL                                                          
         CVD   R0,WORK+24               NET - CD                                
*                                                                               
         USING ACMD,R7             ESTABLISH ACCUMULATORS                       
*                                                                               
         AP    ACMBLD,WORK+8(8)    BILLED GROSS - CD DOLLARS                    
         AP    ACMBLD+ACCL,WORK(8) BILLED GROSS                                 
*                                                                               
         LA    R7,ROWL(R7)         MONTH NET ACCUMULATORS                       
         AP    ACMBLD,WORK+24(8)   BILLED NET - CD                              
         AP    ACMBLD+ACCL,WORK+16(8) BILLED NET                                
*                                                                               
*        BILLABLE                                                               
*                                                                               
         DROP R7                                                                
*                                                                               
         USING ACMD,R6             ESTABLISH ACCUMULATORS                       
*                                                                               
         CLC   PBLDATE,BTODAY                                                   
         BNE   ADDUP7B                                                          
*                                                                               
         AP    ACMBLD,WORK+8(8)      TODAY BILLED GROSS - CD                    
         AP    ACMBLD+ACCL,WORK+0(8) TODAY BILLED GROSS                         
*                                                                               
         LA    R6,ROWL(R6)         POINT TO TODAY NET ACCUMULATORS              
*                                                                               
         AP    ACMBLD,WORK+24(8)       TODAY BILLED NET - CD                    
         AP    ACMBLD+ACCL,WORK+16(8)  TODAY BILLED NET                         
*                                                                               
         B     ADDUP7B                                                          
*                                                                               
         DROP  R2,R6                                                            
***OG***                                                                        
*                                                                               
ADDUP7X  DS    0H                                                               
*                                                                               
         MVC   WORK(3),BTODAY      DATE RANGE FOR THIS MONTH                    
         MVC   WORK+3(3),BTODAY                                                 
         MVI   WORK+2,X'01'                                                     
         MVI   WORK+5,X'31'                                                     
*                                                                               
         GOTO1 GETINS,DMCB,(C'P',PBUYREC),(0,GROSS),PBUYKPRD,WORK,     X        
               =C'GST'                                                          
*                                                                               
         L     R1,DMCB+16               PAID GST IS RETURNED                    
         USING GVALUES,R1                                                       
*                                                                               
         L     R0,PGROSS                                                        
***GST   A     R0,GSTTAXPD                                                      
         ST    R0,PGROSS                INCLUDE GST IN GROSS                    
*                                                                               
         DROP  R1                                                               
*                                                                               
         L     R6,ACLTTOTS                                                      
         LA    R7,MGROW(R6)        POINT TO MONTH GROSS ACCUMULATORS            
*                                                                               
         USING ACMD,R7             ESTABLISH ACCUMULATORS                       
*                                                                               
*                                  PAID AMOUNTS                                 
*                                                                               
         ICM   R0,15,PGROSS                                                     
         CVD   R0,WORK                  GRS                                     
*                                                                               
         MVC   FULL,PCSHDSC                                                     
         S     R0,FULL                                                          
         CVD   R0,WORK+8                GRS - CD                                
*                                                                               
         ICM   R0,15,PGROSS                                                     
         MVC   FULL,PAGYCOM                                                     
         S     R0,FULL                  NET                                     
         CVD   R0,WORK+16                                                       
*                                                                               
         MVC   FULL,PCSHDSC                                                     
         S     R0,FULL                                                          
         CVD   R0,WORK+24               NET - CD                                
*                                                                               
         AP    ACMPAID,WORK+8(8)                                                
         AP    ACMPAID+ACCL,WORK+0(8)                                           
*                                                                               
         LA    R7,ROWL(R7)         BUMP TO NET ACCUMULATORS                     
*                                                                               
         AP    ACMPAID,WORK+24(8)      NET - CD                                 
         AP    ACMPAID+ACCL,WORK+16(8) NET                                      
*                                                                               
         MVC   WORK(3),BTODAY      DATE RANGE OF TODAY ONLY                     
         MVC   WORK+3(3),BTODAY                                                 
*                                                                               
         GOTO1 GETINS,DMCB,(C'P',PBUYREC),(0,GROSS),PBUYKPRD,WORK,     X        
               =C'GST'                                                          
*                                                                               
         L     R1,DMCB+16               PAID GST IS RETURNED                    
         USING GVALUES,R1                                                       
*                                                                               
         L     R0,PGROSS                                                        
***GST   A     R0,GSTTAXPD                                                      
         ST    R0,PGROSS                INCLUDE GST IN GROSS                    
*                                                                               
         DROP  R1                                                               
*                                                                               
         L     R6,ACLTTOTS                                                      
         LA    R7,TGROW(R6)        POINT TO TODAY'S GROSS ACCUMULATORS          
*                                                                               
*                                  PAID TODAY AMOUNTS                           
         ICM   R0,15,PGROSS                                                     
         CVD   R0,WORK                  GRS                                     
*                                                                               
         MVC   FULL,PCSHDSC                                                     
         S     R0,FULL                                                          
         CVD   R0,WORK+8                GRS - CD                                
*                                                                               
         ICM   R0,15,PGROSS                                                     
         MVC   FULL,PAGYCOM                                                     
         S     R0,FULL                  NET                                     
         CVD   R0,WORK+16                                                       
*                                                                               
         MVC   FULL,PCSHDSC                                                     
         S     R0,FULL                                                          
         CVD   R0,WORK+24               NET - CD                                
*                                                                               
         AP    ACMPAID,WORK+8(8)        GCD                                     
         AP    ACMPAID+ACCL,WORK+0(8)   GROSS                                   
*                                                                               
*        BUMP TO TODAY NET ACCUMULATORS                                         
*                                                                               
         AP    ACMPAID,WORK+24(8)       NCD                                     
         AP    ACMPAID+ACCL,WORK+16(8)  NET                                     
*                                                                               
         B     ADDUPX                                                           
*                                                                               
         DROP R7                                                                
*                                                                               
*        BUCKET RECORD                                                          
*                                                                               
ADDUPBK  EQU   *                                                                
*                                                                               
         USING ACMD,R2             ESTABLISH ACCUMULATORS                       
*                                                                               
         MVI   ELCODE1,X'23'       SEARCH FOR SPECIAL MONTH BUCKETS             
*                                  FOR PRINT THESE ARE INSERTION MONTH          
*                                  BUCKETS                                      
         L     R4,ACONIO1          (A)PCONREC                                   
*                                                                               
         LA    R4,33(R4)           BUCKET IS IN PCONREC                         
         USING BKELEM,R4                                                        
*                                                                               
         CLI   0(R4),X'23'                                                      
         BE    RBK15                                                            
*                                                                               
RBK12    BAS   RE,NEXTLR4                                                       
         BNE   RBK25                                                            
*                                                                               
RBK15    CLI   BKTYPE,C'I'         SEE IF INS MONTH BUCKET                      
         BNE   RBK12                                                            
*                                                                               
         LA    R1,BKYM                                                          
         BAS   RE,FINDMO                                                        
*                                   R2 = A(ROW)                                 
         ZAP   DUB,BKOGRS                                                       
*                                                                               
         CLI   NETOPT,C'Y'         SEE IF DOING NET                             
         BNE   *+10                                                             
         ZAP   DUB,BKONET                                                       
*                                                                               
         AP    ACMGRSIM,DUB        GROSS - INS. MO                              
         AP    ACMGRSIM+ACCL,DUB                                                
*                                                                               
*        PLANNED COSTS ORDERED                                                  
*              EQUALS GROSS FOR BILLABLE MONTH                                  
*              IF MONTH BEFORE PC BILL START DATE                               
*              OR NOT AFTER ESTIMATE ACTUALIZATION DATE                         
*                                                                               
         L     RE,ACONIO1          POINT TO BUCKET RECORD                       
         SR    RF,RF                                                            
         ICM   RF,3,10(RE)            GET ESTIMATE #                            
         MHI   RF,4                   CALCULATE INDEX INTO TABLE                
         A     RF,AACTDTES            POINT TO ACTUALIZATION DATES              
*                                                                               
         OC    0(2,RF),0(RF)       IF NO BILLING EFD                            
         BZ    RBK16                  USE GROSS                                 
*                                                                               
         CLC   BKYM,0(RF)          IF BEFORE PC BILLING START                   
         BL    RBK16                     USE GROSS                              
         CLC   BKYM,2(RF)          IF BEFORE ACTUALIZATION DATE                 
         BH    RBK17                     SKIP                                   
*                                                                               
RBK16    DS    0H                                                               
*                                                                               
         AP    ACMPCGIM,DUB        PCORD IS GROSS FOR BILL MONTH                
         AP    ACMPCGIM+ACCL,DUB                                                
*                                                                               
RBK17    DS    0H                                                               
*                                                                               
         B     RBK12               GO DO NEXT INS MTH BUCKET                    
*                                                                               
         DROP  R4                                                               
*                                                                               
RBK25    DS    0H           NOW DO BILLING MTH BUCKETS                          
*                                                                               
         L     R4,ACONIO1          (A)PCONREC                                   
         LA    R4,33(R4)           BUCKET IS PCONREC                            
*                                                                               
         USING BKELEM,R4                                                        
*                                                                               
         MVI   ELCODE1,X'22'       LOOKING FOR REGULAR BUCKETS                  
*                                  IE BILL MONTH BUCKETS                        
         CLI   0(R4),X'22'                                                      
         BE    RBK27                                                            
*                                                                               
RBK26    BAS   RE,NEXTLR4                                                       
         BNE   RBK40                                                            
*                                                                               
RBK27    LA    R1,BKYM                                                          
         BAS   RE,FINDMO                                                        
*                                                                               
         ZAP   DUB,BKOGRS                                                       
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+10                                                             
         ZAP   DUB,BKONET                                                       
*                                    R2 = A(ROW)                                
         AP    ACMGRSBM,DUB          GROSS - BILL MO.                           
         AP    ACMGRSBM+ACCL,DUB                                                
*                                                                               
         AP    ACMCD,BKOCD           C.D. - BILL MO.                            
         AP    ACMCD+ACCL,BKOCD                                                 
*                                                                               
*        PLANNED COSTS ORDERED                                                  
*              EQUALS GROSS FOR BILLABLE MONTH                                  
*              IF MONTH BEFORE PC BILL START DATE                               
*              OR NOT AFTER ESTIMATE ACTUALIZATION DATE                         
*                                                                               
         L     RE,ACONIO1          POINT TO BUCKET RECORD                       
         SR    RF,RF                                                            
         ICM   RF,3,10(RE)            GET ESTIMATE #                            
         MHI   RF,4                   CALCULATE INDEX INTO TABLE                
         A     RF,AACTDTES            POINT TO ACTUALIZATION DATES              
*                                                                               
         OC    0(2,RF),0(RF)       SKIP IF NO BILLING EFD                       
         BZ    RBK5AB                                                           
*                                                                               
         CLC   BKYM,0(RF)             SEE IF ORDERED COSTS NEEDED               
         BL    RBK5AB                    BEFORE PC BILLING START                
         CLC   BKYM,2(RF)                UP TO  ACTUALIZATION DATE              
         BH    RBK5AC                    ELSE - SKIP                            
*                                                                               
RBK5AB   DS    0H                                                               
*                                                                               
         ZAP   DUB,BKOGRS          PLANNED COST IS ORD GRS FOR MONTH            
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+10                                                             
         ZAP   DUB,BKONET                                                       
*                                    R2 = A(ROW)                                
         AP    ACMPCGBM,DUB        PCORD IS GROSS FOR BILL MONTH                
         AP    ACMPCGBM+ACCL,DUB                                                
*                                                                               
         AP    ACMPCCD,BKOCD           C.D. - BILL MO.                          
         AP    ACMPCCD+ACCL,BKOCD                                               
*                                                                               
RBK5AC   DS    0H                                                               
*                                                                               
         ZAP   DUB,BKPGRS          PAID GROSS                                   
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+10                                                             
         ZAP   DUB,BKPNET                                                       
*                                    R2 = A(ROW)                                
         AP    ACMPAID+ACCL,DUB      PAID GROSS - BILL MO.                      
         SP    DUB,BKPCD                                                        
         AP    ACMPAID,DUB           PAID (GROSS LESS C.D.) - BILL MO.          
*                                                                               
         B     RBK26                 GO DO NEXT BILL MTH BUCKET                 
*                                                                               
         DROP  R4                                                               
*                                                                               
RBK40    DS    0H                                                               
*                                                                               
         L     R4,ACONIO1          (A)PCONREC                                   
         LA    R4,33(R4)           BUCKET IS IN PCONREC                         
         USING BKELEM,R4                                                        
*                                                                               
         MVI   ELCODE1,X'21'       TODAY'S BUCKETS                              
***GST   MVI   ELCODE1,X'31'       WAS X'21'  - NEW X'31' ELEMS                 
*                                  INCLUDE GST                                  
         CLI   0(R4),X'21'                                                      
***GST   CLI   0(R4),X'31'                                                      
         BE    RBK45                                                            
RBK43    DS    0H                                                               
         BAS   RE,NEXTLR4                                                       
         BNE   RBK50                                                            
RBK45    CLC   BKDATE,BTODAY    SEE IF DONE TODAY                               
         BNE   RBK43                                                            
*                                                                               
         L     R6,ACLTTOTS                                                      
         LA    R7,MGROW(R6)                                                     
*                                                                               
         LA    R6,TGROW(R6)                                                     
*                                                                               
         ZAP   DUB,BKPGRS          PAID TODAY - GROSS                           
         ZAP   WORK(8),DUB                                                      
*                                                                               
         SP    DUB,BKPCD           PAID GROSS-CD                                
         ZAP   WORK+8(8),DUB                                                    
*                                                                               
         ZAP   DUB,BKPNET                                                       
         ZAP   WORK+16(8),DUB      PAID NET                                     
*                                                                               
         SP    DUB,BKPCD                                                        
         ZAP   WORK+24(8),DUB      PAID NET - CD                                
*                                                                               
*                                       I ONLY HAVE PAID TODAY BUCKETS          
*                                                                               
         AP    ACMPAID-ACMD(ACMACML,R6),WORK+8(8)     PD GROSS-CD               
         AP    ACMPAID-ACMD+ACCL(ACMACML,R6),WORK(8)  PD GROSS                  
*                                                                               
         LA    R6,ROWL(R6)                                                      
         AP    ACMPAID-ACMD(ACMACML,R6),WORK+24(8)    PD NET-CD                 
         AP    ACMPAID-ACMD+ACCL(ACMACML,R6),WORK+16(8) PD NET                  
*                                                                               
         B     RBK43               GO DO NEXT TODAY ELEM                        
*                                                                               
RBK50    DS    0H                                                               
*                                                                               
         MVI   ELCODE1,X'43'       SEARCH FOR SPECIAL MONTH PC BUCKETS          
*                                  FOR PRINT THESE ARE INSERTION MONTH          
*                                  BUCKETS                                      
         L     R4,ACONIO1          (A)PCONREC                                   
*                                                                               
         LA    R4,33(R4)           BUCKET IS IN PCONREC                         
         USING BKELEM,R4                                                        
*                                                                               
         CLI   0(R4),X'43'                                                      
         BE    RBKPC15                                                          
*                                                                               
RBKPC12  BAS   RE,NEXTLR4                                                       
         BNE   RBKPC25                                                          
*                                                                               
RBKPC15  CLI   BKTYPE,C'I'         SEE IF INS MONTH BUCKET                      
         BNE   RBKPC12                                                          
*                                                                               
         LA    R1,BKYM                                                          
         BAS   RE,FINDMO                                                        
*                                   R2 = A(ROW)                                 
         ZAP   DUB,BKOGRS                                                       
*                                                                               
         CLI   NETOPT,C'Y'         SEE IF DOING NET                             
         BNE   *+10                                                             
         ZAP   DUB,BKONET                                                       
*                                                                               
*        PLANNED COSTS ORDERED                                                  
*              EQUALS GROSS FOR BILLABLE MONTH                                  
*              IF MONTH BEFORE PC BILL START DATE                               
*              OR NOT AFTER ESTIMATE ACTUALIZATION DATE                         
*              ELSE USE PLANNED COSTS                                           
*                                                                               
         L     RE,ACONIO1          POINT TO BUCKET RECORD                       
         SR    RF,RF                                                            
         ICM   RF,3,10(RE)            GET ESTIMATE #                            
         MHI   RF,4                   CALCULATE INDEX INTO TABLE                
         A     RF,AACTDTES            POINT TO ACTUALIZATION DATES              
*                                                                               
         OC    0(2,RF),0(RF)       IF NO BILLING EFD                            
         BZ    RBKPC16                  SKIP                                    
*                                                                               
         CLC   BKYM,0(RF)             IF BEFORE PC BILLING START                
         BL    RBKPC16                   SKIP                                   
         CLC   BKYM,2(RF)             IF BEFORE ACTUALIZATION DATE              
         BH    RBKPC17                   USE PLANNED COSTS                      
*                                                                               
RBKPC16  DS    0H                                                               
*                                                                               
         B     RBKPC12             GO DO NEXT INS MTH PC BUCKET                 
*                                                                               
RBKPC17  DS    0H                                                               
*                                                                               
         AP    ACMPCGIM,DUB        GROSS - INS. MO                              
         AP    ACMPCGIM+ACCL,DUB                                                
*                                                                               
         B     RBKPC12             GO DO NEXT INS MTH PC BUCKET                 
*                                                                               
RBKPC25  DS    0H           NOW DO BILLING MTH PC BUCKETS                       
*                                                                               
         L     R4,ACONIO1          (A)PCONREC                                   
         LA    R4,33(R4)           BUCKET IS PCONREC                            
*                                                                               
         USING BKELEM,R4                                                        
*                                                                               
         MVI   ELCODE1,X'42'       LOOKING FOR REGULAR BUCKETS                  
*                                  IE BILL MONTH BUCKETS                        
         CLI   0(R4),X'42'                                                      
         BE    RBKPC27                                                          
*                                                                               
RBKPC26  BAS   RE,NEXTLR4                                                       
         BNE   RBKPC40                                                          
*                                                                               
RBKPC27  LA    R1,BKYM                                                          
         BAS   RE,FINDMO                                                        
*                                                                               
*        PLANNED COSTS ORDERED                                                  
*              EQUALS PC COSTS FOR BILLABLE MONTH                               
*              IF  MONTH AFTER PC BILL START DATE                               
*              AND MONTH AFTER ESTIMATE ACTUALIZATION DATE                      
*                                                                               
         L     RE,ACONIO1          POINT TO BUCKET RECORD                       
         SR    RF,RF                                                            
         ICM   RF,3,10(RE)            GET ESTIMATE #                            
         MHI   RF,4                   CALCULATE INDEX INTO TABLE                
         A     RF,AACTDTES            POINT TO ACTUALIZATION DATES              
*                                                                               
         OC    0(2,RF),0(RF)       SKIP IF NO BILLING EFD                       
         BZ    RBKPC6AC                                                         
*                                                                               
         CLC   BKYM,0(RF)          SEE IF PLANNED COSTS NEEDED                  
         BL    RBKPC6AC                  SKIP IF BEFORE PC BILL START           
*                                                                               
         CLC   BKYM,2(RF)                SKIP IF BEFORE ACT DATE                
         BNH   RBKPC6AC                                                         
*                                                                               
         ZAP   DUB,BKOGRS                                                       
*                                                                               
         CLI   NETOPT,C'Y'                                                      
         BNE   *+10                                                             
         ZAP   DUB,BKONET                                                       
*                                    R2 = A(ROW)                                
         AP    ACMPCGBM,DUB        PCORD IS PC GROSS FOR BILL MONTH             
         AP    ACMPCGBM+ACCL,DUB                                                
*                                                                               
RBKPC6AC DS    0H                                                               
*                                                                               
         B     RBKPC26               GO DO NEXT BILL MTH BUCKET                 
*                                                                               
         DROP  R4                                                               
*                                                                               
RBKPC40  DS    0H                                                               
*                                                                               
*                                                                               
RBKPC50  DS    0H                                                               
*                                                                               
ADDUPX   EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
         SPACE 3                                                                
NEXTEL   DS    0H                                                               
         SR    R0,R0                                                            
         IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTEL2                                                          
         CLC   ELCODE1,0(R2)                                                    
         BER   RE                                                               
         B     NEXTEL+2                                                         
NEXTEL2  LTR   R2,R2                                                            
         BR    RE                                                               
         SPACE 2                                                                
NEXTLR4  DS    0H                                                               
         SR    R0,R0                                                            
         IC    R0,1(R4)                                                         
         AR    R4,R0                                                            
         CLI   0(R4),0                                                          
         BE    NEXTLR4X                                                         
         CLC   ELCODE1,0(R4)                                                    
         BER   RE                                                               
         B     NEXTLR4+2                                                        
NEXTLR4X LTR   R4,R4                                                            
         BR    RE                                                               
*                                                                               
*                                  R1 = A(MONTH)                                
FINDMO   EQU   *                                                                
         LA    R2,MLIST                                                         
         L     R3,ACLTTOTS                                                      
FM2      CLC   0(2,R1),0(R2)                                                    
         BL    FM4                                                              
         BE    FM10                                                             
         LA    R2,2(R2)                                                         
         B     FM2                                                              
FM4      EQU   *                                                                
         CLI   0(R2),C'A'          EOL                                          
         BE    FM8                                                              
         LR    R2,R3               R2 = A(PRIOR ROW)                            
         B     FINDMX                                                           
FM8      EQU   *                                                                
         LA    R2,NMOS*ROWL+ROWL(R3)    R2 = A(SUBSQ ROW)                       
         B     FINDMX                                                           
FM10     EQU   *                                                                
         LA    R0,MLIST                                                         
         SR    R2,R0                                                            
         SRL   R2,R1                                                            
         MH    R2,=Y(ROWL)                                                      
         L     R3,ACLTTOTS                                                      
         LA    R2,ROWL(R2,R3)      R2 = A(ROW)                                  
         B     FINDMX                                                           
FINDMX   EQU   *                                                                
         BR    RE                                                               
         EJECT                                                                  
*                                                                               
GETBGST  NTR1                                                                   
         ZAP   MYGST,=P'0'                                                      
***GST                                                                          
         B     GETBGX                                                           
*                                                                               
         LA    R2,PBILLEL                                                       
         MVI   ELCODE1,X'0A'                                                    
         BAS   RE,NEXTEL                                                        
         BNE   GETBGX                                                           
         USING PBILVEL,R2                                                       
         ICM   R0,15,PBILLVAT                                                   
         CVD   R0,MYGST                                                         
*                                                                               
GETBGX   XIT1                                                                   
         DROP  R2                                                               
*                                                                               
         LTORG                                                                  
*                                                                               
         TITLE 'PP049-02  PRINTPAK AGENCY SUMMARY '                             
*                                  WORK AREA DSECT                              
GVALUESD DSECT                                                                  
       ++INCLUDE GVALUES                                                        
*                                                                               
PP49WRKD DSECT                                                                  
SAVR2    DS    F                                                                
MLIST    DS    CL120               60 MONTH LIST                                
MLISTX   DS    CL10                                                             
BSTART   DS    XL3                                                              
BEND     DS    XL3                                                              
PSTART   DS    CL6                                                              
PEND     DS    CL6                                                              
C2ACTIVE DS    CL1                                                              
SAVCOFF  DS    CL2                                                              
SVPRDEFD DS    XL2                 PRODUCT PC BILLING EFF DTE                   
MBKOPT   DS    H                                                                
MUPOPT   DS    H                                                                
BUYOPT   DS    C                                                                
NETOPT   DS    C                                                                
OPNOPT   DS    C                                                                
TSTOPT   DS    C                                                                
PRIOR    DS    X                                                                
SUBSQ    DS    X                                                                
HAVPRI   DS    X                                                                
HAVSUB   DS    X                                                                
DUBDUB   DS    PL16                                                             
HLDDAT   DS    CL8                                                              
HLDPCT   DS    CL5                                                              
TOTSW    DS    X                                                                
CDSW     DS    X                   0 = CD                                       
*                                  1 = NO CD                                    
STAGSW   DS    CL1                                                              
CLTACT   DS    X                                                                
OLDKEY   DS    CL32                                                             
CURMED   DS    C                                                                
WFID     DS    CL16                                                             
ACLIENT  DS    A                                                                
LASTOFF  DS    XL2                                                              
LASTPRD  DS    CL3                                                              
TODAY1   DS    CL6                                                              
DAY      DS    CL1                 BINARY DAY OF WEEK                           
DAYADJ   DS    H                                                                
BTODAY   DS    XL3                                                              
ELCODE1  DS    XL1                                                              
MYGST    DS    D                                                                
         DS    F                                                                
REQCRDH  DS    CL26                                                             
REQCRD   DS    CL80                                                             
HLDAGYC  DS    CL2                                                              
HLDAGYN  DS    CL33                                                             
HLDMEDN  DS    CL10                                                             
SVMEDNM  DS    CL10                                                             
SVMEDCD  DS    CL1                                                              
PCYN     DS    CL1                 C'N' - BUY HAS NO PLANNED COSTS              
*                                                                               
         DS    0F                                                               
SVOFCLST DS    CL32                                                             
B2BPROF  DS    CL16                B2B PROFILE FOR CLIENT                       
*                                                                               
ACLTTOTS DS    A                                                                
AAGYTOTS DS    A                                                                
ADDSTOTS DS    A                                                                
AWRKTOTS DS    A                                                                
AOFFTOTS DS    A                                                                
AAGYNAMS DS    A                                                                
ACLTTAB  DS    A                                                                
AESTLST  DS    A                                                                
AACTDTES DS    A                   A(ESTIMATE ACTUALIZATION DATES)              
AWFMOD   DS    A                                                                
APRNT    DS    A                                                                
PP49WFN  DS    A                                                                
AADDUP   DS    A                                                                
*                                                                               
ACONIO1  DS    A                   PCONREC ADDRESS FROM PPG                     
*                                                                               
VOFFICER DS    V                                                                
*                                                                               
         DS    2A            SPARE (8/05 - WAS 3A)                              
*                                                                               
         DS    0F                  ALIGNMENT                                    
PCVALUES DS    XL96                PLANNED COST GETINS RETURN                   
*                                                                               
       ++INCLUDE PPBVALD           NEW PPBVAL DSECT                             
*                                                                               
         SPACE 3                                                                
*                             MAGAZINE LINE DSECT                               
         SPACE 1                                                                
MLINED   DSECT                                                                  
MLINE    DS    0CL264                                                           
MDATE    DS    CL6                                                              
MPS      DS    CL2                                                              
         DS    CL1                                                              
MPCT     DS    CL5                                                              
MINORD   DS    CL15                                                             
MBLORD   DS    CL15                                                             
MCD      DS    CL12                                                             
MNET     DS    CL15                                                             
MPD      DS    CL15                                                             
MUNPD    DS    CL15                                                             
MBLD     DS    CL15                                                             
MUNBLD   DS    CL15                                                             
         DS    CL1                END OF LINE 1                                 
*        SECOND LINE                                                            
*                                                                               
         DS    CL9                                                              
TPCT     DS    CL5                                                              
         DS    CL15                                                             
TBLORD   DS    CL15                                                             
         DS    CL12                                                             
TNET     DS    CL15                                                             
         DS    CL15                                                             
TUNPD    DS    CL15                                                             
         DS    CL15                                                             
TUNBLD   DS    CL15                                                             
         DS    CL1                                                              
*                                                                               
         EJECT                                                                  
*                                                                               
BUCKEL   DSECT                                                                  
       ++INCLUDE DDBKELEM                                                       
*                                                                               
       ++INCLUDE DMWRKRK                                                        
         EJECT                                                                  
*                   ACCUMULATORS ARE STRUCTURED AS FOLLOWS                      
*                   GROSS - INS. MONTH                                          
*                   GROSS - BILL MONTH (NOT FOR NEWSPAPERS)                     
*                   CD                                                          
*                   PAID                                                        
*                   BILLED                                                      
*                   PC - GROSS - INS. MONTH                                     
*                   PC - GROSS - BILL MONTH                                     
*                   PC - GROSS - PLANNED/ORDERED                                
*                   PC - CD    - PLANNED/ORDERED                                
*                                                                               
*        SET OF ACCUMLATORS KEPT FOR                                            
*              PRIOR TO START DATE                                              
*              EACH OF 60 MONTHS - 5 YEARS                                      
*              SUBSEQUENT TO END DATE                                           
*              GRAND TOTAL FOR SUBTOTAL                                         
*              TODAY - GROSS                                                    
*              TODAY - NET                                                      
*              RUNDATE MONTH - GROSS                                            
*              RUNDATE MONTH - NET                                              
*              BILLED  FOR THIS SET OF ACCUMULATORS                             
*        TOTAL NUMBER SETS OF ACCUMULATORS = 68                                 
*        TOTAL NUMBER OF BUCKETS = NUMBER IN SET * NUMBER OF SETS               
*                                = ACMDN * 68                                   
*                  CURRENTLY     = 7 * 68 = 476                                 
*                                                                               
*                   (PL7 X 5 ) X (PRI + 60M + SUBS + TOT )                      
*                                 TODAY G + TODAY N + MONTH G +                 
*                                 MONTH N + BILLROW)= 35 X 68=2360              
*                                                                               
*                                                                               
PP4902   CSECT                                                                  
CLTTOTS  DS    0D                                                               
         DS    (ACCN)PL(ACMACML)                                                
         DS    (ACCN)PL(ACMACML)   FOR ALT TOTALS (NO CD)                       
         SPACE 3                                                                
AGYTOTS  DS    0D                                                               
         DS    (ACCN)PL(ACMACML)                                                
         DS    (ACCN)PL(ACMACML)                                                
*                                                                               
DDSTOTS  DS    0D                                                               
         DS    (ACCN)PL(ACMACML)                                                
         DS    (ACCN)PL(ACMACML)                                                
*                                                                               
WRKTOTS  DS    0D                                                               
         DS    (ACCN)PL(ACMACML)                                                
*                                                                               
OFFTOTS  DS    0D                                                               
         DS    (ACCN)PL(ACMACML)                                                
         DS    (ACCN)PL(ACMACML)                                                
*                                                                               
*                                                                               
*                                                                               
NMOS     EQU   60                  NUMBER OF MONTHS COVERED                     
ACCN     EQU   ACMDN*(NMOS+8)      NUMBER OF ACCUMULATORS IN SUBTOTAL           
ACCL     EQU   ACCN*ACMACML        LENGTH OF ACCUMULATORS IN SUBTOTAL           
ROWL     EQU   ACMDN*ACMACML       LENGTH OF BASIC ACCUMULATORS                 
*                                  # OF ACCUMULATORS IN ROW *                   
*                                  LENGTH OF AN ACCUMULATOR                     
TGROW    EQU   (NMOS+3)*ROWL                                                    
TNROW    EQU   (NMOS+4)*ROWL                                                    
MGROW    EQU   (NMOS+5)*ROWL                                                    
MNROW    EQU   (NMOS+6)*ROWL                                                    
TOTROW   EQU   (NMOS+2)*ROWL                                                    
         SPACE 3                                                                
AGYNAMS  DS    0D                                                               
         DC    A(*+4)              A(NEXT)                                      
         DS    100CL11             ROOM FOR 100 AGYMEDS                         
*                                  BYTES 0-2    MED/AGY                         
*                                        3-7    WF DISK ADDR                    
*                                        8-9    WF REC NO                       
*                                                                               
*                                                                               
CLTTAB   DS    0D                                                               
         DS    4000CL16            4000 CLIENTS                                 
         DS    X                                                                
*                                                                               
MAXCLTS  EQU   4000                                                             
*                                                                               
         DS    0F                                                               
ESTLST   DS    1000X                                                            
*                                                                               
ACTDTES  DS    1000XL4            LIST OF ESTIMATE ACTUALIZATION DATES          
*                                  BINARY - YM                                  
         SPACE 2                                                                
WRKRBUFF DS    0D                                                               
         DS    4096X                                                            
         SPACE 2                                                                
         EJECT                                                                  
***********************************************************************         
*                                                                     *         
*        DSECT FOR BASIC ACCUMULATORS                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
ACMD     DSECT                                                                  
*                                                                               
ACMACML  EQU 7                     SIZE OF ONE ACMUMULATOR                      
*                                                                               
ACMGRSIM DS    PL(ACMACML)         GROSS - INSERTION MONTH                      
ACMGRSBM DS    PL(ACMACML)         GROSS - BILL      MONTH                      
ACMCD    DS    PL(ACMACML)         CASH DISCOUNT                                
ACMPAID  DS    PL(ACMACML)         CLEARED                                      
ACMBLD   DS    PL(ACMACML)         BILLED                                       
ACMPCGIM DS    PL(ACMACML)         PC/ORDERED   - GROSS - INSERT MONTH          
ACMPCGBM DS    PL(ACMACML)         PC/ORDERED   - GROSS - BILL   MONTH          
ACMPCCD  DS    PL(ACMACML)         PC/ORDERED   - CASH DISCOUNT                 
*                                     DEPENDS ON ACTUALIZATION STATUS           
*                                                                               
ACMDL    EQU   *-ACMD              LENGTH OF BASIC ACMUMULATORS                 
ACMDN    EQU   ACMDL/(ACMACML)     NUMBER OF ACCMULATORS                        
*                                                                               
       ++INCLUDE DDOFFICED                                                      
         PRINT OFF                                                              
       ++INCLUDE DDCOMFACSD                                                     
*                                                                               
       ++INCLUDE PPREPWORK                                                      
*                                                                               
       ++INCLUDE PPREPWORK2                                                     
*                                                                               
       ++INCLUDE PPNEWFILE         HAVE NEW PBILLREC DSECT                      
       ++INCLUDE PPMODEQU                                                       
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'135PPREP4902 03/20/14'                                      
         END                                                                    

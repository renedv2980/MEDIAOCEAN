*          DATA SET SPB902S    AT LEVEL 046 AS OF 05/01/02                      
*CATALP SPB902                                                                  
         TITLE 'SPB902 - SPOT/RETAIL BILLING LINK REPORT'                       
         PRINT NOGEN                                                            
SPB902   CSECT                                                                  
         NMOD1 0,SPB902                                                         
         L     RA,0(R1)                                                         
         LA    R8,1(RA)                                                         
         LA    R8,4095(R8)                                                      
         USING SPWORKD,RA,R8                                                    
         LA    RC,SPACEND                                                       
         USING SPB9WRKD,RC                                                      
         LA    R3,GDAREA                                                        
         USING GDSECT,R3                                                        
*                                                                               
         CLI   MODE,PROCBUY                                                     
         BE    PRBUY                                                            
         CLI   MODE,ESTFRST                                                     
         BE    ESTF                                                             
         CLI   MODE,CLTFRST                                                     
         BE    CLTF                                                             
         CLI   MODE,CLTLAST                                                     
         BE    CLTL                                                             
         CLI   MODE,REQFRST                                                     
         BE    REQF                                                             
*                                                                               
EXIT     DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
*              FIRST FOR REQUEST                                                
         SPACE 2                                                                
REQF     DS    0H                                                               
*                                                                               
REQF10   DS    0H                                                               
*                                  RELOCATE ACONS                               
         RELOC RELO                                                             
         LA    R1,ACONLST                                                       
         LA    R2,ACONS                                                         
         LA    R0,(ACONSX-ACONS)/4                                              
*                                                                               
REQF12   DS    0H                                                               
         L     RF,0(R2)                                                         
         A     RF,RELO                                                          
         ST    RF,0(R1)                                                         
         LA    R1,4(R1)                                                         
         LA    R2,4(R2)                                                         
         BCT   R0,REQF12                                                        
*                                                                               
         MVC   NXTEST,AESTTAB                                                   
         MVC   NXTCLUST,ACLUSTAB                                                
         MVI   DASHES,C'-'                                                      
         MVC   DASHES+1(L'DASHES-1),DASHES                                      
*                             SET BINSRCH PARS FOR ECTAB                        
         SR    R0,R0                                                            
         L     R1,=A(ECTAB)                                                     
         A     R1,RELO                                                          
         SR    R2,R2                                                            
         LA    R3,ECTBL                                                         
         LA    R4,ECTBL                                                         
         LA    R5,ECTBN                                                         
         STM   R0,R5,ECPARS                                                     
*                                                                               
         MVI   FCRDBUYS,C'N'       NO BUYS                                      
         CLI   QOPT1,C'N'                                                       
         BE    *+8                                                              
         MVI   FCRDBUYS,C'Y'       READ BUYS                                    
         CLC   QEST,=C'ALL'                                                     
         BNE   *+10                                                             
         MVC   QEST,=C'NO '                                                     
         B     EXIT                                                             
         SPACE 3                                                                
*        FIRST FOR CLIENT                                                       
         SPACE 2                                                                
CLTF     DS    0H                                                               
         CLI   PROGPROF,0                                                       
         BNE   CLTF2                                                            
         MVC   P(35),=C'** B9 PROFILE INVALID OR NOT FOUND**'                   
         GOTO1 APRNT                                                            
         GOTO1 AENDREQ                                                          
CLTF2    DS    0H                                                               
         CLC   PROGPROF(3),LASTPROF     TEST SAME COMP,UNIT,LEDG                
         BE    CF26                    YES - SKIP ACCT READ                     
*                                                                               
         MVC   LASTPROF,PROGPROF                                                
         XC    GDSECT(GDSECTL),GDSECT                                           
*                                                                               
         MVC   GDMGRLEN,PROGPROF+3                                              
         MVI   GDMKTLEN,0                                                       
         CLI   PROGPROF+4,C'Y'                                                  
         BNE   *+8                                                              
         MVI   GDMKTLEN,4                                                       
         MVC   GDOUTLEN,PROGPROF+5                                              
*                                                                               
         MVC   GDCOMP,PROGPROF                                                  
         MVC   GDUNIT,PROGPROF+1                                                
         MVC   GDLEDG,PROGPROF+2                                                
*                                                                               
CF20     DS    0H                                                               
         MVC   GDCLUST(4),=C'NEXT'                                              
         MVC   GDDMGR,DATAMGR                                                   
         MVC   GDATABS,AFOTABS                                                  
         MVC   GDAUTL,UTL                                                       
         MVC   GDACCSYS,ACCTSE                                                  
         GOTO1 AFINDOUT,DMCB,GDSECT                                             
*                                                                               
         MVC   CLUSTDSC,GDMGRDSC   CLUSTER DESCRIPTION                          
         CLI   GDMKTLEN,0                                                       
         BE    *+10                                                             
         MVC   CLUSTDSC,GDMKTDSC                                                
*                                                                               
         OC    GDNSCHMS,GDNSCHMS                                                
         BNZ   CF24                                                             
         GOTO1 AENDREQ                                                          
*                                                                               
CF22     DS    0H                                                               
         MVC   GDCLUST(4),=C'NEXT'                                              
         GOTO1 AFINDOUT,DMCB,GDSECT                                             
*                                                                               
CF24     DS    0H                                                               
         CLC   GDCLUST(4),=C'LAST'                                              
         BE    CF26                                                             
*                                  CHECK VALIC CLUSTER                          
         ZIC   R0,GDMGRLEN                                                      
         ZIC   R1,GDMKTLEN                                                      
         AR    R0,R1                                                            
         LA    R1,GDCLUST                                                       
CF24A    DS    0H                                                               
         CLI   0(R1),C' '          WHOLE CLUSTER MUST BE NON-BLANK              
         BNH   CF22                                                             
         LA    R1,1(R1)                                                         
         BCT   R0,CF24A                                                         
         CLI   QOPT3,C'N'          SKIP OUTLET PRINT                            
         BE    CF24B                                                            
         GOTO1 APRTOUTS                                                         
CF24B    DS    0H                                                               
         MVI   GDOUTNO,0                                                        
         MVC   GDSCHM,SPACES                                                    
*                                                                               
*                                  SAVE CLUSTER NO. AND SHARES                  
         L     RF,NXTCLUST                                                      
         MVC   0(8,RF),GDCLUST                                                  
         LA    RF,8(RF)                                                         
         L     R1,GDNSCHMS                                                      
         L     RE,GDAOUTS                                                       
         LA    RE,GDOUTDL(RE)      POINT TO SHARES                              
         XC    0(256,RF),0(RF)                                                  
CF24D    DS    0H                                                               
         OC    0(4,RE),0(RE)                                                    
         BZ    *+8                                                              
         MVI   0(RF),1             SET SCHEME ACTIVE                            
         LA    RF,1(RF)                                                         
         LA    RE,4(RE)                                                         
         BCT   R1,CF24D                                                         
*                                                                               
*                                                                               
         L     RF,NXTCLUST                                                      
         L     R1,GDNSCHMS                                                      
         LA    RF,8(RF,R1)                                                      
         MVI   0(RF),X'FF'         SET EOL                                      
         ST    RF,NXTCLUST                                                      
*                                                                               
         B     CF22                                                             
*                                                                               
CF26     DS    0H                                                               
         CLI   GDMGRLEN,0          IF USING MGR'S                               
         BE    CF28                                                             
         CLI   QMGR,C' '           BUT NOT REQ'D BY MGR                         
         BNE   CF28                                                             
         MVI   FCRDBUYS,C'N'       SUPPRESS BUY READ                            
CF28     DS    0H                                                               
         MVI   FORCEHED,C'Y'                                                    
         XC    LASTPRD,LASTPRD                                                  
         XC    ECPARS+8(4),ECPARS+8    CLEAR EST TAB                            
         B     EXIT                                                             
         SPACE 3                                                                
*        FIRST FOR EST                                                          
         SPACE 2                                                                
ESTF     DS    0H                                                               
         CLC   =C'NO',QEST                                                      
         BE    ESTFA1                                                           
         BAS   RE,ESTFP                                                         
         B     EXIT                                                             
ESTFA1   DS    0H                                                               
         MVC   SVKEY,KEY                                                        
         L     RF,ADPRD                                                         
         MVC   KEY(25),0(RF)                                                    
*                                  READ ALL ESTS IN ESTLST                      
         LA    R5,ESTLST                                                        
         LA    R4,256                                                           
ESTFA2   DS    0H                                                               
         CLI   0(R5),0                                                          
         BE    ESTFA4                                                           
         MVC   KEY+7(1),0(R5)                                                   
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         BAS   RE,ESTFP                                                         
*                                                                               
ESTFA4   DS    0H                                                               
         LA    R5,1(R5)                                                         
         BCT   R4,ESTFA2                                                        
*                                                                               
         XC    ECPARS+8(4),ECPARS+8                                             
         MVC   KEY,SVKEY           RESTORE SEQ                                  
         GOTO1 HIGH                                                             
         B     EXIT                                                             
         SPACE 2                                                                
ESTFP    NTR1                                                                   
         CLC   PRD,LASTPRD                                                      
         BE    ESTF2                                                            
         MVC   LASTPRD,PRD                                                      
         MVC   MYHA,SPACES                                                      
         MVC   MYHB,EHEADA                                                      
         MVC   MYHC,EHEADB                                                      
         MVI   RCSUBPRG,20                                                      
         GOTO1 APRNT                                                            
         LA    R5,P                                                             
         MVI   SPACING,2                                                        
         LA    R6,132(R5)                                                       
         MVC   0(7,R5),=C'PRODUCT'                                              
         MVC   9(3,R5),PRD                                                      
         MVC   9(3,R6),DASHES                                                   
         CLI   9+2(R5),C' '                                                     
         BH    *+8                                                              
         MVI   9+2(R6),C' '                                                     
         MVC   13(24,R5),PRDNM                                                  
         MVC   13(24,R6),DASHES                                                 
         LA    R7,39(R5)                                                        
ESTF1    DS    0H                                                               
         CLI   0(R7),C' '                                                       
         BH    ESTF1B                                                           
         MVI   132(R7),C' '                                                     
         BCT   R7,ESTF1                                                         
ESTF1B   DS    0H                                                               
         GOTO1 APRNT                                                            
ESTF2    DS    0H                                                               
         L     R7,ADEST                                                         
         USING ESTHDR,R7                                                        
         LA    R4,P                                                             
         USING EPRTD,R4                                                         
         CLC   EPROF+1(2),SPACES                                                
         BNH   ESTF3                                                            
         L     R6,NXTEST                                                        
         USING ETABD,R6                                                         
         MVC   ETPRD,PRD                                                        
         MVC   ETEST,EKEYEST                                                    
         MVC   ETSCHM,EPROF+1                                                   
         LA    R6,ETABRL(R6)                                                    
         ST    R6,NXTEST                                                        
         MVI   0(R6),0                                                          
ESTF3    DS    0H                                                               
         MVC   EPEST,EST                                                        
         MVC   EPNAME,EDESC                                                     
         GOTO1 DATCON,DMCB,ESTART,(5,EPDATES)                                   
         GOTO1 (RF),(R1),EEND,(5,EPDATES+9)                                     
         MVI   EPDATES+8,C'-'                                                   
         MVC   EPSCHM,EPROF+1                                                   
         CLC   EPROF+1(2),SPACES                                                
         BH    ESTF3B                                                           
         MVC   EPSCHM-1(4),=C'NONE'                                             
         B     ESTF7                                                            
ESTF3B   DS    0H                                                               
         L     R0,GDNSCHMS                                                      
         LTR   R0,R0                                                            
         BZ    ESTF5                                                            
         L     RF,GDASCHMS                                                      
ESTF4    DS    0H                                                               
         CLC   0(2,RF),EPSCHM                                                   
         BE    ESTF6                                                            
         LA    RF,GDSCHMDL(RF)                                                  
         BCT   R0,ESTF4                                                         
*                                                                               
ESTF5    DS    0H                                                               
         MVC   EPSCHNAM(13),=C'**NOT FOUND**'                                   
         B     ESTF7                                                            
*                                                                               
ESTF6    DS    0H                                                               
         MVC   EPSCHNAM,4(RF)                                                   
*                                                                               
ESTF7    DS    0H                                                               
         GOTO1 APRNT                                                            
         B     EXIT                                                             
         DROP  R4                                                               
         DROP  R6                                                               
         SPACE 3                                                                
*        LAST FOR CLIENT                                                        
         SPACE 2                                                                
CLTL     DS    0H                                                               
         GOTO1 APRTSCHM                                                         
         B     EXIT                                                             
         SPACE 3                                                                
*        PROCESS BUY                                                            
         SPACE 2                                                                
PRBUY    DS    0H                                                               
         L     R7,ADBUY                                                         
         USING BUYREC,R7                                                        
*                                  CHECK IF EST/CLUSTER ALREADY TESTED          
         MVC   WORK,SPACES                                                      
         MVC   WORK(1),BUYKEST                                                  
         MVC   GDCLUST,SPACES                                                   
         CLI   GDMGRLEN,0                                                       
         BE    PB2                                                              
         ZIC   RF,GDMGRLEN                                                      
         ZIC   RE,MGR3LEN                                                       
         SR    RE,RF                                                            
         BNM   *+6                                                              
         SR    RE,RE                                                            
         LA    RE,MGR3+1(RE)                                                    
         BCTR  RF,R0                                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   GDMGR(0),0(RE)                                                   
PB2      DS    0H                                                               
         CLI   GDMKTLEN,0                                                       
         BE    *+10                                                             
         MVC   GDMKT,MKT                                                        
         MVC   WORK+1(8),GDCLUST                                                
         MVC   WORK+9(5),BUYMSTA                                                
         GOTO1 BINSRCH,ECPARS,(1,WORK)                                          
         OC    1(3,R1),1(R1)       TEST TABLE FULL                              
         BNZ   *+6                                                              
         DC    H'0'                                                             
         CLI   0(R1),1                                                          
         BNE   EXIT                ALREADY TESTED                               
*                                                                               
*              GET SCHEME FROM ESTTAB                                           
         L     R6,AESTTAB                                                       
         USING ETABD,R6                                                         
PB3      DS    0H                                                               
         CLI   0(R6),0                                                          
         BE    EXIT                                                             
         CLC   ETEST,BUYKEST                                                    
         BNE   PB4                                                              
         CLC   ETPRD,PRD                                                        
         BE    PB5                                                              
*                                                                               
PB4      DS    0H                                                               
         LA    R6,ETABRL(R6)                                                    
         B     PB3                                                              
*                                                                               
PB5      DS    0H                                                               
         CLC   ETSCHM,SPACES       NO SCHEME - SKIP                             
         BNH   EXIT                                                             
*                                                                               
         L     R4,GDASCHMS                                                      
         L     R0,GDNSCHMS                                                      
         LTR   R0,R0                                                            
         BNP   EXIT                NO SCHEMES                                   
*                                                                               
PB6      DS    0H                                                               
         CLC   ETSCHM,0(R4)                                                     
         BE    PB7                                                              
         LA    R4,GDSCHMDL(R4)                                                  
         BCT   R0,PB6                                                           
*                                                                               
         B     EXIT                INVALID SCHEME SKIP                          
*                                                                               
PB7      DS    0H                                                               
         L     R5,ACLUSTAB         SEE IF SCHEME DEFINED IN CLUSTER             
PB8      DS    0H                                                               
         CLC   WORK+1(8),0(R5)                                                  
         BE    PB9                                                              
         CLI   0(R5),X'FF'         EOL                                          
         BE    PB12                CLUSTER NOT DEFINED                          
*                                                                               
         L     R1,GDNSCHMS                                                      
         LA    R5,8(R5,R1)         NEXT CLUSTER                                 
         B     PB8                                                              
*                                                                               
PB9      DS    0H                                                               
         LR    RF,R4                                                            
         S     RF,GDASCHMS                                                      
         SR    RE,RE                                                            
         D     RE,=A(GDSCHMDL)                                                  
         LA    RF,8(R5,RF)                                                      
         CLI   0(RF),0             TEST SHARE FOR THIS SCHEME                   
         BNZ   EXIT                                                             
*                                                                               
         LA    R1,P                                                             
         MVC   0(37,R1),=C'** SCHEME XX (EST NNN) NOT DEFINED IN'               
         MVC   38(15,R1),CLUSTDSC                                               
         MVC   10(2,R1),0(R4)                                                   
         EDIT  (B1,ETEST),(3,18(R1))                                            
         MVC   54(4,R1),GDMGR                                                   
         MVC   59(4,R1),GDMKT                                                   
*                                                                               
         MVC   P+66(21),=C'MARKET=NNNN, STATION='                               
         GOTO1 MSUNPK,DMCB,BUYMSTA,P+73,P+87                                    
*                                                                               
         GOTO1 APRNT                                                            
         B     EXIT                                                             
*                                                                               
PB12     DS    0H                                                               
         LA    R1,P                                                             
         MVC   0(2,R1),=C'**'                                                   
         MVC   3(15,R1),CLUSTDSC                                                
         MVC   19(4,R1),GDMGR                                                   
         MVC   24(4,R1),GDMKT                                                   
         MVC   29(14,R1),=C'NOT DEFINED **'                                     
         MVC   44(9,R1),=C'(EST NNN)'                                           
         EDIT  (B1,ETEST),(3,49(R1))                                            
*                                                                               
         MVC   P+66(21),=C'MARKET=NNNN, STATION='                               
         GOTO1 MSUNPK,DMCB,BUYMSTA,P+73,P+87                                    
*                                                                               
         GOTO1 APRNT                                                            
         B     EXIT                                                             
         DROP  R6                                                               
         SPACE 3                                                                
EHEADA   DC    CL132'  EST   ESTIMATE NAME          ESTIMATE DATES     X        
               SCHEME  SCHEME NAME'                                             
EHEADB   DC    CL132'  ---   -------------          --------------     X        
               ------  -----------'                                             
         SPACE 3                                                                
*        ADDRESS CONSTANTS FOR RELOCATION                                       
         SPACE 2                                                                
ACONS    DS    0F                                                               
         DC    A(ESTTAB)                                                        
         DC    V(FINDOUT)                                                       
         DC    A(FOTABS)                                                        
         DC    A(CLUSTAB)                                                       
         DC    A(PRNT)                                                          
         DC    A(PRTOUTS)                                                       
         DC    A(PRTSCHMS)                                                      
ACONSX   EQU   *                                                                
         SPACE 3                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                  PRINT OUTLETS AND SHARES                     
         SPACE 2                                                                
PRTOUTS  CSECT                                                                  
         NMOD1 0,PRTOUTS                                                        
         LA    RC,SPACEND                                                       
         USING GDOUTD,R4                                                        
         MVI   FORCEHED,C'Y'                                                    
         OC    GDNOUTS,GDNOUTS                                                  
         BNZ   PD01                                                             
*                                                                               
         MVC   P(5),=C'** NO'                                                   
         MVC   P+6(15),GDOUTDSC                                                 
         MVC   P+22(8),=C'FOR THIS'                                             
         MVC   P+31(15),CLUSTDSC                                                
         GOTO1 APRNT                                                            
         B     PDX                                                              
*                                                                               
PD01     DS    0H                                                               
*                                  SET MGR AND MKT NAMES                        
         MVC   CLHEADA,SPACES                                                   
         MVC   CLHEADB,SPACES                                                   
*                                                                               
         MVC   CLHEADA(15),GDMGRDSC                                             
         MVC   CLHEADB(15),GDMKTDSC                                             
*                                                                               
         LA    RF,CLHEADA+15                                                    
PD01A    DS    0H                                                               
         CLI   0(RF),C' '                                                       
         BH    PD01D                                                            
         CLI   60(RF),C' '                                                      
         BH    PD01D                                                            
         BCT   RF,PD01A                                                         
*                                                                               
PD01D    DS    0H                                                               
         MVC   2(4,RF),GDMGR                                                    
         MVC   60+2(4,RF),GDMKT                                                 
*                                                                               
         MVC   8(36,RF),GDMGRNAM                                                
         MVC   60+8(36,RF),GDMKTNAM                                             
*                                  SET TOTAL FOR EACH SCHEME IN                 
*                                  'TOTAL' DISTRIBUTOR                          
PDA      DS    0H                                                               
         SR    R5,R5                                                            
PDA2     DS    0H                                                               
         L     R4,GDAOUTS          'TOTAL' ROW                                  
         LR    RF,R5                                                            
         SLL   RF,2                                                             
         LA    RE,GDOSHRS(RF)                                                   
         XC    0(4,RE),0(RE)        CLEAR THIS SHEME                            
         SR    R7,R7                                                            
PDA4     DS    0H                                                               
         A     R4,GDROWL           NEXT DISTRIBUTO                              
         CLI   0(R4),X'FF'                                                      
         BE    PDA6                                                             
         A     R7,GDOSHRS(RF)      TOTAL PCTS                                   
         B     PDA4                                                             
*                                                                               
PDA6     DS    0H                                                               
         ST    R7,0(RE)            SET IN TOTAL ROW                             
         LA    R5,1(R5)            NEXT SCHEME                                  
         C     R5,GDNSCHMS                                                      
         BL    PDA2                                                             
*                                                                               
*                                                                               
         SR    R5,R5                                                            
         MVI   RCSUBPRG,10                                                      
PD1      DS    0H                                                               
         ST    R5,FSCHM                 SAVE STARTING SCHEME                    
*                                       SET HEADLINES                           
         MVI   FORCEHED,C'Y'                                                    
         MVC   MYHA,SPACES                                                      
         MVC   MYHB,SPACES                                                      
         MVC   MYHC,SPACES                                                      
         MVC   MYHB(4),=C'CODE'                                                 
         MVC   MYHC(4),DASHES                                                   
         MVC   MYHB+7(15),GDOUTDSC                                              
         MVC   MYHC+7(15),DASHES                                                
         LA    RF,MYHB+7+15                                                     
PD1A     DS    0H                                                               
         CLI   0(RF),C' '                                                       
         BH    PD1A2                                                            
         MVI   132(RF),C' '                                                     
         BCT   RF,PD1A                                                          
*                                                                               
PD1A2    DS    0H                                                               
*                                  SET SCHEME CODES IN HEADLINES                
         LA    R7,SPP                                                           
         LA    R6,MYHB+32+6                                                     
PD1B     DS    0H                                                               
         C     R5,GDNSCHMS                                                      
         BNL   PD1F                DONE                                         
*                                                                               
*                                  TEST SCHEME USED IN THIS CLUSTER             
         L     R4,GDAOUTS          POINTS TO TOTAL FOR CLUSTER                  
         LR    RF,R5                                                            
         SLL   RF,2                                                             
         LA    RF,GDOSHRS(RF)                                                   
         OC    0(4,RF),0(RF)                                                    
         BNZ   PD1D                                                             
         LA    R5,1(R5)            SCHEME NOT USED - TRY NEXT                   
         B     PD1B                                                             
PD1D     DS    0H                                                               
         LR    RF,R5                                                            
         MH    RF,=Y(GDSCHMDL)                                                  
         A     RF,GDASCHMS                                                      
         MVC   1(2,R6),0(RF)                                                    
         MVC   132(4,R6),DASHES                                                 
         LA    R6,10(R6)                                                        
         LA    R5,1(R5)                                                         
         BCT   R7,PD1B                                                          
*                                                                               
PD1F     DS    0H                                                               
         L     R5,FSCHM            RESTORE TO FIRST SCHEME FOR PAGE             
         L     R4,GDAOUTS                                                       
         B     PD9                 SKIP FIRST LINE (CLUSTER)                    
*                                                                               
PD2      DS    0H                                                               
         LA    R6,P+7                                                           
         C     R4,GDAOUTS                                                       
         BNE   PD2B                                                             
         MVC   0(9,R6),=C'**TOTAL**'                                            
         B     PD5                                                              
PD2B     DS    0H                                                               
         MVC   P(L'GDOCODE),GDOCODE                                             
         GOTO1 CHOPPER,DMCB,(36,GDONAME),(26,(R6)),(C'P',2)                     
         CLI   GDONUM,C' '         TEST NUMBER USED                             
         BNH   PD4                                                              
         LA    R7,132+2(R6)                                                     
         CLI   132(R6),C' '                                                     
         BNH   PD3                                                              
*                                  FLOAT ON 2ND LINE                            
         LA    R7,132+26(R6)                                                    
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
*                                                                               
PD3      DS    0H                                                               
         MVI   1(R7),C'('                                                       
         MVC   2(L'GDONUM,R7),GDONUM                                            
         LA    R7,L'GDONUM+1(R7)                                                
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         MVI   1(R7),C')'                                                       
*                                                                               
PD4      DS    0H                                                               
*                                       ADDRESS LINES                           
         LA    R6,P2+7                                                          
         CLI   0(R6),C' '                                                       
         BNH   *+8                                                              
         LA    R6,132(R6)                                                       
         MVC   000(26,R6),GDOAL1                                                
         MVC   132(26,R6),GDOAL2                                                
         MVC   264(26,R6),GDOAL3                                                
         MVC   396(26,R6),GDOAL4                                                
*                                                                               
*                                       SCHEME SHARES                           
PD5      DS    0H                                                               
         LA    R6,P+32                                                          
         LA    R7,SPP              BCT - NO. PER LINE                           
         L     R5,FSCHM                                                         
PD6      DS    0H                                                               
         C     R5,GDNSCHMS                                                      
         BNL   PD8                                                              
*                                                                               
*                                  TEST SCHEME USED IN CLUSTER                  
         LR    RF,R5                                                            
         SLL   RF,2                                                             
         A     RF,GDAOUTS               CHECK IN TOTAL ROW                      
         LA    RF,GDOSHRS-GDOUTD(RF)                                            
         OC    0(4,RF),0(RF)                                                    
         BNZ   PD6B                                                             
         LA    R5,1(R5)                                                         
         B     PD6                                                              
*                                                                               
PD6B     DS    0H                                                               
         LR    RF,R5                                                            
         SLL   RF,2                                                             
         LA    RF,GDOSHRS(RF)                                                   
         EDIT  (B4,0(RF)),(10,0(R6)),2                                          
         LA    R5,1(R5)                                                         
         LA    R6,10(R6)                                                        
         BCT   R7,PD6                                                           
*                                                                               
PD8      DS    0H                                                               
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
*                                                                               
         C     R4,GDAOUTS          TEST HAVE JUST DONE CLUSTER TOTAL            
         BE    PD10                YES - DONE                                   
PD9      DS    0H                                                               
         A     R4,GDROWL           NEXT OUTLET                                  
         CLI   0(R4),X'FF'                                                      
         BNE   PD2                                                              
         L     R4,GDAOUTS          NOW DO CLUSTER TOTAL                         
         B     PD2                                                              
PD10     DS    0H                                                               
         C     R5,GDNSCHMS         TEST END OF SCHEMES                          
         BL    PD1                 NO                                           
*                                                                               
PDX      DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                  PRINT SCHEME LIST                            
         SPACE 2                                                                
PRTSCHMS CSECT                                                                  
         NMOD1 0,PRTSCHMS                                                       
         LA    RC,SPACEND                                                       
         SPACE 2                                                                
         MVI   FORCEHED,C'Y'                                                    
         MVI   RCSUBPRG,30                                                      
         MVC   MYHA,SPACES                                                      
         MVC   MYHB,SPACES                                                      
         MVC   MYHC,SPACES                                                      
*                                                                               
         USING GDSCHMD,R4                                                       
         L     R4,GDASCHMS                                                      
PS6      DS    0H                                                               
         CLI   0(R4),X'FF'                                                      
         BE    PS40                                                             
         GOTO1 APRNT                                                            
*                                  SCHEME CODE AND NAME                         
         MVC   P(2),GDSCODE                                                     
         MVC   P+4(15),GDSNAME                                                  
         MVC   P2(2),DASHES                                                     
         MVC   P2+4(15),DASHES                                                  
         LA    RF,P+19                                                          
PS8      DS    0H                                                               
         CLI   0(RF),C' '                                                       
         BH    PS10                                                             
         MVI   132(RF),C' '                                                     
         BCT   RF,PS8                                                           
*                                                                               
PS10     DS    0H                                                               
         MVI   SPACING,2                                                        
         MVI   ALLOWLIN,8                                                       
         GOTO1 APRNT                                                            
*                                  SEARCH ESTTAB FOR THIS SCHEME                
*                                                                               
         MVC   P+7(15),=C'ESTIMATES- NONE'                                      
         L     R5,AESTTAB                                                       
         USING ETABD,R5                                                         
         XC    LASTPRD,LASTPRD                                                  
PS12     DS    0H                                                               
         CLC   GDSCODE,ETSCHM                                                   
         BE    PS14                                                             
         CLI   0(R5),0             EOL                                          
         BE    PS16                                                             
PS13     DS    0H                                                               
         LA    R5,ETABRL(R5)                                                    
         B     PS12                                                             
*                                                                               
PS14     DS    0H                                                               
         CLC   ETPRD,LASTPRD                                                    
         BE    PS15B                                                            
         OC    LASTPRD,LASTPRD                                                  
         BZ    PS15                                                             
         GOTO1 APRNT                                                            
PS15     DS    0H                                                               
         XC    ELPAR1,ELPAR1                                                    
         MVC   P+18(3),ETPRD                                                    
         MVI   P+21,C'-'                                                        
         MVC   LASTPRD,ETPRD                                                    
*                                                                               
PS15B    DS    0H                                                               
         MVC   WORK(8),SPACES                                                   
         ZIC   R0,ETEST                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK(3),DUB                                                      
         GOTO1 SETFLD,ELPARS                                                    
         B     PS13                NEXT EST                                     
*                                                                               
PS16     DS    0H                                                               
         GOTO1 APRNT                                                            
*                                                                               
PS18     DS    0H                                                               
*                             SEARCH CLUSTAB FOR THIS SCHEME                    
*                                                                               
         ZIC   RF,GDMGRLEN                                                      
         ZIC   RE,GDMKTLEN                                                      
         AR    RF,RE                                                            
         BNP   PS40                NO MGR OR MKT                                
         BCTR  RF,R0                                                            
         ST    RF,CLPLEN           SET LENGTH                                   
*                                                                               
         GOTO1 APRNT                                                            
*                                                                               
         LA    RF,P                                                             
         LA    RE,CLUSTDSC+14                                                   
PS19     DS    0H                                                               
         CLI   0(RE),C' '                                                       
         BH    PS20                                                             
         LA    RF,1(RF)                                                         
         BCT   RE,PS19                                                          
*                                                                               
PS20     DS    0H                                                               
         MVC   0(15,RF),CLUSTDSC                                                
         MVC   P+15(15),SPACES                                                  
         MVC   P+15(7),=C'S- NONE'                                              
*                                                                               
         XC    CLPAR1,CLPAR1                                                    
         LA    R1,GDSCHMD                                                       
         S     R1,GDASCHMS                                                      
         SR    R0,R0                                                            
         D     R0,=A(GDSCHMDL)                                                  
         ST    R1,FULL             R1=DISP INTO SHARES                          
         L     R5,ACLUSTAB                                                      
PS22     DS    0H                                                               
         CLI   0(R5),X'FF'                                                      
         BE    PS30                                                             
         LA    RF,8(R5)                                                         
         A     RF,FULL             POINT TO SHARES FOR THIS SCHEME              
         CLI   0(RF),0                                                          
         BZ    PS26                SCHEME NOT USED                              
*                                                                               
         MVC   WORK(8),SPACES                                                   
         MVC   WORK(4),0(R5)      MGR                                           
         CLI   GDMKTLEN,0                                                       
         BE    PS24                                                             
         LA    RF,WORK                                                          
         ZIC   RE,GDMGRLEN                                                      
         AR    RF,RE                                                            
         MVI   0(RF),C'-'                                                       
         MVC   1(4,RF),4(R5)    MKT                                             
PS24     DS    0H                                                               
         GOTO1 SETFLD,CLPARS                                                    
*                                                                               
PS26     DS    0H                                                               
         L     R1,GDNSCHMS                                                      
         LA    R5,8(R5,R1)         NEXT CLUSTER                                 
         B     PS22                                                             
*                                                                               
PS30     DS    0H                                                               
         GOTO1 APRNT                                                            
*                                                                               
         LA    R4,GDSCHMDL(R4)                                                  
         B     PS6                                                              
*                                                                               
PS40     DS    0H                                                               
PSX      DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
         SPACE 3                                                                
ELPARS   DS    0F                                                               
ELPAR1   DC    A(0)                                                             
         DC    A(0)                                                             
         DC    F'22'                                                            
         DC    F'130'                                                           
         DC    F'2'                                                             
CLPARS   DS    0F                                                               
CLPAR1   DC    A(0)                                                             
         DC    A(0)                                                             
         DC    F'18'                                                            
         DC    F'130'                                                           
CLPLEN   DC    A(0)                                                             
         SPACE 3                                                                
*                                  SET N BYTES OF WORK IN MULTI-LINE            
*                                  LIST, SEPARATED WITH COMMAS                  
SETFLD   NTR1                                                                   
         OC    0(4,R1),0(R1)       TEST START                                   
         BNZ   SF4                 NO                                           
         LA    R5,P                YES - START WITH P                           
         ST    R5,4(R1)                                                         
         A     R5,8(R1)            PLUS START DISP                              
         B     SF20                                                             
SF4      DS    0H                  NOT FIRST ONE                                
         L     R5,0(R1)            A(PREV)                                      
         A     R5,16(R1)                                                        
         MVI   1(R5),C','                                                       
         LA    R5,2(R5)            POINT TO NEXT                                
         LA    R6,2(R5)                                                         
         A     R6,16(R1)                                                        
         S     R6,4(R1)                                                         
         C     R6,12(R1)           TEST OK ON THIS LINE                         
         BNH   SF20                                                             
*                                                                               
         L     R5,4(R1)            NEXT LINE                                    
         LA    R5,132(R5)                                                       
         LA    R0,P14+132                                                       
         CR    R5,R0                                                            
         BNH   SF8                                                              
         GOTO1 APRNT                                                            
         LA    R5,P                                                             
SF8      DS    0H                                                               
         ST    R5,4(R1)                                                         
         A     R5,8(R1)                                                         
*                                                                               
SF20     DS    0H                                                               
         MVC   0(8,R5),WORK                                                     
*                                                                               
         ST    R5,0(R1)            A(THIS ONE)                                  
SFX      DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                  PRINT LINK                                   
         SPACE 2                                                                
PRNT     CSECT                                                                  
         NMOD1 0,PRNT                                                           
         LA    RC,SPACEND                                                       
*                                                                               
         MVC   HEAD9,MYHA                                                       
         MVC   HEAD10,MYHB                                                      
         MVC   HEAD11,MYHC                                                      
*                                                                               
         CLI   RCSUBPRG,10                                                      
         BNE   PRT2                                                             
*                                                                               
         MVC   HEAD6(60),CLHEADA                                                
         MVC   HEAD7(60),CLHEADB                                                
*                                                                               
PRT2     DS    0H                                                               
         GOTO1 REPORT                                                           
*                                                                               
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
SPB9WRKD DSECT                                                                  
*                                                                               
ACONLST  DS    0F                                                               
AESTTAB  DS    A                                                                
AFINDOUT DS    A                                                                
AFOTABS  DS    A                                                                
ACLUSTAB DS    A                                                                
APRNT    DS    A                                                                
APRTOUTS DS    A                                                                
APRTSCHM DS    A                                                                
*                                                                               
RELO     DS    A                                                                
FSCHM    DS    F                                                                
MYHA     DS    CL132                                                            
MYHB     DS    CL132                                                            
MYHC     DS    CL132                                                            
CLHEADA  DS    CL60                                                             
CLHEADB  DS    CL60                                                             
SPP      EQU   10                                                               
NXTEST   DS    F                                                                
NXTCLUST DS    F                                                                
LASTPROF DS    XL16                                                             
DASHES   DS    CL25                                                             
CLUSTDSC DS    CL15                                                             
LASTPRD  DS    CL3                                                              
SAVSYS   DS    XL1                                                              
SVKEY    DS    CL32                                                             
ECPARS   DS    6F                                                               
         DS    0F                                                               
GDAREA   DS    CL256                                                            
         SPACE 2                                                                
ETABD    DSECT                                                                  
ETPRD    DS    CL3                                                              
ETEST    DS    XL1                                                              
ETSCHM   DS    CL2                                                              
ETABRL   EQU   *-ETABD                                                          
         SPACE 2                                                                
EPRTD    DSECT                                                                  
         DS    CL2                                                              
EPEST    DS    CL3                                                              
         DS    CL3                                                              
EPNAME   DS    CL20                                                             
         DS    CL3                                                              
EPDATES  DS    CL17                                                             
         DS    CL4                                                              
EPSCHM   DS    CL2                                                              
         DS    CL4                                                              
EPSCHNAM DS    CL15                                                             
         SPACE 2                                                                
*                                                                               
       ++INCLUDE FOLINKD                                                        
*                                                                               
*                                                                               
TABS     CSECT                                                                  
ESTTAB   DS    0F                                                               
         ORG   *+500*ETABRL                                                     
         DC    X'0000'                                                          
CLUSTAB  DS    0F                                                               
         ORG   *+120000                                                         
         DC    X'0000'                                                          
FOTABS   DS    0F                                                               
         ORG   *+80000                                                          
         DC    X'0000'                                                          
*                                                                               
ECTBL    EQU   14                                                               
ECTBN    EQU   3200                                                             
ECTAB    DS    0F                                                               
         ORG   *+(ECTBL*ECTBN)                                                  
         DC    X'0000'                                                          
*                                                                               
*                                                                               
         PRINT OFF                                                              
       ++INCLUDE SPREPWORKD                                                     
       ++INCLUDE SPGENEST                                                       
       ++INCLUDE SPGENBUY                                                       
       ++INCLUDE SPREPMODES                                                     
       ++INCLUDE DDLOGOD                                                        
         PRINT ON                                                               
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'046SPB902S   05/01/02'                                      
         END                                                                    

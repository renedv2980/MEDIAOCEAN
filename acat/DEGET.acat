*          DATA SET DEGET      AT LEVEL 014 AS OF 06/18/20                      
*PROCESS USING(WARN(15))                                                        
*CATALP DEGET                                                                   
DEGET    TITLE '-    DEMO FILES READ CONTROLLER'                                
*                                                                               
* MAY29/18     FIX DQTAB ENTRIES LABLES.                                        
*                                                                               
* MAR08/04     GET A(DEGET01) FROM COMFACS, NOT BY CALLING CALLOV.              
*                                                                               
* NOV17/03     READ TIME PERIOD DATA FOR CABLE NAD NETWORKS THAT                
*              DON'T HAVE PROGRAM DATA.                                         
*              FOR TBS REQUESTS AFTER SEP29/03, READ DATA FOR TBSN.             
*                                                                               
* MAY01/03     SUPPORT NEWEST OPTIMIZATION DCON RECORDS.  READ X'FF0F'          
*              DCON RECORDS AND POINT TO AGENCY ID MATCH.  IF X'FF0F'           
*              RECORDS NOT FOUND, NEWEST DEMADDR CODE TO BUILD DCON             
*              MUST NOT BE LOADED. IF SO, PROCEED AS NORMAL.                    
*                                                                               
* JAN03/01     BUG FIX UID DEFAULT SHOULD GO BACK AND RESET ITSELF              
* SEP29/00     UID DCON DEFAULT IS AGENCY DCON DEFAULT NOT SYSTEMS              
*                                                                               
* MAR07/97     SUPPORT FOR TIME CHANGE OPTION                                   
*                                                                               
* DEC17/96     CHECK ALPHA MARKET FOR STRATA DOWNLOAD                           
*                                                                               
* AUG06/96     EXPAND DEFAULT TIMES IN GETDQ ROUTINE FOR IUN FILE               
*                                                                               
* SEP19/95     SUPPORT READING REPDIR/REPFIL                                    
*                                                                               
* APR19/95     TEST BOOKTYPE IF INPUTTED IN GETMS CODE                          
*                                                                               
* JAN11/95     SUPPORT ALPHA-MKT TABLE IN HIGH-CORE                             
*                                                                               
* DEC30/94     USE NEW TABLES FOR CANADIAN NETWORK CONVERSIONS                  
*               ADD NEW NETWORKS                                                
*                                                                               
* OCT07/94     USE NEW QH EQUATES FOR ARBITRON RADIO DQTAB ENTRY                
*                                                                               
* SEP02/94     ENTRIES TO READ TP PROGRAM RECORDS (I-PTRS)                      
*                                                                               
* DEC09/92     SUPPORT GETMKN (GET MARKET NAMES) FUNCTION                       
*                                                                               
* SEP17/92     SUPPORT DAYPART FILE                                             
*                                                                               
* AUG31/92     CSI/BBM EXTENDED DAY LIST FOR JUL/92 AND SUBS.                   
*                                                                               
* AUG27/92     CSI DEFAULT MARKET FOR US STATIONS (CSIHOMT)                     
*                                                                               
* FEB19/92     SUPPORT ARB MPA FILE                                             
*                                                                               
* JAN14/92     FIX MARKET NUMBER FOR NSI COLORADO SPRINGS                       
*               (NSI SENT TA AS REG IN FEB/91)                                  
*                                                                               
* OCT09/91     ADD DAY/TIME LIST PROCESSING TO GETDQ                            
*                                                                               
* SEP27/91     CONVERT SPECIAL SPILL STATIONS FOR GETMS                         
*                                                                               
* AUG06/91     MAKE CHANGES FOR MPA                                             
*                                                                               
* JUN25/91     COUNT DAYS FOR UNEXPLODED TIME OPTION                            
*                                                                               
* MAR04/91     NSI HOME MARKET OVERRIDE FOR WJMN                                
*                                                                               
* FEB20/91     METERED MARKET EFFECTIVE BOOK FOR NSI SPOT TV                    
*                                                                               
* NOV26/90     FLAT FILE FOR NTI BOOKS                                          
*                                                                               
* JUL02/90     USE 5 CHAR CALL LETTERS FOR CALL LETTER CHANGES                  
*                IF 5 CHAR ENTERED                                              
*                                                                               
* JUN15/90     STOP XQH LOOKUP IF DBSELCLI= '=L'                                
*                SO THAT THE LAYOUT REPORT WILL WORK                            
*                                                                               
* APR01/90     DISASTER CONTROL FOR FILE LOAD CRAPPING OUT (SEE IO)             
*                                                                               
* MAR14/90     SUPPORT FOR CCF CABLE TAPES                                      
*                                                                               
* MAR10/90     SUPPORT FOR BBM/CSI SATTELITE AND REPEATER NETS                  
*                                                                               
* OCT03/89     SUPPORT FOR CSI ANGLO/FRANCO BOOKS                               
*                                                                               
* AUG23/89     BBM HOME MARKET OVERRIDES FOR LONDON MARKET                      
*                                                                               
* JUN20/89     FIX 7 MINUTE LOGIC. (RANDOMLY ACTIVATING E7MIN OPTION)           
*              USE ARB RADIO CALL LETTER CHANGES FOR BIRCH                      
*                                                                               
* MAY31/89     ADD 7 MIN OPTIONS. IE USE A QUARTER HOUR ONLY IF IT              
*              HAS MORE THAN 7 MINUTES ACTIVE.                                  
*                                                                               
* MAR07/89     HANDLE BBM HOME MARKET OVERRIDES SINCE BBM CAN'T                 
*              SEEM TO GET THE HOME STATION DEFINITIONS TO US IN                
*              TIME FOR THE LOAD.                                               
*                                                                               
* NOV22/88     HANDLE M-SAT AND SAT-SUN DAYS FOR RDP DAYPARTS                   
*                                                                               
* JUL07/88     HANDLE YEARLY HUT AUTHORIZATIONS PROPERLY                        
*                                                                               
* JAN13/88     FIX END OF DAY LOGIC (GETDQ12)                                   
*                                                                               
* DEC16/87     ADDED BOOK TYPE TO GETMS ROUTINE                                 
*                                                                               
* NOV04/87     ADDED BOOK TYPE TO GETMKB ROUTINE                                
         EJECT                                                                  
DEGET    RSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 DEGETL,**DEGET,RA,R9,RR=R8,CLEAR=YES                             
         USING DEGETD,RC           RC=A(W/S)                                    
         ST    RB,BASE1                                                         
         ST    RA,BASE2                                                         
         ST    R9,BASE3                                                         
         ST    R1,APARM            SAVE PLIST ADDRESS                           
         ST    R8,RELO             SAVE PROGRAM RELOCATION FACTOR               
         MVC   ROOTRD,4(RD)        SAVE W/S LINK-BACK                           
         L     R6,0(R1)                                                         
         USING DBLOCKD,R6          R6=A(DBLOCK)                                 
         MVI   NOHARD,1            1= SOFT DEMO, 0=HARD CODE (LIVE)             
*                                                                               
         BRAS  RE,INIT             INITIALISE ALL VALUES NECESSARY              
*                                                                               
         CLC   =C'SIN S',DBSELSTA                                               
         BE    *+14                                                             
         CLC   =C'ITN S',DBSELSTA                                               
         BNE   *+20                                                             
         MVC   SVSELDUR,DBSELDUR                                                
         MVI   DBSELDUR,X'FF'      ALL DURATIONS FOR ITN                        
         XC    DBSELTIM,DBSELTIM                                                
*                                                                               
         MVI   PRELIMOK,C'N'       DEFAULT IS NO PRELIM DATA                    
         CLI   DBSELMED,C'T'                                                    
         BNE   PREEQC                                                           
LCBTCHKX DS    0C                                                               
*                                                                               
* CHECK FOR FUSION LPM MARKETS AND REDIRECT TO NSI WIRED                        
         GOTO1 VSUBR01,DMCB,('FUSCHKQ',(RC))   CHECK FOR FUSION TO NSI          
******************************************************                          
         GOTO1 VSUBR01,DMCB,('STALNKQ',(RC))   CHECK FOR STATION LINK           
*                                                                               
* STOP OUT OF RANGE BTYPE P                                                     
         OC    DBSELBK,DBSELBK     LATEST BOOK                                  
         BZ    PREEQUX             BECAUSE OF NEW PPM MARKETS                   
         CLC   DBSELBK,=AL2(MAY_01) BEFORE P BOOK                               
         BL    PRECHKP                                                          
         CLC   DBSELBK,=AL2(MAY_02) AFTER P BOOK                                
         BL    PREEQUX                                                          
PRECHKP  CLI   DBBTYPE,C'P'                                                     
         BNE   PREEQUX                                                          
         CLC   DBSELBK,=AL2(SEP_03) ALLOW P BOOK TYPE AFTER SEP/03              
         BH    PREEQUX              TEST DATA FOR LA,CHI,NY                     
         MVI   DBBTYPE,0                                                        
         B     PREEQUX                                                          
*                                                                               
PREEQC   CLI   DBSELMED,C'C'       CANADA?                                      
         BNE   PREEQUX                                                          
PREEQCL  DS    0C                  SWITCH SOURCE TO BBM > JAN/08                
*                                                                               
         CLI   DBFUNCT,DBTSTACS    BUT NOT FOR THESE FUNCTIONS                  
         BE    PREEQCL1                                                         
         CLI   DBFUNCT,DBGETMKN                                                 
         BE    PREEQCL1                                                         
         CLI   DBFUNCT,DBGETMK                                                  
         BE    PREEQCL1                                                         
         CLI   DBFUNCT,DBGETMS                                                  
         BE    PREEQCL1                                                         
         CLI   DBFUNCT,DBGETMB                                                  
         BE    PREEQCL1                                                         
         CLI   DBFUNCT,DBGETSM                                                  
         BE    PREEQCL1                                                         
         CLI   DBFUNCT,DBGETMKB                                                 
         BE    PREEQCL1                                                         
         CLI   DBFUNCT,DBCNVA2N                                                 
         BE    PREEQCL1                                                         
         CLI   DBFUNCT,DBCNVN2A                                                 
         BE    PREEQCL1                                                         
         CLI   DBFUNCT,DBVLST                                                   
         BE    PREEQCL1                                                         
*                                                                               
         CLC   DBSELBK,=X'0000'    LET'S USE BBM FOR LATEST                     
         BE    *+14                                                             
         CLC   DBSELBK,=AL2(JAN_08) LET'S USE BBM AFTER 2008                    
         BL    PREEQCL1                                                         
         CLI   DBSELSRC,C'N'                                                    
         BNE   PREEQCL1                                                         
         MVI   DBBTYPE,C'W'        BBM WEEKLY NEEDS A BOOK TYPE                 
         MVI   DBSELSRC,C'A'                                                    
*                                                                               
PREEQCL1 CLI   DBFUNCT,DBCNVA2N                                                 
         BE    PREEQUX                                                          
         CLI   DBFUNCT,DBCNVN2A                                                 
         BE    PREEQUX                                                          
         MVC   DUB+3(2),DBSELMK                                                 
************************************************************                    
* THIS SECTION OF THE CODE DETERMINES THE NEED FOR SPILL MKT                    
* BASED ON STATION CALL LETTERS.   IF A STATION IS HOME TO                      
* THE MARKET ATTACHED, WE WILL STRIP OFF THE MARKET.  *SOFT*                    
* WE USED TO DO THIS FOR MONTHLY DATA ONLY, NOW WE DO IT                        
* FOR WEEKLY AS WELL.  (MOF/TOR/VAN/CAL)  HOWEVER, MOF ARE                      
* ALL SPILL STATIONS.   SEAN.    3/2008                                         
************************************************************                    
*                                                                               
PREEQC01 L     R8,DBCOMFCS                                                      
         USING COMFACSD,R8         R8=A(COMFACS)                                
         CLC   DBSELMK,=H'0'       NUMERIC MARKET PASSED                        
         BNE   PREEQC02                                                         
         CLI   DBSELALF,0          ALPHA MARKET PASSED                          
         BE    PREEQUX              NO - IT OK FOR NOW                          
         CLI   DBSELSRC,C'A'       BBM                                          
         BNE   PREEQUX                                                          
         XC    DUB,DUB                                                          
         MVC   DUB(3),DBSELALF     SET FOR ALPHA CONVSN                         
         MVC   DUBSV(1),DBINTMED                                                
         MVC   DUBSV+1(1),DBACTSRC                                              
         MVI   DBINTMED,C'C'                                                    
         MVI   DBACTSRC,C'A'                                                    
         LR    R3,RE                                                            
         BRAS  RE,TRAMKT           TRANSLATE ALPHAMKT TO NUMERIC MKT            
         LR    RE,R3                                                            
         MVC   DBINTMED,DUBSV                                                   
         MVC   DBACTSRC,DUBSV+1                                                 
*                                                                               
PREEQC02 GOTO1 CDEMTABS,DMCB,HOMESTA                                            
         ICM   R3,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)                                                         
         USING HOMESTAD,R3                                                      
PREEQC04 CLC   HOMEMKT,=X'FFFF'    END OF LIST - IT'S NOT ON                    
         BE    PREEQUX              DEMO FILE AS HOME                           
         CLC   HOMEMKT,DUB+3       NEEDS TO BE SAME MARKET                      
         BNE   PREEQC05                                                         
         CLC   DBSELSTA(4),HOMECALL AND STATION                                 
         BE    PREEQC06                                                         
PREEQC05 AR    R3,R0               NOT FOUND - TRY NEXT                         
         B     PREEQC04                                                         
**********************************************************************          
PREEQC06 CLC   HOMEBK,=X'0000'     IS THERE AN EFFECTIVE DATE?                  
         BE    PREEQC10                                                         
         OC    DBSELBK,DBSELBK     LATEST WILL ALWAYS QUALIFY                   
         BZ    PREEQC10                                                         
*** CHECK EFFECTIVE DATE ***                                                    
         CLI   DBBTYPE,C'W'        NEED TO TO MONTH<->WKS COMPARE               
         BE    PREEQC07                                                         
         CLC   DBFILE(3),=C'TP '   TP IS MONTHLY, STRAIGHT COMPARE              
         BE    PREEQC09                                                         
*                                                                               
PREEQC07 XC    DUBSV,DUBSV         DUBSV IS FREE HERE                           
         MVC   DUBSV(2),HOMEBK                                                  
         MVI   DUBSV+2,15          EX: X'990315'                                
         GOTO1 CDATCON,DMCB,(3,DUBSV),(0,WORKSV)                                
         L     RF,=V(GETBROAD)                                                  
         A     RF,RELO             WORKSV+6 = FIRST WEEK OF MONTH               
         GOTO1 (RF),DMCB,(X'01',WORKSV),WORKSV+6,CGETDAY,CADDAY                 
         L     RF,=V(NETWEEK)                                                   
         A     RF,RELO             DMCB+8 = WEEK# OF FIRST WEEK                 
         GOTO1 (RF),DMCB,WORKSV+6,CGETDAY,CADDAY                                
         MVC   SAVEBOOK(1),DMCB+4                                               
         MVC   SAVEBOOK+1(1),DMCB+8                                             
         CLC   DBSELBK,SAVEBOOK                                                 
         B     *+10                                                             
PREEQC09 CLC   DBSELBK,HOMEBK                                                   
         BL    PREEQUX             DOES NOT QUALIFY VS BOOK                     
PREEQC10 DS    0H                                                               
         XC    DBSELALF,DBSELALF   HOME TO MARKET - ZAP ALPHA                   
         XC    DBSELMK,DBSELMK                                                  
         DROP  R8                                                               
*                                                                               
*                                  EQUIVALENCE FOR LATEST BOOK                  
*                                                                               
PREEQUX  DS    0C                                                               
*                                                                               
         MVI   SPNETFLG,0          IF DBLOCK: DBSELMED=N                        
         CLI   DBSELMED,C'N'                  DBFILE=TP/PAV                     
         JNE   NOSPNET                        DBSELSRC=H/D/K/C                  
         CLC   DBFILE(3),=C'TP '   THEN, SET SPNETFLG  SPT/REP->NETWK           
         JE    *+18                                                             
         CLC   DBFILE(3),=C'PAV'                                                
         JNE   NOSPNET                                                          
*                                                                               
         MVI   SPNETFLG,SPNETPV                                                 
         CLI   DBSELSRC,SRCNHT     IDENTIFY FILE RQSTD FROM DBSELSRC            
         JNE   *+8                                                              
         OI    SPNETFLG,SPNHTQ     NHTI                                         
         CLI   DBSELSRC,SRCNAD                                                  
         JNE   *+8                                                              
         OI    SPNETFLG,SPNADQ     NAD MONTHLY                                  
         CLI   DBSELSRC,SRCNTI                                                  
         JNE   *+8                                                              
         OI    SPNETFLG,SPNTIQ     NTI POCKETPIECE                              
         CLI   DBSELSRC,SRCCBL                                                  
         JNE   *+8                                                              
         OI    SPNETFLG,SPCBLQ     NTI CABLE                                    
         MVC   SRCNET,DBSELSRC     SET SOURCE                                   
*                                                                               
         TM    SPNETFLG,X'7F'      MAKE SURE A FILE WAS SET                     
         JNZ   *+12                                                             
         MVI   SPNETFLG,0          IF NOT, KILL FLAGS                           
         MVI   SRCNET,0                                                         
*                                                                               
NOSPNET  CLI   SPNETFLG,0          IF SPOT-NETWK REQUEST,LET IT GO THRU         
         JNE   *+24                                                             
         CLC   DBFILE,=C'RLD'      RLD USES DYTM                                
         JE    *+14                                                             
         CLC   DBFILE,=C'NTI'      NET FILE ONLY SUPPORT                        
         JNE   DEMAND10                                                         
         USING DBXTLD,RE                                                        
         ICM   RE,15,DBEXTEND      SCAN FOR DAY/TIME LIST                       
GDTLIST1 JZ    GDTLIST2            OUT IF NO DAY/TIME LIST                      
         CLC   0(4,RE),=C'DYTM'                                                 
         JE    *+12                                                             
         ICM   RE,15,DBXTLNXT                                                   
         J     GDTLIST1                                                         
         ST    RE,ADTLIST          SAVE DAY TIME LIST ADDR                      
         MVI   DBXTLIDX,0          RESET INDEX TO BEGINNING                     
         DROP  RE                                                               
GDTLIST2 ICM   RE,15,DBEXTEND      BACK TO START OF EXTENSIONS                  
         SPACE                                                                  
DEMAND1  JZ    DEMAND10            SCAN FOR NETWORK CONTROL LIST                
         CLC   0(4,RE),=C'NETW'                                                 
         JE    *+12                                                             
         ICM   RE,15,4(RE)                                                      
         J     DEMAND1                                                          
*                                                                               
         USING DBXNTID,RE                                                       
         CLI   DBSELBK,93          ALL FLAT AFTER 93                            
         JH    DEMAND10                                                         
         CLI   DBXNFFBK,C'Y'                                                    
         JNE   DEMAND10                                                         
         DROP  RE                                                               
         CLI   DBSELBK,0           LATEST BOOK                                  
         JE    DEMAND10                                                         
         L     RE,=A(YRINDX)                                                    
         A     RE,RELO                                                          
DEMAND2  CLC   DBSELBK(1),0(RE)    EXCEPTION YEAR                               
         JE    *+8                                                              
         CLI   0(RE),X'FF'         DEFAULT                                      
         JE    *+12                                                             
         LA    RE,3(RE)                                                         
         J     DEMAND2                                                          
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,3,1(RE)          CONVERT THE WEEK                             
         L     RE,=A(YRINDX)                                                    
         A     RE,RELO                                                          
         AR    RE,RF                                                            
         ZIC   RF,DBSELBK+1                                                     
         BCTR  RF,0                                                             
         AR    RE,RF                                                            
         MVC   DBSELBK+1(1),0(RE)                                               
*                                                                               
DEMAND10 L     R1,APARM                                                         
         MVC   AUSERRTN,4(R1)      SAVE A(USER HOOK)                            
         XC    ATRCRTN,ATRCRTN                                                  
         CLC   8(4,R1),=C'*IO*'                                                 
         JNE   *+10                                                             
         MVC   ATRCRTN,12(R1)      SAVE A(USER TRACE ROUTINE)                   
         CLI   DBFULTRK,C'Y'                                                    
         JNE   *+8                                                              
         MVI   DBFULTRK,X'10'                                                   
         L     R8,DBCOMFCS                                                      
         USING COMFACSD,R8         R8=A(COMFACS)                                
         MVI   DBERROR,0           RESET ERROR CODE                             
         MVI   DBERRMOD,EDEMAND                                                 
         XC    ACONHDR,ACONHDR                                                  
DEMAND12 MVI   NEWDSEQ,C'N'                                                     
         TM    DBMODE,DBMDSEQ      TEST USER BROKE READ SEQUENCE                
         JZ    *+12                                                             
         MVI   NEWDSEQ,C'Y'        SET DMREAD OF LAST RECORD REQD.              
         NI    DBMODE,X'FF'-DBMDSEQ                                             
         CLC   DBFUNCT,DBLSTFNC    TEST IF CHANGE OF FUNCTION                   
         JE    *+8                                                              
         MVI   DBMODE,DBMFRST      YES - RESET CONTROL MODE                     
         CLI   DBMODE,DBMNEXT      TEST IF SEQUENTIAL CALL                      
         JE    DEMGO                                                            
         MVI   DBMODE,DBMFRST                                                   
         MVI   NEWDSEQ,C'N'                                                     
*                                  CLEAR DBLOCK CONTROL VALUES                  
         XC    DBNUMVLS,DBNUMVLS                                                
         XC    DBFACTOR,DBFACTOR                                                
         XC    DBDIVSOR,DBDIVSOR                                                
         XC    DBLASTS,DBLASTS                                                  
         XC    DBACTUAL,DBACTUAL                                                
         BRAS  RE,NAMECHG          HANDLE NTI NETWORK NAME CHANGES              
*                                                                               
         CLC   DBSELSTA,=C'KMPHL'  LOW POWER CALL EQUATES                       
         BNE   *+10                                                             
         MVC   DBSELSTA,=C'KM58T'                                               
*                                                                               
         OC    DBSELSTA,DBSELSTA                                                
         BZ    DEM2                                                             
****** CAN I TAKE THIS OUT ? NSIHOM TABLE IS ONE ENTRY OF X'FF'                 
*&&DO                                                                           
         CLI   DBSELMED,C'T'       US SPOT TV                                   
         BNE   *+8                                                              
         CLI   DBSELSRC,C'N'       AND NSI                                      
         BNE   DEM001                                                           
         GOTO1 VSUBR01,DMCB,('NSIHOMQ',(RC))                                    
*&&                                                                             
DEM001   CLI   DBSELMED,C'C'       IF IT IS CANADIAN                            
         BNE   DEM1                                                             
         GOTO1 VSUBR01,DMCB,('GLOBALQ',(RC))                                    
****** CAN I TAKE THIS OUT ? CSI AND BBM HOMETAB HAVE X'FF'                     
*&&DO                                                                           
         CLI   DBSELSRC,C'A'                                                    
         BNE   DEM001A                                                          
         GOTO1 VSUBR01,DMCB,('BBMHOMQ',(RC))   THIS IS DEAD                     
DEM001A  CLI   DBSELSRC,C'N'                                                    
         BNE   DEM001B                                                          
         GOTO1 VSUBR01,DMCB,('CSIHOMQ',(RC))                                    
                                                                                
*&&                                                                             
DEM001B  OC    DBSELBK,DBSELBK     AFTER AUG/00                                 
         BZ    DEM001D             THERE IS NO COMBINED AGLO/FRANC              
         CLC   DBSELBK,=AL2(AUG_00) SO FORCE THE FLAG                           
         BH    DEM001D                                                          
         CLI   DBFRANCO,C'Y'       ENGLISH AND FRENCH CONVERSION                
         BNE   DEM1                                                             
DEM001D  MVI   DBFRANCO,C'Y'                                                    
         GOTO1 VSUBR01,DMCB,('CNVENGQ',(RC))                                    
*                                                                               
DEM1     CLI   DBSELSRC,C'F'       IF IT IS FUSION                              
         BE    *+8                                                              
         CLI   DBSELSRC,C'R'       IF IT IS RENTRAK                             
         BE    *+8                                                              
         CLI   DBSELMED,C'N'       IF IT IS NETWORK                             
         BNE   DEM2                                                             
         CLI   SPNETFLG,0                                                       
         BE    *+12                                                             
         TM    SPNETFLG,SPCBLQ     CABLE REQUEST?                               
         BNO   *+12                                                             
         BRAS  RE,CABLE            CHECK FOR CABLE BOOK                         
         BRAS  RE,CABNUM                                                        
*                                                                               
*                                  VALIDATE FUNCTION                            
DEM2     L     RE,=A(FUNCTAB)        RE=A(FUNCTION TABLE)                       
         A     RE,RELO                                                          
DEM4     CLI   0(RE),EOT           LOOK-UP DBFUNCT IN TABLE                     
         BNE   *+12                                                             
         MVI   DBERROR,INVCMND                                                  
         B     DEMX                                                             
         CLC   DBFUNCT,0(RE)                                                    
         BE    *+12                                                             
         LA    RE,L'FUNCTAB(RE)                                                 
         B     DEM4                                                             
         MVC   FUNCVALS,1(RE)      SAVE FUNCTION VALUES IN W/S                  
         XC    INTFMS,INTFMS                                                    
*                                                                               
         TM    FUNCINDS,FOVER      APPLY FUNCTION FILE/MED/SRC ORRIDES          
         BZ    *+10                                                             
         MVC   INTFIL,FUNCFIL                                                   
         TM    FUNCINDS,MOVER                                                   
         BZ    *+10                                                             
         MVC   INTMED,FUNCMED                                                   
         CLI   DBSELSRC,C'F'       FUSION IS NOT REALLY CABLE                   
         BE    DEM5                                                             
         OC    DBCABNUM,DBCABNUM                                                
         BZ    *+8                                                              
         MVI   INTMED,C'C'                                                      
*                                                                               
DEM5     CLI   DBSELSRC,C'R'       IF ASKING FOR RENTRAK DATA                   
         BNE   *+12                SET THE MEDIA CODE TO R                      
         MVI   INTMED,C'R'         AND NIELSEN TO N                             
         MVI   INTSRC,C'N'                                                      
*                                                                               
         TM    FUNCINDS,SOVER                                                   
         BZ    *+10                                                             
         MVC   INTSRC,FUNCSRC                                                   
*                                                                               
         CLI   SPNETFLG,0          SPOT-NET LK UP?                              
         BE    *+14                                                             
         MVC   INTSRC,SRCNET       SET OVERRIDES                                
         MVI   INTMED,C'N'                                                      
*                                  VALIDATE OR LOCATE FILE VALUES               
         L     RE,=A(FILETAB)        RE=A(FILE TABLE)                           
         A     RE,RELO                                                          
DEM6     CLI   0(RE),EOT           LOOK-UP INTERNAL/EXTERNAL FILE               
         BNE   *+12                                                             
         MVI   DBERROR,INVFILE                                                  
         B     DEMX                                                             
         CLI   INTMED,0            ANY MEDIA OVERRIDE?                          
         BE    *+10                                                             
         CLC   INTMED,7(RE)        TEST MEDIA OVERRIDE                          
         BNE   DEM10                                                            
*                                                                               
         CLI   INTSRC,0            TEST SRC OVERRIDE                            
         BE    *+10                                                             
         CLC   INTSRC,8(RE)        TEST IF SOURCE OVERRIDE                      
         BNE   DEM10                                                            
*                                                                               
         CLI   INTFIL,0            TEST IF FUNCTION FILE OVRIDE                 
         BE    DEM8                                                             
         CLC   INTFIL,6(RE)        YES - MATCH ON INTERNAL FILE                 
         BNE   DEM10                                                            
         BE    DEM12                                                            
DEM8     CLC   DBFILE,0(RE)        NO - MATCH ON EXTERNAL FILE                  
         BE    DEM12                                                            
*                                                                               
DEM10    LA    RE,L'FILETAB(RE)                                                 
         B     DEM6                                                             
DEM12    MVC   FILEVALS,3(RE)                                                   
         MVC   INTFIL,FILEFIL                                                   
*                                                                               
         CLI   DBSELMED,C'U'       COUNTY COVERAGE WE WANT TO READ              
         BNE   *+10                EVERTHING AS CUN FOR FMS                     
         MVC   INTFIL,DBFILE       OR RUA FOR RADIO                             
*                                                                               
         CLI   INTMED,0            APPLY FILE MEDIA/SOURCE ORRIDES              
         BNE   DEM14                                                            
         TM    FILEINDS,MOVER                                                   
         BZ    DEM14                                                            
         MVC   INTMED,FILEMED                                                   
DEM14    CLI   INTSRC,0                                                         
         BNE   DEM16                                                            
         TM    FILEINDS,SOVER                                                   
         BZ    DEM16                                                            
         MVC   INTSRC,FILESRC                                                   
*                                                                               
DEM16    CLI   INTMED,0            GET DEFAULT MEDIA (IF NOT SET)               
         BNE   DEM18                                                            
         MVC   INTMED,DBSELMED                                                  
         CLI   INTMED,C'A'                                                      
         BNL   DEM18                                                            
         MVC   INTMED,FILEMED                                                   
         CLI   INTMED,C'A'                                                      
         BNL   DEM18                                                            
         MVC   INTMED,FUNCMED                                                   
         CLI   INTMED,C'A'                                                      
         BNL   DEM18                                                            
         MVI   DBERROR,INVMED                                                   
         B     DEMX                                                             
*                                                                               
DEM18    CLI   INTSRC,0            GET DEFAULT SOURCE (IF NOT SET)              
         BNE   DEM20                                                            
         MVC   INTSRC,DBSELSRC                                                  
         CLI   INTSRC,C'A'                                                      
         BNL   DEM20                                                            
         MVC   INTSRC,FILESRC                                                   
         CLI   INTSRC,C'A'                                                      
         BNL   DEM20                                                            
         MVC   INTSRC,FUNCSRC                                                   
         CLI   INTSRC,C'A'                                                      
         BNL   DEM20                                                            
         MVI   DBERROR,INVSRC                                                   
         B     DEMX                                                             
*                                  VALIDATE FILE/MEDIA/SOURCE COMBO             
DEM20    L     RE,=A(FMSTAB)       RE=A(FMS TABLE)                              
         A     RE,RELO                                                          
DEM22    CLI   0(RE),EOT           LOOK-UP INTERNAL FMS IN TABLE                
         BNE   *+12                                                             
         MVI   DBERROR,INVFMS                                                   
         B     DEMX                                                             
         CLC   INTFMS,0(RE)                                                     
         BE    *+12                                                             
         LA    RE,L'FMSTAB(RE)                                                  
         B     DEM22                                                            
         MVC   FMSINDS,3(RE)       EXTRACT F/M/S INDICATORS                     
*                                                                               
         MVC   DBINTFIL,INTFIL     SET INTERNAL VALUES IN DBLOCK                
         MVC   DBINTMED,INTMED                                                  
         MVC   DBACTMED,INTMED                                                  
         MVC   DBACTSRC,INTSRC                                                  
         MVC   DBDTADSP,=AL2(DRFRSTEL-DRKEY)                                    
*                                                                               
         ZIC   RE,FILEEQU          SET FILE & DIRECTORY NAMES                   
         LA    RF,L'FDTAB                                                       
         MR    RE,RE                                                            
         LA    RE,FDTAB-L'FDTAB(RF)                                             
         MVC   DBFILNAM(L'FDTAB),0(RE)                                          
         B     DEMGO                                                            
*                                                                               
         TITLE 'DEMGO - PASS CONTROL TO PROCESSING ROUTINE'                     
***********************************************************************         
* DEMGO - FIND WHICH MODULE TO BRANCH BASED ON FILE & SRC USING RTNTAB*         
*        FOR SPNETFLG, TEST SOURCE AS WELL                            *         
*        PASS CONTROL TO PROCESSING RTN                               *         
***********************************************************************         
         SPACE 1                                                                
DEMGO    XR    RF,RF                                                            
         MVI   DMCB,0                                                           
         IC    RF,DBFUNCT                                                       
         BCTR  RF,0                                                             
         SLL   RF,2                                                             
         L     R1,=A(GOTAB)                                                     
         A     R1,RELO                                                          
         L     RF,0(RF,R1)                                                      
         LTR   RF,RF               IF NON ZERO CALL ROUTINE                     
         JNZ   DEMGO40                                                          
*                                                                               
         MVI   RECCODE,C'R'        SET FOR DEFAULT RECORD CODE                  
         CLC   DBFILE,=C'RDP'      CHECK FOR RADIO DAYPARTS                     
         JNE   *+8                                                              
         MVI   RECCODE,C'D'        SET RADIO DPT RECORD CODE                    
         CLI   DBMODE,DBMFRST                                                   
         JNE   DEMGO30                                                          
*                                                                               
         L     R1,=A(RTNTAB)       ROUTINE TABLE                                
         A     R1,RELO                                                          
         USING RTND,R1                                                          
DEMGO02  CLI   0(R1),EOT           COMPARE ON FILE & MDEIA                      
         JNE   *+12                                                             
         MVI   DBERROR,INVFM                                                    
         J     DEMX                                                             
DEMGO03  CLC   DBINTFIL(2),RTNFILE                                              
         JNE   DEMGO10                                                          
DEMGO04  CLI   SPNETFLG,0                                                       
         JE    DEMGO05                                                          
         CLC   DBSELSRC,RTNSRC                                                  
         JE    DEMGO20                                                          
         J     DEMGO10                                                          
*                                                                               
DEMGO05  CLI   RTNSRC,0            ONLY USE DEFAULT ENTRYS FOR REG LKUP         
         JNE   DEMGO10                                                          
         CLI   RTNFUNCT,0          IF NON-ZERO TABLE ENTRY, CMP FUNCT           
         JE    DEMGO20             ACCEPT DEFAULT ENTRY                         
         CLC   RTNFUNCT,DBFUNCT                                                 
         JE    DEMGO20             IF FUNC MATCHES TAKE THIS ENTRY              
*                                                                               
DEMGO10  LA    R1,RTNDLN(R1)       NEXT ENTRY IN TABLE                          
         J     DEMGO02                                                          
*                                                                               
DEMGO20  DS    0H                  MATCHED ENTRY WITH TABLE                     
         MVC   DBLSTSBF,RTNLSTSB   SET SUB RTN LK UP EQUATE                     
         DROP  R1                                                               
*                                                                               
         CLC   DBFILE,=C'RLD'      AMRLD VALIDATE NETWORK/BOOK                  
         BNE   DEMGO21                                                          
         CLI   DBFUNCT,DBVLNBK     IN THE GETMXM MODULE                         
         BNE   DEMGO21                                                          
         MVI   DBLSTSBF,DGETMXM                                                 
*                                                                               
DEMGO21  CLC   =C'ITN S',DBSELSTA  ITN AND COMMERCIAL AVERAGE                   
         JE    DEMGO22             DON'T HAVE TP DATA                           
         CLC   =C'SIN S',DBSELSTA  SIN AND COMMERCIAL AVERAGE                   
         JE    DEMGO22             DON'T HAVE TP DATA                           
         CLI   DBSELSTA+4,C'C'     EXCEPT FOR CABLE,                            
         JE    DEMGO23             WHICH USES GETCAB TO VALIDATE                
         CLI   DBSELSTA+4,C'Q'                                                  
         JE    DEMGO23                                                          
         BRAS  RE,COMMAVG          COMMERCIAL AVG AND NEW VIEWING TYPES         
         JE    DEMGO22             DONT HAVE TP AND USE GETNTI TO VAL           
         BRAS  RE,VTYPACM          VIEWING TYPES +1,+2,+3,AL,AS,A7              
         JNE   DEMGO23                                                          
DEMGO22  CLI   DBFUNCT,DBVLNBK                                                  
         JNE   *+8                                                              
         MVI   DBLSTSBF,DGETNTI    VALIDATE ON PROGRAM DATA                     
**                                                                              
DEMGO23  MVI   DBLSTNXT,0                                                       
         CLI   SPNETFLG,0                                                       
         JE    DEMGO25                                                          
         CLI   DBFUNCT,DBGETPUR    NETWORK PURE# LK UP IN DEGETNTI              
         JNE   *+8                                                              
         MVI   DBLSTSBF,DGETNTI                                                 
         CLI   DBFUNCT,DBGETTOT    NETWORK HUT LK UP IN DEGETNET                
         JNE   *+8                                                              
         MVI   DBLSTSBF,DGETNET     CALL DEGETNTI FOR PRGS                      
*                                                                               
DEMGO25  CLI   DBFUNCT,DBGETNTI    SWITCH GETCAB TO NTI                         
         BNE   DEMGO30                                                          
         CLI   DBBTYPE,C'C'        FOR MONITOR PLUS                             
         BNE   DEMGO30                                                          
         CLI   DBLSTSBF,DGETCAB                                                 
         JNE   DEMGO30                                                          
         MVI   DBLSTSBF,DGETNTI                                                 
                                                                                
DEMGO30  XR    RE,RE                                                            
         L     RE,=A(DGETAB)        USE DBLSTSBF TO GET RTN IN DGETAB           
         A     RE,RELO                                                          
DEMGO35  CLI   0(RE),EOT                                                        
         JNE   *+6                                                              
         DC    H'0'                INVALID ROUTINE                              
         CLC   DBLSTSBF,0(RE)                                                   
         JE    *+12                                                             
         LA    RE,L'DGETAB(RE)                                                  
         J     DEMGO35                                                          
         ICM   RF,15,1(RE)                                                      
         ST    RF,DMCB                                                          
*                                                                               
DEMGO40  A     RF,RELO                                                          
         XC    DMCB+4(4),DMCB+4    PASS 0 IN 2ND PARAM OF CALL                  
         TM    DMCB,GET01Q         DEGET01 REDIRECT?                            
         JNO   DEMGO50                                                          
         L     RF,ADEGET01         ROUTINE LIVES IN 2ND DEGET MODULE            
         MVC   DMCB+4(1),DMCB                                                   
*                                                                               
DEMGO50  XR    R0,R0                                                            
         CLI   DBMODE,DBMFRST                                                   
         JE    *+8                                                              
         LA    R0,1                                                             
         MVC   SVSELSTA,DBSELSTA                                                
         MVC   SVSELSRC,DBSELSRC                                                
         MVC   SVACTSRC,DBACTSRC                                                
         MVC   SVBBTYPE,DBBTYPE                                                 
         GOTO1 (RF),DMCB,((R0),(RC))                                            
         MVC   DBSELSTA,SVSELSTA                                                
         MVC   DBSELSRC,SVSELSRC                                                
         MVC   DBBTYPE,SVBBTYPE                                                 
         MVC   DBACTSRC,SVACTSRC                                                
         J     DEMX                                                             
*                                                                               
         LTORG                                                                  
         TITLE 'EXIT POINTS'                                                    
**********************************************************************          
* GETX - EXIT MODULE                                                 *          
**********************************************************************          
         SPACE 1                                                                
GETX     CLI   DBERROR,0           TEST IF ERROR SET                            
         JE    *+14                                                             
         XC    DBAQUART,DBAQUART   YES - CLEAR QTR HOUR ADDRESS                 
         MVI   DBMODE,DBMFRST      AND RESET SEQUENTIAL MODE                    
         MVC   DBLSTFNC,DBFUNCT    EQUATE LAST FUNCTION TO THIS                 
         OC    AUSERRTN,AUSERRTN   TEST IF USER HOOK SUPPLIED                   
         JZ    XIT                 NO - RETURN TO CALLER                        
         CLI   DBERROR,0           TEST IF ERROR SET                            
         JNE   XIT                 YES - RETURN TO CALLER                       
         CLI   DBMODE,DBMNEXT      TEST IF SEQUENTIAL MODE                      
         JE    *+8                                                              
         LA    RE,XIT              NO - SET RETURN TO EXIT                      
*                                                                               
         NTR1  ,                   SAVE REGS & GO TO USER HOOK                  
         L     RF,AUSERRTN                                                      
         L     RE,ROOTRD                                                        
         LR    R0,RE               R0=A(CALLER'S RD)                            
         LM    R1,RC,24(RE)        R1-RC=CALLERS REGISTERS                      
         BASR  RE,RF               GO TO USER HOOK                              
         J     XIT                                                              
*                              *** FINAL EXIT OF DEMAND                         
DEMX     IPM   R2                  SAVE CONDITION CODE                          
         CLI   PRELIMOK,C'Y'       TAKEN OUT PER BEN'S REQUEST.                 
         BNE   *+8                                                              
         NI    DBBTYPE,X'BF'       RESTORE LOWER CASE                           
         CLC   =C'SIN S',DBSELSTA                                               
         BE    *+14                                                             
         CLC   =C'ITN S',DBSELSTA                                               
         BNE   *+10                                                             
         MVC   DBSELDUR,SVSELDUR   RESTORE DURATION                             
         SPM   R2                  RESTORE CONDITION CODE BEFORE XIT            
         J     XIT                 FINAL EXIT TO CALLER                         
*                                                                               
XIT      XIT1  ,                   SUBROUTINE EXIT                              
*                                                                               
                                                                                
         TITLE 'GET STATION MARKETS'                                            
***********************************************************************         
* GET STATION/MARKETS FOR A BOOK                                      *         
***********************************************************************         
         SPACE 1                                                                
GETSM    CLI   0(R1),0                                                          
         JNE   GETSM08                                                          
         CLI   DBSELMED,C'N'                                                    
         JE    GTSMNET                                                          
*                                                                               
GETSM02  LA    R1,DBSELBK          R1=A(SELECTED BOOK)                          
         OC    DBSELBK,DBSELBK                                                  
         JNZ   *+8                                                              
         LA    R1,EFFS             OR A(EFFS) IF NOT SPECIFIED                  
         GOTO1 AGETCTRL            GET AGENCY CONTROL INFO                      
         LA    R2,DBKEY                                                         
*                                                                               
         USING BSKEY,R2            R2=A(KEY)                                    
         MVI   BSCODE,BSCODEQU     BUILD KEY                                    
         MVC   BSMEDIA,DBINTMED                                                 
         MVC   BSSRC,DBACTSRC                                                   
         MVC   BSBOOK,DBSELBK                                                   
         OC    BSBOOK,BSBOOK                                                    
         JZ    *+10                                                             
         XC    BSBOOK,EFFS                                                      
         MVI   BSIND,BSINDEQU                                                   
         OC    DBSELSTA,DBSELSTA   TEST IF STATION PASSED                       
         JZ    *+10                                                             
         MVC   BSSTAT,DBSELSTA     YES - MOVE TO KEY                            
         MVI   IOFLAG,DIR+HIGH     READ HIGH/DIRECTORY                          
         GOTO1 AIO,IOFLAG                                                       
         JL    GETX                ERRORS                                       
         JH    GETSM06             EOF                                          
*                                  CHECK RETURN KEY                             
         CLC   BSKEY(BSBOOK-BSKEY),KEYSAVE                                      
         JNE   GETSM06                                                          
         CLI   BSIND,BSINDEQU                                                   
         JNE   GETSM06                                                          
         OC    DBSELBK,DBSELBK     TEST IF BOOK PASSED                          
         JZ    GETSM04                                                          
         MVC   DUB(2),BSBOOK       YES - CHECK BOOK                             
         XC    DUB(2),EFFS                                                      
         CLC   DBSELBK,DUB                                                      
         JNE   GETSM06                                                          
         CLI   DBSELMED,C'T'       NSI USTV DATA VALID POST OCT90               
         JNE   GETSM04                                                          
         CLI   DBSELSRC,C'N'                                                    
         JNE   GETSM04                                                          
         CLC   DBSELAGY,=C'NB'     NBC                                          
         BE    GETSM04                                                          
         CLC   DBSELAGY,=C'SJ'                                                  
         BE    GETSM04                                                          
         CLC   DBSELBK,=AL2(OCT_90) DISABLE BOOKS < OCT90                       
         BL    GETSM06             RETURN NOT FOUND                             
*                                                                               
GETSM04  OC    DBSELSTA,DBSELSTA   TEST IF STATION PASSED                       
         JZ    GETSMX                                                           
         CLC   BSSTAT,DBSELSTA     YES - CHECK STATION                          
         JE    GETSMX                                                           
         J     GETSM10                                                          
*                                                                               
GETSM06  MVI   DBERROR,NOTFOUND    RETURN NOT FOUND                             
         J     GETX                                                             
*                                  SEQUENTIAL MODE                              
GETSM08  LA    R2,DBKEY                                                         
         MVI   IOFLAG,DIR+SEQ      READ SEQUENTIAL/DIRECTORY                    
         GOTO1 AIO,IOFLAG                                                       
         JNE   GETX                                                             
*                                  CHECK FOR LOGICAL EOF                        
         CLC   BSKEY(BSSTAT-BSKEY),KEYSAVE                                      
         JNE   GETSM10                                                          
         OC    DBSELSTA,DBSELSTA   TEST IF STATION PASSED                       
         JZ    GETSMX                                                           
         CLC   BSSTAT,DBSELSTA     YES - CHECK STATION                          
         JE    GETSMX                                                           
*                                                                               
GETSM10  MVI   DBERROR,EOF         RETURN EOF                                   
         J     GETX                                                             
*                                                                               
GETSMX   CLI   BSBTYP,XSPILL       TEST SPECIAL SURVEY SPILL                    
         JNE   *+16                                                             
         TM    DBCSPILL,DBOXSPL    YES - TEST USER HAS ACCESS                   
         JZ    GETSM08                                                          
         J     *+14                                                             
         CLC   BSBTYP,DBBTYPE                                                   
         JNE   GETSM08                                                          
*                                                                               
         MVC   DUB(2),BSBOOK                                                    
         XC    DUB(2),EFFS                                                      
         CLI   DBSELMED,C'T'       NSI USTV DATA VALID POST OCT90               
         JNE   GETSMX2                                                          
         CLI   DBSELSRC,C'N'                                                    
         JNE   GETSMX2                                                          
         CLC   DBSELAGY,=C'NB'     NBC                                          
         BE    GETSMX2                                                          
         CLC   DBSELAGY,=C'SJ'     AND SJR HAVE ACCESS TO OLD DATA              
         BE    GETSMX2                                                          
         CLC   DUB(2),=AL2(OCT_90) DISABLE BOOKS < OCT90                        
         BL    GETSM10             RETURN EOF                                   
                                                                                
GETSMX2  MVI   DBRECTYP,DBRECSM                                                 
         MVI   DBMODE,DBMNEXT      SET SEQUENTIAL MODE                          
         BRAS  RE,GETX                                                          
         J     GETSM08             GET NEXT RECORD                              
         DROP  R2                                                               
*                                                                               
         TITLE 'GET STATIONS FOR A BOOK FROM NETWORK FILE'                      
***********************************************************************         
* GET STATION(S) FOR A BK (OR LATEST BK) FROM NETWORK FILE            *         
* IF NO BOOK GIVEN, GET LATEST BOOK -- LOOK FOR STATION FOR LATEST BK *         
* IF NO STATION-- GET ALL STATIONS FOR BOOK OR FOR LATEST BK          *         
***********************************************************************         
         SPACE 1                                                                
GTSMNET  XC    DUB,DUB             WILL HOLD LATEST BK AND STN-TYPE             
         OC    DBSELSTA,DBSELSTA                                                
         JNZ   *+8                                                              
         BRAS  RE,GTNSRC           XTRACT STATION+4 BYTE FROM DBSELSRC          
*                                                                               
         LA    R1,DBSELBK                                                       
         OC    DBSELBK,DBSELBK                                                  
         JNZ   *+12                                                             
         BRAS  RE,GTNLBK           GET LATEST BOOK FOR NETWORK SOURCE           
         LA    R1,DUBSV            PT TO LATEST BK                              
*                                                                               
         MVC   DUBSV,DUB                                                        
         GOTO1 AGETCTRL         GET AUTH RECD (R1=BOOK),KILLS WORK/DUB          
         MVC   DUB,DUBSV           RESTORE                                      
*                                                                               
         LA    R2,DBKEY            BUILD LOOK UP KEY                            
         USING PRKEY,R2                                                         
         MVI   PRCODE,PRCODEQU                                                  
         MVC   PRMEDIA,DBSELMED                                                 
         MVI   PRSRC,C'N'                                                       
         MVC   PRSTAT(5),DBSELSTA                                               
         TM    SPNETFLG,SPCBLQ                                                  
         BNO   GTNET10                                                          
         MVC   PRSTAT(4),DBCABNUM                                               
         MVI   PRSTAT+4,C'C'                                                    
         MVI   PRMEDIA,C'C'                                                     
*                                                                               
GTNET10  OC    PRSTAT(5),PRSTAT    NO SPEC STATION REQUESTED                    
         JNZ   *+10                                                             
         MVC   PRSTAT+4(1),DUB+4   FILE TYPE                                    
         MVC   PRBOOK,DBSELBK                                                   
         OC    DBSELBK,DBSELBK                                                  
         JNZ   *+10                                                             
         MVC   PRBOOK,DUB          SET TO LATEST BOOK                           
*                                                                               
GTNET20  MVI   IOFLAG,DIR+HIGH+NTI                                              
         GOTO1 AIO,IOFLAG                                                       
         JL    GETX                ERRORS                                       
         JH    GTNETFX             EOF                                          
*                                                                               
         OC    DBSELSTA,DBSELSTA   SPECIFIC STN REQUESTED?                      
         JZ    GTNET30                                                          
         CLC   PRKEY(PRSTYP-PRKEY),KEYSAVE                                      
         JNE   GTNETNX             NOT FOUND                                    
         J     GTNET50             GOOD RECD - PASS IT BACK & DONE              
*                                                                               
GTNET30  CLC   PRKEY(3),KEYSAVE    READ ALL STATNS FOR BK/LATEST                
         JNE   GTNETFX             EOF                                          
         CLC   PRSTAT+4(1),KEYSAVE+7  SAME FILE TYPE CHAR IN STN?               
         JE    GTNET45                                                          
         JL    GTNET40             READ FOR THIS STN W/STA+4 CHAR               
*                                                                               
GTNET35  IC    R1,PRSTAT+3         NO STA+4 CHAR FOR THIS STN,                  
         LA    R1,1(R1)              BUMP TO NEXT STATION                       
         STC   R1,PRSTAT+3         BUMP 4TH CHAR OF STATION                     
*                                                                               
GTNET40  MVC   KEYSAVE+3(4),PRSTAT  REPLACE W/NEW STATION                       
         MVC   DBKEY,KEYSAVE                                                    
         J     GTNET20             READ HI FOR NEXT STATION                     
*                                                                               
GTNET45  CLC   PRBOOK,KEYSAVE+10   MAKE SURE GOT RIGHT BOOK                     
         JH    GTNET35             BOOK <> LATEST, TRY NEXT STN                 
         JL    GTNET40             READ FOR THIS STN AND BOOK                   
         XC    WORK,WORK                                                        
         MVC   WORK(PRSTYP-PRKEY),PRKEY                                         
*                                                                               
GTNET50  MVI   IOFLAG,FILE+HIGH+NTI                                             
         GOTO1 AIO,IOFLAG                                                       
         L     RE,DBAREC                                                        
         LA    RE,PRFRSTEL-PRKEY(RE)    PT TO MKT ELEM                          
         XC    NETMKT,NETMKT                                                    
         CLI   0(RE),X'01'         PICK OFF MKT # FROM RECD                     
         JNE   *+10                                                             
         MVC   NETMKT,MARNO-MARELEM(RE)                                         
         TM    SPNETFLG,SPCBLQ                                                  
         BNO   *+10                                                             
         MVC   NETMKT,=Y(CBLMKT)                                                
         MVI   DUB,C'B'            BUILD BSKEY IN IOAREA                        
         BRAS  RE,BLDNET                                                        
         MVC   DBKEY,KEYSAVE       RESTORE DIR KEY                              
         MVI   DBMODE,DBMNEXT      SET SEQ MODE                                 
         MVI   DBRECTYP,DBRECSM                                                 
         BRAS  RE,GETX             RETURN TO CALLER                             
         OC    DBSELSTA,DBSELSTA                                                
         JNZ   GTNETFX             SET EOF                                      
         MVC   KEYSAVE,WORK        RESTORE FROM BEFORE                          
         J     GTNET35             BUMP STATION AND READ HI                     
*                                                                               
GTNETFX  MVI   DBERROR,EOF         RETURN EOF                                   
         J     GETX                                                             
*                                                                               
GTNETNX  MVI   DBERROR,NOTFOUND    RETURN NOT FOUND                             
         J     GETX                                                             
         EJECT                                                                  
***********************************************************************         
* VLSTBK -  VALIDATE A STATION/BOOK                                   *         
***********************************************************************         
         SPACE 1                                                                
VLSTBK   CLI   DBINTMED,C'N'                                                    
         JE    VLBK12                                                           
*                                                                               
         GOTO1 VSUBR01,DMCB,('CHKPPMQ',(RC))                                    
*                                                                               
         OC    DBSELMK,DBSELMK                                                  
         BNZ   VLBK00                                                           
         OC    DBSELALF,DBSELALF                                                
         BZ    VLBK00                                                           
         XC    DUB,DUB                                                          
         MVC   DUB(3),DBSELALF     SET FOR ALPHA CONVSN                         
         BRAS  RE,TRAMKT           TRANSLATE ALPHAMKT TO NUMERIC MKT            
         MVC   DBSELMK,DUB+3      DUB+3(2) = NUMERIC MARKET                     
*                                                                               
VLBK00   LA    R2,DBKEY                                                         
         USING BSKEY,R2            R2=A(KEY)                                    
         MVI   BSCODE,BSCODEQU     BUILD KEY                                    
         MVC   BSMEDIA,DBINTMED                                                 
         MVC   BSSRC,DBACTSRC                                                   
         CLI   DBSELMED,C'T'       NSI USTV DATA VALID POST OCT90               
         BNE   VLBK01                                                           
         CLI   DBSELSRC,C'N'                                                    
         BNE   VLBK01                                                           
         CLC   DBSELAGY,=C'NB'     NBC                                          
         BE    VLBK01                                                           
         CLC   DBSELAGY,=C'SJ'     AND SJR HAVE ACCESS TO OLD DATA              
         BE    VLBK01                                                           
         CLC   DBSELBK,=AL2(OCT_90) DISABLE BOOKS < OCT90                       
         BL    VLBKNX              -> NOT FOUND                                 
                                                                                
VLBK01   MVC   BSBOOK,DBSELBK                                                   
         XC    BSBOOK,EFFS                                                      
         MVI   BSIND,BSINDEQU                                                   
         MVC   BSKMKT,DBSELMK                                                   
         MVC   BSSTYP,DBSTYPE                                                   
         MVC   BSBTYP,DBBTYPE                                                   
         BRAS  RE,GETCALL                                                       
         MVC   BSSTAT,DUB                                                       
         LA    R1,BSSTAT(R1)                                                    
         CLI   DBSELMED,C'R'       DON'T FORCE FOR RADIO                        
         JE    *+8                                                              
         MVI   0(R1),C'T'                                                       
         MVI   IOFLAG,DIR+HIGH     READ HIGH/DIRECTORY                          
         GOTO1 AIO,IOFLAG                                                       
         JL    GETX                ERRORS                                       
         JH    VLBK08                                                           
*                                                                               
         CLI   DBSELSRC,C'N'       FIX DDS FUCK UP FOR HART/NH METRO            
         JNE   VLBK04                                                           
         CLI   DBSELMED,C'T'                                                    
         JNE   VLBK04                                                           
*                                                                               
         CLC   DBSELSTA(4),=C'WWWB'                                             
         BNE   *+10                                                             
         MVC   BSRMKT,=H'117'                                                   
*                                                                               
         CLC   DBSELSTA(4),=C'KAKW'                                             
         BNE   KAKWOK                                                           
         CLC   BSRMKT,=H'225'                                                   
         JNE   *+10                                                             
         MVC   BSRMKT,=H'235'                                                   
KAKWOK   DS    0C                                                               
*                                                                               
         CLI   DBBTYPE,C'M'                                                     
         JNE   VLBK02                                                           
         CLC   BSRMKT,=H'189'                                                   
         JNE   *+10                                                             
         MVC   BSRMKT,=H'288'                                                   
         J     VLBK04                                                           
*                                                                               
VLBK02   CLI   DBBTYPE,C'T'        FIX NSI FUCK UP FOR CS TA                    
         JE    VLBK04                                                           
         CLC   BSRMKT,=H'299'                                                   
         JNE   *+10                                                             
         MVC   BSRMKT,=H'352'                                                   
*                                                                               
         CLC   BSRMKT,=H'002'                                                   
         JNE   *+10                                                             
         MVC   BSRMKT,=H'230'                                                   
*                                                                               
VLBK04   CLI   DBSELSRC,C'S'       FIX SRC FUCK UP                              
         JNE   VLBK06                                                           
*        CLC   BSRMKT,=H'95'                                                    
*        JNE   VLBK06                                                           
*        CLC   DBSELSTA(4),=C'ABC '                                             
*        JE    *+10                                                             
*        CLC   DBSELSTA(4),=C'CBS '                                             
*        JE    *+10                                                             
*        CLC   DBSELSTA(4),=C'GALA'                                             
*        JE    *+10                                                             
*        CLC   DBSELSTA(4),=C'NBC '                                             
*        JE    *+10                                                             
*        CLC   DBSELSTA(4),=C'TELE'                                             
*        JE    *+10                                                             
*        CLC   DBSELSTA(4),=C'UNIV'                                             
*        JNE   VLBK06                                                           
*        MVC   BSRMKT,=H'98'                                                    
*                                                                               
*                                  CHECK RETURN KEY                             
*                                                                               
VLBK06   CLC   BSKEY(BSRMKT-BSKEY),KEYSAVE                                      
         JE    VLSTBKX             MATCH THROUGH BOOK TYPE SO VALID             
         CLC   BSKEY(BSBTYP-BSKEY),KEYSAVE TEST MATCH UP TO BK TYPE             
**       JNE   VLBK08              NO - TRY EQUIVALENCING                       
         JE    VLBK07              NO - TRY EQUIVALENCING                       
*                                                                               
         CLI   DBSELMED,C'U'       FOR COUNTY COVERAGE                          
         JNE   VLBK08              RESEARCH WRITER HAS OPTION NOT               
         OC    DBSELMK,DBSELMK     TO PASS COUNTY CODE.  LET IT                 
         JNZ   VLBK08              GO THROUGH                                   
         J     VLSTBKX             NO COUNTY GIVEN IS VALID                     
*                                                                               
VLBK07   CLI   DBBTYPE,0           TEST REGULAR SURVEY REQUESTED                
         JNE   VLBK08              NO-NOT FOUND FOR A SPECIAL SURVEY            
         CLI   BSBTYP,XSPILL       TEST EXTRA SPILL RECORD                      
         JNE   VLBK08              NO-NOT FOUND SO EQUIVALENCE                  
         LA    R1,DBSELBK                                                       
         OC    DBSELBK,DBSELBK                                                  
         JNZ   *+8                                                              
         LA    R1,EFFS                                                          
         GOTO1 AGETCTRL            GET CONTROL VALUES TO                        
         TM    DBCSPILL,DBOXSPL    CHECK ACCESS TO EXTRA SPILL                  
         JO    VLSTBKX             YES-HAS ACCESS SO VALID                      
*                                  NOT FOUND - TRY EQUIVALENCING                
VLBK08   MVC   DBKEY,KEYSAVE                                                    
         XC    DUB(5),DUB                                                       
         MVI   DUB+5,3                                                          
         GOTO1 AGETEQIV           GET EQUIVALENT CALL LETTERS                   
         JNE   VLBKNX                                                           
         MVC   BSSTAT,DUB                                                       
         BRAS  RE,GETCALL                                                       
         LA    R1,BSSTAT(R1)                                                    
         CLI   DBSELMED,C'R'       DON'T FORCE FOR RADIO                        
         JE    *+8                                                              
         MVI   0(R1),C'T'                                                       
         GOTO1 AIO,IOFLAG                                                       
         JL    GETX                                                             
         JH    VLBKNX                                                           
*                                  CHECK RETURN KEY                             
         CLC   BSKEY(BSRMKT-BSKEY),KEYSAVE                                      
         JE    VLBK10              OK                                           
         CLC   BSKEY(BSBTYP-BSKEY),KEYSAVE CHECK MATCH UP TO BOOK TYPE          
         JNE   VLBKNX              NO-SO NOT FOUND                              
         CLI   DBBTYPE,0           TEST REGULAR SURVEY REQUESTED                
         JNE   VLBKNX              NO                                           
         CLI   BSBTYP,XSPILL       TEST EXTRA SPILL RECORD RETURNED             
         JNE   VLBKNX              NO                                           
         LA    R1,DBSELBK                                                       
         OC    DBSELBK,DBSELBK                                                  
         JNZ   *+8                                                              
         LA    R1,EFFS                                                          
         GOTO1 AGETCTRL                                                         
         TM    DBCSPILL,DBOXSPL    TEST ACCESS TO EXTRA SPILL                   
         JZ    VLBKNX              NO-SO EXIT WITH NOT FOUND                    
*                                                                               
VLBK10   MVC   DBSELSTA,BSSTAT                                                  
         J     VLSTBKX                                                          
*                                                                               
VLBK12   XC    DUB,DUB             NETWORK FILE STATION VALIDATION              
         MVC   DUB+1(2),DBSELBK                                                 
***      MVC   DUB+3(1),DBBTYPE                                                 
         LA    R1,PRBTYP-PRKEY+1                                                
         STC   R1,DUB+4                                                         
         BRAS  RE,RDNET                                                         
         JNE   VLBKNX                                                           
         XC    DUB,DUB                                                          
         MVI   DUB,C'B'            BUILD BSRKEY                                 
         BRAS  RE,BLDNET                                                        
         J     VLSTBKX                                                          
*                                                                               
VLBKNX   MVI   DBERROR,NOTFOUND    RETURN NOT FOUND                             
         J     GETX                                                             
*                                                                               
VLSTBKX  MVI   DBRECTYP,DBRECSM    RETURN TO CALLER                             
         MVI   DBMODE,DBMFRST                                                   
         J     GETX                                                             
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* GET MARKET/STATIONS FOR A BOOK                                                
***********************************************************************         
         SPACE 1                                                                
GETMS    CLI   0(R1),0                                                          
         JE    GETMS1A                                                          
         CLI   DBSELMED,C'N'                                                    
         JE    GTMSN10                                                          
         J     GETMS4                                                           
*                                                                               
GETMS1A  DS    0H                                                               
         GOTO1 VSUBR01,DMCB,('CHKPPMQ',(RC))                                    
         CLI   DBSELMED,C'T'       NSI USTV DATA VALID POST OCT90               
         BNE   GETMS1B                                                          
         CLI   DBSELSRC,C'N'                                                    
         BNE   GETMS1B                                                          
         CLC   DBSELAGY,=C'NB'                                                  
         BE    GETMS1B                                                          
         CLC   DBSELAGY,=C'SJ'     ONLY NBC AND SJR CAN ACCESS OLD DATA         
         BE    GETMS1B                                                          
         CLC   DBSELBK,=AL2(OCT_90) DISABLE BOOKS < OCT90                       
         BL    GETMS2              -> NOT FOUND                                 
*                                                                               
GETMS1B  LA    R1,DBSELBK          R1=A(SELECTED BOOK)                          
         OC    DBSELBK,DBSELBK                                                  
         BNZ   *+8                                                              
         LA    R1,EFFS             OR A(EFFS) IF NOT SPECIFIED                  
         GOTO1 AGETCTRL            GET AGENCY CONTROL INFO                      
*                                                                               
         GOTO1 VSUBR01,DMCB,('CHKLPMQ',(RC))   CHECK FOR FOR LPM                
*                                                                               
         SR    R0,R0               SET-UP SELECTED MARKET NUMBER                
         TM    DBSELSTA,X'F0'      TEST FOR NUMERIC STATION                     
         BNO   *+14                                                             
         PACK  DUB,DBSELSTA(4)                                                  
         CVB   R0,DUB              YES - R0=MARKET NUMBER                       
         OC    DBSELRMK,DBSELRMK   TEST IF MARKET SET                           
         BNZ   *+8                                                              
         STCM  R0,3,DBSELRMK       NO - SET FROM STATION                        
*                                                                               
         CLI   DBSELMED,C'N'       FOR NETWORK, DIFFERENT PROCESISNG            
         BE    GTMSNET                                                          
*                                                                               
         LA    R2,DBKEY                                                         
         USING MLKEY,R2            R2=A(KEY)                                    
         MVI   MLCODE,MLCODEQU     BUILD KEY                                    
         MVC   MLMEDIA,DBINTMED                                                 
         MVC   MLSRC,DBACTSRC                                                   
         MVC   MLBOOK,DBSELBK                                                   
         OC    MLBOOK,MLBOOK                                                    
         BZ    *+10                                                             
         XC    MLBOOK,EFFS                                                      
         MVI   MLIND,MLINDEQU                                                   
         CLI   DBSELMED,C'U'      COUNTY COVERAGE CHECK COUNTY CODE             
         BNE   *+14                                                             
         MVC   MLKMKT,DBSELRMK     SPILL MKT # IS COUNTY #                      
         B     *+20                                                             
         OC    DBSELRMK,DBSELRMK   TEST IF MARKET  PASSED                       
         BZ    *+10                                                             
         MVC   MLRMKT,DBSELRMK     YES - MOVE TO KEY                            
                                                                                
GETMS1C  MVI   IOFLAG,DIR+HIGH     READ HIGH/DIRECTORY                          
         GOTO1 AIO,IOFLAG                                                       
         BL    GETX                ERRORS                                       
         BH    GETMS2              EOF                                          
*                                  CHECK RETURN KEY                             
*CONVERT NUMERIC CABLE # TO CALL LETTERS FOR FUSION                             
         CLI   DBSELSRC,C'F'                                                    
         BNE   GETMS1D                                                          
         XC    WORK,WORK                                                        
         MVC   WORK(L'MLSTAT),MLSTAT                                            
         BRAS  RE,CABALPH          CONVERT CABLE # TO ALPHA                     
         MVC   DBACTSTA,WORK+5                                                  
* IF WE DO NOT FIND THE CABLE STATION IN DEMTABS TABLE                          
* AND ITS BINARY SKIP..DONT DISPLAY IT                                          
         CLC   DBACTSTA(4),WORK                                                 
         BE    GETMS4                                                           
*                                                                               
GETMS1D  DS    0H                                                               
*                                                                               
         CLC   =C'HUT',MLSTAT     DONT PASS HUTW                                
         BE    GETMS4              READ NEXT ONE                                
         CLC   MLKEY(MLBOOK-MLKEY),KEYSAVE                                      
         JNE   GETMS2                                                           
         CLI   MLIND,MLINDEQU                                                   
         JNE   GETMS2                                                           
         OC    DBSELBK,DBSELBK     TEST IF BOOK PASSED                          
         BZ    GETMS1                                                           
         MVC   DUB(2),MLBOOK       YES - CHECK BOOK                             
         XC    DUB(2),EFFS                                                      
         CLC   DBSELBK,DUB                                                      
         JNE   GETMS2                                                           
*                                                                               
                                                                                
GETMS1   OC    DBSELRMK,DBSELRMK   TEST IF MARKET OR COUNTY PASSED              
         BZ    GETMSX                                                           
         CLI   DBSELMED,C'U'                                                    
         BNE   GETMS1E                                                          
         CLC   MLKMKT,DBSELRMK     YES-CHECK COUNTY CODE                        
         BE    GETMSX              RETURN TO CALLER                             
         BNL   GETTEST                                                          
         MVC   MLKMKT,DBSELRMK                                                  
         B     GETMS1C                                                          
GETTEST  DS    0H                                                               
*                                                                               
         MVC   MLKMKT,=X'FFFF'                                                  
         B     GETMS1C             ELSE READ HIGH                               
GETMS1E  CLC   MLRMKT,DBSELRMK     YES - CHECK MARKET                           
         BE    GETMSX                                                           
         B     GETMS5                                                           
*                                                                               
GETMS2   MVI   DBERROR,NOTFOUND    RETURN NOT FOUND                             
         B     GETX                                                             
*                                  SEQUENTIAL MODE                              
GETMS4   LA    R2,DBKEY                                                         
         MVI   IOFLAG,DIR+SEQ      READ SEQUENTIAL/DIRECTORY                    
         GOTO1 AIO,IOFLAG                                                       
         JNE   GETX                                                             
*                                                                               
         CLI   DBSELSRC,C'F'       FUSION CONVERT INTERNAL CABLE                
         BNE   GETMS4D             STATION NUMBER TO CALL LETTERS               
         XC    WORK,WORK                                                        
         MVC   WORK(L'MLSTAT),MLSTAT                                            
         BRAS  RE,CABALPH          CONVERT CABLE # TO ALPHA                     
         MVC   DBACTSTA,WORK+5                                                  
* IF WE DO NOT FIND THE CABLE STATION IN DEMTABS TABLE                          
* AND ITS BINARY SKIP..DONT DISPLAY IT                                          
         CLC   DBACTSTA(4),WORK                                                 
         BE    GETMS4                                                           
GETMS4D  DS    0H                                                               
*                                                                               
         CLC   =C'HUT',MLSTAT     DONT PASS HUTW                                
         BE    GETMS4              READ NEXT ONE                                
         CLC   MLKEY(MLRMKT-MLKEY),KEYSAVE                                      
         JNE   GETMS5                                                           
         OC    DBSELRMK,DBSELRMK   TEST IF MARKET PASSED                        
         BZ    GETMSX                                                           
*                                                                               
         CLI   DBSELMED,C'U'                                                    
         BNE   GETMS4F                                                          
         CLC   MLKMKT,DBSELRMK     YES-CHECK COUNTY CODE                        
         BE    GETMSX              RETURN TO CALLER                             
         BL    GETMS4              SEQ READ                                     
         MVC   MLKMKT,=X'FFFF'                                                  
         B     GETMS1C             ELSE READ HIGH                               
*                                                                               
GETMS4F  CLC   MLRMKT,DBSELRMK     YES - CHECK MARKET                           
         BE    GETMSX                                                           
*                                                                               
GETMS5   MVI   DBERROR,EOF         RETURN EOF                                   
         B     GETX                                                             
*                                  RETURN TO CALLER                             
*&&DO                                                                           
GETMSX   CLI   MLBTYP,XSPILL       TEST SPECIAL SURVEY SPILL                    
         JNE   *+16                                                             
         TM    DBCSPILL,DBOXSPL    YES - TEST USER HAS ACCESS                   
         BZ    GETMS4                                                           
         B     *+14                                                             
*&&                                                                             
GETMSX   DS    0H                                                               
         CLI   DBBTYPE,0           IF A BOOKTYPE INPUTTED,                      
         JNE   GETMSX1              ALWAYS CHECK AGAINST IT                     
         CLI   DBSELSRC,C'N'                                                    
         JNE   *+12                                                             
         CLI   DBSELMED,C'D'       FIX FOR DAYPART POINTERS                     
         BE    GETMSX2                                                          
         CLI   MLBTYP,XSPILL       TEST SPECIAL SURVEY SPILL                    
         JNE   GETMSX1                                                          
         TM    DBCSPILL,DBOXSPL    YES - TEST USER HAS ACCESS                   
         BZ    GETMS4                                                           
         B     GETMSX2                                                          
                                                                                
GETMSX1  DS    0H                                                               
*                                                                               
*FOR COUNTY COVERAGE IF WE ALL DONE W THE STATE THEN END CALL                   
*                                                                               
         CLI   DBSELMED,C'U'                                                    
         BNE   GETMSX1B                                                         
         CLC   MLBTYP,DBBTYPE                                                   
         BNH   GETMSX1B                                                         
* BUMP THE KEY BY BOOKTYPE=FF  AND READ HIGH                                    
         MVC   MLKMKT,=X'FFFF'                                                  
         B     GETMS1C                                                          
*                                                                               
GETMSX1B DS    0H                                                               
*  FOR BBM, IF WE FIND THE CORRECT BOOK, AND MARKET LIST                        
*  THEN IF THE FIRST SURVEY WE FIND IS NOT STANDARD BUT                         
*  BOOKTYPE 'W' THEN LET IT PASS THROUGH                                        
*  THIS IS A COMPROMISED FIX.  WE DONT REALLY HAVE MONTHLY KEYS                 
*  FOR STATION LIST FOR METER MARKETS.  THEY ARE LOADED AS WEEKLY               
*  BOOKS WITH BOOKTYPE C'W'.  THIS WILL ATLEAST FAKE THE READ TO                
*  PASS BACK THE WEEKLY KEYS (WEEKS 1-12)  1 BEING JAN 12 BEING DEC             
*                                                                               
         CLI   DBSELMED,C'C'                                                    
         BNE   *+8                                                              
         CLI   DBSELSRC,C'A'       DEFAULT                                      
         BNE   *+8                                                              
         CLI   DBBTYPE,0                                                        
         BNE   *+12                                                             
         CLI   MLBTYP,C'W'                                                      
         BE    GETMSX2                                                          
                                                                                
         CLC   MLBTYP,DBBTYPE      CHECK THE BOOK TYPE                          
*****    JNE   GETMS4                                                           
         BE    GETMSX2                                                          
         CLI   DBSELMED,C'R'                                                    
         BNE   GETMS4                                                           
*                                                                               
* FOR RADIO IF BOOKTYPE IF NOT THE SAME SEE IF ITS THE PRELIMINARY              
* PPM BOOKTYPE                                                                  
*                                                                               
         CLI   DBBTYPE,0                                                        
         BNE   *+12                                                             
         CLI   MLBTYP,C'P'                                                      
         BE    GETMSX2                                                          
         CLI   DBBTYPE,C'B'                                                     
         BNE   *+12                                                             
         CLI   MLBTYP,C'E'                                                      
         BE    GETMSX2                                                          
         CLI   DBBTYPE,C'H'                                                     
         BNE   GETMS4                                                           
         CLI   MLBTYP,C'I'                                                      
         BE    GETMSX2                                                          
*                                                                               
GETMSX2  DS    0H                                                               
         MVI   DBRECTYP,DBRECMS                                                 
         MVI   DBMODE,DBMNEXT      SET SEQUENTIAL MODE                          
*                                                                               
         CLI   DBSELMED,C'C'       FOR CANADIAN                                 
         JNE   GETMSX3                                                          
*        BRAS  RE,MKHOSTC           CONVERT SPECIAL SPILL STATIONS              
         GOTO1 VSUBR01,DMCB,('MKHOSTQ',(RC))                                    
*                                                                               
GETMSX3  DS    0H                                                               
         BRAS  RE,GETX                                                          
         MVC   MLKMKT,=X'FFFF'                                                  
         B     GETMS1C                                                          
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* TABLE OF VALID I/O COMMANDS                                         *         
***********************************************************************         
         SPACE 1                                                                
CMNDTAB  DS    0CL8                                                             
CMNDRDHI DC    CL8'DMRDHI  '                                                    
CMNDRSEQ DC    CL8'DMRSEQ  '                                                    
CMNDREAD DC    CL8'DMREAD  '                                                    
         SPACE 1                                                                
***********************************************************************         
* TABLE OF FILE/DIRECTORY NAMES                                       *         
***********************************************************************         
         SPACE 1                                                                
FDTAB    DS    0CL14                                                            
         DC    CL14'DEMFIL DEMDIR '                                             
         DC    CL14'PAVFIL PAVDIR '      REPS ONLY: DEM.PURFIL                  
         DC    CL14'REPFIL REPDIR '                                             
         DC    CL14'NTIFIL NTIDIR '      NETWORK:   DEM.PAVFIL                  
         EJECT                                                                  
**********************************************************************          
* GENERAL ROUNTINE TO LOOK UP STATION CALL LETTERS FROM CABLE NUMBER            
* THIS ROUTINE IS CURRENTLY BEING CALLED ONLY FOR FUSION.                       
* INPUT = CABLE STATION NUMBER = WORK  BYTES                                    
* OUTPUT = CALL LETTER WORK+5(5)                                                
**********************************************************************          
*                                                                               
CABALPH  NTR1  BASE=BASE1,LABEL=NO                                              
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
* CONVERT CABLE STATION NUMBERS TO CALL LETTERS FOR FUSION                      
         XC    DBACTSTA,DBACTSTA                                                
*                                                                               
         MVC   DMCB,=AL4(NECABCLL) TABLE OF NET CABLE CALL LETTERS              
         CLI   FCBLEFLG,C'Y'                                                    
         BNE   *+10                                                             
         MVC   DMCB,=AL4(NSICABLE) TABLE OF NSI CABLE CALL LETTERS              
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB           GET ADRESS OF TABLE FROM DEMTABS             
         ICM   RE,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            R0 HAS LENGTH OF TABLE ENTRY                 
         LR    R1,RE               R1=A(TABLE)                                  
         USING NSICBLD,R1                                                       
*                                                                               
CABALP2  CLI   0(R1),X'FF'         EOT?                                         
         BNE   *+14                                                             
         MVC   WORK+5(5),WORK  EOT PASS BACK SAME STATION AS ON                 
         B     CABALPX             THE FILE                                     
         XC    CABPACK,CABPACK                                                  
         XC    DBCABNUM,DBCABNUM                                                
         XR    RF,RF                                                            
*                                                                               
         ICM   RF,7,NSICBNML        CONVERT TABLE VALUE TO CHAR                 
         C     RF,=F'10000'                                                     
         BL    CABALP4                                                          
         STCM  RF,15,DBCABNUM       5 DIGIT STAT NUMBER, DONT CONVERT           
         B     CABALP6                                                          
*                                                                               
*********CABALP4  ICM   RF,3,4(R1)          CONVERT TABLE VALUE TO CHAR         
CABALP4  CVD   RF,CABPACK                                                       
         OI    CABPACK+L'CABPACK-1,X'0F'                                        
         UNPK  DBCABNUM(4),CABPACK+5(3) AND SEED IN DBLOCK                      
CABALP6  CLC   WORK(4),DBCABNUM   COMPARE MKT#                                  
         BE    CABALP10                                                         
*                                                                               
         AR    R1,R0                                                            
         B     CABALP2                                                          
*                                                                               
CABALP10 MVC   WORK+5(4),0(R1)     REPLACE CALL LETTER                          
         MVI   WORK+9,X'40'                                                     
         XC    CABPACK,CABPACK                                                  
         XC    DBCABNUM,DBCABNUM                                                
                                                                                
*                                                                               
CABALPX  DS    0H                                                               
         B     XIT                                                              
         DROP  R1                                                               
*                                                                               
**********************************************************************          
**********************************************************************          
*GTMSNET - GET STATIONS FOR MARKET/BOOK FOR NETWORK--USE NETMKT TBL             
*   NOTE: I'VE GOT A PROBLEM IF THEY COME IN W/NUMERIC STATION                  
*        IN DBSELSTA BECAUSE EARLIER ON, THINKS NTI-CABLE FILE                  
*        FOR NOW, ONLY VALID CALL SETS DBSELRMK.                                
**********************************************************************          
         SPACE 1                                                                
GTMSNET  DS    0H                                                               
         XC    DUB,DUB                                                          
         MVC   WORK+9(2),DBSELBK                                                
         OC    DBSELBK,DBSELBK                                                  
         BNZ   GTMSN02                                                          
         BRAS  RE,GTNLBK           GET LATEST BOOK IN DUB                       
         CLI   DUB,0               NO BOOK FOUND FOR SOURCE                     
         BE    GTMSNX                                                           
         MVC   WORK+9(2),DUB       SAVE BOOK IN WORK+9(2)                       
*                                                                               
GTMSN02  XC    WORK(4),WORK        AREA FOR A(STATION TABLE)                    
         XC    WORK+4(4),WORK+4    AREA FOR LENGTH OF STATION TABLE             
         MVI   WORK+8,0                                                         
*                                                                               
GTMSN05  XC    DBKEY,DBKEY         BUILD DEMO RECORD KEY                        
         LA    R2,DBKEY                                                         
         USING PRKEY,R2                                                         
         MVI   PRCODE,PRCODEQU                                                  
         MVI   PRMEDIA,C'N'                                                     
         TM    SPNETFLG,SPCBLQ                                                  
         BNO   *+8                                                              
         MVI   PRMEDIA,C'C'                                                     
         MVI   PRSRC,C'N'                                                       
         MVC   PRBOOK,DBSELBK                                                   
         OC    DBSELBK,DBSELBK                                                  
         BNZ   *+10                                                             
         MVC   PRBOOK,WORK+9       READ LATEST BOOK                             
*                                                                               
*-CABLE                                                                         
GTMSN10  CLC   DBSELRMK,=Y(CNADMKT)    CABLE NAD                                
         BE    GTMSN15                                                          
         CLC   DBSELRMK,=Y(CBLMKT)     REGULAR CABLE                            
         BE    GTMSN15                                                          
         CLC   DBSELRMK,=Y(ACMCBMKT)   ACM(COMMERCIAL AVG) CABLE                
         BNE   GTMSN20                                                          
GTMSN15  B     GTMSNFX             DISABLE LISTING FOR NATIONAL CABLE           
* SINCE THE CHANGE FROM 4 TO 5-DIGIT STATION CODES, ADDITIONAL CODE             
* WAS NEEDED TO SUPPORT CABLE LISTINGS FOR NATIONAL.  THIS OPTION WAS           
* AVAILABLE ONLY FROM DEM AND IS BELIEVED TO NO LONGER BE NEEDED.               
****     BRAS  RE,NXTCBLST         NEXT CABLE STATION                           
****     BE    GTMSN100                                                         
****     B     GTMSNFX             NO MORE STATIONS                             
*                                                                               
*-HISPANIC TV AUDIENCE                                                          
GTMSN20  CLC   DBSELRMK,=Y(HTVAMKT)                                             
         BE    *+14                                                             
         CLC   DBSELRMK,=Y(HPTVAMKT)                                            
         BNE   GTMSN30                                                          
         BRAS  RE,NXTHTVST         NEXT HISPANIC TV AUDIENCE STATION            
         BE    GTMSN100                                                         
         B     GTMSNFX             NO MORE STATIONS                             
*                                                                               
*-HISPANIC GENERAL MARKET                                                       
GTMSN30  CLC   DBSELRMK,=Y(HGMTMKT)                                             
         BE    *+14                                                             
         CLC   DBSELRMK,=Y(HPGMTMKT)                                            
         BNE   GTMSN40                                                          
         BRAS  RE,NXTHGMST         NEXT HISPANIC GENERAL MARKET STATION         
         BE    GTMSN100                                                         
         B     GTMSNFX             NO MORE STATIONS                             
*                                                                               
*-HISPANIC GENERAL MARKET AGGREGATES                                            
GTMSN40  CLC   DBSELRMK,=Y(HGMAMKT)                                             
         BE    *+14                                                             
         CLC   DBSELRMK,=Y(HPGMAMKT)                                            
         BNE   GTMSNFX                                                          
         BRAS  RE,NXTHGAST         NEXT HISPANIC GENERAL MARKET AFFILT          
         BE    GTMSN100                                                         
         B     GTMSNFX             NO MORE STATIONS                             
*                                                                               
GTMSN100 MVI   IOFLAG,DIR+HIGH+NTI                                              
         DS    0H                                                               
         GOTO1 AIO,IOFLAG                                                       
         BL    GETX                ERRORS                                       
         CLC   PRKEY(PRSTYP-PRKEY),KEYSAVE  FOUND STN AND BK?                   
         BNE   GTMSN05             LOOK UP NEXT STATION                         
         MVI   IOFLAG,FILE+HIGH+NTI                                             
         GOTO1 AIO,IOFLAG                                                       
         L     RE,DBAREC                                                        
         LA    RE,PRFRSTEL-PRKEY(RE)    PT TO MKT ELEM                          
         XC    NETMKT,NETMKT                                                    
         CLI   0(RE),X'01'         PICK OFF MKT # FROM RECD                     
         BNE   *+10                                                             
         MVC   NETMKT,MARNO-MARELEM(RE)                                         
         TM    SPNETFLG,SPCBLQ                                                  
         BNO   *+10                                                             
         MVC   NETMKT,=Y(CBLMKT)                                                
         MVI   DUB,C'M'            BUILD MLKEY IN IOAREA                        
         BRAS  RE,BLDNET                                                        
         ICM   R1,15,DBAREC                                                     
         MVC   DBKEY,0(R1)                                                      
         MVI   DBRECTYP,DBRECMS                                                 
         MVI   DBMODE,DBMNEXT                                                   
         BRAS  RE,GETX                                                          
         B     GTMSN05                                                          
*                                                                               
GTMSNFX  MVI   DBERROR,EOF                                                      
         B     GETX                                                             
*                                                                               
GTMSNX   MVI   DBERROR,NOTFOUND                                                 
         B     GETX                                                             
         EJECT                                                                  
**********************************************************************          
* GETMB - VALIDATE A STATION OR                                                 
*        GET MARKET/BOOKS FOR A STATION                                         
**********************************************************************          
         SPACE 1                                                                
*                                  SEQUENTIAL MODE                              
GETMB    BRAS  RE,GETMKTBK                                                      
         J     GETX                                                             
         EJECT                                                                  
**********************************************************************          
*GETAMB- GET ALL MARKETS/ ALL BOOKS.                                            
*        RTNS MKT NAME RECD WITH DBACTBK AND DBBTYPE SET                        
**********************************************************************          
GETAMB   BRAS  RE,GETAMBK                                                       
         J     GETX                                                             
         EJECT                                                                  
**********************************************************************          
*GETASB- GET ALL STATIONS/ ALL BOOKS FOR A MARKET.                              
*        RTNS MKT/STTN RECD WITH DBACTBK AND DBBTYPE SET                        
**********************************************************************          
GETASB   DS    0H                                                               
         CLI   DBSELMED,C'N'                                                    
         BNE   *+12                                                             
         MVI   DBERROR,INVMED      SORRY, N/A FOR NETWORK                       
         B     GETX                                                             
*                                                                               
         DS    0H                                                               
         CLI   0(R1),0                                                          
         BNE   GETASB4                                                          
         XC    DBACTBK,DBACTBK                                                  
*                                                                               
         SR    R0,R0               SET UP SELECTED MARKET NUMBER                
         TM    DBSELSTA,X'F0'       TEST FOR NUMERIC STATION                    
         BNO   *+14                                                             
         PACK  DUB,DBSELSTA(4)                                                  
         CVB   R0,DUB                YES, R0=MKT#                               
         OC    DBSELRMK,DBSELRMK    TEST IF MARKET SET                          
         BNZ   *+8                                                              
         STCM  R0,3,DBSELRMK         NO, SET FROM STATION                       
                                                                                
*                                  GET FIRST/NEXT MARKET RECORD                 
GETASB4  DS    0H                                                               
         LA    R2,DBKEY                                                         
         USING MLKEY,R2            R2=A(KEY)                                    
         XC    MLKMAJOR,MLKMAJOR   (RE)/BUILD KEY                               
         MVI   MLCODE,MLCODEQU                                                  
         MVC   MLMEDIA,DBINTMED                                                 
         MVC   MLSRC,DBACTSRC                                                   
         MVI   MLIND,MLINDEQU                                                   
         MVC   MLRMKT,DBSELRMK                                                  
         OC    DBACTBK,DBACTBK     FIRST LK UP?                                 
         BZ    GETASB4X              DON'T SET ANYTHING ELSE                    
         MVC   MLBOOK,DBACTBK                                                   
         MVC   MLSTAT,DBACTSTA                                                  
         MVC   MLKMKT,DBACTKMK                                                  
         MVC   MLSTYP,DBSTYPE                                                   
         MVC   MLBTYP,DBBTYPE                                                   
         MVI   MLHOME,X'FF'        FORCE TO READ NEXT BOOKTYPE                  
GETASB4X EQU   *                                                                
                                                                                
*                                                                               
GETASB5  DS    0H                                                               
         MVI   IOFLAG,DIR+HIGH     READ HIGH/DIRECTORY                          
         GOTO1 AIO,IOFLAG                                                       
         BL    GETX                 ERRORS                                      
         BE    GETASB8              FOUND                                       
                                                                                
         OC    DBACTBK,DBACTBK     TEST IF FIRST TIME                           
         BZ    GETASBNF             YES - RETURN NOT FOUND                      
         B     GETASBEOF            NO  - RETURN EOF                            
                                                                                
*                                  CHECK RETURN KEY                             
GETASB8  DS    0H                                                               
         CLC   MLKEY((MLSRC+L'MLSRC)-MLKEY),KEYSAVE                             
         BE    *+18                                                             
         OC    DBACTBK,DBACTBK     WAS ANYTHING FOUND BEFORE?                   
         BNZ   GETASBEOF            YES - RETURN EOF                            
         B     GETASBNF             NO  - RETURN NOT FOUND                      
*                                                                               
         CLI   MLIND,MLINDEQU                                                   
         BNE   GETASB8A                                                         
         CLI   DBSELMED,C'T'       NSI USTV DATA VALID POST OCT90               
         BNE   GETASB8D                                                         
         CLI   DBSELSRC,C'N'                                                    
         BNE   GETASB8D                                                         
*3/23/04 CLC   DBSELAGY,=C'SJ'     ONLY SJ & NB CAN GET < OCT90 DATA            
*        BE    GETASB8D                                                         
*        CLC   DBSELAGY,=C'NB'                                                  
*        BE    GETASB8D                                                         
         CLC   MLBOOK,=AL2(65535-OCT_90)                                        
         BNH   GETASB8D             IF BOOK >= OCT90 ITS GOOD                   
*                                                                               
GETASB8A MVI   MLIND,X'FF'                                                      
         MVC   MLIND+1(L'MLKMAJOR-(MLIND-MLKEY)-1),MLIND                        
         B     GETASB5             LOOK UP NEXT BOOK                            
*                                                                               
GETASB8D DS    0H                  CHECK MARKET                                 
         CLC   MLRMKT,DBSELRMK                                                  
         BH    GETASB8H             HIGH==>GET NEXT BOOK                        
         BL    GETASB8L             LOW==>RESET MARKET IN KEY                   
         B     GETASB8AX                                                        
                                                                                
GETASB8H DS    0H                  MLRMKT > DBSELRMK                            
         MVI   MLIND,X'FF'                                                      
         MVC   MLIND+1(L'MLKMAJOR-(MLIND-MLKEY)-1),MLIND                        
         B     GETASB5              LOOK UP NEXT BOOK                           
                                                                                
GETASB8L DS    0H                  MLRMKT < DBSELRMK                            
         MVC   MLRMKT,DBSELRMK      RESET MARKET IN KEY                         
         XC    MLRMKT+L'MLRMKT(10),MLRMKT+L'MLRMKT                              
         B     GETASB5              READ HIGH FOR MARKET AGAIN                  
                                                                                
GETASB8AX EQU  *                                                                
         DS    0H                  SAVE DBACTS TO RESET RDING LATER             
         MVC   DBACTBK,MLBOOK                                                   
         MVC   DBACTRMK,MLRMKT     RTG SRVC MKT                                 
         MVC   DBACTSTA,MLSTAT                                                  
         MVC   DBACTKMK,MLKMKT     SPILL MKT                                    
         MVC   DBSTYPE,MLSTYP                                                   
         MVC   DBBTYPE,MLBTYP      BOOKTYPE                                     
         CLC   =C'HUT',MLSTAT     SKIP HUTW RECORDS                             
         BNE   *+12                                                             
         MVI   MLHOME,X'FF'                                                     
         B     GETASB5                                                          
*                                                                               
*CONVERT NUMERIC CABLE # TO CALL LETTERS FOR FUSION                             
         CLI   DBSELSRC,C'F'                                                    
         BNE   GETASB9                                                          
         XC    WORK,WORK                                                        
         MVC   WORK(L'MLSTAT),MLSTAT                                            
         BRAS  RE,CABALPH          CONVERT CABLE # TO ALPHA                     
         MVC   DBACTSTA,MLSTAT                                                  
         MVC   MLSTAT,WORK+5                                                    
                                                                                
GETASB9    EQU  *                                                               
*                                                                               
                                                                                
*                                  RETURN TO CALLER                             
GETASBX  DS    0H                                                               
         MVI   DBRECTYP,DBRECMS                                                 
         MVI   DBMODE,DBMNEXT      SET SEQUENTIAL MODE                          
         BRAS  RE,GETX                                                          
         B     GETASB4             GET NEXT RECORD                              
                                                                                
*                                                                               
GETASBNF DS    0H                                                               
         MVI   DBERROR,NOTFOUND    RETURN NOT FOUND                             
         B     GETX                                                             
*                                                                               
GETASBEOF DS   0H                                                               
         MVI   DBERROR,EOF         RETURN END-OF-FILE                           
         B     GETX                                                             
         DROP  R2                                                               
         EJECT                                                                  
**********************************************************************          
*GETAB - GET ALL BOOKS                                                          
*        RTNS DBRECSM  RECD WITH DBACTBK AND DBBTYPE SET                        
**********************************************************************          
GETAB    DS    0H                                                               
         CLI   DBSELMED,C'N'                                                    
         BNE   *+12                                                             
         MVI   DBERROR,INVMED      SORRY, N/A FOR NETWORK                       
         B     GETX                                                             
         CLI   DBSELMED,C'U'       COUNTY COVERAGE                              
         BE    GETAB40                                                          
*                                                                               
         DS    0H                                                               
         CLI   0(R1),0                                                          
         BNE   GETAB4                                                           
         XC    DBACTBK,DBACTBK                                                  
*                                  GET FIRST/NEXT MARKET RECORD                 
GETAB4   DS    0H                                                               
         CLI   DBACTSRC,C'N'       FOR SOURCE=NIELSEN AND                       
         BNE   *+12                                                             
         CLI   DBINTMED,C'T'        MEDIA=USTV,                                 
         BE    GETAB10              USE MKT TOTAL RECD LOGIC                    
         LA    R2,DBKEY                                                         
         USING BSKEY,R2            R2=A(KEY)                                    
         XC    BSKMAJOR,BSKMAJOR   (RE)/BUILD KEY                               
         MVI   BSCODE,BSCODEQU                                                  
         MVC   BSMEDIA,DBINTMED                                                 
         MVC   BSSRC,DBACTSRC                                                   
         MVI   BSIND,BSINDEQU                                                   
         OC    DBACTBK,DBACTBK     FIRST LK UP?                                 
         BZ    GETAB4X               DON'T SET ANYTHING ELSE                    
         MVC   BSBOOK,DBACTBK                                                   
         MVC   BSSTAT,DBACTSTA                                                  
         MVC   BSKMKT,DBACTKMK                                                  
         MVC   BSSTYP,DBSTYPE                                                   
         MVC   BSBTYP,DBBTYPE                                                   
         MVC   BSRMKT,=X'FFFF'     FORCE TO READ NEXT BOOKTYPE                  
         MVI   BSHOME,X'FF'          "    "  "    "      "                      
GETAB4X  EQU   *                                                                
                                                                                
*                                                                               
GETAB5   DS    0H                                                               
         MVI   IOFLAG,DIR+HIGH     READ HIGH/DIRECTORY                          
         GOTO1 AIO,IOFLAG                                                       
         BL    GETX                 ERRORS                                      
         BE    GETAB8               FOUND                                       
                                                                                
         OC    DBACTBK,DBACTBK     TEST IF FIRST TIME                           
         BZ    GETABNF              YES - RETURN NOT FOUND                      
         B     GETABEOF             NO  - RETURN EOF                            
                                                                                
*                                  CHECK RETURN KEY                             
GETAB8   DS    0H                                                               
         CLC   BSKEY((BSSRC+L'BSSRC)-BSKEY),KEYSAVE                             
         BE    *+18                                                             
         OC    DBACTBK,DBACTBK     WAS ANYTHING FOUND BEFORE?                   
         BNZ   GETABEOF             YES - RETURN EOF                            
         B     GETABNF              NO  - RETURN NOT FOUND                      
*                                                                               
         CLI   DBSELMED,C'T'       NSI USTV DATA VALID POST OCT90               
         BNE   GETAB08A                                                         
         CLI   DBSELSRC,C'N'                                                    
         BNE   GETAB08A                                                         
*3/23/04 CLC   DBSELAGY,=C'SJ'     ONLY SJ & NB CAN GET < OCT90 DATA            
*        BE    GETAB08A                                                         
*        CLC   DBSELAGY,=C'NB'                                                  
*        BE    GETAB08A                                                         
         CLC   BSBOOK,=AL2(65535-OCT_90)  IF BOOK >=OCT90, ITS OKAY             
         BH    GETAB08H             ELSE READ FOR NEXT BK                       
*                                                                               
GETAB08A DS    0H                  CHECK FOR CORRECT INDICATOR                  
         CLI   BSIND,BSINDEQU                                                   
         BH    GETAB08H                                                         
         BL    GETAB08L                                                         
         B     GETAB08X                                                         
                                                                                
GETAB08H DS    0H                  BSIND > BSINDEQU                             
         MVI   BSIND,X'FF'                                                      
         MVC   BSIND+1(L'BSKMAJOR-(BSIND-BSKEY)-1),BSIND                        
         B     GETAB5               LOOK UP NEXT BOOK                           
                                                                                
GETAB08L DS    0H                  BSIND < BSINDEQU                             
         MVI   BSIND,BSINDEQU                                                   
         XC    BSSTAT(12),BSSTAT                                                
         B     GETAB5               READ HIGH TO GET CORRECT INDICATOR          
GETAB08X EQU   *                                                                
*                                                                               
         DS    0H                  SAVE DBACTS TO RESET RDING LATER             
         MVC   DBACTBK,BSBOOK                                                   
         MVC   DBACTRMK,BSRMKT     RTG SRVC MKT                                 
         MVC   DBACTSTA,BSSTAT                                                  
         MVC   DBACTKMK,BSKMKT     SPILL MKT                                    
         MVC   DBSTYPE,BSSTYP                                                   
         MVC   DBBTYPE,BSBTYP      BOOKTYPE                                     
                                                                                
*                                  RETURN TO CALLER                             
GETABX   DS    0H                                                               
         MVI   DBRECTYP,DBRECSM                                                 
         MVI   DBMODE,DBMNEXT      SET SEQUENTIAL MODE                          
         BRAS  RE,GETX                                                          
         B     GETAB4              GET NEXT RECORD                              
*                                                                               
* THIS CODE TO RETRIEVE ALL BOOKS FOR A GIVEN SRC/MEDIA RELIES ON THE           
*  FACT THAT THE SRC/MEDIA HAS MARKET TOTAL MLKEY POINTERS.  OTHERWISE,         
*  THIS LOGIC WILL NOT BE ABLE TO GET ALL BOOKS.                                
                                                                                
GETAB10  DS    0H                                                               
         LA    R2,DBKEY                                                         
         USING MLKEY,R2            R2=A(KEY)                                    
         XC    MLKMAJOR,MLKMAJOR                                                
         MVI   MLCODE,MLCODEQU                                                  
         MVC   MLMEDIA,DBINTMED                                                 
         MVC   MLSRC,DBACTSRC                                                   
         MVI   MLIND,MLINDEQU                                                   
                                                                                
*                                                                               
GETAB12  DS    0H                                                               
         MVI   IOFLAG,DIR+HIGH     READ HIGH/DIRECTORY                          
         GOTO1 AIO,IOFLAG                                                       
         BL    GETX                 ERRORS                                      
         BE    GETAB14              FOUND                                       
                                                                                
         OC    DBACTBK,DBACTBK     TEST IF FIRST TIME                           
         BZ    GETABNF              YES - RETURN NOT FOUND                      
         B     GETABEOF             NO  - RETURN EOF                            
                                                                                
*                                                                               
GETAB14  DS    0H                  CHECK FOR CORRECT RECTYPE/MEDIA/SRC          
         CLC   MLKEY((MLSRC+L'MLSRC)-MLKEY),KEYSAVE                             
         BE    *+18                                                             
         OC    DBACTBK,DBACTBK     WAS ANYTHING FOUND BEFORE?                   
         BNZ   GETABEOF             YES - RETURN EOF                            
         B     GETABNF              NO  - RETURN NOT FOUND                      
*                                                                               
         DS    0H                  CHECK FOR CORRECT INDICATOR                  
         CLI   MLIND,MLINDEQU       DO WE HAVE CORRECT ONE?                     
         BE    *+18                  YEP                                        
         MVI   MLIND,X'FF'           NOPE, FORCE TO READ NEXT BOOK              
         MVC   MLIND+1(L'MLKMAJOR-(MLIND-MLKEY)-1),MLIND                        
         B     GETAB12                                                          
                                                                                
*                                                                               
GETAB16  DS    0H                  READ FOR MARKET TOTAL PTR FOR MLRMKT         
         XC    MLSTAT(L'MLKMAJOR-(MLSTAT-MLKEY)),MLSTAT                         
         MVI   MLSTAT,X'F0'         MKT TOTAL PTR HAS NUMERIC STATION           
*                                                                               
         DS    0H                                                               
         MVI   IOFLAG,DIR+HIGH                                                  
         B     GETAB16G                                                         
GETAB16D DS    0H                                                               
         MVI   IOFLAG,DIR+SEQ                                                   
*        B     GETAB16G                                                         
                                                                                
GETAB16G DS    0H                                                               
         GOTO1 AIO,IOFLAG                                                       
         BL    GETX                                                             
         BE    GETAB17              FOUND                                       
                                                                                
         OC    DBACTBK,DBACTBK     TEST IF FIRST TIME                           
         BZ    GETABNF              YES - RETURN NOT FOUND                      
         B     GETABEOF             NO  - RETURN EOF                            
                                                                                
*                                                                               
GETAB17  DS    0H                                                               
         CLC   MLKEY((MLRMKT+L'MLRMKT)-MLKEY),KEYSAVE                           
         BE    GETAB17X                                                         
         CLC   MLKEY((MLIND+L'MLIND)-MLKEY),KEYSAVE                             
         BNE   GETAB14                                                          
         BE    GETAB16                                                          
GETAB17X EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                  PASS THIS RECORD BACK TO CALLER              
         MVC   DBACTBK,MLBOOK       BOOK                                        
         MVC   DBACTRMK,MLRMKT      RTG SRVC MKT                                
         MVC   DBBTYPE,MLBTYP       BOOKTYPE                                    
                                                                                
*                                  RETURN TO CALLER                             
GETAB19  DS    0H                                                               
         MVI   DBRECTYP,DBRECMS                                                 
         MVI   DBMODE,DBMNEXT      SET SEQUENTIAL MODE                          
         BAS   RE,GETX                                                          
         B     GETAB16D            GET NEXT RECORD                              
                                                                                
*                                                                               
GETABNF  DS    0H                                                               
         MVI   DBERROR,NOTFOUND    RETURN NOT FOUND                             
         B     GETX                                                             
*                                                                               
GETABEOF DS    0H                                                               
         MVI   DBERROR,EOF         RETURN END-OF-FILE                           
         B     GETX                                                             
         DROP  R2                                                               
*                                                                               
********************************************************                        
* THIS PART READS CUN RECORDS TO GET ALL BOOKS FOR ALL                          
* FOR ALL STATES     ( COUNTY COVERAGE FILE)                                    
********************************************************                        
                                                                                
GETAB40  LA    R2,DBKEY            GET MARKET NAME DIRECTORY ITEM               
                                                                                
         USING DMKEY,R2            R2=A(KEY)                                    
         XC    DMKEY,DMKEY                                                      
         MVI   DMCODE,C'C'         BUILD KEY                                    
         MVC   DMMEDIA,DBINTMED                                                 
         MVC   DMSRC,DBACTSRC                                                   
         MVI   IOFLAG,DIR+HIGH     READ/DIRECTORY                               
                                                                                
         GOTO1 AIO,IOFLAG                                                       
         BL    GETX                ERRORS                                       
         BE    GETAB60             FOUND                                        
                                                                                
                                                                                
         MVI   DBERROR,NOTFOUND    RETURN NOT FOUND                             
         B     GETX                                                             
                                                                                
GETAB60  B     GETAB90                                                          
GETAB70  MVI   IOFLAG,DIR+SEQ                                                   
         GOTO1 AIO,IOFLAG                                                       
         BNE   GETX                                                             
                                                                                
*                                  RETURN TO CALLER                             
GETAB90  L     RF,DBAREC                                                        
                                                                                
*        CLC   =C'CUN',0(RF)                                                    
         CLC   =C'CU',0(RF)                                                     
         BNE   GETABEOF                                                         
         MVI   DBRECTYP,DBRECMK                                                 
         MVI   DBMODE,DBMNEXT      SET SEQUENTIAL MODE                          
         DS    0H                  PASS THIS RECORD BACK TO CALLER              
         MVC   DBACTBK,3(RF)        BOOK                                        
         MVC   DBBTYPE,5(RF)        BOOKTYPE                                    
                                                                                
         BRAS  RE,GETX                                                          
         B     GETAB70             GET NEXT RECORD                              
         DROP  R2                                                               
                                                                                
         EJECT                                                                  
**********************************************************************          
*GETASM - GET ALL SPILL MARKETS ACROSS ALL BOOKS FOR A STATION                  
*        RTNS  DBRECSM  RECD WITH DBACT VALUES SET                              
**********************************************************************          
GETASM   DS    0H                                                               
         CLI   DBSELMED,C'N'                                                    
         BNE   *+12                                                             
         MVI   DBERROR,INVMED      SORRY, N/A FOR NETWORK                       
         B     GETX                                                             
*                                                                               
         DS    0H                                                               
         CLI   0(R1),0                                                          
         BNE   GETASM4                                                          
         XC    DBACTRMK,DBACTRMK                                                
                                                                                
*                                  GET FIRST/NEXT MARKET RECORD                 
GETASM4  DS    0H                                                               
         LA    R2,DBKEY                                                         
         USING BSKEY,R2            R2=A(KEY)                                    
         XC    BSKMAJOR,BSKMAJOR   (RE)/BUILD KEY                               
         MVI   BSCODE,BSCODEQU                                                  
         MVC   BSMEDIA,DBINTMED                                                 
         MVC   BSSRC,DBACTSRC                                                   
         MVI   BSIND,BSINDEQU                                                   
         MVC   BSSTAT,DBSELSTA                                                  
         OC    DBACTRMK,DBACTRMK   FIRST LK UP?                                 
         BZ    GETASM4X             DON'T SET ANYTHING ELSE                     
         MVC   BSBOOK,DBACTBK                                                   
         MVC   BSKMKT,DBACTKMK                                                  
         MVC   BSSTYP,DBSTYPE                                                   
         MVC   BSBTYP,DBBTYPE                                                   
         MVC   BSRMKT,=X'FFFF'     FORCE TO READ NEXT BOOKTYPE                  
         MVI   BSHOME,X'FF'          "    "  "    "      "                      
GETASM4X EQU   *                                                                
                                                                                
*                                                                               
GETASM5  DS    0H                                                               
         MVI   IOFLAG,DIR+HIGH     READ HIGH/DIRECTORY                          
         GOTO1 AIO,IOFLAG                                                       
         BL    GETX                 ERRORS                                      
         BE    GETASM8              FOUND                                       
                                                                                
         OC    DBACTRMK,DBACTRMK   TEST IF FIRST TIME                           
         BZ    GETASMNF             YES - RETURN NOT FOUND                      
         B     GETASMEOF            NO  - RETURN EOF                            
                                                                                
*                                  CHECK RETURN KEY                             
GETASM8  DS    0H                                                               
         CLC   BSKEY((BSSRC+L'BSSRC)-BSKEY),KEYSAVE                             
         BE    *+18                                                             
         OC    DBACTRMK,DBACTRMK   WAS ANYTHING FOUND BEFORE?                   
         BNZ   GETASMEOF            YES - RETURN EOF                            
         B     GETASMNF             NO  - RETURN NOT FOUND                      
*                                                                               
         DS    0H                  CHECK FOR CORRECT INDICATOR                  
         CLI   BSIND,BSINDEQU                                                   
         BH    GETASM08H                                                        
         BL    GETASM08L                                                        
         CLI   DBSELMED,C'T'       NSI USTV DATA VALID POST OCT90               
         BNE   GETASM08X                                                        
         CLI   DBSELSRC,C'N'                                                    
         BNE   GETASM08X                                                        
*        CLC   DBSELAGY,=C'SJ'     ONLY SJ & NB CAN GET < OCT90 DATA            
*        BE    GETASM08X                                                        
*        CLC   DBSELAGY,=C'NB'                                                  
*        BE    GETASM08X                                                        
         CLC   BSBOOK,=AL2(65535-OCT_90)  IF BOOK >=OCT90, ITS OKAY             
         BH    GETASM08H             ELSE READ FOR NEXT BK                      
         B     GETASM08X                                                        
                                                                                
GETASM08H DS   0H                  BSIND > BSINDEQU                             
         MVI   BSIND,X'FF'                                                      
         MVC   BSIND+1(L'BSKMAJOR-(BSIND-BSKEY)-1),BSIND                        
         B     GETASM5              LOOK UP NEXT BOOK                           
                                                                                
GETASM08L DS   0H                  BSIND < BSINDEQU                             
         MVI   BSIND,BSINDEQU                                                   
         XC    BSSTAT(12),BSSTAT                                                
         B     GETASM5              READ HIGH TO GET CORRECT INDICATOR          
GETASM08X EQU  *                                                                
                                                                                
*                                                                               
         DS    0H                  CHECK FOR CORRECT STATION                    
         CLC   BSSTAT,DBSELSTA                                                  
         BH    GETASM10H                                                        
         BL    GETASM10L                                                        
         B     GETASM10X                                                        
                                                                                
GETASM10H DS   0H                  BSSTAT > DBSELSTA                            
         MVI   BSIND,X'FF'                                                      
         MVC   BSIND+1(L'BSKMAJOR-(BSIND-BSKEY)-1),BSIND                        
         B     GETASM5              LOOK UP NEXT BOOK                           
                                                                                
GETASM10L DS   0H                  BSSTAT < DBSELSTA                            
         MVC   BSSTAT,DBSELSTA                                                  
         XC    BSKMKT(07),BSKMKT                                                
         B     GETASM5              READ HIGH TO GET CORRECT STATION            
GETASM10X EQU  *                                                                
                                                                                
*                                                                               
         DS    0H                  SAVE DBACTS TO RESET RDING LATER             
         MVC   DBACTBK,BSBOOK                                                   
         MVC   DBACTRMK,BSRMKT      RTG SRVC MKT                                
         MVC   DBACTSTA,BSSTAT                                                  
         MVC   DBACTKMK,BSKMKT      SPILL MKT                                   
         MVC   DBSTYPE,BSSTYP                                                   
         MVC   DBBTYPE,BSBTYP       BOOKTYPE                                    
                                                                                
*                                  RETURN TO CALLER                             
GETASMX  DS    0H                                                               
         MVI   DBRECTYP,DBRECSM                                                 
         MVI   DBMODE,DBMNEXT      SET SEQUENTIAL MODE                          
         BRAS  RE,GETX                                                          
         B     GETASM4             GET NEXT RECORD                              
                                                                                
*                                                                               
GETASMNF DS    0H                                                               
         MVI   DBERROR,NOTFOUND    RETURN NOT FOUND                             
         B     GETX                                                             
*                                                                               
GETASMEOF DS   0H                                                               
         MVI   DBERROR,EOF         RETURN END-OF-FILE                           
         B     GETX                                                             
         DROP  R2                                                               
         EJECT                                                                  
**********************************************************************          
*GETMK   GET A MARKET NAME RECORD                                               
**********************************************************************          
         SPACE 1                                                                
GETMK    BRAS  RE,GETMKREC         CALL ROUTINE TO GET MARKET NAME              
         B     GETX                                                             
         EJECT                                                                  
**********************************************************************          
*GETMKN - GET MARKET NAMES FOR A RATING SEVICE/MEDIA                            
**********************************************************************          
         SPACE 1                                                                
GETMKN   LA    R2,DBKEY                                                         
         USING DMKEY,R2            R2=A(KEY)                                    
         XC    DMKMAJOR,DMKMAJOR   BUILD KEY                                    
         MVI   DMCODE,DMCODEQU                                                  
         MVC   DMMEDIA,DBINTMED                                                 
         MVC   DMSRC,DBACTSRC                                                   
*                                                                               
         CLI   DBSELMED,C'N'                                                    
         BNE   GETMKN15                                                         
         L     R1,=A(NETSRC)                                                    
         A     R1,RELO                                                          
         MVC   WORK(11),=C'**UNKNOWN**'                                         
GETMKN10 CLI   0(R1),X'FF'                                                      
         BE    GETMKN13                                                         
         MVC   DBMINKEY,2(R1)      GET MKT # FROM TABLE                         
         MVC   WORK(11),9(R1)      PASS WORK TO BLDMKT W/NAME IN IT             
GETMKN12 GOTO1 ABLDMRKT          BUILD DUMMY RECD W/MKT NAME IN WORK            
         MVI   DBRECTYP,DBRECMK    RETURN TO CALLER                             
         MVI   DBMODE,DBMNEXT                                                   
         BRAS  RE,GETX                                                          
         LA    R1,L'NETSRC(R1)                                                  
         B     GETMKN10            LOOP THRU REST OF TABLE                      
GETMKN13 MVI   DBERROR,EOF                                                      
         B     GETX                                                             
*                                                                               
GETMKN15 MVI   MKPMODE,MKFSTQ                                                   
         MVC   MKPSRC,DMSRC                                                     
         MVC   MKPMED,DMMEDIA                                                   
         XC    MKPMKNUM,MKPMKNUM   READ FIRST MARKET FOR SRC/MEDIA              
*                                                                               
GETMKN20 BRAS  RE,MKNAME                                                        
         BE    *+12                                                             
         MVI   DBERROR,EOF                                                      
         B     GETX                                                             
         MVI   DBRECTYP,DBRECMK    RETURN TO CALLER                             
         MVI   DBMODE,DBMNEXT                                                   
         BRAS  RE,GETX                                                          
         MVI   MKPMODE,MKNXTQ      READ NEXT MARKET NAME ENTRY                  
         B     GETMKN20                                                         
         DROP  R2                                                               
         EJECT                                                                  
**********************************************************************          
*GETMKB - GET MARKET NAME RECORDS FOR A BOOK                                    
**********************************************************************          
         SPACE 1                                                                
GETMKB   CLI   DBSELMED,C'N'                                                    
         BE    GETMKBN                                                          
         CLI   DBSELMED,C'U'       COUNTY COVERAGE                              
         BE    GETMKBC1                                                         
                                                                                
         CLI   0(R1),0                                                          
         BNE   GETMKB4                                                          
         CLI   DBSELMED,C'T'       NSI USTV DATA VALID POST OCT90               
         BNE   GETMKB1                                                          
         CLI   DBSELSRC,C'N'                                                    
         BNE   GETMKB1                                                          
         CLC   DBSELAGY,=C'SJ'     ONLY SJ & NB CAN GET < OCT90 DATA            
         BE    GETMKB1                                                          
         CLC   DBSELAGY,=C'NB'                                                  
         BE    GETMKB1                                                          
         CLC   DBSELBK,=AL2(OCT_90)  IF BOOK >=OCT90, ITS OKAY                  
         BL    GETMKB2             RTN NOT FOUND                                
*                                                                               
GETMKB1  LA    R2,DBKEY            GET MARKET NAME DIRECTORY ITEM               
         USING DMKEY,R2            R2=A(KEY)                                    
         MVI   DMCODE,DMCODEQU     BUILD KEY                                    
         MVC   DMMEDIA,DBINTMED                                                 
         CLI   DBINTMED,C'O'       TP OVERNIGHTS READ USTV MKT NAME             
         BNE   *+8                 RECS                                         
         MVI   DMMEDIA,C'T'                                                     
         MVC   DMSRC,DBACTSRC                                                   
         CLI   DBACTSRC,C'F'       FUSION READ NSI USTV MKT NAME REC            
         BNE   *+8                                                              
         MVI   DMSRC,C'N'                                                       
         MVC   DBACTBK,DBSELBK                                                  
*                                                                               
         MVI   MKPMODE,MKFSTQ                                                   
         MVC   MKPSRC,DMSRC                                                     
         MVC   MKPMED,DMMEDIA                                                   
         XC    MKPMKNUM,MKPMKNUM   FIRST MARKET FOR SRC/MEDIA                   
         BRAS  RE,MKNAME                                                        
         BE    GETMKB4             FOUND                                        
*                                                                               
GETMKB2  MVI   DBERROR,NOTFOUND    RETURN NOT FOUND                             
         B     GETX                                                             
*                                  GET FIRST/NEXT MARKET RECORD                 
GETMKB4  LA    R2,DBKEY                                                         
         USING MLKEY,R2            R2=A(KEY)                                    
         XC    MLKMAJOR,MLKMAJOR   BUILD KEY                                    
         MVI   MLCODE,MLCODEQU                                                  
         MVC   MLMEDIA,DBINTMED                                                 
         MVC   MLSRC,DBACTSRC                                                   
         MVC   MLBOOK,DBACTBK                                                   
         OC    MLBOOK,MLBOOK                                                    
         BZ    *+10                                                             
         XC    MLBOOK,EFFS                                                      
         MVI   MLIND,MLINDEQU                                                   
         MVC   MLRMKT,DBMINKEY                                                  
*----->  OC    MLRMKT,MLRMKT       TEST IF FIRST TIME                           
*----->  BZ    *+8                                                              
         MVI   MLSTAT,X'FF'        NO - SET STATION TO X'FF'                    
         MVI   IOFLAG,DIR+HIGH     READ HIGH/DIRECTORY                          
         GOTO1 AIO,IOFLAG                                                       
         BL    GETX                ERRORS                                       
         BE    GETMKB8             FOUND                                        
*                                                                               
GETMKB6  OC    DBMINKEY,DBMINKEY   TEST IF FIRST TIME                           
         BZ    GETMKB2             YES - RETURN NOT FOUND                       
         MVI   DBERROR,EOF         NO - RETURN EOF                              
         B     GETX                                                             
*                                  CHECK RETURN KEY                             
GETMKB8  CLC   MLKEY(MLBOOK-MLKEY),KEYSAVE                                      
         BNE   GETMKB6                                                          
         CLI   MLIND,MLINDEQU                                                   
         BNE   GETMKB6                                                          
         CLI   DBSELMED,C'T'       NSI USTV DATA VALID POST OCT90               
         BNE   GETMKB81                                                         
         CLI   DBSELSRC,C'N'                                                    
         BNE   GETMKB81                                                         
         CLC   DBSELAGY,=C'SJ'     ONLY SJ & NB CAN GET < OCT90 DATA            
         BE    GETMKB81                                                         
         CLC   DBSELAGY,=C'NB'                                                  
         BE    GETMKB81                                                         
         CLC   MLBOOK,=AL2(65535-OCT_90)   IF BOOK >=OCT90, ITS OKAY            
         BH    GETMKB6             ELSE DON'T RELEASE                           
*                                                                               
GETMKB81 OC    DBACTBK,DBACTBK     TEST IF BOOK PASSED                          
         BNZ   *+16                                                             
         MVC   DBACTBK,MLBOOK      NO - SET BOOK FROM KEY                       
         XC    DBACTBK,EFFS                                                     
         MVC   DUB(2),MLBOOK                                                    
         XC    DUB(2),EFFS                                                      
         CLC   DBACTBK,DUB                                                      
         BNE   GETMKB6                                                          
GETMKB8A CLC   DBBTYPE,MLBTYP      CHECK THE BOOK TYPE                          
         BE    GETMKB9                                                          
* FOR RADIO IF BOOKTYPE IF NOT THE SAME SEE IF ITS THE PRELIMINARY              
* PPM BOOKTYPE                                                                  
*                                                                               
         CLI   DBSELMED,C'R'                                                    
         BNE   GETMBK8E                                                         
         CLI   DBBTYPE,0                                                        
         BNE   *+12                                                             
         CLI   MLBTYP,C'P'                                                      
         BE    GETMKB9                                                          
         CLI   DBBTYPE,C'B'                                                     
         BNE   *+12                                                             
         CLI   MLBTYP,C'E'                                                      
         BE    GETMKB9                                                          
         CLI   DBBTYPE,C'H'                                                     
         BNE   GETMBK8E                                                         
         CLI   MLBTYP,C'I'                                                      
         BE    GETMKB9                                                          
*                                                                               
*                                                                               
GETMBK8E MVC   DBMINKEY,MLRMKT     SAVE FOR NEXT READ                           
         MVI   IOFLAG,DIR+SEQ                                                   
         GOTO1 AIO,IOFLAG                                                       
         BL    GETX                ERRORS                                       
         CLC   MLKEY(MLSTAT-MLKEY),KEYSAVE  SAME MARKET                         
         BE    GETMKB8A                     CONTINUE WITH BTYPE SEARCH          
         MVC   DBLSTDIR,DIRSAVE    DIFFERENT MARKET                             
         MVI   DBRECTYP,DBRECMK    TRY THE NEXT ONE                             
         MVI   DBMODE,DBMNEXT                                                   
         B     GETMKB4                                                          
*                                  SET-UP FOR FILE READ                         
GETMKB9  MVC   DBMINKEY,MLRMKT     SET MINOR KEY                                
         MVC   MKPMKNUM,MLRMKT     SET MARKET NUMBER                            
         BRAS  RE,MKNAME                                                        
         BE    GETMKBX                                                          
         GOTO1 ABLDMRKT                                                         
*                                  RETURN TO CALLER                             
GETMKBX  MVI   DBRECTYP,DBRECMK                                                 
         MVI   DBMODE,DBMNEXT      SET SEQUENTIAL MODE                          
         BRAS  RE,GETX                                                          
         B     GETMKB4             GET NEXT RECORD                              
         DROP  R2                                                               
                                                                                
*                                                                               
* ============== READ SPECIFIC TO COUNTY COVERAGE FILE ===                      
*                                                                               
GETMKBC1 LA    R2,DBKEY            GET MARKET NAME DIRECTORY ITEM               
         USING DMKEY,R2            R2=A(KEY)                                    
         XC    DMKEY,DMKEY                                                      
         MVI   DMCODE,C'C'         BUILD KEY                                    
         MVC   DMMEDIA,DBINTMED                                                 
         MVC   DMSRC,DBACTSRC                                                   
         MVC   3(2,R2),DBSELBK                                                  
         XC    3(2,R2),EFFS                                                     
         MVC   5(1,R2),DBBTYPE     STATE CODE                                   
         MVI   IOFLAG,DIR+READ     READ/DIRECTORY                               
                                                                                
         GOTO1 AIO,IOFLAG                                                       
         BL    GETX                ERRORS                                       
         BE    GETMKBC4            FOUND                                        
                                                                                
                                                                                
GETMKBC2 MVI   DBERROR,NOTFOUND    RETURN NOT FOUND                             
         B     GETX                                                             
                                                                                
GETMKBC4 MVI   IOFLAG,FILE+HIGH                                                 
         MVC   DIRSAVE,DBLSTDIR   SAVE  DIRECTORY ITEM                          
         B     GETMKBC6                                                         
GETMKBC5 MVI   IOFLAG,FILE+SEQ                                                  
                                                                                
GETMKBC6 GOTO1 AIO,IOFLAG                                                       
         BNE   GETX                                                             
                                                                                
*                                  RETURN TO CALLER                             
GETMKBCX L     RF,DBAREC                                                        
         CLC   KEYSAVE(9),0(RF)                                                 
         BNE   GETX                                                             
         MVI   DBRECTYP,DBRECMK                                                 
         MVI   DBMODE,DBMNEXT      SET SEQUENTIAL MODE                          
         BRAS  RE,GETX                                                          
         B     GETMKBC5            GET NEXT RECORD                              
         DROP  R2                                                               
         EJECT                                                                  
**********************************************************************          
*GETMKBN - GET MARKET NAME RECD FOR A BOOK FOR NETWORK                          
**********************************************************************          
GETMKBN  DS    0H                                                               
         CLI   0(R1),0                                                          
         BE    *+12                                                             
         ICM   R2,15,DIRSAVE                                                    
         B     GTMKBN4                                                          
*                                                                               
         MVC   DBACTBK,DBSELBK                                                  
         OC    DBACTBK,DBACTBK     SPECIFIC BOOK REQUESTED?                     
         BNZ   *+14                                                             
         BRAS  RE,GTNLBK           GET LATEST BOOK FOR SOURCE                   
         MVC   DBACTBK,DUB         SET                                          
         L     R2,=A(NETSRC)                                                    
         A     R2,RELO                                                          
         ST    R2,DUBSV                                                         
*                                                                               
GTMKBN4  XC    DUB,DUB                                                          
         CLI   0(R2),X'FF'                                                      
         BE    GTMKBNF             END OF FILE                                  
         MVC   DUB+1(2),DBACTBK                                                 
         MVI   DUB+4,PRSTYP-PRKEY                                               
         MVC   WORK(5),DBSELSTA                                                 
         MVC   DBSELSTA,4(R2)                                                   
         BRAS  RE,RDNET                                                         
         MVC   DBSELSTA,WORK       RESTORE DBLOCK FLD                           
         CLI   DBERROR,0                                                        
         BNE   GTMKBN8             NOT FOUND, BUMP TO NEXT MKT IN TBL           
         MVC   DBMINKEY,2(R2)                                                   
         MVC   WORK(11),9(R2)                                                   
         GOTO1 ABLDMRKT                                                         
         MVI   DBMODE,DBMNEXT                                                   
         MVI   DBRECTYP,DBRECMK                                                 
         MVC   DIRSAVE(4),DUBSV    SAVE ADDRESS OF TABLE PTR                    
         BRAS  RE,GETX                                                          
GTMKBN8  LA    R2,L'NETSRC(R2)     NEXT MKT IN TABLE                            
         ST    R2,DUBSV                                                         
         CLI   0(R2),X'FF'                                                      
         BNE   GTMKBN4                                                          
*                                                                               
GTMKBNF  MVI   DBERROR,EOF                                                      
         B     GETX                                                             
         EJECT                                                                  
***********************************************************************         
*ACSALL - RTN ACCESS BLKS FOR FILE/MEDIA/AGY FOR EACH DCON RECD BOOK            
*         DBFUNCT=DBACSALL                                                      
***********************************************************************         
         SPACE 1                                                                
ACSALL   DS    0H                                                               
         MVI   DBMODE,DBMFRST                                                   
         OC    DBAREC,DBAREC                                                    
         JNZ   *+12                                                             
         MVI   DBERROR,HORREND     NO IO AREA SPECIFIED TO WRITE TO             
         J     GETX                                                             
*                                                                               
         OC    DBSELBK,DBSELBK     LK UP SPEC AGY/BK                            
         JZ    ACS05                                                            
         LA    R1,DBSELBK          R1=A(SELECTED BOOK)                          
         GOTO1 AGETCTRL            GET A(CONTRL HDR)                            
         JNZ   *+12                                                             
         MVI   DBERROR,NOTFOUND                                                 
         J     GETX                                                             
         XC    AAGYHDR,AAGYHDR     NO HK LOOPING                                
         SR    R2,R2                                                            
         ICM   R2,7,ACONHDR+1      PICK UP AUTH BLOCK ADDR                      
         J     ACS20               COPY TO USER'S IO AREA IN DBAREC             
*                                                                               
*                                  ALL RECDS FOR AGY INCL DEFAULT               
ACS05    LA    R1,=XL2'4F0C'       GET DEFAULT SRC/MED RECD                     
         MVC   WORKSV(2),DBSELAGY                                               
         MVC   DBSELAGY,=X'FFFF'   DUMMY AGENCY TO PULL F/M DEFAULT             
         GOTO1 AGETCTRL            GET A(CONTRL HDR)                            
         JNZ   ACS10                                                            
         MVC   DBSELAGY,WORKSV                                                  
         MVI   DBERROR,NOTFOUND                                                 
         J     GETX                                                             
*                                                                               
ACS10    DS    0H                  LK UP ACTUAL AGY CONTROLS                    
         MVC   DBSELAGY,WORKSV                                                  
         SR    R2,R2                                                            
         ICM   R2,7,ACONHDR+1      R2->DEFAULT RECD FOR SRC/MEDIA               
         LA    R1,=XL2'4F0C'       NOW FIND TOP OF AGY SPEC AUTH                
         GOTO1 AGETCTRL                                                         
         STCM  R2,15,ACONHDR       RESTORE PTR TO DEFAULT SRC/MED               
         MVI   DBERROR,0                                                        
*                                                                               
         ICM   R2,7,AAGYHDR+1                                                   
         LTR   R2,R2                                                            
         JZ    *+8                                                              
         AHI   R2,-1                                                            
         STCM  R2,7,AAGYHDR+1      LINK STORED AS ADDR-1                        
         SR    R2,R2                                                            
         ICM   R2,7,ACONHDR+1      R2=A(CONTROL TABLE HEADER)                   
*                                                                               
ACS20    DS    0H                  R2 -> AUTH ENTRY                             
         LAM   AR2,AR2,ALET                                                     
         SAC   512                                                              
         LTR   R2,R2                                                            
         JZ    ACSEOF                                                           
         CLI   DBMODE,DBMFRST                                                   
         JE    ACS30                                                            
         CLC   WORKSV(4),0(R2)       MAKE SURE ENTRY MATCHS PREV F/M/S          
         JNE   ACSEOF                                                           
*                                                                               
ACS30    DS    0H                  PROCESS/SAVE ENTRY TO BUFFER                 
         SR    RF,RF                                                            
         ICM   RF,7,10(R2)         ADDRESS OF NEXT LINK-1                       
         CLI   DBMODE,DBMFRST                                                   
         JE    *+8                                                              
         STCM  RF,7,AAGYHDR+1      SAVE NEXT LINK                               
         SR    RF,R2               RF=#BYTE TO MOVE                             
         LR    R1,RF               SAVE LEN TO STORE AWAY LATER                 
         AHI   RF,1                                                             
         LR    R3,RF                                                            
         L     RE,DBAREC           IO AREA                                      
         MVCL  RE,R2               COPY ENTRY TO USER'S IO AREA                 
         XR    R2,R2                                                            
         SAR   AR2,R2              CLEAR AR2                                    
         SAC   0                   OUT OF AR MODE                               
*                                                                               
         L     RE,DBAREC           IO AREA                                      
         STCM  R1,7,10(RE)         GIVE HOOK LENGTH OF ENTRY-1                  
         MVC   WORKSV(4),0(RE)       SAVE F/M/S FOR NEXT TIME CMP               
         CLI   DBMODE,DBMFRST      FIRST TIME IN RTNS DEFAULT BLK               
         BNE   *+10                                                             
         MVC   WORKSV+2(2),DBSELAGY                                             
         OC    DBSELBK,DBSELBK     IF BK SPECIFIED, NO SEQ MODE                 
         JNZ   *+8                                                              
         MVI   DBMODE,DBMNEXT      SET SEQUENTIAL MODE                          
*                                                                               
         BRAS  RE,GETX             GO OFF TO USER HK                            
*                                                                               
         CLI   DBMODE,DBMNEXT                                                   
         JNE   *+12                                                             
         ICM   R2,7,AAGYHDR+1      R2=A(AGENCY DCON BLOCK-1)                    
         AHI   R2,1                                                             
         J     ACS20               PROCESS NEXT ENTRY                           
         MVI   DBERROR,EOF         DONE                                         
         J     GETX                                                             
*                                                                               
ACSNTFND DS    0H                  GET OUT OF AR MODE                           
         SAC   0                                                                
         XR    R2,R2                                                            
         SAR   AR2,R2              CLEAR AR2                                    
         XC    AAGYHDR,AAGYHDR                                                  
         MVI   DBERROR,NOTFOUND                                                 
         J     GETX                                                             
*                                                                               
ACSEOF   DS    0H                  DONE PROCESSING ENTRIES                      
         SAC   0                                                                
         XR    R2,R2                                                            
         SAR   AR2,R2              CLEAR AR2                                    
         XC    AAGYHDR,AAGYHDR                                                  
         MVI   DBERROR,EOF         DONE                                         
         J     GETX                                                             
         EJECT                                                                  
***********************************************************************         
* GETCTL -  GET AGENCY CONTROL TABLE VALUES - CONTROL BITS            *         
* RETURNED IN DBCNTRL                                                 *         
***********************************************************************         
         SPACE 1                                                                
GETCTL   LA    R1,DBSELBK                                                       
         OC    DBSELBK,DBSELBK     TEST IF BOOK PASSED                          
         JNZ   *+8                                                              
         LA    R1,EFFS             NO-USE LATEST BOOK VALUES                    
         GOTO1 AGETCTRL                                                         
         J     DEMX                                                             
         EJECT                                                                  
**********************************************************************          
* ROUTINE TO READ FUSION  SUBSCRIBER BASE RECORD                                
* FOR A GIVEN BOOK                                                              
**********************************************************************          
         SPACE 1                                                                
                                                                                
GETSYS   LA    R2,DBKEY                                                         
         USING DFUEKEY,R2           R2=A(KEY)                                   
         CLC   DBSELBK,=AL2(JAN_08) JAN/08                                      
         BL    GETSYS34                                                         
         OC    DBSELSTA,DBSELSTA   IF STATION PROVIDED- READ NEW                
***      BZ    GETSYS34            GTF PASSIVES                                 
         BNZ   GETSYS01                                                         
* IF NO STATIONS FILLED IN AND SYSCODE IS PASSED                                
* THEN REQUESTED BY SYSCODE                                                     
         OC    DBSELSYC,DBSELSYC   NO SYSCODE AND NO STATION MEANS              
         BZ    GETSYS34            REQUEST BY AMKT- USE OLD BTFS                
         CLC   DBSELBK,=AL2(JAN_08) JAN/08                                      
         BNL   GETSYS01                                                         
         B     GETSYS34                                                         
                                                                                
GETSYS01 XC    DFUEKMAJ,DFUEKMAJ                                                
         MVI   DFUECODE,DFUECODQ                                                
         MVC   DFUEMED,DBINTMED                                                 
         MVC   DFUESRC,DBSELSRC                                                 
         MVC   DFUEBOOK,DBSELBK                                                 
         XC    DFUEBOOK,=X'FFFF'                                                
         MVC   DFUEMKT,DBSELRMK                                                 
         MVC   DFUESYSC,DBSELSYC                                                
                                                                                
GETSYS08 MVI   IOFLAG,DIR+HIGH        READ/FILE                                 
         GOTO1 AIO,IOFLAG                                                       
         BNE   GETX                                                             
         BE    GETSYS12                                                         
GETSYS10 MVI   IOFLAG,DIR+SEQ      READ SEQUENTIAL/DIRECTORY                    
         GOTO1 AIO,IOFLAG                                                       
         BNE   GETX                                                             
GETSYS12 MVI   DBRECTYP,DBRECSYS  RETURN TO CALLER                              
*                                                                               
         L     R2,DBAREC                                                        
         USING DFUEKEY,R2                                                       
*                                                                               
         OC    DBSELSYC,DBSELSYC                                                
         BZ    GETSYS16                                                         
         CLC   DFUEKEY(DFUEMKT-DFUEKEY),KEYSAVE                                 
         BE    *+12                                                             
         MVI   DBERROR,EOF         NO - RETURN EOF                              
         B     GETX                                                             
         MVI   DBMODE,DBMNEXT                                                   
         CLC   DFUESYSC,DBSELSYC                                                
         BE    *+12                                                             
         MVI   DBKEY+(DFUESTN-DFUEKEY),X'FF'                                    
         B     GETSYS08                                                         
         MVI   DBMODE,DBMNEXT                                                   
         B     GETSYS17                                                         
                                                                                
*                                                                               
*   IF REQUESTED WITH MARKET PASSED IN                                          
*                                                                               
GETSYS16 CLC   DFUEKEY(DFUEBKTP-DFUEKEY),KEYSAVE                                
         BE    *+12                                                             
         MVI   DBERROR,EOF         NO - RETURN EOF                              
         B     GETX                                                             
         MVI   DBMODE,DBMNEXT                                                   
*                                                                               
* CONVERT NETWORK ID TO CALL LETTERS AND RETURN IN DBAREC                       
* CONVERT CALL LETTER TO NETWORK NUMERIC ID                                     
*                                                                               
GETSYS17 OC    DFUESTN,DFUESTN                                                  
         BNZ   GETSYS18                                                         
         MVC   DFUESTN(5),=C'00000'                                             
         B     GETSYS28                                                         
*                                                                               
GETSYS18 CLI   DFUESTN,0           TEST FOR 5 BYTE STATION NUMBER               
         BNE   GETSYS19            NO HANDLE NORMALLY                           
         MVC   WORK(3),DFUESTN+1                                                
         B     GETSYS20                                                         
*                                                                               
GETSYS19 PACK  DUB,DFUESTN(4)                                                   
         CVB   R0,DUB                                                           
         STCM  R0,7,WORK                                                        
*                                                                               
GETSYS20 L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,NSICABLE                                               
         ICM   RE,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            R0 HAS LENGTH OF TABLE ENTR                  
         LR    R1,RE               R1=A(TABLE)                                  
         USING NSICBLD,R1                                                       
                                                                                
GETSYS22 CLI   0(R1),X'FF'         EOT?                                         
         BNE   GETSYS24                                                         
         B     GETSYS28            EXIT WITH CALL ID                            
GETSYS24 CLC   NSICBNML,WORK       SAME NETWORK ID ?                            
         BE    GETSYS26                                                         
         AR    R1,R0                                                            
         B     GETSYS22                                                         
GETSYS26 MVC   DFUESTN,NSICCALL    RETURN CALL LETTERS                          
         MVI   DFUESTN+4,C'T'                                                   
         DROP  R1                                                               
                                                                                
*                                                                               
*                                                                               
*                                                                               
*                                                                               
GETSYS28 BRAS  RE,GETX                                                          
         B     GETSYS10            GET NEXT RECORD                              
         DROP  R2                                                               
         USING DSYKEY,R2            R2=A(KEY)                                   
GETSYS34 XC    DSYKMAJ,DSYKMAJ     BUILD KEY                                    
         MVI   DSYCODE,DSYCDEQU                                                 
         MVC   DSYMEDIA,DBINTMED                                                
         MVC   DSYSRC,DBSELSRC                                                  
         MVC   DSYBKEFF,DBSELBK                                                 
         XC    DSYBKEFF,=X'FFFF'                                                
*                                                                               
         OC    DBSELBK,DBSELBK                                                  
         BNZ   *+8                                                              
         LA    R1,EFFS             OR A(EFFS) IF NOT SPECIFIED                  
         GOTO1 AGETCTRL            GET AGENCY CONTROL INFO                      
         SR    R0,R0               SET-UP SELECTED MARKET NUMBER                
         TM    DBSELSTA,X'F0'      TEST FOR NUMERIC STATION                     
         BNO   *+14                                                             
         PACK  DUB,DBSELSTA(4)                                                  
         CVB   R0,DUB              YES - R0=MARKET NUMBER                       
         OC    DBSELRMK,DBSELRMK   TEST IF MARKET SET                           
         BNZ   *+8                                                              
         STCM  R0,3,DBSELRMK       NO - SET FROM STATION                        
*                                                                               
                                                                                
         MVI   IOFLAG,DIR+HIGH        READ/FILE                                 
         GOTO1 AIO,IOFLAG                                                       
         BE    GETSY45                                                          
         B     GETX                                                             
GETSY38  DS    0H                                                               
         MVI   IOFLAG,FILE+SEQ      NEXT SEQUENTIAL FILE READ                   
         GOTO1 AIO,IOFLAG                                                       
         JNE   GETX                                                             
         B     GETSY50                                                          
GETSY45  DS    0H                                                               
         CLC   DSYKEY(L'DSYKMAJ),KEYSAVE                                        
         BNE   GETX                                                             
         MVI   IOFLAG,FILE+HIGH       READ/FILE                                 
         GOTO1 AIO,IOFLAG                                                       
         BNE   GETX                                                             
*                                                                               
* FILTER ON MARKET -                                                            
* ADD CODE WHEN DAVID ADDS THE NUMERIC MKT # TO THE MSO RECORDS                 
*                                                                               
                                                                                
GETSY50  MVI   DBRECTYP,DBRECSYS  RETURN TO CALLER                              
         MVI   DBMODE,DBMNEXT                                                   
         BRAS  RE,GETX                                                          
         B     GETSY38             GET NEXT RECORD                              
*                                                                               
         EJECT                                                                  
         DROP  R2                                                               
         EJECT                                                                  
**********************************************************************          
* ROUTINE TO GET LATEST BOOK FOR NETWORK                                        
* DBSELSTA+4 HAS FILE:  C=CABLE, T=BROADCAST, S=SYNDICATION....                 
**********************************************************************          
                                                                                
GTNTLB   BRAS  RE,LATSTNBK                                                      
         BE    *+12                                                             
         MVI   DBERROR,NOTFOUND                                                 
         B     GETX                ERRORS                                       
         L     RE,DBAREC                                                        
         MVC   0(2,RE),DUB                                                      
         B     GETX                SEND LATEST BOOK                             
                                                                                
         TITLE 'FIND DEMO ROUTINE'                                              
***********************************************************************         
* ROUTINE TO EXECUTE I/O TO DEMO FILES.                               *         
*                                                                     *         
* ON ENTRY R1 POINTS TO A COMMAND FLAG WHICH CONTAINS COMMAND NUMBER, *         
* FILE/DIRECTORY NUMBER (ZERO MEANS USE DBFILNAM/DBDIRNAM) AND FILE   *         
* TYPE. ALL COMMANDS (SEE CMNDTAB) ARE AVAILABLE FOR BOTH FILE AND    *         
* DIRECTORY. FOR FILE COMMANDS A DIRECTORY READ IS EXECUTED IF DBNDXDA*         
* IS BINARY ZEROES. AS DMREAD FOR A D/A FILE IS NOT SUPPORTED THIS IS *         
* EMULATED. FOR DIRECTORY COMMANDS DBKEY IS ALWAYS SAVED IN KEYSAVE   *         
* BEFORE I/O IS EXECUTED, DBLSTDIR CONTAINS ACTUAL RECORD.            *         
*                                                                     *         
* ON EXIT DBERROR CONTAINS ERROR CONDITION (ZERO MEANS OK)            *         
*         USER'S IO AREA CONTAINS RECORD READ                         *         
*         CC=EQUAL IF I/O SUCCESSFUL                                  *         
*         CC=LOW IF DISK ERROR                                        *         
*         CC=HIGH FOR END-OF-FILE & NOT FOUND                         *         
***********************************************************************         
         SPACE 1                                                                
         PRINT GEN                                                              
IO       NTR1  BASE=BASE1,WORK=(R7,IOWORKX-IOWORKD)                             
         PRINT NOGEN                                                            
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         USING IOWORKD,R7          R7=A(LOCAL W/S)                              
         MVC   IOWORK1,0(R1)       SAVE COMMAND FLAG                            
         MVC   IOWORK2,IOWORK1                                                  
         PACK  IOWORK3,IOWORK1     INVERSE COMMAND FLAG                         
         NI    IOWORK2,X'07'       IOWORK2=FILE/DIR NUMBER                      
         LA    RE,DBFILNAM                                                      
         CLI   IOWORK2,0           TEST IF TO USE DEFAULT                       
         BE    IO2                                                              
         ZIC   RE,IOWORK2                                                       
         LA    RF,L'FDTAB                                                       
         MR    RE,RE                                                            
         LA    RE,FDTAB-L'FDTAB(RF)                                             
IO2      MVC   IOFILE,0(RE)        SET FILE/DIR NAMES                           
         MVC   IODIR,7(RE)                                                      
         NI    IOWORK3,X'03'       IOWORK3=COMMAND NUMBER                       
*        GOTO1 =V(PRNTBL),DMCB,=C' IO-WORK',(R7),C'DUMP',100,=C'1D'             
*        GOTO1 =V(PRNTBL),DMCB,=C' IOWORK1',IOWORK1,C'DUMP',3,=C'1D'            
         ZIC   RE,IOWORK3                                                       
         SLL   RE,3                                                             
         LA    RE,CMNDTAB-8(RE)                                                 
         MVC   IOCMND,0(RE)        SET COMMAND                                  
*        GOTO1 =V(PRNTBL),DMCB,=C' IOCMND',IOCMND,C'DUMP',7,=C'1D'              
*                                                                               
**       CLC   IOCMND,CMNDRSEQ     DON'T ADJUST FOR READ SEQUENTIALS            
**       BE    IO3                                                              
         BRAS  RE,ADJLIVE          ADJUST NET KEY FOR TIME SHIFTED DATA         
         BE    *+12                                                             
         MVI   DBERROR,NOTFOUND    DATA REQUESTED NOT ON FILE                   
         B     IOX                                                              
         BRAS  RE,COMMAVG          ADJUST KEY FOR COMMERCIAL DATA?              
         BNE   IO3                                                              
         ZIC   RE,DBKEY+1          YES. CONVERT MEDIA TO LOWER CASE             
         CHI   RE,C'A'                                                          
         BL    IO3                                                              
         SHI   RE,X'40'                                                         
         STC   RE,DBKEY+1                                                       
*                                                                               
IO3      TM    IOWORK1,DIR                                                      
         BZ    IO6                                                              
*                                  TEST DMRSEQ BROKEN BY USER                   
         CLC   IOCMND,CMNDRSEQ     TEST READ SEQUETIAL CALL                     
         BNE   IO4                                                              
         CLI   NEWDSEQ,C'Y'        TEST READ SEQUENCE BROKEN                    
         BE    *+12                                                             
         TM    DBMODE,DBMDSEQ                                                   
         BZ    IO4                                                              
         OI    IOWORK2,DIR+READ    SET TO DO DMREAD OF LAST RECORD              
         GOTO1 IO,IOWORK2                                                       
         BE    IO4                                                              
         DC    H'0'                USER MAY HAVE DESTROYED DBKEY                
*                                  DIRECTORY CALL                               
IO4      MVI   NEWDSEQ,C'N'        RESET READ SEQUENCE CONTROLS                 
         NI    DBMODE,X'FF'-DBMDSEQ                                             
                                                                                
         MVC   KEYSAVE,DBKEY       SAVE KEY                                     
         GOTO1 CDATAMGR,IOPARM,IOCMND,IODIR,DBKEY,DBAREC                        
*        ST    R1,TEMPR1                                                        
*        GOTO1 =V(PRNTBL),DMCB,=C' IOPARM',IOPARM,C'DUMP',20,=C'1D'             
*        GOTO1 =V(PRNTBL),DMCB,=C' IO-DIR',IODIR,C'DUMP',20,=C'1D'              
*        GOTO1 =V(PRNTBL),DMCB,=C' DBKEY',DBKEY,C'DUMP',100,=C'1D'              
*        GOTO1 =V(PRNTBL),DMCB,=C' DBAREC',DBAREC,C'DUMP',200,=C'1D'            
*        L     R1,TEMPR1                                                        
         BRAS  RE,IOTRACE                                                       
         L     RE,DBAREC           MOVE RECORD TO USER I/O AREA                 
         MVC   DBLSTDIR,0(RE)                                                   
         MVC   DBERROR,8(R1)       RETURN DATAMGR ERROR                         
         B     IOX                                                              
*                                  FILE CALL                                    
IO6      OC    DBNDXDA,DBNDXDA     TEST IF INDEX D/A PRESENT                    
         BNZ   IO8                                                              
         OI    IOWORK2,DIR+READ    NO - DO DIRECTORY READ                       
         GOTO1 IO,IOWORK2                                                       
         BNE   IOX                                                              
         OC    DBNDXDA,DBNDXDA     TEST IF INDEX D/A PRESENT                    
         BNZ   IO8                                                              
IO7XX    MVI   DBERROR,NOTFOUND    NO - RETURN NOT FOUND                        
         B     IOX                                                              
*                                                                               
IO8      L     RE,DBAREC           BUILD KEY IN USER I/O AREA                   
*        B     IO8A                *****CODE BELOW LOCKS OUT A FILE             
         BC    0,IO8A              *****CODE BELOW LOCKS OUT A FILE             
****************************************IN CASE OF DISASTER***********          
         CLC   IOFILE(6),=C'NTIFIL'                                             
         BNE   IO8A                                                             
*        CLI   DBKEY+1,C'N'          *  **NIELSEN MEDIAS**                      
*        BE    IO7XX                 *  N=NSI M=BIRCH                           
*        CLI   DBKEY+2,C'N'          *  **NIELSEN MEDIAS**                      
*        BE    IO7XX                 *  N=NSI M=BIRCH                           
*        CLI   DBKEY+2,C'M'          *                                          
*        BE    IO7XX                 *                                          
*                                    ***********************                    
**********************************************************************          
         CLI   DBKEY,X'FF'         TRAP EOF                                     
         BE    IO7XX                                                            
         CLI   DBKEY+1,C'R'          *  **ARBITRON MEDIAS***                    
         BNE   IO8A                  *                                          
         CLI   DBKEY+2,C'A'          *  **ARBITRON MEDIAS***                    
         BE    IO7XX                 *                                          
**********************************************************************          
IO8A     MVC   0(L'DBKEY,RE),DBKEY                                              
         MVC   L'DBKEY(L'DBMINKEY,RE),DBMINKEY                                  
         MVC   L'DBKEY+4(1,RE),DBSTATUS     USED BY DEMDIR/DEMFIL N/O           
         TM    IOWORK1,READ        TEST IF READ COMMAND                         
         BNO   *+10                                                             
         MVC   IOCMND,CMNDRDHI     YES - SET COMMAND TO READ HIGH               
       GOTO1 CDATAMGR,IOPARM,(DBFULTRK,IOCMND),IOFILE,DBNDXDA,DBAREC,0          
         BRAS  RE,IOTRACE                                                       
         MVC   DBERROR,8(R1)       RETURN DATAMGR ERROR                         
         TM    IOWORK1,READ        TEST IF READ COMMAND                         
         BNO   IOX                 NO - EXIT                                    
         MVI   DBERROR,NOTFOUND                                                 
         CLI   8(R1),0                                                          
         BNE   IOX                                                              
         L     RE,DBAREC                                                        
         CLC   0(L'DBKEY,RE),DBKEY CHECK RETURN KEY                             
         BNE   IOX                                                              
         CLC   L'DBKEY(L'DBMINKEY,RE),DBMINKEY                                  
         BNE   IOX                                                              
         MVI   DBERROR,0           RESET ERROR                                  
*                                  SET CC & RETURN                              
IOX      MVI   IOWORK1,1                                                        
         CLI   DBERROR,0                                                        
         BE    IOXX                                                             
         MVI   IOWORK1,2                                                        
         TM    DBERROR,EOF+NOTFOUND                                             
         BNZ   IOXX                                                             
         MVI   IOWORK1,0                                                        
IOXX     CLI   IOWORK1,1                                                        
         B     XIT                                                              
*                                                                               
*                                  PASS CONTROL TO USER'S TRACE RTN             
IOTRACE  OC    ATRCRTN,ATRCRTN                                                  
         BZR   RE                                                               
         NTR1                                                                   
         MVC   IOPARM(1),IOWORK1                                                
         L     RF,ATRCRTN                                                       
         L     RE,ROOTRD                                                        
         LR    R0,RE                                                            
         LM    R2,RC,28(RE)                                                     
         BASR  RE,RF                                                            
         XIT1                                                                   
         DROP  R7                                                               
         EJECT                                                                  
         LTORG                                                                  
         TITLE 'ALPHMKT'                                                        
***********************************************************************         
*ALPHMKT - DBCNVN2A AND DBCNVA2N CONVERTS BETWEEN NUMERIC AND ALPHA             
*  MKT NUMBER BY FILLING IN DUB OR DUB+3 WITH THE MKT FROM DBLOCK               
*  FIELDS: DBSELALF OR DBSELRMK                                                 
***********************************************************************         
         SPACE 1                                                                
ALPHMKT  NTR1  BASE=BASE1,LABEL=NO                                              
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         MVI   DBERROR,0                                                        
         XC    DUB,DUB                                                          
         CLI   DBFUNCT,DBCNVN2A    NUMERIC TO ALPHA?                            
         BNE   ALPH10                                                           
                                                                                
         MVC   DUB+3(2),DBSELRMK   SET FOR NUMERIC CNVSN                        
         BRAS  RE,TRAMKT                                                        
         MVC   DBSELALF,DUB        DUB(3) = ALPHA MARKET                        
         B     XIT                                                              
*                                                                               
ALPH10   CLI   DBFUNCT,DBCNVA2N    ALPHA TO NUMERIC?                            
         BNE   ALPH15                                                           
         MVC   DUB(3),DBSELALF     SET FOR ALPHA CONVSN                         
         BRAS  RE,TRAMKT           TRANSLATE ALPHAMKT TO NUMERIC MKT            
         MVC   DBSELRMK,DUB+3      DUB+3(2) = NUMERIC MARKET                    
         B     XIT                                                              
*                                                                               
ALPH15   MVI   DBERROR,INVCMND     SOMETHINGS WRONG->SHOULDNT BE HERE           
         B     XIT                                                              
*                                                                               
         LTORG                                                                  
         TITLE 'EQUATE CABLE ALPHA CALLS TO FILE VALUES'                        
***********************************************************************         
* EQUATE CABLE ALPHA CALLS TO NUMERIC FILE VALUES                     *         
* ON ENTRY, DBSELSTA HAS ALPHA CALL LETTERS.                          *         
* ON EXIT,  DBCABNUM HAS THE STATION CODE, IN A FORMAT THAT MATCHES   *         
*           THE KEYS OF THE DEMO RECORDS FOR THAT TYPE OF DATA.       *         
*           IF THE ALPHA CALL LETTERS ARE UNKNOWN, DBCABNUM WILL BE   *         
*           CLEARED.                                                  *         
***********************************************************************         
         SPACE 1                                                                
CABNUM   NTR1  BASE=BASE1,LABEL=NO                                              
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         XC    DBCABNUM,DBCABNUM   RESET FOR ERROR                              
         CLI   DBBTYPE,C'U'        DON'T CONVERT USER RECDS                     
         JE    CABNUMX                                                          
         CLI   DBSELSTA+4,C'S'     DON'T CONVERT SYN  TO CABLE CODE             
         JE    CABNUMX                                                          
         CLI   DBSELSTA+4,C'M'     DON'T CONVERT NAD-SYN TO CABLE CODE          
         JE    CABNUMX                                                          
         CLI   DBSELSRC,C'F'                                                    
         BE    *+16                                                             
         TM    SPNETFLG,SPCBLQ                                                  
         BNO   *+12                                                             
         CLI   DBFUNCT,DBGETMB     BOOK NOT PRESENT, TRANSLATE ANYWAY           
         BE    CABNUM01                                                         
         CLC   DBSELBK,=AL1(YR_1993,WEEK_37) ONLY DO AFTER OCT/93               
         JL    CABNUMX                                                          
         CLC   DBSELBK,=AL1(YR_1993,WEEK_49) WEEK 49 OUT OF SEQUENCE            
         JE    CABNUMX                                                          
         CLC   DBSELBK,=AL1(YR_1993,WEEK_50) WEEK 50 OUT OF SEQUENCE            
         JE    CABNUMX                                                          
         CLC   DBSELBK,=AL1(YR_1993,WEEK_51) WEEK 51 OUT OF SEQUENCE            
         JE    CABNUMX                                                          
*                                                                               
CABNUM01 MVC   DMCB,=AL4(NECABCLL)                                              
         CLI   FCBLEFLG,C'Y'                                                    
         BNE   *+10                                                             
         MVC   DMCB,=AL4(NSICABLE)                                              
         CLI   DBSELSRC,C'R'       RENTRAK?                                     
         BNE   *+10                                                             
         MVC   DMCB,=AL4(RECABCLL)                                              
*                                                                               
* DISABLE FOR NOW - ALSO HAVE TO CHANGE ALL REFERENCES TO NSICBLQ               
* TO READ PASSIVES                                                              
*&&DO                                                                           
* WHEN WE HAVE THE CSKEYS (CABLE EQUIVALENCE PASSIVES) LOADED WE CAN            
* BYPASS THE TABLE READIN AND READ THE PASSIVES ONLY                            
         CLI   DBSELSRC,C'F'                                                    
         JNE   *+18                                                             
         BRAS  RE,CABEQIV             IF WE FOUND THE CABLE NUMBER              
         OC    DBCABNUM,DBCABNUM      IN THE PASSIVE KEYS THEN USE IT           
         JNZ   CABNUM2D               ELSE TRY OUR TABLES                       
*&&                                                                             
CABNUM1A TM    DBSELSTA,X'F0'                                                   
         JO    CABNUM04                                                         
*                                                                               
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB                                                        
         ICM   RE,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            R0 HAS LENGTH OF TABLE ENTRY                 
         LR    R1,RE               R1=A(TABLE)                                  
                                                                                
CABNUM02 CLI   0(R1),X'FF'         EOT - EXIT                                   
         JE    CABNUM03                                                         
         CLC   DBSELSTA(4),0(R1)   SCAN FOR ALPHA STATION                       
         JE    CABNUM2B                                                         
*                                                                               
         AR    R1,R0                                                            
         J     CABNUM02                                                         
*                                                                               
CABNUM2B XR    RF,RF                                                            
         ICM   RF,3,4(R1)          CONVERT TABLE VALUE TO CHAR                  
         BNZ   CABNUM2C                                                         
*                                                                               
         XC    DBCABNUM,DBCABNUM                                                
         CLI   DBSELSRC,C'R'       RENTRAK?                                     
         BE    CABNUM2D                                                         
*                                                                               
         CLI   FCBLEFLG,C'Y'       NSI?                                         
         BNE   *+14                                                             
         MVC   DBCABNUM+1(3),8(R1) USE THE EXTENDED BINARY STATION CODE         
         B     CABNUM2D                                                         
*                                  NET?                                         
         MVC   DBCABNUM+1(3),6(R1) USE THE EXTENDED BINARY STATION CODE         
         B     CABNUM2D                                                         
*                                                                               
CABNUM2C CVD   RF,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  DBCABNUM(4),DUB+5(3) AND SEED IN DBLOCK                          
                                                                                
CABNUM2D CLI   DBSELSRC,C'F'                                                    
         BE    *+16                                                             
         TM    SPNETFLG,SPCBLQ                                                  
         BO    *+8                                                              
         MVI   DBINTMED,C'C'                                                    
*                                                                               
         CLI   DBSELSRC,C'F'          FUSION STATIONS ARE NUMERIC               
         BNE   *+10                                                             
         MVC   DBSELSTA(4),DBCABNUM                                             
*                                                                               
         CLC   DBSELBK,=AL1(YR_2003,WEEK_40)     AFTER SEP29/03                 
         JL    *+20                                                             
         CLC   DBCABNUM,=C'5830'   IF REQUEST FOR TBS                           
         JNE   *+10                                                             
         MVC   DBCABNUM,=C'7237'   READ DATA FOR TBSN                           
*                                                                               
         J     CABNUMX                                                          
*                                                                               
CABNUM03 L     RF,DBCOMFCS         GET A(HISPANIC CABLE CALL LETTERS)           
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,NEHCBCLL                                               
         ICM   RE,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)                                                         
         LR    R1,RE                                                            
*                                                                               
         USING NEHCBCLD,R1                                                      
CABNUM3A CLI   0(R1),X'FF'         END OF HISPANIC TABLE ALSO                   
         JE    CABNUMX                                                          
         CLC   DBSELSTA(4),NEHCBALP  SCAN FOR ALPHA STATION                     
         JE    *+10                                                             
         AR    R1,R0                                                            
         J     CABNUM3A                                                         
*                                                                               
         MVI   DBCABNUM,C'H'                                                    
         MVI   DBCABNUM+1,0                                                     
         MVC   DBCABNUM+1(3),NEHCBNML                                           
         DROP  R1                                                               
         CLI   DBSELSRC,C'F'                                                    
         BE    *+16                                                             
         TM    SPNETFLG,SPCBLQ                                                  
         BO    *+8                                                              
         MVI   DBINTMED,C'C'                                                    
         J     CABNUMX                                                          
*                                                                               
*                                                                               
CABNUM04 MVC   DBCABNUM(4),DBSELSTA INPUT NUMERIC - JUST USE IT                 
         CLI   DBSELSRC,C'F'                                                    
         BE    *+16                                                             
         TM    SPNETFLG,SPCBLQ                                                  
         BO    *+8                                                              
         MVI   DBINTMED,C'C'                                                    
*                                                                               
CABNUMX  J     XIT                                                              
         LTORG                                                                  
         TITLE 'FIND A CABLE STATION'                                           
***********************************************************************         
* FIND A CABLE STATION                                                          
* ON EXIT, IF STATION IS VALID  : CBLENTY(4)=STATION CALL LETTERS               
*                                 CBLENTY+4(2)=MARKET NUMBER FOR ACCESS         
*                                 CBLENTY+6(1)=C'C'                             
*          IF STATION IS INVALID: CBLENTY IS CLEARED TO ZEROES                  
***********************************************************************         
         SPACE 1                                                                
GETCBL   NTR1  BASE=BASE1,LABEL=NO                                              
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         XC    CBLENTY,CBLENTY                                                  
*                                                                               
         CLI   DBSELSTA+4,C'M'                                                  
         JE    GETCBLX             N/A FOR NAD SYN                              
         CLI   DBBTYPE,C'U'                                                     
         JE    GETCBLX                                                          
*                                                                               
         L     R1,=A(OLDCABS)      OLD TABLE HAS STN/MKT                        
         A     R1,RELO                                                          
         LHI   R0,6                LENGTH OF TABLE ENTRY                        
         CLI   DBSELBK,88                                                       
         JNH   GETCBL2                                                          
*                                                                               
         MVC   DMCB,=AL4(NECABCLL)                                              
         CLI   FCBLEFLG,C'Y'                                                    
         BNE   *+10                                                             
         MVC   DMCB,=AL4(NSICABLE)                                              
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB                                                        
         ICM   RE,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            R0 HAS LENGTH OF TABLE ENTRY                 
         LR    R1,RE               R1=A(TABLE)                                  
*                                                                               
GETCBL2  CLI   0(R1),X'FF'         END OF TABLE                                 
         JE    GETCBLX                                                          
         CLC   DBSELSTA(4),0(R1)   IS IT THIS ONE                               
         JE    GETCBL3                                                          
         AR    R1,R0                                                            
         J     GETCBL2                                                          
*                                                                               
GETCBL3  MVC   CBLENTY(4),0(R1)    MOVE IN STATION NAME                         
         MVC   CBLENTY+4(2),=AL2(CBLMKT)   REGULAR CABLE MARKET NO              
         CLI   DBBTYPE,C'N'                                                     
         BNE   *+10                                                             
         MVC   CBLENTY+4(2),=AL2(CNADMKT)  CABLE NAD MARKET NO                  
         CLI   DBBTYPE,C'M'                                                     
         BNE   *+10                                                             
         MVC   CBLENTY+4(2),=AL2(MOVIEMKT) CABLE MOVIE GOER                     
         BRAS  RE,COMCMKT                                                       
         BNE   *+10                                                             
         MVC   CBLENTY+4(2),=AL2(ACMCBMKT) ACM(COMMERCIAL AVG) CABLE            
         MVI   CBLENTY+6,C'C'                                                   
         CLI   DBSELBK,88                                                       
         JH    *+10                                                             
         MVC   CBLENTY+4(2),4(R1)  SET  MKT NUMBER FROM OLD TABLE               
*                                                                               
         CLC   DBSELSTA(4),=C'WTBS'                                             
         JE    CHAWTBS                                                          
         CLC   DBSELSTA(4),=C'TBS '                                             
         JE    CHATBS                                                           
         CLC   DBSELSTA(4),=C'DISC'                                             
         JE    CHADISC                                                          
         CLC   DBSELSTA(4),=C'DSC '                                             
         JE    CHADSC                                                           
         J     GETCBLX                                                          
*                                                                               
CHAWTBS  CLC   DBSELBK,=AL1(YR_1992,WEEK_14)                                    
         JL    GETCBLX                                                          
         MVC   DBSELSTA(4),=C'TBS '                                             
         J     GETCBLX                                                          
*                                                                               
CHATBS   CLC   DBSELBK,=AL1(YR_1992,WEEK_13)                                    
         JH    GETCBLX                                                          
         MVC   DBSELSTA(4),=C'WTBS'                                             
         J     GETCBLX                                                          
*                                                                               
CHADSC   CLC   DBSELBK,=AL1(YR_1993,WEEK_49)    DEAL WITH BLACK WEEKS           
         JE    GETCBLX                                                          
         CLC   DBSELBK,=AL1(YR_1993,WEEK_50)                                    
         JE    GETCBLX                                                          
         CLC   DBSELBK,=AL1(YR_1993,WEEK_51)                                    
         JE    GETCBLX                                                          
         CLC   DBSELBK,=AL1(YR_1993,WEEK_37)    AND NEW FILE                    
         JL    GETCBLX                                                          
         MVC   DBSELSTA(4),=C'DISC'                                             
         J     GETCBLX                                                          
*                                                                               
CHADISC  CLC   DBSELBK,=AL1(YR_1993,WEEK_49)    DEAL WITH BLACK WEEKS           
         JE    CHADISC1                                                         
         CLC   DBSELBK,=AL1(YR_1993,WEEK_50)                                    
         JE    CHADISC1                                                         
         CLC   DBSELBK,=AL1(YR_1993,WEEK_51)                                    
         JE    CHADISC1                                                         
         CLC   DBSELBK,=AL1(YR_1993,WEEK_37)                                    
         JH    GETCBLX                                                          
*                                                                               
CHADISC1 MVC   DBSELSTA(4),=C'DSC '                                             
         J     GETCBLX             A SLIGHTLY SUPERFLUOUS BRANCH...             
*                                                                               
GETCBLX  XIT1                                                                   
         EJECT                                                                  
         TITLE 'TRANSLATE ALPHA MARKET'                                         
***********************************************************************         
* TRANSLATE ALPHA MARKET                                              *         
*                                                                     *         
* THIS ROUTINE IS USED MAP AN ALPHA MKT (STORED IN DUB(3)) TO A       *         
* NUMERIC MARKET USING THE ALPHAMKT TABLE IN THE TABS DATASPACE       *         
* OR IF DUB(3) = X'000000' THE REVERSE IS DONE.                       *         
* NTRY:                                                               *         
*   DUB(3)   = BLANK-PADDED ALPHA MARKET                              *         
* EXIT:                                                               *         
*   DUB+3(2) = NUMERIC MARKET                                         *         
***********************************************************************         
         SPACE 1                                                                
TPREC    EQU   WORK                                                             
         SPACE 1                                                                
TRAMKT   NTR1  BASE=BASE1,LABEL=NO                                              
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         OC    AAMKTTAB,AAMKTTAB   DID WE GET A(ALPHAMKT TABLE) YET?            
         JNZ   TAM02                YEP!                                        
*                                                                               
         BRAS  RE,GETATAB          GET TABLE ADDRESSES                          
*                                                                               
TAM02    STAR  CLEAR=Y,ARS=ON                                                   
         ICM   R2,15,AAMKTTAB      R2-->ALPHAMKT TABLE IN DATASPACE             
         JZ    TAMX                                                             
         LAM   AR2,AR2,ALET                                                     
         USING DAMHDRD,R2                                                       
                                                                                
         MVI   WORK,X'FF'          ASSUME DEFAULT BOOK TYPE                     
         CLI   DBBTYPE,0                                                        
         JE    *+10                                                             
         MVC   WORK(1),DBBTYPE                                                  
         CLI   DBSELMED,C'W'                                                    
         BNE   *+8                                                              
         MVI   DBINTMED,C'T'                                                    
                                                                                
         LA    RE,TAM04                                                         
         O     RE,=XL4'80000000'                                                
         BSM   0,RE                SWITCH TO 31-BIT MODE                        
*                                                                               
TAM04    CLC   0(2,R2),=X'FFFF'    AT END OF TABLE YET?                         
         JE    TAMX                                                             
         CLC   DAMHMED,DBINTMED    MATCH AGAINST MEDIA,                         
         JNE   TAM06                                                            
*                                                                               
         CLI   DBACTSRC,C'H'       FOR IHEART,                                  
         JE    *+8                                                              
         CLI   DBACTSRC,C'T'       FOR TRITON,                                  
         JNE   TAM04A                                                           
         CLI   DAMHSRC,C'A'        USE ARBITRON MARKET LIST                     
         JNE   TAM06                                                            
         J     TAM08                                                            
*                                                                               
TAM04A   CLI   DBACTSRC,C'C'       FOR NCM                                      
         JE    *+8                                                              
         CLI   DBACTSRC,C'V'       FOR VIDEOLOGY                                
         JNE   TAM05                                                            
         CLI   DAMHSRC,C'N'        USE NIELSEN MARKET LIST                      
         JNE   TAM06                                                            
         J     TAM08                                                            
*                                                                               
TAM05    CLC   DAMHSRC,DBACTSRC     AND SOURCE                                  
         JNE   TAM06                                                            
         J     TAM08                                                            
*                                                                               
TAM06    XR    R0,R0               BUMP TO NEXT MEDIA/SOURCE SECTION            
         ICM   R0,15,DAMHAET                                                    
         AHI   R0,1                                                             
         LR    R2,R0                                                            
         J     TAM04                                                            
*                                                                               
TAM08    XR    R0,R0               MEDIA/SOURCE SECTION FOUND                   
         ICM   R0,3,DAMHLDE        R0=L(DATA ELEMENT)                           
         LR    R3,R2                                                            
         AH    R3,=Y(DAMHDRL)                                                   
         CPYA  AR3,AR2                                                          
         USING DAMDTAD,R3                                                       
                                                                                
TAM10    OC    DUB(3),DUB          NUMERIC TO ALPHA                             
         JZ    TAM16                                                            
         CLC   DAMDAMKT,DUB        NOW MATCH ON ALPHA MARKET                    
         JH    TAMX                 EXIT NOW, NO USE LOOKING FURTHER            
         JL    TAM14                WANT EXACT MATCH                            
*                                  NOW MATCH ON BOOKTYPE                        
         CLI   WORK,C'R'           NEED EXACT MATCH FOR SQAD HISPANIC           
         BE    *+12                 (OVERLAP WITH NSI MARKETS)                  
         CLI   DAMDBTYP,X'FF'      USE DEFAULT BOOKTYPE IF CAN'T MATCH          
         JE    TAM12                BOOKTYPE EXACTLY                            
         CLC   DAMDBTYP,WORK       BOOKTYPE MATCH (WORK(1)=BOOKTYPE) ?          
         JNE   TAM14                NO, BUMP TO NEXT ENTRY                      
*                                                                               
TAM12    MVC   DUB+3(2),DAMDNMKT   FOUND NUMERIC MARKET                         
         CLI   DBSELMED,C'W'                                                    
         BNE   TAM13                                                            
         CLC   DUB+3(2),=AL2(168)  168 = ATL                                    
         BNE   *+10                FOR WEEKLY IT WAS NEVER CHANGED TO           
         MVC   DUB+3(2),=AL2(124)  168- KEEP USING 124                          
TAM13    J     TAMX                                                             
                                                                                
TAM14    AR    R3,R0                                                            
         CLM   R3,15,DAMHAET       COMPARE AGAINST EOTABLE ADDRESS              
         JL    TAM10                CONTINUE IF STILL LOW                       
         J     TAMX                ELSE EXIT, NOT FOUND                         
*                                                                               
* CONVERT FROM NUMERIC TO ALPHA                                                 
*                                                                               
TAM16    CLC   DAMDNMKT,DUB+3      NOW MATCH ON ALPHA MARKET                    
         JNE   TAM14                EXIT NOW, NO USE LOOKING FURTHER            
*                                  NOW MATCH ON BOOKTYPE                        
         CLI   WORK,C'R'           NEED EXACT MATCH FOR SQAD HISPANIC           
         BE    *+12                 (OVERLAP WITH NSI MARKETS)                  
         CLI   DAMDBTYP,X'FF'      USE DEFAULT BOOKTYPE IF CAN'T MATCH          
         JE    TAM18                BOOKTYPE EXACTLY                            
         CLC   DAMDBTYP,WORK       BOOKTYPE MATCH (WORK(1)=BOOKTYPE) ?          
         JNE   TAM14                NO, BUMP TO NEXT ENTRY                      
*                                                                               
TAM18    MVC   DUB(3),DAMDAMKT     FOUND ALPHA MARKET                           
         J     TAMX                                                             
*                                                                               
TAMX     LA    RE,*+6                                                           
         BSM   0,RE                                                             
         REAR  ARS=OFF              AND EXIT                                    
         CLI   DBSELMED,C'W'                                                    
         BNE   *+8                                                              
         MVI   DBINTMED,C'W'                                                    
         J     XIT                                                              
         DROP  R2,R3                                                            
*                                                                               
         LTORG                                                                  
         TITLE 'CALL DEMADDR TO GET SYSTEM TABLES INTO W/S'                     
**********************************************************************          
* GETATAB - GET ADDRESSES OF SYSTEM CONTROL TABLES INTO W/S          *          
**********************************************************************          
         SPACE 1                                                                
GETATAB  NTR1  BASE=BASE1,LABEL=NO,WORK=(R7,GETATDLQ)                           
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         USING GETATD,R7                                                        
*                                                                               
         L     R2,=A(DEMTABCL)     A(LIST OF TABLES WITHIN PROGRAM)             
         A     R2,RELO                                                          
         USING DEMTABCL,R2                                                      
         MVC   GTAATABS,ATABLESL   SET W/S FROM LIST WITHIN CSECT               
         MVC   NEWBOOK,NEWBOOKL                                                 
         OC    GTADBOOK+1(3),GTADBOOK+1  DID WE GET A(TABLES) ALREADY?          
         BNZ   GETAT20                   YES                                    
*                                                                               
         GOTO1 CDEMADDR,DMCB,(X'FF',GTAATABS),COMFACSD                          
         MVC   NEWBOOK,8(R1)       SAVE NEW BOOK EFFECTIVE DATE                 
*                                                                               
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CPROTOFF-COMFACSD(RF)                                      
         JZ    *+6                                                              
         BASR  RE,RF               *** TURN STORAGE PROTECTION OFF ***          
*                                                                               
         MVC   ATABLESL(TABLISTL),GTAATABS   SAVE A(TABLES) IN CSECT            
         MVC   NEWBOOKL,NEWBOOK                                                 
*                                                                               
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CPROTON-COMFACSD(RF)                                       
         JZ    *+6                                                              
         BASR  RE,RF               *** STORAGE PROTECTION BACK ON ***           
*                                                                               
GETAT20  DS    0H                                                               
         MVC   AAMKTTAB,GTAAMKT    SET W/S IN DEGETD                            
         MVC   ABOOKTAB,GTADBOOK                                                
         MVC   AEQIVTAB,GTADSTA                                                 
         MVC   ACTRLTAB,GTADCON                                                 
*                                                                               
         J     XIT                                                              
         DROP  R2,R7                                                            
*                                                                               
         LTORG                                                                  
*                                                                               
GETATD   DSECT                                                                  
GTAATABS DS    XL(TABLISTL)        LIST OF TABLE ADDRESSES                      
         ORG   GTAATABS                                                         
GTADBOOK DS    X,3X                DBOOK TABLE                                  
GTADSTA  DS    X,3X                DSTATION TABLE                               
GTADCON  DS    X,3X                DCONTROL TABLE                               
GTAAMKT  DS    X,3X                ALPHAMKT TABLE                               
         DS    X                   EOT                                          
GETATDLQ EQU   *-GETATD                                                         
*                                                                               
         TITLE 'GET STATION CALL LETTERS FROM DBLOCK INTO DUB'                  
DEGET    RSECT                                                                  
**********************************************************************          
* PKCAB - PACK CABLE NUMBER PT TO BY R1 AND SAVE IN DBCABNUM         *          
**********************************************************************          
*KCAB    NTR1  BASE=BASE1,LABEL=NO                                              
*        XR    RF,RF                                                            
*        ICM   RF,3,0(R1)          CONVERT TABLE VALUE TO CHAR                  
*        CVD   RF,CABPACK                                                       
*        OI    CABPACK+15,X'0F'                                                 
*        UNPK  DBCABNUM(4),CABPACK+5(3) AND SEED IN DBLOCK                      
*KCABX   J     XIT                                                              
*                                                                               
**********************************************************************          
* GETCALL - EXTRACT STATION CALL LETTERS FROM DBLOCK INTO DUB        *          
* ON EXIT R1=L'STATION CALL LETTERS (EXCLUDING TYPE)                 *          
**********************************************************************          
         SPACE 1                                                                
GETCALL  NTR1  BASE=BASE1,LABEL=NO                                              
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         MVI   DUB,C' '                                                         
         MVC   DUB+1(4),DUB                                                     
         CLI   DBSELMED,C'N'                                                    
         JNE   GCALL20                                                          
         CLI   DBBTYPE,C'U'        FOR NETWORK USER FILES                       
         JE    GCALL20             DON'T EQUATE THE CAB STATION                 
         LA    R1,5                                                             
         MVC   DUB(5),DBSELSTA                                                  
         TM    SPNETFLG,SPCBLQ     TRANSLATE TO INTERNAL CBL NUMBER             
         BNO   GCALL15                                                          
         CLI   DBCABNUM,0          CABLE NOT DEFINED, JUST USE DBSELSTA         
         BE    GCALL15                                                          
         MVC   DUB(4),DBCABNUM                                                  
****     B     GCALL15                                                          
*                                                                               
GCALL15  CLI   DBFUNCT,DBGETTOT    FOR TOTALS USE DBACTSTA                      
         JE    *+12                                                             
         CLI   DBFUNCT,DBGETTTL                                                 
         JNE   *+10                                                             
         MVC   DUB(5),DBACTSTA                                                  
         J     GETCALLX                                                         
*                                                                               
GCALL20  MVC   DUB(4),DBSELSTA                                                  
         CLC   DBSELSTA,=C'KMPHL'  LOW POWER EQUIV                              
         JNE   *+10                                                             
         MVC   DUB(5),=C'KM58T'                                                 
         CLI   DBFUNCT,DBGETTOT                                                 
         JE    *+12                                                             
         CLI   DBFUNCT,DBGETTTL                                                 
         JNE   *+10                                                             
         MVC   DUB(4),DBACTSTA                                                  
         LA    R1,4                                                             
         CLI   DBSELSRC,C'C'       NCM HAS 5 CHAR CALL LETTERS                  
         JNE   *+12                                                             
         CLI   DBSELMED,C'T'                                                    
         BE    *+8                                                              
         CLI   DBSELSRC,C'V'       VIDEOLOGY HAS 5 CHAR CALL LETTERS            
         JE    *+8                                                              
         CLI   DBSELMED,C'R'                                                    
         JNE   GETCALLX                                                         
         LA    R1,5                                                             
         MVC   DUB(5),DBSELSTA     RADIO HAS 5 CHAR CALL LETTERS                
         CLI   DBFUNCT,DBGETTOT                                                 
         JNE   GETCALLX                                                         
         MVC   DUB(5),DBACTSTA                                                  
*                                                                               
GETCALLX XIT1  REGS=(R1)                                                        
*                                                                               
         LTORG                                                                  
         TITLE 'READ NETWORK RECORD'                                            
***********************************************************************         
* RDNET  - READ NETWORK RECD FROM NTIDIR AND NTIFIL                   *         
*    IN:   DUB(1)   - 0=BLD KEY FROM DB'S, B=USE KEY BUILD IN DBKEY   *         
*          DUB+1(2) - 0 OR BOOK                                       *         
*     ->>  DUB+3(1) - BOOKTYPE         << NOT USED!! >>               *         
*          DUB+4(1) - COMPARE LENGTH FOR KEY READ TO KEY BUILT        *         
*    OUT:  PRKEY RECD IN DBAREC                                       *         
*          DBKEY HAS PASSIVE PRKEY. KEYSAVE HAS DIRECTORY PRKEY       *         
***********************************************************************         
         SPACE 1                                                                
RDNET    NTR1  BASE=BASE1,LABEL=NO                                              
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         XC    NETMKT,NETMKT                                                    
         MVI   DBERROR,0                                                        
         XR    R3,R3                                                            
         IC    R3,DUB+4            SAVE COMPARE LENGTH                          
         BCTR  R3,0                -1 FOR EXCLC                                 
         LA    R2,DBKEY                                                         
         USING PRKEY,R2                                                         
         CLI   DUB,C'B'            USE KEY BUILT                                
         JE    RDNET02                                                          
         MVI   PRCODE,PRCODEQU                                                  
         MVC   PRMEDIA,DBSELMED                                                 
         TM    SPNETFLG,SPCBLQ                                                  
         BNO   *+8                                                              
         MVI   PRMEDIA,C'C'                                                     
         MVI   PRSRC,C'N'          <-- ALWAYS 'N'                               
         MVC   PRBOOK,DUB+1                                                     
*        MVC   PRBTYP,DUB+3        B=BRKOUT, S=SPECIAL                          
*        MVC   PRSTYP,DBSTYPE      NAD-SEQUENCING   NTI-ASCR/INTGR              
         BRAS  RE,GETCALL          WARNING: CLOBBERS DUB  W/STATION             
         MVC   PRSTAT(5),DUB                                                    
*                                                                               
RDNET02  MVI   IOFLAG,DIR+HIGH+NTI  READ NTIDIR                                 
         GOTO1 AIO,IOFLAG                                                       
         JL    GETX                ERRORS                                       
         JH    RDNET04             EOF/NOT FOUND                                
*                                                                               
         EX    R3,*+8                                                           
         JNE   RDNET04             IF IT DOESN'T MATCH, NOT FOUND               
         CLC   PRKEY(0),KEYSAVE                                                 
*                                                                               
         MVC   KEYSAVE,PRKEY       SV DIR KEY (RD-FILE DOSN'T SET KYSV)         
         CLI   DBFUNCT,DBGETMB                                                  
         BNE   RDNET03                                                          
         TM    SPNETFLG,SPCBLQ     DON'T DO UNECC READS, JUST SET MKT#          
         BNO   *+14                                                             
         MVC   NETMKT,=Y(CBLMKT)                                                
         B     RDNET06                                                          
         TM    SPNETFLG,SPNTIQ     ALSO BYPASS RD FOR NTI                       
         BNO   RDNET03                                                          
         CLI   PRSTAT+4,C'T'                                                    
         BNE   RDNET03                                                          
         MVC   NETMKT,=Y(NTIMKT)                                                
         B     RDNET06                                                          
*                                                                               
RDNET03  MVI   IOFLAG,FILE+HIGH+NTI                                             
         GOTO1 AIO,IOFLAG                                                       
         JNE   RDNET04             DIRKEY=KEYSAVE, FILKEY=DBKEY                 
         ICM   R1,15,DBAREC                                                     
         LA    R1,PRFRSTEL-PRKEY(R1)                                            
         CLI   0(R1),X'01'         SHOULD BE MKT ELEM                           
         JNE   RDNET06                                                          
         MVC   NETMKT,MARNO-MARELEM(R1)  RATING SERVICE MKT                     
         TM    SPNETFLG,SPCBLQ                                                  
         BNO   *+10                                                             
         MVC   NETMKT,=Y(CBLMKT)                                                
         J     RDNET06                                                          
*                                                                               
RDNET04  MVI   DBERROR,NOTFOUND                                                 
*                                                                               
RDNET06  CLI   DBERROR,0                                                        
         J     XIT                                                              
         DROP  R2                                                               
*                                                                               
         LTORG                                                                  
         TITLE 'DEGET - CONSTANTS AND TABLES'                                   
***********************************************************************         
* CONSTANTS                                                           *         
***********************************************************************         
         SPACE 1                                                                
EFFS     DC    X'FFFFFFFF'                                                      
*                              *** FILE ACCESS EQUATES                          
TPTACCS  EQU   X'80'               TIME PERIOD FILE                             
PAVACCS  EQU   X'40'               PROGRAM AVERAGES FILE                        
NTIACCS  EQU   X'20'               NETWORK FILE                                 
MPAACCS  EQU   X'10'               MARKET PROGRAM ANALYSIS FILE                 
DPTACCS  EQU   X'08'               DAYPART SUMMARY TAPE                         
RDPACCS  EQU   X'04'               RADIO DAYPART FILE                           
         SPACE 2                                                                
DEMTABCL CSECT                                                                  
*                                                                               
ATABLESL DC    X'D1',3X'00'        DBOOK TABLE                                  
         DC    X'D2',3X'00'        DSTATION TABLE                               
         DC    X'D7',3X'00'        DCONTROL TABLE                               
         DC    X'E3',3X'00'        ALPHAMKT TABLE                               
         DC    X'FF'                                                            
TABLISTL EQU   *-ATABLESL                                                       
*                                                                               
NEWBOOKL DC    XL(L'NEWBOOK)'00'   NEW BOOK EFF. DATE (FROM DEMADDR)            
*                                                                               
         EJECT                                                                  
DEGET    RSECT                                                                  
***********************************************************************         
* TABLE OF BRANCHES TO FUNCTION ROUTINES (INDEX BY DBFUNCT-1*4)       *         
***********************************************************************         
         SPACE 1                                                                
GOTAB    DS    0A                                                               
         DC    A(GETMB)        1   DBVLST   (VALIDATE STN)                      
         DC    A(VLSTBK)       2   DBVLSTBK (VALIDATE STN/BOOK)                 
         DC    A(GETSM)        3   DBGETSM  (GET STN/MRKTS FOR BOOK)            
         DC    A(GETMS)        4   DBGETMS  (GET MRKT/STNS FOR BOOK)            
         DC    A(GETMB)        5   DBGETMB  (GET MRKT/BOOKS FOR STN)            
         DC    A(GETMK)        6   DBGETMK  (GET MRKT RECORD)                   
         DC    A(GETMKB)       7   DBGETMKB (GET MRKTS FOR BOOK)                
         DC    V(GETMPA)       8   DBGETUNV (GET MPA UNIVERSE RECORD)           
         DC    A(0)            9   DBGETNTI (GET NTI PGM DEMOS)                 
         DC    A(0)           10   DBGETTOT (GET MRKT TOTALS DEMOS)             
         DC    A(0)           11   DBGETDEM (GET DEMOS FOR ANY FILE)            
         DC    A(0)           12   DBGETPUR (GET PAV PURE DEMOS)                
         DC    A(0)           13   DBGETTLB (GET LATEST BOOK)                   
         DC    A(0)           14   DBVLNBK  (VALIDATE NETWORK BOOK)             
         DC    A(TSTACS)      15   DBTSTACS (TEST FILE ACCESS)                  
         DC    A(GETCTL)      16   DBGETCTL (GET AGY. CONTROL VALUES)           
         DC    A(0)           17   DBGETTTL (GET MRKT TOTALS DEMOS)             
         DC    A(GETMKN)      18   DBGETMKN (GET MRKT NAMES SRC/MED)            
         DC    A(0)           19   DBGETIPR (GET PROGRAMS FOR A BOOK)           
         DC    A(0)           20   DBGETISI (GET STATION FOR PROG#)             
         DC    A(0)           21   DBGETISR (GET DEMOS FOR PROG#)               
         DC    A(ALPHMKT)     22   DBCNVA2N ( ALPHA MKT TO NUMERIC)             
         DC    A(ALPHMKT)     23   DBCNVN2A ( NUMERIC MKT TO ALPHA)             
         DC    A(GETAMB)      24   DBGETAMB (GET ALL MKTS ALL BOOKS)            
         DC    A(GETASB)      25   DBGETASB (GET ALL STTN/BKS FOR MKT)          
         DC    A(GETAB)       26   DBGETAB  (GET ALL BOOKS)                     
         DC    A(GETASM)      27   DBGETASM (GET ALL SPLL MKTS)                 
         DC    A(ACSALL)      28   DBACSALL (GET DCON ACCESS RECDS)             
         DC    A(0)           29   DBGETOPI (GET OPI PROGRAM RECDS)             
         DC    A(GETSYS)      30   GET FUSION SYSCODE FOR MARKET                
         DC    A(GTNTLB)      31   DBGTNTLB (GET LATEST BOOK FOR NET)           
         DC    A(NETLIVE)     32   DBCKNLIV (CK IF FLE HAS LIVE AVAIL)          
         DC    A(0)           33   GET RESPONDENT LEVEL DATA                    
         EJECT                                                                  
***********************************************************************         
* TABLE OF VALID FILE/MEDIA/SOURCE COMBINATIONS                       *         
***********************************************************************         
         SPACE 1                                                                
FMSTAB   DS    0XL5                                                             
         DC    C'TTA',AL1(0,0)               TIME PERIOD FILES                  
         DC    C'TTM',AL1(0,0)               MEDIAFAX TPT FILE                  
         DC    C'TTN',AL1(0,0)                                                  
         DC    C'TTS',AL1(0,0)                                                  
         DC    C'TCA',AL1(0,0)                                                  
         DC    C'TCN',AL1(0,0)                                                  
         DC    C'TRA',AL1(0,0)                                                  
         DC    C'TRT',AL1(0,0)              TRITON                              
         DC    C'TRN',AL1(0,0)                                                  
         DC    C'TRM',AL1(0,0)                                                  
         DC    C'TRR',AL1(0,0)               RADAR FILE                         
         DC    C'TRS',AL1(0,0)               SQAD RADIO                         
         DC    C'TDN',AL1(0,0)               DAYPART FILES                      
         DC    C'TPA',AL1(0,0)               MPA FILES                          
         DC    C'TPN',AL1(0,0)                                                  
         DC    C'TWN',AL1(0,0)               WEEKLY FILE                        
         DC    C'PTA',AL1(FMS1SASU,0)        PROGRAM AVERAGE                    
         DC    C'PTM',AL1(FMS1SASU,0)        MEDIAFAX PAV                       
         DC    C'PTN',AL1(0,0)                                                  
         DC    C'PNN',AL1(0,0)               NTI                                
         DC    C'PCN',AL1(0,0)               CABLE AFTER SEP/93                 
         DC    C'PWN',AL1(0,0)               HISPANIC WEEKLY                    
         DC    C'IUN',AL1(0,0)               REP INVENTORY                      
         DC    C'IUM',AL1(0,0)               MFX INVENTORY                      
*                               SPOT -> NET LK UPS                              
         DC    C'TNH',AL1(0,0)               NHTI       - TP                    
         DC    C'PNH',AL1(0,0)                          - PAV                   
         DC    C'TND',AL1(0,0)               NAD        - TP                    
         DC    C'PND',AL1(0,0)                          - PAV                   
         DC    C'TNK',AL1(0,0)               NTI PKT PC - TP                    
         DC    C'PNK',AL1(0,0)                          - PAV                   
         DC    C'TNC',AL1(0,0)               NTI CABLE  - TP                    
         DC    C'PNC',AL1(0,0)                          - PAV                   
         DC    C'TON',AL1(0,0)                OVERNIGHTS TP                     
         DC    C'CUN',AL1(0,0)                COUNTY COVERAGE                   
         DC    C'TTF',AL1(0,0)                FUSION                            
         DC    C'PON',AL1(0,0)                OVERNIGHTS PAV                    
         DC    C'RUA',AL1(0,0)                RADIO COUNTY COVERAGE             
         DC    C'PRN',AL1(0,0)                RENTRAK                           
         DC    C'TTV',AL1(0,0)                VIDEOLOGY                         
         DC    C'TRH',AL1(0,0)                IHEART                            
         DC    C'TTC',AL1(0,0)                NCM                               
         DC    AL1(EOT)                                                         
         EJECT                                                                  
***********************************************************************         
* TABLE OF BRANCHES TO DEMO ROUTINES (INDEX BY DBLSTSBF-1*4)                    
***********************************************************************         
*                        DBLSTSBF INDEX EQUATES TO DGETAB                       
DGETTP   EQU   1                                                                
DGETPAV  EQU   2                                                                
DGETNET  EQU   3                                                                
DGETNTI  EQU   4                                                                
DGETCAB  EQU   5                                                                
DGETINV  EQU   6                                                                
DGETDPT  EQU   7                                                                
DGETMPA  EQU   8                                                                
DGETPA2  EQU   9                                                                
DGETMXM  EQU   10                                                               
DGETRUA  EQU   11                                                               
                                                                                
DGETAB   DS    0XL5                                                             
         DC    AL1(DGETTP),AL1(GETTPQ),AL3(0)                                   
         DC    AL1(DGETPAV),VL4(GETPAV)                                         
         DC    AL1(DGETNET),VL4(GETNET)                                         
         DC    AL1(DGETNTI),VL4(GETNTI)                                         
         DC    AL1(DGETCAB),VL4(GETCAB)                                         
         DC    AL1(DGETINV),VL4(GETINV)                                         
         DC    AL1(DGETDPT),VL4(GETDPT)                                         
         DC    AL1(DGETMPA),VL4(GETMPA)                                         
         DC    AL1(DGETPA2),VL4(GETPA2)                                         
         DC    AL1(DGETMXM),VL4(GETMXM)                                         
         DC    AL1(DGETRUA),VL4(GETRUA)                                         
         DC    AL1(EOT)                                                         
         SPACE 1                                                                
***********************************************************************         
*RTNTAB - NEW FILE MEDIA SRC TABLE DIRECTING TO CALLING ROUTINE                 
*    NOTE: SOURCE FIELD USED WHEN SPNETFLG<>0 ELSE SRC=AL1(0) DEFAULTS          
*    FIELDS:   FILE/MEDIA/SRC/FUNCT/RTN(DBLSTSBF)                               
***********************************************************************         
RTND     DSECT                                                                  
RTNFILE  DS    CL1                 FILE                                         
RTNMED   DS    CL1                 MEDIA                                        
RTNSRC   DS    CL1                 SOURCE (USED WHEN SPNETFLG NON ZERO)         
RTNFUNCT DS    CL1                 FUNCTION CALL                                
RTNLSTSB DS    CL1                 DBLSTSBF EQUATES LK UP ROUTINE               
RTNDLN   EQU   *-RTND                                                           
                                                                                
DEGET    RSECT                                                                  
                                                                                
RTNTAB   DS    0XL(RTNDLN)                                                      
*                                              SPT-NET LK UP: CMP SRC           
         DC    C'PNH',AL1(0),AL1(DGETNTI)      NHT                              
         DC    C'TNH',AL1(0),AL1(DGETNET)                                       
         DC    C'PND',AL1(0),AL1(DGETNTI)      NAD                              
         DC    C'TND',AL1(0),AL1(DGETNET)                                       
         DC    C'PNK',AL1(0),AL1(DGETNTI)      NTI                              
         DC    C'TNK',AL1(0),AL1(DGETNET)                                       
         DC    C'PNC',AL1(0),AL1(DGETCAB)      NTI CABLE                        
         DC    C'TNC',AL1(0),AL1(DGETNET)                                       
*                                              DEFAULTS - W/OUT SRC             
         DC    C'TT',AL1(0),AL1(0),AL1(DGETTP)                                  
         DC    C'TC',AL1(0),AL1(0),AL1(DGETTP)                                  
         DC    C'TR',AL1(0),AL1(0),AL1(DGETTP)                                  
         DC    C'TW',AL1(0),AL1(0),AL1(DGETTP)                                  
         DC    C'TP',AL1(0),AL1(0),AL1(DGETMPA)                                 
         DC    C'PT',AL1(0),AL1(0),AL1(DGETPAV)                                 
         DC    C'PN',AL1(0),AL1(DBGETNTI),AL1(DGETNTI)                          
         DC    C'PN',AL1(0),AL1(DBGETOPI),AL1(DGETNTI)                          
         DC    C'PN',AL1(0),AL1(DBGETRLD),AL1(DGETMXM)                          
         DC    C'PN',AL1(0),AL1(0),AL1(DGETNET)                                 
         DC    C'PC',AL1(0),AL1(DBGETDEM),AL1(DGETNET)                          
         DC    C'PC',AL1(0),AL1(DBGETRLD),AL1(DGETMXM)                          
         DC    C'PC',AL1(0),AL1(0),AL1(DGETCAB)                                 
         DC    C'PW',AL1(0),AL1(0),AL1(DGETNET) HISPANIC WEEKLY                 
         DC    C'TD',AL1(0),AL1(0),AL1(DGETDPT) SET TO TP ROUTINES              
         DC    C'IU',AL1(0),AL1(0),AL1(DGETINV)                                 
         DC    C'TO',AL1(0),AL1(0),AL1(DGETTP)  OVERNIGHTS  TP                  
         DC    C'CU',AL1(0),AL1(0),AL1(DGETTP)  COUNTY COVERAGE                 
         DC    C'PO',AL1(0),AL1(0),AL1(DGETPA2) OVERNIGHTS  PAV                 
         DC    C'RU',AL1(0),AL1(0),AL1(DGETRUA)  RADIO COUNTY COVERAGE          
         DC    C'PR',AL1(0),AL1(DBGETDEM),AL1(DGETNET)   RENTRAK                
         DC    C'PR',AL1(0),AL1(0),AL1(DGETNET)                                 
         DC    AL1(EOT)                                                         
         SPACE 1                                                                
***********************************************************************         
* TABLE OF VALID FILES (SEE FILEVALS)                                 *         
***********************************************************************         
         SPACE 1                                                                
FILETAB  DS    0XL10                                                            
         DC    C'TP ',AL1(0,TPTACCS,0)                                          
         DC    C'TTN',AL1(DEM)                                                  
         DC    C'TP ',AL1(0,NTIACCS,0)        <--NHT TP LK UP ON SPOT           
         DC    C'TNH',AL1(NTI)                                                  
         DC    C'TP ',AL1(0,NTIACCS,0)        <--NAD TP LK UP ON SPOT           
         DC    C'TND',AL1(NTI)                                                  
         DC    C'TP ',AL1(0,NTIACCS,0)        <--NTI TP LK UP ON SPOT           
         DC    C'TNK',AL1(NTI)                                                  
         DC    C'TP ',AL1(0,NTIACCS,0)        <--NTI CABLE TP ON SPOT           
         DC    C'TNC',AL1(NTI)                                                  
         DC    C'RLD',AL1(0,NTIACCS,0)        <--AMRLD                          
         DC    C'PNN',AL1(NTI)                                                  
         DC    C'RLD',AL1(0,NTIACCS,0)        <--AMRLD CABLE                    
         DC    C'PCN',AL1(NTI)                                                  
*                                                                               
         DC    C'DPT',AL1(0,DPTACCS,0)                                          
         DC    C'TDN',AL1(DEM)                                                  
         DC    C'RDP',AL1(0,RDPACCS,0)                                          
         DC    C'TRN',AL1(DEM)                                                  
         DC    C'PAV',AL1(0,PAVACCS,0)                                          
         DC    C'PTN',AL1(PAV)                                                  
*                                                                               
         DC    C'PAV',AL1(0,NTIACCS,0)        <--NHT PAV LK UP ON SPOT          
         DC    C'PNH',AL1(NTI)                                                  
         DC    C'PAV',AL1(0,NTIACCS,0)        <--NAD PAV LK UP ON SPOT          
         DC    C'PND',AL1(NTI)                                                  
         DC    C'PAV',AL1(0,NTIACCS,0)        <--NTI PAV LK UP ON SPOT          
         DC    C'PNK',AL1(NTI)                                                  
         DC    C'PAV',AL1(0,NTIACCS,0)        <--NTI CABLE PAV ON SPOT          
         DC    C'PNC',AL1(NTI)                                                  
*                                                                               
         DC    C'MPA',AL1(MOVER,MPAACCS,0)                                      
         DC    C'TPN',AL1(DEM)                                                  
         DC    C'NAD',AL1(0,NTIACCS,0)                                          
         DC    C'PNN',AL1(NTI)            <-- WAS PAV                           
         DC    C'NTI',AL1(0,NTIACCS,0)                                          
         DC    C'PNN',AL1(NTI)            <-- WAS PAV                           
         DC    C'NTI',AL1(0,NTIACCS,0)                                          
         DC    C'PCN',AL1(NTI)            <-- WAS PAV                           
         DC    C'NTI',AL1(0,NTIACCS,0)                                          
         DC    C'PWN',AL1(NTI)            <-- WAS PAV                           
         DC    C'TPT',AL1(0,TPTACCS,0)                                          
         DC    C'TCN',AL1(DEM)                                                  
         DC    C'IUN',AL1(0,PAVACCS,0)                                          
         DC    C'IUN',AL1(REP)                                                  
*                                                                               
         DC    C'RTP',AL1(0,RDPACCS,0)    RADAR                                 
         DC    C'TRR',AL1(DEM)                                                  
*                                                                               
         DC    C'OPI',AL1(0,NTIACCS,0)    OPTIMUM PROGRAM FILE                  
         DC    C'PNN',AL1(NTI)                                                  
*                                                                               
         DC    C'TP ',AL1(0,TPTACCS,0)    OVERNIGHT TP                          
         DC    C'TON',AL1(DEM)                                                  
*                                                                               
         DC    C'CTP',AL1(0,TPTACCS,0)    COUNTY COVERAGE                       
         DC    C'CUN',AL1(DEM)                                                  
*                                                                               
         DC    C'PAV',AL1(0,PAVACCS,0)    OVERNIGHTS PAV                        
         DC    C'PON',AL1(PAV)                                                  
*                                                                               
         DC    C'RUA',AL1(0,RDPACCS,0)    RADIO COUNTY COVERAGE                 
         DC    C'RUA',AL1(DEM)                                                  
*                                                                               
         DC    C'NTI',AL1(0,NTIACCS,0)    RENTRAK                               
         DC    C'PRN',AL1(NTI)                                                  
*                                                                               
         DC    C'TP ',AL1(0,TPTACCS,0)    NCM                                   
         DC    C'TTC',AL1(DEM)                                                  
         DC    AL1(EOT)                                                         
         EJECT                                                                  
***********************************************************************         
* TABLE OF NETWORK MARKET TO DBAUTH BITS FOR NETWORK                  *         
***********************************************************************         
         SPACE 1                                                                
TWABITS  DS    0XL3                                                             
         DC    AL2(001),X'80'                                                   
         DC    AL2(002),X'80'                                                   
         DC    AL2(010),X'20'                                                   
         DC    AL2(011),X'20'                                                   
         DC    AL2(012),X'20'                                                   
         DC    AL2(013),X'20'                                                   
         DC    AL2(014),X'20'                                                   
         DC    AL2(015),X'20'                                                   
         DC    AL2(016),X'20'                                                   
         DC    AL2(017),X'20'                                                   
         DC    AL2(018),X'20'                                                   
         DC    AL2(200),X'40'                                                   
         DC    AL2(210),X'80'                                                   
         DC    AL2(211),X'80'                                                   
         DC    AL2(300),X'20'                                                   
         DC    AL2(400),X'40'                                                   
         DC    AL2(500),X'10'                                                   
         DC    AL2(501),X'10'                                                   
         DC    AL2(601),X'80'      M+ COST FILE                                 
         DC    X'FF'                                                            
         SPACE 1                                                                
***********************************************************************         
* TABLE OF VALID FUNCTIONS (SEE FUNCVALS)                             *         
***********************************************************************         
         SPACE 1                                                                
FUNCTAB  DS    0XL7                                                             
         DC    AL1(DBVLST,FOVER,0,0)                                            
         DC    C'TTN'                                                           
         DC    AL1(DBVLSTBK,FOVER,0,0)                                          
         DC    C'TTN'                                                           
         DC    AL1(DBGETSM,FOVER,0,0)                                           
         DC    C'TTN'                                                           
         DC    AL1(DBGETMS,FOVER,0,0)                                           
         DC    C'TTN'                                                           
         DC    AL1(DBGETMB,FOVER,0,0)                                           
         DC    C'TTN'                                                           
         DC    AL1(DBGETMK,FOVER,0,0)                                           
         DC    C'TTN'                                                           
         DC    AL1(DBGETMKB,FOVER,0,0)                                          
         DC    C'TTN'                                                           
         DC    AL1(DBGETUNV,FOVER+MOVER+SOVER,0,0)                              
         DC    C'TPN'                                                           
         DC    AL1(DBGETNTI,FOVER+MOVER+SOVER,0,0)                              
         DC    C'PNN'                                                           
         DC    AL1(DBGETTOT,FOVER,0,0)                                          
         DC    C'TTN'                                                           
         DC    AL1(DBGETDEM,0,0,0)                                              
         DC    C'TTN'                                                           
         DC    AL1(DBGETPUR,FOVER+MOVER,0,0)                                    
         DC    C'PTN'                                                           
         DC    AL1(DBGETTLB,FOVER,0,0)                                          
         DC    C'TTN'                                                           
         DC    AL1(DBVLNBK,FOVER+MOVER+SOVER,0,0)                               
         DC    C'PNN'                                                           
         DC    AL1(DBTSTACS,0,0,0)                                              
         DC    C'TTN'                                                           
         DC    AL1(DBGETCTL,0,0,0)                                              
         DC    C'TTN'                                                           
         DC    AL1(DBGETTTL,FOVER,0,0)                                          
         DC    C'TTN'                                                           
         DC    AL1(DBGETMKN,FOVER,0,0)                                          
         DC    C'TTN'                                                           
         DC    AL1(DBGETIPR,FOVER,0,0)                                          
         DC    C'TTN'                                                           
         DC    AL1(DBGETISI,FOVER,0,0)                                          
         DC    C'TTN'                                                           
         DC    AL1(DBGETISR,FOVER,0,0)                                          
         DC    C'TTN'                                                           
         DC    AL1(DBCNVN2A,0,0,0)                                              
         DC    C'TTN'                                                           
         DC    AL1(DBCNVA2N,0,0,0)                                              
         DC    C'TTN'                                                           
         DC    AL1(DBGETAMB,FOVER,0,0)                                          
         DC    C'TTN'                                                           
         DC    AL1(DBGETASB,FOVER,0,0)                                          
         DC    C'TTN'                                                           
         DC    AL1(DBGETAB,FOVER,0,0)                                           
         DC    C'TTN'                                                           
         DC    AL1(DBGETASM,FOVER,0,0)                                          
         DC    C'TTN'                                                           
         DC    AL1(DBACSALL,0,0,0)                                              
         DC    C'TTN'                                                           
         DC    AL1(DBGETOPI,FOVER+MOVER+SOVER,0,0)                              
         DC    C'PNN'                                                           
*                                                                               
         DC    AL1(DBGETSYS,FOVER,0,0)                                          
         DC    C'TTN'                                                           
*                                                                               
         DC    AL1(DBGTNTLB,FOVER,0,0)                                          
         DC    C'PNN'                                                           
*                                                                               
         DC    AL1(DBCKNLIV,0,0,0)                                              
         DC    C'PNN'                                                           
*                                                                               
         DC    AL1(DBGETRLD,0,0,0)                                              
         DC    C'RLD'                                                           
*                                                                               
         DC    AL1(EOT)                                                         
         EJECT                                                                  
***********************************************************************         
* TABLE OF CALL STATIONS CALL LETTERS                                 *         
***********************************************************************         
*OLD CABLE STUFF:   4 BYTE STATION ENTRIES, 2 BYTE MARKET NUMBER                
OLDCABS  DC    C'WTBS',AL2(11)                                                  
         DC    C'CNN ',AL2(10)                                                  
         DC    C'CBN ',AL2(13)                                                  
         DC    C'ESPN',AL2(14)                                                  
         DC    C'MTV ',AL2(15)                                                  
         DC    C'USA ',AL2(12)                                                  
         DC    C'NICK',AL2(16)                                                  
         DC    C'AEN ',AL2(17)                                                  
         DC    C'LFTM',AL2(18)                                                  
         DC    X'FF',AL3(0),AL2(0)                                              
         SPACE 2                                                                
***********************************************************************         
* TABLE OF REUSED CALL LETTERS                                        *         
* (CALL LETTERS/BOOK OF REUSE/CALL LETTERS PRIOR TO REUSE)            *         
***********************************************************************         
         SPACE 1                                                                
DBLSTAB  DS    0CL10                                                            
*        DC    C'KCTV',X'5307',C'KCMO'                                          
*        DC    C'KJTV',X'5510',C'KJAA'                                          
*        DC    C'WUSA',X'5607',C'WDVM'                                          
         DC    C'WBKI',AL2(NOV_00),C'WWWB'                                      
         DC    C'WWWB',AL2(NOV_99),C'XXXX'                                      
         DC    C'WMOR',AL2(NOV_99),C'WWWB'                                      
         DC    C'WOTV',AL2(JUL_92),C'WUHQ'                                      
         DC    C'WKMG',AL2(FEB_98),C'WCPX'                                      
         DC    C'WCPX',AL2(OCT_98),C'XXXX'                                      
         DC    X'FF'                                                            
         SPACE 2                                                                
*                                                                               
*        THESE STATIONS CAN BE ACCESSED WITH SPECIAL CALL LETTERS               
*        BUT ARE ON THE DEMO FILE AS SPILL.                                     
*                                                                               
*OSTC    DS    0CL5          REPLACED BY GLBCNVT 12/30/94                       
*        DC    C'CIII',C'G'                                                     
*        DC    C'CIHF',C'I'                                                     
*        DC    C'ASN ',C'A'                                                     
*        DC    C'TSN ',C'S'                                                     
*        DC    X'FF'                                                            
         EJECT                                                                  
NSIMMTAB DC    AL2(124),AL2(OCT_88) ATLANTA                                     
         DC    AL2(112),AL2(NOV_92) BALTIMORE                                   
         DC    AL2(106),AL2(OCT_88) BOSTON                                      
         DC    AL2(117),AL2(OCT_91) CHARLOTTE                                   
         DC    AL2(202),AL2(OCT_88) CHICAGO                                     
         DC    AL2(115),AL2(NOV_89) CINCINNATI                                  
         DC    AL2(110),AL2(MAY_94) CLEVELAND                                   
         DC    AL2(223),AL2(OCT_88) DALLAS/FT. WORTH                            
         DC    AL2(351),AL2(OCT_88) DENVER                                      
         DC    AL2(105),AL2(JUL_94) DETROIT  (OUT91/10) IN 94/11                
         DC    AL2(133),AL2(JAN_90) HARTFORD/NEW HAVEN                          
         DC    AL2(218),AL2(OCT_88) HOUSTON                                     
         DC    AL2(127),AL2(OCT_89) INDIANAPOLIS                                
         DC    AL2(216),AL2(NOV_92) KANSAS CITY                                 
         DC    AL2(403),AL2(OCT_88) LOS ANGELES                                 
         DC    AL2(128),AL2(OCT_88) MIAMII/FT. LAUDERDALE                       
         DC    AL2(217),AL2(AUG_89) MILWAUKEE                                   
         DC    AL2(213),AL2(AUG_89) MINNEAPOLIS/ST. PAUL                        
         DC    AL2(101),AL2(OCT_88) NEW YORK                                    
         DC    AL2(134),AL2(FEB_93) ORLANDO-DAYTONA                             
         DC    AL2(104),AL2(OCT_88) PHILADELPHIA                                
         DC    AL2(353),AL2(SEP_89) PHOENIX                                     
         DC    AL2(420),AL2(MAY_90) PROTLAND, OR                                
         DC    AL2(462),AL2(AUG_89) SACRAMENTO-STOCKTON                         
         DC    AL2(241),AL2(NOV_90) SAN ANTONIO                                 
         DC    AL2(425),AL2(NOV_92) SAN DIEGO                                   
         DC    AL2(407),AL2(OCT_88) SAN FRANCISCO                               
         DC    AL2(419),AL2(AUG_89) SEATTLE-TACOMA                              
         DC    AL2(209),AL2(AUG_89) ST LOUIS                                    
         DC    AL2(139),AL2(NOV_89) TAMPA-ST. PETERSBURG                        
         DC    AL2(111),AL2(OCT_88) WASHINGTON, DC                              
         DC    AL2(148),AL2(FEB_94) WEST PALM BEACH-FT. PIERCE                  
         DC    X'FFFF'                                                          
         EJECT                                                                  
*                                                                               
NETSRC   DS    0XL20             DBSELSRC,STAT+4 CHAR, MKT#,LK-UP STN           
         DC    C'H',C'H',AL2(500),C'TEL H',CL11'NHTI'                           
         DC    C'H',C'H',AL2(501),C'ABC H',CL11'NHTI AFFL'                      
         DC    C'H',C'H',AL2(502),C'AFA H',CL11'NHTI GMA'                       
         DC    C'H',C'H',AL2(502),C'AFA H',CL11'NHTI GMA'                       
*                                                                               
         DC    C'C',C'C',AL2(300),C'5830C',CL11'NTI CABLE'                      
*                                                                               
*--DISABLE FOR NOW TILL NAD & NTI ACTIVATED                                     
*        DC    C'D',C'N',AL2(200),C'ABC N',CL11'NAD '                           
*        DC    C'D',C'S',AL2(400),C'ABC S',CL11'NAD-NSS'                        
*                                                                               
*        DC    C'K',C'T',AL2(001),C'ABC T',CL11'NTI '                           
*        DC    C'K',C'S',AL2(001),C'ABC S',CL11'NTI-NSS'                        
         DC    X'FFFF'                                                          
         EJECT                                                                  
NTIMKT   EQU   1                   NTI CABLE MKT=1                              
CBLMKT   EQU   300                 NTI CABLE MKT=300                            
CNADMKT  EQU   321                 NTI CABLE NAD MKT=321                        
RLDMKT   EQU   103                 AMRLD MKT=103                                
MOVIEMKT EQU   207                 MOVIE GOER (CABLE,NTI,NSS)                   
HGALMKT  EQU   510                 NHT GALA  MKT=510                            
HCBLMKT  EQU   511                 NHT CABLE MKT=511                            
HPMGALMK EQU   516                 NTIH GALA  MKT=516                           
HPMCBLMK EQU   517                 NTIH CABLE MKT=517                           
ACMCBMKT EQU   102                 ACM(COMMERCIAL AVG) MKT=102                  
HTVAMKT  EQU   500                 HISPANIC TV AUDIENCE                         
HGMTMKT  EQU   501                 HISPANIC GENERAL MARKET                      
HGMAMKT  EQU   502                 HISPANIC GENERAL MARKET AGGREGATES           
*NEW SETTINGS FOR THE HISPANIC DATA FROM NATIONAL SAMPLE                        
HPTVAMKT EQU   512                 HISPANIC TV AUDIENCE                         
HPGMTMKT EQU   513                 HISPANIC GENERAL MARKET                      
HPGMAMKT EQU   514                 HISPANIC GENERAL MARKET AGGREGATES           
OOHNMKT  EQU   518                 OOH NETWORKS                                 
OOHCMKT  EQU   519                 OOH CABLE                                    
*                                                                               
       ++INCLUDE DENTIBKEQU                                                     
         EJECT                                                                  
*TABLE  OF CABLE NAD STATIONS THAT DON'T HAVE PROGRAM DATA                      
*ONLY TIME-PERIOD DATA                                                          
CNADTPTB DS    0X                CABLE NAD AND MOVIE GOER                       
   DC    CL4'BBCA',AL1(YR_2003,WEEK_27) GETS PROGRAM DATA AFTER JUL/03          
   DC    CL4'DHLT',AL1(YR_2002,WEEK_40) GETS PROGRAM DATA AFTER OCT/02          
   DC    CL4'DIY ',AL1(YR_2009,WEEK_01) GETS PROGRAM DATA AFTER JAN/09          
   DC    CL4'DTMS',AL1(YR_2006,WEEK_27) GETS PROGRAM DATA AFTER JUL/06          
   DC    CL4'ID  ',AL1(YR_2006,WEEK_27) ID, NEW NAME FOR DTMS                   
   DC    CL4'DSCI',AL1(YR_2005,WEEK_27) GETS PROGRAM DATA AFTER JUL/05          
   DC    CL4'DKID',AL2(0)                                                       
   DC    CL4'ENC ',AL2(0)                                                       
   DC    CL4'ENN ',AL1(YR_2005,WEEK_01) GETS PROGRAM DATA AFTER JAN/05          
   DC    CL4'ESPC',AL1(YR_2005,WEEK_01) GETS PROGRAM DATA AFTER JAN/05          
   DC    CL4'FINE',AL2(0)                                                       
   DC    CL4'GAC ',AL1(YR_2007,WEEK_01) GETS PROGRAM DATA AFTER JAN/07          
   DC    CL4'GMC ',AL2(0)                                                       
   DC    CL4'GOLF',AL1(YR_2006,WEEK_01) GETS PROGRAM DATA AFTER JAN/06          
   DC    CL4'MIL ',AL1(YR_2005,WEEK_40) GETS PROGRAM DATA AFTER OCT/05          
   DC    CL4'OXYG',AL1(YR_2003,WEEK_14) GETS PROGRAM DATA AFTER APR/03          
   DC    CL4'RLZC',AL2(0)                                                       
   DC    CL4'STZ ',AL2(0)                                                       
   DC    CL4'STYL',AL1(YR_2004,WEEK_40) GETS PROGRAM DATA AFTER OCT/04          
   DC    CL4'SV  ',AL1(YR_2002,WEEK_05) GETS PROGRAM DATA AFTER FEB/02          
   DC    CL4'TECH',AL1(YR_2005,WEEK_40) GETS PROGRAM DATA AFTER OCT/05          
   DC    CL4'G4  ',AL1(YR_2005,WEEK_40) G4, NEW NAME FOR TECH                   
   DC    CL4'THN ',AL2(0)                                                       
   DC    CL4'TOC ',AL2(0)                                                       
   DC    CL4'TV1 ',AL1(YR_2006,WEEK_40) GETS PROGRAM DATA AFTER OCT/06          
   DC    CL4'RFD ',AL1(YR_2009,WEEK_01) GETS PROGRAM DATA AFTER JAN/09          
   DC    CL4'FBN ',AL2(0)                                                       
   DC    CL4'VS  ',AL1(YR_2003,WEEK_01) GETS PROGRAM DATA AFTER JAN/03          
   DC    X'FF'                                                                  
         EJECT                                                                  
***********************************************************************         
*LIST OF VALID FILES & SUBFILES & MEDIA EQUATING TO INTERNAL          *         
*FILE/MEDIA FOR DCON LOOK UPS. DEFAULT LOOK UP FOLLOWS PRIMARY LOOK UP*         
***********************************************************************         
         SPACE 1                                                                
*DCONTAB  DS    0CL9      DBILE(3),DBINTFIL(2),SRC,MED->DCON SRC/MED            
*        DC    C'NTI',C'PC',C'NB',C'NN'     NTI-CABLE WEEKLY                    
*        DC    C'NAD',C'PN',C'NA',C'NN'     NAD MONTHLY                         
*        DC    C'NTI',C'PW',C'HW',C'NN'     NHTI WEEKLY                         
         SPACE 1                                                                
***********************************************************************         
* NEW DCONTAB STRUCTURE:                                              *         
* DBFILE(3),DBINTFIL(2),DBACTSRC,DBACTMED,CTFILE(SRC-MED),CTFILE(DFLT)*         
* IF FIELD IN TABLE=X'0000', BYPASS COMPARISON IN GETCTRL RTN         *         
***********************************************************************         
         SPACE 1                                                                
DCONTAB  DS    0CL11      < USES DCONTABD DSECT >                               
         DC    C'NTI',C'PC',X'0000',C'NB',C'NN'     NTI-CABLE WEEKLY            
         DC    C'NAD',C'PN',X'0000',C'NA',C'NN'     NAD MONTHLY                 
         DC    C'NTI',C'PW',X'0000',C'HW',C'NN'     NHTI WEEKLY                 
         DC    C'RLD',C'PC',X'0000',C'NB',C'NN'     RLD                         
         DC    C'RLD',C'PN',X'0000',C'NN',C'NN'     RLD                         
*  SPOT-> NET FUDGE:                                                            
         DC    C'TP ',X'0000',C'HN',C'NN',C'NN'     NHTI - TP                   
         DC    C'PAV',X'0000',C'HN',C'NN',C'NN'          - PAV                  
         DC    C'TP ',X'0000',C'DN',C'NA',C'NN'     NAD  - TP                   
         DC    C'PAV',X'0000',C'DN',C'NA',C'NN'          - PAV                  
         DC    C'TP ',X'0000',C'KN',C'NN',C'NN'     NTI  - TP                   
         DC    C'PAV',X'0000',C'KN',C'NN',C'NN'          - PAV                  
*                                                                               
         DC    X'FFFFFF'                                                        
         EJECT                                                                  
***********************************************************************         
* DQTAB - DETERMINES DAY AND TIME CODE TO READ FILE WITH FROM THE     *         
*        REQUESTED DAYS/TIMES BASED ON WHAT DATA IS PROVIDED ON TAPES.*         
* TABLE OF VALID LOOK-UP DAYS & QUARTER HOURS (SEE DQHDRD & DQDTAD)   *         
***********************************************************************         
         SPACE 1                                                                
DQTAB    DS    0X                                                               
*                                  TP/US/NSI/STA                                
DQTTNS   DC    C'TTN',AL1(0),AL2(DQTTNSX-DQTTNS)                                
         DC    X'40107C',AL1(QH5P,QH2A)                                         
         DC    X'20207C',AL1(QH5P,QH2A)                                         
         DC    X'10307C',AL1(QH5P,QH2A)                                         
         DC    X'08407C',AL1(QH5P,QH2A)                                         
         DC    X'04507C',AL1(QH5P,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH5P)                                         
DQTTNSX  DC    X'00'                                                            
*                                  TP/US/NSI/MKT                                
DQTTNM   DC    C'TTN',AL1(1),AL2(DQTTNMX-DQTTNM)                                
         DC    X'40107C',AL1(QH330P,QH2A)                                       
         DC    X'20207C',AL1(QH330P,QH2A)                                       
         DC    X'10307C',AL1(QH330P,QH2A)                                       
         DC    X'08407C',AL1(QH330P,QH2A)                                       
         DC    X'04507C',AL1(QH330P,QH2A)                                       
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH330P)                                       
DQTTNMX  DC    X'00'                                                            
*                                                                               
*                                  TP/US/NSI/INCLUDE 2A-6A DAT                  
DQTTNF   DC    C'TTN',AL1(2),AL2(DQTTNFX-DQTTNF)                                
         DC    X'401040',AL1(QHTS5A,QHTE6A)       MON/5A-6A                     
         DC    X'40107C',AL1(QHTS330P,QHTE5A)     MON/330P-5A                   
         DC    X'202020',AL1(QHTS5A,QHTE6A)       TUE/5A-6A                     
         DC    X'20207C',AL1(QHTS330P,QHTE5A)     TUE/330P-5A                   
         DC    X'103010',AL1(QHTS5A,QHTE6A)       WED/5A-6A                     
         DC    X'10307C',AL1(QHTS330P,QHTE5A)     WED/330P-5A                   
         DC    X'084008',AL1(QHTS5A,QHTE6A)       THU/5A-6A                     
         DC    X'08407C',AL1(QHTS330P,QHTE5A)     THU/330P-5A                   
         DC    X'045004',AL1(QHTS5A,QHTE6A)       FRI/5A-6A                     
         DC    X'04507C',AL1(QHTS330P,QHTE5A)     FRI/330P-5A                   
         DC    X'026002',AL1(QHTS5A,QHTE6A)       SAT/5A-6A                     
         DC    X'026000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS5A,QHTE6A)       SUN/5A-6A                     
         DC    X'017000',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
         DC    X'7C9500',AL1(QHTS6A,QHTE330P)     M-F/6A-330P                   
DQTTNFX  DC    X'00'                                                            
*                                                                               
*                                                                               
*           TP/US/NSI/INCLUDE 2A-6A DAT + INDIV. DAY -ALL TIMES                 
DQTTNG   DC    C'TTN',AL1(3),AL2(DQTTNGX-DQTTNG)                                
         DC    X'401040',AL1(QHTS5A,QHTE6A)       MON/5A-6A                     
         DC    X'401040',AL1(QHTS6A,QHTE5A)     MON/330P-5A                     
         DC    X'202020',AL1(QHTS5A,QHTE6A)       TUE/5A-6A                     
         DC    X'202020',AL1(QHTS6A,QHTE5A)     TUE/330P-5A                     
         DC    X'103010',AL1(QHTS5A,QHTE6A)       WED/5A-6A                     
         DC    X'103010',AL1(QHTS6A,QHTE5A)     WED/330P-5A                     
         DC    X'084008',AL1(QHTS5A,QHTE6A)       THU/5A-6A                     
         DC    X'084008',AL1(QHTS6A,QHTE5A)     THU/330P-5A                     
         DC    X'045004',AL1(QHTS5A,QHTE6A)       FRI/5A-6A                     
         DC    X'045004',AL1(QHTS6A,QHTE5A)     FRI/330P-5A                     
         DC    X'026002',AL1(QHTS5A,QHTE6A)       SAT/5A-6A                     
         DC    X'026000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS5A,QHTE6A)       SUN/5A-6A                     
         DC    X'017000',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
         DC    X'7C9500',AL1(QHTS6A,QHTE330P)     M-F/6A-330P                   
DQTTNGX  DC    X'00'                                                            
*                                                                               
*                                  TP/US/NSI/INCLUDE 2A-6A DAT                  
DQTTNH   DC    C'TTN',AL1(4),AL2(DQTTNHX-DQTTNH)                                
         DC    X'401040',AL1(QHTS3A,QHTE5A)       MON/3A-5A                     
         DC    X'40107C',AL1(QHTS330P,QHTE5A)     MON/330P-5A                   
         DC    X'202020',AL1(QHTS3A,QHTE5A)       TUE/3A-5A                     
         DC    X'20207C',AL1(QHTS330P,QHTE5A)     TUE/330P-5A                   
         DC    X'103010',AL1(QHTS3A,QHTE5A)       WED/3A-5A                     
         DC    X'10307C',AL1(QHTS330P,QHTE5A)     WED/330P-5A                   
         DC    X'084008',AL1(QHTS3A,QHTE5A)       THU/3A-5A                     
         DC    X'08407C',AL1(QHTS330P,QHTE5A)     THU/330P-5A                   
         DC    X'045004',AL1(QHTS3A,QHTE5A)       FRI/3A-5A                     
         DC    X'04507C',AL1(QHTS330P,QHTE5A)     FRI/330P-5A                   
         DC    X'026002',AL1(QHTS3A,QHTE5A)       SAT/3A-5A                     
         DC    X'026000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS3A,QHTE5A)       SUN/3A-5A                     
         DC    X'017000',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
         DC    X'7C9500',AL1(QHTS5A,QHTE330P)     M-F/6A-330P                   
DQTTNHX  DC    X'00'                                                            
*****************************************                                       
* PAV OVERNIGHTS    PAV/US/NSI/STA                                              
*****************************************                                       
*                                                                               
DQPONS   DC    C'PON',AL1(0),AL2(DQPONSX-DQPONS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'800000',AL1(QH6A,QH545A)                                       
DQPONSX  DC    X'00'                                                            
*****************************************                                       
* TYPICAL TIME PERIOD OVERNIGHTS                                                
*****************************************                                       
DQTONS   DC    C'TON',AL1(0),AL2(DQTONSX-DQTONS)                                
         DC    X'40107C',AL1(QH6A,QH545A)                                       
         DC    X'20207C',AL1(QH6A,QH545A)                                       
         DC    X'10307C',AL1(QH6A,QH545A)                                       
         DC    X'08407C',AL1(QH6A,QH545A)                                       
         DC    X'04507C',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C9500',AL1(QH6A,QH545A)                                       
DQTONSX  DC    X'00'                                                            
                                                                                
*****************************************                                       
* FUSION                                                                        
*****************************************                                       
DQTTFS   DC    C'TTF',AL1(0),AL2(DQTTFSX-DQTTFS)                                
         DC    X'40107C',AL1(QH6A,QH545A)                                       
         DC    X'20207C',AL1(QH6A,QH545A)                                       
         DC    X'10307C',AL1(QH6A,QH545A)                                       
         DC    X'08407C',AL1(QH6A,QH545A)                                       
         DC    X'04507C',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C9500',AL1(QH6A,QH545A)                                       
DQTTFSX  DC    X'00'                                                            
QHTS5A   EQU   1                                                                
QHTS6A   EQU   (QHTS5A+((((06-05)*4)+0)+0))                                     
QHTE6A   EQU   (QHTS5A+((((06-05)*4)+0)-1))                                     
QHTE330P EQU   (QHTS5A+((((15-05)*4)+2)-1))                                     
QHTS330P EQU   (QHTS5A+((((15-05)*4)+2)+0))                                     
QHTE5A   EQU   (QHTS5A+((((29-05)*4)+0)-1))                                     
QHTE245A EQU   (QHTS5A+((((26-05)*4)+3)-1))                                     
QHTS3A   EQU   (QHTS5A+((((27-05)*4)+0)+0))                                     
QHTS2A   EQU   (QHTS5A+((((26-05)*4)+0)+0))                                     
*                                  TP/US/SRC/STA                                
DQTTSS   DC    C'TTS',AL1(0),AL2(DQTTSSX-DQTTSS)                                
         DC    X'40107C',AL1(QH5P,QH2A)                                         
         DC    X'20207C',AL1(QH5P,QH2A)                                         
         DC    X'10307C',AL1(QH5P,QH2A)                                         
         DC    X'08407C',AL1(QH5P,QH2A)                                         
         DC    X'04507C',AL1(QH5P,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH5P)                                         
DQTTSSX  DC    X'00'                                                            
*                                  TP/US/SRC/MKT                                
DQTTSM   DC    C'TTS',AL1(1),AL2(DQTTSMX-DQTTSM)                                
         DC    X'409500',AL1(QH6A,QH2A)                                         
         DC    X'209500',AL1(QH6A,QH2A)                                         
         DC    X'109500',AL1(QH6A,QH2A)                                         
         DC    X'089500',AL1(QH6A,QH2A)                                         
         DC    X'049500',AL1(QH6A,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH2A)                                         
DQTTSMX  DC    X'00'                                                            
*                                 WTP/US/NSI/STA                                
DQTWNS   DC    C'TWN',AL1(0),AL2(DQTWNSX-DQTWNS)                                
         DC    X'40107C',AL1(QH5P,QHTE5A)                                       
         DC    X'20207C',AL1(QH5P,QHTE5A)                                       
         DC    X'10307C',AL1(QH5P,QHTE5A)                                       
         DC    X'08407C',AL1(QH5P,QHTE5A)                                       
         DC    X'04507C',AL1(QH5P,QHTE5A)                                       
         DC    X'026000',AL1(QH6A,QHTE5A)                                       
         DC    X'017000',AL1(QH6A,QHTE5A)                                       
         DC    X'7C9500',AL1(QH6A,QH5P)                                         
DQTWNSX  DC    X'00'                                                            
*                                 WTP/US/NSI/MKT                                
DQTWNM   DC    C'TWN',AL1(1),AL2(DQTWNMX-DQTWNM)                                
         DC    X'40107C',AL1(QH330P,QHTE5A)                                     
         DC    X'20207C',AL1(QH330P,QHTE5A)                                     
         DC    X'10307C',AL1(QH330P,QHTE5A)                                     
         DC    X'08407C',AL1(QH330P,QHTE5A)                                     
         DC    X'04507C',AL1(QH330P,QHTE5A)                                     
         DC    X'026000',AL1(QH6A,QHTE5A)                                       
         DC    X'017000',AL1(QH6A,QHTE5A)                                       
         DC    X'7C9500',AL1(QH6A,QH330P)                                       
DQTWNMX  DC    X'00'                                                            
                                                                                
*          WTP/US/NSI/INCLUDE 2A-6A DAT + INDIV. DAY -ALL TIMES                 
DQTWNG   DC    C'TWN',AL1(3),AL2(DQTWNGX-DQTWNG)                                
         DC    X'401040',AL1(QHTS5A,QHTE6A)       MON/5A-6A                     
         DC    X'401040',AL1(QHTS6A,QHTE5A)     MON/330P-5A                     
         DC    X'202020',AL1(QHTS5A,QHTE6A)       TUE/5A-6A                     
         DC    X'202020',AL1(QHTS6A,QHTE5A)     TUE/330P-5A                     
         DC    X'103010',AL1(QHTS5A,QHTE6A)       WED/5A-6A                     
         DC    X'103010',AL1(QHTS6A,QHTE5A)     WED/330P-5A                     
         DC    X'084008',AL1(QHTS5A,QHTE6A)       THU/5A-6A                     
         DC    X'084008',AL1(QHTS6A,QHTE5A)     THU/330P-5A                     
         DC    X'045004',AL1(QHTS5A,QHTE6A)       FRI/5A-6A                     
         DC    X'045004',AL1(QHTS6A,QHTE5A)     FRI/330P-5A                     
         DC    X'026002',AL1(QHTS5A,QHTE6A)       SAT/5A-6A                     
         DC    X'026000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS5A,QHTE6A)       SUN/5A-6A                     
         DC    X'017000',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
         DC    X'7C9500',AL1(QHTS6A,QHTE330P)     M-F/6A-330P                   
DQTWNGX  DC    X'00'                                                            
*                                  TP/US/ARB/STA                                
DQTTAS   DC    C'TTA',AL1(0),AL2(DQTTASX-DQTTAS)                                
         DC    X'40107C',AL1(QH5P,QH2A)                                         
         DC    X'20207C',AL1(QH5P,QH2A)                                         
         DC    X'10307C',AL1(QH5P,QH2A)                                         
         DC    X'08407C',AL1(QH5P,QH2A)                                         
         DC    X'04507C',AL1(QH5P,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH5P)                                         
DQTTASX  DC    X'00'                                                            
*                                  TP/US/ARB/MKT                                
DQTTAM   DC    C'TTA',AL1(1),AL2(DQTTAMX-DQTTAM)                                
         DC    X'40107C',AL1(QH4P,QH2A)                                         
         DC    X'20207C',AL1(QH4P,QH2A)                                         
         DC    X'10307C',AL1(QH4P,QH2A)                                         
         DC    X'08407C',AL1(QH4P,QH2A)                                         
         DC    X'04507C',AL1(QH4P,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH4P)                                         
DQTTAMX  DC    X'00'                                                            
*                                  TP/US/ARB/INCLUDE 2A-6A DAT                  
DQTTAF   DC    C'TTA',AL1(2),AL2(DQTTAFX-DQTTAF)                                
         DC    X'401040',AL1(QHTS5A,QHTE6A)       MON/5A-6A                     
         DC    X'40107C',AL1(QHTS330P,QHTE5A)     MON/330P-5A                   
         DC    X'202020',AL1(QHTS5A,QHTE6A)       TUE/5A-6A                     
         DC    X'20207C',AL1(QHTS330P,QHTE5A)     TUE/330P-5A                   
         DC    X'103010',AL1(QHTS5A,QHTE6A)       WED/5A-6A                     
         DC    X'10307C',AL1(QHTS330P,QHTE5A)     WED/330P-5A                   
         DC    X'084008',AL1(QHTS5A,QHTE6A)       THU/5A-6A                     
         DC    X'08407C',AL1(QHTS330P,QHTE5A)     THU/330P-5A                   
         DC    X'045004',AL1(QHTS5A,QHTE6A)       FRI/5A-6A                     
         DC    X'04507C',AL1(QHTS330P,QHTE5A)     FRI/330P-5A                   
         DC    X'026002',AL1(QHTS5A,QHTE6A)       SAT/5A-6A                     
         DC    X'026000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS5A,QHTE6A)       SUN/5A-6A                     
         DC    X'017000',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
         DC    X'7C9500',AL1(QHTS6A,QHTE330P)     M-F/6A-330P                   
DQTTAFX  DC    X'00'                                                            
                                                                                
*           TP/US/ARB/INCLUDE 2A-6A DAT + INDIV. DAY -ALL TIMES                 
DQTTAG   DC    C'TTA',AL1(3),AL2(DQTTAGX-DQTTAG)                                
         DC    X'401040',AL1(QHTS5A,QHTE6A)       MON/5A-6A                     
         DC    X'401040',AL1(QHTS6A,QHTE5A)     MON/330P-5A                     
         DC    X'202020',AL1(QHTS5A,QHTE6A)       TUE/5A-6A                     
         DC    X'202020',AL1(QHTS6A,QHTE5A)     TUE/330P-5A                     
         DC    X'103010',AL1(QHTS5A,QHTE6A)       WED/5A-6A                     
         DC    X'103010',AL1(QHTS6A,QHTE5A)     WED/330P-5A                     
         DC    X'084008',AL1(QHTS5A,QHTE6A)       THU/5A-6A                     
         DC    X'084008',AL1(QHTS6A,QHTE5A)     THU/330P-5A                     
         DC    X'045004',AL1(QHTS5A,QHTE6A)       FRI/5A-6A                     
         DC    X'045004',AL1(QHTS6A,QHTE5A)     FRI/330P-5A                     
         DC    X'026002',AL1(QHTS5A,QHTE6A)       SAT/5A-6A                     
         DC    X'026000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS5A,QHTE6A)       SUN/5A-6A                     
         DC    X'017000',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
         DC    X'7C9500',AL1(QHTS6A,QHTE330P)     M-F/6A-330P                   
DQTTAGX  DC    X'00'                                                            
*                                  TP/US/MEDIAFAX STA                           
DQTTMS   DC    C'TTM',AL1(0),AL2(DQTTMSX-DQTTMS)                                
         DC    X'40107C',AL1(QH330P,QH2A)                                       
         DC    X'20207C',AL1(QH330P,QH2A)                                       
         DC    X'10307C',AL1(QH330P,QH2A)                                       
         DC    X'08407C',AL1(QH330P,QH2A)                                       
         DC    X'04507C',AL1(QH330P,QH2A)                                       
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH2A)                                         
DQTTMSX  DC    X'00'                                                            
*                                  TP/US/MEDIAFAX MKT                           
DQTTMM   DC    C'TTM',AL1(1),AL2(DQTTMMX-DQTTMM)                                
         DC    X'40107C',AL1(QH330P,QH2A)                                       
         DC    X'20207C',AL1(QH330P,QH2A)                                       
         DC    X'10307C',AL1(QH330P,QH2A)                                       
         DC    X'08407C',AL1(QH330P,QH2A)                                       
         DC    X'04507C',AL1(QH330P,QH2A)                                       
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH2A)                                         
DQTTMMX  DC    X'00'                                                            
*                                  TP/CAN/NSI/STA                               
DQTCNS   DC    C'TCN',AL1(0),AL2(DQTCNSX-DQTCNS)                                
         DC    X'40107C',AL1(QH5P,QH2A)                                         
         DC    X'20207C',AL1(QH5P,QH2A)                                         
         DC    X'10307C',AL1(QH5P,QH2A)                                         
         DC    X'08407C',AL1(QH5P,QH2A)                                         
         DC    X'04507C',AL1(QH5P,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH5P)                                         
DQTCNSX  DC    X'00'                                                            
*                                  TP/CAN/NSI/STA JUL/92 AND AFTER              
DQTCN1S  DC    C'TCN',AL1(1),AL2(DQTCNS1X-DQTCN1S)                              
         DC    X'40107C',AL1(QH330P,QH2A)                                       
         DC    X'20207C',AL1(QH330P,QH2A)                                       
         DC    X'10307C',AL1(QH330P,QH2A)                                       
         DC    X'08407C',AL1(QH330P,QH2A)                                       
         DC    X'04507C',AL1(QH330P,QH2A)                                       
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH330P)                                       
DQTCNS1X DC    X'00'                                                            
*                                  TP/DPT/NSI/STA                               
DQTDNS   DC    C'TDN',AL1(0),AL2(DQTDNSX-DQTDNS)                                
         DC    X'7C1500',AL1(QH6A,QH2A)                                         
         DC    X'7F1700',AL1(QH6A,QH2A)                                         
         DC    X'026000',AL1(QH7A,QH5P)                                         
         DC    X'017000',AL1(QH1P,QH6P)                                         
DQTDNSX  DC    X'00'                                                            
*                                  TP/CAN/ARB/STA                               
DQTCAS   DC    C'TCA',AL1(0),AL2(DQTCASX-DQTCAS)                                
         DC    X'40107C',AL1(QH5P,QH2A)                                         
         DC    X'20207C',AL1(QH5P,QH2A)                                         
         DC    X'10307C',AL1(QH5P,QH2A)                                         
         DC    X'08407C',AL1(QH5P,QH2A)                                         
         DC    X'04507C',AL1(QH5P,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH5P)                                         
DQTCASX  DC    X'00'                                                            
*                                  TP/CAN/ARB/STA JUL/92 AND AFTER              
DQTCAS1  DC    C'TCA',AL1(1),AL2(DQTCAS1X-DQTCAS1)                              
         DC    X'40107C',AL1(QH4P,QH2A)                                         
         DC    X'20207C',AL1(QH4P,QH2A)                                         
         DC    X'10307C',AL1(QH4P,QH2A)                                         
         DC    X'08407C',AL1(QH4P,QH2A)                                         
         DC    X'04507C',AL1(QH4P,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH4P)                                         
DQTCAS1X DC    X'00'                                                            
*                                                                               
*                                 TP/CAN/ARB/STA NOV/04 AND AFTER               
DQTCAS2  DC    C'TCA',AL1(2),AL2(DQTCAS2X-DQTCAS2)                              
         DC    X'401000',AL1(QH6A,QH2A)                                         
         DC    X'202000',AL1(QH6A,QH2A)                                         
         DC    X'103000',AL1(QH6A,QH2A)                                         
         DC    X'084000',AL1(QH6A,QH2A)                                         
         DC    X'045000',AL1(QH6A,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
DQTCAS2X DC    X'00'                                                            
*                                 WTP/CAN/BBM                                   
DQTWAS   DC    C'TWA',AL1(1),AL2(DQTWASX-DQTWAS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
DQTWASX  DC    X'00'                                                            
*&&DO                                                                           
*                                  TP/RADIO/RAD/STA                             
DQTRRS   DC    C'TRR',AL1(0),AL2(DQTRRSX-DQTRRS)                                
         DC    X'409500',AL1(QHR5A,QHR445A)                                     
         DC    X'209500',AL1(QHR5A,QHR445A)                                     
         DC    X'109500',AL1(QHR5A,QHR445A)                                     
         DC    X'089500',AL1(QHR5A,QHR445A)                                     
         DC    X'049500',AL1(QHR5A,QHR445A)                                     
         DC    X'026000',AL1(QHR5A,QHR445A)                                     
         DC    X'017000',AL1(QHR5A,QHR445A)                                     
         DC    X'03E700',AL1(QHR5A,QHR445A)       *  SAT-SUN                    
         DC    X'7C9500',AL1(QHR5A,QHR445A)                                     
         DC    X'7E9600',AL1(QHR5A,QHR445A)       *                             
         DC    X'7F9700',AL1(QHR5A,QHR445A)                                     
         DC    X'979700',AL1(QHR5A,QHR445A)       M-S                           
         DC    X'989800',AL1(QHR5A,QHR445A)       ALL                           
         DC    X'919100',AL1(QHR5A,QHR445A)       MF*                           
         DC    X'929200',AL1(QHR5A,QHR445A)       MS*                           
         DC    X'969600',AL1(QHR5A,QHR445A)       M-SAT                         
         DC    X'E7E700',AL1(QHR5A,QHR445A)       SAT-SUN                       
DQTRRSX  DC    X'00'                                                            
*&&                                                                             
*                                                                               
*                                  TP/RADIO/RAD/STA                             
DQTRRS   DC    C'TRR',AL1(0),AL2(DQTRRSX-DQTRRS)                                
*                                                                               
         DC    X'40957C',AL1(QHR5A,QHR5A)                                       
         DC    X'20957C',AL1(QHR5A,QHR5A)                                       
         DC    X'10957C',AL1(QHR5A,QHR5A)                                       
         DC    X'08957C',AL1(QHR5A,QHR5A)                                       
         DC    X'04957C',AL1(QHR5A,QHR5A)                                       
         DC    X'026000',AL1(QHR5A,QH2A)                                        
         DC    X'017000',AL1(QHR5A,QH2A)                                        
         DC    X'7C9500',AL1(QHR5A,QH2A)                                        
*                                                                               
         DC    X'03E700',AL1(QHR5A,QHR445A)       *  SAT-SUN                    
         DC    X'7E9600',AL1(QHR5A,QHR445A)       *                             
         DC    X'7F9700',AL1(QHR5A,QHR445A)                                     
         DC    X'979700',AL1(QHR5A,QHR445A)       M-S                           
         DC    X'989800',AL1(QHR5A,QHR445A)       ALL                           
         DC    X'919100',AL1(QHR5A,QHR445A)       MF*                           
         DC    X'929200',AL1(QHR5A,QHR445A)       MS*                           
         DC    X'969600',AL1(QHR5A,QHR445A)       M-SAT                         
         DC    X'E7E700',AL1(QHR5A,QHR445A)       SAT-SUN                       
*                                                                               
DQTRRSX  DC    X'00'                                                            
*                                                                               
*                                  TP/RADIO/ARB/STA                             
DQTRAS   DC    C'TRA',AL1(0),AL2(DQTRASX-DQTRAS)                                
         DC    X'409500',AL1(QHR5A,QHR445A)                                     
         DC    X'209500',AL1(QHR5A,QHR445A)                                     
         DC    X'109500',AL1(QHR5A,QHR445A)                                     
         DC    X'089500',AL1(QHR5A,QHR445A)                                     
         DC    X'049500',AL1(QHR5A,QHR445A)                                     
         DC    X'026000',AL1(QHR5A,QHR445A)                                     
         DC    X'017000',AL1(QHR5A,QHR445A)                                     
         DC    X'03E700',AL1(QHR5A,QHR445A)                                     
         DC    X'7C9500',AL1(QHR5A,QHR445A)                                     
         DC    X'7E9600',AL1(QHR5A,QHR445A)                                     
         DC    X'7F9700',AL1(QHR5A,QHR445A)                                     
DQTRASX  DC    X'00'                                                            
*^^*                                  TP/RADIO/ARB/STA                          
*^^DQTRAS   DC    C'TRA',AL1(0),AL2(DQTRASX-DQTRAS)                             
*^^      DC    X'409500',AL1(QH6A,QH2A)                                         
*^^      DC    X'209500',AL1(QH6A,QH2A)                                         
*^^      DC    X'109500',AL1(QH6A,QH2A)                                         
*^^      DC    X'089500',AL1(QH6A,QH2A)                                         
*^^      DC    X'049500',AL1(QH6A,QH2A)                                         
*^^      DC    X'026000',AL1(QH6A,QH2A)                                         
*^^      DC    X'017000',AL1(QH6A,QH2A)                                         
*^^      DC    X'03E700',AL1(QH6A,QH2A)                                         
*^^      DC    X'7C9500',AL1(QH6A,QH2A)                                         
*^^      DC    X'7E9600',AL1(QH6A,QH2A)                                         
*^^      DC    X'7F9700',AL1(QH6A,QH2A)                                         
*^^DQTRASX  DC    X'00'                                                         
*                                  TP/RADIO/BIRCH/STA                           
DQTRNS   DC    C'TRN',AL1(0),AL2(DQTRNSX-DQTRNS)                                
         DC    X'409500',AL1(QH6A,QH2A)                                         
         DC    X'209500',AL1(QH6A,QH2A)                                         
         DC    X'109500',AL1(QH6A,QH2A)                                         
         DC    X'089500',AL1(QH6A,QH2A)                                         
         DC    X'049500',AL1(QH6A,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'03E700',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH2A)                                         
         DC    X'7E9600',AL1(QH6A,QH2A)                                         
         DC    X'7F9700',AL1(QH6A,QH2A)                                         
DQTRNSX  DC    X'00'                                                            
*                                  TP/RADIO/BBM/STA                             
DQTRMS   DC    C'TRM',AL1(0),AL2(DQTRMSX-DQTRMS)                                
         DC    X'409500',AL1(QH6A,QH2A)                                         
         DC    X'209500',AL1(QH6A,QH2A)                                         
         DC    X'109500',AL1(QH6A,QH2A)                                         
         DC    X'089500',AL1(QH6A,QH2A)                                         
         DC    X'049500',AL1(QH6A,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'03E700',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH2A)                                         
         DC    X'7E9600',AL1(QH6A,QH2A)                                         
         DC    X'7F9700',AL1(QH6A,QH2A)                                         
DQTRMSX  DC    X'00'                                                            
*                                  PAV/US/NSI/STA                               
DQPTNS   DC    C'PTN',AL1(0),AL2(DQPTNSX-DQPTNS)                                
         DC    X'401000',AL1(QH6A,QH545A)   WAS QH2A 11/09/01                   
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'800000',AL1(QH6A,QH545A)                                       
*&&DO                                                                           
         DC    X'401000',AL1(QH6A,QHTE245A)  WAS QH2A 11/09/01                  
         DC    X'202000',AL1(QH6A,QHTE245A)                                     
         DC    X'103000',AL1(QH6A,QHTE245A)                                     
         DC    X'084000',AL1(QH6A,QHTE245A)                                     
         DC    X'045000',AL1(QH6A,QHTE245A)                                     
         DC    X'026000',AL1(QH6A,QHTE245A)                                     
         DC    X'017000',AL1(QH6A,QHTE245A)                                     
         DC    X'7C0000',AL1(QH6A,QHTE245A)                                     
         DC    X'7F8000',AL1(QH6A,QHTE245A)                                     
         DC    X'800000',AL1(QH6A,QHTE245A)                                     
*&&                                                                             
*&&DO                                                                           
* FOLLWOING WORKED AT CUUTING OFF TIME AT 3AM BUT WE DONT GET 3A PRGS           
* WHEN REQUESTING 3A-9A                                                         
         DC    X'401000',AL1(QH6A,QH2A+3)  WAS QH2A 11/09/01                    
**       DC    X'401040',AL1(QHTS3A,QHTE5A)       MON/5A-6A                     
         DC    X'202000',AL1(QH6A,QH2A+3)                                       
         DC    X'103000',AL1(QH6A,QH2A+3)                                       
         DC    X'084000',AL1(QH6A,QH2A+3)                                       
         DC    X'045000',AL1(QH6A,QH2A+3)                                       
         DC    X'026000',AL1(QH6A,QH2A+3)                                       
         DC    X'017000',AL1(QH6A,QH2A+3)                                       
         DC    X'7C0000',AL1(QH6A,QH2A+3)                                       
         DC    X'7F8000',AL1(QH6A,QH2A+3)                                       
         DC    X'800000',AL1(QH6A,QH2A+3)                                       
*&&                                                                             
*&&DO                                                                           
         DC    X'401000',AL1(QHTS3A,QH545A)  WAS QH2A 11/09/01                  
         DC    X'401000',AL1(QH6A,QH2A+3)   WAS QH2A 11/09/01                   
         DC    X'202000',AL1(QHTS3A,QH545A)                                     
         DC    X'202000',AL1(QH6A,QH2A+3)   WAS QH2A 11/09/01                   
         DC    X'103000',AL1(QHTS3A,QH545A)                                     
         DC    X'103000',AL1(QH6A,QH2A+3)   WAS QH2A 11/09/01                   
         DC    X'084000',AL1(QHTS3A,QH545A)                                     
         DC    X'084000',AL1(QH6A,QH2A+3)   WAS QH2A 11/09/01                   
         DC    X'045000',AL1(QHTS3A,QH545A)                                     
         DC    X'045000',AL1(QH6A,QH2A+3)   WAS QH2A 11/09/01                   
         DC    X'026000',AL1(QHTS3A,QH545A)                                     
         DC    X'026000',AL1(QH6A,QH2A+3)   WAS QH2A 11/09/01                   
         DC    X'017000',AL1(QHTS3A,QH545A)                                     
         DC    X'017000',AL1(QH6A,QH2A+3)   WAS QH2A 11/09/01                   
         DC    X'7C0000',AL1(QHTS3A,QH2A+3)                                     
         DC    X'7F8000',AL1(QHTS3A,QH2A+3)                                     
         DC    X'800000',AL1(QHTS3A,QH2A+3)                                     
*&&                                                                             
*&&DO                                                                           
* FOLLWOING WORKED AT CUUTING OFF TIME AT 3AM BUT WE DONT GET 3A PRGS           
* WHEN REQUESTING 3A-9A                                                         
*                                                                               
         DC    X'401000',AL1(QHTS3A,QHTE5A)       MON/5A-6A                     
         DC    X'401000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'202000',AL1(QHTS3A,QHTE5A)       TUE/5A-6A                     
         DC    X'201000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'103000',AL1(QHTS3A,QHTE5A)       WED/5A-6A                     
         DC    X'103000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'084000',AL1(QHTS3A,QHTE5A)       THU/5A-6A                     
         DC    X'084000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'045000',AL1(QHTS3A,QHTE5A)       FRI/5A-6A                     
         DC    X'045000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'026000',AL1(QHTS3A,QHTE5A)       SAT/5A-6A                     
         DC    X'026000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017000',AL1(QHTS3A,QHTE5A)       SUN/5A-6A                     
         DC    X'017000',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
         DC    X'7C9500',AL1(QHTS5A,QHTE330P)     M-F/6A-330P                   
*&&                                                                             
DQPTNSX  DC    X'00'                                                            
*                                  PAV/US/NSI/STA--VAR & AVG-N                  
DQPTNS2  DC    C'PTN',AL1(2),AL2(DQPTNS2X-DQPTNS2)                              
         DC    X'808000',AL1(QH6A,QH545A) M-SU OR AVG-N INCL SAT & SUN          
         DC    X'909000',AL1(QH6A,QH545A) M-FR OR AVG-N W/O SAT & SUN           
DQPTNS2X DC    X'00'                                                            
*                                  PAV/US/ARB/STA                               
DQPTAS   DC    C'PTA',AL1(0),AL2(DQPTASX-DQPTAS)                                
         DC    X'401000',AL1(QH6A,QH2A)                                         
         DC    X'202000',AL1(QH6A,QH2A)                                         
         DC    X'103000',AL1(QH6A,QH2A)                                         
         DC    X'084000',AL1(QH6A,QH2A)                                         
         DC    X'045000',AL1(QH6A,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C0000',AL1(QH6A,QH2A)                                         
         DC    X'7F8000',AL1(QH6A,QH2A)                                         
         DC    X'800000',AL1(QH6A,QH2A)                                         
DQPTASX  DC    X'00'                                                            
*                                  PAV/US/ARB/SAT-SUN ROTATORS                  
DQPTAS1  DC    C'PTA',AL1(1),AL2(DQPTAS1X-DQPTAS1)                              
         DC    X'401000',AL1(QH6A,QH2A)                                         
         DC    X'202000',AL1(QH6A,QH2A)                                         
         DC    X'103000',AL1(QH6A,QH2A)                                         
         DC    X'084000',AL1(QH6A,QH2A)                                         
         DC    X'045000',AL1(QH6A,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'03E000',AL1(QH6A,QH2A)                                         
         DC    X'7C0000',AL1(QH6A,QH2A)                                         
         DC    X'7F8000',AL1(QH6A,QH2A)                                         
         DC    X'800000',AL1(QH6A,QH2A)                                         
DQPTAS1X DC    X'00'                                                            
*                                  PAV/US/MEDIAFAX/STA                          
DQPTMS   DC    C'PTM',AL1(0),AL2(DQPTMSX-DQPTMS)                                
         DC    X'401000',AL1(QH6A,QH2A)                                         
         DC    X'202000',AL1(QH6A,QH2A)                                         
         DC    X'103000',AL1(QH6A,QH2A)                                         
         DC    X'084000',AL1(QH6A,QH2A)                                         
         DC    X'045000',AL1(QH6A,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C0000',AL1(QH6A,QH2A)                                         
         DC    X'7F8000',AL1(QH6A,QH2A)                                         
         DC    X'800000',AL1(QH6A,QH2A)                                         
DQPTMSX  DC    X'00'                                                            
*                                  PAV/US/MEDIAFAX/SAT-SUN ROTATORS             
DQPTMS1  DC    C'PTM',AL1(1),AL2(DQPTMS1X-DQPTMS1)                              
         DC    X'401000',AL1(QH6A,QH2A)                                         
         DC    X'202000',AL1(QH6A,QH2A)                                         
         DC    X'103000',AL1(QH6A,QH2A)                                         
         DC    X'084000',AL1(QH6A,QH2A)                                         
         DC    X'045000',AL1(QH6A,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'03E000',AL1(QH6A,QH2A)                                         
         DC    X'7C0000',AL1(QH6A,QH2A)                                         
         DC    X'7F8000',AL1(QH6A,QH2A)                                         
         DC    X'800000',AL1(QH6A,QH2A)                                         
DQPTMS1X DC    X'00'                                                            
*                                  PAV/NTI/NSI/STA                              
DQPNNS   DC    C'PNN',AL1(0),AL2(DQPNNSX-DQPNNS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQPNNSX  DC    X'00'                                                            
*                                                                               
*                                  CABLE/STA                                    
DQPCNS   DC    C'PCN',AL1(0),AL2(DQPCNSX-DQPCNS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQPCNSX  DC    X'00'                                                            
*                                  HISPANIC WEEKLY                              
DQPWNS   DC    C'PWN',AL1(0),AL2(DQPWNSX-DQPWNS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQPWNSX  DC    X'00'                                                            
*                                                                               
*                                  TP/NETWORK/NHT  (FOR HUT-H ONLY)             
DQTNHUT  DC    C'TNH',AL1(2),AL2(DQTNHUTX-DQTNHUT)                              
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQTNHUTX DC    X'00'                                                            
*                                  TP/NETWORK/NHT                               
DQTNHS   DC    C'TNH',AL1(0),AL2(DQTNHSX-DQTNHS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQTNHSX  DC    X'00'                                                            
*                                  PAV/NETWORK/NHT                              
DQPNHS   DC    C'PNH',AL1(0),AL2(DQPNHSX-DQPNHS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQPNHSX  DC    X'00'                                                            
*                                  TP/NETWORK/NAD                               
DQTNDS   DC    C'TND',AL1(0),AL2(DQTNDSX-DQTNDS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQTNDSX  DC    X'00'                                                            
*                                  PAV/NETWORK/NAD                              
DQPNDS   DC    C'PND',AL1(0),AL2(DQPNDSX-DQPNDS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQPNDSX  DC    X'00'                                                            
*                                  TP/NETWORK/NTI POCKETPIECE                   
DQTNKS   DC    C'TNK',AL1(0),AL2(DQTNKSX-DQTNKS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQTNKSX  DC    X'00'                                                            
*                                  TNC = CABLE/STA                              
DQTNCS   DC    C'TNC',AL1(0),AL2(DQTNCSX-DQTNCS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQTNCSX  DC    X'00'                                                            
*                                  PAV/NETWORK/NTI POCKETPIECE                  
DQPNKS   DC    C'PNK',AL1(0),AL2(DQPNKSX-DQPNKS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQPNKSX  DC    X'00'                                                            
*                                  CABLE/STA                                    
DQPNCS   DC    C'PNC',AL1(0),AL2(DQPNCSX-DQPNCS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQPNCSX  DC    X'00'                                                            
*                                  REP INVENTORY                                
DQIUN    DC    C'IUN',AL1(0),AL2(DQIUNX-DQIUN)                                  
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQIUNX   DC    X'00'                                                            
*                                  REP INVENTORY                                
DQIUM    DC    C'IUM',AL1(0),AL2(DQIUMX-DQIUM)                                  
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQIUMX   DC    X'00'                                                            
*                                  TP/US/SQAD/STA                               
DQTRSS   DC    C'TRS',AL1(0),AL2(DQTRSSX-DQTRSS)                                
         DC    X'40107C',AL1(QH5P,QH2A)                                         
         DC    X'20207C',AL1(QH5P,QH2A)                                         
         DC    X'10307C',AL1(QH5P,QH2A)                                         
         DC    X'08407C',AL1(QH5P,QH2A)                                         
         DC    X'04507C',AL1(QH5P,QH2A)                                         
         DC    X'026000',AL1(QHR5A,QH2A)                                        
         DC    X'017000',AL1(QHR5A,QH2A)                                        
         DC    X'7C9500',AL1(QHR5A,QH5P)                                        
DQTRSSX  DC    X'00'                                                            
*                                  TP/US/SQAD/MKT                               
DQTRSM   DC    C'TRS',AL1(1),AL2(DQTRSMX-DQTRSM)                                
         DC    X'40107C',AL1(QH330P,QH2A)                                       
         DC    X'20207C',AL1(QH330P,QH2A)                                       
         DC    X'10307C',AL1(QH330P,QH2A)                                       
         DC    X'08407C',AL1(QH330P,QH2A)                                       
         DC    X'04507C',AL1(QH330P,QH2A)                                       
         DC    X'026000',AL1(QHR5A,QH2A)                                        
         DC    X'017000',AL1(QHR5A,QH2A)                                        
         DC    X'7C9500',AL1(QHR5A,QH330P)                                      
DQTRSMX  DC    X'00'                                                            
*                                  TP/US/NSI/INCLUDE 2A-6A DAT                  
*                                                                               
* COUNTY COVERAGE STUFF                                                         
*                                                                               
DQCUNS   DC    C'CUN',AL1(0),AL2(DQCUNSX-DQCUNS)                                
*                                                                               
         DC    X'40957C',AL1(QH5P,QH2A)                                         
         DC    X'20957C',AL1(QH5P,QH2A)                                         
         DC    X'10957C',AL1(QH5P,QH2A)                                         
         DC    X'08957C',AL1(QH5P,QH2A)                                         
         DC    X'04957C',AL1(QH5P,QH2A)                                         
         DC    X'029600',AL1(QH6A,QH2A)          SA (M-SA)                      
         DC    X'019700',AL1(QH6A,QH2A)          SU (SU-SA)                     
                                                                                
DQCUNSX  DC    X'00'                                                            
*                                  TP/US/NSI/MKT                                
DQCUNM   DC    C'CUN',AL1(1),AL2(DQCUNMX-DQCUNM)                                
*                                                                               
         DC    X'40957C',AL1(QH330P,QH2A)                                       
         DC    X'20957C',AL1(QH330P,QH2A)                                       
         DC    X'10957C',AL1(QH330P,QH2A)                                       
         DC    X'08957C',AL1(QH330P,QH2A)                                       
         DC    X'04957C',AL1(QH330P,QH2A)                                       
         DC    X'029600',AL1(QH6A,QH2A)           SAT  (M-SA)                   
         DC    X'019700',AL1(QH6A,QH2A)           SUN  (SU-SA)                  
*                                                                               
DQCUNMX  DC    X'00'                                                            
*                                  TP/US/NSI/INCLUDE 2A-6A DAT                  
DQCUNF   DC    C'CUN',AL1(2),AL2(DQCUNFX-DQCUNF)                                
*                                                                               
         DC    X'40957C',AL1(QH6A,QH2A)           MON/6A-2A                     
         DC    X'20957C',AL1(QH6A,QH2A)           TUE/6A-2A                     
         DC    X'10957C',AL1(QH6A,QH2A)           WED/6A-2A                     
         DC    X'08957C',AL1(QH6A,QH2A)           THU/6A-2A                     
         DC    X'04957C',AL1(QH6A,QH2A)           FRI/6A-2A                     
         DC    X'029600',AL1(QH6A,QH2A)           SAT/6A-2A                     
         DC    X'019700',AL1(QH6A,QH2A)           SUN/6A-2A                     
DQCUNFX  DC    X'00'                                                            
*                                                                               
*           TP/US/NSI/INCLUDE 2A-6A DAT + INDIV. DAY -ALL TIMES                 
DQCUNG   DC    C'CUN',AL1(3),AL2(DQCUNGX-DQCUNG)                                
*                                                                               
         DC    X'409540',AL1(QHTS5A,QHTE6A)       MON/5A-6A                     
         DC    X'409540',AL1(QHTS6A,QHTE5A)     MON/330P-5A                     
         DC    X'209520',AL1(QHTS5A,QHTE6A)       TUE/5A-6A                     
         DC    X'209520',AL1(QHTS6A,QHTE5A)     TUE/330P-5A                     
         DC    X'109510',AL1(QHTS5A,QHTE6A)       WED/5A-6A                     
         DC    X'109510',AL1(QHTS6A,QHTE5A)     WED/330P-5A                     
         DC    X'089508',AL1(QHTS5A,QHTE6A)       THU/5A-6A                     
         DC    X'089508',AL1(QHTS6A,QHTE5A)     THU/330P-5A                     
         DC    X'049504',AL1(QHTS5A,QHTE6A)       FRI/5A-6A                     
         DC    X'049504',AL1(QHTS6A,QHTE5A)     FRI/330P-5A                     
         DC    X'029602',AL1(QHTS5A,QHTE6A)       SAT/5A-6A  (M-SA)             
         DC    X'029600',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'019701',AL1(QHTS5A,QHTE6A)       SUN/5A-6A  (SU-SA)            
         DC    X'019700',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
*                                                                               
DQCUNGX  DC    X'00'                                                            
*                                                                               
DQCUNH   DC    C'CUN',AL1(4),AL2(DQCUNHX-DQCUNH)                                
* SPECIAL SU-SA                                                                 
         DC    X'109710',AL1(QH6A,QH2A)          SU (SU-SA)                     
         DC    X'109700',AL1(QH6A,QH2A)          SU (SU-SA)                     
DQCUNHX  DC    X'00'                                                            
*                                                                               
DQRUAD   DC    C'RUA',AL1(0),AL2(DQRUADX-DQRUAD)                                
* SPECIAL RADIO COUNTY DAYPARTS                                                 
         DC    X'100101',AL1(QH6A,QH12A)         M-SU 6A-12A                    
         DC    X'100202',AL1(QH6A,QH7P)          M-FR 6A-7P                     
DQRUADX  DC    X'00'                                                            
*                                                                               
                                                                                
*                            RENTRAK CABLE/STA                                  
DQPRNS   DC    C'PRN',AL1(0),AL2(DQPRNSX-DQPRNS)                                
         DC    X'401000',AL1(QH6A,QH545A)                                       
         DC    X'202000',AL1(QH6A,QH545A)                                       
         DC    X'103000',AL1(QH6A,QH545A)                                       
         DC    X'084000',AL1(QH6A,QH545A)                                       
         DC    X'045000',AL1(QH6A,QH545A)                                       
         DC    X'026000',AL1(QH6A,QH545A)                                       
         DC    X'017000',AL1(QH6A,QH545A)                                       
         DC    X'7C0000',AL1(QH6A,QH545A)                                       
         DC    X'7F8000',AL1(QH6A,QH545A)                                       
         DC    X'909000',AL1(QH6A,QH545A) (VAR WAS X'800000' AS ABOVE)          
DQPRNSX  DC    X'00'                                                            
*                                                                               
*                                  VIDEOLOGY                                    
*                                  TP/US/NSI/STA                                
DQTTVS   DC    C'TTV',AL1(0),AL2(DQTTVSX-DQTTVS)                                
         DC    X'40107C',AL1(QH5P,QH2A)                                         
         DC    X'20207C',AL1(QH5P,QH2A)                                         
         DC    X'10307C',AL1(QH5P,QH2A)                                         
         DC    X'08407C',AL1(QH5P,QH2A)                                         
         DC    X'04507C',AL1(QH5P,QH2A)                                         
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH5P)                                         
DQTTVSX  DC    X'00'                                                            
*                                  TP/US/NSI/MKT                                
DQTTVM   DC    C'TTV',AL1(1),AL2(DQTTVMX-DQTTVM)                                
         DC    X'40107C',AL1(QH330P,QH2A)                                       
         DC    X'20207C',AL1(QH330P,QH2A)                                       
         DC    X'10307C',AL1(QH330P,QH2A)                                       
         DC    X'08407C',AL1(QH330P,QH2A)                                       
         DC    X'04507C',AL1(QH330P,QH2A)                                       
         DC    X'026000',AL1(QH6A,QH2A)                                         
         DC    X'017000',AL1(QH6A,QH2A)                                         
         DC    X'7C9500',AL1(QH6A,QH330P)                                       
DQTTVMX  DC    X'00'                                                            
*                                                                               
*                                  TP/US/NSI/INCLUDE 2A-6A DAT                  
DQTTVF   DC    C'TTV',AL1(2),AL2(DQTTVFX-DQTTVF)                                
         DC    X'401040',AL1(QHTS5A,QHTE6A)       MON/5A-6A                     
         DC    X'40107C',AL1(QHTS330P,QHTE5A)     MON/330P-5A                   
         DC    X'202020',AL1(QHTS5A,QHTE6A)       TUE/5A-6A                     
         DC    X'20207C',AL1(QHTS330P,QHTE5A)     TUE/330P-5A                   
         DC    X'103010',AL1(QHTS5A,QHTE6A)       WED/5A-6A                     
         DC    X'10307C',AL1(QHTS330P,QHTE5A)     WED/330P-5A                   
         DC    X'084008',AL1(QHTS5A,QHTE6A)       THU/5A-6A                     
         DC    X'08407C',AL1(QHTS330P,QHTE5A)     THU/330P-5A                   
         DC    X'045004',AL1(QHTS5A,QHTE6A)       FRI/5A-6A                     
         DC    X'04507C',AL1(QHTS330P,QHTE5A)     FRI/330P-5A                   
         DC    X'026002',AL1(QHTS5A,QHTE6A)       SAT/5A-6A                     
         DC    X'026000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS5A,QHTE6A)       SUN/5A-6A                     
         DC    X'017000',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
         DC    X'7C9500',AL1(QHTS6A,QHTE330P)     M-F/6A-330P                   
DQTTVFX  DC    X'00'                                                            
*                                                                               
*                                                                               
*           TP/US/NSI/INCLUDE 2A-6A DAT + INDIV. DAY -ALL TIMES                 
DQTTVG   DC    C'TTV',AL1(3),AL2(DQTTVGX-DQTTVG)                                
         DC    X'401040',AL1(QHTS5A,QHTE6A)       MON/5A-6A                     
         DC    X'401040',AL1(QHTS6A,QHTE5A)     MON/330P-5A                     
         DC    X'202020',AL1(QHTS5A,QHTE6A)       TUE/5A-6A                     
         DC    X'202020',AL1(QHTS6A,QHTE5A)     TUE/330P-5A                     
         DC    X'103010',AL1(QHTS5A,QHTE6A)       WED/5A-6A                     
         DC    X'103010',AL1(QHTS6A,QHTE5A)     WED/330P-5A                     
         DC    X'084008',AL1(QHTS5A,QHTE6A)       THU/5A-6A                     
         DC    X'084008',AL1(QHTS6A,QHTE5A)     THU/330P-5A                     
         DC    X'045004',AL1(QHTS5A,QHTE6A)       FRI/5A-6A                     
         DC    X'045004',AL1(QHTS6A,QHTE5A)     FRI/330P-5A                     
         DC    X'026002',AL1(QHTS5A,QHTE6A)       SAT/5A-6A                     
         DC    X'026000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS5A,QHTE6A)       SUN/5A-6A                     
         DC    X'017000',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
         DC    X'7C9500',AL1(QHTS6A,QHTE330P)     M-F/6A-330P                   
DQTTVGX  DC    X'00'                                                            
*&&DO                                                                           
*                                  TP/US/NSI/INCLUDE 2A-6A DAT                  
DQTTVH   DC    C'TTV',AL1(4),AL2(DQTTVHX-DQTTVH)                                
                                                                                
         DC    X'40107C',AL1(QHTS330P,QHTE5A)     MON/330P-5A                   
         DC    X'202020',AL1(QHTS3A,QHTE5A)       TUE/3A-5A                     
         DC    X'20207C',AL1(QHTS330P,QHTE5A)     TUE/330P-5A                   
         DC    X'103010',AL1(QHTS3A,QHTE5A)       WED/3A-5A                     
         DC    X'10307C',AL1(QHTS330P,QHTE5A)     WED/330P-5A                   
         DC    X'084008',AL1(QHTS3A,QHTE5A)       THU/3A-5A                     
         DC    X'08407C',AL1(QHTS330P,QHTE5A)     THU/330P-5A                   
         DC    X'045004',AL1(QHTS3A,QHTE5A)       FRI/3A-5A                     
         DC    X'04507C',AL1(QHTS330P,QHTE5A)     FRI/330P-5A                   
         DC    X'026002',AL1(QHTS3A,QHTE5A)       SAT/3A-5A                     
         DC    X'026000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS3A,QHTE5A)       SUN/3A-5A                     
         DC    X'017000',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
         DC    X'7C9500',AL1(QHTS5A,QHTE330P)     M-F/6A-330P                   
DQTTVHX  DC    X'00'                                                            
*&&                                                                             
**                                                                              
*                                  TP/US/NSI/INCLUDE 2A-6A DAT                  
DQTTVH   DC    C'TTV',AL1(4),AL2(DQTTVHX-DQTTVH)                                
         DC    X'401040',AL1(QHTS3A,QHTE5A)       MON/3A-5A                     
         DC    X'40107C',AL1(QHTS330P,QHTE5A)     MON/330P-5A                   
         DC    X'202020',AL1(QHTS3A,QHTE5A)       TUE/3A-5A                     
         DC    X'20207C',AL1(QHTS330P,QHTE5A)     TUE/330P-5A                   
         DC    X'103010',AL1(QHTS3A,QHTE5A)       WED/3A-5A                     
         DC    X'10307C',AL1(QHTS330P,QHTE5A)     WED/330P-5A                   
         DC    X'084008',AL1(QHTS3A,QHTE5A)       THU/3A-5A                     
         DC    X'08407C',AL1(QHTS330P,QHTE5A)     THU/330P-5A                   
         DC    X'045004',AL1(QHTS3A,QHTE5A)       FRI/3A-5A                     
         DC    X'04507C',AL1(QHTS330P,QHTE5A)     FRI/330P-5A                   
         DC    X'026002',AL1(QHTS3A,QHTE5A)       SAT/3A-5A                     
         DC    X'026000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS3A,QHTE5A)       SUN/3A-5A                     
         DC    X'017000',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
         DC    X'7C9500',AL1(QHTS5A,QHTE330P)     M-F/6A-330P                   
**                                                                              
DQTTVHX  DC    X'00'                                                            
*                                                                               
*                                  NCM                                          
DQTTCS   DC    C'TTC',AL1(0),AL2(DQTTCSX-DQTTCS)                                
         DC    X'401040',AL1(QH5P,QH2A)                                         
         DC    X'202020',AL1(QH5P,QH2A)                                         
         DC    X'103010',AL1(QH5P,QH2A)                                         
         DC    X'084008',AL1(QH5P,QH2A)                                         
         DC    X'045004',AL1(QH5P,QH2A)                                         
         DC    X'026002',AL1(QH6A,QH2A)                                         
         DC    X'017091',AL1(QH6A,QH2A)                                         
**       DC    X'7C9500',AL1(QH6A,QH5P)                                         
DQTTCSX  DC    X'00'                                                            
*                                                                               
DQTTCM   DC    C'TTC',AL1(1),AL2(DQTTCMX-DQTTCM)                                
         DC    X'401040',AL1(QH330P,QH2A)                                       
         DC    X'202029',AL1(QH330P,QH2A)                                       
         DC    X'103010',AL1(QH330P,QH2A)                                       
         DC    X'084008',AL1(QH330P,QH2A)                                       
         DC    X'045004',AL1(QH330P,QH2A)                                       
         DC    X'026002',AL1(QH6A,QH2A)                                         
         DC    X'017001',AL1(QH6A,QH2A)                                         
**       DC    X'7C9500',AL1(QH6A,QH330P)                                       
DQTTCMX  DC    X'00'                                                            
*                                                                               
*                                                                               
DQTTCF   DC    C'TTC',AL1(2),AL2(DQTTCFX-DQTTCF)                                
         DC    X'401040',AL1(QHTS5A,QHTE6A)       MON/5A-6A                     
         DC    X'401040',AL1(QHTS330P,QHTE5A)     MON/330P-5A                   
         DC    X'202020',AL1(QHTS5A,QHTE6A)       TUE/5A-6A                     
         DC    X'202020',AL1(QHTS330P,QHTE5A)     TUE/330P-5A                   
         DC    X'103010',AL1(QHTS5A,QHTE6A)       WED/5A-6A                     
         DC    X'103010',AL1(QHTS330P,QHTE5A)     WED/330P-5A                   
         DC    X'084008',AL1(QHTS5A,QHTE6A)       THU/5A-6A                     
         DC    X'084008',AL1(QHTS330P,QHTE5A)     THU/330P-5A                   
         DC    X'045004',AL1(QHTS5A,QHTE6A)       FRI/5A-6A                     
         DC    X'045004',AL1(QHTS330P,QHTE5A)     FRI/330P-5A                   
         DC    X'026002',AL1(QHTS5A,QHTE6A)       SAT/5A-6A                     
         DC    X'026002',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS5A,QHTE6A)       SUN/5A-6A                     
         DC    X'017001',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
**       DC    X'7C9500',AL1(QHTS6A,QHTE330P)     M-F/6A-330P                   
DQTTCFX  DC    X'00'                                                            
*                                                                               
*                                                                               
*           TP/US/NCM/INCLUDE 2A-6A DAT + INDIV. DAY -ALL TIMES                 
DQTTCG   DC    C'TTC',AL1(3),AL2(DQTTCGX-DQTTCG)                                
         DC    X'401040',AL1(QHTS5A,QHTE6A)       MON/5A-6A                     
         DC    X'401040',AL1(QHTS6A,QHTE5A)     MON/330P-5A                     
         DC    X'202020',AL1(QHTS5A,QHTE6A)       TUE/5A-6A                     
         DC    X'202020',AL1(QHTS6A,QHTE5A)     TUE/330P-5A                     
         DC    X'103010',AL1(QHTS5A,QHTE6A)       WED/5A-6A                     
         DC    X'103010',AL1(QHTS6A,QHTE5A)     WED/330P-5A                     
         DC    X'084008',AL1(QHTS5A,QHTE6A)       THU/5A-6A                     
         DC    X'084008',AL1(QHTS6A,QHTE5A)     THU/330P-5A                     
         DC    X'045004',AL1(QHTS5A,QHTE6A)       FRI/5A-6A                     
         DC    X'045004',AL1(QHTS6A,QHTE5A)     FRI/330P-5A                     
         DC    X'026002',AL1(QHTS5A,QHTE6A)       SAT/5A-6A                     
         DC    X'026000',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS5A,QHTE6A)       SUN/5A-6A                     
         DC    X'017000',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
***      DC    X'7C9500',AL1(QHTS6A,QHTE330P)     M-F/6A-330P                   
DQTTCGX  DC    X'00'                                                            
*                                                                               
*                                  TP/US/NSI/INCLUDE 2A-6A DAT                  
DQTTCH   DC    C'TTC',AL1(4),AL2(DQTTCHX-DQTTCH)                                
         DC    X'401040',AL1(QHTS3A,QHTE5A)       MON/3A-5A                     
         DC    X'401040',AL1(QHTS330P,QHTE5A)     MON/330P-5A                   
         DC    X'202020',AL1(QHTS3A,QHTE5A)       TUE/3A-5A                     
         DC    X'202020',AL1(QHTS330P,QHTE5A)     TUE/330P-5A                   
         DC    X'103010',AL1(QHTS3A,QHTE5A)       WED/3A-5A                     
         DC    X'103010',AL1(QHTS330P,QHTE5A)     WED/330P-5A                   
         DC    X'084008',AL1(QHTS3A,QHTE5A)       THU/3A-5A                     
         DC    X'084008',AL1(QHTS330P,QHTE5A)     THU/330P-5A                   
         DC    X'045004',AL1(QHTS3A,QHTE5A)       FRI/3A-5A                     
         DC    X'045004',AL1(QHTS330P,QHTE5A)     FRI/330P-5A                   
         DC    X'026002',AL1(QHTS3A,QHTE5A)       SAT/3A-5A                     
         DC    X'026002',AL1(QHTS6A,QHTE5A)       SAT/6A-5A                     
         DC    X'017001',AL1(QHTS3A,QHTE5A)       SUN/3A-5A                     
         DC    X'017001',AL1(QHTS6A,QHTE5A)       SUN/6A-5A                     
***      DC    X'7C9500',AL1(QHTS5A,QHTE330P)     M-F/6A-330P                   
DQTTCHX  DC    X'00'                                                            
*                                                                               
         DC    X'0000'                                                          
*                                                                               
         TITLE 'INITIALISE VALUES'                                              
***********************************************************************         
* INITIALISATION ROUTINE FOR DEGET                                    *         
***********************************************************************         
         SPACE 1                                                                
INIT     NTR1  BASE=*,LABEL=*                                                   
* ALWAYS THE BAND TO D FOR NCM LOCAL                                            
         CLI   DBSELSRC,C'C'                                                    
         BNE   *+8                                                              
         CLI   DBSELMED,C'T'                                                    
         BNE   *+8                                                              
         MVI   DBSELSTA+4,C'D'                                                  
*                                                                               
         LA    RF,INITTAB                                                       
INIT04   CLI   0(RF),255                                                        
         JE    INIT06                                                           
         ICM   R0,15,0(RF)                                                      
         A     R0,RELO                                                          
         LH    RE,4(RF)                                                         
         AR    RE,RC                                                            
         STCM  R0,15,0(RE)                                                      
         LA    RF,6(RF)                                                         
         J     INIT04                                                           
*                                                                               
INIT06   L     RE,=V(BINSRCH)                                                   
         A     RE,RELO                                                          
         ST    RE,VBINSR31                                                      
         L     RE,=V(NETWEEK)                                                   
         A     RE,RELO                                                          
         ST    RE,VNETWEK                                                       
*                                                                               
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,VTYPTRN                                                
         ICM   RE,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         ST    RE,VTYPTRTB         A(VIEWING TYPE TRANSLATE TABLE)              
         MVC   VTYPTRTB_LEN,6(R1)  TABLE ENTRY LENGTH                           
*                                                                               
         XC    ADTLIST,ADTLIST                                                  
         XC    AAMKTTAB,AAMKTTAB                                                
         XC    DWLASTN,DWLASTN                                                  
         XC    PPMFLAG,PPMFLAG                                                  
*                                                                               
INIT10   DS    0H                  CALL DEMADDR TO GET TABLE ADDRS              
         L     R8,DBCOMFCS                                                      
         USING COMFACSD,R8                                                      
*                                                                               
         BRAS  RE,GETATAB          GET TABLE ADDRESSES                          
*                                                                               
         OC    CSWITCH,CSWITCH                                                  
         BNZ   INIT15                                                           
         L     RF,CMASTC            RF=AMASTC                                   
         ICM   RF,15,MCSSB-MASTD(RF)       RF=ASSB                              
         USING SSBOFFD,RF                                                       
         MVC   ALET,SSOTBLET                                                    
         MVC   SVDSPACE,SSODSPAC                                                
         DROP  RF                                                               
*                                                                               
         OC    CDEMAND1,CDEMAND1   DID WE ALREADY PICK UP A(DEGET01)?           
         BNZ   INITX               YES                                          
         LHI   R0,QDEMAND1         CORE-RESIDENT PHASE FOR DEGET01              
         ICM   R0,B'1110',=X'D9000A'                                            
         GOTO1 CCALLOV,DMCB,0,(R0)                                              
         MVC   CDEMAND1,0(R1)      REMEMBER THAT WE FOUND THIS                  
         B     INITX                                                            
*                                                                               
INIT15   L     RF,CSWITCH          USE SWITCH TO PICK UP V(SSB)                 
         XC    DUB,DUB                                                          
         MVC   DUB(4),=XL4'FEFFFFFF'                                            
         GOTO1 (RF),DUB                                                         
         ICM   RF,15,0(R1)         RF=V(SYSFACS)                                
         JNZ   *+6                                                              
         DC    H'0'                                                             
         ICM   RF,15,VSSB-SYSFACD(RF)                                           
         JNZ   *+6                                                              
         DC    H'0'                                                             
         USING SSBD,RF                                                          
         MVC   ALET,SSBTBLET                                                    
         MVC   SVDSPACE,SSBDSPAC                                                
         DROP  RF                                                               
*                                                                               
INITX    MVC   ADEGET01,CDEMAND1   SAVE A(DEGET01)                              
*                                                                               
*  WE ARE USING BOOKTYPE G AS A STANDARD BOOKTYPE                               
*  THIS IS A SPOT REQUEST                                                       
         CLI  DBBTYPE,C'G'                                                      
         BNE  *+8                                                               
         MVI  DBBTYPE,0                                                         
*                                                                               
*                                                                               
*  IF SYSCODE IS SET AND DBSELSRC/MED = NSI USTV THEN SET BOOKTYPE              
*  TO WIRED                                                                     
*                                                                               
         CLI   DBSELMED,C'T'                                                    
         BNE   NOTWIRE                                                          
*STARTING JAN19 ON FUSION LOOKS UP NIELSEN SO MAKE FUSION BEHAVE LIKE           
* NIELSEN AND CHECK THE SAME BOOKTYPES                                          
* OCT18 FOR TESTING PURPOSE BECUASE WE DONT HAVE TEST DATA                      
*                                                                               
         CLI   DBSELSRC,C'F'                                                    
         BNE   INIT16                                                           
         CLC   DBSELBK,=AL2(JAN_19)                                             
         BNL   INIT16A                                                          
                                                                                
INIT16   CLI   DBSELSRC,C'N'                                                    
         BNE   NOTWIRE                                                          
         CLI   DBBTYPE,C'1'        ALLOW ZERO CELL STANDARD                     
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,C'2'        ALLOW ZERO CELL HISPANIC                     
         BE    NOTWIRE                                                          
***      CLI   DBBTYPE,C'B'        ALLOW BLACK                                  
***      BE    NOTWIRE                                                          
***      CLI   DBBTYPE,C'H'        ALLOW HISPANIC                               
***      BE    NOTWIRE                                                          
         CLI   DBBTYPE,C'3'        ALLOW ZERO CELL CABLE                        
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,C'4'        ALLOW ZERO CELL WIRED                        
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,C'Z'        ALLOW LIVE ONLY WIRED                        
         BE    NOTWIRE                                                          
*                                                                               
*  NEW HUT BOOKTYPES                                                            
*                                                                               
INIT16A  CLI   DBBTYPE,BOOKTYPE_ZL                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_ZU                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_ZZ                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_ZJ                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_ZS                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_ZA                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_ZE                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_Z3                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_ZD                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_ZB                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_ZF                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_Z7                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_ZC                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_ZW                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_ZH                                              
         BE    NOTWIRE                                                          
**       *************                                                          
**       CLI   DBBTYPE,C'U'        ALLOW LIVE ONLY CABLE                        
**       BE    NOTWIRE                                                          
**       CLI   DBBTYPE,C'J'        ALLOW LIVE ONLY HISPANIC                     
**       BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_W3 ALLOW LIVE+3 WIRED                           
         BE    NOTWIRE                                                          
*                                                                               
         CLC   DBSELBK,=AL2(OCT_11)  ONLY SUPPORT LS AND WS OCT11 ON            
         BL    *+20                  CONTINUE W WIRE BEFORE OCT11               
         CLI   DBBTYPE,BOOKTYPE_WS                                              
         BE    NOTWIRE                                                          
         CLI   DBBTYPE,BOOKTYPE_LS   IF CABLE ASKED UNDER LS  REPORT            
         BE    NOTWIRE                                                          
*                                                                               
*                                                                               
         OC    DBSELSYC,DBSELSYC                                                
         BZ    NOTWIRE                                                          
         CLI   DBBTYPE,C'U'        IF ASKED UNDER U ,REPORT AS Z                
         BE    *+8                                                              
         CLI   DBBTYPE,C'J'        IF ASKED UNDER J ,REPORT AS Z                
         BE    *+8                                                              
         CLI   DBBTYPE,C'L'        IF ASKED UNDER L ,REPORT AS Z                
         BNE   *+12                                                             
         MVI   DBBTYPE,C'Z'                                                     
         B     NOTWIRE                                                          
*                                                                               
         CLI   DBBTYPE,BOOKTYPE_C3   IF CABLE ASKED UNDER C3, REPORT            
         BE    *+8                   AS W3 WHEN APPLYING SYSCODE                
         CLI   DBBTYPE,BOOKTYPE_L3   IF CABLE ASKED UNDER L3, REPORT            
 ***     BNE   *+12                  AS W3 WHEN APPLYING SYSCODE                
         BNE   INIT18                AS W3 WHEN APPLYING SYSCODE                
         MVI   DBBTYPE,BOOKTYPE_W3                                              
* FUSION LOST DIARY DATA EFFECTIVE JAN19 SO WE MUST USE NIELSEN DATA            
* BUT DONT USE WIRED BOOKTYPE SINCE NIELSEN HAS ALREADY LOST                    
* THE WIRED BOOKTYPES IN 2018.SYSCODE LOOKUPS SHOULD BE DMA                     
* CABLE                                                                         
         CLI   DBSELSRC,C'F'  JAN19 FORWARD FUSION BEHAVES LIKE NSI             
         BE    *+8            FOR DIARY MARKETS                                 
         CLI   DBSELSRC,C'N'                                                    
         BNE   NOTWIRE                                                          
         CLC   DBSELBK,=AL2(JAN_19)                                             
         BL    NOTWIRE                                                          
         MVI   DBBTYPE,BOOKTYPE_C3                                              
*                                                                               
         B     NOTWIRE                                                          
INIT18   DS    0H                                                               
* FUSION LOST DIARY DATA EFFECTIVE JAN19 SO WE MUST USE NIELSEN DATA            
* BUT DONT USE WIRED BOOKTYPE SINCE NIELSEN HAS ALREADY LOST                    
* THE WIRED BOOKTYPES IN 2018.SYSCODE LOOKUPS SHOULD BE DMA                     
* CABLE. MARIA SAID DEFAULT TO LS FOR CABLE IF NO BOOKTYPE REQUESTED            
* FOR CABLE                                                                     
         CLI   DBSELSRC,C'F'  JAN19 FORWARD FUSION BEHAVES LIKE NSI             
         BE    *+8            FOR DIARY MARKETS                                 
         CLI   DBSELSRC,C'N'                                                    
         BNE   INIT19                                                           
         CLC   DBSELBK,=AL2(JAN_19)                                             
         BL    INIT19                                                           
*                                                                               
* 03/2000 SINCE FUSION GOING AWAY EFFECTIVE JAN/20, MARIA SAID                  
* THAT WE SHOULD NOT DEFAULT TO _LS ANYMORE BECAUSE WE ONLY DID THAT            
* FOR FUSION DATA                                                               
         CLC   DBSELBK,=AL2(JAN_20)                                             
***      BNL   NOTWIRE                                                          
         BNL   INIT18A                                                          
*                                                                               
         MVI   DBBTYPE,BOOKTYPE_LS                                              
         B     NOTWIRE                                                          
*                                                                               
INIT18A  DS    0H                                                               
         CLI   DBBTYPE,0                                                        
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_C                                               
         CLI   DBBTYPE,BOOKTYPE_L1                                              
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_C1                                              
         CLI   DBBTYPE,BOOKTYPE_L3                                              
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_C3                                              
         B     NOTWIRE                                                          
*                                                                               
*                                                                               
INIT19   MVI   DBBTYPE,C'W'                                                     
NOTWIRE  DS    0H                                                               
*                                                                               
*******THIS CODE TO KILL BTYPE "I" FOR LA                                       
         CLI   DBBTYPE,C'I'                                                     
         BNE   LAHBYPX                                                          
         L     RE,=A(LAHSTA)                                                    
         A     RE,RELO                                                          
LAHBYP   CLI   0(RE),X'FF'                                                      
         JE    LAHBYPX                                                          
         CLC   DBSELSTA(4),0(RE)                                                
         JE    LAHBYP1                                                          
         LA    RE,4(RE)                                                         
         J     LAHBYP                                                           
LAHBYP1  MVI   DBBTYPE,C'H'                                                     
LAHBYPX  DS    0C                                                               
*                                                                               
         CLI   DBSELSRC,C'V'   VIDEOLOGY ONLY HAS LIVE ONLY FOR NOW             
         BNE   *+8                                                              
         MVI   DBBTYPE,C'L'                                                     
         J     XIT                                                              
         DROP  R8                                                               
*                                                                               
INITTAB  DC    AL4(TSTACS),Y(ATSTACS-DEGETD)                                    
         DC    AL4(GETCTRL),Y(AGETCTRL-DEGETD)                                  
         DC    AL4(GETBOOK),Y(AGETBOOK-DEGETD)                                  
         DC    AL4(GETEQIV),Y(AGETEQIV-DEGETD)                                  
         DC    AL4(GETMRKT),Y(AGETMRKT-DEGETD)                                  
         DC    AL4(BLDMRKT),Y(ABLDMRKT-DEGETD)                                  
         DC    AL4(TSTMRKT),Y(ATSTMRKT-DEGETD)                                  
         DC    AL4(GETDQ),Y(AGETDQ-DEGETD)                                      
         DC    AL4(IO),Y(AIO-DEGETD)                                            
         DC    AL4(FIXSTA),Y(AFIXSTA-DEGETD)                                    
         DC    AL4(DCONTAB),Y(ADCONTAB-DEGETD)                                  
         DC    AL4(DQPNNS),Y(ADQPNNS-DEGETD)                                    
         DC    AL4(DQTAB),Y(ADQTAB-DEGETD)                                      
         DC    AL4(SUBR01),Y(VSUBR01-DEGETD)                                    
         DC    AL1(255)                                                         
*                                                                               
         LTORG                                                                  
         TITLE 'TEST ACCESS VALIDITY TO FILES FOR A USER'                       
***********************************************************************         
* TEST ACCESS TO A FILE IS VALID FOR A USER                           *         
***********************************************************************         
         SPACE 1                                                                
TSTACS   NTR1  BASE=*,LABEL=*                                                   
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         LA    R1,DBSELBK          R1=A(SELECTED BOOK)                          
         OC    DBSELBK,DBSELBK                                                  
         JNZ   *+8                                                              
         LA    R1,=XL4'FFFFFFFF'   OR A(EFFS) IF NOT SPECIFIED                  
*                                                                               
*        ST    R1,TEMPR1                                                        
*        GOTO1 =V(PRNTBL),DMCB,=C'HERE1',(R1),C'DUMP',10,=C'1D'                 
*        L     R1,TEMPR1                                                        
*                                                                               
         GOTO1 AGETCTRL            GET AGENCY CONTROL INFO                      
         JZ    TSTACS02            NO CONTROL INFO - DEFAULT IS VALID           
*                                                                               
         L     R2,ACONHDR          R2=A(CONTROL TABLE HEADER)                   
         OC    SVCONHDR,SVCONHDR   SVCONHDR=USTV LEVEL DCON RECORD              
         BZ    *+8                                                              
         L     R2,SVCONHDR                                                      
         LAM   AR2,AR2,ALET                                                     
         SAC   512                                                              
         XR    R1,R1                                                            
         ICM   R1,1,FILEIND2       R1=FILE ACCESS INDICATOR                     
         EX    R1,TSTACMP                                                       
         IPM   R0                  SAVE CC                                      
         SAC   0                                                                
         XR    R2,R2                                                            
         SAR   AR2,R2              CLEAR AR2                                    
         SPM   R0                  RESTORE CC                                   
         JNZ   TSTACS02                                                         
         MVI   DBERROR,INVFILE     SET INVALID FILE                             
         J     XIT                                                              
*                                                                               
TSTACMP  TM    CONCTRLS+1-CONHDRD(R2),0                                         
*                                                                               
TSTACS02 MVI   DBERROR,0           SET VALID FILE                               
         CLI   DBSELSRC,C'F'       EXIT IF NOT NETWORK                          
         JE    *+8                                                              
         CLI   DBSELMED,C'N'       EXIT IF NOT NETWORK                          
         JNE   TSTACS08                                                         
         BRAS  RE,CABNUM           USE NEW TABLE                                
         OC    DBCABNUM,DBCABNUM                                                
         JNZ   TSTACS04                                                         
         BRAS  RE,GETCBL           NEED TO CHECK THE STATION                    
         LA    R1,CBLENTY                                                       
         MVC   DBACTRMK,4(R1)                                                   
         CLI   6(R1),C'C'          CABLE STATION                                
         JNE   TSTACS06                                                         
*                                                                               
TSTACS04 CLC   DBFILE,=C'RLD'      RLD DOES NOT NEED THIS CHECK                 
         BE    TSTACS06                                                         
         GOTO1 ATSTMRKT                                                         
*                                                                               
TSTACS06 BRAS  RE,TSTOACS          TEST OFFICE ACCESS                           
         J     XIT                                                              
*                                                                               
TSTACS08 CLI   DBSELMED,C'R'       EXIT IF NOT NETWORK                          
         JNE   XIT                                                              
         OC    DBSELALF,DBSELALF   IF DBSELALF IS NOT NULLS                     
         JZ    XIT                                                              
         CLC   DBSELALF,=3C' '      AND IT'S NOT BLANKS,                        
         JE    XIT                                                              
         MVC   DUB(3),DBSELALF      THEN USE IT                                 
*                                                                               
         BRAS  RE,TRAMKT           TRANSLATE ALPHAMKT TO NUMERIC MKT            
*                                                                               
         MVC   DBACTKMK,DUB+3      DUB+3(2) = NUMERIC MARKET                    
         MVC   DBSELMK,DBACTKMK                                                 
         MVC   DBACTRMK,DBACTKMK                                                
         OC    DBACTKMK,DBACTKMK                                                
         JNZ   *+12                                                             
         MVI   DBERROR,NOTFOUND                                                 
         J     XIT                                                              
*                                                                               
         GOTO1 ATSTMRKT                                                         
         J     XIT                                                              
*                                                                               
         LTORG                                                                  
         TITLE 'SET INITIAL BOOK VALUE IN DBLOCK'                               
***********************************************************************         
* ROUTINE TO SET INITIAL BOOK VALUE IN DBLOCK (DBACTBK). THIS FIELD   *         
* WILL CONTAIN X'FF'S IF AUTHORIZED FOR LATEST BOOK OR A BOOK VALUE   *         
* DERIVED FROM SELECTED BOOK (DBSELBK), LATEST BOOK LIMIT (DBSETDAT)  *         
* AND LATEST AUTHORIZED BOOK (LBKBOOK).                               *         
*                                                                     *         
* ON EXIT CC=NEQ ON ERROR WITH DBERROR SET.                           *         
***********************************************************************         
         SPACE 1                                                                
GETBOOK  NTR1  BASE=*,LABEL=*                                                   
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         OC    ATABLES,ATABLES     TEST IF A(CONTROL TABLES) SET                
         JNZ   *+8                                                              
         BRAS  RE,GETATAB                                                       
*                                                                               
         MVC   DUB(1),DBACTSRC     BUILD KEY TO LOOK-UP LATEST BOOK             
         MVC   DUB+1(1),DBINTMED                                                
*                                                                               
         CLI   DBINTMED,C'O'       FORCE FOR OVERNIGHTS                         
         BE    *+8                                                              
         CLI   DBACTSRC,C'F'       FORCE FOR FUSION                             
         BE    *+8                                                              
         CLI   DBACTSRC,C'T'       FORCE FOR TRITON                             
         BE    *+8                                                              
         CLI   DBACTSRC,C'H'       FORCE FOR IHEART                             
         BE    *+8                                                              
         CLI   DBACTSRC,C'V'       FORCE FOR VIDEOLOGY                          
         BE    *+8                                                              
         CLI   DBACTSRC,C'C'       NCM                                          
         BE    *+8                                                              
         CLI   DBINTMED,C'U'       FORCE FOR COUNTY COVERAGE                    
         BNE   GLBCTYX                                                          
         OC    DBSELDAT,DBSELDAT   IF SELDAT IS SET IT MEANS LEAVE IT           
         BNZ   *+10                ALONE                                        
         OC    DBSELBK,DBSELBK                                                  
         BNZ   *+10                                                             
         MVC   DBSELDAT,=AL2(DEC_27) FORCE FOR *LATEST* (Y2K WATCH OUT)         
         MVC   DBACTBK,DBSELDAT    RETURN LATEST TVQ BOOK AND EXIT              
         OC    DBSELBK,DBSELBK                                                  
         BZ    *+10                                                             
         MVC   DBACTBK,DBSELBK     RETURN LATEST TVQ BOOK AND EXIT              
         J     GETBOOKX                                                         
GLBCTYX  DS    0C                                                               
*                                                                               
*                                                                               
         STAR  CLEAR=YES,ARS=ON                                                 
         ICM   R2,15,ABOOKTAB                                                   
         LAM   AR2,AR2,ALET                                                     
         USING LBKTABD,R2          R2=A(LATEST BOOK TABLE)                      
*                                                                               
GETBK02  CLC   LBKSRC(2),=XL2'00'                                               
         JNE   GETBK04             PATCH OUT- COUNTY COVERAGE NOT SET           
         REAR  ARS=OFF             SET ACCESS REGISTERS BACK OFF                
         MVI   DBERROR,NOLBOOK     SET ERROR RETURN                             
         J     GETBOOKX            AND EXIT                                     
*                                                                               
GETBK04  CLC   LBKSRC(2),DUB                                                    
         JE    *+12                                                             
         LA    R2,LBKTABLN(,R2)                                                 
         J     GETBK02                                                          
*                                                                               
         MVC   LBOOK,LBKBOOK       SET LATEST AUTHORIZED BOOK                   
         REAR  ARS=OFF             GET OUT OF TROUBLE                           
         DROP  R2                                                               
*                                                                               
         CLI   DUB,C'Q'            TVQ LATEST BK LK UP?                         
         BNE   *+14                                                             
         MVC   DBACTBK,LBOOK       RETURN LATEST TVQ BOOK AND EXIT              
         J     GETBOOKX             (DON'T TEST AUTH)                           
*                                                                               
         MVC   DBACTBK,DBSELBK     SET ACTUAL TO SELECTED BOOK                  
         OC    DBACTBK,DBACTBK     TEST IF BOOK SELECTED                        
         JNZ   GETBK06                                                          
         OC    DBSELDAT,DBSELDAT   TEST IF BOOK LIMIT PRESENT                   
         JZ    GETBK06                                                          
         MVC   DBACTBK,DBSELDAT    YES - SET ACTUAL TO BOOK LIMIT               
*                                                                               
GETBK06  OC    DBACTBK,DBACTBK     TEST IF ACTUAL BOOK SET                      
         JNZ   *+10                                                             
         MVC   DBACTBK,=XL4'FFFFFFFF'    NO - SET ACTUAL EQ MAXIMUM             
         CLC   DBACTBK,LBOOK       TEST ACTUAL GR LATEST AUTHORIZED             
         JNH   GETBOOKX                                                         
         OC    ACONHDR,ACONHDR     TEST IF A(CONTROL HEADER) SET                
         JNZ   GETBK08                                                          
         LA    R1,DBACTBK                                                       
         GOTO1 AGETCTRL                                                         
*                                  SET BOOK VALUE                               
GETBK08  CLI   DBSELSRC,C'A'       FORCE FAST FOR BBM WEEKLY                    
         JNE   GETBK10                                                          
         CLI   DBSELMED,C'C'                                                    
         JNE   GETBK10                                                          
         CLI   DBBTYPE,C'W'                                                     
         JE    GETBOOKX                                                         
*                                                                               
GETBK10  CLI   DBSELSRC,C'X'       TEST IF FAST SERVICE AGENCY                  
         JNE   *+8                                                              
         CLI   DBSELMED,C'T'                                                    
         JE    *+12                                                             
         CLI   DBFAST,C'Y'         TEST IF FAST SERVICE AGENCY                  
         JE    GETBOOKX            YES - EXIT                                   
         OC    DBSELBK,DBSELBK     TEST IF SELECTED BOOK                        
         JZ    *+12                                                             
         MVI   DBERROR,NOTFOUND    YES - RETURN NOT FOUND                       
         J     GETBOOKX                                                         
         MVC   DBACTBK,LBOOK       SET ACTUAL FROM LATEST BOOK                  
*                                  RETURN TO CALLER                             
GETBOOKX CLI   DBERROR,0           SET CC=NEQ ON ERROR                          
         J     XIT                                                              
*                                                                               
         LTORG                                                                  
         TITLE 'FIND AGENCY CONTROL TABLE ENTRY FOR GIVEN BOOK'                 
*                                                                               
***********************************************************************         
* ROUTINE TO FIND AGENCY CONTROL TABLE ENTRY FOR A GIVEN BOOK.        *         
*                                                                     *         
* ON ENTRY R1 POINTS TO REQUIRED BOOK VALUE.                          *         
* ON EXIT CC=EQ IF TABLE NOT FOUND.                                   *         
*         CC=NEQ IF TABLE FOUND WITH ACONHDR SET TO TABLE ADDRESS.    *         
***********************************************************************         
         SPACE 1                                                                
GETCTRL  NTR1  BASE=*,LABEL=*                                                   
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         STAR  CLEAR=Y,ARS=OFF                                                  
         LAM   AR0,ARF,ARZERO                                                   
*                                                                               
         MVI   USTVPASS,0          1ST TIME THROUGH                             
         XC    SVCONHDR,SVCONHDR                                                
         MVC   DUB(2),0(R1)        SAVE BOOK VALUE                              
         MVC   DUB+2(1),DBACTSRC   SAVE THE SOURCE                              
         MVC   DUB+3(1),DBINTMED                                                
         MVC   DUB+4(1),DBBTYPE                                                 
         MVC   DUB+5(L'DBSELCLI),DBSELCLI  SAVE CLIENT                          
*                                                                               
*  IHEART USER ARBITRON RAD DCON RECORD                                         
**       CLI   DBACTSRC,C'H'                                                    
**       BNE   *+8                                                              
**       MVI   DBACTSRC,C'A'                                                    
*  NSI DAYPARTS USE USTV NSI DCON RECORD                                        
         CLI   DBINTMED,C'D'                                                    
         BNE   *+8                                                              
         CLI   DBSELSRC,C'N'                                                    
         BNE   *+8                                                              
         MVI   DBINTMED,C'T'                                                    
*                                                                               
         CLC   DUB+2(3),=C'NCN'    CORRECT FOR CABLE NAD                        
         JNE   GCTRLSQD                                                         
         MVI   DBINTMED,C'N'                                                    
         MVI   DBBTYPE,0                                                        
         J     GETCTRLSQX                                                       
*                                                                               
GCTRLSQD CLI   DBBTYPE,C'S'        FOR SQAD TV                                  
         JE    *+12                                                             
         CLI   DBBTYPE,C'R'        FOR SQAD TV HISPANIC                         
         JNE   GETCTRLSQX                                                       
         CLI   DBINTMED,C'T'                                                    
         BNE   GETCTRLSQX                                                       
         CLI   DBACTSRC,C'N'       FILE SOURCE IS N                             
         JNE   GETCTRLSQX                                                       
         MVI   DBACTSRC,C'S'       BUT IT IS CONTROLLED BY DCON "S"             
GETCTRLSQX DS  0C                                                               
*  NCM USE NIELSEN DCON FOR NOW UNTIL TOLD OTHERWISE                            
GCTRLNCM CLI   DBSELSRC,C'C'       NCM                                          
**       JNE   *+8                                                              
**       MVI   DBACTSRC,C'N'                                                    
*                                                                               
         MVI   DBFAST,C'Y'         SET DEFAULT OPTIONS                          
         MVI   DBSATLIT,C'N'                                                    
         MVI   DBTPSEL,C'4'                                                     
         MVI   DBXQHR,C'N'                                                      
         MVI   DBTT211,C'N'                                                     
         OC    ATABLES,ATABLES     TEST IF A(CONTROL TABLES) SET                
         JNZ   GCTRL02                                                          
         BRAS  RE,GETATAB                                                       
*                                                                               
GCTRL02  DS    0H                                                               
         XC    WORK,WORK                                                        
         XC    AAGYHDR,AAGYHDR                                                  
*                                                                               
         XR    R2,R2                                                            
         SAR   AR2,R2                                                           
         SAC   0                                                                
*                                                                               
******   LA    R2,WORK             BUILD KEY TO LOOK-UP CONTROL TABLE           
         USING CONHDRD,R2          R2=A(KEY)                                    
         MVC   WORK+(CONSRC-CONHDRD)(L'CONSRC),DBACTSRC                         
         MVC   WORK+(CONMED-CONHDRD)(L'CONMED),DBINTMED                         
         XC    DEFLT,DEFLT                                                      
         MVI   UIDPASS,1           SET FOR UID PASS                             
         L     R3,ADCONTAB          DBLOCK FILE/MED/SRC->DCON KEY MED/S         
         USING DCONTABD,R3                                                      
*                                                                               
GCTRL04  CLC   0(3,R3),GCEFFS      END OF FILE                                  
         JE    GCTRL10             EOF DEFAULT-USE DBACTSRC & DBINTMED          
         CLC   DBFILE,DCNFILE                                                   
         JNE   GCTRL06                                                          
         CLI   DCNINFIL,0          CMP TABLE TO DBINTFIL?                       
         JE    *+14                NO                                           
         CLC   DBINTFIL(2),DCNINFIL YES: COMPARE DBINTFIL                       
         JE    GCTRL08                                                          
*                                                                               
         CLI   DCNACMED,0          COMPARE ON DBACTSRC/DBACTMED?                
         JE    GCTRL06                                                          
         CLC   DBACTMED,DCNACMED                                                
         JNE   GCTRL06                                                          
         CLC   DBACTSRC,DCNACSRC                                                
         JE    GCTRL08             MATCHED TABLE                                
*                                                                               
GCTRL06  LA    R3,DCONTABQ(R3)     MATCH NEXT DCONTAB ENTRY                     
         J     GCTRL04                                                          
*                                                                               
*****    LA    R2,WORK                                                          
GCTRL08  MVC   WORK+(CONSRC-CONHDRD)(L'CONSRC),DCNCTSRC  MATCHED                
         MVC   WORK+(CONMED-CONHDRD)(L'CONMED),DCNCTMED                         
         MVC   DEFLT,DCNDFLT       SAVE DEFAULT MED/SRC LOOK UP                 
         DROP  R3                                                               
*                                                                               
****     LA    R2,WORK                                                          
                                                                                
GCTRL10  MVC   WORK+(CONCODE-CONHDRD)(L'CONCODE),DBBTYPE                        
* FOR USTV NSI ACCESS FOR BOOKTYPE P IS STANDARD AND                            
* BOOKTYPE I IS H                                                               
         CLI   DBINTMED,C'T'                                                    
         BNE   GCTRL10A                                                         
         CLI   DBACTSRC,C'N'                                                    
         BNE   GCTRL10A                                                         
         CLI   DBBTYPE,C'P'                                                     
         BNE   *+8                                                              
         MVI   WORK+(CONCODE-CONHDRD),0                                         
         CLI   DBBTYPE,C'I'                                                     
         BNE   *+8                                                              
         MVI   WORK+(CONCODE-CONHDRD),C'H'                                      
*                                                                               
GCTRL10A MVC   WORK+(CONAGY-CONHDRD)(L'CONAGY),DBSELAGY                         
         CLI   UIDPASS,1           ONLY FIRST TIME                              
         BNE   GCTRL12                                                          
         ICM   R3,15,DBEXTEND      LOOK FOR USER ID AUTH                        
         USING DBXUIID,R3                                                       
         JZ    GCTRL11             NO MORE EXTENSION                            
         CLC   0(4,R3),=C'UID '    FIND THE CORRECT EXTENSION                   
         JE    *+12                                                             
         ICM   R3,15,4(R3)                                                      
         J     *-18                                                             
         OC    DBXUUID,DBXUUID     IGNORE IF ZERO                               
         BZ    GCTRL11             USERID NOT FOUND IN EXTENSION                
         MVC   WORK+(CONAGY-CONHDRD)(L'CONAGY),DBXUUID  USER ID                 
         MVI   UIDPASS,2           SET TO UID FOUND                             
* FOR UNIVISION OFFICE'S WE DO NOT WANT TO SET THE BOOKTYPE                     
* P TO STANDARD AND I TO H  BECAUSE THEY DO WANT TO DISABLE ACCESS              
* FOR PRELIMINARY BOOKTYPES FOR THE REPS IN THESE OFFICES                       
         CLC   =H'6047',DBXUUID    UNAT                                         
         BE    *+10                                                             
         CLC   =H'1945',DBXUUID    UNCH                                         
         BE    *+10                                                             
         CLC   =H'1947',DBXUUID    UNDA                                         
         BE    *+10                                                             
         CLC   =H'1946',DBXUUID    UNDE                                         
         BE    *+10                                                             
         CLC   =H'1943',DBXUUID    UNLA                                         
         BE    *+10                                                             
         CLC   =H'1944',DBXUUID    UNMI                                         
         BE    *+10                                                             
         CLC   =H'1951',DBXUUID    UNOC                                         
         BE    *+10                                                             
         CLC   =H'5962',DBXUUID    UNSA                                         
         BE    *+10                                                             
         CLC   =H'1948',DBXUUID    UNSF                                         
         BE    *+10                                                             
         CLC   =H'8474',DBXUUID    UNTT                                         
         BE    *+10                                                             
         CLC   =H'9900',DBXUUID    TFAT                                         
         BE    *+10                                                             
         CLC   =H'9902',DBXUUID    TFCH                                         
         BE    *+10                                                             
         CLC   =H'9903',DBXUUID    TFDA                                         
         BE    *+10                                                             
         CLC   =H'9907',DBXUUID    TFDE                                         
         BE    *+10                                                             
         CLC   =H'9905',DBXUUID    TFLA                                         
         BE    *+10                                                             
         CLC   =H'9901',DBXUUID    TFMI                                         
         BE    *+10                                                             
         CLC   =H'9899',DBXUUID    TFNY                                         
         BE    *+10                                                             
         CLC   =H'9908',DBXUUID    TFOC                                         
         BE    *+10                                                             
         CLC   =H'9904',DBXUUID    TFSA                                         
         BE    *+10                                                             
         CLC   =H'9906',DBXUUID    TFSF                                         
         BE    *+10                                                             
         CLC   =H'1932',DBXUUID    UNNY                                         
         BNE   *+10                                                             
         MVC   WORK+(CONCODE-CONHDRD)(L'CONCODE),DBBTYPE                        
         B     GCTRL12                                                          
         DROP  R3                                                               
* IF USERID IS NOT SET UP IN EXTENSION THEN CHECK COMFACS ADDRESS               
* FOR BLOCK TO PULL THE USERID OUT OF.                                          
GCTRL11  DS    0H                                                               
*040804  J     GCTRL12                                                          
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CXTRAINF-COMFACSD(RF) EXTRA INFO BLOCK SET?                
         JZ    GCTRL12                                                          
         CLC   8(2,RF),=XL2'00'    USERID ?                                     
         JE    GCTRL12                                                          
         MVC   WORK+(CONAGY-CONHDRD)(L'CONAGY),8(RF)    USER ID                 
         MVI   UIDPASS,2           SET TO UID FOUND                             
                                                                                
***      LA    R2,WORK                                                          
GCTRL12  MVC   WORK+(CONCLI-CONHDRD)(L'CONCLI),DBSELCLI                         
         OC    WORK+(CONCLI-CONHDRD)(L'CONCLI),WORK+(CONCLI-CONHDRD)            
         JNZ   *+10                TEST IF CLIENT PRESENT                       
         MVC   WORK+(CONCLI-CONHDRD)(L'CONCLI),GCEFFS NO-SET DEFAULT            
         OC    WORK+(CONCODE-CONHDRD)(L'CONCODE),WORK+(CONCODE-CONHDRD)         
         JNZ   *+10                TEST IF BOOKTYPE PRESENT                     
         MVC   WORK+(CONCODE-CONHDRD)(L'CONCODE),GCEFFS                         
         OC    WORK+(CONAGY-CONHDRD)(L'CONAGY),WORK+(CONAGY-CONHDRD)            
         JNZ   *+22                TEST OF AGENCY PRESENT                       
         MVC   WORK+(CONAGY-CONHDRD)(L'CONAGY),GCEFFS                           
         MVC   WORK+(CONCODE-CONHDRD)(L'CONCODE),GCEFFS                         
         MVC   WORK+(CONCLI-CONHDRD)(L'CONCLI),GCEFFS                           
         MVC   WORK+(CONSBOOK-CONHDRD)(L'CONSBOOK),DUB                          
         XC    WORK+(CONSBOOK-CONHDRD)(L'CONSBOOK),GCEFFS                       
*                                                                               
         XC    ACONHDR,ACONHDR     CLEAR A(TABLE HEADER)                        
         ICM   R2,15,ACTRLTAB      R2=A(CONTROL TABLE)                          
         LAM   AR2,AR2,ALET                                                     
         SAC   512                                                              
*&&DO                                                                           
*  IN A DESPERATE ATTEMPT TO SEE IF THIS IS REALLY THE MODULE                   
*  THATS CHANGING THE DATASPACE..FORCE THIS RECORD TO BE ALWAYS                 
*  AS SUCH..IF ITS ALWAYS AS SUCH, WE KNOW THE PROBLEM IS HERE                  
         CLC   =X'D5E3281DC8',CONHDRD                                           
         JNE   *+16                                                             
         MVC   CONCLI,=X'FFFFFF'   CONCLI SHOULD NOT BE SET FOR THIS            
         MVC   CONSBOOK,=X'98FD'                                                
*&&                                                                             
GCTRL14  CLC   =X'FF0F',CONHDRD   BYPASS THIS SINCE IT MUCKS                    
         JE    GCTRL34            UP THE COMPARE LOGIC                          
         CLC   CONHDRD(2),=XL2'00' TEST E-O-T                                   
         JE    GCTRL16                                                          
         CLC   CONHDRD(CONAGY-CONHDRD),WORK                                     
         JL    GCTRL34                                                          
         JE    GCTRL18                                                          
* WHEN YOU GET TO THIS POINT, WE SHOULD HAVE HIT OUR "FF0F"                     
* RECORD.  NOT THE MED/SRC WE ARE LOOKING FOR, SO POINT                         
* TO NEXT MED/SRC TABLE AREA                                                    
*        CLC   =X'FF0F',CONHDRD                                                 
*        JE    GCTRL34                                                          
*                                                                               
*                                                                               
GCTRL16  OC    DEFLT,DEFLT         LOOK UP DEFAULT MED/SRC?                     
         JZ    GETCTRLX            NO                                           
         XR    R2,R2                                                            
         SAR   AR2,R2                                                           
         SAC   0                                                                
******   LA    R2,WORK                                                          
         MVC   WORK+(CONSRC-CONHDRD)(L'CONSRC),DEFLT                            
         MVC   WORK+(CONMED-CONHDRD)(L'CONMED),DEFLT+1                          
*                                                                               
         CLI   UIDPASS,2           FOUND A USER EXTENSION                       
         JNE   *+12                                                             
         MVI   UIDPASS,0           YES - RETRY FOR AGENCY                       
         J     GCTRL10                                                          
*                                                                               
         MVI   UIDPASS,0           OTHERWISE - RETRY FOR MEDIA                  
         XC    DEFLT,DEFLT                                                      
         XC    AAGYHDR,AAGYHDR                                                  
         J     GCTRL10                                                          
*----------------------------------------------------------                     
* INSTEAD OF SKIPPING THE FIRST RECORD OF SRC/MED TABLE                         
*  READ FOR THE X'FF0F' RECORD. IF NOT FOUND THEN SKIP THE                      
*  1ST SRC/MED RECORD BECAUSE THE NEWEST DEMADDR CODE TO BUILD THE              
*  X'FFFF' RECORD MUST NOT BE IN                                                
*                                                                               
*&&DO                                                                           
*                                  MATCH ON SOURCE/MEDIA                        
GCTRL18  OC    CONAGY,CONAGY       HANDLE OPTIMIZATION                          
         JNZ   GCTRL20                                                          
         AHI   R2,CONHDRLN+1                                                    
         J     GCTRL14                                                          
*&&                                                                             
*-----------------------------------------------------------                    
GCTRL18  CLC   CONAGY,=XL2'00'     IF WE ARE AT THE FIRST SRC/MED               
         JE    *+8                 THEN SEARCH FOR AGENCY IF MATCH              
         J     GCTRL20             ELSE PROCEED                                 
         LR    RE,R2               SAVE R2                                      
         ICM   R2,7,CONAET         POINT TO X'FFFF' RECORD                      
         OR    R2,R2               IF CONAET NOT SET PROCEED TO                 
         BZ    GCTRL18A            READ SEQUENTIALLY                            
         AHI   R2,1                BUMP PASS EOR MARKER                         
         B     *+8       <---TAKE OUT TO DEACTIVATE NEW TABLES                  
         B     GCTRL18A  <---TAKE OUT TO ACTIVATE NEW TABLES                    
         CLC   =X'FF0F',0(R2)      IF X'FF0F' RECORD                            
         BE    GCTRL19                                                          
GCTRL18A LR    R2,RE               IF WE DIDNT FIND X'FF0F'                     
         AHI   R2,CONHDRLN+1       RECORD WE MUST NOT HAVE NEWEST               
         J     GCTRL14             CODE IN DEMADDR-PROCEED NORMALLY             
GCTRL19  XC    DMCB,DMCB                                                        
         GOTOR AGYSRCH,DMCB,(R2)   GET ADDRESS TO START OUR LOOKUP              
         OC    DMCB+4(4),DMCB+4    FOUND THE ADDRESS?                           
         BZ    GCTRL21             NOT FOUND                                    
         ZICM  R2,DMCB+4,(15)      POINT TO ADDRESS FOUND                       
*        J    GCTRL20A             THIS ISN'T RIGHT                             
                                                                                
*                                                                               
GCTRL20  CLC   CONHDRD(CONCODE-CONHDRD),WORK                      *             
         JL    GCTRL34                                            *             
*******  JH    GCTRL22    BRANCH TO AGENCY DEFAULT 9/29/00 BPOO   *             
         JH    GCTRL21                                            *             
                                                                                
                                                                                
GCTRL20A CLI   DBFUNCT,DBACSALL                                                 
         JNE   GCTRL24                                                          
         OC    AAGYHDR,AAGYHDR     ONLY SET ONCE                                
         JNZ   GCTRL24                                                          
         STCM  R2,7,AAGYHDR+1      WORK+17=A(START OF SRC/MED/AGY BLK)          
         J     GCTRL24                                                          
*                                  MATCH ON AGENCY                              
GCTRL21  DS    0H                                                               
         CLI   UIDPASS,2           MAKE SURE THIS USERID IS SET                 
         BNE   GCTRL22                                                          
         MVC   WORK+(CONAGY-CONHDRD)(L'CONAGY),DBSELAGY                         
****     B     GCTRL22A                                                         
* WE SHOUDNT GO ON, SHOULD RESET THE COMPARE FROM THE BEGINNING                 
         MVI   UIDPASS,1                                                        
****     XR    R2,R2                                                            
****     SAR   AR2,R2                                                           
****     SAC   0                                                                
*****    LA    R2,WORK                                                          
*  ALSO RESET R2 TO POINT TO WORK AND CLEAR OUT AR2                             
         B     GCTRL12                                                          
GCTRL22  DS    0H                                                               
         MVC   WORK+(CONAGY-CONHDRD)(L'CONAGY),GCEFFS                           
GCTRL22A MVC   WORK+(CONCODE-CONHDRD)(L'CONCODE),GCEFFS                         
         MVC   WORK+(CONCLI-CONHDRD)(L'CONCLI),GCEFFS                           
                                                                                
*                                  MATCH ON BOOK TYPE                           
GCTRL24  CLC   CONHDRD(CONCLI-CONHDRD),WORK                                     
         JL    GCTRL34                                                          
         JE    GCTRL28                                                          
                                                                                
GCTRL26  MVC   WORK+(CONCODE-CONHDRD)(L'CONCODE),GCEFFS                         
         MVC   WORK+(CONCLI-CONHDRD)(L'CONCLI),GCEFFS                           
*                                  MATCH ON CLIENT                              
GCTRL28  CLC   CONHDRD(CONSBOOK-CONHDRD),WORK                                   
         JL    GCTRL34                                                          
         JE    GCTRL32                                                          
                                                                                
GCTRL30  MVC   WORK+(CONCLI-CONHDRD)(L'CONCLI),GCEFFS                           
*                                  MATCH ON BOOK                                
GCTRL32  CLC   CONHDRD(CONAET-CONHDRD),WORK                                     
         JL    GCTRL34                                                          
         TM    CONCTRLS,X'80'      TEST IF TO USE DEFAULTS                      
         JZ    GCTRL36                                                          
                                                                                
         CLC   CONCLI,GCEFFS       CLIENT LEVEL - USE AGENCY DEFAULTS           
         JNE   GCTRL30                                                          
         CLC   CONCODE,GCEFFS      BOOK TYPE - USE AGENCY DEFAULTS              
         JNE   GCTRL26                                                          
         CLC   CONAGY,GCEFFS       AGENCY LEVEL - USE SYSTEM DEFAULTS           
         JNE   GCTRL22                                                          
         J     GETCTRLX            SYSTEM LEVEL - NO DEFAULTS                   
                                                                                
GCTRL34  ICM   R2,7,CONAET         BUMP TO NEXT TABLE HEADER                    
         AHI   R2,1                                                             
         J     GCTRL14                                                          
*                                  SET DBLOCK VALUES & RETURN A(TABLE)          
GCTRL36  STCM  R2,15,ACONHDR        OF REAL DCON RECORD                         
*                                                                               
* REREAD FOR USTV/NSI AGY LEVEL DCON RECORD FOR CONTROLS                        
* IF WE GET HERE WE MUST HAVE A NSI USTV NON BOOKTYPE NON CLI LEVEL             
* DCON                                                                          
*                                                                               
         CLI   USTVPASS,1                                                       
         JNE   GCTRL50                                                          
         MVI   USTVPASS,1            =1 MEANS WE ARE READING FOR USTV           
         MVC   DBSELCLI,DUB+5        RESTORE CLIENT                             
         MVC   ACONHDR,SVCONHDR      RESTORE CONHDR                             
         J     GCTRL60                                                          
*                                                                               
GCTRL50  CLC   =C'NT',CONHDRD        ONLY REREAD FOR USTV/NSI                   
         BE    *+10                                                             
         CLC   =C'NW',CONHDRD        NSI WEEKLY                                 
         BE    *+10                                                             
         CLC   =C'NO',CONHDRD        OVERNIGHTS                                 
         BE    *+10                                                             
         CLC   =C'NU',CONHDRD        COUNTY COVERAGE                            
         BE    *+10                                                             
         CLC   =C'FT',CONHDRD        FUSION                                     
         BNE   GCTRL60                                                          
                                                                                
*                                                                               
         MVI   DBACTSRC,C'N'          ALWAYS NSI                                
         MVI   DBINTMED,C'T'          ALWAYS USTV                               
         MVI   DBBTYPE,0              NO BOOKTYPE                               
         XC    DBSELCLI,DBSELCLI      NO CLIENT                                 
         MVC   SVCONHDR,ACONHDR       SAVE ADDRESS OF CONHDR                    
         MVI   USTVPASS,1            =1 MEANS WE ARE READING FOR USTV           
         J     GETCTRLSQX             READ USTV DCON REC                        
*                                                                               
*                                                                               
GCTRL60  MVC   DBCNTRL,CONCTRLS    SAVE CONTROL TABLE BITS                      
         MVI   DBFAST,C'N'                                                      
         MVI   DBSATLIT,C'N'                                                    
         MVI   DBXQHR,C'N'                                                      
         TM    CONCTRLS,X'40'      TEST FAST SERVICE                            
         BZ    *+8                                                              
         MVI   DBFAST,C'Y'                                                      
         TM    CONCTRLS,X'20'      TEST PARENT+S2                               
         BZ    *+8                                                              
         MVI   DBSATLIT,C'Y'                                                    
         TM    CONCTRLS,X'10'      TEST 2WK HIGHEST                             
         BZ    *+8                                                              
         MVI   DBTPSEL,C'2'                                                     
         CLC   DBSELCLI,=C'=L'     FOR LAYOUT REPORT                            
         BE    *+16                                                             
         TM    CONCTRLS,X'04'      TEST EXTRA QHR LOOKUP (PEPSI)                
         BZ    *+8                                                              
         MVI   DBXQHR,C'Y'                                                      
         TM    CONCTRLS,X'02'      TEST 4WK IF 211 SPLIT                        
         BZ    *+8                                                              
         MVI   DBTT211,C'Y'                                                     
*                                  RETURN TO CALLER                             
GETCTRLX REAR  ARS=OFF                                                          
         MVC   DBACTSRC,DUB+2      RESTORE THE SOURCE                           
         MVC   DBINTMED,DUB+3         MEDIA                                     
         MVC   DBBTYPE,DUB+4          AND BOOK TYPE                             
         MVI   ACONHDR,X'FF'                                                    
         OC    ACONHDR+1(3),ACONHDR+1                                           
         J     XIT                                                              
         DROP  R2                                                               
                                                                                
********************************************************                        
                                                                                
ARZERO   DC    16F'0'                                                           
                                                                                
GCEFFS   DC    XL4'FFFFFFFF'                                                    
         LTORG                                                                  
         TITLE 'GET EQUIVALENT STATION CALL LETTERS'                            
***********************************************************************         
* THIS ROUTINE BINSRCHES  THROUGH THE AGENCY ID TABLE                           
* TO FIND THE ADDRESS OF AGENCY ACCESS RECORD TO POINT TO                       
* X'FFFF' RECORD POINTS TO AGENCY ID TABLE                                      
* AGENCY ID TABLE HAS 6 BYTE RECORDS OF (2 BYTE ID) + A(LINK)                   
*                                                                               
* ON ENTRY:                                                                     
* DMCB+0(4) = ADDRESS OF X'FF0F' RECORD                                         
* WORK IS SEARCH KEY                                                            
*                                                                               
* ON EXIT - DMCB+4(4) = ADDRESS OF DCON MATCHING AGENCY ID                      
***********************************************************************         
AGYSRCH  NTR1                                                                   
                                                                                
         LAM   AR6,AR6,ALET                                                     
         L     R6,DMCB             ADDRESS OF FFFF RECORD IN DATASPACE          
         SAC   512                                                              
         CPYA  ARE,AR6             POINT TO SAME PAGE                           
                                                                                
         LA    RE,CONHDRLN+1(R6)    RE=A(START OF SEARCH)                       
         ST    RE,AUTHFRST         SAVE START OF TABLE                          
                                                                                
         CPYA  AR1,AR6             POINT TO SAME PAGE                           
         ZICM  R1,CONAET-CONHDRD(R6),(7)  R1=END OF SEARCH                      
         AHI   R1,-2               2 BYTE EOT MARKER                            
                                                                                
         LA    R0,6                LENGTH OF EACH REC =6                        
         LR    RF,R0                                                            
         SR    RE,R0               RE=A(START OF TABLE-L'ENTRY)                 
         SR    R1,RE                                                            
* MAKE IT IDF COMPATIBLE                                                        
*        BRXLE R0,R0,*                                                          
         AR    R0,R0               R0=LOWEST POWER OF 2 >= R1                   
         CR    R0,R1                                                            
         BNH   *-4                                                              
         AR    R1,RE               R1=A(END OF LAST ENTRY)                      
*                                                                               
                                                                                
AGYSH48  SRL   R0,1                1/2 REMAINING TABLE LENGTH                   
         CR    R0,RF               TEST IF LESS THAN AN ENTRY LENGTH            
         JL    AGYSH56                                                          
         BRXH  RE,R0,AGYSH52       COMPUTE NEW TABLE START ADDRESS              
*                                  RE POINTS TO HALF OF REMAINING               
         CLC   WORK+2(2),0(RE)     TEST IF USERID FOUND                         
         JH    AGYSH48                                                          
         JL    AGYSH52                                                          
         JE    AGYSH53             FOUND IT                                     
                                                                                
AGYSH52  SR    RE,R0               POINT BACK TO 1ST HALF                       
         J     AGYSH48                                                          
                                                                                
AGYSH53  DS    0H                 FOUND IT- MATCHED AGENCY CODE                 
         MVC   DMCB+4(4),2(RE)    RETURN ADDRESS OF DCON ENTRY                  
         J     AGYSHX                                                           
*                                                                               
AGYSH56  C     RE,AUTHFRST        SEARCH IS LESS THAT FIRST TABLE ENTRY         
         BNL   *+8                                                              
         LA    RE,6(RE)           SET IT TO BE FIRST TABLE ENTRY                
         MVC   DMCB+4(4),2(RE)                                                  
                                                                                
AGYSHX   DS    0H                                                               
         XR    RE,RE                                                            
         SAR   ARE,RE              CLEAR ARE                                    
         XR    R1,R1                                                            
         SAR   AR1,R1              CLEAR AR1                                    
         XR    R6,R6                                                            
         SAR   AR6,R6              CLEAR AR6                                    
         J     XIT                                                              
***********************************************************************         
* LOOK-UP STATION CALL LETTERS IN STATION RENAME TABLE AND RETURN     *         
* EQUIVALENT STATION CALL LETTERS IN DUB IF FOUND.                    *         
*                                                                     *         
* ON ENTRY DUB(5)=STATION CALL LETTERS ZERO MEANS USE DBSELSTA        *         
*          DUB+5 X'01' BIT ON=OLD TO NEW, X'02' BIT ON=NEW TO OLD     *         
* ON EXIT CC=EQ IF STATION FOUND.                                     *         
***********************************************************************         
         SPACE 1                                                                
GETEQIV  NTR1  BASE=*,LABEL=*                                                   
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         OC    ATABLES,ATABLES     TEST IF A(CONTROL TABLES) SET                
         JNZ   *+8                                                              
         BRAS  RE,GETATAB                                                       
*                                                                               
         OC    DUB(5),DUB          TEST IF CALL LETTERS SET                     
         JNZ   *+12                                                             
         BRAS  RE,GETCALL          GET STATION CALL LETTERS INTO DUB            
         STC   R1,CALLEN                                                        
*                                                                               
         MVC   DUB+6(1),DBACTSRC   BUILD LOOK-UP KEY AT DUB+6                   
         MVC   DUB+L'DUB-1(1),DBINTMED                                          
*                                                                               
         CLI   DUB+L'DUB-1,C'R'    FOR US RADIO                                 
         JNE   *+8                                                              
         CLI   DUB+6,C'N'          USE ARB CALL LETTER CHANGES FOR              
         JNE   *+8                 BIRCH REQUESTS                               
         MVI   DUB+6,C'A'                                                       
*                                                                               
         STAR  CLEAR=YES,ARS=ON                                                 
         ICM   R2,15,AEQIVTAB                                                   
         LAM   AR2,AR2,ALET                                                     
         USING STAHDRD,R2          R2=A(EQIV TABLE HEADER)                      
*                                                                               
GEQIV02  CLC   STASRC(2),=X'0000'  TEST E-O-T                                   
         JE    GEQIVN                                                           
         XR    R5,R5                                                            
         ICM   R5,7,STAAET         R5=A(END OF TABLE)                           
         CLC   DUB+6(2),=C'ND'     NSI DPT USE MONTHLY EQUATE TABLE             
         BE    GEQIV03                                                          
         CLC   DUB+6(2),=C'NW'     NSI WKLY USE MONTHLY EQUATE TABLE            
         BE    GEQIV03                                                          
         CLC   DUB+6(2),=C'NO'     NSI OVNT USE MONTHLY EQUATE TABLE            
         BNE   *+10                                                             
GEQIV03  MVC   DUB+6(2),=C'NT'                                                  
         CLC   STASRC(2),DUB+6     TEST SOURCE/MEDIA ENTRY FOUND                
         JL    GEQIV10                                                          
         JH    GEQIVN                                                           
         MVC   DBEQEFBK,STASBOOK                                                
*                                                                               
         LA    R3,STAHDRD+STAHDRLN                                              
         CPYA  AR3,AR2                                                          
         USING STADTAD,R3          R3=A(FIRST TABLE ENTRY)                      
         XR    R4,R4                                                            
         ICM   R4,3,STALDE         R4=L'DATA ENTRY                              
*                                                                               
GEQIV04  TM    DUB+5,1                                                          
         JZ    GEQIV06                                                          
         CLI   DUB+4,C' '          CHECK 5 IF THERE                             
         JNH   *+8                                                              
         CLI   STAOCALL+4,C' '     CHECK 5 IF THERE                             
         JNH   *+14                                                             
         CLC   STAOCALL(5),DUB                                                  
         J     *+10                                                             
         CLC   STAOCALL(4),DUB     MATCH ON OLD CALL LETTERS                    
         JNE   *+14                                                             
         MVC   DUB(L'STANCALL),STANCALL                                         
         J     GEQIVY                                                           
*                                                                               
GEQIV06  TM    DUB+5,2                                                          
         JZ    GEQIV08                                                          
         CLI   DUB+4,C' '          CHECK 5 IF THERE                             
         JNH   *+8                                                              
         CLI   STANCALL+4,C' '     CHECK 5 IF THERE                             
         JNH   *+14                                                             
         CLC   STANCALL(5),DUB                                                  
         J     *+10                                                             
         CLC   STANCALL(4),DUB     MATCH ON NEW CALL LETTERS                    
         JNE   *+14                                                             
         MVC   DUB(L'STAOCALL),STAOCALL                                         
         J     GEQIVY                                                           
*                                                                               
GEQIV08  BRXLE R3,R4,GEQIV04                                                    
*                                  BUMP TO NEXT TABLE ENTRY                     
GEQIV10  LA    R2,1(R5)                                                         
         J     GEQIV02                                                          
*                                                                               
GEQIVY   SR    RC,RC               RETURN CC=EQ                                 
GEQIVN   LTR   RC,RC               RETURN CC=NEQ                                
         REAR  ARS=OFF                                                          
         J     XIT                                                              
         DROP  R2,R3                                                            
*                                                                               
         LTORG                                                                  
         TITLE 'GET MARKET NUMBER FOR GIVEN STATION'                            
***********************************************************************         
* ROUTINE TO GET MARKET NUMBER FOR A GIVEN STATION.                   *         
*                                                                     *         
* ON EXIT CC=NEQ WITH DBERROR SET ON ERROR.                           *         
*         CC=EQ IF FOUND (DBACTSTA & DBACTRMK ARE SET).               *         
***********************************************************************         
         SPACE 1                                                                
GETMRKT  NTR1  BASE=*,LABEL=*                                                   
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         CLI   DBSELMED,C'N'       PROCESS DIFF FOR NETWORK                     
         JE    GMRKT18                                                          
         LA    R2,DBKEY                                                         
         USING SBKEY,R2            R2=A(STATION KEY)                            
         MVI   SBCODE,SBCODEQU                                                  
         MVC   SBMEDIA,DBINTMED                                                 
         MVC   SBSRC,DBACTSRC                                                   
         BRAS  RE,GETCALL          GET STATION CALL LETTERS                     
*                                                                               
         MVC   SBSTAT,DUB                                                       
         LA    R1,SBSTAT(R1)                                                    
         CLI   DBSELSRC,C'C'       DON'T FORCE FOR NCM                          
         JNE   *+12                                                             
         CLI   DBSELMED,C'T'                                                    
         JE    *+8                                                              
         CLI   DBSELSRC,C'V'       DON'T FORCE FOR VIDEOLOGY                    
         JE    *+8                                                              
         CLI   DBSELMED,C'R'       DON'T FORCE FOR RADIO                        
         JE    *+12                                                             
         MVI   0(R1),C'T'                                                       
         J     *+10                SET KEY MARKET FOR RADIO                     
         MVC   SBKMKT,DBSELRMK                                                  
                                                                                
         CLI   DBSELMED,C'O'       OVERNIGHTS TP                                
         BNE   *+14                FILL IN SPILL MARKET IN                      
         MVC   SBKMKT,DBSELMK      THE PASSIVE KEY LOOKUPS                      
*        MVC   SBKMKT,DBSELRMK     HOME STATIONS WOULD BE 0                     
         MVI   0(R1),C'T'                                                       
                                                                                
* NEW CHECK - I THINK IN THEORY WE SHOULD BE SAFER TO MAKE SURE TO              
* CHECK THE BOOKTYPE - JUST DO IT FOR BOOKTYPE 'H' FOR NOW                      
* AND SEE HOW THIS WORKS OUT. THIS WAS A CASE WHERE A STATION EXISTED           
* FOR H AND STANDARD BUT THE HOME MARKET CHANGED FOR THE STANDARD               
* BUT REMAINED THE SAME FOR THE BOOKTYPE.  THIS IS A NHSI STATION UNDER         
* BKTY H.  THE HOME MARKETS ARE DIFFERENT -  WE CANT ASSUME THE HOME            
* MARKETS ARE THE SAME FOR H AND STANDARD ANYMORE.                              
*                                                                               
*                                                                               
         CLI   DBINTMED,C'T'                                                    
         BNE   *+8                                                              
         CLI   DBSELSRC,C'N'                                                    
         BNE   *+8                                                              
         CLI   DBBTYPE,C'H'                                                     
         BNE   *+10                                                             
         MVC   SBBTYP,DBBTYPE                                                   
                                                                                
         MVI   IOFLAG,DIR+HIGH+DEM READ HIGH/DIRECTORY                          
         GOTO1 AIO,IOFLAG                                                       
         JL    GETMRKTX            ERRORS                                       
         MVI   DBERROR,0                                                        
         JH    GMRKT02             EOF                                          
*                                  CHECK RETURN KEY                             
         CLC   SBKEY(SBKMKT-SBKEY),KEYSAVE                                      
         JE    GMRKT04                                                          
*                                  TRY EQUIVALENCING                            
GMRKT02  MVC   DBKEY,KEYSAVE                                                    
         XC    DUB(5),DUB                                                       
         MVI   DUB+5,3                                                          
         GOTO1 AGETEQIV            GET EQIVALENT STATION CALL LETTERS           
         JNE   GMRKTNF             EXIT IF NOT FOUND                            
         MVC   SBSTAT,DUB                                                       
         BRAS  RE,GETCALL                                                       
         LA    R1,SBSTAT(R1)                                                    
         CLI   DBSELMED,C'R'       DON'T FORCE FOR RADIO                        
         JE    *+8                                                              
         MVI   0(R1),C'T'                                                       
         GOTO1 AIO,IOFLAG                                                       
         JL    GETMRKTX            ERRORS                                       
         JH    GMRKTNF             EOF                                          
         CLC   SBKEY(SBKMKT-SBKEY),KEYSAVE                                      
         JNE   GMRKTNF                                                          
*                                  EXTRACT DATA FROM RECORD INTO DBLOCK         
GMRKT04  MVC   DBACTSTA,SBSTAT                                                  
         CLI   DBSELSRC,C'N'                                                    
         JNE   GMRKT12                                                          
         CLI   DBINTMED,C'T'                                                    
         JNE   GMRKT12                                                          
*                                                                               
         CLC   SBRMKT,=H'145'      BAD POINTERS FOR JAN/96                      
         JE    GMRKT06                                                          
*                                                                               
         B     GETWTVKX                                                         
*                                                                               
         CLC   SBSTAT,=C'WTVKT'                                                 
         BNE   GETWTVKX                                                         
         OC    SBKMKT,SBKMKT                                                    
         BNZ   GETWTVKX                                                         
         CLC   SBRMKT,=H'157'                                                   
         BNE   GETWTVKX                                                         
         MVC   SBRMKT,=H'171'                                                   
GETWTVKX DS    0H                                                               
*                                                                               
         CLC   SBSTAT,=C'WFRVT'                                                 
         JNE   GMRKT08                                                          
         OC    SBKMKT,SBKMKT                                                    
         JNZ   GMRKT08                                                          
         CLC   SBRMKT,=H'153'                                                   
         JNE   GMRKT08                                                          
         MVC   SBRMKT,=H'258'                                                   
         J     GMRKT08                                                          
*                                                                               
GMRKT06  CLC   SBSTAT,=C'WCGVT'    JAN/96 SPECIAL TAPE PROBLEM                  
         JNE   GMRKT08                                                          
         CLC   SBBOOK,=AL2(JAN_96)                                              
         JNE   GMRKT08                                                          
         MVC   SBRMKT,=H'217'                                                   
*                                                                               
GMRKT08  CLC   SBSTAT,=C'WVIIT'    JAN/96 SPECIAL TAPE PROBLEM                  
         JNE   GMRKT10                                                          
         CLC   SBBOOK,=AL2(FEB_95)                                              
         JNE   GMRKT10                                                          
         MVC   SBRMKT,=H'137'                                                   
*                                                                               
GMRKT10  CLC   SBRMKT,=H'124'      DESPERATION FIX FOR NSI FUCK UP              
         JNE   *+10                                                             
         MVC   SBRMKT,=H'168'                                                   
*                                                                               
         CLI   DBBTYPE,C'T'                                                     
         JE    GMRKT12                                                          
         CLC   SBRMKT,=H'299'      DESPERATION FIX FOR NSI FUCK UP              
         JNE   *+10                                                             
         MVC   SBRMKT,=H'352'                                                   
*                                                                               
         CLI   DBBTYPE,C'M'                                                     
         JE    GMRKT12                                                          
         CLC   SBRMKT,=H'002'      DESPERATION FIX FOR NSI FUCK UP              
         JNE   *+10                                                             
         MVC   SBRMKT,=H'230'      BIRMINGHAM                                   
*                                                                               
GMRKT12  CLI   DBSELSRC,C'S'       FIX SRC FUCK UP                              
         JNE   GMRKT14                                                          
         CLC   SBRMKT,=H'95'                                                    
         JNE   GMRKT14                                                          
         CLC   DBSELSTA(4),=C'ABC '                                             
         JE    *+10                                                             
         CLC   DBSELSTA(4),=C'CBS '                                             
         JE    *+10                                                             
         CLC   DBSELSTA(4),=C'GALA'                                             
         JE    *+10                                                             
         CLC   DBSELSTA(4),=C'NBC '                                             
         JE    *+10                                                             
         CLC   DBSELSTA(4),=C'TELE'                                             
         JE    *+10                                                             
         CLC   DBSELSTA(4),=C'UNIV'                                             
         JNE   *+10                                                             
         MVC   SBRMKT,=H'98'                                                    
*                                                                               
GMRKT14  DS    0H                                                               
*        CLI   DBSELSRC,C'A'       FIX ARB MARKET CHANGE                        
*        JNE   GMRKT16                                                          
*        CLC   SBRMKT,=H'131'                                                   
*        JNE   GMRKT16                                                          
*        CLC   DBSELSTA(4),=C'WBSV'                                             
*        JE    *+10                                                             
*        CLC   DBSELSTA(4),=C'WWSB'                                             
*        JNE   *+10                                                             
*        MVC   SBRMKT,=H'645'                                                   
*                                                                               
GMRKT16  MVC   DBACTRMK,SBRMKT                                                  
         OC    DBSELMK,DBSELMK                                                  
         JZ    *+10                                                             
         MVC   DBACTKMK,SBKMKT                                                  
* BYPASS BAD ABQ METRO BOOK LOAD TO THE STANDARD SURVEY IN FEB91                
         CLI   DBSELMED,C'T'                                                    
         BNE   GMRKT16B                                                         
         CLC   SBRMKT,=H'379'     ABQ METRO?                                    
         BNE   GMRKT16B                                                         
         CLI   SBBTYP,C'M'                                                      
         BE    *+14                                                             
         MVC   SBRMKT,=H'390'                                                   
         B     GMRKT17                                                          
*                                                                               
GMRKT16B CLI   DBFUNCT,DBVLST      VALIDATE STATION                             
         JE    GMRKT17              NO - JUST EXIT                              
*                                                                               
         CLC   SBBOOK,=AL2(OCT_90) KILL STN RECDS BEFORE OCT90                  
         BNL   GETMRKTX             ELSE, JUST EXIT                             
         CLC   DBSELAGY,=C'SJ'       ALLOW EVERYTHING FOR SJ AND NB             
         BE    *+14                                                             
         CLC   DBSELAGY,=C'NB'       AND NBC                                    
         BNE   GMRKT17                                                          
         OC    DBSELBK,DBSELBK     NO BK GIVEN, GIVE EVERYTHING                 
         BZ    GETMRKTX                                                         
         CLC   DBSELBK,SBBOOK                                                   
         BH    GMRKT17                                                          
         B     GETMRKTX                                                         
*                                   OTHERWISE READ FOR LAST BOOK                
GMRKT17  MVI   IOFLAG,DIR+SEQ+DEM   READ SEQ/DIRECTORY                          
         GOTO1 AIO,IOFLAG           FOR LATEST BOOK                             
         CLC   SBKEY(SBBOOK-SBKEY),KEYSAVE                                      
         JE    GMRKT04                                                          
         CLC   SBKEY(SBRMKT-SBKEY),KEYSAVE                                      
         JNE   *+14                                                             
         CLC   SBBOOK,KEYSAVE+SBBOOK-SBKEY                                      
         JH    GMRKT04                                                          
         CLI   DBFUNCT,DBVLST                                                   
         BNE   GMRKTNF             CAN'T FIND A GOOD RECD ->NOT FOUND           
         MVC   DBKEY,KEYSAVE       RESTORE LAST GOOD KEY                        
         MVI   IOFLAG,DIR+HIGH+DEM  THEN READ THE RECORD                        
         GOTO1 AIO,IOFLAG                                                       
         J     GETMRKTX                                                         
         DROP  R2                                                               
*                                                                               
GMRKT18  XC    DUB,DUB             NETWORK FILE VALDATION                       
         MVI   DBERROR,0                                                        
         LA    R1,PRKMKT-PRKEY     COMPARE THRU STATION                         
         OC    DBSELBK,DBSELBK                                                  
         JZ    *+14                                                             
         MVC   DUB+1(2),DBSELBK                                                 
         LA    R1,PRSTYP-PRKEY     MATCH ON BOOK TOO                            
         STC   R1,DUB+4                                                         
         BRAS  RE,RDNET                                                         
         JNE   GMRKTNF             NOT FOUND                                    
         MVC   DBACTRMK,NETMKT     GET MKT# FROM PAVFIL KEY                     
         MVI   DUB,C'S'                                                         
         BRAS  RE,BLDNET           BUILD DUMMY STATION                          
         XC    DBKEY,DBKEY                                                      
         MVC   DBKEY(14),KEYSAVE    RESTORE DIRECTORY KEY TO DBKEY              
         J     GETMRKTX                                                         
*                                                                               
GMRKTNF  MVI   DBERROR,NOTFOUND    ERROR EXIT - NOT FOUND                       
*                                                                               
GETMRKTX CLI   DBERROR,0           SET CC=EQ IF RECORD FOUND                    
         J     XIT                                                              
*                                                                               
         LTORG                                                                  
         TITLE 'BUILD DUMMY MARKET RECORD'                                      
***********************************************************************         
* BLDMRKT -  BUILD A DUMMY MARKET NAME RECORD                         *         
***********************************************************************         
         SPACE 1                                                                
BLDMRKT  NTR1  BASE=*,LABEL=*                                                   
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         L     RF,DBAREC                                                        
         USING DMKEY,RF            RF=A(RECORD)                                 
         XC    DMKEY(256),DMKEY                                                 
         MVC   DMKMAJOR,DBKEY                                                   
         MVC   DMMINOR,DBMINKEY                                                 
         LA    R1,DMFRSTEL         BUILD MARKET NAME ELEMENT                    
         MVC   0(2,R1),=X'010F'                                                 
         MVC   2(2,R1),DBMINKEY                                                 
         MVC   4(11,R1),=C'**UNKNOWN**'                                         
         CLI   DBSELMED,C'N'       PULL NETWORK MKT NAMES FROM TBL              
         JNE   *+10                                                             
         MVC   4(11,R1),WORK       MOVE IN NETWORK FILE NAME                    
         LA    R1,16(R1)                                                        
         SR    R1,RF                                                            
         STCM  R1,3,DMRLEN         SET RECORD LENGTH & STATUS                   
         MVI   DBERROR,0           RESET NOT FOUND                              
         J     XIT                                                              
         DROP  RF                                                               
*                                                                               
         LTORG                                                                  
         TITLE 'PROCESS MARKET LIST VALIDITY'                                   
***********************************************************************         
* PROCESS VALID & INVALID MARKET LISTS IN AGENCY CONTROL TABLE        *         
***********************************************************************         
         SPACE 1                                                                
TSTMRKT  NTR1  BASE=*,LABEL=*,WORK=(R7,TMR_DLQ)                                 
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         USING TMR_WRKD,R7                                                      
*                                                                               
         MVI   DBERROR,0                                                        
         CLI   DBFUNCT,DBTSTACS    CABLE CHECKS THE MARKET                      
         JNE   TSTMKT02            ON A TEST ACCESS CALL                        
         OC    DBACTRMK,DBACTRMK                                                
         JNZ   TSTMKT10                                                         
*                                                                               
TSTMKT02 L     R1,DBAREC                                                        
         AH    R1,DBDTADSP         R1=A(CURRENT ELEMENT)                        
         OC    DBACTRMK,DBACTRMK   TEST MARKET NUMBER KNOWN                     
         JNZ   TSTMKTX                                                          
*                                  TEST MARKET NUMBER VALID                     
         MVC   DBACTRMK,=H'1'      SET FOR DEFAULT                              
         USING MARELEM,R1                                                       
         CLI   MARCODE,MARCODEQ    TEST IF MARKET NUMBER ELEMENT                
         JNE   *+10                                                             
         MVC   DBACTRMK,MARNO      SET ACTUAL MARKET FROM RECORD                
         DROP  R1                                                               
*                                                                               
         EJECT                                                                  
*======================================================================         
*                                                                               
* WE ARE GOING TO PURGE HISTORICAL NIELSEN LOCAL MONTHLIES DATA TO              
* RECLAIM DISK SPACE. PRIOR TO DOING THIS, WE EMULATE WHAT HAPPENS WHEN         
* THE BOOKS ARE GONE, BY PRETENDING THAT THEY ARE UNAUTHORIZED. THIS            
* ALLOWS US TO HEAR ABOUT NON-TRANSPARENT PROBLEMS BEFORE WE PHYSICALLY         
* PURGE THE DATA. THIS PERTAINS TO (AND ONLY TO) TIME PERIOD ("RTN")            
* AND DAYPART CUMES ("RDN") DATA.                                               
*                                                                               
* DEIS JUL/2019:                                                                
*   WE SHOULD NOT BE READING FUSION DATA IF ITS CORRESPONDING NIELSEN           
*   LOCAL MONTHLIES BOOK HAS BEEN PURGED, SO WE ARE USING THIS ROUTINE          
*   TO DO A "SOFT" PURGE OF THE FUSION DATA RATHER THAN A PHYSICAL              
*   PURGE. HOWEVER, THAT MEANS THAT WE NEED TO KEEP THIS ROUTINE ALIVE          
*   INDEFINITELY. I.E., IT MIGHT BE BETTER TO PURGE THE FUSION DATA             
*   FROM THE FILE. WE ALSO NEED TO FIGURE OUT HOW TO HANDLE ANY FQA             
*   REGRESSION SCRIPTS FOR FUSION THAT MAY EXIST. TBD.                          
*                                                                               
* NOTE THAT WHEN WE ACTUALLY DO THE DATA PURGE, WE WILL BE PURGING              
* RELATED *PASSIVE* RECORDS ALSO. THAT PURGE IS *NOT* BEING EMULATED IN         
* ADVANCE, BECAUSE IT WAS DEEMED TO BE UNNECESSARY. THIS DOES MEAN,             
* HOWEVER, THAT WE ARE NOT EMULATING THE FULL USER EXPERIENCE WHICH             
* WILL TAKE PLACE WHEN THE DATA IS ACTUALLY PURGED.                             
*                                                                               
* ONCE THIS PROJECT IS COMPLETE, AND THE DATA IS ACTUALLY PURGED, WE            
* CAN REMOVE THIS CODE.                                                         
*                                                                               
* NOTE THAT THERE ARE ACTUALLY *TWO* RELATED, BUT DIFFERENT THINGS              
* HAPPENING IN THIS PIECE OF CODE:                                              
*                                                                               
*  1. FOR FQA ONLY:                                                             
*      OUR PLAN IS TO CONSTRUCT A DEDICATED DEMOFILE FOR FQA CONTAINING         
*      HISTORICAL BOOKS WHICH WILL BE PURGED FROM THE PRODUCTION DEMO           
*      FILE (THIS IS TO PREVENT OUR DESTROYING FQA'S SCRIPTS WHEN THE           
*      HISTORICAL DATA IS PURGED). IN ORDER TO MAKE SURE THAT WE'RE             
*      SAVING ALL OF THE NECESSARY DATA FOR FQA (BEFORE IT IS ACTUALLY          
*      PURGED), A HARD-CODED DEMTABS TABLE OF BOOK/MARKET COMBINATIONS          
*      HAS BEEN CREATED REFLECTING WHAT WE PLAN TO SAVE. SO UNDER FQA           
*      (ONLY), WE CHECK THE REQUESTED BOOK/MARKET AGAINST THAT TABLE.           
*      IF IT'S IN THE LIST, THEN WE DO *NOT* UNAUTHORIZE IT REGARDLESS          
*      OF HOW OLD THE BOOK IS. OTHERWISE, IT IS ELIGIBLE TO BE PURGED           
*      BASED ON ITS AGE.                                                        
*  2. IN ALL ENVIRONMENTS (INCLUDING FQA):                                      
*      THE REQUESTED BOOK IS CHECKED AGAINST THE CURRENT DATE TO                
*      DETERMINE IF IT IS ELIGIBLE TO BE UNAUTHORIZED (I.E., PURGED).           
*                                                                               
L        USING FQABOOKD,TMR_KEY    BINSRCH KEY IN LOCAL W/S                     
*                                                                               
         CLI   DBSELSRC,C'N'       ARE WE LOOKING AT NIELSEN DATA?              
         BE    TMR_10              YES: CHECK IT OUT                            
*                                                                               
         CLI   DBSELSRC,C'F'       ARE WE LOOKING AT FUSION DATA?               
         BNE   TMR_OK              NO: GET OUT                                  
         CLI   SVDSPACE,C'Q'       YES: BUT IF WE'RE ON FQA...                  
         BE    TMR_OK              ...LET ALL FUSION LOOKUPS THROUGH            
*                                       (FOR NOW, ANYWAY)                       
*                                                                               
TMR_10   DS    0H                                                               
         CLI   DBSELMED,C'T'       IS THIS LOCAL MONTHLIES TIME PERIOD?         
         BNE   TMR_20                                                           
         OC    DBACTBK,DBACTBK     YES, IN WHICH CASE...                        
         JNZ   TMR_15              WE NEED THE BOOK                             
         CLI   DBSELSRC,C'F'       BUT IF IT'S FUSION...                        
         JE    TMR_OK              IT'S OKAY TO NOT HAVE THE BOOK               
         DC    H'0'                                                             
*                                                                               
TMR_15   DS    0H                                                               
         MVC   L.FQABOOK,DBACTBK   PUT BOOK IN BINSRCH KEY                      
         B     TMR_40                                                           
*                                                                               
TMR_20   DS    0H                                                               
         CLI   DBSELMED,C'D'       IS IT LOCAL MONTHLIES DAYPART CUMES?         
         BNE   TMR_OK              NO: GET OUT                                  
*                                                                               
         OC    DBSELBK,DBSELBK     IF LATEST BOOK IS REQUESTED, THEN...         
         BZ    TMR_OK              ...WE DON'T HAVE THE BOOK: THAT'S OK         
*                                                                               
         MVC   L.FQABOOK,DBSELBK   PUT BOOK IN BINSRCH KEY                      
*                                                                               
TMR_40   DS    0H                                                               
         OC    DBACTRMK,DBACTRMK   IN ALL CASES, WE MUST HAVE...                
         JZ    *+2                 ...THE RATING SERVICE MARKET!                
         MVC   L.FQARMKT,DBACTRMK  PUT RATING MARKET IN BINSRCH KEY             
*                                                                               
         CLI   SVDSPACE,C'Q'       ARE WE ON FQA?                               
         BNE   TMR_70              NO: DON'T DO THE TABLE LOOKUP                
*                                                                               
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),TMR_DMCB,FQABOOKS       GET A(FQA "KEEP" TABLE)             
         ICM   RE,15,0(R1)         A(TABLE) RETURNED IN P1                      
         JZ    *+2                 BAD TABLEID PASSED                           
         LHY   R0,-4(,RE)          # OF TABLE ENTRIES                           
         L     RF,4(R1)            L'TABLE ENTRY RETURNED IN P2                 
*                                                                               
         USING BSPARA,R1                                                        
         LA    R1,TMR_DMCB         LOCAL DMCB                                   
         XC    BSPARA(8*4),BSPARA  CLEAR ENTIRE DMCB (8 PARAMETERS)             
         ST    RE,BSPSTRT          A(TABLE)                                     
         LA    RE,TMR_KEY                                                       
         ST    RE,BSPAREC          A(RECORD)                                    
         ST    R0,BSPNOR           # OF RECORDS IN TABLE                        
         ST    RF,BSPLENR          L'RECORD                                     
         ST    RF,BSPLENK          L'KEY                                        
         ST    R0,BSPEND           # OF RECORDS IN TABLE                        
         GOTO1 VBINSR31                                                         
         TM    0(R1),X'80'         RECORD NOT FOUND?                            
         BZ    TMR_OK              IT *WAS* FOUND: WE'RE KEEPING IT             
         DROP  R1                                                               
*                                                                               
TMR_70   DS    0H                                                               
*                                                                               
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDATCON-COMFACSD(RF)                                       
*                                                                               
* USE SPECIAL DATCON CALLS WHICH INCORPORATE ADDAY. SUBTRACT THE NUMBER         
* OF MONTHS SPECIFIED IN P4 FROM TODAY'S DATE.                                  
*                                                                               
* SEE IF THE BOOK IS RECENT ENOUGH THAT WE *MUST DEFINITELY KEEP IT.*           
         GOTO1 (RF),TMR_DMCB,(X'35',0),(3,TMR_DUB),                    +        
               (7,0),A((-12*UNCONDITIONAL_LM_KEEP_#_YRS)-1)                     
         CLC   L.FQABOOK,TMR_DUB   KEEP BOOK *UNCONDITIONALLY* ?                
         BNL   TMR_OK              YES: IT'S A CURRENT BOOK                     
*                                                                               
* SEE IF THE BOOK IS OLD ENOUGH THAT WE *MAY DEFINITELY PURGE IT.*              
         GOTO1 (RF),TMR_DMCB,(X'35',0),(3,TMR_DUB),                    +        
               (7,0),A((-12*CONDITIONAL_LM_KEEP_#_YRS)-1)                       
         CLC   L.FQABOOK,TMR_DUB   PURGE BOOK *UNCONDITIONALLY* ?               
         BL    TMR_UNAUTHORIZED    YES: UNAUTHORIZE "HISTORICAL" BOOK           
*                                                                               
* IF THE BOOK WAS DURING A SUMMER OR WINTER OLYMPICS WITHIN THE LAST            
* 8 YEARS, THEN WE MAY NOT PURGE IT. TO MAKE THIS DETERMINATION, WE             
* MUST LOOK AT THE OLYMPIC GAMES DATE RANGE, IN CONJUNCTION WITH THE            
* NIELSEN SWEEP DATE CALENDAR. SO FAR, IN ALL CASES WE'VE SEEN, IT'S            
* VERY STRAIGHTFORWARD, BECAUSE EACH OLYMPIC GAME SERIES FALLS IN               
* TOTALITY WITHIN ONLY ONE SWEEP MONTH. THAT'S NOT GUARANTEED GOING             
* FORWARD, OF COURSE (UNLESS NIELSEN DOES THIS BY DESIGN, BUT WE CAN'T          
* RELY ON THAT).                                                                
*                                                                               
         CLC   L.FQABOOK,=AL2(FEB_18) WINTER/2018 OLYMPICS: FEB09-FEB25         
         BE    TMR_OK                                                           
         CLC   L.FQABOOK,=AL2(AUG_16) SUMMER/2016 OLYMPICS: AUG05-AUG21         
         BE    TMR_OK                                                           
         CLC   L.FQABOOK,=AL2(FEB_14) WINTER/2014 OLYMPICS: FEB07-FEB23         
         BE    TMR_OK                                                           
         CLC   L.FQABOOK,=AL2(AUG_12) SUMMER/2012 OLYMPICS: JUL27-AUG12         
         BE    TMR_OK                                                           
         CLC   L.FQABOOK,=AL2(FEB_10) WINTER/2010 OLYMPICS: FEB12-FEB28         
         BE    TMR_OK                                                           
*                                                                               
TMR_UNAUTHORIZED DS 0H                                                          
*********NOP   TSTMKT20            FOR NOW, DON'T UNAUTHORIZE ANYTHING          
         B     TSTMKT20            HISTORICAL BOOK: UNAUTHORIZE IT              
*                                                                               
TMR_OK   DS    0H                  DON'T PRETEND MARKET IS UNAUTHORIZED         
*                                                                               
         DROP  L                                                                
         EJECT                                                                  
*======================================================================         
*                                                                               
         CLC   DBFILE,=C'RLD'      RLD ACTUALLY FOLLOWS ABOVE METHOD            
         BE    TSTMKT03            FOR CABLE.                                   
*                                                                               
         TM    SPNETFLG,SPCBLQ     SPOT-CBL LK UP                               
         BO    *+14                                                             
         CLC   DBINTFIL(2),=C'PC'  FOR NEW CABLE MARKET                         
         JNE   TSTMKT03            (COMENT OUT FOR CBL STATN LOCKOUTS)          
         MVC   DBACTRMK,=Y(CBLMKT)  REGULAR CABLE MARKET NO                     
         CLI   DBBTYPE,C'N'                                                     
         BNE   *+10                                                             
         MVC   DBACTRMK,=Y(CNADMKT) CABLE NAD MARKET NO                         
         CLI   DBBTYPE,C'M'                                                     
         BNE   *+10                                                             
         MVC   DBACTRMK,=Y(MOVIEMKT) CABLE MOVIE GOER                           
         BRAS  RE,COMCMKT                                                       
         BNE   *+10                                                             
         MVC   DBACTRMK,=Y(ACMCBMKT) ACM(COMMERCIAL AVG) CABLE                  
*                                                                               
         CLI   DBCABNUM,C'H'         HISPANIC CABLE                             
         BNE   TSTMKT03                                                         
         MVC   DBACTRMK,=Y(HCBLMKT)  CABLE MKT BEFORE AUG27/07 (NHTI)           
         CLC   DBSELBK,=AL1(YR_2007,WEEK_35)                                    
         BL    *+10                                                             
         MVC   DBACTRMK,=Y(HPMCBLMK) CABLE MKT STARTING AUG27/07 (NTIH)         
*                                                                               
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,NEHCBCLL                                               
         ICM   RE,15,0(R1)         A(HISPANIC CABLE STATIONS)                   
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            R0 HAS LENGTH OF TABLE ENTRY                 
*                                                                               
         USING NEHCBCLD,RE                                                      
TSHSP04  CLI   0(RE),X'FF'                                                      
         BE    TSTMKT03                                                         
         CLC   NEHCBNML,DBCABNUM+1  MATCH ON EXTENDED STATION NUMBER            
         BE    TSHSP06                                                          
         AR    RE,R0                                                            
         B     TSHSP04                                                          
TSHSP06  CLI   NEHCPRG,NEHCPRGY    DOES STATION HAVE PROGRAM DATA?              
         BNE   TSTMKT03            NO                                           
         DROP  RE                                                               
*                                  YES. USE GALAVISION MARKET NUMBER            
         MVC   DBACTRMK,=Y(HGALMKT)  GALAV MKT BEFORE AUG27/07 (NHTI)           
         CLC   DBSELBK,=AL1(YR_2007,WEEK_35)                                    
         BL    *+10                                                             
         MVC   DBACTRMK,=Y(HPMGALMK) GALAV MKT STARTING AUG27/07 (NTIH)         
*                                                                               
TSTMKT03 CLI   DBSELSRC,C'N'       CHECK FOR NSI SPOT TV                        
         JNE   TSTMKT06                                                         
         CLI   DBSELMED,C'T'                                                    
         JNE   TSTMKT06                                                         
         L     RE,=A(NSIMMTAB)                                                  
         A     RE,RELO                                                          
*                                                                               
TSTMKT04 CLI   0(RE),X'FF'                                                      
         BE    TSTMKT06                                                         
         CLC   DBACTRMK,0(RE)                                                   
         BE    *+12                                                             
         LA    RE,4(RE)                                                         
         B     TSTMKT04                                                         
         MVC   DBMMBOOK,2(RE)                                                   
*                                                                               
*    TAKE CARE OF NTI CONFORMED/INTEGRATED AUTHORIZATIONS                       
*                                                                               
TSTMKT06 CLI   DBSELMED,C'N'       NETWORK REQUEST                              
         JNE   TSTMKT10                                                         
*                                                                               
         CLI   DBSELBK+1,0         POSSIBLE YEARLY HUT (NO WEEK)                
         JNE   *+10                                                             
         CLC   DBSELSTA(3),=C'HUT' CONSIDER VALID IF IT IS                      
         JE    TSTMKT08                                                         
*                                                                               
         CLC   DBACTRMK,=H'1'      AND STANDARD POCKETPIECE DATA                
         JNE   TSTMKT10                                                         
*                                  YR_1997                                      
         CLC   DBSELBK,=X'6100'    NO SPECIAL AUTHORIZATION FOR A/I             
         JH    TSTMKT08            AFTER THIS BOOK                              
         CLI   DBBTYPE,C'C'        FUDGE CONFORMED                              
         JNE   *+10                                                             
         MVC   DBACTRMK,=H'210'                                                 
*                                  ASCRIBED IS THE PRIMARY SERVICE              
         CLC   DBSELBK,=AL1(YR_1987,WEEK_32)                                    
         JH    *+12                AFTER THIS BOOK                              
         CLI   DBBTYPE,C'A'        FUDGE ASCRIBED                               
         JE    *+8                                                              
         CLI   DBBTYPE,C'I'        FUDGE INTEGRATED                             
         JNE   *+10                                                             
         MVC   DBACTRMK,=H'211'                                                 
*                                                                               
TSTMKT08 CLC   DBSELSTA(5),=C'HUT H' HISPANIC HUT REQUEST                       
         JNE   *+10                                                             
         MVC   DBACTRMK,=H'500'    AUTH HISPANIC                                
*                                                                               
TSTMKT10 OC    ACONHDR+1(3),ACONHDR+1                                           
         JZ    TSTMKTX                                                          
*                                                                               
         STAR  CLEAR=Y,ARS=ON                                                   
         L     R2,ACONHDR          R2=A(CONTROL TABLE)                          
         LAM   AR2,AR2,ALET                                                     
         USING CONHDRD,R2                                                       
         LA    R3,CONHDRD+CONHDRLN                                              
         CPYA  AR3,AR2                                                          
         USING CONDTAD,R3                                                       
*                                                                               
         MVC   WORK2(2),DBACTRMK                                                
         BRAS  RE,SETOOH           TEST & SET WORK2 IF OOH SOURCES              
*                                                                               
         LA    R4,3                                                             
         XR    R5,R5                                                            
         ICM   R5,7,CONAET                                                      
         CR    R3,R5                                                            
         JE    *+12                                                             
         MVI   DEMOFLAG,0                                                       
         J     TSTMKT12                                                         
*                                                                               
         REAR  ARS=OFF                                                          
         J     TSTMKT18                                                         
*                                                                               
TSTMKT12 CLI   CONINDIC,0          PROCESS VALID MARKET LIST                    
         JNE   TSTMKT14                                                         
         OI    DEMOFLAG,X'80'                                                   
*!!!     CLC   DBACTRMK,CONMRKT                                                 
         CLC   WORK2(2),CONMRKT                                                 
         JNE   *+8                                                              
         OI    DEMOFLAG,X'40'                                                   
         J     TSTMKT16                                                         
*                                                                               
*        COMMENT BACK IN FOR INDIV CABLE STATION LOCK OUTS                      
*        CLC   DBINTFIL(2),=C'PC'                                               
*        JNE   *+10                                                             
*        CLC   CONMRKT,=Y(CBLMKT)  ALL CABLE VALID?                             
*        JNE   *+14                                                             
*        OI    DEMOFLAG,X'40'                                                   
*        MVC   DBACTRMK,=Y(CBLMKT) SET TO MKT 300= ALL REGULAR CABLE            
*        J     TSTMKT16                                                         
*                                                                               
TSTMKT14 CLI   CONINDIC,X'FF'      PROCESS INVALID MARKET LIST                  
         JNE   TSTMKT16                                                         
         OI    DEMOFLAG,X'20'                                                   
         CLC   DBACTRMK,CONMRKT                                                 
         JNE   *+8                                                              
         OI    DEMOFLAG,X'10'                                                   
         J     TSTMKT16                                                         
*                                                                               
*        COMMENT BACK IN FOR INDIV CABLE STATION LOCK OUTS                      
*        CLC   DBINTFIL(2),=C'PC'                                               
*        JNE   *+10                                                             
*        CLC   CONMRKT,=Y(CBLMKT)                                               
*        JNE   *+14                                                             
*        OI    DEMOFLAG,X'10'      ALL CABLE INVALID                            
*        MVC   DBACTRMK,=Y(CBLMKT) SET TO MKT 300= ALL REGULAR CABLE            
*                                                                               
TSTMKT16 BXLE  R3,R4,TSTMKT12                                                   
         REAR  ARS=OFF                                                          
*                                                                               
         TM    DEMOFLAG,X'C0'      TEST MARKET NUMBERS VALID                    
         JM    TSTMKT20                                                         
         TM    DEMOFLAG,X'30'                                                   
         JO    TSTMKT20                                                         
*                                                                               
TSTMKT18 BRAS  RE,TSTOACS          TEST OFFICE ACCESS                           
         J     TSTMKTX                                                          
*                                                                               
TSTMKT20 MVI   DBERROR,INVMRKT                                                  
*                                                                               
TSTMKTX  CLI   DBERROR,0           SET CONDITION CODE FOR CALLER                
         J     XIT                                                              
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP  RB,R3,R2                                                         
         DROP  R7                                                               
*                                                                               
UNCONDITIONAL_LM_KEEP_#_YRS EQU 5  # OF YRS TO KEEP LOCAL MONTHLIES             
CONDITIONAL_LM_KEEP_#_YRS   EQU 8  SAME, BUT CONSIDERING OLYMPICS               
*                                                                               
TMR_WRKD DSECT ,                   LOCAL W/S                                    
TMR_DUB  DS    D                                                                
TMR_DMCB DS    8F                  LOCAL DMCB                                   
TMR_KEY  DS    XL(FQABOOKQ)        BINSRCH TABLE KEY                            
TMR_DLQ  EQU   *-TMR_WRKD          W/S LENGTH                                   
*                                                                               
DEGET    RSECT                                                                  
*                                                                               
*                                                                               
* SET WORK2 TO CORRECT MARKET # FOR DCON LOOKUP IF OOH/OOHC SOURCES             
*                                                                               
SETOOH   NTR1  BASE=*,LABEL=*                                                   
         ICM   R5,15,DBEXTEND                                                   
         USING DBXLIVD,R5                                                       
SOOH10   BZ    SETOOHX                                                          
         CLC   DBXLIVID,=C'NLIV'                                                
         BE    *+12                                                             
         ICM   R5,15,DBXLIVNX                                                   
         B     SOOH10                                                           
*                                                                               
         CLI   DBXLIVE,DBXLOLQ                                                  
         JE    SOOH20                                                           
         CLI   DBXLIVE,DBXLOSQ                                                  
         JE    SOOH20                                                           
         CLI   DBXLIVE,DBXLO3Q                                                  
         JE    SOOH20                                                           
         CLI   DBXLIVE,DBXLO7Q                                                  
         JE    SOOH20                                                           
         CLI   DBXLIVE,DBXLOCLQ                                                 
         JE    SOOH20                                                           
         CLI   DBXLIVE,DBXLOCSQ                                                 
         JE    SOOH20                                                           
         CLI   DBXLIVE,DBXLOC3Q                                                 
         JE    SOOH20                                                           
         CLI   DBXLIVE,DBXLOC7Q                                                 
         JNE   SETOOHX                                                          
*                                                                               
SOOH20   MVC   WORK2(2),=Y(OOHNMKT)                                             
         CLI   DBSELSTA+4,C'C'     CABLE?                                       
         JNE   SETOOHX                                                          
         MVC   WORK2(2),=Y(OOHCMKT)                                             
*                                                                               
SETOOHX  J     XIT                                                              
         LTORG                                                                  
         TITLE 'GTNLBK - GET LATEST BOOK FOR NETWORK'                           
***********************************************************************         
* GTNLBK - GET LATEST BOOK FOR NETWORK/DBSELSRC IN DUB(2)             *         
***********************************************************************         
         SPACE 1                                                                
GTNLBK   NTR1  BASE=*,LABEL=*                                                   
         XC    DBKEY,DBKEY                                                      
         XC    DUB(2),DUB          INIT LATEST BOOK TO 0                        
*                                                                               
         LA    R2,DBKEY                                                         
         USING PRKEY,R2                                                         
         MVI   PRCODE,PRCODEQU                                                  
         MVI   PRMEDIA,C'N'                                                     
         TM    SPNETFLG,SPCBLQ                                                  
         BNO   *+8                                                              
         MVI   PRMEDIA,C'C'                                                     
         MVI   PRSRC,C'N'                                                       
         MVC   PRBOOK,=AL2(JAN_97) START SEARCH FROM '97                        
         MVC   PRSTAT(4),=C'UUUU'                                               
         MVC   PRSTAT+4(1),DBSELSRC                                             
*                                                                               
GTNL02   MVI   IOFLAG,DIR+HIGH+NTI                                              
*                                                                               
GTNL04   GOTO1 AIO,IOFLAG                                                       
         JL    GETX                ERRORS                                       
         CLC   PRKEY(PRBOOK-PRKEY),KEYSAVE  FOUND STATION?                      
         JNE   GTNL06                                                           
         XR    R1,R1                                                            
         MVC   DUB(2),PRBOOK       SAVE LATEST BOOK                             
         ICM   R1,3,PRBOOK                                                      
         LA    R1,1(R1)            NEXT BOOK TO READ FOR                        
         STCM  R1,3,PRBOOK         BUMP YEAR                                    
         XC    PRSTYP(14),PRSTYP                                                
         J     GTNL02              READ AGAIN                                   
*                                                                               
GTNL06   J     XIT                 DUB(2) HAS LATEST BOOK                       
*                                                                               
         LTORG                                                                  
         TITLE 'BLDNET - BUILD SPOT RECORDS FOR NETWORK'                        
***********************************************************************         
* BLDNET - BUILD SPOT RECDS FOR NETWORK IN DBAREC                     *         
* NTRY: DUB(1)   - KEY CODE TO BUILD                                  *         
*       DBKEY    - PASSIVE NETWORK RECD KEY                           *         
***********************************************************************         
         SPACE 1                                                                
BLDNET   NTR1  BASE=*,LABEL=*                                                   
         L     RF,DBAREC                                                        
         XC    0(L'DBKEY,RF),0(RF)                                              
         LA    R2,DBKEY            PASSIVE KEY                                  
         USING PRKEY,R2                                                         
*                                                                               
         CLI   DUB,C'S'            BUILD STATN RECD: SBKEY                      
         JNE   BLDN02                                                           
         USING SBKEY,RF                                                         
         MVI   SBCODE,SBCODEQU                                                  
         MVC   SBMEDIA,PRMEDIA                                                  
         MVC   SBSRC,PRSRC         <- ?  NHT=H??                                
         TM    SPNETFLG,SPCBLQ                                                  
         BNO   *+12                                                             
         MVI   SBMEDIA,C'N'                                                     
         MVI   SBSRC,C'C'                                                       
         MVC   SBRMKT,NETMKT       RTG SVC MKT# FROM PASSIVE KEY                
         MVC   SBBOOK,PRBOOK                                                    
         MVC   SBSTYP,PRSTYP                                                    
         MVC   SBBTYP,PRBTYP                                                    
         MVC   SBSTAT(5),PRSTAT                                                 
         J     BLDNETX                                                          
         DROP  RF                                                               
*                                                                               
BLDN02   CLI   DUB,C'B'            BUILD STATN RECD: BSKEY                      
         JNE   BLDN04                                                           
         USING BSKEY,RF                                                         
         MVI   BSCODE,BSCODEQU                                                  
         MVI   BSIND,BSINDEQU                                                   
         MVC   BSMEDIA,PRMEDIA                                                  
         MVC   BSSRC,PRSRC        <- ? SHOULD THIS GET 'H' FOR NHTI ?           
         TM    SPNETFLG,SPCBLQ                                                  
         BNO   *+12                                                             
         MVI   BSMEDIA,C'N'                                                     
         MVI   BSSRC,C'C'                                                       
         MVC   BSBOOK,PRBOOK                                                    
         MVC   BSRMKT,NETMKT       MKT # IN PASSIVE KEY                         
         MVC   BSSTYP,PRSTYP                                                    
         MVC   BSBTYP,PRBTYP                                                    
         MVC   BSSTAT(5),PRSTAT                                                 
         DROP  RF                                                               
*                                                                               
BLDN04   CLI   DUB,C'M'            BUILD MARKET LIST RECD: MLKEY                
         JNE   BLDN06                                                           
         USING MLKEY,RF                                                         
         MVI   MLCODE,MLCODEQU                                                  
         MVI   MLMEDIA,C'N'                                                     
         MVC   MLSRC,DBSELSRC                                                   
         MVC   MLSTAT,PRSTAT                                                    
         TM    SPNETFLG,SPCBLQ                                                  
         BNO   *+14                                                             
         MVI   MLSRC,C'C'                                                       
         MVC   MLSTAT,DBACTSTA     SET ALPHA CALL LETTERS                       
         MVC   MLBOOK,PRBOOK                                                    
         MVI   MLIND,MLINDEQU                                                   
         MVC   MLRMKT,NETMKT                                                    
         MVC   MLBTYP,PRBTYP                                                    
         DROP  RF                                                               
*                                                                               
BLDN06   DS    0H                                                               
*                                                                               
BLDNETX  J     XIT                                                              
         DROP  R2                                                               
*                                                                               
         LTORG                                                                  
         TITLE 'FIXSTA - FIX REUSED STAION CALL LETTERS'                        
***********************************************************************         
* FIX STATIONS WHICH HAVE REUSED CALL LETTERS TO CORRECT CALL LETTERS           
***********************************************************************         
         SPACE 1                                                                
FIXSTA   NTR1  BASE=*,LABEL=*                                                   
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         L     RF,=A(DBLSTAB)      CHECK FOR DOUBLE STATION                     
         A     RF,RELO                                                          
         CLI   0(RF),X'FF'         NOTHING IN TABLE                             
         JE    FIXSTAX                                                          
FXSTA02  CLC   DBSELSTA(4),0(RF)                                                
         JE    FXSTA04                                                          
         LA    RF,L'DBLSTAB(RF)                                                 
         CLI   0(RF),X'FF'         NOT IN TABLE                                 
         JE    FIXSTAX                                                          
         J     FXSTA02                                                          
*                                                                               
FXSTA04  LA    RE,DBSELBK          NEED A BOOK                                  
         CLI   0(RE),0                                                          
         JNE   *+8                                                              
         LA    RE,DBSELDAT                                                      
         CLI   0(RE),0             STILL NO BOOK                                
         JE    FIXSTAX              GIVE UP                                     
         CLC   0(2,RE),4(RF)       SWAP IF NOT AFTER CHANGE                     
         JNL   FIXSTAX                                                          
*                                                                               
         CLC   DBSELSTA(4),=C'WBKI' STATION HAS TRIPLE CALL LETTER              
         BNE   FXSTA06               CHANGE INVOLVED                            
         CLC   DBSELBK,=AL2(NOV_99)  ON APPLY IN THE RANGE                      
         BL    FIXSTAX                                                          
*                                                                               
FXSTA06  MVC   DBSELSTA(4),6(RF)                                                
*                                                                               
FIXSTAX  J     XIT                                                              
*                                                                               
         LTORG                                                                  
         TITLE 'BUILD TABLE OF DAYS AND QUARTER HOURS'                          
***********************************************************************         
* BUILD A TABLE OF DAYS & QUARTER HOURS AT DBDQTAB FOR DEMO LOOK-UPS. *         
*                                                                     *         
* NTRY: R1  = DQINDIC VALUE FOR DQTAB TABLE SEARCH                    *         
* EXIT: CC  = NEQ WITH DBERROR SET ON ERROR.                          *         
*       CC  = NEQ WITH DBDQTAB CONTAINING UP TO 8 ENTRIES DELIMITED BY*         
*             X'FF'. SEE DBDQD FOR TABLE DESCRIPTION.                 *         
***********************************************************************         
         SPACE 1                                                                
GETDQ    NTR1  BASE=*,LABEL=*,WORK=(R7,1)                                       
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         STC   R1,WORK                                                          
         STC   R1,0(R7)                                                         
* FOR CANADA IF POSTING NEW METHODOLOGY ?                                       
* DISABLE LEADIN AND LEADOUT TIME FOR NEW POSTING METHODLOGY                    
*                                                                               
***      CLI   DBNPMFLG,DBNPMAFF                                                
***      BE    *+8                                                              
         CLI   DBNPMFLG,DBNPMACH                                                
         BNE   GETDQ01                                                          
         GOTO1 ADJTIME                                                          
**                                                                              
GETDQ01  MVI   DBSELXQH,0          SET EXTRA QHR LOOK-UP INACTIVE               
*                                                                               
         DS    0H                  DETERMINE QH ADJUSTMENT FACTOR               
         SR    R0,R0                INITIALIZE ADJUSTMENT FACTOR                
         CLI   DBINTMED,C'T'        FOR MEDIA=USTV,                             
         BNE   GDQAFTN                                                          
         CLI   DBACTSRC,C'V'         SOURCE=VID,                                
         BE    *+8                                                              
         CLI   DBACTSRC,C'N'         SOURCE=NSI,                                
         BNE   GDQAFTN                                                          
         CLC   DBFILE,=C'TP '        FILE=TIME PERIOD,                          
         BNE   GDQAFTN                                                          
*                                                                               
         CLI   0(R7),2               IF INDICATOR IS 2,                         
         BNE   *+8                                                              
         LHI   R0,4                   SHIFT QHS BY FOUR                         
GDQAFTN  EQU   *                                                                
         STH   R0,2(R7)            STORE IT IN WORK AREA +2                     
*                                                                               
         ICM   RE,15,ADTLIST       CHECK FOR DAY/TIME LIST                      
         JZ    GETDQ02             OUT IF NOT THERE                             
*                                                                               
         USING DBXTLD,RE                                                        
         XR    RF,RF                                                            
         IC    RF,DBXTLIDX         GET LIST INDEX                               
         MHI   RF,5                                                             
         AR    RE,RF                                                            
         MVC   DBSELTIM(4),DBXTLIST+1 SET DAY AND TIME FROM LIST                
         MVC   DBSELDAY,DBXTLIST      **************************                
         DROP  RE                                                               
*                                                                               
GETDQ02  CLC   DBFILE,=C'RLD'      MINUTE BY MINUTE DON'T NEED DQTAB            
         BE    GETDQX                                                           
*                                                                               
         OC    DBSELTIM,DBSELTIM   SET DEFAULT TIMES (ALL)                      
         JNZ   GETDQ04                                                          
         MVC   DBSELTIM,=AL2(0600,2600)                                         
         CLC   DBFILE,=C'IUN'             FOR IUN FILE,                         
         JNE   *+10                                                             
         MVC   DBSELTIM+2(2),=AL2(2945)    SET END TIME TO 545A                 
         J     GETDQ08                                                          
*                                  HANDLE EXTRA QHR LOOKUP (PEPSI)              
GETDQ04  CLI   DBXQHR,C'Y'         TEST EXTRA QHR LOOKUP REQUIRED               
         JNE   GETDQ08                                                          
         LA    RE,DBSELTIM                                                      
         CLC   0(2,RE),2(RE)       TEST START TIME EQ END TIME                  
         JE    GETDQ08                                                          
         CLC   2(2,RE),=XL2'00'    TEST BREAK TIME GIVEN                        
         JE    GETDQ08             YES - IGNORE XQH LOGIC                       
         LA    RF,2                                                             
*                                                                               
GETDQ06  XR    R1,R1               TEST TIMES MODULO HALF HOUR                  
         ICM   R1,3,0(RE)                                                       
         XR    R0,R0                                                            
         D     R0,=F'100'          R0=MINS,R1=HOURS                             
         LTR   R0,R0               REMAINDER MUST BE ZERO OR THIRTY             
         JZ    *+12                                                             
         CH    R0,MINS2QH                                                       
         JNE   GETDQ08                                                          
         LA    RE,2(RE)                                                         
         BRCT  RF,GETDQ06                                                       
*                                                                               
         GOTO1 GETQTRHR,DBSELTIM                                                
         SH    R1,=H'1'            DECREMENT START QHR BY ONE                   
         JP    *+8                                                              
         LA    R1,1                                                             
         STC   R1,DBACTSQH                                                      
*                                                                               
         GOTO1 GETQTRHR,DBSELTIM+2                                              
         STC   R1,DBACTEQH                                                      
         MVI   DBSELXQH,C'Y'       SET EXTRA QHR LOOK-UP ACTIVE                 
         J     GETDQ18                                                          
*                                  CONVERT TIMES TO QUARTER HOURS               
GETDQ08  DS    0C                                                               
         GOTO1 GETQTRHR,DBSELTIM                                                
         STC   R1,DBACTSQH                                                      
         STC   R1,DBACTEQH                                                      
**       CLI   DBNWKFLG,DBNWKACH   NEW CANADIAN NATIONAL ACHIEVE                
**       BE    GETDQ18             POSTING METHODLOGY ACHIEVED  DONT            
         OC    DBSELTIM+2(2),DBSELTIM+2  TEST FOR BREAK TIME                    
         JNZ   GETDQ12                                                          
         CLI   DBSELMED,C'R'       DISABLE BREAKS FOR RADIO                     
         BE    GETDQ18                                                          
* ONLY DO THIS IF YOU WANT TO DISABLE 2 MIN RULE AND POST                       
* ONLY THE QTR HOUR THE SPOT RAN IN.                                            
*****    CLI   DBNPMFLG,DBNPMAFF                                                
*****    BE    GETDQ16                                                          
         TM    DBNPMFLG,DBNOBAVG                                                
         BO    GETDQ16                                                          
* TIMES WITHIN 2 MINUTES OF QUARTER HOURS RECEIVE SPECIAL HANDLING              
*              7:48 - 7:57 LOOKS UP 7:45 ONLY                                   
*              7:58 - 8:02 LOOKS UP 7:45 AND 8:00                               
*              8:03 - 8:12 LOOKS UP 8:00 ONLY                                   
*                                                                               
         XR    RE,RE                                                            
         ICM   RE,3,DBSELTIM       GET BREAK TIME                               
         SRDL  RE,32                                                            
         D     RE,=F'100'          GIVES MINUTES IN RE                          
         SRDA  RE,32                                                            
         D     RE,=F'15'           REMAINDER TO 15 IS IN RE                     
         CH    RE,=H'2'            TEST MORE THAN 2 MIN AFTER QH                
         JH    GETDQ10             NO                                           
         SH    R1,=H'1'            DECREMENT START QH                           
         JP    *+8                                                              
         LA    R1,1                MIN START QH IS 1                            
         STC   R1,DBACTSQH                                                      
         J     GETDQ18                                                          
*                                                                               
GETDQ10  CH    RE,=H'13'           TEST MORE THAN 2 MIN BEFORE QH               
         JL    GETDQ18             NO                                           
         AH    R1,=H'1'            INCREMENT END QH                             
         STC   R1,DBACTEQH                                                      
         J     GETDQ18                                                          
*                                                                               
GETDQ12  GOTO1 GETQTRHR,DBSELTIM+2 CHECK FOR END OF DAY                         
*                                                                               
         MVI   DUB+2,0             RESET THE 7 MINUTE OPTIONS                   
**       CLI   DBNWKFLG,DBNWKACH   NEW CANADIAN NATIONAL ACHIEVE                
**       BE    GETDQ14             POSTING METHODLOGY ACHIEVED  DONT            
         TM    DBC7MIN,DBOS7MIN+DBOE7MIN                                        
         JZ    GETDQ14                                                          
         STC   R1,DBACTEQH         SAVE R1 FOR FUTURE                           
         LR    RE,R1               MAKE SURE DURATION IS OK                     
         XR    RF,RF                                                            
         IC    RF,DBACTSQH                                                      
         SR    RE,RF                                                            
         CH    RE,=H'2'            ONLY IF CROSSING QTR HRS                     
         JL    GETDQ14                                                          
         MVC   DUB+2(1),DBC7MIN    SET THE OPTIONS                              
         TM    DUB+2,DBOS7MIN      CHECK IF APPLIES TO START                    
         JZ    GETDQ14                                                          
         ICM   R1,3,DBSELTIM       YES - MAKE SURE THERE IS ENOUGH              
         LA    R1,7(R1)                                                         
         STH   R1,DUB                                                           
         GOTO1 GETQTRHR,DUB                                                     
         STC   R1,DBACTSQH         RESET START QH                               
         ICM   R1,1,DBACTEQH       RESTORE END QH                               
*                                                                               
GETDQ14  CH    R1,=H'96'           ACCEPT END OF DAY AS IS                      
         JE    GETDQ16                                                          
         ICM   R1,3,DBSELTIM+2     ROUND UP TO NEXT QTR HOUR                    
*                                                                               
         LA    R1,7(R1)            7 MIN FOR SURE                               
         TM    DUB+2,DBOE7MIN      DONE IF 7 MIN OPTION ON                      
         JO    *+8                                                              
         LA    R1,7(R1)            ANOTHER 7 NORMALLY                           
         STCM  R1,3,DUB                                                         
         GOTO1 GETQTRHR,DUB                                                     
         CLM   R1,1,DBACTSQH       TEST END QHR GR START QHR                    
         JE    *+6                                                              
         BCTR  R1,0                YES - DECREMENT END QHR BY ONE               
*                                                                               
GETDQ16  STC   R1,DBACTEQH                                                      
         CLC   DBACTSQH,DBACTEQH   TEST END QHR GR START QHR                    
         BNH   GETDQ18                                                          
                                                                                
         DS    0H                  WHEN SQH > EQH,                              
         CLI   DBINTMED,C'O'        AND MEDIA IS  OVERNIGHTS TP                 
         BE    *+8                                                              
         CLI   DBINTMED,C'W'        AND MEDIA IS  WEEKLY TP                     
         BE    *+8                                                              
         CLI   DBINTMED,C'T'        AND MEDIA IS USTV,                          
         BNE   GETDQM                                                           
         CLI   DBACTSRC,C'V'        AND SOURCE IS VID,                          
         BE    *+8                                                              
         CLI   DBACTSRC,C'N'        AND SOURCE IS NSI,                          
         BNE   GETDQM                                                           
         MVI   DBACTEQH,96          FORCE EQH TO HIGHEST POSSIBLE VALUE         
         B     GETDQ18               AND MOVE ON                                
GETDQM   EQU   *                                                                
                                                                                
         MVI   DBACTSQH,1          YES - SET START TO ONE                       
*                                                                               
GETDQ18  BRAS  RE,TIMCHG           ADJUST FOR TIME CHANGE MARKETS               
         LA    R2,DUB              BUILD KEY FOR DQTAB LOOK-UP                  
         USING DQHDRD,R2           R2=A(KEY)                                    
         MVC   DQSRC,DBACTSRC                                                   
         CLI   DQSRC,C'H'          FOR IHEART                                   
         BE    *+8                                                              
         CLI   DQSRC,C'T'          FOR TRITON,                                  
         BNE   *+8                                                              
         MVI   DQSRC,C'A'          USE ARBITRON DAY/TIME TABLES                 
*                                                                               
**       CLI   DQSRC,C'V'          FVIDEOLOGY USE NSI TABLES FOR NOW            
**       BNE   *+8                                                              
**       MVI   DQSRC,C'N'          USE ARBITRON DAY/TIME TABLES                 
         MVC   DQMED,DBINTMED                                                   
         MVC   DQFILE,DBINTFIL                                                  
         CLC   =C'TCA',DQFILE                                                   
         BNE   *+8                                                              
         CLI   DBBTYPE,C'W'                                                     
         BNE   *+8                                                              
         MVI   DQMED,C'W'                                                       
         MVC   DQINDIC,WORK                                                     
         NI    DQINDIC,X'7F'       TURN OFF ROTATOR FLAG                        
*                                  FIND SOURCE/MEDIA/TYPE IN DQTAB              
         L     R2,ADQTAB           R2=A(DQTAB)                                  
GETDQ20  CLC   =X'0000',DQHDRD     TEST E-O-T                                   
         JNE   *+12                                                             
         MVI   DBERROR,NODQTAB                                                  
         J     GETDQX                                                           
*                                                                               
         CLC   DQHDRD(DQLT-DQHDRD),DUB                                          
         JE    GETDQ22                                                          
         XR    R1,R1               BUMP TO NEXT TABLE ENTRY                     
         ICM   R1,3,DQLT                                                        
         LA    R2,1(R1,R2)                                                      
         J     GETDQ20                                                          
*                                                                               
GETDQ22  LA    R2,DQHDRLN(R2)                                                   
         ST    R2,ADQNTRY          SAVE A(FIRST DATA ENTRY)                     
*                                                                               
         DS    0H                                                               
         SHI   R2,DQHDRLN          BUMP POINTER BACK TO TABLE HEADER            
*                                                                               
         MVC   DBACTDAY,DBSELDAY                                                
         CLI   DBACTDAY,0          SET DEFAULT DAY                              
         JNE   *+8                                                              
         MVI   DBACTDAY,X'7F'                                                   
         CLI   DBACTDAY,X'FF'      SPECIAL FOR ALL DAYS                         
         JNE   *+8                                                              
         MVI   DBACTDAY,X'80'                                                   
         CLI   DBINTMED,C'T'        AND MEDIA IS USTV,                          
         BNE   *+16                                                             
         TM    DBACTDAY,X'90'      VAR & AVG-N (EG. AVG4)                       
         JNO   *+8                                                              
         NI    DBACTDAY,X'90'       REMOVE LOWER NIBBLE                         
*                                  DEAL WITH ROTATORS (M-F, M-S)                
         TM    WORK,X'80'          TEST FOR ROTATORS & SPECIALS                 
         JZ    GETDQ23X                                                         
         MVC   WORK(1),DBACTDAY    YES - DON'T EXPLODE DAY                      
         MVI   WORK+1,EOT                                                       
         J     GETDQ26                                                          
*                                                                               
GETDQ23X DS    0H                  CHECK FOR VAR AND AVG-N                      
         TM    DBACTDAY,X'90'                                                   
         BNO   GETDQ24X                                                         
         CLC   =C'PTN',DQFILE       FOR PAV/USTV/NSI,                           
         BNE   GETDQ24X                                                         
         MVC   WORK+0(1),DBACTDAY                                               
         MVI   WORK+1,X'80'          TACK ON THIS SPECIAL DAY CODE              
         MVI   WORK+2,EOT                                                       
         J     GETDQ26                                                          
*                                  EXPLODE DAY INTO 7 BYTES IN WORK             
GETDQ24X DS    0H                                                               
         MVC   WORK(1),DBACTDAY                                                 
         MVC   WORK+1(6),WORK                                                   
         NC    WORK(8),=X'4020100804020100'                                     
         MVI   WORK+7,EOT          SET EOT MARKER-DO NOT TAKE OUT               
*                                  WORK NOW CONTAINS 1 BYTE PER DAY             
*                                  TO BE LOOKED-UP IN DQTAB.                    
GETDQ26  LA    R1,WORK             R1=A(DAY CODE)                               
         XC    DUB,DUB                                                          
         LA    R3,DBDQTAB                                                       
                                                                                
         DS    0H                   DAY/QH ENTRIES LOCATED ELSEWHERE?           
         CLC   =AL2(DBDQUXTD),DBDQTAB+0 IF INSTRUCTED TO USE XTND AREA,         
         BNE   GETDQ26M                                                         
         LA    RF,DBEXTEND-4                                                    
GETDQ26G DS    0H                        LOOK THROUGH DBEXTEND                  
         ICM   RF,15,4(RF)                                                      
         BZ    GETDQ26M                                                         
         CLC   0(4,RF),DBDQTAB+2         FOR NAME GIVEN HERE                    
         BNE   GETDQ26G                                                         
         USING DBDQXTND,RF                                                      
         MVC   DBDQADJF,2(R7)        LET CALLER KNOW OF ADJ FACTOR              
         LA    R3,DBDQXFXL(RF)                                                  
         DROP  RF                                                               
GETDQ26M EQU   *                                                                
                                                                                
DBDQ     USING DBDQD,R3            R3=A(DBDQTAB ENTRY)                          
*                                  BUILD DQTAB LOOK-UP KEY AT DUB(4)            
GETDQ28  XC    0(4,R3),0(R3)                                                    
         L     R2,ADQNTRY          R2=A(FIRST DQTAB ENTRY)                      
         CLI   0(R1),EOT           TEST E-O-T                                   
         BNE   GETDQ30                                                          
         MVC   DUB(4),DUB+4        YES - SET KEY FROM DUB+4                     
         J     GETDQ34                                                          
*                                  BUILD KEY                                    
GETDQ30  MVC   DUB(1),0(R1)        DUB+0(1)=DAY CODE (X'40' THRU X'01')         
         MVC   DUB+1(2),DBACTSQH   DUB+1(2)=START & END QTR HOURS               
         MVI   DUB+3,1             DUB+3(1)=WEIGHTING FACTOR                    
*                                                                               
GETDQ31  DS    0H                                                               
         TM    0(R7),X'80'         UNEXPLODED DAY FLAG                          
         JZ    GETDQ34                                                          
         XR    RF,RF                                                            
         IC    RF,DBACTDAY         MUST COUNT BITS HERE                         
         XR    RE,RE                                                            
         XR    R0,R0                                                            
         SLL   RF,25               LOW 7 BITS ONLY                              
*                                                                               
GETDQ32  SLDL  RE,1                SLIDE 1 BIT                                  
         AR    R0,RE               SUM THE ACTIVES                              
         SR    RE,RE                                                            
         LTR   RF,RF               ANY MORE                                     
         JNZ   GETDQ32             YES CONTINE                                  
         STC   R0,DUB+3            NO - SAVE DAY COUNT                          
*                                                                               
         USING DQDTAD,R2                                                        
GETDQ34  CLI   DUB,0               TEST IF DAY CODE PRESENT                     
         JE    GETDQ46                                                          
*                                  FIND DQTAB ENTRY FOR DAY                     
GETDQ36  CLI   DQDAY,0                                                          
         JE    GETDQ46                                                          
         CLC   DQDAY,DUB                                                        
         JE    *+12                                                             
         LA    R2,DQDTALN(R2)                                                   
         J     GETDQ36                                                          
*                                                                               
         XC    WORK+8(2),WORK+8                                                 
         MVC   WORK+10(2),DUB+1                                                 
         CLC   DUB+2(1),DQSQH      TEST SELECTED SQH LE AVAILABLE START         
         JL    GETDQ40                                                          
         CLC   DUB+1(1),DQEQH      TEST SELECTED EQH GR AVAILABLE START         
         JH    GETDQ40                                                          
         MVC   WORK+8(2),DUB+1                                                  
         XC    WORK+10(2),WORK+10                                               
         CLC   DUB+1(1),DQSQH      TEST SELECTED WITHIN AVAILABLE               
         JL    GETDQ38                                                          
         CLC   DUB+2(1),DQEQH                                                   
         JNH   GETDQ40                                                          
*                                  SELECTED OVERLAPS AVAILABLE END              
         MVC   WORK+8(1),DUB+1                                                  
         MVC   WORK+9(1),DQEQH                                                  
         XR    RF,RF                                                            
         IC    RF,DQEQH                                                         
         LA    RF,1(RF)                                                         
         STC   RF,WORK+10                                                       
         MVC   WORK+11(1),DUB+2                                                 
         J     GETDQ40                                                          
*                                  SELECTED OVERLAPS AVAILABLE START            
GETDQ38  MVC   WORK+8(1),DQSQH                                                  
         MVC   WORK+9(1),DUB+2                                                  
         MVC   WORK+10(1),DUB+1                                                 
         XR    RF,RF                                                            
         IC    RF,DQSQH                                                         
         BCTR  RF,0                                                             
         STC   RF,WORK+11                                                       
*                                  BUILD DBDQTAB ENTRY                          
GETDQ40  OC    WORK+8(2),WORK+8                                                 
         JZ    GETDQ42                                                          
         MVC   DBDQ.DBDQKDAY,DQKDAY                                             
         XR    R0,R0                                                            
         IC    R0,WORK+8           CONVERT ST AND END QH                        
         BCTR  R0,0                BACK TO ZERO BASE                            
         SH    R0,2(R7)            UN-SHIFT QH                                  
         BNM   *+8                                                              
         AHI   R0,96                                                            
         STC   R0,DBDQ.DBDQSQH                                                  
         XR    R0,R0                                                            
         IC    R0,WORK+9                                                        
         BCTR  R0,0                                                             
         SH    R0,2(R7)            UN-SHIFT QH                                  
         BNM   *+8                                                              
         AHI   R0,96                                                            
         STC   R0,DBDQ.DBDQEQH                                                  
         MVC   DBDQ.DBDQDAYW,DUB+3                                              
         LA    R3,DBDQLEN(R3)                                                   
         DROP  DBDQ                                                             
*                                  BUILD REMAINDER ENTRY AT DUB+4               
GETDQ42  OC    WORK+10(2),WORK+10                                               
         JZ    GETDQ46                                                          
         CLI   DQDDAY,0            TEST IF DEFAULT PRESENT                      
         JE    GETDQ46                                                          
         CLC   DQDDAY,DQDAY         YES, DEFAULT DAY CODE = DAY CODE?           
         JE    GETDQ45               YES, QHS ARE SEGMENTED                     
         OC    DUB+4(4),DUB+4        NO, TEST IF ENTRY BUILT                    
         JNZ   GETDQ44                                                          
         MVC   DUB+4(1),DQDDAY                                                  
         MVC   DUB+5(2),WORK+10                                                 
*                                                                               
GETDQ44  XR    RF,RF                                                            
         IC    RF,DUB+L'DUB-1      BUMP DAY WEIGHTING FACTOR                    
         LA    RF,1(RF)                                                         
         STC   RF,DUB+L'DUB-1                                                   
         J     GETDQ46                                                          
*                                                                               
GETDQ45  DS    0H                  DEFAULT DAY CODE  =  DAY CODE                
         XC    0(4,R3),0(R3)        CONTINUE TO BREAK OUT                       
         MVC   DUB+0(1),DQDDAY      QUARTER HOURS UNDER THE SAME DAY            
         MVC   DUB+1(2),WORK+10                                                 
         MVI   DUB+3,1                                                          
         AHI   R2,DQDTALN                                                       
         J     GETDQ31                                                          
*                                                                               
GETDQ46  CLI   0(R1),EOT           TEST E-O-L                                   
         JE    *+12                                                             
         LA    R1,1(R1)            NO - BUMP LIST POINTER                       
         J     GETDQ28                                                          
         MVI   0(R3),EOT           SET END OF DBDQTAB                           
*                                                                               
GETDQX   CLI   DBERROR,0           SET CC=NEQ ON ERROR                          
         J     XIT                                                              
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* THIS SECTION IS FOR TIME CHANGE MARKETS                             *         
* SOME MARKETS DON'T GO ON DAYLIGHT SAVINGS TIME SO THE SUMMER        *         
* AND FALL TIMES NEED TO BE ADJUSTED TO THE TIMES THAT ARE ACTUALLY   *         
* ENTERED. IT IS DONE HERE TO ALLOW THE SYSTEM TO MAKE ANY OPTIONAL   *         
* CHANGES TO TIME BEFORE THE TIME CHANGE ADJUSTMENT TAKES PLACE.      *         
*                                                                     *         
* R1 IS DESTROYED BY THIS ROUTINE                                     *         
***********************************************************************         
         SPACE 1                                                                
TIMCHG   CLI   DBTIMCHG,0                                                       
         BER   RE                                                               
         CLI   DBTIMCHG,C'S'       GIVEN SUMMER TIMES                           
         JE    TIMCHG2             ADJUST FALL AND WINTER                       
*                                                                               
* GIVEN A FALL TIME -60 FOR MAY AND JUL                                         
*                                                                               
         CLI   DBTIMCHG,C'F'       MAKE SURE FLAG IS VALID                      
         BNER  RE                                                               
         CLI   DBACTBK+1,5         MAY BOOK - NEEDS ADJUSTMENT                  
         JE    *+10                                                             
         CLI   DBACTBK+1,7         JULY BOOK - NEEDS ADJUSTMENT                 
         BNER  RE                   OTHERS DONT                                 
*                                                                               
         CLI   DBACTSQH,4          BOUNDARY CONDITIONS                          
         JH    *+8                                                              
         MVI   DBACTSQH,5                                                       
         CLI   DBACTEQH,4                                                       
         JH    *+8                                                              
         MVI   DBACTEQH,5                                                       
*                                                                               
         XR    R1,R1                                                            
         IC    R1,DBACTSQH                                                      
         SH    R1,=H'4'                                                         
         STC   R1,DBACTSQH                                                      
         XR    R1,R1                                                            
         IC    R1,DBACTEQH                                                      
         SH    R1,=H'4'                                                         
         STC   R1,DBACTEQH                                                      
         BR    RE                                                               
*                                                                               
* GIVEN A SUMMER TIME +60 MIN FOR ALL EXCEPT MAY/JUL                            
*                                                                               
TIMCHG2  CLI   DBACTBK+1,5         MAY BOOK - DONT ADJUST                       
         BER   RE                                                               
         CLI   DBACTBK+1,7         JULY BOOK - DONT ADJUST                      
         BER   RE                                                               
*                                                                               
         CLI   DBACTSQH,93         BOUNDARY CONDITIONS                          
         BL    *+8                                                              
         MVI   DBACTSQH,92                                                      
         CLI   DBACTEQH,93                                                      
         BL    *+8                                                              
         MVI   DBACTEQH,92                                                      
*                                                                               
         XR    R1,R1                                                            
         IC    R1,DBACTSQH                                                      
         AH    R1,=H'4'                                                         
         STC   R1,DBACTSQH                                                      
         XR    R1,R1                                                            
         IC    R1,DBACTEQH                                                      
         AHI   R1,4                                                             
         STC   R1,DBACTEQH                                                      
         BR    RE                                                               
         EJECT                                                                  
***********************************************************************         
* CONVERT MILITARY TIME TO RELATIVE QUARTER HOUR                      *         
* NTRY: R1     = A(MILITARY TIME VALUE)                               *         
* EXIT: R1     = A(QUARTER HOUR)                                      *         
***********************************************************************         
         SPACE 1                                                                
GETQTRHR XR    R0,R0                                                            
         ICM   R0,3,0(R1)                                                       
         SRDL  R0,32               GET MILITARY TIME IN R1                      
         D     R0,=F'100'          R0=REMAINDER MINUTES                         
         MH    R1,MINS1HR          R1=HOURS*60                                  
         AR    R1,R0               R1=RELATIVE MINUTE                           
         LH    RF,MINS5HR          BASE = 5AM FOR RADIO                         
*                                                                               
         CLI   DBSELMED,C'R'                                                    
         JE    *+8                                                              
         LH    RF,MINS6HR          BASE = 6AM FOR ALL OTHERS                    
*                                                                               
         CR    R1,RF               TEST IF LESS THAN BASE                       
         JNL   *+8                                                              
         AH    R1,MINS1DY          YES - ADD 24 HOURS (IN MINUTES)              
         SR    R1,RF               SUBTRACT BASE HOURS                          
         SR    R0,R0                                                            
         SR    RF,RF                                                            
         ICM   RF,3,MINS1QH                                                     
         DR    R0,RF               DIVIDE BY 15 TO GET RELATIVE QTR HR          
         AH    R1,2(R7)            SHIFT USING ADJUSTMENT FACTOR                
         BNM   *+8                  IF NEGATIVE,                                
         AHI   R1,96                 MAKE IT POSITIVE                           
         CHI   R1,96                IF GREATER THAN MAX # QHS/DAY,              
         BL    *+8                                                              
         SHI   R1,96                 GET IT TO WITHIN BOUNDS                    
         LA    R1,1(R1)            MAKE QUARTER HOUR 1 BASED                    
         BR    RE                                                               
*                                                                               
MINS1QH  DC    AL2(60/4)                                                        
MINS2QH  DC    AL2(60/2)                                                        
MINS1HR  DC    AL2(60)                                                          
MINS5HR  DC    AL2(60*5)                                                        
MINS6HR  DC    AL2(60*6)                                                        
MINS1DY  DC    AL2(60*24)                                                       
         EJECT                                                                  
         LTORG                                                                  
         TITLE 'EQUATE CABLE NEEDS TO BOOKS ON FILE'                            
***********************************************************************         
* EQUATE CABLE WEEKS TO BOOKS ON THE FILE                                       
***********************************************************************         
         SPACE 1                                                                
CABLE    NTR1  BASE=*,LABEL=*                                                   
         CLI   DBBTYPE,C'U'        DON'T DO FOR USER RECDS                      
         JE    CABLEX                                                           
         CLI   DBSELSTA+4,C'S'     DON'T DO FOR SYNDICATION                     
         JE    CABLEX                                                           
*                                                                               
         OC    DBSELBK,DBSELBK                                                  
         JNZ   CABLE01                                                          
         MVC   DBSELBK,DBACTBK                                                  
*                                                                               
CABLE01  CLI   DBFUNCT,DBGETNTI    SOME CABLE ORIGINATORS                       
         JNE   CABLE02             HAVE NO PROGRAMS                             
         CLI   DBBTYPE,C'M'                                                     
         JE    CABLE01A                                                         
         CLI   DBBTYPE,C'N'                                                     
         JE    CABLE01A                                                         
         CLC   DBSELBK,=AL1(YR_1999,WEEK_36)                                    
         JNL   CABLE02             AUG30/99 FOWARD LKUP PROGRAMS                
         CLC   =C'MSNB',DBSELSTA                                                
         JE    *+10                                                             
         CLC   =C'HLN ',DBSELSTA                                                
         JE    *+10                                                             
         CLC   =C'PREV',DBSELSTA                                                
         JNE   *+8                                                              
         MVI   DBFUNCT,DBGETDEM    FORCE TO TP READ                             
         J     CABLE02                                                          
*                                                                               
CABLE01A BRAS  RE,CNADETP          FOR CNAD STATIONS WITH NO PROG DATA,         
*                                  LOOKUP TIME PERIOD DATA                      
*                                                                               
CABLE02  DS    0H                                                               
         CLC   DBSELBK,=AL1(YR_2004,WEEK_14)  BEFORE MAR29/04,                  
         JNL   *+20                                                             
         CLC   =C'NAN ',DBSELSTA   REPLACE 'NAN' BY 'NICK'                      
         JNE   *+10                                                             
         MVC   DBSELSTA(4),=C'NICK'                                             
*                                                                               
         CLC   DBSELBK,=AL1(YR_2005,WEEK_14)  BEFORE MAR28/05,                  
         JNL   *+20                                                             
         CLC   =C'ADSM',DBSELSTA   REPLACE 'ADSM' BY 'TOON'                     
         JNE   *+10                                                             
         MVC   DBSELSTA(4),=C'TOON'                                             
*                                                                               
         BRAS  RE,CABNUM           GET CABLE NUMBER - POST OCT/93               
         OC    DBSELBK,DBSELBK                                                  
         BZ    CABLEX                                                           
*                                                                               
CABLE04  CLI   DBSELSTA+4,C'C'     CHECK FOR CABLE STATION                      
         JE    CABLE06                                                          
         BRAS  RE,GETCBL                                                        
         LA    R1,CBLENTY                                                       
         CLI   6(R1),C'C'          IS IT A CABLE STATION                        
         JNE   CABLEX                                                           
         CLC   4(2,R1),=XL2'00'    NOT IN TABLE                                 
         JE    CABLEX                                                           
*                                                                               
CABLE06  CLI   DBSELBK+1,49        CABLE USES 52 WEEK CALENDAR                  
         JL    CABLE08             FOR THE FILE                                 
         CLI   DBSELBK,91          NOT TRUE NOW                                 
         JH    CABLE08                                                          
         ZIC   RE,DBSELBK+1                                                     
         SH    RE,=H'49'                                                        
         LA    RE,CBLWEEKS(RE)                                                  
         MVC   DBSELBK+1(1),0(RE)                                               
*                                                                               
CABLE08  CLC   DBSELBK,=AL1(YR_1993,WEEK_37)  QH ONLY BEFORE 93/09/29           
         JL    *+12                SO OVERRIDE THE Q                            
         CLI   DBSELSTA+4,C'Q'                                                  
         JE    CABLEX                                                           
         CLI   DBSELBK,89                                                       
         JL    *+8                                                              
         MVI   DBSELSTA+4,C'C'     MAKE IT EASY FOR APPLICATIONS                
*                                                                               
CABLEX   J     XIT                                                              
*                                                                               
CBLWEEKS DC    AL1(16,24,32,52,32)                                              
         LTORG                                                                  
         EJECT                                                                  
**********************************************************************          
* CHECK IF CABLE NAD STATION HAS ONLY TIME PERIOD DATA               *          
* IF SO, SWITCH TO TIME-PERIOD DATA                                  *          
**********************************************************************          
                                                                                
CNADETP  NTR1  BASE=*,LABEL=*                                                   
                                                                                
         CLI   DBFUNCT,DBGETDEM    ALREADY TP, DON'T NEED TO FORCE              
         BE    CNADTPX                                                          
                                                                                
         L     RF,DBCOMFCS         GET A(GEN MARKET ENGLISH ST TABLE)           
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,NADTPB                                                 
         ICM   RE,15,0(R1)         A(TABLE)                                     
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            LENGTH OF TABLE                              
                                                                                
         USING CNADTPTD,RE                                                      
CNADTP5  CLI   0(RE),X'FF'                                                      
         BE    CNADTPX                                                          
         CLC   CNADTNET,DBSELSTA                                                
         BNE   CNADTP10                                                         
         CLC   CNADTBK,=X'0000'    ANY END DATE FOR TP SHIFT?                   
         BE    CNADTP8             NO. ALWAYS FORCE TO TP                       
         CLC   DBSELBK,CNADTBK                                                  
         BNL   CNADTPX                                                          
CNADTP8  MVI   DBFUNCT,DBGETDEM    FORCE TO TP READ                             
         B     CNADTPX                                                          
CNADTP10 AR    RE,R0                                                            
         B     CNADTP5                                                          
                                                                                
CNADTPX  J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
****************************************************************                
* HANDLE NTI NETWORK NAME CHANGES: PAR->UPN, PAX->ION          *                
****************************************************************                
NAMECHG  NTR1  BASE=*,LABEL=NO                                                  
         CLI   DBFUNCT,DBGETOPI     DON'T SWITCH TO PAR FOR OPI                 
         BNE   PAR1                                                             
         CLC   DBSELSTA,=C'PAR T'   SPECIAL FOR UPN                             
         BNE   *+10                                                             
         MVC   DBSELSTA,=C'UPN T'                                               
         B     PARX                                                             
PAR1     CLC   DBSELSTA(4),=C'UPNP' SPECIAL FOR UPN                             
         BE    *+10                                                             
         CLC   DBSELSTA(4),=C'UPND' SPECIAL FOR UPN                             
         BE    *+10                                                             
         CLC   DBSELSTA(4),=C'UPN ' SPECIAL FOR UPN                             
         BNE   *+10                                                             
         MVC   DBSELSTA(3),=C'PAR'                                              
         CLC   DBSELBK,=AL1(YR_1998,WEEK_04)                                    
         BL    PARX                                                             
         CLC   DBSELSTA(5),=C'PAR H'                                            
         BNE   PARX                                                             
         MVC   DBSELSTA(5),=C'UPN H'                                            
PARX     DS    0C                                                               
*                                                                               
PAX1     CLC   DBSELSTA(4),=C'IONP' SPECIAL FOR ION                             
         BE    *+10                                                             
         CLC   DBSELSTA(4),=C'IOND'                                             
         BE    *+10                                                             
         CLC   DBSELSTA(4),=C'ION '                                             
         BNE   *+10                                                             
         MVC   DBSELSTA(3),=C'PAX'                                              
PAXX     DS    0C                                                               
*                                                                               
TF1      CLC   DBSELSTA(4),=C'UMAP' SPECIAL FOR UMA                             
         BE    *+10                                                             
         CLC   DBSELSTA(4),=C'UMAD'                                             
         BE    *+10                                                             
         CLC   DBSELSTA(4),=C'UMA '                                             
         BNE   *+10                                                             
         MVC   DBSELSTA(3),=C'TF '                                              
TFX      DS    0X                                                               
*                                                                               
MFX1     CLC   DBSELSTA(4),=C'MMXP' SPECIAL FOR MMX                             
         BE    *+10                                                             
         CLC   DBSELSTA(4),=C'MMXD'                                             
         BE    *+10                                                             
         CLC   DBSELSTA(4),=C'MMX '                                             
         BNE   *+10                                                             
         MVC   DBSELSTA(3),=C'MFX'                                              
MFXX     DS    0X                                                               
*                                                                               
         J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TEST OFFICE ACCESS                                                  *         
***********************************************************************         
         SPACE 1                                                                
TSTOACS  NTR1  BASE=*,LABEL=NO                                                  
         L     RA,BASE2                                                         
         L     R9,BASE3                                                         
         CLI   DBSELMED,C'N'                                                    
         JNE   TSTOACSX                                                         
**********************************PROTECTIVE CODE                               
         BC    0,TSTOACSX          FOR RAPID DEINSTALL                          
         OC    DBAUTH,DBAUTH       IN CASE APPL DIDN'T SET IT                   
         JZ    TSTOACSX                                                         
**********************************PROTECTIVE CODE                               
         CLI   DBERROR,0           MAINTAIN PREV ERROR AND CC                   
         JNE   TSTOACSX                                                         
*                                                                               
         L     RE,=A(TWABITS)                                                   
         A     RE,RELO                                                          
TSTOAC02 CLI   0(RE),X'FF'                                                      
         JE    TSTOACSX                                                         
         CLC   DBACTRMK,0(RE)                                                   
         JE    *+12                                                             
         LA    RE,L'TWABITS(RE)                                                 
         J     TSTOAC02                                                         
*                                                                               
         XR    RF,RF                                                            
         IC    RF,2(RE)                                                         
         EX    RF,*+8                                                           
         JZ    TSTOAC04                                                         
         TM    DBAUTH,0                                                         
         J     TSTOACSX                                                         
*                                                                               
TSTOAC04 MVI   DBERROR,INVFMS                                                   
*                                                                               
TSTOACSX CLI   DBERROR,0           SET CONDITION CODE FOR CALLER                
         J     XIT                                                              
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* LATEST BOOK ROUTINE FOR NETWORK                                               
* RETURNS LATEST BOOK IN DUB(2)                                                 
***********************************************************************         
                                                                                
LATSTNBK NTR1  BASE=*,LABEL=*                                                   
         XC    DBKEY,DBKEY                                                      
         XC    DUB(2),DUB          INIT LATEST BOOK TO 0                        
*                                                                               
         LA    R2,DBKEY                                                         
         USING PRKEY,R2                                                         
         MVI   PRCODE,PRCODEQU                                                  
         MVC   PRMEDIA,DBSELMED                                                 
         MVC   PRSTAT(4),=C'UUUU'                                               
         MVC   PRSTAT+4(1),DBSELSTA+4                                           
         CLI   DBSELSTA+4,C'C'                                                  
         BNE   *+12                                                             
         MVI   PRMEDIA,C'C'                                                     
         MVI   PRSTAT+4,C'U'                                                    
         MVC   PRSRC,DBSELSRC                                                   
         MVC   PRBOOK,=AL2(JAN_04) START SEARCH FROM 2004                       
         MVC   PRBTYP,DBBTYPE                                                   
         CLI   DBSELSTA+4,C'S'     SYNDICATION                                  
         BNE   *+10                                                             
         MVC   PRSTAT(4),=C'WB  '                                               
*                                                                               
LATSTN02 MVI   IOFLAG,DIR+HIGH+NTI                                              
*                                                                               
         GOTO1 AIO,IOFLAG                                                       
         JL    LATSTNNO            ERRORS                                       
         CLC   PRKEY(PRBOOK-PRKEY),KEYSAVE                                      
         JNE   LATSTNOK            SEND LATEST BOOK                             
         CLC   PRBTYP,KEYSAVE+PRBTYP-PRKEY                                      
         JNE   LASTN05                                                          
         XR    R1,R1                                                            
         CLC   PRBOOK,DUB                                                       
         BNH   *+10                                                             
         MVC   DUB(2),PRBOOK       SAVE LATEST BOOK                             
         ICM   R1,3,PRBOOK                                                      
         LA    R1,1(R1)            NEXT BOOK TO READ FOR                        
         STCM  R1,3,PRBOOK         BUMP YEAR                                    
         XC    PRSTYP(14),PRSTYP                                                
         MVC   PRBTYP,DBBTYPE                                                   
         J     LATSTN02            READ AGAIN                                   
*                                                                               
LASTN05  ZIC   R1,PRBTYP                                                        
         AHI   R1,R1                                                            
         STC   R1,PRBTYP                                                        
         J     LATSTN02                                                         
*                                                                               
LATSTNNO CHI   RB,0                                                             
         J     XIT                                                              
LATSTNOK CR    RB,RB                                                            
         J     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* READ CABLE STATION EQUIVALENCE PASSIVE KEYS                                   
***********************************************************************         
         SPACE 1                                                                
CABEQIV  NTR1  BASE=*,LABEL=NO                                                  
         SPACE 1                                                                
         L     R8,DBCOMFCS                                                      
         USING COMFACSD,R8         R8=A(COMFACS)                                
         LA    R2,DBKEY                                                         
         USING CSKEY,R2            R2=A(KEY)                                    
         OC    DBSELSTA,DBSELSTA   MAKE SURE STATION IS SET                     
         JZ    CABEQX                                                           
         CLI   DBSELSRC,C'F'       LOOKING UP FUSION?                           
         JNE   CABEQ01                                                          
         TM    DBSELSTA,X'F0'      DONT NEED TO REREAD IF NUMERIC               
         JO    CABEQ14             STATION LOOKUP FOR FUSION                    
         J     CABEQ02                                                          
*                                                                               
CABEQ01  CLI   DBSELSRC,C'N'        NSI LOOKUP?                                 
         JNE   CABEQX                                                           
         TM    DBSELSTA,X'F0'       IF PASSED IN NUMERIC STATION                
         JO    CABEQ02              THEN READ PASSIVE KEYS FOR ALPHA            
         J     CABEQX               IF ALPHA THEN ITS FINE- EXIT                
*                                                                               
* IF WE ARE LOOKING UP FUSION AND DBSELSTA = ALPHA CALL LETTERS                 
* THEN WE MUST READ PASSIVE KEYS TO GRAB THE NUMERIC CABLE STATION              
* NUMBER                                                                        
CABEQ02  MVI   CSCODE,CSCODEQU     BUILD KEY                                    
         MVI   CSMEDIA,C'T'        READ FTN RECORD                              
         MVI   CSSRC,C'N'                                                       
         MVC   CSBOOK,DBSELBK                                                   
         OC    CSBOOK,CSBOOK                                                    
         JZ    *+10                                                             
         XC    CSBOOK,EFFS                                                      
         MVC   CSSTAT1,DBSELSTA     YES - MOVE TO KEY                           
         MVI   CSSTAT1+4,C'T'                                                   
         MVI   IOFLAG,DIR+HIGH     READ HIGH/DIRECTORY                          
         MVC   DBFILNAM,=C'DEMFIL '                                             
         MVC   DBDIRNAM,=C'DEMDIR '                                             
         GOTO1 AIO,IOFLAG                                                       
         JL    GETX                ERRORS                                       
         JH    CABEQ06             EOF                                          
*                                  CHECK RETURN KEY                             
                                                                                
CABEQ04  CLC   CSKEY(CSBOOK-CSKEY),KEYSAVE  DID WE FIND STATION?                
         JE    CABEQ12                                                          
*                                                                               
CABEQ06  MVI   DBERROR,NOTFOUND    RETURN NOT FOUND                             
         J     GETX                                                             
         EJECT                                                                  
CABEQ12  TM    DBSELSTA,X'F0'                                                   
         JO    CABEQ14                                                          
         XC    DUB,DUB                                                          
         MVC   DUB(L'CSSTAT2),CSSTAT2                                           
                                                                                
* NOTE:DBCABNUM IS ONLY 4 BYTES SO AT MOST WE CAN SUPPORT 9999 AS OF            
* NOW.  IF WE NEED MORE THAN THE 4 CHARS - EXAMPLE FOR LOCAL CABLE              
* NUMBERS THEN WE NEED TO COME UP WITH A PLAN. ASSUME 4 BYTES AS OF NOW         
**       UNPK  DBCABNUM(4),DUB+3(2)     SEED IN DBLOCK                          
         LA    R3,DUB+3                                                         
         XC    DMCB,DMCB                                                        
         GOTO1 CHEXOUT,DMCB,(R3),DBCABNUM,2,=C'TOG'                             
         J     CABEQX                                                           
CABEQ14  DS    0X                       DBSELSTA= NUMERIC                       
         CLI   DBSELSRC,C'F'            IF FUSION LOOKUP AND NUMERIC            
         JNE   *+10                     STATION THEN DBCABNUM SHOULD BE         
         MVC   DBCABNUM,DBSELSTA        NUMERIC ALSO.                           
                                                                                
         CLI   DBSELSRC,C'N'            NSI- NUMERIC STATION LOOKUP             
         JNE   *+10                     RESET DBSELSTA - TO ALPHA               
         MVC   DBSELSTA,CSSTAT2         CALL LETTER READ FROM PASSIVE           
CABEQX   J     XIT                                                              
         DROP   R2                                                              
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
* READ THE DATASPACE TO GET MARKET NAMES                                        
* --IN                                                                          
* PARAMETERS IN MKPARAMS                                                        
* --OUT                                                                         
* DBAREC HAS A DMKEY-STYLE MARKET NAME RECORD                                   
* IF DBKEY WAS FILLED IN, THEN OUTPUT RECORD WILL HAVE THIS KEY                 
***********************************************************************         
                                                                                
MKNAME   NTR1  BASE=*,LABEL=*,WORK=(R7,BSPARAL)                                 
                                                                                
         CLI   MKPSRC,C'H'        IHEART USES SAME MARKET NAME                  
         BE    *+8                 TABLE AS ARBITRON                            
         CLI   MKPSRC,C'T'        TRITON USES SAME MARKET NAME                  
         BNE   *+8                 TABLE AS ARBITRON                            
         MVI   MKPSRC,C'A'                                                      
                                                                                
         CLI   MKPSRC,C'C'        NCM SAME MARKET NAME                          
         BE    *+8                 TABLE AS NIELSEN                             
         CLI   MKPSRC,C'V'        VIDEOLOGY SAME MARKET NAME                    
         BNE   *+8                 TABLE AS NIELSEN                             
         MVI   MKPSRC,C'N'                                                      
                                                                                
         USING BSPARA,R7          R7=A(LOCAL W/S)                               
         CLI   MKPMODE,MKNXTQ                                                   
         BNE   MKNM10                                                           
         STAR  CLEAR=Y,ARS=ON                                                   
         LAM   AR2,AR2,ALET        USE IT FOR A(START OF MKT TABLE)             
         CPYA  AR3,AR2             USE TO ADVANCE IN THE MKT TABLE              
         ICM   R2,15,DMKTABA       A(START OF MARKET NAME TABLE)                
         BZ    MKNMNO                                                           
         ICM   R3,15,DMKTLST       A(LAST ACCESSED ENTRY IN THE TABLE)          
         BZ    MKNMNO                                                           
         LA    R3,DMNDATL(,R3)                                                  
         USING DMNDATD,R3          MAKE SURE STILL MATCH ON SRC/MEDIA           
         CLC   DMNSRC,MKPSRC       ACCOUNTS FOR EOT TOO                         
         BNE   MKNMNO                                                           
         CLC   DMNMED,MKPMED                                                    
         BNE   MKNMNO                                                           
         B     MKNM100             GO CREATE RECORD                             
         DROP  R3                                                               
                                                                                
MKNM10   ICM   R2,15,DMKTABA       A(MARKET NAME TABLE) ALREADY THERE?          
         BNZ   MKNM20              YES.                                         
         MVC   DUB(TABMLSTQ),TABMLST  NO. CALL DEMADDR TO GET IT                
         GOTO1 CDEMADDR,DMCB,(X'FF',DUB),COMFACSD                               
         ICM   R2,15,DUB           A(MARKET NAME TABLE) IN DATASPACE            
         BZ    MKNMNO                                                           
         STCM  R2,15,DMKTABA       R2-->MARKET NAME TABLE IN DATASPACE          
                                                                                
MKNM20   STAR  CLEAR=Y,ARS=ON                                                   
         LAM   AR2,AR2,ALET        USE IT FOR A(START OF MKT TABLE)             
         CPYA  AR3,AR2             USE TO ADVANCE IN THE MKT TABLE              
***      MVC   BSPARAMS(28),0(R2)  BINARY SEARCH PARAMETERS                     
***      OC    BSPARAMS(28),BSPARAMS                                            
         MVC   BSPARA(28),0(R2)  BINARY SEARCH PARAMETERS                       
         OC    BSPARA(28),BSPARA                                                
         BZ    MKNMNO              PROTECT AGAINST BAD OR MISSING TABLE         
******   USING BSPARA,BSPARAMS                                                  
                                                                                
         LA    RE,DUB              BINARY SEARCH KEY                            
         USING DMNDATD,RE                                                       
         MVC   DMNMED,MKPMED                                                    
         MVC   DMNSRC,MKPSRC                                                    
         MVC   DMNDNUM,MKPMKNUM                                                 
         ST    RE,BSPAREC                                                       
         DROP  RE                                                               
                                                                                
         OC    MKPMKNUM,MKPMKNUM                                                
         BNZ   *+8                                                              
         MVI   BSPLENR,X'02'       READ HIGH IF NO MKT# GIVEN                   
                                                                                
****     GOTO1 VBINSR31,BSPARAMS                                                
         GOTO1 VBINSR31,BSPARA                                                  
         SAFE  CLEAR=ARZEROS                                                    
         CLI   0(R1),X'80'                                                      
         BE    MKNMNO              RECORD NOT FOUND                             
         ICM   R3,15,0(R1)         R3=A(MATCHING ENTRY)                         
                                                                                
MKNM100  STCM  R3,15,DMKTLST       UPDATE A(LAST ACCESSED ENTRY)                
         USING DMNDATD,R3                                                       
         L     R4,DBAREC                                                        
         USING DMKEY,R4            R4=A(RECORD)                                 
MKNM110  XC    DMKMAJOR,DMKMAJOR   BUILD DUMMY KEY                              
         MVI   DMCODE,DMCODEQU                                                  
         MVC   DMMEDIA,DMNMED                                                   
         MVC   DMSRC,DMNSRC                                                     
MKNM120  MVC   DMRMKT,DMNDNUM                                                   
         LA    R5,DMFRSTEL         BUILD MARKET NAME ELEMENT                    
         USING DMELEM,R5                                                        
         MVI   DMECODE,DMECODEQ    ELEMEMT '01'                                 
         MVC   DMMNO,DMNDNUM       MARKET NUMBER                                
         MVI   DMRSTAT,0           AND STATUS                                   
         MVC   DMMNAME(L'DMNDNAM),DMNDNAM   MARKET NAME                         
         LA    R1,DMMNAME+L'DMNDNAM-1                                           
         LA    RE,DMMNAME                                                       
MKNM125  CLI   0(R1),C' '          LOCATE END OF NAME                           
         BNE   MKNM130                                                          
         CR    R1,RE                                                            
         BNH   MKNM130             STOP IF ALL BLANKS. SHOULDNT HAPPEN          
         BCT   R1,MKNM125                                                       
MKNM130  LA    R1,1(R1)                                                         
         SR    R1,R5                                                            
         STC   R1,DMLEN            SET ELEMENT LENGTH                           
         DROP  R5                                                               
         AR    R5,R1                                                            
         MVI   0(R5),0             SET END OF RECORD                            
         LA    R5,1(R5)            INCLUDE END OF RECORD                        
         SR    R5,R4                                                            
         STCM  R5,3,DMRLEN         SET RECORD LENGTH                            
         B     MKNMYES                                                          
                                                                                
         DROP  R3,R4,R7                                                         
                                                                                
MKNMNO   CHI   RB,0                SET CONDITION CODES AND EXIT                 
         B     MKNAMEX                                                          
MKNMYES  CR    RB,RB                                                            
         B     MKNAMEX                                                          
                                                                                
MKNAMEX  LAM   AR2,AR3,ARZEROS                                                  
         LA    RE,*+6                                                           
         BSM   0,RE                                                             
         REAR  ARS=OFF                                                          
         J     XIT                                                              
                                                                                
         LTORG                                                                  
TABMLST  DS    0X                                                               
         DC    X'E6',3X'00'        PARAM TO DEMADDR FOR MKT NAME TABLE          
         DC    X'FF'                                                            
TABMLSTQ EQU   *-TABMLST                                                        
ARZEROS  DC    16F'0'                                                           
BSPARAL  EQU   28                  28 BYTE BINSRCH PARAM LENGTH                 
         EJECT                                                                  
                                                                                
***********************************************************************         
* CANADA ADJUST DBSELTIM FOR POSTING IF NEW METHODOLOGY IS REQUESTED            
* START TIME WHERE ITS THREE MONITES BEFORE QTR BOUDARY DO NOT GO               
* READ LEADIN TIME- WE WILL ADJUST THE START TIME TO THE NEXT QTR               
* BOUNDARY                                                                      
* END TIME WHERE ITS THREE MONITES AFTER QTR BOUDARY DO NOT GO                  
* READ LEADOUT TIME- WE WILL ADJUST THE END TIME TO THE PREVIOUS QTR            
* BOUNDARY                                                                      
***********************************************************************         
ADJTIME  NTR1  BASE=*,LABEL=*                                                   
* DO WE NEED TO ADJUST START TIME?                                              
         ZICM  R0,DBSELTIM,(3)                                                  
         SRDL  R0,32               GET MILITARY TIME IN R1                      
         D     R0,=F'100'          R0=REMAINDER MINUTES                         
*                                                                               
         LR    R1,R0               R1= NUMBER OF MINUTES PASS THE HOUR          
         LR    RF,R0               RF= NUMBER OF MINUTES PASS THE HOUR          
         SR    R0,R0                                                            
         D     R0,=F'15'           HOW MANY MINUTES PASS A QTR HOUR             
         CHI   R0,12               THE 3 MINUTES BEFORE A QTR BOUNDARY          
         BL    ADJTM20             PRETEND START TIME IS THE NEXT QTR           
* START TIME IS WITHIN 3 MINUTES PRIOR TO A QTR HOUR BOUNDARY                   
* EX 557A, 558A 559A SHOUDL BEHAVE AS IF THEY REQUESTED 6AM START TIME          
         LR    RE,R0               RE=NUMBER OF MINUTES PASS QTR HOUR           
*                                                                               
         ZICM  R0,DBSELTIM,(3)                                                  
         SRDL  R0,32               R1= START TIME IN WHOLE HOURS                
         D     R0,=F'100'                                                       
         MHI   R1,100                                                           
                                                                                
         LA    R0,15                                                            
         SR    R0,RE               NUMBER MINS PASS A QTR HOUR BOUNDARY         
*                                                                               
*IF THE NUMBER OF MINUTES TO ADD=60 THEN ADD A FULL HOUR                        
         AR    R0,RF                                                            
         CHI   R0,60                                                            
         BNE   *+8                                                              
         LA    R0,100              60 MINUTES = FULL HOUR                       
*                                                                               
         AR    R1,R0                                                            
         STCM  R1,3,DBSELTIM                                                    
*                                                                               
* DO WE NEED TO ADJUST END TIME?                                                
*                                                                               
* DO WE NEED TO ADJUST START TIME?                                              
ADJTM20  CLI   DBNPMFLG,DBNOBAVG   DO NOT BREAK AVERAGE THE SPOT TIME           
         BE    *+8                                                              
         CLI   DBNPMFLG,DBNPMAFF   NO END TIME FOR AFFIDS                       
         BE    ADJTIMX             SO DONT BOTHER MESSING WITH ENDTIME          
*                                                                               
         ZICM  R0,DBSELTIM+2,(3)                                                
         SRDL  R0,32               GET MILITARY TIME IN R1                      
         D     R0,=F'100'          R0=REMAINDER MINUTES                         
*                                                                               
         LR    R1,R0               R1= NUMBER OF MINUTES PASS THE HOUR          
         LR    RF,R0               RF= NUMBER OF MINUTES PASS THE HOUR          
         SR    R0,R0                                                            
         D     R0,=F'15'           HOW MANY MINUTES PASS A QTR HOUR             
         CHI   R0,3                THE 3 AFTER   BEFORE A QTR BOUNDARY          
         BH    ADJTIMX             PRETEND START TIME IS THE NEXT QTR           
* START TIME IS WITHIN 3 MINUTES PRIOR TO A QTR HOUR BOUNDARY                   
* EX 557A, 558A 559A SHOUDL BEHAVE AS IF THEY REQUESTED 6AM START TIME          
         LR    RE,R0               RE=NUMBER OF MINUTES PASS QTR HOUR           
*                                                                               
         ZICM  R0,DBSELTIM+2,(3)                                                
         SRDL  R0,32               R1= START TIME IN WHOLE HOURS                
         D     R0,=F'100'                                                       
         MHI   R1,100                                                           
                                                                                
***      LA    R0,15                                                            
****     SR    R0,RE               NUMBER MINS PASS A QTR HOUR BOUNDARY         
*                                                                               
*IF THE NUMBER OF MINUTES TO ADD=60 THEN ADD A FULL HOUR                        
         SR    RF,RE                                                            
         CHI   RF,60                                                            
         BNE   *+8                                                              
         LA    RF,100              60 MINUTES = FULL HOUR                       
*                                                                               
         AR    R1,RF                                                            
         STCM  R1,3,DBSELTIM+2                                                  
*****                                                                           
*                                                                               
ADJTIMX  J     XIT                                                              
***********************************************************************         
*ADJUST SOURCE IN THE KEY ACCORDING TO THE DESIRED FLAVOR OF                    
*TIME SHIFTED DATA: LIVE, LIVE+1, OR LIVE+7                                     
***********************************************************************         
                                                                                
ADJLIVE  NTR1  BASE=*,LABEL=*                                                   
         USING IOWORKD,R7          R7=A(LOCAL W/S)                              
*                                                                               
         CLC   DBFILE,=C'RLD'      RLD POINTERS ONLY HAS LIVE                   
         BNE   *+12                                                             
         CLI   DBKEY,C'M'                                                       
         BNE   ADJLVOK                                                          
         CLC   =C'NTIDIR',IODIR    NTI DIRECTORY                                
         BNE   ADJLVOK                                                          
         CLI   DBKEY+2,C'N'        SOURCE=NIELSEN                               
         BNE   ADJLVOK                                                          
                                                                                
         CLI   DBBTYPE,C'U'        EXCLUDE USER FILES                           
         BE    ADJLVOK                                                          
                                                                                
         LA    R2,NETPOSN          EXCLUDE A FEW SPECIFIC STATIONS              
         USING NETPOSND,R2                                                      
ADJL02   CLI   0(R2),X'FF'                                                      
         BE    ADJL08              DON'T NEED TO CHECK THIS RECORD              
         CLC   NETPREC,DBKEY                                                    
         BE    ADJL04                                                           
         LA    R2,NETPOSNL(R2)                                                  
         B     ADJL02                                                           
                                                                                
ADJL04   LA    RE,DBKEY                                                         
         ZIC   RF,NETPSTA                                                       
         AR    RF,RE               RF=A(STATION IN THE KEY)                     
         CLC   =C'ITAB',0(RF)      KEEP SOURCE=N FOR INTABS                     
         BE    ADJLVOK                                                          
         CLC   =C'STAB',0(RF)      AND FOR SCALED INTABS                        
         BE    ADJLVOK                                                          
         CLI   4(RF),C'U'          ALWAYS LOOK UP LIVE UNIVERSES                
         BE    ADJLVOK                                                          
         CLC   =C'UUUU',0(RF)      ALWAYS LOOK UP LIVE UNIVERSES                
         BE    ADJLVOK                                                          
         DROP  R2                                                               
                                                                                
ADJL08   ICM   R5,15,DBEXTEND                                                   
         USING DBXLIVD,R5                                                       
ADJL10   BZ    ADJLVOK                                                          
         CLC   DBXLIVID,=C'NLIV'                                                
         BE    *+12                                                             
         ICM   R5,15,DBXLIVNX                                                   
         B     ADJL10                                                           
                                                                                
         MVC   BYTE,DBXLIVE        SET BYTE WITH VIEWING TYPE                   
*                                                                               
         CLI   DBKEY,PRCODEQU      LOOKING UP P KEY?                            
         JNE   ADJL11                                                           
         CLI   DBXLIVE,DBXLOLQ     IF IT'S OOH/OOHC,                            
         JE    ADJ10A              SET IT LIKE NTI/ACM                          
         CLI   DBXLIVE,DBXLOSQ                                                  
         JE    ADJ10A                                                           
         CLI   DBXLIVE,DBXLO3Q                                                  
         JE    ADJ10A                                                           
         CLI   DBXLIVE,DBXLO7Q                                                  
         JE    ADJ10A                                                           
         CLI   DBXLIVE,DBXLOCLQ                                                 
         JE    ADJ10A                                                           
         CLI   DBXLIVE,DBXLOCSQ                                                 
         JE    ADJ10A                                                           
         CLI   DBXLIVE,DBXLOC3Q                                                 
         JE    ADJ10A                                                           
         CLI   DBXLIVE,DBXLOC7Q                                                 
         JNE   *+8                                                              
ADJ10A   MVI   BYTE,DBXLLQ                                                      
*                                                                               
ADJL11   L     RE,VTYPTRTB                                                      
         LH    R0,VTYPTRTB_LEN     BUMP TO NEXT TABLE ENTRYN                    
         USING VTYPTRND,RE                                                      
ADJL12   CLI   0(RE),X'FF'                                                      
         BE    ADJLVNOT            VIEWING TYPE NOT DEFINED                     
*        CLC   DBXLIVE,VTDBXLIV                                                 
         CLC   BYTE,VTDBXLIV                                                    
         BE    ADJL14                                                           
         AR    RE,R0                                                            
         B     ADJL12                                                           
ADJL14   MVC   DBKEY+2(1),VTDEMSRC ACTUAL SOURCE IN THE KEY                     
         DROP  RE                                                               
                                                                                
         CLI   DBXLIVE,DBXLLQ      LIVE, SOURCE=C'N'                            
         BNE   ADJL20                                                           
         BRAS  RE,COMMAVG          COMMERCIAL AVERAGE HAS LIVE DATA             
         BE    ADJLVOK                                                          
         BRAS  RE,NETLIVE          CK IF THIS IS A FILE WITH LIVE DATA          
         BNE   ADJLVNOT            NO. SPECIFICALLY ASKED FOR LIVE.             
         B     ADJLVOK                                                          
                                                                                
ADJL20   CLI   DBXLIVE,DBXLL7Q     LIVE+7, SOURCE=C'7'                          
         BNE   ADJLVOK                                                          
         BRAS  RE,COMMAVG          COMMERCIAL AVERAGE HAS LIVE DATA             
         BE    ADJLVOK                                                          
         BRAS  RE,NETLIVE          CK IF THIS IS A FILE WITH LIVE DATA          
         BE    ADJLVOK             YES. LIVE+7 IS SAVED WITH SOURCE=7           
         MVI   DBKEY+2,SRCLIVE     NO. LIVE+7 IS SAVED WITH SOURCE=N            
         B     ADJLVOK                                                          
                                                                                
ADJLVOK  CR    RB,RB                                                            
         B     ADJLIVX                                                          
ADJLVNOT CHI   RB,0                                                             
ADJLIVX  J     XIT                                                              
         DROP  R5,R7                                                            
                                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF COMMERCIAL AVERAGE DATA WAS REQUESTED                                
***********************************************************************         
                                                                                
COMMAVG  NTR1  BASE=*,LABEL=*                                                   
                                                                                
         CLI   DBBTYPE,C'U'        EXCLUDE USER FILES                           
         BE    COMMANO                                                          
*                                                                               
         ICM   RE,15,DBEXTEND                                                   
         USING DBXLIVD,RE                                                       
COMMAV02 BZ    COMMAV08                                                         
         CLC   DBXLIVID,=C'NLIV'                                                
         BE    *+12                                                             
         ICM   RE,15,DBXLIVNX                                                   
         B     COMMAV02                                                         
                                                                                
         CLI   DBXLIVE,DBXLOLQ     IF IT'S OOH, DON'T LOOK AT CAVG              
         JE    COMMANO                                                          
         CLI   DBXLIVE,DBXLOSQ                                                  
         JE    COMMANO                                                          
         CLI   DBXLIVE,DBXLO3Q                                                  
         JE    COMMANO                                                          
         CLI   DBXLIVE,DBXLO7Q                                                  
         JE    COMMANO                                                          
                                                                                
         USING DBXCAVD,RE                                                       
COMMAV08 ICM   RE,15,DBEXTEND                                                   
COMMAV10 BZ    COMMANO                                                          
         CLC   DBXCAVID,=C'CAVG'   CAVG EXTENTION                               
         BE    COMMAV20                                                         
         ICM   RE,15,DBXCAVNX                                                   
         B     COMMAV10                                                         
                                                                                
COMMAV20 CLI   DBXCAV,DBXCVYQ      WITH INDICATOR ON                            
         BNE   COMMANO                                                          
         B     COMMAYES                                                         
                                                                                
COMMAYES CR    RB,RB                                                            
         B     COMMAVX                                                          
COMMANO  CHI   RB,0                                                             
COMMAVX  J     XIT                                                              
         DROP  RE                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF VIEWING TYPES +1,+2,+3,AL,AS,OR A7 WAS REQUESTED                     
* DATA FOR THESE VIEWING TYPES COMES FROM THE ACM TAPES                         
***********************************************************************         
                                                                                
VTYPACM  NTR1  BASE=*,LABEL=*                                                   
                                                                                
         USING DBXLIVD,RE                                                       
         ICM   RE,15,DBEXTEND                                                   
VACMTP10 BZ    VACMTPN                                                          
         CLC   DBXLIVID,=C'NLIV'                                                
         BE    VACMTP20                                                         
         ICM   RE,15,DBXLIVNX                                                   
         B     VACMTP10                                                         
VACMTP20 CLI   DBXLIVE,DBXLLF1Q    LIVE+1                                       
         BE    VACMTPY                                                          
         CLI   DBXLIVE,DBXLL2Q     LIVE+2                                       
         BE    VACMTPY                                                          
         CLI   DBXLIVE,DBXLL3Q     LIVE+3                                       
         BE    VACMTPY                                                          
         CLI   DBXLIVE,DBXLALVQ    LIVE    PROG AVG DATA FROM ACM TAPES         
         BE    VACMTPY                                                          
         CLI   DBXLIVE,DBXLALSQ    LIVE+SD PROG AVG DATA FROM ACM TAPES         
         BE    VACMTPY                                                          
         CLI   DBXLIVE,DBXLAL7Q    LIVE+7  PROG AVG DATA FROM ACM TAPES         
         BE    VACMTPY                                                          
         B     VACMTPN                                                          
                                                                                
VACMTPY  CR    RB,RB                                                            
         B     VACMTPX                                                          
VACMTPN  CHI   RB,0                                                             
VACMTPX  J     XIT                                                              
         DROP  RE                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DETERMINE IF DATA REQUESTED IS CONTROLLED BY 'ACMC' DCON ACCESS               
* THIS IS THE CABLE COMMERCIAL AVG DATA, AND WEEKLY CABLE DATA FOR              
* VIEWING TYPES: LIVE+1,LIVE+2,LIVE+3                                           
***********************************************************************         
                                                                                
COMCMKT  NTR1  BASE=*,LABEL=*                                                   
                                                                                
         BRAS  RE,COMMAVG                                                       
         BE    COMCMYES            THIS IS ACM(COMM AVG) CABLE DATA             
                                                                                
         USING DBXLIVD,RE                                                       
         ICM   RE,15,DBEXTEND      CABLE DATA NOT ACM(COMM AVG)                 
COMCMK10 BZ    COMCMNO             FOR SPECIAL VIEWING TYPES                    
         CLC   DBXLIVID,=C'NLIV'                                                
         BE    COMCMK20                                                         
         ICM   RE,15,DBXLIVNX                                                   
         B     COMCMK10                                                         
COMCMK20 CLI   DBXLIVE,DBXLLF1Q   PROGRAM DATA FOR LIVE+1,LIVE+2,LIVE+3         
         BE    COMCMYES            COMES ONLY ON THE COMM AVG TAPES.            
         CLI   DBXLIVE,DBXLL2Q     THIS DATA GETS THE SAME DCON ACCESS          
         BE    COMCMYES            AS THE COMM AVG DATA                         
         CLI   DBXLIVE,DBXLL3Q                                                  
         BE    COMCMYES                                                         
         B     COMCMNO                                                          
                                                                                
COMCMYES CR    RB,RB                                                            
         B     COMCMKX                                                          
COMCMNO  CHI   RB,0                                                             
COMCMKX  J     XIT                                                              
         DROP  RE                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF THIS FILE HAS ACTUAL LIVE DATA                                       
* DBKEY HAS THE KEY OF THE RECORD                                               
***********************************************************************         
                                                                                
NETLIVE  NTR1  BASE=*,LABEL=*                                                   
                                                                                
         USING IOWORKD,R7                                                       
*                                                                               
         LA    R3,NETLTAB                                                       
         USING NETLTABD,R3                                                      
NETLV10  CLI   0(R3),X'FF'                                                      
         BE    NLVYES              FILE NOT DEFINED.MUST HAVE LIVE DATA         
                                                                                
         LA    R2,NETPOSN                                                       
         USING NETPOSND,R2                                                      
NETLV20  CLI   0(R2),X'FF'                                                      
         BE    NLVYES              DON'T NEED TO CHECK THIS RECORD              
         CLC   NETPREC,DBKEY                                                    
         BE    NETLV30                                                          
         LA    R2,NETPOSNL(R2)                                                  
         B     NETLV20                                                          
                                                                                
NETLV30  LA    R4,DBKEY                                                         
                                                                                
         ZIC   RF,NETPMED          COMPARE ON THE MEDIA                         
         AR    RF,R4                                                            
         CLC   NETLMED,0(RF)                                                    
         BNE   NETLV100                                                         
                                                                                
         ICM   RF,15,NETLSTR       COMPARE ON STATION                           
         BZ    NETLV40                                                          
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         BNE   NETLV100                                                         
                                                                                
NETLV40  CLI   NETLBTYP,ANYBTYP    COMPARE ON BOOKTYPE                          
         BE    NETLV50                                                          
         ZIC   RF,NETPBTYP                                                      
         AR    RF,R4                                                            
         CLC   NETLBTYP,0(RF)                                                   
         BNE   NETLV100                                                         
                                                                                
NETLV50  ZIC   RF,NETPBOOK         COMPARE ON BOOK                              
         AR    RF,R4                                                            
         CLC   NETLSBK,0(RF)                                                    
         BH    NLVYES              OLD DATA WAS LIVE ONLY                       
         CLC   NETLSLBK,0(RF)                                                   
         BH    NLVNO               BEFORE THIS BOOK NO LIVE DATA                
                                                                                
* THIS CODE HANDLES WEEKS WHERE THE FAST (PRELIMINARY) DATA HAS ONLY            
* LIVE+7 DATA, WHILE THE FINAL DATA THAT COMES AT THE END OF THE MONTH          
* HAS ALL STREAMS, INCLUDING LIVE.  THE PROBLEM IS THAT BOTH THE                
* 'FAST LIVE+7' AND 'FINAL LIVE' HAVE THE SAME KEY. WILL USE THE                
* LOAD IDENTIFIER PASSIVE RECORDS TO DETERMINE WHETHER THE FINAL DATA           
* HAS BEEN LOADED YET. THIS WILL HELP DECIDE IF THE KEY BELONGS TO A            
* RECORD WITH LIVE DATA OR LIVE+7 DATA                                          
         CLC   NETLSLBP,=X'0000'   FAST DATA FOR THIS FILE?                     
         BE    NLVYES              NO. NO NEED TO CHECK FURTHER                 
         CLC   NETLSLBP,0(RF)                                                   
         BNH   NLVYES              AFTER FAST START DATE WE HAVE LIVE           
*                                  BF HAVE LIVE ONLY FOR FINAL.                 
         OC    CDATCON,CDATCON                                                  
         BZ    NETLV70             TO OPTIMIZE,                                 
         OC    CGETDAY,CGETDAY     ANY DATA 3 MONTH PRIOR TO CURRENT            
         BZ    NETLV70             MUST HAVE FINAL DATA LOADED                  
         OC    CADDAY,CADDAY                                                    
         BZ    NETLV70                                                          
         GOTO1 CDATCON,DMCB,(5,WORK),(0,DUB)                                    
         GOTO1 CADDAY,DMCB,(C'M',DUB),WORK,-3                                   
         GOTO1 VNETWEK,DMCB,WORK,CGETDAY,CADDAY                                 
         MVC   DUB(1),DMCB+4       YY                                           
         MVC   DUB+1(1),DMCB       WW                                           
         ZIC   RF,NETPBOOK                                                      
         AR    RF,R4                                                            
         CLC   0(2,RF),DUB                                                      
         BL    NLVYES              >3 MONTH BEFORE,FINAL/LIVE DATA IN           
                                                                                
NETLV70  LA    RE,WORK             CHECK TO SEE IF FINAL DATA LOADED            
         USING PLKEY,RE            BY READING THE LOAD IDENTIF RECDS.           
         XC    PLKMAJOR,PLKMAJOR                                                
         MVI   PLCODE,PLCODEQU                                                  
         ZIC   RF,NETPMED          COMPARE ON THE MEDIA                         
         AR    RF,R4                                                            
         MVC   PLMEDIA,0(RF)       MEDIA                                        
         MVI   PLSRC,C'N'          LIVE SOURCE                                  
         ZIC   RF,NETPSTA                                                       
         AR    RF,R4                                                            
         MVC   PLFILE,4(RF)        5TH CHAR OF STATION                          
         ZIC   RF,NETPBOOK         COMPARE ON BOOK                              
         AR    RF,R4                                                            
         MVC   PLBOOK,0(RF)        BOOK                                         
         MVI   PLORIG,PLOFINLQ     FINAL FILE                                   
         DROP  RE                                                               
         MVC   WORKSV,WORK         SAVE KEY                                     
         MVI   NEWDSEQ,C'Y'                                                     
         GOTO1 CDATAMGR,DMCB,CMNDREAD,CNTIDIR,WORK,WORK2                        
         BNE   NLVNO               NO FINAL DATA, NO LIVE                       
         CLC   WORKSV(L'PLKMAJOR),WORK2                                         
         BNE   NLVNO                                                            
         B     NLVYES              LIVE FINAL DATA FOUND                        
                                                                                
NETLV100 LA    R3,NETLTABL(R3)                                                  
         B     NETLV10                                                          
                                                                                
NLVNO    CLI   DBFUNCT,DBCKNLIV                                                 
         BNE   *+8                                                              
         MVI   DBERROR,NOTFOUND                                                 
         CHI   RB,0                SET CONDITION CODE                           
         J     XIT                                                              
NLVYES   CR    RB,RB                                                            
         J     XIT                                                              
         DROP  R3,R7                                                            
                                                                                
                                                                                
*---------------------------------------------------------------------*         
* CHECK FOR NTI NAD STATION                                                     
* R2-> ENTRY IN NETPOSN TABLE                                                   
* R4-> DBKEY                                                                    
*---------------------------------------------------------------------*         
NADNTIS  NTR1  BASE=*,LABEL=*                                                   
         USING NETPOSND,R2                                                      
         ZIC   RF,NETPSTA                                                       
         AR    RF,R4               RF-> STATION IN THE KEY                      
         CLI   4(RF),C'N'          CHECK FOR NTI NAD                            
         JNE   XITNO                                                            
         J     XITYES                                                           
         DROP  R2                                                               
                                                                                
*---------------------------------------------------------------------*         
* CHECK FOR NSS NAD STATION                                                     
* R2-> ENTRY IN NETPOSN TABLE                                                   
* R4-> DBKEY                                                                    
*---------------------------------------------------------------------*         
NADNSSS  NTR1  BASE=*,LABEL=*                                                   
         USING NETPOSND,R2                                                      
         ZIC   RF,NETPSTA                                                       
         AR    RF,R4               RF-> STATION IN THE KEY                      
         CLI   4(RF),C'M'          CHECK FOR NSS NAD                            
         JNE   XITNO                                                            
         J     XITYES                                                           
         DROP  R2                                                               
                                                                                
*---------------------------------------------------------------------*         
* CHECK FOR NSS STATION                                                         
* R2-> ENTRY IN NETPOSN TABLE                                                   
* R4-> DBKEY                                                                    
*---------------------------------------------------------------------*         
NSSSTA   NTR1  BASE=*,LABEL=*                                                   
         USING NETPOSND,R2                                                      
         ZIC   RF,NETPSTA                                                       
         AR    RF,R4               RF-> STATION IN THE KEY                      
         CLI   4(RF),C'S'          CHECK FOR NSS                                
         JNE   XITNO                                                            
         J     XITYES                                                           
         DROP  R2                                                               
                                                                                
*---------------------------------------------------------------------*         
* CHECK FOR CABLE STATION                                                       
* R2-> ENTRY IN NETPOSN TABLE                                                   
* R4-> DBKEY                                                                    
*---------------------------------------------------------------------*         
CBLSTA   NTR1  BASE=*,LABEL=*                                                   
         USING NETPOSND,R2                                                      
         ZIC   RF,NETPSTA                                                       
         AR    RF,R4               RF-> STATION IN THE KEY                      
         CLI   4(RF),C'C'          CHECK FOR CABLE                              
         JE    XITYES                                                           
         CLI   4(RF),X'83'         SMALL C, HUT HH DATA                         
         JE    XITYES                                                           
         CLI   4(RF),C'Q'          QH DATA                                      
         JE    XITYES                                                           
         CLI   4(RF),X'98'         SMALL Q, HUT QH DATA                         
         JE    XITYES                                                           
         J     XITNO                                                            
         DROP  R2                                                               
                                                                                
*---------------------------------------------------------------------*         
* CHECK FOR NHTI GENERAL MARKET STATIONS                                        
* R2-> ENTRY IN NETPOSN TABLE                                                   
* R4-> DBKEY                                                                    
*---------------------------------------------------------------------*         
HGENSTA  NTR1  BASE=*,LABEL=*                                                   
         USING NETPOSND,R2                                                      
         ZIC   R3,NETPSTA                                                       
         AR    R3,R4               R3-> STATION IN THE KEY                      
         CLI   4(R3),C'H'          HISPANIC                                     
         JNE   XITNO                                                            
*                                                                               
         L     RF,DBCOMFCS         GET A(GEN MARKET ENGLISH ST TABLE)           
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,NEHGES                                                 
         ICM   RE,15,0(R1)         A(TABLE)                                     
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            LENGTH OF TABLE                              
*                                                                               
         USING NEHGENMD,RE                                                      
HGENS10  CLI   0(RE),X'FF'                                                      
         BE    HGENS20             GO TRY GENERAL MARKET AGGREGATES             
         CLC   0(3,R3),NEHGENET    COMPARE ON STATION                           
         JE    XITYES                                                           
         AR    RE,R0                                                            
         B     HGENS10                                                          
         DROP  RE                                                               
*                                  CALL DEMTABS TO                              
HGENS20  GOTO1 (RF),DMCB,NEHGAG    GET A(GEN MARKET AGGREGATES TABLE)           
         ICM   RE,15,0(R1)         A(TABLE)                                     
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            LENGTH OF TABLE                              
*                                                                               
         USING NEHGAGD,RE                                                       
HGENS30  CLI   0(RE),X'FF'                                                      
         JE    XITNO               STATION NOT FOUND                            
         CLC   0(3,R3),NEHGAGNT    COMPARE ON STATION                           
         JE    XITYES                                                           
         AR    RE,R0                                                            
         B     HGENS30                                                          
         DROP  RE                                                               
         DROP  R2                                                               
                                                                                
*---------------------------------------------------------------------*         
* CHECK FOR NHTI AUDIENCE STATIONS                                              
* R2-> ENTRY IN NETPOSN TABLE                                                   
* R4-> DBKEY                                                                    
*---------------------------------------------------------------------*         
HAUDSTA  NTR1  BASE=*,LABEL=*                                                   
         USING NETPOSND,R2                                                      
         ZIC   R3,NETPSTA                                                       
         AR    R3,R4               R3-> STATION IN THE KEY                      
         CLI   4(R3),C'H'          HISPANIC                                     
         JNE   XITNO                                                            
*                                                                               
         L     RF,DBCOMFCS         GET A(TV AUDIENCE BROADCAST TABLE)           
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,NEHBRO                                                 
         ICM   RE,15,0(R1)         A(TABLE)                                     
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            LENGTH OF TABLE                              
*                                                                               
         USING NEHBRNMD,RE                                                      
HAUDS10  CLI   0(RE),X'FF'                                                      
         BE    HAUDS20             GO TRY TV AUDIENCE AGGREGATES                
         CLC   0(3,R3),NEHBRNET    COMPARE ON STATION                           
         JE    XITYES                                                           
         AR    RE,R0                                                            
         B     HAUDS10                                                          
         DROP  RE                                                               
*                                  CALL DEMTABS TO                              
HAUDS20  GOTO1 (RF),DMCB,NEHTAG    GET A(TV AUDIENCE AGGREGATES TABLE)          
         ICM   RE,15,0(R1)         A(TABLE)                                     
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            LENGTH OF TABLE                              
*                                                                               
         USING NEHTAGD,RE                                                       
HAUDS30  CLI   0(RE),X'FF'                                                      
         JE    XITNO               STATION NOT FOUND                            
         CLC   0(3,R3),NEHTAGNT    COMPARE ON STATION                           
         JE    XITYES                                                           
         AR    RE,R0                                                            
         B     HAUDS30                                                          
         DROP  RE                                                               
         DROP  R2                                                               
                                                                                
XITNO    CHI   RB,0                                                             
         J     XIT                                                              
XITYES   CR    RB,RB                                                            
         J     XIT                                                              
                                                                                
*---------------------------------------------------------------------*         
* THIS TABLE DEFINES THE NETWK FILES THAT DON'T HAVE LIVE DATA                  
* THESE FILES HAVE ONLY LIVE+7 DATA, BUT GET SAVED WITH THE DEFUALT KEY         
* SEE NETLTABD FOR FORMAT                                                       
*                                                                               
* NOTES: ENTRY FOR SPECIFIC BOOKTYPE SHOULD COME BEFORE ENTRIES FOR             
*         ALL BOOKTYPES                                                         
*---------------------------------------------------------------------*         
NETLTAB  DS    0X                                                               
* MONTHLY NTI NAD: NO LIVE DATA JAN/O6-DEC/06                                   
         DC    AL2(JAN_06),AL2(JAN_07),AL2(0)                                   
         DC    C'N',AL4(NADNTIS),AL1(ANYBTYP)                                   
                                                                                
* WEEKLY NTI MOVIEGOER: NO LIVE DATA JAN/06-CURRENT                             
         DC    AL2(JAN_06),X'FFFF',AL2(0)                                       
         DC    C'W',AL4(NADNTIS),C'M'                                           
                                                                                
* WEEKLY NTI NAD - FINAL DATA: NO LIVE DATA JAN/06-DEC/06                       
*                - FAST DATA: NO LIVE DATA JAN/06-CURRENT                       
         DC    AL2(JAN_06),AL2(JAN_07),X'FFFF'                                  
         DC    C'W',AL4(NADNTIS),AL1(ANYBTYP)                                   
                                                                                
* MONTHLY NSS NAD: NO LIVE DATA JAN/O6-DEC/06                                   
         DC    AL2(JAN_06),AL2(JAN_07),AL2(0)                                   
         DC    C'N',AL4(NADNSSS),AL1(ANYBTYP)                                   
                                                                                
* WEEKLY NSS MOVIEGOER: NO LIVE DATA JAN/06-CURRENT                             
         DC    AL2(JAN_06),X'FFFF',AL2(0)                                       
         DC    C'W',AL4(NADNSSS),C'M'                                           
                                                                                
* WEEKLY NSS NAD - FINAL DATA ONLY: NO LIVE DATA JAN/06-DEC/06                  
         DC    AL2(JAN_06),AL2(JAN_07),AL2(0)                                   
         DC    C'W',AL4(NADNSSS),AL1(ANYBTYP)                                   
                                                                                
* CABLE NAD: NO LIVE DATA JAN/O6-DEC/06                                         
         DC    AL2(JAN_06),AL2(JAN_07),AL2(0)                                   
         DC    C'C',AL4(CBLSTA),C'N'                                            
                                                                                
* CABLE MOVIEGOER: NO LIVE DATA JAN/06-CURRENT                                  
         DC    AL2(JAN_06),X'FFFF',AL2(0)                                       
         DC    C'C',AL4(CBLSTA),C'M'                                            
                                                                                
* MONTHLY NHTI GEN MARKET: NO LIVE DATA JAN/O6-DEC/06                           
         DC    AL2(JAN_06),AL2(JAN_07),AL2(0)                                   
         DC    C'N',AL4(HGENSTA),AL1(ANYBTYP)                                   
                                                                                
* WEEKLY NHTI GEN MAKET: NO LIVE DATA JAN/06-DEC/06                             
         DC    AL2(JAN_06),AL2(JAN_07),AL2(0)                                   
         DC    C'W',AL4(HGENSTA),AL1(ANYBTYP)                                   
                                                                                
* WEEKLY NHTI AUDIENCE: - FINAL DATA: ALWAYS HAS LIVE DATA                      
*                       - FAST DATA: NO LIVE DATA JAN/06-AUG20/07               
         DC    AL2(JAN_06),AL2(JAN_06),AL1(YR_2007,WEEK_35)                     
         DC    C'W',AL4(HAUDSTA),AL1(ANYBTYP)                                   
                                                                                
NETLTABX DC    X'FF'                                                            
                                                                                
*---------------------------------------------------------------------*         
* TABLE OF POSITIONAL DISPLACEMENTS BY RECORD TYPE                              
*---------------------------------------------------------------------*         
NETPOSN  DS    0X                                                               
         DC    AL1(PRCODEQU)       P-RECORD (TIME PERIOD DATA)                  
         DC    AL1(PRBOOK-PRKEY)   BOOK                                         
         DC    AL1(PRMEDIA-PRKEY)  MEDIA                                        
         DC    AL1(PRSTAT-PRKEY)   STATION                                      
         DC    AL1(PRBTYP-PRKEY)   BOOKTYPE                                     
                                                                                
         DC    AL1(PMCODEQU)       Q-RECORD (PROGRAM DATA)                      
         DC    AL1(PMBOOK-PMKEY)   BOOK                                         
         DC    AL1(PMMEDIA-PMKEY)  MEDIA                                        
         DC    AL1(PMSTAT-PMKEY)   STATION                                      
         DC    AL1(PMBTYP-PMKEY)   BOOKTYPE                                     
                                                                                
         DC    AL1(PNCODEQU)       N-RECORD (DAY/TIME PASSIVE POINTERS)         
         DC    AL1(PNBOOK-PNKEY)   BOOK                                         
         DC    AL1(PNMEDIA-PNKEY)  MEDIA                                        
         DC    AL1(PNSTAT-PNKEY)   STATION                                      
         DC    AL1(PNBTYP-PNKEY)   BOOKTYPE                                     
                                                                                
         DC    AL1(PKCODEQU)       K-RECORD (PROGRAM/STATION POINTERS)          
         DC    AL1(PKBOOK-PKKEY)   BOOK                                         
         DC    AL1(PKMEDIA-PKKEY)  MEDIA                                        
         DC    AL1(PKSTAT-PKKEY)   STATION                                      
         DC    AL1(PKBTYP-PKKEY)   BOOKTYPE                                     
                                                                                
         DC    AL1(PJCODEQU)       J-RECORD (PROGRAM/FILE# POINTERS)            
         DC    AL1(PJBOOK-PJKEY)   BOOK                                         
         DC    AL1(PJMEDIA-PJKEY)  MEDIA                                        
         DC    AL1(PJSTAT-PJKEY)   STATION                                      
         DC    AL1(PJBTYPE-PJKEY)  BOOKTYPE                                     
                                                                                
         DC    AL1(CHCODEQU)       C-RECORD (CORRECTION INFO RECORDS)           
         DC    AL1(CHRBOOK-CHKEY)  BOOK                                         
         DC    AL1(CHMEDIA-CHKEY)  MEDIA                                        
         DC    AL1(CHSTAT-CHKEY)   STATION                                      
         DC    AL1(CHBTYP-CHKEY)   BOOKTYPE                                     
                                                                                
         DC    X'FF'                                                            
                                                                                
CNTIDIR  DC    CL7'NTIDIR'                                                      
                                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* GET NEXT CABLE STATION                                                        
* WORK(4)     AREA FOR A(STATION TABLE)                                         
* WORK+4(4)   AREA FOR LENGTH OF STATION TABLE                                  
* R2 HAS THE ADDRESS OF THE KEY WHERE WE NEED TO FILL IN THE STATION            
***********************************************************************         
* SINCE THE CHANGE FROM 4 TO 5-DIGIT STATION CODES, ADDITIONAL CODE             
* WAS NEEDED TO SUPPORT CABLE LISTINGS FOR NATIONAL.  THIS OPTION WAS           
* AVAILABLE ONLY FROM DEM AND IS BELIEVED TO NO LONGER BE NEEDED.               
*&&DO                                                                           
NXTCBLST NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING PRKEY,R2                                                         
*                                                                               
         OC    WORK(4),WORK                                                     
         BNZ   NXTCBL10                                                         
*                                                                               
         L     RF,DBCOMFCS         GET A(CABLE CALL LETTERS)                    
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,NECABCLL                                               
         ICM   RE,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)                                                         
         STCM  R0,15,WORK+4        LENGTH OF TABLE ENTRY                        
         STCM  RE,15,WORK          A(TABLE)                                     
*                                                                               
NXTCBL10 ICM   RE,15,WORK                                                       
         USING NECBCLD,RE                                                       
         CLI   0(RE),X'FF'         EOT?                                         
         BE    NXTCBLNO            DONE                                         
         MVC   DBACTSTA(4),NECBALPH   SET USERS CALL LETTERS                    
         MVI   DBACTSTA+4,C'C'                                                  
         XR    RF,RF                                                            
         ICM   RF,3,NECBNUM        CONVERT TABLE VALUE TO CHAR                  
         CVD   RF,CABPACK                                                       
         OI    CABPACK+L'CABPACK-1,X'0F'                                        
         UNPK  DBCABNUM(4),CABPACK+5(3) AND SEED IN DBLOCK                      
         MVC   PRSTAT(4),DBCABNUM  MOVE STATION TO READ FOR INTO KEY            
         MVI   PRSTAT+4,C'C'                                                    
         MVC   DBACTRMK,=Y(CBLMKT)  REGULAR CABLE                               
         CLI   DBBTYPE,C'N'                                                     
         BNE   *+10                                                             
         MVC   DBACTRMK,=Y(CNADMKT) CABLE NAD                                   
         BRAS  RE,COMCMKT                                                       
         BNE   *+10                                                             
         MVC   DBACTRMK,=Y(ACMCBMKT) ACM(COMMERCIAL AVG) CABLE                  
         DROP  RE                                                               
*                                                                               
         ICM   RE,15,WORK                                                       
         ICM   R0,15,WORK+4                                                     
         AR    RE,R0               ADD LENGTH OF TABLE ENTRY                    
         STCM  RE,15,WORK          A(NEXT ENTRY)                                
         B     NXTCBLY                                                          
*                                                                               
NXTCBLY  CR    RB,RB                                                            
         B     NXTCBLX                                                          
NXTCBLNO CHI   RB,0                                                             
         B     NXTCBLX                                                          
*                                                                               
NXTCBLX  J     XIT                                                              
         DROP  R2                                                               
         LTORG                                                                  
         EJECT                                                                  
*&&                                                                             
***********************************************************************         
* GET NEXT HISPANIC TV AUDIENCE STATION.                                        
* THIS INCLUDES HISPANIC TV AUDIENCE BROADCAST, HISPANIC TV AUDIENCE            
* AGGREGATES, AND SOME SPECIAL STATIONS.                                        
* WORK(4)     AREA FOR A(STATION TABLE)                                         
* WORK+4(4)   AREA FOR LENGTH OF STATION TABLE                                  
* WORK+8(1)   TABLE INDICATOR (SEE EQUATES BELOW)                               
* R2 HAS THE ADDRESS OF THE KEY WHERE WE NEED TO FILL IN THE STATION            
***********************************************************************         
TVABRQ   EQU   0                   TV AUDIENCE BROADCAST                        
TVAAGQ   EQU   1                   TV AUDIENCE AGGREGATES                       
TVASPQ   EQU   2                   TV AUDIENCE SPECIAL                          
NXTHTVST NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING PRKEY,R2                                                         
*                                                                               
         CLI   WORK+8,TVABRQ                                                    
         BE    NXTHTV10                                                         
         CLI   WORK+8,TVAAGQ                                                    
         BE    NXTHTV20                                                         
         CLI   WORK+8,TVASPQ                                                    
         BE    NXTHTV30                                                         
         B     NXTHTVNO                                                         
*                                                                               
NXTHTV10 OC    WORK(4),WORK        START WITH TV AUDIENCE BROADCAST             
         BNZ   NXTHTV14                                                         
*                                                                               
         L     RF,DBCOMFCS         GET A(TV AUDIENCE BROADCAST TABLE)           
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,NEHBRO                                                 
         ICM   RE,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)                                                         
         STCM  R0,15,WORK+4        LENGTH OF TABLE ENTRY                        
         STCM  RE,15,WORK          A(TABLE)                                     
*                                                                               
NXTHTV14 ICM   RE,15,WORK                                                       
         CLI   0(RE),X'FF'         EOT?                                         
         BNE   NXTHTV16                                                         
         MVI   WORK+8,TVAAGQ       CONTINUE WITH TVA AGGREGATES                 
         XC    WORK(4),WORK        NEW TABLE                                    
         B     NXTHTV20                                                         
         USING NEHBRNMD,RE                                                      
NXTHTV16 MVC   PRSTAT(3),NEHBRNET  MOVE STATION TO READ FOR INTO KEY            
         MVC   PRSTAT+3(2),=C' H'                                               
         DROP  RE                                                               
*                                                                               
         ICM   R0,15,WORK+4                                                     
         AR    RE,R0               ADD LENGTH OF TABLE ENTRY                    
         STCM  RE,15,WORK          A(NEXT ENTRY)                                
         B     NXTHTVY                                                          
*                                                                               
NXTHTV20 OC    WORK(4),WORK        CONTINUE WITH TVA AGGREGATES                 
         BNZ   NXTHTV24                                                         
*                                                                               
         L     RF,DBCOMFCS         GET A(TV AUDIENCE AGGREGATE TABLE)           
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,NEHTAG                                                 
         ICM   RE,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)                                                         
         STCM  R0,15,WORK+4        LENGTH OF TABLE ENTRY                        
         STCM  RE,15,WORK          A(TABLE)                                     
*                                                                               
NXTHTV24 ICM   RE,15,WORK                                                       
         CLI   0(RE),X'FF'         EOT?                                         
         BNE   NXTHTV26                                                         
         MVI   WORK+8,TVASPQ       CONTINUE WITH TVA SPECIAL STATIONS           
         XC    WORK(4),WORK        NEW TABLE                                    
         B     NXTHTV30                                                         
         USING NEHTAGD,RE                                                       
NXTHTV26 MVC   PRSTAT(3),NEHTAGNT  MOVE STATION TO READ FOR INTO KEY            
         MVC   PRSTAT+3(2),=C' H'                                               
         DROP  RE                                                               
*                                                                               
         ICM   R0,15,WORK+4                                                     
         AR    RE,R0               ADD LENGTH OF TABLE ENTRY                    
         STCM  RE,15,WORK          A(NEXT ENTRY)                                
         B     NXTHTVY                                                          
*                                                                               
NXTHTV30 OC    WORK(4),WORK        CONTINUE WITH TVA AGGREGATES                 
         BNZ   NXTHTV34                                                         
*                                                                               
         L     RE,=A(NEHTVSP)                                                   
         A     RE,RELO                                                          
         LHI   R0,NEHTVSPL                                                      
         STCM  R0,15,WORK+4        LENGTH OF TABLE ENTRY                        
         STCM  RE,15,WORK          A(TABLE)                                     
*                                                                               
NXTHTV34 ICM   RE,15,WORK                                                       
         CLI   0(RE),X'FF'         EOT?                                         
         BE    NXTHTVNO            DONE                                         
         USING NEHTVSPD,RE                                                      
         MVC   PRSTAT(4),NEHTVSST  MOVE STATION TO READ FOR INTO KEY            
         MVI   PRSTAT+4,C'H'                                                    
         DROP  RE                                                               
*                                                                               
         ICM   R0,15,WORK+4                                                     
         AR    RE,R0               ADD LENGTH OF TABLE ENTRY                    
         STCM  RE,15,WORK          A(NEXT ENTRY)                                
         B     NXTHTVY                                                          
*                                                                               
NXTHTVY  CR    RB,RB                                                            
         B     NXTHTVX                                                          
NXTHTVNO CHI   RB,0                                                             
         B     NXTHTVX                                                          
*                                                                               
NXTHTVX  J     XIT                                                              
         DROP  R2                                                               
         LTORG                                                                  
*                                                                               
*---------------------------------------------------------------------*         
* TABLE OF SPECIAL TV AUDIENCE STATIONS                                         
*---------------------------------------------------------------------*         
NEHTVSP  DC    CL4'HUT '                                                        
         DC    X'FF'                                                            
         EJECT                                                                  
***********************************************************************         
* GET NEXT HISPANIC GENERAL MARKET STATION                                      
* WORK(4)     AREA FOR A(STATION TABLE)                                         
* WORK+4(4)   AREA FOR LENGTH OF STATION TABLE                                  
* WORK+8(1)   TABLE INDICATOR (SEE EQUATES BELOW)                               
* R2 HAS THE ADDRESS OF THE KEY WHERE WE NEED TO FILL IN THE STATION            
***********************************************************************         
GMKTEQ   EQU   0                   GENERAL MARKET ENGLISH                       
GMKTSQ   EQU   1                   GENERAL MARKET SPECIAL                       
NXTHGMST NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING PRKEY,R2                                                         
*                                                                               
         CLI   WORK+8,GMKTEQ                                                    
         BE    NXTHGM10                                                         
         CLI   WORK+8,GMKTSQ                                                    
         BE    NXTHGM20                                                         
         B     NXTHGMNO                                                         
*                                                                               
NXTHGM10 OC    WORK(4),WORK                                                     
         BNZ   NXTHGM14                                                         
*                                                                               
         L     RF,DBCOMFCS         GET A(BROADCAST/HISP GEN MRKT TABLE)         
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,NEHGES                                                 
         ICM   RE,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)                                                         
         STCM  R0,15,WORK+4        LENGTH OF TABLE ENTRY                        
         STCM  RE,15,WORK          A(TABLE)                                     
*                                                                               
NXTHGM14 ICM   RE,15,WORK                                                       
         CLI   0(RE),X'FF'         EOT?                                         
         BNE   NXTHGM16                                                         
         MVI   WORK+8,GMKTSQ       CONTINUE WITH GEN MK SPECIAL STATNS          
         XC    WORK(4),WORK        NEW TABLE                                    
         B     NXTHGM20                                                         
         USING NEBRDNMD,RE                                                      
NXTHGM16 MVC   PRSTAT(3),NEBRDNET  MOVE STATION TO READ FOR INTO KEY            
         MVC   PRSTAT+3(2),=C' H'                                               
         DROP  RE                                                               
*                                                                               
         ICM   R0,15,WORK+4                                                     
         AR    RE,R0               ADD LENGTH OF TABLE ENTRY                    
         STCM  RE,15,WORK          A(NEXT ENTRY)                                
         B     NXTHGMY                                                          
*                                                                               
NXTHGM20 OC    WORK(4),WORK                                                     
         BNZ   NXTHGM24                                                         
*                                                                               
         L     RE,=A(NEHGMSP)                                                   
         A     RE,RELO                                                          
         LHI   R0,NEHGMSPL                                                      
         STCM  R0,15,WORK+4        LENGTH OF TABLE ENTRY                        
         STCM  RE,15,WORK          A(TABLE)                                     
*                                                                               
NXTHGM24 ICM   RE,15,WORK                                                       
         CLI   0(RE),X'FF'         EOT?                                         
         BE    NXTHGMNO            DONE                                         
         USING NEHGMSPD,RE                                                      
         MVC   PRSTAT(4),NEHGMSST  MOVE STATION TO READ FOR INTO KEY            
         MVI   PRSTAT+4,C'H'                                                    
         DROP  RE                                                               
*                                                                               
         ICM   R0,15,WORK+4                                                     
         AR    RE,R0               ADD LENGTH OF TABLE ENTRY                    
         STCM  RE,15,WORK          A(NEXT ENTRY)                                
         B     NXTHGMY                                                          
*                                                                               
NXTHGMY  CR    RB,RB                                                            
         B     NXTHGMX                                                          
NXTHGMNO CHI   RB,0                                                             
         B     NXTHGMX                                                          
*                                                                               
NXTHGMX  J     XIT                                                              
         DROP  R2                                                               
         LTORG                                                                  
*                                                                               
*---------------------------------------------------------------------*         
* TABLE OF SPECIAL GENERAL MARKET ENGLICH STATIONS                              
*---------------------------------------------------------------------*         
NEHGMSP  DC    CL4'PAR '                                                        
         DC    CL4'PAX '                                                        
         DC    X'FF'                                                            
         EJECT                                                                  
***********************************************************************         
* GET NEXT HISPANIC GENERAL MARKET AGGREGATE                                    
* WORK(4)     AREA FOR A(STATION TABLE)                                         
* WORK+4(4)   AREA FOR LENGTH OF STATION TABLE                                  
* R2 HAS THE ADDRESS OF THE KEY WHERE WE NEED TO FILL IN THE STATION            
***********************************************************************         
NXTHGAST NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING PRKEY,R2                                                         
*                                                                               
         OC    WORK(4),WORK                                                     
         BNZ   NXTHGA10                                                         
*                                                                               
         L     RF,DBCOMFCS         GET A(BROADCAST/HISP GEN MRKT TABLE)         
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,NEHGAG                                                 
         ICM   RE,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)                                                         
         STCM  R0,15,WORK+4        LENGTH OF TABLE ENTRY                        
         STCM  RE,15,WORK          A(TABLE)                                     
*                                                                               
NXTHGA10 ICM   RE,15,WORK                                                       
         USING NEHGAGD,RE                                                       
         CLI   0(RE),X'FF'         EOT?                                         
         BE    NXTHGANO            DONE                                         
         MVC   PRSTAT(3),NEHGAGNT  MOVE STATION TO READ FOR INTO KEY            
         MVC   PRSTAT+3(2),=C' H'                                               
         DROP  RE                                                               
*                                                                               
         ICM   R0,15,WORK+4                                                     
         AR    RE,R0               ADD LENGTH OF TABLE ENTRY                    
         STCM  RE,15,WORK          A(NEXT ENTRY)                                
         B     NXTHGAY                                                          
*                                                                               
NXTHGAY  CR    RB,RB                                                            
         B     NXTHGAX                                                          
NXTHGANO CHI   RB,0                                                             
         B     NXTHGAX                                                          
*                                                                               
NXTHGAX  J     XIT                                                              
         DROP  R2                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
                                                                                
                                                                                
         TITLE 'SUBR01 - FREE UP SPACE'                                         
***********************************************************************         
*SUBR01 - FREES UP SPACE                                                        
***********************************************************************         
SUBR01   DS    0H                                                               
         NMOD1 0,**GET1**,RA,RR=RE,CLEAR=YES                                    
         ZICM  RC,1(R1),(7)                                                     
*        LR    RC,R1                                                            
         USING DEGETD,RC                                                        
         ZIC   RF,0(R1)                                                         
         BCTR  RF,0                                                             
         SLL   RF,2                                                             
         B     SUBR1#(RF)                                                       
*                                                                               
DEMX1    XIT1                                                                   
*                                                                               
GLOBALQ  EQU   (GLOBAL#-*)/4+1                                                  
CNVENGQ  EQU   (CNVENG#-*)/4+1                                                  
BBMHOMQ  EQU   (BBMHOM#-*)/4+1                                                  
CSIHOMQ  EQU   (CSIHOM#-*)/4+1                                                  
NSIHOMQ  EQU   (NSIHOM#-*)/4+1                                                  
MKHOSTQ  EQU   (MKHOST#-*)/4+1                                                  
STALNKQ  EQU   (STALNK#-*)/4+1                                                  
CHKLPMQ  EQU   (CHKLPM#-*)/4+1                                                  
FUSCHKQ  EQU   (FUSCHK#-*)/4+1                                                  
CHKPPMQ  EQU   (CHKPPM#-*)/4+1                                                  
*                                                                               
SUBR1#   DS    0H                                                               
GLOBAL#  B     GLOBAL              ARB/MFX PROCESS ELEMENTS                     
CNVENG#  B     CNVENGFR            MOVE IN FRCH OR ENGLISH MKT#'S               
BBMHOM#  B     BBMHOM                                                           
CSIHOM#  B     CSIHOM                                                           
NSIHOM#  B     NSIHOM                                                           
MKHOST#  B     MKHOSTC                                                          
STALNK#  B     STALINK             STATION CALL LETTER LINK                     
CHKLPM#  B     CHKLPM              LPM MARKET CHECK                             
FUSCHK#  B     FUSCHK                                                           
CHKPPM#  B     CHKPPM                                                           
*                                                                               
*********************************************************************           
* GLOBAL -  EQUATE GLOBAL STATIONS FOR CANADIAN DEMO FILES                      
* NOTE: NOT JUST FOR 'GLOBAL' STATIONS!                                         
*********************************************************************           
GLOBAL   DS    0C                                                               
         CLC   DBSELSTA(4),=C'ASN '  BYPASS ANOMALIES                           
         BE    GLOBALX                                                          
         CLC   DBSELSTA(4),=C'YTV '  BYPASS ANOMALIES                           
         BE    GLOBALX                                                          
         CLI   DBBTYPE,C'W'        WEEKLY ALREADY CONVERTED                     
*        BE    GLOBALX                                                          
         BE    GLOBALW                                                          
         CLI   NOHARD,1                                                         
         BE    GLOBALX                                                          
* CHECK FOR SPECIAL CONDITIONS  DUMMYS WITH UNIQUE CALL LETTERS                 
         LA    R1,SPCLTAB          POINT TO SPECIALS                            
SPCLCHK  CLI   0(R1),X'FF'         EOT - LEAVE ALONE                            
         BE    SPCLCHKX                                                         
         CLC   DBSELSTA(4),0(R1)   FOUND SPECIAL SITUATION                      
         BE    *+12                YES - SET STATION                            
         LA    R1,L'SPCLTAB(R1)                                                 
         B     SPCLCHK                                                          
         MVC   DBSELSTA(4),4(R1)   OVERRIDE STATION                             
         MVC   DBSELMK(2),8(R1)    OVERRIDE MARKET                              
SPCLCHKX DS    0C                                                               
*                                                                               
         LA    R1,GLBCNVT          POSSIBLE NETWORK CHECK                       
         CLI   DBSELSTA+1,C'X'                                                  
         BE    *+8                                                              
         CLI   DBSELSTA+1,C'Y'                                                  
         BE    *+12                                                             
         CLI   DBSELSTA+1,C'Z'                                                  
         BNE   GLBCHK                                                           
         LA    R1,GXBCNVT                                                       
GXBCHK   CLI   0(R1),X'FF'         EOT - JUST EXIT                              
         BE    GLBCHK                                                           
         CLC   DBSELSTA(2),0(R1)   MATCH FIRST 2 CHARACTERS                     
         BE    *+12                                                             
         LA    R1,L'GXBCNVT(R1)                                                 
         B     GXBCHK                                                           
         LA    R1,1(R1)            ADJUST DISPLACEMENT FOR COMMON               
         B     GLOBAL1              ROUTINES                                    
*                                                                               
GLBCHK   CLI   0(R1),X'FF'         EOT - JUST EXIT                              
*        BE    GLOBALX                                                          
         BE    GLOBALF                                                          
         CLC   DBSELSTA(1),0(R1)   MATCH FIRST CHARACTER                        
         BE    *+12                                                             
         LA    R1,L'GLBCNVT(R1)                                                 
         B     GLBCHK                                                           
*                                                                               
GLOBAL1  LA    RE,GLBLTAB                                                       
GLOBAL2  CLI   0(RE),X'FF'         END OF TABLE                                 
*        BE    GLOBALX                                                          
         BE    GLOBALF                                                          
         CLC   DBSELSTA(4),0(RE)   IS IT THIS ONE                               
         BE    *+12                                                             
         LA    RE,L'GLBLTAB(RE)    NO TRY THE NEXT                              
         B     GLOBAL2                                                          
*                                                                               
         SR    RF,RF               SET FOR NOT FOUND                            
         CLI   DBSELSRC,C'A'       OTHERWISE SET DISP.                          
         BNE   *+8                 FOR THIS SERVICE                             
         LA    RF,4                                                             
         CLI   DBSELSRC,C'N'                                                    
         BNE   *+8                                                              
         LA    RF,6                                                             
         LTR   RF,RF               EXIT IF UNDEFINED                            
         BZ    GLOBALX                                                          
*                                                                               
         MVC   DBSELSTA(4),1(R1)   SET DEMO FILE CALL LETTERS                   
         LA    RE,0(RE,RF)         POINT TO MARKET                              
         MVC   DBSELMK,0(RE)                                                    
         CLC   DBSELSTA(4),=C'CIII' HANDLE CIII EXCEPTIONS                      
         BE    GLOBALG                                                          
         CLC   DBSELSTA(4),=C'CIHF' SPECIAL SHIT                                
         BNE   GLOBALX                                                          
         CLC   DBSELMK,=H'431'     431 HOME - NOV/90 AND SUBS                   
         BNE   GLOBALI2                                                         
         CLI   DBSELBK,0                                                        
         BE    *+14                                                             
         CLC   DBSELBK,=AL2(SEP_90)                                             
         BL    GLOBALX                                                          
         XC    DBSELMK,DBSELMK                                                  
         B     GLOBALX                                                          
*                                                                               
GLOBALI2 CLC   DBSELMK,=H'430'     430 HOME - PRIOR NOV/90                      
         BNE   GLOBALI3                                                         
         CLI   DBSELBK,0                                                        
         BE    GLOBALX                                                          
         CLC   DBSELBK,=AL2(SEP_90)                                             
         BH    GLOBALX                                                          
         XC    DBSELMK,DBSELMK                                                  
         B     GLOBALX                                                          
*                                                                               
GLOBALI3 CLC   DBSELMK,=H'2080'    2080 HOME - AFTER JUL/92                     
         BNE   GLOBALX              (BBM)                                       
         CLI   DBSELBK,0                                                        
         BE    GLOBALX                                                          
         CLC   DBSELBK,=AL2(AUG_92)                                             
         BL    GLOBALX                                                          
         XC    DBSELMK,DBSELMK                                                  
         B     GLOBALX                                                          
*                                                                               
GLOBALG  CLC   DBSELMK,=H'446'     MARKET 446 CHANGED TO 495                    
         BNE   GLOBALX             NOV/91                                       
         CLI   DBSELBK,0                                                        
         BE    *+14                                                             
         CLC   DBSELBK,=AL2(SEP_91)                                             
         BL    GLOBALX                                                          
         MVC   DBSELMK,=H'495'                                                  
         B     GLOBALX                                                          
*                                                                               
* AS OF NOV2001 - CANADIAN SPECIALTY CABLE WILL CEASE TO USE DUMMY CALL         
* LETTERS. ONCE AN AGENCY HAS HAD DATA CONVERTED, CALLS WILL BE FOR             
* TRUE STATION CALL LETTERS WHICH WE MUST CONVERT BACK TO DUMMY SINCE           
* SOME WEEKLY BBM DATA IS STILL HELD UNDER DUMMY CALL LETTERS.                  
GLOBALW  CLC   DBSELMK,=AL2(9109)                                               
         BNE   GLOBALX             NOT VANCOUVER (CMA)                          
         LA    R1,WKLYFIXT                                                      
GLOBW10  CLI   0(R1),X'FF'         EOT - JUST EXIT                              
         BE    GLOBALX                                                          
         CLC   DBSELSTA(4),0(R1)   MATCH CALL LETTER                            
         BE    *+12                                                             
         LA    R1,L'WKLYFIXT(R1)                                                
         B     GLOBW10                                                          
         MVC   DBSELSTA(4),4(R1)   SET DEMO FILE DUMMY CALL LETTERS             
         B     GLOBALX                                                          
*                                                                               
* NOV2001 - BBM/NIELSEN SUPPLIED CALL LETTERS NOT MATCH DDS DOCUMENTED          
* ONES. SUPPLIED DATA IS LOADED AS IS - THUS A CALL USING DDS LETTERS           
* WILL NOT PICK UP DATA. CORRECT HERE FOR NOW                                   
GLOBALF  LA    R1,CALLFIXT        (ONLY HERE IF NOT FIXED ANYTHING YET)         
GLOBF10  CLI   0(R1),X'FF'         EOT - JUST EXIT                              
         BE    GLOBALX                                                          
         CLC   DBSELSTA(4),0(R1)   MATCH DDS CALL LETTERS                       
         BE    *+12                                                             
         LA    R1,L'CALLFIXT(R1)                                                
         B     GLOBF10                                                          
         CLI   DBSELSRC,C'N'                                                    
         BE    *+8                                                              
         LA    R1,4(R1)            BUMP FOR BBM CODE                            
         CLC   4(4,R1),=C'XXXX'    ENSURE WE KNOW OVERRIDE                      
         BE    GLOBALX                                                          
         MVC   DBSELSTA(4),4(R1)   SET DEMO FILE CALL LETTERS                   
*                                                                               
GLOBALX  B     DEMX1                                                            
* *******************************************************************           
* CNVENGFR- MOVE IN ENG OR FRENCH MKT NUMBERS FOR SPECIAL STATIONS              
* *******************************************************************           
*                                                                               
CNVENGFR DS    0C                                                               
         CLI   DBSELSRC,C'A'       SOURCE IS BBM NEEDS SPECIAL CODE             
         BNE   CNVENFR2            OTHERS DON'T                                 
************************************************************                    
* HARD CODE:  FOR CKMI/NKMI                                *                    
************************************************************                    
         CLC   DBSELSTA(4),=C'NKMI' CHANGED MARKET 9711                         
         BE    *+10                                                             
         CLC   DBSELSTA(4),=C'CKMI' CHANGED MARKET 9711                         
         BNE   CNVENFR1                                                         
         CLI   DBSELBK,0           DEAL WITH LATEST                             
         BE    CNVENFR1                                                         
         CLC   DBSELBK(2),=AL2(NOV_97)                                          
         BL    CNVENFRX                                                         
************************************************************                    
* HARD CODE:  FOR CFTM                                                          
************************************************************                    
CNVENFR1 CLC   DBSELMK,=XL2'13CD'  CHECK FOR MARKET 5069                        
         BNE   CNVENFR2                                                         
         CLC   DBSELSTA(4),=CL4'CFTM'                                           
         BNE   CNVENFR2                                                         
         MVC   DBSELMK,=XL2'13D0'  MOVE IN MARKET 5072                          
         B     CNVENFRX                                                         
************************************************************                    
CNVENFR2 LA    RE,CSIAFTB         RE POINTS TO STATION LIST                     
         CLI   DBSELSRC,C'N'      CSI - OK, PROCEED                             
         BE    CNVENFR4                                                         
         LA    RE,BBMAFTB         BBM - CHECK SOME CRITERIA                     
         CLI   DBBTYPE,C'W'        - ONLY PROCEED IF BBM MONTHLY                
         BE    CNVENFR4                                                         
         CLC   DBSELBK,=AL2(MAR_07) - AND BEFORE MARCH 2007                     
         BNL   CNVENFRX                                                         
         CLC   DBSELBK,=X'0000'                                                 
         BE    CNVENFRX                                                         
*                                                                               
CNVENFR4 CLI   0(RE),X'FF'         END OF TABLE                                 
         BE    CNVENFRX                                                         
         CLC   DBSELSTA(4),0(RE)   IS IT THIS ONE                               
         BE    *+12                                                             
         LA    RE,6(RE)            NO TRY THE NEXT                              
         B     CNVENFR4                                                         
************************************************************                    
* HARD CODE:   FOR CIII                                                         
************************************************************                    
         OC    DBSELMK,DBSELMK     IF MARKET NUMBER NOT ZERO                    
         BNZ   CNVENFR6            EXIT                                         
         CLC   DBSELSTA(4),=C'CIII'                                             
         BE    CNVENFRX                                                         
         MVC   DBSELMK,4(RE)       MOVE MARKET VALUE IN                         
         B     CNVENFRX                                                         
*                                                                               
CNVENFR6 CLC   DBSELSTA(4),=CL4'CIII' CIII/GOTT HAS LANG BOOK                   
         BNE   CNVENFRX                                                         
         CLC   DBSELMK,=H'5069'    BBM                                          
         BE    *+10                                                             
         CLC   DBSELMK,=H'0444'    NSI                                          
         BNE   *+10                                                             
         MVC   DBSELMK,4(RE)       MOVE MARKET VALUE IN                         
*                                                                               
CNVENFRX B     DEMX1               FOR THIS SERVICE                             
         EJECT                                                                  
*                                                                               
******************************************************************              
*BBMHOM - THIS CODE IS DEAD, THERE IS A NEW BBM TABLE, IN DEMTABS               
******************************************************************              
BBMHOM   DS    0C                                                               
         B     DEMX1                                                            
         SPACE 2                                                                
******************************************************************              
*CSIHOM - THIS CODE IS DEAD, THERE IS A NEW HOMESTA TAB IN DEMTABS              
******************************************************************              
CSIHOM   DS    0C                                                               
         B     DEMX1                                                            
         SPACE 2                                                                
******************************************************************              
*NSIHOM - THIS CODE IS DEAD, THE TABLE WAS ONE ENTRY OF X'FF'                   
******************************************************************              
NSIHOM   DS    0C                                                               
         B     DEMX1                                                            
         SPACE 2                                                                
*                                                                               
MKHOSTC  DS    0C                                                               
         USING MLKEY,R2                                                         
         OC    MLKMKT,MLKMKT                                                    
         BZ    MKHOSTCX                                                         
         LA    RE,GLBCNVT                                                       
MKHOSTC1 CLI   0(RE),X'FF'                                                      
         BE    MKHOSTCX                                                         
         CLC   1(4,RE),MLSTAT                                                   
         BE    *+12                                                             
         LA    RE,L'GLBCNVT(RE)                                                 
         B     MKHOSTC1                                                         
*                                                                               
MKHOSTC2 LA    RF,GLBLTAB                                                       
         LA    R1,4                                                             
         CLI   MLSRC,C'N'                                                       
         BNE   *+8                                                              
         LA    R1,2(R1)                                                         
*                                                                               
MKHOSTC3 CLI   0(RF),X'FF'                                                      
         BE    MKHOSTCX                                                         
         CLC   0(1,RE),0(RF)                                                    
         BE    *+12                                                             
MKHOSTC4 LA    RF,L'GLBLTAB(RF)                                                 
         B     MKHOSTC3                                                         
         LA    R7,0(R1,RF)                                                      
         CLC   0(2,R7),MLKMKT                                                   
         BNE   MKHOSTC4                                                         
         L     R2,DBAREC                                                        
         MVC   MLSTAT(4),0(RF)                                                  
         XC    MLKMKT,MLKMKT                                                    
MKHOSTCX B     DEMX1                                                            
         DROP  R2                                                               
*                                                                               
STALINK  DS    0C                                                               
***      L     RA,BASE2            OUT 6/13/07                                  
         L     R9,BASE3                                                         
* NESN REPORTED AS APRIL06(C) INSTEAD OF THE STANDARD BOOK                      
* NESN ASKED NIELSON TO REPORT THE STATION DIFFERENTLY, BUT THE                 
* CHANGE NIELSON MADE CHANGED AN INDICATOR FIELD WE USED TO DETERMINE           
* IF THE STATION IS A CABLE STATION AND TO BE LOADED UNDER BKTYPE"C"            
* IF WE ASK FOR APRIL 06 NO BOOKTYPE- READ BOOKTYPE C                           
        CLC    =C'NESN',DBSELSTA                                                
        BNE    *+10                                                             
        CLC    =AL2(APR_06),DBSELBK                                             
        BNE    *+8                                                              
        CLI    DBBTYPE,0                                                        
        BNE    *+8                                                              
        MVI    DBBTYPE,C'C'                                                     
*                                                                               
        CLC    =C'WBVA',DBSELSTA                                                
        BNE    WBVAX                                                            
        CLC    DBSELBK,=AL2(NOV_06)        CHANGED TO WCW5                      
        BL     WBVAX                                                            
        MVC    DBSELSTA(4),=C'WCW5'                                             
        CLC    DBSELBK,=AL2(FEB_07)        WCW5 CHANGE TO                       
        BL     WBVAX                       EWCW  FEB07 BOOK                     
        MVC    DBSELSTA(4),=C'EWCW'                                             
WBVAX   DS     0C                                                               
*                                                                               
        CLC    =C'VRVS',DBSELSTA                                                
        BNE    VRVSXX                                                           
        MVC    DBSELSTA(4),=C'WBVA'         PREVIOUS TO NOV06=WBVA              
        CLC    DBSELBK,=AL2(NOV_06)         NOV06 OR LATER                      
        BL     VRVSXX                       VRVS=WCW5                           
        MVC    DBSELSTA(4),=C'WCW5'                                             
        CLC    DBSELBK,=AL2(FEB_07)        WCW5 CHANGE TO                       
        BL     VRVSXX                      EWCW  FEB07 BOOK                     
        MVC    DBSELSTA(4),=C'EWCW'                                             
VRVSXX   DS    0H                                                               
*                                                                               
        CLC    =C'EWCW',DBSELSTA                                                
        BNE    EWCWXX                                                           
        CLC    DBSELBK,=AL2(FEB_07)                                             
        BNL    EWCWXX                                                           
        MVC    DBSELSTA(4),=C'WCW5'                                             
        CLC    DBSELBK,=AL2(NOV_06)                                             
        BNL    EWCWXX                                                           
        MVC    DBSELSTA(4),=C'WBVA'                                             
EWCWXX   DS    0H                                                               
         CLC   =C'KUPT',DBSELSTA           KUPT = KMYL EFFECTIVE                
         BNE   KUPTX                       JUL06                                
         CLC   DBSELBK,=AL2(JUL_06)                                             
         BL    *+10                                                             
         MVC   DBSELSTA(4),=C'KMYL'                                             
KUPTX    DS    0H                                                               
*                                                                               
         CLC   =C'KMYL',DBSELSTA           IF USING KMYL                        
         BNE   KMYLX                                                            
         CLC   DBSELBK,=AL2(MAY_06)                                             
         BH    KMYLX                                                            
         MVC   DBSELSTA,=C'KUPT'           =KUPT PRIOR TO NOV05                 
         CLC   DBSELBK,=AL2(FEB_06)                                             
         BL    *+10                                                             
         MVC   DBSELSTA,=C'KU14'           =KU14 FROM 0206-0506                 
KMYLX    DS    0H                                                               
*                                                                               
*&&DO                                                                           
* FOLLOWING CODE WAS TAKEN OUT AND SUPPORTED IN DEDEMTABS                       
* TABLE                                                                         
         CLI   DBSELMED,C'T'                                                    
         BNE   STALINKX                                                         
         CLC   =C'KHTV',DBSELSTA           KHTV = KHWB BEFORE MAY06             
         BNE   KHTVX                            =KHCW MAY06 AND AFTER           
         MVC   DBSELSTA(4),=C'KHCW'                                             
         CLC   DBSELBK,=AL2(MAY_06)                                             
         BNL   *+10                                                             
         MVC   DBSELSTA(4),=C'KHWB'                                             
KHTVX    DS    0H                                                               
*                                                                               
         CLC   =C'KHCW',DBSELSTA           IF USING KHCW                        
         BNE   KHCWX                                                            
         CLC   DBSELBK,=AL2(FEB_06)                                             
         BH    KHCWX                                                            
         MVC   DBSELSTA,=C'KHTV'           =KHTV PRIOR TO OCT99                 
         CLC   DBSELBK,=AL2(OCT_99)                                             
         BL    *+10                                                             
         MVC   DBSELSTA,=C'KHWB'           =KHWB FROM OCT99 FEB06               
KHCWX    DS    0H                                                               
*&&                                                                             
*                                                                               
         CLC   DBSELSTA(4),=C'JRWB'  JRWB WAS REALLY WB26                       
         BNE   *+10                WB26 CHANGED TO WB16 EFF FEB01               
         MVC   DBSELSTA,=C'WB16T'  THIS ALLOWS PROPER LOOKUP AND                
*                                                                               
         CLC   DBSELSTA(4),=C'WB16' WB16T CHANGED TO WRWB EFFECTIVE             
         BNE   WB16TXX              JUL03                                       
         CLC   DBSELBK,=AL2(JUL_03) THIS SHOULD ACCOUNT FOR JRWB                
         BL    WB16TXX              TO ALSO SWITCH TO WRWB EFF JUL/03           
         MVC   DBSELSTA,=C'WRWBT'   BUT STAY AS WB16T PRIOR TO JUL/03           
WB16TXX  DS    0H                                                               
*                                                                               
         CLC   DBFILE,=C'IUN'      DON'T PRE-EQUATE INVENTORY                   
         BE    WWWB5X                                                           
         CLI   DBSELBK,0           4TH CHANGE FOR WWWB                          
         BE    WWWB5X              REQUIRES SPECIAL CODE                        
         CLC   DBSELBK,=AL2(MAY_01)                                             
         BH    WWWB5X                                                           
         CLC   DBSELSTA(4),=C'WWWB'  WWWB WAS GOES TO WFVT                      
         BNE   *+10                   PRIOR TO JUL/01                           
         MVC   DBSELSTA,=C'WFVTT'   WAS WFVT IN THIS MARKET                     
*                                                                               
WWWB5X   DS    0C                                                               
         CLC   DBSELBK,=AL2(APR_06)                                             
         BL    WWWB6X                                                           
         CLC   DBSELSTA(4),=C'WWWB'  WWWB WAS GOES TO WFVT                      
         BNE   *+10                   PRIOR TO JUL/01                           
         MVC   DBSELSTA,=C'WMYTT'   WAS WFVT IN THIS MARKET                     
WWWB6X   DS    0C                                                               
*                                                                               
* DEAL WITH SPECIAL CASE WHERE SOMEONE CHANGED THEIR STATION                    
* NAME TO WCIV IMMEDIATLY AFTER IT BECAME AVAILABLE                             
*                                                                               
         CLC   DBFILE,=C'TP '        FILE=TIME PERIOD,                          
         BE    STALNK20                                                         
*                                                                               
         CLC   =CL4'WMMP',DBSELSTA                                              
         BNE   CHKWCIV2                                                         
         CLC   DBSELBK,=AL2(OCT_14)                                             
         BNH   CHKWCIV2                                                         
         MVC   DBSELSTA(4),=CL4'WCIV'                                           
         B     STALINKX                                                         
*                                                                               
CHKWCIV2 CLC   =CL4'ECIV',DBSELSTA                                              
         BNE   CHKWCIV4                                                         
         CLC   DBSELBK,=AL2(OCT_14)                                             
         BH    CHKWCIV4                                                         
         MVC   DBSELSTA(4),=CL4'WCIV'                                           
         B     STALINKX                                                         
*                                                                               
CHKWCIV4 CLI   DBVOPT,X'40'         CHECK IF POSTING CALL                       
         BE    CHKNVMY1             YES EXIT                                    
         CLC   =CL4'WCIV',DBSELSTA                                              
         BNE   CHKNVMY1                                                         
         CLC   DBSELBK,=AL2(OCT_14)                                             
         BH    STALNK20                                                         
         MVC   DBSELSTA(4),=CL4'WMMP'                                           
         B     STALINKX                                                         
*                                                                               
* DEAL WITH SPECIAL CASE WHERE SOMEONE CHANGED THEIR STATION                    
* NAME TO NVMY IMMEDIATLY AFTER IT BECAME AVAILABLE                             
*                                                                               
CHKNVMY1 CLC   =CL4'OVMY',DBSELSTA                                              
         BNE   CHKNVMY2                                                         
         CLC   DBSELBK,=AL2(JAN_15)                                             
         BNH   CHKNVMY2                                                         
         MVC   DBSELSTA(4),=CL4'NVMY'                                           
         B     STALINKX                                                         
*                                                                               
CHKNVMY2 CLI   DBVOPT,X'40'         CHECK IF POSTING CALL                       
         BE    CHKNVMY4             YES EXIT                                    
         CLC   =CL4'KVMY',DBSELSTA                                              
         BNE   CHKNVMY4                                                         
         CLC   DBSELBK,=AL2(JAN_15)                                             
         BH    CHKNVMY4                                                         
         MVC   DBSELSTA(4),=CL4'NVMY'                                           
         B     STALINKX                                                         
*                                                                               
CHKNVMY4 CLI   DBVOPT,X'40'         CHECK IF POSTING CALL                       
         BE    STALNK20             YES EXIT                                    
         CLC   =CL4'NVMY',DBSELSTA                                              
         BNE   STALNK20                                                         
         CLC   DBSELBK,=AL2(JAN_15)                                             
         BH    STALNK20                                                         
         MVC   DBSELSTA(4),=CL4'OVMY'                                           
         B     STALINKX                                                         
*                                                                               
* CALL DEMTABS TO GET A(STATION CALL LETTER LINK TABLE)                         
*                                                                               
STALNK20 CLI   DBFUNCT,DBGETMB                                                  
         BE    STALINKX                                                         
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,CALL_LNK                                               
         ICM   RE,15,0(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            R0 HAS LENGTH OF TABLE ENTRY                 
         USING CALLLNKD,RE                                                      
STALNK30 CLI   0(RE),X'FF'         EOT                                          
         BE    STALINKX                                                         
         CLC   CALLSTAT,DBSELSTA                                                
         BE    STALNK50                                                         
         AR    RE,R0                                                            
         B     STALNK30                                                         
STALNK50 CLC   DBSELBK,CALLSTBK                                                 
         BL    STALNK52                                                         
         CLC   DBSELBK,CALLEBK                                                  
         BH    STALNK54                                                         
         MVC   DBSELSTA,CALLSTAT  FOUND STATION LINK, MOVE IN STATION           
         B     STALINKX                                                         
* DBSELBK IS EARLIER THAN THIS TABLE ENTRY'S BOOK RANGE. MOVE BACKWARDS         
STALNK52 SR    RE,R0                                                            
         B     STALNK50                                                         
* DBSELBK IS LATER THAN THIS TABLE ENTRY'S BOOK RANGE.  MOVE BACKWARDS          
STALNK54 AR    RE,R0                                                            
         B     STALNK50                                                         
                                                                                
         DROP  RE                                                               
                                                                                
STALINKX B     DEMX1                                                            
*-------------------------------------------------------------------            
CHKLPM   DS    0C                                                               
         CLI   DBSELMED,C'T'                                                    
         BNE   CHKPLATX                                                         
         CLI   DBBTYPE,C'I'                                                     
         BE    *+12                                                             
         CLI   DBBTYPE,C'P'                                                     
         BNE   CHKPLATX                                                         
* WE SHOULD CHECK LPM PERIODS HERE FOR NSI USTV- BEN                            
         LA    RE,LPMENDP                                                       
*   LOOK AT REGULAR PARALLEL TABLE                                              
         CLI   DBBTYPE,C'I'        UNLESS HISPANIC                              
         BNE   CHKPLAT1                                                         
         LA    RE,LPMENDI                                                       
CHKPLAT1 CLI   0(RE),X'FF'         SCAN FOR THE MARKET                          
         BE    CHKPLATX                                                         
         CLC   DBSELRMK,0(RE)                                                   
         BE    *+12                                                             
         LA    RE,L'LPMENDP(RE)                                                 
         B     CHKPLAT1                                                         
                                                                                
         OC    DBSELBK,DBSELBK                                                  
         BZ    CHKPLAT2                                                         
         CLC   DBSELBK,2(RE)                                                    
         BNH   CHKPLATX                                                         
         B     CHKPLAT4                                                         
CHKPLAT2 CLC   DBSELDAT,2(RE)                                                   
         BL    CHKPLATX                                                         
CHKPLAT4 CLI   DBBTYPE,C'I'                                                     
         BNE   *+12                                                             
         MVI   DBBTYPE,C'H'        RESET HISPANIC                               
         B     CHKPLATX                                                         
         MVI   DBBTYPE,0           RESET NOTNAL                                 
CHKPLATX DS    0C                                                               
* ZERO CELL STATION LISTING JUL06 AND AFTER ZEROCELL WENT LIVE                  
         CLI   DBFUNCT,DBGETMS                                                  
         BNE   LPMCHKX                                                          
         CLC   DBSELBK,=AL2(JUL_06)                                             
         BL    LPMCHKX                                                          
         CLI   DBBTYPE,C'1'        ALLOW ZERO CELL STANDARD                     
         BNE   *+8                                                              
         MVI   DBBTYPE,0           ZERO CELL STANDARD                           
         CLI   DBBTYPE,C'2'        ALLOW ZERO CELL HISPANIC                     
         BNE   *+8                                                              
         MVI   DBBTYPE,C'H'        HISPANIC                                     
         CLI   DBBTYPE,C'3'        ALLOW ZERO CELL CABLE                        
         BNE   *+8                                                              
         MVI   DBBTYPE,C'C'        CABLE                                        
         CLI   DBBTYPE,C'4'        ALLOW ZERO CELL WIRED                        
         BNE   *+8                                                              
         MVI   DBBTYPE,C'W'        WIRED                                        
*                                                                               
LPMCHKX  B     DEMX1                                                            
         EJECT                                                                  
*------------------------------------------------------------------             
* CHECK FOR FUSION LPM MARKETS AND REDIRECT TO NSI WIRED                        
FUSCHK   DS    0C                                                               
*                                                                               
         MVI   FCBLEFLG,C'N'       SET FLAG IF NSI WIRED OR                     
         CLI   DBSELMED,C'T'       FUSION                                       
         BNE   *+8                                                              
         CLI   DBBTYPE,C'W'                                                     
         BE    *+8                                                              
         CLI   DBSELSRC,C'F'                                                    
         BNE   *+8                                                              
         MVI   FCBLEFLG,C'Y'                                                    
*                                                                               
         CLI   DBFUNCT,DBGETAMB     DONT REDIRECT FOR CERTAIN DEMAND            
         BE    FUSCHKX              CALLS                                       
         CLI   DBFUNCT,DBGETASB                                                 
         BE    FUSCHKX                                                          
         CLI   DBFUNCT,DBGETAB                                                  
         BE    FUSCHKX                                                          
         CLI   DBFUNCT,DBGETASM                                                 
         BE    FUSCHKX                                                          
         CLI   DBFUNCT,DBGETMB                                                  
         BE    FUSCHKX                                                          
         CLI   DBFUNCT,DBGETSYS                                                 
         BE    FUSCHKX                                                          
*                                                                               
         CLI   DBSELSRC,C'F'       FUSION                                       
         JNE   FUSCHKX                                                          
         CLI   DBSELMED,C'T'       AND USTV                                     
         JNE   FUSCHKX                                                          
* EFFECTIVE JAN20 ALL FUSION LOOKS GO TO NIELSEN                                
         CLC   DBSELBK,=AL2(JAN_20)                                             
         JNL   FUSCHK80                                                         
*                                                                               
* GET TABLE FOR LOCAL CABLE AND SEE IF WE ARE DEALING WITH                      
* LOCAL CABLE  WITHOUT A SPILL MKT PASSES IN - GET MKT FROM TABLE               
         MVI   BYTE,0                                                           
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,LOCALCAB  GET A(FUSION END DATE TABLE)                 
         ICM   RE,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         L     R0,4(R1)            L'TABLE ENTRY RETURNED IN P2                 
         USING LOCCABD,RE                                                       
FUSCHK10 CLI   0(RE),X'FF'                                                      
         BE    FUSCHK28                                                         
         CLC   LOCSPOTC,DBSELSTA                                                
         BE    FUSCHK12                                                         
FUSCHK11 AR    RE,R0                                                            
         B     FUSCHK10                                                         
*USCHK12 MVC   DBSELSTA(5),LOCNSIC      LINK STATION TO READ                    
FUSCHK12 DS    0C                                                               
* BYPASS LOCAL CABLE LINK ENTIRELY IS SPILL MKT ASKED FOR                       
         OC    DBSELMK,DBSELMK                                                  
         BNZ   FUSCHK28                                                         
         OC    DBSELALF,DBSELALF                                                
         BNZ   FUSCHK28                                                         
FUSCHK16 MVC   DBSELMK,LOCSMKT          SPILL MKT TO READ                       
         MVC   DBACTKMK,LOCSMKT          SPILL MKT TO READ                      
         MVC   DBSELALF,LOCALPHA         SPILL MKT TO READ                      
* GET BOOKTYPE SWITCH TABLE                                                     
         ZICM  RF,LOCABKTB,(15)        DISPL TO BOOKTYPE TABLE                  
         AR    RE,RF                   ADD TO LOCAL CABLE TAB ENTRY             
         USING LOCBKTBD,RE                                                      
FUSCHK20 CLI   0(RE),X'FF'                                                      
         BE    FUSCHK26                                                         
                                                                                
         CLC   DBBTYPE,LOCINBT                                                  
         BE    FUSCHK24                                                         
         AHI   RE,LOCBKTBQ                                                      
                                                                                
FUSCHK24 MVC   DBBTYPE,LOCOUTBT         SWITCH BOOKTYPE                         
         MVC   BYTE,DBBTYPE                                                     
         DROP  RE                                                               
                                                                                
FUSCHK26 MVI   DBACTSRC,C'N'            LOCAL CABLE ALWAYS NSI                  
         MVI   DBSELSRC,C'N'            LOCAL CABLE ALWAYS NSI                  
FUSCHK28 DS    0C                                                               
*                                                                               
* CHECK FOR DIARY MARKET EFFECTVE JAN19 -                                       
* CHECK FOR OCT18 FOR TESTING                                                   
* FOR FUSION DIARY MARKETS ALSO USE NIELSEN                                     
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,NSIMKTS                                                
         ICM   RE,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         L     R0,4(R1)            L'TABLE ENTRY                                
         USING NMKTD,RE                                                         
         OC    DBSELMK,DBSELMK     NUMERIC MARKET GIVEN                         
         JZ    FUSCK29B                                                         
         MVC   DUB(2),DBSELMK                                                   
FUSCK29A CLI   0(RE),X'FF'         CHECK NUMERIC MARKET                         
         JE    FUSCHK29                                                         
         CLC   NMKTNUM,DUB                                                      
         JE    FUSCK29D                                                         
         AR    RE,R0                                                            
         J     FUSCK29A                                                         
FUSCK29B CLI   DBSELALF,X'41'      ALPHA MARKET GIVEN                           
         JL    FUSCHKX                                                          
FUSCK29C CLI   0(RE),X'FF'                                                      
         JE    FUSCHK29                                                         
         CLC   NMKTALF,DBSELALF    CHECK ALPHA MARKET                           
         JE    FUSCK29D                                                         
         AR    RE,R0                                                            
         J     FUSCK29C                                                         
* FOUND MARKET IN TABLE                                                         
FUSCK29D CLI   NMKTTYPE,NMKTDQ      NO DIARY GO CHECK LPM LIKE ALWAYS           
         BNE   FUSCHK29                                                         
         OC    DBSELBK,DBSELBK                                                  
         JZ    FUSCK29H                                                         
*                                                                               
         CLC   DBSELBK,=AL2(JAN_19)                                             
         JL    FUSCHKX                                                          
         J     FUSCHK80             DBSELBK GREATER THAN TABLE ENTRY            
* FOR CALLS SUCH AS VALSTBK DBSELBK IS NOT SET                                  
* IF WE CHANGE THE SOURCE TO NIELSEN WE MESSED UP A POSTING LOOKUP              
* FOR JAN18 BOOK FOR TYL WHICH IS A DIARY MARKET WHICH SUPPOSE                  
* TO LOOK UP FUSION DATA WE SHOULD NOT SWITCH TO NIELSEN SOURCE WHEN            
* BASICALLY WE SHOULD ONLY SWITCH SOURCE FOR LATEST BOOK LOOKUP                 
* FOR DBFUNCT=DBGETDEM                                                          
FUSCK29H DS    0H                                                               
         CLI   DBFUNCT,DBGETDEM                                                 
         BNE   FUSCHKX                                                          
*                                                                               
         OC    DBSELDAT,DBSELDAT    IF NO BOOK - CHECK DBSELDAT                 
         JZ    FUSCHK80             CHECK DBSELDAT LIMIT AGAINST                
         CLC   DBSELDAT,=AL2(JAN_19)    TABLE                                   
         JL    FUSCHKX                                                          
         J     FUSCHK80             USE NIELSEN                                 
******                                                                          
                                                                                
*                                                                               
*                                                                               
FUSCHK29 DS    0C                                                               
*     LPM CHECK FOR NIELSEN                                                     
                                                                                
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,FUSNENDP  GET A(FUSION END DATE TABLE)                 
         ICM   RE,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         L     R0,4(R1)            L'TABLE ENTRY RETURNED IN P2                 
         XC    DUB,DUB                                                          
         OC    DBSELMK,DBSELMK     NUMERIC MARKET GIVEN                         
         JZ    FUSCHK40                                                         
         MVC   DUB(2),DBSELMK                                                   
FUSCHK30 CLI   0(RE),X'FF'         CHECK NUMERIC MARKET                         
         JE    FUSCHKX                                                          
         CLC   3(2,RE),DUB                                                      
         JE    FUSBK                                                            
         AR    RE,R0                                                            
         J     FUSCHK30                                                         
FUSCHK40 CLI   DBSELALF,X'41'      ALPHA MARKET GIVEN                           
         JL    FUSCHKX                                                          
FUSCHK60 CLI   0(RE),X'FF'                                                      
         JE    FUSCHKX                                                          
         CLC   0(3,RE),DBSELALF    CHECK ALPHA MARKET                           
         JE    FUSBK                                                            
         AR    RE,R0                                                            
         J     FUSCHK60                                                         
                                                                                
FUSBK    OC    DBSELBK,DBSELBK                                                  
         JZ    FUSCHK70                                                         
         CLC   DBSELBK,5(RE)                                                    
         JL    FUSCHKX                                                          
         J     FUSCHK80             DBSELBK GREATER THAN TABLE ENTRY            
FUSCHK70 OC    DBSELDAT,DBSELDAT    IF NO BOOK - CHECK DBSELDAT                 
         JZ    FUSCHK80             CHECK DBSELDAT LIMIT AGAINST                
         CLC   DBSELDAT,5(RE)       TABLE                                       
         JL    FUSCHKX                                                          
*                                                                               
*                                                                               
FUSCHK80 MVI   DBSELSRC,C'N'        IF NO BOOK, NO SELDAT                       
* STARTING JAN18 DO NOT USE WIRED DATA                                          
* WE ARE GOING TO LOSE WIRED NIELSEN DATA SEP18                                 
* FUSION IS ALREADY ALL DMA ANYWAYS                                             
         OC    DBSELBK,DBSELBK                                                  
         BZ    FUSCHK88                                                         
         CLC   DBSELBK,=AL2(JAN_18)                                             
         BNL   FUSCHK88                                                         
         CLI   DBBTYPE,C'3'        ALLOW ZERO CELL CABLE                        
         BE    FUSCHK88                                                         
         CLI   DBBTYPE,C'4'        ALLOW ZERO CELL WIRED                        
         BE    FUSCHK88                                                         
         CLI   DBBTYPE,C'Z'        ALLOW LIVE ONLY WIRED                        
         BE    FUSCHK88                                                         
**       CLI   DBBTYPE,C'U'        ALLOW LIVE ONLY CABLE                        
**       BE    FUSCHK88                                                         
**       CLI   DBBTYPE,C'J'        ALLOW LIVE ONLY HISPANIC                     
**       BE    FUSCHK88                                                         
         CLI   DBBTYPE,BOOKTYPE_W3 ALLOW LIVE+3 WIRED                           
         BE    FUSCHK88                                                         
*                                                                               
         CLI   DBBTYPE,C'U'        U AND J BOOKS GO TO Z                        
         BE    *+8                                                              
         CLI   DBBTYPE,C'J'                                                     
         BE    *+8                                                              
         CLI   DBBTYPE,C'L'                                                     
         BNE   *+12                                                             
         MVI   DBBTYPE,C'Z'        IF CABLE USING L BOOK THEN                   
         B     FUSCHK88            USE Z BOOK FOR SPOT POSTING                  
*                                                                               
         CLI   DBBTYPE,BOOKTYPE_C3  IF USING C+3 THEN SWITCH                    
         BE    *+8                  TO W+3                                      
         CLI   DBBTYPE,BOOKTYPE_L3                                              
         BNE   *+12                                                             
         MVI   DBBTYPE,BOOKTYPE_W3 IF CABLE USING L+3 BOOK THEN                 
         B     FUSCHK88            USE W+3 BOOK FOR SPOT POSTING                
*                                                                               
         CLI   DBBTYPE,BOOKTYPE_WS  IF USING LIVE + SAME DAY THEN USE           
         BE    *+8                  BOOKTYPE WS                                 
         CLI   DBBTYPE,BOOKTYPE_LS                                              
         BNE   FUSCHK86                                                         
         CLC   DBSELBK,=AL2(OCT_11)  ONLY SUPPORT LS AND WS OCT11 ON            
         BL    FUSCHK86              CONTINUE W WIRE BEFORE OCT11               
         MVI   DBBTYPE,BOOKTYPE_WS                                              
         B     FUSCHK88                                                         
FUSCHK86 CLI   DBFUNCT,DBGETTOT     THEN GRAB NSI WIRED                         
         BE    *+8                  UNLESS WE ARE GRABBING                      
         MVI   DBBTYPE,C'W'         MKT TOTALS ..WE WANT STANDARD               
FUSCHK88 MVI   DBACTSRC,C'N'                                                    
* BYTE =  SAVE D BOOKTYPE FROM LOCAL CABLE TABLE                                
         OC    BYTE,BYTE                                                        
         BZ    FUSCHKX                                                          
         MVC   DBBTYPE,BYTE                                                     
FUSCHKX  DS    0C                                                               
         J     DEMX1                                                            
         EJECT                                                                  
                                                                                
*-----------------------------------------------------------------              
* ROUTINE TO CHECK FOR PPM MARKET                                               
* CHECK AGAINST DBSELBK UNLESS BOOK IS PASSED INTO DMCB+4                       
* OUTPUT- DBBTYPE CHANGE TO PRELIM BOOKTYPE IF WITHIN PRELIM PERIOD             
* PPMFLAG IS SET TO PPMLVB_Y IF LIVEBOOK IS LOADED                              
* DMCB+8= ADDRESS OF MATCHING TABLE ENTRY                                       
*                                                                               
* ALERT- IF THERE ARE MORE PRELIMINARY BOOKTYPE TO TAKE CARE OF                 
* ALSO ADD CHANGE TO GETMKB AND GETMS CALL WHICH CHECKS FOR BOOKTYPES           
*-----------------------------------------------------------------              
CHKPPM   DS    0C                                                               
         CLI   DBINTMED,C'R'                                                    
         BNE   CHKPPM0X                                                         
         CLI   DBSELSRC,C'T'                                                    
         BE    CHKPPM0X           NOT FOR TRITON                                
*                                                                               
         CLI   DBFUNCT,DBGETMB                                                  
         BNE   *+10                                                             
         MVC   DBBTYPE,DBKEY+(SBBTYP-SBKEY)                                     
*                                                                               
         XC    PPMFLAG,PPMFLAG    CLEAR FLAG                                    
         XC    DUB,DUB                                                          
         MVC   DUB(L'DBSELBK),DBSELBK                                           
         OC    DMCB+4(L'DBSELBK),DMCB+4                                         
         BZ    *+10                                                             
         MVC   DUB(L'DBSELBK),DMCB+4                                            
*                                                                               
         L     RF,DBCOMFCS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,PPMTAB    GET ADRESS OF TABLE FROM DEMTABS             
         ICM   RE,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         L     R0,4(R1)            L'TABLE ENTRY RETURNED IN P2                 
         USING PPMTABD,RE                                                       
CHKPPM02 CLC   =X'FFFF',0(RE)                                                   
         BE    CHKPPM0X                                                         
         OC    DBSELALF,DBSELALF                                                
         BNZ   CHKPPM04                                                         
         CLC   DBSELMK,PPMNMKT                                                  
         BNE   CHKPPM08                                                         
         B     CHKPPM06                                                         
CHKPPM04 CLC   DBSELALF,PPMAMKT    PPM MARKET IN TABLE?                         
         BNE   CHKPPM08                                                         
CHKPPM06 ST    RE,DMCB+8           SAVE ADDRESS OF MATCHING ENTRY               
         CLC   DUB(2),PPMSTRTP    IF BOOK BEFORE START PRELIM                   
         BL    CHKPPM0X            ALSO GET RID OF PPM BOOKTYPES                
         CLC   DUB(2),PPMLIVBK                                                  
         BL    CHKPPM07                                                         
                                                                                
         CLI   DBBTYPE,0           IF BOOKTYPE REQUESTED IS                     
         BE    *+8                 LIVE PPM BOOKTYPES ONLY                      
         CLI   DBBTYPE,C'B'        AND BOOK IS AFTER LIVE PPM BOOK              
         BE    *+8                 THEN SET LIVE PPM BOOK LOADED                
         CLI   DBBTYPE,C'H'        FLAG                                         
         BNE   *+8                                                              
         OI    PPMFLAG,PPMLVB_Y                                                 
         B     CHKPPM0X                                                         
* REMINDER IF WE ARE ADDING MORE BOOKTYPES FOR PRELIMINARY                      
* TO ALSO ADD BOOKTYPE CHECK IN GETMKB                                          
CHKPPM07 CLI   DBBTYPE,0                                                        
         BNE   *+8                                                              
         MVI   DBBTYPE,C'P'                                                     
         CLI   DBBTYPE,C'B'                                                     
         BNE   *+8                                                              
         MVI   DBBTYPE,C'E'                                                     
         CLI   DBBTYPE,C'H'                                                     
         BNE   *+8                                                              
         MVI   DBBTYPE,C'I'                                                     
         B     CHKPPM0X                                                         
*                                                                               
CHKPPM08 AR    RE,R0                                                            
         B     CHKPPM02                                                         
CHKPPM0X J     DEMX1                                                            
         DROP  RE                                                               
*                                                                               
*-------------------------                                                      
* LTORG - FOR SUBR1 ONLY                                                        
*-------------------------                                                      
         LTORG                                                                  
*        THESE STATIONS CAN BE ACCESSED WITH SPECIAL CALL LETTERS               
*        BUT ARE ON THE DEMO FILE AS SPILL.                                     
GLBCNVT  DS    0CL5                CAN NETWORK CONVERSION TABLE                 
         DC    C'A',CL4'ASN '      ATLANTIC STA. NETWORK                        
         DC    C'B',CL4'BRAV'      BRAVO NETWORK                                
         DC    C'D',CL4'DSCY'      DISCOVERY NETWORK                            
         DC    C'F',CL4'RDI '      RESEAU DE L'INFORMATION                      
         DC    C'G',CL4'CIII'      GLOBAL                                       
         DC    C'H',CL4'SHOW'      SHOWCASE                                     
         DC    C'I',CL4'CIHF'      MARITINE IND. TV                             
         DC    C'L',CL4'LIFE'      LIFE NETWORK                                 
         DC    C'O',CL4'WTN '      WOMEN'S TV NETWORK                           
         DC    C'S',CL4'TSN '      SPORTS NETWORK                               
         DC    C'U',CL4'NCN '      NEW COUNTRY NETWORK                          
         DC    C'Y',CL4'YTV '                                                   
         DC    X'FF',CL4'    '                                                  
*                                                                               
*        THESE STATIONS CAN BE ACCESSED WITH SPECIAL CALL LETTERS               
*        BUT ARE ON THE DEMO FILE AS SPILL.                                     
GXBCNVT  DS    0CL6                CAN NETWORK CONVERSION TABLE                 
         DC    C'IX',CL4'CITY '      CITY                                       
         DC    C'OX',CL4'CHCH '      CHCH                                       
         DC    C'LZ',CL4'TLC  '      TLC                                        
         DC    C'FZ',CL4'FOOD '      FOOD                                       
         DC    C'FX',CL4'CFMT '      CFMT                                       
         DC    C'TY',CL4'CIVM '      FOOD                                       
         DC    X'FFFF',CL4'    '                                                
*                                                                               
* SOME CANADIAN DUMMY CALL LETTERS HAVE NO UNIQUE STATION TO REFERENCE          
* TO - SO THEY ARE HERE AND TREATED SPECIALLY                                   
SPCLTAB  DS    0CL10               TABLE OF SPECIAL STATIONS/MARKETS            
*                                  DDS CALL LETTERS                             
*                                  BBM CALL LETTERS                             
*                                  BBM MARKET NUMBER                            
*                                                                               
         DC    C'ECAL',CL4'ACCE',AL2(8069)    CALGARY                           
         DC    C'ERED',CL4'ACCE',AL2(8078)    RED DEER                          
         DC    C'EEDM',CL4'ACCE',AL2(0000)    EDMONTON                          
         DC    C'SRCL',CL4'CBAF',AL2(3111)    CARLETON                          
         DC    C'KLLN',CL4'CBLN',AL2(5336)    KITCH/LONDON                      
         DC    C'LBLN',CL4'CBLN',AL2(0000)    LONDON                            
         DC    C'KBLN',CL4'CBLN',AL2(5339)    KITCHENER                         
         DC    C'TBLT',CL4'CBLT',AL2(5199)    TORONTO                           
         DC    C'BBLT',CL4'CBLT',AL2(0000)    BARRIE                            
         DC    C'LFCN',CL4'CFCN',AL2(0000)    LETHBRIDGE                        
         DC    C'TQCL',CL4'CFJP',AL2(3111)    CARLETON                          
         DC    C'DXKL',CL4'CFPL',AL2(5336)    KITCH/LONDON                      
         DC    C'DXLO',CL4'CFPL',AL2(0000)    LONDON                            
         DC    C'DXKT',CL4'CFPL',AL2(5339)    KITCHENER                         
         DC    C'TFTO',CL4'CFTO',AL2(5199)    TORONTO                           
         DC    C'PFTO',CL4'CFTO',AL2(5159)    PETERBOROUGH                      
         DC    C'BFTO',CL4'CFTO',AL2(5243)    BARRIE                            
         DC    C'DXOE',CL4'CHRO',AL2(5071)    OTTAWA ANGLO                      
         DC    C'DXKI',CL4'CHRO',AL2(5109)    KINGSTON                          
         DC    C'DXWI',CL4'CFPL',AL2(5409)    WINDSOR                           
         DC    C'CIHM',CL4'CIHF',AL2(3011)    ST JOHN/MONCTON                   
         DC    C'RITV',CL4'CITV',AL2(8078)    RED DEER                          
         DC    C'ATCH',CL4'CJCH',AL2(1021)    CHARLOTTETOWN                     
         DC    C'OJOH',CL4'CJOH',AL2(5071)    OTTAWA ANGLO                      
         DC    C'KJOH',CL4'CJOH',AL2(5109)    KINGSTON                          
         DC    C'KKCO',CL4'CKCO',AL2(0000)    KITCHENER                         
         DC    C'KLCO',CL4'CKCO',AL2(5336)    KITCH/LONDON                      
         DC    C'LKCO',CL4'CKCO',AL2(5369)    LONDON                            
         DC    C'WKCO',CL4'CKCO',AL2(5409)    WINDSOR                           
         DC    C'DXPE',CL4'CKVR',AL2(5159)    PETERBOROUGH                      
         DC    C'TKVR',CL4'CKVR',AL2(5199)    TORONTO                           
         DC    C'DXTO',CL4'CKVR',AL2(5199)    TORONTO                           
         DC    C'DXBA',CL4'CKVR',AL2(0000)    BARRIE                            
         DC    C'XXCA',CL4'KAYU',AL2(8069)    CALGARY                           
         DC    C'XXED',CL4'KAYU',AL2(8119)    EDMONTON                          
         DC    C'XXOK',CL4'KAYU',AL2(9071)    OKANAGAN/KAMLOOPS                 
         DC    C'WZOE',CL4'WUTV',AL2(5071)    OTTAWA ANGLO                      
         DC    C'WZTO',CL4'WUTV',AL2(5199)    TORONTO                           
         DC    C'WZKT',CL4'WUTV',AL2(5339)    KITCHENER                         
         DC    C'WZKL',CL4'WUTV',AL2(5336)    KITCH/LONDON                      
         DC    C'WZLO',CL4'WUTV',AL2(5369)    LONDON                            
         DC    C'OCHN',CL4'CHAN',AL2(9071)    OKANAGAN/KAMLOOPS                 
         DC    C'OIVT',CL4'CIVT',AL2(9071)    OKANAGAN/KAMLOOPS                 
         DC    X'FFFF'                                                          
         SPACE 2                                                                
*                                                                               
GLBLTAB  DS    0CL8                TABLE OF GLOBAL STATIONS/MARKETS             
*                                  CALL LETTERS                                 
*                                  BBM MARKET NUMBER                            
*                                  CSI MARKET NUMBER                            
*                                                                               
*              ********CIII***************                                      
         DC    C'GBAR',AL2(5243),AL2(0457)                                      
         DC    C'GBRA',AL2(6061),AL2(9999)                                      
         DC    C'GHAM',AL2(5269),AL2(9999)                                      
         DC    C'GKIN',AL2(5109),AL2(0454)                                      
         DC    C'GKIT',AL2(5339),AL2(0447)                                      
         DC    C'GLON',AL2(5369),AL2(0445)                                      
         DC    C'GKTL',AL2(5336),AL2(0000)                                      
         DC    C'GOTT',AL2(5069),AL2(0444)                                      
         DC    C'GPET',AL2(5159),AL2(0456)                                      
         DC    C'GPTK',AL2(9341),AL2(9999)                                      
         DC    C'GTIM',AL2(9999),AL2(0446)                                      
         DC    C'GTOR',AL2(5199),AL2(0440)                                      
         DC    C'GSSM',AL2(5531),AL2(0495)                                      
         DC    C'GSTN',AL2(5479),AL2(0446)                                      
         DC    C'GSUD',AL2(5479),AL2(0446)                                      
         DC    C'GVIC',AL2(9119),AL2(9999)                                      
         DC    C'GWIN',AL2(5441),AL2(0458)                                      
         DC    C'GWND',AL2(5409),AL2(0459)                                      
*              ********CIHF*************** MARITINE IND.                        
         DC    C'ICHA',AL2(1021),AL2(0434)                                      
         DC    C'IHAL',AL2(2080),AL2(0430)  NSI HOME =430 PR.NOV/90             
         DC    C'IMAR',AL2(9999),AL2(0477)                                      
         DC    C'ISJM',AL2(3011),AL2(0431)  NSI HOME = 431 SUB. OCT/90          
         DC    C'ISYD',AL2(2010),AL2(9999)                                      
*              ********ASN*************** ATLANTIC SAT. NETWORK                 
         DC    C'ACBR',AL2(0041),AL2(9999)                                      
         DC    C'ACHA',AL2(1021),AL2(0434)                                      
         DC    C'AGRF',AL2(0060),AL2(9999)                                      
         DC    C'AHAL',AL2(2080),AL2(0430)                                      
         DC    C'ASJM',AL2(3011),AL2(0431)                                      
         DC    C'ASJN',AL2(0009),AL2(0433)                                      
         DC    C'ASN ',AL2(0000),AL2(0477)  BBM HOME =1031                      
         DC    C'ASYD',AL2(2010),AL2(0432)                                      
*              ********CHCH***************                                      
         DC    C'OXBA',AL2(5243),AL2(0457)                                      
         DC    C'OXHM',AL2(5269),AL2(0000)                                      
         DC    C'OXKT',AL2(5339),AL2(0447)                                      
         DC    C'OXLO',AL2(5369),AL2(0445)                                      
         DC    C'OXKL',AL2(5336),AL2(0000)                                      
         DC    C'OXOT',AL2(5069),AL2(0444)                                      
         DC    C'OXPE',AL2(5159),AL2(0000)                                      
         DC    C'OXTO',AL2(5199),AL2(0440)                                      
         DC    C'OXSN',AL2(5479),AL2(0000)                                      
         DC    C'OXSU',AL2(5479),AL2(0000)                                      
         DC    C'OXST',AL2(5511),AL2(0000)                                      
*              ********CITY***************                                      
         DC    C'IXBA',AL2(5243),AL2(0457)                                      
         DC    C'IXHM',AL2(5269),AL2(0000)                                      
         DC    C'IXKI',AL2(5109),AL2(0000)                                      
         DC    C'IXKL',AL2(5336),AL2(0000)                                      
         DC    C'IXKT',AL2(5339),AL2(0447)                                      
         DC    C'IXLO',AL2(5369),AL2(0445)                                      
         DC    C'IXOE',AL2(5071),AL2(0000)                                      
         DC    C'IXOT',AL2(5069),AL2(0444)                                      
         DC    C'IXPE',AL2(5159),AL2(0000)                                      
         DC    C'IXSN',AL2(5511),AL2(0000)                                      
         DC    C'IXTO',AL2(5199),AL2(0000)                                      
         DC    C'IXWI',AL2(5144),AL2(0440)                                      
*              ********TSN*************** SPORTS NETWORK                        
         DC    C'SCAL',AL2(9999),AL2(0484)                                      
         DC    C'SCHA',AL2(9999),AL2(0434)                                      
         DC    C'SEDM',AL2(9999),AL2(0482)                                      
         DC    C'SHAL',AL2(9999),AL2(0430)                                      
         DC    C'SKEN',AL2(9999),AL2(0435)                                      
         DC    C'SKIT',AL2(9999),AL2(0447)                                      
         DC    C'SKIL',AL2(9999),AL2(0491)                                      
         DC    C'SLTH',AL2(9999),AL2(0480)                                      
         DC    C'SLON',AL2(9999),AL2(0445)                                      
         DC    C'SMAR',AL2(9999),AL2(0477)                                      
         DC    C'SOTT',AL2(9999),AL2(0444)                                      
         DC    C'SREG',AL2(9999),AL2(0471)                                      
         DC    C'SSAS',AL2(9999),AL2(0474)                                      
         DC    C'SSJN',AL2(9999),AL2(0433)                                      
         DC    C'SSSM',AL2(9999),AL2(0460)                                      
         DC    C'SSUD',AL2(9999),AL2(0495)                                      
         DC    C'SSYD',AL2(9999),AL2(0432)                                      
         DC    C'STHB',AL2(9999),AL2(0461)                                      
         DC    C'STOR',AL2(5199),AL2(0440)                                      
         DC    C'SVAN',AL2(9999),AL2(0490)                                      
         DC    C'SWPG',AL2(9999),AL2(0470)                                      
         DC    C'SYOR',AL2(9999),AL2(0472)                                      
******************CFMT********************                                      
         DC    C'FXOE',AL2(5071),AL2(0000)                                      
         DC    C'FXKI',AL2(5109),AL2(0000)                                      
         DC    C'FXPE',AL2(5159),AL2(0000)                                      
         DC    C'FXTO',AL2(5199),AL2(0000)                                      
         DC    C'FXBA',AL2(5243),AL2(0000)                                      
         DC    C'FXKT',AL2(5336),AL2(0000)                                      
         DC    C'FXKL',AL2(5339),AL2(0000)                                      
         DC    C'FXLO',AL2(5369),AL2(0000)                                      
******************CIVM********************                                      
         DC    C'TYCL',AL2(3111),AL2(0000)                                      
         DC    C'TYRI',AL2(4061),AL2(0000)                                      
         DC    C'TYRO',AL2(4101),AL2(0000)                                      
         DC    C'TYQU',AL2(4199),AL2(0000)                                      
         DC    C'TYCJ',AL2(4120),AL2(0000)                                      
         DC    C'TYSH',AL2(4351),AL2(0000)                                      
         DC    C'TYTR',AL2(4661),AL2(0000)                                      
         DC    C'TYRN',AL2(4723),AL2(0000)                                      
         DC    C'TYMF',AL2(4481),AL2(0000)                                      
         DC    C'TYOF',AL2(5072),AL2(0000)                                      
         DC    C'TYTR',AL2(4661),AL2(0000)                                      
******************YTV*********************                                      
         DC    C'YTOR',AL2(5199),AL2(0440)                                      
******************FOOD**FOOD TV***********                                      
         DC    C'FXVA',AL2(9109),AL2(0490)                                      
******************TLC*THE LEARNING CHANNEL*                                     
         DC    C'LXVA',AL2(9109),AL2(0490)                                      
         DC    X'FF'                                                            
         SPACE 2                                                                
*                                                                               
WKLYFIXT DS   0CL8                TABLE OF WEEKLY BBM DUMMY STATIONS            
* +0(4)  DDS DOCUMENTED CALL LETTERS                                            
* +4(4)  DUMMY CALL LETTERS (VANCOUVER) - BASED ON DEDETB99W2 STATTAB           
*                                                                               
         DC   CL4'FAIR',CL4'KVAN'  FAIRCHILD                                    
         DC   CL4'NWS ',CL4'NXVA'  CTV NEWS ONE                                 
         DC   CL4'WTN ',CL4'OVAN'  WOMEN'S TV NWK                               
         DC   CL4'WNW ',CL4'WVAN'  WEATHER NETWORK                              
         DC   CL4'VTV ',CL4'VVAN'  VISION                                       
         DC   CL4'YTV ',CL4'YVAN'  YTV                                          
         DC   CL4'CBNW',CL4'NVAN'  CBC NEWSWORLD                                
         DC   CL4'MUCH',CL4'MVAN'  MUCH MUSIC                                   
         DC   CL4'TSN ',CL4'SVAN'  SPORTS NET                                   
         DC   CL4'CMT ',CL4'YXVA'  CMT                                          
         DC   CL4'SHOW',CL4'HVAN'  SHOWCASE                                     
         DC   CL4'BRAV',CL4'BVAN'  BRAVO                                        
         DC   CL4'LIFE',CL4'LVAN'  LIFE NETWORK                                 
         DC   CL4'DSCY',CL4'DVAN'  DISCOVERY                                    
         DC   CL4'CSN ',CL4'JXVA'  CTV SPORTSNET                                
         DC   CL4'HIST',CL4'HXVA'  HISTORY                                      
         DC   CL4'SPAC',CL4'SXVA'  SPACE                                        
         DC   CL4'PRME',CL4'PXVA'  PRIME                                        
         DC   CL4'OLN ',CL4'UXVA'  OUTDOOR LIFE NET                             
         DC   CL4'TOON',CL4'LXVA'  TELETOON                                     
         DC   CL4'HSN ',CL4'JVAN'  HEADLINE SPORTS NEWS                         
         DC   CL4'COME',CL4'CXVA'  COMEDY                                       
         DC   CL4'MMM ',CL4'QXVA'  MUCH MORE MUSIC                              
         DC   X'FF'                                                             
         SPACE 2                                                                
*                                                                               
CALLFIXT DS   0CL12             TABLE OF DDS/BBM/NIELSEN CALL LETTERS           
*                               ONLY CONTAINS STATIONS ACTUALLY ON FILE         
* +0(4)  DDS CALL LETTERS       (XXXX=UNKNOWN/NOT ON FILE)                      
* +4(4)  NIELSEN CALL LETTERS                                                   
* +8(4)  BBM CALL LETTERS                                                       
*                 DDS       CSI       BBM                                       
         DC   CL4'ACC ',CL4'ACCS',CL4'ACCE'    ACCESS                           
         DC   CL4'CFMN',CL4'CFMT',CL4'CFMT'    CFMT                             
         DC   CL4'NFMT',CL4'CFMT',CL4'CFMT'    CFMT                             
         DC   CL4'CITN',CL4'CITY',CL4'CITY'    CITY                             
         DC   CL4'CKMN',CL4'XXXX',CL4'CKMI'    CKMI                             
         DC   CL4'CPNW',CL4'CP24',CL4'XXXX'    CABLE PLUS 24                    
*        DC   CL4'DSCY',CL4'DISC',CL4'DSCV'    DISCOVERY                        
*        DC   CL4'XXXX',CL4'A&&E',CL4'A+E '    A&E (BBM WKLY=AEN !)             
         DC   X'FF'                                                             
         SPACE 2                                                                
BBMAFTB  DS    0CL6                TABLE OF STATIONS MARKETS                    
*                                    CALL LETTERS                               
*                                    MARKET NUMBERS                             
*--- MONTREAL STATIONS                                                          
         DC    C'CBFT',AL2(4481)   FRENCH                                       
         DC    C'CBFA',AL2(4481)                                                
         DC    C'CBFG',AL2(4481)                                                
         DC    C'CBFR',AL2(4481)                                                
         DC    C'CBFW',AL2(4481)                                                
         DC    C'CFTM',AL2(4481)                                                
         DC    C'CFJP',AL2(4481)                                                
         DC    C'CIVM',AL2(4481)                                                
*        DC    C'CHLT',AL2(4481)                                                
         DC    C'CBMT',AL2(4480)   ANGLO                                        
         DC    C'CBSE',AL2(4480)                                                
         DC    C'CBJE',AL2(4480)                                                
         DC    C'CFCF',AL2(4480)                                                
         DC    C'CJNT',AL2(4480)    NOV/01 START                                
         DC    C'CKMI',AL2(4480)    NOV/97 START                                
         DC    C'NKMI',AL2(4480)    NOV/97 START                                
         DC    C'WCAX',AL2(4480)                                                
         DC    C'WCFE',AL2(4480)                                                
         DC    C'WETK',AL2(4480)                                                
         DC    C'WFFF',AL2(4480)    02/02/00                                    
         DC    C'WVNY',AL2(4480)                                                
         DC    C'WPTZ',AL2(4480)                                                
*--- OTTAWA STATIONS                                                            
         DC    C'CBOF',AL2(5072)   FRENCH                                       
         DC    C'CFGS',AL2(5072)                                                
         DC    C'CIVO',AL2(5072)                                                
         DC    C'CHOT',AL2(5072)                                                
         DC    C'CBOT',AL2(5071)   ANGLO                                        
         DC    C'CJOH',AL2(5071)                                                
         DC    C'CIII',AL2(5071)                                                
         DC    C'WHEC',AL2(5071)                                                
         DC    C'WROC',AL2(5071)                                                
         DC    C'CHRO',AL2(5071)                                                
         DC    X'FF'                                                            
         SPACE 2                                                                
CSIAFTB  DS    0CL6           CSI  TABLE OF STATIONS MARKETS                    
*                                    CALL LETTERS                               
*                                    MARKET NUMBERS                             
*--- MONTREAL STATIONS                                                          
         DC    C'CBFT',AL2(0415)   FRENCH                                       
         DC    C'CBFA',AL2(0415)                                                
         DC    C'CBFG',AL2(0415)                                                
         DC    C'CBFR',AL2(0415)                                                
         DC    C'CBFW',AL2(0415)                                                
         DC    C'CFTM',AL2(0415)                                                
         DC    C'CFJP',AL2(0415)                                                
         DC    C'CIVM',AL2(0415)                                                
*        DC    C'CHLT',AL2(0415)                                                
         DC    C'CBMT',AL2(0414)   ANGLO                                        
         DC    C'CBSE',AL2(0414)                                                
         DC    C'CBJE',AL2(0414)                                                
         DC    C'CFCF',AL2(0414)                                                
         DC    C'WCAX',AL2(0414)                                                
         DC    C'WVNY',AL2(0414)                                                
         DC    C'WPTZ',AL2(0414)                                                
*--- OTTAWA STATIONS                                                            
         DC    C'CBOF',AL2(0478)   FRENCH                                       
         DC    C'CFGS',AL2(0478)                                                
         DC    C'CIVO',AL2(0478)                                                
         DC    C'CHOT',AL2(0478)                                                
         DC    C'CBOT',AL2(0416)   ANGLO                                        
         DC    C'CJOH',AL2(0416)                                                
         DC    C'CIII',AL2(0416)                                                
         DC    C'WHEC',AL2(0416)                                                
         DC    C'WROC',AL2(0416)                                                
*        DC    C'CHRO',AL2(0416)   HOME SWITCHED TO PEMBROOKE                   
         DC    X'FF'                                                            
         EJECT                                                                  
BBMHOMT  DS    0CL6              TABLE OF BBM HOME STATION MARKETS              
         DC    X'FF'                                                            
CSIHOMT  DS    0CL6              TABLE OF CSI HOME STATION MARKETS              
         DC    X'FF'                                                            
NSIHOMT  DS    0CL6              TABLE OF NSI HOME STATION MARKETS              
         DC    X'FF'                                                            
         SPACE 2                                                                
LAHSTA   DS    0C                                                               
         DC    C'KABC'                                                          
         DC    C'KAZA'                                                          
         DC    C'KCAL'                                                          
         DC    C'KCBS'                                                          
         DC    C'KCET'                                                          
         DC    C'KCOP'                                                          
         DC    C'KDOC'                                                          
         DC    C'KFTR'                                                          
         DC    C'KJLA'                                                          
         DC    C'KLCS'                                                          
         DC    C'KMEX'                                                          
         DC    C'KNBC'                                                          
         DC    C'KOCE'                                                          
         DC    C'KPXN'                                                          
         DC    C'KRCA'                                                          
         DC    C'KSFV'                                                          
         DC    C'KTLA'                                                          
         DC    C'KTTV'                                                          
         DC    C'KVEA'                                                          
         DC    C'KWHY'                                                          
         DC    X'FF'                                                            
*                                                                               
LPMENDP  DS    0CL4 TABLE OF LPM PARALLEL END DATES (REGULAR)                   
         DC    AL2(101),XL2'6809' NY                                            
         DC    AL2(403),XL2'6808' LA                                            
         DC    AL2(202),XL2'680A' CHI                                           
         DC    AL2(407),XL2'6901' SF                                            
         DC    AL2(106),XL2'6605' BOS                                           
         DC    AL2(111),XL2'6907' WAS                                           
         DC    AL2(104),XL2'6907' PHL                                           
         DC    AL2(105),XL2'6A01' DET                                           
         DC    AL2(223),XL2'6A01' DAL                                           
         DC    AL2(168),XL2'6A07' ATL                                           
         DC    AL2(124),XL2'6A07' ATL                                           
         DC    AL2(218),XL2'6B0A' HOU                                           
         DC    AL2(419),XL2'6B0A' SEA                                           
         DC    AL2(139),XL2'6B0A' TAM                                           
         DC    AL2(353),XL2'6C04' PHX                                           
         DC    AL2(110),XL2'6C09' CLE                                           
         DC    AL2(213),XL2'6C09' MIN                                           
         DC    AL2(351),XL2'6C0A' DEN                                           
         DC    AL2(128),XL2'6C0A' MIA                                           
         DC    AL2(134),AL2(JAN_09)   ORL                                       
         DC    AL2(462),AL2(JAN_09)   SAC                                       
         DC    AL2(209),AL2(JAN_09)   STL                                       
         DC    AL2(108),AL2(JUL_09)   PIT                                       
         DC    AL2(420),AL2(JUL_09)   POO                                       
         DC    AL2(112),AL2(JUL_09)   BAL                                       
         DC    AL2(117),AL2(OCT_09)   CHL                                       
         DC    AL2(127),AL2(APR_10)   IND                                       
         DC    AL2(425),AL2(APR_10)   SND                                       
         DS    AL2(160),AL2(APR_10)   RAL                                       
         DC    AL2(133),AL2(APR_10)   HNH                                       
         DC    AL2(259),AL2(AUG_10)   NAS                                       
         DC    AL2(216),AL2(AUG_10)   KAN                                       
         DC    AL2(135),AL2(AUG_10)   COO                                       
         DC    AL2(115),AL2(OCT_10)   CIN                                       
         DC    AL2(217),AL2(OCT_10)   MIL                                       
*&&DO                                                                           
         DC    AL2(370),AL2(FEB_11)   SLC                                       
         DC    AL2(167),AL2(FEB_11)   GRS                                       
         DC    AL2(241),AL2(APR_11)   SNT                                       
         DC    AL2(148),AL2(APR_11)   WPB                                       
         DC    AL2(230),AL2(AUG_11)   BIR                                       
         DC    AL2(144),AL2(AUG_11)   NPN                                       
         DC    AL2(439),AL2(AUG_11)   LAS                                       
         DC    AL2(125),AL2(AUG_11)   ALQ                                       
         DC    AL2(250),AL2(OCT_11)   OKL                                       
         DC    AL2(118),AL2(OCT_11)   GWH                                       
         DC    AL2(240),AL2(FEB_12)   MEM                                       
         DC    AL2(129),AL2(FEB_12)   LOU                                       
         DC    AL2(161),AL2(FEB_12)   JAX                                       
         DC    AL2(114),AL2(FEB_12)   BUF                                       
         DC    AL2(235),AL2(APR_12)   AUS                                       
         DC    AL2(121),AL2(APR_12)   PRO                                       
         DC    AL2(222),AL2(APR_12)   NWO                                       
         DC    AL2(157),AL2(APR_12)   KNO                                       
         DC    AL2(156),AL2(OCT_12)   RIC                                       
         DC    AL2(271),AL2(OCT_12)   TUL                                       
         DC    AL2(142),AL2(OCT_12)   DAY                                       
         DC    AL2(171),AL2(OCT_12)   FTM                                       
*&&                                                                             
         DC    X'FFFF'                                                          
*                                                                               
LPMENDI  DS    0CL4 TABLE OF LPM PARALLEL END DATES (HISPANIC)                  
         DC    AL2(101),XL2'6809' NY                                            
         DC    AL2(403),XL2'6808' LA                                            
         DC    AL2(202),XL2'680A' CHI                                           
         DC    AL2(407),XL2'6901' SF                                            
         DC    AL2(223),XL2'6A01' DAL                                           
         DC    AL2(218),XL2'6B0A' HOU                                           
         DC    AL2(353),XL2'6C04' PHX                                           
         DC    AL2(351),XL2'6C08' DEN                                           
         DC    AL2(128),XL2'6C08' MIA                                           
         DC    AL2(351),XL2'6C0A' DEN                                           
         DC    AL2(128),XL2'6C0A' MF                                            
         DC    AL2(134),AL2(JAN_09)   ORL                                       
         DC    AL2(462),AL2(JAN_09)   SAC                                       
         DC    AL2(425),AL2(APR_10)   SD                                        
         DS    AL2(160),AL2(APR_10)   RAL                                       
         DC    AL2(133),AL2(APR_10)   HAT                                       
         DC    AL2(115),AL2(OCT_10)   CIN                                       
*&&DO                                                                           
         DC    AL2(241),AL2(APR_11)   SAN                                       
         DC    AL2(148),AL2(APR_11)   WPB                                       
         DC    AL2(439),AL2(AUG_11)   LAS                                       
         DC    AL2(235),AL2(APR_12)   AUS                                       
         DC    AL2(171),AL2(OCT_12)   FM                                        
*&&                                                                             
         DC    X'FFFF'                                                          
         DROP  RA                                                               
         EJECT                                                                  
***********************************************************************         
* GTNSRC - GET PRSTAT+4 CHAR DEPENDING ON DBSELSRC REQST              *         
***********************************************************************         
         SPACE 1                                                                
GTNSRC   NTR1  BASE=*,LABEL=*                                                   
         MVI   DUB+4,0             INITIALIZE                                   
         L     R1,=A(NETSRC)       PT TO TRANSLATE TABLE                        
         A     R1,RELO                                                          
GTNSRC02 CLI   0(R1),X'FF'         EOT                                          
         JE    GTNSRCX                                                          
         CLC   DBSELSRC,0(R1)                                                   
         JE    *+12                                                             
         LA    R1,L'NETSRC(R1)                                                  
         J     GTNSRC02                                                         
         MVC   DUB+4(10),1(R1)                                                  
GTNSRCX  J     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* GET MARKET RECORD ROUTINE                                                     
***********************************************************************         
GETMKREC NTR1  BASE=*,LABEL=*                                                   
         SPACE 1                                                                
         MVC   DBACTRMK,DBSELRMK   TEST IF MARKET NUMBER PRESENT                
         OC    DBACTRMK,DBACTRMK                                                
         BNZ   GETMRC2                                                          
*                                                                               
* CHECK ALPHA MARKET                                                            
         OC    DBSELALF,DBSELALF                                                
         BZ    GETMRC1                                                          
         XC    DUB,DUB                                                          
         MVC   DUB(3),DBSELALF                                                  
         BRAS  RE,TRAMKT           TRANSLATE ALHAMKT TO NUMERIC MKT             
         MVC   DBACTRMK,DUB+3      DUB+3(2) = NUMERIC MARKET                    
         B     GETMRC2                                                          
*                                  NO - GET MARKET FOR STATION                  
GETMRC1  OC    DBSELSTA,DBSELSTA                                                
         BNZ   *+12                                                             
         MVI   DBERROR,NOTFOUND                                                 
         B     GETMRCX                                                          
         GOTO1 AGETMRKT                                                         
         BNE   GETMRCX                                                          
*                                  MARKET NUMBER PRESENT                        
GETMRC2  LA    R2,DBKEY                                                         
         USING DMKEY,R2            R2=A(KEY)                                    
         CLI   DBSELMED,C'U'       COUNTY COVERAGE                              
         BE    GETMRC40                                                         
         XC    DMKMAJOR,DMKMAJOR   BUILD KEY                                    
         MVI   DMCODE,DMCODEQU                                                  
         MVC   DMMEDIA,DBINTMED                                                 
         CLI   DBINTMED,C'O'       OVERNIGHTS READ USTV                         
         BNE   *+8                                                              
         MVI   DMMEDIA,C'T'                                                     
         MVC   DMSRC,DBACTSRC                                                   
         CLI   DBACTSRC,C'F'       FUSION READ NSI MARKET RECORDS               
         BNE   *+8                                                              
         MVI   DMSRC,C'N'                                                       
         MVC   DBMINKEY,DBACTRMK   SET MINOR KEY                                
         CLI   DBSELMED,C'N'       BUILD DUMMY RECD, PULL NAME FROM TBL         
         BNE   GETMRC15                                                         
*                                                                               
         L     R1,=A(NETSRC)                                                    
         A     R1,RELO                                                          
         MVC   WORK(11),=C'**UNKNOWN**'                                         
GETMRC10 CLI   0(R1),X'FF'                                                      
         BE    GETMRC20                                                         
         CLC   DBMINKEY,2(R1)      COMPARE MKT# W/TABLE ENTRY                   
         BE    *+12                                                             
         LA    R1,L'NETSRC(R1)                                                  
         B     GETMRC10                                                         
         MVC   WORK(11),9(R1)      PASS WORK TO BLDMKT W/NAME IN IT             
         B     GETMRC20                                                         
*                                                                               
GETMRC15 MVI   MKPMODE,MKFSTQ                                                   
         MVC   MKPSRC,DMSRC                                                     
         MVC   MKPMED,DMMEDIA                                                   
         MVC   MKPMKNUM,DBMINKEY                                                
         BRAS  RE,MKNAME                                                        
         BE    GETMRC21                                                         
GETMRC20 GOTO1 ABLDMRKT                                                         
GETMRC21 MVI   DBRECTYP,DBRECMK    RETURN TO CALLER                             
         B     GETMRCX                                                          
***********************************************************                     
* READ RUN RECORD TO GET MARKET NAME FOR COUNTY COVERAGE                        
***********************************************************                     
GETMRC40 OC    DBSELSTA,DBSELSTA                                                
         BNZ   *+12                                                             
         MVI   DBERROR,NOTFOUND                                                 
         B     GETMRCX                                                          
*                                                                               
GETMRC42 LA    R2,DBKEY                                                         
         USING DRKEY,R2            R2=A(KEY)                                    
         XC    DRKMAJOR,DRKMAJOR   BUILD KEY                                    
         MVI   DRCODE,DRCODEQU                                                  
         MVC   DRMEDIA,DBINTMED                                                 
         MVC   DRSRC,DBSELSRC                                                   
         MVC   DRSTAT,DBSELSTA                                                  
         MVC   DRBOOK,DBSELBK                                                   
         XC    DRBOOK,=X'FFFF'                                                  
         MVC   DRKMKT,DBSELRMK                                                  
         MVC   DRBTYP,DBBTYPE                                                   
*                                                                               
         MVI   IOFLAG,DIR+HIGH    READ/FILE                                     
         GOTO1 AIO,IOFLAG                                                       
         BE    GETMRC45                                                         
         B     GETMRC48                                                         
GETMRC45 DS    0H                                                               
         CLC   DRKEY(L'DRKMAJOR),KEYSAVE                                        
         BNE   GETMRC48                                                         
         MVI   IOFLAG,FILE+HIGH    READ/FILE                                    
         GOTO1 AIO,IOFLAG                                                       
         BNE   GETMRC48                                                         
         B     GETMRC50                                                         
                                                                                
GETMRC48 GOTO1 ABLDMRKT                                                         
GETMRC50 MVI   DBRECTYP,DBRECMK    RETURN TO CALLER                             
         B     GETMRCX                                                          
GETMRCX  J     XIT                                                              
*                                                                               
***********************************************************************         
*        GET MARKET/BOOKS FOR A STATION                                         
***********************************************************************         
GETMKTBK NTR1  BASE=*,LABEL=*                                                   
         MVC   SVBBTYPE,DBBTYPE    CHANGING BOOKTYPE AND NOT RESTORING          
*                                  BREAKS SOME CALLER'S COMPARES                
         CLI   0(R1),0                                                          
         BNE   GETMB4                                                           
GETMB2   GOTO1 AGETMRKT                                                         
         JNE   GETX                                                             
         B     GETMBX                                                           
*                                  SEQUENTIAL MODE                              
GETMB4   CLI   DBSELMED,C'N'       BYPASS FOR NETWORK (FOR NOW)                 
         BE    GETMB20                                                          
         TM    PPMFLAG,PRELMEND                                                 
         BO    GETMB5                                                           
         TM    PPMFLAG,PRELMODE    MIDDLE OF PROCESSING FAKE PRELIM             
         BO    GETMB7              KEYS?                                        
GETMB5   LA    R2,DBKEY                                                         
         USING SBKEY,R2                                                         
         MVI   IOFLAG,DIR+SEQ      READ SEQUENTIAL/DIRECTORY                    
         GOTO1 AIO,IOFLAG                                                       
         JNE   GETX                                                             
         CLC   SBKEY(SBKMKT-SBKEY),KEYSAVE                                      
         BNE   GETMBEOF                                                         
*                                                                               
         CLI   DBSELMED,C'R'                                                    
         BNE   GETMBX                                                           
*------------------------  PPM CODE ----------                                  
* IF MATCH AND FOR RADIO                                                        
         CLC   SBBOOK,=AL2(MAR_07)         THERE ARE NO LIVE PPM BKS            
         BL    GETMBX                      BEFORE MAR07                         
         MVC   DBSELMK,SBKMKT                                                   
         XC    DMCB,DMCB                                                        
         MVC   DMCB+4(L'SBBOOK),SBBOOK                                          
         GOTO1 VSUBR01,DMCB,('CHKPPMQ',(RC))                                    
* IF LIVE BOOK IS LOADED, WE MUST ALSO HAVE ALL THE PRELIM                      
* BOOKS LOADED -PASS BACK FAKE PRELIM BOOK KEYS EVERY TIME WE                   
* HAVE JUST READ THE LIVE PPM BOOK                                              
         TM    PPMFLAG,PPMLVB_Y                                                 
         BZ    GETMBX                                                           
         L     RE,DMCB+8                                                        
         USING PPMTABD,RE                                                       
         CLC   SBBOOK,PPMLIVBK                                                  
         BE    GETMB6                                                           
         B     GETMBX                                                           
         DROP  RE                                                               
GETMB6   OI    PPMFLAG,PRELMODE                                                 
         NI    PPMFLAG,X'FF'-PRELMEND                                           
         MVC   KEYSAVE,SBKEY                                                    
         L     RE,DMCB+8                   SAVED PPM TABLE ENTRY                
         USING PPMTABD,RE                                                       
         MVC   SBBOOK,PPMSTRTP             PROCESS 1ST PRELIM BOOK              
         L     RE,DBAREC                                                        
         MVC   0(SBHOME-SBKEY,RE),SBKEY                                         
         B     GETMBX                                                           
         DROP  RE                                                               
*                                                                               
GETMB7   TM    PPMFLAG,PRELMEND            DID WE ALREADY PROCESSED             
         BO    GETMBX                      PRELIM BOOKTYPES?                    
         L     RE,DBAREC                                                        
         MVC   SBKEY(SBHOME-SBKEY),0(RE)                                        
         ZIC   RE,SBBOOK+1                                                      
         AHI   RE,1                                                             
         STC   RE,SBBOOK+1                                                      
         CHI   RE,13                                                            
         BNE   GETMB8                                                           
         MVI   SBBOOK+1,1                                                       
         ZIC   RE,SBBOOK                                                        
         AHI   RE,1                                                             
         STC   RE,SBBOOK                                                        
GETMB8   L     RF,DMCB+8                                                        
         USING PPMTABD,RF                                                       
         L     RE,DBAREC                                                        
         MVC   0(SBHOME-SBKEY,RE),SBKEY                                         
         CLC   SBBOOK,PPMENDP      PROCESS FAKE PRELIM KEYS                     
         BNH   GETMBX                                                           
         OI    PPMFLAG,PRELMEND                                                 
         L     RE,DBAREC                                                        
         MVC   SBKEY,KEYSAVE       RESTORE LAST RECORD AND CONTINUE             
         MVC   0(SBHOME-SBKEY,RE),SBKEY WITH REST OF REAL DIR KEYS              
         B     GETMBX                                                           
         DROP  RF                                                               
*------------------------- END OF PPM CODE                                      
*                                                                               
         DROP  R2                                                               
*                                  CHECK FOR LOGICAL EOF                        
GETMB20  DS    0H                  NETWORK                                      
         LA    R2,DBKEY                                                         
         USING PRKEY,R2                                                         
         ZIC   R1,PRBOOK+1                                                      
         LA    R1,1(R1)                                                         
         STC   R1,PRBOOK+1                                                      
         XC    DUB,DUB             DUB IS PARAM LIST FOR RDNET                  
         MVI   DUB,C'B'            BYPASS BUILDING KEY                          
         LA    R1,PRKMKT-PRKEY     COMPARE THRU STATION                         
         STC   R1,DUB+4                                                         
         BRAS  RE,RDNET                                                         
         BNE   GETMBEOF                                                         
         MVI   DUB,C'S'                                                         
         BRAS  RE,BLDNET           BUILD DUMMY SPOT RECD FOR NET                
         XC    DBKEY,DBKEY                                                      
         MVC   DBKEY(12),KEYSAVE    RESTORE DIRECTORY KEY TO DBKEY              
         B     GETMBX                                                           
         DROP  R2                                                               
*                                                                               
GETMBEOF MVI   DBERROR,EOF         RETURN EOF                                   
*   NEW CODE CALL GETEQUIV TO GET BOOKS FOR EQUIV STATIONS                      
*   IF THE CALLER SETS IN DBBEST TO C'A'                                        
         CLI   DBBEST,C'A'                                                      
         JNE   GETMBEFX                                                         
**                                                                              
*  I DONT KNOW WHY WE NEED THE TWO INSTRUCTIONS AT GETMBEF2                     
*  I WOULD THINK WE COULD JUST FALL DOWN BELOW AND THE CLC                      
*  CLC DUB(L'DBSTAT-1),SVSELSTA INSTRUCTION WOULD BE SUFFICENT TO               
* CHECK IF WE ALREADY REREAD FOR THE EQUIV STATION                              
* I WILL ONLY ADD THE FOLLOWING BLOCK FOR TRITON CALL LETTER CHANGES            
* TO GET THE EQUIVALENT BOOKS FOR THE EQUIV STATION                             
* BPOO 09/27/18                                                                 
         CLI   DBSELMED,C'R'                                                    
         BNE   GETMBEF2                                                         
         CLI   DBSELSRC,C'T'                                                    
***      BNE   GETMBEF2                                                         
         BE    GETMBEF3                                                         
*                                                                               
**                                                                              
* CHECK IF WE ALREADY READ EQUIV STATION                                        
GETMBEF2 CLC   DBSELSTA,KEYSAVE+(SBSTAT-SBKEY)                                  
         BE    GETMBEFX                                                         
GETMBEF3 XC    DUB(5),DUB                                                       
         MVI   DUB+5,3                                                          
         GOTO1 AGETEQIV           GET EQUIVALENT CALL LETTERS                   
         JNE   GETMBEFX                                                         
         CLC   DUB(L'SBSTAT-1),SVSELSTA                                         
         JE    *+18                                                             
         MVC   DBSELSTA,DUB                                                     
         MVI   DBSELSTA+4,C'T'                                                  
*                                                                               
* FOR TRITON EQUIV STATION LOOKUPS EX WHEN TLXX CHANGED TO DX                   
* CALL LETTERS I NEED THIS CODE TO SUPPORT READING BOTH STATIONS                
* FOR THE COMBINED BOOKS LIST                                                   
         CLI   DBSELMED,C'R'                                                    
         BNE   GETMB2                                                           
         CLI   DBSELSRC,C'T'                                                    
         BNE   GETMB2                                                           
         MVC   DBSELSTA+4(1),SVSELSTA+4  KEEP THE BAND CHARACTER                
         CLC   DBSELSTA,KEYSAVE+(SBSTAT-SBKEY)                                  
         BE    GETMBEFX                                                         
*                                                                               
         J     GETMB2                                                           
                                                                                
*                                                                               
GETMBEFX MVC   DBBTYPE,SVBBTYPE    RESTORE BOOKTYPE IN CASE IT CHANGED          
         J     GETX                                                             
*                                  RETURN TO CALLER                             
GETMBX   DS    0H                                                               
         LA    RE,DBKEY                                                         
         USING SBKEY,RE                                                         
         CLI   DBSELMED,C'R'       RADIO ALSO PASS BACK ALPHA                   
         BNE   *+14                MKT INTO DBSELALF DUE TO                     
         MVC   DBBTYPE,SBBTYP      BOOKTYPE HAS DIFF MKT #S                     
         B     *+8                                                              
         CLI   DBSELMED,C'C'                                                    
         BNE   GETMBX4                                                          
         LA    RE,DBKEY                                                         
         USING SBKEY,RE                                                         
         XC    DBSELALF,DBSELALF                                                
         XC    DUB,DUB                                                          
         OC    SBKMKT,SBKMKT                                                    
         BZ    GETMBX2                                                          
         MVC   DUB+3(2),SBKMKT     SET FOR NUMERIC CNVSN                        
         B     GETMBX3                                                          
GETMBX2  MVC   DUB+3(2),SBRMKT     IF NO  SPILL THEN TRANSLATE HOME             
         DROP  RE                                                               
GETMBX3  BRAS  RE,TRAMKT                                                        
         MVC   DBSELALF,DUB        DUB(3) = ALPHA MARKET                        
*                                                                               
GETMBX4  CLI   DBSELMED,C'N'                                                    
         BE    GETMBX8                                                          
         CLI   DBSELMED,C'T'       NSI USTV DATA VALID POST OCT90               
         BNE   GETMBX8                                                          
         CLI   DBSELSRC,C'N'                                                    
         BNE   GETMBX8                                                          
         CLC   DBSELAGY,=C'SJ'     ONLY SJ & NB CAN GET < OCT90 DATA            
         BE    GETMBX8                                                          
         CLC   DBSELAGY,=C'NB'                                                  
         BE    GETMBX8                                                          
         LA    R2,DBKEY                                                         
         USING SBKEY,R2                                                         
         CLC   SBBOOK,=AL2(OCT_90)                                              
         BL    GETMB4              BYPASS YEARS < OCT90                         
         DROP  R2                                                               
*                                                                               
GETMBX8  MVI   DBRECTYP,DBRECMB                                                 
         MVI   DBMODE,DBMFRST                                                   
         MVC   DBBTYPE,SVBBTYPE    RESTORE BOOKTYPE IN CASE IT CHANGED          
         CLI   DBFUNCT,DBVLST                                                   
         JE    GETX                                                             
         MVI   DBMODE,DBMNEXT      SET SEQUENTIAL MODE                          
*                                                                               
*CONVERT NUMERIC CABLE # TO CALL LETTERS FOR FUSION                             
         CLI   DBSELSRC,C'F'                                                    
         BNE   GETMBX9                                                          
         LA    R2,DBKEY                                                         
         USING SBKEY,R2                                                         
         XC    WORK,WORK                                                        
         MVC   WORK(L'MLSTAT),SBSTAT                                            
         DROP  R2                                                               
         BRAS  RE,CABALPH          CONVERT CABLE # TO ALPHA                     
         MVC   DBACTSTA,WORK+5                                                  
*                                                                               
GETMBX9  MVC   DBBTYPE,SVBBTYPE    RESTORE BOOKTYPE                             
         BRAS  RE,GETX                                                          
         B     GETMB4              GET NEXT RECORD                              
         EJECT                                                                  
*                                                                               
**********************************************************************          
*        GET ALL MARKETS/ ALL BOOKS.                                            
*        RTNS MKT NAME RECD WITH DBACTBK AND DBBTYPE SET                        
**********************************************************************          
GETAMBK  NTR1  BASE=*,LABEL=*                                                   
         CLI   DBSELMED,C'N'                                                    
         JNE   *+12                                                             
         MVI   DBERROR,INVMED      SORRY, N/A FOR NETWORK                       
         J     GETX                                                             
         CLI   0(R1),0                                                          
         JNE   GETAMB4                                                          
         XC    DBACTBK,DBACTBK                                                  
         LA    R2,DBKEY            GET MARKET NAME DIRECTORY ITEM               
         USING DMKEY,R2            R2=A(KEY)                                    
         MVI   DMCODE,DMCODEQU     BUILD KEY                                    
         MVC   DMMEDIA,DBINTMED                                                 
         CLI   DBINTMED,C'O'       TP OVERNIGHTS READ USTV TP                   
         JNE   *+8                 MARKET NAME RECORDS                          
         MVI   DMMEDIA,C'T'                                                     
         MVC   DMSRC,DBACTSRC                                                   
         CLI   DBACTSRC,C'F'       FUSION READ USTV TP NSI                      
         JNE   *+8                 MARKET NAME RECORDS                          
         MVI   DMSRC,C'N'                                                       
         CLI   DBACTSRC,C'H'       IHEART READ ARBITRON                         
         JNE   *+8                 MARKET NAME RECORDS                          
         MVI   DMSRC,C'A'                                                       
*                                                                               
         MVI   MKPMODE,MKFSTQ                                                   
         MVC   MKPSRC,DMSRC                                                     
         MVC   MKPMED,DMMEDIA                                                   
         XC    MKPMKNUM,MKPMKNUM   FIRST MARKET FOR THE SRC/MEDIA               
         BRAS  RE,MKNAME                                                        
         JE    GETAMB4                                                          
*                                                                               
GETAMB2  MVI   DBERROR,NOTFOUND    RETURN NOT FOUND                             
         J     GETX                                                             
*                                                                               
GETAMB4  LA    R2,DBKEY            GET FIRST/NEXT MARKET LIST RECORD            
         USING MLKEY,R2            R2=A(KEY)                                    
         TM    PPMFLAG,PRELMEND                                                 
         JO    GETAMB4E                                                         
         TM    PPMFLAG,PRELMODE    MIDDLE OF PROCESSING FAKE PRELIM             
         JO    GETAMB9E            KEYS?                                        
GETAMB4E XC    MLKMAJOR,MLKMAJOR   (RE)/BUILD KEY                               
         MVI   MLCODE,MLCODEQU                                                  
         MVC   MLMEDIA,DBINTMED                                                 
         MVC   MLSRC,DBACTSRC                                                   
         OC    DBACTBK,DBACTBK     FIRST LK UP?                                 
         JZ    GETAMB5               DON'T SET ANYTHING ELSE                    
         MVC   MLBOOK,DBACTBK                                                   
         XC    MLBOOK,EFFS                                                      
         MVC   MLRMKT,DBACTRMK                                                  
         MVC   MLSTAT,DBACTSTA                                                  
         MVC   MLKMKT,DBACTKMK                                                  
         MVC   MLSTYP,DBSTYPE                                                   
         MVC   MLBTYP,DBBTYPE                                                   
***********************************                                             
*GETAMB5  MVI   MLSTAT,X'FF'      * THIS CAUSED SKIPPING BLACK SURVEY           
***********************************                                             
* FOR FUSION WE WILL ONLY PROCESS "HUT T" RECORDS                               
* SO IF WE SEE A NUMERIC STATION SET STATION TO 'FF'                            
* TO READ NEXT MKT'S HUTT RECORD                                                
GETAMB5  CLI   DBSELSRC,C'F'                                                    
         JNE   GETAMB5C                                                         
***      TM    MLSTAT,X'F0'                                                     
***      BZ    GETAMB5D                                                         
***      MVI   MLSTAT,X'FF'           BUMP TO NEXT MKT LEVEL RECORD             
* NEW CODE                                                                      
* ALL WE REALLY NEED IS TO READ HUT T RECORDS FOR THE BOOK LIST                 
         CLC   =C'HUT T',MLSTAT       READ ALL HUT RECORDS                      
         BNE   *+12                   UNTIL WE READ STATION LEVEL               
         MVI   MLBTYP+L'MLBTYP,X'FF'  BUMP TO NEXT BKTYP LVL RECORD             
         J     GETAMB5D                                                         
*                                                                               
* NO HUT RECORDS SUCH AS NULL OR NUMERIC STATION KEYS                           
         MVC   MLSTAT(5),=X'FFFFFFFFFF'                                         
****     MVI   MLKMKT+L'MLKMKT,X'FF'  BUMP TO NEXT BKTYP LVL RECORD             
         J     GETAMB5D                                                         
                                                                                
*                                                                               
*  WE CANT ASSUME ALL BOOKTYPES HAS A UNIQUE MARKET ASSOCIATED WITH             
*  IT - IT CAUSED PROBLEMS SHOWING BOOKS FOR BLACK SURVEY                       
*                                                                               
***GETAMB5  TM    MLSTAT,X'F0'                                                  
GETAMB5C CLI   DBSELSRC,C'T'     FOR TRITON WE DON'T HAVE MARKET TOTALS         
         BE    GETAM5CT          READ ALL THE BOOKTYPES FOR EVERY STATN         
*                                                                               
         TM    MLSTAT,X'F0'                                                     
         JO    *+12                                                             
         MVI   MLSTAT,X'F0'           DONT READ STATION LEVEL RECORDS           
         J     *+8                                                              
******   MVI   MLSTAT+L'MLSTAT,X'FF'  BUMP TO NEXT MKT LEVEL RECORD             
* READING STATION/MARKET ONLY ONCE DOESNT GET US ALL THE BOOKTYPES              
* READ THROUGH ALL THE BOOKTYPES                                                
GETAM5CT MVI   MLBTYP+L'MLBTYP,X'FF'  BUMP TO NEXT BKTYP LVL RECORD             
         B     GETAMB5D                                                         
*                                                                               
*                                                                               
GETAMB5D MVI   IOFLAG,DIR+HIGH     READ HIGH/DIRECTORY                          
         GOTO1 AIO,IOFLAG                                                       
         JL    GETX                ERRORS                                       
         JE    GETAMB8             FOUND                                        
*                                                                               
GETAMB6  OC    DBMINKEY,DBMINKEY   TEST IF FIRST TIME                           
         JZ    GETAMB2             YES - RETURN NOT FOUND                       
         MVI   DBERROR,EOF         NO - RETURN EOF                              
         J     GETX                                                             
*                                  CHECK RETURN KEY                             
GETAMB8  CLC   MLKEY(MLBOOK-MLKEY),KEYSAVE                                      
         JNE   GETAMB6                                                          
         CLI   MLIND,MLINDEQU                                                   
         JNE   GETAMB8A            BYPASS NON-MKT M'RECDS                       
         CLI   DBSELMED,C'T'       NSI USTV DATA VALID POST OCT90               
         JNE   GETAMB8D                                                         
         CLI   DBSELSRC,C'N'                                                    
         JNE   GETAMB8D                                                         
*3/23/04 CLC   DBSELAGY,=C'SJ'     ONLY SJ & NB CAN GET < OCT90 DATA            
*        BE    GETAMB8D                                                         
*        CLC   DBSELAGY,=C'NB'                                                  
*        BE    GETAMB8D                                                         
         CLC   MLBOOK,=AL2(65535-OCT_90)                                        
         JNH   GETAMB8D            BYPASS YEARS < OCT90                         
*                                                                               
GETAMB8A SR    R1,R1                                                            
         ICM   R1,3,MLBOOK                                                      
         LA    R1,1(R1)                                                         
         XC    MLBOOK(MLSTAT-MLBOOK),MLBOOK                                     
         STCM  R1,3,MLBOOK                                                      
         J     GETAMB5             LOOK UP NEXT BOOK                            
*                                                                               
GETAMB8D DS    0H                  SAVE DBACTS TO RESET RDING LATER             
         CLC   MLBOOK,EFFS         SOME "MCA" RECORDS HAVE THIS                 
         JE    GETAMB6              IF WE HIT IT, IT'S END-OF-FILE              
                                                                                
*                                                                               
*-------------                                                                  
*                                                                               
         CLI   DBSELMED,C'R'       RADIO ALSO PASS BACK ALPHA                   
         JNE   GETAMB12                                                         
         MVC   DBBTYPE,MLBTYP      BOOKTYPE HAS DIFF MKT #S                     
         XC    DBSELALF,DBSELALF                                                
         XC    DUB,DUB                                                          
         OC    MLKMKT,MLKMKT                                                    
         JZ    GETAMB9                                                          
         MVC   DUB+3(2),MLKMKT     SET FOR NUMERIC CNVSN                        
         J     GETAMB9A                                                         
GETAMB9  MVC   DUB+3(2),MLRMKT     IF NO  SPILL THEN TRANSLATE HOME             
GETAMB9A BRAS  RE,TRAMKT                                                        
         MVC   DBSELALF,DUB        DUB(3) = ALPHA MARKET                        
*-------------                                                                  
* PPM CODE - CHECK IF LIVE PPM BOOK IS OUT.  IF LIVE PPM BOOK IS LOADED         
* THEN CREATE FAKE PRELIM RECORDS TO PASS BACK TO CALLER'S HOOK                 
* THEN CONTINUE TO PASS REAL PASSIVES BACK TO CALLER                            
         MVC   WORK(2),MLBOOK                                                   
         XC    WORK(2),=X'FFFF'                                                 
         CLC   WORK,=AL2(MAR_07)         THERE ARE NO LIVE PPM BKS              
         JL    GETAMB12                  BEFORE MAR07                           
         MVC   DBSELMK,MLKMKT                                                   
         XC    DMCB,DMCB                                                        
         MVC   DMCB+4(L'MLBOOK),WORK                                            
         GOTO1 VSUBR01,DMCB,('CHKPPMQ',(RC))                                    
* IF LIVE BOOK IS LOADED, WE MUST ALSO HAVE ALL THE PRELIM                      
* BOOKS LOADED -PASS BACK FAKE PRELIM BOOK KEYS EVERY TIME WE                   
* HAVE JUST READ THE LIVE PPM BOOK                                              
         TM    PPMFLAG,PPMLVB_Y                                                 
         JZ    GETAMB12                                                         
         L     RE,DMCB+8                                                        
         USING PPMTABD,RE                                                       
         CLC   WORK(2),PPMLIVBK                                                 
         JE    GETAMB9B                                                         
         J     GETAMB12                                                         
         DROP  RE                                                               
GETAMB9B OI    PPMFLAG,PRELMODE                                                 
         NI    PPMFLAG,X'FF'-PRELMEND                                           
         MVC   KEYSAVE,MLKEY                                                    
         L     RE,DMCB+8                   SAVED PPM TABLE ENTRY                
         USING PPMTABD,RE                                                       
         MVC   MLBOOK,PPMSTRTP             PROCESS 1ST PRELIM BOOK              
         XC    MLBOOK,=X'FFFF'                                                  
         L     RE,DBAREC                                                        
         MVC   0(MLHOME-MLKEY,RE),MLKEY                                         
         J     GETAMB12                                                         
         DROP  RE                                                               
* MIDDLE OF PROCESSING FAKE PRELIM KEYS                                         
GETAMB9E TM    PPMFLAG,PRELMEND            DID WE ALREADY PROCESSED             
         BO    GETAMB12                    PRELIM BOOKTYPES?                    
         MVC   MLKEY(L'MLKMAJOR),WORKSV                                         
         MVC   WORK(2),MLBOOK                                                   
         XC    WORK(2),=X'FFFF'                                                 
         ZIC   RE,WORK+1                                                        
         AHI   RE,1                                                             
         STC   RE,WORK+1                                                        
         MVC   MLBOOK,WORK                                                      
         CHI   RE,13                                                            
         JNE   GETAMB9H                                                         
         MVI   WORK+1,1                                                         
         ZIC   RE,WORK                                                          
         AHI   RE,1                                                             
         STC   RE,WORK                                                          
         MVC   MLBOOK,WORK                                                      
GETAMB9H L     RF,DMCB+8                                                        
         USING PPMTABD,RF                                                       
         MVC   WORK(2),MLBOOK                                                   
         XC    MLBOOK,=X'FFFF'                                                  
         L     RE,DBAREC                                                        
         MVC   0(MLHOME-MLKEY,RE),MLKEY                                         
         CLC   WORK(L'MLBOOK),PPMENDP      PROCESS FAKE PRELIM KEYS             
         JNH   GETAMB12                                                         
         OI    PPMFLAG,PRELMEND                                                 
         L     RE,DBAREC                                                        
         MVC   MLKEY(L'MLKMAJOR),KEYSAVE   RESTORE KEY                          
         MVC   0(MLHOME-MLKEY,RE),MLKEY WITH REST OF REAL DIR KEYS              
         XC    PPMFLAG,PPMFLAG                                                  
         J     GETAMB12                                                         
         DROP  RF                                                               
*------------------------- END OF PPM CODE                                      
*                                                                               
*                                                                               
*                                                                               
GETAMB12 MVC   DBACTBK,MLBOOK                                                   
         XC    DBACTBK,EFFS                                                     
         XC    WORKSV,WORKSV                                                    
         MVC   WORKSV(L'MLKMAJOR),MLKEY SAVE OFF KEY                            
*                                                                               
         MVC   DBACTRMK,MLRMKT     RTG SRVC MKT                                 
         MVC   DBACTSTA,MLSTAT                                                  
         MVC   DBACTKMK,MLKMKT     SPILL MKT                                    
         MVC   DBSTYPE,MLSTYP                                                   
         MVC   DBBTYPE,MLBTYP      BOOKTYPE                                     
         MVC   DBMINKEY,MLRMKT                                                  
*                                                                               
         MVC   MKPMKNUM,MLRMKT     ASK FOR SPECIFIC MARKET NUMBER               
         BRAS  RE,MKNAME           READ DATA SET FOR MARKET NAME                
         JE    GETAMBX                                                          
         BRAS  RE,BLDMRKT          BUILD DUMMY MARKET RECORD                    
*                                                                               
*                                                                               
GETAMBX  MVI   DBRECTYP,DBRECMK    RETURN TO CALLER                             
         MVI   DBMODE,DBMNEXT      SET SEQUENTIAL MODE                          
         BRAS  RE,GETX                                                          
*                                                                               
         J     GETAMB4             GET NEXT RECORD                              
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
                                                                                
NETLTABD DSECT                     ENTRY IN THE FILE DEFINITION TABLE           
NETLSBK  DS    XL2                 START BOOK OF -ONLY- LIVE+7 DATA.            
NETLSLBK DS    XL2                 START BOOK OF LIVE (& OTHER STREAMS)         
NETLSLBP DS    XL2                 START BOOK OF LIVE FOR FAST DATA             
NETLMED  DS    C                   MEDIA (FROM THE DEMO RECORD)                 
NETLSTR  DS    AL4                 ROUTINE TO VALIDATE STATION                  
NETLBTYP DS    X                   BOOKTYPE                                     
ANYBTYP  EQU   X'FF'               ALL BOOKTYPES                                
NETLTABL EQU   *-NETLTABD                                                       
                                                                                
NETPOSND DSECT                     POSITION DIPSLACEMENTS BY RECD TYPE          
NETPREC  DS    C                   RECORD CODE                                  
NETPBOOK DS    AL1                 DISPLACEMENT TO BOOK IN THE KEY              
NETPMED  DS    AL1                 DISPLACEMENT OF MEDIA IN THE KEY             
NETPSTA  DS    AL1                 DISPLACEMENT OF STATION IN THE KEY           
NETPBTYP DS    AL1                 DISPLACEMENT OF BOOKTYPE IN THE KEY          
NETPOSNL EQU   *-NETPOSND                                                       
                                                                                
NEHTVSPD DSECT                     HISPANIC TV AUDIENCE SPECIAL STATNS          
NEHTVSST DS    CL4                 STATION CALL LETTERS                         
NEHTVSPL EQU   *-NEHTVSPD                                                       
                                                                                
NEHGMSPD DSECT                     HISPANIC GEN MKT ENG SPECIAL STATNS          
NEHGMSST DS    CL4                 STATION CALL LETTERS                         
NEHGMSPL EQU   *-NEHGMSPD                                                       
                                                                                
***********************************************************************         
* OTHER INCLUDED DSECTS                                               *         
***********************************************************************         
* FASYSFAC                                                                      
         PRINT OFF                                                              
       ++INCLUDE FASYSFAC                                                       
         PRINT ON                                                               
         SPACE 1                                                                
* FASSB                                                                         
         PRINT OFF                                                              
       ++INCLUDE FASSB                                                          
         PRINT ON                                                               
         SPACE 1                                                                
* FASSBOFF                                                                      
         PRINT OFF                                                              
SSBOFFD  DSECT                                                                  
       ++INCLUDE FASSBOFF                                                       
         PRINT ON                                                               
         SPACE 1                                                                
* DEGETD                                                                        
         PRINT OFF                                                              
       ++INCLUDE DEGETD                                                         
         PRINT ON                                                               
         SPACE 1                                                                
* DEDEBEXTRAD                                                                   
         PRINT OFF                                                              
       ++INCLUDE DEDBEXTRAD                                                     
         PRINT ON                                                               
* DDMASTD                                                                       
         PRINT OFF                                                              
       ++INCLUDE DDMASTD                                                        
         PRINT ON                                                               
* DDCOREQUS                                                                     
         PRINT OFF                                                              
       ++INCLUDE DDCOREQUS                                                      
*                                                                               
       ++INCLUDE DDMONYREQU                                                     
*                                                                               
       ++INCLUDE DDBSPARA                                                       
*                                                                               
         PRINT ON                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'014DEGET     06/18/20'                                      
         END                                                                    

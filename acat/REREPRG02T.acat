*          DATA SET REREPRG02T AT LEVEL 058 AS OF 04/02/04                      
*          DATA SET REREPRG02  AT LEVEL 138 AS OF 04/13/99                      
*CATALP RERG02                                                                  
         TITLE 'RERG02 - REPPAK REPORT GENERATOR - PHASE 1'                     
********************************************************************            
*                ****   RANKER NOTICE   ****                       *            
*  THIS MODULE CONTAINS A LIST OF REPORTS  WHICH ARE CONSIDERED    *            
*  RANKERS.  FOR EACH, THE MAX VALUE IS TAKEN FROM THE REQUEST     *            
*  CARD AND INSERTED INTO THE WORKAREA FIELD.  IF THE REPORT  IS   *            
*  NOT INCLUDED ON THE LIST, THE 'TOP N' WILL BE THE MAX VALUE.    *            
*                                                                  *            
*  SEARCH FOR '**RANKER LIST**' TO LOCATE PROPER CODE PLACEMENT    *            
*     .                                                            *            
*                                                                  *            
*                                                                  *            
*                ****   RANKER NOTICE   ****                       *            
********************************************************************            
*  UPDATE HISTORY                                                  *            
*  FOR PRIOR HISTORY, SEE REREPRG02H (HISTORY BOOK)                *            
*                                                                  *            
*                                                                  *            
*  JAN03/97 (BU ) --- ADD LOSS PRORATION CODE                      *            
*                                                                  *            
*  FEB03/97 (BU ) --- HARD-CODED FILTER SET CONTYPE/DEVCONTYP      *            
*                                                                  *            
*  FEB05/97 (BU ) --- MODS TO R1/R2/R3 Q3JNLOST REPORTING          *            
*                                                                  *            
*  MAR06/97 (BU ) --- FIX R1 REPORT BUG:  USED FULL FOR TESTING    *            
*                                                                  *            
*  MAR21/97 (BU ) --- INCREASE HARD-CODED FILTER SET               *            
*                                                                  *            
*  APR11/97 (BU ) --- MAKE CATEGORY/CLASS FILTER SOFT ON NO-FIND   *            
*                                                                  *            
*  APR16/97 (BU ) --- BUILD IN R5/R6 OPTIONS:  OPTION STATIONS     *            
*                     TABLE SETUP                                  *            
*                                                                  *            
*  APR24/97 (BU ) --- SKIP ALL-STATYPE RECORD IF ON-LINE REPORT.   *            
*                                                                  *            
*  MAY02/97 (BU ) --- UPGRADE TO SET OF SETS LOGIC                 *            
*                                                                  *            
*  MAY06/97 (BU ) --- COLLAPSE SET LOADING INTO SINGLE PARAMETER   *            
*                     DRIVEN ROUTINE                               *            
*                                                                  *            
*  MAY12/97 (BU ) --- ADD R5 OPTION: TOM OLSON WALL STREET REPORT  *            
*                                                                  *            
*  MAY22/97 (BU ) --- REMOVE 'HB' FROM HARD-CODED FILTER SET       *            
*                                                                  *            
*  JUN02/97 (BU ) --- UPGRADE FOR YR 2000                          *            
*                                                                  *            
*  JUN04/97 (BU ) --- FIX RUNMODE=SINGLE PROBLEM                   *            
*                                                                  *            
*  JUL17/97 (BU ) --- CONTYPE+DEVCONTYP EXCLUDE SET CHANGE         *            
*                                                                  *            
*  SEP04/97 (BU ) --- SKIP SETMONTH CODE FOR AVAIL PENDING REPS    *            
*                                                                  *            
*  OCT02/97 (BU ) --- ADD 'AGENCY' KEYWORD: NO OFFICE IN SORT KEY  *            
*                                                                  *            
*  NOV03/97 (BU ) --- BEST $/CONF/UNCF/DIRECT RESP/ COLUMNS        *            
*                                                                  *            
*  NOV10/97 (BU ) --- AS-AT OFFSET BASED ON REP PROFILE BYTE       *            
*                                                                  *            
*  NOV17/97 (BU ) --- ALTERNATE CALENDAR CALL SETUP                *            
*                                                                  *            
*  JAN06/98 (BU ) --- TERRITORY FILTER/SET USAGE                   *            
*                                                                  *            
*  JAN08/98 (BU ) --- ADD COLUMN PRIOR ACT/CONF ONLY               *            
*                                                                  *            
*  FEB25/98 (BU ) --- IMPLEMENT 'NO BACK BILLING' OPTION           *            
*                                                                  *            
*  MAR09/98 (BU ) --- MODIFY 'BACK BILLING' OPTION                 *            
*                                                                  *            
*  APR09/98 (BU ) --- NRRGON DATE REALIGNMENT                      *            
*                                                                  *            
*  APR22/98 (BU ) --- S/P AS MASTER SET                            *            
*                                                                  *            
*  APR23/98 (BU ) --- 19   COLUMN INCREASE  QWKDB --> QWKDC        *            
*                                                                  *            
*  MAY05/98 (BU ) --- COMPANY BUDGET (C*MP)                        *            
*                                                                  *            
*  JUL06/98 (BU ) --- CROSS-FILE ACCESS                            *            
*                                                                  *            
*  SEP14/98 (BU ) --- NATL/LOCAL FILTER BASED ON OFFICE FLAG       *            
*                                                                  *            
*  SEP16/98 (BU ) --- FIX 'NO THIRD CARD' NAT/LOC PROBLEM          *            
*                                                                  *            
*  SEP16/98 (BU ) --- ADD RER FILTERING                            *            
*                                                                  *            
*  SEP18/98 (BU ) --- UPGRADE FOR MARKET/STATION REQUIREMENT       *            
*                                                                  *            
*  OCT07/98 (BU ) --- ADD OWNER/MARKET FILTER AS APPROPRIATE       *            
*                                                                  *            
*  NOV02/98 (BU ) --- ADD 'THIS WEEK/2YRS PRIOR'                   *            
*                                                                  *            
*  NOV14/98 (BU ) --- ADD 'FORCE ROW TO PRINT' COLUMN              *            
*                                                                  *            
*  DEC14/98 (BU ) --- QWMISFLG ENTRY:       QWKDC --> QWKDD        *            
*                                                                  *            
*  JUN04/99 (BU ) --- ADD TEST MASTER/SUB1/SUB2/SUB3 TO CMBOREP    *            
*                                                                  *            
*  JUL12/99 (BU ) --- ADD MARKET SET PROCESSING                    *            
*                                                                  *            
*  SEP07/99 (BU ) --- FIX CROSS-FILE REP RECORD USE                *            
*                                                                  *            
*  DEC06/99 (BU ) --- ADD CLEAR CHANNEL TO KATZ RADIO  COMBO TABLE *            
*                                                                  *            
*  DEC21/99 (BU ) --- ADD $=000 FOOTER                             *            
*                                                                  *            
*  MAR27/00 (BU ) --- REREPRGEQB -->  REREPRGEQC                   *            
*                     NEW VERSION OF REREPVALM (NEW TRADE FIELDS)  *            
*                                                                  *            
*  APR24/00 (BU ) --- ADD INTERACTIVE MEDIA TO KATZ COMBO TABLE    *            
*                                                                  *            
*  OCT30/00 (BU ) --- ADD 'TRADE' OPTION TO VALU3NEW CALLS         *            
*                                                                  *            
*  FEB10/01 (BU ) --- TURN OFF OPERATOR RESPONSE REQUIRED.         *            
*                                                                  *            
*  MAR27/01 (BU ) --- FIX 'LAST WEEK' BUG                          *            
*                                                                  *            
*  MAY05/01 (BU ) --- FIX PRIOR YEAR SHARE CALC                    *            
*                                                                  *            
*  MAY21/01 (BU ) --- DAILY PACING VERSION                         *            
*                                                                  *            
*  SEP26/01 (BU ) --- BUYLINE CODING: ALTERNATE DATA FEED          *            
*                                                                  *            
*  DEC13/01 (BU ) --- COMPENSATION S/P ADDED                       *            
*                                                                  *            
*  JAN24/02 (BU ) --- CONTRACT END DATE/JOIN DATE ADDED            *            
*                                                                  *            
*  FEB07/02 (BU ) --- SPL AS-RUN ERROR: THSWKFLG                   *            
*                                                                  *            
*  APR05/02 (BU ) --- USE VALU5NEW.  ADD BLOCK OF A(DATCON/ADDAY/  *            
*                     GETDAY) FOR ITS USE.                         *            
*                                                                  *            
*  MAY10/02 (BU ) --- ADD KTV SUB 8K TO SET LOGIC                  *            
*                                                                  *            
*                                                                  *            
*                                                                  *            
*                     ** END TOMBSTONE **                          *            
********************************************************************            
RERG02   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,**RG02**,R9,RR=RE                                              
         L     RA,0(R1)                                                         
         USING WORKD,RA                                                         
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         L     R8,=A(RGWORKC)                                                   
         USING RGWORKC,R8                                                       
*                                                                               
         L     R3,ADCONLST                                                      
         USING ADCONSD,R3                                                       
         L     R6,MASTC            ADDRESS MASTER CONTROL                       
         USING MASTD,R6                                                         
*                                                                               
         ST    RE,RELO                                                          
         L     R1,=A(QWAREA)                                                    
         A     R1,RELO                                                          
         ST    R1,AQWORK                                                        
*                                                                               
*      NEW MONTH TABLE SPACE ASSIGNED                                           
*      VIA 'COVAIL' CALL IN 'FILCON'                                            
*                                                                               
         LA    R0,AXTRAN           SET EXTENTION ROUTINES                       
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         L     R1,=A(EXTRA)                                                     
         ST    R1,AXTRA(RE)                                                     
         STC   RF,AXTRA(RE)                                                     
         LA    RF,1(RF)                                                         
         LA    RE,4(RE)                                                         
         BCT   R0,*-16                                                          
*                                                                               
         CLI   MODE,RUNFRST        CHECK MODE SETTINGS                          
         BE    RG005                                                            
         CLI   MODE,REQFRST                                                     
         BE    REQFIRST                                                         
         CLI   MODE,MULTIMOD       MULTI-LOOP RETURN?                           
         BE    REQFIRST                                                         
         CLI   MODE,MULTIPRE       MULTI-LOOP RETURN - PRE-REPORT?              
         BE    REQFIRST                                                         
*                                                                               
*                                                                               
EQXIT    CR    RB,RB                                                            
         B     XIT                                                              
*                                                                               
NEXIT    LTR   RB,RB                                                            
*                                                                               
XIT      XIT1                                                                   
*                                                                               
         DROP  R3                                                               
         EJECT                                                                  
*                                                                               
*        RUNFRST                                                                
*                                                                               
RG005    L     R1,=A(BUFFALOC)                                                  
         A     R1,RELO                                                          
         ST    R1,BUFFC                                                         
         GOTO1 BUFFALO,DMCB,=C'SET',BUFFC          INIT BUFFALO                 
*                                                                               
         LA    R4,RGKEYLEN                                                      
         LA    R5,SORTCARD+15                                                   
         EDIT  (R4),(3,(R5)),ZERO=NOBLANK    MERGER KEY LENGTH                  
         LA    R4,RGRECLEN                                                      
         LA    R5,RECCARD+21                                                    
         EDIT  (R4),(3,(R5)),ZERO=NOBLANK    MERGER RECORD LENGTH               
*                                                                               
         MVC   DMCB+8(4),SORTER                                                 
         MVI   DMCB+8,25           MAX NO REPORTS PER REQUEST                   
         OI    DMCB+8,X'80'                                                     
         GOTO1 MERGER,DMCB,SORTCARD,RECCARD        INIT MERGER                  
*                                                                               
         GOTO1 DATCON,DMCB,(4,RCDATE),(3,RUNDATE)  SET THE RUN DATE             
*                                                                               
         GOTO1 DATAMGR,DMCB,=C'OPEN',=C'REP',=C'NCTFILE X'                      
*                                                                               
         L     RF,=V(RESETSPC)     SET A(SET STORAGE SPACE)                     
         ST    RF,ANEXTSET         SET A(NEXT SET LOCATION)                     
         ST    RF,AFRSTSET         SET A(FRST SET LOCATION)                     
*        MVC   P+1(13),=C'HIGH-MEM ADDR'                                        
*        GOTO1 HEXOUT,DMCB,ANEXTSET,P+22,4,=C'TOG'                              
*        GOTO1 REPORT                                                           
         B     XIT                                                              
         EJECT                                                                  
*                                                                               
*        REQUEST FIRST                                                          
*                                                                               
REQFIRST EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        MVC   P+1(08),=C'REQFIRST'                                             
*        GOTO1 REPORT                                                           
*   TEST                                                                        
*                                                                               
*   TEST:  USING TEST VERSON REPFACS                                            
*                                                                               
*TEST*   GOTOX LOADER,DMCB,=CL8'T00AACA',0                                      
         GOTOX LOADER,DMCB,=CL8'T00AAC',0                                       
         MVC   VREPFACS,4(R1)      LOADED REPFACS                               
         OC    VREPFACS,VREPFACS   REPFACS FOUND?                               
         BNZ   *+6                 YES                                          
         DC    H'0'                NO  - KILL IT                                
*                                                                               
         GOTO1 =A(CKCMBRP),DMCB,(RC)                                            
         GOTO1 =A(OPTSTAS),DMCB,(RC)                                            
*                                                                               
         L     R5,ASPACND4         SORT STATIONS IN MARKET ORDER                
         XC    IOAREA(50),IOAREA   CLEAR FIRST 50 BYTES                         
         SR    R4,R4                                                            
RFIR0260 CLI  0(R5),0             END OF FILE                                   
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         CLI   0(R5),2             STATION                                      
         BE    RFIR0280                                                         
         IC    R4,1(R5)                                                         
         AR    R5,R4               NEXT ELEMENT                                 
         B     RFIR0260                                                         
         SPACE 1                                                                
RFIR0280 ST    R5,FRST2            A(1ST ST ELT)                                
*                                                                               
*   TEST                                                                        
*        MVC   P+1(06),=C'FRST2='                                               
*        MVC   P+7(4),FRST2                                                     
*        MVC   P+15(68),0(R5)                                                   
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
RFIR0300 ST    R5,SFRST2           A(1ST STN ELT) FOR SORTING                   
         IC    R4,1(R5)            LENGTH OF STATION ELEMENT                    
*        MVC   IOAREA(2),DMKTREP(R5)    REP CODE FROM TABLE ENTRY               
         SR    R2,R2                                                            
RFIR0320 CLI   0(R5),2             COUNT # OF ELEMENTS TO BE SORTED             
         BE    RFIR0340                                                         
         MVC   IOAREA+2(2),=X'FFFF'  FLAG AS FINISHED                           
         B     RFIR0360            SORT LAST REP'S STATION                      
RFIR0340 EQU   *                                                                
*        CLC   IOAREA(2),DMKTREP(R5)    SAME REP?                               
*        BNE   RFIR0360            NO  - SORT WHAT YOU HAVE                     
         LA    R2,1(R2)                                                         
         AR    R5,R4               NEXT ELEMENT                                 
         B     RFIR0320                                                         
         SPACE 1                                                                
RFIR0360 EQU   *                                                                
         GOTO1 =V(QSORT),DMCB,(0,SFRST2),(R2),(R4),20,17                        
         GOTO1 =A(SORTSTAS),DMCB,(0,SFRST2),(R2),(R4),(RC)                      
         CLC   IOAREA+2(2),=X'FFFF'  LAST SORT?                                 
         BE    RFIR0380            YES                                          
         B     RFIR0300            GO BACK FOR NEXT                             
*                                                                               
*                                                                               
*        *****FOR MARKET TOTALS******                                           
*  FOR EACH STATION WITH A COMMON MARKET, FIND THE RELATIVE NUMBER              
*  OF THE LAST STATION IN THAT MARKET AND PUT IT IN EACH STATION                
*  RECORD IN SPACEND (+52).  ZERO DISP MEANS 1 STATION IN THE MKT.              
*   TO GET TO THE CORRECT RECORD, SUBTRACT 1 FROM THE COUNTER AND               
*   MULTIPLY BY L'STATION RECORD.                                               
*                                                                               
RFIR0380 EQU   *                                                                
         SR    RE,RE                                                            
         XC    IOAREA(256),IOAREA                                               
         LA    R1,IOAREA                                                        
*                                                                               
         L     R5,FRST2            FIRST STATION ELEMENT                        
         SR    RF,RF               STATION COUNTER                              
         LR    R2,R5                                                            
*                                                                               
RFIR0400 IC    RE,1(R2)                                                         
         AR    R2,RE               POINT TO NEXT STATION                        
         LA    RF,1(RF)            AND INCREMENT STATION COUNTER                
*                                                                               
         CLI   0(R2),2             ARE WE STILL ON STATION ELEMENT              
         BNE   RFIR0420                                                         
         CLC   DMKTNAM(20,R2),DMKTNAM(R5)    SAME MARKET?                       
         BNE   RFIR0420                                                         
*                                                                               
         ST    R5,0(R1)            YES                                          
         LA    R1,4(R1)                                                         
         IC    RE,1(R5)            POINT TO NEXT STATION                        
         AR    R5,RE                                                            
         B     RFIR0400                                                         
*                                                                               
RFIR0420 LA    R1,IOAREA                                                        
RFIR0440 OC    0(4,R1),0(R1)       MORE THAN 1 STA PER MKT                      
         BZ    RFIR0480                                                         
*                                                                               
         STH   RF,DSTNDISP(R5)     STORE DISP OF LAST STA IN MKT                
RFIR0460 L     R5,0(R1)            GO BACK TO OTHER STATIONS IN MKT             
         STH   RF,DSTNDISP(R5)     AND STORE DISP IN THEM                       
         XC    0(4,R1),0(R1)                                                    
         LA    R1,4(R1)                                                         
         OC    0(4,R1),0(R1)       MORE STATIONS                                
         BNZ   RFIR0460                                                         
*                                                                               
RFIR0480 CLI   0(R2),2             MORE STATION RECORDS                         
         BNE   RFIR0500            NO                                           
         LR    R5,R2               NEXT STATION                                 
         LA    R1,IOAREA                                                        
         B     RFIR0400                                                         
*                                                                               
RFIR0500 EQU   *                                                                
         ZAP   DUB,RCENNUM         SET END TO 9999                              
         CVB   R0,DUB                                                           
         STC   R0,REQEND           REQUEST END NUM                              
         CH    R0,=H'256'                                                       
         BL    *+8                                                              
         MVI   REQEND,X'FF'                                                     
         ZAP   DUB,RCSTNUM         SET START TO 1                               
         CVB   R0,DUB                                                           
         STC   R0,REQST            REQUEST START NUM                            
         BCTR  R0,0                                                             
         STC   R0,REQNUM           INITIALIZE REQUEST COUNTER                   
         MVI   RPTNUM,0            REPORT COUNTER                               
         MVI   SALES,C'N'          INDICATORS - SALES RPT                       
         MVI   AVAILS,C'N'                      AVAIL RPT                       
         MVI   BUDGETS,C'N'                     BUDGETS                         
         MVI   AVLDTMSK,0                       AVAIL REQ DATES                 
         MVI   COMIND,0            COMMISSION INDICATOR                         
         MVI   RDIND,0             READ INDICATOR                               
*                                                                               
         L     R2,AQWORK           ADDRESS REQ WORK AREA                        
         USING QWKD,R2                                                          
*                                                                               
         CLI   MODE,MULTIMOD       MULTI-FILE LOOP?                             
         BE    RFIR0580            YES - DON'T LOOK FOR NEXT CARDS              
*                                                                               
         CLI   MODE,MULTIPRE       MULTI-FILE LOOP - PRE-REPORT?                
         BE    RFIR0580            YES - DON'T LOOK FOR NEXT CARDS              
*                                                                               
         STCM  R2,7,QWNEXT         POINT FIRST QWORK TO ITSELF                  
         L     R7,VXADDR                                                        
         USING VXADDRD,R7                                                       
         L     R4,VXRQNUM                                                       
         L     R5,VXRQCARD                                                      
         MVC   QWNREQ,0(R4)        SAVE N'REQUEST CARDS                         
         CLI   QWNREQ,1            TEST: 2ND REQUEST CARD?                      
         BNH   RFIR0580            NO                                           
         MVC   QRECORD2,80(R5)     YES - SAVE IT                                
         CLI   QWNREQ,2            TEST: 3RD REQUEST CARD?                      
         BNH   RFIR0580            NO                                           
         MVC   QRECORD3,160(R5)    YES - SAVE IT                                
*                                                                               
*   CHECK IF CROSS-FILE REQUEST.  IF SO, LOAD THE ALTERNATE                     
*        MARKET STATION AREA.                                                   
*                                                                               
         GOTO1 =A(CHKXFIL),DMCB,(RC)                                            
*                                                                               
         B     RFIR0580            PROCESS FIRST REQ                            
*                                                                               
RFIR0520 EQU   *                                                                
         L     R3,ADCONLST                                                      
         USING ADCONSD,R3                                                       
         GOTO1 CARDREAD            READ NEXT REQUEST CARD                       
*                                                                               
         DROP  R3                                                               
*                                                                               
         CLI   MCRUNMOD,C'S'                                                    
         BE    *+10                IF RUN MODE IS NOT SINGLE,                   
         ZAP   MCREQNO,RCSTNUM      KEEP MASTER REQ NO AT FIRST                 
         MVC   QRECORD,MCREQREC                                                 
*                                                                               
*  TEST                                                                         
*        MVC   P+1(05),=C'QREC='                                                
*        MVC   P+7(1),MODE                                                      
*        MVC   P+10(80),QRECORD                                                 
*        GOTO1 REPORT                                                           
*  TEST END                                                                     
*                                                                               
         CLC   QPROG,=C'/*'        REQUEST CARD DELIMITER?                      
         BNE   RFIR0540            NO  - NOT END OF REQUEST CARDS               
         CLI   MCRUNMOD,C'S'       YES - END OF REQUEST CARDS                   
*                                     RUNMODE = SINGLE?                         
         BE    RFIR0780            YES - EVERYTHING PROCESSED:                  
*                                     END JOB                                   
         B     RFIR0620            NO  - RUNMODE = MULTI -                      
*                                     NOW PROCESS ALL REQUESTS                  
RFIR0540 EQU   *                                                                
         CLC   QREP,RCREPFL        FILTER ON REP                                
         BNE   RFIR0520                                                         
         AP    RCRQTOT,=P'1'                                                    
         ICM   R2,7,QWNEXT         POINT TO NEXT QWORK AREA                     
         MVC   QWNREQ,MCRQNUM                                                   
         MVC   0(1,R4),QWNREQ                                                   
         MVC   0(80,R5),QRECORD                                                 
         XC    QRECORD2,QRECORD2   CLEAR 2ND REQUEST CARD AREA                  
         CLI   QWNREQ,1            TEST SECOND REQUEST CARD                     
         BNH   RFIR0560                                                         
         MVC   QRECORD2,MCIO+80    YES                                          
         MVC   80(80,R5),QRECORD2                                               
         XC    QRECORD3,QRECORD3   CLEAR 3RD REQUEST CARD AREA                  
         CLI   QWNREQ,2            TEST THIRD  REQUEST CARD                     
         BNH   RFIR0560                                                         
         MVC   QRECORD3,MCIO+160   YES                                          
         MVC   160(80,R5),QRECORD3                                              
RFIR0560 L     R1,ABOX             MAKE SURE BOXES ARE OFF                      
         MVI   BOXOFF-BOXD(R1),C'Y'                                             
         GOTO1 REQREP,DMCB         EDIT REQUEST                                 
         OC    DMCB(4),DMCB        TEST FOR ERRORS                              
         BZ    RFIR0580                                                         
         AP    RCRQERR,=P'1'                                                    
         B     RFIR0520                                                         
*                                                                               
RFIR0580 EQU   *                                                                
         CLI   MODE,X'FC'          MULTI-FILE LOOP - PRE-REPORT?                
         BE    RFIR0740            YES - SKIP ALL SECOND SETUP                  
*                                     AND EXIT RERG02                           
         CLI   MODE,X'FD'          MULTI-FILE LOOP?                             
         BE    RFIR0700            YES - SKIP ALL SECOND SETUP                  
         BAS   RE,VALIDATE         VALIDATE REQ CARD                            
         BNE   RFIR0520                                                         
*                                                                               
RFIR0600 EQU   *                                                                
         ZIC   RE,REQNUM                                                        
         LA    RE,1(RE)                                                         
         STC   RE,REQNUM           INCREMENT REQUEST NUMBER                     
         BAS   RE,REQUEST          SET UP WORK AREAS FOR THIS REQ               
         BAS   RE,REQFILT          DETERMINE FILTERS FOR THIS REQ               
         CLI   MCRUNMOD,C'S'       IN SINGLE RUN MODE,                          
         BNE   RFIR0520             ONLY READ ONE REQUEST AT A TIME             
*                                                                               
RFIR0620 EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        MVC   P+1(08),=C'DATES:  '                                             
*        MVC   P+10(16),SVQSTART                                                
*        GOTO1 REPORT                                                           
*   TEST                                                                        
*                                                                               
         CLI   QWSALES,C'Y'        TEST FOR ANY SALES RPTS                      
         BNE   RFIR0640                                                         
         GOTO1 =A(SETMONTB),DMCB,(RC)                                           
*                                  SET UP NEW FORMAT MONTH TABLE                
RFIR0640 EQU   *                                                                
         CLI   REQNUM,0            TEST FOR ANY REQUESTS                        
         BE    RFIR0780                                                         
         XC    QWNEXT,QWNEXT       MARK LAST REQUEST                            
         CLI   MCRUNMOD,C'S'       SKIP RESTART LOGIC                           
         BE    RFIR0680             FOR SINGLE RUN MODE                         
         CLI   MCRESTRT,C'Y'       CHECK FOR RESTART                            
         BNE   RFIR0680                                                         
         OPEN  (BKUP,INPUT)        OPEN RESTART FILE FOR INPUT                  
*                                                                               
RFIR0660 GET   BKUP,BFREC          GET RESTART RECORD                           
         CLC   REQST,BFKEY                                                      
         BH    RFIR0660                                                         
         CLC   REQEND,BFKEY                                                     
         BL    RFIR0660                                                         
         GOTO1 MERGER,DMCB,=C'PUT',BFREC   WRITE MERGER FROM RESTART            
         B     RFIR0660                                                         
*                                                                               
RFIR0680 EQU   *                                                                
         OPEN  (BKUP,OUTPUT)       OPEN RESTART FILE FOR OUTPUT                 
RFIR0700 EQU   *                                                                
         MVI   RECORD,C'C'                                                      
         BAS   RE,WRITE            PROCESS CONTRACT RECORDS                     
*                                                                               
         CLI   BUDGETS,C'Y'                                                     
         BNE   RFIR0720                                                         
         MVI   RECORD,C'B'                                                      
         BAS   RE,WRITE            PROCESS BUDGET RECORDS                       
*                                                                               
RFIR0720 EQU   *                                                                
**                                                                              
**   TEST MULTI-FILE INTERFACE                                                  
****     MVC   P+1(05),=C'END: '                                                
****     MVC   P+7(2),RCREPFL                                                   
****     MVC   P+10(80),QRECORD3                                                
****     GOTO1 REPORT                                                           
****     DC    H'0'                                                             
**   TEST MULTI-FILE INTERFACE END                                              
         LA    RF,QRECORD3                                                      
         USING QREC3,RF                                                         
*                                                                               
         CLC   Q3XFILNM,SPACES     MULTI-FILE REQUEST?                          
         BE    RFIR0740            NO  - BYPASS MULTIFILE TEST                  
         OC    Q3XFILNM,Q3XFILNM   MULTI-FILE REQUEST?                          
         BZ    RFIR0740            NO  - BYPASS MULTIFILE TEST                  
*                                                                               
         DROP  RF                                                               
*                                                                               
*                                                                               
*   TEST                                                                        
*        MVC   P+1(03),=C'R2='                                                  
*        STCM  R2,15,P+4                                                        
*        MVC   P+12(80),QWREQ-QWORK(R2)                                         
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         GOTO1 =A(MULTIFIL),DMCB,(RC),(R2)                                      
         BZ    XIT                 =Z  ->  STILL FILES TO PROCESS               
*                                     MODE SET BY 'MULTIFIL' ROUTINE            
*                                  NZ  ->  ALL FILES PROCESSED                  
*                                                                               
**   TEST MULTI-FILE INTERFACE END                                              
**                                                                              
RFIR0740 EQU   *                                                                
         MVI   RECORD,X'FF'                                                     
         BAS   RE,WRITE            PUT REMAINING BUFFALO TO MERGER              
         CLC   RCRQFILT,=C'RT'     TEST FOR WRITE TO TAPE REQUEST               
         BNE   RFIR0760                                                         
         LA    R0,LLOGMSG                                                       
         GOTO1 LOGIO,DMCB,1,((R0),LOGMSG)   GIVE OPERATOR A NUDGE               
***>>>   GOTO1 LOGIO,DMCB,0,(1,BYTE)        WAIT FOR REPLY                      
*                                                                               
RFIR0760 CLOSE (BKUP)              CLOSE RESTART FILE                           
*                                                                               
*   TEST                                                                        
*        MVC   P+1(13),=C'OUTPUT COUNT='                                        
*        EDIT  OUTCOUNT,(8,P+14)                                                
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
*                                                                               
*   TEST                                                                        
**       MVC   P+1(07),=C'RERG02:'                                              
**       MVC   P+10(06),DOUBLE+8                                                
**       GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         L     RF,=V(RERG03)                                                    
         GOTO1 (RF),DMCB,(RA),(R6) CALL OUTPUT PROCESSOR                        
         CLI   MCRUNMOD,C'S'       TEST FOR SINGLE RUN MODE                     
         BNE   RFIR0780                                                         
         MVI   RPTNUM,0            INITIALIZE EVERYTHING                        
         MVI   REQNUM,0                                                         
         MVI   SALES,C'N'                                                       
         MVI   AVAILS,C'N'                                                      
         MVI   BUDGETS,C'N'                                                     
         MVI   AVLDTMSK,0                                                       
         MVI   COMIND,0                                                         
         MVI   RDIND,0                                                          
         GOTO1 BUFFALO,DMCB,=C'RESET',BUFFC                                     
         GOTO1 MERGER,DMCB,=C'END'                                              
         L     R1,=A(RPSPECS)                                                   
         L     R0,=A(RPSPECSX)                                                  
         BAS   RE,CLEAR                                                         
         L     R1,=A(QWAREA)                                                    
         L     R0,=A(QWAREAX)                                                   
         BAS   RE,CLEAR                                                         
         L     R2,AQWORK                                                        
         STCM  R2,7,QWNEXT                                                      
*                                                                               
*   TEST                                                                        
*        MVC   P+1(08),=C'SVQ/NEW:'                                             
*        MVC   P+10(6),SVQSTART                                                 
*        MVI   P+16,C'/'                                                        
*        MVC   P+17(6),NEWSTART                                                 
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         MVC   SVQSTART,NEWSTART                                                
*                                  RESET START DATE SAVE                        
         XC    SVQEND,SVQEND       RESET END   DATE SAVE                        
         B     RFIR0520            GO ROUND AGAIN                               
*                                                                               
RFIR0780 EQU   *                                                                
         MVI   MODE,X'FF'          FILE CONTROLLER LAST TIME HOOK               
         B     XIT                                                              
         DROP  R7                                                               
         EJECT                                                                  
*                                                                               
*        VALIDATE REQUEST CARD                                                  
*                                                                               
         SPACE                                                                  
VALIDATE NTR1                                                                   
         MVC   ACCOPT,QACCTOPT     SAVE ACCOUNTING OPTION                       
         MVC   REQDAY,QSTART+4     SAVE 1ST CHAR OF REQUEST DAY                 
         MVC   QSTART+4(2),=C'01'                                               
         MVC   QEND+4(2),=C'01'                                                 
         GOTO1 DATCON,DMCB,QSTART,(3,WORK)                                      
         GOTO1 (RF),(R1),QEND,(3,WORK+3)                                        
         CLC   WORK(3),WORK+3      CHECK START DATE LE END DATE                 
         BH    INPERR                                                           
         MVC   CURST,WORK          CUR PERIOD START                             
         MVC   CURST3,WORK         SAVE 3-BYTE DATE                             
         CLI   REQDAY,C' '         ANY DAY IN REQUEST DATES?                    
         BNE   VALI0010            YES - LEAVE DAY                              
         XC    CURST3+2(1),CURST3+2                                             
*                                  NO  - SET DAY TO ZERO                        
VALI0010 EQU   *                                                                
         MVC   CURND,WORK+3        CUR PERIOD END                               
         MVC   CURND3,WORK+3       SAVE 3-BYTE DATE                             
         CLI   REQDAY,C' '         ANY DAY IN REQUEST DATES?                    
         BNE   VALI0020            YES - LEAVE DAY                              
         XC    CURND3+2(1),CURND3+2                                             
*                                  NO  - SET DAY TO ZERO                        
VALI0020 EQU   *                                                                
         MVC   PRIST,CURST                                                      
         ZIC   R5,PRIST                                                         
         BCTR  R5,0                                                             
         STC   R5,PRIST            PRIOR PERIOD START                           
         MVC   PRIST3(2),PRIST     SAVE 3-BYTE DATE                             
         MVC   PRIST3+2(1),WORK+2  INSERT DAY FROM CURRENT START                
         CLI   REQDAY,C' '         ANY DAY IN REQUEST DATES?                    
         BNE   VALI0030            YES - LEAVE DAY                              
         XC    PRIST3+2(1),PRIST3+2                                             
*                                  NO  - SET DAY TO ZERO                        
VALI0030 EQU   *                                                                
         MVC   PRIND,CURND                                                      
         IC    R5,PRIND                                                         
         BCTR  R5,0                                                             
         STC   R5,PRIND            PRIOR PERIOD END                             
         MVC   PRIND3(2),PRIND     SAVE 3-BYTE DATE                             
         MVC   PRIND3+2(1),WORK+5  INSERT DAY FROM CURRENT START                
         CLI   REQDAY,C' '         ANY DAY IN REQUEST DATES?                    
         BNE   VALI0040            YES - LEAVE DAY                              
         XC    PRIND3+2(1),PRIND3+2                                             
*                                  NO  - SET DAY TO ZERO                        
VALI0040 EQU   *                                                                
         B     EQXIT                                                            
         SPACE 2                                                                
INPERR   AP    RCRQERR,=P'1'                                                    
         MVI   P,C'*'                                                           
         MVC   P+1(109),P                                                       
         MVC   PSECOND(20),=C'INVALID REQUEST CARD'                             
         MVC   PTHIRD(80),QRECORD                                               
         MVC   PFOURTH(110),P                                                   
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 REPORT                                                           
         B     NEXIT                                                            
         EJECT                                                                  
*        ROUTINE TO SET UP REQUEST WORK AREAS                                   
*                                                                               
         SPACE                                                                  
REQUEST  NTR1                      R2 = QWKD BASE                               
*                                                                               
*   TEST                                                                        
*        MVC   P+1(08),=C'REQUEST:'                                             
*        MVC   P+10(6),SVQSTART                                                 
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         LA    R4,QRECORD2         SET ADDRESSABILITY FOR 2ND                   
         USING QREC2D,R4              REQUEST CARD                              
*                                                                               
         MVC   QWACCOPT,ACCOPT     SAVE ACCOUNTING OPTION                       
         MVC   QWCURST,CURST       CUR REQ PERIOD                               
         MVC   QWCURND,CURND                                                    
         MVC   QWPRIST,PRIST       PRIOR REQ PERIOD                             
         MVC   QWPRIND,PRIND                                                    
         MVC   QWCURST3,CURST3     CUR REQ PERIOD: 3-BYTE FORMAT                
         MVC   QWCURND3,CURND3                                                  
         MVC   QWPRIST3,PRIST3     PRIOR REQ PERIOD: 3-BYTE FORMAT              
         MVC   QWPRIND3,PRIND3                                                  
         XC    QWMONADJ,QWMONADJ                                                
         CLC   QWCURST(1),QWCURND  TEST START AND END YEARS THE SAME            
         BE    *+16                                                             
         ZIC   RE,QWCURST+1        NO - SET MONTH ADJUSTMENT                    
         BCTR  RE,0                                                             
         STH   RE,QWMONADJ                                                      
         XC    CURST(8),CURST      CLEAR PERIODS WORK                           
         MVC   QWREQNUM,REQNUM     REQUEST SEQUENCE NUM                         
         MVI   QWNAOFLG,C'Y'       SET 'INCLUDE AGY/OFF OFFICE'                 
         CLI   QAGENCY,C'*'        SET OR SUPPRESS AGY/OFF'S OFF?               
         BNE   RQST0040            NO  -                                        
         CLC   QSETAGY,SPACES      SET NAME ENTERED?                            
         BNE   RQST0040            YES - KEEP '*' ON REQUEST CARD               
         MVI   QWNAOFLG,C'N'       NO  - SET 'EXCLUDE AGY/OFF OFFICE'           
         MVC   QAGENCY,SPACES      SPACE-FILL AGENCY FIELD                      
         B     RQST0040                                                         
RQST0040 EQU   *                                                                
         MVC   QWREQ,QRECORD       REQ CARD                                     
         CLI   CMBOREP,C'Y'        MASTER OR SUBSIDIARY?                        
         BNE   RQST0080            NO                                           
         CLI   QSTATION+4,C'C'     REQUEST FOR COMBO STATION?                   
         BNE   RQST0080            NO                                           
         GOTO1 SETCOMBO,DMCB,(R2)  YES - GET STATION'S COMBO PARTNERS           
RQST0080 EQU   *                                                                
         CLI   QWNREQ,1            TEST: 2ND REQ CARD?                          
         BNH   RQST0360            NO                                           
         MVC   QWREQ2,QRECORD2     YES                                          
         CLC   Q2PPSON,SPACES      TEST POINT PERSON                            
         BH    *+14                                                             
         CLC   Q2NCNUM,SPACES      OR NETWORK CONTRACT NUMBER FILTERS           
         BNH   RQST0120                                                         
         OI    RDIND,RDIPRD        YES-MUST READ PRODUCT RECORDS                
RQST0120 EQU   *                                                                
         CLI   QMAN,C'*'           SALESPERSON SET REQUESTED?                   
         BNE   RQST0160            NO                                           
*                                                                               
         LA    RE,WORK+32          SET UP WORKSPACE                             
         USING RSETLOAD,RE                                                      
*                                                                               
         LA    RF,QSETSAL                                                       
         ST    RF,RSETRNAM         A(SET NAME IN REQUEST CARD)                  
         LA    RF,QWSALSET                                                      
         ST    RF,RSETWADD         A(ADDR OF SET INFO) IN QWKD                  
         LA    RF,3                                                             
         ST    RF,RSETRSIZ         SET SIZE OF ENTRY                            
         MVC   RSETRTYP,=C'SP'     SET TYPE OF ENTRY                            
         MVI   RSETRFLG,X'40'      SET VALUE OF FLAG                            
         MVI   RSETROFF,0          SET VALUE OF BYTE OFFSET                     
         MVI   RSETRMST,1          SET 'CHEK MASTER/SUBS'                       
*                                                                               
         DROP  RE                                                               
*                                                                               
         GOTO1 =A(LOADSET),DMCB,(R4)                                            
RQST0160 EQU   *                                                                
         CLI   QGROUP,C'*'         GRP/SUBGRP SET REQUESTED?                    
         BNE   RQST0200            NO                                           
*                                                                               
         LA    RE,WORK+32          SET UP WORKSPACE                             
         USING RSETLOAD,RE                                                      
*                                                                               
         LA    RF,QSETGSG                                                       
         ST    RF,RSETRNAM         A(SET NAME IN REQUEST CARD)                  
         LA    RF,QWGRPSET                                                      
         ST    RF,RSETWADD         A(ADDR OF SET INFO) IN QWKD                  
         LA    RF,2                                                             
         ST    RF,RSETRSIZ         SET SIZE OF ENTRY                            
         MVC   RSETRTYP,=C'GS'     SET TYPE OF ENTRY                            
         MVI   RSETRFLG,X'80'      SET VALUE OF FLAG                            
         MVI   RSETROFF,0          SET VALUE OF BYTE OFFSET                     
         MVI   RSETRMST,1          SET 'CHEK MASTER/SUBS'                       
*                                                                               
         DROP  RE                                                               
*                                                                               
         GOTO1 =A(LOADSET),DMCB,(R4)                                            
RQST0200 EQU   *                                                                
         CLI   QAGENCY,C'*'        AGY/AGYOFF SET REQUESTED?                    
         BNE   RQST0220            NO                                           
         CLC   QSETAGY,SPACES      MAYBE - ANY SET NAME?                        
         BE    RQST0240            NO - MUST BE RANK SUPPRESSION                
*                                                                               
         LA    RE,WORK+32          SET UP WORKSPACE                             
         USING RSETLOAD,RE                                                      
*                                                                               
         LA    RF,QSETAGY                                                       
         ST    RF,RSETRNAM         A(SET NAME IN REQUEST CARD)                  
         LA    RF,QWAGYSET                                                      
         ST    RF,RSETWADD         A(ADDR OF SET INFO) IN QWKD                  
         LA    RF,6                                                             
         ST    RF,RSETRSIZ         SET SIZE OF ENTRY                            
         MVC   RSETRTYP,=C'AG'     SET TYPE OF ENTRY                            
         MVI   RSETRFLG,X'10'      SET VALUE OF FLAG                            
         MVI   RSETROFF,0          SET VALUE OF BYTE OFFSET                     
         MVI   RSETRMST,1          SET 'CHEK MASTER/SUBS'                       
*                                                                               
         DROP  RE                                                               
*                                                                               
         GOTO1 =A(LOADSET),DMCB,(R4)                                            
RQST0220 EQU   *                                                                
         CLI   QAGENCY,C'+'        TERRITORY FILTER (SET) REQUESTED?            
         BNE   RQST0240            NO                                           
         LA    RE,WORK+32          SET UP WORKSPACE                             
         USING RSETLOAD,RE                                                      
*                                                                               
         LA    R1,QRECORD3         SET ADDRESSABILITY FOR 3RD                   
         USING QREC3D,R1              REQUEST CARD                              
*                                                                               
         LA    RF,Q3SETTER         2-CHAR TERRITORY CODE                        
*                                                                               
         DROP  R1                                                               
*                                                                               
         ST    RF,RSETRNAM         A(TERRITORY CODE IN REQUEST CARD)            
         LA    RF,QWAGYSET                                                      
         ST    RF,RSETWADD         A(ADDR OF SET INFO) IN QWKD                  
         LA    RF,6                                                             
         ST    RF,RSETRSIZ         SET SIZE OF ENTRY                            
         MVC   RSETRTYP,=C'AG'     SET TYPE OF ENTRY                            
         MVI   RSETRFLG,X'10'      SET VALUE OF FLAG                            
         MVI   RSETROFF,0          SET VALUE OF BYTE OFFSET                     
         MVI   RSETRMST,1          SET 'CHEK MASTER/SUBS'                       
*                                                                               
         DROP  RE                                                               
*                                                                               
         GOTO1 =A(LOADTER),DMCB,(R4)                                            
*                                  LOAD AGENCIES BY TERRITORY                   
*                                     AS IF THEY WERE A SET!!                   
RQST0240 EQU   *                                                                
         CLI   QADV,C'*'           ADVERTISER SET REQUESTED?                    
         BNE   RQST0280            NO                                           
*                                                                               
         LA    RE,WORK+32          SET UP WORKSPACE                             
         USING RSETLOAD,RE                                                      
*                                                                               
         LA    RF,QSETADV                                                       
         ST    RF,RSETRNAM         A(SET NAME IN REQUEST CARD)                  
         LA    RF,QWADVSET                                                      
         ST    RF,RSETWADD         A(ADDR OF SET INFO) IN QWKD                  
         LA    RF,4                                                             
         ST    RF,RSETRSIZ         SET SIZE OF ENTRY                            
         MVC   RSETRTYP,=C'AD'     SET TYPE OF ENTRY                            
         MVI   RSETRFLG,X'20'      SET VALUE OF FLAG                            
         MVI   RSETROFF,0          SET VALUE OF BYTE OFFSET                     
         MVI   RSETRMST,1          SET 'CHEK MASTER/SUBS'                       
*                                                                               
         DROP  RE                                                               
*                                                                               
         GOTO1 =A(LOADSET),DMCB,(R4)                                            
RQST0280 EQU   *                                                                
         DROP  R4                                                               
         CLI   QWNREQ,2            TEST: 3RD REQ CARD?                          
         BNH   RQST0360            NO                                           
         MVC   QWREQ3,QRECORD3     YES                                          
         LA    R4,QRECORD3                                                      
         CLI   NRRGFLAG,C'N'       NRRGFLAG ALREADY SET?                        
         BNE   RQST0282            YES - DON'T RESET IT                         
         MVC   NRRGFLAG,Q3NRRGON-QREC3(R4)                                      
*                                  SAVE NRRGON DATE ADJUSTMENT FLAG             
RQST0282 EQU   *                                                                
         CLI   QSTATION,C'*'       STATION SET REQUESTED?                       
         BNE   RQST0285            NO                                           
*                                                                               
         LA    RE,WORK+32          SET UP WORKSPACE                             
         USING RSETLOAD,RE                                                      
*                                                                               
         LA    RF,Q3STASET-QREC3(R4)                                            
         ST    RF,RSETRNAM         A(SET NAME IN REQUEST CARD)                  
         LA    RF,QWSTASET                                                      
         ST    RF,RSETWADD         A(ADDR OF SET INFO) IN QWKD                  
         LA    RF,5                                                             
         ST    RF,RSETRSIZ         SET SIZE OF ENTRY                            
         MVC   RSETRTYP,=C'ST'     SET TYPE OF ENTRY                            
         MVI   RSETRFLG,X'08'      SET VALUE OF FLAG                            
         MVI   RSETROFF,0          SET VALUE OF BYTE OFFSET                     
         MVI   RSETRMST,0          SET 'SKIP MASTER/SUBS'                       
*                                                                               
         DROP  RE                                                               
*                                                                               
         GOTO1 =A(LOADSET),DMCB,(R4)                                            
RQST0285 EQU   *                                                                
         CLI   QCONTYPE,C'*'       CONTYPE SET REQUESTED?                       
         BNE   RQST0290            NO                                           
*                                                                               
         LA    RE,WORK+32          SET UP WORKSPACE                             
         USING RSETLOAD,RE                                                      
*                                                                               
         LA    RF,Q3CTYSET-QREC3(R4)                                            
         ST    RF,RSETRNAM         A(SET NAME IN REQUEST CARD)                  
         LA    RF,QWCTYSET                                                      
         ST    RF,RSETWADD         A(ADDR OF SET INFO) IN QWKD                  
         LA    RF,1                                                             
         ST    RF,RSETRSIZ         SET SIZE OF ENTRY                            
         MVC   RSETRTYP,=C'CT'     SET TYPE OF ENTRY                            
         MVI   RSETRFLG,X'04'      SET VALUE OF FLAG                            
         MVI   RSETROFF,0          SET VALUE OF BYTE OFFSET                     
         MVI   RSETRMST,0          SET 'SKIP MASTER/SUBS'                       
*                                                                               
         DROP  RE                                                               
*                                                                               
         GOTO1 =A(LOADSET),DMCB,(R4)                                            
RQST0290 EQU   *                                                                
         LA    RF,QRECORD2                                                      
         USING QREC2D,RF                                                        
         CLI   QDEVCTYP,C'*'       DEV CON TYPE SET REQUESTED?                  
         BNE   RQST0295            NO                                           
*                                                                               
         DROP  RF                                                               
*                                                                               
         LA    RE,WORK+32          SET UP WORKSPACE                             
         USING RSETLOAD,RE                                                      
*                                                                               
         LA    RF,Q3DTYSET-QREC3(R4)                                            
         ST    RF,RSETRNAM         A(SET NAME IN REQUEST CARD)                  
         LA    RF,QWDTYSET                                                      
         ST    RF,RSETWADD         A(ADDR OF SET INFO) IN QWKD                  
         LA    RF,2                                                             
         ST    RF,RSETRSIZ         SET SIZE OF ENTRY                            
         MVC   RSETRTYP,=C'DT'     SET TYPE OF ENTRY                            
         MVI   RSETRFLG,X'02'      SET VALUE OF FLAG                            
         MVI   RSETROFF,0          SET VALUE OF BYTE OFFSET                     
         MVI   RSETRMST,1          SET 'CHEK MASTER/SUBS'                       
*                                                                               
         DROP  RE                                                               
*                                                                               
         GOTO1 =A(LOADSET),DMCB,(R4)                                            
RQST0295 EQU   *                                                                
         LA    RF,QRECORD2                                                      
         USING QREC2D,RF                                                        
         CLI   Q2PPSON,C'*'        POINT PERSON SET REQUESTED?                  
         BNE   RQST0300            NO                                           
*                                                                               
         DROP  RF                                                               
*                                                                               
         LA    RE,WORK+32          SET UP WORKSPACE                             
         USING RSETLOAD,RE                                                      
*                                                                               
         LA    RF,Q3PPRSET-QREC3(R4)                                            
         ST    RF,RSETRNAM         A(SET NAME IN REQUEST CARD)                  
         LA    RF,QWPPRSET                                                      
         ST    RF,RSETWADD         A(ADDR OF SET INFO) IN QWKD                  
         LA    RF,3                                                             
         ST    RF,RSETRSIZ         SET SIZE OF ENTRY                            
         MVC   RSETRTYP,=C'PP'     SET TYPE OF ENTRY                            
         MVI   RSETRFLG,X'01'      SET VALUE OF FLAG                            
         MVI   RSETROFF,0          SET VALUE OF BYTE OFFSET                     
         MVI   RSETRMST,1          SET 'CHEK MASTER/SUBS'                       
*                                                                               
         DROP  RE                                                               
*                                                                               
         GOTO1 =A(LOADSET),DMCB,(R4)                                            
RQST0300 EQU   *                                                                
         CLI   QOFFICE,C'*'        OFFICE SET REQUESTED?                        
         BNE   RQST0305            NO                                           
*                                                                               
         LA    RE,WORK+32          SET UP WORKSPACE                             
         USING RSETLOAD,RE                                                      
*                                                                               
         LA    RF,Q3OFFSET-QREC3(R4)                                            
         ST    RF,RSETRNAM         A(SET NAME IN REQUEST CARD)                  
         LA    RF,QWOFFSET                                                      
         ST    RF,RSETWADD         A(ADDR OF SET INFO) IN QWKD                  
         LA    RF,2                                                             
         ST    RF,RSETRSIZ         SET SIZE OF ENTRY                            
         MVC   RSETRTYP,=C'OF'     SET TYPE OF ENTRY                            
         MVI   RSETRFLG,X'80'      SET VALUE OF FLAG                            
         MVI   RSETROFF,1          SET VALUE OF BYTE OFFSET                     
         MVI   RSETRMST,0          SET 'SKIP MASTER/SUBS'                       
*                                                                               
         DROP  RE                                                               
*                                                                               
         GOTO1 =A(LOADSET),DMCB,(R4)                                            
RQST0305 EQU   *                                                                
         LA    RF,QRECORD3                                                      
         USING QREC3D,RF                                                        
         CLC   Q3REPSET,SPACES     REP SET REQUESTED?                           
         BE    RQST0320            NO                                           
*                                                                               
         DROP  RF                                                               
*                                                                               
         LA    RE,WORK+32          SET UP WORKSPACE                             
         USING RSETLOAD,RE                                                      
*                                                                               
         LA    RF,Q3REPSET-QREC3(R4)                                            
         ST    RF,RSETRNAM         A(SET NAME IN REQUEST CARD)                  
         LA    RF,QWREPSET                                                      
         ST    RF,RSETWADD         A(ADDR OF SET INFO) IN QWKD                  
         LA    RF,2                                                             
         ST    RF,RSETRSIZ         SET SIZE OF ENTRY                            
         MVC   RSETRTYP,=C'RE'     SET TYPE OF ENTRY                            
         MVI   RSETRFLG,X'40'      SET VALUE OF FLAG                            
         MVI   RSETROFF,1          SET VALUE OF BYTE OFFSET                     
         MVI   RSETRMST,1          SET 'CHEK MASTER/SUBS'                       
*                                                                               
         DROP  RE                                                               
*                                                                               
         GOTO1 =A(LOADSET),DMCB,(R4)                                            
RQST0320 EQU   *                                                                
         LA    RF,QRECORD2                                                      
         USING QREC2D,RF                                                        
         CLI   Q2MARKET,C'*'       MARKET SET REQUESTED?                        
         BNE   RQST0360            NO                                           
*                                                                               
         DROP  RF                                                               
*                                                                               
         LA    RE,WORK+32          SET UP WORKSPACE                             
         USING RSETLOAD,RE                                                      
*                                                                               
         LA    RF,Q3SETMKT-QREC3(R4)                                            
         ST    RF,RSETRNAM         A(SET NAME IN REQUEST CARD)                  
         LA    RF,QWMKTSET                                                      
         ST    RF,RSETWADD         A(ADDR OF SET INFO) IN QWKD                  
         LA    RF,4                                                             
         ST    RF,RSETRSIZ         SET SIZE OF ENTRY                            
         MVC   RSETRTYP,=C'MK'     SET TYPE OF ENTRY                            
         MVI   RSETRFLG,X'20'      SET VALUE OF FLAG                            
         MVI   RSETROFF,1          SET VALUE OF BYTE OFFSET                     
         MVI   RSETRMST,1          SET 'CHEK MASTER/SUBS'                       
*                                                                               
         DROP  RE                                                               
*                                                                               
         GOTO1 =A(LOADSET),DMCB,(R4)                                            
*                                                                               
RQST0360 LA    R4,QWEND-QWKD(R2)                                                
         STCM  R4,7,QWNEXT         NEXT REQ WORK AREA ADDR                      
         MVI   QWSALES,C'N'        INITIALIZE SWITCHES                          
         MVI   QWAVAILS,C'N'                                                    
         MVI   QWASAT,C'N'                                                      
         MVI   QWMNTHS,C'N'                                                     
         MVI   QWBUDGET,C'N'                                                    
         MVC   WORK(8),SPACES                                                   
         MVC   WORK(4),=C'RERG'    SET UP SPEC LOAD PHASE NAME                  
         MVC   WORK+4(2),QRGPROG   ADD PROGRAM NUMBER                           
         MVC   QWREQPR,QRGPROG     PROGRAM NUMBER                               
         MVI   QWRKMAX,0           DEFAULT RANKING MAX IS HIGH                  
*                                                                               
*   **RANKER LIST**                                                             
*                                                                               
         CLC   QRGPROG(2),=C'G0'    G0 REPORT MAY HAVE RANKING                  
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'G1'    G1 REPORT MAY HAVE RANKING                  
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'G8'    G8 REPORT MAY HAVE RANKING                  
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'G9'    G9 REPORT MAY HAVE RANKING                  
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'CL'    CL REPORT MAY HAVE RANKING                  
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'C0'    C0 REPORT MAY HAVE RANKING                  
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'C1'    C1 REPORT MAY HAVE RANKING                  
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'C3'    C3 REPORT MAY HAVE RANKING                  
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'D0'   D0, D1 MAY HAVE RANKING                      
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'D1'   D0, D1 MAY HAVE RANKING                      
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'K0'   K-SERIES REPORTS MAY HAVE RANKING            
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'K3'   K-SERIES REPORTS MAY HAVE RANKING            
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'K4'   K-SERIES REPORTS MAY HAVE RANKING            
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'K5'   K-SERIES REPORTS MAY HAVE RANKING            
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'K6'   K-SERIES REPORTS MAY HAVE RANKING            
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'K9'   K-SERIES REPORTS MAY HAVE RANKING            
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'KA'   K-SERIES REPORTS MAY HAVE RANKING            
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'KB'   K-SERIES REPORTS MAY HAVE RANKING            
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'KC'   K-SERIES REPORTS MAY HAVE RANKING            
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'KD'   K-SERIES REPORTS MAY HAVE RANKING            
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'OR'   OR MAY HAVE RANKING                          
         BE    RQST0400                                                         
         CLC   QRGPROG(2),=C'5F'   5F IS A NON-RANKER - VIOLATES                
*                                     NUMBERING SCHEME CONVENTION               
         BE    RQST0440                                                         
         CLI   QRGPROG,C'5'        50/60 REPORTS MAY HAVE RANKING               
         BL    RQST0440                                                         
         CLI   QRGPROG,C'6'                                                     
         BH    RQST0440            50/60 REPORTS FOUND                          
RQST0400 EQU   *                                                                
         CLC   QOPTION1(2),SPACES                                               
         BE    RQST0440                                                         
         PACK  DUB,QOPTION1(2)                                                  
         CVB   R1,DUB                                                           
         STC   R1,QWRKMAX          RANKING MAX FROM QOPTION1(2)                 
*                                                                               
RQST0440 GOTO1 LOADER,DMCB,WORK    LOAD THE SPECS                               
         OC    DMCB+4,DMCB+4                                                    
         BNZ   *+6                                                              
         DC    H'0'                SPECS PHASE NOT FOUND                        
         MVC   QWSPECS,DMCB+4      A(SPECS)                                     
*                                                                               
RQST0480 MVC   QWREPORT,RPTNUM     NUMBER OF PREVIOUS REPORTS                   
         SR    R5,R5                                                            
         IC    R5,RPTNUM                                                        
         LA    R5,1(R5)                                                         
         STC   R5,QWLORPT          LOW REPORT NUM FOR THIS REQEST               
*                                                                               
         BAS   RE,RPTSPEC          SET UP RPT SPEC WORK AREAS                   
*                                                                               
         MVC   QWHIRPT,RPTNUM      HIGH REPORT NUM FOR THIS REQ                 
         CLI   QWSALES,C'Y'        TEST FOR ANY SALES RPTS                      
         BNE   RQST0520                                                         
         GOTO1 =A(SETUPMON)        YES - SET UP MONTH INFORMATION               
RQST0520 EQU   *                                                                
         CLI   QWAVAILS,C'Y'       TEST FOR ANY AVAIL RPTS                      
         BNE   RQST0600                                                         
         MVC   QWRDATE,RUNDATE     YES - SET REQUEST RUN DATE                   
         CLC   QASAT,SPACES              TEST FOR AS AT DATE OVERRIDE           
         BNE   *+12                                                             
         OI    AVLDTMSK,RUNDATS          NO - AVL RUN DATE INDICATOR            
         B     RQST0560                                                         
         OI    AVLDTMSK,ASATDATS         YES - AVL ASAT DATE INDICATOR          
         MVI   QWASAT,C'Y'                     REQUEST AVL ASAT INDIC           
         GOTO1 DATCON,DMCB,(0,QASAT),(3,QWRDATE)    CONVERT ASAT DATE           
*                                                                               
RQST0560 CLI   QWMNTHS,C'Y'        TEST FOR MONTH OR QTR FORMATS                
         BNE   RQST0600                                                         
         BAS   RE,SETUPQTR         YES - SET UP QTR TABLE                       
*                                                                               
RQST0600 B     XIT                                                              
         EJECT                                                                  
*                                                                               
*        ROUTINE TO SET UP FILTER CONTRACT KEY FIELDS                           
*                                                                               
         SPACE                                                                  
REQFILT  NTR1  ,                                                                
         CLI   QWREQNUM,1                                                       
         BNE   RQFI0080                                                         
         MVC   FGROUP(2),SPACES    CLEAR GROUP/SUBGROUP                         
         CLI   QGROUP,C'*'         GROUP SET REQUEST?                           
         BE    RQFI0020            YES - DON'T SET GROUP/SUBGROUP               
         MVC   FGROUP,QGROUP                                                    
         MVC   FSBGROUP,QSBGROUP                                                
RQFI0020 EQU   *                                                                
         MVC   FSTATION,SPACES                                                  
         CLI   QSTATION,C'*'       STATION SET REQUEST?                         
         BE    RQFI0060            YES - DON'T SET STATION                      
*                                                                               
*   IF REP IS INTEREP OR SUBSIDIARY, A FILTERED REQUEST ON A COMBO              
*      STATION MUST DRAW INFORMATION FOR ALL STATIONS WITHIN THAT               
*      COMBO.  THEREFORE, THE SKIP-READ CAN'T JUST SINGLE OUT THE               
*      REQUESTED STATION.  THE FILTER ROUTINE ITSELF WILL SELECT                
*      THOSE STATIONS COMPRISING THE COMBO.  THAT INFORMATION IS                
*      DEVELOPED FROM THE STATION RECORD OF THE COMBO.                          
*                                                                               
*      IF THERE IS MORE THAN ONE REQUEST IN THE GROUP, THIS IS A MOOT           
*        POINT, IF THE REQUESTS FILTER ON MORE THAN ONE STATION ANYWAY.         
*                                                                               
         CLI   CMBOREP,C'N'        IS IT MASTER OR SUB?                         
         BE    RQFI0040            NO                                           
         CLI   QSTATION+4,C'C'     YES - IS IT A COMBO STATION?                 
         BE    RQFI0060            YES - DON'T PLACE IT IN FILTER               
RQFI0040 EQU   *                                                                
         MVC   FSTATION,QSTATION                                                
RQFI0060 EQU   *                                                                
         MVC   FOFFICE,SPACES      CLEAR OFFICE                                 
         CLI   QOFFICE,C'*'        OFFICE SET REQUEST?                          
         BE    RQFI0062            YES - DON'T SET OFFICE                       
         MVC   FOFFICE,QOFFICE                                                  
RQFI0062 EQU   *                                                                
         MVC   FAGENCY,SPACES      CLEAR AGENCY                                 
         MVC   FAGYOFF,SPACES      CLEAR AGENCY OFFICE                          
         CLI   QAGENCY,C'*'        AGENCY SET REQUEST?                          
         BE    RQFI0064            YES - DON'T SET AGENCY/AGYOFF                
         CLI   QAGENCY,C'+'        TERRITORY FILTER/SET REQUEST?                
         BE    RQFI0064            YES - DON'T SET AGENCY/AGYOFF                
         MVC   FAGENCY,QAGENCY                                                  
         MVC   FAGYOFF,QAGYOFF                                                  
RQFI0064 EQU   *                                                                
         MVC   FADV,SPACES         CLEAR ADVERTISER                             
         CLI   QADV,C'*'           ADVERT SET REQUEST?                          
         BE    RQFI0068            YES - DON'T SET ADVERTISER                   
         MVC   FADV,QADV                                                        
RQFI0068 EQU   *                                                                
         B     RQFI0100                                                         
*                                                                               
RQFI0080 CLC   FGROUP,QGROUP                                                    
         BE    *+10                                                             
         MVC   FGROUP,SPACES                                                    
         CLC   FSBGROUP,QSBGROUP                                                
         BE    *+10                                                             
         MVC   FSBGROUP,SPACES                                                  
         CLC   FSTATION,QSTATION                                                
         BE    *+10                                                             
         MVC   FSTATION,SPACES                                                  
         CLC   FOFFICE,QOFFICE                                                  
         BE    *+10                                                             
         MVC   FOFFICE,SPACES                                                   
         CLC   FAGENCY,QAGENCY                                                  
         BE    *+10                                                             
         MVC   FAGENCY,SPACES                                                   
         CLC   FAGYOFF,QAGYOFF                                                  
         BE    *+10                                                             
         MVC   FAGYOFF,SPACES                                                   
         CLC   FADV,QADV                                                        
         BE    *+10                                                             
         MVC   FADV,SPACES                                                      
*                                                                               
RQFI0100 EQU   *                                                                
         SR    R0,R0               FORMAT REQUEST DETAILS FOOTLINE              
         SR    R1,R1                                                            
         SR    RF,RF                                                            
         LA    R7,QWFOOT                                                        
         MVI   0(R7),C' '                                                       
         L     R4,=A(QTAB)         SET A(QTAB)                                  
         A     R4,RELO             SET ADDRESSABILITY                           
*                                                                               
RQFI0120 CLI   0(R4),0             SEARCH FOR REQUEST FIELDS                    
         BE    RQFI0260                                                         
         LA    R5,QRECORD                                                       
         CLI   1(R4),1                                                          
         BE    RQFI0130                                                         
         LA    R5,QRECORD2                                                      
         CLI   1(R4),2                                                          
         BE    RQFI0130                                                         
         LA    R5,QRECORD3                                                      
         CLI   1(R4),3                                                          
         BE    RQFI0130                                                         
         DC    H'0'                UNIDENTIFIED CARD NUMBER                     
RQFI0130 EQU   *                                                                
         IC    R0,2(R4)            DISPLACEMENT INTO CARD                       
         AR    R5,R0               A(IN CARD)                                   
         IC    R1,3(R4)            LENGTH FOR COMPARE                           
         EX    R1,RFCOMSPA         COMPARE REQ FIELD TO SPACES                  
         BNH   RQFI0240            SPACES OR LESS                               
         IC    RF,0(R4)            LENGTH OF ENTRY                              
         SH    RF,=H'5'                                                         
         BP    *+6                                                              
         DC    H'0'                                                             
         EX    RF,RFMOVCON         MOVE QUALIFIER TO FOOTLINE                   
         LA    R7,1(RF,R7)                                                      
         EX    R1,RFMOVFLD         MOVE FILTER TO FOOTLINE                      
*                                                                               
*                                                                               
         CLC   4(07,R4),=C'DEVTYP='                                             
*                                  DEV CON TYPE SET QUALIFIER?                  
         BNE   RQFI0176            NO                                           
         CLI   0(R5),C'*'          REQUEST FOR DEV CONTYPE SET?                 
         BNE   RQFI0176            NO                                           
         LA    R5,QRECORD3                                                      
         MVC   0(4,R7),Q3DTYSET-QREC3(R5)                                       
*                                  MOVE SETNAME TO FOOTLINE                     
         LA    R7,4(R7)            INCREASE LENGTH                              
         MVI   0(R7),C','          INSERT SEPARATOR                             
         LA    R7,1(R7)                                                         
         B     RQFI0240                                                         
RQFI0176 EQU   *                                                                
         CLC   4(07,R4),=C'PTPSON='                                             
*                                  POINT PERSON SET QUALIFIER?                  
         BNE   RQFI0177            NO                                           
         CLI   0(R5),C'*'          REQUEST FOR POINT PERSON SET?                
         BNE   RQFI0177            NO                                           
         BCTR  R1,0                YES - DROP LENGTH BY 1                       
         EX    R1,RFMOVFLD         MOVE FILTER TO FOOTLINE                      
         LA    R5,QRECORD3                                                      
         MVC   0(4,R7),Q3PPRSET-QREC3(R5)                                       
*                                  MOVE SETNAME TO FOOTLINE                     
         LA    R7,4(R7)            INCREASE LENGTH                              
         MVI   0(R7),C','          INSERT SEPARATOR                             
         LA    R7,1(R7)                                                         
         B     RQFI0240                                                         
RQFI0177 EQU   *                                                                
RQFI0180 CLC   4(5,R4),=C'ASAT='                                                
         BE    RQFI0200                                                         
         CLC   4(8,R4),=C'ASAT TO='                                             
         BNE   RQFI0220                                                         
RQFI0200 EQU   *                                                                
         MVC   0(2,R7),2(R5)                                                    
         MVI   2(R7),C'/'                                                       
         MVC   3(2,R7),4(R5)                                                    
         MVI   5(R7),C'/'                                                       
         MVC   6(2,R7),0(R5)                                                    
         LA    R7,2(R7)                                                         
*                                                                               
RQFI0220 LA    R7,1(R1,R7)                                                      
         MVI   0(R7),C','          SEPARATE WITH COMMAS                         
         LA    R7,1(R7)                                                         
*                                                                               
RQFI0240 IC    R0,0(R4)            NEXT REQ FIELD                               
         AR    R4,R0                                                            
         B     RQFI0120                                                         
*                                                                               
RQFI0260 CLI   0(R7),C' '                                                       
         BE    RQFI0280                                                         
         BCTR  R7,0                                                             
         MVI   0(R7),C' '                                                       
*                                                                               
RQFI0280 EQU   *                                                                
         ZIC   R3,QWREPORT                                                      
         MH    R3,=Y(RPSPECX-RPSPECD)                                           
         L     R4,=A(RPSPECS)                                                   
         AR    R3,R4                                                            
*                                  R3 = RPSPECD BASE                            
         USING RPSPECD,R3                                                       
         CLI   RPMONEY,0           PRINT IN THOUSANDS?                          
         BNE   RQFI0300            NO                                           
*                                                                               
         DROP  R3                                                               
*                                                                               
         MVC   0(6,R7),=C',$=000'                                               
*                                  MOVE SETNAME TO FOOTLINE                     
*                                                                               
*   TEST DUMP                                                                   
*        DC    H'0'                                                             
*   TEST DUMP END                                                               
*                                                                               
RQFI0300 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
RFCOMSPA CLC   0(0,R5),SPACES                                                   
RFMOVCON MVC   0(0,R7),4(R4)                                                    
RFMOVFLD MVC   0(0,R7),0(R5)                                                    
         EJECT                                                                  
*                                                                               
*        ROUTINE TO SET UP REPORT SPEC WORK AREAS                               
*                                                                               
         SPACE                                                                  
RPTSPEC  NTR1                      R2 = QWKD BASE                               
         MVI   QWNFORCE,C'N'       SET REPORT NOT TO 'FORCE ROW'                
         MVI   QWCOMBO,C'N'        SET 'COMBO FLAG' = NO                        
         ZIC   R7,QWREPORT                                                      
         MH    R7,=Y(RPSPECX-RPSPECD)                                           
         L     RF,=A(RPSPECS)                                                   
         AR    R7,RF                                                            
******>                            R7 = RPSPECD BASE                            
         USING RPSPECD,R7                                                       
         L     R4,QWSPECS                                                       
         CLI   MCRUNMOD,C'S'       SKIP TOTDEFS FOR SINGLE RUNMODE              
         BE    RSPE0020                                                         
         MVI   SPEC,6                                                           
         BAS   RE,GETSPEC          LOOK FOR TOTDEF SPEC                         
         BNE   RSPE0020                                                         
         ST    R4,QWTOTS           A(TOTDEF SPEC)                               
*                                                                               
RSPE0020 EQU   *                                                                
         MVI   RPFLAGS,0           CLEAR FLAGS                                  
         MVI   RPFLAG2,0           CLEAR FLAGS                                  
         MVI   SPEC,10             LOOK FOR REPORT SPEC                         
         BAS   RE,GETSPEC                                                       
         BNE   RSPE1180            END OF SPECS                                 
RSPE0040 EQU   *                                                                
         BAS   RE,RSPE1200         LOOK FOR COMMENT/PEND/SPLITPND               
         CLI   1(R4),3             TEST NEW STYLE REP SPEC                      
         BE    RSPE0140            NEW SPEC IS 4 LONG                           
         CLI   3(R4),0             TEST FOR IF                                  
         BE    RSPE0140            NO 'IF' IN ELEMENT                           
         LA    R5,3(R4)            A(1ST 'IF' CLAUSE OF REPORT)                 
         ZIC   R0,1(R4)            L(REPORT SPEC)                               
         LA    RF,3                CALCULATE # IFS IN ELEMENT                   
         SR    R0,RF                  L - 3 = # IFS                             
RSPE0060 EQU   *                                                                
         MVC   BYTE,0(R5)          MOVE 'IF' NUMBER                             
         BAS   RE,CHECKIF          CHECK FOR TRUE                               
         BNE   RSPE0080            NOT TRUE:  ERROR                             
         LA    R5,1(R5)            BUMP TO NEXT 'IF'                            
         BCT   R0,RSPE0060         GO BACK FOR NEXT 'IF'                        
         B     RSPE0140            ALL 'IFS' ARE TRUE: ACCEPT IT                
RSPE0080 EQU   *                                                                
         SR    R0,R0               MARK ALL ASSOCIATED SPECS DEFUNCT            
         SPACE 1                                                                
RSPE0100 IC    R0,1(R4)                                                         
         AR    R4,R0                                                            
         CLI   0(R4),7             PENDING?                                     
         BE    RSPE0120            YES                                          
         CLI   0(R4),8             COMMENT?                                     
         BE    RSPE0120            YES                                          
         CLI   0(R4),9             SPLITPND?                                    
         BE    RSPE0120            YES                                          
         CLI   0(R4),10                                                         
         BE    RSPE0040            NEW REPORT                                   
         BL    RSPE1180            END OF SPECS                                 
RSPE0120 EQU   *                                                                
         OI    0(R4),X'80'                                                      
         B     RSPE0100                                                         
*                                                                               
RSPE0140 EQU   *                                                                
         MVC   RPREQ,REQNUM        REQUEST NUMBER                               
         MVC   RPRPT,2(R4)         REPORT NUM WITHIN REQUEST                    
         ZIC   R5,RPTNUM                                                        
         LA    R5,1(R5)                                                         
         STC   R5,RPTNUM           INCREMENT REPORT NUM                         
         XC    RPRECAP,RPRECAP     CLEAR RECAP SPEC ADDR                        
*                                                                               
         MVI   SPEC,16             LOOK FOR MONEY SPEC                          
         BAS   RE,NEXTSPEC                                                      
         BNE   RSPE0160                                                         
         MVC   RPMONEY,2(R4)       SAVE MONEY SPEC                              
         CLI   2(R4),1             IS IT 'DOLLARS' ?                            
         BNE   RSPE0160                                                         
         OI    RPFLAGS,X'08'       YES - FLAG MONEY IN DOLLARS                  
*                                                                               
RSPE0160 MVI   SPEC,18             LOOK FOR ONLINE SPEC                         
         BAS   RE,NEXTSPEC                                                      
         BNE   RSPE0180                                                         
         OI    RPFLAGS,X'20'       FLAG FOR ONLINE SPEC                         
         MVC   DOUBLE+8(06),=C'ONLINE'                                          
*                                                                               
RSPE0180 MVI   SPEC,19             LOOK FOR REPTYPE SPEC                        
         BAS   RE,NEXTSPEC                                                      
         BNE   RSPE0200            NO - ASSUME SALES REPORT                     
         CLC   2(3,R4),=C'SAL'     SALES RPT                                    
         BE    RSPE0200                                                         
         CLC   2(3,R4),=C'AVL'     AVAIL RPT                                    
         BE    *+6                                                              
         DC    H'0'                                                             
         OI    RPFLAGS,X'40'       FLAG AVAIL REPORT                            
         MVI   QWAVAILS,C'Y'       REQ AVAIL INDICATOR                          
         MVI   AVAILS,C'Y'         GLOBAL AVAIL INDIVATOR                       
         B     RSPE0240                                                         
*                                                                               
RSPE0200 MVI   SPEC,20             LOOK FOR RPTFILT SPEC                        
         BAS   RE,NEXTSPEC                                                      
         BNE   RSPE0210                                                         
         ST    R4,RPFILT                                                        
*                                                                               
RSPE0210 EQU   *                                                                
         MVI   SPEC,21             LOOK FOR RPTFLAGS SPEC                       
         BAS   RE,NEXTSPEC                                                      
         BNE   RSPE0220                                                         
         XC    RPMISFLG,RPMISFLG   CLEAR AREA                                   
         ZIC   RF,1(R4)            TAKE ELEMENT LENGTH                          
         LA    RE,3                MINUS CONTROL + 1 FOR EX                     
         SR    RF,RE                                                            
         EX    RF,RSPE0211         MOVE BY LENGTH                               
         B     RSPE0220                                                         
RSPE0211 MVC   RPMISFLG(0),2(R4)                                                
*                                                                               
RSPE0220 MVI   QWSALES,C'Y'        REQ SALES INDICATOR                          
         MVI   SALES,C'Y'          GLOBAL SALES INDICATOR                       
*                                                                               
RSPE0240 EQU   *                                                                
         MVI   SPEC,25             LOOK FOR AGGREG SPEC                         
         BAS   RE,NEXTSPEC                                                      
         BNE   RSPE0260            NOT FOUND                                    
*                                  FOUND:  THIS IS AN AGGREGATE REPORT          
         ST    R4,RPAGGREG           AGGREG SPEC ADDR                           
         MVI   RPMONROW,C'A'         FORCE MONROW TO 'ALLMONTH'                 
*                                                                               
RSPE0260 EQU   *                                                                
         MVI   SPEC,26             LOOK FOR RECAP SPEC                          
         BAS   RE,NEXTSPEC                                                      
         BNE   RSPE0280            NOT FOUND                                    
         ST    R4,RPRECAP          RECAP SPEC ADDR                              
*                                                                               
RSPE0280 EQU   *                                                                
         MVI   SPEC,27             LOOK FOR AGGSPL SPEC                         
         BAS   RE,NEXTSPEC                                                      
         BNE   RSPE0300            NOT FOUND                                    
*                                  FOUND:  THIS IS SPL AS-RUN REPORT            
         ST    R4,RPAGGSPL           AGGSPL SPEC ADDR                           
         MVI   RPMONROW,C'A'         FORCE MONROW TO 'ALLMONTH'                 
*                                                                               
RSPE0300 EQU   *                                                                
         MVI   SPEC,29             LOOK FOR BUDPAS SPEC                         
         BAS   RE,NEXTSPEC                                                      
         BNE   RSPE0320            NOT FOUND                                    
*                                  FOUND:  SPECIAL BUDGET PROCESSING            
         ST    R4,RPBUDPAS           BUDPAS SPEC ADDR                           
*                                                                               
RSPE0320 LA    R6,RPROWS          IMPLODED ROW SPECS                            
         LA    R5,1                                                             
*                                                                               
RSPE0340 MVI   SPEC,30                                                          
         BAS   RE,NEXTSPEC         LOOK FOR ROW SPEC                            
         BNE   RSPE0800            NO MORE ROW SPECS                            
         CLI   2(R4),X'01'         FIRST ROW OF SPEC OR RECAP?                  
         BNE   RSPE0360            NO  - DON'T INITIALIZE STORAGE               
         XC    COSPEC#,COSPEC#     INITIALIZE                                   
RSPE0360 CLI   3(R4),X'28'         'COMPANY' DATA CODE (DECL 40)                
         BNE   RSPE0380            NO                                           
         L     RF,VXADDR           YES - USE ONLY FOR MASTER REP                
         USING VXADDRD,RF                                                       
         L     RF,VXSREP           A(MASTER/SUBSIDIARY TABLE)                   
         USING RSREPD,RF                                                        
         CLI   MASTREP,1           MASTER REP?                                  
         BE    RSPE0380            YES - USE COMPANY ROW SPEC                   
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVC   COSPEC#,2(R4)       NO  - SAVE COMPANY ROW SPEC #                
         B     RSPE0340            SKIP COMPANY ROW SPEC                        
*                                                                               
RSPE0380 EQU   *                                                                
         CLI   3(R4),2             STATION ROW?                                 
         BE    RSPE0400            YES                                          
         CLI   3(R4),32            STA/MKT ROW?                                 
         BNE   RSPE0420            NO                                           
RSPE0400 EQU   *                                                                
         MVC   RPSPLSTA,2(R4)      YES - SAVE ROW # FOR ADDR CALC               
RSPE0420 EQU   *                                                                
         CLI   6(R4),0             DOES IT HAVE AN IF OPTION ?                  
         BE    RSPE0460            NO                                           
         MVC   BYTE,6(R4)          YES -                                        
         BAS   RE,CHECKIF          CHECK FOR TRUE                               
         BE    RSPE0460            TRUE                                         
         SR    R0,R0               FALSE -                                      
*                                                                               
RSPE0440 IC    R0,1(R4)            MARK ALL ASSOCIATED SPECS AS DEFUNKT         
         AR    R4,R0                                                            
         CLI   0(R4),30                                                         
         BE    RSPE0360                                                         
         CLI   0(R4),40                                                         
         BNL   RSPE0800                                                         
         OI    0(R4),X'80'                                                      
         B     RSPE0440                                                         
*                                                                               
RSPE0460 CLI   3(R4),16            IS IT RANK ?                                 
         BNE   RSPE0540                                                         
         OI    RPFLAGS,X'02'       INDICATE THIS IS RANK RPT                    
         ST    R4,FULL                                                          
         MVI   SPEC,33                                                          
         BAS   RE,NEXTSPEC         FIND RANK SPEC                               
         BE    RSPE0480                                                         
         DC    H'0'                                                             
*                                                                               
RSPE0480 EQU   *                                                                
         OC    COSPEC#,COSPEC#     'COMPANY' ROW SPEC DROPPED?                  
         BZ    RSPE0500            NO                                           
*                                                                               
*   WITH 'COMPANY' SPEC DROPPED, THE RANK SPEC MAY REQUIRE THE                  
*     ADJUSTMENT OF THE ROW # FOR THE 'WITHIN' CLAUSE                           
*                                                                               
         ZIC   RF,COSPEC#          'COMPANY' SPEC ROW #                         
         ZIC   RE,4(R4)            RANK 'WITHIN' ROW #                          
         CR    RE,RF               RANK VS COMPANY                              
         BL    RSPE0500            RANK ROW # < COMPANY SPEC                    
         BCTR  RE,0                DECREASE RANK ROW #                          
         STC   RE,4(R4)            RESET 'WITHIN' ROW #                         
*                                  ADJUSTING?                                   
RSPE0500 EQU   *                                                                
         CLI   3(R4),0             TEST FOR IF                                  
         BE    RSPE0520            NO                                           
         MVC   BYTE,3(R4)          YES -                                        
         BAS   RE,CHECKIF          CHECK FOR TRUE                               
         MVI   SPEC,33             LOOK FOR MORE RANK SPECS                     
         BAS   RE,NEXTSPEC                                                      
         BE    RSPE0480                                                         
*                                                                               
RSPE0520 L     R4,FULL                                                          
*                                                                               
RSPE0540 MVC   0(1,R6),3(R4)       MOVE IN DATA CODE                            
         LA    RF,MONCDTB                                                       
*                                                                               
RSPE0560 CLC   0(1,R6),0(RF)       IS IT A MONTH CODE ?                         
         BE    RSPE0580                                                         
         LA    RF,2(RF)                                                         
         C     RF,=A(MONCDTBX)                                                  
         BNH   RSPE0560                                                         
         B     RSPE0600                                                         
*                                                                               
RSPE0580 MVC   RPMONROW,1(RF)      YES - RPMONROW HAS MONTH TYPE                
         CLI   0(RF),17            IS IT 'MONTH' ?                              
         BE    *+12                                                             
         CLI   0(RF),20            IS IT 'QTR' ?                                
         BNE   RSPE0600                                                         
         OI    RPFLAGS,X'04'       YES- INDICATE THIS RPT HAS MONTH ROW         
         MVI   QWMNTHS,C'Y'        REQ MONTH/QTR INDICATOR                      
*                                                                               
RSPE0600 ZIC   R1,2(R4)            ROW NUM                                      
         OC    COSPEC#,COSPEC#     'COMPANY' ROW SPEC ELIMINATED?               
         BZ    RSPE0620            NO  - DON'T ADJUST ROW NUMBER                
         ZIC   RF,COSPEC#          YES - IS ROW AFTER 'COMPANY' ROW?            
         CR    R1,RF                                                            
         BL    RSPE0620            NO  - DON'T ADJUST ROW NUMBER                
         BCTR  R1,0                YES - DECREASE ROW NUMBER                    
RSPE0620 MH    R1,=Y(RGROWSZ)                                                   
         A     R1,=A(BFKEY)                                                     
         STCM  R1,7,1(R6)          MOVE IN ADDR OF BUFF KEY                     
*                                                                               
         CLI   5(R4),X'04'         ZERO OUT ROW VALUE?                          
         BNE   RSPE0640            NO                                           
         STCM  R1,7,RPZERORW       YES - SAVE THE BUFFALO ADDR                  
RSPE0640 EQU   *                                                                
         CLI   3(R4),32            STATION MARKET REPORT?                       
         BNE   RSPE0700            NO                                           
         LA    RE,QWREQ            YES - IS IT A RADIO REQUEST?                 
         USING QRECORD,RE                                                       
         CLI   QGROUP-QRECORD(RE),C'R'                                          
         BNE   RSPE0700            NO                                           
*                                                                               
         DROP  RE                                                               
*                                                                               
         MVI   SPEC,31             YES - RETRIEVE THE DETAILS                   
         BAS   RE,NEXTSPEC                                                      
         BE    RSPE0660                                                         
         DC    H'0'                NO DETAILS - SPEC DESTROYED                  
RSPE0660 EQU   *                                                                
         CLI   3(R4),3             IS MARKET TOTAL IN PRINT LINE?               
         BE    RSPE0680            YES - SET MARKET TOTALS FLAG                 
*                                                                               
*   IF REP IS PERMITTED 'COMBO', THE MARKET TOTAL FLAG IS PASSED                
*     THROUGH EVEN IF IT IS IN THE HEADING.  THIS IS TO PERMIT                  
*     REPORT GENERATION OF COMBO AND MARKET TOTALS IN THE                       
*     RERG03 MODULE.  A SPECIAL FLAG IS ALSO SET, WHICH IS PICKED               
*     UP IN THE RERG03 MOUDLE ROUTINE 'POST'.                                   
*                                                                               
         CLI   CMBOREP,C'Y'        MASTER OR SUBSIDIARY?                        
         BNE   RSPE0700            NO  - DON'T SET FLAG TO INDICATE             
*                                     MARKET TOTALS ARE NEEDED                  
         MVI   QWCOMBO,C'Y'        SET 'COMBO FLAG' TO YES                      
*                                                                               
RSPE0680 EQU   *                                                                
         MVI   RPMKTOT,C'Y'        INDICATE THIS REP HAS MKT TOTALS             
         STCM  R1,7,RPMKTOT+1         AND STORE ITS ROW ADDRESS                 
*                                                                               
RSPE0700 CLI   3(R4),22            IS IT STATYPE ?                              
         BNE   *+12                                                             
         MVI   RPSTATYP,C'Y'       YES- INDICATE THIS RPT HAS STATYPE           
         STCM  R1,7,RPSTATYP+1          AND STORE ITS ROW ADDRESS               
*                                                                               
         CLI   3(R4),34            TEST POINT PERSON                            
         BE    *+12                                                             
         CLI   3(R4),35            OR NETWORK CONTRACT NUMBER                   
         BNE   *+8                                                              
         OI    RDIND,RDIPRD        YES-INDICATE TO READ PRODUCT RECORDS         
*                                                                               
         CLI   3(R4),36            TEST BOOK                                    
         BE    RSPE0720                                                         
         CLI   3(R4),37            OR DAYPART                                   
         BE    RSPE0720                                                         
         CLI   3(R4),38            OR DEMO                                      
         BE    RSPE0720                                                         
         CLI   3(R4),41            OR DAYPRTS                                   
         BNE   RSPE0740                                                         
RSPE0720 OI    RDIND,RDISABOP      YES-INDICATE READ SAR OR BOP ELEMENT         
*                                      IN CONTRACT RECORD                       
RSPE0740 MVI   SPEC,36                                                          
         BAS   RE,NEXTSPEC         LOOK FOR ROWFILT SPECS                       
         BNE   RSPE0780                                                         
         CLC   0(1,R6),2(R4)       IS ROWFILT SPEC FOR SAME DATA CODE           
         BNE   RSPE0760            NO - SKIP                                    
         STCM  R4,7,4(R6)          MOVE ADDR OF ROWFILT SPECS                   
         CLI   0(R6),22            IS IT STNTYPE                                
         BNE   RSPE0780                                                         
         MVI   RPSTATYP,0          YES - DON'T WANT 'ALL STATIONS'              
         B     RSPE0780                                                         
*                                                                               
RSPE0760 L     R4,REGSTOR                                                       
*                                                                               
RSPE0780 LA    R5,1(R5)                                                         
***>>>   CH    R5,=Y(RGROWMAX-1)                                                
         CH    R5,=Y(RGROWMAX)     PROCESS LAST ROW                             
         BH    RSPE0820            ENOUGH ROWS                                  
         LA    R6,7(R6)            NEXT ROW                                     
         B     RSPE0340                                                         
*                                                                               
RSPE0800 MVI   0(R6),X'FF'         MARK END OF ROWS                             
         CH    R5,=H'1'            DID WE FIND ANY ROW SPECS                    
         BH    RSPE0820                                                         
         MVI   SPEC,32             NO - LOOK FOR ROW EQU SPEC                   
         BAS   RE,GETSPEC                                                       
         BE    *+6                                                              
         DC    H'0'                NO ROW SPECS AT ALL                          
         ZIC   R5,2(R4)            ROWS SAME AS THIS REPORT                     
         ZIC   R6,QWREPORT                                                      
         AR    R5,R6               ADD NUM OF RPTS PREVIOUS TO REQ              
         BCTR  R5,0                FIND ITS RPT SPEC WORK AREA                  
         MH    R5,=Y(RPSPECX-RPSPECD)                                           
         L     RF,=A(RPSPECS)                                                   
         AR    R5,RF                                                            
         MVC   RPROWS,RPROWS-RPSPECD(R5)  MOVE ITS ROWS                         
*                                                                               
RSPE0820 XC    RPBUDCP,RPBUDCP     INIT BUDGET COL ADDRESSES                    
         XC    RPBUDCY,RPBUDCY                                                  
         XC    RPREVCP,RPREVCP                                                  
         LA    R6,RPCONCOL                                                      
         MVI   SPEC,40                                                          
         LA    R5,1                COL COUNTER                                  
         BAS   RE,GETSPEC          FIND FIRST COL SPEC                          
         B     *+8                                                              
*                                                                               
RSPE0840 BAS   RE,NEXTSPEC         LOOK FOR MORE COL SPECS                      
         BNE   RSPE1140            NO MORE COL SPECS                            
         CLI   6(R4),41            IS COLUMN 'FORCE ROW' SPEC?                  
         BNE   RSPE0860            NO                                           
         MVI   QWNFORCE,C'Y'       YES - SET 'FORCE ROW' FLAG                   
RSPE0860 EQU   *                                                                
         ZIC   R3,2(R4)            COL NUM                                      
         BCTR  R3,0                                                             
         MH    R3,=Y(RGCOLSZ)                                                   
         A     R3,=A(BFACCS)       R3 = A(BUFFALO COL)                          
*                                                                               
*   SECOND BYTE OF COL KEY 1 NOW BEING USED FOR OPTIONAL DECIMAL                
*        POINT PLACEMENT                                                        
*                                                                               
         MVI   PERIOD,X'01'        PERIOD                                       
****>>>  CLC   3(2,R4),=X'0100'    COL KEY 1                                    
         CLI   3(R4),X'01'         COL KEY 1                                    
         BE    RSPE0880                                                         
         MVI   PERIOD,X'02'        YTD                                          
****>>>  CLC   3(2,R4),=X'0200'                                                 
         CLI   3(R4),X'02'                                                      
         BE    RSPE0880                                                         
         MVI   PERIOD,0            COLCOMP                                      
****>>>  CLC   3(2,R4),=X'0000'                                                 
         CLI   3(R4),X'00'                                                      
         BE    RSPE0840            IGNORE COLCOMPS                              
         DC    H'0'                                                             
*                                                                               
RSPE0880 LA    R1,COLKEY2T                                                      
*                                                                               
RSPE0900 CLC   5(2,R4),0(R1)       SEARCH FOR VALID COL KEY 2                   
         BE    RSPE0920                                                         
         LA    R1,CK2ELEN(R1)                                                   
         C     R1,=A(COLKEY2X)                                                  
         BNH   RSPE0900                                                         
         DC    H'0'                                                             
*                                                                               
         USING COLKEY2D,R1                                                      
RSPE0920 CLI   CK2REC,X'0C'        COL DATA FROM CONTRACT REC                   
         BE    RSPE1000                                                         
         LA    RE,RPBUDCP          CURRENT BUDGET COL ADDRS                     
         LA    RF,RPBUDCY                                                       
         CLI   CK2REC,X'13'        CURRENT BUDGET?                              
         BE    RSPE0940            YES                                          
         LA    RE,RPREVCP          NO  - REVENUE COL ADDRS                      
         SR    RF,RF                                                            
         CLI   CK2REC,X'14'        REVENUE?                                     
         BE    RSPE0940            YES                                          
         LA    RE,RPBUDCPP         NO  - PRIOR BUDGET ADDRS                     
         LA    RF,RPBUDCYP                                                      
         CLI   CK2REC,X'15'        PRIOR BUDGET?                                
         BE    RSPE0940            YES                                          
         LA    RE,RPBUDCP2         NO  - 2YR PRIOR BUDGET ADDRS                 
         LA    RF,RPBUDCY2                                                      
         CLI   CK2REC,X'16'        2YR PRIOR BUDGET?                            
         BE    RSPE0940            YES                                          
         DC    H'0'                                                             
*                                                                               
RSPE0940 OI    RPFLAGS,X'01'       REPORT BUDGETS INDICATOR ON                  
         MVI   QWBUDGET,C'Y'       REQ BUDGETS INDICATOR ON                     
         MVI   BUDGETS,C'Y'        BUDGETS INDICATOR ON                         
         LA    R5,1(R5)            BUMP COL COUNTER                             
         CLI   PERIOD,X'01'                                                     
         BNE   RSPE0960                                                         
         ST    R3,0(RE)            CUR PERIOD BUDGET/REVENUE COL ADDR           
         B     RSPE0980                                                         
*                                                                               
RSPE0960 CLI   PERIOD,X'02'                                                     
         BE    *+6                                                              
         DC    H'0'                                                             
         LTR   RF,RF                                                            
         BNZ   *+6                                                              
         DC    H'0'                                                             
         ST    R3,0(RF)            CURRENT YTD BUDGET COL ADDR                  
         LR    RE,RF                                                            
*                                                                               
RSPE0980 CLC   7(2,R4),=X'0100'    TEST APPLY COMMISSION                        
         BNE   *+12                                                             
         OI    0(RE),X'80'         YES-INDICATE COMMISSION                      
         OI    COMIND,COMIBUD                                                   
         B     RSPE0840            NEXT COL SPEC                                
*                                                                               
RSPE1000 EQU   *                                                                
         CLI   1(R1),SPL$$VAL      SPL DOLLAR VALUE COLUMN?                     
         BNE   RSPE1020            NO                                           
         ST    R3,RPSPL$AD         YES - SAVE THE ADDRESS                       
RSPE1020 EQU   *                                                                
         CLI   1(R1),SPLM$VAL      SPL MKT DOLLAR VALUE COLUMN?                 
         BNE   RSPE1040            NO                                           
         ST    R3,RPSPLMAD         YES - SAVE THE ADDRESS                       
RSPE1040 EQU   *                                                                
         CLI   1(R1),SPLD$VAL      GROSS SPL DOLLAR VALUE COLUMN?               
         BNE   RSPE1060            NO                                           
         ST    R3,RPSPLDAD         YES - SAVE THE ADDRESS                       
         OI    RPFLAG2,X'20'       SET 'GROSS SPL CALC NEEDED'                  
RSPE1060 EQU   *                                                                
         CLI   1(R1),SPLG$VAL      GROSS SPL MKT DOLLAR VALUE COLUMN?           
         BNE   RSPE1080            NO                                           
         ST    R3,RPSPLGAD         YES - SAVE THE ADDRESS                       
         OI    RPFLAG2,X'20'       SET 'GROSS SPL CALC NEEDED'                  
RSPE1080 EQU   *                                                                
         MVC   0(1,R6),PERIOD      PERIOD                                       
         STCM  R3,7,1(R6)          BUFFALO COL ADDR                             
         MVC   4(3,R6),CK2RTN      COL POST ROUTINE ADDR                        
         CLC   7(2,R4),=X'0100'    TEST APPLY COMMISSION                        
         BNE   RSPE1100                                                         
         OI    0(R6),X'80'         YES-INDICATE COMMISSION                      
         OI    COMIND,COMICON                                                   
RSPE1100 EQU   *                                                                
         TM    CK2PND,X'01'        'PENDING' COLUMN?                            
         BZ    RSPE1120            NO                                           
         OI    0(R6),X'04'         YES - FLAG IT IN COLUMN ARRAY                
RSPE1120 EQU   *                                                                
         LA    R5,1(R5)            INCREMENT CONTRACT COL COUNT                 
         CH    R5,=Y(RGCOLMAX)                                                  
         BH    RSPE1160                                                         
         LA    R6,7(R6)                                                         
         B     RSPE0840            NEXT COL SPEC                                
*                                                                               
RSPE1140 MVI   0(R6),X'FF'         MARK END OF COLS                             
         CH    R5,=H'1'                                                         
         BH    RSPE1160                                                         
*                                                                               
         MVI   SPEC,42             LOOK FOR COL EQU SPEC                        
         BAS   RE,GETSPEC                                                       
         BZ    *+6                                                              
         DC    H'0'                NO COL SPECS WHATSOEVER                      
         ZIC   R5,2(R4)            COLS SAME AS THIS REPORT                     
         ZIC   R6,QWREPORT                                                      
         AR    R5,R6               ADD NUM OF RPTS PREVIOUS TO REQ              
         BCTR  R5,0                FIND ITS RPT SPEC WORK AREA                  
         MH    R5,=Y(RPSPECX-RPSPECD)                                           
         L     RF,=A(RPSPECS)                                                   
         AR    R5,RF                                                            
         MVC   RPCONCOL,RPCONCOL-RPSPECD(R5) MOVE ITS IMP COL SPECS             
         MVC   RPBUDCP,RPBUDCP-RPSPECD(R5)   MOVE ITS BUDGET COL ADDRS          
         MVC   RPBUDCY,RPBUDCY-RPSPECD(R5)                                      
         TM    RPFLAGS-RPSPECD(R5),X'01'     MOVE ITS BUDGETS IND               
         BNO   RSPE1160                                                         
         OI    RPFLAGS,X'01'                                                    
*                                                                               
*                                                                               
RSPE1160 LA    R7,RPSPECX-RPSPECD(R7)  ADDRESS NEXT RPT SPEC WORK AREA          
         B     RSPE0020                                                         
*                                                                               
*                                                                               
*                                                                               
RSPE1180 B     XIT                                                              
         EJECT                                                                  
*                                                                               
*  RSPE1200:   LOOK FOR 'COMMENT/PENDING' SPECS, SET FLAGS                      
*        ROUTINE IS OUT-OF-LINE, SO REGISTERS BEING USED                        
*        BY ORIGINAL ROUTINE WILL RETAIN SIGNIFICANT VALUES                     
*                                                                               
RSPE1200 NTR1                                                                   
         NI    RPFLAGS,X'7F'       TURN OFF 'PENDING' FLAG                      
         NI    RPFLAG2,X'E0'       TURN OFF 'COMMENT','SPLITPND',               
*                                     'TRUE PEND+FCST', AND 'SKIP               
*                                     FORECAST' FLAGS                           
         MVI   SPEC,7              LOOK FOR PENDING SPEC                        
         BAS   RE,GETSPEC                                                       
         BNE   RSPE1260            NOT FOUND                                    
         OI    RPFLAGS,X'80'       FLAG 'PENDING' REPORT                        
         CLI   1(R4),2             OLD FORMAT?                                  
         BE    RSPE1260            YES - DON'T SET ANYTHING ELSE                
         CLI   2(R4),0             NEW FORMAT - BOTH PEND/FORECAST?             
         BE    RSPE1260            YES - DON'T SET ANYTHING ELSE                
         CLI   2(R4),1             NO  - TRUE FCST ONLY?                        
         BNE   RSPE1220            NO  - MUST BE TRUE PEND                      
         OI    RPFLAG2,X'04'       YES - SET TRUE FCTS ONLY                     
         B     RSPE1260                                                         
RSPE1220 EQU   *                                                                
         CLI   2(R4),2             NO  - TRUE PEND ONLY?                        
         BNE   RSPE1240            NO  - MUST BE SKIP FORECAST                  
         OI    RPFLAG2,X'08'       SET TRUE PEND ONLY                           
         B     RSPE1260                                                         
RSPE1240 EQU   *                                                                
*                                                                               
*   SKIP FORECAST RECORDS COMES IN ON THE 'PENDING' SPEC, BUT IS                
*        NOT - REPEAT NOT - A PENDING REPORT!                                   
*                                                                               
         OI    RPFLAG2,X'10'       SET SKIP FCST                                
         NI    RPFLAGS,X'7F'       TURN OFF 'PENDING REPORT' FLAG               
RSPE1260 EQU   *                                                                
         MVI   SPEC,8              LOOK FOR COMMENT SPEC                        
         BAS   RE,GETSPEC                                                       
         BNE   RSPE1280            NOT FOUND                                    
         OI    RPFLAG2,X'01'       FLAG 'COMMENT' REPORT                        
RSPE1280 EQU   *                                                                
         MVI   SPEC,9              LOOK FOR SPLITPND SPEC                       
         BAS   RE,GETSPEC                                                       
         BNE   RSPE1300            NOT FOUND                                    
         OI    RPFLAG2,X'02'       FLAG 'SPLITPND' REPORT                       
RSPE1300 EQU   *                                                                
         XIT1                                                                   
*                                                                               
         DROP  R1                                                               
         EJECT                                                                  
*                                                                               
*        ROUTINE TO CHECK WHETHER IF OPTION IS TRUE OR FALSE                    
*                                                                               
         SPACE                                                                  
CHECKIF  NTR1                      BYTE HAS IF NUMBER                           
         LR    R5,R4               R5 = A(ORIGINAL SPEC)                        
         MVI   SPEC,60                                                          
*                                                                               
CH010    BAS   RE,NEXTSPEC         FIND IF SPEC                                 
         BE    *+6                                                              
         DC    H'0'                                                             
         CLC   BYTE,2(R4)          TEST IF NUMBER                               
         BNE   CH010                                                            
         ZIC   R1,3(R4)            OPTION NUMBER                                
         BCTR  R1,0                                                             
         SLL   R1,1                                                             
         LA    R1,QOPTAB(R1)                                                    
         LA    RE,QWREQ                                                         
         CLI   0(R1),2             TEST OPTION ON 2ND REQUEST CARD              
         BNE   *+8                                                              
         LA    RE,QWREQ2           YES                                          
         ZIC   RF,1(R1)                                                         
         AR    RF,RE               RF = A(OPTION VALUE)                         
         ZIC   RE,1(R4)                                                         
         SH    RE,=H'6'            RE = LENGTH FOR COMPARE                      
         BNM   *+6                                                              
         DC    H'0'                                                             
         NI    OPTCOMP+7,X'0F'     RESET MASK IN BRANCH INSTRTN                 
         OC    OPTCOMP+7(1),4(R4)  SET MASK                                     
         EX    RE,OPTCOMP                                                       
         B     *+10                                                             
*                                                                               
OPTCOMP  CLC   5(0,R4),0(RF)                                                    
         BC    0,CH990            CONDITION SATISFIED                           
         OI    0(R5),X'80'        NOT SATISFIED- MARK SPEC DEFUNCT              
         LTR   RB,RB              RETURN CC NE 0 FALSE                          
         B     CH999                                                            
*                                                                               
CH990    CR    RB,RB              RETURN CC = 0  TRUE                           
*                                                                               
CH999    B     XIT                                                              
         SPACE 2                                                                
QOPTAB   DC    AL1(1),AL1(QOPTION1-QRECORD)                                     
         DC    AL1(1),AL1(QOPTION2-QRECORD)                                     
         DC    AL1(1),AL1(QOPTION3-QRECORD)                                     
         DC    AL1(2),AL1(Q2OPT4-QREC2)                                         
         DC    AL1(1),AL1(QSEQ-QRECORD)                                         
         DC    AL1(1),AL1(QSBGROUP-QRECORD)                                     
         DC    AL1(1),AL1(QACCTOPT-QRECORD)                                     
         DC    AL1(1),AL1(QREP-QRECORD)                                         
         EJECT                                                                  
*                                                                               
*   TABLE DEFINITION:                                                           
*        POSITIONS  1 - 2  =  DATA TYPE CODE                                    
*                       3  =  DERIVE DATA FROM RECORD TYPE X                    
*                   4 - 6  =  A(ROUTINE TO EXTRACT DATA)                        
*                       7  =  MISCELLANEOUS FLAGS                               
*                             X'01' = 'PENDING' COLUMNS                         
*                                                                               
COLKEY2T DC    AL1(9,21),X'0C',AL3(CC100),X'00' CUR EST                         
COLKEYNX DC    AL1(9,22),X'0C',AL3(CC101),X'00' PRI EST                         
         DC    AL1(9,23),X'0C',AL3(CC102),X'00' CUR ACT                         
         DC    AL1(9,24),X'0C',AL3(CC103),X'00' PRI ACT                         
*                                                                               
*   BUDGET COMPONENT                                                            
*                                                                               
         DC    AL1(9,25),X'13',AL3(0),X'00'     CUR BUD                         
         DC    AL1(9,83),X'15',AL3(0),X'00'     PRIOR BUD                       
         DC    AL1(9,84),X'16',AL3(0),X'00'     2YR PRIOR BUD                   
*                                                                               
*   END                                                                         
*                                                                               
         DC    AL1(9,26),X'0C',AL3(CC460),X'00' CUR AVL                         
         DC    AL1(9,27),X'0C',AL3(CC470),X'00' PRI AVL                         
         DC    AL1(9,28),X'14',AL3(0),X'00'     CUR REV                         
         DC    AL1(9,29),X'0C',AL3(CC104),X'00' 2 YEAR PRI EST                  
         DC    AL1(9,30),X'0C',AL3(CC105),X'00' 2 YEAR PRI ACT                  
         DC    AL1(9,31),X'0C',AL3(CC106),X'00' NEXT YEAR EST (BEST)            
         DC    AL1(9,32),X'0C',AL3(CC107),X'00' CURRENT BOOKED                  
         DC    AL1(9,33),X'0C',AL3(CC108),X'00' PRIOR   BOOKED                  
         DC    AL1(9,34),X'0C',AL3(CC109),X'00' 2 YEARS PRIOR BKED              
         DC    AL1(9,35),X'0C',AL3(CC110),X'00' BLANK COLUMN                    
         DC    AL1(9,36),X'0C',AL3(CC111),X'00' THIS WEEK ORDERED               
         DC    AL1(9,37),X'0C',AL3(CC112),X'00' LAST WEEK ORDERED               
         DC    AL1(9,38),X'0C',AL3(CC113),X'00' BILLED:  CURRENT YR             
         DC    AL1(9,39),X'0C',AL3(CC114),X'00' BILLED:  PRIOR   YR             
         DC    AL1(9,40),X'0C',AL3(CC115),X'00' BILLED:  2 YRS PRIOR            
         DC    AL1(9,41),X'0C',AL3(CC116),X'00' FORCE ROW                       
         DC    AL1(9,42),X'0C',AL3(CC117),X'00' BUDGET                          
         DC    AL1(9,43),X'0C',AL3(CC118),X'00' SHARE GOAL                      
         DC    AL1(9,44),X'0C',AL3(CC119),X'01' CURRENT AS AT FORECAST          
         DC    AL1(9,45),X'0C',AL3(CC120),X'01' PRIOR   AS AT FORECAST          
         DC    AL1(9,46),X'0C',AL3(CC121),X'01' 2YR PRI AS AT FORECAST          
         DC    AL1(9,47),X'0C',AL3(CC122),X'01' NEXT YR AS AT FORECAST          
         DC    AL1(9,48),X'0C',AL3(CC123),X'00' DSK ADDR OF CONTRACT            
         DC    AL1(9,49),X'0C',AL3(CC124),X'00' SHARE $                         
         DC    AL1(9,50),X'0C',AL3(CC125),X'00' MARKET $                        
         DC    AL1(9,51),X'0C',AL3(CC126),X'00' FORCE ROW DELIMITER             
         DC    AL1(9,52),X'0C',AL3(CC127),X'00' SPL AS-RUN CURRENT              
         DC    AL1(9,53),X'0C',AL3(CC128),X'00' SPL AS-RUN PRIOR                
         DC    AL1(9,54),X'0C',AL3(CC129),X'00' CURNT BKED:  NO AS-AT           
         DC    AL1(9,55),X'0C',AL3(CC130),X'00' PRIOR BKED:  NO AS-AT           
         DC    AL1(9,56),X'0C',AL3(CC131),X'01' CURR  FCST: MARKET $$           
         DC    AL1(9,57),X'0C',AL3(CC132),X'01' PRIOR FCST: MARKET $$           
         DC    AL1(9,58),X'0C',AL3(CC133),X'00' EST TOTAL: CSTN + BKC           
         DC    AL1(9,59),X'0C',AL3(CC134),X'00' FORCE EST TOTAL ROW -           
*                                                   TO ID MERGING DATA          
         DC    AL1(9,60),X'0C',AL3(CC135),X'00' CURR BILL CUME                  
         DC    AL1(9,61),X'0C',AL3(CC136),X'00' CURR BILL PRCNT CUME            
         DC    AL1(9,62),X'0C',AL3(CC137),X'00' SPL AS-RUN THIS WEEK            
         DC    AL1(9,63),X'0C',AL3(CC138),X'00' SPL AS-RUN ESTIMATED            
         DC    AL1(9,64),X'0C',AL3(CC139),X'01' CURR   TRUE PENDING $$          
         DC    AL1(9,65),X'0C',AL3(CC140),X'01' PRIOR  TRUE PENDING $$          
         DC    AL1(9,66),X'0C',AL3(CC141),X'01' 2YRPRI TRUE PENDING $$          
         DC    AL1(9,67),X'0C',AL3(CC142),X'01' CURR   TRUE FRCASTG $$          
         DC    AL1(9,68),X'0C',AL3(CC143),X'01' PRIOR  TRUE FRCASTG $$          
         DC    AL1(9,69),X'0C',AL3(CC144),X'01' 2YRPRI TRUE FRCASTG $$          
         DC    AL1(9,70),X'0C',AL3(CC116),X'00' FORCE/REPLACE ROW COL           
         DC    AL1(9,71),X'0C',AL3(CC145),X'01' CURR  PEND (TRUE) MKT$          
         DC    AL1(9,72),X'0C',AL3(CC146),X'01' PRIOR PEND (TRUE) MKT$          
         DC    AL1(9,73),X'0C',AL3(CC147),X'01' CURR  FORE (TRUE) MKT$          
         DC    AL1(9,74),X'0C',AL3(CC148),X'01' PRIOR FORE (TRUE) MKT$          
         DC    AL1(9,75),X'0C',AL3(CC149),X'00' THIS WEEK PRIOR ORD             
         DC    AL1(9,76),X'0C',AL3(CC150),X'00' SPL AS-RUN THIS WEEK,           
*                                                          LAST YEAR            
         DC    AL1(9,77),X'0C',AL3(CC151),X'00' SPL % FOR REP'D STA             
         DC    AL1(9,78),X'0C',AL3(CC152),X'00' SPL LOSS FOR REPD STA           
         DC    AL1(9,79),X'0C',AL3(CC153),X'00' SPL DOLLARS                     
         DC    AL1(9,80),X'0C',AL3(CC154),X'00' SPL MARKET $$                   
         DC    AL1(9,81),X'0C',AL3(CC155),X'00' GROSS SPL DOLLARS               
         DC    AL1(9,82),X'0C',AL3(CC156),X'00' GROSS SPL MKT DOLLARS           
         DC    AL1(9,85),X'0C',AL3(CC157),X'00' SPL AS-RUN MAIN/CURRENT         
         DC    AL1(9,86),X'0C',AL3(CC158),X'00' SPL AS-RUN MAIN/PRIOR           
         DC    AL1(9,87),X'0C',AL3(CC159),X'00' SPL AS-RUN MAIN/THIS WK         
         DC    AL1(9,88),X'0C',AL3(CC160),X'00' BEST $/CONFIRMED ONLY           
*                                         DIR RESP BEFORE CUTOFF DATE           
         DC    AL1(9,89),X'0C',AL3(CC161),X'00' BEST $/UNCONF ONLY              
*                                         INCLUDING DIRECT BILLING              
*                                         REGARDLESS OF CUTOFF DATE             
         DC    AL1(9,90),X'0C',AL3(CC162),X'00' BEST $/DIR RESP ONLY            
*                                                    AFTER CUTOFF DATE          
         DC    AL1(9,91),X'0C',AL3(CC163),X'00' THIS WEEK/CONF ONLY             
         DC    AL1(9,92),X'0C',AL3(CC164),X'00' PRIOR ACT/CONF ONLY             
         DC    AL1(9,93),X'0C',AL3(CC165),X'00' NEXT YEAR ACTUALS               
         DC    AL1(9,94),X'0C',AL3(CC166),X'00' BOOKED:  NEXT YEAR              
         DC    AL1(9,95),X'0C',AL3(CC167),X'00' BILLED:  NEXT YEAR              
         DC    AL1(9,96),X'0C',AL3(CC168),X'00' THIS WEEK 2YRS PRIOR            
         DC    AL1(9,97),X'0C',AL3(CC169),X'00' FORCE ROW TO PRINT              
***NEW TRADE COLKEY ENTRIES                                                     
         DC    AL1(9,98),X'0C',AL3(CC170),X'00' TRADE CUR EST                   
         DC    AL1(9,99),X'0C',AL3(CC171),X'00' TRADE PRI EST                   
         DC    AL1(9,100),X'0C',AL3(CC172),X'00' TRADE CUR ACT                  
         DC    AL1(9,101),X'0C',AL3(CC173),X'00' TRADE CUR ACT                  
         DC    AL1(9,102),X'0C',AL3(CC174),X'00' TRADE CURR BKED                
         DC    AL1(9,103),X'0C',AL3(CC175),X'00' TRADE PRI   BKED               
         DC    AL1(9,104),X'0C',AL3(CC176),X'00' TRADE THIS WEEK ORD            
         DC    AL1(9,105),X'0C',AL3(CC177),X'00' TRADE LAST WEEK ORD            
         DC    AL1(9,106),X'0C',AL3(CC178),X'00' TRADE CURR BILLED              
         DC    AL1(9,107),X'0C',AL3(CC179),X'00' TRADE PRI  BILLED              
         DC    AL1(9,108),X'0C',AL3(CC180),X'00' TRADE CUR BK NO AS-AT          
         DC    AL1(9,109),X'0C',AL3(CC181),X'00' TRADE PRI BK NO AS-AT          
         DC    AL1(9,110),X'0C',AL3(CC182),X'00' TRADE BEST $/CF ONLY           
*                                         DIR RESP BEFORE CUTOFF DATE           
         DC    AL1(9,111),X'0C',AL3(CC183),X'00' TRADE BEST $/UNCF ONLY         
*                                         INCLUDING DIRECT BILLING              
*                                         REGARDLESS OF CUTOFF DATE             
         DC    AL1(9,112),X'0C',AL3(CC184),X'00' TRADE THIS WK/CF ONLY          
         DC    AL1(9,113),X'0C',AL3(CC185),X'00' TRADE PRI ACT/CF ONLY          
         DC    AL1(9,114),X'0C',AL3(CC186),X'00' SPOTS: CURRENT                 
         DC    AL1(9,115),X'0C',AL3(CC187),X'00' SPOTS: PRIOR                   
         DC    AL1(9,116),X'0C',AL3(CC188),X'00' SPOTS: 2YR PRIOR               
COLKEY2X EQU   *-1                                                              
         SPACE                                                                  
CK2ELEN  EQU   COLKEYNX-COLKEY2T                                                
SPL$$VAL EQU   79                  SPL $$ COLUMN NUMBER                         
SPLM$VAL EQU   80                  SPL MKT $$ COLUMN NUMBER                     
SPLD$VAL EQU   81                  GROSS SPL $$ COLUMN NUMBER                   
SPLG$VAL EQU   82                  GROSS SPL MKT $$ COLUMN NUMBER               
         SPACE 3                                                                
*                                                                               
MONCDTB  DC    AL1(17),C'M'        MONTH                                        
         DC    AL1(18),C'C'        CURMONTH                                     
         DC    AL1(19),C'A'        ALLMONTH                                     
         DC    AL1(20),C'Q'        QTR                                          
MONCDTBX EQU   *-1                                                              
*                                                                               
         EJECT                                                                  
*                                                                               
*        ROUTINE TO SET UP QTR INFORMATION                                      
*                                                                               
         SPACE                                                                  
SETUPQTR ZIC   R4,QWCURST+1        IS START MONTH A QTR START                   
         BCTR  R4,0                                                             
         SRDL  R4,32                                                            
         D     R4,=F'3'                                                         
         LTR   R4,R4                                                            
         BNZ   SQ999                                                            
         ZIC   R0,QWCURND+1        IS END MONTH A QTR END                       
         SRDL  R0,32                                                            
         D     R0,=F'3'                                                         
         LTR   R0,R0                                                            
         BNZ   SQ999                                                            
         IC    R1,QWCURND+1                                                     
         IC    R0,QWCURST+1                                                     
         SR    R1,R0                                                            
         LA    R1,1(R1)                                                         
         STC   R1,QWNMON           SET NUMBER OF REQUEST MONTHS                 
*                                                                               
         ZIC   R1,QWCURST+1        SET UP QTR TABLE                             
         LA    R4,QWQTRS                                                        
         LA    RF,14(R5)                                                        
*                                                                               
SQ010    STC   RF,0(R4)            QTR CODE (14,15,16,17)                       
         MVC   1(1,R4),QWCURST     CUR ST YEAR                                  
         MVC   3(1,R4),QWPRIST     PRI ST YEAR                                  
         MVC   5(1,R4),QWCURND     CUR ND YEAR                                  
         MVC   7(1,R4),QWPRIND     PRI ND YEAR                                  
         STC   R1,2(R4)            CUR QTR ST MONTH                             
         STC   R1,4(R4)            PRI QTR ST MONTH                             
         LA    R1,2(R1)                                                         
         STC   R1,6(R4)            CUR QTR ND MONTH                             
         STC   R1,8(R4)            PRI QTR ND MONTH                             
         CLM   R1,1,QWCURND+1      TEST FOR END OF PERIOD                       
         BNL   SQ999                                                            
         LA    R1,1(R1)            NEXT QTR                                     
         LA    R4,9(R4)                                                         
         LA    RF,1(RF)                                                         
         B     SQ010                                                            
*                                                                               
SQ999    BR    RE                                                               
         EJECT                                                                  
*                                                                               
*   ACCESS STATION RECORD OF REQUEST, RETRIEVE EACH X'0A' ELEMENT,              
*     AND TABLE ITS STATION FOR LATER FILTERING.                                
*                                                                               
SETCOMBO NTR1                                                                   
         L     R2,0(R1)            A(REQUEST WORK AREA)                         
         USING QWKD,R2                                                          
         XC    KEY,KEY                                                          
         MVI   KEY,2               SET RECORD TYPE                              
         MVC   KEY+20(2),RCREPFL   INSERT REP CODE                              
         MVC   KEY+22(5),QSTATION  INSERT STATION FROM REQ REC                  
         GOTO1 AHIGH               READ KEY                                     
         CLC   KEY(27),KEYSAVE     FOUND?                                       
         BE    *+6                 YES                                          
         DC    H'0'                NO  - MUST BE ON FILE                        
         GOTO1 AGETSTA             RETRIEVE RECORD                              
         LA    R3,QWCOMBOS         A(PARTICIPATING STATIONS)                    
         LA    R4,RSTAELEM         X'01' ELEMENT                                
SCOM0010 EQU   *                                                                
         CLI   0(R4),X'00'         END OF RECORD?                               
         BE    SCOM0040            YES - FINISHED                               
         CLI   0(R4),X'0A'         NO  - COMBO STATION ELEMENT?                 
         BNE   SCOM0030            NO  -                                        
         CLI   1(R4),7             OLD FORMAT ELEMENT?                          
         BNH   SCOM0020            YES -                                        
         CLI   7(R4),C'-'          NO  - NON-PARTICIPATING STATION?             
         BE    SCOM0030            YES - DON'T TABLE IT                         
SCOM0020 EQU   *                                                                
         MVC   0(5,R3),2(R4)       YES - MOVE STATION TO TABLE                  
         LA    R3,5(R3)            BUMP A(TABLE ENTRY)                          
SCOM0030 EQU   *                                                                
         ZIC   RF,1(R4)            BUMP TO NEXT ELEMENT                         
         AR    R4,RF                                                            
         B     SCOM0010            GO BACK FOR NEXT                             
SCOM0040 EQU   *                                                                
         PRINT GEN                                                              
         XIT1                                                                   
         PRINT NOGEN                                                            
         EJECT                                                                  
*                                                                               
*        ROUTINE TO CLEAR FROM R1 TO R0                                         
*                                                                               
         SPACE 1                                                                
CLEAR    SR    R0,R1               GIVES LENGTH TO CLEAR                        
         BP    *+6                                                              
         DC    H'0'                                                             
         LA    RF,256                                                           
*                                                                               
CLEAR2   CR    R0,RF                                                            
         BNH   CLEAR4                                                           
         XC    0(256,R1),0(R1)                                                  
         AR    R1,RF                                                            
         SR    R0,RF                                                            
         B     CLEAR2                                                           
CLEAR4   LR    RF,R0                                                            
         BCTR  RF,0                                                             
         EX    RF,CLEARXC                                                       
         BR    RE                                                               
CLEARXC  XC    0(0,R1),0(R1) *EXECUTED*                                         
         EJECT                                                                  
*                                                                               
*        GETSPEC SEARCHES FOR A SPEC FROM THIS SPEC                             
*        NEXTSPEC SEARCHES FOR A SPEC FROM NEXT SPEC                            
*                                                                               
*        IN  R4 = A(ORIGINAL SPEC)                                              
*            SPEC = SOUGHT AFTER SPEC CODE (1 BYTE)                             
*        OUT CC = 0, R4 = A(FOUND SPEC)     SPEC FOUND                          
*            CC = 2, R4 = A(ORIGINAL SPEC)  SPEC NOT FOUND                      
         SPACE                                                                  
GETSPEC  DS    0H                                                               
         CLC   0(1,R4),SPEC        START SEARCH AT THIS SPEC                    
         BER   RE                                                               
*                                                                               
NEXTSPEC DS    0H                  START SEARCH AT NEXT SPEC                    
         ST    R4,REGSTOR                                                       
         SR    R0,R0                                                            
*                                                                               
GS005    ICM   R0,1,1(R4)            LOOK AT NEXT SPEC                          
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R4,R0                                                            
         CLI   0(R4),0                                                          
         BE    GS020               END OF SPECS                                 
         CLC   0(1,R4),SPEC        COMPARE TO SOUGHT SPEC CODE                  
         BE    GS010               FOUND                                        
         CLI   0(R4),10            ONLY LOOK IN THIS REPORT                     
         BE    GS020               STOP AT NEXT REPORT                          
         B     GS005                                                            
*                                                                               
GS010    CR    RB,RB               CC = 0    SPEC FOUND                         
         BR    RE                                                               
*                                                                               
GS020    L     R4,REGSTOR                                                       
         LTR   RB,RB               CC = 2    SPEC NOT FOUND                     
*                                                                               
GS900    BR    RE                                                               
         EJECT                                                                  
*                                                                               
*        ROUTINE TO EXECUTE PROREC ROUTINE                                      
*                                                                               
         SPACE                                                                  
WRITE    MVC   DMCB(1),RECORD                                                   
         LR    R0,RE               SAVE VALUE OF RE                             
         GOTO1 PROREC,DMCB                                                      
         LR    RE,R0               RESTORE VALUE OF RE                          
         BR    RE                                                               
         EJECT                                                                  
*                                                                               
*        ROUTINE TO PROCESS RECORDS                                             
*                                                                               
         SPACE                                                                  
PROREC   NTR1                                                                   
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         CLI   0(R1),C'C'                                                       
         BNE   PROREC10                                                         
         GOTO1 =A(CONREC),DMCB                                                  
         B     PRORECX                                                          
PROREC10 EQU   *                                                                
         CLI   0(R1),C'B'                                                       
         BNE   PROREC20                                                         
         GOTO1 =A(BUDREC),DMCB                                                  
         B     PRORECX                                                          
PROREC20 EQU   *                                                                
         CLI   0(R1),X'FF'                                                      
         BE    *+6                                                              
         DC    H'0'                                                             
PROREC30 EQU   *                                                                
         GOTO1 APUTMERG                                                         
*                                                                               
PRORECX  XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         SPACE 2                                                                
         DROP  R9,RB                                                            
         EJECT                                                                  
*                                                                               
*   ROUTINE TO USE OVERALL REQUEST DATES TO ESTABLISH A SINGLE                  
*     MONTH TABLE FOR ALL REPORTS.                                              
* !!!   NOTE    !!!                                                             
*       IF START AND END DATES ARE MORE THAN 6 YEARS APART (72 MOS)             
*       THERE IS A PROBLEM:  TABLE WON'T HANDLE THIS RANGE.  72 MOS,            
*       BEGINNING WITH JANUARY OF THE EARLIEST YEAR REQUESTED, WILL             
*       BE LOADED, AND THE REMAINDER WILL FALL INTO NEVER-NEVER LAND.           
*                                                                               
SETMONTB NMOD1 0,**SMON**                                                       
         L     RC,0(R1)            RESET A(WORKSPACE)                           
*                                                                               
*   TEST                                                                        
*        MVC   P+1(09),=C'NRRGFLAG='                                            
*        MVC   P+10(1),NRRGFLAG                                                 
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         LA    RF,NEXTBUCK         L(NEW MONTH TABLE ENTRY)                     
         MH    RF,=H'72'           NUMBER OF ENTRIES                            
         L     RE,ANEWMON          A(NEW MONTH TABLE)                           
         XCEFL                                                                  
         L     R4,ANEWMON          A(NEW MONTH TABLE)                           
*                                                                               
*  SET THE ADDRESS OF CONTRACT SPECIFIC INFORMATION INTO THE MIS-               
*    CELLANEOUS STORAGE AREA JUST PRECEDING THE NEW MONTH TABLE.                
*    THIS SERVES AS A FLAG TO VALUENEW TO EXTRACT DATA.                         
*                                                                               
         LA    RE,CONSPINF         SET A(CONTRACT SPECIFIC INFO )               
         SR    R4,RE                                                            
         MVC   0(4,R4),ACONSPEC    LOAD A(CONTRACT SPEC INFO)                   
         L     R4,ANEWMON          RESET A(NEW MONTH TABLE)                     
         MVC   0(6,R4),SVQSTART    LOAD EARLIEST DATE                           
         MVC   2(4,R4),=C'0101'    SET EARLIEST DATE TO JAN/1                   
         LA    R5,71               72 BUCKETS TOTAL: 1ST LOADED                 
SETM0004 EQU   *                                                                
         CLC   0(4,R4),SVQEND      ALL DATES LOADED?                            
         BE    SETM0008            YES - NOW SEED OTHER DATES                   
         LA    R6,NEXTBUCK(R4)     SET A(NEXT DATE ENTRY)                       
         GOTO1 ADDAY,DMCB,(R4),(R6),45    CALC MIDDLE OF NEXT MONTH             
         MVC   4(2,R6),=C'01'      SET DAY OF NEXT MONTH                        
         LR    R4,R6                                                            
         BCT   R5,SETM0004         DO NEXT DATE                                 
SETM0008 EQU   *                                                                
         L     R4,ANEWMON          RESET START OF TABLE                         
         MVC   WORK(2),SVQSTRT2    CURRENT START DATE (2-BYTE)                  
         MVC   WORK+1(1),=X'01'    SET MONTH TO 'JAN'                           
SETM0012 EQU   *                                                                
         MVC   CURDATE(2,R4),WORK  SET CURRENT START DATE                       
         ZIC   RF,WORK                                                          
         BCTR  RF,0                DECREMENT YEAR BY 1                          
         STC   RF,WORK             TO CALCULATE PRIOR YEAR                      
         MVC   PRIDATE(2,R4),WORK  SET PRIOR DATE                               
         BCTR  RF,0                SUBTRACT ANOTHER TO CALCULATE                
         STC   RF,WORK             2 YEARS PRIOR                                
         MVC   PRI2DATE(2,R4),WORK SET 2 YEARS PRIOR                            
         LA    RF,3(RF)            CALCULATE NEXT YEARS DATE                    
         STC   RF,WORK                                                          
         MVC   NEXTDATE(2,R4),WORK SET NEXT YEARS DATE                          
         CLI   NRRGFLAG,C'Y'       NRRGON DATE ADJUSTMENT NEEDED?               
         BNE   SETM0015            NO                                           
         MVC   NEXTDATE(2,R4),PRIDATE(R4)                                       
*                                  YES - LOAD 'LAST' YEAR INTO 'NEXT'           
SETM0015 EQU   *                                                                
         CLI   WORK+1,12           IS IT DECEMBER?                              
         BL    SETM0016            NO                                           
         MVI   WORK+1,1            YES - SET MONTH TO JAN                       
*                                  YEAR IS ALREADY SET TO NEXT YEAR             
         B     SETM0020                                                         
SETM0016 EQU   *                                                                
         BCTR  RF,0                DECREMENT NEXT YEAR TO THIS YEAR             
         STC   RF,WORK             RESET YEAR TO CURRENT                        
         ZIC   RF,WORK+1           INCREMENT MONTH                              
         LA    RF,1(RF)                                                         
         STC   RF,WORK+1           RESTORE NEW MONTH                            
SETM0020 EQU   *                                                                
         CLC   SVQEND2,WORK        END REACHED?                                 
         BL    SETM0024            YES                                          
         LA    R4,NEXTBUCK(R4)     NO  - NEXT TABLE ENTRY                       
         B     SETM0012            GO BACK AND DO NEXT                          
SETM0024 EQU   *                                                                
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*        ROUTINE TO PROCESS CONTRACT RECORDS                                    
*                                                                               
         DS    0F                                                               
CONREC   NMOD1 0,*CONREC*,R9                                                    
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
         XC    BYCODKEY,BYCODKEY   CLEAR BUY CODE PROCSSING KEY                 
         MVI   BYCODFLG,0                                                       
         MVC   STASAVE,SPACES      FOR TVB/OWNER/RANK                           
         MVC   STASAV,SPACES       FOR MARKET SEQUENCE                          
         MVC   SVSTA,SPACES        FOR A(STATION ELEMENT IN SPACEND)            
         TM    COMIND,COMICON      TEST COMMISSIONS NEEDED FOR                  
         BZ    CREC0040            CONTRACT RECORDS                             
         L     R1,=A(COMTAB)       YES-CLEAR FIRST ENTRY IN COMMISSION          
         XC    0(LCOMTAB,R1),0(R1)     TABLE                                    
         MVC   COMST,=X'FFFF'      SET EARLIEST AND LATEST Y/M                  
         XC    COMND,COMND                                                      
         L     R2,AQWORK                                                        
*                                                                               
CREC0020 CLC   QWPRIST,COMST                                                    
         BNL   *+10                                                             
         MVC   COMST,QWPRIST                                                    
         CLC   QWCURND,COMND                                                    
         BNH   *+10                                                             
         MVC   COMND,QWCURND                                                    
         ICM   R2,7,QWNEXT                                                      
         BNZ   CREC0020                                                         
*                                                                               
CREC0040 EQU   *                                                                
         LA    R3,RCREPFL          LOAD A(REP ID FOR RUN)                       
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP           A(MASTER/SUBSIDIARY TABLE)                   
         USING RSREPD,RE                                                        
         CLI   MASTREP,1           MASTER REP?                                  
         BNE   CREC0060            NO  - USE ID FOR RUN                         
         LA    R3,SUBREPTB         SET A(1ST REP IN SUB TABLE)                  
         ST    R3,ACONSREP         SAVE ADDR IN TABLE                           
         DROP  RE,RF                                                            
*                                                                               
CREC0060 EQU   *                                                                
         LA    RF,QRECORD3                                                      
         USING QREC3,RF                                                         
*                                                                               
         CLI   Q3BUYCOD,C'Y'       ALTERNATE READ MECHANISM VIA                 
*                                     BUYLINE CODE PASSIVE NEEDED?              
         DROP  RF                                                               
*                                                                               
         BNE   CREC0080            NO  - STANDARD READ USED                     
CREC0070 EQU   *                                                                
         GOTO1 =A(BUYCODER),DMCB,(RC),0(R3),RCONREC                             
*                                  RC  ->  WORKSPACE (FILES)                    
*                                  R3  ->  REP CODE IN USE                      
*                                  RCONREC =  RECORD DELIVERY AREA              
*                                                                               
         BNZ   CREC0140            END OF DATA:  TEST MASTER REP                
         B     CREC0180            DATA FOUND: PROCESS THIS ORDER               
CREC0080 EQU   *                                                                
         XC    KEY,KEY                                                          
         MVI   KEY,X'0C'                                                        
         MVC   KEY+2(2),0(R3)      REP ID FOR CONTRACTS                         
         LA    R4,3                                                             
         CLC   FGROUP,SPACES                                                    
         BE    CREC0100                                                         
         LA    R4,4                                                             
         MVC   KEY+4(1),FGROUP                                                  
         CLC   FSBGROUP,SPACES                                                  
         BE    CREC0100                                                         
         LA    R4,5                                                             
         MVC   KEY+5(1),FSBGROUP                                                
         CLC   FSTATION,SPACES                                                  
         BE    CREC0100                                                         
         LA    R4,10                                                            
         MVC   KEY+6(5),FSTATION                                                
         CLC   FOFFICE,SPACES                                                   
         BE    CREC0100                                                         
         LA    R4,12                                                            
         MVC   KEY+11(2),FOFFICE                                                
         CLC   FAGENCY,SPACES                                                   
         BE    CREC0100                                                         
         LA    R4,16                                                            
         MVC   KEY+13(4),FAGENCY                                                
         CLC   FAGYOFF,SPACES                                                   
         BE    CREC0100                                                         
         LA    R4,18                                                            
         MVC   KEY+17(2),FAGYOFF                                                
         CLC   FADV,SPACES                                                      
         BE    CREC0100                                                         
         LA    R4,22                                                            
         MVC   KEY+19(4),FADV                                                   
*                                                                               
CREC0100 EQU   *                                                                
         ST    R4,KCOMPLEN                                                      
         GOTO1 AHIGH                                                            
*                                                                               
CREC0120 EQU   *                                                                
         EX    R4,KEYCOMP                                                       
         BE    CREC0160            SAME KEY - CONTINUE                          
CREC0140 EQU   *                                                                
         MVI   BYCODFLG,0          CLEAR BUY CODE READ PROCESS FLAG             
         XC    BYCODKEY,BYCODKEY   CLEAR BUY CODE KEY                           
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP           A(MASTER/SUBSIDIARY REP TABLE)               
         USING RSREPD,RE                                                        
         CLI   MASTREP,1           MASTER REP?                                  
         BNE   CREC0620            NO  - FINISHED/EXIT                          
         L     R3,ACONSREP         A(CURRENT REP CODE IN TABLE)                 
         LA    R3,LSUBREP(R3)      ADD L(TABLE ENTRY)                           
         CLC   0(2,R3),=X'FFFF'    END OF TABLE REACHED?                        
         BE    CREC0620            YES - FINISHED/EXIT                          
         ST    R3,ACONSREP         SAVE A(REP CODE IN PROCESS)                  
         B     CREC0060            NO  - PROCESS NEXT REP ID                    
         DROP  RE,RF                                                            
*                                                                               
CREC0160 EQU   *                                                                
         GOTO1 AGETCONT            GET A CONTRACT RECORD                        
         BNZ   CREC0600                                                         
*                                                                               
*                                                                               
CREC0180 EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        ROUTINE DISPLAYS BUCKETS DELIVERED WITH A CONTRACT                     
*                                                                               
**       CLC   =X'03862869',RCONKCON                                            
**       BNE   TEST0220                 NO                                      
**       LA    R1,RCONELEM                                                      
TEST0200 EQU   *                                                                
**       CLI   0(R1),0                  END OF RECORD?                          
**       BE    TEST0220                 YES                                     
**       CLI   0(R1),3                  EST BUCKET?                             
**       BNE   TEST0210                 NO                                      
**       MVC   P+1(10),=C'03 BUCKET:'                                           
**       MVC   P+15(10),0(R1)                                                   
**       GOTO1 REPORT                                                           
TEST0210 EQU   *                                                                
**       ZIC   RF,1(R1)                                                         
**       AR    R1,RF                                                            
**       B     TEST0200                 GO BACK FOR NEXT                        
TEST0220 EQU   *                                                                
*   TEST END                                                                    
*                                                                               
         CLC   RCONKSTA,SVSTA      TEST STATION CHANGE                          
         BE    CREC0260                                                         
         MVC   SVSTA,RCONKSTA      YES-                                         
         TM    COMIND,COMICON      TEST COMMISSIONS NEEDED                      
         BZ    CREC0200                                                         
         GOTO1 =A(COMRECS),DMCB,(RC) YES-GET COMMISSION RECORDS                 
CREC0200 EQU   *                                                                
         XC    ASTAEL,ASTAEL                                                    
         LA    R1,50               **TEST**                                     
         MVI   INFCODE,2           FIND STATION ELEMENT IN SPACEND              
         BAS   RE,FRSTINF5                                                      
         B     *+8                                                              
CREC0220 EQU   *                                                                
         BAS   RE,NEXTINF5                                                      
         BE    *+6                                                              
CREC0240 EQU   *                                                                
         DC    H'0'                                                             
         CLC   RCONKREP,DSTNREP(R5)  SAME REP?                                  
         BNE   CREC0220                                                         
*        BL    CREC0240            NOT FOUND                                    
*        BH    CREC0220            GET NEXT                                     
         CLC   RCONKSTA,DSTNCALL(R5)                                            
         BNE   CREC0220                                                         
         ST    R5,ASTAEL           SAVE A(STATION ELEMENT)                      
*                                                                               
CREC0260 TM    RDIND,RDIPRD        TEST TO READ PRODUCT RECORDS                 
         BZ    CREC0280                                                         
         GOTO1 =A(GETPRD),DMCB,(RC)                                             
*                                                                               
CREC0280 EQU   *                                                                
         TM    RDIND,RDISABOP      TEST NEED SAR OR BOP ELEMENT                 
         BZ    CREC0360                                                         
         XC    ABOPEL,ABOPEL       YES-GET THEIR ADDRESSES                      
         XC    ASAREL,ASAREL                                                    
         LA    R1,RCONELEM                                                      
         SR    R0,R0                                                            
*                                                                               
CREC0300 CLI   0(R1),0                                                          
         BE    CREC0360                                                         
         CLI   0(R1),X'12'         SAR                                          
         BNE   CREC0340                                                         
CREC0320 EQU   *                                                                
         ST    R1,ASAREL                                                        
         B     CREC0360                                                         
CREC0340 EQU   *                                                                
         CLI   0(R1),X'10'         BOP ELEMENT FOR RADIO                        
         BNE   *+12                                                             
         ST    R1,ABOPEL                                                        
         B     CREC0360                                                         
         IC    R0,1(R1)                                                         
         AR    R1,R0                                                            
         B     CREC0300                                                         
*                                                                               
CREC0360 EQU   *                                                                
         CLI   AVAILS,C'Y'         TEST FOR ANY AVAIL REPORTS                   
         BNE   CREC0400                                                         
*                                                                               
         TM    AVLDTMSK,RUNDATS    TEST AT LEAST ONE RUN DATE REQUEST           
         BZ    CREC0380                                                         
****>>>  LA    R1,RUNDATE          GET CONTRACT RUN DATE STATUS                 
*                                                                               
*   RUNDATE ADDR NOW PASSED IN AS P2                                            
*                                                                               
         GOTO1 =A(CONAVL),DMCB,(RC),RUNDATE                                     
         MVC   RAVLMSK,AVLMSK                                                   
         CLI   SALES,C'Y'          TEST FOR ANY SALES REPORTS                   
         BE    CREC0380                                                         
         TM    AVLDTMSK,ASATDATS   NO - TEST FOR ANY AS AT DATE REQS            
         BO    CREC0380                                                         
         TM    RAVLMSK,REJECTED         NO - TEST FOR CONTRACT REJECTED         
         BO    CREC0600                      YES - SKIP THIS CONTRACT           
*                                                                               
CREC0380 GOTO1 DATCON,DMCB,(3,RCONDATE),(0,WORK)   GET FLIGHT START/            
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                      END DATES         
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
         MVC   FLIGHTST,FULL                                                    
         GOTO1 DATCON,DMCB,(3,RCONDATE+3),(0,WORK)                              
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                                        
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
         MVC   FLIGHTND,FULL                                                    
*                                                                               
CREC0400 L     R2,AQWORK                                                        
*                                                                               
CREC0420 EQU   *                                                                
         MVI   TOTSONLY,C'N'                                                    
         LA    R1,QWREQ                                                         
         USING QRECORD,R1                                                       
         CLC   =C'*SPECSET',QUESTOR                                             
         BNE   CREC0440                                                         
*                                                                               
         DROP  R1                                                               
*                                                                               
         GOTO1 =A(SPECSET),DMCB,(RC)                                            
*                                  FILTER VIA HARD-CODED SET                    
         BNZ   CREC0580            NOT ACCEPTED - SKIP IT                       
CREC0440 EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        MVC   P+1(07),=C'FILTER:'                                              
*        MVC   P+10(2),RCONKGRP                                                 
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+15,4,=C'TOG'                              
*        GOTO1 REPORT                                                           
*   TEST FILTER END                                                             
*                                                                               
         GOTO1 =A(FILTCON),DMCB,(RC)                                            
*                                  FILTER THROUGH REQUEST                       
         BE    CREC0460            OK                                           
         BL    CREC0580            NOT OK AND DON'T ADD TO TOTAL RECS           
         OC    QWTOTS,QWTOTS       TEST FOR TOTAL RECS REQUIRED                 
         BZ    CREC0580                                                         
         MVI   TOTSONLY,C'Y'       YES - INDICATE TOTAL RECS ONLY               
*                                                                               
CREC0460 EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        MVC   P+1(07),=C'PASSED:'                                              
*        MVC   P+10(2),RCONKGRP                                                 
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+15,4,=C'TOG'                              
*        GOTO1 REPORT                                                           
*   TEST PASSED END                                                             
*                                                                               
         CLI   QWSALES,C'Y'        TEST FOR ANY SALES REPORTS                   
         BNE   CREC0480                                                         
         GOTO1 =A(POSTMNTH),DMCB,(RC)                                           
*                                  SALES REPORTS:  POST MONTHS                  
CREC0480 CLI   QWAVAILS,C'Y'       TEST FOR ANY AVAIL RPTS                      
         B     CREC0500                                                         
         CLI   QWASAT,C'Y'         AVAIL RPTS - TEST FOR ASAT DATE              
         BE    CREC0500                                                         
         TM    RAVLMSK,REJECTED            NO - TEST FOR CONTRACT               
         BO    CREC0580                         REJECTED FOR RUN DATE           
*                                                                               
CREC0500 CLI   QWAVAILS,C'Y'       TEST FOR ANY AVAIL RPTS                      
         BNE   CREC0560                                                         
         CLI   QWASAT,C'Y'         YES - TEST FOR AS AT DATE                    
         BE    CREC0520                                                         
         MVC   QAVLMSK,RAVLMSK           NO - USE RUN DATE MASK                 
         B     CREC0540                                                         
*                                                                               
CREC0520 EQU   *                                                                
****>>>> LA    R1,QWRDATE          SET REQ DATE MASK FOR AS AT DATE             
*                                                                               
*   RUNDATE ADDR NOW PASSED IN AS P2                                            
*                                                                               
         GOTO1 =A(CONAVL),DMCB,(RC),QWRDATE                                     
         MVC   QAVLMSK,AVLMSK                                                   
*                                                                               
CREC0540 CLI   QWSALES,C'Y'        TEST FOR ANY SALES REPORTS                   
         BE    CREC0560                                                         
         TM    QAVLMSK,REJECTED    NO - TEST FOR CONTACT REJECTED               
         BO    CREC0580                 YES - NEXT REQUEST                      
*                                                                               
CREC0560 EQU   *                                                                
         GOTO1 =A(POSTCON),DMCB,(RC)   POST THE DETAILS                         
*                                                                               
CREC0580 EQU   *                                                                
         ICM   R2,7,QWNEXT         NEXT REQ                                     
         BNZ   CREC0420                                                         
*                                                                               
CREC0600 EQU   *                                                                
         LA    RF,QRECORD3                                                      
         USING QREC3,RF                                                         
*                                                                               
         CLI   Q3BUYCOD,C'Y'       ALTERNATE READ MECHANISM VIA                 
*                                     BUYLINE CODE PASSIVE NEEDED?              
         DROP  RF                                                               
*                                                                               
         BNE   CREC0610            NO                                           
         L     R2,AQWORK           YES - RESET A(REPT REQ WORK AREA)            
         B     CREC0070            DRIVE THRU BUYCODER                          
*                                     AND IGNORE 'SKIPPER'                      
CREC0610 EQU   *                                                                
         BAS   RE,SKIPPER          NEXT RECORD                                  
         B     CREC0120                                                         
*                                                                               
CREC0620 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
         DROP  R2                                                               
         SPACE 2                                                                
KEYCOMP  CLC   KEY(0),KEYSAVE      EXECUTED                                     
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
* INCLUDE REREPRGEQC        (EQUATES FOR VALU5NEW INTERFACE)                    
       ++INCLUDE REREPRGEQC                                                     
*                                                                               
*        POST BUFFALO COLS, REPORT LEVEL (CONTRACT RECORD)                      
*                                                                               
         SPACE                                                                  
CONCOL   NMOD1 0,*CONCOL*                                                       
         L     RC,0(R1)            RESET A(WORKSPACE)                           
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN  -  DONT CHANGE IT                          
*                                                                               
         LA    RF,QWREQ3           SET A(REQUEST CARD 3)                        
         USING QREC3D,RF                                                        
         CLI   Q3JNLOST,C'5'       R5 REQUEST?                                  
         BNE   CC004                                                            
*                                                                               
         DROP  RF                                                               
*                                                                               
         GOTO1 =A(SETR5DTS),DMCB,(RC)                                           
*                                  YES - SET R5 DATE ARRAY                      
CC004    EQU   *                                                                
*        ZIC   R7,QWREPORT                                                      
*        MH    R7,=Y(RPSPECX-RPSPECD)                                           
*        LA    R7,RPSPECS(R7)      ADDRESS RPT SPECS WORK AREA                  
         USING RPSPECD,R7                                                       
*                                                                               
         XC    ACMKTFLD(28),ACMKTFLD                                            
*                                  CLEAR ACMKTFLD, APMKTFLD, AESTTFLD,          
*                                    ACPMKFLD, APPMKFLD, ACFMKFLD,              
*                                        APFMKFLD                               
         MVI   SHRGOAL,0           CLEAR SHARE GOAL VALUE                       
*                                                                               
*   TEST RPFLAGS:                                                               
*        MVC   P+1(08),=C'RPFLAGS='                                             
*        MVC   P+10(2),RPFLAGS                                                  
*        GOTO1 REPORT                                                           
*   TEST RPFLAGS: END                                                           
*                                                                               
         TM    RPFLAGS,X'40'       TEST FOR AVAIL REPORT                        
         BO    CC400               YES - BRANCH TO AVAIL LOGIC                  
         TM    RPFLAGS,X'06'       TEST FOR RANK RPT AND 'MONTH' ROW            
         BNO   CC005                                                            
         MVC   BFRECSV,BFREC       COPY THE RECORD                              
         ICM   R1,15,AMONROW                                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
         LA    R1,RGRECLEN(R1)                                                  
         MVC   0(1,R1),QWCURST     MOVE YEAR TO MONTH ROW IN COPY REC           
         MVI   1(R1),13            MOVE MONTH 13                                
*                                                                               
CC005    EQU   *                                                                
         L     R4,ANEWMON          A(NEW MONTH TABLE)                           
*                                                                               
*   MUST ESTABLISH START DATE OF THIS REQUEST WITHIN THE NEW MONTH              
*     TABLE.  START DATE 'QWCURST' IS FIRST COMPARED WITH 'QWCURND'             
*     TO SEE IF BOTH ARE IN SAME YEAR.  IF SO, MONTH OF 'QWCURST'               
*     IS SET TO 'JANUARY'.  'QWCURST' IS FIRST MOVED TO 'WORK'.                 
*                                                                               
         MVC   WORK(2),QWCURST     SAVE CURRENT START DATE                      
         CLC   QWCURST(1),QWCURND  START AND END IN SAME YEAR?                  
         BNE   CC006               NO  - LEAVE START AS IS                      
         MVI   WORK+1,X'01'        YES - SET MONTH TO 'JANUARY'                 
CC006    EQU   *                                                                
         CLC   WORK(2),CURDATE(R4) REQUEST START VS TABLE ENTRY                 
         BE    CC008               FOUND                                        
         BH    CC007               NOT FOUND YET - KEEP LOOKING                 
         DC    H'0'                CAN'T BE LOW!  NOT FOUND ABORT               
CC007    EQU   *                                                                
         LA    R4,NEXTBUCK(R4)     BUMP TO NEXT ENTRY                           
         B     CC006                                                            
CC008    EQU   *                                                                
         ST    R4,R4STORE                                                       
CC010    CLI   0(R4),0             TEST FOR END OF MONTH TABLE                  
         BE    CC900               FOUND - EXIT                                 
         CLC   QWCURND,CURDATE(R4) TEST FOR END DATE OF REQUEST                 
         BL    CC900               FOUND - EXIT                                 
         GOTO1 DATCON,DMCB,(R4),(3,FULL)                                        
*                                                                               
         MVC   SAV2FULL,FULL                                                    
*                                  INTERMEDIATE STORAGE BECAUSE FULL IS         
*                                     A COMMON-USAGE FIELD                      
         MVC   MONTHROW(2),FULL    PERIOD MONTH YM                              
         MVC   SVMONTH,MONTHROW                                                 
         CLI   RPMONROW,0                                                       
         BE    CC040               NO MONTH ROW                                 
         CLI   RPMONROW,C'M'       ROW TYPE MONTH OR QTR                        
         BE    *+12                                                             
         CLI   RPMONROW,C'Q'                                                    
         BNE   CC015                                                            
         CLC   QWCURST,MONTHROW                                                 
         BNH   CC012                                                            
         CLC   QWREQPR,=C'3J'      REQUEST 3J GETS NO PRIOR                     
         BE    CC300                                                            
         MVI   MONTHROW+1,0        PRIOR MONTH Y0                               
         B     CC030                                                            
SAV2FULL DS    F                                                                
*                                                                               
CC012    EQU   *                                                                
         C     R4,R4STORE          ARE WE IN FIRST MONTH                        
         BE    CC030               YES - DON'T PUT YET                          
         TM    RPFLAG2,X'20'       GROSS SPL $$ COLUMNS IN REPORT?              
         BNO   CC012001            NO  -                                        
         GOTO1 =A(SPL$CALC),DMCB,(R7),(RC)                                      
*                                  YES - INSERT GROSS SPL, IF ANY               
CC012001 EQU   *                                                                
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BO    CC013               YES - PASS ALL BUFFALO RECORDS               
         OC    BFACCS,BFACCS                                                    
         BZ    CC030                                                            
         GOTO1 =A(NOBFFACC),DMCB   CHECK FOR VALID VALUE                        
         BZ    CC030               NO VALID VALUE                               
CC013    EQU   *                                                                
         GOTO1 =A(SHARCALC),DMCB,(R8),(RC)                                      
         GOTO1 =A(PUT),DMCB        PUT BUFFALO REC                              
         B     CC030                                                            
*                                                                               
CC015    CLI   RPMONROW,C'C'       ROW TYPE CURMONTH                            
         BNE   CC020                                                            
         CLC   QWCURMON,MONTHROW+1                                              
         BL    CC900               BEYOND CURRENT MONTH                         
         MVC   MONTHROW+1(1),QWCURMON   POST TO CURRENT MONTH ONLY              
         B     CC030                                                            
*                                                                               
CC020    CLI   RPMONROW,C'A'       ROW TYPE ALLMONTH                            
         BE    *+6                                                              
         DC    H'0'                                                             
         MVI   MONTHROW+1,13       POST TO TOTAL MONTH ONLY                     
*                                                                               
CC030    ICM   R1,15,AMONROW                                                    
         BZ    CC040                                                            
         MVC   0(L'MONTHROW,R1),MONTHROW    POST THE MONTH ROW                  
         TM    RPFLAGS,X'06'       TEST FOR RANK RPT AND 'MONTH' ROW            
         BNO   CC040                                                            
         OI    1(R1),X'80'         YES- TURN ON TOP BIT IN MONTH                
*                                                                               
CC040    LA    R6,RPCONCOL         IMPLODED COL SPECS                           
         LA    R5,1                COL COUNTER                                  
*                                                                               
CC050    EQU   *                                                                
*                                                                               
*   TEST                                                                        
***      CLC   =X'02912140',RCONKCON                                            
***      BNE   CC050TST                                                         
***      LTR   R1,R1                                                            
***      MVC   P+1(05),=C'CC050'                                                
***      MVC   P+7(1),THSWKFLG                                                  
***      MVC   P+10(32),0(R6)      DISPLAY COLUMN INFORMATION                   
***      GOTO1 REPORT                                                           
CC050TST EQU   *                                                                
*   TEST END                                                                    
*                                                                               
         MVI   THSWKFLG,C'N'       TURN OFF 'THIS WEEK FLAG'                    
*                                                                               
         CLI   0(R6),X'FF'         TEST FOR END OF COLS                         
         BE    CC300                                                            
         CLI   RPMONROW,0          TEST FOR MONTH ROW                           
         BE    CC090                                                            
         CLI   RPMONROW,C'M'       ROW TYPE MONTH OR QTR                        
         BE    *+12                                                             
         CLI   RPMONROW,C'Q'                                                    
         BNE   CC060                                                            
         TM    0(R6),X'01'         TEST PERIOD                                  
         BZ    CC090                                                            
         CLI   MONTHROW+1,0                                                     
         BE    CC210               DO NOT POST PRIOR TO PERIOD                  
         B     CC090                                                            
*                                                                               
CC060    CLI   RPMONROW,C'C'       ROW TYPE CURMONTH                            
         BNE   CC070                                                            
         CLC   MONTHROW+1(1),SAV2FULL+1                                         
*                                  IS THIS THE CURRENT MONTH?                   
         BE    CC090                                                            
         TM    0(R6),X'02'         NO - ONLY YTD GETS POSTED                    
         BZ    CC210                                                            
         B     CC090                                                            
*                                                                               
CC070    EQU   *                                                                
         CLI   RPMONROW,C'A'       ROW TYPE ALLMONTH                            
         BE    *+6                                                              
         DC    H'0'                                                             
         OC    QWMONADJ,QWMONADJ   REQ ACROSS YEARS HAS NO YTD                  
         BNZ   CC090                                                            
         CLC   QWCURST+1(1),SAV2FULL+1                                          
*                                  IS THIS THE PRIOR MONTH?                     
         BNH   CC090                                                            
         TM    0(R6),X'02'         YES - ONLY YTD IS POSTED                     
         BZ    CC210                                                            
         EJECT                                                                  
*                                                                               
*   AT THIS POINT, (R4) IS POINTING TO THE BEGINNING OF THE MONTH               
*     IN THE TABLE.  THIS CONTAINS 16 BYTES OF DATE INFORMATION,                
*     AFTER WHICH THE BUCKETS ARE STORED.                                       
*   THE ROUTINES DERIVE INFORMATION IN THE FOLLOWING MANNER:                    
*   ROUTINE    DEFINES         PRIORITY                                         
*   -------    -------         --------                                         
*   CC100      CURRENT EST     1.  CURRENT AS AT INVOICED                       
*                              2.  CURRENT AS AT ESTIMATE/ORDERED               
*   CC101      PRIOR   EST     1.  PRIOR   AS AT INVOICED                       
*                              2.  PRIOR   AS AT ESTIMATE/ORDERED               
*   CC102      CURRENT ACT     1.  CURRENT AS AT INVOICED                       
*   CC103      PRIOR   ACT     1.  PRIOR TOTAL INVOICED                         
*                              2.  PRIOR TOTAL ORDERED                          
*   CC104      2 YR PR EST     1.  2 YR PRIOR AS AT INVOICED                    
*                              2.  2 YR PRIOR AS AT ESTIMATE/ORD'D              
*   CC105      2 YR PR ACT     1.  2 YR PRIOR TOTAL INVOICED                    
*                              2.  2 YR PRIOR TOTAL ORDERED                     
**********************************************************************          
***>CC106      NEXT YEAR EST   1.  NEXT YEAR AS AT ORDERED                      
**********************************************************************          
*   CC106      NEXT YEAR EST   1.  NEXT    AS AT INVOICED                       
*                              2.  NEXT    AS AT ESTIMATE/ORDERED               
*   CC107      CURRENT BOOKED  1.  CURRENT AS AT ESTIMATE/ORDERED               
*   CC108      PRIOR   BOOKED  1.  PRIOR   AS AT ESTIMATE/ORDERED               
*   CC109      2 YR PR BOOKED  1.  2 YR PRIOR AS AT ESTIMATE/ORD'D              
*   CC110      BLANK COLUMN    1.  VALUE ALWAYS ZERO:  NO VALUE                 
*   CC111      THIS WK ORDERED 1.  THIS WEEK ORDERED                            
*   CC112      LAST WK ORDERED 1.  LAST WEEK ORDERED                            
*   CC113      BILLED: CURR YR 1.  CURRENT AS AT INVOICED (PURE BILL)           
*   CC114      BILLED: PRI  YR 1.  PRIOR AS AT INVOICED                         
*   CC115      BILLED: 2 YR PR 1.  2 YR PRIOR AS AT INVOICED                    
*   CC116      FORCE ROW       1.  INSERTS X'FEFEFEFE' INTO SLOT                
*   CC117      BUDGET (SAR)    1.  CONTRACT SPECIFIC BUDGET                     
*   CC118      SHARE GOAL      1.  CONTRACT SPECIFIC SHARE GOAL                 
*   CC119      FORECAST: CURRT 1.  CURRENT YEAR AS AT FORECAST                  
*   CC120      FORECAST: PRIOR 1.  PRIOR   YEAR AS AT FORECAST                  
*   CC121      FORECAST: 2YR"  1.  2 YR   PRIOR AS AT FORECAST                  
*   CC122      FORECAST: NEXT  1.  NEXT    YEAR AS AT FORECAST                  
*   CC123      A(CONTRACT REC) 1.  DISK ADDRESS OF CONTRACT RECORD              
*   CC124      SHARE $         1.  CONTRACT SPECIFIC STN SHARE MKT$             
*   CC125      MARKET $        1.  CONTRACT SPECIFIC MKT $                      
*   CC126      FORCE ROW DELIM 1.  CONTRACT SPECIFIC                            
*   CC127      SPL AS-RUN CURR 1.  CONTRACT SPECIFIC SPL AS-RUN CURR            
*                                  ALSO SPL CURRENT/MAIN CARD                   
*   CC128      SPL AS-RUN PRI  1.  CONTRACT SPECIFIC SPL AS-RUN  PRI            
*                                  ALSO SPL PRIOR  /MAIN CARD                   
*   CC129      CURNT BOOKED:   1.  CURRENT TOTAL ORDERED                        
*                NO AS-AT DATE                                                  
*   CC130      PRIOR BOOKED:   1.  PRIOR TOTAL ORDERED                          
*                NO AS-AT DATE                                                  
*   CC131      FORECAST: CURRT 1.  CURRENT YEAR AS AT FORECAST                  
*                MARKET $$            / SHARE GOAL                              
*   CC132      FORECAST: PRIOR 1.  PRIOR   YEAR AS AT FORECAST                  
*                MARKET $$            / SHARE GOAL                              
*   CC133      ESTIMATED TOTAL 1.  CURR STATION FORECAST $$ + CURR              
*                                     BOOKED $$                                 
*   CC134      FORCE EST TOTAL 1.  FORCE OUT CC133 ROW                          
*                 ROW                                                           
*   CC135      CURR BILLING    1.  CURRENT BILLING:  SAME AS                    
*                 CUME                   CC100 (CURR EST)                       
*   CC136      CURR BILLING %  1.  CURRENT BILLING:  SAME AS                    
*                 CUME                   CC100 (CURR EST)                       
*   CC137      SPL AS-RUN THIS 1.  CONTRACT SPECIFIC SPL AS-RUN  THIS           
*                 WEEK                   WEEK: SAME AS CC111:                   
*                                        THIS WEEK ORDERED                      
*                                  ALSO SPL THIS WK/MAIN CARD                   
*   CC138      SPL AS-RUN      1.  CONTRACT SPECIFIC SPL AS-RUN BASED           
*                 ESTIMATED          ON ESTIMATED TOTAL:  CURRENT               
*                                      FORECAST + CURRENT BOOKED                
*                                  FOR 'PENDING' PORTION (CFOR), NO             
*                                  - REPEAT, NO - SPL IS PRESENT, SO            
*                                  CFOR IS BROUGHT OVER INTACT, AND             
*                                  ADDED TO THE SPLE BUCKET.                    
*                                  FOR CURR BOOKED PORTION, CALC IS             
*                                  DONE AS FOR REGULAR SPL                      
*   CC139      CUR TRUE PEND   1.  CONTRACT SPECIFIC CURRENT FORECAST           
*                                  $$ WHEN CSFRCAST FLAG = 'N'                  
*   CC140      PRIOR TRUE PEND 1.  SAME AS CC139                                
*   CC141      1YR PRI TRUPEND 1.  SAME AS CC139                                
*                                                                               
*                                  NOTE:  140/141 ARE MEANINGLESS               
*   CC142      CUR TRUE FRCAST 1.  CONTRACT SPECIFIC CURRENT FORECAST           
*                                  $$ WHEN CSFRCAST FLAG = 'Y'                  
*   CC143      PRIOR TRUE PEND 1.  SAME AS CC142                                
*   CC144      1YR PRI TRUPEND 1.  SAME AS CC142                                
*                                  NOTE:  143/144 ARE MEANINGLESS               
*                                                                               
*   CC145      CURR PEND MKT$$ 1.  CURR (TRUE) PEND STA$$ / SHARE GOAL          
*   CC146      PRI  PEND MKT$$ 1.  PRI  (TRUE) PEND STA$$ / SHARE GOAL          
*   CC147      CURR FORE MKT$$ 1.  CURR (TRUE) FORE STA$$ / SHARE GOAL          
*   CC148      PRI  FORE MKT$$ 1.  PRI  (TRUE) FORE STA$$ / SHARE GOAL          
*   CC149      THIS WK PRI ORD 1.  THIS WEEK PRIOR YEAR ORDERED                 
*   CC150      SPL AS-RUN THIS 1.  CONTRACT SPECIFIC SPL AS-RUN  THIS           
*                 WEEK,LAST YR           WEEK: SAME AS CC111:                   
*                                        THIS WEEK ORDERED                      
*   CC151      SPL PERCENT     1.  CONTRACT SPECIFIC SPL PERCENT:               
*                                        MUTUALLY EXCLUSIVE FROM LOSS           
*   CC152      SPL LOSS        1.  CONTRACT SPECIFIC SPL LOSS:                  
*                                        MUTUALLY EXCLUSIVE FROM PCT            
*   CC153      SPL $ (SPL ELT) 1.  SPL $ FOR REPORT PERIOD FROM                 
*                                        SPL ELEMENT (MAY BE $0 IF              
*                                        SPL WAS A LOSS)                        
*   CC154      SPL MKT $       1.  SPL $ FOR REPORT PERIOD/REP'D STA            
*              (SPL ELEMENT)             % = SPL MKT $                          
* NOTE REGARDING SPL $ FROM SPL ELEMENT:  AT THE TIME THE COMPLETED             
*      RECORD IS TO BE RELEASED TO BUFFALO, THE DEVELOPED RECORD WILL           
*      BE OUTPUT.  A FLAG WILL INDICATE THAT THE SPL ELEMENT IS TO BE           
*      INTERROGATED.  FOR EACH STATION WHICH HAS A %, THE STATION               
*      CALLS ARE TO BE REPLACED (SEE RPSPLSTA, WHICH CONTAINS THE               
*      STATION ROW NUMBER TO CALCULATE THE STATION CALL ADDRESS IN              
*      KEY), AND THE PERCENT IS TO BE USED, ALONG WITH THE MARKET $,            
*      TO CALCULATE THE STATION'S SPL $.  THE RESULTING RECORD(S)               
*      WILL HAVE ALL BUT THE SPL COLUMNS CLEARED, AND THEN RELEASED             
*      TO BUFFALO.  THIS WILL PUT OUT MULTIPLE RECORDS WITH THE                 
*      'SAME' KEY, WHICH WILL GROUP ON THE REPORT AS 'SPL'                      
*                                                                               
*   CC155      GROSS SPL $     1.  GROSS SPL $ FROM                             
*              (SPL ELEMENT)             SPL ELEMENT (MAY BE $0 IF              
*                                        SPL WAS A LOSS)                        
*   CC156      GROSS SPL MKT $ 1.  SPL $ FOR REPORT PERIOD/REP'D STA            
*              (SPL ELEMENT)             % = SPL MKT $                          
*                                                                               
* NOTE REGARDING GROSS SPL $ FROM SPL ELEMENT:  THIS FIGURE IS THE              
*      TOTAL ORDERED DOLLARS FOR THE ORDER, IF THE SPL DATE IS W/IN             
*      THE REQUEST PERIOD (IF NOT, IT IS $0).  AFTER THAT, THE                  
*      CALCULATIONS ARE THE SAME AS THOSE OF CC153/CC154.                       
*                                                                               
*   CC157      SPL AS-RUN CURR 1.  SPL $ FOR CURRENT PER/MAIN CARD              
*                                                                               
*   CC158      SPL AS-RUN PRI  1.  SPL $ FOR PRIOR   PER/MAIN CARD              
*                                                                               
*   CC159      SPL AS-RUN THWK 1.  SPL $ FOR THIS WEEK  /MAIN CARD              
*   CC160      BEST$/CONF ONLY     DIR RESP PRE CUTOFF DATE                     
*   CC161      BEST$/UNCF ONLY     INCL DIR RESP REGARDLESS CUTOFF              
*   CC162      BEST$/DIR RESP ONLY AFTER CUTOFF DATE                            
*   CC163      THIS WEEK/CONF ONLY                                              
*   CC164      PRIOR ACTUAL/CONF ONLY                                           
*   CC165      NEXT YEAR: ACTUAL                                                
*   CC166      BOOKED:  NEXT YEAR                                               
*   CC167      BILLING: NEXT YEAR                                               
*   CC168                                                                       
*   CC169                                                                       
*                                                                               
***NEW TRADE FIGURES                                                            
*   FOLLOWING CALCULATIONS ALL PERTAIN TO **TRADE FIGURES**                     
*                                                                               
*   CC170      CURRENT EST     1.  CURRENT AS AT INVOICED                       
*                              2.  CURRENT AS AT ESTIMATE/ORDERED               
*   CC171      PRIOR   EST     1.  PRIOR   AS AT INVOICED                       
*                              2.  PRIOR   AS AT ESTIMATE/ORDERED               
*   CC172      CURRENT ACT     1.  CURRENT AS AT INVOICED                       
*   CC173      PRIOR   ACT     1.  PRIOR TOTAL INVOICED                         
*                              2.  PRIOR TOTAL ORDERED                          
*   CC174      CURRENT BOOKED  1.  CURRENT AS AT ESTIMATE/ORDERED               
*   CC175      PRIOR   BOOKED  1.  PRIOR   AS AT ESTIMATE/ORDERED               
*   CC176      THIS WK ORDERED 1.  THIS WEEK ORDERED                            
*   CC177      LAST WK ORDERED 1.  LAST WEEK ORDERED                            
*   CC178      BILLED: CURR YR 1.  CURRENT AS AT INVOICED (PURE BILL)           
*   CC179      BILLED: PRI  YR 1.  PRIOR AS AT INVOICED                         
*   CC180      CURNT BOOKED:   1.  CURRENT TOTAL ORDERED                        
*                NO AS-AT DATE                                                  
*   CC181      PRIOR BOOKED:   1.  PRIOR TOTAL ORDERED                          
*                NO AS-AT DATE                                                  
*   CC182      BEST$/CONF ONLY     DIR RESP PRE CUTOFF DATE                     
*   CC183      BEST$/UNCF ONLY     INCL DIR RESP REGARDLESS CUTOFF              
*   CC184      THIS WEEK/CONF ONLY                                              
*   CC185      PRIOR ACTUAL/CONF ONLY                                           
*   CC186      SPOTS:  CURRENT                                                  
*   CC187      SPOTS:  PRIOR                                                    
*   CC188      SPOTS:  2YRS PRIOR                                               
*                                                                               
*   PRECEDING CALCULATIONS ALL PERTAIN TO **TRADE FIGURES**                     
***NEW TRADE FIGURES                                                            
*                                                                               
*                                                                               
*   SOME NOTES CONCERNING THE 'AS AT DATE' LOGIC:                               
*                                                                               
*     ALL - REPEAT, ALL - REQUESTS HAVE AN 'AS AT DATE,' WHETHER                
*        STATED OR IMPLIED.  IF NO DATE IS ENTERED, THE RUN DATE                
*        BECOMES THE 'AS AT DATE.'                                              
*        THE 'AS AT DATE' ENTERED/IMPLIED IS THE BASE FOR THE PRIOR             
*        YEAR/2 YEARS PRIOR 'AS AT DATE.'  THIS MAY PRODUCE CONFLICTING         
*        RESULTS IN REPORTS WHEN, FOR EXAMPLE, THE FOLLOWING SITUATIONS         
*        ARISE: (EXAMPLE ASSUMES REPORT RUN OF AUG19/91):                       
*                                       AS AT IMPLIED:  AS AT ENTERED           
*                                       --------------  -------------           
*   DATE RANGE OF REPORT:   JAN-DEC90     AUG19/91         AUG20/90             
*     PRIOR YEAR DATES  :   JAN-DEC89     AUG20/90         AUG21/89             
*     2 YR PRIOR DATES  :   JAN-DEC88     AUG21/89         AUG22/88             
*                                                                               
*     BECAUSE OF THE DIFFERENT AS AT DATES, THE REPORTS GENERATED WILL          
*        SHOW SIGNIFICANTLY DIFFERENT FIGURES.                                  
*                                                                               
         EJECT                                                                  
CC090    EQU   *                                                                
         MVI   NOPRIFLG,0          CLEAR 'NO PRIOR DATA' FLAG                   
         MVI   NOCURFLG,0          CLEAR 'NO CURRENT DATA' FLAG                 
         LA    RF,QWREQ3           R1/R2 REQUESTS?                              
         USING QREC3D,RF                                                        
*                                                                               
         CLI   Q3JNLOST,C'1'       R1 REQUEST? (GROSS BILLING)                  
         BE    CC090A              YES - CHECK JOIN/LEAVE                       
         CLI   Q3JNLOST,C'2'       R2 REQUEST? (EQUAL BAR)                      
         BE    CC090A              YES - CHECK JOIN/LEAVE                       
         CLI   Q3JNLOST,C'3'       R3 REQUEST? (KATZ COMP)                      
         BE    CC090A              YES - CHECK JOIN/LEAVE                       
*                                                                               
         CLI   Q3JNLOST,C'5'       R5 REQUEST? (GAIN/LOST)                      
         BE    CC090B              YES - CHECK JOIN/LEAVE                       
*                                                                               
         CLI   Q3JNLOST,C'6'       R6 REQUEST? (TOM OLSON)                      
         BE    CC090C              YES - CHECK OPTSTA TABLE                     
         B     CC090F              NO  - SKIP JOIN/LEAVE                        
*                                                                               
         DROP  RF                                                               
*                                                                               
*        CC090A  -   GROSS BILLING REPORT                                       
*                    EQUAL BAR REPORT                                           
*                    KATZ COMP REPORT                                           
*                                                                               
CC090A   EQU   *                                                                
         MVC   SAVEFULL,FULL       SAVE CONTENTS                                
         GOTO1 =A(JOINLEAV),DMCB,(RC),(R4),(R2)                                 
*                                  TEST JOIN/LEAVE DATE REPORTING               
         MVC   FULL,SAVEFULL       RESTORE CONTENTS                             
         BZ    CC090F              ACCEPTED:  USE DATA                          
         SR    R1,R1               CLEAR REGISTER                               
         B     CC190               REJECTED:  SKIP DATA                         
SAVEFULL DS    F                                                                
*                                                                               
*        CC090B  -   GAIN/LOST REPORT                                           
*                                                                               
CC090B   EQU   *                                                                
         MVC   SAVEFULL,FULL       SAVE CONTENTS                                
         GOTO1 =A(GAINLOST),DMCB,(RC),(R4)                                      
*                                  TEST GAIN/LOST DATE REPORTING                
         MVC   FULL,SAVEFULL       RESTORE CONTENTS                             
         BZ    CC090F              ACCEPTED:  USE DATA                          
         SR    R1,R1               CLEAR REGISTER                               
         B     CC190               REJECTED:  SKIP DATA                         
*                                                                               
*        CC090C  -   TOM OLSON REPORT                                           
*                                                                               
CC090C   EQU   *                                                                
         MVC   SAVEFULL,FULL       SAVE CONTENTS                                
         GOTO1 =A(CHKOPSTA),DMCB,(RC),(R4),(R2)                                 
*                                  TEST OPTSTA TABLE REPORTING                  
         MVC   FULL,SAVEFULL       RESTORE CONTENTS                             
         BZ    CC090F              ACCEPTED:  USE DATA                          
         SR    R1,R1               CLEAR REGISTER                               
         B     CC190               REJECTED:  SKIP DATA                         
CC090F   EQU   *                                                                
         ICM   R3,7,1(R6)          BUFFALO COL ADDR                             
         ICM   RF,7,4(R6)          POST ROUTINE ADDDR                           
         TM    RPFLAG2,X'02'       SPLITPND REPORT?                             
         BZ    CC095               NO  - PROCESS AS USUAL                       
         TM    0(R6),X'04'         YES - 'PENDING' COLUMN?                      
         BZ    CC095               NO  - PROCESS AS USUAL                       
         L     RE,ACONSPEC         YES - IS CONTRACT 'PENDING'?                 
         CLI   CSPENDNG(RE),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    CC095               YES - PROCESS                                
         CLI   CSPENDNG(RE),C'P'   NO  - 'PENDING/NEW SAR' ORDER?               
         BNE   CC110               NO  - FORCE AS BLANK COL                     
CC095    EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        ST    RE,REGSAVE                                                       
*        ST    RF,REGSAVE2                                                      
*        MVC   P+1(4),=C'C95='                                                  
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+5,4,=C'TOG'                               
*        GOTO1 REPORT                                                           
*        L     RE,REGSAVE          RESTORE RE                                   
*        L     RF,REGSAVE2         RESTORE RE                                   
*   TEST END                                                                    
*                                                                               
         BR    RF                  POST THE COL                                 
*EGSAVE  DS    F                                                                
*EGSAVE2 DS    F                                                                
*                                                                               
CC100    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TOTORD(R4)      CURRENT AS AT ESTIMATE               
         TM    6(R4),X'01'                 TEST: CURR AS AT INV?                
         BZ    *+8                         NO  - USE ESTIMATE                   
         L     R1,SKIPDATE+CUASATIN(R4)    YES - USE CURR AS AT INV             
         B     CC190                                                            
*                                                                               
CC101    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         BAS   RE,CCCUTOFP         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFP         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+PRASATIN(R4)    PRIOR AS AT INVOICE                  
         TM    6(R4),X'04'                 TEST: PRIOR AS AT INV                
         BO    *+8                         YES - USE INVOICE                    
         L     R1,SKIPDATE+PRASATOR(R4)    NO  - USE PRIOR AS AT EST            
         B     CC190                                                            
*                                                                               
CC102    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         L     R1,SKIPDATE+CUASATIN(R4)    CURRENT AS AT INVOICE                
         B     CC190                                                            
*                                                                               
CC103    EQU   *                                                                
         SR    R1,R1                                                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+PRTOTINV(R4)    PRIOR TOTAL INVOICE                  
         TM    6(R4),X'02'                 TEST: ANY PRIOR INVOICES             
         BO    *+8                         YES - USE INVOICE                    
         L     R1,SKIPDATE+PRTOTORD(R4)    NONE - USE PRIOR TOT EST             
         B     CC190                                                            
*                                                                               
CC104    EQU   *                                                                
         SR    R1,R1                                                            
**       TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
**       BO    CC190               YES                                          
         TM    NOPRIFLG,2          SKIP 2YR PRIOR DATA?                         
         BO    CC190               YES                                          
         L     R1,SKIPDATE+P2ASATIN(R4)    2 YEAR PRIOR AS AT INVOICE           
         TM    6(R4),X'10'                 TEST: ANY 2 YR AS AT INV             
         BO    *+8                         YES - USE AS AT INVOICE              
         L     R1,SKIPDATE+P2ASATOR(R4)    NO - USE AS AT ORDERED               
         B     CC190                                                            
*                                                                               
CC105    EQU   *                                                                
         SR    R1,R1                                                            
**       TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
**       BO    CC190               YES                                          
         TM    NOPRIFLG,2          SKIP 2YR PRIOR DATA?                         
         BO    CC190               YES                                          
         L     R1,SKIPDATE+P2TOTINV(R4)    2 YEAR PRIOR TOTAL INVOICE           
         TM    6(R4),X'08'                 TEST: ANY 2 YR PRIOR INV             
         BO    *+8                         YES - USE INVOICE                    
         L     R1,SKIPDATE+P2TOTORD(R4)    NO  - USE 2 YR PRI TOT EST           
         B     CC190                                                            
*                                                                               
*   DEPENDING UPON NRGON OPTION, 'NEXT YEAR' MAY BE USED FOR AN                 
*        ALTERNATE DATE CALCULATION FOR 'PRIOR/LAST YEAR'.  IF                  
*        OPTION IS SET, 'NEXT YEAR' PROCESSING IS IDENTICAL TO                  
*        'PRIOR YEAR'.                                                          
*                                                                               
CC106    EQU   *                                                                
         CLI   NRRGFLAG,C'Y'       SPECIAL OPTION FOR NRRGON?                   
         BE    CC106A              YES - PROCESS AS 'LAST YEAR'                 
*                                  NO  - PROCESS AS 'NEXT YEAR'                 
         L     R1,SKIPDATE+NXASATOR(R4)    NEXT YEAR AS AT ORDERED              
         B     CC190                                                            
*                                                                               
CC106A   EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
*                                                                               
*   ACTUALLY USE CURRENT CUTOFF DATE FOR THIS 'LAST YEAR'                       
*                                                                               
***      BAS   RE,CCCUTOFP         TEST FOR DR CUTOFF                           
         GOTO1 =A(CCCUTNEX),DMCB,(RC)                                           
         BNZ   CC106B                                                           
***      BAS   RE,PPCUTOFP         TEST FOR PP CUTOFF                           
         GOTO1 =A(PPCUTNEX),DMCB,(RC)                                           
         BNZ   CC106B                                                           
         L     R1,SKIPDATE+NXASATIN(R4)    NEXT AS AT INVOICE                   
*                                                                               
*   TEST                                                                        
**       CLC   =X'04973382',RCONKCON                                            
**       BNE   TEST0010                                                         
**       ZIC   RF,FLAG7(R4)                                                     
**       DC    H'0'                                                             
TEST0010 EQU   *                                                                
*   TEST END                                                                    
*                                                                               
         TM    FLAG7(R4),X'20'             TEST: NEXT  AS AT INV                
         BO    *+8                         YES - USE INVOICE                    
         L     R1,SKIPDATE+NXASATOR(R4)    NO  - USE NEXT AS AT EST             
         B     CC190                                                            
*                                                                               
CC106B   EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR AFTER 'GOTO1'              
         B     CC190                                                            
*                                                                               
CC107    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TOTORD(R4)      CURRENT BOOKED                       
         B     CC190                                                            
*                                                                               
CC108    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         BAS   RE,CCCUTOFP         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFP         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+PRASATOR(R4)    PRIOR BOOKED                         
         B     CC190                                                            
*                                                                               
CC109    EQU   *                                                                
         SR    R1,R1                                                            
**       TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
**       BO    CC190               YES                                          
         TM    NOPRIFLG,2          SKIP 2YR PRIOR DATA?                         
         BO    CC190               YES                                          
         L     R1,SKIPDATE+P2ASATOR(R4)    2 YEARS PRIOR BOOKED                 
         B     CC190                                                            
*                                                                               
CC110    EQU   *                                                                
         SR    R1,R1                       BLANK COLUMN                         
         B     CC190                                                            
*                                                                               
CC111    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+THISWKOR(R4)    THIS WEEK ORDERED                    
         B     CC190                                                            
*                                                                               
CC112    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+LASTWKOR(R4)    LAST WEEK ORDERED                    
         B     CC190                                                            
*                                                                               
CC113    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+CUASATIN(R4)    BILLED:  CURRENT YEAR                
         B     CC190                                                            
*                                                                               
CC114    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         BAS   RE,CCCUTOFP         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFP         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+PRASATIN(R4)    BILLED:  PRIOR   YEAR                
         B     CC190                                                            
*                                                                               
CC115    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
**       TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
**       BO    CC190               YES                                          
         TM    NOPRIFLG,2          SKIP 2YR PRIOR DATA?                         
         BO    CC190               YES                                          
         L     R1,SKIPDATE+P2ASATIN(R4)    BILLED:  2 YEARS PRIOR               
         B     CC190                                                            
*                                                                               
CC116    EQU   *                                                                
*                                  IF RPMISFLG+1 = X'02', ROW                   
*                                     NEEDS NOTHING MORE                        
*                                  OTHERWISE FOLLOWING APPLIES:                 
*                                  UNLESS REPORT IS 'PENDING'                   
*                                  OR REPORT IS 'AGGREGATE'                     
*                                  FORCE ROW MUST HAVE CURRENT BOOKED           
*                                  OR CURRENT BILLED DOLLARS                    
         TM    RPMISFLG+1,X'02'    FORCE ROW OVERRIDE?                          
         BO    CC116A              YES - DON'T TEST DOLLARS                     
         TM    RPMISFLG+1,X'08'    FORCE ROW OVERRIDE/FLIGHT DATES?             
         BO    CC116A              YES - DON'T TEST DOLLARS                     
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BO    CC116A              YES - DON'T TEST DOLLARS                     
*                                                                               
         OC    RPAGGREG,RPAGGREG   ANY VALUE IN AGGREGATE?                      
         BNZ   CC116A              YES - DON'T TEST DOLLARS                     
*                                                                               
         OC    RPAGGSPL,RPAGGSPL   ANY VALUE IN SPL AS-RUN?                     
         BNZ   CC116A              YES - DON'T TEST DOLLARS                     
*                                                                               
         L     R1,SKIPDATE+TOTORD(R4)   CURRENT BOOKED DOLLARS?                 
         LTR   R1,R1                                                            
         BNZ   CC116A                   YES - FORCE THE ROW                     
*                                                                               
*   NO CURRENT BOOKED DOLLARS - CHECK CURRENT BILLED DOLLARS                    
*                                                                               
         L     R1,SKIPDATE+CUASATIN(R4) CURRENT BILLED DOLLARS?                 
         LTR   R1,R1                                                            
         BZ    CC190                    NO  - DON'T FORCE ROW                   
CC116A   EQU   *                                                                
         L     R1,=X'FEFEFEFE'          FORCE ROW                               
         B     CC205                                                            
*                                                                               
CC117    EQU   *                                                                
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSBUDGET(RE)     BUDGET FROM SAR ELEMENT                      
         B     CC205               SKIP COMMISSION CALCULATION                  
*                                                                               
CC118    EQU   *                                                                
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSSHGOAL(RE)     SHARE GOAL FROM SAR ELT                      
         B     CC205               SKIP COMMISSION CALCULATION                  
*                                                                               
CC119    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         L     R1,SKIPDATE+CURRFORC(R4)    CURRENT FORECAST AS AT               
         L     RF,ACONSPEC         SET A(CONTRACT SPECIFIC)                     
*                                                                               
         TM    CSFRMISC(RF),X'10'  FORECAST/$0 EXPLICIT?                        
         BNO   CC190               NO  -                                        
         LA    RF,QWREQ3           SET A(REQUEST CARD 3)                        
         USING QREC3D,RF                                                        
         CLI   Q3FORCST,C'Y'       DISPLAY FORECAST REQUEST?                    
         BNE   CC190               NO                                           
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVC   BFREC+RGLSTDTA(4),=X'FFFFFFFF'                                   
*                                  YES - LOAD LAST BUCKET TO FORCE              
*                                     OUTPUT OF THIS RECORD                     
*   NOTE:  THIS IS A DANGEROUS THING, BECAUSE THE VERY LAST BUCKET              
*        MAY BE USED BY REAL DATA.  IT IS ADVISABLE THAT FORECAST               
*        REPORTS LEAVE THE LAST BUCKET EMPTY.                                   
*                                                                               
         B     CC190                                                            
*                                                                               
CC120    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+PRIOFORC(R4)    PRIOR   FORECAST AS AT               
         L     RF,ACONSPEC         SET A(CONTRACT SPECIFIC)                     
*                                                                               
         TM    CSFRMISC(RF),X'10'  FORECAST/$0 EXPLICIT?                        
         BNO   CC190               NO  -                                        
         LA    RF,QWREQ3           SET A(REQUEST CARD 3)                        
         USING QREC3D,RF                                                        
         CLI   Q3FORCST,C'Y'       DISPLAY FORECAST REQUEST?                    
         BNE   CC190               NO                                           
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVC   BFREC+RGLSTDTA(4),=X'FFFFFFFF'                                   
*                                  YES - LOAD LAST BUCKET TO FORCE              
*                                     OUTPUT OF THIS RECORD                     
*   NOTE:  THIS IS A DANGEROUS THING, BECAUSE THE VERY LAST BUCKET              
*        MAY BE USED BY REAL DATA.  IT IS ADVISABLE THAT FORECAST               
*        REPORTS LEAVE THE LAST BUCKET EMPTY.                                   
*                                                                               
         B     CC190                                                            
*                                                                               
CC121    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
**       TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
**       BO    CC190               YES                                          
         TM    NOPRIFLG,2          SKIP 2YR PRIOR DATA?                         
         BO    CC190               YES                                          
         L     R1,SKIPDATE+PRI2FORC(R4)    2YR PRI FORECAST AS AT               
         L     RF,ACONSPEC         SET A(CONTRACT SPECIFIC)                     
*                                                                               
         TM    CSFRMISC(RF),X'10'  FORECAST/$0 EXPLICIT?                        
         BNO   CC190               NO  -                                        
         LA    RF,QWREQ3           SET A(REQUEST CARD 3)                        
         USING QREC3D,RF                                                        
         CLI   Q3FORCST,C'Y'       DISPLAY FORECAST REQUEST?                    
         BNE   CC190               NO                                           
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVC   BFREC+RGLSTDTA(4),=X'FFFFFFFF'                                   
*                                  YES - LOAD LAST BUCKET TO FORCE              
*                                     OUTPUT OF THIS RECORD                     
*   NOTE:  THIS IS A DANGEROUS THING, BECAUSE THE VERY LAST BUCKET              
*        MAY BE USED BY REAL DATA.  IT IS ADVISABLE THAT FORECAST               
*        REPORTS LEAVE THE LAST BUCKET EMPTY.                                   
*                                                                               
         B     CC190                                                            
*                                                                               
CC122    L     R1,SKIPDATE+NEXTFORC(R4)    NEXT YR FORECAST AS AT               
         B     CC190                                                            
*                                                                               
CC123    EQU   *                                                                
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSCOMMNT(RE)     DISK ADDRESS OF CONTRACT REC                 
         B     CC205               SKIP COMMISSION CALCULATION                  
*                                                                               
CC124    EQU   *                                                                
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSSHRDOL(RE)     STATION SHARE $ FROM SAR ELT                 
         B     CC205               SKIP COMMISSION CALCULATION                  
*                                                                               
CC125    EQU   *                                                                
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSMKTDOL(RE)     MARKET $ FROM SAR ELT                        
         B     CC205               SKIP COMMISSION CALCULATION                  
*                                                                               
CC126    EQU   *                                                                
         L     R1,=X'FEFEFEFE'     FORCE ROW DELIMITER                          
         B     CC205                                                            
*                                                                               
CC127    EQU   *                   SPL AS-RUN CURRENT                           
         MVI   THREE+1,0           SET 'AS-RUN CURRENT'                         
*                                                                               
*   TEST                                                                        
***      CLC   =X'02704730',RCONKCON                                            
***      BNE   CC127TST                                                         
***      LTR   R1,R1                                                            
***      MVC   P+1(05),=C'CC127'                                                
***      GOTO1 REPORT                                                           
CC127TST EQU   *                                                                
*   TEST END                                                                    
*                                                                               
         OC    RPAGGSPL,RPAGGSPL   SPL AS-RUN SPEC?                             
         BZ    CC310               NO  - TEST FOR LOSS                          
*                                  YES                                          
*                                                                               
*   TEST                                                                        
***      CLC   =X'02704730',RCONKCON                                            
***      BNE   CC127TS2                                                         
***      MVC   P+1(05),=C'NOLOS'                                                
***      GOTO1 REPORT                                                           
CC127TS2 EQU   *                                                                
*   TEST END                                                                    
*                                                                               
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC220               YES                                          
*                                  BASED ON CURRENT BOOKED FIGURES              
         L     R1,SKIPDATE+TOTORD(R4)                                           
         B     CC220               GO TO COMMON ROUTINE                         
*                                                                               
CC128    EQU   *                   SPL AS-RUN PRIOR                             
         MVI   THREE+1,1           SET 'AS-RUN PRIOR'                           
*                                                                               
*   TEST                                                                        
***      CLC   =X'02704730',RCONKCON                                            
***      BNE   CC128TST                                                         
***      LTR   R1,R1                                                            
***      MVC   P+1(05),=C'CC128'                                                
***      GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
CC128TST EQU   *                                                                
*   TEST END                                                                    
*                                                                               
         OC    RPAGGSPL,RPAGGSPL   SPL AS-RUN SPEC?                             
         BZ    CC310               NO  - TEST FOR LOSS                          
*                                  YES                                          
*                                                                               
*   TEST                                                                        
***      CLC   =X'02704730',RCONKCON                                            
***      BNE   CC128TS2                                                         
***      MVC   P+1(05),=C'NOLOS'                                                
***      GOTO1 REPORT                                                           
CC128TS2 EQU   *                                                                
*   TEST END                                                                    
*                                                                               
*                                  BASED ON PRIOR   BOOKED FIGURES              
*                                     DISREGARDING AS-AT DATES                  
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC220               YES                                          
         L     R1,SKIPDATE+PRTOTORD(R4)                                         
         B     CC220               GO TO COMMON ROUTINE                         
*                                                                               
CC129    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TOTORD(R4)      USE TOTAL ORDERED                    
         B     CC190                                                            
*                                                                               
CC130    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         BAS   RE,CCCUTOFP         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFP         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+PRTOTORD(R4)    USE PRIOR TOT ORDERED                
         B     CC190                                                            
*                                                                               
CC131    EQU   *                                                                
         ST    R3,ACMKTFLD         A(CURRENT BUFF FIELD)                        
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSSHGOAL(RE)     SHARE GOAL FROM SAR ELT                      
         ST    R1,SHRGOAL          SAVE SHARE GOAL                              
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         L     R1,SKIPDATE+CURRFORC(R4)    CURRENT FORECAST AS AT               
*                                            TO BE USED TO CALCULATE            
*                                            CURR MKT $$ FOR PERIOD             
         B     CC190                                                            
*                                                                               
CC132    EQU   *                                                                
         ST    R3,APMKTFLD         A(CURRENT BUFF FIELD)                        
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSSHGOAL(RE)     SHARE GOAL FROM SAR ELT                      
         ST    R1,SHRGOAL          SAVE SHARE GOAL                              
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+PRIOFORC(R4)    PRIOR   FORECAST AS AT               
*                                            TO BE USED TO CALCULATE            
*                                            PRIOR MKT $$ FOR PERIOD            
         B     CC190                                                            
*                                                                               
*                                  ESTIMATED TOTAL: CURRENT STATION             
*                                     FORECAST $$ + CURRENT BOOKED              
*                                  SET CURRENT BOOKED NOW.                      
*                                  STN FC $$ TO BE ADDED TO IT                  
*                                     AT PRINT TIME AS THE TWO                  
*                                     VALUES MAY BE AGGREGATED IN               
*                                     DIFFERENT REPORTS, THEN MERGED            
*                                     IN RERG03                                 
*                                                                               
CC133    EQU   *                                                                
         ST    R3,AESTTFLD         A(CURRENT BUFF FIELD)                        
         L     R1,SKIPDATE+TOTORD(R4)      CURRENT BOOKED                       
         B     CC190                                                            
*                                                                               
CC134    EQU   *                   FORCE ESTIMATE TOTAL ROW                     
         L     R1,=X'FEFEFEFE'          FORCE ROW                               
         B     CC205                                                            
*                                                                               
CC135    EQU   *                   CURRENT BILLING CUME:                        
         B     CC100               USE CURRENT ESTIMATE ROUTINE                 
*                                                                               
CC136    EQU   *                   CURRENT BILLING % CUME:                      
         B     CC100               USE CURRENT ESTIMATE ROUTINE                 
*                                                                               
CC137    EQU   *                   SPL AS-RUN THIS WEEK                         
         MVI   THSWKFLG,C'Y'       SET SPL AS RUN THIS WEEK FLAG                
         OC    RPAGGSPL,RPAGGSPL   SPL AS-RUN SPEC?                             
         BZ    CC310               NO  - TEST FOR LOSS                          
*                                  YES                                          
*                                  BASED ON THIS WEEK BOOKED FIGURES            
*                                     DISREGARDING AS-AT DATES                  
         L     R1,SKIPDATE+THISWKOR(R4)   (THIS WEEK ORDERED)                   
         B     CC220               GO TO COMMON ROUTINE                         
*                                                                               
*                                                                               
*                                                                               
*   NOTE:  SPL AS-RUN ESTIMATED CANNOT BE A FEATURE OF AN AGGREG                
*        REPORT.  IN ORDER TO DO THE SPL CALCULATION, ALL COMPONENTS            
*        MUST BE PRESENT.  THE STATION FORECAST $$ FIGURE CAN BE                
*        PASSED IN AN AGGREGATE FOR OTHER REPORTING, BUT NOT FOR THIS           
*        CASE.                                                                  
*                                                                               
CC138    EQU   *                   SPL AS-RUN ESTIMATED                         
         OC    RPAGGSPL,RPAGGSPL   SPL AS-RUN SPEC?                             
         BZ    CC110               NO  - TREAT AS BLANK COLUMN                  
*                                  YES                                          
*                                  BASED ON CURRENT BOOKED FIGURES              
*                                     PLUS STATION FORECAST $$                  
*                                     DISREGARDING AS-AT DATES                  
*                                                                               
*   NOTE:  BOTH CURRENT ORDERED AND CURRENT FORECAST WILL NOT                   
*     EXIST AT THE SAME TIME.  IF THE INPUT VALUE IS CURRENT                    
*     BOOKED, IT IS PROCESSED IDENTICALLY AS SPL AS-RUN CURRENT.                
*     IF INPUT VALUE IS CURRENT FORCED, JUST THAT VALUE IS                      
*     ACCUMULATED AS THE NUMERATOR OF THE FINAL EQUATION.                       
*     IF NEITHER FIELD HAS A VALUE, ITEM IS PROCESSED TO CHECK                  
*     FOR A LOSS, IN WHICH CASE CSSPLPCT MAY CONTAIN A TOTAL                    
*     MARKET BUDGET $$ FIGURE.                                                  
*                                                                               
         GOTO1 =A(FLITDATE),DMCB,(RC)  CALCULATE ORDER FLIGHT DATES             
*                                                                               
         L     R1,SKIPDATE+TOTORD(R4)   (CURRENT ORDERED)                       
         LTR   R1,R1               ANY VALUE?                                   
         BNZ   CC220               YES - PROCESS CURRENT BOOKED $$              
         L     R1,SKIPDATE+CURRFORC(R4)                                         
*                                  NO  - ADD STATION FORECAST $$                
         LTR   R1,R1               ANY VALUE?                                   
         BZ    CC220               NO  - GO LOOK FOR A LOSS                     
         LR    RE,R1                                                            
         A     RE,0(R3)            ACCUMULATE COLUMN                            
         ST    RE,0(R3)                                                         
         B     CC210               GO FOR NEXT BUCKET                           
*                                                                               
CC139    EQU   *                                                                
         L     RE,ACONSPEC         IS CONTRACT 'PENDING'?                       
         CLI   CSPENDNG(RE),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    CC139A              YES - PROCESS                                
         CLI   CSPENDNG(RE),C'P'   NO  - 'PENDING/NEW SAR' ORDER?               
         BNE   CC110               NO  - FORCE AS BLANK COL                     
CC139A   EQU   *                                                                
         CLI   CSFRCAST(RE),C'Y'   IS CONTRACT 'FORECAST?'                      
         BE    CC110               YES - NOT 'TRUE PENDING'                     
*                                     FORCE AS BLANK COLUMN                     
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         L     R1,SKIPDATE+CURRFORC(R4)    TRUE PENDING AS AT $$                
         B     CC190                                                            
*                                                                               
CC140    EQU   *                                                                
         L     RE,ACONSPEC         IS CONTRACT 'PENDING'?                       
         CLI   CSPENDNG(RE),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    CC140A              YES - PROCESS                                
         CLI   CSPENDNG(RE),C'P'   NO  - 'PENDING/NEW SAR' ORDER?               
         BNE   CC110               NO  - FORCE AS BLANK COL                     
CC140A   EQU   *                                                                
         CLI   CSFRCAST(RE),C'Y'   IS CONTRACT 'FORECAST?'                      
         BE    CC110               YES - NOT 'TRUE PENDING'                     
*                                     FORCE AS BLANK COLUMN                     
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+PRIOFORC(R4)    PRIOR PENDING AS AT $$               
         B     CC190                                                            
*                                                                               
CC141    EQU   *                                                                
         L     RE,ACONSPEC         IS CONTRACT 'PENDING'?                       
         CLI   CSPENDNG(RE),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    CC141A              YES - PROCESS                                
         CLI   CSPENDNG(RE),C'P'   NO  - 'PENDING/NEW SAR' ORDER?               
         BNE   CC110               NO  - FORCE AS BLANK COL                     
CC141A   EQU   *                                                                
         CLI   CSFRCAST(RE),C'Y'   IS CONTRACT 'FORECAST?'                      
         BE    CC110               YES - NOT 'TRUE PENDING'                     
*                                     FORCE AS BLANK COLUMN                     
         SR    R1,R1               CLEAR ACCUMULATOR                            
**       TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
**       BO    CC190               YES                                          
         TM    NOPRIFLG,2          SKIP 2YR PRIOR DATA?                         
         BO    CC190               YES                                          
         L     R1,SKIPDATE+PRI2FORC(R4)    2YR PRI PENDING AS AT $$             
         B     CC190                                                            
*                                                                               
CC142    EQU   *                                                                
         L     RE,ACONSPEC         IS CONTRACT 'PENDING'?                       
         CLI   CSPENDNG(RE),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    CC142A              YES - PROCESS                                
         CLI   CSPENDNG(RE),C'P'   NO  - 'PENDING/NEW SAR' ORDER?               
         BNE   CC110               NO  - FORCE AS BLANK COL                     
CC142A   EQU   *                                                                
         CLI   CSFRCAST(RE),C'Y'   IS CONTRACT 'FORECAST?'                      
         BNE   CC110               NO  - NOT 'TRUE FORECAST'                    
*                                     FORCE AS BLANK COLUMN                     
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         L     R1,SKIPDATE+CURRFORC(R4)    TRUE PENDING AS AT $$                
*                                                                               
*   TEST CC142                                                                  
*        MVC   P+1(05),=C'CX142'                                                
*        MVC   P+7(72),BFREC                                                    
*        L     RF,ACONSPEC                                                      
*        MVC   P+80(32),0(RF)                                                   
*        GOTO1 REPORT                                                           
*   TEST CC142 END                                                              
*                                                                               
         L     RF,ACONSPEC         SET A(CONTRACT SPECIFIC)                     
*                                                                               
         TM    CSFRMISC(RF),X'10'  FORECAST/$0 EXPLICIT?                        
         BNO   CC190               NO  -                                        
         LA    RF,QWREQ3           SET A(REQUEST CARD 3)                        
         USING QREC3D,RF                                                        
         CLI   Q3FORCST,C'Y'       DISPLAY FORECAST REQUEST?                    
         BNE   CC190               NO                                           
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVC   BFREC+RGLSTDTA(4),=X'FFFFFFFF'                                   
*                                  YES - LOAD LAST BUCKET TO FORCE              
*                                     OUTPUT OF THIS RECORD                     
*   NOTE:  THIS IS A DANGEROUS THING, BECAUSE THE VERY LAST BUCKET              
*        MAY BE USED BY REAL DATA.  IT IS ADVISABLE THAT FORECAST               
*        REPORTS LEAVE THE LAST BUCKET EMPTY.                                   
*                                                                               
*                                                                               
*   TEST CC142                                                                  
*        MVC   P+1(05),=C'CC142'                                                
*        MVC   P+7(72),BFREC                                                    
*        GOTO1 REPORT                                                           
*        MVC   P+7(72),BFREC+72                                                 
*        GOTO1 REPORT                                                           
*   TEST CC142 END                                                              
*                                                                               
         B     CC190                                                            
*                                                                               
CC143    EQU   *                                                                
         L     RE,ACONSPEC         IS CONTRACT 'PENDING'?                       
         CLI   CSPENDNG(RE),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    CC143A              YES - PROCESS                                
         CLI   CSPENDNG(RE),C'P'   NO  - 'PENDING/NEW SAR' ORDER?               
         BNE   CC110               NO  - FORCE AS BLANK COL                     
CC143A   EQU   *                                                                
         CLI   CSFRCAST(RE),C'Y'   IS CONTRACT 'FORECAST?'                      
         BNE   CC110               NO  - NOT 'TRUE FORECAST'                    
*                                     FORCE AS BLANK COLUMN                     
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+PRIOFORC(R4)    PRIOR PENDING AS AT $$               
         L     RF,ACONSPEC         SET A(CONTRACT SPECIFIC)                     
*                                                                               
         TM    CSFRMISC(RF),X'10'  FORECAST/$0 EXPLICIT?                        
         BNO   CC190               NO  -                                        
         LA    RF,QWREQ3           SET A(REQUEST CARD 3)                        
         USING QREC3D,RF                                                        
         CLI   Q3FORCST,C'Y'       DISPLAY FORECAST REQUEST?                    
         BNE   CC190               NO                                           
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVC   BFREC+RGLSTDTA(4),=X'FFFFFFFF'                                   
*                                  YES - LOAD LAST BUCKET TO FORCE              
*                                     OUTPUT OF THIS RECORD                     
*   NOTE:  THIS IS A DANGEROUS THING, BECAUSE THE VERY LAST BUCKET              
*        MAY BE USED BY REAL DATA.  IT IS ADVISABLE THAT FORECAST               
*        REPORTS LEAVE THE LAST BUCKET EMPTY.                                   
*                                                                               
         B     CC190                                                            
*                                                                               
CC144    EQU   *                                                                
         L     RE,ACONSPEC         IS CONTRACT 'PENDING'?                       
         CLI   CSPENDNG(RE),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    CC144A              YES - PROCESS                                
         CLI   CSPENDNG(RE),C'P'   NO  - 'PENDING/NEW SAR' ORDER?               
         BNE   CC110               NO  - FORCE AS BLANK COL                     
CC144A   EQU   *                                                                
         CLI   CSFRCAST(RE),C'Y'   IS CONTRACT 'FORECAST?'                      
         BNE   CC110               NO  - NOT 'TRUE FORECAST'                    
*                                     FORCE AS BLANK COLUMN                     
         SR    R1,R1               CLEAR ACCUMULATOR                            
**       TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
**       BO    CC190               YES                                          
         TM    NOPRIFLG,2          SKIP 2YR PRIOR DATA?                         
         BO    CC190               YES                                          
         L     R1,SKIPDATE+PRI2FORC(R4)    2YR PRI PENDING AS AT $$             
         L     RF,ACONSPEC         SET A(CONTRACT SPECIFIC)                     
*                                                                               
         TM    CSFRMISC(RF),X'10'  FORECAST/$0 EXPLICIT?                        
         BNO   CC190               NO  -                                        
         LA    RF,QWREQ3           SET A(REQUEST CARD 3)                        
         USING QREC3D,RF                                                        
         CLI   Q3FORCST,C'Y'       DISPLAY FORECAST REQUEST?                    
         BNE   CC190               NO                                           
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVC   BFREC+RGLSTDTA(4),=X'FFFFFFFF'                                   
*                                  YES - LOAD LAST BUCKET TO FORCE              
*                                     OUTPUT OF THIS RECORD                     
*   NOTE:  THIS IS A DANGEROUS THING, BECAUSE THE VERY LAST BUCKET              
*        MAY BE USED BY REAL DATA.  IT IS ADVISABLE THAT FORECAST               
*        REPORTS LEAVE THE LAST BUCKET EMPTY.                                   
*                                                                               
         B     CC190                                                            
*                                                                               
CC145    EQU   *                                                                
         L     RE,ACONSPEC         IS CONTRACT 'PENDING'?                       
         CLI   CSPENDNG(RE),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    CC145A              YES - PROCESS                                
         CLI   CSPENDNG(RE),C'P'   NO  - 'PENDING/NEW SAR' ORDER?               
         BNE   CC110               NO  - FORCE AS BLANK COL                     
CC145A   EQU   *                                                                
         CLI   CSFRCAST(RE),C'Y'   IS CONTRACT 'FORECAST?'                      
         BE    CC110               YES - NOT 'TRUE PENDING'                     
*                                     FORCE AS BLANK COLUMN                     
*                                                                               
         ST    R3,ACPMKFLD         A(CURRENT BUFF FIELD)                        
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSSHGOAL(RE)     SHARE GOAL FROM SAR ELT                      
         ST    R1,SHRGOAL          SAVE SHARE GOAL                              
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         L     R1,SKIPDATE+CURRFORC(R4)    CURRENT PENDING  AS AT               
*                                            TO BE USED TO CALCULATE            
*                                            CURR MKT $$ FOR PERIOD             
*                                                                               
*   TEST                                                                        
*        L     RE,ACONSPEC         IS CONTRACT 'PENDING'?                       
*        MVC   P+1(08),=C'CSPENDNG'                                             
*        MVC   P+10(4),CSPENDNG(RE)                                             
*        MVC   P+16(4),SKIPDATE+CURRFORC(R4)                                    
*        GOTO1 REPORT                                                           
*   TEST                                                                        
*                                                                               
         B     CC190                                                            
*                                                                               
CC146    EQU   *                                                                
         L     RE,ACONSPEC         IS CONTRACT 'PENDING'?                       
         CLI   CSPENDNG(RE),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    CC146A              YES - PROCESS                                
         CLI   CSPENDNG(RE),C'P'   NO  - 'PENDING/NEW SAR' ORDER?               
         BNE   CC110               NO  - FORCE AS BLANK COL                     
CC146A   EQU   *                                                                
         CLI   CSFRCAST(RE),C'Y'   IS CONTRACT 'FORECAST?'                      
         BE    CC110               YES - NOT 'TRUE PENDING'                     
*                                     FORCE AS BLANK COLUMN                     
*                                                                               
         ST    R3,APPMKFLD         A(PRIOR   BUFF FIELD)                        
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSSHGOAL(RE)     SHARE GOAL FROM SAR ELT                      
         ST    R1,SHRGOAL          SAVE SHARE GOAL                              
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+PRIOFORC(R4)    PRIOR   PENDING  AS AT               
*                                            TO BE USED TO CALCULATE            
*                                            CURR MKT $$ FOR PERIOD             
         B     CC190                                                            
*                                                                               
CC147    EQU   *                                                                
         L     RE,ACONSPEC         IS CONTRACT 'PENDING'?                       
         CLI   CSPENDNG(RE),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    CC147A              YES - PROCESS                                
         CLI   CSPENDNG(RE),C'P'   NO  - 'PENDING/NEW SAR' ORDER?               
         BNE   CC110               NO  - FORCE AS BLANK COL                     
CC147A   EQU   *                                                                
         CLI   CSFRCAST(RE),C'Y'   IS CONTRACT 'FORECAST?'                      
         BNE   CC110               NO  - NOT 'TRUE FORECAST'                    
*                                     FORCE AS BLANK COLUMN                     
*                                                                               
         ST    R3,ACFMKFLD         A(CURRENT BUFF FIELD)                        
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSSHGOAL(RE)     SHARE GOAL FROM SAR ELT                      
         ST    R1,SHRGOAL          SAVE SHARE GOAL                              
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         L     R1,SKIPDATE+CURRFORC(R4)    CURRENT FORECAST AS AT               
*                                            TO BE USED TO CALCULATE            
*                                            CURR MKT $$ FOR PERIOD             
         B     CC190                                                            
*                                                                               
CC148    EQU   *                                                                
         L     RE,ACONSPEC         IS CONTRACT 'PENDING'?                       
         CLI   CSPENDNG(RE),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    CC148A              YES - PROCESS                                
         CLI   CSPENDNG(RE),C'P'   NO  - 'PENDING/NEW SAR' ORDER?               
         BNE   CC110               NO  - FORCE AS BLANK COL                     
CC148A   EQU   *                                                                
         CLI   CSFRCAST(RE),C'Y'   IS CONTRACT 'FORECAST?'                      
         BNE   CC110               NO  - NOT 'TRUE FORECAST'                    
*                                     FORCE AS BLANK COLUMN                     
*                                                                               
         ST    R3,APFMKFLD         A(PRIOR   BUFF FIELD)                        
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSSHGOAL(RE)     SHARE GOAL FROM SAR ELT                      
         ST    R1,SHRGOAL          SAVE SHARE GOAL                              
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+PRIOFORC(R4)    PRIOR   PENDING  AS AT               
*                                            TO BE USED TO CALCULATE            
*                                            CURR MKT $$ FOR PERIOD             
         B     CC190                                                            
*                                                                               
CC149    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+THPRWKOR(R4)    THIS WEEK PRIOR ORD                  
         B     CC190                                                            
*                                                                               
CC150    EQU   *                   SPL AS-RUN THIS WEEK                         
         MVI   THSWKFLG,C'Y'       SET SPL AS RUN THIS WEEK FLAG                
         OC    RPAGGSPL,RPAGGSPL   SPL AS-RUN SPEC?                             
         BZ    CC310               NO  - TREAT AS BLANK COLUMN                  
*                                  YES                                          
*                                  BASED ON THIS WEEK LAST YEAR                 
*                                     BOOKED FIGURES                            
*                                     DISREGARDING AS-AT DATES                  
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+THPRWKOR(R4)   (THIS WEEK LAST YR ORDERED)           
         B     CC220               GO TO COMMON ROUTINE                         
*                                                                               
CC151    EQU   *                   SPL % FOR REP'D STATION                      
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSSPLPER(RE)     GET SPL PCT FOR CONTRACT                     
         B     CC205               DON'T ACCUMULATE THIS DATA                   
*                                                                               
CC152    EQU   *                   SPL LOSS FOR REP'D STATION                   
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     R1,CSSPLLSS(RE)     GET SPL LOSS FOR CONTRACT                    
         SR    R0,R0               DECIMAL ALIGN:  ADD PENNIES                  
         M     R0,=F'100'          MULTIPLY BY 100                              
         B     CC205               DON'T ACCUMULATE THIS DATA                   
*                                                                               
CC153    EQU   *                   SPL DOLLARS FROM SPL ELEMENT                 
         L     R1,SKIPDATE+TOTORD(R4)                                           
*                                  CURRENT BOOKED FOR REPORT PERIOD             
         B     CC190                                                            
*                                                                               
CC154    EQU   *                   SPL MKT DOLLARS FROM SPL ELEMENT             
         L     R5,SKIPDATE+TOTORD(R4)                                           
*                                  CURRENT BOOKED FOR REPORT PERIOD             
         GOTO1 =A(SPLMKT$$),DMCB,(R3),(R5)                                      
*                                  R3 = A(COLUMN IN ARRAY)                      
*                                  R5 = CURRENT BOOKED $$                       
         B     CC210               GO FOR NEXT BUCKET                           
*                                                                               
CC155    EQU   *                   GROSS SPL $$ FROM SPL ELEMENT                
*                                  NO ACTIVITY AT THIS LEVEL                    
*                                    DROPS INTO NEXT ROUTINE                    
*                                                                               
CC156    EQU   *                   GROSS SPL MKT $$ FROM SPL ELEMENT            
         B     CC110               TREAT AS BLANK COLUMN FOR NOW                
*                                                                               
CC157    EQU   *                   SPL AS-RUN CURRENT/MAIN CARD                 
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC220               YES                                          
*                                  BASED ON CURRENT BOOKED FIGURES              
         L     R1,SKIPDATE+TOTORD(R4)                                           
         B     CC220               GO TO COMMON ROUTINE                         
*                                                                               
CC158    EQU   *                   SPL AS-RUN PRIOR                             
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC220               YES                                          
         L     R1,SKIPDATE+PRTOTORD(R4)                                         
*                                  BASED ON PRIOR BOOKED FIGURES                
*                                     DISREGARDING AS-AT DATES                  
         B     CC220               GO TO COMMON ROUTINE                         
*                                                                               
CC159    EQU   *                   SPL AS-RUN THIS WEEK                         
         MVI   THSWKFLG,C'Y'       SET SPL AS RUN THIS WEEK FLAG                
*                                  BASED ON THIS WEEK BOOKED FIGURES            
*                                     DISREGARDING AS-AT DATES                  
         L     R1,SKIPDATE+THISWKOR(R4)   (THIS WEEK ORDERED)                   
         B     CC220               GO TO COMMON ROUTINE                         
*                                                                               
*  BEST $:  CONFIRMED ORDERS ONLY                                               
*                                                                               
CC160    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         L     RF,ACONSPEC         YES - SET A(CONTRACT SPECIFIC)               
*                                                                               
         TM    CSFRMISC(RF),X'20'  IS ORDER CONFIRMED?                          
         BNO   CC190               NO  - TREAT A $0                             
*                                  YES - INCLUDE CONF $$                        
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190               DON'T INCLUDE: DR PAST CUTOFF                
*                                                                               
         L     R1,SKIPDATE+TOTORD(R4)      CURRENT AS AT ESTIMATE               
         TM    6(R4),X'01'                 TEST: CURR AS AT INV?                
         BZ    *+8                         NO  - USE ESTIMATE                   
         L     R1,SKIPDATE+CUASATIN(R4)    YES - USE CURR AS AT INV             
         B     CC190                                                            
*                                                                               
*  BEST $:  UNCONFIRMED ORDERS ONLY                                             
*                                                                               
CC161    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         L     RF,ACONSPEC         YES - SET A(CONTRACT SPECIFIC)               
*                                                                               
         TM    CSFRMISC(RF),X'20'  IS ORDER CONFIRMED?                          
         BO    CC190               YES - TREAT AS $0                            
*                                  NO  - INCLUDE UNCONFIRMED $$                 
         L     R1,SKIPDATE+TOTORD(R4)      CURRENT AS AT ESTIMATE               
         TM    6(R4),X'01'                 TEST: CURR AS AT INV?                
         BZ    *+8                         NO  - USE ESTIMATE                   
         L     R1,SKIPDATE+CUASATIN(R4)    YES - USE CURR AS AT INV             
         B     CC190                                                            
*                                                                               
*  BEST $:  UPCOMING DIRECT RESPONSE $$                                         
*        THERE WILL NEVER BE INVOICED DOLLARS FOR THIS FIELD,                   
*        BECAUSE ITS EXISTENCE IS ONLY IN THE FUTURE.                           
*                                                                               
CC162    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
*                                                                               
*   TEST                                                                        
*        LA    RF,QWREQ3                                                        
*        USING QREC3D,RF                                                        
*                                                                               
*        MVC   P+1(27),=C'PROF/TYPE/CURDATE/COFF/'                              
*        MVC   P+32(1),RREPPROF+8  INSERT REP PROFILE                           
*        MVC   P+34(1),RCONTYPE                                                 
*        MVC   WORK+48(2),CURDATE(R4)                                           
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+36)                                 
*        MVC   WORK+48(2),QWDRCOFF                                              
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+46)                                 
*        GOTO1 REPORT                                                           
*        XC    WORK+48(12),WORK+48                                              
*        DROP  RF                                                               
*   TEST END                                                                    
*                                                                               
*                                                                               
*                                                                               
         CLC   RCONTYPE,RREPPROF+8 CONTYPE = DIRECT RESPONSE?                   
*                                     STORED IN REP PROFILE POS # 9             
         BNE   CC190               NO  - TREAT AS $ZERO                         
         CLC   CURDATE(2,R4),QWDRCOFF                                           
*                                  YES - PRIOR TO CUTOFF DATE?                  
         BL    CC190               YES - NOT UPCOMING:  DON'T USE IT            
*                                                                               
         L     RF,ACONSPEC         SET A(CONTRACT SPECIFIC)                     
*                                                                               
         TM    CSFRMISC(RF),X'20'  IS ORDER CONFIRMED?                          
         BNO   CC190               NO  - TREAT AS $0                            
*                                  YES - INCLUDE CONFIRMED $$                   
         L     R1,SKIPDATE+TOTORD(R4)      CURRENT AS AT ESTIMATE               
         TM    6(R4),X'01'                 TEST: CURR AS AT INV?                
         BZ    *+8                         NO  - USE ESTIMATE                   
         L     R1,SKIPDATE+CUASATIN(R4)    YES - USE CURR AS AT INV             
         B     CC190                                                            
*                                                                               
CC163    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         L     RF,ACONSPEC         YES - SET A(CONTRACT SPECIFIC)               
*                                                                               
         TM    CSFRMISC(RF),X'20'  IS ORDER CONFIRMED?                          
         BNO   CC190               NO  - TREAT A $0                             
*                                  YES - INCLUDE CONF $$                        
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+THISWKOR(R4)    THIS WEEK ORDERED                    
         B     CC190                                                            
*                                                                               
CC164    EQU   *                   PRIOR ACTUALS/CONFIRMED ONLY                 
         SR    R1,R1                                                            
         L     RF,ACONSPEC         YES - SET A(CONTRACT SPECIFIC)               
*                                                                               
         TM    CSFRMISC(RF),X'20'  IS ORDER CONFIRMED?                          
         BNO   CC190               NO  - TREAT A $0                             
*                                  YES - INCLUDE CONF $$                        
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+PRTOTINV(R4)    PRIOR TOTAL INVOICE                  
         TM    6(R4),X'02'                 TEST: ANY PRIOR INVOICES             
         BO    *+8                         YES - USE INVOICE                    
         L     R1,SKIPDATE+PRTOTORD(R4)    NONE - USE PRIOR TOT EST             
         B     CC190                                                            
*                                                                               
CC165    EQU   *                                                                
         SR    R1,R1                                                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+NXTOTINV(R4)    PRIOR TOTAL INVOICE                  
         TM    FLAG7(R4),X'80'             TEST: ANY NEXT YR INVS               
         BO    *+8                         YES - USE INVOICE                    
         L     R1,SKIPDATE+NEXTOTOR(R4)    NONE - USE PRIOR TOT EST             
         B     CC190                                                            
*                                                                               
CC166    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP NEXT YR DATA?                           
         BE    CC190               YES                                          
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+NEXTOTOR(R4)    NEXT YR BOOKED                       
         B     CC190                                                            
*                                                                               
CC167    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP NEXT YR DATA?                           
         BE    CC190               YES                                          
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+NXASATIN(R4)    BILLED:  NEXT YR YEAR                
         B     CC190                                                            
*                                                                               
CC168    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+THP2WKOR(R4)    THIS WEEK 2YRS PRIOR ORD             
         B     CC190                                                            
*                                                                               
CC169    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         L     RF,ACONSPEC                                                      
         CLI   CSFRCAST(RF),C'Y'   IS CONTRACT 'FORECAST?'                      
         BNE   CC190               NO  - ONLY 'TRUE FCST' ARE TO FORCE          
         L     R1,=F'50000'        INSERT VALUE TO FORCE ROW TO PRINT           
         B     CC190                                                            
***NEW TRADE CC'S***                                                            
*                                                                               
CC170    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TRTOTORD(R4)    CURRENT AS AT ESTIMATE               
         TM    7(R4),X'10'                 TEST: CURR AS AT INV?                
         BZ    *+8                         NO  - USE ESTIMATE                   
         L     R1,SKIPDATE+TRCUAAIN(R4)    YES - USE CURR AS AT INV             
         B     CC190                                                            
*                                                                               
CC171    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         BAS   RE,CCCUTOFP         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFP         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TRPRAAIN(R4)    PRIOR AS AT INVOICE                  
         TM    7(R4),X'04'                 TEST: PRIOR AS AT INV                
         BO    *+8                         YES - USE INVOICE                    
         L     R1,SKIPDATE+TRPRAAOR(R4)    NO  - USE PRIOR AS AT EST            
         B     CC190                                                            
*                                                                               
CC172    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         L     R1,SKIPDATE+TRCUAAIN(R4)    CURRENT AS AT INVOICE                
         B     CC190                                                            
*                                                                               
CC173    EQU   *                                                                
         SR    R1,R1                                                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+TRPRTOTI(R4)    PRIOR TOTAL INVOICE                  
         TM    7(R4),X'08'                 TEST: ANY PRIOR INVOICES             
         BO    *+8                         YES - USE INVOICE                    
         L     R1,SKIPDATE+TRPRTOTO(R4)    NONE - USE PRIOR TOT EST             
         B     CC190                                                            
*                                                                               
CC174    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TRTOTORD(R4)    CURRENT BOOKED                       
         B     CC190                                                            
*                                                                               
CC175    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         BAS   RE,CCCUTOFP         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFP         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TRPRAAOR(R4)    PRIOR BOOKED                         
         B     CC190                                                            
*                                                                               
CC176    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TRTHWKOR(R4)    THIS WEEK ORDERED                    
         B     CC190                                                            
*                                                                               
CC177    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TRLSWKOR(R4)    LAST WEEK ORDERED                    
         B     CC190                                                            
*                                                                               
CC178    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TRCUAAIN(R4)    BILLED:  CURRENT YEAR                
         B     CC190                                                            
*                                                                               
CC179    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         BAS   RE,CCCUTOFP         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFP         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TRPRAAIN(R4)    BILLED:  PRIOR   YEAR                
         B     CC190                                                            
*                                                                               
CC180    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TRTOTORD(R4)    USE TOTAL ORDERED                    
         B     CC190                                                            
*                                                                               
CC181    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         BAS   RE,CCCUTOFP         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFP         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TRPRTOTO(R4)    USE PRIOR TOT ORDERED                
         B     CC190                                                            
*                                                                               
CC182    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         L     RF,ACONSPEC         YES - SET A(CONTRACT SPECIFIC)               
*                                                                               
         TM    CSFRMISC(RF),X'20'  IS ORDER CONFIRMED?                          
         BNO   CC190               NO  - TREAT A $0                             
*                                  YES - INCLUDE CONF $$                        
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190               DON'T INCLUDE: DR PAST CUTOFF                
*                                                                               
         L     R1,SKIPDATE+TRTOTORD(R4)    CURRENT AS AT ESTIMATE               
         TM    7(R4),X'10'                 TEST: CURR AS AT INV?                
         BZ    *+8                         NO  - USE ESTIMATE                   
         L     R1,SKIPDATE+TRCUAAIN(R4)    YES - USE CURR AS AT INV             
         B     CC190                                                            
*                                                                               
*  BEST $:  UNCONFIRMED ORDERS ONLY                                             
*                                                                               
CC183    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         L     RF,ACONSPEC         YES - SET A(CONTRACT SPECIFIC)               
*                                                                               
         TM    CSFRMISC(RF),X'20'  IS ORDER CONFIRMED?                          
         BO    CC190               YES - TREAT AS $0                            
*                                  NO  - INCLUDE UNCONFIRMED $$                 
         L     R1,SKIPDATE+TRTOTORD(R4)    CURRENT AS AT ESTIMATE               
         TM    7(R4),X'10'                 TEST: CURR AS AT INV?                
         BZ    *+8                         NO  - USE ESTIMATE                   
         L     R1,SKIPDATE+TRCUAAIN(R4)    YES - USE CURR AS AT INV             
         B     CC190                                                            
*                                                                               
*  BEST $:  UPCOMING DIRECT RESPONSE $$                                         
*        THERE WILL NEVER BE INVOICED DOLLARS FOR THIS FIELD,                   
*        BECAUSE ITS EXISTENCE IS ONLY IN THE FUTURE.                           
*                                                                               
CC184    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         L     RF,ACONSPEC         YES - SET A(CONTRACT SPECIFIC)               
*                                                                               
         TM    CSFRMISC(RF),X'20'  IS ORDER CONFIRMED?                          
         BNO   CC190               NO  - TREAT A $0                             
*                                  YES - INCLUDE CONF $$                        
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+TRTHWKOR(R4)    THIS WEEK ORDERED                    
         B     CC190                                                            
*                                                                               
CC185    EQU   *                   PRIOR ACTUALS/CONFIRMED ONLY                 
         SR    R1,R1                                                            
         L     RF,ACONSPEC         YES - SET A(CONTRACT SPECIFIC)               
*                                                                               
         TM    CSFRMISC(RF),X'20'  IS ORDER CONFIRMED?                          
         BNO   CC190               NO  - TREAT A $0                             
*                                  YES - INCLUDE CONF $$                        
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         L     R1,SKIPDATE+TRPRTOTI(R4)    PRIOR TOTAL INVOICE                  
         TM    7(R4),X'08'                 TEST: ANY PRIOR INVOICES             
         BO    *+8                         YES - USE INVOICE                    
         L     R1,SKIPDATE+TRPRTOTO(R4)    NONE - USE PRIOR TOT EST             
         B     CC190                                                            
*                                                                               
CC186    EQU   *                                                                
*                                                                               
*   TEST                                                                        
***      GOTO1 =V(PRNTBL),DMCB,0,(R4),C'DUMP',192,=C'2D'                        
*   TEST                                                                        
*                                                                               
         SR    R1,R1               CLEAR ACCUMULATOR                            
         CLI   NOCURFLG,1          SKIP CURRENT DATA?                           
         BE    CC190               YES                                          
         BAS   RE,CCCUTOFF         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFF         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+SPTSCUR(R4)     SPOTS:  CURRENT                      
         MH    R1,=H'100'          MULTIPLY BY 100:                             
*                                  THINKS THIS IS $ AND THEN ROUNDS!            
         B     CC190                                                            
*                                                                               
CC187    EQU   *                                                                
         SR    R1,R1               CLEAR ACCUMULATOR                            
         TM    NOPRIFLG,1          SKIP PRIOR DATA?                             
         BO    CC190               YES                                          
         BAS   RE,CCCUTOFP         TEST FOR DR CUTOFF                           
         BNZ   CC190                                                            
         BAS   RE,PPCUTOFP         TEST FOR PP CUTOFF                           
         BNZ   CC190                                                            
         L     R1,SKIPDATE+SPTSPRI(R4)     SPOTS:  PRIOR                        
         MH    R1,=H'100'          MULTIPLY BY 100:                             
*                                  THINKS THIS IS $ AND THEN ROUNDS!            
         B     CC190                                                            
*                                                                               
CC188    EQU   *                                                                
         SR    R1,R1                                                            
         TM    NOPRIFLG,2          SKIP 2YR PRIOR DATA?                         
         BO    CC190               YES                                          
         L     R1,SKIPDATE+SPTS2YR(R4)     SPOTS: 2 YEAR PRIOR                  
         MH    R1,=H'100'          MULTIPLY BY 100:                             
         B     CC190                                                            
*                                  THINKS THIS IS $ AND THEN ROUNDS!            
*                                                                               
***NEW TRADE CC'S***                                                            
*                                                                               
CC190    TM    0(R6),X'80'         TEST TO APPLY COMMISSION                     
         BZ    CC200               NO                                           
         ST    RC,DMCB             PASS RC TO RESET A(WORKSPACE)                
*                                     DON'T USE ARGUMENT LIST!!  IT             
*                                     CLOBBERS $$ VALUE IN PROCESS              
         GOTO1 =A(COMCON)          YES  -                                       
         L     R1,FULL             R1=COMMISSION                                
*                                                                               
CC200    LTR   RF,R1                                                            
         BZ    CC210                                                            
         A     RF,0(R3)            ACCUMULATE PENNIES TO COL                    
         ST    RF,0(R3)                                                         
         TM    RPFLAGS,X'06'       TEST FOR RANK RPT AND 'MONTH' ROW            
         BNO   CC210                                                            
         LA    R3,RGRECLEN(R3)     YES- ACCUMULATE ALL TO TOTAL MONTH           
         A     R1,0(R3)                 IN COPY RECORD                          
         ST    R1,0(R3)                                                         
         B     CC210                                                            
*                                                                               
*   NOTE:  FOR CONTRACT-SPECIFIC FIELDS, THE VALUE WILL BE EXTRACTED            
*     FOR EACH LOOP.  SO THAT IT IS NOT ACCUMULATED, BUT RATHER JUST            
*     STORED, ALL CONTRACT-SPECIFIC FIELDS TRANSFER HERE.                       
*                                                                               
CC205    EQU   *                                                                
         LTR   RF,R1                                                            
         BZ    CC210                                                            
         ST    RF,0(R3)                                                         
         TM    RPFLAGS,X'06'       TEST FOR RANK RPT AND 'MONTH' ROW            
         BNO   CC210                                                            
         LA    R3,RGRECLEN(R3)     YES- ACCUMULATE ALL TO TOTAL MONTH           
         ST    R1,0(R3)                                                         
*                                                                               
CC210    EQU   *                                                                
*                                                                               
*   TEST                                                                        
***      CLC   =X'02704730',RCONKCON                                            
***      BNE   CC210TST                                                         
***      LTR   R1,R1                                                            
***      MVC   P+1(05),=C'CC210'                                                
***      GOTO1 REPORT                                                           
CC210TST EQU   *                                                                
*   TEST END                                                                    
*                                                                               
         LA    R5,1(R5)                                                         
         CH    R5,=Y(RGCOLMAX)                                                  
         BH    CC300                                                            
*                                                                               
*   TEST                                                                        
***      CLC   =X'02704730',RCONKCON                                            
***      BNE   CC210TS2                                                         
***      LTR   R1,R1                                                            
***      MVC   P+1(14),=C'CC210 NEXT COL'                                       
***      GOTO1 REPORT                                                           
CC210TS2 EQU   *                                                                
*   TEST END                                                                    
*                                                                               
         LA    R6,7(R6)            NEXT COL                                     
         B     CC050                                                            
         EJECT                                                                  
*                                                                               
*   DIRECT RESPONSE CUTOFF TESTING:                                             
*        1.  IF NOT DR CUTOFF OPTIONED REP, EXIT CC = ZERO                      
*        2.  IF ORDER NOT CONTYPE 'Z' (DIR RESP), EXIT CC = ZERO                
*        3.  IF CURDATE(R4) LESS THAN DR CUTOFF DATE, EXIT CC = ZERO            
*            IE: CURDATE = 9512  DR CUTOFF 9601:  USE DATA                      
*            IE: CURDATE = 9512  DR CUTOFF 9512:  DON'T USE DATA                
*                                                                               
CCCUTOFF NTR1                                                                   
         LA    RF,QWREQ3                                                        
         USING QREC3D,RF                                                        
*                                                                               
*   TEST                                                                        
*        MVC   P+1(27),=C'REQ/PROF/TYPE/CURDATE/COFF/'                          
*        MVC   P+30(1),Q3DIRRES    INSERT REQUEST CARD OPTION                   
*        MVC   P+32(1),RREPPROF+8  INSERT REP PROFILE                           
*        MVC   P+34(1),RCONTYPE                                                 
*        MVC   WORK+48(2),CURDATE(R4)                                           
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+36)                                 
*        MVC   WORK+48(2),QWDRCOFF                                              
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+46)                                 
*        GOTO1 REPORT                                                           
*        XC    WORK+48(12),WORK+48                                              
*        LA    RF,QWREQ3           RESET A(REQUEST CARD 3)                      
*   TEST END                                                                    
*                                                                               
         CLI   Q3DIRRES,C'Y'       EXCLUDE DIRECT RESPONSE?                     
*                                                                               
         DROP  RF                                                               
*                                                                               
         BNE   CCCU0400            NO  - EXIT CC = ZERO                         
         CLC   RCONTYPE,RREPPROF+8 YES - CONTYPE = DIRECT RESPONSE?             
*                                     STORED IN REP PROFILE POS # 9             
         BNE   CCCU0400            NO  - EXIT CC = ZERO                         
         CLC   CURDATE(2,R4),QWDRCOFF                                           
*                                  YES - PRIOR TO CUTOFF DATE?                  
         BL    CCCU0400            YES - EXIT CC = ZERO                         
         LTR   RB,RB               NO  - SET CC NOT ZERO                        
*                                     DON'T USE DATA                            
         B     CCCU0600                                                         
CCCU0400 EQU   *                                                                
         SR    R0,R0                                                            
CCCU0600 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*   DIRECT RESPONSE:  PRIOR YEAR                                                
*                                                                               
CCCUTOFP NTR1                                                                   
         LA    RF,QWREQ3                                                        
         USING QREC3D,RF                                                        
*                                                                               
*   TEST                                                                        
*        MVC   P+1(27),=C'REQ/PROF/TYPE/CURDATE/COFF/'                          
*        MVC   P+30(1),Q3DIRRES    INSERT REQUEST CARD OPTION                   
*        MVC   P+32(1),RREPPROF+8  INSERT REP PROFILE                           
*        MVC   P+34(1),RCONTYPE                                                 
*        MVC   WORK+48(2),CURDATE(R4)                                           
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+36)                                 
*        MVC   WORK+48(2),QWDRCOFP                                              
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+46)                                 
*        GOTO1 REPORT                                                           
*        XC    WORK+48(12),WORK+48                                              
*        LA    RF,QWREQ3           RESET A(REQUEST CARD 3)                      
*   TEST END                                                                    
*                                                                               
         CLI   Q3DIRRES,C'Y'       EXCLUDE DIRECT RESPONSE?                     
*                                                                               
         DROP  RF                                                               
*                                                                               
         BNE   CCCP0400            NO  - EXIT CC = ZERO                         
         CLC   RCONTYPE,RREPPROF+8 YES - CONTYPE = DIRECT RESPONSE?             
*                                     STORED IN REP PROFILE POS # 9             
         BNE   CCCP0400            NO  - EXIT CC = ZERO                         
         CLC   PRIDATE(2,R4),QWDRCOFP                                           
*                                  YES - PRIOR TO CUTOFF DATE?                  
         BL    CCCP0400            YES - EXIT CC = ZERO                         
         LTR   RB,RB               NO  - SET CC NOT ZERO                        
*                                     DON'T USE DATA                            
         B     CCCP0600                                                         
CCCP0400 EQU   *                                                                
         SR    R0,R0                                                            
CCCP0600 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*   PAID PROGRAMMING CUTOFF TESTING:                                            
*        1.  IF NOT PP CUTOFF OPTIONED REP, EXIT CC = ZERO                      
*        2.  IF ORDER NOT CONTYPE 'Z' (PAID PRO), EXIT CC = ZERO                
*        3.  IF CURDATE(R4) LESS THAN PP CUTOFF DATE, EXIT CC = ZERO            
*            IE: CURDATE = 9512  PP CUTOFF 9601:  USE DATA                      
*            IE: CURDATE = 9512  PP CUTOFF 9512:  DON'T USE DATA                
*                                                                               
PPCUTOFF NTR1                                                                   
         LA    RF,QWREQ3                                                        
         USING QREC3D,RF                                                        
*                                                                               
*   TEST                                                                        
*        MVC   P+1(27),=C'REQ/PROF/TYPE/CURDATE/COFF/'                          
*        MVC   P+30(1),Q3PAYPRO    INSERT REQUEST CARD OPTION                   
*        MVC   P+32(1),RREPPROF+9  INSERT REP PROFILE                           
*        MVC   P+34(1),RCONTYPE                                                 
*        MVC   WORK+48(2),CURDATE(R4)                                           
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+36)                                 
*        MVC   WORK+48(2),QWDRCOFF                                              
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+46)                                 
*        GOTO1 REPORT                                                           
*        XC    WORK+48(12),WORK+48                                              
*        LA    RF,QWREQ3           RESET A(REQUEST CARD 3)                      
*   TEST END                                                                    
*                                                                               
         CLI   Q3PAYPRO,C'Y'       EXCLUDE DIRECT RESPONSE?                     
*                                                                               
         DROP  RF                                                               
*                                                                               
         BNE   PPCU0400            NO  - EXIT CC = ZERO                         
         CLC   RCONTYPE,RREPPROF+9 YES - CONTYPE = PAID PROGRAMMING?            
*                                     STORED IN REP PROFILE POS # 10            
         BNE   PPCU0400            NO  - EXIT CC = ZERO                         
         CLC   CURDATE(2,R4),QWDRCOFF                                           
*                                  YES - PRIOR TO CUTOFF DATE?                  
         BL    PPCU0400            YES - EXIT CC = ZERO                         
         LTR   RB,RB               NO  - SET CC NOT ZERO                        
*                                     DON'T USE DATA                            
         B     PPCU0600                                                         
PPCU0400 EQU   *                                                                
         SR    R0,R0                                                            
PPCU0600 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*   PAID PROGRAMMING:  PRIOR YEAR                                               
*                                                                               
PPCUTOFP NTR1                                                                   
         LA    RF,QWREQ3                                                        
         USING QREC3D,RF                                                        
*                                                                               
*   TEST                                                                        
*        MVC   P+1(27),=C'REQ/PROF/TYPE/CURDATE/COFF/'                          
*        MVC   P+30(1),Q3PAYPRO    INSERT REQUEST CARD OPTION                   
*        MVC   P+32(1),RREPPROF+9  INSERT REP PROFILE                           
*        MVC   P+34(1),RCONTYPE                                                 
*        MVC   WORK+48(2),PRIDATE(R4)                                           
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+36)                                 
*        MVC   WORK+48(2),QWDRCOFP                                              
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+46)                                 
*        GOTO1 REPORT                                                           
*        XC    WORK+48(12),WORK+48                                              
*        LA    RF,QWREQ3           RESET A(REQUEST CARD 3)                      
*   TEST END                                                                    
*                                                                               
         CLI   Q3PAYPRO,C'Y'       EXCLUDE DIRECT RESPONSE?                     
*                                                                               
         DROP  RF                                                               
*                                                                               
         BNE   PPCP0400            NO  - EXIT CC = ZERO                         
         CLC   RCONTYPE,RREPPROF+9 YES - CONTYPE = DIRECT RESPONSE?             
*                                     STORED IN REP PROFILE POS # 10            
         BNE   PPCP0400            NO  - EXIT CC = ZERO                         
         CLC   PRIDATE(2,R4),QWDRCOFP                                           
*                                  YES - PRIOR TO CUTOFF DATE?                  
         BL    PPCP0400            YES - EXIT CC = ZERO                         
         LTR   RB,RB               NO  - SET CC NOT ZERO                        
*                                     DON'T USE DATA                            
         B     PPCP0600                                                         
PPCP0400 EQU   *                                                                
         SR    R0,R0                                                            
PPCP0600 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*   SPL CALCULATIONS:                                                           
*   WHEN CONTRACT IS A 'WIN':                                                   
*        MONTHLY AMOUNT IS PASSED IN R1.  THE SPL PERCENT IS                    
*        IN THE CONTRACT SPECIFIC AREA.   TO CALCULATE THE TOTAL                
*        MARKET $$ FOR THE PERIOD:  MONTHLY AMOUNT/SPL PERCENT.                 
*        THE RESULT IS THEN ADDED TO THE NEXT COLUMN, WHICH MUST                
*        HAVE BEEN SPECIFIED AS BLANK TO ENSURE ITS AVAILABILITY.               
*      ADDITIONALLY, A 'WIN' MAY BE A CREDIT:  NEGATIVE DOLLARS IN              
*        R1.  IN SUCH A CASE, R1 WILL BE SET TO ZERO, AND RESULTS               
*        PASSED FORWARD.                                                        
*                                                                               
*   WHEN CONTRACT IS A 'LOSS':                                                  
*        THERE WILL BE NO VALUE IN R1.  THE SPL PERCENT IN THE                  
*        CONTRACT SPECIFIC AREA WILL CONTAIN THE TOTAL MARKET BUDGET            
*        $$ RATHER THAN AN SPL PERCENT.  THIS VALUE IS TO BE ADDED              
*        TO THE TOTAL MARKET $$ FIGURE, WHICH WILL >>DECREASE<< THE             
*        SPL AS-RUN FIGURE.                                                     
*                                                                               
*        WHEN AMOUNT PASSED IN IS CURRENT FORECAST FOR SPL AS-RUN               
*        (ESTIMATED), THE CURR FORECAST VALUE IS PASSED IN, DESPITE             
*        THE FACT THAT THERE WILL BE !! NO !! SPL PCT FOR CONTRACT.             
*                                                                               
CC220    EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        ST    R1,FULL             SAVE TEMPORARILY                             
*        L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
*        L     RF,CSSPLPCT(RE)     GET SPL PCT FOR CONTRACT                     
*        MVC   P+1(12),=C'LOSS FLAG = '                                         
*        MVC   P+14(1),CSSPLOSS(RE)                                             
*        EDIT  (RF),(6,P+20)                                                    
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+42,4,=C'TOG'                              
*        GOTO1 REPORT                                                           
*        L     R1,FULL             RESTORE R1                                   
*   END TEST                                                                    
*                                                                               
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     RF,CSSPLPCT(RE)     GET SPL PCT FOR CONTRACT                     
*                                                                               
*   CSSPLOSS IS SET IN CONTRACT ANALYZER MODULE.  IT IS 'N' ONLY IF             
*      CONTRACT HAS AN SPL ELEMENT, AND REP'D STATION HAS A PERCENT             
*      OF THE ACTION.  IF SPL ELEMENT EXISTS, AND REP'D STATION HAS             
*      NO PERCENT, VALUE IS 'Y' (LOSS).  IF NO SPL ELEMENT, VALUE IS            
*      X'00'.                                                                   
*   ONE FURTHER NOTE:  MANY CONTRACTS WERE ENTERED WITH 0% FOR ALL              
*      STATIONS, AND THE ORDER HAS DOLLARS.  THIS IS REPORTED HERE              
*      AS 'NOT A LOSS', BUT RESULTS IN DRASTICALLY INFLATING THE                
*      CALCULATED SHARE, BY ADDING THE ORDER DOLLARS TO THE NUMERATOR,          
*      AND $0 (ORDER DOLLARS / 0%) TO THE DENOMINATOR OF THE CALC.              
*      SUCH ORDERS WILL BE TREATED SAME AS 'CREDITS' - THEY WILL NOT            
*      BE CONSIDERED IN THE CALCULATION.                                        
*                                                                               
         CLI   CSSPLOSS(RE),X'00'  SPL ENTERED FOR THIS ORDER?                  
         BE    CC210               NO  - GO GET NEXT BUCKET                     
         CLI   CSSPLOSS(RE),C'N'   SPL NOT A LOSS?                              
         BNE   CC250               NO  - LOSS OR NO SPL                         
         LTR   RF,RF               IT'S A WIN - ANY SPL PERCENT?                
         BZ    CC223               NO  - TREAT SAME AS CREDIT                   
         LTR   R1,R1               CHECK FOR 'CREDIT': NEGATIVE                 
         BNM   CC225               NOT NEGATIVE: PROCEED                        
CC223    EQU   *                                                                
         SR    R1,R1               NEGATIVE: SET R1 TO ZERO                     
         B     CC227                                                            
CC225    EQU   *                                                                
         ST    RF,STORERF          SAVE VALUE OF RF                             
         BAS   RE,CHEKSIZE         CHECK SIZE OF CALCULATION                    
         L     RF,STORERF          RESTORE RF VALUE BEFORE                      
*                                     CONDITIONAL TEST                          
         BZ    CC227               SIZE ACCEPTABLE                              
         SR    R1,R1               SIZE UNACCEPTABLE:  SET R1 TO ZERO           
         B     CC227                                                            
*                                                                               
*   CHEKSIZE:  SEE WHETHER MARKET $$ CALCULATION WILL OVERFLOW                  
*        REGISTER LIMITATIONS.  CALCULATION VIA 'PACKED' ARITHMETIC             
*        HAS ALSO BEEN TRIED, UNSUCCESSFULLY.                                   
*                                                                               
CHEKSIZE NTR1                                                                   
*                                                                               
*   TEST                                                                        
*        MVC   P+1(08),=C'PRESIZE:'                                             
*        EDIT  (R1),(12,P+10),2                                                 
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         L     RF,STORERF          RELOAD RF                                    
         SR    R0,R0                                                            
         DR    R0,RF               AMOUNT/PERCENT=MARKET $$                     
*                                                                               
*   TEST                                                                        
*        MVC   P+1(07),=C'RESULT:'                                              
*        EDIT  (R1),(12,P+10),2                                                 
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         C     R1,=F'107374'       MAX LIMIT BEFORE OVERFLOW                    
         BNH   CSIZ0080            ACCEPTED                                     
         LTR   RB,RB               SET CC NOT ZERO                              
         B     CSIZ0100                                                         
CSIZ0080 EQU   *                                                                
         SR    R0,R0               SET CC ZERO                                  
CSIZ0100 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
CC227    EQU   *                                                                
         LR    RE,R1                                                            
         A     RE,0(R3)                                                         
         ST    RE,0(R3)            SAVE MONTHLY DOLLARS                         
         SR    R0,R0                                                            
         M     R0,=F'10000'        MULT MONTHLY $ BY 10,000                     
*                                     PCT FIGURE IS XX.XX                       
         SLDA  R0,1                DOUBLE FOR ROUNDING                          
         LTR   R0,R0               VALUE NEEDS BOTH REGISTERS?                  
         BZ    CC228               NO  - PROCEED                                
*                                                                               
         C     RF,=F'100'          YES - CHECK DIVISOR SIGNIFICANCE             
         BNL   CC228               SIGNIFICANT ENOUGH TO PROCEED                
*                                     AT LEAST 1.00 PERCENT                     
         SR    RF,RF               NOT SIGNIFICANT: DON'T DIVIDE                
CC228    EQU   *                                                                
         AR    R1,RF               ADD PCT AMOUNT FOR ROUNDING                  
         LTR   RF,RF               ANY PERCENT?                                 
         BNZ   CC230               YES                                          
         SR    R1,R1               NO % = NO MARKET $$                          
         B     CC240                                                            
CC230    EQU   *                                                                
         DR    R0,RF               AMOUNT/PERCENT=MARKET $$                     
         SRA   R1,1                DIVIDE BY 2                                  
CC240    EQU   *                                                                
         A     R1,4(R3)            STORE AMOUNT IN BLANK BUCKET                 
         ST    R1,4(R3)            STORE IT BACK                                
         B     CC210               GO FOR NEXT BUCKET                           
*                                                                               
STORERF  DS    F                   SAVE VALUE IN RF                             
*                                                                               
CC250    EQU   *                   SPL WAS A LOSS                               
*                                                                               
*   A LOSS HAS BEEN IDENTIFIED.  CHECK TO ENSURE THAT THE                       
*      CONTRACT'S FLIGHT DATES FALL WITHIN THE REPORT PERIOD.                   
*                                                                               
         GOTO1 =A(FLITDATE),DMCB,(RC)  CALCULATE ORDER FLIGHT DATES             
*                                                                               
*   FIRST CHECK PRIOR PERIOD                                                    
*                                                                               
*                                                                               
*   TEST                                                                        
***      CLC   =X'02704730',RCONKCON                                            
***      BNE   CC050TST                                                         
***      LTR   R1,R1                                                            
***      MVC   P+1(05),=C'CC250'                                                
***      MVC   P+7(3),THREE                                                     
***      GOTO1 REPORT                                                           
CC250TST EQU   *                                                                
*   TEST END                                                                    
*                                                                               
         CLI   THREE+1,1           AS-RUN PRIOR?                                
         BNE   CC252               NO - CHECK CURRENT PERIOD                    
         MVI   THREE,0             CLEAR FLAG FOR LOSSCALC                      
         CLC   FLIGHTND,QWPRIST    FLIGHT ENDS BEFORE REP PERIOD?               
         BL    CC210               YES - CHECK CURRENT YEAR DATES               
         CLC   QWPRIND(2),FLIGHTST FLIGHT STARTS AFTER REP PERIOD?              
         BL    CC210               YES - CHECK CURRENT YEAR DATES               
         MVI   THREE,1             SET FLAG FOR LOSSCALC                        
         B     CC290               IN PRIOR YEAR: USE IT AS IS                  
CC252    EQU   *                   SPL WAS A LOSS                               
*                                                                               
*   THEN  CHECK CURRENT PERIOD                                                  
*                                                                               
         CLC   FLIGHTND,QWCURST    FLIGHT ENDS BEFORE REP PERIOD?               
         BL    CC210               YES - GO FOR NEXT BUCKET                     
         CLC   QWCURND(2),FLIGHTST FLIGHT STARTS AFTER REP PERIOD?              
         BL    CC210               YES - GO FOR NEXT BUCKET                     
CC254    EQU   *                   SPL WAS A LOSS                               
         CLI   THSWKFLG,C'Y'       SPL AS-RUN THIS WEEK?                        
         BNE   CC290               NO  - USE LOSS AS-IS                         
         MVI   THSWKFLG,C'N'       YES - TURN OFF FLAG                          
         LA    R1,RCONELEM         FIND TRUE ACTIV DATE ELT                     
CC255    EQU   *                                                                
         ZIC   R0,1(R1)            ELT LENGTH                                   
         AR    R1,R0               BUMP TO NEXT ELT                             
         CLI   0(R1),0             END OF RECORD?                               
         BE    CC290               YES - NO DATE - USE $$                       
         CLI   0(R1),X'08'         TRUE ACTIV DATE ELT?                         
         BNE   CC255               NO  - GO BACK FOR NEXT                       
         MVC   WORK(3),RCONACTA-RCONACEL(1)                                     
*                                  UNLOAD TRUE ACTIVITY DATE                    
         GOTO1 DATCON,DMCB,(3,WORK),(0,WORK+12)                                 
*                                  CONV 3-BYTE DATE TO EBCDIC YYMMDD            
*                                  TRUE DATE MUST BE SET TO MONDAY              
*                                     OF WEEK OF ACTIVITY                       
         GOTO1 GETDAY,DMCB,WORK+12,FULL                                         
*                                  GET DAY OF WEEK                              
         CLC   FULL(3),SPACES                                                   
         BNE   *+6                                                              
         DC    H'0'                                                             
         ZIC   RE,DMCB             DAY OF WEEK RETURNED                         
         BCTR  RE,R0               DECREMENT BY 1                               
         LNR   RE,RE               NEGATE FOR SUBTRACTION                       
         CLI   RREPPROF+27,C'Y'    DAILY PACING?                                
         BNE   CC285                                                            
         SR    RE,RE               CLEAR DAY ADJUSTMENT                         
CC285    EQU   *                                                                
         ST    RE,DMCB+8                                                        
         GOTO1 ADDAY,DMCB,WORK+12,WORK+4                                        
         GOTO1 DATCON,DMCB,(0,WORK+4),(2,WORK)                                  
*                                  CONVERT YYMMDD EBCDIC TO 2-BYTE              
         CLC   WORK(2),QWMONFOR    CHECK TRUE ACTIV DATE                        
*                                     VS CURRENT AS-AT DATE                     
         BNE   CC210               NOT 'THIS WEEK' - GO FOR NEXT                
*                                     BUCKET                                    
*                                                                               
*   FOR A LOSS, CSSPLPCT CONTAINED THE TOTAL MARKET $$, WHICH                   
*      ARE TO BE SAVED IN THE DENOMINATOR OF THE CALCULATION.                   
*                                                                               
CC290    EQU   *                                                                
         GOTO1 =A(LOSSCALC),DMCB,(RC),(R4)                                      
*                                  PRORATE LOSS FOR MONTH - VALUE               
*                                     IS RETURNED IN DUB                        
         L     RF,DUB              GET PRORATED LOSS AMOUNT                     
         L     RE,4(R3)                                                         
         AR    RF,RE               ACCUMULATE LOSSES                            
         ST    RF,4(R3)            STORE LOSS IN OUTPUT FIELD                   
*                                                                               
*   TEST                                                                        
****     GOTO1 ADUMPBUF            DUMP RECORD                                  
*   TEST                                                                        
*                                                                               
         B     CC210               GO FOR NEXT BUCKET                           
*                                                                               
*                                                                               
CC300    LA    R4,NEXTBUCK(R4)     NEXT MONTH                                   
         B     CC010                                                            
         EJECT                                                                  
CC310    EQU   *                                                                
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
*                                                                               
         CLI   CSSPLOSS(RE),C'Y'   SPL A LOSS?                                  
         BE    CC320               YES -                                        
         MVI   THSWKFLG,C'N'       NO  - RESET SPL AS-RUN THIS WK FLG           
         B     CC110               TREAT AS A BLANK COLUMN                      
CC320    EQU   *                                                                
*                                                                               
*   A LOSS HAS BEEN IDENTIFIED WITHIN A NON-SPL AGGREGATING REPORT              
*      SPEC.  IT IS NECESSARY THAT THE                                          
*      CONTRACT'S FLIGHT DATES FALL WITHIN THE REPORT PERIOD.                   
*      IF SO, A RECORD MUST BE PUT OUT, TO ENSURE THAT THE SPL AGGREG           
*      DATA HAS DETAIL TO MATCH AGAINST, OTHERWISE THE LOSS COMPONENT           
*      MAY BE LOST.                                                             
*                                                                               
         GOTO1 =A(LOSSCHEK)                                                     
         BNZ   CC210               NOT WITHIN REPORT PERIOD                     
*                                                                               
         SR    R1,R1               LOSS IS WITHIN REPORT PERIOD                 
         BCTR  R1,0                SET SPL FIELD TO -1 TO                       
*                                     FORCE LINE OUTPUT                         
         B     CC205               OVERLAY THE FIELD                            
*                                                                               
         EJECT                                                                  
*        POST BUFFALO COLS - AVAIL LOGIC                                        
*                                                                               
CC400    CLI   RPMONROW,0          THERE MUST BE A MONTH ROW                    
         BNE   *+6                                                              
         DC    H'0'                                                             
         MVC   MONTHTYP,RPMONROW                                                
         MVC   CAVLMON,QWCURST     INIT CURRENT MONTH                           
         MVC   PAVLMON,QWPRIST     INIT PRIOR MONTH                             
         LA    R3,CAVLMON          R3 = A(RECORD PERIOD START CUR/PRI)          
         LA    R4,CAVLMON          R4 = A(RECORD PERIOD END CUR/PRI)            
         LA    R5,QWQTRS           R5 = A(REQUEST QTR LIST)                     
         CLI   MONTHTYP,C'M'       MONTH FORMAT                                 
         BE    CC430                                                            
         CLI   MONTHTYP,C'Q'       QTR FORMAT                                   
         BNE   CC410                                                            
         CLI   0(R5),0             TEST FOR ANY QTRS                            
         BE    CC900                                                            
*                                                                               
CC405    MVC   CAVLMON+1(1),0(R5)  QTRS - MOVE QTR CODE TO MONTH                
         LA    R3,1(R5)            QTR START                                    
         LA    R4,5(R5)            QTR END                                      
         B     CC430                                                            
*                                                                               
CC410    CLI   MONTHTYP,C'C'       CURRENT MONTH FORMAT                         
         BNE   CC420                                                            
         MVC   CAVLMON+1(1),QWCURMON   SET THE CURRENT MONTH                    
         MVC   PAVLMON+1(1),QWCURMON                                            
         B     CC430                                                            
*                                                                               
CC420    CLI   MONTHTYP,C'A'       ALLMONTH FORMAT                              
         BE    CC425                                                            
         DC    H'0'                                                             
*                                                                               
CC425    MVI   CAVLMON+1,13        PERIOD TOTAL CODE                            
         LA    R3,QWCURST          PERIOD START                                 
         LA    R4,QWCURND          PERIOD END                                   
*                                                                               
CC430    ICM   R1,15,AMONROW       MOVE MONTH TO RECORD                         
         BZ    *+10                                                             
         MVC   0(2,R1),CAVLMON                                                  
         LA    R6,RPCONCOL         ADDRESS IMPLODED COL SPECS                   
*                                                                               
CC450    CLI   0(R6),X'FF'         TEST FOR END OF COL SPECS                    
         BE    CC500                                                            
         TM    0(R6),X'01'         COL MUST BE PERIOD                           
         BO    *+6                                                              
         DC    H'0'                                                             
         ICM   RE,7,1(R6)          BUFFALO COL ADDR                             
         ICM   RF,7,4(R6)          POST ROUTINE ADDR                            
         BR    RF                                                               
CC460    EQU   *                                                                
         TM    QAVLMSK,CURREJCT    TEST CONTRACT REJECTED FOR CURRENT           
         BO    CC490                                                            
         CLC   FLIGHTST,0(R4)      FLIGHT START TO CUR PERIOD END               
         BH    CC490               HIGH - REJECT                                
         CLC   FLIGHTND,0(R3)      FLIGHT END TO CUR PERIOD START               
         BL    CC490               LO - REJECT                                  
         B     CC480                                                            
CC470    EQU   *                                                                
         TM    QAVLMSK,PRIREJCT    TEST CONTRACT REJECTED FOR PRIOR             
         BO    CC490                                                            
         CLC   FLIGHTST,2(R4)      FLIGHT START TO PRI PERIOD END               
         BH    CC490               HIGH - REJECT                                
         CLC   FLIGHTND,2(R3)      FLIGHT END TO PRI PERIOD START               
         BL    CC490               LO - REJECT                                  
*                                                                               
CC480    MVC   0(4,RE),=F'1'       CONTRACT ACCEPTED FOR THIS PERIOD            
*                                                                               
CC490    LA    R6,7(R6)            NEXT COLUMN                                  
         B     CC450                                                            
*                                                                               
CC500    CLI   MONTHTYP,C'A'       END OF COLS - TEST FOR TOTAL REC             
         BE    CC900               YES - DONE                                   
         CLI   MONTHTYP,C'C'       TEST FOR CURRENT MONTH FORMAT                
         BE    CC900               YES - DONE                                   
         TM    RPFLAG2,X'20'       GROSS SPL $$ COLUMNS IN REPORT?              
         BNO   CC500001            NO  -                                        
         GOTO1 =A(SPL$CALC),DMCB,(R7),(RC)                                      
*                                  YES - INSERT GROSS SPL, IF ANY               
CC500001 EQU   *                                                                
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BO    CC500A              YES - PASS ALL BUFFALO RECORDS               
         OC    BFACCS,BFACCS                                                    
         BZ    CC500B                                                           
         GOTO1 =A(NOBFFACC),DMCB   CHECK FOR VALID VALUE                        
         BZ    CC500B              NO VALID VALUE                               
CC500A   EQU   *                                                                
         GOTO1 =A(SHARCALC),DMCB,(R8),(RC)                                      
         GOTO1 =A(PUT),DMCB        PUT THE RECORD                               
CC500B   EQU   *                                                                
         CLI   MONTHTYP,C'M'       TEST FOR MONTH FORMAT                        
         BNE   CC510               YES -                                        
         ZIC   RF,CAVLMON+1              NEXT MONTH                             
         LA    RF,1(RF)                                                         
         STC   RF,CAVLMON+1                                                     
         STC   RF,PAVLMON+1                                                     
         CLC   QWCURND,CAVLMON     TEST FOR DONE WHOLE REQ PERIOD               
         BNL   CC430                                                            
         CLI   0(R5),0             YES - TEST FOR QTRS NEEDED                   
         BE    CC520                     NO - FINISH WITH TOTAL REC             
         CLI   QWNMON,3                                                         
         BNH   CC520                                                            
         MVI   MONTHTYP,C'Q'             YES- POST THE QTR RECORDS              
         B     CC405                                                            
*                                                                               
CC510    CLI   MONTHTYP,C'Q'       QTR RECORD(S)                                
         BE    *+6                                                              
         DC    H'0'                                                             
         CLI   0(R5),17            TEST FOR DONE 4TH QTR                        
         BE    CC520               YES - FINISH WITH TOTAL RECORD               
         LA    R5,9(R5)            NO  - NEXT QTR                               
         CLI   0(R5),0                   TEST FOR END OF QTRS                   
         BNE   CC405                     NO - POST THIS QTR                     
*                                                                               
CC520    MVI   MONTHTYP,C'A'       FINALLY POST THE TOTAL RECORD                
         B     CC425                                                            
*                                                                               
*                                                                               
*                                                                               
CC900    EQU   *                                                                
         TM    RPFLAG2,X'20'       GROSS SPL $$ COLUMNS IN REPORT?              
         BNO   CC902               NO  -                                        
         GOTO1 =A(SPL$CALC),DMCB,(R7),(RC)                                      
*                                  YES - INSERT GROSS SPL, IF ANY               
CC902    EQU   *                                                                
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BO    CC904               YES - PASS ALL BUFFALO RECORDS               
         OC    BFACCS,BFACCS                                                    
         BZ    CC910                                                            
         GOTO1 =A(NOBFFACC),DMCB   CHECK FOR VALID VALUE                        
         BZ    CC910               NO VALID VALUE                               
CC904    EQU   *                                                                
         GOTO1 =A(SHARCALC),DMCB,(R8),(RC)                                      
         GOTO1 =A(PUT),DMCB        PUT FINAL BUFFALO REC                        
CC910    EQU   *                                                                
         TM    RPFLAGS,X'06'       TEST FOR COPY RECORD                         
         BNO   CC999X                                                           
         MVC   BFREC,BFRECSV       YES- MOVE BACK TO BFREC                      
         TM    RPFLAG2,X'20'       GROSS SPL $$ COLUMNS IN REPORT?              
         BNO   CC912               NO  -                                        
         GOTO1 =A(SPL$CALC),DMCB,(R7),(RC)                                      
*                                  YES - INSERT GROSS SPL, IF ANY               
CC912    EQU   *                                                                
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BO    CC914               YES - PASS ALL BUFFALO RECORDS               
         OC    BFACCS,BFACCS            AND PUT                                 
         BZ    CC999X                                                           
         GOTO1 =A(NOBFFACC),DMCB   CHECK FOR VALID VALUE                        
         BZ    CC999X              NO VALID VALUE                               
CC914    EQU   *                                                                
         GOTO1 =A(SHARCALC),DMCB,(R8),(RC)                                      
         GOTO1 =A(PUT),DMCB                                                     
*                                                                               
CC999X   EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
         DROP  R2,R7                                                            
         EJECT                                                                  
*                                                                               
*        ROUTINE TO SKIP THROUGH DIRECTORY LOOKING FOR NEXT                     
*        APPLICABLE CONTRACT RECORD                                             
*                                                                               
         SPACE                                                                  
SKIPPER  NTR1                                                                   
         GOTO1 ASEQ                READ NEXT RECORD                             
         EX    R4,KEYCOMP2                                                      
         BNE   SK999                                                            
*                                                                               
SK010    LA    R3,SKIPKEY                                                       
         LA    R4,KEY+4            R4 = KEY FIELD ADDRESS                       
         LA    R5,7                                                             
         SR    R1,R1                                                            
         SR    R6,R6                                                            
*                                                                               
SK020    ICM   R6,7,1(R3)          R6 = FILTER VALUE ADDRESS                    
         IC    R1,0(R3)            R1 = LENGTH OF KEY FIELD - 1                 
         EX    R1,SPACOMP          IS FILTER VALUE SPACES                       
         BE    SK030               YES - NO FILTER ON THIS FIELD                
         EX    R1,FILTCOMP         IS KEY FIELD EQ FILTER VALUE                 
         BE    SK030               YES - CONTINUE TO NEXT FIELD                 
         BL    SK040               KEY FIELD LOW - BUILD HIGHER KEY             
         B     SK050               KEY FIELD HIGH - SKIP TO NEXT                
*                                                                               
SK030    LA    R4,1(R1,R4)         NEXT KEY FIELD                               
         LA    R3,4(R3)                                                         
         BCT   R5,SK020                                                         
         B     SK999                                                            
*                                                                               
SK040    EX    R1,FILTMOVE         MOVE FILTER VALUE TO KEY FIELD               
         LA    R4,1(R1,R4)                                                      
         LA    R1,KEY+26                                                        
         SR    R1,R4                                                            
         EX    R1,NULLMOVE         MOVE NULLS TO REST OF KEY                    
         B     SK060                                                            
*                                                                               
SK050    LA    R4,1(R1,R4)         POINT TO NEXT KEY FIELD                      
         LA    R1,KEY+25                                                        
         SR    R1,R4                                                            
         MVI   0(R4),X'FF'                                                      
         EX    R1,HIGHMOVE         MOVE HIGH VALUES TO REST OF KEY              
*                                                                               
SK060    GOTO1 AHIGH               READ HIGH                                    
         L     R4,KCOMPLEN                                                      
         EX    R4,KEYCOMP2                                                      
         BE    SK010               LOOP BACK THROUGH SKIPPER                    
*                                                                               
SK999    XIT1                                                                   
         EJECT                                                                  
KEYCOMP2 CLC   KEY(0),KEYSAVE      EXECUTED                                     
SPACOMP  CLC   0(0,R6),SPACES                                                   
FILTCOMP CLC   0(0,R4),0(R6)                                                    
FILTMOVE MVC   0(0,R4),0(R6)                                                    
NULLMOVE XC    0(0,R4),0(R4)                                                    
HIGHMOVE CLC   1(0,R4),0(R4)                                                    
         SPACE 2                                                                
SKIPKEY  DC    AL1(L'FGROUP-1),AL3(FGROUP)                                      
         DC    AL1(L'FSBGROUP-1),AL3(FSBGROUP)                                  
         DC    AL1(L'FSTATION-1),AL3(FSTATION)                                  
         DC    AL1(L'FOFFICE-1),AL3(FOFFICE)                                    
         DC    AL1(L'FAGENCY-1),AL3(FAGENCY)                                    
         DC    AL1(L'FAGYOFF-1),AL3(FAGYOFF)                                    
         DC    AL1(L'FADV-1),AL3(FADV)                                          
         EJECT                                                                  
*                                                                               
*        ROUTINE TO FIND INFORMATION ELEMENT FROM INFO POOL                     
*              INPUT:  INFCODE = ELEMENT CODE                                   
*              OUTPUT: R5      = A(ELEMENT)                                     
*                                                                               
         SPACE                                                                  
FRSTINF5 L     R5,ASPACND4                                                      
*                                                                               
FN010    CLI   0(R5),0                                                          
         BE    FN999                                                            
         CLC   INFCODE,0(R5)                                                    
         BER   RE                                                               
*                                                                               
NEXTINF5 SR    R0,R0                                                            
         ICM   R0,1,1(R5)                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R5,R0                                                            
         B     FN010                                                            
*                                                                               
FN999    LTR   RE,RE                                                            
         BR    RE                                                               
         EJECT                                                                  
*                                                                               
*        NXTSPECC SEARCHES FOR A SPEC FROM NEXT SPEC                            
*                                                                               
*        IN  R4 = A(ORIGINAL SPEC)                                              
*            SPEC = SOUGHT AFTER SPEC CODE (1 BYTE)                             
*        OUT CC = 0, R4 = A(FOUND SPEC)     SPEC FOUND                          
*            CC = 2, R4 = A(ORIGINAL SPEC)  SPEC NOT FOUND                      
         SPACE                                                                  
NXTSPECC DS    0H                  START SEARCH AT NEXT SPEC                    
         ST    R4,REGSTOR                                                       
         SR    R0,R0                                                            
*                                                                               
NSC005   ICM   R0,1,1(R4)            LOOK AT NEXT SPEC                          
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R4,R0                                                            
         CLI   0(R4),0                                                          
         BE    NSC020               END OF SPECS                                
         CLC   0(1,R4),SPEC        COMPARE TO SOUGHT SPEC CODE                  
         BE    NSC010               FOUND                                       
         CLI   0(R4),10            ONLY LOOK IN THIS REPORT                     
         BE    NSC020               STOP AT NEXT REPORT                         
         B     NSC005                                                           
*                                                                               
NSC010   CR    RB,RB               CC = 0    SPEC FOUND                         
         BR    RE                                                               
*                                                                               
NSC020   L     R4,REGSTOR                                                       
         LTR   RB,RB               CC = 2    SPEC NOT FOUND                     
         BR    RE                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*        ROUTINE TO CALCULATE ORDER FLIGHT DATES IN CORRECT FORMAT              
*                                                                               
         SPACE                                                                  
FLITDATE NMOD1 0,*FLITDATE*                                                     
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         GOTO1 DATCON,DMCB,(3,RCONDATE),(0,WORK)   GET FLIGHT START/            
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                      END DATES         
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
         MVC   FLIGHTST,FULL                                                    
         GOTO1 DATCON,DMCB,(3,RCONDATE+3),(0,WORK)                              
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                                        
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
         MVC   FLIGHTND,FULL                                                    
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*        ROUTINE TO POST BUFFALO, REQUEST LEVEL (CONTRACT RECORD)               
*                                                                               
         SPACE                                                                  
POSTCON  NMOD1 0,*POSTCON*                                                      
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN - DONT CHANGE VALUE                         
*                                                                               
         ZIC   R7,QWREPORT                                                      
         MH    R7,=Y(RPSPECX-RPSPECD)                                           
         L     RF,=A(RPSPECS)      ADDRESS RPT SPECS WORK AREA                  
         AR    R7,RF                                                            
         USING RPSPECD,R7                                                       
*                                                                               
         MVI   REQTOTS,C'N'                                                     
         ICM   R1,15,QWTOTS        DO WE NEED TOTAL RECORDS ?                   
         BZ    PSCN0040                                                         
         MVI   REQTOTS,C'Y'                                                     
         CLI   TOTSONLY,C'Y'       TEST FOR TOTAL RECS ONLY                     
         BE    PSCN1000                                                         
*                                                                               
PSCN0040 CLC   RPREQ,QWREQNUM      IS IT SAME REQUEST NUM                       
         BNE   PSCN1400            NO                                           
*                                                                               
*   FOLLOWING TESTS DETERMINE STATUS OF REQUEST VS STATUS OF RECORD             
*        IN PROGRESS:                                                           
*        CONFIRMED/UNCONFIRMED CONTRACT FILTERING                               
*                                                                               
*        FOR 'PENDING/SKIP FORECAST', ALL RECORDS WHICH ARE 'FORECAST'          
*              ARE BYPASSED.                                                    
*        FOR 'INCOMPLETE ONLY' REPORT, ONLY ORDERS SET AS SUCH BY               
*              VALU5NEW ARE PROCESSED.                                          
*                                                                               
         L     RF,ACONSPEC         YES - SET A(CONTRACT SPECIFIC)               
         LA    R4,QWREQ2           SET A(SECOND REQUEST CARD)                   
         USING QREC2,R4                                                         
*                                                                               
*   TEST                                                                        
*        ST    RF,FULL             SAVE TEMPORARILY                             
*        MVC   P+1(12),=C'CON/UNCON = '                                         
*        MVC   P+14(1),CSFRMISC(RF)                                             
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+17,4,=C'TOG'                              
*        MVC   P+28(09),=C'REQ CARD='                                           
*        MVC   P+40(1),QCONUNC                                                  
*        GOTO1 REPORT                                                           
*        L     RF,FULL             RESTORE RF                                   
*   END TEST                                                                    
*                                                                               
         CLI   QCONUNC,C' '        CONFIRM/UNCONF FILTERING NEEDED?             
         BE    PSCN0048            NO                                           
         CLI   QCONUNC,X'00'       DITTO                                        
         BE    PSCN0048                                                         
         TM    CSFRMISC(RF),X'20'  IS ORDER CONFIRMED?                          
         BNO   PSCN0044            NO  - TEST FOR UNCONFIRM REQUEST             
         CLI   QCONUNC,C'C'        YES - IS REQUEST FOR CONFIRMED               
         BE    PSCN0048            YES - ACCEPT THE ORDER                       
         B     PSCN1320            NO  - SKIP THE ORDER                         
PSCN0044 EQU   *                                                                
         CLI   QCONUNC,C'U'        IS REQUEST FOR UNCONFIRMED                   
         BE    PSCN0048            YES - ACCEPT THE ORDER                       
         B     PSCN1320            NO  - SKIP THE ORDER                         
*                                                                               
         DROP  R4                                                               
*                                                                               
PSCN0048 EQU   *                                                                
         L     RF,ACONSPEC         SET A(CONTRACT SPECIFIC)                     
         TM    RPMISFLG,X'08'      'INCOMPLETE REPORT' REQUEST?                 
         BNO   PSCN0055            NO                                           
*                                                                               
*   TEST                                                                        
*        ST    RF,FULL             SAVE TEMPORARILY                             
*        MVC   P+1(12),=C'PENDING   = '                                         
*        MVC   P+14(4),CSPENDNG(RF)                                             
*        EDIT  RF,(6,P+20)                                                      
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+42,4,=C'TOG'                              
*        GOTO1 REPORT                                                           
*        L     RF,FULL             RESTORE RF                                   
*   END TEST                                                                    
*                                                                               
         TM    CSFRMISC(RF),X'80'  YES - IS ORDER 'INCOMPLETE'?                 
         BNO   PSCN1320            NO  - SKIP IT                                
         B     PSCN0160            YES - PROCESS IT                             
PSCN0055 EQU   *                                                                
         TM    RPMISFLG,X'40'      'STACKED SPL' EXTRA DATES REQUEST?           
         BNO   PSCN0058            NO                                           
*                                                                               
*   TEST                                                                        
*        ST    RF,FULL             SAVE TEMPORARILY                             
*        MVC   P+1(12),=C'PENDING   = '                                         
*        MVC   P+14(4),CSPENDNG(RF)                                             
*        EDIT  RF,(6,P+20)                                                      
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+42,4,=C'TOG'                              
*        GOTO1 REPORT                                                           
*        L     RF,FULL             RESTORE RF                                   
*   END TEST                                                                    
*                                                                               
         TM    CSFRMISC(RF),X'40'  YES - IS ORDER W/IN RANGE OF                 
*                                     EXTRA DATES?                              
         BNO   PSCN1320            NO  - SKIP IT                                
         B     PSCN0160            YES - PROCESS IT                             
PSCN0058 EQU   *                                                                
         TM    RPFLAG2,X'10'       'SKIP FCST' REPORT?                          
         BNO   PSCN0065            NO                                           
         CLI   CSPENDNG(RF),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    PSCN0060            YES  - CHECK FURTHER                         
         CLI   CSPENDNG(RF),C'P'   'PENDING/NEW SAR' ORDER?                     
         BNE   PSCN0160            NO  - PROCESS IT                             
PSCN0060 EQU   *                                                                
         CLI   CSFRCAST(RF),C'Y'   FCST CONTRACT?                               
         BE    PSCN1320            YES - SKIP CONTRACT                          
         B     PSCN0160            NO  - PROCESS IT                             
PSCN0065 EQU   *                                                                
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BZ    PSCN0080            NO  -                                        
         CLI   CSPENDNG(RF),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    PSCN0070            YES  - CHECK FURTHER                         
         CLI   CSPENDNG(RF),C'P'   'PENDING/NEW SAR' ORDER?                     
         BNE   PSCN1320            NO  - SKIP CONTRACT                          
PSCN0070 EQU   *                                                                
         TM    RPFLAG2,X'04'       'TRUE FCST' REPORT?                          
         BNO   PSCN0075            NO - MUST BE 'TRUE PEND'                     
         CLI   CSFRCAST(RF),C'Y'   FCST CONTRACT?                               
         BNE   PSCN1320            NO  - SKIP CONTRACT                          
         B     PSCN0120            YES - PROCESS IT                             
PSCN0075 EQU   *                   TRUE PENDING: CHECK CONTRACT                 
         TM    RPFLAG2,X'08'       'TRUE PEND' REPORT?                          
         BNO   PSCN0120            NO - MUST BE 'BOTH FCST+PEND'                
         CLI   CSFRCAST(RF),C'Y'   FCST CONTRACT?                               
         BE    PSCN1320            YES - SKIP CONTRACT                          
         B     PSCN0120            NO  - PROCESS IT                             
PSCN0080 EQU   *                                                                
         TM    RPFLAG2,X'02'       'SPLITPND' REPORT?                           
         BZ    PSCN0160            NO  -                                        
         L     RF,ACONSPEC         YES - IS CONTRACT 'PENDING'?                 
         CLI   CSPENDNG(RF),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    PSCN0120            YES -                                        
         CLI   CSPENDNG(RF),C'P'   'PENDING/NEW SAR' ORDER?                     
         BNE   PSCN0160            NO  - PROCESS OTHER SIDE                     
*                                  YES - PENDING - CHECK FLGHT DTES             
PSCN0120 EQU   *                                                                
*                                                                               
*   'PENDING' DATA HAS BEEN IDENTIFIED.  CHECK TO ENSURE THAT THE               
*      CONTRACT'S FLIGHT DATES FALL WITHIN THE REPORT PERIOD.                   
*                                                                               
         GOTO1 DATCON,DMCB,(3,RCONDATE),(0,WORK)   GET FLIGHT START/            
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                      END DATES         
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
         MVC   FLIGHTST,FULL                                                    
         GOTO1 DATCON,DMCB,(3,RCONDATE+3),(0,WORK)                              
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                                        
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
         MVC   FLIGHTND,FULL                                                    
         CLC   FLIGHTND,QWCURST    FLIGHT ENDS BEFORE REP PERIOD?               
         BL    PSCN1320            YES - SKIP CONTRACT                          
         CLC   QWCURND(2),FLIGHTST FLIGHT STARTS AFTER REP PERIOD?              
         BL    PSCN1320            YES - SKIP CONTRACT                          
*                                  FOR THIS REPORT                              
PSCN0160 EQU   *                                                                
         TM    RPFLAGS,X'40'       TEST FOR AVAIL REPORT                        
         BZ    *+12                                                             
         TM    QAVLMSK,REJECTED    YES - IS CONTRACT REJECTED                   
         BO    PSCN1320                  YES - NEXT REPORT                      
         MVI   RPTFILT,C'N'                                                     
         BAS   RE,GETRPFLT         ANY RPTFILT SPECS                            
         BNE   PSCN0320            NO                                           
         LA    R4,WORK             YES - GET FILTER VALUE                       
         LA    R6,2(R5)                                                         
         GOTO1 =A(POSTROW),DMCB,(R6)                                            
         CLI   0(R6),4                                                          
         BE    *+12                                                             
         CLI   0(R6),14                                                         
         BNE   *+8                                                              
         LA    R4,1(R4)            IF OFFICE CODE ADD ONE FOR COMPARE           
*                                                                               
         CLI   0(R6),2             IF STATION, ADD 2 FOR COMPARE                
         BE    *+12                                                             
         CLI   0(R6),32                                                         
         BNE   *+8                                                              
         LA    R4,2(R4)                                                         
*                                                                               
         CLI   3(R5),C'+'          INCLUDE                                      
         BNE   PSCN0240                                                         
*                                                                               
PSCN0200 EX    R3,RPFLTCLC                                                      
         BE    PSCN0320                                                         
         BAS   RE,NXTRPFLT                                                      
         BE    PSCN0200                                                         
         MVI   RPTFILT,C'Y'                                                     
         B     PSCN1000                                                         
*                                                                               
PSCN0240 CLI   3(R5),C'-'          EXCLUDE                                      
         BE    PSCN0280                                                         
         DC    H'0'                                                             
*                                                                               
PSCN0280 EX    R3,RPFLTCLC                                                      
         BNE   *+12                                                             
         MVI   RPTFILT,C'Y'                                                     
         B     PSCN1000                                                         
         BAS   RE,NXTRPFLT                                                      
         BE    PSCN0280                                                         
*                                                                               
PSCN0320 XC    BFREC,BFREC         CLEAR BUFFALO REC                            
         MVC   BFREC+RGCMPDSP(2),RCONKREP                                       
*                                                                               
*     FOR EACH RECORD, THE COMPANY CODE IS LOADED IN THE LAST TWO               
*     BYTES OF THE COMMENT FIELD.  THIS ENABLES THE REPORT SEGMENT              
*     TO CORRECTLY EXTRACT CODE EXPANSIONS FROM 'SPACEND' WHICH                 
*     IS MODIFIED TO INCLUDE PARTITIONING OF CODES OVER MULTIPLE                
*     REPS, IN THOSE CASES WHERE A 'MASTER REP' IS INDICATED.                   
*     IT IS UNDERSTOOD THAT THIS PROCESS WILL OCCUR FOR EACH ROW                
*     ADDED TO THE SORT KEY                                                     
*                                                                               
         MVC   BFREC+RGDSKDSP(4),KEY+28                                         
*                                                                               
*     FOR EACH RECORD, THE DISK ADDRESS OF THE CONTRACT IS LOADED               
*     IN THE FOUR BYTES PRECEDING THE COMPANY CODE.  THIS IS TO                 
*     PERMIT THE RETRIEVAL OF THE CONTRACT RECORD DURING REPORT                 
*     GENERATION, IF IT IS DETERMINED THAT EITHER 'BUYER' OR                    
*     COMMENTS ARE DESIRED.                                                     
*                                                                               
*     FOR 'PENDING' OR 'SPLITPND' REPORTS, A FLAG IS SET IN THE                 
*     COMMENT AREA IF THE CONTRACT IS TRUE FORECAST.  THIS WILL                 
*     PERMIT THE DISPLAY OF AN INDICATOR TO THAT EFFECT AT PRINT                
*     TIME IN THE RERG03 MODULE.                                                
*                                                                               
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BNZ   PSCN0360            YES -                                        
         TM    RPFLAG2,X'02'       NO  - 'SPLITPND' REPORT?                     
         BZ    PSCN0440            NO  -                                        
PSCN0360 EQU   *                                                                
         L     RF,ACONSPEC         YES - IS CONTRACT 'PENDING'?                 
         CLI   CSPENDNG(RF),C'Y'   'PENDING/NO NEW SAR' ORDER?                  
         BE    PSCN0400            YES  - PROCESS                               
         CLI   CSPENDNG(RF),C'P'   'PENDING/NEW SAR' ORDER?                     
         BNE   PSCN0440            NO                                           
PSCN0400 EQU   *                                                                
         CLI   CSFRCAST(RF),C'Y'   IS CONTRACT 'FORECAST?'                      
         BNE   PSCN0440            NO                                           
         MVI   BFREC+RGFCSDSP,C'F' YES - SET INDICATOR IN COMMENT               
PSCN0440 EQU   *                                                                
         TM    RPFLAGS,X'20'       TEST FOR ONLINE SPEC(S)                      
         BZ    PSCN0480                                                         
         OI    BFCOM,X'01'         INDICATE IN COMMENT AREA                     
         MVC   BFCOM+1(2),QWREQPR   AND MOVE IN THE REQUEST NO                  
         MVC   BFCOM+3(1),RPRPT                 AND REPORT NO                   
         MVC   BFCOM+4(2),RCREPFL               AND REP                         
*                                                                               
PSCN0480 MVC   BFKEY(1),RPREQ      FIRST KEY HAS REQ NUM                        
         MVC   BFKEY+1(1),RPRPT              AND RPT NUM                        
         XC    RECAPLVL,RECAPLVL   CLEAR RECAP LEVEL                            
         ICM   R5,15,RPRECAP       RECAP?                                       
         BZ    PSCN0520            NO                                           
         MVC   BFKEY+1(1),2(R5)    YES - RECAP OF THIS REPORT NUM               
         ZIC   R0,3(R5)               AT THIS LEVEL                             
         STH   R0,RECAPLVL                                                      
         B     PSCN0600                                                         
*                                                                               
*   IF A RECAP SPEC IS PRESENT, THE REPORT IT POINTS TO IS TO TAKE              
*        PRIORITY OVER THE AGGREG REPORT NUMBER.  IN THIS MANNER,               
*        A RECAP CAN HAVE AN AGGREGATION, AND THE WHOLE THING CAN               
*        FLOAT INTO POSITION BEHIND THE TARGET REPORT AT THE RIGHT              
*        BREAK LEVEL.                                                           
*                                                                               
PSCN0520 EQU   *                                                                
*                                                                               
*   TEST FOR AGGREGATION ADDRESS.  IF PRESENT, REPORT NUMBER IN KEY             
*     IS CHANGED TO THAT OF BASE REPORT.  UNLIKE RECAP, THERE IS NO             
*     REPORT LEVEL TO BE SET                                                    
*                                                                               
         ICM   RF,15,RPAGGREG      TEST FOR AGGREG                              
         BZ    PSCN0560                                                         
         MVC   BFKEY+1(1),2(RF)    AGGREG OF THIS REPORT NUM                    
*                                                                               
PSCN0560 EQU   *                                                                
*                                                                               
*   TEST FOR SPL AS-RUN ADDRESS.  IF PRESENT, REPORT NUMBER IN KEY              
*     IS CHANGED TO THAT OF BASE REPORT.  UNLIKE RECAP, THERE IS NO             
*     REPORT LEVEL TO BE SET                                                    
*                                                                               
         ICM   RF,15,RPAGGSPL      TEST FOR AGGSPL                              
         BZ    PSCN0600                                                         
         MVC   BFKEY+1(1),2(RF)    AGGSPL OF THIS REPORT NUM                    
*                                                                               
PSCN0600 EQU   *                                                                
         LA    R6,RPROWS           ADDRESS IMPLODED ROW SPECS                   
         LA    R5,1                                                             
         XC    AMONROW,AMONROW     CLEAR A(MONTH ROW)                           
*                                                                               
PSCN0640 CLI   0(R6),X'FF'         TEST FOR END OF ROWS                         
         BE    PSCN0920                                                         
         ICM   R4,7,1(R6)          BUFFALO ROW ADDR                             
         PRINT GEN                                                              
         GOTO1 =A(POSTROW),DMCB,(R6)    POST THE ROW                            
         PRINT NOGEN                                                            
         BE    PSCN0660                                                         
         MVI   RPTFILT,C'Y'        SKIP THIS REPORT                             
         B     PSCN1000            BUT CHECK FOR TOTALS                         
PSCN0660 EQU   *                                                                
         BAS   RE,GETFILT                                                       
         BNE   PSCN0800            NO ROW FILTERS                               
         LR    R3,R4                                                            
         CLI   0(R6),4                                                          
         BE    *+12                                                             
         CLI   0(R6),14                                                         
         BNE   *+8                                                              
         LA    R3,1(R3)            IF OFFICE CODE ADD ONE FOR COMPARE           
*                                                                               
         CLI   0(R6),2             IF STATION, ADD 2 FOR COMPARE                
         BE    *+12                                                             
         CLI   0(R6),32                                                         
         BNE   *+8                                                              
         LA    R3,2(R3)                                                         
*                                                                               
         CLI   3(R1),C'+'          TEST FOR INCLUDE                             
         BNE   PSCN0720                                                         
*                                                                               
PSCN0680 EX    RF,COMPARE          INCLUDE                                      
         BE    PSCN0800            EQUAL - OK                                   
         BAS   RE,NEXTFILT         NEXT ROW FILTER                              
         BE    PSCN0680                                                         
         MVI   RPTFILT,C'Y'        NOT INCLUDED                                 
         B     PSCN1000            SKIP THIS REPORT                             
*                                                                               
PSCN0720 CLI   3(R1),C'-'          TEST FOR EXCLUDE                             
         BE    PSCN0760                                                         
         DC    H'0'                                                             
*                                                                               
PSCN0760 EX    RF,COMPARE          EXCLUDE                                      
         BNE   *+12                NOT EQUAL - OK                               
         MVI   RPTFILT,C'Y'        EQUAL - SKIP THIS REPORT                     
         B     PSCN1000                                                         
         BAS   RE,NEXTFILT         NEXT ROW FILTER                              
         BNE   PSCN0800            OK                                           
         B     PSCN0760                                                         
*                                                                               
PSCN0800 EQU   *                                                                
*                                                                               
*   'RECAPLVL' WILL BE ZERO IF THIS IS NOT A RECAP REPORT                       
*                                                                               
         CH    R5,RECAPLVL              TEST FOR RECAP                          
         BNE   PSCN0880                                                         
         MVC   RGROWSZ-1(1,R4),RPRPT    RECAP IS AT THIS LEVEL                  
*                                                                               
*   IF RECAP, CHECK TO SEE IF AGGREG OR AGGSPL SPEC IS USED.  IF                
*        IT IS, THEN THE INDIRECT REPORT NUMBER REFERENCED THERE                
*        MUST BE USED.                                                          
*                                                                               
         ICM   RF,15,RPAGGREG           TEST FOR AGGREG                         
         BZ    PSCN0840                                                         
         MVC   RGROWSZ-1(1,R4),2(RF)    AGGREG OF THIS REPORT NUM               
*                                                                               
PSCN0840 EQU   *                                                                
*                                                                               
         ICM   RF,15,RPAGGSPL           TEST FOR AGGSPL                         
         BZ    PSCN0860                                                         
         MVC   RGROWSZ-1(1,R4),2(RF)    AGGSPL OF THIS REPORT NUM               
*                                                                               
PSCN0860 EQU   *                                                                
*                                                                               
*   FINALLY, CHECK IF RECAP IS 'RECAPA', WHICH CONTAINS AN EXTRA                
*        ARGUMENT AS THE FIFTH CHARACTER, WHICH IS A REPORT NUMBER              
*        OVERRIDE TO ENSURE PROPER SEQUENCING OF AGGREG/AGGSPL                  
*        SUBREPORTS.                                                            
*                                                                               
         ICM   RF,15,RPRECAP       TEST FOR AGGSPL                              
         BZ    PSCN0880                                                         
         CLI   1(RF),5             SPEC LENGTH = 5 (RECAPA)?                    
         BNE   PSCN0880            NO  - 4 CHAR (RECAP)                         
         MVC   RGROWSZ-1(1,R4),4(RF)                                            
*                                  YES - OVERRIDE REPORT NUMBER                 
*                                                                               
PSCN0880 LA    R6,7(R6)                                                         
         LA    R5,1(R5)                                                         
         ST    R4,SVR4ADDR         SAVE BUFFALO ROW ADDRESS                     
         CH    R5,=Y(RGROWMAX-1)   TEST FOR ENOUGH ROWS                         
         BNH   PSCN0640            NEXT ROW                                     
*                                                                               
PSCN0920 EQU   *                                                                
         ICM   RF,15,RPAGGREG      TEST FOR AGGREG                              
         BZ    PSCN0960            NOT AGGREG - PROCEED                         
         XC    RGROWSZ-1(1,R4),RGROWSZ-1(R4)                                    
*                                  AGGREG:  SET LAST ROW REPORT#                
*                                     TO ZERO TO FORCE SORT 1ST                 
PSCN0960 EQU   *                                                                
         ICM   RF,15,RPAGGSPL      TEST FOR AGGSPL                              
         BZ    PSCN1000            NOT AGGSPL - PROCEED                         
         XC    RGROWSZ-1(1,R4),RGROWSZ-1(R4)                                    
*                                  AGGSPL:  SET LAST ROW REPORT#                
*                                     TO ZERO TO FORCE SORT 1ST                 
         MVI   RGROWSZ(R4),X'FF'                                                
*                                  INSERT X'FF' INTO NEXT CHARACTER             
*                                     OF SPL AS-RUN DETAIL                      
PSCN1000 CLI   REQTOTS,C'Y'        TEST FOR TOTAL RECORDS                       
         BE    PSCN1040            YES                                          
         CLI   RPTFILT,C'Y'        NO - IS REPORT FILTERED ?                    
         BE    PSCN1320             YES- SKIP THE REPORT                        
         B     PSCN1280             NO - SKIP TOTAL KEYS                        
*                                                                               
PSCN1040 ICM   R4,15,QWTOTS        PROCESS TOTALS RECS ON FIRST REPORT          
         LA    R3,TOTKEYS                                                       
*                                                                               
PSCN1080 XC    0(RGKEYLEN,R3),0(R3)  CLEAR TOTAL KEY                            
         MVC   0(1,R3),QWREQNUM    REQ NUM                                      
         LA    R5,2(R4)                                                         
         ST    R4,R4STORE                                                       
         LA    R4,RGROWSZ(R3)                                                   
         ST    R3,R3STORE                                                       
         LA    R3,2(R3)                                                         
         LH    R6,=Y(TOTMAX)       MAX ROWS FOR TOTAL REC                       
         MVI   SPEC,6                                                           
*                                                                               
PSCN1120 MVC   0(1,R3),0(R5)       ROW DATA CODE                                
         SR    R1,R1                                                            
         CLI   0(R5),0                                                          
         BE    PSCN1160                                                         
         GOTO1 =A(POSTROW),DMCB,(R5)   POST THE ROW                             
         BE    PSCN1160                                                         
         L     R3,R3STORE          SKIP THIS TOTAL                              
         B     PSCN1200                                                         
*                                                                               
PSCN1160 LA    R3,1(R3)                                                         
         LA    R4,RGROWSZ(R4)                                                   
         LA    R5,1(R5)                                                         
         BCT   R6,PSCN1120         NEXT ROW                                     
*                                                                               
         L     R3,R3STORE                                                       
         LA    R3,RGKEYLEN(R3)                                                  
*                                                                               
PSCN1200 L     R4,R4STORE                                                       
         BAS   RE,NXTSPECC         LOOK FOR NEXT TOTDEF SPEC                    
         BNE   PSCN1240                                                         
         C     R3,=A(TOTKEYSX)                                                  
         BNH   PSCN1080                                                         
         DC    H'0'                                                             
*                                                                               
PSCN1240 MVI   0(R3),X'FF'         MARK END OF TOTAL KEYS                       
*                                                                               
PSCN1280 EQU   *                                                                
         GOTO1 =A(CONCOL),DMCB,(RC)     POST THE COLUMNS                        
         MVI   REQTOTS,C'N'                                                     
*                                                                               
PSCN1320 CLI   TOTSONLY,C'Y'       IF TOTAL RECS ONLY THEN SKIP                 
         BE    PSCN1360                                                         
         LA    R7,RPSPECX-RPSPECD(R7)                                           
         C     R7,=A(RPSPECSX)                                                  
         BNH   PSCN0040            NEXT REPORT                                  
*                                                                               
PSCN1360 CLI   REQTOTS,C'Y'        DO WE STILL REQUIRE TOTAL RECS ?             
         BNE   PSCN1400                                                         
         MVI   TOTSONLY,C'Y'       YES - INDICATE ALL RPTS FILTERED OUT         
         B     PSCN1000                  AND POST THE TOTAL RECS                
*                                                                               
*                                                                               
PSCN1400 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
         DROP  R2,R7                                                            
         EJECT                                                                  
TOTMAX   EQU   2                                                                
*                                                                               
COMPARE  CLC   0(0,R3),4(R1)       COMPARE ROW VALUE TO FILTER                  
RPFLTCLC CLC   0(0,R4),4(R5)       COMPARE FOR REPORT FILTERING                 
         SPACE 2                                                                
GETFILT  SR    R1,R1                                                            
         ICM   R1,7,4(R6)                                                       
         BNZ   GF010                                                            
         LTR   RB,RB               NO ROW FILTERS                               
         BR    RE                  CC NE 0                                      
*                                                                               
NEXTFILT ZIC   R0,1(R1)                                                         
         AR    R1,R0                                                            
         CLI   0(R1),36                                                         
         BNER  RE                  NO MORE ROW FILTERS - CC NE 0                
*                                                                               
GF010    ZIC   RF,1(R1)                                                         
         SH    RF,=H'5'            RF = LENGTH OF FILTER - 1                    
         BNM   *+6                                                              
         DC    H'0'                                                             
         CR    RB,RB               ROW FILTER FOUND                             
         BR    RE                  CC EQ 0                                      
         SPACE 3                                                                
         USING RPSPECD,R7                                                       
         SPACE                                                                  
GETRPFLT ICM   R5,15,RPFILT        TEST FOR RPTFILT SPEC(S)                     
         BNZ   NF010                                                            
         LTR   RB,RB               NO - CC NE 0                                 
         BR    RE                                                               
*                                                                               
NXTRPFLT ZIC   R0,1(R5)                                                         
         AR    R5,R0                                                            
         CLI   0(R5),20                                                         
         BNER  RE                  NO MORE RPTFILT SPECS- CC NE 0               
*                                                                               
NF010    ZIC   R3,1(R5)                                                         
         SH    R3,=H'5'            R3 = LENGTH OF FILTER - 1                    
         BNM   *+6                                                              
         DC    H'0'                                                             
         CR    RB,RB               RPTFILT SPEC FOUND                           
         BR    RE                  CC EQ 0                                      
         SPACE 2                                                                
         DROP  R7                                                               
         EJECT                                                                  
         EJECT                                                                  
* ROUTINE TO GET COMMISSION RECORDS FOR A STATION                               
* NOTE: THIS ROUTINE IS CALLED FROM THE CONTRACT RECORD READ ROUTINE            
*                                                                               
COMRECS  NMOD1 0,*CREC*                                                         
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         L     R1,=A(COMTAB)                                                    
         L     R0,=A(COMTABX)                                                   
         BAS   RE,COMCLEAR         CLEAR OUT COMM TABLE                         
*                                                                               
         MVC   SVKEY,KEY                                                        
         XC    KEY,KEY             READ COMMISSION RECORDS                      
         LA    R6,NCOMTAB          MAX ENTRIES IN TABLE                         
         SR    R2,R2               TABLE ENTRY COUNTER                          
         LA    R5,KEY                                                           
         USING RCOMRECD,R5                                                      
         MVI   RCOMKTYP,X'29'                                                   
         LA    R3,RCREPFL          A(REP ID FOR RUN)                            
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP           A(MASTER/SUBSIDIARY REP TABLE)               
         USING RSREPD,RE                                                        
         CLI   MASTREP,1           MASTER REP?                                  
         BNE   COMR0010            NO  - USE REP ID FOR RUN                     
         L     R3,ACONSREP         A(CURRENT REP ID IN TABLE)                   
         DROP  RE,RF                                                            
COMR0010 EQU   *                                                                
         MVC   HALF,0(R3)          SAVE REP CODE IN USE                         
         MVC   RCOMKREP,0(R3)      LOAD REP ID                                  
         MVC   RCOMKSTA,RCONKSTA                                                
         L     R3,=A(COMTAB)                                                    
         GOTO1 AHIGH                                                            
         B     COMR0030                                                         
COMR0020 EQU   *                                                                
         GOTO1 ASEQ                                                             
COMR0030 EQU   *                                                                
         CLI   KEY,X'29'           STILL COMMISSION KEYS?                       
         BNE   COMR0040            NO  - DONE                                   
         CLC   KEY+11(2),HALF      STILL SAME REP?                              
         BNE   COMR0040            NO  - DONE                                   
         CLC   KEY+13(5),RCONKSTA  STILL CURRENT STATION?                       
         BNE   COMR0040            NO  - DONE                                   
         GOTO1 AGETCOM             RETRIEVE THE COMMISSION RECORD               
*                                                                               
*   LOAD DETAILS OF COMMISSION RECORD TO TABLE ENTRY                            
*                                                                               
         MVC   NCOMSTAT(5,R3),RCOMKSTA                                          
         MVC   NCOMOFF(2,R3),RCOMKOFF                                           
         MVC   NCOMADV(4,R3),RCOMKADV                                           
         MVC   NCOMTYP(1,R3),RCOMKTPE                                           
         MVC   NCOMDATE(2,R3),RCOMKDAT                                          
         LA    R5,IOAREA           RESET DSECT TO IO AREA WHICH                 
*                                     CONTAINS COMMISSION RECORD READ           
         MVC   NCOMRATE(4,R3),RCOMRAT1                                          
         LA    R3,LCOMTAB(R3)      BUMP TO NEXT TABLE POSITION                  
         LA    R2,1(R2)            BUMP COUNTER                                 
         CR    R2,R6               TABLE FULL?                                  
         BL    COMR0020            NO  - CHECK FOR MORE                         
         DC    H'0'                TABLE FULL                                   
*                                  EXPAND NUMBER OF ENTRIES IN COMTAB           
*                                  REASSEMBLE, RELINK, AND REENTER              
*                                                                               
*                                                                               
COMR0040 MVC   KEY,SVKEY           RESTORE READ SEQUENCE                        
         GOTO1 AHIGH                                                            
         STC   R2,NUMRATES         SAVE # RECS IN TABLE                         
*                                                                               
COMR0050 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
         DROP  R5                                                               
         EJECT                                                                  
COMCLEAR SR    R0,R1               GIVES LENGTH TO CLEAR                        
         BP    *+6                                                              
         DC    H'0'                NEGATIVE:  CAN'T CLEAR                       
         LA    RF,256                                                           
*                                                                               
COMCLR2  CR    R0,RF                                                            
         BNH   COMCLR4                                                          
         XC    0(256,R1),0(R1)                                                  
         AR    R1,RF                                                            
         SR    R0,RF                                                            
         B     COMCLR2                                                          
COMCLR4  LR    RF,R0                                                            
         BCTR  RF,0                                                             
         EX    RF,COMCLRXC                                                      
         BR    RE                                                               
COMCLRXC XC    0(0,R1),0(R1) *EXECUTED*                                         
*                                                                               
         DROP  R9,RB                                                            
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
* ROUTINE TO GET PRODUCT RECORD                                                 
*                                                                               
GETPRD   NMOD1 0,*GPRD*                                                         
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         XC    RPRDKEY,RPRDKEY     SET PRODUCT RECORD KEY                       
         MVI   RPRDKTYP,9                                                       
         MVC   RPRDKADV,RCONKADV                                                
         MVC   RPRDKPRD,RCONPRD                                                 
         LA    R4,RCREPFL                                                       
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP                                                        
         USING RSREPD,RE                                                        
         CLI   MASTREP,1           MASTER REP?                                  
         BNE   GETPRD1             NO                                           
         L     R4,ACONSREP         A(REP IN PROCESS)                            
*                                                                               
         DROP  RE,RF                                                            
*                                                                               
GETPRD1  MVC   RPRDKREP,0(R4)                                                   
         CLC   RPRDKEY,SVPRDKEY    TEST SAME AS SAVED PRODUCT KEY               
         BE    GETPRDX             YES-PRODUCT RECORD ALREADY READ              
         MVC   SVPRDKEY,RPRDKEY    NO-GET THE PRODUCT RECORD                    
         CLC   RCONPRD,SPACES                                                   
         BNH   GETPRDX                                                          
         MVC   SVKEY,KEY                                                        
         XC    KEY,KEY                                                          
         MVC   KEY(L'RPRDKEY),RPRDKEY                                           
         GOTO1 AHIGH                                                            
         CLC   KEY(L'RPRDKEY),KEYSAVE                                           
         BE    *+14                                                             
         XC    RPRDELEM(RPRDELMX-RPRDELEM),RPRDELEM  NOT FOUND-CLEAR            
         B     GETPRD2                               THE X'01' ELEM             
         GOTO1 AGETPROD                                                         
*                                                                               
GETPRD2  MVC   KEY,SVKEY           RESTORE READ SEQUENCE                        
         GOTO1 AHIGH                                                            
*                                                                               
GETPRDX  EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
SVPRDKEY DC    XL(L'RPRDKEY)'00'   SAVED PRODUCT RECORD KEY                     
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
* CHECK FOR CROSS-FILE REQUEST.  IF FOUND, ACCESS EACH REQUESTED                
*        FILE IN TURN TO BUILD A MARKET/STATION LIST, THEN                      
*        SORT INTO MARKET NUMBER SEQUENCE.  THIS WILL REPLACE THE               
*        MARKET NUMBER FOR CROSS-FILE SEQUENCING.                               
*        THE TABLE IS LOCATED 1,055,000 BYTES PAST ASPACEND.                    
*                                                                               
*                                                                               
CHKXFIL  NMOD1 0,*XFIL*                                                         
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         MVC   SAVRPKEY,RREPREC    SAVE REP KEY FOR RESTORE                     
         MVI   XFILYES,C'N'        SET 'CROSS-FILE=NO'                          
         MVI   ORIGUTL,0           CLEAR ORIGINAL UTL                           
*        MVC   P+1(05),=C'QREC3'                                                
*        MVC   P+10(80),QRECORD3                                                
*        GOTO1 REPORT                                                           
         LA    R1,QRECORD3                                                      
         USING QREC3,R1                                                         
*                                                                               
         CLC   Q3XFILNM,SPACES     MULTI-FILE REQUEST?                          
         BE    CHKX0800            NO  - BYPASS MULTIFILE SETUP                 
         OC    Q3XFILNM,Q3XFILNM   MULTI-FILE REQUEST?                          
         BZ    CHKX0800            NO  - BYPASS MULTIFILE SETUP                 
*                                                                               
         MVI   XFILYES,C'Y'        SET 'CROSS-FILE=YES'                         
         LA    R3,MSFILCOD         SET A(REPS LIST FOR MKT/STN)                 
CHKX0020 EQU   *                                                                
         CLI   0(R3),0             END OF TABLE REACHED?                        
         BNE   *+6                 NO                                           
         DC    H'0'                YES - MUSTN'T HAPPEN                         
         CLC   Q3XFILNM,0(R3)      CROSS-FILE OPTION NAME FOUND?                
         BE    CHKX0040            YES                                          
*                                                                               
         DROP  R1                                                               
*                                                                               
         LA    R3,LMSFILCD(R3)     NO  - BUMP TO NEXT ITEM                      
         B     CHKX0020            GO BACK FOR NEXT                             
CHKX0040 EQU   *                                                                
         LA    R3,4(R3)            BUMP PAST OPTION NAME                        
         SR    R7,R7               CLEAR COUNTER                                
         L     R5,AMKTSTA          SET A(MARKET STATION TABLE AREA)             
         MVC   ORIGUTL,MSSENUM(R3) SAVE ORIGINAL UTL NUMBER                     
*                                                                               
*   FIRST REP IN TABLE IS THE SIGNON REP:  UTL IS ALREADY SET UP                
*        TO HANDLE IT.                                                          
*                                                                               
CHKX0050 EQU   *                                                                
         XC    CHKXSUBS,CHKXSUBS   CLEAR SUB-REP LIST                           
         MVC   CHKXSUBS(2),MSPOWRCD(R3)                                         
*                                  SET PRIMARY POWER CODE                       
         CLI   MSMSTFLG(R3),C'Y'   MASTER REP?                                  
         BNE   CHKX0120            NO                                           
         XC    KEY,KEY             YES - RETRIEVE REP REC FOR SUBREPS           
         MVI   KEY,1                                                            
         MVC   KEY+25(2),CHKXSUBS  INSERT PRIMARY POWER CODE                    
         GOTO1 HIGHX               RETRIEVE KEY                                 
         CLC   KEY(27),KEYSAVE     KEY FOUND?                                   
         BE    *+6                 YES                                          
         DC    H'0'                NO  - MUST BE THERE                          
         GOTO1 GETREP              RETRIEVE REP RECORD                          
         LA    R1,RREPELEM         SET A(DESCRIPTOR ELEMENT)                    
CHKX0060 EQU   *                                                                
         CLI   0(R1),0             END OF RECORD?                               
         BE    CHKX0120            YES -                                        
         CLI   0(R1),2             SUBSIDIARY REP ELEMENT?                      
         BE    CHKX0080            YES                                          
         ZIC   RF,1(R1)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R1,RF                                                            
         B     CHKX0060            GO BACK FOR NEXT                             
CHKX0080 EQU   *                                                                
         ZIC   RF,RREPSCNT-RREPSUB(R1)                                          
*                                  GET COUNT OF SUBREPS                         
         LA    RE,CHKXSUBS                                                      
         LA    R1,RREPSCOD-RREPSUB(R1)                                          
*                                  SET A(SUBREPS IN ELEMENT)                    
CHKX0100 EQU   *                                                                
         MVC   0(2,RE),0(R1)       MOVE SUBREP TO TABLE                         
         LA    RE,2(RE)            BUMP TO NEXT TABLE POSITION                  
         LA    R1,2(R1)            BUMP TO NEXT SUBREP                          
         BCT   RF,CHKX0100         GO BACK FOR NEXT                             
CHKX0120 EQU   *                                                                
         LA    R4,CHKXSUBS         SET A(REP TABLE)                             
CHKX0140 EQU   *                                                                
         XC    KEY,KEY             CLEAR KEY                                    
         MVI   KEY,2               SET STATION RECORD TYPE                      
         MVC   KEY+20(2),0(R4)     INSERT REP CODE                              
         GOTO1 HIGHX               READ FIRST KEY                               
         B     CHKX0180                                                         
CHKX0160 EQU   *                                                                
         GOTO1 SEQX                                                             
CHKX0180 EQU   *                                                                
         CLC   KEY(22),KEYSAVE     SAME RECORD TYPE/REP?                        
         BNE   CHKX0220            NO  -                                        
***>>>   CLI   KEY+25,C'C'         COMBO STATION RECORD?                        
***>>>   BE    CHKX0160            YES - SKIP IT                                
         GOTO1 GETSTAX             YES - RETRIEVE STATION RECORD                
         MVC   0(20,R5),RSTAMKT    TABLE MARKET NAME                            
         MVC   20(5,R5),RSTAKSTA   TABLE STATION CALLS                          
         MVC   25(2,R5),RSTAKREP   TABLE STATION REP                            
         LA    R5,27(R5)           BUMP TO NEXT ENTRY IN TABLE                  
         LA    R7,1(R7)            INCREMENT STATION COUNT                      
         B     CHKX0160            GO BACK FOR NEXT                             
CHKX0220 EQU   *                                                                
         LA    R4,2(R4)            BUMP TO NEXT REP CODE                        
         OC    0(2,R4),0(R4)       ANY ENTRY?                                   
         BNZ   CHKX0140            GO BACK FOR NEXT                             
*                                                                               
         LA    R3,LMSFLNTR(R3)     BUMP TO NEXT TABLE ENTRY                     
*                                                                               
         L     R2,ADCONLST                                                      
         USING ADCONSD,R2                                                       
         L     R6,MASTC                                                         
         USING MASTD,R6                                                         
         L     RE,MCUTL            SET A(UTL)                                   
*                                                                               
         DROP R2,R6                                                             
*                                                                               
         MVC   4(1,RE),ORIGUTL     RESET FILE UTL                               
*                                     WITH ORIGINAL UTL                         
         CLI   0(R3),0             END OF TABLE?                                
         BE    CHKX0300            YES - LEAVE ORIGINAL UTL - FINISHED          
         MVC   4(1,RE),MSSENUM(R3)                                              
*                                  NO  - OVERRIDE FILE UTL                      
*                                     WITH REP UTL CODE                         
         GOTO1 DATAMGR,DMCB,=C'DMOPEN',=C'REP',FLIST,AREC                       
*                                     OPEN REP FILE                             
         B     CHKX0050            GO BACK AND PROCESS                          
*                                                                               
CHKX0300 EQU   *                                                                
         MVC   KEY,SAVRPKEY        RESET KEY                                    
         GOTO1 HIGHX               RETRIEVE KEY                                 
         CLC   KEY(27),KEYSAVE     KEY FOUND?                                   
         BE    *+6                 YES                                          
         DC    H'0'                NO  - MUST BE THERE                          
         GOTO1 GETREP              RETRIEVE REP RECORD                          
*                                     THIS RESETS ORIGINAL REP RECORD           
*                                                                               
*   TEST DISPLAY                                                                
*        L     R1,AMKTSTA          SET A(MKT STATION TABLE)                     
*CHKXT010 EQU   *                                                               
*        OC    0(4,R1),0(R1)       ANY ENTRY?                                   
*        BZ    CHKXT040            NO  - FINISHED                               
*        MVC   P+1(27),0(R1)                                                    
*        GOTO1 REPORT                                                           
*        LA    R1,27(R1)           BUMP TO NEXT ENTRY                           
*        B     CHKXT010            GO BACK FOR NEXT                             
*CHKXT040 EQU   *                                                               
         PRINT GEN                                                              
         GOTO1 =V(QSORT),DMCB,(0,AMKTSTA),(R7),27,20,0                          
         PRINT NOGEN                                                            
*        MVC   P+1(08),=C'POSTSORT'                                             
*        MVC   P+10(10),=C'SORT COUNT'                                          
*        EDIT  (R7),(8,P+32)                                                    
*        GOTO1 REPORT                                                           
*        GOTO1 REPORT                                                           
*        L     R1,AMKTSTA          SET A(MKT STATION TABLE)                     
*HKXT050 EQU   *                                                                
*        OC    0(4,R1),0(R1)       ANY ENTRY?                                   
*        BZ    CHKXT060            NO  - FINISHED                               
*        MVC   P+1(27),0(R1)                                                    
*        GOTO1 REPORT                                                           
*        LA    R1,27(R1)           BUMP TO NEXT ENTRY                           
*        B     CHKXT050            GO BACK FOR NEXT                             
*HKXT060 EQU   *                                                                
*                                                                               
CHKX0800 EQU   *                                                                
         XIT1                                                                   
CHKXSUBS DS    CL32                UP TO 16 SUB-REPS                            
ORIGUTL  DS    CL1                                                              
SAVRPKEY DS    CL27                                                             
         DS    0F                                                               
*                                                                               
*        DATA MANAGER INTERFACE (DIRECTORY)                                     
*                                                                               
         SPACE 1                                                                
HIGHX    NTR1                                                                   
         LA    RF,DMRDHI                                                        
         MVC   KEYSAVE,KEY                                                      
         B     LINKDIRX                                                         
*                                                                               
SEQX     NTR1                                                                   
         LA    RF,DMRSEQ                                                        
         MVC   KEYSAVE,KEY                                                      
         B     LINKDIRX                                                         
*                                                                               
LINKDIRX ST    RF,DMCB                                                          
         MVC   TRACEKEY,KEY                                                     
         MVC   DMCB(1),DMINBTS                                                  
         GOTO1 DATAMGR,DMCB,,REPDIR,KEY,KEY,0                                   
         B     DMCHEX                                                           
         EJECT                                                                  
*                                                                               
*        DATA MANAGER INTERFACE (FILE GETS)                                     
*                                                                               
GETREP   NTR1                                                                   
         LA    RF,RREPREC                                                       
         B     LINKFILX                                                         
*                                                                               
GETSTAX  NTR1                                                                   
         LA    RF,RSTAREC                                                       
         B     LINKFILX                                                         
*                                                                               
*                                                                               
LINKFILX LR    R2,RF                                                            
         GOTO1 DATAMGR,DMCB,(DMINBTS,GETREC),REPFILE,KEY+28,           X        
               (R2),(0,DMWORK)                                                  
         MVC   LASTIO,DMCB+12      SAVE THESE VALUES                            
         MVC   LASTDA,KEY+28                                                    
         MVC   LASTLEN,27(R2)                                                   
         B     DMCHEX                                                           
         EJECT                                                                  
*                                                                               
*        DATA MANAGER INTERFACE (CHECK ERRORS)                                  
*                                                                               
         SPACE                                                                  
DMCHEX   TM    DMCB+8,X'10'        TEST FOR RECORD NOT FOUND                    
         BZ    DM010X                                                           
         TM    29(R2),X'80'        IS RECORD MARKED FOR DELETION                
         BZ    DM020X              NO - ERROR                                   
         LTR   RB,RB               YES - RETURN WITH CC NE 0                    
         B     EXITX                                                            
*                                                                               
DM010X   TM    DMCB+8,X'EF'        TEST FOR OTHER ERRORS                        
         BZ    EXITX                                                            
*                                                                               
DM020X   MVC   WORK(41),=C'*** DATA MANAGER ERROR IN INPUT PHASE ***'           
         GOTO1 LOGIO,WORK+48,1,(41,WORK)                                        
         MVC   WORK(41),SPACES                                                  
         BASR  RE,RF                                                            
         BAS   RE,DMTRACX                                                       
         DC    H'0'            BLOW UP                                          
         EJECT                                                                  
*                                                                               
*        ROUTINE TO TRACE DATA MANAGER CALLS                                    
*                                                                               
         SPACE                                                                  
DMTRACX  NTR1                                                                   
         MVC   P,SPACES                                                         
         LM    R2,R5,DMCB                                                       
         MVC   TRACXDM8,DMCB+8                                                  
         MVC   P(8),0(R2)          COMMAND                                      
         MVC   P+10(8),0(R3)       FILE                                         
         LA    R6,4                                                             
         CLC   3(3,R3),=C'DIR'                                                  
         BNE   DMTRACX2                                                         
         LA    R4,TRACEKEY                                                      
         GOTO1 HEXOUT,DMCB,(R4),P+20,32,=C'N'                                   
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,(R1),(R5)                                                 
         GOTO1 HEXOUT,DMCB,(R5),P+20,32,=C'N'                                   
         B     DMTRACX4                                                         
*                                                                               
DMTRACX2 GOTO1 HEXOUT,DMCB,(R4),P+20,(R6),=C'N'                                 
         LA    R5,34(R5)                                                        
         GOTO1 HEXOUT,DMCB,(R5),P+75,25                                         
*                                                                               
DMTRACX4 DS    0H                                                               
         GOTO1 HEXOUT,DMCB,TRACXDM8,P+130,1                                     
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 REPORT                                                           
EXITX    XIT1                                                                   
         SPACE 2                                                                
TRACXDM8 DS    C                                                                
         DS    0H                                                               
         EJECT                                                                  
*                                                                               
*                                                                               
       ++INCLUDE REGENCRMKT                                                     
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
* MULTI-FILE INTERFACE                                                          
*                                                                               
MULTIPRE EQU   X'FC'                                                            
MULTIMOD EQU   X'FD'                                                            
*                                                                               
MULTIFIL NMOD1 0,*MULTIFIL*                                                     
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         L     R2,4(R1)            RESET A(QWORKAREA IN USE)                    
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
         LA    RF,RREPREC          SET A(IO WORK AREA)                          
         ST    RF,AREC                                                          
         OC    AREPSLST,AREPSLST   FIRST TIME THROUGH?                          
         BNZ   MUFI0060            NO  - USE STORED ADDRESS                     
*                                  YES - FIRST REP IS DONE:  SAVE NEXT          
         LA    RF,XFILCODE         SAVE A(REPS LIST)                            
MUFI0020 EQU   *                                                                
         CLI   0(RF),0             END OF TABLE REACHED?                        
         BNE   *+6                 NO                                           
         DC    H'0'                YES - ENTRY MUST BE IN TABLE                 
         CLC   0(4,RF),QWREQ3+(Q3XFILNM-QREC3)                                  
*                                  REQUEST CROSS-FILE NAME IN TABLE?            
         BE    MUFI0040            YES -                                        
         LA    RF,LXFILSET(RF)     NO  - BUMP TO NEXT ENTRY                     
         B     MUFI0020            GO BACK FOR NEXT                             
MUFI0040 EQU   *                                                                
         LA    RF,LXFILCDE(RF)     SKIP IDENTIFIER+CONTROL INFO                 
         ST    RF,AREPSLST         SAVE A(TABLE ENTRY)                          
MUFI0060 EQU   *                                                                
         GOTO1 DATAMGR,DMCB,(0,=C'DMOPEN'),=C'CONTROL',                +        
               =C'NCTFILE X',AREC,0                                             
         L     R1,AREPSLST                                                      
         CLI   0(R1),0             END OF LIST?                                 
         BE    MUFI0160            YES -                                        
         MVC   RCREPFL,RLPOWRCD(R1)                                             
*                                  SET NEXT POWER CODE                          
         MVC   QREP,RLPOWRCD(R1)   SET NEXT POWER CODE                          
         MVC   QWREQ+(QREP-QRECORD)(2),RLPOWRCD(R1)                             
*                                  SET NEXT POWER CODE                          
         MVC   QWREQ+(QGROUP-QRECORD)(1),RLGROUP(R1)                            
*                                  INSERT STATION GROUP FOR NEW FILE            
         MVC   QGROUP(1),RLGROUP(R1)  INSERT STATION GROUP                      
         MVC   FGROUP(1),RLGROUP(R1)  INSERT STATION GROUP AS FILTER            
*                                                                               
         XC    WORK,WORK                                                        
         MVI   WORK,C'I'           FIND CONTROL FILE ID RECORD                  
         MVC   WORK+15(05),0(R1)                                                
         MVC   WORK+20(05),SPACES                                               
*                                  LOAD AGENCY NAME AS TEST                     
         OC    WORK+15(10),SPACES  SET REMAINDER TO SPACES                      
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'CTFILE',WORK,AREC                     
         CLI   8(R1),0             FOUND?                                       
         BE    *+6                 YES                                          
         DC    H'0'                SHOULD HAVE BEEN THERE....                   
         L     R1,AREC                                                          
         CLC   WORK(25),0(R1)      CHECK THE KEY                                
         BE    *+6                 SAME - OKAY                                  
         DC    H'0'                DIFFERS - DUMP IT OUT                        
*                                                                               
*   TEST                                                                        
*        MVC   P+1(04),=C'CTL='                                                 
*        MVC   P+6(25),0(R1)                                                    
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         LA    R1,28(R1)           FIND SYS AUTHORIZATION ELEMENT               
MUFI0080 EQU   *                                                                
         CLI   0(R1),X'21'         AUTH ELEMENT?                                
         BNE   MUFI0100            NO                                           
         CLI   2(R1),X'08'         IS IT 'REP' SYSTEM?                          
         BE    MUFI0120            YES                                          
MUFI0100 EQU   *                                                                
         ZIC   R0,1(R1)            BUMP TO NEXT ELEMENT                         
         AR    R1,R0                                                            
         CLI   0(R1),0             END OF RECORD                                
         BNE   MUFI0080            NO                                           
         DC    H'0'                NO X'21' - DUMP IT OUT                       
MUFI0120 EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        L     RF,ADCONLST                                                      
*        USING ADCONSD,RF                                                       
*        MVC   DBCOMFCS,VCOMFACS                                                
*        DROP  RF                                                               
*        L     RF,DBCOMFCS                                                      
*        MVC   P+1(07),=C'COMFACS'                                              
*        MVC   P+10(1),3(R1)                                                    
*        MVC   P+15(40),0(RF)                                                   
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         L     R3,ADCONLST                                                      
         USING ADCONSD,R3                                                       
         L     R6,MASTC                                                         
         USING MASTD,R6            USING STILL IN EFFECT                        
         L     RE,MCUTL            SET A(UTL)                                   
*                                                                               
         DROP R3,R6                                                             
*                                                                               
         MVC   4(1,RE),3(R1)       OVERRIDE CONTROL FILE UTL                    
*                                     WITH REP UTL CODE                         
*  OPEN REP FILE                                                                
*                                     WITH REP UTL CODE                         
         GOTO1 DATAMGR,DMCB,=C'DMOPEN',=C'REP',FLIST,AREC                       
         SPACE 1                                                                
***>>>                                                                          
         XC    RREPKEY,RREPKEY     CLEAR KEY                                    
         MVI   RREPKTYP,1          INSERT KEY TYPE                              
*                                                                               
***>>>   MVC   RREPKEY+25(2),=C'FN'                                             
         MVC   KEY(27),RREPKEY     SET KEY FOR READ                             
         GOTO1 AHIGH                                                            
*                                                                               
*                         1.3.5.7.9.1.3.5.7.9.1                                 
*        MVC   P+1(21),=C'REP RECORD FOUND? YES'                                
***>>>   CLC   KEY(27),KEYSAVE     RECORD FOUND?                                
***>>>   BE    MUFI0140            YES                                          
***>>>   MVC   P+19(3),=C'NO '                                                  
MUFI0140 EQU   *                                                                
****     GOTO1 REPORT                                                           
****     MVC   P+1(04),=C'KEY='                                                 
****     MVC   P+6(27),KEY                                                      
****     GOTO1 REPORT                                                           
         GOTO1 GETCONA                                                          
****     MVC   P+1(04),=C'REC='                                                 
****     MVC   P+6(27),RCONREC                                                  
****     GOTO1 REPORT                                                           
*                                                                               
                                                                                
         L     R1,AREPSLST         BUMP TO NEXT ENTRY                           
         MVC   MODE,RLMODECD(R1)   INSERT NEXT MODE CODE                        
         LA    R1,LREPSLST(R1)                                                  
         ST    R1,AREPSLST         PUT BACK A(NEXT ITEM)                        
         SR    R0,R0               SET CC = ZERO:                               
         B     MUFI0180                                                         
*                                     -> ANOTHER FILE TO PROCESS                
***>>>   B     MUFI0060             GO BACK FOR NEXT                            
*                                  DON'T LOOP BACK:  SHOULD GO OUT,             
*                                     THEN RETURN TO FILCON TO RELOAD           
*                                        SPACEND TABLE                          
MUFI0160 EQU   *                                                                
         GOTO1 REPORT                                                           
         MVC   P+1(08),=C'ALL REPS'                                             
         GOTO1 REPORT                                                           
         LTR   RB,RB               SET CC NOT ZERO                              
*                                     -> NO MORE FILES                          
***>>>   DC    H'0'                                                             
MUFI0180 EQU   *                                                                
         XIT1                                                                   
FLIST    DS    0H                                                               
         DC    CL8'NREPFILE'                                                    
         DC    CL8' REPDIR '                                                    
         DC    CL8'X       '                                                    
SAVEUTL  DS    X                                                                
AREC     DS    A                                                                
AREPSLST DC    F'0'                                                             
*                                                                               
*                                                                               
       ++INCLUDE REGENCROSS                                                     
*                                                                               
         EJECT                                                                  
GETCONA  NTR1                                                                   
         LA    RF,RCONREC                                                       
         B     LINKFILA                                                         
*                                                                               
*                                                                               
LINKFILA LR    R2,RF                                                            
         GOTO1 DATAMGR,DMCB,(DMINBTS,GETREC),REPFILE,KEY+28,           X        
               (R2),(0,DMWORK)                                                  
         MVC   LASTIO,DMCB+12      SAVE THESE VALUES                            
         MVC   LASTDA,KEY+28                                                    
         MVC   LASTLEN,27(R2)                                                   
         EJECT                                                                  
*                                                                               
*        DATA MANAGER INTERFACE (CHECK ERRORS)                                  
*                                                                               
         SPACE                                                                  
         TM    DMCB+8,X'10'        TEST FOR RECORD NOT FOUND                    
         BZ    DM010A                                                           
         TM    29(R2),X'80'        IS RECORD MARKED FOR DELETION                
         BZ    DM020A              NO - ERROR                                   
         LTR   RB,RB               YES - RETURN WITH CC NE 0                    
         B     MUFI0800                                                         
*                                                                               
DM010A   TM    DMCB+8,X'EF'        TEST FOR OTHER ERRORS                        
         BZ    MUFI0800                                                         
*                                                                               
DM020A   MVC   WORK(41),=C'*** DATA MANAGER ERROR IN INPUT PHASE ***'           
         GOTO1 LOGIO,WORK+48,1,(41,WORK)                                        
         MVC   WORK(41),SPACES                                                  
         BASR  RE,RF                                                            
         BAS   RE,DMTRACA                                                       
         DC    H'0'            BLOW UP                                          
         EJECT                                                                  
*                                                                               
*        ROUTINE TO TRACE DATA MANAGER CALLS                                    
*                                                                               
         SPACE                                                                  
DMTRACA  NTR1                                                                   
         MVC   P,SPACES                                                         
         LM    R2,R5,DMCB                                                       
         MVC   TRACADM8,DMCB+8                                                  
         MVC   P(8),0(R2)          COMMAND                                      
         MVC   P+10(8),0(R3)       FILE                                         
         LA    R6,4                                                             
         CLC   3(3,R3),=C'DIR'                                                  
         BNE   DMTRACA2                                                         
         LA    R4,TRACEKEY                                                      
         GOTO1 HEXOUT,DMCB,(R4),P+20,32,=C'N'                                   
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,(R1),(R5)                                                 
         GOTO1 HEXOUT,DMCB,(R5),P+20,32,=C'N'                                   
         B     DMTRACA4                                                         
*                                                                               
DMTRACA2 GOTO1 HEXOUT,DMCB,(R4),P+20,(R6),=C'N'                                 
         LA    R5,34(R5)                                                        
         GOTO1 HEXOUT,DMCB,(R5),P+75,25                                         
*                                                                               
DMTRACA4 DS    0H                                                               
         GOTO1 HEXOUT,DMCB,TRACADM8,P+130,1                                     
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 REPORT                                                           
         B     MUFI0800                                                         
         SPACE 2                                                                
MUFI0800 EQU   *                                                                
         XIT1                                                                   
TRACADM8 DS    C                                                                
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
***>>>                                                                          
*                                                                               
*        ROUTINE TO POST THE MONTH TABLE                                        
*                                                                               
         SPACE                                                                  
POSTMNTH NMOD1 0,*PMTH*                                                         
*                                                                               
         L     RC,0(R1)            RESET A(WORKSPACE)                           
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 SET PREVIOUSLY, AND PASSED IN - DON'T CHANGE                             
*                                                                               
*                                                                               
         L     R4,ANEWMON          A(NEW MONTH TABLE)                           
*                                                                               
*   TEST                                                                        
**       CLC   =X'04973382',RCONKCON                                            
**       BNE   TEST002X                                                         
**       LTR   RB,RB                                                            
TEST002X EQU   *                                                                
*   TEST END                                                                    
*                                                                               
         XC    DMCB(24),DMCB                                                    
         LA    R1,QWKEYMON         A(KEY MONTH FOR ACCNTG REPORTS)              
         ST    R1,DMCB+20                                                       
         MVI   DMCB+20,C'R'        SET 'SOURCE=RRG' INDICATOR                   
         CLI   QWCURST3+2,0        ANY DAY IN START DATE?                       
*                                                                               
         BE    PM0010              NO  - NOT ACTIVITY REPORT                    
         LA    R1,QWMONACT         YES - ACTIVITY DATES                         
         ST    R1,DMCB+16                                                       
PM0010   EQU   *                                                                
         MVC   DMCB+16(1),QWACCOPT INSERT ACCOUNTING OPTION                     
         CLI   QWACCOPT,C' '       ANY ACCOUNTING OPTION?                       
         BNE   PM0020              YES - LEAVE IT                               
         MVI   DMCB+16,C'P'        NO  - INSERT PENNIES OPTION                  
PM0020   EQU   *                                                                
*                                                                               
*   EACH CONTRACT IS LOOKED AT FOR EACH REPORT TO BE PROCESSED.  IF             
*        THE CONTRACT HAS ALREADY BEEN BUCKETED, AND THE BASIS OF               
*        THE ANALYSIS IS THE SAME (ACCOUNTING REPORT VS BILLING                 
*        REPORT), DON'T REBUCKET THE ORDER.                                     
*                                                                               
         CLC   RCONKCON,OLDCON     CONTRACT NUMBER ALREADY SEEN?                
         BNE   PM0040              NO  - EXPLODE IT AGAIN                       
*                                                                               
*   SAME:  CHECK FOR DIFFERING AS-AT DATES                                      
*                                                                               
         LA    RF,QWREQ            SET A(1ST REQUEST RECORD OF SET)             
         CLC   QASAT-QRECORD(RF),OLDASAT                                        
         BNE   PM0040              DIFFERENT AS-AT DATES: READ                  
*                                                                               
*   SAME:  CHECK FOR DIFFERENCES WITHIN BILLING/ACCOUNTING                      
*                                                                               
         MVI   TSTACCOP,0          SET TO 'BILLING REPORT'                      
         CLI   QWACCOPT,C'A'       NO  - REQUEST FOR ACCOUNT OPTION?            
         BE    PM0030              YES                                          
         CLI   QWACCOPT,C'T'       NO  - REQUEST FOR ACCOUNT OPTION?            
         BNE   PM0035              NO                                           
PM0030   EQU   *                   ACCOUNT OPTION: CHECK AGAIN                  
         MVI   TSTACCOP,1          SET TO 'ACCOUNTING REPORT'                   
PM0035   EQU   *                   ACCOUNT OPTION: CHECK AGAIN                  
         CLC   OLDACCOP,TSTACCOP   SAME REPORT BASIS?                           
         BNE   PM0040              NO  - REEXPLODE                              
         LA    RF,QWREQ3           ALTERNATE VS BROADCAST CAL                   
         USING QREC3D,RF                                                        
*                                                                               
         CLC   Q3ALTCAL,OLDALTCL   THIS REQUEST VS PRIOR REQUEST                
         BE    PM0060              SAME - DON'T REEXPLODE                       
*                                  NOT SAME - REEXPLODE                         
         DROP  RF                                                               
PM0040   EQU   *                                                                
         LA    RF,QWREQ3                                                        
         USING QREC3D,RF                                                        
*                                                                               
         XC    DBLOCK,DBLOCK       CLEAR BLOCK FOR DATCON/ADDAY/GETDAY          
         MVC   DBLOCK(4),DATCON                                                 
         MVC   DBLOCK+4(4),ADDAY                                                
         MVC   DBLOCK+8(4),GETDAY                                               
*                                                                               
         CLI   Q3ALTCAL,C'Y'       ALTERNATE CALENDAR DATA WANTED?              
         BE    PM0050              YES                                          
*                                  NO                                           
         CLI   Q3TRADE,C'Y'        TRADE DATA WANTED?                           
         BE    PM0052              YES                                          
*                                  NO                                           
         DROP  RF                                                               
*                                                                               
         GOTO1 =V(VALU5NEW),DMCB,RCONREC,(R4),QWMONINF,QWMONFOR,,,     X        
               DBLOCK                                                           
*                                  SEVENTH PARAMETER                            
         B     PM0055                                                           
PM0050   EQU   *                                                                
         GOTO1 =V(VALU5NEW),DMCB,(X'80',RCONREC),(R4),QWMONINF,        X        
               QWMONFOR,,,DBLOCK                                                
*                                  SEVENTH PARAMETER                            
         B     PM0055                                                           
PM0052   EQU   *                                                                
         GOTO1 =V(VALU5NEW),DMCB,(X'40',RCONREC),(R4),QWMONINF,        X        
               QWMONFOR,,,DBLOCK                                                
*                                  SEVENTH PARAMETER                            
         B     PM0055                                                           
PM0055   EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        CLC   =X'02661939',RCONKCON SPECIAL CONTRACT?                          
*        BNE   PMTEST20            NO                                           
*        MVC   P+1(07),=C'SPECIAL'                                              
*        GOTO1 REPORT                                                           
*        L     RF,ACONSPEC         DISPLAY CHARACTERS                           
*        MVC   P+1(64),0(RF)                                                    
*        GOTO1 REPORT                                                           
*        L     R6,ANEWMON          SET A(AREA TO DISPLAY)                       
*        GOTO1 =V(PRNTBL),DMCB,0,(R6),C'DUMP',1960,=C'2D'                       
PMTEST20 EQU   *                                                                
*   TEST END                                                                    
*                                                                               
*                                                                               
*   TEST                                                                        
*        MVC   P+1(06),=C'VALU2='                                               
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+7,4,=C'TOG'                               
*        GOTO1 HEXOUT,DMCB,OLDCON,P+17,4,=C'TOG'                                
*        MVC   P+27(1),QWACCOPT                                                 
*        MVI   P+28,C'/'                                                        
*        MVC   P+29(1),OLDACCOP                                                 
*        LA    RF,QWREQ                                                         
*        MVC   P+31(6),QASAT-QRECORD(RF)                                        
*        MVI   P+37,C'/'                                                        
*        MVC   P+38(6),OLDASAT                                                  
*        MVI   P+44,C'/'                                                        
*        MVC   P+45(6),QWMONFOR                                                 
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         LA    RF,QWREQ3                                                        
         USING QREC3D,RF                                                        
*                                                                               
         CLI   Q3ALTCAL,C'Y'       ALTERNATE CALENDAR DATA WANTED?              
         BE    PM0060              YES                                          
*                                                                               
         DROP  RF                                                               
*                                                                               
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP                                                        
         USING RSREPD,RE                                                        
         CLI   REPCLOSD,C'Y'       REP DEFAULTS TO INV CLOSE DATE?              
         BNE   PM0060              NO  - DON'T EVEN CHECK                       
         CLC   =C'ACC-BBL',RCONBUYR    YES - BACK BILLING ORDER FROM            
*                                     SFM/BACKHIST?                             
         BE    PM0060              YES - DON'T RESET BITS                       
*                                                                               
         DROP  RE,RF                                                            
*                                                                               
*                                  R2 -> ANEWMON TABLE                          
*                                  RCONREC -> STATION IN QUESTION               
         CLI   NRRGFLAG,C'Y'       SPECIAL OPTION FOR NRRGON?                   
         BE    PM0058              YES                                          
         GOTO1 =A(SETVALU2),DMCB,(RC),(R2),QWMONFOR,QWCURST3                    
         B     PM0060                                                           
*                                                                               
PM0058   EQU   *                                                                
         GOTO1 =A(SETVALU3),DMCB,(RC),(R2),QWMONFOR,QWCURST3                    
*                                                                               
PM0060   EQU   *                                                                
         MVC   OLDCON,RCONKCON     SET LAST CONTRACT                            
         MVC   OLDACCOP,TSTACCOP   SET LAST REPORT BASIS                        
         LA    RF,QWREQ                                                         
         MVC   OLDASAT,QASAT-QRECORD(RF)                                        
*                                  SET LAST AS-AT DATE                          
         LA    RF,QWREQ3                                                        
         USING QREC3D,RF                                                        
*                                                                               
         MVC   OLDALTCL,Q3ALTCAL   SAVE ALT CAL FLAT                            
*                                                                               
         DROP  RF                                                               
*                                                                               
PM999    EQU   *                                                                
         XIT1                                                                   
*                                                                               
OLDCON   DS    CL4                 PREVIOUS CONTRACT NUMBER                     
OLDACCOP DS    CL1                 PREVIOUS ACCOUNT OPTION                      
TSTACCOP DS    CL1                 TEST OF ACCOUNTING OPTION FIELD              
OLDALTCL DS    CL1                 PREVIOUS ALTERNATE CALENDAR                  
OLDASAT  DS    CL6                 PREVIOUS AS-AT DATE                          
*                                                                               
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
       ++INCLUDE RESETVAL                                                       
       ++INCLUDE RESETVALA                                                      
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*        ROUTINE TO DETERMINE A CONTRACT'S AVAIL STATUS                         
*        INPUT : R1 = A(RUN DATE)                                               
*        OUTPUT: AVLMSK X'01' CONTRACT RESOLVED OR NOT CREATED BY               
*                             CURRENT RUN DATE                                  
*                       X'02' CONTRACT RESOLVED OR NOT CREATED BY               
*                             PRIOR RUN DATE                                    
*                       X'80' CONTRACT RESOLVED                                 
         SPACE                                                                  
CONAVL   NMOD1 0,*CAVL*                                                         
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         L     R1,4(R1)            RESET A(RUN DATE)                            
         MVI   AVLMSK,0                                                         
         MVC   CURRUNDT,0(R1)      CURRENT RUN DATE                             
         MVC   PRIRUNDT,0(R1)                                                   
         ZIC   RF,0(R1)                                                         
         BCTR  RF,0                                                             
         STC   RF,PRIRUNDT         PRIOR RUN DATE                               
         XC    SPLDT,SPLDT                                                      
         TM    RCONMODR,X'10'      BUYLINE(S) ENTERED?                          
         BNO   CA005               NO                                           
         OI    AVLMSK,RESOLVED     YES - RESOLVED                               
         B     CA050                                                            
CA005    EQU   *                                                                
         LA    R4,RCONELEM         BROWSE ELEMENTS FOR MONEY                    
         SR    R5,R5                                                            
*                                                                               
CA010    IC    R5,1(R4)            FIND NEXT ELEMENT                            
         LTR   R5,R5                                                            
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R4,R5                                                            
         CLI   0(R4),0                                                          
         BE    CA050                                                            
         CLI   0(R4),3             ORDERED BUCKET ELEMENT                       
         BNE   CA020                                                            
*                                                                               
*   BUCKETS ARE ACCEPTED REGARDLESS OF AMOUNT VALUE                             
*                                                                               
****>>>> OC    6(4,R4),6(R4)       AMOUNT                                       
****>>>> BZ    CA010                                                            
         OI    AVLMSK,RESOLVED     NON-ZERO - RESOLVED                          
         B     CA010                                                            
*                                                                               
CA020    CLI   0(R4),4             ACTUAL BUCKET ELEMENT                        
         BNE   CA030                                                            
****>>>> OC    6(4,R4),6(R4)       AMOUNT                                       
****>>>> BZ    CA010                                                            
         OI    AVLMSK,RESOLVED     NON-ZERO - RESOLVED                          
         B     CA010                                                            
*                                                                               
CA030    CLI   0(R4),6             SPL ELEMENT                                  
         BNE   CA010                                                            
         OC    5(3,R4),5(R4)       TEST FOR DATE                                
         BZ    CA035                                                            
         MVC   SPLDT,5(R4)         YES - THEREFORE RESOLVED                     
         OI    AVLMSK,RESOLVED                                                  
         B     CA010                                                            
*                                                                               
CA035    LA    R3,9(R4)            BROWSE MINI ELEMENTS FOR AMOUNT              
         ZIC   RF,8(R4)                                                         
*                                                                               
CA040    OC    5(4,R3),5(R3)                                                    
         BZ    *+12                                                             
         OI    AVLMSK,RESOLVED     SPL AMOUNT FOUND - RESOLVED                  
         B     CA010                                                            
         LA    R3,9(R3)                                                         
         BCT   RF,CA040                                                         
         B     CA010                                                            
*                                                                               
CA050    TM    AVLMSK,RESOLVED     END OF ELEMENTS - TEST FOR RESOLVED          
         BZ    CA070                                                            
         LA    R5,RCONCREA         YES - FIND RESOLUTION DATE                   
         OC    SPLDT,SPLDT                                                      
         BZ    CA060                                                            
         CLC   RCONCREA,SPLDT      RESOLVED ON EARLIER OF BUYLINE 1             
         BNH   CA060               AND SPL DATE                                 
         LA    R5,SPLDT                                                         
*                                                                               
CA060    CLC   0(3,R5),PRIRUNDT                                                 
         BNH   CA090                                                            
         CLC   0(3,R5),CURRUNDT                                                 
         BH    CA070                                                            
         OI    AVLMSK,CURREJCT     RESOLVED BY CUR DATE                         
*                                                                               
CA070    LA    R3,RCONHDRD         CREATION DATE                                
         CLC   RCONHDRD,=X'550C03' OK FOR 12/03/85 PLUS                         
         BNL   CA080                                                            
         LA    R3,RCONCREA                                                      
         TM    AVLMSK,RESOLVED     TEST FOR CONTRACT RESOLVED                   
         BZ    CA080               NO - RCONCREA IS REAL CREATION DATE          
         GOTO1 DATCON,DMCB,(3,0(R5)),(0,WORK)    OTHERWISE SUBTRACT             
         MVC   DMCB+8(4),=F'-4'                  SOME DAYS FROM                 
         CLI   RCONKGRP,C'R'                     RESOLUTION DATE                
         BNE   *+10                                                             
         MVC   DMCB+8(4),=F'-1'                                                 
         GOTO1 ADDAY,DMCB,WORK,WORK+6                                           
         GOTO1 DATCON,DMCB,(0,WORK+6),(3,FULL)                                  
         LA    R3,FULL             ESTIMATED CREATION DATE                      
*                                                                               
CA080    CLC   0(3,R3),CURRUNDT                                                 
         BH    CA090                                                            
         CLC   0(3,R3),PRIRUNDT                                                 
         BNH   CA999                                                            
         OI    AVLMSK,PRIREJCT                                                  
         B     CA999                                                            
*                                                                               
CA090    OI    AVLMSK,REJECTED     CONTRACT REJECTED FOR CUR AND PRIOR          
*                                                                               
CA999    EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
* ROUTINE TO GET AND APPLY COMMISSION RATE TO A CONTRACT RECORD VALUE           
* INPUT  : R1=DOLLAR VALUE                                                      
*          SVMONTH=Y/M                                                          
* OUTPUT : FULL=COMMISSION                                                      
*                                                                               
COMCON   NMOD1 0,*CMCN*                                                         
         L     RC,DMCB             RESET A(WORKSPACE)                           
         XC    FULL,FULL                                                        
         BAS   RE,COMRATE          LOOK FOR RATE ON DATE                        
         ICM   R3,15,FULL          ANY RATE RETURNED?                           
*                                     FULL = A(COMM RECORD FOUND)               
         BZ    COMCONX             NO  - EXIT                                   
         XC    FULL,FULL                                                        
         ICM   RE,15,NCOMRATE(R3)  RETRIEVE RATE                                
         BZ    COMCONX                                                          
         SR    R0,R0                                                            
         MR    R0,RE               MULTIPLY BY COMMISSION RATE                  
         SLDA  R0,1                DOUBLE COMMISSION CALCULATED                 
         D     R0,=F'1000000'      SIX  DECIMAL PLACE ALIGN                     
         LTR   R1,R1                                                            
         BM    *+8                                                              
         AH    R1,=H'1'                                                         
         SRA   R1,1                DIVIDE BY TWO                                
*                                                                               
*  THIS ENDS CALCULATION OF COMMISSION RATE BASED ON PRECISION                  
*    PASSED FROM VALU5NEW.  IT IS NOW NECESSARY TO BRING THE FINAL              
*    RESULT IN LINE WITH RESULTS PRODUCED BY REPORTER-DRIVEN                    
*    REPORTS.                                                                   
*                                                                               
         LR    R0,R1               MOVE RESULT TO R0,                           
*                                     OVERRIDING REMAINDER                      
         SR    R1,R1               WIPE OUT ORIGINAL RESULT                     
         SRDA  R0,31               DOUBLE RESULTS AGAIN BY MOVING               
*                                     VALUE BACK TO R1, LEAVING                 
*                                     SIGN BEHIND IN DOUBLE REGS                
*                                                                               
*   THE 'SRA' FOLLOWED BY THE 'SRDA' IS REQUIRED!  DON'T SAVE                   
*     INSTRUCTIONS BY REMOVING THESE>>>>  BIL UHR                               
*                                                                               
         D     R0,=F'100'          DIVIDE RESULT BY 100                         
         LTR   R1,R1                                                            
         BM    *+8                                                              
         AH    R1,=H'1'                                                         
         SRA   R1,1                DIVIDE BY TWO AGAIN                          
         MH    R1,=H'100'          DECIMAL ALIGN AGAIN                          
         ST    R1,FULL                                                          
*                                                                               
COMCONX  EQU   *                                                                
         XIT1                                                                   
*                                                                               
*                                                                               
*DISPCOMM NTR1                                                                  
*         LTR   R1,R1                                                           
*         BZ    DISPCOMX                                                        
*         EDIT  (R1),(12,P+2),2                                                 
*         EDIT  (R4),(12,P+20)                                                  
*         GOTO1 REPORT                                                          
*DISPCOMX EQU   *                                                               
*         XIT1                                                                  
         EJECT                                                                  
*                                                                               
*        COMRATE --- GET A COMMISSION RATE FOR THE CURRENT ENTRY                
*                                                                               
*            SVMONTH = YYMM OF CONTRACT $$                                      
*            FULL    = A(COMMISSION RECORD FOUND)                               
*                                                                               
COMRATE  NTR1                                                                   
*                                                                               
*                                                                               
         ZICM  R0,NUMRATES,1       ANY RECORDS IN TABLE?                        
         BZ    CRAT0090            NO  - EXIT                                   
*                                                                               
         L     R3,=A(COMTAB)         A(COMMISSION TABLE)                        
*                                                                               
*        GET GENERIC RATE FIRST (NON OFFICE/ADV/TYPE)                           
*                                                                               
CRAT0010 EQU   *                                                                
         OC    NCOMOFF(NCOMDATE-NCOMOFF,R3),NCOMOFF(R3)                         
*                                           PAST GENERIC DATES?                 
         BNZ   CRAT0040                     YES                                 
         OC    NCOMSTAT(2,R3),NCOMSTAT(R3)  AT END OF TABLE?                    
         BZ    CRAT0090                     YES                                 
CRAT0020 EQU   *                                                                
         CLC   SVMONTH,NCOMDATE(R3)   DATE VS EFFECT DATE                       
         BL    CRAT0030               PAST ACCEPTABLE DATE                      
*                                                                               
         ST    R3,FULL                SAVE A(COMM RECORD ENTRY)                 
CRAT0030 EQU   *                                                                
         LA    R3,LCOMTAB(R3)                                                   
         B     CRAT0010                                                         
*                                                                               
*        LOOK FOR A SPECIFIC RATE                                               
*                                                                               
CRAT0040 EQU   *                                                                
         CLC   NCOMOFF(2,R3),RCONKOFF      MATCH ON OFFICE                      
         BNE   CRAT0070                    NO, GET NEXT                         
         OC    NCOMADV(4,R3),NCOMADV(R3)   DO WE HAVE AN ADV CODE               
         BZ    CRAT0050                    NO, TAKE THIS RATE                   
*                                                                               
         CLC   RCONKADV(4),NCOMADV(R3)     MATCH ON ADV                         
         BNE   CRAT0070                    NO, GET NEXT                         
         OC    NCOMTYP(1,R3),NCOMTYP(R3)   DO WE HAVE A TYPE CODE               
         BZ    CRAT0050                    NO, TAKE THIS RATE                   
*                                                                               
         CLC   RCONTYPE(1),NCOMTYP(R3)                                          
         BNE   CRAT0070                                                         
*                                                                               
CRAT0050 EQU   *                                                                
         CLC   SVMONTH,NCOMDATE(R3)        DATE VS EFFECT DATE                  
         BL    CRAT0070                    PAST ACCEPTABLE DATE                 
CRAT0060 EQU   *                                                                
         ST    R3,FULL                     SAVE A(COMM RECORD ENTRY)            
CRAT0070 EQU   *                                                                
         LA    R3,LCOMTAB(R3)               BUMP TO NEXT ENTRY                  
         OC    NCOMSTAT(2,R3),NCOMSTAT(R3)  AT END OF TABLE?                    
         BZ    CRAT0090                     YES                                 
         B     CRAT0040                                                         
CRAT0080 EQU   *                                                                
*                                                                               
*        COMRATE EXIT                                                           
*                                                                               
CRAT0090 EQU   *                                                                
         SR    R0,R0                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*        ROUTINE TO PROCESS BUDGET RECORDS                                      
*                                                                               
         DS    0F                                                               
BUDREC   NMOD1 0,*BUDREC*,R9                                                    
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         MVI   USESPBUD,C'N'       CLEAR 'NEED S/P BUDGETS' FLAG                
         L     R1,=A(COMTAB)       CLEAR FIRST ENTRY IN COMMISSION TAB          
         XC    0(LCOMTAB,R1),0(R1)                                              
         L     R2,AQWORK           SCAN REQUESTS FOR BUDGET YEARS               
         USING QWKD,R2                                                          
         SR    R3,R3                                                            
         SR    R4,R4               R4 = LOWEST BUDGET YEAR                      
         SR    R5,R5               R5 = HIGHEST BUDGET YEAR                     
         CLI   QWBUDGET,C'Y'                                                    
         BNE   BURC0040            REQUEST DOESN'T NEED BUDGETS                 
*                                                                               
*   TEST BUDGETS                                                                
*        MVC   P+1(11),=C'NEED BUDGET'                                          
*        GOTO1 REPORT                                                           
*   TEST END BUDGETS                                                            
*                                                                               
         IC    R5,QWCURND          HI YR                                        
*                                                                               
BURC0020 EQU   *                                                                
*                                                                               
*   BUDGET IS BEING USED:  IS S/P BUDGET BEING ASKED FOR?                       
*                                                                               
         LA    RF,QWREQ3                                                        
         USING QREC3,RF                                                         
         CLI   Q3SALBUD,C'Y'       THIS REQUEST USES S/P  BUDGETS?              
         BNE   BURC0030            NO  - CHECK FOR REGULAR BUDGET               
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVI   USESPBUD,C'Y'       YES - SET 'NEED S/P BUDGET' FLAG             
BURC0030 EQU   *                                                                
         IC    R4,QWCURST          LO YR                                        
         CLI   RREPFMON,1                                                       
         BE    BURC0040                                                         
         BCTR  R4,0          FISCAL YR START NOT JAN - NEED PREVIOUS YR         
*                                                                               
BURC0040 EQU   *                                                                
*                                     TO PERMIT PRIOR YEAR BUDGETS              
*   TEST C*MPANY BUDGET                                                         
*        MVC   P+1(07),=C'R2(40)='                                              
*        STCM  R2,15,P+10                                                       
*        MVC   P+20(50),QWBUDGET                                                
*        GOTO1 REPORT                                                           
*   TEST C*MPANY BUDGET END                                                     
*                                                                               
         ICM   R2,7,QWNEXT         NEXT REQUEST                                 
         BZ    BURC0060            END OF REQUESTS                              
         CLI   QWBUDGET,C'Y'                                                    
         BNE   BURC0040            REQUEST DOESN'T NEED BUDGETS                 
         IC    R3,QWCURND                                                       
         CR    R3,R5                                                            
         BNH   *+6                                                              
         LR    R5,R3               INCREASE HI YR                               
         IC    R3,QWCURST                                                       
         CR    R3,R4                                                            
         BNH   BURC0020            DECREASE LO YR                               
         B     BURC0040            NEXT REQUEST                                 
*                                                                               
BURC0060 EQU   *                                                                
*                                                                               
*   NOTE:  WHEN CALCULATING THE BUDGET RANGE, THE PACKED FORMAT                 
*        ACCOUNTS FOR THE YEAR-2000 BREAK.  HOWEVER, WHEN UNPACKING             
*        THE DATE RANGE, THE RESULTING TWO-BYTE FIELDS COULD WIND               
*        UP AS 98/00.  THIS WILL RESULT IN THE SKIPPING OF YEAR-2000            
*        BUDGETS, WHICH ARE SET UP WITH DDS INTERNAL FORMAT DATES               
*        TO DESCRIBE 1ST DECADE, ETC (00 = X'F0F0', INTERNAL FORMAT             
*        IS X'FAF0').  THEREFORE, THE DATES ARE EXAMINED TO SEE IF              
*        THEY ARE 21ST CENTURY DATES, AND SET APPROPRIATELY BY                  
*        THE FOLLOWING CODE.                                                    
*                                                                               
         L     R2,AQWORK           RELOAD A(REQUEST WORK AREA)                  
         BCTR  R4,0                BACK LOW YEAR UP ONE YEAR                    
         CVD   R4,DUB                                                           
         UNPK  BUDLOYR(2),DUB+6(2)                                              
         CLI   BUDLOYR,X'F8'       20TH CENTURY YEAR?                           
         BNL   BURC0062            YES - DON'T SET INTERNAL BIT                 
         OI    BUDLOYR,X'FA'       LO YR + INTERNAL CONTROL                     
BURC0062 EQU   *                                                                
         OI    BUDLOYR+1,X'F0'     LO YR                                        
         CVD   R5,DUB                                                           
         UNPK  BUDHIYR(2),DUB+6(2)                                              
         CLI   BUDHIYR,X'F8'       20TH CENTURY YEAR?                           
         BNL   BURC0064            YES - DON'T SET INTERNAL BIT                 
         OI    BUDHIYR,X'FA'       HI YR + INTERNAL CONTROL                     
BURC0064 EQU   *                                                                
         OI    BUDHIYR+1,X'F0'     HI YR                                        
*                                                                               
*   TEST BUDGET RANGE: Y2K                                                      
*        MVC   P+1(14),=C'BUDGET: ST/END'                                       
*        MVC   P+20(2),BUDLOYR                                                  
*        MVC   P+24(2),BUDHIYR                                                  
*        GOTO1 REPORT                                                           
*   TEST BUDGET END                                                             
*                                                                               
         LA    R3,RCREPFL          A(REP ID)                                    
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP           A(MASTER/SUB REP TABLE)                      
         USING RSREPD,RE                                                        
         CLI   MASTREP,1           MASTER REP?                                  
         BNE   BURC0080            NO                                           
         LA    R3,SUBREPTB         A(MASTER/SUBSIDIARY TABLE)                   
         ST    R3,ACONSREP         STORE IT BACK                                
*                                                                               
         DROP  RE,RF                                                            
*                                                                               
*                                                                               
BURC0080 EQU   *                                                                
         XC    KEY,KEY                                                          
         MVI   KEY,X'13'                                                        
         MVC   KEY+16(2),0(R3)                                                  
         MVC   KEY+18(2),BUDLOYR                                                
         GOTO1 AHIGH               READ BUDGET RECORDS FROM LO YEAR             
*                                                                               
BURC0100 EQU   *                                                                
         L     R2,AQWORK           RELOAD A(REQUEST WORK AREA)                  
         CLC   KEY(20),KEYSAVE     REC TYPE/REP/YEAR SAME?                      
         BE    BURC0120            YES - PROCESS FURTHER                        
         CLC   KEY(18),KEYSAVE     NO  - REC TYPE/REP SAME?                     
         BNE   BURC0340            NO  - FINISHED                               
         CLC   BUDHIYR,KEY+18      YES - PAST END OF RANGE?                     
         BL    BURC0340            YES - BEYOND HI YR                           
*                                                                               
BURC0120 EQU   *                                                                
         GOTO1 AGETBUD             READ BUDGET RECORD                           
         BNZ   BURC0320                                                         
*                                     TO PERMIT PRIOR YEAR BUDGETS              
*                                                                               
***********************************************************************         
*                                                                               
*   NEED TO PASS ALL BUDGETS, AS SOME REQUESTS MAY BE FOR COMPANY               
*        BUDGETS, AND SOME MAY BE REQUESTS FOR REGULAR BUDGETS                  
*                                                                               
***********************************************************************         
*                                                                               
         CLC   RBUDKSTA,=C'WTCN '  *** AVOID WTCN                               
         BE    BURC0320            ***                                          
         CLC   RBUDKSTA,=C'WDMA '  *** AVOID WDMA                               
         BE    BURC0320            ***                                          
         MVC   DUB(2),RBUDKYR      SET UP TEMP DATE                             
         MVC   DUB+2(2),=C'01'     SET TO JANUARY                               
         MVC   DUB+4(2),=C'01'     SET TO FIRST                                 
         GOTO1 DATCON,DMCB,(0,DUB),(3,FULL)                                     
         MVC   BUDYR(1),FULL       BUDYR = BUDGET RECORD YEAR                   
**       PACK  DUB(8),RBUDKYR                                                   
**       CVB   R5,DUB                                                           
**       STC   R5,BUDYR            BUDYR = BUDGET RECORD YEAR                   
*                                                                               
*   TEST DISPLAY BUDGET VS ARRAY DATE                                           
*        MVC   P+1(08),=C'BUD/ARR='                                             
*        MVC   P+16(3),RBUDKYR                                                  
*        MVC   P+20(3),QWCURST                                                  
*        MVC   P+24(1),BUDYR                                                    
*        GOTO1 REPORT                                                           
*   TEST DISPLAY BUDGET VS ARRAY DATE END                                       
*                                                                               
*                                                                               
*   TEST C*MPANY BUDGET                                                         
*        MVC   P+1(08),=C'R2(180)='                                             
*        STCM  R2,15,P+10                                                       
*        MVC   P+20(50),QWBUDGET                                                
*        GOTO1 REPORT                                                           
*   TEST C*MPANY BUDGET END                                                     
*                                                                               
*                                                                               
BURC0200 EQU   *                                                                
         CLI   QWBUDGET,C'Y'                                                    
         BNE   BURC0300            THIS REQUEST DOESN'T NEED BUDGETS            
*                                                                               
         LA    RF,QWREQ3                                                        
         USING QREC3,RF                                                         
         CLI   Q3COMBUD,C'Y'       THIS REQUEST USES C*MP BUDGETS?              
         BNE   BURC0204            NO  - CHECK FOR REGULAR BUDGET               
         CLC   RBUDKSTA,=C'C*MP '  YES - IS THIS A COMPANY BUDGET?              
         BNE   BURC0300            NO  - DON'T APPLY BUDGET RECORD              
*                                     TO THIS REQUEST                           
         B     BURC0208            YES - PROCESS IT                             
                                                                                
BURC0204 EQU   *                                                                
         CLI   Q3SALBUD,C'Y'       THIS REQUEST USES S/P  BUDGETS?              
         BE    BURC0300            YES - DON'T APPLY STA BUDGET REC             
*                                                                               
*   TEST C*MPANY BUDGET                                                         
*        MVC   P+1(08),=C'NOT C*MP'                                             
*        MVC   P+12(12),QUESTOR                                                 
*        GOTO1 REPORT                                                           
*   TEST C*MPANY BUDGET END                                                     
*                                                                               
         DROP  RF                                                               
*                                  REGULAR BUDGETS NEEDED                       
         CLC   RBUDKSTA,=C'C*MP '  IS THIS A COMPANY BUDGET?                    
         BE    BURC0300            YES - DON'T APPLY BUDGET RECORD              
*                                     TO THIS REQUEST                           
BURC0208 EQU   *                                                                
         OC    QWREPSET,QWREPSET   REP SET FILTER?                              
         BZ    BURC0260            NO  - USE ANYTHING THAT COMES IN             
BURC0220 EQU   *                                                                
         L     RF,QWREPSET         SET A(REP SET)                               
BURC0240 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    BURC0300            YES - NO MATCH - SKIP THIS REP               
*                                     FOR THIS REQUEST                          
         CLC   RBUDKREP,0(RF)      NO  - REP IN REC IN SET?                     
         BE    BURC0260            YES - ACCEPT THIS REP                        
         LA    RF,2(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     BURC0240            GO BACK FOR NEXT                             
*                                                                               
BURC0260 EQU   *                                                                
         MVI   TOTSONLY,C'N'                                                    
*                                                                               
*   TEST C*MPANY BUDGET                                                         
*        MVC   P+1(08),=C'R2(260)='                                             
*        STCM  R2,15,P+10                                                       
*        MVC   P+20(50),QWBUDGET                                                
*        GOTO1 REPORT                                                           
*   TEST C*MPANY BUDGET END                                                     
*                                                                               
         GOTO1 =A(FILTBUD),DMCB,(RC)           FILTER RECORD THRU REQ           
         BE    BURC0280            OK                                           
         BL    BURC0300            NOT OK AND DON'T INCLUDE IN TOTALS           
         OC    QWTOTS,QWTOTS       TEST FOR TOALS REQUIRED                      
         BZ    BURC0300                                                         
         MVI   TOTSONLY,C'Y'       INDICATE TOTALS RECS ONLY                    
*                                                                               
BURC0280 EQU   *                                                                
*                                                                               
*   TEST BUDGETS                                                                
*        MVC   P+1(11),=C'0280 BUDGET'                                          
*        GOTO1 REPORT                                                           
*   TEST END BUDGETS                                                            
*                                                                               
         XC    NUMCTYPS(4),NUMCTYPS     INITIALIZE BUDGET WORKAREA              
         LA    RE,1                INITIALIZE 'TYPES COMPLETED' TO 1            
         STC   RE,CTYPDONE         FOR LOOP CONTROL LATER                       
         BAS   RE,CTYPCNTR         SET BUDGET TYPE COUNTER                      
         BAS   RE,POSTBUD          POST BUFFALO THIS REC/REQ                    
*                                                                               
BURC0300 ICM   R2,7,QWNEXT         NEXT REQUEST                                 
         BNZ   BURC0200                                                         
*                                                                               
BURC0320 GOTO1 ASEQ         END OF REQUESTS - READ NEXT BUDGET REC              
         B     BURC0100                                                         
*                                                                               
BURC0340 EQU   *                                                                
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP           A(MASTER/SUBSIDIARY TABLE)                   
         USING RSREPD,RE                                                        
         CLI   MASTREP,1           MASTER REP?                                  
         BNE   BURC0380            NO  - FINISHED                               
         L     R3,ACONSREP         GET NEXT CODE                                
BURC0360 EQU   *                                                                
         LA    R3,LSUBREP(R3)                                                   
         CLC   0(2,R3),=X'FFFF'    END OF TABLE?                                
         BE    BURC0380            YES - FINISHED                               
         ST    R3,ACONSREP         NO  - STORE ADRRESS BACK                     
         B     BURC0080            GO BACK FOR NEXT BUDGET                      
*                                                                               
         DROP  RE,RF                                                            
*                                                                               
BURC0380 EQU   *                                                                
*                                                                               
*   TEST SP BUD 2                                                               
*        MVC   P+1(08),=C'BURC0380'                                             
*        MVC   P+12(1),USESPBUD                                                 
*        MVC   P+14(1),QWBUDGET                                                 
*        GOTO1 REPORT                                                           
*   TEST SP BUD 2 END                                                           
*                                                                               
         CLI   USESPBUD,C'Y'       SALESPERSON BUDGETS NEEDED?                  
         BNE   BURC0400            NO                                           
         BAS   RE,SPBUDGET         YES - CYCLE S/P BUDGETS                      
*                                     AGAINST REQUESTS                          
BURC0400 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
         DROP  R2                                                               
         EJECT                                                                  
*                                                                               
*   SPBUDGET:  CYCLE SALESPERSON BUDGETS AGAINST ALL REQUESTS                   
*                                                                               
SPBUDGET NTR1                                                                   
**-->>                                                                          
*                                                                               
         L     R2,AQWORK           SCAN REQUESTS FOR BUDGET YEARS               
         USING QWKD,R2                                                          
*                                                                               
         LA    R3,RCREPFL          A(REP ID)                                    
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP           A(MASTER/SUB REP TABLE)                      
         USING RSREPD,RE                                                        
         CLI   MASTREP,1           MASTER REP?                                  
         BNE   SPBU0080            NO                                           
         LA    R3,SUBREPTB         A(MASTER/SUBSIDIARY TABLE)                   
         ST    R3,ACONSREP         STORE IT BACK                                
*                                                                               
         DROP  RE,RF                                                            
*                                                                               
*                                                                               
SPBU0080 EQU   *                                                                
         XC    KEY,KEY                                                          
         MVI   KEY,X'15'                                                        
         CLI   RREPPROF+16,C'S'    S/P BUDGETS INCLUDE STATION?                 
         BNE   SPBU0090            NO  - SET UP 1505 KEY                        
         MVI   KEY+1,X'04'         YES - SET UP 1504 KEY                        
         MVC   KEY+13(2),0(R3)     INSERT REP CODE                              
         MVC   KEY+15(2),BUDLOYR   INSERT LOW YEAR                              
         B     SPBU0095                                                         
SPBU0090 EQU   *                                                                
         MVI   KEY+1,X'05'         SET UP 1505 KEY                              
         MVC   KEY+13(2),0(R3)                                                  
         MVC   KEY+15(2),BUDLOYR                                                
SPBU0095 EQU   *                                                                
         GOTO1 AHIGH               READ BUDGET RECORDS FROM LO YEAR             
*                                                                               
SPBU0100 EQU   *                                                                
         L     R2,AQWORK           RELOAD A(REQUEST WORK AREA)                  
         CLC   KEY(17),KEYSAVE     YES - REC TYPE/REP/YEAR SAME?                
         BE    SPBU0120            YES - PROCESS FURTHER                        
         CLC   KEY(15),KEYSAVE     NO  - REC TYPE/REP SAME?                     
         BNE   SPBU0340            NO  - FINISHED                               
         CLC   BUDHIYR,KEY+15      YES - PAST END OF RANGE?                     
         BL    SPBU0340            YES - BEYOND HI YR                           
SPBU0120 EQU   *                                                                
         GOTO1 AGETBUD             READ BUDGET RECORD                           
         BNZ   SPBU0320                                                         
*                                                                               
*   TEST SP BUD 1                                                               
*        MVC   P+1(08),=C'SPBU0120'                                             
*        MVC   P+12(27),RSBDREC    INSERT KEY                                   
*        GOTO1 REPORT                                                           
*   TEST SP BUD 1 END                                                           
*                                                                               
*                                     TO PERMIT PRIOR YEAR BUDGETS              
*                                                                               
         MVC   DUB(2),RSBDKYR      SET UP TEMP DATE                             
         MVC   DUB+2(2),=C'01'     SET TO JANUARY                               
         MVC   DUB+4(2),=C'01'     SET TO FIRST                                 
         GOTO1 DATCON,DMCB,(0,DUB),(3,FULL)                                     
         MVC   BUDYR(1),FULL       BUDYR = BUDGET RECORD YEAR                   
***      PACK  DUB(8),RSBDKYR      PACK YEAR                                    
***      CVB   R5,DUB                                                           
***      STC   R5,BUDYR            BUDYR = BUDGET RECORD YEAR                   
*                                                                               
SPBU0200 EQU   *                                                                
         CLI   QWBUDGET,C'Y'                                                    
         BNE   SPBU0300            THIS REQUEST DOESN'T NEED BUDGETS            
         LA    RF,QWREQ3                                                        
         USING QREC3,RF                                                         
         CLI   Q3SALBUD,C'Y'       USE S/P DEFAULT BUDGETS?                     
         BE    SPBU0208            YES - USES S/P DEFAULT BUDGET                
         CLI   Q3SALBUD,C'O'       NO  - USE S/P 'OTHER' BUDGETS?               
         BNE   SPBU0300            NO  - DON'T APPLY S/P BUDGET REC             
*                                                                               
         DROP  RF                                                               
*                                                                               
SPBU0208 EQU   *                                                                
         OC    QWREPSET,QWREPSET   REP SET FILTER?                              
         BZ    SPBU0260            NO  - USE ANYTHING THAT COMES IN             
SPBU0220 EQU   *                                                                
         L     RF,QWREPSET         SET A(REP SET)                               
SPBU0240 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    SPBU0300            YES - NO MATCH - SKIP THIS REP               
*                                     FOR THIS REQUEST                          
         CLC   RSBDKREP,0(RF)      REP IN REC IN SET?                           
         BE    SPBU0260            YES - ACCEPT THIS REP                        
         LA    RF,2(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     SPBU0240            GO BACK FOR NEXT                             
*                                                                               
SPBU0260 EQU   *                                                                
         MVI   TOTSONLY,C'N'                                                    
*                                                                               
         GOTO1 =A(SPBDFILT),DMCB,(RC),(R2)                                      
*                                  FILTER RECORD THROUGH REQUEST                
         BE    SPBU0280            OK                                           
         BL    SPBU0300            NOT OK AND DON'T INCLUDE IN TOTALS           
         OC    QWTOTS,QWTOTS       TEST FOR TOALS REQUIRED                      
         BZ    SPBU0300                                                         
         MVI   TOTSONLY,C'Y'       INDICATE TOTALS RECS ONLY                    
*                                                                               
SPBU0280 EQU   *                                                                
*                                                                               
*   TEST SP BUD 2                                                               
*        MVC   P+1(08),=C'POSTBUD '                                             
*        MVC   P+12(27),RSBDREC    INSERT KEY                                   
*        GOTO1 REPORT                                                           
*   TEST SP BUD 2 END                                                           
*                                                                               
         BAS   RE,POSTBUD          POST BUFFALO THIS REC/REQ                    
*                                                                               
SPBU0300 ICM   R2,7,QWNEXT         NEXT REQUEST                                 
         BNZ   SPBU0200                                                         
*                                                                               
SPBU0320 GOTO1 ASEQ         END OF REQUESTS - READ NEXT BUDGET REC              
         B     SPBU0100                                                         
*                                                                               
SPBU0340 EQU   *                                                                
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP           A(MASTER/SUBSIDIARY TABLE)                   
         USING RSREPD,RE                                                        
         CLI   MASTREP,1           MASTER REP?                                  
         BNE   SPBU0380            NO  - FINISHED                               
         L     R3,ACONSREP         GET NEXT CODE                                
SPBU0360 EQU   *                                                                
         LA    R3,LSUBREP(R3)                                                   
         CLC   0(2,R3),=X'FFFF'    END OF TABLE?                                
         BE    SPBU0380            YES - FINISHED                               
         ST    R3,ACONSREP         NO  - STORE ADRRESS BACK                     
         B     SPBU0080            GO BACK FOR NEXT BUDGET                      
*                                                                               
         DROP  RE,RF                                                            
*                                                                               
SPBU0380 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
         DROP  R2                                                               
**-->>                                                                          
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*        ROUTINE TO POST BUFFALO, REQUEST LEVEL (BUDGET RECORD)                 
*                                                                               
         SPACE                                                                  
SPBDGT   EQU   X'15'               RECORD TYPE: SALESPERSON BUDGET              
SPBGWIST EQU   04                  S/P BUDGET W/STATION                         
SPBGWOST EQU   05                  S/P BUDGET W/O STATION                       
POSTBUD  NTR1                                                                   
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN - DON'T CHANGE VALUE                        
*                                                                               
         ZIC   R7,QWREPORT                                                      
         MH    R7,=Y(RPSPECX-RPSPECD)                                           
         L     RF,=A(RPSPECS)      ADDRESS RPT SPECS WORK AREA                  
         AR    R7,RF                                                            
         USING RPSPECD,R7                                                       
         MVI   REQTOTS,C'N'                                                     
         ICM   R1,15,QWTOTS        DO WE NEED TOTAL RECORDS                     
         BZ    POBU0020                                                         
         MVI   REQTOTS,C'Y'                                                     
         CLI   TOTSONLY,C'Y'       TEST FOR TOTAL RECS ONLY                     
         BE    POBU0280                                                         
*                                                                               
POBU0020 CLC   RPREQ,QWREQNUM      IS IT SAME REQUEST NUM                       
         BNE   POBU0500                                                         
         MVI   RPTFILT,C'N'                                                     
*                                                                               
*   TEST SP BUD 2.5                                                             
*        MVC   P+1(08),=C'RPFLAGS '                                             
*        MVC   P+12(1),RPFLAGS     DISPLAY FLAG                                 
*        GOTO1 REPORT                                                           
*   TEST SP BUD 2.5 END                                                         
*                                                                               
         TM    RPFLAGS,X'01'                                                    
         BNO   POBU0460            BUDGET RECORD NOT NEEDED - NEXT RPT          
         XC    BFREC,BFREC                                                      
*                                                                               
*   TEST SP BUD 2.6                                                             
*        MVC   P+1(08),=C'RSBDKTYP'                                             
*        MVC   P+12(1),RSBDKTYP                                                 
*        GOTO1 REPORT                                                           
*   TEST SP BUD 2.6 END                                                         
*                                                                               
         CLI   RSBDKTYP,SPBDGT     S/P BUDGET IN USE?                           
         BNE   POBU0030            NO                                           
*                                  YES                                          
*                                                                               
*   TEST SP BUD 2.6                                                             
*        MVC   P+1(08),=C'SPBDGT  '                                             
*        GOTO1 REPORT                                                           
*   TEST SP BUD 2.6 END                                                         
*                                                                               
         MVC   BFREC+RGCMPDSP(2),RSBDKREP                                       
         CLI   RSBDKTYP+1,SPBGWIST                                              
*                                  S/P BUDGETS INCLUDE STATION?                 
         BE    POBU0028            YES - USE 1504 KEY FIELDS                    
         MVC   BFREC+RGCMPDSP(2),RSBD5REP                                       
*                                  NO  - USE 1505 KEY FIELDS                    
POBU0028 EQU   *                                                                
*                                                                               
*   TEST SP BUD 3                                                               
*        MVC   P+1(08),=C'SP BUD3 '                                             
*        MVC   P+12(27),RSBDREC    INSERT KEY                                   
*        GOTO1 REPORT                                                           
*   TEST SP BUD 3 END                                                           
*                                                                               
         B     POBU0032                                                         
POBU0030 EQU   *                                                                
         MVC   BFREC+RGCMPDSP(2),RBUDKREP                                       
POBU0032 EQU   *                                                                
*                                                                               
*     FOR EACH RECORD, THE COMPANY CODE IS LOADED IN THE LAST TWO               
*     BYTES OF THE OUTPUT.  THIS IS TO ENABLE THE REPORT SEGMENT                
*     TO CORRECTLY EXTRACT CODE EXPANSIONS FROM 'SPACEND' WHICH                 
*     IS MODIFIED TO INCLUDE PARTITIONING OF CODES OVER MULTIPLE                
*     REPS, IN THOSE CASES WHERE A 'MASTER REP' IS INDICATED.                   
*     IT IS UNDERSTOOD THAT THIS PROCESS WILL OCCUR FOR EACH ROW                
*     ADDED TO THE SORT KEY                                                     
*                                                                               
         TM    RPFLAGS,X'20'       TEST FOR ONLINE SPEC(S)                      
         BZ    POBU0040                                                         
         OI    BFCOM,X'01'         INDICATE IN COMMENT AREA                     
         MVC   BFCOM+1(2),QWREQPR   AND MOVE IN THE REQUEST NO                  
         MVC   BFCOM+3(1),RPRPT                 AND REPORT NO                   
         MVC   BFCOM+4(2),RCREPFL               AND REP                         
*                                                                               
POBU0040 EQU   *                                                                
         CLI   RSBDKTYP,SPBDGT     S/P BUDGET IN USE?                           
         BE    POBU0050            YES - NO C*MP BUDGETS EXIST HERE             
         CLC   =C'C*MP',RBUDKSTA   C*MP BUDGET?                                 
         BNE   POBU0050            NO                                           
         OI    BFREC+RMISCDSP,X'80'                                             
*                                  YES - SET 'CMPNY BUDGET' FLAG                
         OC    RBUDKTEM,RBUDKTEM   ANY OFFICE ENTERED?                          
         BZ    POBU0050            NO                                           
         OI    BFREC+RMISCDSP,X'40'                                             
*                                  YES - SET 'OFFICE ENTERED' FLAG              
POBU0050 EQU   *                                                                
         MVC   BFKEY(1),RPREQ      FIRST KEY HAS REQ NUM                        
         MVC   BFKEY+1(1),RPRPT              AND RPT NUM                        
         XC    RECAPLVL,RECAPLVL   CLEAR RECAP LEVEL                            
         ICM   R1,15,RPRECAP       TEST FOR RECAP                               
         BZ    POBU0060                                                         
         MVC   BFKEY+1(1),2(R1)    RECAP OF THIS REPORT NUM                     
         ZIC   R0,3(R1)             AT THIS LEVEL                               
         STH   R0,RECAPLVL                                                      
         B     POBU0080                                                         
*                                                                               
*   IF A RECAP SPEC IS PRESENT, THE REPORT IT POINTS TO IS TO TAKE              
*        PRIORITY OVER THE AGGREG REPORT NUMBER.  IN THIS MANNER,               
*        A RECAP CAN HAVE AN AGGREGATION, AND THE WHOLE THING CAN               
*        FLOAT INTO POSITION BEHIND THE TARGET REPORT AT THE RIGHT              
*        BREAK LEVEL.                                                           
*                                                                               
*                                                                               
POBU0060 EQU   *                                                                
*                                                                               
*   TEST FOR AGGREG/AGGSPL ADDRESSES.  IF PRESENT, REPORT IS TO BE              
*     SKIPPED.  THERE ARE NO PERTINENT BUDGET FIGURES TO INSERT INTO            
*     THESE RECORDS.                                                            
*                                                                               
         ICM   RF,15,RPAGGREG      TEST FOR AGGREG                              
         BNZ   POBU0160            SKIP AGGREG REPORT SPEC                      
         ICM   RF,15,RPAGGSPL      TEST FOR AGGSPL                              
         BNZ   POBU0160            SKIP AGGSPL REPORT SPEC                      
*                                                                               
POBU0080 EQU   *                                                                
         LA    R6,RPROWS           ADDRESS IMPLODED ROW SPECS                   
         LA    R5,1                ROW COUNTER                                  
         XC    AMONROW,AMONROW     CLEAR A(MONTH ROW)                           
*                                                                               
POBU0100 EQU   *                                                                
         CLI   0(R6),X'FF'         TEST FOR END OF ROWS                         
         BE    POBU0280                                                         
         CLI   0(R6),33            ROW FOR CONTRACT TYPE?                       
         BNE   POBU0120            NO                                           
         MVI   CTYPREQD,C'Y'       YES - SET FLAG                               
POBU0120 EQU   *                                                                
         SR    R1,R1                                                            
         ICM   R4,7,1(R6)          BUFFALO ROW ADDR                             
POBU0140 EQU   *                                                                
*                                                                               
*   TEST BUDGETS                                                                
*        MVC   P+1(11),=C'P140 BUDGET'                                          
*        GOTO1 REPORT                                                           
*   TEST END BUDGETS                                                            
*                                                                               
         CLI   RSBDKTYP,SPBDGT     S/P BUDGET IN USE?                           
         BE    POBU0150            YES - NO C*MP BUDGETS EXIST HERE             
         GOTO1 =A(POSTROW),DMCB,(R6),(R7)                                       
         BE    POBU0170                                                         
         B     POBU0160                                                         
POBU0150 EQU   *                                                                
*                                                                               
*   TEST SP BUD 4                                                               
*        MVC   P+1(08),=C'PSTSPROW'                                             
*        MVC   P+12(27),RSBDREC    INSERT KEY                                   
*        GOTO1 REPORT                                                           
*   TEST SP BUD 4 END                                                           
*                                                                               
         GOTO1 =A(PSTSPROW),DMCB,(R6),(R7)                                      
*                                  POST S/P BUDGETS                             
         BE    POBU0170                                                         
         B     POBU0160                                                         
POBU0160 EQU   *                                                                
*                                                                               
*   TEST BUDGETS                                                                
*        MVC   P+1(11),=C'FAIL BUDGET'                                          
*        GOTO1 REPORT                                                           
*   TEST END BUDGETS                                                            
*                                                                               
         MVI   RPTFILT,C'Y'        SKIP THIS REPORT                             
         B     POBU0280            BUT CHECK FOR TOTALS                         
POBU0170 EQU   *                                                                
         BAS   RE,GETFILTB                                                      
         BNE   POBU0240            NO ROW FILTERS                               
         LR    R3,R4                                                            
         CLI   0(R6),4                                                          
         BE    *+12                                                             
         CLI   0(R6),14                                                         
         BNE   *+8                                                              
         LA    R3,1(R3)            IF OFFICE CODE ADD ONE FOR COMPARE           
*                                                                               
         CLI   0(R6),2             IF STATION, ADD 2 FOR COMPARE                
         BE    *+12                                                             
         CLI   0(R6),32                                                         
         BNE   *+8                                                              
         LA    R3,2(R3)                                                         
*                                                                               
         CLI   3(R1),C'+'          TEST FOR INCLUDE                             
         BNE   POBU0200                                                         
*                                                                               
POBU0180 EX    RF,COMPAREB         INCLUDE                                      
         BE    POBU0240            EQUAL - OK                                   
         BAS   RE,NXTFILTB         NEXT ROW FILTER                              
         BE    POBU0180                                                         
         MVI   RPTFILT,C'Y'        NOT INCLUDED                                 
         B     POBU0280            SKIP THIS REPORT                             
*                                                                               
POBU0200 CLI   3(R1),C'-'          TEST FOR EXCLUDE                             
         BE    POBU0220                                                         
         DC    H'0'                                                             
*                                                                               
POBU0220 EX    RF,COMPAREB         EXCLUDE                                      
         BNE   *+12                NOT EQUAL - OK                               
         MVI   RPTFILT,C'Y'        EQUAL - SKIP THIS REPORT                     
         B     POBU0280                                                         
         BAS   RE,NXTFILTB         NEXT ROW FILTER                              
         BNE   POBU0240            OK                                           
         B     POBU0220                                                         
*                                                                               
POBU0240 CH    R5,RECAPLVL         TEST FOR RECAP                               
         BNE   POBU0260                                                         
         MVC   RGROWSZ-1(1,R4),RPRPT   RECAP IS AT THIS LEVEL                   
*                                                                               
POBU0260 LA    R6,7(R6)                                                         
         LA    R5,1(R5)            INCREMENT ROW COUNTER                        
         ST    R4,SVR4ADDR         SAVE BUFFALO ROW ADDRESS                     
         CH    R5,=Y(RGROWMAX-1)   TEST FOR ENOUGH ROWS                         
         BNH   POBU0100            NEXT ROW                                     
*                                                                               
POBU0280 EQU   *                                                                
         CLI   REQTOTS,C'Y'        TEST FOR TOTAL RECORDS                       
         BE    POBU0320            YES                                          
         CLI   RPTFILT,C'Y'        NO - IS REPORT FILTERED                      
         BE    POBU0460             YES - SKIP THE REPORT                       
         B     POBU0440             NO  - SKIP TOTAL KEYS                       
*                                                                               
POBU0320 ICM   R4,15,QWTOTS        PROCESS TOTALS RECS ON FIRST REPORT          
         LA    R3,TOTKEYS                                                       
*                                                                               
POBU0340 XC    0(RGKEYLEN,R3),0(R3)  CLEAR TOTAL KEY                            
         MVC   0(1,R3),QWREQNUM    REQ NUM                                      
         LA    R5,2(R4)                                                         
         ST    R4,R4STORE                                                       
         LA    R4,RGROWSZ(R3)                                                   
         ST    R3,R3STORE                                                       
         LA    R3,2(R3)                                                         
         LH    R6,=Y(TOTMAX)       MAX ROWS FOR TOTAL REC                       
         MVI   SPEC,6                                                           
*                                                                               
POBU0360 MVC   0(1,R3),0(R5)       ROW DATA CODE                                
         CLI   0(R5),0                                                          
         BE    POBU0380                                                         
*                                                                               
         CLI   RSBDKTYP,SPBDGT     S/P BUDGET IN USE?                           
         BE    POBU0370            YES - NO C*MP BUDGETS EXIST HERE             
         GOTO1 =A(POSTROW),DMCB,(R5),(R7)                                       
         BE    POBU0380            POSTED OKAY                                  
         B     POBU0375            ERROR IN POSTING:  SKIP IT                   
POBU0370 EQU   *                                                                
         GOTO1 =A(PSTSPROW),DMCB,(R5),(R7)                                      
*                                  POST S/P BUDGETS                             
         BE    POBU0380            POSTED OKAY                                  
*                                  ERROR IN POSTING:  SKIP IT                   
POBU0375 EQU   *                                                                
         L     R3,R3STORE          SKIP THIS TOTAL                              
         B     POBU0400                                                         
*                                                                               
POBU0380 LA    R3,1(R3)                                                         
         LA    R4,RGROWSZ(R4)                                                   
         LA    R5,1(R5)                                                         
         BCT   R6,POBU0360         NEXT ROW                                     
*                                                                               
         L     R3,R3STORE                                                       
         LA    R3,RGKEYLEN(R3)                                                  
*                                                                               
POBU0400 L     R4,R4STORE                                                       
         BAS   RE,NXTSPECB          LOOK FOR NEXT TOTDEF SPEC                   
         BNE   POBU0420                                                         
         C     R3,=A(TOTKEYSX)                                                  
         BNH   POBU0340                                                         
         DC    H'0'                                                             
*                                                                               
POBU0420 MVI   0(R3),X'FF'         MARK END OF TOTAL KEYS                       
*                                                                               
POBU0440 EQU   *                                                                
*                                                                               
         BAS   RE,BUDCOLPR         POST PRIOR   YEAR BUDGET COLUMNS             
         BAS   RE,BUDCOL           POST CURRENT YEAR BUDGET COLUMNS             
         MVI   REQTOTS,C'N'                                                     
*                                                                               
*                                                                               
POBU0460 EQU   *                                                                
         CLI   CTYPREQD,C'Y'       BUDGET CON TYPES REQUIRED?                   
         BNE   POBU0480            NO                                           
         CLC   CTYPDONE,NUMCTYPS   # COMPLETE VS # TYPES                        
         BE    POBU0480            DONE - GET OUT OF LOOP                       
         ZIC   RE,CTYPDONE         NOT DONE - INCREMENT COUNTER                 
         LA    RE,1(RE)            ADD: 1 MORE COMPLETE                         
         STC   RE,CTYPDONE         PUT IT BACK                                  
         B     POBU0020            GO BACK FOR NEXT                             
POBU0480 EQU   *                                                                
         LA    RE,1                RESET COMPLETION COUNT TO 1                  
         STC   RE,CTYPDONE         BEFORE START OF NEXT REPORT                  
         MVI   CTYPREQD,C'N'       SET CON TYPE REQD FLAG TO NO                 
         LA    R7,RPSPECX-RPSPECD(R7)                                           
         C     R7,=A(RPSPECSX)                                                  
         BNH   POBU0020            NEXT REPORT WITHIN REQUEST                   
*                                                                               
*                                                                               
POBU0500 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
COMPAREB CLC   0(0,R3),4(R1)       COMPARE ROW VALUE TO FILTER                  
         SPACE 2                                                                
         DROP  R2,R7                                                            
         EJECT                                                                  
*                                                                               
*   FOR REQUESTS WHICH CONTAIN A ROW SPECIFICATION OF CONTRACT TYPE,            
*       A COUNTER CONTAINING THE NUMBER OF CONTRACT TYPE (X'02')                
*       ELEMENTS IN THE BUDGET RECORD MUST BE DEVELOPED.                        
*                                                                               
CTYPCNTR NTR1                                                                   
         SR    R1,R1               INITIALIZE COUNTER                           
         LA    R2,RBUDREC          A(RECORD) +                                  
         ZICM  R3,RBUDLEN,2        L(RECORD) =                                  
         AR    R2,R3               A(END OF RECORD + 1)                         
         BCTR  R2,0                                                             
         LA    R3,RBUDELEM         A(01 ELEMENT: BASIC BUDGET ELT)              
CTC0001  EQU   *                                                                
         ZIC   R4,1(R3)            L(ELEMENT)                                   
         AR    R3,R4               A(NEXT ELEMENT)                              
         CLI   0(R3),X'00'         EOR? X'00' ELEMENT                           
         BE    CTC0098             YES                                          
         CR    R2,R3               EOR? LENGTH                                  
         BNH   CTC0098             YES                                          
         CLI   0(R3),X'02'         X'02' ELEMENT?                               
         BNE   CTC0001             NO  - GET NEXT                               
         LA    R1,1(R1)            YES - BUMP COUNTER                           
         B     CTC0001             GET NEXT                                     
CTC0098  EQU   *                                                                
         STC   R1,NUMCTYPS         SAVE COUNTER                                 
CTC0099  EQU   *                                                                
         XIT1                      RETURN                                       
         EJECT                                                                  
GETFILTB SR    R1,R1                                                            
         ICM   R1,7,4(R6)                                                       
         BNZ   GFB010                                                           
         LTR   RB,RB               NO ROW FILTERS                               
         BR    RE                  CC NE 0                                      
*                                                                               
NXTFILTB ZIC   R0,1(R1)                                                         
         AR    R1,R0                                                            
         CLI   0(R1),36                                                         
         BNER  RE                  NO MORE ROW FILTERS - CC NE 0                
*                                                                               
GFB010   ZIC   RF,1(R1)                                                         
         SH    RF,=H'5'            RF = LENGTH OF FILTER - 1                    
         BNM   *+6                                                              
         DC    H'0'                                                             
         CR    RB,RB               ROW FILTER FOUND                             
         BR    RE                  CC EQ 0                                      
         EJECT                                                                  
*                                                                               
*        POST BUFFALO COLS, REPORT LEVEL (BUDGET RECORD)                        
*                                                                               
         SPACE                                                                  
BUDCOL   NTR1                                                                   
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN  -  DONT CHANGE IT                          
*                                                                               
         USING RPSPECD,R7                                                       
*                                                                               
         TM    RPFLAGS,X'06'       TEST FOR RANK RPT AND 'MONTH' ROW            
         BNO   BUCL0040                                                         
         MVC   BFRECSV,BFREC       COPY THE RECORD                              
         ICM   R1,15,AMONROW                                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
*                                                                               
***>>>   LA    RF,QWREQ                                                         
***>>>   USING QRECORD,RF                                                       
***>>>   CLC   =C'C*MP',QUESTOR    REQUEST FOR COMPANY BUDGETS?                 
***>>>   BNE   BUCL0020            NO                                           
         LA    RF,QWREQ3                                                        
         USING QREC3,RF                                                         
         CLI   Q3COMBUD,C'Y'       THIS REQUEST USES C*MP BUDGETS?              
         BNE   BUCL0020            NO  - CHECK FOR REGULAR BUDGET               
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVI   2(R1),X'FF'         YES - INSERT DIFFERENTIATION                 
*                                     INTO KEY STRING SO BUDGETS ARE            
*                                     NOT ROLLED INTO OTHER FIGURES             
         MVC   3(2,R1),RBUDKTEM    DIFFERENTIATE OFFICE FROM COMPANY            
*                                     LEVEL BUDGET RECORDS                      
*                                                                               
BUCL0020 EQU   *                                                                
         LA    R1,RGRECLEN(R1)                                                  
         MVC   0(1,R1),QWCURST     MOVE YEAR TO MONTH ROW IN COPY REC           
         MVI   1(R1),13            MOVE MONTH 13                                
*                                                                               
BUCL0040 LA    R3,1                                                             
         LA    R5,RBUDSJAN         STATION BUDGETS BY MONTH                     
         LA    R6,12                                                            
*                                                                               
BUCL0060 EQU   *                                                                
         STC   R3,MONTH            MONTH NUM                                    
         OC    QWMONADJ,QWMONADJ   TEST FOR REQ STRT/END DIFFERENT YRS          
         BZ    BUCL0160                                                         
         CLC   BUDYR,QWCURST       YES                                          
         BE    BUCL0080                                                         
         BH    BUCL0120                                                         
         CLC   MONTH,RREPFMON      YEAR LT START YEAR                           
         BNL   BUCL0500            GOT TO PRIOR YEAR'S MONTHS - EXIT            
         BL    BUCL0100                                                         
*                                                                               
BUCL0080 CLC   MONTH,RREPFMON      YEAR = START YEAR                            
         BNL   BUCL0100                                                         
         CLC   MONTH,QWCURND+1     PRIOR YEAR'S RECORD FOR END YEAR             
         BH    BUCL0480            MONTH GT END MONTH - NEXT MONTH              
         MVC   YEAR,QWCURND        YEAR IS END YEAR                             
         B     BUCL0140                                                         
*                                                                               
BUCL0100 CLC   MONTH,QWCURST+1     COMPARE MONTH TO START MONTH                 
         BL    BUCL0480            LOW - NEXT MONTH                             
         MVC   YEAR,QWCURST        YEAR IS START YEAR                           
         B     BUCL0140                                                         
*                                                                               
BUCL0120 CLC   BUDYR,QWCURND       YEAR GT START YEAR - CHECK IT'S              
         BNE   BUCL0500                                 END YEAR                
         CLC   MONTH,RREPFMON                                                   
         BL    BUCL0480            STILL IN NEXT YR'S MONTHS - NEXT MON         
         CLC   MONTH,QWCURND+1                                                  
         BH    BUCL0500            BEYOND PERIOD END - EXIT                     
         MVC   YEAR,QWCURND        YEAR IS END YEAR                             
*                                                                               
BUCL0140 CLI   RPMONROW,C'C'       TEST FOR CURRENT MONTH ROW                   
         BNE   BUCL0240                                                         
         CLC   MONTH,QWCURMON                                                   
         BH    BUCL0500            BEYOND CURRENT MONTH                         
         B     BUCL0240                                                         
*                                                                               
BUCL0160 MVC   YEAR,QWCURST        REQ START/END IN SAME YEAR                   
         CLC   BUDYR,QWCURST                                                    
         BE    BUCL0180                                                         
         CLC   MONTH,RREPFMON      PRIOR YEAR'S RECORD                          
         BNL   BUCL0580            GOT TO LAST YEAR'S MONTHS - NEXT RPT         
         B     BUCL0200                                                         
*                                                                               
BUCL0180 CLC   MONTH,RREPFMON      CURRENT YEAR'S RECORD                        
         BL    BUCL0480         STILL IN NEXT YEAR'S MONTHS - NEXT MNTH         
*                                                                               
BUCL0200 CLI   RPMONROW,C'C'       TEST FOR CURRENT MONTH ROW                   
         BNE   BUCL0220                                                         
         CLC   MONTH,QWCURMON                                                   
         BH    BUCL0500            BEYOND CURRENT MONTH                         
         B     BUCL0240                                                         
*                                                                               
BUCL0220 CLC   MONTH,QWCURND+1     NO CURRENT MONTH ROW                         
         BH    BUCL0500            BEYOND PERIOD END                            
*                                                                               
BUCL0240 CLI   RPMONROW,0          TEST FOR ANY TYPE MONTH ROW                  
         BE    BUCL0380                                                         
         MVC   MONTHROW(1),YEAR    POST THE YEAR                                
         MVC   MONTHROW+1(1),MONTH POST THE MONTH                               
         CLI   RPMONROW,C'M'       TEST FOR MONTH OR QTR TYPE MONTH ROW         
         BE    *+12                                                             
         CLI   RPMONROW,C'Q'                                                    
         BNE   BUCL0300                                                         
         CLC   QWCURST,MONTHROW    YTD                                          
         BNH   BUCL0260                                                         
         CLC   QWREQPR,=C'3J'      REQUEST 3J GETS NO PRIOR                     
         BE    BUCL0480                                                         
         MVI   MONTHROW+1,0        PRIOR TO PERIOD - MONTH ZERO                 
         B     BUCL0340                                                         
*                                                                               
BUCL0260 CLI   MONTH,1             IF MONTH = JAN,                              
         BE    BUCL0340             THEN NO RECORDS TO PUT YET                  
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BO    BUCL0280            YES - PASS ALL BUFFALO RECORDS               
         OC    BFACCS,BFACCS                                                    
         BZ    BUCL0340                                                         
BUCL0280 EQU   *                                                                
         GOTO1 =A(PUT),DMCB        MONTH ROW HAS CHANGED, SO PUT REC            
         B     BUCL0340                                                         
*                                                                               
BUCL0300 CLI   RPMONROW,C'C'       TEST FOR CURRENT MONTH ROW                   
         BNE   BUCL0320                                                         
         MVC   MONTHROW+1(1),QWCURMON   POST THE CURRENT MONTH                  
         B     BUCL0340                                                         
*                                                                               
BUCL0320 CLI   RPMONROW,C'A'       TEST FOR ALLMONTH ROW                        
         BE    *+6                                                              
         DC    H'0'                                                             
         MVI   MONTHROW+1,13       POST THE TOTAL MONTH                         
*                                                                               
BUCL0340 ICM   R1,15,AMONROW                                                    
         BZ    BUCL0380                                                         
         MVC   0(L'MONTHROW,R1),MONTHROW  POST THE MONTH ROW                    
*                                                                               
***>>>   LA    RF,QWREQ                                                         
***>>>   USING QRECORD,RF                                                       
***>>>   CLC   =C'C*MP',QUESTOR    REQUEST FOR COMPANY BUDGETS?                 
***>>>   BNE   BUCL0360            NO                                           
         LA    RF,QWREQ3                                                        
         USING QREC3,RF                                                         
         CLI   Q3COMBUD,C'Y'       THIS REQUEST USES C*MP BUDGETS?              
         BNE   BUCL0360            NO  - CHECK FOR REGULAR BUDGET               
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVI   2(R1),X'FE'         YES - INSERT DIFFERENTIATION                 
*                                     INTO KEY STRING SO BUDGETS ARE            
*                                     NOT ROLLED INTO OTHER FIGURES             
         MVC   3(2,R1),RBUDKTEM    DIFFERENTIATE OFFICE FROM COMPANY            
*                                     LEVEL BUDGET RECORDS                      
BUCL0360 EQU   *                                                                
         TM    RPFLAGS,X'06'       TEST FOR RANK RPT AND 'MONTH' ROW            
         BNO   BUCL0380                                                         
         OI    1(R1),X'80'         YES- TURN ON TOP BIT IN MONTH                
*                                                                               
BUCL0380 EQU   *                                                                
         CLI   CTYPREQD,C'Y'       CONTRACT TYPE ROW REQUIRED?                  
         BNE   BUCL0400            NO  - AGGREGATE BUDGETS NORMALLY             
         BAS   RE,BUDCTYPE         YES - GET BUDGETS BY TYPE                    
         B     BUCL0420                                                         
BUCL0400 EQU   *                                                                
         BAS   RE,BUDAGG           AGGREGATE BUDGET                             
BUCL0420 EQU   *                                                                
         L     R1,WORD             TOTAL BUDGET IS IN 'WORD'                    
         LTR   R1,R1               SET CONDITION CODE                           
         BZ    BUCL0480            IF ZERO SKIP TO NEXT MONTH                   
         CLC   RBUDKREP(4),=C'BL84'   IF BLAIR 84, THEN DOLLARS ARE             
         BNE   *+8                    IN THOUSANDS                              
         MH    R1,=H'1000'                                                      
         SR    R4,R4                                                            
         ICM   R4,7,RPBUDCP+1      NOW POST THE CUR PERIOD COL                  
         BZ    BUCL0440                                                         
         TM    RPBUDCP,X'80'       TEST APPLY COMMISSION                        
         BZ    *+12                                                             
         BAS   RE,COMM             YES                                          
         L     R1,FULL                                                          
         BAS   RE,BUDPERCL                                                      
*                                                                               
BUCL0440 ICM   R4,7,RPBUDCY+1      NOW POST THE CUR YTD COL                     
         BZ    BUCL0460                                                         
         TM    RPBUDCY,X'80'       TEST APPLY COMMISSION                        
         BZ    *+12                                                             
         BAS   RE,COMM             YES                                          
         L     R1,FULL                                                          
         LR    RF,R1               ACCUMULATE                                   
         A     RF,0(R4)                                                         
         ST    RF,0(R4)                                                         
         TM    RPFLAGS,X'06'       TEST FOR RANK RPT AND 'MONTH' ROW            
         BNO   BUCL0460                                                         
         LA    R4,RGRECLEN(R4)     YES- ACCUMULATE ALL TO TOTAL MONTH           
         LR    RF,R1                                                            
         A     RF,0(R4)                                                         
         ST    RF,0(R4)                                                         
*                                                                               
BUCL0460 ICM   R4,15,RPREVCP       POST CURRENT PERIOD REVENUE COLUMN           
         BZ    BUCL0480                                                         
         BAS   RE,COMM             GET THE REVENUE VALUE                        
         SR    RE,RE               MULTIPLY RESULT OF CALCULATION               
         L     RF,FULL             BY 100 FOR PROPER DECIMAL ALIGNMENT          
         LA    R1,100                                                           
         MR    RE,R1                                                            
         LR    R1,RF                                                            
         BAS   RE,BUDPERCL                                                      
*                                                                               
BUCL0480 LA    R3,1(R3)            NEXT MONTH                                   
         LA    R5,4(R5)                                                         
         BCT   R6,BUCL0060                                                      
*                                                                               
BUCL0500 EQU   *                                                                
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BO    BUCL0520            YES - PASS ALL BUFFALO RECORDS               
         OC    BFACCS,BFACCS                                                    
         BZ    BUCL0540                                                         
BUCL0520 EQU   *                                                                
         GOTO1 =A(PUT),DMCB                                                     
BUCL0540 EQU   *                                                                
         TM    RPFLAGS,X'06'       TEST FOR COPY RECORD                         
         BNO   BUCL0580                                                         
         MVC   BFREC,BFRECSV       YES- MOVE BACK TO BFREC                      
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BO    BUCL0560            YES - PASS ALL BUFFALO RECORDS               
         OC    BFACCS,BFACCS            AND PUT                                 
         BZ    BUCL0580                                                         
BUCL0560 EQU   *                                                                
         GOTO1 =A(PUT),DMCB        FINALLY PUT REMAINING RECORD                 
*                                                                               
BUCL0580 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
         DROP  R2,R7                                                            
         EJECT                                                                  
*                                                                               
*        POST BUFFALO COLS, REPORT LEVEL (PRIOR YEAR BUDGET RECORD)             
*                                                                               
         SPACE                                                                  
BUDCOLPR NTR1                                                                   
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN  -  DONT CHANGE IT                          
*                                                                               
         USING RPSPECD,R7                                                       
*                                                                               
*                                     TO PERMIT PRIOR YEAR BUDGETS              
*                                                                               
         TM    RPFLAGS,X'06'       TEST FOR RANK RPT AND 'MONTH' ROW            
         BNO   BUPR0040                                                         
         MVC   BFRECSV,BFREC       COPY THE RECORD                              
         ICM   R1,15,AMONROW                                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
*                                                                               
***      LA    RF,QWREQ                                                         
***      USING QRECORD,RF                                                       
***      CLC   =C'C*MP',QUESTOR    REQUEST FOR COMPANY BUDGETS?                 
***      BNE   BUPR0020            NO                                           
         LA    RF,QWREQ3                                                        
         USING QREC3,RF                                                         
         CLI   Q3COMBUD,C'Y'       THIS REQUEST USES C*MP BUDGETS?              
         BNE   BUPR0020            NO  - CHECK FOR REGULAR BUDGET               
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVI   2(R1),X'FD'         YES - INSERT DIFFERENTIATION                 
*                                     INTO KEY STRING SO BUDGETS ARE            
*                                     NOT ROLLED INTO OTHER FIGURES             
         MVC   3(2,R1),RBUDKTEM    DIFFERENTIATE OFFICE FROM COMPANY            
*                                     LEVEL BUDGET RECORDS                      
BUPR0020 EQU   *                                                                
         LA    R1,RGRECLEN(R1)                                                  
         MVC   0(1,R1),QWPRIST     MOVE YEAR TO MONTH ROW IN COPY REC           
         MVI   1(R1),13            MOVE MONTH 13                                
*                                                                               
BUPR0040 LA    R3,1                                                             
         LA    R5,RBUDSJAN         STATION BUDGETS BY MONTH                     
         LA    R6,12                                                            
*                                                                               
BUPR0060 EQU   *                                                                
         STC   R3,MONTH            MONTH NUM                                    
         OC    QWMONADJ,QWMONADJ   TEST FOR REQ STRT/END DIFFERENT YRS          
         BZ    BUPR0160                                                         
         CLC   BUDYR,QWPRIST       YES                                          
         BE    BUPR0080                                                         
         BH    BUPR0120                                                         
         CLC   MONTH,RREPFMON      YEAR LT START YEAR                           
         BNL   BUPR0500            GOT TO PRIOR YEAR'S MONTHS - EXIT            
         BL    BUPR0100                                                         
*                                                                               
BUPR0080 CLC   MONTH,RREPFMON      YEAR = START YEAR                            
         BNL   BUPR0100                                                         
         CLC   MONTH,QWPRIND+1     PRIOR YEAR'S RECORD FOR END YEAR             
         BH    BUPR0480            MONTH GT END MONTH - NEXT MONTH              
         MVC   YEAR,QWPRIND        YEAR IS END YEAR                             
         B     BUPR0140                                                         
*                                                                               
BUPR0100 CLC   MONTH,QWPRIST+1     COMPARE MONTH TO START MONTH                 
         BL    BUPR0480            LOW - NEXT MONTH                             
*                                                                               
*   SET ALL YEARS AS 'CURRENT YEAR' RATHER THAN 'PRIOR YEAR' IN THE             
*        OUTPUT RECORD                                                          
*                                                                               
         MVC   YEAR,QWCURST        YEAR IS START YEAR                           
         B     BUPR0140                                                         
*                                                                               
BUPR0120 CLC   BUDYR,QWPRIND       YEAR GT START YEAR - CHECK IT'S              
         BNE   BUPR0500                                 END YEAR                
         CLC   MONTH,RREPFMON                                                   
         BL    BUPR0480            STILL IN NEXT YR'S MONTHS - NEXT MON         
         CLC   MONTH,QWPRIND+1                                                  
         BH    BUPR0500            BEYOND PERIOD END - EXIT                     
         MVC   YEAR,QWCURND        YEAR IS END YEAR                             
*                                                                               
BUPR0140 CLI   RPMONROW,C'C'       TEST FOR CURRENT MONTH ROW                   
         BNE   BUPR0240                                                         
         CLC   MONTH,QWCURMON                                                   
         BH    BUPR0500            BEYOND CURRENT MONTH                         
         B     BUPR0240                                                         
*                                                                               
BUPR0160 MVC   YEAR,QWCURST        REQ START/END IN SAME YEAR                   
         CLC   BUDYR,QWPRIST                                                    
         BE    BUPR0180                                                         
         CLC   MONTH,RREPFMON      PRIOR YEAR'S RECORD                          
         BNL   BUPR0580            GOT TO LAST YEAR'S MONTHS - NEXT RPT         
         B     BUPR0200                                                         
*                                                                               
BUPR0180 CLC   MONTH,RREPFMON      CURRENT YEAR'S RECORD                        
         BL    BUPR0480         STILL IN NEXT YEAR'S MONTHS - NEXT MNTH         
*                                                                               
BUPR0200 CLI   RPMONROW,C'C'       TEST FOR CURRENT MONTH ROW                   
         BNE   BUPR0220                                                         
         CLC   MONTH,QWCURMON                                                   
         BH    BUPR0500            BEYOND CURRENT MONTH                         
         B     BUPR0240                                                         
*                                                                               
BUPR0220 CLC   MONTH,QWPRIND+1     NO CURRENT MONTH ROW                         
         BH    BUPR0500            BEYOND PERIOD END                            
*                                                                               
BUPR0240 CLI   RPMONROW,0          TEST FOR ANY TYPE MONTH ROW                  
         BE    BUPR0380                                                         
         MVC   MONTHROW(1),YEAR    POST THE YEAR                                
         MVC   MONTHROW+1(1),MONTH POST THE MONTH                               
         CLI   RPMONROW,C'M'       TEST FOR MONTH OR QTR TYPE MONTH ROW         
         BE    *+12                                                             
         CLI   RPMONROW,C'Q'                                                    
         BNE   BUPR0300                                                         
         CLC   QWPRIST,MONTHROW    YTD                                          
         BNH   BUPR0260                                                         
         CLC   QWREQPR,=C'3J'      REQUEST 3J GETS NO PRIOR                     
         BE    BUPR0480                                                         
         MVI   MONTHROW+1,0        PRIOR TO PERIOD - MONTH ZERO                 
         B     BUPR0340                                                         
*                                                                               
BUPR0260 CLI   MONTH,1             IF MONTH = JAN,                              
         BE    BUPR0340             THEN NO RECORDS TO PUT YET                  
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BO    BUPR0280            YES - PASS ALL BUFFALO RECORDS               
         OC    BFACCS,BFACCS                                                    
         BZ    BUPR0340                                                         
BUPR0280 EQU   *                                                                
         GOTO1 =A(PUT),DMCB        MONTH ROW HAS CHANGED, SO PUT REC            
         B     BUPR0340                                                         
*                                                                               
BUPR0300 CLI   RPMONROW,C'C'       TEST FOR CURRENT MONTH ROW                   
         BNE   BUPR0320                                                         
         MVC   MONTHROW+1(1),QWCURMON   POST THE CURRENT MONTH                  
         B     BUPR0340                                                         
*                                                                               
BUPR0320 CLI   RPMONROW,C'A'       TEST FOR ALLMONTH ROW                        
         BE    *+6                                                              
         DC    H'0'                                                             
         MVI   MONTHROW+1,13       POST THE TOTAL MONTH                         
*                                                                               
BUPR0340 ICM   R1,15,AMONROW                                                    
         BZ    BUPR0380                                                         
         MVC   0(L'MONTHROW,R1),MONTHROW  POST THE MONTH ROW                    
*                                                                               
***      LA    RF,QWREQ                                                         
***      USING QRECORD,RF                                                       
***      CLC   =C'C*MP',QUESTOR    REQUEST FOR COMPANY BUDGETS?                 
***      BNE   BUPR0360            NO                                           
         LA    RF,QWREQ3                                                        
         USING QREC3,RF                                                         
         CLI   Q3COMBUD,C'Y'       THIS REQUEST USES C*MP BUDGETS?              
         BNE   BUPR0360            NO  - CHECK FOR REGULAR BUDGET               
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVI   2(R1),X'FC'         YES - INSERT DIFFERENTIATION                 
*                                     INTO KEY STRING SO BUDGETS ARE            
*                                     NOT ROLLED INTO OTHER FIGURES             
         MVC   3(2,R1),RBUDKTEM    DIFFERENTIATE OFFICE FROM COMPANY            
*                                     LEVEL BUDGET RECORDS                      
BUPR0360 EQU   *                                                                
         TM    RPFLAGS,X'06'       TEST FOR RANK RPT AND 'MONTH' ROW            
         BNO   BUPR0380                                                         
         OI    1(R1),X'80'         YES- TURN ON TOP BIT IN MONTH                
*                                                                               
BUPR0380 EQU   *                                                                
         CLI   CTYPREQD,C'Y'       CONTRACT TYPE ROW REQUIRED?                  
         BNE   BUPR0400            NO  - AGGREGATE BUDGETS NORMALLY             
         BAS   RE,BUDCTYPE         YES - GET BUDGETS BY TYPE                    
         B     BUPR0420                                                         
BUPR0400 EQU   *                                                                
         BAS   RE,BUDAGG           AGGREGATE BUDGET                             
BUPR0420 EQU   *                                                                
         L     R1,WORD             TOTAL BUDGET IS IN 'WORD'                    
         LTR   R1,R1               SET CONDITION CODE                           
         BZ    BUPR0480            IF ZERO SKIP TO NEXT MONTH                   
         CLC   RBUDKREP(4),=C'BL84'   IF BLAIR 84, THEN DOLLARS ARE             
         BNE   *+8                    IN THOUSANDS                              
         MH    R1,=H'1000'                                                      
         SR    R4,R4                                                            
         ICM   R4,7,RPBUDCPP+1     NOW POST THE PRI PERIOD COL                  
         BZ    BUPR0440                                                         
         TM    RPBUDCPP,X'80'      TEST APPLY COMMISSION                        
         BZ    *+12                                                             
         BAS   RE,COMM             YES                                          
         L     R1,FULL                                                          
         BAS   RE,BUDPERPR                                                      
*                                                                               
BUPR0440 ICM   R4,7,RPBUDCYP+1     NOW POST THE PRI YTD COL                     
         BZ    BUPR0460                                                         
         TM    RPBUDCYP,X'80'      TEST APPLY COMMISSION                        
         BZ    *+12                                                             
         BAS   RE,COMM             YES                                          
         L     R1,FULL                                                          
         LR    RF,R1               ACCUMULATE                                   
         A     RF,0(R4)                                                         
         ST    RF,0(R4)                                                         
         TM    RPFLAGS,X'06'       TEST FOR RANK RPT AND 'MONTH' ROW            
         BNO   BUPR0460                                                         
         LA    R4,RGRECLEN(R4)     YES- ACCUMULATE ALL TO TOTAL MONTH           
         LR    RF,R1                                                            
         A     RF,0(R4)                                                         
         ST    RF,0(R4)                                                         
*                                                                               
BUPR0460 ICM   R4,15,RPREVCP       POST CURRENT PERIOD REVENUE COLUMN           
***>>>   BZ    BUPR0480                                                         
         B     BUPR0480            NO PRIOR REVENUE:  SKIP                      
         BAS   RE,COMM             GET THE REVENUE VALUE                        
         SR    RE,RE               MULTIPLY RESULT OF CALCULATION               
         L     RF,FULL             BY 100 FOR PROPER DECIMAL ALIGNMENT          
         LA    R1,100                                                           
         MR    RE,R1                                                            
         LR    R1,RF                                                            
         BAS   RE,BUDPERPR                                                      
*                                                                               
BUPR0480 LA    R3,1(R3)            NEXT MONTH                                   
         LA    R5,4(R5)                                                         
         BCT   R6,BUPR0060                                                      
*                                                                               
BUPR0500 EQU   *                                                                
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BO    BUPR0520            YES - PASS ALL BUFFALO RECORDS               
         OC    BFACCS,BFACCS                                                    
         BZ    BUPR0540                                                         
BUPR0520 EQU   *                                                                
         GOTO1 =A(PUT),DMCB                                                     
BUPR0540 EQU   *                                                                
         TM    RPFLAGS,X'06'       TEST FOR COPY RECORD                         
         BNO   BUPR0580                                                         
         MVC   BFREC,BFRECSV       YES- MOVE BACK TO BFREC                      
         TM    RPFLAGS,X'80'       'PENDING' REPORT?                            
         BO    BUPR0560            YES - PASS ALL BUFFALO RECORDS               
         OC    BFACCS,BFACCS            AND PUT                                 
         BZ    BUPR0580                                                         
BUPR0560 EQU   *                                                                
         GOTO1 =A(PUT),DMCB        FINALLY PUT REMAINING RECORD                 
*                                                                               
BUPR0580 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
         DROP  R2,R7                                                            
         EJECT                                                                  
*                                                                               
* ROUTINE TO AGGREGATE BUDGETS.                                                 
*   R5   =  A(THIS MONTH'S BUDGET) IN BASIC (01) ELEMENT -                      
*           USED TO CALCULATE DISPLACEMENT INTO (02) ELEMENTS                   
*           FOR AGGREGATION                                                     
*   WORD =  STORAGE FOR AGGREGATED AMOUNT TO PASS BACK                          
*   HALF =  TEMPORARY STORAGE TO DETERMINE IF TYPE IS 'INCLUDE'                 
*           OR 'EXCLUDE'                                                        
* FOLLOWING RULES APPLY:                                                        
*   CONTRACT TYPE NOT ENTERED:                                                  
*        ACCUMULATE BUDGET FROM BASIC (01) ELEMENT AND ALL                      
*                   CONTRACT TYPE (02) ELEMENTS.                                
*   CONTRACT TYPE ENTERED AS 'INCLUDE':                                         
*        ONLY USE BUDGET FROM CONTRACT TYPE (02) ELEMENT WITH                   
*             TYPE SAME AS ENTERED.                                             
*   CONTRACT TYPE ENTERED AS 'EXCLUDE':                                         
*        ACCUMULATE BUDGET FROM BASIC (01) ELEMENT AND ALL                      
*                   CONTRACT TYPE (02) ELEMENTS NOT MATCHING                    
*                   THE TYPE ENTERED.                                           
*                                                                               
DISPCTYP EQU   RBUDTYPE-RBUDELE2                                                
*                                                                               
BUDAGG   NTR1                                                                   
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
         XC    WORD,WORD           INITIALIZE PASS-THROUGH STORAGE              
         LA    R4,RBUDREC          A(RECORD)                                    
         ZICM  R3,RBUDLEN,2        L(RECORD)                                    
         AR    R4,R3               A(END OF RECORD)                             
         BCTR  R4,0                SUBTRACT 1 FOR A(EOR)                        
         LA    R3,QWREQ                                                         
         USING QRECORD,R3                                                       
         MVC   HALF(1),QCONTYPE    ESTABLISH INCL/EXCL TYPE                     
         OC    HALF(1),=X'40'      SET UPPER CASE BIT                           
*   'HALF' IS USED FOR TEMPORARY STORAGE                                        
         LA    R1,RBUDELEM         ESTABLISH A(01 ELEMENT)                      
         LR    R2,R5               CALCULATE DISPLACEMENT OF BUCKET             
         SR    R2,R1               R2 CONTAINS DISPLACEMENT                     
         CLI   QCONTYPE,C' '       ANY TYPE ENTERED: SPACE                      
         BE    BA0030              NO  - AGGREGATE ALL BUDGET FIGURES           
         CLI   QCONTYPE,X'00'      ANY TYPE ENTERED: LOW VALUE                  
         BE    BA0030              NO  - AGGREGATE ALL BUDGET FIGURES           
         TM    QCONTYPE,X'40'      TYPE ENTERED: INCL OR EXCL?                  
         BNO   BA0030              OFF: LOWER CASE - EXCL TYPE                  
         DROP  R2,R3                                                            
*                                                                               
* CONTRACT TYPE ENTERED AS 'INCLUDE': SCAN ELEMENTS LOOKING FOR IT              
*     R1    = A(01 ELEMENT)                                                     
*     R2    = DISPLACEMENT FOR BUCKET                                           
* NOTE:  FIRST LOOP BYPASSES THE '01' ELEMENT                                   
*                                                                               
BA0008   EQU   *                                                                
         ZIC   R3,1(R1)            CALCULATE A(NEXT ELEMENT)                    
         AR    R1,R3               A(ELEMENT) + L(ELEMENT)                      
         CLI   0(R3),X'00'         END OF RECORD? X'00' ELT                     
         BE    BA0099              YES                                          
         CR    R4,R1               END OF RECORD? LENGTH                        
         BNH   BA0099              YES - NO ELEMENT - EXIT                      
         CLI   0(R1),X'02'         '02' ELEMENT?                                
         BNE   BA0008              NO  - GET NEXT                               
         CLC   HALF(1),DISPCTYP(R1)                                             
         BNE   BA0008              NOT TYPE SOUGHT - GET NEXT                   
         AR    R1,R2               TYPE FOUND - ADD DISPLACEMENT                
         ICM   R5,15,0(R1)         THIS MONTH'S BUCKET BY TYPE                  
         ST    R5,WORD             LOAD FINAL STORAGE                           
         B     BA0099              EXIT                                         
*                                                                               
* NO CONTRACT TYPE ENTERED, OR ENTERED AS 'EXCLUDE TYPE.'  ADD ALL              
*    BUCKETS EXCEPT AN EXCLUDED TYPE.  NOTE: FIRST LOOP ALWAYS ADDS             
*    '01' ELEMENT VALUE.                                                        
*                                                                               
BA0030   EQU   *                                                                
         ICM   R3,15,0(R5)         A(THIS MONTH'S BUCKET)                       
         LA    R6,WORD             A(ACCUMULATOR)                               
         A     R3,0(R6)            ADD TOTAL + THIS MONTH                       
         ST    R3,0(R6)            STORE NEW TOTAL                              
BA0032   EQU   *                                                                
         ZIC   R3,1(R1)            BUMP TO NEXT ELEMENT                         
         AR    R1,R3               A(ELEMENT) + L(ELEMENT)                      
         CR    R4,R1               END OF RECORD?                               
         BNH   BA0099              YES - EXIT                                   
         CLI   0(R1),X'02'         '02' ELEMENT?                                
         BNE   BA0032              NO  - TRY AGAIN                              
         CLI   HALF,C' '           ANY TYPE ENTERED? SPACE                      
         BE    BA0036              NO                                           
         CLI   HALF,X'00'          ANY TYPE ENTERED? LOW VALUE                  
         BE    BA0036              NO                                           
         CLC   HALF(1),DISPCTYP(R1) SAME TYPE?                                  
         BE    BA0032              YES - EXCLUDE IT                             
BA0036   EQU   *                                                                
         LR    R5,R1               A(ELEMENT TO BE ADDED)                       
         AR    R5,R2               DISPL OF THIS MONTH'S BUCKET                 
         B     BA0030              GO BACK TO ACCUMULATE                        
BA0099   EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
* ROUTINE TO AGGREGATE BUDGETS BY CONTRACT TYPE                                 
*   R5   =  A(THIS MONTH'S BUDGET) IN BASIC (01) ELEMENT -                      
*           USED TO CALCULATE DISPLACEMENT INTO (02) ELEMENTS                   
*           FOR AGGREGATION                                                     
*   WORD =  STORAGE FOR AGGREGATED AMOUNT TO PASS BACK                          
* FOLLOWING RULES APPLY:                                                        
*   CONTRACT TYPES HAVE ALREADY BEEN FILTERED BY POSTROW ROUTINE.               
*        IF CONTRACT TYPE REJECTED BY POSTROW, THIS ROUTINE IS                  
*        NOT EVEN CALLED.                                                       
*   FIELD 'CTYPDONE' CONTAINS THE NUMBER OF THE X'02' ELEMENT                   
*        FROM WHICH THE BUDGETS ARE TO BE TAKEN.  NO FURTHER                    
*        TESTING IS REQUIRED.                                                   
*                                                                               
BUDCTYPE NTR1                                                                   
*                                                                               
         XC    WORD,WORD           INITIALIZE PASS-THROUGH STORAGE              
         SR    R6,R6               INITIALIZE COUNTER                           
         LA    R4,RBUDREC          A(RECORD)                                    
         ZICM  R3,RBUDLEN,2        L(RECORD)                                    
         AR    R4,R3               A(END OF RECORD)                             
         BCTR  R4,0                SUBTRACT 1 FOR A(EOR)                        
         LA    R1,RBUDELEM         ESTABLISH A(01 ELEMENT)                      
         LR    R2,R5               CALCULATE DISPLACEMENT OF BUCKET             
         SR    R2,R1               R2 CONTAINS DISPLACEMENT                     
*                                                                               
* NOTE:  FIRST LOOP BYPASSES THE '01' ELEMENT                                   
*                                                                               
BC0008   EQU   *                                                                
         ZIC   R3,1(R1)            CALCULATE A(NEXT ELEMENT)                    
         LA    R6,1(R6)            X'02' ELEMENT COUNTER                        
         AR    R1,R3               A(ELEMENT) + L(ELEMENT)                      
         CLI   0(R3),X'00'         END OF RECORD? X'00' ELT                     
         BE    BC0099              YES                                          
         CR    R4,R1               END OF RECORD? LENGTH                        
         BNH   BC0099              YES - NO ELEMENT - EXIT                      
         CLI   0(R1),X'02'         '02' ELEMENT?                                
         BNE   BC0008              NO  - GET NEXT                               
         ZIC   RE,CTYPDONE         # IN PROCESS                                 
         CR    RE,R6               IS THIS # OF ELEMENT IN PROCESS?             
         BNE   BC0008              NO  - GET NEXT                               
         AR    R1,R2               # FOUND - ADD DISPLACEMENT                   
         ICM   R5,15,0(R1)         THIS MONTH'S BUCKET BY TYPE                  
         ST    R5,WORD             LOAD FINAL STORAGE                           
         B     BC0099              EXIT                                         
BC0099   EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
* ROUTINE TO POST CURRENT PERIOD COLUMN FOR BUDGETS AND REVENUES                
* INPUT  : R1=DOLLAR VALUE                                                      
*          R4=A(COLUMN)                                                         
*                                                                               
BUDPERCL LR    R0,RE                                                            
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN  -  DONT CHANGE IT                          
*                                                                               
         USING RPSPECD,R7                                                       
*                                                                               
         CLI   RPMONROW,C'C'       TEST FOR CURRENT MONTH ROW                   
         BNE   BP2                                                              
         CLC   MONTH,QWCURMON      TEST FOR MONTH EQ CURRENT MONTH              
         BNE   BPX                 NOT EQUAL - DON'T POST PERIOD COL            
         B     BP4                                                              
*                                                                               
BP2      EQU   *                                                                
         CLC   YEAR,QWCURST        STILL WITHIN START YEAR?                     
         BNE   BP4                 NO  - CROSSES YEAR BREAK                     
*                                                                               
         CLC   MONTH,QWCURST+1     MONTH BEFORE PERIOD START ---                
         BL    BPX                 DON'T POST PERIOD COL                        
*                                                                               
BP4      CLI   RPMONROW,C'A'       TEST FOR ALLMONTH ROW                        
         BNE   BP6                                                              
         LR    RF,R1               ACCUMULATE FOR TOTAL                         
         A     RF,0(R4)                                                         
         ST    RF,0(R4)                                                         
         B     BP8                                                              
*                                                                               
BP6      ST    R1,0(R4)            OTHER THAN ALLMONTH - MOVE TO COL            
*                                                                               
BP8      TM    RPFLAGS,X'06'       TEST FOR RANK RPT AND 'MONTH' ROW            
         BNO   BPX                                                              
         LA    R4,RGRECLEN(R4)     YES- ACCUMULATE ALL TO TOTAL MONTH           
         LR    RF,R1                    IN COPY RECORD                          
         A     RF,0(R4)                                                         
         ST    RF,0(R4)                                                         
*                                                                               
BPX      LR    RE,R0                                                            
         BR    RE                                                               
         SPACE 2                                                                
         DROP  R2,R7                                                            
         EJECT                                                                  
* ROUTINE TO POST PRIOR   PERIOD COLUMN FOR BUDGETS AND REVENUES                
* INPUT  : R1=DOLLAR VALUE                                                      
*          R4=A(COLUMN)                                                         
*                                                                               
BUDPERPR LR    R0,RE                                                            
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN  -  DONT CHANGE IT                          
*                                                                               
         USING RPSPECD,R7                                                       
*                                                                               
         CLI   RPMONROW,C'C'       TEST FOR CURRENT MONTH ROW                   
         BNE   BX2                                                              
         CLC   MONTH,QWCURMON      TEST FOR MONTH EQ CURRENT MONTH              
         BNE   BXX                 NOT EQUAL - DON'T POST PERIOD COL            
         B     BX4                                                              
*                                                                               
BX2      EQU   *                                                                
*                                                                               
*   COMPARE AGAINST 'CURRENT YEAR', NOT 'PRIOR YEAR'                            
*                                                                               
         CLC   YEAR,QWCURST        STILL WITHIN START YEAR?                     
         BNE   BX4                 NO  - CROSSES YEAR BREAK                     
*                                                                               
         CLC   MONTH,QWPRIST+1     MONTH BEFORE PERIOD START ---                
         BL    BXX                 DON'T POST PERIOD COL                        
*                                                                               
BX4      CLI   RPMONROW,C'A'       TEST FOR ALLMONTH ROW                        
         BNE   BX6                                                              
         LR    RF,R1               ACCUMULATE FOR TOTAL                         
         A     RF,0(R4)                                                         
         ST    RF,0(R4)                                                         
         B     BX8                                                              
*                                                                               
BX6      ST    R1,0(R4)            OTHER THAN ALLMONTH - MOVE TO COL            
*                                                                               
BX8      TM    RPFLAGS,X'06'       TEST FOR RANK RPT AND 'MONTH' ROW            
         BNO   BXX                                                              
         LA    R4,RGRECLEN(R4)     YES- ACCUMULATE ALL TO TOTAL MONTH           
         LR    RF,R1                    IN COPY RECORD                          
         A     RF,0(R4)                                                         
         ST    RF,0(R4)                                                         
*                                                                               
BXX      LR    RE,R0                                                            
         BR    RE                                                               
         SPACE 2                                                                
         DROP  R2,R7                                                            
         EJECT                                                                  
* ROUTINE TO GET A COMMISSION BY APPLYING A RATE FROM A COMMISSION              
* RECORD TO A BUDGET VALUE                                                      
* INPUT  : R1=BUDGET VALUE                                                      
*          BUDYR=YEAR                                                           
*          MONTH=MONTH                                                          
* OUTPUT : FULL=COMMISSION VALUE                                                
*                                                                               
COMM     NTR1                                                                   
*                                                                               
         ST    R1,FULL             SAVE BUDGET VALUE                            
         LTR   R1,R1               TEST FOR ZERO                                
         BZ    COMX                                                             
         MVC   WORK(1),BUDYR       SAVE Y/M                                     
         MVC   WORK+1(1),MONTH                                                  
         XC    WORD,WORD           CLEAR COMMISSION RATE                        
         L     R3,=A(COMTAB)       LOOK UP COMMISSION TABLE                     
         LA    R4,NCOMTAB                                                       
*                                                                               
COM2     OC    0(LCOMTAB,R3),0(R3)                                              
         BZ    COM6                                                             
         CLC   RBUDKSTA,0(R3)      MATCH STATION                                
         BNE   COM4                                                             
         CLC   WORK(2),5(R3)       AND Y/M                                      
         BL    COM4                                                             
         CLC   WORK(2),7(R3)                                                    
         BH    COM4                                                             
         MVC   WORD,9(R3)          MATCHED-GET THE COMMISSION RATE              
         B     COM18                                                            
*                                                                               
COM4     LA    R3,LCOMTAB(R3)                                                   
         BCT   R4,COM2                                                          
         DC    H'0'                TABLE FULL                                   
*                                                                               
COM6     MVC   SVKEY,KEY           NOT FOUND IN TABLE -                         
         XC    KEY,KEY             READ COMMISSION RECORDS                      
         LA    R5,KEY                                                           
         USING RCOMRECD,R5                                                      
         MVI   RCOMKTYP,X'29'                                                   
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP           A(MASTER/SUBSIDIARY TABLE)                   
         USING RSREPD,RE                                                        
*                                                                               
         DROP  RF                                                               
*                                                                               
         LA    RF,RCREPFL          LOAD A(REP ID FOR RUN)                       
         CLI   MASTREP,1           MASTER REP?                                  
         BNE   COM7                NO                                           
         L     RF,ACONSREP         A(CURRENT REP CODE IN TABLE)                 
COM7     EQU   *                                                                
         MVC   RCOMKREP,0(RF)                                                   
*                                                                               
         DROP  RE                                                               
*                                                                               
         MVC   RCOMKSTA,RBUDKSTA                                                
         XC    HALF,HALF                                                        
         MVC   HALF2,=X'FFFF'                                                   
         GOTO1 AHIGH                                                            
         CLC   KEY(RCOMKDAT-RCOMKEY),KEYSAVE                                    
         BNE   COM16               RECORD NOT FOUND                             
         CLC   RCOMKDAT,WORK                                                    
         BH    COM10               RECORD NOT FOUND                             
*                                                                               
COM8     MVC   HALF,RCOMKDAT       FIND LATEST Y/M LE BUDGET Y/M                
         GOTO1 ASEQ                                                             
         CLC   KEY(RCOMKDAT-RCOMKEY),KEYSAVE                                    
         BNE   COM12                                                            
         CLC   RCOMKDAT,WORK                                                    
         BNH   COM8                                                             
*                                                                               
COM10    MVC   HALF2,RCOMKDAT      SUBTRACT ONE MONTH FOR LAST MONTH            
         ZIC   RE,HALF2+1          THIS COMMISSION IS EFFECTIVE                 
         BCTR  RE,0                                                             
         LTR   RE,RE                                                            
         BZ    *+12                                                             
         STC   RE,HALF2+1                                                       
         B     COM12                                                            
         ZIC   RE,HALF2                                                         
         BCTR  RE,0                                                             
         LTR   RE,RE                                                            
         BNM   *+8                                                              
         LA    RE,99                                                            
         STC   RE,HALF2                                                         
         MVI   HALF2+1,12                                                       
*                                                                               
COM12    OC    HALF,HALF           TEST COMMISSION RECORD FOUND                 
         BZ    COM16                                                            
         MVC   KEY,KEYSAVE         YES-GET BACK THE COMMISSION RECORD           
         MVC   RCOMKDAT,HALF       WE WANT                                      
         GOTO1 AHIGH                                                            
         GOTO1 AGETCOM             READ COMMISSION RECORD                       
         BNZ   COM16                                                            
         LA    R5,IOAREA                                                        
         LA    R5,RCOMELEM                                                      
         SR    R0,R0               GET COMMISSION RATE                          
*                                                                               
COM14    CLI   0(R5),0                                                          
         BE    COM16                                                            
         CLI   0(R5),1                                                          
         BE    *+14                                                             
         IC    R0,1(R5)                                                         
         AR    R5,R0                                                            
         B     COM14                                                            
         MVC   WORD,RCOMRAT1-RCOMELEM(R5)                                       
*                                                                               
COM16    MVC   0(5,R3),RBUDKSTA    STATION                                      
         MVC   5(2,R3),HALF        Y/M START                                    
         MVC   7(2,R3),HALF2       Y/M END                                      
         MVC   9(4,R3),WORD        COMMISSION RATE                              
*                                                                               
         MVC   KEY,SVKEY           RESTORE BUDGET KEY                           
         GOTO1 AHIGH                                                            
*                                                                               
COM18    EQU   *                                                                
         ICM   R1,15,WORD          TEST RATE=0                                  
         BZ    COM20                                                            
         L     RF,FULL             CALCULATE REVENUE                            
         MR    RE,R1                                                            
         SLDA  RE,1                                                             
         D     RE,=F'1000000'                                                   
         LTR   R1,RF                                                            
         BM    *+8                                                              
         AH    R1,=H'1'                                                         
         SRA   R1,1                                                             
*                                                                               
COM20    ST    R1,FULL             RETURN COMMISSION = BUDGET X RATE            
*                                                                               
COMX     EQU   *                                                                
         XIT1                                                                   
*                                                                               
         DROP  R5                                                               
         EJECT                                                                  
         EJECT                                                                  
*                                                                               
*        NXTSPECB SEARCHES FOR A SPEC FROM NEXT SPEC                            
*                                                                               
*        IN  R4 = A(ORIGINAL SPEC)                                              
*            SPEC = SOUGHT AFTER SPEC CODE (1 BYTE)                             
*        OUT CC = 0, R4 = A(FOUND SPEC)     SPEC FOUND                          
*            CC = 2, R4 = A(ORIGINAL SPEC)  SPEC NOT FOUND                      
         SPACE                                                                  
NXTSPECB DS    0H                  START SEARCH AT NEXT SPEC                    
         ST    R4,REGSTOR                                                       
         SR    R0,R0                                                            
*                                                                               
NSB005   ICM   R0,1,1(R4)            LOOK AT NEXT SPEC                          
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R4,R0                                                            
         CLI   0(R4),0                                                          
         BE    NSB020               END OF SPECS                                
         CLC   0(1,R4),SPEC        COMPARE TO SOUGHT SPEC CODE                  
         BE    NSB010               FOUND                                       
         CLI   0(R4),10            ONLY LOOK IN THIS REPORT                     
         BE    NSB020               STOP AT NEXT REPORT                         
         B     NSB005                                                           
*                                                                               
NSB010   CR    RB,RB               CC = 0    SPEC FOUND                         
         BR    RE                                                               
*                                                                               
NSB020   L     R4,REGSTOR                                                       
         LTR   RB,RB               CC = 2    SPEC NOT FOUND                     
         BR    RE                                                               
         EJECT                                                                  
         LTORG                                                                  
         SPACE 2                                                                
         DROP  R9,RB                                                            
         EJECT                                                                  
**===>FILTBUD                                                                   
*                                                                               
*        ROUTINE TO FILTER BUDGET RECORDS (REQUEST LEVEL)                       
*                                                                               
         SPACE                                                                  
FILTBUD  NMOD1 0,*FBUD*                                                         
         L     RC,0(R1)            RESET A(WORKSPACE)                           
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN - DON'T CHANGE VALUE                        
*                                                                               
         LA    R3,QWREQ                                                         
         USING QRECORD,R3                                                       
*                                                                               
         USING RPSPECD,R7                                                       
*                                                                               
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RF,VXSREP           A(MASTER/SUBSIDIARY TABLE)                   
         USING RSREPD,RF                                                        
         CLI   MASTREP,1           MASTER REP?                                  
         BE    FIBU0020            YES - SKIP REP CODE TEST                     
*                                                                               
         DROP  RF                                                               
*                                                                               
         CLC   QREP,RBUDKREP                                                    
         BNE   FIBU0900                                                         
*                                                                               
FIBU0020 EQU   *                                                                
*                                                                               
*                                     TO PERMIT PRIOR YEAR BUDGETS              
*   TEST FIBU                                                                   
*        MVC   P+1(08),=C'FIBU0020'                                             
*        GOTO1 REPORT                                                           
*   TEST FIBU END                                                               
*                                                                               
         CLC   =C'C*MP',RBUDKSTA   C*MP  BUDGET?                                
         BNE   FIBU0030            NO  - FILTER                                 
*                                                                               
***      CLC   =C'C*MP',QUESTOR    USE C*MP BUDGETS?                            
***      BE    FIBU0040            YES - DON'T FILTER                           
*                                                                               
         LA    RF,QWREQ3                                                        
         USING QREC3,RF                                                         
*                                                                               
         CLI   Q3COMBUD,C'Y'       THIS REQUEST USES C*MP BUDGETS?              
         BE    FIBU0040            NO  - CHECK FOR REGULAR BUDGET               
*                                                                               
         DROP  RF                                                               
*                                                                               
FIBU0030 EQU   *                                                                
*                                                                               
         GOTO1 =A(FILTSTA),DMCB,RBUDKSTA,RBUDKREP                               
         BNE   FIBU0900                                                         
*                                                                               
FIBU0040 EQU   *                                                                
*                                                                               
*   TEST C*MPANY BUDGET FILTERING: WILL REQUIRE REFINING BASED ON OTHER         
*        FIELDS FOR WHICH FILTERS HAVE BEEN SUBMITTED                           
*                                                                               
**       CLC   =C'C*MP',RBUDKSTA   C*MP  BUDGET?                                
**       BNE   FIBU0050            NO  - FILTER                                 
*                                                                               
**       CLC   =C'C*MP',QUESTOR    USE C*MP BUDGETS?                            
**       BE    FIBU0060            YES - DON'T FILTER                           
*                                                                               
FIBU0050 EQU   *                                                                
         CLC   QOFFICE,SPACES                                                   
         BE    FIBU0060                                                         
**OFFSET                                                                        
         CLI   QOFFICE,C'*'        OFFICE SET FILTER?                           
         BE    FIBU0052            YES - CHECK AGAINST SET                      
         CLC   QOFFICE,RBUDKTEM    NO  - CORRECT OFFICE?                        
         BNE   FIBU0900            NO  - REJECT IT                              
         B     FIBU0060            YES - ACCEPT IT                              
FIBU0052 EQU   *                                                                
         L     RF,QWOFFSET         SET A(OFFICE SET)                            
FIBU0054 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FIBU0056            YES - NO MATCH                               
         CLC   RBUDKTEM,0(RF)      NO  - OFFICE IN SET?                         
         BE    FIBU0058            YES - ACCEPT THIS RECORD                     
         LA    RF,2(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FIBU0054            GO BACK FOR NEXT                             
FIBU0056 EQU   *                                                                
         TM    QWSETFLG+1,EXOFFSET CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FIBU0060            YES - ACCEPT RECORD                          
         B     FIBU0900            NO  - REJECT RECORD                          
FIBU0058 EQU   *                                                                
         TM    QWSETFLG+1,EXOFFSET CODE FOUND IN SET: EXCLUDE SET?              
         BO    FIBU0900            YES - REJECT IT                              
         B     FIBU0060            NO  - ACCEPT IT                              
**OFFSET                                                                        
*                                                                               
FIBU0060 CLC   QREGION,SPACES                                                   
         BE    FIBU0120                                                         
         OC    RBUDKTEM,RBUDKTEM                                                
         BZ    FIBU0900                                                         
         MVI   INFCODE,4                                                        
         BAS   RE,FRSTINF6                                                      
         B     *+8                                                              
FIBU0080 BAS   RE,NEXTINF6                                                      
         BE    *+6                                                              
FIBU0100 DC    H'0'                                                             
         CLC   RBUDKREP,DOFFREP(R5) SAME REP?                                   
         BL    FIBU0100                                                         
         BH    FIBU0080                                                         
         CLC   RBUDKTEM,DOFFOFF(R5)                                             
         BNE   FIBU0080                                                         
         CLC   QREGION,DOFFRGN(R5)                                              
         BNE   FIBU0900                                                         
*                                                                               
FIBU0120 EQU   *                                                                
         OC    RPBUDCPP(8),RPBUDCPP                                             
*                                  PRIOR PERIOD BUDGET COLUMN?                  
         BZ    FIBU0140            NO  - NORMAL PROCESS                         
         CLC   BUDYR,QWPRIST       YES - PRIOR YEAR BUDGET?                     
         BE    FIBU0180            YES - ACCEPT IT                              
         CLC   BUDYR,QWPRIND                                                    
         BE    FIBU0180            YES - ACCEPT IT                              
FIBU0140 EQU   *                                                                
         CLC   RREPFMON,QWCURND+1                                               
         BH    FIBU0160                                                         
         CLC   BUDYR,QWCURST                                                    
         BE    FIBU0180                                                         
         CLC   BUDYR,QWCURND                                                    
         BE    FIBU0180                                                         
         CLI   RREPFMON,1                                                       
         BE    FIBU0900            NEED THIS YEAR'S BUD REC ONLY                
*                                                                               
FIBU0160 CLC   BUDYR,QWPRIST                                                    
         BE    FIBU0180                                                         
         CLC   BUDYR,QWPRIND                                                    
         BNE   FIBU0900            NEED PRIOR YEAR'S BUD REC ONLY               
*                                                                               
FIBU0180 EQU   *                                                                
         CLC   =C'C*MP',RBUDKSTA   C*MP BUDGET IN PROGRESS?                     
         BE    FIBU0800            YES - ACCEPT IT                              
*                                                                               
         CLC   QGROUP(2),SPACES                                                 
         BE    FIBU0800                                                         
         SR    R1,R1                                                            
         CLI   QGROUP,C'*'         GROUP SET REQUESTED?                         
         BE    FIBU0190            YES - COMPARE 2 CHARACTERS                   
         CLC   QSBGROUP,SPACES                                                  
         BE    FIBU0195            IF ONLY GROUP, COMPARE 1 BYTE                
FIBU0190 EQU   *                                                                
         LA    R1,1(R1)            IF GROUP & SUBGROUP, COMPARE 2 BYTES         
FIBU0195 EQU   *                                                                
         MVI   INFCODE,2                                                        
         BAS   RE,FRSTINF6                                                      
         B     *+8                                                              
FIBU0200 BAS   RE,NEXTINF6                                                      
         BE    *+6                                                              
FIBU0220 DC    H'0'                                                             
         CLC   RBUDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   FIBU0200                                                         
         CLC   RBUDKSTA,DSTNCALL(R5)                                            
         BNE   FIBU0200                                                         
*        MVC   P+1(11),=C'QGROUP    ='                                          
*        MVC   P+13(1),QGROUP                                                   
*        GOTO1 REPORT                                                           
         CLI   QGROUP,C'*'         GROUP SET REQUESTED?                         
         BNE   FIBU0270            NO                                           
*        L     RF,QWGRPSET         YES - GET A(GROUPS FOR THIS SET)             
*        MVC   P+1(11),=C'SET       ='                                          
*        MVC   P+13(10),0(RF)                                                   
*        GOTO1 REPORT                                                           
         L     RF,QWGRPSET         YES - GET A(GROUPS FOR THIS SET)             
FIBU0240 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FIBU0250            YES - NOT IN SET                             
         CLC   37(2,R5),0(RF)      NO  - COMPARE AGAINST SET                    
         BE    FIBU0260            FOUND -                                      
         LA    RF,2(RF)            NOT FOUND - BUMP TO NEXT ENTRY               
         B     FIBU0240            GO BACK FOR NEXT                             
FIBU0250 EQU   *                                                                
         TM    QWSETFLG,EXGRPSET   CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FIBU0800            YES - ACCEPT RECORD                          
         B     FIBU0280            NO  - REJECT RECORD                          
FIBU0260 EQU   *                                                                
         TM    QWSETFLG,EXGRPSET   CODE FOUND IN SET: EXCLUDE SET?              
         BO    FIBU0280            YES - REJECT IT                              
         B     FIBU0800            NO  - ACCEPT IT                              
FIBU0270 EQU   *                                                                
         EX    R1,FBCOMGRP                                                      
         BE    FIBU0800                                                         
FIBU0280 EQU   *                                                                
         CR    RB,R9               FILTERED AND DON'T INCLUDE IN TOTALS         
         B     FIBU1000            CC = 1                                       
*                                                                               
FIBU0800 CR    RB,RB               NOT FILTERED                                 
         B     FIBU1000            CC = 0                                       
*                                                                               
FIBU0900 CR    R9,RB               FILTERED, BUT INCLUDE IN TOTALS              
*                                  CC = 2                                       
FIBU1000 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
FBCOMGRP CLC   QGROUP,37(R5)       EXECUTED                                     
         SPACE 2                                                                
         DROP  R2,R3,R7                                                         
         EJECT                                                                  
*                                                                               
*        ROUTINE TO FIND INFORMATION ELEMENT FROM INFO POOL                     
*              INPUT:  INFCODE = ELEMENT CODE                                   
*              OUTPUT: R5      = A(ELEMENT)                                     
*                                                                               
         SPACE                                                                  
FRSTINF6 L     R5,ASPACND4                                                      
*                                                                               
FN6010   CLI   0(R5),0                                                          
         BE    FN6999                                                           
         CLC   INFCODE,0(R5)                                                    
         BER   RE                                                               
*                                                                               
NEXTINF6 SR    R0,R0                                                            
         ICM   R0,1,1(R5)                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R5,R0                                                            
         B     FN6010                                                           
*                                                                               
FN6999   LTR   RE,RE                                                            
         BR    RE                                                               
         LTORG                                                                  
         EJECT                                                                  
**===>FILTBUD                                                                   
*                                                                               
*        ROUTINE TO FILTER BUDGET RECORDS (REQUEST LEVEL)                       
*                                                                               
         SPACE                                                                  
SPBDFILT NMOD1 0,**SPBF**                                                       
*                                                                               
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         L     R2,4(R1)            RESET A(WORKAREA)                            
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN - DON'T CHANGE VALUE                        
*                                                                               
         LA    R3,QWREQ                                                         
         USING QRECORD,R3                                                       
*                                                                               
         USING RPSPECD,R7                                                       
*                                                                               
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RF,VXSREP           A(MASTER/SUBSIDIARY TABLE)                   
         USING RSREPD,RF                                                        
         CLI   MASTREP,1           MASTER REP?                                  
         BE    SPBF0020            YES - SKIP REP CODE TEST                     
*                                                                               
         DROP  RF                                                               
*                                                                               
         CLC   QREP,RSBDKREP       YES - TEST 1504 KEY                          
         BNE   SPBF0900                                                         
SPBF0020 EQU   *                                                                
*                                                                               
         CLI   RREPPROF+16,C'S'    S/P BUDGETS INCLUDE STATION?                 
         BNE   SPBF0040            NO  - NO STATION FILTER                      
*                                                                               
         GOTO1 =A(FILTSTA),DMCB,RSBDKSTA,RSBDKREP                               
         BNE   SPBF0900                                                         
*                                                                               
SPBF0040 EQU   *                                                                
*                                                                               
*   FIRST CHECK FOR USE OF DEVCONTYPE SET (INCLUDE OR EXCLUDE)                  
*                                                                               
         LA    RE,QWREQ2           SET A(REQUEST REC 2)                         
         USING QREC2,RE                                                         
*                                                                               
**DEVSET                                                                        
         CLI   QDEVCTYP,C'*'       DEVTYPE SET FILTER?                          
         BNE   SPBF0120            NO  - PROCESS BASED ON OPTION                
*                                                                               
         DROP  RE                                                               
*                                  YES - CHECK INCLUDE/EXCLUDE                  
         L     RF,QWDTYSET         SET A(DEVTYPE SET)                           
SPBF0060 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    SPBF0080            YES - NO MATCH                               
         CLC   0(2,RF),RSBDKDCT                                                 
*                                  DEV TYPE FOUND IN SET?                       
         BE    SPBF0100            YES - ACCEPT THIS RECORD                     
         LA    RF,2(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     SPBF0060            GO BACK FOR NEXT                             
SPBF0080 EQU   *                                                                
         TM    QWSETFLG,EXDTYSET   CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    SPBF0180            YES - ACCEPT RECORD                          
         B     SPBF0900            NO  - REJECT RECORD                          
SPBF0100 EQU   *                                                                
         TM    QWSETFLG,EXDTYSET   CODE FOUND IN SET: EXCLUDE SET?              
         BO    SPBF0900            YES - REJECT IT                              
         B     SPBF0180            NO  - ACCEPT IT                              
**DEVSET                                                                        
SPBF0120 EQU   *                                                                
         LA    RE,QWREQ3           SET A(REQUEST REC 2)                         
         USING QREC3,RE                                                         
*                                                                               
         CLI   Q3SALBUD,C'Y'       USE DEFAULT S/P BUDGET  ->                   
*                                     DEVTYPE + OTHER BUSINESS?                 
         BNE   SPBF0140            NO  - SEPARATE                               
*                                                                               
         DROP  RE                                                               
*                                                                               
         LA    RE,QWREQ2           SET A(REQUEST REC 2)                         
         USING QREC2,RE                                                         
*                                                                               
         CLC   QDEVCTYP,SPACES     ANY DEV CON TYPE FILTER?                     
         BE    SPBF0180            NO  - ACCEPT ALL TYPES                       
         CLC   QDEVCTYP,RSBDKDCT   YES -                                        
         BNE   SPBF0900            NOT SAME DEVCONTYPE                          
         B     SPBF0180            ACCEPTED                                     
*                                                                               
         DROP  RE                                                               
SPBF0140 EQU   *                                                                
*                                                                               
*   Q3SALBUD = 'O':  SHOW EITHER:                                               
*        A)  OTHER BUSINESS BUDGETS ONLY                                        
*        B)  SPECIFIC DEV CONTYPE BUDGET ON FILTER                              
*                                                                               
         LA    RE,QWREQ2           SET A(REQUEST REC 2)                         
         USING QREC2,RE                                                         
*                                                                               
         CLC   QDEVCTYP,SPACES     ANY DEV CON TYPE FILTER?                     
         BE    SPBF0160            NO  - ACCEPT ONLY GENERAL TYPES              
         CLC   QDEVCTYP,RSBDKDCT   YES -                                        
         BNE   SPBF0900            NOT SAME DEVCONTYPE                          
         B     SPBF0180            ACCEPTED                                     
SPBF0160 EQU   *                                                                
         CLC   RSBDKDCT,SPACES     YES                                          
         BH    SPBF0900            CONTAINS DEVCONTYPE:REJECT                   
*                                  ACCEPTED                                     
         B     SPBF0180                                                         
                                                                                
*                                                                               
         DROP  RE                                                               
SPBF0180 EQU   *                                                                
         CLC   QMAN,SPACES         ANY S/P FILTER?                              
         BE    SPBF0190            NO  -                                        
         CLC   RSBDKSAL,QMAN       YES - S/P MATCH?                             
         BNE   SPBF0900            NO  - SKIP THIS BUDGET                       
*                                                                               
SPBF0190 EQU   *                                                                
         CLC   QREGION,SPACES      ANY REGION FILTER?                           
         BNE   SPBF0900            YES - ASSUME NO MATCH                        
*                                                                               
         CLC   QOFFICE,SPACES      ANY OFFICE FILTER?                           
         BE    SPBF0240            NO                                           
*                                  YES                                          
*                                                                               
*   OFFICE IS IN THE SALESPERSON SPACEND ENTRY.  FIND IT,                       
*        CHECK AGAINST OFFICE VALUE                                             
*                                                                               
         MVI   INFCODE,6                                                        
         BAS   RE,FRSTINBD                                                      
         B     SPBF0220                                                         
SPBF0200 EQU   *                                                                
         BAS   RE,NEXTINBD                                                      
         BE    SPBF0220                                                         
         DC    H'0'                                                             
SPBF0220 EQU   *                                                                
         CLC   RSBDKREP,DSALREP(R5) SAME REP?                                   
         BNE   SPBF0200             NO  - GO BACK FOR NEXT                      
         CLC   RSBDKSAL,DSALSAL(R5) SAME SALESPERSON?                           
         BNE   SPBF0200             NO  - GO BACK FOR NEXT                      
         CLC   QOFFICE,DSALOFF(R5)  OFFICE FILTER MATCH                         
         BNE   SPBF0900             NO  - SKIP BUDGET                           
*                                                                               
*                                                                               
*   AT THIS POINT, IT SHOULD BE POSSIBLE TO DETERMINE THE                       
*        REGION OF THE SALESPERSON BUDGET RECORD BY                             
*        FINDING THE SALESPERSON CODE IN SPACEND, DETERMINING                   
*        THE OFFICE OF THE S/P, THEN LOOKING UP THE OFFICE                      
*        IN SPACEND, AND COMPARING THE REGION OF THE OFFICE                     
*        AGAINST THE REGION FILTER.  IF A MATCH, ACCEPT.                        
*   UNFORTUNATELY, THE S/P IN SPACEND DOES NOT INCLUDE THE                      
*        OFFICE OF THE S/P, AND, AT THIS POINT, I DON'T WANT                    
*        TO CHANGE THE SETUP.                                                   
*   THE LIKELIHOOD OF HITTING THIS IS SO REMOTE THAT IT IS                      
*        NOT REALLY WORTH THE EFFORT.                                           
*                                                                               
*                                                                               
SPBF0240 EQU   *                                                                
         OC    RPBUDCPP(8),RPBUDCPP                                             
*                                  PRIOR PERIOD BUDGET COLUMN?                  
         BZ    SPBF0260            NO  - NORMAL PROCESS                         
         CLC   BUDYR,QWPRIST       YES - PRIOR YEAR BUDGET?                     
         BE    SPBF0300            YES - ACCEPT IT                              
         CLC   BUDYR,QWPRIND                                                    
         BE    SPBF0300            YES - ACCEPT IT                              
SPBF0260 EQU   *                                                                
         CLC   RREPFMON,QWCURND+1                                               
         BH    SPBF0280                                                         
         CLC   BUDYR,QWCURST                                                    
         BE    SPBF0300                                                         
         CLC   BUDYR,QWCURND                                                    
         BE    SPBF0300                                                         
         CLI   RREPFMON,1                                                       
         BE    SPBF0900            NEED THIS YEAR'S BUD REC ONLY                
*                                                                               
SPBF0280 CLC   BUDYR,QWPRIST                                                    
         BE    SPBF0300                                                         
         CLC   BUDYR,QWPRIND                                                    
         BNE   SPBF0900            NEED PRIOR YEAR'S BUD REC ONLY               
*                                                                               
SPBF0300 EQU   *                                                                
         CLI   RREPPROF+16,C'S'    S/P BUDGETS INCLUDE STATION?                 
         BNE   SPBF0800            NO  - NO GROUP FILTERING NEEDED              
         CLC   QGROUP(2),SPACES                                                 
         BE    SPBF0800                                                         
         SR    R1,R1                                                            
         CLI   QGROUP,C'*'         GROUP SET REQUESTED?                         
         BE    SPBF0320            YES - COMPARE 2 CHARACTERS                   
         CLC   QSBGROUP,SPACES                                                  
         BE    SPBF0340            IF ONLY GROUP, COMPARE 1 BYTE                
SPBF0320 EQU   *                                                                
         LA    R1,1(R1)            IF GROUP & SUBGROUP, COMPARE 2 BYTES         
SPBF0340 EQU   *                                                                
         MVI   INFCODE,2                                                        
         BAS   RE,FRSTINBD                                                      
         B     *+8                                                              
SPBF0360 BAS   RE,NEXTINBD                                                      
         BE    *+6                                                              
SPBF0380 DC    H'0'                                                             
         CLC   RSBDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   SPBF0360                                                         
         CLC   RSBDKSTA,DSTNCALL(R5)                                            
         BNE   SPBF0360                                                         
*        MVC   P+1(11),=C'QGROUP    ='                                          
*        MVC   P+13(1),QGROUP                                                   
*        GOTO1 REPORT                                                           
         CLI   QGROUP,C'*'         GROUP SET REQUESTED?                         
         BNE   SPBF0460            NO                                           
*        L     RF,QWGRPSET         YES - GET A(GROUPS FOR THIS SET)             
*        MVC   P+1(11),=C'SET       ='                                          
*        MVC   P+13(10),0(RF)                                                   
*        GOTO1 REPORT                                                           
         L     RF,QWGRPSET         YES - GET A(GROUPS FOR THIS SET)             
SPBF0400 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    SPBF0420            YES - NOT IN SET                             
         CLC   37(2,R5),0(RF)      NO  - COMPARE AGAINST SET                    
         BE    SPBF0440            FOUND -                                      
         LA    RF,2(RF)            NOT FOUND - BUMP TO NEXT ENTRY               
         B     SPBF0400            GO BACK FOR NEXT                             
SPBF0420 EQU   *                                                                
         TM    QWSETFLG,EXGRPSET   CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    SPBF0800            YES - ACCEPT RECORD                          
         B     SPBF0480            NO  - REJECT RECORD                          
SPBF0440 EQU   *                                                                
         TM    QWSETFLG,EXGRPSET   CODE FOUND IN SET: EXCLUDE SET?              
         BO    SPBF0480            YES - REJECT IT                              
         B     SPBF0800            NO  - ACCEPT IT                              
SPBF0460 EQU   *                                                                
         EX    R1,SPCOMGRP                                                      
         BE    SPBF0800                                                         
SPBF0480 EQU   *                                                                
         CR    RB,R9               FILTERED AND DON'T INCLUDE IN TOTALS         
         B     SPBF1000            CC = 1                                       
*                                                                               
SPBF0800 CR    RB,RB               NOT FILTERED                                 
         B     SPBF1000            CC = 0                                       
*                                                                               
SPBF0900 CR    R9,RB               FILTERED, BUT INCLUDE IN TOTALS              
*                                  CC = 2                                       
SPBF1000 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
SPCOMGRP CLC   QGROUP,37(R5)       EXECUTED                                     
         SPACE 2                                                                
         DROP  R2,R3,R7                                                         
*                                                                               
*        ROUTINE TO FIND INFORMATION ELEMENT FROM INFO POOL                     
*              INPUT:  INFCODE = ELEMENT CODE                                   
*              OUTPUT: R5      = A(ELEMENT)                                     
*                                                                               
         SPACE                                                                  
FRSTINBD L     R5,ASPACND4                                                      
*                                                                               
FNBD6010 CLI   0(R5),0                                                          
         BE    FNBD6999                                                         
         CLC   INFCODE,0(R5)                                                    
         BER   RE                                                               
*                                                                               
NEXTINBD SR    R0,R0                                                            
         ICM   R0,1,1(R5)                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R5,R0                                                            
         B     FNBD6010                                                         
*                                                                               
FNBD6999 LTR   RE,RE                                                            
         BR    RE                                                               
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
**CKCMB                                                                         
*                                                                               
*   CHECK TABLE(S) TO DETERMINE IF REP IS A COMBO USER                          
*                                                                               
CKCMBRP  NMOD1 0,*CMRP*                                                         
         L     RC,0(R1)            RELOAD A(WORKSPACE)                          
         MVI   CMBOREP,C'N'        SET MASTER OR SUB TO 'NO'                    
         LA    RE,CMBOREPI         CHECK IF INTEREP OR SUBS                     
CMRP0020 EQU   *                                                                
         CLC   =C'00',0(RE)        END OF TABLE REACHED?                        
         BE    CMRP0060            YES - NOT INTEREP OR SUB                     
         CLC   RCREPFL,0(RE)                                                    
         BE    CMRP0040            RUN ID FOUND IN TABLE                        
         LA    RE,2(RE)            NOT FOUND - GO TO NEXT ENTRY                 
         B     CMRP0020                                                         
CMRP0040 EQU   *                                                                
         MVC   CMBOMSTR,=C'IR'     SET MASTER TO INTEREP                        
         MVI   CMBOREP,C'Y'        SET INTEREP OR SUB TO 'YES'                  
         B     CMRP0300                                                         
CMRP0060 EQU   *                                                                
         LA    RE,CMBOREPK         CHECK IF KATZ OR SUBS                        
CMRP0080 EQU   *                                                                
         CLC   =C'00',0(RE)        END OF TABLE REACHED?                        
         BE    CMRP0120            YES - NOT INTEREP OR SUB                     
         CLC   RCREPFL,0(RE)                                                    
         BE    CMRP0100            RUN ID FOUND IN TABLE                        
         LA    RE,2(RE)            NOT FOUND - GO TO NEXT ENTRY                 
         B     CMRP0080                                                         
CMRP0100 EQU   *                                                                
         MVC   CMBOMSTR,=C'K3'     SET MASTER TO KATZ RADIO                     
         MVI   CMBOREP,C'Y'        SET KATZ OR SUB TO 'YES'                     
         B     CMRP0300                                                         
CMRP0120 EQU   *                                                                
         LA    RE,CMBOREPT         CHECK IF TEST SUBTEST                        
CMRP0140 EQU   *                                                                
         CLC   =C'00',0(RE)        END OF TABLE REACHED?                        
         BE    CMRP0180            YES - NOT TEST OR SUB                        
         CLC   RCREPFL,0(RE)                                                    
         BE    CMRP0160            RUN ID FOUND IN TABLE                        
         LA    RE,2(RE)            NOT FOUND - GO TO NEXT ENTRY                 
         B     CMRP0140                                                         
CMRP0160 EQU   *                                                                
         MVC   CMBOMSTR,=C'7S'     SET MASTER TO TEST                           
         MVI   CMBOREP,C'Y'        SET TO 'YES'                                 
         B     CMRP0300                                                         
CMRP0180 EQU  *                                                                 
         LA    RE,CMBOREPN         CHECK IF NATL PUB SUBTEST                    
CMRP0200 EQU   *                                                                
         CLC   =C'00',0(RE)        END OF TABLE REACHED?                        
         BE    CMRP0230            YES - NOT NATPUB OR SUB                      
         CLC   RCREPFL,0(RE)                                                    
         BE    CMRP0220            RUN ID FOUND IN TABLE                        
         LA    RE,2(RE)            NOT FOUND - GO TO NEXT ENTRY                 
         B     CMRP0200                                                         
CMRP0220 EQU   *                                                                
         MVC   CMBOMSTR,=C'V6'     SET MASTER TO NATPUB                         
         MVI   CMBOREP,C'Y'        SET TO 'YES'                                 
         B     CMRP0300                                                         
CMRP0230 EQU   *                                                                
         LA    RE,CMBOREPM                                                      
CMRP0240 EQU   *                                                                
         CLC   =C'00',0(RE)        END OF TABLE REACHED?                        
         BE    CMRP0280            YES - NOT MASTER OR SUB                      
         CLC   RCREPFL,0(RE)                                                    
         BE    CMRP0260            RUN ID FOUND IN TABLE                        
         LA    RE,2(RE)            NOT FOUND - GO TO NEXT ENTRY                 
         B     CMRP0240                                                         
CMRP0260 EQU   *                                                                
         MVC   CMBOMSTR,=C'MS'     SET MASTER TO MASTER                         
         MVI   CMBOREP,C'Y'        SET TO 'YES'                                 
         B     CMRP0300                                                         
CMRP0280 EQU   *                                                                
CMRP0300 EQU  *                                                                 
         XIT1                                                                   
         LTORG                                                                  
**CKCMB                                                                         
         EJECT                                                                  
**===>                                                                          
*                                                                               
*   OPTSTAS:  SCANS SPACEND STATIONS, BUILDS A PARTICIPATING DATE               
*        TABLE BY STATION/JOIN/LEAVE/REP, THEN SORTS THE TABLE.                 
*        AFTER THAT, TABLE IS COLLAPSED INTO A SINGLE ENTRY PER                 
*        STATION, VARIABLE LENGTH, DETAILING HISTORY OF STATION FOR             
*        REP (MASTER OR SUBSIDIARY:  MASTER MAY HAVE MORE THAN ONE              
*        DATE, SUBS WILL HAVE ONLY ONE DATE.)                                   
*        FIRST TABLE IS BEGUN 64 BYTES INTO AOPTSTAS, THEN COLLAPSED            
*        INTO FIRST BYTE, SO THERE IS NO CHANCE OF OVERLAP.                     
*        COMBO STATIONS (-C) ARE SKIPPED, AS THEY HAVE NO CONTRACTS.            
*                                                                               
OPTSTAS  NMOD1 0,*OSTA*                                                         
         L     RC,0(R1)            RELOAD A(WORKSPACE)                          
         XC    LASTOSTA,LASTOSTA   CLEAR LAST STATION SEEN                      
         L     R5,ASPACND4         SORT STATIONS IN MARKET ORDER                
         L     RF,AOPTSTAS         SET A(OPTION STATION TABLE)                  
         LA    RF,FRSTOSET(RF)     OFFSET FOR FIRST PASS                        
         SR    R4,R4               INITIALIZE COUNTER                           
OSTA0020 EQU   *                                                                
         CLI   0(R5),0                                                          
         BNE   *+6                                                              
         DC    H'0'                END OF FILE:  NO STATIONS?                   
*                                                                               
         CLI   0(R5),2             FIND FIRST STATION ENTRY                     
         BE    OSTA0040                                                         
         ZIC   RE,1(R5)            BUMP TO NEXT ENTRY                           
         AR    R5,RE                                                            
         B     OSTA0020            GO BACK AND TEST NEXT                        
         SPACE 1                                                                
OSTA0040 EQU   *                                                                
         CLI   8(R5),C'C'          COMBO STATION?                               
         BE    OSTA0060            YES - DON'T PUT IN TABLE                     
         MVC   0(5,RF),04(R5)      INSERT STATION CALL LETTERS                  
         MVC   5(3,RF),09(R5)      INSERT JOIN  DATE                            
         MVC   8(3,RF),12(R5)      INSERT LEAVE DATE                            
         MVC   11(2,RF),02(R5)     INSERT REP CODE                              
         LA    RF,LOPTSTA(RF)      BUMP TO NEXT TABLE ENTRY                     
         LA    R4,1(R4)            INCREMENT COUNTER                            
OSTA0060 EQU   *                                                                
         ZIC   RE,1(R5)                                                         
         AR    R5,RE               BUMP TO NEXT ELEMENT                         
         CLI   0(R5),2             STILL A STATION ELEMENT?                     
         BE    OSTA0040            YES - ADD TO TABLE                           
*                                                                               
         L     R5,AOPTSTAS         SET A(OPTION STATION TABLE)                  
         LA    R5,FRSTOSET(R5)     OFFSET FOR 1ST PASS                          
         LA    R7,LOPTSTA          SET A(LENGTH OF ENTRY)                       
         GOTO1 =V(QSORT),DMCB,(0,(R5)),(R4),(R7),13,0                           
*                                                                               
*   TEST PRINT OPTSTAS TABLE                                                    
*                                                                               
*        MVC   P+1(13),=C'OPTSTAS TABLE'                                        
*        GOTO1 REPORT                                                           
*        L     R5,AOPTSTAS                                                      
*        LA    R5,FRSTOSET(R5)     OFFSET FOR 1ST PASS                          
TESTOP10 EQU   *                                                                
*        OC    0(LOPTSTA,R5),0(R5) ANY ENTRY?                                   
*        BZ    TESTOP50            NO  - FINISHED                               
*        MVC   P+1(05),0(R5)       YES - PRINT IT OUT                           
*        GOTO1 DATCON,DMCB,(3,5(R5)),(5,P+10)                                   
*        GOTO1 DATCON,DMCB,(3,8(R5)),(5,P+20)                                   
*        MVC   P+30(2),11(R5)                                                   
*        GOTO1 REPORT                                                           
*        LA    R5,LOPTSTA(R5)      BUMP TO NEXT ENTRY                           
*        B     TESTOP10            GO BACK FOR NEXT                             
TESTOP50 EQU   *                                                                
*                                                                               
*   TEST PRINT OPTSTAS TABLE END                                                
*                                                                               
*                                                                               
*   COLLAPSED TABLE SETUP (COVERED BY R5):                                      
*        MINIMUM ENTRY:  12 BYTES                                               
*           BYTES 1  -   5  =  STATION CALL LETTERS                             
*           BYTE  6         =  TABLE ENTRY LENGTH                               
*           BYTES 7  -   9  =  JOIN DATE (MUST BE PRESENT)                      
*           BYTES 10 -   12 =  LEAVE DATE (MAY BE PRESENT -                     
*                                          IF NOT, X'FFFFFF')                   
*        IF MULTIPLE DATES, NEXT SIX BYTES WILL CONTAIN NEXT                    
*           JOIN/LEAVE DATE SET, WITH LENGTH OF ENTRY INCREASED                 
*           BY 6 FOR EACH OCCURRENCE.                                           
*                                                                               
         L     R5,AOPTSTAS         SET A(1ST POSITION OF TABLE)                 
         ST    R5,ANEWSTA          SET FOR 1ST TIME NEW STATION                 
         LR    R4,R5               SET A(1ST POSITION, 1ST PASS)                
         LA    R4,FRSTOSET(R4)     OFFSET TO 1ST POSITION                       
OSTA0080 EQU   *                                                                
         OC    0(LOPTSTA,R4),0(R4) ANY ENTRY?                                   
         BZ    OSTA0600            NO  - FINISHED                               
*                                                                               
*   TEST OSTA0080 DISPLAY                                                       
*        MVC   P+1(11),=C'INPUT ARRAY'                                          
*        MVC   P+20(LOPTSTA),0(R4)                                              
*        GOTO1 REPORT                                                           
*   TEST OSTA0080 END                                                           
*                                                                               
         CLC   LASTOSTA,0(R4)      LAST STATION = THIS STATION?                 
         BNE   OSTA0400            NO  - SET NEW ENTRY                          
*                                                                               
*   MATCHING STATION:  FIGURE OUT DATES                                         
*                                                                               
         BAS   RE,MATCHSTA         SET STATION DATES FOR MATCH                  
         L     R3,DUB              SET A(NEXT SLOT)                             
         LA    R4,LOPTSTA(R4)      BUMP TO NEXT TABLE ENTRY                     
         B     OSTA0080            GO BACK FOR NEXT                             
OSTA0400 EQU   *                                                                
         L     R5,ANEWSTA          SET A(NEXT SLOT)                             
*                                                                               
*   TEST NEW SLOT                                                               
*        MVC   P+1(09),=C'NEW SLOT='                                            
*        MVC   P+15(12),0(R5)                                                   
*        GOTO1 REPORT                                                           
*   TEST NEW SLOT END                                                           
*                                                                               
         MVC   LASTOSTA,0(R4)      SET LAST STATION                             
         MVC   0(5,R5),0(R4)       INSERT STATION INTO TABLE                    
         MVI   5(R5),12            SET LENGTH OF ENTRY                          
         MVC   6(6,R5),5(R4)       MOVE JOIN/LEAVE DATES TO TABLE               
         OC    9(3,R5),9(R5)       LEAVE DATE = X'00' (EMPTY?)                  
         BNZ   OSTA0420            NO  - LEAVE AS IS                            
         MVC   9(3,R5),=X'FFFFFF'  YES - SET TO HIGH VALUE                      
OSTA0420 EQU   *                                                                
*                                                                               
*   TEST OSTA0420 DISPLAY                                                       
*        MVC   P+1(11),=C'O/PUT ARRAY'                                          
*        MVC   P+20(12),0(R5)      BASIC RECORD DISPLAY                         
*        GOTO1 REPORT                                                           
*   TEST OSTA0420 END                                                           
*                                                                               
         LR    R3,R5               SET A(NEXT DATES IN BUCKET)                  
         LA    R3,12(R3)           SKIP STA/LENGTH/1ST SET OF DATES             
         XC    0(12,R3),0(R3)      CLEAR NEXT ENTRY                             
         ST    R3,ANEWSTA          SAVE A(NEW STATION)                          
OSTA0500 EQU   *                                                                
         LA    R4,LOPTSTA(R4)      BUMP TO NEXT STATION IN TABLE                
         B     OSTA0080            GO BACK FOR NEXT                             
OSTA0600 EQU   *                                                                
         XIT1                                                                   
ANEWSTA  DS    F                                                                
LASTOSTA DS    CL5                 LAST STATION SEEN                            
LOPTSTA  EQU   15                  LENGTH OPTSTA TABLE ENTRY                    
FRSTOSET EQU   64              FIRST PASS OFFSET                                
         EJECT                                                                  
*                                                                               
*   MATCHSTA:  STATION MATCH FOUND IN TABLE.  COMPARE AND SET DATES             
*        IN ARRAY FOR THIS STATION.                                             
*        R3  -> NEXT DATE SLOT IN TABLE ENTRY                                   
*        R4  -> OPTSTA TABLE ENTRY (+5 = JOIN/LEAVE DATES)                      
*        R5  -> TABLE ENTRY START                                               
*   DUE TO SORT ORDER, START DATES ARE IN ASCENDING SEQUENCE, AND ONLY          
*        'EQUAL TO' AND 'HIGH' ARE CONSIDERATIONS.                              
*                                                                               
JOINMTCH EQU   5                                                                
LEAVMTCH EQU   8                                                                
*                                                                               
MATCHSTA NTR1                                                                   
         LR    R6,R5               SET A(TABLE ENTRY START)                     
         LA    R6,6(R6)            SET TO 1ST SET OF DATES IN ENTRY             
MTCH0020 EQU   *                                                                
         CLC   JOINMTCH(3,R4),0(R6)                                             
*                                  OPTSTA JOIN DATE VS TABLE JOIN DATE          
         BE    MTCH0080            DATES EQUAL: CHECK END DATE                  
*                                  OPTSTA > TABLE JOIN DATE: CHECK              
*                                     OPTSTA JOIN VS TABLE END DATE             
         CLC   JOINMTCH(3,R4),3(R6)                                             
*                                  OPTSTA JOIN DATE VS TABLE LEAVE DT           
         BNH   MTCH0080            OPTSTA <= TABLE LEAVE DATE: CHECK            
*                                     LEAVE VS LEAVE DATES                      
*                                  OPTSTA > TABLE LEAVE DATE: CHECK             
*                                     FOR ONE DAY SEPARATION                    
         MVC   WORK+24(3),3(R6)    SET TABLE LEAVE DATE                         
         GOTO1 DATCON,DMCB,(3,WORK+24),(X'00',WORK)                             
*                                  TABLE LEAVE DATE --> EBCDIC                  
         MVC   WORK+24(3),JOINMTCH(R4)                                          
*                                  SET STATION JOIN DATE                        
         GOTO1 DATCON,DMCB,(3,WORK+24),(X'00',WORK+6)                           
*                                  OPTSTA JOIN DATE --> EBCDIC                  
         GOTO1 =V(PERVERT),DMCB,WORK,WORK+6                                     
         CLC   DMCB+8(2),=X'0002'  TWO DAYS INCLUSIVE =                         
         BNH   MTCH0080               SINGLE DAY:  TREAT AS CONTINUOUS          
*                                  MORE THAN SINGLE DAY:  MOVE TO               
*                                     NEXT SLOT                                 
*                                                                               
*   TEST                                                                        
*        MVC   P+1(14),=C'PERVERT CHECK:'                                       
*        MVC   P+16(6),WORK                                                     
*        MVC   P+26(6),WORK+6                                                   
*        MVC   P+36(2),DMCB+8                                                   
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         OC    6(6,R6),6(R6)       NEXT SLOT EMPTY?                             
         BZ    MTCH0060            YES - MOVE ENTRIES TO TABLE                  
*                                     AND BUMP ENTRY LENGTH                     
         LA    R6,6(R6)            NO  - BUMP TO NEXT SET OF DATES              
         B     MTCH0020            GO BACK AND COMPARE                          
MTCH0060 EQU   *                                                                
         LA    R6,6(R6)            BUMP TO NEXT SLOT                            
         MVC   0(6,R6),JOINMTCH(R4)                                             
*                                  MOVE JOIN/LEAVE TO NEXT ENTRY                
         OC    3(3,R6),3(R6)       ANY END DATE?                                
         BNZ   MTCH0070            YES                                          
         MVC   3(3,R6),=X'FFFFFF'  NO  - SET TO HIGH VALUE                      
MTCH0070 EQU   *                                                                
         LA    R6,6(R6)            BUMP TO NEXT SLOT                            
         XC    0(6,R6),0(R6)       CLEAR IT OUT                                 
         ST    R6,DUB              SAVE FOR RETURN                              
         ZIC   RF,5(R5)            INCREMENT ENTRY LENGTH                       
         LA    RF,6(RF)                                                         
         STC   RF,5(R5)            REINSERT INTO TABLE                          
         L     RE,ANEWSTA          INCREMENT NEW STATION ADDR BY 6              
         LA    RE,6(RE)                                                         
         ST    RE,ANEWSTA          PUT IT BACK                                  
*                                                                               
*   TEST DISPLAY EXT TABLE ENTRY                                                
TESTDI20 EQU   *                                                                
*        MVC   P+1(10),=C'EXT-TABLE:'                                           
*        BCTR  RF,0                DECREMENT 1 FOR EX                           
*        EX    RF,TESTDI40                                                      
*        GOTO1 REPORT                                                           
*        MVC   P+1(10),=C'NEXT SLOT='                                           
*        MVC   P+15(6),0(R6)                                                    
*        GOTO1 REPORT                                                           
*   TEST DISPLAY EXT TABLE ENTRY END                                            
*                                                                               
         B     MTCH0800            EXIT                                         
TESTDI40 MVC   P+15(0),0(R5)                                                    
*                                                                               
MTCH0080 EQU   *                                                                
         OC    LEAVMTCH(3,R4),LEAVMTCH(R4)                                      
*                                  ANY LEAVE DATE?                              
         BNZ   MTCH0090            YES - USE IT                                 
         MVC   LEAVMTCH(3,R4),=X'FFFFFF'                                        
*                                  NO  - SET TO HIGH VALUE                      
MTCH0090 EQU   *                                                                
         CLC   LEAVMTCH(3,R4),3(R6)                                             
*                                  OPTSTA LEAVE DATE VS TABLE LEAVE DT          
         BNH   MTCH0100            OPTSTA <= TABLE LEAVE DATE: LEAVE            
*                                     AS SET                                    
         MVC   3(3,R6),LEAVMTCH(R4)                                             
*                                  OPTSTA > TABLE LEAVE:  INSERT IT             
*                                                                               
*   TEST DISPLAY EXT TABLE ENTRY                                                
*        ZIC   RF,5(R5)            GET LENGTH OF TABLE                          
*        MVC   P+1(10),=C'EXT TABLE:'                                           
*        BCTR  RF,0                DECREMENT 1 FOR EX                           
*        EX    RF,TESTDI60                                                      
*        GOTO1 REPORT                                                           
*   TEST DISPLAY EXT TABLE ENTRY END                                            
*                                                                               
         B     MTCH0800            EXIT                                         
TESTDI60 MVC   P+15(0),0(R5)                                                    
*                                                                               
MTCH0100 EQU   *                                                                
         ST    R3,DUB              SET FOR RETURN                               
MTCH0800 EQU   *                                                                
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*   IF R5 OPTION IS SPECIFIED, A DATE ARRAY REPRESENTATIVE OF THE               
*        STATUS OF THE STATION WITH REGARD TO THE REPORT REQUEST                
*        PERIOD IS CONSTRUCTED.  THIS INDICATES WHICH MONTHS OF THE             
*        REQUEST ARE TO BE INCLUDED OR EXCLUDED FOR PRIOR/CURRENT               
*        DATA.                                                                  
*   THIS ROUTINE WILL BE CALLED ONCE FOR EACH CONTRACT PROCESSED.               
*        THE TABLE WILL THEREAFTER BE CHECKED IN ROUTINE 'GAINLOST'             
*        FOR EACH MONTH REPRESENTED BY THE CONTRACT.                            
*                                                                               
*                                                                               
SETR5DTS NMOD1 0,*STR5*                                                         
         L     RC,0(R1)            RESET A(WORKSPACE)                           
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
         L     R5,=A(ARRAYR5)      SET A(ARRAY)                                 
         XC    0(L'ARRAYR5,R5),0(R5)                                            
*                                  CLEAR THE ARRAY                              
         ZIC   RE,QWCURST          SET YR OF CURRENT START                      
         ZIC   RF,QWCURST+1        SET MO OF CURRENT START                      
SEDT0020 EQU   *                                                                
         STC   RE,0(R5)            INSERT YR INTO TABLE: 1ST BYTE               
         STC   RF,1(R5)            INSERT MO INTO TABLE: 2ND BYTE               
         CH    RF,=H'12'           MONTH = 12?                                  
         BNE   SEDT0040            NO                                           
         LA    RF,1                YES - RESET MONTH TO 1                       
         LA    RE,1(RE)            BUMP THE YEAR BY 1                           
         B     SEDT0060                                                         
SEDT0040 EQU   *                                                                
         LA    RF,1(RF)            BUMP THE MONTH BY 1                          
SEDT0060 EQU   *                                                                
         CLC   QWCURND,0(R5)       MONTH IN TABLE = REQUEST END?                
         BE    SEDT0080                                                         
         LA    R5,3(R5)            NO  - BUMP TO NEXT TABLE ENTRY               
         B     SEDT0020            GO BACK AND LOAD NEXT MONTH                  
SEDT0080 EQU   *                                                                
*                                                                               
         L     R6,AOPTSTAS         SET A(OPT STATION TABLE)                     
SEDT0100 EQU   *                                                                
         OC    0(6,R6),0(R6)       ANY ENTRY IN TABLE?                          
         BNZ   *+6                 YES                                          
         DC    H'0'                STATION NOT IN TABLE?                        
         CLC   RCONKSTA(5),0(R6)   STATION FOUND IN TABLE?                      
         BE    SEDT0120            YES                                          
         ZIC   RF,5(R6)            GET L(TABLE ENTRY)                           
         AR    R6,RF               BUMP TO NEXT ENTRY                           
         B     SEDT0100            GO BACK FOR NEXT                             
SEDT0120 EQU   *                                                                
*                                                                               
*   TEST DISPLAY SEDT0120                                                       
*        MVC   P+1(11),=C'TABLE FOUND'                                          
*        MVC   P+13(2),RCONKREP                                                 
*        MVC   P+18(4),RCONKCON                                                 
*        ZIC   RF,5(R6)            GET LENGTH OF ENTRY                          
*        BCTR  RF,0                DECREMENT FOR DISPLAY                        
*        EX    RF,TSED0020                                                      
*        GOTO1 REPORT                                                           
*        B     TSED0040                                                         
TSED0020 EQU   *                                                                
*        MVC   P+35(0),0(R6)       MOVE BY LENGTH                               
TSED0040 EQU   *                                                                
*   TEST DISPLAY SEDT0120 END                                                   
*                                                                               
         ZIC   R1,5(R6)            GET L(TABLE ENTRY)                           
         SH    R1,=H'6'            SUBTRACT L(STATION/LEN BYTE)                 
         SR    R0,R0                                                            
         D     R0,=F'6'            DIVIDE TO CALC # ENTRIES                     
*                                                                               
*   R1 NOW CONTAINS # OF DATE SETS FOR STATION'S TABLE ENTRY                    
*                                                                               
         LR    R7,R1               SAVE # ENTRIES                               
         ST    R7,LOOPPRI          SAVE LOOP CONTROL VALUE                      
         ST    R7,LOOPSET          SAVE LOOP CONTROL VALUE                      
         LA    R6,6(R6)            POINT TO FIRST DATE SET                      
         LR    R5,R6               SAVE A(1ST DATE SET)                         
*                                                                               
*   TEST                                                                        
*        MVC   P+1(22),=C'# ENTRIES FOR STATION='                               
*        EDIT  (R1),(3,P+25)                                                    
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
SEDT0140 EQU   *                                                                
**       MVC   P+1(09),=C'R5 DATES:'                                            
**       L     RF,=A(ARRAYR5)                                                   
**       MVC   P+12(36),0(RF)                                                   
**       GOTO1 REPORT                                                           
*                                                                               
*   TEST # 1:  DID STATION LEAVE PRE CURRENT START DATE OF REQUEST?             
*                                                                               
         SR    R0,R0               USE # ENTRIES TO ADDRESS LAST                
*                                     LEAVE DATE                                
         BCTR  R1,0                MAKE ZERO RELATIVE                           
         MH    R1,=H'6'            #(ENTRIES) * L(ENTRY)                        
         AR    R1,R6               DISPLACEMENT + A(1ST DATE FLD)               
*                                                                               
*   TEST LEAVE PRE CURR                                                         
*        MVC   P+1(12),=C'LV PRE CURR:'                                         
*        MVC   P+15(2),=C'LV'                                                   
*        MVC   P+18(3),3(R1)       INSERT LEAVE DATE                            
*        MVI   P+21,C'/'                                                        
*        MVC   P+22(3),=C'CUR'                                                  
*        MVC   P+26(3),QWCURST                                                  
*        GOTO1 REPORT                                                           
*   TEST LEAVE PRE CURR END                                                     
*                                                                               
         CLC   3(2,R1),QWCURST     LAST LEAVE DATE VS CURR START                
         BL    SEDT2000            LEFT BEFORE CURRENT START DATE               
*                                     SKIP ALL DATA                             
*                                                                               
*   TEST # 2:  DID STATION JOIN DURING CURRENT REQUEST PERIOD?                  
*                                                                               
         LR    R1,R7               RESET # OF ENTRIES IN TABLE                  
         LR    R6,R5               RESET A(1ST ENTRY IN TABLE)                  
*                                                                               
*   TEST JOIN DUR CURR                                                          
*        MVC   P+1(12),=C'JN DUR CURR:'                                         
*        MVC   P+15(3),=C'CUR'                                                  
*        MVC   P+19(3),QWCURST                                                  
*        MVI   P+22,C'/'                                                        
*        MVC   P+23(2),=C'JN'                                                   
*        MVC   P+26(3),0(R6)       INSERT LEAVE DATE                            
*        GOTO1 REPORT                                                           
*   TEST JOIN DUR CURR END                                                      
*                                                                               
         CLC   QWCURST,0(R6)       CURR START DATE VS 1ST JOIN DATE             
         BNH   SEDT2000            JOINED CURR START DATE OR LATER              
*                                     SKIP ALL DATA                             
*                                                                               
*   TEST # 3:  DID STATION JOIN DURING PRIOR YEAR OF REQUEST PERIOD?            
*                                                                               
*                                                                               
*   TEST JOIN DUR PRIOR                                                         
*        MVC   P+1(12),=C'JN DUR PRIR:'                                         
*        MVC   P+15(3),=C'PRI'                                                  
*        MVC   P+19(3),QWPRIST                                                  
*        MVI   P+22,C'/'                                                        
*        MVC   P+23(2),=C'JN'                                                   
*        MVC   P+26(3),0(R6)       INSERT LEAVE DATE                            
*        MVI   P+29,C'/'                                                        
*        MVC   P+30(3),=C'CUR'                                                  
*        MVC   P+33(3),QWCURST                                                  
*        GOTO1 REPORT                                                           
*   TEST JOIN DUR PRIOR END                                                     
*                                                                               
         CLC   0(2,R6),QWPRIST     1ST JOIN DATE VS PRIOR START DATE            
         BL    SEDT0400            JOINED PRE-PRIOR START DATE                  
*                                                                               
*                                  JOINED ON OR AFTER PRIOR START DATE          
         CLC   0(2,R6),QWCURST     1ST JOIN DATE VS CURR START DATE             
         BNL   SEDT2000            SHOULDN'T HAPPEN:  WEEDED OUT BY             
*                                     'JOINED CURRENT LOGIC'                    
*                                                                               
*   AT THIS POINT, IT HAS BEEN DETERMINED THAT THE STATION JOINED               
*        DURING THE PRIOR REQUEST YEAR.  IT MUST NOW BE CHECKED FOR:            
*        1.  LEFT  PRIOR :  EXCLUDE ALL CURR/PRIOR                              
*        2.  STILL JOINED:  SHOW COMPARABLE CURR/PRIOR                          
*        3.  LEFT  PRIOR/REJOINED PRIOR:  SHOW COMPARABLE CURR/PRIOR            
*                                                                               
SEDT0160 EQU   *                                                                
*                                                                               
*   TEST JOIN DUR PRIOR                                                         
*        MVC   P+1(12),=C'JN/LV  PRIR:'                                         
*        MVC   P+15(3),=C'PRI'                                                  
*        MVC   P+19(3),QWPRIST                                                  
*        MVI   P+22,C'/'                                                        
*        MVC   P+23(2),=C'JL'                                                   
*        MVC   P+26(6),0(R6)       INSERT JOIN/LEAVE DATE                       
*        MVI   P+32,C'/'                                                        
*        MVC   P+33(3),=C'CUR'                                                  
*        MVC   P+36(3),QWCURST                                                  
*        GOTO1 REPORT                                                           
*   TEST JOIN DUR PRIOR END                                                     
*                                                                               
         CLC   3(2,R6),QWCURST     LEAVE DATE VS CURR START DATE                
         BNL   SEDT0200            NOT LEFT WITHIN PRIOR PERIOD                 
*                                     'SHOW COMPARABLE'                         
*                                                                               
*                                  LEFT W/IN PRIOR:  REJOINED?                  
         LA    R6,6(R6)            BUMP TO NEXT DATE BUCKET                     
         L     RF,LOOPPRI                                                       
         BCTR  RF,0                DECREMENT LOOP CONTROL                       
         LTR   RF,RF               ANYTHING LEFT?                               
         BZ    SEDT2000            NO  - NOT REJOINED                           
         ST    RF,LOOPPRI          SAVE COUNTER                                 
         CLC   0(2,R6),QWCURST     NEXT JOIN DATE VS CURR START DATE            
         BL    SEDT0160            REJOINED IN PRI YR - CHECK LEAVE             
         B     SEDT2000            REJOINED, BUT NOT IN PRIOR YEAR              
SEDT0200 EQU   *                                                                
         BAS   RE,SETARRAY                                                      
         B     SEDT4000            EXIT                                         
LOOPPRI  DS    F                   LOOP CONTROL:  JOIN/LEAVE TESTING            
LOOPSET  DS    F                   LOOP CONTROL:  ARRAY FINAL SETTING           
SEDT0400 EQU   *                                                                
*   JOINED-PRE-PRIOR PROCESSING HERE                                            
*        NOTE:  AT THIS TIME, THERE IS NO DIFFERENCE BETWEEN JOINED             
*        DURING PRIOR AND JOINED PRE-PRIOR PROCESSING.  THE TWO                 
*        SECTIONS ARE SEPARATED IN THE EVENT THAT DIFFERING REQUIRE-            
*        MENTS ARISE LATER, AT WHICH TIME THEY CAN BE PROPERLY                  
*        INCORPORATED WITHOUT MAJOR REVISIONS.                                  
*                                                                               
*   AT THIS POINT, IT HAS BEEN DETERMINED THAT THE STATION JOINED               
*        BEFORE THE PRIOR REQUEST PERIOD.  IT MUST NOW BE CHECKED FOR:          
*        1.  LEFT  PRIOR :  EXCLUDE ALL CURR/PRIOR                              
*        2.  STILL JOINED:  SHOW COMPARABLE CURR/PRIOR                          
*        3.  LEFT  PRIOR/REJOINED PRIOR:  SHOW COMPARABLE CURR/PRIOR            
*        4.  LEFT  CURR:  SHOW COMPARABLE CURR/PRIOR                            
*        5.  LEFT  CURR/REJOINED CURR:  SHOW COMPARABLE CURR/PRIOR              
*                                                                               
*                                                                               
*   TEST JOIN BEFORE PRIOR                                                      
*        MVC   P+1(13),=C'JN/LV  BEFORE'                                        
*        MVC   P+15(3),=C'PRI'                                                  
*        MVC   P+19(3),QWPRIST                                                  
*        MVI   P+22,C'/'                                                        
*        MVC   P+23(2),=C'JL'                                                   
*        MVC   P+26(6),0(R6)       INSERT JOIN/LEAVE DATE                       
*        MVI   P+32,C'/'                                                        
*        MVC   P+33(3),=C'CUR'                                                  
*        MVC   P+36(3),QWCURST                                                  
*        GOTO1 REPORT                                                           
*   TEST JOIN DUR PRIOR END                                                     
*                                                                               
         CLC   3(2,R6),QWCURST     LEAVE DATE VS CURR START DATE                
         BNL   SEDT0420            NOT LEFT WITHIN PRIOR PERIOD                 
*                                     'SHOW COMPARABLE'                         
*                                                                               
*                                  LEFT W/IN PRIOR:  REJOINED?                  
         LA    R6,6(R6)            BUMP TO NEXT DATE BUCKET                     
         L     RF,LOOPPRI                                                       
         BCTR  RF,0                DECREMENT LOOP CONTROL                       
         LTR   RF,RF               ANYTHING LEFT?                               
         BZ    SEDT2000            NO  - NOT REJOINED                           
         ST    RF,LOOPPRI          SAVE COUNTER                                 
         CLC   0(2,R6),QWCURST     NEXT JOIN DATE VS CURR START DATE            
         BL    SEDT0400            REJOINED IN PRI YR - CHECK LEAVE             
         B     SEDT2000            REJOINED, BUT NOT IN PRIOR YEAR              
SEDT0420 EQU   *                                                                
         BAS   RE,SETARRAY                                                      
         B     SEDT4000            EXIT                                         
SEDT2000 EQU   *                                                                
*                                                                               
*   TEST DATA SKIPPED MESSAGE                                                   
*        MVC   P+1(15),=C'****>>> SKIPPED'                                      
*        MVC   P+17(5),RCONKSTA                                                 
*        GOTO1 REPORT                                                           
*   TEST DATA SKIPPED MESSAGE                                                   
*                                                                               
SEDT4000 EQU   *                                                                
         XIT1                                                                   
*                                                                               
         EJECT                                                                  
*                                                                               
*   SETARRAY:  DETERMINED THAT COMPARABLE PERIODS ARE TO BE REPORTED.           
*        THE TIME-LINE FOR THE STATION IS SCANNED AND, FOR EACH                 
*        MONTH WITHIN THE REQUEST PERIOD, THE PRIOR/CURRENT FLAGS               
*        ARE SET IF THE STATION WAS JOINED FOR THAT MONTH                       
*        TWO PASSES WILL BE MADE THROUGH THE ARRAY.  THE FIRST                  
*        PASS WILL TURN ON PRIOR MONTH FLAGS FOR ALL MONTHS THE                 
*        STATION WAS OWNED DURING THE PRIOR PERIOD, AS WELL AS                  
*        CHECKING TO TURN ON CURRENT MONTH FLAGS FOR ALL MONTHS                 
*        THE STATION WAS OWNED DURING THE CURRENT PERIOD.  THE                  
*        SECOND PASS WILL TURN OFF ALL MONTHS IN WHICH BOTH FLAGS               
*        ARE NOT SET.  THIS WILL RESULT IN ONLY THOSE COMPARABLE                
*        MONTHS BEING SET.                                                      
*                                                                               
*        R5 --> FIRST SET OF DATES IN STATION TABLE ENTRY                       
*        R7 --> # ENTRIES IN STATION TABLE ENTRY (ALSO LOOPSET)                 
*                                                                               
SETARRAY NTR1                                                                   
         L     R6,=A(ARRAYR5)      SET A(ARRAY)                                 
         LR    R1,R5               SAVE A(1ST DATE IN TABLE)                    
SARR0020 EQU   *                                                                
*                                                                               
*   EXAMPLE:  ARRAY IS 9701-9712, PRIOR YEAR IS 9601-9612                       
*             STATION TABLE ENTRY IS J:9603-L:9606 J:9609-L:XFFFF               
*                                                                               
         ZIC   RF,0(R6)            CALC PRIOR PER YM FROM CURRENT               
*                                     IE:  9701 -> 9601                         
         BCTR  RF,0                BACK UP 1 YEAR                               
         STC   RF,SARRPRI          INSERT YEAR OF CURRENT DATE                  
         MVC   SARRPRI+1(1),1(R6)  INSERT MONTH OF CURRENT DATE                 
         CLC   SARRPRI,0(R1)       ARRAY DATE (PRI) VS TABLE START DATE         
*                                     IE:  9601 VS 9603                         
         BL    SARR0040            NOT JOINED YET                               
         CLC   SARRPRI,3(R1)       ARRAY DATE (PRI) VS TABLE LEAVE DATE         
*                                     IE:  9603 VS 9603                         
         BH    SARR0040            JOINED, BUT LEFT                             
         OI    2(R6),X'80'         JOINED/ACTIVE DURING PRIOR MONTH             
SARR0040 EQU   *                                                                
         CLC   0(2,R6),0(R1)       ARRAY DATE VS TABLE START DATE               
         BL    SARR0060            NOT JOINED YET                               
         CLC   0(2,R6),3(R1)       ARRAY DATE VS TABLE START DATE               
         BH    SARR0060            JOINED, BUT LEFT                             
         OI    2(R6),X'40'         JOINED/ACTIVE DURING PRIOR MONTH             
SARR0060 EQU   *                                                                
         LA    R1,6(R1)            BUMP TO NEXT STATION DATES                   
         BCT   R7,SARR0020         GO BACK AND CHECK NEXT STATN DATES           
         L     R7,LOOPSET          RESET STATN DATE LOOP                        
         LR    R1,R5               RESET A(1ST DATE IN TABLE)                   
         LA    R6,3(R6)            BUMP TO NEXT ARRAY MONTH                     
         OC    0(3,R6),0(R6)       ANY ENTRY?                                   
         BNZ   SARR0020            YES - GO BACK AND CHECK IT                   
*                                  NO  - RESCAN ARRAY FOR COMPARABLE            
         L     R6,=A(ARRAYR5)      SET A(ARRAY)                                 
         LA    RF,12               SET LOOP CONTROL                             
SARR0080 EQU   *                                                                
         CLI   2(R6),X'C0'         BOTH PRIOR/CURRENT ON?                       
         BE    SARR0100            YES - LEAVE ON                               
         MVI   2(R6),0             NO  - SET BOTH OFF                           
SARR0100 EQU   *                                                                
         LA    R6,3(R6)            BUMP TO NEXT BUCKET                          
         BCT   RF,SARR0080         GO BACK AND CHECK NEXT                       
*                                                                               
*   TEST FINAL ARRAY SETUP                                                      
*        MVC   P+1(12),=C'FINAL ARRAY:'                                         
*        L     R6,=A(ARRAYR5)      SET A(ARRAY)                                 
*        MVC   P+15(39),0(R6)                                                   
*        GOTO1 REPORT                                                           
*   TEST FINAL ARRAY SETUP END                                                  
*                                                                               
         XIT1                                                                   
SARRPRI  DS    CL2                                                              
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*  GAINLOST:  ARRAYR5 IS SET UP BASED ON THE INTERACTION OF THE                 
*        CURRENT/PRIOR DATES OF THE REQUEST, AND THE TIME-LINE                  
*        PARTICIPATION OF THE STATION ACROSS ALL REFERENCES WITHIN              
*        SUBSIDIARIES.  THE ARRAY CONSISTS OF CURRENT MONTHS OF                 
*        THE REQUEST PERIOD.  IF THE MONTH'S DATA IS TO BE INCLUDED             
*        IN THE REPORT, THE FLAG BYTE HAS X'C0' SET (X'80' = PRIOR,             
*        X'40' = CURRENT).                                                      
*                                                                               
*   THIS ROUTINE IS CALLED BEFORE THE TRANSFER TO THE CALCULATION               
*        ROUTINE FOR A COLUMN.  THEREFORE, ALL COLUMNS FOR A MONTH              
*        ARE PROCESSED.                                                         
*                                                                               
*                                                                               
GAINLOST NMOD1 0,*GALO*                                                         
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         L     R4,4(R1)            RESET A(BUCKET)                              
         L     R6,=A(ARRAYR5)      SET A(ARRAY)                                 
         LA    R3,12               SET LOOP CONTROL                             
GALO0020 EQU   *                                                                
*                                                                               
*   TEST GALO0020                                                               
*        MVC   P+1(17),=C'SCANNING: CUR/BKT'                                    
*        MVC   P+20(2),CURDATE(R4)                                              
*        MVI   P+22,C'/'                                                        
*        MVC   P+23(3),0(R6)                                                    
*        GOTO1 REPORT                                                           
*   TEST GALO0020 END                                                           
*                                                                               
         CLC   CURDATE(2,R4),0(R6) BUCKET CURRENT DATE VS ARRAY DATE            
         BE    GALO0040            FOUND                                        
         LA    R6,3(R6)            BUMP TO NEXT BUCKET                          
         BCT   R3,GALO0020         GO BACK FOR NEXT                             
         B     GALO0240            NOT FOUND:  DON'T USE DATA                   
GALO0040 EQU   *                                                                
         CLI   2(R6),0             FLAG BYTE:  BITS SET?                        
         BE    GALO0240            NO  - DON'T USE DATA                         
         SR    R0,R0               YES - SET CC = ZERO                          
         B     GALO0280                                                         
GALO0240 EQU   *                                                                
         LTR   RB,RB               SET CC NOT ZERO                              
GALO0280 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*                                                                               
*   OPTION STATION TABLE TESTING:                                               
*        1.  R6 OPTION (TOM OLSEN REPORT):                                      
*            A.  GAINED STATION - IF GAIN MONTH IN CURRENT YEAR,                
*                1.  IF GAIN MONTH IS WITHIN CURRENT YEAR, EXCLUDE              
*                    THE STATION FROM THE REPORT                                
*                2.  IF GAIN MONTH IS WITHIN PRIOR   YEAR, INCLUDE              
*                    PRIOR DOLLARS JOIN MONTH FORWARD, AND CURRENT              
*                    DOLLARS FOR COMPARABLE MONTHS                              
*            B.  STATION GAINED BEFORE PRIOR PERIOD, NEVER LEFT -               
*                1.  DISPLAY ALL PRIOR DOLLARS                                  
*                2.  DISPLAY ALL CURRENT DOLLARS                                
*            C.  LOST STATION - STATION LEAVES WITHIN THE TWO-YEAR              
*                PERIOD (WHETHER IT RETURNS OR NOT)                             
*                1.  EXCLUDE ALL PRIOR DOLLARS                                  
*                2.  EXCLUDE ALL CURRENT DOLLARS                                
*                                                                               
*        THE OPTSTA TABLE CONTAINS THE DATE HISTORY OF ALL STATIONS.            
*        FIRST THE STATION IN QUESTION IS LOCATED. THEN, THE LEAVE              
*        DATES (2ND DATE OF PAIRS).  IF LEAVE DATE WITHIN REQUEST               
*        PERIOD IN ENCOUNTERED, STATION IS CONSIDERED AS HAVING                 
*        LEFT.  THIS IS BECAUSE THE TABLE HAS BEEN SMOOTHED, WITH               
*        ONLY GAPS BEING DELINEATED BETWEEN THE INITIAL JOIN AND THE            
*        FINAL LEAVE DATES.                                                     
*                                                                               
*   THIS ROUTINE IS CALLED BEFORE THE TRANSFER TO THE CALCULATION               
*        ROUTINE FOR A COLUMN.  THEREFORE, ALL COLUMNS FOR A MONTH              
*        ARE PROCESSED.                                                         
*                                                                               
*                                                                               
CHKOPSTA NMOD1 0,*COPS*                                                         
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         L     R4,4(R1)            RESET A(BUCKET)                              
         L     R2,8(R1)            RESET A(QWKD)                                
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
         L     R6,AOPTSTAS         SET A(OPT STATION TABLE)                     
COPS0020 EQU   *                                                                
         OC    0(6,R6),0(R6)       ANY ENTRY IN TABLE?                          
         BNZ   *+6                 YES                                          
         DC    H'0'                STATION NOT IN TABLE?                        
         CLC   RCONKSTA(5),0(R6)   STATION FOUND IN TABLE?                      
         BE    COPS0040            YES                                          
         ZIC   RF,5(R6)            GET L(TABLE ENTRY)                           
         AR    R6,RF               BUMP TO NEXT ENTRY                           
         B     COPS0020            GO BACK FOR NEXT                             
COPS0040 EQU   *                                                                
*                                                                               
*   TEST DISPLAY COPS0040                                                       
*        MVC   P+1(11),=C'TABLE FOUND'                                          
*        ZIC   RF,5(R6)            GET LENGTH OF ENTRY                          
*        BCTR  RF,0                DECREMENT FOR DISPLAY                        
*        EX    RF,TCOP0020                                                      
*        GOTO1 REPORT                                                           
*        B     TCOP0040                                                         
TCOP0020 EQU   *                                                                
*        MVC   P+15(0),0(R6)       MOVE BY LENGTH                               
TCOP0040 EQU   *                                                                
*   TEST DISPLAY COPS0040 END                                                   
*                                                                               
         ZIC   R1,5(R6)            GET L(TABLE ENTRY)                           
         SH    R1,=H'6'            SUBTRACT L(STATION/LEN BYTE)                 
         SR    R0,R0                                                            
         D     R0,=F'6'            DIVIDE TO CALC # ENTRIES                     
*                                                                               
*   R3 NOW CONTAINS # OF DATE SETS FOR STATION'S TABLE ENTRY                    
*                                                                               
         LR    R7,R1               SAVE # ENTRIES                               
         LA    R6,6(R6)            POINT TO FIRST DATE SET                      
         LR    R5,R6               SAVE A(1ST DATE SET)                         
COPS0060 EQU   *                                                                
         CLC   QWPRIST,3(R6)       REQ PRI PER ST VS ENTRY LVE DATE             
*                                     YM COMPARISON                             
         BL    COPS0080            REQ PRI ST BEFORE ENTRY LV                   
*                                     CHECK HIGH FOR RANGE INCLUSION            
*                                                                               
*                                  REQ PRI ST AFTER ENTRY LEAVE                 
*                                     CHECK NEXT ENTRY, IF ANY                  
         LA    R6,6(R6)            BUMP TO NEXT TABLE ENTRY                     
         BCT   R1,COPS0060         GO BACK AND CHECK NEXT ENTRY                 
         B     COPS0900            IF NO MORE ENTRIES, STATION HAS              
*                                     LEFT, AND MUST BE SKIPPED                 
COPS0080 EQU   *                                                                
         CLC   QWCURND,3(R6)       REQ CUR PER END VS ENTRY LVE DATE            
*                                     YM COMPARISON                             
         BL    COPS0300            REQ CUR END BEFORE ENTRY LV                  
*                                     LEAVE AFTER REQUEST PERIOD                
*                                     OR X'FFFFFF' DELIMITER REACHED            
*                                     STATION DID NOT LEAVE W/IN                
*                                        REQUEST PERIOD                         
******                                                                          
*                                  REQ CUR END >= ENTRY LEAVE:                  
*                                     LEFT WITHIN REQUEST PERIOD,               
*                                     SKIP DATA COMPLETELY                      
         B     COPS0900            SET CC NOT ZERO, EXIT                        
COPS0300 EQU   *                                                                
*                                                                               
*   TEST NOT LEFT                                                               
*        MVC   P+1(08),=C'NOT LEFT'                                             
*        GOTO1 REPORT                                                           
*   TEST NOT LEFT END                                                           
*                                                                               
*                                  STATION NOT LEFT - NOW CHECK GAINED          
*                                  DURING CURRENT PERIOD:  IF SO,               
*                                  SKIP THIS STATION'S DATA                     
         LR    R6,R5               RESET A(1ST DATES IN TABLE ENTRY)            
         LR    R1,R7               RESET # ENTRIES                              
*                                  CHECK IF GAIN IN CURRENT YEAR                
COPS0320 EQU   *                                                                
         CLC   QWCURST,0(R6)       REQ ST DATE VS ST JOIN DATE                  
         BH    COPS0340            REQ ST AFTER JOIN DATE                       
         CLC   0(2,R6),QWCURND     JOIN DATE VS REQ END DATE                    
         BH    COPS0340            JOIN DATE AFTER REQUEST END                  
         B     COPS0900            DATE WITHIN REQUEST START/END:               
*                                     SKIP THIS DATA                            
COPS0340 EQU   *                                                                
         LA    R6,6(R6)            BUMP TO NEXT DATE SET                        
         BCT   R1,COPS0320         GO BACK AND CHECK NEXT DATES                 
*                                                                               
*                                  HERE:  ALL DATE SETS CHECKED. NOT            
*                                     JOINED WITHIN CURRENT PERIOD              
*                                  NOW CHECK GAINED                             
*                                  DURING PRIOR PERIOD:  IF SO, SKIP            
*                                  DATA FOR PRIOR AND CURRENT MONTHS            
*                                  BEFORE JOIN MONTH                            
         LR    R6,R5               RESET A(1ST DATES IN TABLE ENTRY)            
         LR    R1,R7               RESET # ENTRIES                              
*                                  CHECK IF GAIN IN CURRENT YEAR                
COPS0360 EQU   *                                                                
         CLC   QWPRIST,0(R6)       REQ START DATE VS STA JOIN DATE              
         BH    COPS0380            REQ START AFTER JOIN DATE                    
*                                  REQ START BEFORE/SAME AS JOIN DATE           
         CLC   0(2,R6),QWPRIND     JOIN DATE VS REQUEST END DATE                
         BH    COPS0380            JOIN DATE AFTER REQUEST END                  
         MVC   TRAPMON,1(R6)       SAVE MONTH OF JOIN DATE FROM                 
*                                     DATE SET IN TABLE                         
         B     COPS0400            DATE WITHIN PRIOR   START/END:               
*                                     CHECK ACTUAL MONTH                        
COPS0380 EQU   *                                                                
         LA    R6,6(R6)            BUMP TO NEXT DATE SET                        
         BCT   R1,COPS0360         GO BACK AND CHECK NEXT DATES                 
*                                                                               
*                                  HERE:  ALL DATE SETS CHECKED. NOT            
*                                     JOINED WITHIN PRIOR   PERIOD              
         B     COPS0800            SET CC = ZERO, EXIT                          
COPS0400 EQU   *                                                                
         CLC   CURDATE+1(1,R4),TRAPMON                                          
*                                  MONTH BEFORE JOIN MONTH?                     
         BL    COPS0900            YES - SKIP ALL DATA                          
*                                  NO  - INCLUDE ALL DATA                       
COPS0800 EQU   *                                                                
         SR    R0,R0               SET CC = ZERO                                
         B     COPS1000                                                         
COPS0900 EQU   *                                                                
         LTR   RB,RB               SET CC NOT ZERO                              
COPS1000 EQU   *                                                                
*                                                                               
         XIT1                                                                   
TRAPMON  DS    CL1                 JOIN MONTH FROM TABLE                        
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*                                                                               
*   JOIN/LEAVE DATE CUTOFF TESTING:                                             
*        1.  R1 OPTION (GROSS BILLING REPORT) - INCLUDE:                        
*            A.  ALL DATA FROM COMPARABLE STATIONS                              
*            B.  NEW STATION:  DATA FROM JOINED BCAST MONTH FORWARD             
*                FOR CURRENT YEAR ONLY                                          
*            C.  ALL DATA IF STATION HAS LEAVE DATE                             
*        2.  R2 OPTION (EQUAL BAR REPORT) - INCLUDE:                            
*            A.  ALL DATA FROM COMPARABLE STATIONS                              
*            B.  NEW STATION: DATA FROM JOINED BCAST MONTH FORWARD              
*                FOR CURRENT/PRIOR YEARS                                        
*            C.  OLD STATION: ALL DATA UP TO, BUT NOT PAST, LEAVE               
*                DATE FOR CURRENT/PRIOR YEARS ('LIKE' MONTHS)                   
*        3.  R3 OPTION (KATZ COMP REPORT) - INCLUDE:                            
*            A.  ALL DATA FROM COMPARABLE STATIONS                              
*            B.  NEW STATION: NO DATA AT ALL                                    
*            C.  OLD STATION: ALL DATA UP TO, BUT NOT PAST, LEAVE               
*                DATE FOR CURRENT/PRIOR YEARS ('LIKE' MONTHS)                   
*                                                                               
*   THIS ROUTINE IS CALLED BEFORE THE TRANSFER TO THE CALCULATION               
*        ROUTINE FOR A COLUMN.  THEREFORE, ALL COLUMNS FOR A MONTH              
*        ARE PROCESSED.  TESTING THE CURRENT MONTH AGAINST THE JOIN/            
*        LEAVE DATES ESTABLISHED WILL BE SUFFICIENT FOR PRIOR PERIOD            
*        ALSO, AS PRIOR PERIOD IS A FUNCTION OF CURRENT MONTH (APRIL            
*        96=CURRENT, APRIL 95=PRIOR:  IF APRIL 96 IS PRE A JOINED DATE          
*        OF MAY 96, APRIL 95 IS PRE MAY 95 FOR SAME REASON)                     
*                                                                               
*                                                                               
JDATE    EQU   09                  DISPLACEMENT TO JOIN DATE                    
LDATE    EQU   12                  DISPLACEMENT TO LEAVE DATE                   
JDORIDE  EQU   64                  DISPLACEMENT TO JOIN DATE OVERRIDE           
LDORIDE  EQU   66                  DISPLACEMENT TO LEAVE DATE OVERRIDE          
*                                                                               
JOINLEAV NMOD1 0,*JNLV*                                                         
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         L     R4,4(R1)            RESET A(BUCKET)                              
         L     R2,8(R1)            RESET A(QWKD)                                
         XC    JDYRMO,JDYRMO       CLEAR PRIOR VALUES                           
         XC    LDYRMO,LDYRMO                                                    
         XC    JDYRMO3,JDYRMO3     CLEAR PRIOR VALUES                           
         MVC   LDYRMO3,=X'FFFFFF'  LOAD HIGH-VALUE DATE                         
*                                                                               
*   TEST                                                                        
*        MVC   P+1(09),=C'RCREPFL2='                                            
*        ST    RA,WORK+40                                                       
*        GOTO1 HEXOUT,DMCB,WORK+40,P+10,4,=C'TOG'                               
*        MVC   P+20(02),RCREPFL                                                 
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+24,4,=C'TOG'                              
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN  -  DONT CHANGE IT                          
*                                                                               
         L     R5,ASTAEL           RETRIEVE STATION ELEMENT                     
         OC    JDATE(3,R5),JDATE(R5)                                            
*                                  ANY DATE IN FIELD?                           
         BZ    JOLE0020            NO  - SET A DEFAULT                          
         CLC   JDATE(3,R5),=C'   ' ANY DATE IN FIELD?                           
         BNE   JOLE0040            YES - USE IT                                 
JOLE0020 EQU   *                                                                
         MVC   JDATE(3,R5),=X'5A0101'                                           
*                                  SET DEFAULT TO JAN1/90                       
JOLE0040 EQU   *                                                                
         MVC   JDYRMO3,JDATE(R5)   SET 3-CHAR JOINED DATE                       
         OC    LDATE(3,R5),LDATE(R5)                                            
         BZ    JOLE0060                                                         
         MVC   LDYRMO3,LDATE(R5)   SET 3-CHAR LEAVE DATE                        
JOLE0060 EQU   *                                                                
         OC    JDORIDE(2,R5),JDORIDE(R5)                                        
*                                  ANY JOIN DATE OVERRIDE?                      
         BZ    JOLE0080            NO                                           
         MVC   JDYRMO,JDORIDE(R5)  YES - MOVE OVERRIDE TO CUTOFF                
         B     JOLE0100                                                         
JOLE0080 EQU   *                                                                
         GOTO1 DATCON,DMCB,(3,JDATE(R5)),(0,WORK)                               
*                                  USE JOIN DATE                                
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                                        
*                                  CALC START/END DATES OF BCAST MO             
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
*                                                                               
         MVC   JDYRMO,FULL         INSERT YR/MO OF BCAST END DATE               
JOLE0100 EQU   *                                                                
         OC    LDORIDE(2,R5),LDORIDE(R5)                                        
*                                  ANY LEAVE DATE OVERRIDE?                     
         BZ    JOLE0120            NO                                           
         MVC   LDYRMO,LDORIDE(R5)  YES - MOVE OVERRIDE TO CUTOFF                
         B     JOLE0140                                                         
JOLE0120 EQU   *                                                                
         OC    LDATE(3,R5),LDATE(R5)                                            
         BZ    JOLE0140                                                         
         MVC   LDYRMO3,LDATE(R5)   INSERT 3-CHAR LEAVE DATE                     
         GOTO1 DATCON,DMCB,(3,LDATE(R5)),(0,WORK)                               
*                                  USE LEAVE DATE                               
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                                        
*                                  CALC START/END DATES OF BCAST MO             
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
*                                                                               
         MVC   LDYRMO,FULL         INSERT YR/MO OF BCAST END DATE               
         MVC   LDYRMO3,LDATE(R5)   USE LEAVE DATE FOR AS-AT TESTS               
JOLE0140 EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        MVC   P+1(09),=C'RCREPFL3='                                            
*        ST    RA,WORK+40                                                       
*        GOTO1 HEXOUT,DMCB,WORK+40,P+10,4,=C'TOG'                               
*        MVC   P+20(02),RCREPFL                                                 
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+24,4,=C'TOG'                              
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
*                                                                               
*   TEST                                                                        
*        MVC   P+1(11),=C'JOIN/LEAVE='                                          
*        MVC   WORK+48(2),JDYRMO                                                
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+12)                                 
*        OC    LDYRMO,LDYRMO                                                    
*        BZ    TEST0020                                                         
*        MVC   WORK+48(2),LDYRMO                                                
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+20)                                 
TEST0020 EQU   *                                                                
*   3-CHAR DATES                                                                
*        GOTO1 DATCON,DMCB,(3,JDYRMO3),(5,P+28)                                 
*        CLC   LDYRMO3,=X'FFFFFF'  DEFAULT VALUE SET?                           
*        BE    TEST0022            YES - SKIP IT                                
*        GOTO1 DATCON,DMCB,(3,LDYRMO3),(5,P+36)                                 
TEST0022 EQU   *                                                                
*        MVC   P+60(8),QWCURST                                                  
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         LA    RF,QWMONFOR                                                      
         MVC   WORK+48(2),QWCASATF(RF)                                          
         GOTO1 DATCON,DMCB,(2,WORK+48),(3,JNLVASAT)                             
*                                                                               
*                                                                               
*   TEST                                                                        
*        MVC   P+1(11),=C'ASAT/JN/LV='                                          
*        LA    RF,QWMONFOR                                                      
*        MVC   WORK+48(2),QWCASATF(RF)                                          
*        MVC   P+52(8),QWCASATF(RF)                                             
*        GOTO1 DATCON,DMCB,(2,WORK+48),(5,P+12)                                 
*        MVC   WORK+48(2),JDYRMO                                                
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+22)                                 
*        OC    LDYRMO,LDYRMO                                                    
*        BZ    TEST0030                                                         
*        MVC   WORK+48(2),LDYRMO                                                
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+32)                                 
TEST0030 EQU   *                                                                
*        GOTO1 DATCON,DMCB,(3,JNLVASAT),(5,P+42)                                
*        MVC   P+62(8),QWCURST                                                  
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         LA    RF,QWREQ3                                                        
         USING QREC3D,RF                                                        
*                                                                               
         CLI   Q3JNLOST,C'1'       R1 REQUEST? (GROSS BILLING)                  
         BNE   JOLE0400            NO  -                                        
*                                  YES - PROCESS GROSS BILLING REQ              
         DROP  RF                                                               
*                                                                               
*                                                                               
         OC    LDYRMO,LDYRMO       ANY LEAVE DATE?                              
         BZ    JOLE0200            NO  -                                        
         CLC   PRI2DATE(2,R4),LDYRMO                                            
*                                  2YR PRIOR DATE => LEAVE DATE?                
         BL    JOLE0160            NO  - NOT LEFT                               
         OI    NOPRIFLG,2          YES - SET NO 2YR PRIOR                       
JOLE0160 EQU   *                                                                
*                                                                               
         CLC   PRIDATE(2,R4),LDYRMO                                             
*                                  PRIOR YEAR DATE => LEAVE DATE?               
         BL    JOLE0180            NO  - NOT LEFT                               
         OI    NOPRIFLG,1          YES - SET NO PRIOR YEAR                      
JOLE0180 EQU   *                                                                
         CLC   CURDATE(2,R4),LDYRMO                                             
*                                  CURRENT YEAR => LEAVE DATE?                  
         BL    JOLE0200            NO  - NOT LEFT: CHECK JOINED                 
         MVI   NOCURFLG,1          SET NO CURRENT DATA FLAG                     
*                                                                               
JOLE0200 EQU   *                   NO  - CHECK JOIN DATES                       
         CLC   JDYRMO3,JNLVASAT                                                 
*                                  IS JOIN DATE <= TO AS-AT DATE?               
         BNH   JOLE0220            NO  - JOINED AFTER DATE OF RUN -             
         MVI   NOPRIFLG,3          NO PRIOR/2YR PRIOR                           
         B     JOLE0900            EXCLUDE CURRENT                              
*                                     EXCLUDE DATA                              
JOLE0220 EQU   *                   NO  - CHECK JOIN DATES                       
*                                                                               
         CLC   JDYRMO,PRI2DATE(R4) JOIN DATE <= 2YR PRIOR?                      
         BNH   JOLE0240            YES                                          
         OI    NOPRIFLG,2          NO  - NO 2YR PRIOR                           
JOLE0240 EQU   *                                                                
         CLC   JDYRMO,PRIDATE(R4)  JOIN DATE <= PRIOR YEAR?                     
         BNH   JOLE0260            YES                                          
         OI    NOPRIFLG,1          NO  - NO PRIOR YEAR                          
JOLE0260 EQU   *                                                                
         CLC   JDYRMO,CURDATE(R4)  JOIN DATE <= CURRENT YEAR?                   
         BNH   JOLE0800            YES                                          
         B     JOLE0900            NO  - NO 2YR PRIOR                           
JOLE0400 EQU   *                                                                
*                                                                               
         LA    RF,QWREQ3                                                        
         USING QREC3D,RF                                                        
*                                                                               
         CLI   Q3JNLOST,C'2'       R2 REQUEST? (EQUAL BAR)                      
         BNE   JOLE0600            NO  -                                        
*                                  YES - PROCESS GROSS BILLING REQ              
         DROP  RF                                                               
*                                                                               
*        R2 OPTION (EQUAL BAR REPORT) - INCLUDE:                                
*            A.  ALL DATA FROM COMPARABLE STATIONS                              
*            B.  NEW STATION: DATA FROM JOINED BCAST MONTH FORWARD              
*                FOR CURRENT/PRIOR YEARS                                        
*            C.  OLD STATION: ALL DATA UP TO, BUT NOT PAST, LEAVE               
*                DATE FOR CURRENT/PRIOR YEARS ('LIKE' MONTHS)                   
*                                                                               
         OC    LDYRMO,LDYRMO       ANY LEAVE DATE?                              
         BZ    JOLE0440            NO                                           
         CLC   LDYRMO3,JNLVASAT                                                 
*                                  IS LEAVE DATE <= TO AS-AT DATE?              
         BH    JOLE0440            NO  - TREAT AS IF 'NO LEAVE DATE'            
         CLC   CURDATE(2,R4),LDYRMO                                             
*                                  YES - CURRENT DATE <= LEAVE DATE?            
         BNH   JOLE0800            YES - EXIT CC = ZERO - USE DATA              
*                                     FOR 'LIKE MONTHS' IN PRIOR YEAR           
         LTR   RB,RB               NO  - SET CC NOT ZERO -                      
*                                     DON'T USE DATA                            
         B     JOLE0900                                                         
*                                                                               
JOLE0440 EQU   *                   NO  - CHECK JOIN DATES                       
         CLC   JDYRMO3,JNLVASAT                                                 
*                                  IS JOIN DATE <= TO AS-AT DATE?               
         BH    JOLE0900            NO  - JOINED AFTER DATE OF RUN -             
*                                     EXCLUDE DATA                              
*                                  CHECK FOR NEW STATION                        
         CLC   JDYRMO,QWCURST      JOIN DATE PRIOR TO REQUEST START?            
         BL    JOLE0800            YES - ACCEPT ALL DATA                        
*                                  NO  - ACCEPT NEW STATION DATA                
*                                     FOR CURR/PRIOR YEARS, FROM                
*                                        JOIN DATE ONWARD                       
         CLC   CURDATE(2,R4),JDYRMO                                             
*                                  CURRENT DATE < JOIN DATE?                    
         BNL   JOLE0800            NO  - EXIT CC = ZERO -                       
*                                     ACCEPT CURR/PRIOR DATA                    
         LTR   RB,RB               YES - SET CC NOT ZERO                        
*                                     DON'T USE DATA                            
         B     JOLE0900                                                         
*                                                                               
JOLE0600 EQU   *                                                                
*                                                                               
*        R3 OPTION (KATZ COMP REPORT) - INCLUDE:                                
*            A.  ALL DATA FROM COMPARABLE STATIONS                              
*            B.  NEW STATION: NO DATA AT ALL                                    
*            C.  OLD STATION: ALL DATA UP TO, BUT NOT PAST, LEAVE               
*                DATE FOR CURRENT/PRIOR YEARS ('LIKE' MONTHS)                   
*                                                                               
         OC    LDYRMO,LDYRMO       ANY LEAVE DATE?                              
         BZ    JOLE0640            NO                                           
         CLC   LDYRMO3,JNLVASAT                                                 
*                                  IS LEAVE DATE <= TO AS-AT DATE?              
         BH    JOLE0640            NO  - TREAT AS IF 'NO LEAVE DATE'            
         CLC   CURDATE(2,R4),LDYRMO                                             
*                                  YES - CURRENT DATE <= LEAVE DATE?            
         BNH   JOLE0800            YES - EXIT CC = ZERO - USE DATA              
*                                     FOR 'LIKE MONTHS' IN PRIOR YEAR           
         LTR   RB,RB               NO  - SET CC NOT ZERO -                      
*                                     DON'T USE DATA                            
         B     JOLE0900                                                         
*                                                                               
JOLE0640 EQU   *                   NO  - CHECK JOIN DATES                       
         CLC   JDYRMO3,JNLVASAT                                                 
*                                  IS JOIN DATE <= TO AS-AT DATE?               
         BH    JOLE0900            NO  - JOINED AFTER DATE OF RUN -             
*                                     EXCLUDE DATA                              
*                                  CHECK FOR NEW STATION                        
         CLC   JDYRMO,QWCURST      JOIN DATE PRIOR TO REQUEST START?            
         BL    JOLE0800            YES - ACCEPT ALL DATA                        
*                                  NO  - SKIP ALL DATA FOR NEW STN              
         LTR   RB,RB               SET CC NOT ZERO - DON'T USE DATA             
         B     JOLE0900                                                         
*                                                                               
JOLE0800 EQU   *                                                                
         SR    R0,R0               SET CC = ZERO                                
JOLE0900 EQU   *                                                                
         XIT1                                                                   
*                                                                               
JDYRMO   DS    XL2                 JOIN DATE/YR-MONTH:  YM ONLY                 
LDYRMO   DS    XL2                 LEAVE DATE/YR-MONTH: YM ONLY                 
JDYRMO3  DS    XL3                 JOIN DATE/YR-MONTH:  YMD                     
LDYRMO3  DS    XL3                 LEAVE DATE/YR-MONTH: YMD                     
JNLVASAT DS    XL3                 JOIN/LEAVE AS-AT DATE                        
         EJECT                                                                  
*                                                                               
*        PUT TO BUFFALO ROUTINE                                                 
*                                                                               
         DS    0F                                                               
PUT      NMOD1 0,**PUT**                                                        
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN - DON'T CHANGE VALUE                        
*                                                                               
         USING RPSPECD,R7                                                       
*                                                                               
*   RPZERORW MAY CONTAIN A BUFFALO RECORD ADDRESS.  THIS WAS SET IN             
*     THE 'RPTSPEC' ROUTINE FOR THE REPORT.  THE ROW DEFINITION                 
*     CONTAINS 'ZERO', WHICH INDICATES THAT THE VALUE INSERTED INTO             
*     THE RECORD FOR THE ROW IS TO BE CLEARED BEFORE THE DATA IS                
*     RELEASED TO BUFFALO.                                                      
*                                                                               
         OC    RPZERORW,RPZERORW   CLEAR ROW VALUE NEEDED?                      
         BZ    PUTA0005            NO  - NO ADDRESS IN REPORT SLOT              
         ZICM  RF,RPZERORW,3       YES - GET BUFFALO ADDRESS                    
         XC    0(9,RF),0(RF)       CLEAR THE VALUE IN ROW                       
PUTA0005 EQU   *                                                                
         CLI   QWACCOPT,C'A'       ACCOUNTING OPTION?                           
         BNE   PUTA0010            NO                                           
         CLI   RPMONEY,2           YES - ROUNDOLLARS WANTED?                    
         BNE   PUTA0050            NO  - LEAVE AS IS                            
         B     PUTA0020            YES - ROUND PENNIES TO DOLLARS               
PUTA0010 EQU   *                                                                
         TM    RPFLAGS,X'40'       NO ROUNDING FOR AVAILS                       
         BO    PUTA0050                                                         
         TM    RPFLAGS,X'08'       NO ROUNDING FOR MONEY=DOLLARS                
         BO    PUTA0050                                                         
PUTA0020 EQU   *                                                                
         LA    R5,BFACCS           ROUND PENNIES TO DOLLARS                     
         LA    R6,RGCOLMAX                                                      
*                                                                               
PUTA0030 ICM   RE,15,0(R5)                                                      
         BZ    PUTA0040                                                         
         C     RE,=X'FEFEFEFE'     FORCE ROW VALUE?                             
         BE    PUTA0040            YES - DON'T ROUND IT                         
         C     RE,=X'FFFFFFFF'     SPL LOSS VALUE?                              
         BE    PUTA0040            YES - DON'T ROUND IT                         
         C     R5,RPBUDCP          BUDGET COLUMNS ALREADY IN DOLLARS            
         BE    PUTA0040                                                         
         C     R5,RPBUDCY                                                       
         BE    PUTA0040                                                         
         C     R5,RPBUDCPP         PRIOR BDGT COLS ALREADY IN DOLLARS           
         BE    PUTA0040                                                         
         C     R5,RPBUDCYP                                                      
         BE    PUTA0040                                                         
         SR    RF,RF                                                            
         SRDA  RE,31                                                            
         D     RE,=F'100'                                                       
         LTR   RF,RF                                                            
         BM    *+8                                                              
         A     RF,=F'1'                                                         
         SRA   RF,1                                                             
         ST    RF,0(R5)                                                         
*                                                                               
PUTA0040 LA    R5,RGCOLSZ(R5)                                                   
         BCT   R6,PUTA0030                                                      
*                                                                               
PUTA0050 MVC   COMSTORE,BFCOM      SAVE COMMENT AREA                            
         ICM   R1,15,AMONROW                                                    
         BZ    PUTA0060                                                         
         CLI   1(R1),0             TEST MONTH = PRIOR                           
         BNE   PUTA0060                                                         
         XC    BFCOM(4),BFCOM      YES - CLEAR COMMENT SO THAT RRGON            
*                                        DON'T GET THIS RECORD                  
PUTA0060 CLI   RCTRACE,C'Y'                                                     
         BE    PUTA0070                                                         
         CLI   RCTRACE,C'2'        RERG02 RECORDS ONLY TRACE                    
         BE    PUTA0070                                                         
         CLI   RCTRACE,C'I'        RERG02/03 RECORDS ONLY TRACE                 
         BE    PUTA0070                                                         
         CLI   RCTRACE,C'B'        RERG02 BUDGET RECORDS ONLY TRACE             
         BNE   PUTA0080                                                         
         CLI   RECORD,C'B'         BUDGET RECORD?                               
         BNE   PUTA0080            NO  - SKIP IT                                
PUTA0070 EQU   *                                                                
         GOTO1 ADUMPBUF                                                         
*                                                                               
PUTA0080 CLI   TOTSONLY,C'Y'       TOTAL RECS ONLY?                             
         BE    PUTA0130            YES                                          
         CLI   RPTFILT,C'Y'        RPT FILTERED AT RPT LEVEL?                   
         BE    PUTA0130            YES                                          
         OC    RPSPL$AD(RPSPLLEN),RPSPL$AD                                      
*                                  ANY SPL$ COLUMNS IN REPORT?                  
         BZ    PUTA0085            NO                                           
         GOTO1 =A(SPLEXPLD),DMCB,(RC),(R7)                                      
         B     PUTA0087            SKIP NEXT PUTBUFF                            
PUTA0085 EQU   *                                                                
         GOTO1 APUTBUFF            PUT BUFFALO RECORD                           
         L     RF,OUTCOUNT         BUMP OUTPUT RECORD COUNTER                   
         LA    RF,1(RF)                                                         
         ST    RF,OUTCOUNT         SAVE OUTPUT COUNTER                          
PUTA0087 EQU   *                                                                
         CLI   RPSTATYP,C'Y'       STATYPE ROW IN SPEC?                         
         BNE   PUTA0090            NO                                           
         TM    RPFLAGS,X'20'       ON-LINE REPORT?                              
         BO    PUTA0090            YES - SKIP 'ALL-STATIONS' RECORD             
         ICM   R5,7,RPSTATYP+1     YES - GET ROW ADDRESS                        
         MVC   BYTE,0(R5)          SAVE STATION TYPE                            
         MVI   0(R5),C'4'          INSERT 'ALL-STATIONS' CODE                   
         GOTO1 APUTBUFF            GENERATE AN 'ALL-STATIONS' RECORD            
         L     RF,OUTCOUNT         BUMP OUTPUT RECORD COUNTER                   
         LA    RF,1(RF)                                                         
         ST    RF,OUTCOUNT         SAVE OUTPUT COUNTER                          
         MVC   0(1,R5),BYTE        RESTORE ORIGINAL STATION TYPE                
*                                                                               
PUTA0090 CLI   RPMKTOT,C'Y'        MARKET TOTALS                                
         BNE   PUTA0130                                                         
         ICM   R5,7,RPMKTOT+1      STAMKT ROW                                   
*                                                                               
         L     R4,FRST2            POINT TO CORRECT STATION IN                  
         SR    RE,RE               SPACEND USING DISPLACEMENT                   
         ICM   RE,3,0(R5)                                                       
         BCTR  RE,0                                                             
         STH   RE,HALF             STATION NUMBER - 1                           
         SR    RE,RE                     X                                      
         IC    RE,1(R4)            L'STATION RECORD                             
         MH    RE,HALF                                                          
         AR    R4,RE                                                            
*                                                                               
*   PUT OUT RECORDS FOR COMBO TOTALS IF A COMBO STATION. IF NOT                 
*     USED BY RERG03A IT WILL BE DISCARDED.                                     
*                                                                               
         OC    DSTNCMBO(5,R4),DSTNCMBO(R4)  COMBO STATION?                      
         BZ    PUTA0100                     NO  - SKIP COMBO RECORD             
         MVC   WORK(8),0(R5)                YES - SAVE ORIG DISP/STA            
*                                           LEAVE STATION NUMBER                
         MVC   2(6,R5),=X'FFFFFFFFFFFE'     REPLACE STATION CALLS               
         GOTO1 APUTBUFF                                                         
         L     RF,OUTCOUNT         BUMP OUTPUT RECORD COUNTER                   
         LA    RF,1(RF)                                                         
         ST    RF,OUTCOUNT         SAVE OUTPUT COUNTER                          
*                                                                               
*   FORCE MARKET TOTAL AFTER COMBO - CHECK IF THERE IS A DISPLACE-              
*      MENT BECAUSE THERE MAY BE MORE THAN ONE COMBO IN THE MARKET.             
*      THIS WILL FORCE THE MARKET TOTAL TO SORT AFTER THE COMBO(S).             
*                                                                               
         OC    DSTNDISP(2,R4),DSTNDISP(R4)  MORE THAN 1 STATION?                
         BNZ   PUTA0110                     YES - USE STN DISPLACEMT            
*                                                 ROUTINE RELOADS IT            
         B     PUTA0120                     NO  - USE COMBO STN DISP            
*                                                                               
PUTA0100 EQU   *                                                                
*                                                                               
         OC    DSTNDISP(2,R4),DSTNDISP(R4)  MORE THAN 1 STATION?                
         BZ    PUTA0130                     NO  - SKIP TOTAL RECORD             
         MVC   WORK(8),0(R5)                YES - SAVE ORIG DISP/STA            
PUTA0110 EQU   *                                                                
         MVC   0(2,R5),DSTNDISP(R4)         USE LAST STA IN MKT DISP            
PUTA0120 EQU   *                                                                
         MVC   2(6,R5),=X'FFFFFFFFFFFF'                                         
         GOTO1 APUTBUFF                                                         
         L     RF,OUTCOUNT         BUMP OUTPUT RECORD COUNTER                   
         LA    RF,1(RF)                                                         
         ST    RF,OUTCOUNT         SAVE OUTPUT COUNTER                          
         MVC   0(8,R5),WORK        RESTORE ORIG. DISP/STA                       
*                                                                               
PUTA0130 CLI   REQTOTS,C'Y'        DO WE NEED TOTAL RECS                        
         BNE   PUTA0160                                                         
         MVC   KEYSTORE,BFKEY      SAVE PRIMARY KEY                             
         XC    BFCOM,BFCOM         CLEAR THE COMMENT AREA                       
         LA    R3,TOTKEYS                                                       
*                                                                               
PUTA0140 MVC   BFKEY,0(R3)         MOVE IN TOTAL KEY                            
*                                                                               
PUTA0150 GOTO1 APUTBUFF                                                         
         L     RF,OUTCOUNT         BUMP OUTPUT RECORD COUNTER                   
         LA    RF,1(RF)                                                         
         ST    RF,OUTCOUNT         SAVE OUTPUT COUNTER                          
         LA    R3,RGKEYLEN(R3)     NEXT TOTAL KEY                               
         CLI   0(R3),X'FF'                                                      
         BNE   PUTA0140                                                         
         MVC   BFKEY,KEYSTORE      RESTORE PRIMARY KEY                          
*                                                                               
PUTA0160 MVC   BFCOM,COMSTORE      RESTORE COMMENT AREA                         
         XC    BFACCS,BFACCS       CLEAR BUFFALO COLS                           
         ICM   R1,15,AMONROW                                                    
         BZ    PUTA0170                                                         
         XC    0(L'MONTHROW,R1),0(R1)   CLEAR THE MONTH ROW                     
*                                                                               
PUTA0170 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
         DROP  R2,R7                                                            
         SPACE 2                                                                
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
*        CHECK BFFACCS FOR ALL X'FEFEFEFE' OR ZEROS.  IF NO REAL                
*        DATA VALUE, SEND BACK CC = ZERO, SO RECORD IS NOT OUTPUT.              
*        IF RPMISFLG+1 = X'02', PASS THROUGH LINE.                              
*                                                                               
         DS    0F                                                               
NOBFFACC NMOD1 0,**BFAC**                                                       
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN - DON'T CHANGE VALUE                        
*                                                                               
         USING RPSPECD,R7                                                       
*                                                                               
*   R7 PREVIOUSLY SET AND PASSED IN - DON'T CHANGE VALUE                        
*                                                                               
         TM    RPMISFLG+1,X'02'    PASS THROUGH ALL ROWS?                       
         BO    NOBF0120            YES - DON'T REJECT THE LINE                  
         TM    RPMISFLG+1,X'08'    PASS THROUGH ALL ROWS IF ORDER               
*                                     WITHIN REPORT PERIOD?                     
         BNO   NOBF0010            NO  - CHECK FOR VALUES IN LINE               
*                                                                               
*   REPORT IS TO SHOW ALL ACTIVITY FOR FORCED ROW IF FLIGHT DATES               
*      ARE WITHIN THE REPORT PERIOD.                                            
*                                                                               
*                                                                               
*   TEST                                                                        
*        MVC   P+1(07),=C'FLIGHT:'                                              
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+10,4,=C'TOG'                              
*        MVC   P+20(6),RCONDATE                                                 
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         GOTO1 DATCON,DMCB,(3,RCONDATE),(0,WORK)   GET FLIGHT START/            
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                      END DATES         
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
         MVC   FLIGHTST,FULL                                                    
         GOTO1 DATCON,DMCB,(3,RCONDATE+3),(0,WORK)                              
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                                        
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
         MVC   FLIGHTND,FULL                                                    
         CLC   FLIGHTND,QWCURST    FLIGHT ENDS BEFORE REP PERIOD?               
         BL    NOBF0080            YES - SKIP CONTRACT                          
         CLC   QWCURND(2),FLIGHTST FLIGHT STARTS AFTER REP PERIOD?              
         BL    NOBF0080            YES - SKIP CONTRACT                          
*                                  FOR THIS REPORT                              
         B     NOBF0120            ORDER WITHIN FLIGHT: USE IT                  
NOBF0010 EQU   *                                                                
         LA    R5,BFACCS           A(BUFFALO ACCUMULATORS)                      
         LA    R6,RGCOLMAX         NUMBER OF COLUMNS IN THIS SPEC               
*                                                                               
NOBF0020 ICM   RE,15,0(R5)                                                      
         BZ    NOBF0060            BUCKET IS ZERO                               
         C     RE,=X'FEFEFEFE'     FORCE ROW VALUE?                             
         BNE   NOBF0120            NON-ZERO, NON-X'FEFE' VALUE FOUND            
NOBF0060 EQU   *                   NO REAL VALUE IN BUCKET                      
         LA    R5,4(R5)            BUMP TO NEXT BUCKET                          
         BCT   R6,NOBF0020         GO BACK FOR NEXT                             
NOBF0080 EQU   *                   NO REAL VALUE IN BUCKET                      
         SR    R0,R0               NO REAL VALUES FOUND: CC = ZERO              
         B     NOBF0160                                                         
NOBF0120 EQU   *                                                                
         LTR   RB,RB               SET CC NOT = ZERO                            
NOBF0160 EQU   *                                                                
         XIT1                                                                   
*                                                                               
         DROP  R2,R7                                                            
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
*    SPLEXPLD:  PUTS OUT FILLER RECORDS FOR THE COMPETITIVE STATIONS            
*       WHICH HAVE NON-ZERO SPL AMOUNTS IN THE CONTRACT'S X'06'                 
*       ELEMENT.                                                                
*                                                                               
         DS    0F                                                               
SPLEXPLD NMOD1 0,*SEXP*                                                         
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         L     R7,4(R1)            RESET A(RPSPECD)                             
         USING RPSPECD,R7                                                       
*                                                                               
*                                  CALC STATION ROW DISPLACEMENT                
*                                  DON'T MAKE ZERO RELATIVE                     
         ZIC   RF,RPSPLSTA         STATION ROW NUMBER                           
         MH    RF,=Y(RGROWSZ)      X ROW WIDTH                                  
         LA    RE,BFREC            A(BUFFALO RECORD)                            
         AR    RE,RF               ADDR+DISP = A(STATION ROW)                   
         ST    RE,ADSTAROW         SAVE ADDRESS                                 
         XC    0(2,RE),0(RE)       CLEAR 1ST BYTES OF REP'D STATION             
         BAS   RE,COMPAFF          SET COMP/AFFILIATE INFO                      
         GOTO1 APUTBUFF            PUT  REP'D STATION BUFFALO RECORD            
         L     RF,OUTCOUNT         BUMP OUTPUT RECORD COUNTER                   
         LA    RF,1(RF)                                                         
         ST    RF,OUTCOUNT         SAVE OUTPUT COUNTER                          
         MVC   SVBFREC,BFREC       SAVE THE CURRENT BUFF REC                    
         TM    RPMISFLG,X'04'      SKIP COMPETITIVES FLAG SET?                  
         BO    SEXP0900            YES - DON'T GEN THEM                         
         OC    RPSPL$AD,RPSPL$AD   SPL $$ COLUMN IN REPORT?                     
         BZ    SEXP0020            NO                                           
         L     RF,RPSPL$AD         YES - SAVE THE DOLLARS                       
         MVC   SVSPL$,0(RF)                                                     
SEXP0020 EQU   *                                                                
         OC    RPSPLMAD,RPSPLMAD   SPL MARKET $$ COLUMN IN REPORT?              
         BZ    SEXP0040            NO                                           
         L     RF,RPSPLMAD         YES - SAVE THE DOLLARS                       
         MVC   SVSPLM$,0(RF)                                                    
SEXP0040 EQU   *                                                                
         OC    RPSPLDAD,RPSPLDAD   GROSS SPL $$ COLUMN IN REPORT?               
         BZ    SEXP0060            NO                                           
         L     RF,RPSPLDAD         YES - SAVE THE DOLLARS                       
         MVC   SVGSPL$,0(RF)                                                    
SEXP0060 EQU   *                                                                
         OC    RPSPLGAD,RPSPLGAD   GROSS SPL MKT $$ COLUMN IN REPORT?           
         BZ    SEXP0080            NO                                           
         L     RF,RPSPLGAD         YES - SAVE THE DOLLARS                       
         MVC   SVGSPLM$,0(RF)                                                   
SEXP0080 EQU   *                                                                
         LA    R3,RCONELEM         FIND THE SPL ELEMENT                         
SEXP0100 EQU   *                                                                
         ZIC   RF,1(R3)                                                         
         AR    R3,RF               BUMP TO NEXT ELEMENT                         
         CLI   0(R3),0             END OF RECORD?                               
         BE    SEXP0900            YES - FINISHED                               
         CLI   0(R3),6             SPL ELEMENT?                                 
         BNE   SEXP0100            NO  - GO BACK FOR NEXT                       
*                                                                               
         USING RCONSPEL,R3         YES                                          
*                                                                               
         ST    R3,SPLSVR3          SAVE REGISTER                                
         ZIC   RE,RCONSPNU         NUMBER OF MINI-ELTS (STATIONS)               
         BCTR  RE,0                DROP 1 FOR REP'D STATION                     
         LA    R3,RCONSPST+9       A(1ST NON-REP'D CALL LETTERS)                
         C     RE,=F'2'            MORE THAN ONE STATION?                       
         BL    SEXP0110            NO  - DON'T BOTHER WITH SORT                 
*                                                                               
*   SORT ALL BUT THE REP'D STATION ENTRIES.  THIS WILL PERMIT THE               
*      DETERMINATION OF THE LAST STATION SHOULD A STATION SWITCH                
*      AFFECT ANY OF THE ENTRIES.  THE LAST STATION IS FLAGGED SO               
*      THAT COMMENTS CAN BE TRIGGERED AT THE APPROPRIATE SPOT WHEN              
*      THE REPORT IS PRODUCED.                                                  
*                                                                               
         PRINT GEN                                                              
         GOTO1 XSORT,DMCB,(0,(R3)),(RE),9,5,0                                   
         PRINT NOGEN                                                            
*                                                                               
*   NOW RESET THE MINI-ELT POINTERS, ETC....                                    
*                                                                               
SEXP0110 EQU   *                                                                
         L     R3,SPLSVR3          RESTORE R3                                   
         ZIC   RE,RCONSPNU         NUMBER OF MINI-ELTS (STATIONS)               
         BCTR  RE,0                DROP 1 FOR REP'D STATION                     
         LTR   RE,RE               ANY STATIONS REMAINING?                      
         BZ    SEXP0900            NO  - ONLY REP'D STATION                     
*                                     EXIT ROUTINE NOW                          
         LA    R3,RCONSPST+9       A(1ST NON-REP'D CALL LETTERS)                
         DROP  R3                                                               
SEXP0120 EQU   *                                                                
         STC   RE,NULOOP           SAVE LOOP CONTROL                            
         OC    RPSPLMAD,RPSPLMAD   SPL MARKET $$ COLUMN ON REPORT?              
         BZ    SEXP0160            NO                                           
         ZICM  RF,5(R3),4          YES - INSERT SPL % INTO REGISTER             
         SR    R0,R0                                                            
         L     R1,SVSPLM$          INSERT SPL MARKET $ INTO REGISTER            
         MR    R0,RF               DOLLARS X %                                  
         SLDA  R0,1                DOUBLE THE AMOUNT                            
         A     R1,=F'10000'        HALF-ADD FOR ROUNDING                        
         D     R0,=F'10000'        DIVIDE FOR DECIMAL ALIGNMENT                 
         SRDA  R0,1                HALVE THE AMOUNT                             
         L     RF,RPSPL$AD         SET RESULT IN STATION                        
         STCM  R1,15,0(RF)         INSERT STATION $$ IN RECORD                  
         L     RF,RPSPLMAD         INSERT MARKET $$ IN RECORD                   
         MVC   0(4,RF),SVSPLM$                                                  
SEXP0160 EQU   *                                                                
         OC    RPSPLGAD,RPSPLGAD   GROSS SPL MKT $$ COLUMN ON REPORT?           
         BZ    SEXP0200            NO                                           
         ZICM  RF,5(R3),4          YES - INSERT SPL % INTO REGISTER             
         SR    R0,R0                                                            
         L     R1,SVGSPLM$         INSERT GROSS SPL MKT $ INTO REG              
         MR    R0,RF               DOLLARS X %                                  
         SLDA  R0,1                DOUBLE THE AMOUNT                            
         A     R1,=F'10000'        HALF-ADD FOR ROUNDING                        
         D     R0,=F'10000'        DIVIDE FOR DECIMAL ALIGNMENT                 
         SRDA  R0,1                HALVE THE AMOUNT                             
         L     RF,RPSPLDAD         SET RESULT IN STATION                        
         STCM  R1,15,0(RF)         INSERT GROSS STN $$ IN RECORD                
         L     RF,RPSPLGAD         INSERT GROSS MKT $$ IN RECORD                
         MVC   0(4,RF),SVGSPLM$                                                 
SEXP0200 EQU   *                                                                
         L     RF,ADSTAROW         SET A(STATION ROW)                           
         MVI   1(RF),1             SET 'COMPETING STATION' IN KEY               
         CLI   NULOOP,1            LAST STATION?                                
         BNE   SEXP0240            NO                                           
         TM    RPFLAG2,X'01'       COMMENTS NEEDED ON THIS REPORT?              
         BNO   SEXP0240            NO  - DON'T SET 'LAST COMP STN'              
         MVI   1(RF),2             YES - SET 'LAST COMP STN' IN KEY             
SEXP0240 EQU   *                                                                
         MVC   SPLMEDIA,6(RF)      SAVE STATION MEDIA CODE                      
         MVC   2(5,RF),0(R3)       INSERT STA CALLS FROM MINI-ELT               
*                                     (TV DOESN'T CONTAIN MEDIA)                
         CLI   SPLMEDIA,C'T'       ORIGINAL MEDIA WAS TV?                       
         BNE   SEXP0280            NO  - LEAVE WHAT'S THERE                     
         MVI   6(RF),C'T'          YES - REINSERT 'T'                           
SEXP0280 EQU   *                                                                
         BAS   RE,COMPAFF2         INSERT COMPETITIVE'S AFFIL                   
         GOTO1 APUTBUFF            OUTPUT THE NEW COMP RECORD                   
         L     RF,OUTCOUNT         BUMP OUTPUT RECORD COUNTER                   
         LA    RF,1(RF)                                                         
         ST    RF,OUTCOUNT         SAVE OUTPUT COUNTER                          
SEXP0800 EQU   *                                                                
         ZIC   RE,NULOOP           RESET LOOP CONTROL                           
         LA    R3,9(R3)            BUMP TO NEXT MINI-ELT                        
         BCT   RE,SEXP0120         GO BACK FOR NEXT                             
*                                  FINISHED                                     
SEXP0900 EQU   *                                                                
         MVC   BFREC,SVBFREC       RESTORE THE CURRENT BUFF REC                 
         XIT1                                                                   
*                                                                               
ADCOMAFF DS    A                   ADDRESS OF COMP AFFIL IN SPACEND             
LSTCOMAF DS    CL4                 LAST STATION FOUND                           
ADSTAROW DS    A                   ADDRESS OF STATION ROW IN RECORD             
SVSPL$   DS    F                   SAVE AREA FOR SPL $$                         
SVSPLM$  DS    F                   SAVE AREA FOR SPL MARKET $$                  
SVGSPL$  DS    F                   SAVE AREA FOR GROSS SPL $$                   
SVGSPLM$ DS    F                   SAVE AREA FOR GROSS SPL MARKET $$            
SPLSVR3  DS    F                   SAVE AREA FOR R3                             
SPLMEDIA DS    CL1                 ORIGINAL MEDIA FOR STATIONS                  
NULOOP   DS    X                   LOOP CONTROL                                 
SVBFREC  DS    CL(RGRECLEN)        SAVE CURRENT BUFF RECORD AREA                
         DROP  R7                                                               
         EJECT                                                                  
*                                                                               
*   COMPAFF:  FIND THE COMPETITIVE AFFILIATE ENTRY IN SPACEND FOR               
*       THIS STATION, AND SET THE STATION'S AFFILIATION IN THE                  
*       COMMENT AREA.  ALSO SET THE ADDRESS OF THE ENTRY IN THE                 
*       TABLE INTO ADCOMAFF.                                                    
*                                                                               
COMPAFF  NTR1                                                                   
         L     RF,ADSTAROW         SET A(STATION ROW)                           
         L     R1,ADCOMAFF         SET A(LAST COMP/AFF ELT FOUND)               
         CLC   LSTCOMAF,2(RF)      A(STATION) ALREADY FOUND?                    
         BE    CAFF0120            YES - DON'T LOOK UP AGAIN                    
         L     R1,ASPACND4         SET A(1ST ELEMENT IN SPACEND)                
CAFF0020 EQU   *                                                                
         CLI   0(R1),0             END OF SPACEND?                              
         BE    CAFF0140            YES - FORCE 'UNK' INTO RECORD                
         CLI   0(R1),X'50'         COMP/AFF ELEMENT?                            
         BE    CAFF0060            YES - CHECK IT OUT                           
CAFF0040 EQU   *                                                                
         ZIC   R0,1(R1)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R1,R0                                                            
         B     CAFF0020                                                         
CAFF0060 EQU   *                                                                
         CLC   BFREC+RGCMPDSP(2),2(R1)                                          
*                                  REP IN BFREC = ENTRY REP?                    
         BNE   CAFF0040            NO                                           
         L     RF,ADSTAROW         YES - SET A(STATION ROW)                     
         CLC   5(2,RF),=C'TV'      3-CHARACTER STATION LETTERS?                 
         BNE   CAFF0080            NO  - FOUR-CHARACTER                         
         CLC   2(3,RF),4(R1)       YES - REP IN STN ROW = ENTRY STN?            
         B     CAFF0100                                                         
CAFF0080 EQU   *                                                                
         CLC   2(4,RF),4(R1)       REP IN STN ROW = ENTRY STATION?              
CAFF0100 EQU   *                                                                
         BNE   CAFF0040            NO                                           
         ST    R1,ADCOMAFF         YES - STORE A(COMP/AFF ELT FOUND)            
         MVC   LSTCOMAF,2(RF)      SAVE CALLS OF LAST FOUND                     
CAFF0120 EQU   *                                                                
         MVC   BFREC+RGAFFDSP(3),8(R1)                                          
*                                  INSERT REP'D STATION'S AFFILIATION           
         B     CAFF0160                                                         
CAFF0140 EQU   *                                                                
         MVC   BFREC+RGAFFDSP(3),=C'UNK'                                        
*                                  INSERT UNKNOWN AFFILIATION                   
CAFF0160 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*   COMPAFF2:  ADDRESS OF COMPET AFFIL ENTRY IN SPACEND IS IN ADCOMAFF.         
*       LOCATE THIS STATION, AND INSERT ITS AFFILIATION IN THE                  
*       COMMENT AREA.                                                           
*                                                                               
COMPAFF2 NTR1                                                                   
         L     R2,ADSTAROW         SET A(STATION ROW)                           
         L     R1,ADCOMAFF         SET A(LAST COMP/AFF ELT FOUND)               
         LA    R1,11(R1)           A(1ST COMPETITIVE STN)                       
CAFX0020 EQU   *                                                                
         CLI   0(R1),0             END OF COMPETITIVE STATIONS?                 
         BNE   CAFX0060            NO  -                                        
         MVC   BFREC+RGAFFDSP(3),=C'UNK'                                        
*                                  YES - INSERT 'UNKNOWN' AFFILIATE             
         B     CAFX0200            EXIT ROUTINE                                 
CAFX0040 EQU   *                                                                
         LA    R1,7(R1)            NO  - BUMP TO NEXT COMPETITIVE               
         B     CAFX0020            GO BACK FOR NEXT                             
CAFX0060 EQU   *                                                                
         CLC   2(4,R2),0(R1)       STN IN STN/ROW = COMP STN?                   
         BNE   CAFX0040            NO                                           
         MVC   BFREC+RGAFFDSP(3),4(R1)                                          
*                                  INSERT COMP STATION'S AFFILIATION            
CAFX0200 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*    LOSSCALC:  AMOUNT OF LOSS IS CONTAINED IN CSSPLPCT.  THIS                  
*        IS TO BE USED TO CALCULATE THE AMOUNT OF THE LOSS FOR                  
*        THE MONTH BEING PROCESSED.                                             
*    FIRST, THE ARRAY MONTH IS CHECKED TO ENSURE THAT IT IS WITHIN              
*        THE FLIGHT DATES OF THE CONTRACT.  IF IT IS NOT, THE                   
*        RETURN FIELD IS SENT BACK AS ZERO.                                     
*    IF WITHIN FLIGHT:                                                          
*        1.  TOTAL LOSS / # DAYS IN FLIGHT -> $LOSS/DAY                         
*        2.  # DAYS IN FLIGHT IN BDCAST MONTH * $LOSS/DAY ->                    
*            $LOSS/BDCAST MONTH                                                 
*        3.  VALUE IS RETURNED IN DUB                                           
*        4.  R4 -> ARRAY ADDRESS                                                
*                                                                               
LOSSCALC NMOD1 0,**LOSS**                                                       
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         L     R4,4(R1)            RESET A(ARRAY ENTRY)                         
         USING QWKD,R2                                                          
*                                                                               
*   R2 IS PREVIOUSLY SET.  DO NOT CHANGE IT HERE.                               
*                                                                               
         XC    DUB,DUB             CLEAR RETURN FIELD                           
*                                                                               
*   TEST ARRAY DATE FOR INCLUSION WITHIN CONTRACT FLIGHT DATES                  
*        IF DOING PRIOR YEAR FIGURES, SKIP TEST                                 
*                                                                               
         MVC   WORK+60(2),CURDATE(R4)                                           
*                                  SET CURRENT DATE                             
         CLI   THREE,0             LOOKING FOR CURRENT YEAR?                    
         BE    LOCA0010            YES                                          
         MVC   WORK+60(2),PRIDATE(R4)                                           
*                                  NO  - SET PRIOR   DATE                       
LOCA0010 EQU   *                                                                
         MVI   WORK+62,1           SET DAY TO 1                                 
         GOTO1 DATCON,DMCB,(3,WORK+60),(0,WORK)                                 
*                                  CONVERT MONTH DATE TO EBCDIC                 
         MVC   WORK+54(6),WORK     SAVE EBCDIC DATE                             
*                                                                               
****>>>  MVC   WORK(6),0(R4)       ARRAY DATE (EBCDIC)                          
*                                  DON'T USE ARRAY DATE ANY MORE                
*                                                                               
         GOTO1 DATCON,DMCB,(0,WORK),(3,WORK+6)                                  
*                                  CONVERT TO BINARY FORMAT                     
         CLC   WORK+6(2),FLIGHTST                                               
*                                  ARRAY DATE VS CON FLIGHT START               
         BL    LOCA0100            ARRAY EARLIER: EXIT W/$0                     
         CLC   WORK+6(2),FLIGHTND                                               
*                                  ARRAY DATE VS CON FLIGHT END                 
         BH    LOCA0100            ARRAY LATER: EXIT W/$0                       
*                                                                               
         MVC   WORK(4),WORK+54     GET BDCAST DATES OF MONTH                    
         MVC   WORK+4(2),=C'15'    SET TO 15TH OF MONTH                         
*                                                                               
*   TEST                                                                        
*        MVC   P+1(05),=C'DATE:'                                                
*        MVC   P+10(6),WORK                                                     
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                                        
*                                  WORK+6  = BCST MONTH START DATE              
*                                  WORK+12 = DCST MONTH END DATE                
*                                                                               
*   TEST                                                                        
*        MVC   P+1(05),=C'BCST:'                                                
*        MVC   P+10(12),WORK+6                                                  
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
*                                                                               
*   CHECK IF FLIGHT START SUPERCEDES BCST START, OR                             
*            FLIGHT END   SUPERCEDES BCST END                                   
*                                                                               
         GOTO1 DATCON,DMCB,(0,WORK+6),(3,WORK+24)                               
*                                  CONVERT START DATE TO YMD BINARY             
         CLC   RCONDATE(3),WORK+24                                              
*                                  FLIGHT START VS BCST START                   
         BNH   LOCA0020            START NOT AFTER BCST START: LEAVE            
         GOTO1 DATCON,DMCB,(3,RCONDATE),(0,WORK+6)                              
*                                  START AFTER BCST START:                      
*                                     REPLACE WITH FLIGHT START                 
LOCA0020 EQU   *                                                                
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,WORK+24)                              
*                                  CONVERT END   DATE TO YMD BINARY             
         CLC   RCONDATE+3(3),WORK+24                                            
*                                  FLIGHT END   VS BCST END                     
         BNL   LOCA0040            END  NOT BEFORE BCST END: LEAVE              
         GOTO1 DATCON,DMCB,(3,RCONDATE+3),(0,WORK+12)                           
*                                  END BEFORE BCST END:                         
*                                     REPLACE WITH FLIGHT END                   
LOCA0040 EQU   *                                                                
*                                  WORK+6  = BCST MONTH OR FLIGHT               
*                                     START DATE (WHICHEVER IS LATER)           
*                                  WORK+12 = BCST MONTH OR FLIGHT               
*                                     END DATE (WHICHEVER IS EARLIER)           
*                                                                               
*                                                                               
*   TEST                                                                        
*        MVC   P+1(05),=C'PERV:'                                                
*        MVC   P+10(12),WORK+6                                                  
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         GOTO1 =V(PERVERT),DMCB,WORK+6,WORK+12                                  
         ZICM  RF,DMCB+8,2         P3 = # DAYS INCLUSIVE IN MONTH               
         ST    RF,PERDAYS          SAVE # DAYS INCLUSIVE IN MONTH               
*                                                                               
*   CALCULATE $LOSS/DAY:                                                        
*        1.  CALCULATE DAYS IN FLIGHT                                           
*        2.  DIVIDE LOSS $$ BY DAYS IN FLIGHT                                   
*        3.    SAVE RESULT IN DOLRSDAY                                          
*                                                                               
         GOTO1 DATCON,DMCB,(3,RCONDATE),(0,WORK+6)                              
         GOTO1 DATCON,DMCB,(3,RCONDATE+3),(0,WORK+12)                           
*                                  WORK+6  = FLIGHT START DATE                  
*                                  WORK+12 = FLIGHT END DATE                    
         GOTO1 =V(PERVERT),DMCB,WORK+6,WORK+12                                  
         ZICM  R1,DMCB+8,2         P3 = # DAYS INCLUSIVE IN FLIGHT              
         ST    R1,FLTDAYS          SAVE # DAYS IN FLIGHT                        
*                                                                               
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     RF,CSSPLPCT(RE)     GET LOSS DOLLARS FOR ORDER                   
         ST    RF,LOSSDOLS         SAVE LOSS DOLLARS                            
         SR    RE,RE               CLEAR FOR DIVIDE                             
         M     RE,=F'200'          DECIMAL ALIGNMENT + DOUBLE FOR               
*                                     ROUNDING                                  
         AR    RF,R1               HALF-ADD FOR ROUNDING                        
         DR    RE,R1               DIVIDE BY # DAYS                             
         SRA   RF,1                DIVIDE BY 2                                  
         ST    RF,DOLRSDAY         SAVE DOLLARS/DAY                             
*                                                                               
         SR    RE,RE               CLEAR FOR MULTIPLICATION                     
         M     RE,PERDAYS          $LOSS/DAY * DAYS IN PERIOD                   
*                                     ->  $LOSS IN PERIOD                       
         ST    RF,LOSSPER                                                       
*        MVC   P+1(09),=C'DOLRSDAY='                                            
*        EDIT  DOLRSDAY,(9,P+12),WRK=DUBLOCAL                                   
*        EDIT  FLTDAYS,(9,P+24),WRK=DUBLOCAL                                    
*        EDIT  LOSSDOLS,(9,P+36),WRK=DUBLOCAL                                   
*        EDIT  LOSSPER,(9,P+48),WRK=DUBLOCAL                                    
*        EDIT  PERDAYS,(9,P+60),WRK=DUBLOCAL                                    
*        GOTO1 REPORT                                                           
*                                                                               
         MVC   DUB,LOSSPER         LOAD RESULT TO RETURN FIELD                  
LOCA0100 EQU   *                                                                
         XIT1                                                                   
*                                                                               
PERDAYS  DS    F                                                                
DOLRSDAY DS    F                                                                
FLTDAYS  DS    F                                                                
LOSSDOLS DS    F                                                                
LOSSPER  DS    F                                                                
DUBLOCAL DS    D                                                                
*                                                                               
         EJECT                                                                  
*                                                                               
*                                                                               
*    IF GROSS SPL $$ COLUMN SPEC IS USED:                                       
*       1.  CHECK SPL DATE TO ENSURE IT IS WITHIN REQUEST PERIOD.               
*       2.  SCAN ENTIRE CONTRACT, AGGREGATING THE ORDERED $$ TOTAL.             
*       3.  CALL THE SPLMKT$$ ROUTINE WITH THE GROSS $$ FIGURE,                 
*           TO CORRECTLY CALCULATE THE MARKET DOLLARS.                          
*                                                                               
SPL$CALC NMOD1 0,**SPL$**                                                       
         L     R7,0(R1)            RESET A(RPSPECD)                             
         USING RPSPECD,R7                                                       
         USING QWKD,R2                                                          
*                                                                               
*   R2 IS PREVIOUSLY SET.  DO NOT CHANGE IT HERE.                               
*                                                                               
         L     RC,4(R1)            RESET A(WORKSPACE)                           
*                                                                               
         LA    R3,RCONELEM         FIND SPL ELEMENT                             
S$CA0020 EQU   *                                                                
         ZIC   RF,1(R3)            BUMP TO NEXT ELEMENT                         
         AR    R3,RF                                                            
         CLI   0(R3),0             END OF RECORD?                               
         BE    S$CA0900            YES - NO SPL ELEMENT                         
         CLI   0(R3),6             NO  - SPL ELEMENT?                           
         BNE   S$CA0020            NO  - GO BACK FOR NEXT                       
         USING RCONSPEL,R3         YES -                                        
         TM    RCONSPES,X'08'      COMPRESSED DATE IN ELEMENT?                  
         BNO   S$CA0040            NO  - OLD FORMAT                             
*                                  NEW FORMAT:  COMPARE COMPRESSED              
         MVC   WORK+4(2),RCONSPYR  SET DATE FOR COMMON TEST                     
         B     S$CA0050                                                         
S$CA0040 EQU   *                                                                
         MVC   WORK(2),RCONSPYR    MOVE OLD FORMAT DATE                         
         MVI   WORK+2,1            SET DAY TO 1                                 
         GOTO1 DATCON,DMCB,(3,WORK),(2,WORK+4)                                  
*                                  CONVERT YMD BINARY TO COMPRESSED             
S$CA0050 EQU   *                                                                
*                                                                               
*   TEST                                                                        
         CLC   =C'DUMPMONFOR',QWREQ+(QUESTOR-QRECORD)                           
         BNE   S$CATST1                                                         
         BAS   RE,DISPSPL$                                                      
S$CATST1 EQU   *                                                                
*   TEST END                                                                    
*                                                                               
         CLC   WORK+4(2),QWBCSTST  PRIOR TO START (COMPRESSED)?                 
         BL    S$CA0900            YES - DON'T INCLUDE IT                       
         CLC   WORK+4(2),QWBCSTND  NO  - AFTER END (COMPRESSED)?                
         BH    S$CA0900            YES - DON'T INCLUDE IT                       
S$CA0070 EQU   *                                                                
         DROP  R3                                                               
*                                                                               
         LA    R3,RCONELEM         SCAN THE CONTRACT                            
         SR    R5,R5                                                            
S$CA0080 EQU   *                                                                
         ZIC   RF,1(R3)            BUMP TO NEXT ELEMENT                         
         AR    R3,RF                                                            
         CLI   0(R3),0             END OF RECORD?                               
         BE    S$CA0100            YES                                          
         CLI   0(R3),3             CONTRACT BUCKET ELEMENT?                     
         BNE   S$CA0080            NO  - GO BACK FOR NEXT                       
         ZICM  RE,RCONBKAM-RCONBKEL(R3),4                                       
*                                  GET DOLLAR AMT FROM ELEMENT                  
         AR    R5,RE               ACCUMULATE TOTAL ORDERED                     
         B     S$CA0080            GO BACK FOR NEXT                             
S$CA0100 EQU   *                                                                
         L     R3,RPSPLDAD         SET A(GROSS SPL $ COLUMN)                    
         STCM  R5,15,0(R3)         INSERT INTO OUTPUT RECORD                    
         L     R3,RPSPLGAD         SET A(GROSS SPL MKT $ COLUMN)                
         GOTO1 =A(SPLMKT$$),DMCB,(R3),(R5)                                      
*                                  R3 = COLUMN IN ARRAY                         
*                                  R5 = GROSS SPL $ FOR ORDER                   
S$CA0900 EQU   *                                                                
         XIT1                                                                   
*                                                                               
         EJECT                                                                  
*                                                                               
* DISPLAY THE PERTINENT SPL DATES AND CONTRACT NUMBER FOR THIS                  
*    COMPARISON.                                                                
*                                                                               
DISPSPL$ NTR1                                                                   
         GOTO1 HEXOUT,DMCB,RCONKCON,P+1,4,=C'TOG'                               
         GOTO1 DATCON,DMCB,(2,WORK+4),(5,P+10)                                  
         MVC   P+20(2),QWCURST                                                  
         MVC   P+30(2),QWCURND                                                  
         MVC   P+40(3),QWBCSTST                                                 
         MVC   P+50(3),QWBCSTND                                                 
         GOTO1 REPORT                                                           
         XIT1                                                                   
         DROP  R2,R7                                                            
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
         DS    0F                                                               
*                                                                               
*    IF CMKT/PMKT COLUMN SPEC IS USED, CALCULATE THE MARKET $$                  
*       FROM THE VALUE IN THE COLUMN AND THE SHARE GOAL STORED.                 
*       THE ADDRESS OF THE COLUMNS ARE IN CMKTFLD AND PMKTFLD.                  
*    ALSO CHECK IF ESTIMATED TOTAL IS TO BE CALCULATED.  IF SO,                 
*       ADD CURRENT MARKET $$ TO CURRENT BOOKED, WHICH IS BROUGHT               
*       OVER IN BUFFREC COLUMN.                                                 
*                                                                               
         DS    0F                                                               
SHARCALC NMOD1 0,**SHAR*                                                        
         L     RC,4(R1)            RESET A(WORKSPACE)                           
*                                                                               
         L     R2,ACMKTFLD                                                      
         OC    ACMKTFLD,ACMKTFLD   CURR MKT $$ NEEDED?                          
         BZ    SCAL0020            NO                                           
         GOTO1 SHARCAL2,DMCB,(R2)                                               
*                                  YES - CALCULATE VALUE                        
*                                                                               
SCAL0020 EQU   *                                                                
         L     R2,APMKTFLD                                                      
         OC    APMKTFLD,APMKTFLD   PRIOR MKT $$ NEEDED?                         
         BZ    SCAL0040            NO                                           
         GOTO1 SHARCAL2,DMCB,(R2)                                               
SCAL0040 EQU   *                                                                
*                                  YES - CALCULATE VALUE                        
         L     R2,ACPMKFLD                                                      
         OC    ACPMKFLD,ACPMKFLD   CURR PEND (TRUE) MKT$$ NEEDED?               
         BZ    SCAL0060            NO                                           
         GOTO1 SHARCAL2,DMCB,(R2)                                               
SCAL0060 EQU   *                                                                
*                                  YES - CALCULATE VALUE                        
         L     R2,APPMKFLD                                                      
         OC    APPMKFLD,APPMKFLD   PRIOR PEND (TRUE) MKT$$ NEEDED?              
         BZ    SCAL0080            NO                                           
         GOTO1 SHARCAL2,DMCB,(R2)                                               
SCAL0080 EQU   *                                                                
*                                  YES - CALCULATE VALUE                        
         L     R2,ACFMKFLD                                                      
         OC    ACFMKFLD,ACFMKFLD   CURR FORE (TRUE) MKT$$ NEEDED?               
         BZ    SCAL0100            NO                                           
         GOTO1 SHARCAL2,DMCB,(R2)                                               
SCAL0100 EQU   *                                                                
*                                  YES - CALCULATE VALUE                        
         L     R2,APFMKFLD                                                      
         OC    APFMKFLD,APFMKFLD   PRIOR FORE (TRUE) MKT$$ NEEDED?              
         BZ    SCAL0120            NO                                           
         GOTO1 SHARCAL2,DMCB,(R2)                                               
SCAL0120 EQU   *                                                                
         XIT1                                                                   
         SPACE 5                                                                
SHARCAL2 NTR1                                                                   
         SR    RF,RF               CLEAR RESULT FIELD                           
         SR    R7,R7               CLEAR A COUNTER                              
         OC    SHRGOAL,SHRGOAL     ANY SHARE GOAL?                              
         BZ    SHAC0020            NO  - FORCE ZERO VALUE                       
         L     R2,SHRGOAL          RETRIEVE SHARE GOAL                          
         L     R3,0(R1)            SET A(BUFF REC FIELD)                        
         L     RF,0(R3)            LOAD FORECAST $$ FOR PERIOD                  
SHAC0010 EQU   *                                                                
         LTR   RF,RF               TEST FOR NEGATIVE                            
*                                    (EXCESSIVELY LARGE VALUE)                  
         BNP   SHAC0012                                                         
         C     RF,=F'1000000'      MAX LIMIT                                    
         BNH   SHAC0015            NOT EXCEEDED                                 
         SRA   RF,1                EXCEEDED: DIVIDE BY 2                        
         LA    R7,1(R7)            INCREMENT COUNTER                            
         B     SHAC0010            GO BACK AND CHECK AGAIN                      
SHAC0012 EQU   *                                                                
         SR    RF,RF               ZERO IT OUT: DISCOUNT IT                     
SHAC0015 EQU   *                                                                
*                                                                               
*   TEST DUMP                                                                   
***      CLC   =X'07220787',RCONKCON                                            
***      BNE   TDUM0020                                                         
***      MVC   P+1(09),=C'CON FOUND'                                            
***      ST    RF,TESTRF                                                        
***      EDIT  TESTRF,(12,P+12)                                                 
***      GOTO1 REPORT                                                           
***      DC    H'0'                                                             
*TESTRF   DS    F                                                               
TDUM0020 EQU   *                                                                
*   TEST DUMP                                                                   
*                                                                               
         SR    RE,RE                                                            
         M     RE,=F'10000'        MULTIPLY FOR DECIMAL ALIGN                   
         SLDA  RE,1                DOUBLE FOR ROUNDING                          
         AR    RF,R2               ADD FOR ROUNDING                             
         DR    RE,R2               DIVIDE BY SHARE GOAL                         
         SRA   RF,1                DIVIDE BY 2                                  
SHAC0020 EQU   *                                                                
         L     R3,0(R1)            RESET A(BUFF RECORD ADDR)                    
         LTR   R7,R7               ANY COUNTER?                                 
         BZ    SHAC0040            NO                                           
SHAC0030 EQU   *                   YES - REALIGN FINAL OUTPUT                   
         SLA   RF,1                DOUBLE FINAL AMOUNT                          
         BCT   R7,SHAC0030         DO IT FOR EACH EARLIER DIVIDE                
SHAC0040 EQU   *                   YES - REALIGN FINAL OUTPUT                   
         ST    RF,0(R3)            REPLACE MARKET $$                            
         XIT1                                                                   
         SPACE 5                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*                                                                               
*        ROUTINE TO FILTER STATION RELATED FIELDS                               
*        P1 = A(RECORD STATION FIELD)                                           
*        P2 = A(RECORD REP CODE FIELD)                                          
*                                                                               
         DS    0F                                                               
FILTSTA  NMOD1 0,FILTSTA                                                        
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN - DONT CHANGE VALUE                         
*                                                                               
         LA    R3,QWREQ                                                         
         USING QRECORD,R3                                                       
*                                                                               
         L     R4,4(R1)            RE-SET R4 TO A(REP CODE FLD)                 
         L     R1,0(R1)            RE-SET R1 TO A(STATION FLD)                  
*                                                                               
         CLC   QSTATION,SPACES     TEST STATION FILTER                          
         BE    FSTA0030            NO STATION FILTER                            
         CLI   QSTATION,C'*'       STATION SET FILTER REQUESTED?                
         BNE   FSTA0000            NO                                           
         BAS   RE,FSTATSET         YES - CHECK FOR STATION SET                  
         BNZ   FSXNE               RETURN NOT ZERO:  NOT ACCEPTED               
         B     FSTA0030            RETURN     ZERO:  ACCEPTED                   
*                                     DO STATION-RELATED FILTERS                
FSTA0000 EQU   *                                                                
         CLI   CMBOREP,C'Y'        MASTER OR SUBSIDIARY?                        
         BNE   FSTA0020            NO                                           
         CLI   QSTATION+4,C'C'     YES - REQUEST FOR COMBO STATION?             
         BNE   FSTA0020            NO                                           
         CLC   QSTATION,0(R1)      RECORD FOR REQUESTED STATION?                
         BE    FSTA0030            YES                                          
         LA    RE,QWCOMBOS         NO  - SCAN PARTICIPATING STATIONS            
         LA    RF,4                4 STATIONS MAXIMUM                           
FSTA0010 EQU   *                                                                
         CLC   0(5,RE),0(R1)       TABLE VS RCONREC STATION                     
         BE    FSTA0030            FOUND - USE IT                               
         LA    RE,5(RE)            BUMP TO NEXT ENTRY                           
         BCT   RF,FSTA0010         GO BACK FOR NEXT                             
         B     FSXNE               NOT FOUND - SKIP IT                          
FSTA0020 EQU   *                                                                
         CLC   QSTATION,0(R1)      YES-COMPARE STATIONS                         
         BNE   FSXNE                                                            
FSTA0030 EQU   *                                                                
         CLI   QWNREQ,1            TEST 2ND REQUEST CARD                        
         BNH   FSXEQ                                                            
         LA    R3,QWREQ                                                         
         USING QRECORD,R3                                                       
         LA    R7,QWREQ2           YES-                                         
         USING QREC2D,R7                                                        
         CLC   Q2TVB,SPACES        TEST FOR TVB FILTER                          
         BH    FSTA0040                                                         
         CLC   Q2OWNER,SPACES      TEST FOR OWNER FILTER                        
         BH    FSTA0040                                                         
         CLI   Q2RANK,C' '         TEST FOR RANK FILTER                         
         BH    FSTA0040                                                         
         CLC   Q2MARKET,SPACES     TEST FOR MARKET FILTER                       
         BH    FSTA0040                                                         
         CLC   Q2AFFIL,SPACES      TEST FOR STATION AFFIL FILTER                
         BNH   FSXEQ               NO-STATION IS OK                             
*                                                                               
FSTA0040 CLC   STASAVE,0(R1)       TEST FOR STATION BREAK                       
         BE    FSTA0070                                                         
         MVI   INFCODE,2           FIND STATION INFO ELE                        
         BAS   RE,FRSTINF7                                                      
         B     *+8                                                              
FSTA0050 BAS   RE,NEXTINF7                                                      
         BE    *+6                                                              
FSTA0060 DC    H'0'                                                             
         CLC   0(2,R4),DSTNREP(R5) SAME REP?                                    
         BNE   FSTA0050                                                         
         CLC   0(5,R1),DSTNCALL(R5)                                             
         BNE   FSTA0050                                                         
         MVC   STATVB,DSTNTVB(R5)   SAVE TVB CODE                               
         MVC   STAOWN,DSTNOWN(R5)   SAVE OWNER CODE                             
         MVC   STARANK,DSTNRANK(R5) SAVE RANK                                   
         MVC   STAMKT,DSTNMKT(R5)   SAVE MARKET                                 
         MVC   STAAFFL,DSTNAFF(R5)  SAVE AFFL                                   
         OC    STAMKT,SPACES                                                    
         MVC   STASAVE,0(R1)        SAVE STATION                                
*                                                                               
FSTA0070 CLC   Q2TVB,SPACES        TVB FILTER?                                  
         BNH   FSTA0080            NO                                           
         CLC   STATVB,Q2TVB        YES -                                        
         BNE   FSXNE                                                            
FSTA0080 EQU   *                                                                
         CLC   Q2OWNER,SPACES      OWNER FILTER?                                
         BNH   FSTA0090            NO  -                                        
         LA    RE,QWREQ3           YES - CHECK IF OWNER/MKT FLAG SET            
         USING QREC3D,RE                                                        
         CLI   Q3OWNMKT,C'Y'       PERMIT ACCESS TO MARKETS IN WHICH            
*                                     OWNER PARTICIPATES?                       
         BNE   FSTA0088            NO  - STANDARD OWNER FILTER                  
*                                                                               
         DROP  RE                                                               
         XC    FSTAWORK,FSTAWORK   CLEAR OUT WORK AREA                          
         MVC   FSTAWORK(3),Q2OWNER INSERT OWNER FILTER FROM REQUEST             
         MVC   FSTAWORK+3(4),STAMKT                                             
*                                  INSERT STA MKT FROM TABLE ENTRY              
         L     RF,AOWNMKT          SET A(OWNER/MARKET TABLE)                    
FSTA0082 EQU   *                                                                
         CLI   0(RF),X'22'         OWNER/MARKET TABLE ENTRY?                    
         BNE   FSXNE               NO  - ENTRY NOT FOUND -                      
*                                     REJECTED                                  
         CLC   2(7,RF),FSTAWORK    TABLE ENTRY = OWNER/MARKET?                  
         BE    FSTA0090            YES - ACCEPT THIS CONTRACT                   
*                                     OWNER ACTIVE IN MARKET                    
         ZIC   RE,1(RF)            BUMP BY LENGTH                               
         AR    RF,RE                                                            
         B     FSTA0082            GO BACK FOR NEXT                             
FSTAWORK DS    2F                  OWNER/MARKET WORK AREA                       
FSTA0088 EQU   *                                                                
         CLC   STAOWN,Q2OWNER                                                   
         BNE   FSXNE                                                            
FSTA0090 EQU   *                                                                
         CLI   Q2RANK,C' '                                                      
         BNH   FSTA0100                                                         
         CLC   STARANK,Q2RANK                                                   
         BNE   FSXNE                                                            
FSTA0100 EQU   *                                                                
*                                                                               
*   HERE'S THE MARKET FILTER CODE:  INTERSPERSE WITH FINDING SET                
*        PARTICIPATION.                                                         
*                                                                               
**>>>>                                                                          
         CLC   Q2MARKET,SPACES                                                  
         BNH   FSTA0110                                                         
         CLI   Q2MARKET,C'*'       MARKET SET FILTER?                           
         BNE   FSTA0109            NO                                           
         L     RF,QWMKTSET         YES - COMPARE AGAINST SET                    
FSTA0101 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FSTA0102            YES - NO MATCH                               
         CLC   STAMKT,0(RF)        NO  - MARKET IN SET?                         
         BE    FSTA0103            YES - ACCEPT THIS RECORD                     
         LA    RF,4(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FSTA0101            GO BACK FOR NEXT                             
FSTA0102 EQU   *                                                                
         TM    QWSETFLG+1,EXMKTSET CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FSTA0110            YES - ACCEPT RECORD                          
         B     FSXNE               NO  - REJECT RECORD                          
FSTA0103 EQU   *                                                                
         TM    QWSETFLG+1,EXMKTSET CODE FOUND IN SET: EXCLUDE SET?              
         BO    FSXNE               YES - REJECT IT                              
         B     FSTA0110            NO  - ACCEPT IT                              
**>>>>                                                                          
FSTA0109 EQU   *                                                                
         CLC   STAMKT,Q2MARKET                                                  
         BNE   FSXNE                                                            
FSTA0110 EQU   *                                                                
         CLC   Q2AFFIL,SPACES                                                   
         BNH   FSXEQ                                                            
         CLC   STAAFFL,Q2AFFIL                                                  
         BE    FSXEQ                                                            
*                                                                               
FSXNE    LTR   RB,RB                                                            
         B     FSX                                                              
*                                                                               
FSXEQ    CR    RB,RB                                                            
*                                                                               
FSX      EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*   FSTATSET:  STATION SET REQUESTED:  CHECK TABLED STATIONS FOR                
*        FILTERING                                                              
*        R1  =  A(STATION FIELD IN RECORD BEING CHECKED)                        
*                                                                               
FSTATSET NTR1                                                                   
         L     RF,QWSTASET         A(STATION SET)                               
FSTS0020 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FSTS0030            YES - NO MATCH                               
         CLC   0(5,R1),0(RF)       NO  - STATION IN SET?                        
         BE    FSTS0040            YES - ACCEPT THIS RECORD                     
         LA    RF,5(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FSTS0020            GO BACK FOR NEXT                             
FSTS0030 EQU   *                                                                
         TM    QWSETFLG,EXSTASET   CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FSTS0060            YES - ACCEPT RECORD                          
         B     FSTS0080            NO  - REJECT RECORD                          
FSTS0040 EQU   *                                                                
         TM    QWSETFLG,EXSTASET   CODE FOUND IN SET: EXCLUDE SET?              
         BO    FSTS0080            YES - REJECT IT                              
         B     FSTS0060            NO  - ACCEPT IT                              
FSTS0060 EQU   *                                                                
         SR    R0,R0               FOUND:  SET CC = ZERO                        
         B     FSTS0100                                                         
FSTS0080 EQU   *                                                                
         LTR   RB,RB               NOT FOUND:  SET CC NOT = ZERO                
FSTS0100 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
         DROP  R2,R3,R7                                                         
         EJECT                                                                  
*                                                                               
*        ROUTINE TO FIND INFORMATION ELEMENT FROM INFO POOL                     
*              INPUT:  INFCODE = ELEMENT CODE                                   
*              OUTPUT: R5      = A(ELEMENT)                                     
*                                                                               
         SPACE                                                                  
FRSTINF7 L     R5,ASPACND4                                                      
*                                                                               
FN7010   CLI   0(R5),0                                                          
         BE    FN7999                                                           
         CLC   INFCODE,0(R5)                                                    
         BER   RE                                                               
*                                                                               
NEXTINF7 SR    R0,R0                                                            
         ICM   R0,1,1(R5)                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R5,R0                                                            
         B     FN7010                                                           
*                                                                               
FN7999   LTR   RE,RE                                                            
         BR    RE                                                               
         SPACE 2                                                                
         LTORG                                                                  
         SPACE 2                                                                
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
*        POST BUFFALO ROWS, REPORT LEVEL                                        
*        R1 POINTS TO A(ROW CODE)                                               
*        R4 = BUFFALO ROW ADDR                                                  
         DS    0F                                                               
POSTROW  NMOD1 0,POSTROW                                                        
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN - DONT CHANGE VALUE                         
*                                                                               
*                                                                               
         L     RF,0(R1)                                                         
         CLI   RECORD,C'B'         BUDGET RECORD PROCESSING?                    
         BNE   PSRW0040            NO  - DON'T RELOAD R7                        
*                                     NOT PASSED IN                             
         L     R7,4(R1)            RESET A(RPSPECD)                             
         USING RPSPECD,R7                                                       
*                                     NOT PASSED IN                             
PSRW0040 EQU   *                                                                
         SR    R1,R1                                                            
         IC    R1,0(RF)                                                         
         STC   R1,SVCODE                                                        
         BCTR  R1,0                                                             
         SLL   R1,3                                                             
         LA    RE,ROWBTAB(R1)                                                   
         C     RE,=A(ROWBTABX)                                                  
         BNH   PSRW0080                                                         
         DC    H'0'                                                             
PSRW0080 EQU   *                                                                
         CLI   RECORD,C'C'         CONTRACT PROCESSING?                         
         BNE   PSRW0120            NO  - BUDGET PROCESSING                      
         ICM   RF,15,0(RE)         YES - TEST CONTRACT ROUTINE LIST             
         BZ    PSRWXTNE            NO ADDRESS - NOT FOUND                       
         TM    0(RE),X'80'         VALID ROW - SET TO '-1'?                     
         BO    PSRWXTEQ            YES - PROCESS AS 'POSTED'                    
         BASR  R9,RF               NO  - POST THIS ROW                          
         BZ    PSRW0100            NO ERROR ON RETURN:                          
*                                  COLUMN VALUE NOT FOUND:                      
         LA    RF,QWREQ3           SET A(REQUEST CARDS FOR JOB)                 
         CLI   Q3DISALL-QREC3(RF),C'Y'                                          
*                                  REQUEST TO OVERRIDE 'EMPTY' SKIP?            
         BNE   PSRWXTNE            NO  - TREAT AS 'NOT FOUND'                   
*                                  USE DEFAULT VALUE FOR 'ALL COLS'             
PSRW0100 EQU   *                                                                
         MVI   RGROWSZ-1(R4),1                                                  
         B     PSRWXTEQ                                                         
*                                                                               
PSRW0120 EQU   *                                                                
         LA    RE,4(RE)            CHECK BUDGET ROUTINES                        
         ICM   RF,15,0(RE)         ANY BUDGET ROUTINE?                          
         BNZ   PSRW0160            YES                                          
***>>>                             NO  - CHECK FOR C*MP PROCESSING              
***      LA    RF,QWREQ                                                         
***      USING QRECORD,RF                                                       
***      CLC   =C'C*MP',QUESTOR    USE C*MP BUDGETS?                            
***      BNE   PSRW0140            NO                                           
         LA    RF,QWREQ3                                                        
         USING QREC3,RF                                                         
         CLI   Q3COMBUD,C'Y'       THIS REQUEST USES C*MP BUDGETS?              
         BNE   PSRW0140            NO  -                                        
*                                                                               
         DROP  RF                                                               
*                                                                               
         CLC   RBUDKSTA,=C'C*MP '  YES - 'COMPANY WIDE' BUDGET?                 
         BE    PSRW0150            YES - PROCESS IT                             
***>>>                                                                          
PSRW0140 EQU   *                                                                
         ICM   RF,15,RPBUDPAS      BUDPAS SPEC?                                 
         BZ    PSRWXTNE            NO  - NO ROUTINE                             
PSRW0150 EQU   *                                                                
         MVC   0(2,R4),=X'FFFF'    YES - STUFF 'BUDGET ROW' FLAG                
         MVC   2(6,R4),=C'BUDGET'                                               
         MVI   RGROWSZ-1(R4),1                                                  
         B     PSRWXTEQ                                                         
PSRW0160 EQU   *                                                                
         TM    0(RE),X'80'                                                      
         BO    PSRWXTEQ                                                         
         BASR  R9,RF               POST THE ROWS                                
         BNZ   PSRWXTNE                                                         
         MVI   RGROWSZ-1(R4),1                                                  
*                                                                               
PSRWXTEQ EQU   *                                                                
         CR    RB,RB                                                            
         B     PSRWEXIT                                                         
*                                                                               
PSRWXTNE EQU   *                                                                
         LTR   RB,RB                                                            
*                                                                               
PSRWEXIT EQU   *                                                                
         XIT1                                                                   
*                                                                               
         DROP R7                                                                
*                                                                               
         EJECT                                                                  
*                                                                               
*        ROW POST ROUTINE BRANCH TABLE                                          
*                                                                               
         SPACE                                                                  
*              CONTRACT  /BUDGET                 RECORD                         
ROWBTAB  DS    0F                                                               
         DC    A(ROWCD01),A(ROWBD01)             REP                            
         DC    A(ROWCD02),A(ROWCD02)             STATION                        
         DC    A(ROWCD03),A(ROWBD03)             REGION                         
         DC    A(ROWCD04),A(ROWBD04)             OFFICE                         
         DC    A(ROWCD05),A(ROWBD05)             TEAM                           
         DC    A(ROWCD06),AL4(0)                 SALESPERSON                    
         DC    A(ROWCD07),A(ROWBD07)             GROUP                          
         DC    A(ROWCD08),AL4(0)                 ADVERTISER                     
         DC    A(ROWCD09),AL4(0)                 PRODUCT                        
         DC    A(ROWCD10),AL4(0)                 AGENCY/OFFICE                  
         DC    A(ROWCD11),A(ROWBD11)             AFFILIATE                      
         DC    A(ROWCD12),AL4(0)                 CONTRACT                       
         DC    A(ROWCD13),AL4(0)                 CLASS                          
         DC    A(ROWCD14),A(ROWBD14)             OFFICE NY/CH/LA SEQ            
         DC    A(ROWCD15),AL4(0)                 CATEGORY                       
         DC    AL4(-1),AL4(-1)                   RANK                           
         DC    A(ROWCD17),A(ROWBD17)             MONTH                          
         DC    A(ROWCD18),A(ROWBD18)             CURMONTH                       
         DC    A(ROWCD19),A(ROWBD19)             ALLMONTH                       
         DC    A(ROWCD20),A(ROWBD20)             QTR                            
         DC    A(0),A(0)                         SPARE                          
         DC    A(ROWCD22),A(ROWBD22)             STATYPE                        
         DC    A(ROWCD23),A(ROWBD23)             TVB                            
         DC    A(ROWCD24),A(ROWBD24)             OWNER                          
         DC    A(ROWCD25),A(ROWBD25)             GRGRP                          
         DC    A(ROWCD07),A(ROWBD07)             GRSUBGRP                       
         DC    AL4(-1),AL4(0)                    ADVNAME                        
         DC    AL4(-1),AL4(0)                    AGYNAME                        
         DC    A(ROWCD29),A(0)                   SERVICE                        
         DC    A(ROWCD30),A(0)                   MKTRANK                        
         DC    AL4(-1),AL4(0)                    AVLPACE                        
         DC    A(ROWCD02),A(ROWCD02)             STAMKT                         
         DC    A(ROWCD33),A(ROWBD33)             CONTYPE                        
         DC    A(ROWCD34),A(0)                   PTPERSON                       
         DC    A(ROWCD35),A(0)                   NETCON                         
         DC    A(ROWCD36),A(0)                   BOOK                           
         DC    A(ROWCD37),A(0)                   DAYPART                        
         DC    A(ROWCD38),A(0)                   DEMO                           
         DC    A(ROWCD39),A(ROWBD39)             MARKET                         
         DC    A(ROWCD40),A(ROWBD40)             COMPANY                        
         DC    A(ROWCD41),A(0)                   DAYPARTS                       
         DC    A(ROWCD42),A(0)                   FLIGHT                         
         DC    A(ROWCD43),A(0)                   BUYER                          
         DC    A(ROWCD44),A(0)                   DEV SALESPERSON                
         DC    A(ROWCD45),A(0)                   DEV CONTRACT TYPE              
         DC    A(ROWCD46),A(0)                   EMPTY ROW                      
         DC    A(ROWCD47),A(0)                   AGENCY ONLY (NO OFFC)          
         DC    A(ROWCD48),A(0)                   BUYLINE CODE                   
         DC    A(ROWCD49),A(0)                   BUY ATTRIBUTE 1                
         DC    A(ROWCD50),A(0)                   BUY ATTRIBUTE 2                
         DC    A(ROWCD51),A(0)                   COMPENSATION S/P               
         DC    A(ROWCD52),A(0)                   CONTRACT END DATE              
         DC    A(ROWCD53),A(0)                   JOIN DATE                      
ROWBTABX EQU   *-1                                                              
         EJECT                                                                  
*                                                                               
*        ROUTINES TO POST ROWS FROM CONTRACT RECORD                             
*                                                                               
         SPACE                                                                  
ROWCD01  MVC   0(2,R4),RCONKREP                                                 
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD02  EQU   *                                                                
         GOTO1 =A(ROW2NMOD),DMCB,(RC)                                           
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD03  MVI   INFCODE,4                                                        
         BAS   RE,FIRSTINF                                                      
         B     *+8                                                              
ROWCD03A BAS   RE,NEXTINF                                                       
         BE    *+6                                                              
ROWCD03B DC    H'0'                                                             
         CLC   RCONKREP,DOFFREP(R5) SAME REP?                                   
         BL    ROWCD03B            NOT FOUND                                    
         BH    ROWCD03A                                                         
         CLC   RCONKOFF,DOFFOFF(R5)                                             
         BNE   ROWCD03A                                                         
         MVC   0(2,R4),DOFFRGN(R5)                                              
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD04  MVI   0(R4),0                                                          
         MVC   1(2,R4),RCONKOFF                                                 
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD05  MVC   0(2,R4),RCONTEM                                                  
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD06  MVC   0(3,R4),RCONSAL                                                  
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD07  MVC   0(2,R4),RCONKGRP                                                 
         CLI   1(R4),X'00'         SUBGROUP = BINARY ZERO?                      
         BNE   ROWCD999            NO                                           
         MVI   1(R4),C' '          YES - SET TO SPACE                           
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD08  MVC   0(4,R4),RCONKADV                                                 
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD09  EQU   *                                                                
         GOTO1 =A(ROW9NMOD),DMCB,(RC)                                           
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD10  MVC   0(4,R4),RCONKAGY                                                 
         MVC   4(2,R4),SPACES      SPACE-FILL AGY/OFFICE FIELD                  
         CLI   QWNAOFLG,C'N'       EXCLUDE AGY/OFF OFFICE?                      
         BE    ROWCD999            YES - AGY CODE ONLY                          
         MVC   4(2,R4),RCONKAOF    NO  - INSERT AGY/OFFICE OFFICE               
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD11  L     R5,ASTAEL                                                        
         MVC   0(3,R4),DSTNAFF(R5) AFFILIATE                                    
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD12  MVC   0(4,R4),RCONKCON                                                 
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD13  MVI   INFCODE,X'0F'                                                    
         BAS   RE,FIRSTINF                                                      
         B     ROWCD13B                                                         
ROWCD13A EQU   *                                                                
         BAS   RE,NEXTINF                                                       
ROWCD13B EQU   *                                                                
         BE    ROWCD13C                                                         
         MVC   0(2,R4),=C'??'      RETURN 'UNKNOWN CLASS'                       
         B     ROWCD999                                                         
ROWCD13C EQU   *                                                                
         CLC   RCONCTGY,2(R5)                                                   
         BNE   ROWCD13A                                                         
         MVC   0(2,R4),4(R5)                                                    
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD14  MVC   1(2,R4),RCONKOFF                                                 
         MVI   0(R4),1                                                          
         CLC   RCONKOFF,=C'NY'                                                  
         BE    ROWCD999                                                         
         MVI   0(R4),2                                                          
         CLC   RCONKOFF,=C'CH'                                                  
         BE    ROWCD999                                                         
         MVI   0(R4),3                                                          
         CLC   RCONKOFF,=C'LA'                                                  
         BE    ROWCD999                                                         
         MVI   0(R4),9                                                          
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD15  MVC   0(2,R4),RCONCTGY                                                 
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD17  ST    R4,AMONROW          SAVE MONTH ROW ADDR                          
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD18  ST    R4,AMONROW          SAVE CURMONTH ROW ADDR                       
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD19  ST    R4,AMONROW          SAVE ALLMONTH ROW ADDR                       
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD20  ST    R4,AMONROW          SAVE QTR ROW ADDR                            
         B     ROWCD999                                                         
         EJECT                                                                  
*                                                                               
*   FOLLOWING ROUTINE RETURNS THE STATION TYPE BASED ON JOIN/LEAVE              
*      DATES FOR A PARTICULAR STATION.  R4 POINTS TO RETURN AREA.               
*                                                                               
*   LOGIC FLOW OF STATION TYPE DETERMINATION:                                   
*      STATUS      DEFINITION                                                   
*      ------      ----------                                                   
*      3(OLD)      LEFT BEFORE REPORT REQUEST END MONTH                         
*      2(NEW)      JOINED AFTER REPORT REQUEST START MONTH                      
*      1(COMP)                                                                  
*      4(JOINED)   JOINED BEFORE MID-MONTH, REQUEST START MONTH                 
*      5(LEFT)     LEFT BEFORE MID-MONTH,   REQUEST END   MONTH                 
*                                                                               
*   EXAMPLE:   REQUEST RANGE IS JAN91 - DEC91                                   
*                                                                               
*  STAT  JOINED  LEFT      STATUS              STATUS                           
*                         9101-9112           910115-911216                     
*  ----  ------  -------  --------------      -------------                     
*  WAAA  80/1/1  91/4/16  OLD: LEFT <  9112   OLD: LEFT <  911216               
*  WBBB  90/4/3  -------  NEW: JN'D >  9101   CMP: JN'D <= 910115               
*  WCCC  79/1/1  -------  CMP: JN'D <= 9101   CMP: JN'D <= 910115               
*  WCCC  91/7/3  -------  NEW: JN'D >  9101   NEW: JN'D >  910115               
*                                                                               
*        ****** STATION TYPE ******                                             
ROWCD22  CLC   RCONKSTA,QWSTNSAV   STATION ALREADY SET?                         
         BNE   *+14                NO  - SET IT                                 
         MVC   0(1,R4),QWSTNTYP    YES - RETURN STATION TYPE                    
         B     ROWCD999                                                         
*                                                                               
         GOTO1 =A(R22STYPE)                                                     
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD23  L     R5,ASTAEL                                                        
         MVC   0(2,R4),DSTNTVB(R5)                                              
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD24  L     R5,ASTAEL                                                        
         OC    DSTNOWN(3,R5),DSTNOWN(R5)                                        
         BZ    ROWCD990            NO OWNER, DON'T POST                         
         MVC   0(3,R4),DSTNOWN(R5)                                              
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD25  MVC   0(1,R4),RCONKGRP                                                 
         MVI   1(R4),X'40'         INSERT SPACE AS SUBGROUP                     
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD29  MVC   0(1,R4),RCONRTGS                                                 
         CLI   0(R4),C'A'                                                       
         BE    ROWCD999                                                         
         CLI   0(R4),C'N'                                                       
         BE    ROWCD999                                                         
         CLI   0(R4),C'S'                                                       
         BE    ROWCD999                                                         
         CLI   0(R4),0                                                          
         BNE   ROWCD999                                                         
         MVI   0(R4),C'U'          U=NO RATING SVC                              
         B     ROWCD999   ******** FOR NOW, POST EVERYTHING*******              
*        B     ROWCD990            SVC NOT ARB, NSI OR SRC-DON'T POST           
         SPACE 2                                                                
ROWCD30  L     R5,ASTAEL           STATION MARKET RANK                          
         MVC   0(1,R4),DSTNRANK(R5)                                             
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD33  MVC   0(1,R4),RCONTYPE    CONTRACT TYPE                                
         MVI   1(R4),C' '                                                       
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD34  EQU   *                                                                
         MVC   0(3,R4),XFE         POINT PERSON                                 
         TM    RCONMODR+1,X'10'    KATZ MODIFIED CONTRACT?                      
         BNO   ROWCD34D            NO  - PROCESS AS USUAL                       
         LA    R1,RCONELEM         CONTRACT DESCRPT ELEMENT                     
         SR    R0,R0                                                            
*                                                                               
ROWCD34A CLI   0(R1),0                                                          
         BE    ROWCD999                                                         
         CLI   0(R1),X'74'         KATZ MASTER CONTRACT ELEMENT?                
         BE    *+14                YES                                          
         IC    R0,1(R1)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R1,R0                                                            
         B     ROWCD34A            GO BACK FOR NEXT                             
         OC    RCONK4PP-RCONK4EL(3,R1),RCONK4PP-RCONK4EL(R1)                    
*                                  ANYTHING IN FIELD?                           
         BZ    ROWCD999            NO                                           
         CLC   RCONK4PP-RCONK4EL(3,R1),SPACES                                   
*                                  ANYTHING IN FIELD?                           
         BE    ROWCD999            NO                                           
         MVC   0(3,R4),RCONK4PP-RCONK4EL(R1)                                    
*                                  FOUND - INSERT INTO OUTPUT                   
         B     ROWCD999            EXIT                                         
ROWCD34D EQU   *                                                                
         CLC   RCONPRD,SPACES      COMES FROM PRODUCT RECORD                    
         BNH   ROWCD999                                                         
         LA    R1,RPRDELEM         NETWORK CONTRACT ELEMENT                     
         SR    R0,R0                                                            
*                                                                               
ROWCD34M CLI   0(R1),0                                                          
         BE    ROWCD999                                                         
         CLI   0(R1),2                                                          
         BE    *+14                                                             
         IC    R0,1(R1)                                                         
         AR    R1,R0                                                            
         B     ROWCD34M                                                         
         MVC   0(3,R4),RPRDNPNT-RPRDNELM(R1)                                    
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD35  EQU   *                                                                
         MVC   0(8,R4),XFE         NETWORK CONTRACT NUMBER                      
         TM    RCONMODR+1,X'10'    KATZ MODIFIED CONTRACT?                      
         BNO   ROWCD35D            NO  - PROCESS AS USUAL                       
         LA    R1,RCONELEM         CONTRACT DESCRPT ELEMENT                     
         SR    R0,R0                                                            
*                                                                               
ROWCD35A CLI   0(R1),0                                                          
         BE    ROWCD999                                                         
         CLI   0(R1),X'74'         KATZ MASTER CONTRACT ELEMENT?                
         BE    *+14                YES                                          
         IC    R0,1(R1)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R1,R0                                                            
         B     ROWCD35A            GO BACK FOR NEXT                             
         OC    RCONK4MC-RCONK4EL(7,R1),RCONK4MC-RCONK4EL(R1)                    
*                                  ANYTHING IN FIELD?                           
         BZ    ROWCD999            NO                                           
         CLC   RCONK4MC-RCONK4EL(7,R1),SPACES                                   
*                                  ANYTHING IN FIELD?                           
         BE    ROWCD999            NO                                           
         MVC   0(7,R4),RCONK4MC-RCONK4EL(R1)                                    
*                                  FOUND - INSERT INTO OUTPUT                   
         MVI   7(R4),C' '          INSERT TRAILING SPACE                        
         B     ROWCD999            EXIT                                         
ROWCD35D EQU   *                                                                
         CLC   RCONPRD,SPACES      COMES FROM PRODUCT RECORD                    
         BNH   ROWCD999                                                         
         OC    RPRDNET#,RPRDNET#                                                
         BZ    ROWCD999                                                         
         MVC   0(8,R4),RPRDNET#                                                 
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD36  MVC   0(3,R4),XFE         BOOK                                         
         ICM   R5,15,ASAREL                                                     
         BZ    ROWCD36B                                                         
         LA    R5,RSARBKS-RSAREL(R5)  FROM SAR ELEMENT                          
         MVC   0(2,R4),=C'DR'                                                   
         MVI   2(R4),C' '                                                       
         CLC   0(2,R5),=C'DR'      TEST DIRECT RESPONSE                         
         BE    ROWCD999                                                         
         MVC   0(2,R4),1(R5)       Y/M                                          
         LA    RE,SVCLST           FIND THE PREFIX                              
*                                                                               
ROWCD36A CLI   0(RE),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   0(1,R5),3(RE)                                                    
         BE    *+12                                                             
         LA    RE,L'SVCLST(RE)                                                  
         B     ROWCD36A                                                         
         MVC   2(1,R4),1(RE)                                                    
         B     ROWCD999                                                         
*                                                                               
ROWCD36B ICM   R5,15,ABOPEL        FROM BOP ELEMENT                             
         BZ    ROWCD999                                                         
         LA    R5,RCONBBKS-RCONBPEL(R5)                                         
         LA    RE,C'1'             SORT IN ORDER -                              
         CLI   0(R5),C'W'          WINTER                                       
         BE    ROWCD36C                                                         
         LA    RE,1(RE)                                                         
         CLC   0(2,R5),=C'SP'      SPRING                                       
         BE    ROWCD36C                                                         
         LA    RE,1(RE)                                                         
         CLC   0(2,R5),=C'SU'      SUMMER                                       
         BE    ROWCD36C                                                         
         LA    RE,1(RE)                                                         
         CLI   0(R5),C'F'          FALL                                         
         BE    ROWCD36C                                                         
         LA    RE,1(RE)            THE REST                                     
*                                                                               
ROWCD36C STC   RE,0(R4)                                                         
         MVC   1(6,R4),0(R5)                                                    
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD37  MVC   0(3,R4),XFE         DAYPART                                      
         ICM   R5,15,ASAREL        FROM SAR ELEMENT                             
         BZ    ROWCD37A                                                         
         OC    RSARDPT-RSAREL(3,R5),RSARDPT-RSAREL(R5)                          
*                                  ANYTHING IN FIELD?                           
         BZ    ROWCD999            NO  - LEAVE X'FE' IN FIELD                   
         MVC   0(3,R4),RSARDPT-RSAREL(R5)                                       
         B     ROWCD999                                                         
ROWCD37A EQU   *                                                                
         ICM   R5,15,ABOPEL        OR BOP ELEMENT                               
         BZ    ROWCD999                                                         
         CLC   RCONBPTM-RCONBPEL(3,R5),SPACES                                   
         BNH   ROWCD999                                                         
         MVC   0(3,R4),RCONBPTM-RCONBPEL(R5)                                    
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD38  MVC   0(7,R4),XFE         DEMO                                         
         ICM   R5,15,ASAREL                                                     
         BZ    ROWCD38D                                                         
         LA    R5,RSARDEM-RSAREL(R5)   FROM SAR ELEMENT                         
         XC    DBLOCK,DBLOCK                                                    
         MVC   DBFILE,=C'INV'                                                   
         MVI   DBSELMED,C'T'                                                    
         L     RF,ADCONLST                                                      
         USING ADCONSD,RF                                                       
         MVC   DBCOMFCS,VCOMFACS                                                
         DROP  RF                                                               
         LA    R0,8                SET LOOP CONTROL                             
         LR    R1,R5               SAVE A(1ST DEMO)                             
*                                                                               
ROWCD38A OC    0(3,R5),0(R5)       TOP OF LOOP - ANY DEMO?                      
         BZ    ROWCD38B            NO                                           
         TM    0(R5),X'40'         YES - PRIMARY DEMO?                          
         BO    ROWCD38C            YES                                          
         LA    R5,3(R5)            NO  - SKIP TO NEXT DEMO                      
         BCT   R0,ROWCD38A         GO BACK AND TEST IT                          
ROWCD38B LR    R5,R1               NO PRIMARY - RESET A(1ST DEMO)               
         OC    0(3,R5),0(R5)       ANY DEMO THERE?                              
         BZ    ROWCD999            NO  - GET OUT                                
*                                                                               
ROWCD38C CLI   1(R5),C'T'          FUDGE FOR DEMOCON                            
         BNE   *+8                                                              
         MVI   1(R5),C'I'                                                       
         GOTO1 =V(DEMOCON),DMCB,(0,(R5)),(5,WORK),(0,DBLOCK)                    
*                                  GET DEMO NAME 5/5 (IE, W849SHARE)            
         MVC   0(5,R4),WORK        INSERT JUST DEMO CAT NAME                    
         MVI   5(R4),C' '          CLEAR NEX TO LAST POSITION OF DEMO           
         MVI   6(R4),C' '          CLEAR LAST POSITION OF DEMO                  
         B     ROWCD999                                                         
*                                                                               
ROWCD38D ICM   R5,15,ABOPEL        TRY BOP ELEMENT                              
         BZ    ROWCD999                                                         
         LA    R5,RCONBPDM-RCONBPEL(R5)                                         
         CLI   0(R5),X'FF'         VALIDATED BY DEMOVAL?                        
         BE    ROWCD38E            YES                                          
*                                                                               
*  NO  - ORIGINAL SETUP - PRE-JAN91 - PROBABLY NO ORDERS STILL ON               
*        FILE WITH THIS FORMAT. SO NO QUALIFIER-COLLAPSING CODE                 
*        INSERTED HERE.                                                         
*                                                                               
         MVC   0(7,R4),0(R5)                                                    
         LA    R0,6                                                             
         LA    R1,1(R4)                                                         
         LA    RE,5                                                             
         CLI   0(R1),C','                                                       
         BE    *+18                                                             
         LA    R1,1(R1)                                                         
         BCTR  RE,0                                                             
         BCT   R0,*-14                                                          
         B     ROWCD38F                                                         
         EX    RE,*+4                                                           
         MVC   0(0,R1),SPACES                                                   
         B     ROWCD38F                                                         
         SPACE 2                                                                
ROWCD38E EQU   *                                                                
         XC    DBLOCK,DBLOCK                                                    
         MVC   DBFILE,=C'TP '                                                   
         MVI   DBSELMED,C'R'                                                    
         L     RF,ADCONLST                                                      
         USING ADCONSD,RF                                                       
         MVC   DBCOMFCS,VCOMFACS                                                
*                                                                               
         DROP  RF                                                               
*                                                                               
         LA    R5,1(R5)            PASS THE X'FF' BYTE                          
         CLI   1(R5),C'T'          FUDGE FOR DEMOCON                            
         BNE   *+8                                                              
         MVI   1(R5),C'I'                                                       
         GOTO1 =V(DEMOCON),DMCB,(0,(R5)),(5,WORK),(0,DBLOCK)                    
*                                  GET DEMO NAME 5/5 (IE, W849SHARE)            
         MVC   0(5,R4),WORK        INSERT JUST DEMO CAT NAME                    
         MVI   5(R4),C' '          CLEAR NEX TO LAST POSITION OF DEMO           
         MVI   6(R4),C' '          CLEAR LAST POSITION OF DEMO                  
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD38F EQU   *                   STRIP OUT HYPHEN FROM DEMO NAME              
         LA    RE,6                SCAN LAST SIX CHARACTERS                     
         LA    R1,1(R4)            A(DEMO STRING - SECOND CHARACTER)            
ROWCD38G EQU   *                                                                
         CLI   0(R1),C'-'          IS CHARACTER A HYPHEN?                       
         BE    ROWCD38H            YES                                          
         LA    R1,1(R1)            BUMP A(CHARACTER)                            
         BCT   RE,ROWCD38G                                                      
         B     ROWCD999            FINISHED                                     
ROWCD38H EQU   *                                                                
         LA    R2,1(R1)            SET R2 PAST HYPHEN                           
         BCTR  RE,0                -1 FROM REMAINING LEN                        
         EX    RE,ROWCD38J         MOVE CHARS OVER HYPHEN                       
         MVI   6(R4),C' '          SET LAST CHARACTER TO SPACE                  
         B     ROWCD999                                                         
*                                                                               
ROWCD38J MVC   0(0,R1),0(R2)       MOVE TRAILING CHARS OVER '-'                 
         SPACE 2                                                                
ROWCD39  L     R5,ASTAEL           MARKET CODE                                  
         MVC   0(4,R4),XFE                                                      
         CLC   DSTNMKT(4,R5),SPACES                                             
         BNH   ROWCD999                                                         
         MVC   0(4,R4),DSTNMKT(R5)                                              
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD40  MVC   0(2,R4),RCONKREP    COMPANY CODE                                 
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD41  MVC   0(6,R4),XFE         DAYPART                                      
         ICM   R5,15,ASAREL        FROM SAR ELEMENT                             
         BZ    ROWCD41E                                                         
         XC    DUB,DUB             SET UP WORK AREA                             
         LA    R5,RSARXDPT-RSARXEL(R5)                                          
         OC    0(6,R5),0(R5)       ANY DAYPARTS?                                
         BZ    ROWCD999            NO  - LEAVE AS X'FE'                         
         LA    RF,6                                                             
         LA    R1,DUB                                                           
ROWCD41A EQU   *                                                                
         CLI   0(R5),0             ANY DAYPART?                                 
         BZ    ROWCD41B            NO  - FINISHED                               
         MVC   0(1,R1),0(R5)       MOVE DAYPART CODE TO WORKAREA                
         LA    R1,1(R1)            INCREMENT A(WORKAREA)                        
         LA    R5,3(R5)            INCREMENT A(SAR ELEMENT)                     
         BCT   RF,ROWCD41A         GO BACK FOR NEXT                             
ROWCD41B EQU   *                                                                
         MVC   0(6,R4),DUB         MOVE 1ST 6 DYPTS FROM WORKAREA               
         B     ROWCD999                                                         
ROWCD41E EQU   *                                                                
         ICM   R5,15,ABOPEL        OR BOP ELEMENT                               
         BZ    ROWCD999                                                         
         CLC   RCONBPTM-RCONBPEL(3,R5),SPACES                                   
         BNH   ROWCD999                                                         
         MVC   0(3,R4),RCONBPTM-RCONBPEL(R5)                                    
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD42  MVC   0(6,R4),RCONDATE    FLIGHT DATES                                 
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD43  EQU   *                                                                
         MVC   0(8,R4),RCONBUYR    LOAD 1ST EIGHT CHARS                         
         B     ROWCD999                                                         
*                                                                               
*                                                                               
*   FOLLOWING CODE INSERTS BUYER NAME INTO A TABLE (MAX ENTRIES:                
*     10K), AND PASSES A COUNT BACK IN THE ROW FIELD.  THE COUNT                
*     IS THEN USED IN RERG03 TO ACCESS THE TABLE, AND RETRIEVE THE              
*     NAME.   THIS IS DEACTIVATED, BECAUSE COMMENT CANNOT BE TABLED,            
*     AND MUST BE DERIVED FROM THE CONTRACT RECORD ITSELF.  SO....              
*                                                                               
*        L     RF,ABUYNAMS         A(BUYER'S NAME TABLE)                        
*        LA    RE,1                INITIALIZE COUNTER                           
*ROWCD43A EQU   *                                                               
*         OC    0(20,RF),0(RF)      ANY ENTRY IN SLOT?                          
*         BZ    ROWCD43B            NO  - LOAD NAME, USE COUNT                  
*         CLC   RCONBUYR,0(RF)      BUYER IN TABLE?                             
*         BE    ROWCD43C            YES - USE COUNT                             
*         CH    RE,=H'10000'        10000 ENTRIES IN TABLE?                     
*         BH    ROWCD43C            YES - DON'T ALLOW MORE                      
*         LA    RE,1(RE)            NO  - TRY NEXT ENTRY                        
*         LA    RF,20(RF)                                                       
*         B     ROWCD43A            GO BACK FOR NEXT                            
*ROWCD43B EQU   *                                                               
*         MVC   0(20,RF),RCONBUYR   LOAD NAME                                   
*ROWCD43C EQU   *                                                               
*         ST    RE,DUB              USE COUNT                                   
*         MVC   0(4,R4),DUB         AGENCY BUYER COUNT                          
*         B     ROWCD999                                                        
         SPACE 2                                                                
ROWCD44  EQU   *                                                                
         MVC   0(3,R4),XFE         DEVELOPMENTAL SALESPERSON                    
         LA    R1,RCONELEM         ONLY ACCEPT IF X'18' ELEMENT                 
         SR    R0,R0                  IN CONTRACT RECORD                        
*                                                                               
ROWCD44A CLI   0(R1),0             END OF RECORD?                               
         BE    ROWCD990            YES - NO DEV ELT - DON'T POST                
         CLI   0(R1),X'18'         DEVELOPMENTAL ELEMENT?                       
         BE    ROWCD44B            YES                                          
         IC    R0,1(R1)                                                         
         AR    R1,R0                                                            
         B     ROWCD44A                                                         
ROWCD44B EQU   *                                                                
         MVC   0(3,R4),RCONDVSP-RCONDVEL(R1)                                    
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD45  EQU   *                                                                
                                                                                
         MVC   0(2,R4),=C'**'      DEFAULT IF 'ALL COLS'                        
****>>>> MVC   0(2,R4),XFE         DEVELOPMENTAL CONTRACT TYPE                  
         LA    R1,RCONELEM         ONLY ACCEPT IF X'18' ELEMENT                 
         SR    R0,R0                  IN CONTRACT RECORD                        
*                                                                               
ROWCD45A CLI   0(R1),0             END OF RECORD?                               
         BE    ROWCD999            YES - NO DEV ELT - DON'T POST                
         CLI   0(R1),X'18'         DEVELOPMENTAL ELEMENT?                       
         BE    ROWCD45B            YES                                          
         IC    R0,1(R1)                                                         
         AR    R1,R0                                                            
         B     ROWCD45A                                                         
ROWCD45B EQU   *                                                                
         OC    RCONDVCT-RCONDVEL(2,R1),RCONDVCT-RCONDVEL(R1)                    
*                                  ANY DEV CONTYPE IN FIELD?                    
         BZ    ROWCD999            NO  - LEAVE AS DEFAULT                       
         MVC   0(2,R4),RCONDVCT-RCONDVEL(R1)                                    
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD46  EQU   *                                                                
*                                  EMPTY ROW:  DON'T INSERT A VALUE             
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD47  MVC   0(4,R4),RCONKAGY                                                 
         MVC   4(2,R4),SPACES      SPACE-FILL AGY/OFFICE FIELD                  
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD48  EQU   *                                                                
         LA    RF,RCONELEM         SET A(1ST ELEMENT IN CONTRACT)               
ROWCD48A EQU   *                                                                
         CLI   0(RF),0             END OF RECORD?                               
         BNE   *+6                 NO                                           
         DC    H'0'                YES - ELEMENT MUST BE PRESENT                
         CLI   0(RF),X'5F'         BUYLINE CODE TEMPORARY ELT?                  
         BE    ROWCD48B            YES                                          
         ZIC   RE,1(RF)            NO  - BUMP TO NEXT ELEMENT                   
         AR    RF,RE                                                            
         B     ROWCD48A            GO BACK FOR NEXT ELT                         
ROWCD48B EQU   *                                                                
         MVC   0(3,R4),2(RF)       MOVE BUYCODE                                 
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD49  EQU   *                                                                
         LA    RF,RCONELEM         SET A(1ST ELEMENT IN CONTRACT)               
ROWCD49A EQU   *                                                                
         CLI   0(RF),0             END OF RECORD?                               
         BNE   *+6                 NO                                           
         DC    H'0'                YES - ELEMENT MUST BE PRESENT                
         CLI   0(RF),X'5F'         BUYLINE CODE TEMPORARY ELT?                  
         BE    ROWCD49B            YES                                          
         ZIC   RE,1(RF)            NO  - BUMP TO NEXT ELEMENT                   
         AR    RF,RE                                                            
         B     ROWCD49A            GO BACK FOR NEXT ELT                         
ROWCD49B EQU   *                                                                
         MVC   0(2,R4),5(RF)       MOVE ATTRIBUTE 1                             
         CLC   0(2,R4),SPACES      ANY VALUE THERE?                             
         BH    ROWCD999            YES - LEAVE AS IS                            
         MVC   0(2,R4),=C'**'      NO  - FORCE A DEFAULT                        
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD50  EQU   *                                                                
         LA    RF,RCONELEM         SET A(1ST ELEMENT IN CONTRACT)               
ROWCD50A EQU   *                                                                
         CLI   0(RF),0             END OF RECORD?                               
         BNE   *+6                 NO                                           
         DC    H'0'                YES - ELEMENT MUST BE PRESENT                
         CLI   0(RF),X'5F'         BUYLINE CODE TEMPORARY ELT?                  
         BE    ROWCD50B            YES                                          
         ZIC   RE,1(RF)            NO  - BUMP TO NEXT ELEMENT                   
         AR    RF,RE                                                            
         B     ROWCD50A            GO BACK FOR NEXT ELT                         
ROWCD50B EQU   *                                                                
         MVC   0(2,R4),7(RF)       MOVE ATTRIBUTE 2                             
         CLC   0(2,R4),SPACES      ANY VALUE THERE?                             
         BH    ROWCD999            YES - LEAVE AS IS                            
         MVC   0(2,R4),=C'**'      NO  - FORCE A DEFAULT                        
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD51  EQU   *                                                                
         LA    RF,RCONELEM         SET A(1ST ELEMENT IN CONTRACT)               
ROWCD51A EQU   *                                                                
         CLI   0(RF),0             END OF RECORD?                               
         BE    ROWCD51C            YES - USE S/P OF RECORD                      
         CLI   0(RF),X'1E'         RANDOM FLAG ELEMENT?                         
         BE    ROWCD51B            YES                                          
         ZIC   RE,1(RF)            NO  - BUMP TO NEXT ELEMENT                   
         AR    RF,RE                                                            
         B     ROWCD51A            GO BACK FOR NEXT ELT                         
ROWCD51B EQU   *                                                                
         CLC   RCONRPSP-RCONRFEL(5,RF),SPACES                                   
*                                  ANY VALUE IN 1E ELEMENT?                     
         BNH   ROWCD51C            NO  - SET DEFAULT                            
         MVC   0(3,R4),RCONRPSP-RCONRFEL(RF)                                    
*                                  LOAD COMP S/P                                
         MVI   3(R4),C'/'          INSERT SEPARATOR                             
         MVC   4(2,R4),RCONRPSP-RCONRFEL+3(RF)                                  
*                                  LOAD OFFICE CODE                             
         CLC   0(5,R4),SPACES      ANY VALUE THERE?                             
         BH    ROWCD999            YES - LEAVE AS IS                            
ROWCD51C EQU   *                                                                
         MVC   0(3,R4),RCONSAL     NO  - USE THE S/P CODE                       
         MVI   3(R4),C'/'          INSERT SEPARATOR                             
         MVC   4(2,R4),RCONKOFF        - USE THE S/P OFFICE CODE                
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD52  EQU   *                                                                
         GOTO1 =A(CONENDTE),DMCB,(RC)                                           
         MVC   0(8,R4),DUB                                                      
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD53  EQU   *                                                                
         GOTO1 =A(CONJOINS),DMCB,(RC)                                           
         MVC   0(8,R4),DUB                                                      
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWCD990 LTR   RB,RB               SKIP THIS REPORT - CC NE 0                   
         BR    R9                                                               
*                                                                               
ROWCD999 CR    RB,RB               OK - CC EQ 0                                 
         BR    R9                                                               
         EJECT                                                                  
*                                                                               
*        ROUTINES TO POST ROWS FROM BUDGET RECORD                               
*                                                                               
         SPACE                                                                  
ROWBD01  MVC   0(2,R4),RBUDKREP                                                 
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD03  OC    RBUDKTEM,RBUDKTEM                                                
         BZ    ROWCD990            OFFICE = ZERO, DON'T POST REGION             
         MVI   INFCODE,4 ** FIND OFFICE ENTRIES **                              
         BAS   RE,FIRSTINF                                                      
         B     *+8                                                              
         BAS   RE,NEXTINF                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         CLC   RBUDKTEM,DOFFOFF(R5)                                             
         BNE   *-16                                                             
         MVC   0(2,R4),DOFFRGN(R5)                                              
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD04  MVI   0(R4),0                                                          
         MVC   1(2,R4),RBUDKTEM                                                 
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD05  EQU   *                                                                
         MVC   0(2,R4),SPACES                                                   
         CLC   =C'C*MP',RBUDKSTA   COMPANY BUDGET RECORD?                       
         BNE   ROWBD05A            NO                                           
*                                  YES                                          
         MVI   0(R4),C'T'          NOTE - RADIO HAS NO BUDGETS                  
         B     ROWCD999                                                         
ROWBD05A EQU   *                                                                
         OC    RBUDKTEM,RBUDKTEM                                                
         BZ    ROWCD999                                                         
         CLC   RBUDKTEM,=C'NY'                                                  
         BE    ROWBD05D                                                         
         CLC   RBUDKTEM,=C'CH'                                                  
         BE    ROWBD05D                                                         
         MVI   0(R4),C'T'          NOTE - RADIO HAS NO BUDGETS                  
         B     ROWCD999                                                         
*                                                                               
ROWBD05D MVI   INFCODE,2                                                        
         BAS   RE,FIRSTINF                                                      
         B     *+8                                                              
ROWBD06  BAS   RE,NEXTINF                                                       
         BE    *+6                                                              
ROWBD06A DC    H'0'                                                             
         CLC   RBUDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   ROWBD06                                                          
         CLC   RBUDKSTA,DSTNCALL(R5)                                            
         BNE   ROWBD06                                                          
         MVC   0(2,R4),DSTNNYTM(R5) NY TEAM CODE                                
         CLC   RBUDKTEM,=C'NY'                                                  
         BE    ROWCD999                                                         
         MVC   0(2,R4),DSTNCHTM(R5) CH TEAM CODE                                
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD07  EQU   *                                                                
         CLC   =C'C*MP',RBUDKSTA   COMPANY BUDGET RECORD?                       
         BNE   ROWBD07A            NO                                           
         MVC   0(2,R4),QWREQ+QGROUP-QRECORD                                     
*                                  YES - USE GRP/SUBGRP FROM CARD               
         CLI   1(R4),X'00'         SUBGROUP = BINARY ZERO?                      
         BNE   ROWCD999            NO  - LEAVE AS IS                            
         MVI   1(R4),X'40'         YES - SET TO SPACE                           
         B     ROWCD999                                                         
ROWBD07A MVI   INFCODE,2                                                        
         BAS   RE,FIRSTINF                                                      
         B     *+8                                                              
ROWBD07C BAS   RE,NEXTINF                                                       
         BE    *+6                                                              
ROWBD07F DC    H'0'                                                             
         CLC   RBUDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   ROWBD07C                                                         
         CLC   RBUDKSTA,DSTNCALL(R5)                                            
         BNE   ROWBD07C                                                         
         MVC   0(2,R4),DSTNGRP(R5)                                              
         CLI   1(R4),X'00'         SUBGROUP = BINARY ZERO?                      
         BNE   ROWCD999            NO  - LEAVE AS IS                            
         MVI   1(R4),X'40'         YES - SET TO SPACE                           
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD11  EQU   *                                                                
         CLC   =C'C*MP',RBUDKSTA   COMPANY BUDGET RECORD?                       
         BNE   ROWBD11Z                                                         
         MVC   0(2,R4),=X'FFFF'    YES - STUFF 'BUDGET ROW' FLAG                
         MVC   2(6,R4),=C'BUDGET'                                               
         MVI   RGROWSZ-1(R4),1                                                  
         B     ROWCD999                                                         
ROWBD11Z MVI   INFCODE,2                                                        
         BAS   RE,FIRSTINF                                                      
         B     *+8                                                              
ROWBD11A BAS   RE,NEXTINF                                                       
         BE    *+6                                                              
ROWBD11B DC    H'0'                                                             
         CLC   RBUDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   ROWBD11A                                                         
         CLC   RBUDKSTA,DSTNCALL(R5)                                            
         BNE   ROWBD11A                                                         
         MVC   0(3,R4),DSTNAFF(R5) AFFILIATE                                    
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD14  MVC   1(2,R4),RBUDKTEM                                                 
         MVI   0(R4),1                                                          
         CLC   RBUDKTEM,=C'NY'                                                  
         BE    ROWCD999                                                         
         MVI   0(R4),2                                                          
         CLC   RBUDKTEM,=C'CH'                                                  
         BE    ROWCD999                                                         
         MVI   0(R4),3                                                          
         CLC   RBUDKTEM,=C'LA'                                                  
         BE    ROWCD999                                                         
         MVI   0(R4),9                                                          
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD17  ST    R4,AMONROW          SAVE MONTH ROW ADDR                          
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD18  ST    R4,AMONROW          SAVE CURMONTH ROW ADDR                       
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD19  ST    R4,AMONROW          SAVE ALLMONTH ROW ADDR                       
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD20  ST    R4,AMONROW          SAVE QTR ROW ADDR                            
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD22  EQU   *                                                                
         CLC   =C'C*MP',RBUDKSTA   COMPANY BUDGET RECORD?                       
         BNE   ROWBD22Z                                                         
         MVC   0(2,R4),=X'FFFF'    YES - STUFF 'BUDGET ROW' FLAG                
         MVC   2(6,R4),=C'BUDGET'                                               
         MVI   RGROWSZ-1(R4),1                                                  
         B     ROWCD999                                                         
ROWBD22Z EQU   *                                                                
         CLC   RCONKSTA,QWSTNSAV   STNTYPE                                      
         BNE   *+14                                                             
         MVC   0(1,R4),QWSTNTYP    ALREADY HAVE STATION TYPE                    
         B     ROWCD999                                                         
         MVC   QWSTNSAV,RCONKSTA                                                
         MVI   INFCODE,2                                                        
         BAS   RE,FIRSTINF                                                      
         B     *+8                                                              
RBD22A   BAS   RE,NEXTINF                                                       
         BE    *+6                                                              
RBD22B   DC    H'0'                                                             
         CLC   RBUDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   RBD22A                                                           
         CLC   RBUDKSTA,DSTNCALL(R5)                                            
         BNE   RBD22A                                                           
         MVC   WORK(4),=X'0000FFFF'                                             
         OC    DSTNSTRT(3,R5),DSTNSTRT(R5)   START DATE                         
         BZ    ROWBD22B                                                         
         GOTO1 DATCON,DMCB,(3,DSTNSTRT(R5)),WORK+6                              
         GOTO1 GETBROAD,(R1),WORK+6,WORK+12                                     
         CLC   WORK+6,WORK+12                                                   
         BE    ROWBD22A           STARTED ON 1ST DAY OF BROADCAST MONTH         
         MVC   WORK+12(6),WORK+18  ELSE GO TO NEXT MONTH                        
         GOTO1 ADDAY,DMCB,WORK+12,WORK+18,15                                    
*                                                                               
ROWBD22A GOTO1 DATCON,DMCB,WORK+18,(3,WORK)                                     
         MVI   WORK+2,X'FF'        WORK(2) HAS FIRST MONTH                      
*                                                                               
ROWBD22B OC    DSTNEND(3,R5),DSTNEND(R5)     END DATE                           
         BZ    ROWBD22D                                                         
         GOTO1 DATCON,DMCB,(3,DSTNEND(R5)),WORK+6                               
         GOTO1 GETBROAD,DMCB,WORK+6,WORK+12                                     
         CLC   WORK+6(6),WORK+18                                                
         BE    ROWBD22C            ENDED ON LAST DAY OF BROADCAST MONTH         
         L     R5,=F'-15'           ELSE GO TO PREVIOUS MONTH                   
         GOTO1 ADDAY,DMCB,WORK+12,WORK+18,(R5)                                  
*                                                                               
ROWBD22C GOTO1 DATCON,DMCB,WORK+18,(3,WORK+2)  WORK+2(2) HAS LAST MONTH         
*                                                                               
ROWBD22D MVI   0(R4),C'3'          OLD                                          
         CLC   WORK+2(2),QWCURND   LOST BEFORE LAST REQUEST MONTH               
         BL    ROWBD22E                                                         
         MVI   0(R4),C'2'          NEW                                          
         CLC   WORK(2),QWPRIST     STARTED AFTER FIRST PRIOR MONTH              
         BH    ROWBD22E                                                         
         MVI   0(R4),C'1'          ELSE COMPARABLE                              
*                                                                               
ROWBD22E MVC   QWSTNTYP,0(R4)                                                   
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD23  EQU   *                                                                
         CLC   =C'C*MP',RBUDKSTA   COMPANY BUDGET RECORD?                       
         BNE   ROWBD23Z                                                         
         MVC   0(2,R4),=X'FFFF'    YES - STUFF 'BUDGET ROW' FLAG                
         MVC   2(6,R4),=C'BUDGET'                                               
         MVI   RGROWSZ-1(R4),1                                                  
         B     ROWCD999                                                         
ROWBD23Z EQU   *                                                                
         MVI   INFCODE,2                                                        
         BAS   RE,FIRSTINF                                                      
         B     *+8                                                              
ROWBD23A BAS   RE,NEXTINF                                                       
         BE    *+6                                                              
ROWBD23B DC    H'0'                                                             
         CLC   RBUDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   ROWBD23A                                                         
         CLC   RBUDKSTA,DSTNCALL(R5)                                            
         BNE   ROWBD23A                                                         
         MVC   0(2,R4),DSTNTVB(R5)      TVB REGION                              
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD24  EQU   *                                                                
         CLC   =C'C*MP',RBUDKSTA   COMPANY BUDGET RECORD?                       
         BNE   ROWBD24Z                                                         
         MVC   0(2,R4),=X'FFFF'    YES - STUFF 'BUDGET ROW' FLAG                
         MVC   2(6,R4),=C'BUDGET'                                               
         MVI   RGROWSZ-1(R4),1                                                  
         B     ROWCD999                                                         
ROWBD24Z EQU   *                                                                
         MVI   INFCODE,2                                                        
         BAS   RE,FIRSTINF                                                      
         B     *+8                                                              
ROWBD24A BAS   RE,NEXTINF                                                       
         BE    *+6                                                              
ROWBD24B DC    H'0'                                                             
         CLC   RBUDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   ROWBD24A                                                         
         CLC   RBUDKSTA,DSTNCALL(R5)                                            
         BNE   ROWBD24A                                                         
         OC    DSTNOWN(3,R5),DSTNOWN(R5)                                        
         BZ    ROWCD990            NO OWNER, DON'T POST                         
         MVC   0(3,R4),DSTNOWN(R5)      OWNER                                   
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD25  EQU   *                                                                
         CLC   =C'C*MP',RBUDKSTA   COMPANY BUDGET RECORD?                       
         BNE   ROWBD25Z                                                         
         MVC   0(2,R4),QWREQ+QGROUP-QRECORD                                     
*                                  YES - USE GRP/SUBGRP FROM CARD               
         CLI   1(R4),X'00'         SUBGROUP = BINARY ZERO?                      
         BNE   ROWCD999            NO  - LEAVE AS IS                            
         MVI   1(R4),X'40'         YES - SET TO SPACE                           
         B     ROWCD999                                                         
ROWBD25Z EQU   *                                                                
         MVI   INFCODE,2                                                        
         BAS   RE,FIRSTINF                                                      
         B     *+8                                                              
ROWBD25A BAS   RE,NEXTINF                                                       
         BE    ROWBD25C            ***                                          
ROWBD25B MVI   0(R4),C'T'          *** TEMPORARY FIX FOR WTCN                   
         B     ROWCD999            ***                                          
ROWBD25C EQU   *                                                                
         CLC   RBUDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   ROWBD25A                                                         
         CLC   RBUDKSTA,DSTNCALL(R5)                                            
         BNE   ROWBD25A            ***                                          
         MVC   0(1,R4),DSTNGRP(R5)  GROUP                                       
         CLI   1(R4),X'00'         SUBGROUP = BINARY ZERO?                      
         BNE   ROWCD999            NO  - LEAVE AS IS                            
         MVI   1(R4),X'40'         YES - SET TO SPACE                           
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD33  EQU   *                                                                
         GOTO1 =A(R33CTYP)                                                      
*                                  LOOK FOR NEXT CONTRACT TYPE                  
         BNZ   ROWCD990            NONE FOUND - SKIP REPORT                     
         MVC   0(1,R4),CTYPBACK    LOAD TYPE TO ROW SPEC                        
         MVI   1(R4),C' '                                                       
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD39  EQU   *                                                                
         CLC   =C'C*MP',RBUDKSTA   COMPANY BUDGET RECORD?                       
         BNE   ROWBD39Z            NO                                           
         MVC   0(4,R4),=X'FFFFFFFF'                                             
*                                  YES - FORCE HIGH-MARKET NUMBER               
         B     ROWCD999                                                         
ROWBD39Z EQU   *                                                                
         MVI   INFCODE,2           MARKET CODE                                  
         BAS   RE,FIRSTINF                                                      
         B     *+8                                                              
ROWBD39A BAS   RE,NEXTINF                                                       
         BE    *+6                                                              
ROWBD39B DC    H'0'                                                             
         CLC   RBUDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   ROWBD39A                                                         
         CLC   RBUDKSTA,DSTNCALL(R5)                                            
         BNE   ROWBD39A                                                         
         MVC   0(4,R4),DSTNMKT(R5)                                              
         B     ROWCD999                                                         
         SPACE 2                                                                
ROWBD40  MVC   0(2,R4),RBUDKREP    COMPANY CODE                                 
         B     ROWCD999                                                         
         SPACE 2                                                                
         EJECT                                                                  
*                                                                               
*        ROUTINE TO FIND INFORMATION ELEMENT FROM INFO POOL                     
*              INPUT:  INFCODE = ELEMENT CODE                                   
*              OUTPUT: R5      = A(ELEMENT)                                     
*                                                                               
         SPACE                                                                  
FIRSTINF L     R5,ASPACND4                                                      
*                                                                               
FI010    CLI   0(R5),0                                                          
         BE    FI999                                                            
         CLC   INFCODE,0(R5)                                                    
         BER   RE                                                               
*                                                                               
NEXTINF  SR    R0,R0                                                            
         ICM   R0,1,1(R5)                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R5,R0                                                            
         B     FI010                                                            
*                                                                               
FI999    LTR   RE,RE                                                            
         BR    RE                                                               
         EJECT                                                                  
         LTORG                                                                  
         SPACE 2                                                                
         EJECT                                                                  
****>>>>                                                                        
*                                                                               
*   R22STYPE:    SET STATION TYPE                                               
*                                                                               
*                                                                               
R22STYPE NMOD1 0,*R22S*                                                         
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED THROUGH - DON'T CHANGE IT                      
*                                                                               
                                                                                
         MVC   QWSTNSAV,RCONKSTA   SET STATION CALL LETTERS                     
         L     R5,ASTAEL                                                        
         MVC   WORK(6),=X'000000FFFFFF'                                         
         OC    DSTNSTRT(3,R5),DSTNSTRT(R5) ANY START (JOINED) DATE?             
         BZ    R22S0040                    NO  - CHECK END (LEFT) DATE          
*                                                                               
*   KATZ DATE TEST:  THEY HAD A CONVERTED DATE OF AUG61/95.  THIS               
*        TEST WILL SKIP GROSSLY DISTORTED DATES.                                
         CLI   DSTNSTRT+1(R5),1    MON < 1?                                     
         BL    R22S0040            YES - SKIP THIS DATE                         
         CLI   DSTNSTRT+1(R5),12   MON > 12?                                    
         BH    R22S0040            YES - SKIP THIS DATE                         
         CLI   DSTNSTRT+2(R5),1    DAY < 1?                                     
         BL    R22S0040            YES - SKIP THIS DATE                         
         CLI   DSTNSTRT+2(R5),31   DAY > 31?                                    
         BH    R22S0040            YES - SKIP THIS DATE                         
*                                                                               
         GOTO1 DATCON,DMCB,(3,DSTNSTRT(R5)),WORK+6                              
*                                                                               
         GOTO1 GETBROAD,(R1),WORK+6,WORK+12                                     
*                                                                               
         CLC   WORK+6(6),WORK+12       JOINED 1ST DAY OF BDCST MONTH?           
         BE    R22S0020                YES - USE YEAR/MONTH                     
         MVC   WORK+12(6),WORK+18      NO  - GO TO NEXT MONTH                   
*                                                                               
         GOTO1 ADDAY,DMCB,WORK+12,WORK+18,15                                    
*                                                                               
R22S0020 EQU   *                                                                
*                                                                               
*   CONVERT END DATE OF BROADCAST MONTH FROM YYMMDD (EBCDIC) TO                 
*     YMD (BINARY) FORMAT.                                                      
*                                                                               
         GOTO1 DATCON,DMCB,WORK+18,(3,WORK)                                     
*                                            WORK(3) WILL CONTAIN START         
*                                            DATE IN FORMAT = YMD               
         MVI   WORK+2,16                     SET START DAY TO 16TH              
*                                                                               
R22S0040 OC    DSTNEND(3,R5),DSTNEND(R5)     ANY END (LEFT) DATE?               
         BZ    R22S0080                      NO                                 
*                                                                               
*   KATZ DATE TEST:  THEY HAD A CONVERTED DATE OF AUG61/95.  THIS               
*        TEST WILL SKIP GROSSLY DISTORTED DATES.                                
         CLI   DSTNEND+1(R5),1     MON < 1?                                     
         BL    R22S0080            YES - SKIP THIS DATE                         
         CLI   DSTNEND+1(R5),12    MON > 12?                                    
         BH    R22S0080            YES - SKIP THIS DATE                         
         CLI   DSTNEND+2(R5),1     DAY < 1?                                     
         BL    R22S0080            YES - SKIP THIS DATE                         
         CLI   DSTNEND+2(R5),31    DAY > 31?                                    
         BH    R22S0080            YES - SKIP THIS DATE                         
*                                                                               
*                                                                               
         GOTO1 DATCON,DMCB,(3,DSTNEND(R5)),WORK+6                               
*                                                                               
         GOTO1 GETBROAD,DMCB,WORK+6,WORK+12                                     
*                                                                               
         CLC   WORK+6(6),WORK+18         LEFT LAST DAY OF BDCST MONTH?          
         BE    R22S0060                  YES - USE YEAR/MONTH                   
         L     RF,=F'-15'                NO  - GO TO PREVIOUS MONTH             
*                                                                               
         PRINT GEN                                                              
         GOTO1 ADDAY,DMCB,WORK+12,WORK+18,(RF)                                  
         PRINT NOGEN                                                            
*                                                                               
R22S0060 EQU   *                                                                
*                                                                               
         GOTO1 DATCON,DMCB,WORK+18,(3,WORK+3)                                   
*                                         WORK+3(3) WILL CONTAIN END            
*                                         DATE IN FORMAT = YMD                  
         MVI   WORK+5,15                  SET START DAY TO 16TH                 
*                                                                               
R22S0080 EQU   *                                                                
         MVI   QWSTNTY2,C'0'       INITIALIZE NEW STATION TYPES                 
         MVI   0(R4),C'3'          OLD                                          
         CLC   WORK+3(2),QWCURND   LOST BEFORE LAST REQUEST MONTH               
         BL    R22S0100            TEST FOR LEFT BEFORE 16TH                    
         MVI   0(R4),C'2'          NEW                                          
         CLC   WORK(2),QWPRIST     STARTED AFTER FIRST PRIOR MONTH              
         BH    R22S0100            TEST FOR JOINED AFTER 15TH                   
         MVI   0(R4),C'1'          ELSE COMPARABLE                              
R22S0100 EQU   *                                                                
         OC    DSTNEND(3,R5),DSTNEND(R5)     ANY STATION END   DATE?            
         BZ    R22S0120                      NO  - SKIP CUTOFF TESTS            
         MVC   WORK+6(2),QWCURND             SET REQUEST END MONTH              
*                                                                               
         CLC   DSTNEND(2,R5),WORK+6          LEFT BEFORE REQUEST END?           
         BH    R22S0120                      NO                                 
         MVC   WORK+6(2),QWCURST             SET REQUEST START MONTH            
*                                                                               
         CLC   DSTNEND(2,R5),WORK+6          LEFT AFTER REQUEST START?          
         BL    R22S0120                      NO                                 
                                                                                
         MVI   QWSTNTY2,C'5'                 SET 'LEFT/OLD' FLAG                
         B     R22S0140                                                         
R22S0120 EQU   *                                                                
         OC    DSTNSTRT(3,R5),DSTNSTRT(R5)   ANY STATION START DATE?            
         BZ    R22S0140                      NO  - SKIP CUTOFF TESTS            
         MVC   WORK+6(2),QWCURST             SET REQUEST START MONTH            
         CLC   DSTNSTRT(2,R5),WORK+6         JOINED AFTER CUTOFF MONTH?         
         BL    R22S0140                      NO                                 
         MVI   QWSTNTY2,C'4'                 SET 'JOINED/NEW' FLAG              
*                                                                               
R22S0140 MVC   QWSTNTYP,0(R4)                                                   
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
****>>>>                                                                        
*                                                                               
*                                                                               
*   SEQUENTIALLY, OR SELECTIVELY, PUTS OUT CONTRACT TYPE FOR CONTRACT           
*     TYPE ROW SPEC.  APPLIES CONTRACT TYPE FILTER AS NEEDED                    
*                                                                               
R33CTYP  NMOD1 0,*R33C*                                                         
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED THROUGH - DON'T CHANGE IT                      
*                                                                               
         XC    CTYPBACK,CTYPBACK                                                
         LA    R4,RBUDREC          A(RECORD)                                    
         ZICM  R3,RBUDLEN,2        L(RECORD)                                    
         AR    R4,R3               A(END OF RECORD)                             
         BCTR  R4,0                SUBTRACT 1 FOR A(EOR)                        
         SR    R6,R6               SET UP COUNTER                               
         MVC   HALF(1),QCONTYPE    ESTABLISH INCL/EXCL TYPE                     
         OC    HALF(1),=X'40'      SET UPPER CASE BIT                           
*   'HALF' IS USED FOR TEMPORARY STORAGE                                        
         LA    R1,RBUDELEM         ESTABLISH A(01 ELEMENT)                      
*                                                                               
* NOTE:  FIRST LOOP BYPASSES THE '01' ELEMENT                                   
*                                                                               
R33008   EQU   *                                                                
         ZIC   R3,1(R1)            CALCULATE A(NEXT ELEMENT)                    
         AR    R1,R3               A(ELEMENT) + L(ELEMENT)                      
         CLI   0(R3),X'00'         END OF RECORD? X'00' ELT                     
         BE    R33097              YES - NO ELEMENT - EXIT                      
         CR    R4,R1               END OF RECORD? LENGTH                        
         BNH   R33097              YES - NO ELEMENT - EXIT                      
         CLI   0(R1),X'02'         '02' ELEMENT?                                
         BNE   R33008              NO  - GET NEXT                               
         LA    R6,1(R6)            BUMP ELEMENT COUNTER                         
         ZIC   RE,CTYPDONE         WHICH ELEMENT ARE WE DOING?                  
         CR    RE,R6               ELEMENT COUNTER CHECK                        
         BNE   R33008              NOT THIS ONE                                 
         CLI   QCONTYPE,C' '       ANY TYPE ENTERED: SPACE                      
         BE    R33098              NO  - ACCEPT THIS ELEMENT                    
         CLI   QCONTYPE,X'00'      ANY TYPE ENTERED: LOW VALUE                  
         BE    R33098              NO  - ACCEPT THIS ELEMENT                    
         TM    QCONTYPE,X'40'      TYPE ENTERED: INCL OR EXCL?                  
         BNO   R33010              OFF: LOWER CASE - EXCL TYPE                  
         CLC   HALF(1),DISPCTYP(R1)     ON: TEST TYPE FOR INCLUDE               
         BNE   R33097                   NOT EQUAL - IGNORE IT                   
         B     R33098                   EQUAL - USE IT                          
R33010   EQU   *                                                                
         CLC   HALF(1),DISPCTYP(R1)     OFF: TEST FOR EXCLUSION                 
         BE    R33097                   EQUAL - IGNORE IT                       
         B     R33098                   NOT EQUAL - USE IT                      
R33097   EQU   *                                                                
         LTR   RB,RB               SET CC NOT = ZERO: NO VALUE                  
         B     R33099              EXIT                                         
R33098   EQU   *                                                                
         MVC   CTYPBACK,DISPCTYP(R1)    PASS VALUE BACK                         
         CR    RB,RB               SET CC = ZERO: VALUE                         
R33099   EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***>>>>  CONENDTE/CONJOINS                                                      
CONENDTE NMOD1 0,*CONENDTE*                                                     
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED THROUGH - DON'T CHANGE IT                      
*                                                                               
         L     R5,FRST2            POINT TO FIRST STATION ELEMENT               
CEND0010 EQU   *                                                                
         CLI   0(R5),2             STATION RECORD                               
         BE    CEND0020                                                         
         DC    H'0'                                                             
*                                                                               
CEND0020 EQU   *                                                                
         CLC   RCONKREP,DSTNREP(R5)                                             
*                                  SAME REP?                                    
         BNE   CEND0060            NO                                           
         CLC   DSTNCALL(5,R5),RCONKSTA                                          
*                                  CORRECT STATION?                             
         BE    CEND0080            YES                                          
CEND0060 EQU   *                   NO                                           
         ZIC   RF,1(R5)            LENGTH OF ELEMENT                            
         AR    R5,RF               BUMP TO NEXT STATION                         
         B     CEND0010                                                         
*                                                                               
CEND0080 EQU   *                                                                
*        MVC   P+1(04),=C'STA='                                                 
*        MVC   P+5(74),0(R5)                                                    
*        GOTO1 REPORT                                                           
*                                                                               
         XC    DUB,DUB                                                          
         EDIT  (2,DSTNDEND(R5)),(3,DUB),DUB=MYDUB,ZERO=NOBLANK                  
         MVC   DUB+5(3),=C'MOS'                                                 
         XIT1                                                                   
MYDUB    DS    D                                                                
         LTORG                                                                  
         EJECT                                                                  
CONJOINS NMOD1 0,*CONJOINS*                                                     
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED THROUGH - DON'T CHANGE IT                      
*                                                                               
         L     R5,FRST2            POINT TO FIRST STATION ELEMENT               
CJNS0010 EQU   *                                                                
         CLI   0(R5),2             STATION RECORD                               
         BE    CJNS0020                                                         
         DC    H'0'                                                             
*                                                                               
CJNS0020 EQU   *                                                                
         CLC   RCONKREP,DSTNREP(R5)                                             
*                                  SAME REP?                                    
         BNE   CJNS0060            NO                                           
         CLC   DSTNCALL(5,R5),RCONKSTA                                          
*                                  CORRECT STATION?                             
         BE    CJNS0080            YES                                          
CJNS0060 EQU   *                   NO                                           
         ZIC   RF,1(R5)            LENGTH OF ELEMENT                            
         AR    R5,RF               BUMP TO NEXT STATION                         
         B     CJNS0010                                                         
*                                                                               
CJNS0080 EQU   *                                                                
         XC    DUB,DUB                                                          
*                                  STATION JOIN DATE                            
         GOTO1 DATCON,DMCB,(3,DSTNSTRT(R5)),(5,DUB)                             
*                                                                               
***      MVC   P+1(04),=C'STA='                                                 
***      MVC   P+5(20),0(R5)                                                    
***      MVC   P+30(8),DUB                                                      
***      GOTO1 REPORT                                                           
*                                                                               
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***>>>>  CONENDTE/CONJOINS                                                      
*                                                                               
*  'ROW2NMOD' IS NEVER CALLED WHEN S/P BUDGETS W/OUT STATION IN KEY             
*        ARE BEING PROCESSED.                                                   
*                                                                               
ROW2NMOD NMOD1 0,*ROW2*                                                         
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED THROUGH - DON'T CHANGE IT                      
*                                                                               
         MVC   DUB(5),RCONKSTA                                                  
         CLI   RECORD,C'C'         CONTRACT                                     
         BE    RNMD0020                                                         
         MVC   DUB(5),RBUDKSTA     BUDGET                                       
         CLI   RSBDKTYP,SPBDGT     S/P BUDGET IN USE?                           
         BNE   RNMD0010            NO  - USE REGULAR BUDGET STATION             
         MVC   DUB(5),RSBDKSTA     YES - USE S/P BUDGET STATION                 
         B     RNMD0020                                                         
RNMD0010 EQU   *                                                                
         CLC   =C'C*MP',RBUDKSTA   C*MPANY BUDGET RECORD?                       
         BNE   RNMD0020            NO  - SKIP REST OF TESTS                     
         XC    ROWSTSAV,ROWSTSAV   YES - CLEAR COMBO PARENT VALUE               
         B     RNMD0220            SKIP REST OF TESTS                           
RNMD0020 EQU   *                                                                
         OC    DUB(5),SPACES                                                    
         XC    0(2,R4),0(R4)                                                    
         CLI   SVCODE,2            STATION ORDER?                               
         BNE   RNMD0040            NO  - MARKET STATION ORDER                   
         BAS   RE,GETROWST         YES                                          
         B     RNMD0220                                                         
*                                                                               
*    IT'S MARKET ORDER - NEED DISPLACEMENT INTO SPACEND IN                      
*        FIRST 2 BYTES OF KEY                                                   
*                                                                               
RNMD0040 EQU   *                                                                
         CLC   DUB(5),STASAV                                                    
         BE    RNMD0200            ALREADY HAVE DISP.                           
*                                                                               
         MVC   STASAV,DUB                                                       
         L     R5,FRST2            POINT TO FIRST STATION ELEMENT               
*                                                                               
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP           A(MASTER/SUBSIDIARY TABLE)                   
         USING RSREPD,RE                                                        
         MVC   TESTREP,RCREPFL     LOAD REP ID FOR RUN                          
         CLI   MASTREP,1           MASTER REP?                                  
         BNE   RNMD0060            NO                                           
         L     RF,ACONSREP         A(CURRENT REP CODE IN TABLE)                 
         MVC   TESTREP,0(RF)       LOAD REP ID FOR RUN                          
*                                                                               
         DROP  RE,RF                                                            
*                                                                               
RNMD0060 EQU   *                                                                
         LA    RE,1                FIND RELATIVE COUNT INTO SPACND              
         ZIC   RF,1(R5)            LENGTH OF ELEMENT                            
*                                                                               
RNMD0080 CLI   0(R5),2             STATION RECORD                               
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         CLC   TESTREP,DSTNREP(R5) SAME REP?                                    
         BNE   RNMD0100            NO                                           
         CLC   DSTNCALL(5,R5),DUB  CORRECT STATION                              
         BE    RNMD0120                                                         
RNMD0100 EQU   *                                                                
         LA    RE,1(RE)            INCREMENT DISP. COUNTER                      
         AR    R5,RF               NEXT ELEMENT                                 
         B     RNMD0080                                                         
*                                                                               
RNMD0120 EQU   *                                                                
         XC    ROWSTSAV,ROWSTSAV   CLEAR COMBO PARENT VALUE                     
         OC    DSTNCMBO(5,R5),DSTNCMBO(R5)  ANY COMBO STATION?                  
         BZ    RNMD0180            NO  - USE THIS STATION'S COUNT               
*                                                                               
         ST    R5,P6               SAVE REGISTER FOR 'NOT FOUND'                
*                                                                               
*   IF A COMBO STATION IS RECOGNIZED, THE DISPLACEMENT OF THAT STATION          
*     MUST BE USED, RATHER THAN THE STATION REFERENCED IN THE CONTRACT          
*                                                                               
         MVC   DUB(5),DSTNCMBO(R5) YES - GO BACK AND FIND COMBO                 
         L     R5,FRST2            POINT TO FIRST STATION ELEMENT               
         LA    RE,1                FIND RELATIVE COUNT INTO SPACND              
         ZIC   RF,1(R5)                                                         
RNMO0100 CLI   0(R5),2             STATION RECORD                               
         BE    RNMD0140            STATION TYPE IN TABLE FOUND                  
*                                                                               
         L     R5,P6               RELOAD SAVED REGISTER                        
         B     RNMD0180            COMBO STATION NOT FOUND                      
*                                     DEFAULT TO ORIGINAL STATION               
*                                                                               
RNMD0140 EQU   *                                                                
         CLC   TESTREP,DSTNREP(R5) SAME REP?                                    
         BNE   RNMD0160            NO                                           
         CLC   DSTNCALL(5,R5),DUB  CORRECT STATION                              
         BNE   RNMD0160                                                         
         MVC   ROWSTSAV,DUB        SET 'COMBO STATION USED' FLAG                
         B     RNMD0180                                                         
RNMD0160 EQU   *                                                                
         LA    RE,1(RE)            INCREMENT DISP. COUNTER                      
         AR    R5,RF               NEXT ELEMENT                                 
         B     RNMO0100                                                         
*                                                                               
RNMD0180 EQU   *                                                                
         STH   RE,SVDISP                                                        
         CLI   XFILYES,C'Y'        CROSS-FILE REPORT?                           
         BNE   RNMD0200            NO                                           
         BAS   RE,XFILDISP         YES - RESET COUNT TO D(XFILE)                
*                                     SVDISP WILL BE RESET BY ROUTINE           
RNMD0200 MVC   0(2,R4),SVDISP                                                   
*                                                                               
RNMD0220 MVC   2(4,R4),RCONKSTA                                                 
         CLI   RECORD,C'C'         CONTRACT                                     
         BE    RNMD0240                                                         
         MVC   2(4,R4),RBUDKSTA    BUDGET                                       
         CLI   RSBDKTYP,SPBDGT     S/P BUDGET IN USE?                           
         BNE   RNMD0230            NO  - USE REGULAR BUDGET STATION             
         MVC   2(4,R4),RSBDKSTA    YES - USE S/P BUDGET STATION                 
         B     RNMD0240                                                         
RNMD0230 EQU   *                                                                
         CLC   =C'C*MP',RBUDKSTA   COMPANY BUDGET RECORD?                       
         BNE   RNMD0240            NO  -                                        
         MVI   1(R4),X'FF'         YES - FORCE TO SORT LAST                     
RNMD0240 EQU   *                                                                
         LA    R5,5(R4)                                                         
         LA    RF,4                                                             
         CLI   0(R5),C' '                                                       
         BNE   *+12                                                             
         BCTR  R5,0                                                             
         BCT   RF,*-10                                                          
         DC    H'0'                                                             
         MVI   2(R5),C'M'                                                       
         MVC   1(1,R5),RCONKSTA+4                                               
         CLI   RECORD,C'C'         CONTRACT                                     
         BE    RNMD0250                                                         
         MVC   1(1,R5),RBUDKSTA+4  BUDGET                                       
         CLI   RSBDKTYP,SPBDGT     S/P BUDGET IN USE?                           
         BNE   RNMD0250            NO  - USE REGULAR BUDGET STATION             
         MVC   1(1,R5),RSBDKSTA+4  YES - USE S/P BUDGET STATION                 
RNMD0250 EQU   *                                                                
         CLI   DUB+4,C' '                                                       
         BNE   RNMD0260                                                         
         MVC   1(2,R5),=C'TV'                                                   
RNMD0260 EQU   *                                                                
         CLI   1(R5),C'L'          LOW-POWER STATION?                           
         BNE   RNMD0280            NO                                           
         MVI   2(R5),C' '          YES - CLEAR OUT LAST CHARACTER               
RNMD0280 EQU   *                                                                
         LA    RF,QWREQ3           SET A(REQUEST CARDS FOR JOB)                 
         CLI   Q3COMPNO-QREC3(RF),C'Y'                                          
*                                  REQUEST TO SUPPRESS COMPONENTS?              
         BNE   RNMD0300            NO  - FINISHED                               
         OC    ROWSTSAV,ROWSTSAV   WAS COMBO STATION USED?                      
         BZ    RNMD0300            NO                                           
         MVC   2(5,R4),ROWSTSAV    YES - OVERRIDE WITH COMBO PARENT             
         MVI   7(R4),C'M'          INSERT MEDIA CODE                            
*                                                                               
RNMD0300 EQU   *                                                                
         XIT1                                                                   
*                                                                               
ROWSTSAV DS    CL5                 LOCAL STORAGE FOR COMBO PARENT               
         DS    0H                                                               
         EJECT                                                                  
*                                                                               
*   XFILDISP:  CROSS-FILE REPORTING IS BEING DONE.  THE DISPLACEMENT            
*        CALCULATED FROM SPACEND IS NOT CORRECT, SO IT MUST BE                  
*        REDONE FROM A TABLE WHICH CONTAINS ALL STATIONS FOR ALL                
*        REP FILES BEING CONSIDERED.                                            
*        MARKET STATION TABLE IS SET UP AS:                                     
MKSTNAME EQU   0                   POS 0  -  19  =  MARKET NAME                 
MKSTSTA  EQU   20                  POS 20  - 24   = STATION CALLS               
MKSTREP  EQU   25                  POS 25  - 26   = STATION REP                 
MKSTLEN  EQU   27                  LENGTH OF TABLE ENTRY                        
*                                                                               
XFILDISP NTR1                                                                   
         L     RF,AMKTSTA          SET A(MARKET STATION TABLE)                  
         LA    RE,1                SET COUNTER                                  
XDIS0020 EQU   *                                                                
         CLI   0(RF),0             END OF TABLE REACHED?                        
         BNE   *+6                 NO                                           
         DC    H'0'                YES - STATION MUST BE IN TABLE               
         CLC   DUB(5),MKSTSTA(RF)  STATION FOUND?                               
         BNE   XDIS0040            NO                                           
         CLC   TESTREP,MKSTREP(RF) YES - REP FOUND?                             
         BNE   XDIS0040            NO                                           
         STH   RE,SVDISP           YES - SAVE DISPLACEMENT COUNT                
         B     XDIS0060            EXIT                                         
XDIS0040 EQU   *                                                                
         LA    RF,MKSTLEN(RF)      BUMP TO NEXT ENTRY                           
         LA    RE,1(RE)            BUMP COUNT BY 1                              
         B     XDIS0020            GO BACK FOR NEXT                             
XDIS0060 EQU   *                                                                
         XIT1                                                                   
*                                                                               
         EJECT                                                                  
*                                                                               
*   GETROWST:  RETRIEVE THE COMBO STATION CALL LETTERS, IF ANY.                 
*                                                                               
GETROWST NTR1                                                                   
*                                                                               
         L     R5,FRST2            POINT TO FIRST STATION ELEMENT               
*                                                                               
*                                                                               
*   TEST                                                                        
*        MVC   P+1(09),=C'RCREPFL1='                                            
*        ST    RA,WORK+40                                                       
*        GOTO1 HEXOUT,DMCB,WORK+40,P+10,4,=C'TOG'                               
*        MVC   P+20(02),RCREPFL                                                 
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+24,4,=C'TOG'                              
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP           A(MASTER/SUBSIDIARY TABLE)                   
         USING RSREPD,RE                                                        
         MVC   TESTREP,RCREPFL     LOAD REP ID FOR RUN                          
         CLI   MASTREP,1           MASTER REP?                                  
         BNE   GROW0030            NO                                           
         L     RF,ACONSREP         A(CURRENT REP CODE IN TABLE)                 
         MVC   TESTREP,0(RF)       LOAD REP ID FOR RUN                          
*                                                                               
         DROP  RE,RF                                                            
*                                                                               
GROW0030 EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        MVC   P+1(09),=C'GETROWST='                                            
*        MVC   P+10(4),FRST2                                                    
*        MVC   P+16(2),TESTREP                                                  
*        MVI   P+18,C'/'                                                        
*        MVC   P+19(2),RCREPFL                                                  
*        ST    R8,WORK+40                                                       
*        GOTO1 HEXOUT,DMCB,WORK+40,P+24,4,=C'TOG'                               
*        L     RF,FRST2                                                         
*        MVC   P+40(24),0(RF)                                                   
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
*                                                                               
GROW0040 EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        MVC   P+1(09),=C'GROW0040='                                            
*        MVC   P+10(5),DUB                                                      
*        ST    R5,WORK+40                                                       
*        MVC   P+16(4),WORK+40                                                  
*        MVC   P+22(68),0(R5)                                                   
*        GOTO1 REPORT                                                           
*        MVC   P+10(2),TESTREP                                                  
*        MVI   P+12,C'/'                                                        
*        MVC   P+13(2),DSTNREP(R5)                                              
*        MVC   P+17(5),DUB                                                      
*        MVI   P+22,C'/'                                                        
*        MVC   P+23(5),DSTNCALL(R5)                                             
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         CLI   0(R5),2             STATION RECORD                               
         BE    GROW0050                                                         
         DC    H'0'                                                             
*                                                                               
GROW0050 EQU   *                                                                
         CLC   TESTREP,DSTNREP(R5) SAME REP?                                    
         BNE   GROW0060            NO                                           
         CLC   DSTNCALL(5,R5),DUB  CORRECT STATION?                             
         BE    GROW0080            YES                                          
GROW0060 EQU   *                   NO                                           
         ZIC   RF,1(R5)            LENGTH OF ELEMENT                            
         AR    R5,RF               BUMP TO NEXT STATION                         
         B     GROW0040                                                         
*                                                                               
GROW0080 EQU   *                                                                
         XC    ROWSTSAV,ROWSTSAV   CLEAR COMBO PARENT VALUE                     
         OC    DSTNCMBO(5,R5),DSTNCMBO(R5)  ANY COMBO STATION?                  
         BZ    GROW0100            NO  - EXIT                                   
*                                                                               
         MVC   ROWSTSAV(5),DSTNCMBO(R5)                                         
*                                  YES - USE INSTEAD OF COMBO CHILD             
*                                     DEFAULT TO ORIGINAL STATION               
GROW0100 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
ROW9NMOD NMOD1 0,*ROW9*                                                         
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED THROUGH - DON'T CHANGE IT                      
*                                                                               
         CLC   RCONPRD,SPACES      PRODUCT                                      
         BNH   RW090040                                                         
*                                                                               
RW090020 EQU   *                                                                
         MVC   0(3,R4),RCONPRD     PRODUCT CODE                                 
         MVI   3(R4),X'FF'         SET 'FF' PRODUCT CODE INDICATOR              
*                                     FOR WHEN 1ST CHARACTER FAILS IN           
*                                        RERG03 (SEE DOC THERE)                 
         B     RW090800                                                         
*                                                                               
RW090040 LA    R5,RCONELEM         NO PRODUCT CODE ---                          
         SR    R0,R0               LOOK FOR PRODUCT NAME FROM                   
*                                  EXPANSION ELEMENT                            
RW090060 CLI   0(R5),0                                                          
         BE    RW090020                                                         
         CLI   0(R5),5                                                          
         BE    RW090080                                                         
         IC    R0,1(R5)                                                         
         AR    R5,R0                                                            
         B     RW090060                                                         
*                                                                               
RW090080 L     R1,ASPACND4         LOOK FOR PRODUCT ELEMNTS                     
         SR    R0,R0                                                            
         XC    HALF,HALF                                                        
*                                                                               
RW090100 CLI   0(R1),0                                                          
         BE    RW090140                                                         
         CLI   0(R1),9             TEST PRODUCT ELEMENT                         
         BNE   RW090120                                                         
         CLC   4(20,R1),RCONEXPR-RCONEXEL(R5)  YES-TEST SAME PRD NAME           
         BE    RW090160            YES                                          
         MVC   HALF,2(R1)          NO-SAVE LATEST PRODUCT CODE                  
*                                                                               
RW090120 IC    R0,1(R1)                                                         
         AR    R1,R0                                                            
         B     RW090100                                                         
*                                                                               
RW090140 LH    RF,HALF             NEXT PRODUCT CODE                            
         LA    RF,1(RF)                                                         
         STH   RF,HALF             TEST BEYOND X'7FFF'                          
         CLC   HALF,=X'7FFF'                                                    
         BH    RW090180            YES-JUST FIRST 8 CHARACTERS                  
*                                                                               
*   RETRIEVE A(SPACEND), THEN TAKE 1ST WORD THEREIN, WHICH IS THE               
*        LENGTH OF SPACE REMAINING, TO DETERMINE IF PRODUCT WILL                
*        FIT IN SPACEND.                                                        
*                                                                               
         L     RE,ASPACEND         A(SPACEND)                                   
         L     RF,0(RE)            ROOM TO ADD PRODUCT ELT?                     
         SH    RF,=H'24'                                                        
         BM    RW090180            NO-JUST FIRST 8 CHARACTERS                   
         ST    RF,0(RE)            STORE NEW REMAINING LENGTH                   
         MVI   0(R1),9                                                          
         MVI   1(R1),24                                                         
         MVC   2(2,R1),HALF                                                     
         MVC   4(20,R1),RCONEXPR-RCONEXEL(R5)                                   
*                                                                               
RW090160 MVC   0(6,R4),4(R1)       BEGINNING OF PRD NAME FOR SORTING            
         NI    0(R4),X'7F'         INDICATE SPECIAL PRODUCT CODE                
         MVC   6(2,R4),2(R1)       MOVE PRODUCT CODE                            
         B     RW090800                                                         
*                                                                               
RW090180 MVC   0(8,R4),RCONEXPR-RCONEXEL(R5)  JUST FIRST 8 CHARACTERS           
         NI    0(R4),X'7F'                                                      
         OI    6(R4),X'80'                                                      
         B     RW090800                                                         
RW090800 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
**-->>                                                                          
*                                                                               
*        POST BUFFALO ROWS, REPORT LEVEL                                        
*        R1 POINTS TO A(ROW CODE)                                               
*        R4 = BUFFALO ROW ADDR                                                  
         DS    0F                                                               
PSTSPROW NMOD1 0,**SPRW**                                                       
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN - DONT CHANGE VALUE                         
*                                                                               
*                                                                               
         L     RF,0(R1)                                                         
         L     R7,4(R1)            RESET A(RPSPECD)                             
         USING RPSPECD,R7                                                       
*                                     NOT PASSED IN                             
PSPR0040 EQU   *                                                                
         SR    R1,R1                                                            
         IC    R1,0(RF)                                                         
         STC   R1,SVCODE                                                        
         BCTR  R1,0                MAKE ZERO RELATIVE                           
         SLL   R1,2                MULTIPLY BY 4                                
         LA    RE,ROWSPTAB(R1)                                                  
         C     RE,=A(ROWSPTBX)                                                  
         BNH   PSPR0080                                                         
         DC    H'0'                                                             
PSPR0080 EQU   *                                                                
*                                                                               
*                                  CHECK BUDGET ROUTINES                        
         ICM   RF,15,0(RE)         ANY BUDGET ROUTINE?                          
         BNZ   PSPR0160            YES                                          
***>>>                             NO  -                                        
         ICM   RF,15,RPBUDPAS      BUDPAS SPEC?                                 
         BZ    PSPRXTNE            NO  - NO ROUTINE                             
PSPR0150 EQU   *                                                                
         MVC   0(2,R4),=X'FFFF'    YES - STUFF 'BUDGET ROW' FLAG                
         MVC   2(6,R4),=C'BUDGET'                                               
         MVI   RGROWSZ-1(R4),1                                                  
         B     PSPRXTEQ                                                         
PSPR0160 EQU   *                                                                
         TM    0(RE),X'80'                                                      
         BO    PSPRXTEQ                                                         
         BASR  R9,RF               POST THE ROWS                                
         BNZ   PSPRXTNE                                                         
         MVI   RGROWSZ-1(R4),1                                                  
*                                                                               
PSPRXTEQ EQU   *                                                                
         CR    RB,RB                                                            
         B     PSPREXIT                                                         
*                                                                               
PSPRXTNE EQU   *                                                                
         LTR   RB,RB                                                            
*                                                                               
PSPREXIT EQU   *                                                                
         XIT1                                                                   
*                                                                               
         DROP R7                                                                
*                                                                               
         EJECT                                                                  
*                                                                               
*        ROW POST ROUTINE BRANCH TABLE (SALESPERSON BUDGET)                     
*                                                                               
         SPACE                                                                  
*              CONTRACT  /BUDGET                 RECORD                         
ROWSPTAB DS    0F                                                               
         DC    A(RWSB0110)                       REP                            
         DC    A(RWSB0210)                                                      
         DC    AL4(0)                            REGION                         
         DC    A(RWSB0410)                       OFFICE                         
         DC    A(RWSB0510)                       TEAM                           
         DC    A(RWSB0610)                       SALESPERSON                    
         DC    A(RWSB0710)                       GROUP                          
         DC    AL4(0)                            ADVERTISER                     
         DC    AL4(0)                            PRODUCT                        
         DC    AL4(0)                            AGENCY/OFFICE                  
         DC    A(RWSB1110)                       AFFILIATE                      
         DC    AL4(0)                            CONTRACT                       
         DC    AL4(0)                            CLASS                          
         DC    AL4(0)                            OFF NY/LA/CH SEQ               
         DC    AL4(0)                            CATEGORY                       
         DC    AL4(-1)                           RANK                           
         DC    A(RWSB1710)                       MONTH                          
         DC    A(RWSB1810)                       CURMONTH                       
         DC    A(RWSB1910)                       ALLMONTH                       
         DC    A(RWSB2010)                       QTR                            
         DC    A(0)                              SPARE                          
         DC    A(RWSB2210)                       STATYPE                        
         DC    A(RWSB2310)                       TVB                            
         DC    A(RWSB2410)                       OWNER                          
         DC    A(RWSB2510)                       GRGRP                          
         DC    A(RWSB0710)                       GRSUBGRP                       
         DC    AL4(0)                            ADVNAME                        
         DC    AL4(0)                            AGYNAME                        
         DC    AL4(0)                            SERVICE                        
         DC    AL4(0)                            MKTRANK                        
         DC    AL4(0)                            AVLPACE                        
         DC    A(RWSB0210)                       STAMKT                         
         DC    AL4(0)                            CONTYPE                        
         DC    AL4(0)                            PTPERSON                       
         DC    AL4(0)                            NETCON                         
         DC    AL4(0)                            BOOK                           
         DC    AL4(0)                            DAYPART                        
         DC    AL4(0)                            DEMO                           
         DC    A(RWSB3910)                       MARKET                         
         DC    A(RWSB4010)                       COMPANY                        
         DC    AL4(0)                            DAYPARTS                       
         DC    AL4(0)                            FLIGHT                         
         DC    AL4(0)                            BUYER                          
         DC    AL4(0)                            DEV SALESPERSON                
         DC    A(RWSB4510)                       DEV CONTRACT TYPE              
         DC    AL4(0)                            EMPTY ROW                      
         DC    AL4(0)                            AGENCY ONLY (NO OFFC)          
ROWSPTBX EQU   *-1                                                              
         EJECT                                                                  
*                                                                               
*        ROUTINES TO POST ROWS FROM S/P BUDGET RECORD                           
*                                                                               
         SPACE                                                                  
RWSB0110 EQU   *                                                                
         MVC   0(2,R4),RSBDKREP    SET  KEY                                     
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
         SPACE                                                                  
RWSB0210 EQU   *                                                                
         CLI   RREPPROF+16,C'S'    S/P BUDGETS INCLUDE STATION?                 
         BNE   RWSB9990            NO  - CAN'T CHECK FOR STATION                
         GOTO1 =A(ROW2NMOD),DMCB,(RC)                                           
*                                  YES - CHECK FOR STATION                      
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
*                                                                               
*   SALESPERSON OFFICE IS CONTAINED IN S/P SPACEND ENTRY.                       
*        ACCESS S/P CODE, RETRIEVE OFFICE                                       
*                                                                               
RWSB0410 EQU   *                                                                
         MVI   INFCODE,6                                                        
         BAS   RE,FSTSPINF                                                      
         B     *+8                                                              
RWSB0420 BAS   RE,NXTS0020                                                      
         BE    *+6                                                              
RWSB0430 DC    H'0'                                                             
         CLC   RSBDKREP,DSALREP(R5) SAME REP?                                   
         BNE   RWSB0420                                                         
         CLC   RSBDKSAL,DSALSAL(R5) SAME SALESPERSON?                           
         BNE   RWSB0420                                                         
         MVC   1(2,R4),DSALOFF(R5) OFFICE CODE                                  
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB0510 EQU   *                                                                
         MVC   0(2,R4),SPACES                                                   
         CLI   RREPPROF+16,C'S'    S/P BUDGETS INCLUDE STATION?                 
         BE    RWSB9990            YES - EXIT OKAY ON THIS ITEM                 
         LA    RE,QWREQ            NO  - TAKE GROUP/SUBGRP FROM                 
*                                     REQUEST CARD                              
         MVC   0(2,R4),QGROUP-QRECORD(RE)                                       
         B     RWSB9990            EXIT OKAY                                    
*                                                                               
RWSB0530 MVI   INFCODE,2                                                        
         BAS   RE,FSTSPINF                                                      
         B     *+8                                                              
RWSB0540 BAS   RE,NXTS0020                                                      
         BE    *+6                                                              
RWSB0550 DC    H'0'                                                             
         CLC   RSBDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   RWSB0540                                                         
         CLC   RSBDKSTA,DSTNCALL(R5)                                            
         BNE   RWSB0540                                                         
*                                                                               
*   AS THERE IS NO OFFICE, THERE IS NO TEAM FOR STN                             
*                                                                               
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB0610 EQU   *                                                                
         MVC   0(3,R4),RSBDKSAL                                                 
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB0710 EQU   *                                                                
         CLI   RREPPROF+16,C'S'    S/P BUDGETS INCLUDE STATION?                 
         BNE   RWSB9990            NO  - EXIT OKAY ON THIS ITEM                 
         MVI   INFCODE,2                                                        
         BAS   RE,FSTSPINF                                                      
         B     *+8                                                              
RWSB0730 BAS   RE,NXTS0020                                                      
         BE    *+6                                                              
RWSB0740 DC    H'0'                                                             
         CLC   RSBDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   RWSB0730                                                         
         CLC   RSBDKSTA,DSTNCALL(R5)                                            
         BNE   RWSB0730                                                         
         MVC   0(2,R4),DSTNGRP(R5)                                              
         CLI   1(R4),X'00'         SUBGROUP = BINARY ZERO?                      
         BNE   RWSB9990            NO  - LEAVE AS IS                            
         MVI   1(R4),X'40'         YES - SET TO SPACE                           
         B     RWSB9990                                                         
         SPACE 2                                                                
RWSB1110 EQU   *                                                                
         CLI   RREPPROF+16,C'S'    S/P BUDGETS INCLUDE STATION?                 
         BNE   RWSB9990            NO  - EXIT OKAY ON THIS ITEM                 
         MVI   INFCODE,2                                                        
         BAS   RE,FSTSPINF                                                      
         B     *+8                                                              
RWSB1130 BAS   RE,NXTS0020                                                      
         BE    *+6                                                              
RWSB1140 DC    H'0'                                                             
         CLC   RSBDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   RWSB1130                                                         
         CLC   RSBDKSTA,DSTNCALL(R5)                                            
         BNE   RWSB1130                                                         
         MVC   0(3,R4),DSTNAFF(R5) AFFILIATE                                    
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB1710 ST    R4,AMONROW          SAVE MONTH ROW ADDR                          
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB1810 ST    R4,AMONROW          SAVE CURMONTH ROW ADDR                       
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB1910 ST    R4,AMONROW          SAVE ALLMONTH ROW ADDR                       
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB2010 ST    R4,AMONROW          SAVE QTR ROW ADDR                            
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB2210 EQU   *                                                                
         CLI   RREPPROF+16,C'S'    S/P BUDGETS INCLUDE STATION?                 
         BNE   RWSB9990            NO  - EXIT OKAY ON THIS ITEM                 
         CLC   RSBDKSTA,QWSTNSAV   STNTYPE                                      
         BNE   *+14                                                             
         MVC   0(1,R4),QWSTNTYP    ALREADY HAVE STATION TYPE                    
         B     RWSB9990            EXIT OKAY                                    
         MVC   QWSTNSAV,RSBDKSTA                                                
         MVI   INFCODE,2                                                        
         BAS   RE,FSTSPINF                                                      
         B     *+8                                                              
RWSB2230 BAS   RE,NXTS0020                                                      
         BE    *+6                                                              
RWSB2240 DC    H'0'                                                             
         CLC   RSBDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   RWSB2230                                                         
         CLC   RSBDKSTA,DSTNCALL(R5)                                            
         BNE   RWSB2230                                                         
         MVC   WORK(4),=X'0000FFFF'                                             
         OC    DSTNSTRT(3,R5),DSTNSTRT(R5)   START DATE                         
         BZ    RWSB2260                                                         
         GOTO1 DATCON,DMCB,(3,DSTNSTRT(R5)),WORK+6                              
         GOTO1 GETBROAD,(R1),WORK+6,WORK+12                                     
         CLC   WORK+6,WORK+12                                                   
         BE    RWSB2250           STARTED ON 1ST DAY OF BROADCAST MONTH         
         MVC   WORK+12(6),WORK+18  ELSE GO TO NEXT MONTH                        
         GOTO1 ADDAY,DMCB,WORK+12,WORK+18,15                                    
*                                                                               
RWSB2250 GOTO1 DATCON,DMCB,WORK+18,(3,WORK)                                     
         MVI   WORK+2,X'FF'        WORK(2) HAS FIRST MONTH                      
*                                                                               
RWSB2260 OC    DSTNEND(3,R5),DSTNEND(R5)     END DATE                           
         BZ    RWSB2280                                                         
         GOTO1 DATCON,DMCB,(3,DSTNEND(R5)),WORK+6                               
         GOTO1 GETBROAD,DMCB,WORK+6,WORK+12                                     
         CLC   WORK+6(6),WORK+18                                                
         BE    RWSB2270            ENDED ON LAST DAY OF BROADCAST MONTH         
         L     R5,=F'-15'           ELSE GO TO PREVIOUS MONTH                   
         GOTO1 ADDAY,DMCB,WORK+12,WORK+18,(R5)                                  
*                                                                               
RWSB2270 GOTO1 DATCON,DMCB,WORK+18,(3,WORK+2)  WORK+2(2) HAS LAST MONTH         
*                                                                               
RWSB2280 MVI   0(R4),C'3'          OLD                                          
         CLC   WORK+2(2),QWCURND   LOST BEFORE LAST REQUEST MONTH               
         BL    RWSB2290                                                         
         MVI   0(R4),C'2'          NEW                                          
         CLC   WORK(2),QWPRIST     STARTED AFTER FIRST PRIOR MONTH              
         BH    RWSB2290                                                         
         MVI   0(R4),C'1'          ELSE COMPARABLE                              
*                                                                               
RWSB2290 MVC   QWSTNTYP,0(R4)                                                   
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB2310 EQU   *                                                                
         CLI   RREPPROF+16,C'S'    S/P BUDGETS INCLUDE STATION?                 
         BNE   RWSB9990            NO  - EXIT OKAY ON THIS ITEM                 
         MVI   INFCODE,2                                                        
         BAS   RE,FSTSPINF                                                      
         B     *+8                                                              
RWSB2330 BAS   RE,NXTS0020                                                      
         BE    *+6                                                              
RWSB2340 DC    H'0'                                                             
         CLC   RSBDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   RWSB2330                                                         
         CLC   RSBDKSTA,DSTNCALL(R5)                                            
         BNE   RWSB2330                                                         
         MVC   0(2,R4),DSTNTVB(R5)      TVB REGION                              
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB2410 EQU   *                                                                
         CLI   RREPPROF+16,C'S'    S/P BUDGETS INCLUDE STATION?                 
         BNE   RWSB9990            NO  - EXIT OKAY ON THIS ITEM                 
         MVI   INFCODE,2                                                        
         BAS   RE,FSTSPINF                                                      
         B     *+8                                                              
RWSB2430 BAS   RE,NXTS0020                                                      
         BE    *+6                                                              
RWSB2440 DC    H'0'                                                             
         CLC   RSBDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   RWSB2430                                                         
         CLC   RSBDKSTA,DSTNCALL(R5)                                            
         BNE   RWSB2430                                                         
         OC    DSTNOWN(3,R5),DSTNOWN(R5)                                        
         BZ    RWSB9900            NO OWNER, DON'T POST                         
         MVC   0(3,R4),DSTNOWN(R5)      OWNER                                   
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB2510 EQU   *                                                                
         CLI   RREPPROF+16,C'S'    S/P BUDGETS INCLUDE STATION?                 
         BE    RWSB2520            YES - CAN FIGURE GROUP/SUBGROUP              
         LA    RE,QWREQ            NO  - TAKE GROUP/SUBGRP FROM                 
*                                     REQUEST CARD                              
         MVC   0(2,R4),QGROUP-QRECORD(RE)                                       
         B     RWSB9990            EXIT OKAY ON THIS ITEM                       
RWSB2520 EQU   *                                                                
         MVI   INFCODE,2                                                        
         BAS   RE,FSTSPINF                                                      
         B     *+8                                                              
RWSB2530 BAS   RE,NXTS0020                                                      
         BE    RWSB2550            ***                                          
RWSB2540 MVI   0(R4),C'T'          *** TEMPORARY FIX FOR WTCN                   
         B     RWSB9990            EXIT OKAY                                    
RWSB2550 EQU   *                                                                
         CLC   RSBDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   RWSB2530                                                         
         CLC   RSBDKSTA,DSTNCALL(R5)                                            
         BNE   RWSB2530            ***                                          
         MVC   0(1,R4),DSTNGRP(R5)  GROUP                                       
         CLI   1(R4),X'00'         SUBGROUP = BINARY ZERO?                      
         BNE   RWSB9990            NO  - LEAVE AS IS                            
         MVI   1(R4),X'40'         YES - SET TO SPACE                           
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB3910 EQU   *                                                                
         CLI   RREPPROF+16,C'S'    S/P BUDGETS INCLUDE STATION?                 
         BNE   RWSB9990            NO  - EXIT OKAY ON THIS ITEM                 
         MVI   INFCODE,2           MARKET CODE                                  
         BAS   RE,FSTSPINF                                                      
         B     *+8                                                              
RWSB3930 BAS   RE,NXTS0020                                                      
         BE    *+6                                                              
RWSB3940 DC    H'0'                                                             
         CLC   RSBDKREP,DSTNREP(R5) SAME REP?                                   
         BNE   RWSB3930                                                         
         CLC   RSBDKSTA,DSTNCALL(R5)                                            
         BNE   RWSB3930                                                         
         MVC   0(4,R4),DSTNMKT(R5)                                              
         B     RWSB9990            EXIT OKAY                                    
         SPACE 2                                                                
RWSB4010 EQU   *                                                                
         MVC   0(2,R4),RSBDKREP    COMPANY CODE FROM KEY                        
         B     RWSB9990            EXIT OKAY                                    
RWSB4510 EQU   *                                                                
         MVC   0(2,R4),RSBDKDCT    COMPANY CODE FROM 1504 KEY                   
         CLC   0(2,R4),=C'  '      ANY CODE IN FIELD? (SPACES)                  
         BE    RWSB4540            NO  - INSERT 'ALL'                           
         OC    0(2,R4),0(R4)       ANY CODE IN FIELD? (BIN ZERO)                
         BNZ   RWSB9990            YES - EXIT OKAY                              
RWSB4540 EQU   *                                                                
         MVC   0(2,R4),=C'**'      INSERT NON-PRINTABLE 'HOLDER'                
****     MVC   0(2,R4),=X'FFFF'    INSERT NON-PRINTABLE 'HOLDER'                
         B     RWSB9990            EXIT OKAY                                    
RWSB9900 LTR   RB,RB               SKIP THIS REPORT - CC NE 0                   
         BR    R9                                                               
*                                                                               
RWSB9990 CR    RB,RB               OK - CC EQ 0                                 
         BR    R9                                                               
         EJECT                                                                  
         SPACE 2                                                                
         EJECT                                                                  
*                                                                               
*        ROUTINE TO FIND INFORMATION ELEMENT FROM INFO POOL                     
*              INPUT:  INFCODE = ELEMENT CODE                                   
*              OUTPUT: R5      = A(ELEMENT)                                     
*                                                                               
         SPACE                                                                  
FSTSPINF L     R5,ASPACND4                                                      
*                                                                               
FSSP0020 CLI   0(R5),0                                                          
         BE    FSSP0200                                                         
         CLC   INFCODE,0(R5)                                                    
         BER   RE                                                               
*                                                                               
NXTS0020 SR    R0,R0                                                            
         ICM   R0,1,1(R5)                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R5,R0                                                            
         B     FSSP0020                                                         
*                                                                               
FSSP0200 LTR   RE,RE                                                            
         BR    RE                                                               
         EJECT                                                                  
         LTORG                                                                  
         SPACE 2                                                                
         EJECT                                                                  
**-->>                                                                          
EXGRPSET EQU   X'80'                                                            
EXSALSET EQU   X'40'                                                            
EXADVSET EQU   X'20'                                                            
EXAGYSET EQU   X'10'                                                            
EXSTASET EQU   X'08'                                                            
EXCTYSET EQU   X'04'                                                            
EXDTYSET EQU   X'02'                                                            
EXPPRSET EQU   X'01'                                                            
EXOFFSET EQU   X'80'                                                            
EXREPSET EQU   X'40'                                                            
EXMKTSET EQU   X'20'                                                            
*                                                                               
*        ROUTINE TO FILTER CONTRACT RECORDS (REQUEST LEVEL)                     
*                                                                               
FILTCON  NMOD1 0,*FCON*                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 SET BY CONREC AND PASSED IN - DON'T RESET ITS VALUE                      
*                                                                               
         L     RC,0(R1)            RESET A(WORKSPACE)                           
*                                                                               
         LA    R3,QWREQ3                                                        
         USING QREC3D,R3                                                        
*                                                                               
         GOTO1 FILTSUB1            BUYLINE CODING & COMP S/P FILTERS            
         BNZ   FCON2160            FILTER FAILED: SKIP RECORD                   
         CLI   Q3RERFLG,C' '       RER REQUEST?                                 
         BE    FCON0018            NO                                           
         CLI   Q3RERFLG,X'00'      RER REQUEST?                                 
         BE    FCON0018            NO                                           
*                                  YES                                          
         SR    R1,R1               SET FLAG TO 'NON-RER'                        
         LA    RF,RCONELEM                                                      
FCON0010 EQU   *                                                                
         ZIC   RE,1(RF)            BUMP TO NEXT ELEMENT                         
         AR    RF,RE                                                            
         CLI   0(RF),0             END OF RECORD?                               
         BE    FCON0012            YES - CONSIDER 'NOT RER CONTRACT'            
         CLI   0(RF),X'1F'         EXTENDED DESCRIPTOR ELEMENT?                 
         BNE   FCON0010            NO  - CHECK NEXT ELEMENT                     
         TM    RCONSTAT-RCONXEL(RF),X'04'                                       
         BNO   FCON0012                                                         
         LA    R1,1                SET 'RER ORDER'                              
FCON0012 EQU   *                                                                
         CLI   Q3RERFLG,C'+'       REPORT ONLY RER CONTRACTS?                   
         BNE   FCON0014            NO                                           
         LTR   R1,R1               YES - TEST RER FLAG                          
         BZ    FCON2160            NOT RER ORDER - SKIP IT                      
         B     FCON0018            CONTINUE TESTING                             
*                                                                               
FCON0014 EQU   *                                                                
         CLI   Q3RERFLG,C'-'       EXCLUDE BACK BILL OPTION SET?                
         BNE   FCON0018            NO                                           
         LTR   R1,R1               YES - TEST RER FLAG                          
         BNZ   FCON2160            RER ORDER - SKIP IT                          
         B     FCON0018            CONTINUE TESTING                             
*                                                                               
*                                                                               
*                                                                               
*   TEST                                                                        
*        MVC   P+1(04),=C'OPT='                                                 
*        MVC   P+8(1),Q3BKBILL                                                  
*        MVC   P+12(05),=C'BUYR='                                               
*        MVC   P+20(6),RCONBUYR                                                 
*        MVC   P+29(05),=C'PROF='                                               
*        MVC   P+34(1),RREPPROF+15                                              
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+40,4,=C'TOG'                              
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
FCON0018 EQU   *                                                                
         CLI   Q3BKBILL,C'A'       INCLUDE ALL  BILL OPTION SET?                
         BE    FCON0080            YES - IGNORE ALL BACKBILL TESTS              
*                                                                               
         CLI   Q3BKBILL,C'-'       EXCLUDE BACK BILL OPTION SET?                
         BNE   FCON0040            NO                                           
*                                                                               
FCON0020 EQU   *                                                                
         CLC   =C'ACC-BB',RCONBUYR YES - BACK BILLING ORDER?                    
         BE    FCON2160            YES - SKIP IT                                
         B     FCON0080                                                         
FCON0040 EQU   *                                                                
         CLI   Q3BKBILL,C'+'       ONLY    BACK BILL OPTION SET?                
         BNE   FCON0060            NO                                           
*                                                                               
         CLC   =C'ACC-BB',RCONBUYR YES - BACK BILLING ORDER?                    
         BNE   FCON2160            NO  - SKIP IT                                
         B     FCON0080                                                         
*                                                                               
FCON0060 EQU   *                                                                
         CLI   RREPPROF+15,C'B'    AUTO PROFILE EXCLUDE BACK BILL SET?          
         BNE   FCON0080            NO                                           
*                                                                               
         CLC   =C'ACC-BB',RCONBUYR YES - BACK BILLING ORDER?                    
         BE    FCON2160            YES - SKIP IT                                
*                                                                               
FCON0080 EQU   *                                                                
***      L     R5,ASPACND4                                                      
*                                                                               
*TEST10  CLI   0(R5),0                                                          
*        BE    TESTEND                                                          
*        MVC   P+1(6),=C'TABLE='                                                
*        MVC   P+10(10),0(R5)                                                   
*        GOTO1 REPORT                                                           
*                                                                               
*        SR    R0,R0                                                            
*        ICM   R0,1,1(R5)                                                       
*        BNZ   *+6                                                              
*        DC    H'0'                                                             
*        AR    R5,R0                                                            
*        B     TEST10                                                           
*                                                                               
TESTEND  EQU   *                                                                
*                                                                               
*                                                                               
         CLI   Q3NATLOC,C' '       ANY NATL/LOCAL FILTER?                       
         BE    FCON0160            NO  - SKIP NEXT TESTING                      
         CLI   Q3NATLOC,X'00'      ANY NATL/LOCAL FILTER?                       
         BE    FCON0160            NO  - SKIP NEXT TESTING                      
         MVI   INFCODE,X'44'       YES - FIND OFFICE2 SPACEND                   
         BAS   RE,FRSTFIL1                                                      
         B     *+8                                                              
FCON0100 BAS   RE,NEXTFIL1                                                      
         BNE   FCON0140            NOT FOUND - CONSIDER 'NATIONAL'              
FCON0120 EQU   *                                                                
*                                                                               
         CLC   RCONKREP,DOFFREP2(R5)                                            
*                                  SAME REP?                                    
         BNE   FCON0100            NO  - CHECK NEXT ENTRY                       
         CLC   RCONKOFF,DOFFOFF2(R5)                                            
*                                  SAME OFFICE?                                 
         BNE   FCON0100            NO  - CHECK NEXT ENTRY                       
         TM    DOFFFLAG(R5),X'80'  YES - IS OFFICE 'LOCAL'?                     
         BNO   FCON0140            NO  - 'NATIONAL'                             
*                                  YES - 'LOCAL'                                
         CLI   Q3NATLOC,C'L'       IS REPORT FOR 'LOCAL'?                       
         BNE   FCON2160            NO  - SKIP THIS ORDER                        
         B     FCON0160            YES - PROCESS IT                             
FCON0140 EQU   *                   OFFICE IS 'NATIONAL'                         
         CLI   Q3NATLOC,C'N'       IS REPORT FOR 'NATIONAL'?                    
         BNE   FCON2160            NO  - SKIP THIS ORDER                        
         B     FCON0160            YES - PROCESS IT                             
*                                                                               
         DROP  R3                                                               
*                                                                               
FCON0160 EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        MVC   P+1(04),=C'OK ='                                                 
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+30,4,=C'TOG'                              
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         LA    R3,QWREQ                                                         
         USING QRECORD,R3                                                       
*                                                                               
         LA    R4,QREP                                                          
         L     RF,VXADDR                                                        
         USING VXADDRD,RF                                                       
         L     RE,VXSREP                                                        
         USING RSREPD,RE                                                        
         CLI   MASTREP,1                                                        
         BNE   FCON0180                                                         
         L     R4,ACONSREP         A(CURRENT REP IN USE)                        
*                                                                               
         DROP  RE,RF                                                            
*                                                                               
FCON0180 EQU   *                                                                
         OC    QWREPSET,QWREPSET   REP SET FILTER?                              
         BZ    FCON0260            NO                                           
         L     RF,QWREPSET         SET A(REP SET)                               
FCON0200 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FCON0220            YES - NO MATCH                               
         CLC   RCONKREP,0(RF)      NO  - REP IN SET?                            
         BE    FCON0240            YES - ACCEPT THIS RECORD                     
         LA    RF,2(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FCON0200            GO BACK FOR NEXT                             
FCON0220 EQU   *                                                                
         TM    QWSETFLG+1,EXREPSET CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FCON0280            YES - ACCEPT RECORD                          
         B     FCON2160            NO  - REJECT RECORD                          
FCON0240 EQU   *                                                                
         TM    QWSETFLG+1,EXREPSET CODE FOUND IN SET: EXCLUDE SET?              
         BO    FCON2160            YES - REJECT IT                              
         B     FCON0280            NO  - ACCEPT IT                              
FCON0260 EQU   *                                                                
         CLC   RCONKREP,0(R4)                                                   
         BNE   FCON2160                                                         
FCON0280 EQU   *                                                                
*                                                                               
         GOTO1 =A(FILTSTA),DMCB,RCONKSTA,RCONKREP                               
         BNE   FCON2160                                                         
*                                                                               
         CLC   QOFFICE,SPACES                                                   
         BE    FCON0380                                                         
         CLI   QOFFICE,C'*'        OFFICE SET FILTER?                           
         BNE   FCON0360            NO                                           
         L     RF,QWOFFSET         SET A(OFFICE SET)                            
FCON0300 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FCON0320            YES - NO MATCH                               
         CLC   RCONKOFF,0(RF)      NO  - OFFICE IN SET?                         
         BE    FCON0340            YES - ACCEPT THIS RECORD                     
         LA    RF,2(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FCON0300            GO BACK FOR NEXT                             
FCON0320 EQU   *                                                                
         TM    QWSETFLG+1,EXOFFSET CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FCON0380            YES - ACCEPT RECORD                          
         B     FCON2160            NO  - REJECT RECORD                          
FCON0340 EQU   *                                                                
         TM    QWSETFLG+1,EXOFFSET CODE FOUND IN SET: EXCLUDE SET?              
         BO    FCON2160            YES - REJECT IT                              
         B     FCON0380            NO  - ACCEPT IT                              
FCON0360 EQU   *                                                                
         CLC   QOFFICE,RCONKOFF                                                 
         BNE   FCON2160                                                         
*                                                                               
FCON0380 EQU   *                                                                
         CLC   QAGENCY,SPACES                                                   
         BE    FCON0520                                                         
         CLI   QAGENCY,C'*'        AGENCY SET FILTER?                           
         BE    FCON0400            YES                                          
         CLI   QAGENCY,C'+'        AGENCY SET FILTER?                           
         BNE   FCON0500            NO                                           
*                                                                               
FCON0400 EQU   *                                                                
         OC    QWAGYSET,QWAGYSET   ANY AGENCY FILTERS?                          
         BZ    FCON0520            NO  - THIS PROBABLY SHOULDN'T                
*                                     HAVE HAPPENED....                         
         L     RF,QWAGYSET         YES - COMPARE AGAINST SET                    
FCON0420 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FCON0460            YES - NO MATCH                               
         CLC   RCONKAGY,0(RF)      NO  - AGENCY IN SET?                         
         BNE   FCON0440            NO  - GO CHECK NEXT ENTRY                    
         CLC   4(2,RF),SPACES      ANY AGY OFFICE FILTER?                       
         BE    FCON0480            NO  - ACCEPT THIS RECORD                     
         CLC   RCONKAOF,4(RF)      YES - AGENCY OFFICE IN KEY?                  
         BE    FCON0480            YES - ACCEPT THIS RECORD                     
FCON0440 EQU   *                                                                
         LA    RF,6(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FCON0420            GO BACK FOR NEXT                             
FCON0460 EQU   *                                                                
         TM    QWSETFLG,EXAGYSET   CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FCON0520            YES - ACCEPT RECORD                          
         B     FCON2160            NO  - REJECT RECORD                          
FCON0480 EQU   *                                                                
         TM    QWSETFLG,EXAGYSET   CODE FOUND IN SET: EXCLUDE SET?              
         BO    FCON2160            YES - REJECT IT                              
         B     FCON0520            NO  - ACCEPT IT                              
FCON0500 EQU   *                                                                
         CLC   QAGENCY,RCONKAGY                                                 
         BNE   FCON2160                                                         
*                                                                               
FCON0520 CLC   QADV,SPACES                                                      
         BE    FCON0620                                                         
         CLI   QADV,C'*'           ADVERT SET FILTER?                           
         BNE   FCON0600            NO                                           
         L     RF,QWADVSET         YES - COMPARE AGAINST SET                    
FCON0540 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FCON0560            YES - NO MATCH                               
         CLC   RCONKADV,0(RF)      NO  - ADVERT IN SET?                         
         BE    FCON0580            YES - ACCEPT THIS RECORD                     
         LA    RF,4(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FCON0540            GO BACK FOR NEXT                             
FCON0560 EQU   *                                                                
         TM    QWSETFLG,EXADVSET   CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FCON0620            YES - ACCEPT RECORD                          
         B     FCON2160            NO  - REJECT RECORD                          
FCON0580 EQU   *                                                                
         TM    QWSETFLG,EXADVSET   CODE FOUND IN SET: EXCLUDE SET?              
         BO    FCON2160            YES - REJECT IT                              
         B     FCON0620            NO  - ACCEPT IT                              
FCON0600 EQU   *                                                                
         CLC   QADV,RCONKADV                                                    
         BNE   FCON2160                                                         
*                                                                               
FCON0620 CLI   QDIV,C' '                                                        
         BE    FCON0640                                                         
         CLC   QDIV,RCONTEM                                                     
         BNE   FCON2160                                                         
*                                                                               
FCON0640 CLI   QTEAM,C' '                                                       
         BE    FCON0680                                                         
         CLC   QTEAM,RCONTEM+1                                                  
         BNE   FCON2160                                                         
*                                                                               
FCON0680 CLC   QMAN,SPACES                                                      
         BE    FCON0800                                                         
         CLI   QMAN,C'*'           SALESPERSON SET FILTER?                      
         BNE   FCON0760            NO                                           
         L     RF,QWSALSET         YES - COMPARE AGAINST SET                    
FCON0720 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FCON0730            YES - NO MATCH                               
         CLC   RCONSAL,0(RF)       NO  - SALESPERSON IN SET?                    
         BE    FCON0740            YES                                          
         LA    RF,3(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FCON0720            GO BACK FOR NEXT                             
FCON0730 EQU   *                                                                
         TM    QWSETFLG,EXSALSET   CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FCON0800            YES - ACCEPT RECORD                          
         B     FCON2160            NO  - REJECT RECORD                          
FCON0740 EQU   *                                                                
         TM    QWSETFLG,EXSALSET   CODE FOUND IN SET: EXCLUDE SET?              
         BO    FCON2160            YES - REJECT IT                              
         B     FCON0800            NO  - ACCEPT IT                              
FCON0760 EQU   *                                                                
         CLC   QMAN,RCONSAL                                                     
         BNE   FCON2160                                                         
*                                                                               
FCON0800 CLC   QAGYOFF,SPACES                                                   
         BE    FCON0840                                                         
         CLC   QAGYOFF,RCONKAOF                                                 
         BNE   FCON2160                                                         
*                                                                               
FCON0840 CLI   QCONTYPE,C' '                                                    
         BE    FCON1000                                                         
         CLI   QCONTYPE,C'*'       CONTYPE SET FILTER?                          
         BNE   FCON0920            NO                                           
         TM    QWSETFLG,EXCTYSET   EXCLUSION SET?                               
         BO    FCON0860            YES - CHECK ALL CONTYPES                     
         CLI   RCONTYPE,X'00'      NO  - ANY CONTYPE IN RECORD?                 
         BE    FCON2160            NO  - REJECT RECORD                          
*                                                                               
*        NOTE:  FOR INCLUSION CONTRACT TYPE SETS:                               
*           CONTRACTS WITH NO CONTYPE AT ALL MUST BE BYPASSED IN                
*           ALL CASES.  THESE WOULD BE AUTOMATICALLY BYPASSED FOR               
*           AN INCLUSION SET, AS NOT MATCHING ONE OF THE CODES.                 
*           FOR AN EXCLUSION SET, THERE IS A UNIQUE SITUATION.  IF              
*           THERE IS A CONTRACT TYPE ROW IN THE REPORT, THE SELECTION           
*           OF AN ORDER WITH NO CONTRACT TYPE WILL RESULT IN THAT               
*           ORDER NOT APPEARING, AS THE REPORT WILL NOT PRODUCE A               
*           LINE FOR DATA MISSING A ROW CODE.                                   
*                                                                               
FCON0860 EQU   *                                                                
         L     RF,QWCTYSET         SET A(CONTYPE SET)                           
FCON0880 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FCON0890            YES - NO MATCH                               
         CLC   RCONTYPE,0(RF)      NO  - CONTYPE IN SET?                        
         BE    FCON0900            YES - ACCEPT THIS RECORD                     
         LA    RF,1(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FCON0880            GO BACK FOR NEXT                             
FCON0890 EQU   *                                                                
         TM    QWSETFLG,EXCTYSET   CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FCON1000            YES - ACCEPT RECORD                          
         B     FCON2160            NO  - REJECT RECORD                          
FCON0900 EQU   *                                                                
         TM    QWSETFLG,EXCTYSET   CODE FOUND IN SET: EXCLUDE SET?              
         BO    FCON2160            YES - REJECT IT                              
         B     FCON1000            NO  - ACCEPT IT                              
FCON0920 CLI   QCONTYPE,C' '                                                    
         TM    QCONTYPE,X'40'      LOWER CASE MEANS EXCLUDE FILTER              
         BZ    FCON0960                                                         
         CLC   QCONTYPE,RCONTYPE   INCLUDE FILTER                               
         BE    FCON1000                                                         
**       CLI   QCONTYPE,C'R'                                                    
**       BNE   FCON2160                                                         
**       CLI   RCONTYPE,0                                                       
**       BNE   FCON2160                                                         
**       B     FCON1000                                                         
*                                                                               
         B     FCON2160            EXCLUDE IT                                   
*                                                                               
FCON0960 MVC   BYTE,QCONTYPE       EXCLUDE FILTER                               
         OI    BYTE,X'40'                                                       
         CLC   BYTE,RCONTYPE                                                    
         BE    FCON2160                                                         
**       CLI   BYTE,C'R'                                                        
**       BNE   FCON1000                                                         
**       CLI   RCONTYPE,0                                                       
**       BE    FCON2160                                                         
*                                                                               
FCON1000 CLC   QCLASS,SPACES                                                    
         BE    FCON1040                                                         
         MVI   INFCODE,X'0F'                                                    
         BAS   RE,FRSTFIL1                                                      
         B     FCON1030                                                         
FCON1020 EQU   *                                                                
         BAS   RE,NEXTFIL1                                                      
FCON1030 EQU   *                   CATEGORY CODE NOT FOUND                      
         BNE   FCON2160            TREAT AS 'NOT ACCEPTED'                      
         CLC   RCONCTGY,2(R5)                                                   
         BNE   FCON1020                                                         
         CLC   QCLASS,4(R5)                                                     
         BNE   FCON2160                                                         
*                                                                               
FCON1040 CLC   QCATY,SPACES                                                     
         BE    FCON1080                                                         
         CLC   QCATY,RCONCTGY                                                   
         BNE   FCON2160                                                         
*                                                                               
FCON1080 CLC   QREGION,SPACES                                                   
         BE    FCON1200                                                         
         MVI   INFCODE,4                                                        
         BAS   RE,FRSTFIL1                                                      
         B     *+8                                                              
FCON1120 BAS   RE,NEXTFIL1                                                      
         BE    *+6                                                              
FCON1160 DC    H'0'                                                             
         CLC   RCONKREP,DOFFREP(R5) SAME REP?                                   
         BL    FCON1160            NOT FOUND                                    
         BH    FCON1120                                                         
         CLC   RCONKOFF,DOFFOFF(R5)                                             
         BNE   FCON1120                                                         
         CLC   QREGION,DOFFRGN(R5)                                              
         BNE   FCON2160                                                         
*                                                                               
FCON1200 CLC   QGROUP,SPACES                                                    
         BE    FCON1320                                                         
         CLI   QGROUP,C'*'         GRP/SUBGRP SET FILTER?                       
         BNE   FCON1280            NO                                           
         L     RF,QWGRPSET         YES - COMPARE AGAINST SET                    
*                                                                               
FCON1240 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FCON1260            YES - DON'T ADD TO TOTAL RECS                
         CLI   1(RF),C' '          SET 2ND CHAR = SPACE?                        
*                                     (TEST ONLY GROUP?)                        
         BNE   FCON1250            NO  - TEST 2 CHARS                           
         CLC   RCONKGRP(1),0(RF)   YES - GROUP IN SET?                          
         BE    FCON1270            YES -                                        
FCON1250 EQU   *                                                                
         CLC   RCONKGRP(2),0(RF)   NO  - GROUP/SUBGRP IN SET?                   
         BE    FCON1270            YES -                                        
         LA    RF,2(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FCON1240            GO BACK FOR NEXT                             
FCON1260 EQU   *                                                                
         TM    QWSETFLG,EXGRPSET   CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FCON1360            YES - ACCEPT RECORD                          
         B     FCON2080            NO  - REJECT RECORD                          
FCON1270 EQU   *                                                                
         TM    QWSETFLG,EXGRPSET   CODE FOUND IN SET: EXCLUDE SET?              
         BO    FCON2080            YES - REJECT IT                              
         B     FCON1360            NO  - ACCEPT IT                              
FCON1280 EQU   *                                                                
         CLC   QGROUP,RCONKGRP                                                  
         BNE   FCON2080            DON'T ADD THIS TO ANY TOTAL RECS             
*                                                                               
FCON1320 CLC   QSBGROUP,SPACES                                                  
         BE    FCON1360                                                         
         CLC   QSBGROUP,RCONKGRP+1                                              
         BNE   FCON2160                                                         
*                                                                               
FCON1360 CLC   QPRODUCT,SPACES                                                  
         BE    FCON1400                                                         
         CLC   QPRODUCT,RCONPRD                                                 
         BNE   FCON2160                                                         
*                                                                               
FCON1400 CLC   QSTATYPE,SPACES     STATION TYPE                                 
         BE    FCON1600                                                         
         CLC   RCONKSTA,QWSTNSAV                                                
         BE    FCON1440                                                         
         LA    R4,WORK+50                                                       
         GOTO1 =A(POSTROW),DMCB,=X'16'   GET NUMERICAL STNTYPE                  
*                                                                               
FCON1440 LA    R4,5                FIND NUMERICAL STATYPE CORRESPONDING         
         LA    RF,STATYPES         TO ALPHA STATYPE FILTER                      
*                                                                               
FCON1480 CLC   QSTATYPE,0(RF)      ALPHA TYPE FOUND IN TABLE?                   
         BE    FCON1520            YES -                                        
         LA    RF,2(RF)            NO  - TRY NEXT                               
         BCT   R4,FCON1480                                                      
         B     FCON2160            TYPE NOT FOUND - SKIP IT                     
*                                                                               
FCON1520 EQU   *                                                                
         CLI   1(RF),C'4'          NEW STATYPE ENCOUNTERED?                     
         BL    FCON1560            NO  - TEST OLD TYPE                          
         CLC   QWSTNTY2,1(RF)      CORRECT NEW STATYPE?                         
         BNE   FCON2160            NO  - SKIP IT                                
         B     FCON2120            YES - ACCEPT IT                              
*                                                                               
FCON1560 CLC   QWSTNTYP,1(RF)      CORRECT OLD STATYPE?                         
         BNE   FCON2160            NO  - SKIP IT                                
         B     FCON2120            YES - ACCEPT IT                              
*                                                                               
FCON1600 CLI   QWNREQ,1            TEST 2ND REQUEST CARD                        
         BNH   FCON1800                                                         
         LA    R4,QWREQ2                                                        
         USING QREC2D,R4                                                        
         CLC   Q2PPSON,SPACES      YES-TEST POINT PERSON FILTER                 
         BNH   FCON1760                                                         
         TM    RCONMODR+1,X'10'    KATZ MODIFIED CONTRACT?                      
         BNO   FCON1630            NO  - PROCESS AS USUAL                       
         BAS   RE,FKTZPPSN         YES - FILTER AGAINST KATZ MASTER ELT         
         BZ    FCON1760            CC = ZERO: ACCEPT IT                         
         B     FCON2160            CC NOT ZERO:  REJECT IT                      
         EJECT                                                                  
*                                                                               
*   FILTSUB1:  CHECK FOR BUYLINE CODING FILTERS BEING USED.                     
*                                                                               
FILTSUB1 NTR1                                                                   
         LA    R3,QWREQ3                                                        
         USING QREC3D,R3                                                        
         LA    R1,RCONELEM         CONTRACT DESCRPT ELEMENT                     
         SR    R0,R0               SET CC = ZERO                                
FSUB0020 EQU   *                                                                
         CLI   0(R1),0                                                          
         BE    FSUB0120            NO ELEMENT: NOT FOUND                        
         CLI   0(R1),X'1E'         RANDOM FLAG ELEMENT?                         
         BE    FSUB0140            YES                                          
         CLI   0(R1),X'5F'         BUYLINE CODE TEMPORARY ELEMENT?              
         BE    FSUB0040            YES                                          
FSUB0030 EQU   *                                                                
         ZIC   RF,1(R1)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R1,RF                                                            
         B     FSUB0020            GO BACK FOR NEXT                             
FSUB0040 EQU   *                                                                
         USING RCONBUEL,R1                                                      
         CLC   Q3BLCODE,SPACES     ANY BUYLINE CODE FILTER?                     
         BNH   FSUB0060            NO                                           
         OC    RCONBUCD(3),SPACES  OVERRIDE BINARY ZERO                         
*                                                                               
*   TEST                                                                        
**       MVC   P+1(08),=C'BUYCODE:'                                             
**       MVC   P+9(3),Q3BLCODE                                                  
**       MVI   P+12,C'/'                                                        
**       MVC   P+13(3),RCONBUCD                                                 
**       GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         CLC   Q3BLCODE,RCONBUCD   YES - FILTER CODE IN TEMPORARY ELT?          
         BNE   FSUB0800            NOT FILTER: REJECT                           
FSUB0060 EQU   *                                                                
         CLC   Q3BLATT1,SPACES     ANY BUYLINE CODE ATTRIB 1 FILTER?            
         BNH   FSUB0080            NO                                           
         CLC   Q3BLATT1,RCONBUA1   YES - FILTER CODE IN TEMPORARY ELT?          
         BE    FSUB0080            YES - CHECK NEXT FILTER                      
         CLC   Q3BLATT1,RCONBUA2   NO  - CHECK AGAINST SECOND ATTRIBUTE         
         BNE   FSUB0800            FILTER NOT IN TEMP ELT:  REJECT              
FSUB0080 EQU   *                                                                
         CLC   Q3BLATT2,SPACES     ANY BUYLINE CODE ATTRIB 2 FILTER?            
         BNH   FSUB0100            NO                                           
         CLC   Q3BLATT2,RCONBUA2   YES - FILTER CODE IN TEMPORARY ELT?          
         BE    FSUB0100            YES - FILTERS MATCH                          
         CLC   Q3BLATT2,RCONBUA1   NO  - CHECK AGAINST FIRST ATTRIBUTE          
         BNE   FSUB0800            FILTER NOT IN TEMP ELT:  REJECT              
FSUB0100 EQU   *                                                                
         B     FSUB0900            FILTERS MATCH:  EXIT CC = ZERO               
FSUB0120 EQU   *                                                                
         CLC   Q3BLCODE(7),SPACES  NO ELEMENT: ANY FILTERS?                     
         BNH   FSUB0900            NO FILTERS - EXIT CC ZERO                    
         B     FSUB0800                                                         
FSUB0140 EQU   *                                                                
         USING RCONRFEL,R1                                                      
         CLC   Q3COMPSP,SPACES     ANY COMP S/P CODE FILTER?                    
         BNH   FSUB0030            NO  - GO BACK FOR NEXT ELEMENT               
         CLC   Q3COMPSP,RCONRPSP   YES - FILTER CODE IN RANFLAG ELT?            
         BNE   FSUB0800            NO  - REJECT                                 
         B     FSUB0030            YES - GO BACK FOR NEXT ELEMENT               
FSUB0800 EQU   *                                                                
         LA    R0,1                FILTERS: ERROR - EXIT CC NOT ZERO            
         B     FSUB0900                                                         
FSUB0900 EQU   *                                                                
         LTR   R0,R0               SET CC                                       
         XIT1                                                                   
         DROP  R1,R3                                                            
         EJECT                                                                  
*                                                                               
*                                                                               
*  FKTZPPSN:  KATZ CONVERTED ORDER:  LOOK FOR A MASTER CONTRACT ELT,            
*        FILTER AGAINST POINT PERSON THEREIN.                                   
*                                                                               
FKTZPPSN NTR1                                                                   
         LA    R1,RCONELEM         CONTRACT DESCRPT ELEMENT                     
         SR    R0,R0                                                            
*                                                                               
FKTZ0020 CLI   0(R1),0                                                          
         BE    FKTZ0400            NO ELEMENT: NOT FOUND                        
         CLI   0(R1),X'74'         KATZ MASTER CONTRACT ELEMENT?                
         BE    *+14                YES                                          
         IC    R0,1(R1)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R1,R0                                                            
         B     FKTZ0020            GO BACK FOR NEXT                             
         CLI   Q2PPSON,C'*'        POINT PERSON SET REQUEST?                    
         BE    FKTZ0040            YES - GO CHECK AGAINST SET                   
*                                  NO  - COMPARE AGAINST REQUEST RECORD         
         CLC   Q2PPSON,RCONK4PP-RCONK4EL(R1)                                    
*                                  POINT PERSON VS MASTER CONTRACT ELT          
         BNE   FKTZ0400            NO  - SKIP IT                                
         B     FKTZ0350            YES - ACCEPT IT                              
FKTZ0040 EQU   *                                                                
         L     RF,QWPPRSET         SET A(POINT PERSON SET)                      
FKTZ0080 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FKTZ0120            YES - NO MATCH                               
         CLC   0(3,RF),RCONK4PP-RCONK4EL(R1)                                    
*                                  POINT PERSON IN SET?                         
         BE    FKTZ0160            YES - ACCEPT THIS RECORD                     
         LA    RF,3(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FKTZ0080            GO BACK FOR NEXT                             
FKTZ0120 EQU   *                                                                
         TM    QWSETFLG,EXPPRSET   CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FKTZ0350            YES - ACCEPT RECORD                          
         B     FKTZ0400            NO  - REJECT RECORD                          
FKTZ0160 EQU   *                                                                
         TM    QWSETFLG,EXPPRSET   CODE FOUND IN SET: EXCLUDE SET?              
         BO    FKTZ0400            YES - REJECT IT                              
         B     FKTZ0350            NO  - ACCEPT IT                              
FKTZ0350 EQU   *                                                                
         SR    R0,R0               SET CC = ZERO                                
         B     FKTZ0500                                                         
FKTZ0400 EQU   *                                                                
         LTR   RB,RB               SET CC NOT = ZERO                            
FKTZ0500 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
FCON1630 EQU   *                                                                
         CLC   RCONPRD,SPACES                                                   
         BNH   FCON2160                                                         
         LA    R1,RPRDELEM                                                      
         SR    R0,R0                                                            
*                                                                               
FCON1640 CLI   0(R1),0                                                          
         BE    FCON2160                                                         
         CLI   0(R1),2                                                          
         BE    *+14                                                             
         IC    R0,1(R1)                                                         
         AR    R1,R0                                                            
         B     FCON1640                                                         
         CLI   Q2PPSON,C'*'        POINT PERSON SET REQUEST?                    
         BNE   FCON1720            NO                                           
         L     RF,QWPPRSET         SET A(POINT PERSON SET)                      
FCON1680 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FCON1690            YES - NO MATCH                               
         CLC   0(3,RF),RPRDNPNT-RPRDNELM(R1)                                    
*                                  POINT PERSON IN SET?                         
         BE    FCON1700            YES - ACCEPT THIS RECORD                     
         LA    RF,3(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FCON1680            GO BACK FOR NEXT                             
FCON1690 EQU   *                                                                
         TM    QWSETFLG,EXPPRSET   CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FCON1760            YES - ACCEPT RECORD                          
         B     FCON2160            NO  - REJECT RECORD                          
FCON1700 EQU   *                                                                
         TM    QWSETFLG,EXPPRSET   CODE FOUND IN SET: EXCLUDE SET?              
         BO    FCON2160            YES - REJECT IT                              
         B     FCON1760            NO  - ACCEPT IT                              
FCON1720 EQU   *                                                                
         CLC   Q2PPSON,RPRDNPNT-RPRDNELM(R1)                                    
         BNE   FCON2160                                                         
*                                                                               
FCON1760 EQU   *                                                                
         CLC   Q2NCNUM,SPACES      TEST NETWORK CONTRACT NUMBER FILTER          
         BNH   FCON1800                                                         
         TM    RCONMODR+1,X'10'    KATZ MODIFIED CONTRACT?                      
         BNO   FCON1790            NO  - PROCESS AS USUAL                       
         BAS   RE,FKTZNCON         YES - FILTER AGAINST KATZ MASTER ELT         
         BZ    FCON1800            CC = ZERO: ACCEPT IT                         
         B     FCON2160            CC NOT ZERO:  REJECT IT                      
         EJECT                                                                  
*                                                                               
*  FKTZNCON:  KATZ CONVERTED ORDER:  LOOK FOR A MASTER CONTRACT ELT,            
*        FILTER AGAINST NETWORK CON# THEREIN.                                   
*                                                                               
FKTZNCON NTR1                                                                   
         LA    R1,RCONELEM         CONTRACT DESCRPT ELEMENT                     
         SR    R0,R0                                                            
*                                                                               
FNCN0020 CLI   0(R1),0                                                          
         BE    FNCN0400            NO ELEMENT: NOT FOUND                        
         CLI   0(R1),X'74'         KATZ MASTER CONTRACT ELEMENT?                
         BE    *+14                YES                                          
         IC    R0,1(R1)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R1,R0                                                            
         B     FNCN0020            GO BACK FOR NEXT                             
*                                  NO  - COMPARE AGAINST REQUEST RECORD         
         CLC   Q2NCNUM(7),RCONK4MC-RCONK4EL(R1)                                 
*                                  REQUEST NETCON# VS KATZ NETCON #             
*                                     KATZ IS ONLY 7 CHARS LONG                 
         BNE   FNCN0400            NO  - SKIP IT                                
FNCN0350 EQU   *                                                                
         SR    R0,R0               SET CC = ZERO                                
         B     FNCN0500                                                         
FNCN0400 EQU   *                                                                
         LTR   RB,RB               SET CC NOT = ZERO                            
FNCN0500 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
FCON1790 EQU   *                                                                
         CLC   RCONPRD,SPACES                                                   
         BNH   FCON2160                                                         
         CLC   Q2NCNUM,RPRDNET#                                                 
         BNE   FCON2160                                                         
*                                                                               
FCON1800 EQU   *                                                                
         CLC   Q2DEVSP,SPACES      TEST DEVELOPMENTAL SALESPERSON               
         BNH   FCON1880            NO FILTER                                    
         LA    R1,RCONELEM         FILTER:  LOOK FOR X'18' ELEMENT              
         SR    R0,R0                                                            
*                                                                               
FCON1840 CLI   0(R1),0             END OF RECORD?                               
         BE    FCON2160            YES - NO X'18' - REJECT CONTRACT             
         CLI   0(R1),X'18'         NO  - X'18' ELEMENT?                         
         BE    *+14                YES                                          
         IC    R0,1(R1)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R1,R0                                                            
         B     FCON1840            GO BACK FOR NEXT                             
         CLC   Q2DEVSP,RCONDVSP-RCONDVEL(R1)                                    
         BNE   FCON2160            NOT SAME:  REJECT IT                         
*                                                                               
*                                                                               
FCON1880 EQU   *                                                                
         CLC   QDEVCTYP,SPACES     TEST DEVELOPMENTAL CONTRACT TYPE             
         BNH   FCON2040            NO FILTER                                    
         LA    R1,RCONELEM         FILTER:  LOOK FOR X'18' ELEMENT              
         SR    R0,R0                                                            
*                                                                               
FCON1920 CLI   0(R1),0             END OF RECORD?                               
         BNE   FCON1940            NO  - LOOK FOR X'18' ELEMENT                 
*                                  YES - NO X'18' ELEMENT FOUND =               
*                                     NO DEVCONTYP ENTERED                      
         TM    QWSETFLG,EXDTYSET   IS SET AN EXCLUDE SET?                       
         BO    FCON2040            YES - ACCEPT RECORD                          
         B     FCON2160            NO  - REJECT RECORD                          
FCON1940 EQU   *                                                                
         CLI   0(R1),X'18'         NO  - X'18' ELEMENT?                         
         BE    *+14                YES                                          
         IC    R0,1(R1)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R1,R0                                                            
         B     FCON1920            GO BACK FOR NEXT                             
         CLI   QDEVCTYP,C'*'       DEVTYPE SET FILTER?                          
         BNE   FCON2000            NO                                           
         CLC   RCONDVCT-RCONDVEL(2,R1),X'0000'                                  
*                                  ANY DEVTYPE IN RECORD?                       
         BE    FCON2160            NO  - REJECT RECORD                          
*                                                                               
*        NOTE:  CONTRACTS WITH NO DEVTYPE AT ALL MUST BE BYPASSED IN            
*           ALL CASES.  THESE WOULD BE AUTOMATICALLY BYPASSED FOR               
*           AN INCLUSION SET, AS NOT MATCHING ONE OF THE CODES.  FOR            
*           AN EXCLUSION SET, THEY SHOULD ALSO BE DISCOUNTED, AS                
*           NORMAL PROCESSING WILL NOT PRODUCE A REPORT BY DEVTYPE              
*           WHICH CONTAINS UNASSIGNED CODES.                                    
*                                                                               
         L     RF,QWDTYSET         SET A(DEVTYPE SET)                           
FCON1960 EQU   *                                                                
         CLI   0(RF),0             END OF SET?                                  
         BE    FCON1970            YES - NO MATCH                               
         CLC   0(2,RF),RCONDVCT-RCONDVEL(R1)                                    
*                                  DEV TYPE FOUND IN SET?                       
         BE    FCON1980            YES - ACCEPT THIS RECORD                     
         LA    RF,2(RF)            NO  - BUMP TO NEXT ENTRY                     
         B     FCON1960            GO BACK FOR NEXT                             
FCON1970 EQU   *                                                                
         TM    QWSETFLG,EXDTYSET   CODE NOT FOUND IN SET: EXCLUDE SET?          
         BO    FCON2040            YES - ACCEPT RECORD                          
         B     FCON2160            NO  - REJECT RECORD                          
FCON1980 EQU   *                                                                
         TM    QWSETFLG,EXDTYSET   CODE FOUND IN SET: EXCLUDE SET?              
         BO    FCON2160            YES - REJECT IT                              
         B     FCON2040            NO  - ACCEPT IT                              
FCON2000 EQU   *                                                                
         CLC   QDEVCTYP,RCONDVCT-RCONDVEL(R1)                                   
         BNE   FCON2160            NOT SAME:  REJECT IT                         
*                                                                               
*                                                                               
FCON2040 EQU   *                                                                
         B     FCON2120                                                         
FCON2080 CR    RB,R9               FILTERED AND DON'T INCLUDE IN TOTALS         
         B     FCON2200            CC = 1                                       
*                                                                               
FCON2120 CR    RB,RB               NOT FILTERED                                 
         B     FCON2200            CC = 0                                       
*                                                                               
FCON2160 EQU   *                                                                
         CR    R9,RB               FILTERED, BUT INCLUDE IN TOTALS              
*                                  CC = 2                                       
FCON2200 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
         DROP  R2                                                               
         SPACE 2                                                                
STATYPES DC    C'C1N2O3J4L5'       COMPARABLE/NEW/OLD/JOINED/LEFT               
         EJECT                                                                  
*                                                                               
*        ROUTINE TO FIND INFORMATION ELEMENT FROM INFO POOL                     
*              INPUT:  INFCODE = ELEMENT CODE                                   
*              OUTPUT: R5      = A(ELEMENT)                                     
*                                                                               
         SPACE                                                                  
FRSTFIL1 L     R5,ASPACND4                                                      
*                                                                               
FF010    CLI   0(R5),0                                                          
         BE    FF999                                                            
         CLC   INFCODE,0(R5)                                                    
         BER   RE                                                               
*                                                                               
NEXTFIL1 SR    R0,R0                                                            
         ICM   R0,1,1(R5)                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R5,R0                                                            
         B     FF010                                                            
*                                                                               
FF999    LTR   RE,RE                                                            
         BR    RE                                                               
*                                                                               
         DROP  R4                                                               
*                                                                               
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
* SPECSET:  FILTER CONTRACT IN PROGRESS AGAINST A FIXED SET OF        *         
*        CONTRACT TYPES AND, FOR 1 CONTYPE, A SPECIFIC DEV CONTYPE.   *         
*        RETURN CONDITION CODE NOT ZERO = NOT ACCEPTED.               *         
*        ACCEPT ALL CONTRACTS WITH CONTYPE NDAYF.  IF CONTYPE = S,    *         
*           DEV CONTYPE MUST BE 'NB'/'HB'/'UB'.  PER SOPHIA 3/21/97   *         
*        REMOVE 'HB' FROM FILTER SET             PER SOPHIA 5/22/97   *         
***********************************************************************         
SPECSET  NMOD1 0,**SPST**                                                       
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED THROUGH - DON'T CHANGE IT                      
*                                                                               
         CLI   RCONTYPE,C'N'                                                    
         BE    SPST0080            ACCEPT CONTRACT                              
         CLI   RCONTYPE,C'D'                                                    
         BE    SPST0080            ACCEPT CONTRACT                              
         CLI   RCONTYPE,C'A'                                                    
         BE    SPST0080            ACCEPT CONTRACT                              
         CLI   RCONTYPE,C'Y'                                                    
         BE    SPST0080            ACCEPT CONTRACT                              
         CLI   RCONTYPE,C'F'                                                    
         BE    SPST0080            ACCEPT CONTRACT                              
         CLI   RCONTYPE,C'S'                                                    
         BNE   SPST0100            DON'T ACCEPT CONTRACT                        
         LA    R1,RCONELEM         TYPE S:  CHECK DEV CONTYPE                   
SPST0020 EQU   *                                                                
         CLI   0(R1),0             END OF RECORD?                               
         BE    SPST0100            YES - DON'T ACCEPT RECORD                    
         CLI   0(R1),X'18'         DEVEL ELEMENT?                               
         BE    SPST0040            YES - CHECK DEV CONTYPE                      
         ZIC   RF,1(R1)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R1,RF                                                            
         B     SPST0020            GO BACK FOR NEXT                             
SPST0040 EQU   *                                                                
         CLC   =C'NB',RCONDVCT-RCONDVEL(R1)                                     
*                                  DEV CON TYPE = 'NB'?                         
         BE    SPST0080            YES -  ACCEPT CONTRACT                       
***      CLC   =C'HB',RCONDVCT-RCONDVEL(R1)                                     
*                                  DEV CON TYPE = 'HB'?                         
***      BE    SPST0080            YES -  ACCEPT CONTRACT                       
         CLC   =C'UB',RCONDVCT-RCONDVEL(R1)                                     
*                                  DEV CON TYPE = 'UB'?                         
         BNE   SPST0100            NO  - DON'T ACCEPT CONTRACT                  
SPST0080 EQU   *                                                                
         SR    R0,R0               SET CC = ZERO: ACCEPT                        
         B     SPST0120            EXIT                                         
SPST0100 EQU   *                                                                
         LTR   RB,RB               SET CC NOT ZERO: DON'T ACCEPT                
SPST0120 EQU   *                                                                
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*                                                                               
***********************************************************************         
*  LOADSET: RETRIEVE AND INSERT PARTICIPANTS IN EACH TYPE OF  SET     *         
***********************************************************************         
LOADSET  NMOD1 0,**LSET**                                                       
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED THROUGH - DON'T CHANGE IT                      
*                                                                               
         LA    R7,WORK+32          SET A(WORKSPACE FOR LOAD)                    
         USING RSETLOAD,R7         SET ADDRESSABILITY                           
*                                                                               
         XC    KEY,KEY                                                          
         MVI   KEY,X'38'           ACCESS SET RECORD                            
         MVC   KEY+19(2),QREP      INSERT REP CODE                              
         CLC   QREP,=C'SJ'         DDS TEST REP?                                
         BE    LSET0010            YES                                          
*                                                                               
         CLI   RSETRMST,1          CHECK FOR MASTER/SUB?                        
         BNE   LSET0010            NO  - SKIP CHECK                             
*                                                                               
         CLC   =C'AM',QREP         KATZ AMERICAN?                               
         BE    LSET0004            YES                                          
         CLC   =C'8K',QREP         KATZ SYNDICATED?                             
         BE    LSET0004            YES                                          
         CLC   =C'CQ',QREP         KATZ CONTINENTAL?                            
         BNE   LSET0008            NO                                           
LSET0004 EQU   *                                                                
         MVC   KEY+19(2),=C'MR'    SET KATZ TV MASTER FOR SETS                  
LSET0008 EQU   *                                                                
         CLI   CMBOREP,C'Y'        MASTER OR SUBS?                              
         BNE   LSET0010            NO                                           
         MVC   KEY+19(2),CMBOMSTR  YES - FORCE TO MASTER                        
LSET0010 EQU   *                                                                
         MVC   KEY+21(2),RSETRTYP  INSERT SET TYPE                              
         L     RF,RSETRNAM         LOAD A(SET NAME ON REQUEST CARD)             
         MVC   KEY+23(4),0(RF)     INSERT SET NAME                              
*                                                                               
         GOTO1 AHIGH                                                            
         CLC   KEY(27),KEYSAVE     KEY FOUND?                                   
         BE    *+6                 YES                                          
         DC    H'0'                NO  - SHOULD HAVE BEEN THERE                 
         MVI   BYTE,C'N'           SET OF SETS --> NO                           
         GOTO1 AGETSET             RETRIEVE RECORD                              
         L     RF,RSETWADD         SET A(ADDR OF SET IN QWKD AREA)              
         MVC   0(4,RF),ANEXTSET    SET A(NEXT SET SPACE FOR GSG)                
         LA    R3,IOAREA                                                        
         USING RSETRECD,R3                                                      
         LA    R4,RSETELEM                                                      
         CLI   0(R4),X'01'         NEW FORMAT/01 DESC ELT?                      
         BNE   LSET0060            NO  - USE OLD FORMAT RECORD                  
         TM    RSET1FLG-RSET1DES(R4),X'08'                                      
*                                  EXCLUSION SET?                               
         BNO   LSET0020            NO                                           
         LA    RF,QWSETFLG         YES - SET A(EXCLUDE FLAGS BYTE)              
         ZIC   RE,RSETROFF         SET BYTE DISPLACEMENT                        
         AR    RF,RE               ADD DISPLACEMENT VALUE                       
         OC    0(1,RF),RSETRFLG    TURN ON EXCLUDE FLAG VALUE                   
LSET0020 EQU   *                                                                
         TM    RSET1FLG-RSET1DES(R4),X'80'                                      
*                                  SET OF SETS?                                 
         BNO   LSET0060            NO  -                                        
         LA    RF,IOAREA                                                        
         A     RF,=F'1000'         BUMP TO IOAREA+1000                          
         PRINT GEN                                                              
         MOVE  ((RF),1000),IOAREA                                               
         PRINT NOGEN                                                            
*                                  YES - SAVE SET OF SETS RECORD                
*                                     SET OF SETS WILL NEVER BE VERY            
*                                     LONG RECORDS - USE SECOND HALF            
*                                                                               
         A     R4,=F'1000'         ADDRESS R4 TO NEW AREA                       
*                                                                               
         MVI   BYTE,C'Y'           SET OF SETS = YES                            
         ZIC   RF,1(R4)            BUMP TO X'10' ELEMENT                        
         AR    R4,RF                                                            
         ZIC   RF,1(R4)            BUMP TO X'20' ELEMENT                        
         AR    R4,RF                                                            
         CLI   0(R4),X'20'         20 ELEMENT IN SET OF SETS                    
         BE    *+6                 FOUND                                        
         DC    H'0'                NOT FOUND: 1ST ELT MUST BE THERE             
         ZIC   RF,1(R4)            SET END OF RECORD INDICATOR                  
         LR    RE,R4                                                            
         AR    RE,RF                                                            
         XC    0(4,RE),0(RE)       SET TO ZERO                                  
*                                                                               
         LA    R4,3(R4)            BUMP TO 1ST ELEMENT IN SET                   
LSET0040 EQU   *                                                                
         MVC   KEY+23(4),0(R4)     INSERT SET CODE FROM SET OF SETS             
         GOTO1 AHIGH               RETRIEVE RECORD FOR SET                      
         CLC   KEY(27),KEYSAVE     KEY FOUND?                                   
         BNE   LSET0080            NO  - SKIP IT                                
         GOTO1 AGETSET             RETRIEVE SET RECORD INTO 1ST HALF            
*                                     OF IOAREA                                 
LSET0060 EQU   *                                                                
         BAS   RE,LOADSET2         UNLOAD SET TO STORAGE                        
         CLI   BYTE,C'N'           SET OF SETS?                                 
         BE    LSET0100            NO  - SINGLE SET LOADED                      
LSET0080 EQU   *                                                                
         LA    R4,4(R4)            BUMP TO NEXT SET CODE                        
         OC    0(4,R4),0(R4)       ANY SET CODE?                                
         BNZ   LSET0040            YES - GO BACK FOR NEXT                       
LSET0100 EQU   *                                                                
*                                                                               
         L     RF,ANEXTSET                                                      
         A     RF,RSETRSIZ         SKIP THE DELIMITER (BY SIZE)                 
         ST    RF,ANEXTSET         SAVE A(START OF NEXT SET)                    
*                                                                               
*                                                                               
         CLC   =C'SETPRINT',QWREQ+(QUESTOR-QRECORD)                             
         BNE   LSET0120                                                         
         LA    RF,1000             DISPLAY 1000 CHARACTERS                      
         L     RE,RSETWADD         SET A(QWKD AREA FOR SET)                     
         L     R6,0(RE)            SET A(AREA TO DISPLAY)                       
         PRINT GEN                                                              
         GOTO1 =V(PRNTBL),DMCB,0,(R6),C'DUMP',(RF),=C'2D'                       
         PRINT NOGEN                                                            
LSET0120 EQU   *                                                                
         CLC   =C'SETPRINT',QWREQ+(QUESTOR-QRECORD)                             
         BNE   LSET0160                                                         
         LA    RF,1000             DISPLAY 1000 CHARACTERS                      
         L     R6,AFRSTSET         SET A(AREA TO DISPLAY)                       
         PRINT GEN                                                              
         GOTO1 =V(PRNTBL),DMCB,0,(R6),C'DUMP',(RF),=C'2D'                       
         PRINT NOGEN                                                            
LSET0160 EQU   *                                                                
*                                                                               
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*   LOADSET2:  UNLOADS INDIVIDUAL SET RECORD TO STORAGE.   SET UP               
*              AS SUBROUTINE TO PRESERVE REGISTERS USED.                        
*                                                                               
LOADSET2 NTR1                                                                   
         LA    R4,RSETELEM         SET R4 LOCALLY TO DETAIL SET REC             
         CLI   0(R4),1             NEW/OLD FORMAT ELEMENT?                      
         BNE   LSET2015            OLD FORMAT - NO X'01' ELEMENT                
*                                     ALREADY AT X'10'                          
         ZIC   RF,1(R4)            BUMP TO X'10' ELEMENT                        
         AR    R4,RF                                                            
LSET2015 EQU   *                                                                
         ZIC   RF,1(R4)            BUMP TO X'20' ELEMENT                        
         AR    R4,RF                                                            
         CLI   0(R4),X'20'                                                      
         BE    *+6                 FOUND                                        
         DC    H'0'                NOT FOUND: 1ST ELT MUST BE THERE             
         LR    R5,R4               SAVE A(ELT BEING PROCESSED)                  
         ZIC   RF,1(R4)            GET ELEMENT LENGTH                           
         LA    RE,3                SUBTRACT CONTROL                             
         SR    RF,RE                                                            
         SR    RE,RE                                                            
         D     RE,RSETRSIZ         DIVIDE BY SIZE OF ENTRY                      
         L     RE,ANEXTSET         SET A(GROUP/SUBGRP) IN WORKAREA              
         LA    R4,3(R4)            A(1ST GROUP/SUBGRP IN SET)                   
LSET2020 EQU   *                                                                
         L     R1,RSETRSIZ         SET SIZE OF ENTRY                            
         EX    R1,LSETMVC          MOVE  ENTRY BY LENGTH                        
         A     RE,RSETRSIZ         BUMP TO NEXT SLOT                            
         EX    R1,LSETXC           CLEAR ENTRY BY LENGTH                        
         B     LSET2025                                                         
*                                                                               
LSETMVC  MVC   0(0,RE),0(R4)                                                    
LSETXC   XC    0(0,RE),0(RE)       CLEAR THE NEXT SLOT: SETS END                
*                                                                               
LSET2025 EQU   *                      OF SET VALUE OF X'00'                     
         A     R4,RSETRSIZ         BUMP TO NEXT SLOT                            
         BCT   RF,LSET2020         LOOP                                         
         ST    RE,ANEXTSET         SAVE NEXT SLOT FOR NEXT ELT                  
         LR    R4,R5               RESET A(ELT BEING PROCESSED)                 
LSET2030 EQU   *                                                                
         ZIC   RF,1(R4)            BUMP TO NEXT ELEMENT                         
         AR    R4,RF                                                            
         CLI   0(R4),0             END OF RECORD?                               
         BE    LSET2040            YES                                          
         CLI   0(R4),X'20'         SET ELEMENT?                                 
         BNE   LSET2030            NO  - SKIP IT                                
         LR    R5,R4               YES - SAVE A(ELT BEING PROCESSED)            
         ZIC   RF,1(R4)            GET ELT LENGTH                               
         LA    RE,3                SUBTRACT CONTROL                             
         SR    RF,RE                                                            
         SR    RE,RE                                                            
         D     RE,RSETRSIZ         DIVIDE BY ENTRY LENGTH                       
         LA    R4,3(R4)            A(1ST ENTRY IN ELT)                          
         L     RE,ANEXTSET         RESTORE NEXT SLOT FOR NEW ELT                
         B     LSET2020            GO BACK AND LOAD ELEMENTS                    
LSET2040 EQU   *                                                                
         ST    RE,ANEXTSET         SET A(NEXT OPEN SLOT)                        
         XIT1                                                                   
*                                                                               
         DROP  R3                                                               
*                                                                               
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*                                                                               
***********************************************************************         
*  LOADTER: RETRIEVE AND INSERT PARTICIPANTS IN EACH TYPE OF  SET     *         
***********************************************************************         
LOADTER  NMOD1 0,**LTER**                                                       
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED THROUGH - DON'T CHANGE IT                      
*                                                                               
         LA    R7,WORK+32          SET A(WORKSPACE FOR LOAD)                    
         USING RSETLOAD,R7         SET ADDRESSABILITY                           
*                                                                               
         XC    KEY,KEY                                                          
         MVI   KEY,X'AA'           ACCESS TERRITORY PASSIVE PTRS                
         MVC   KEY+17(2),QREP      INSERT REP CODE                              
         CLC   QREP,=C'SJ'         DDS TEST REP?                                
         BE    LTER0020            YES                                          
*                                                                               
         CLI   RSETRMST,1          CHECK FOR MASTER/SUB?                        
         BNE   LTER0020            NO  - SKIP CHECK                             
*                                                                               
         CLI   CMBOREP,C'Y'        MASTER OR SUBS?                              
         BNE   LTER0020            NO                                           
         MVC   KEY+17(2),CMBOMSTR  YES - FORCE TO MASTER                        
LTER0020 EQU   *                                                                
         L     R3,RSETWADD         SET A(ADDR OF SET IN QWKD AREA)              
         MVC   0(4,R3),ANEXTSET    SET A(NEXT SET SPACE)                        
*                                                                               
         L     R3,ANEXTSET         SET A(SET ENTRIES IN WORKSPACE)              
*                                                                               
         L     RF,RSETRNAM         LOAD A(SET NAME ON REQUEST CARD)             
         MVC   KEY+19(2),0(RF)     INSERT TERRITORY CODE                        
*                                                                               
         GOTO1 AHIGH               READ FIRST OF TYPE                           
         B     LTER0060                                                         
LTER0040 EQU   *                                                                
         GOTO1 ASEQ                READ NEXT RECORD                             
LTER0060 EQU   *                                                                
         CLC   KEY(21),KEYSAVE     SAME RECTYPE/REP/TERRITORY?                  
         BNE   LTER0080            NO  - FINISHED                               
         MVC   0(6,R3),KEY+21      SAVE AGENCY/AGYOFF IN TERRITORY              
         OC    0(6,R3),SPACES      SET AGY/OFF TO SPACES IF EMPTY               
         A     R3,RSETRSIZ         ADD FOR ENTRY IN TABLE                       
         ST    R3,ANEXTSET         SAVE A(START OF NEXT ENTRY)                  
         B     LTER0040            GO BACK FOR NEXT                             
LTER0080 EQU   *                                                                
*                                                                               
         A     R3,RSETRSIZ         SKIP THE DELIMITER (BY SIZE)                 
         ST    R3,ANEXTSET         SAVE A(START OF NEXT SET)                    
*                                                                               
*                                                                               
         CLC   =C'SETPRINT',QWREQ+(QUESTOR-QRECORD)                             
         BNE   LTER0100                                                         
         LA    RF,1000             DISPLAY 1000 CHARACTERS                      
         L     RE,RSETWADD         SET A(QWKD AREA FOR SET)                     
         L     R6,0(RE)            SET A(AREA TO DISPLAY)                       
         PRINT GEN                                                              
         GOTO1 =V(PRNTBL),DMCB,0,(R6),C'DUMP',(RF),=C'2D'                       
         PRINT NOGEN                                                            
LTER0100 EQU   *                                                                
         CLC   =C'SETPRINT',QWREQ+(QUESTOR-QRECORD)                             
         BNE   LTER0120                                                         
         LA    RF,1000             DISPLAY 1000 CHARACTERS                      
         L     R6,AFRSTSET         SET A(AREA TO DISPLAY)                       
         PRINT GEN                                                              
         GOTO1 =V(PRNTBL),DMCB,0,(R6),C'DUMP',(RF),=C'2D'                       
         PRINT NOGEN                                                            
LTER0120 EQU   *                                                                
*                                                                               
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
         DROP  R7                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*                                                                               
***********************************************************************         
* LOSSCHEK:  AN SPL LOSS RECORD HAS BEEN IDENTIFIED.  THE REPORT SPEC *         
*     IS NOT AN 'AGGSPL'.  IF THE CONTRACT IS WITHIN THE REPORT PER-  *         
*     IOD, A RECORD MUST BE FORCED OUT FOR THIS KEY                   *         
***********************************************************************         
LOSSCHEK NMOD1 0,**LSCH**                                                       
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED THROUGH - DON'T CHANGE IT                      
*                                                                               
         GOTO1 =A(FLITDATE),DMCB,(RC)  CALCULATE ORDER FLIGHT DATES             
*                                                                               
**       GOTO1 DATCON,DMCB,(3,RCONDATE),(0,WORK)   GET FLIGHT START/            
**       GOTO1 GETBROAD,DMCB,WORK,WORK+6                      END DATES         
**       GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
**       MVC   FLIGHTST,FULL                                                    
**       GOTO1 DATCON,DMCB,(3,RCONDATE+3),(0,WORK)                              
**       GOTO1 GETBROAD,DMCB,WORK,WORK+6                                        
**       GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
**       MVC   FLIGHTND,FULL                                                    
*                                                                               
         CLI   THREE+1,1           CHECK PRIOR DATES ONLY?                      
         BNE   LSCH0005            NO                                           
         CLC   FLIGHTND,QWPRIST    FLIGHT ENDS BEFORE REP PERIOD?               
         BL    LSCH0050            YES - SKIP                                   
         CLC   QWPRIND(2),FLIGHTST FLIGHT STARTS AFTER REP PERIOD?              
         BL    LSCH0050            YES - SKIP                                   
         B     LSCH0020            IN PRIOR YEAR: USE LOSS AS-IS                
LSCH0005 EQU   *                                                                
         CLC   FLIGHTND,QWCURST    FLIGHT ENDS BEFORE REP PERIOD?               
         BL    LSCH0050            YES - GO FOR NEXT BUCKET                     
         CLC   QWCURND(2),FLIGHTST FLIGHT STARTS AFTER REP PERIOD?              
         BL    LSCH0050            YES - GO FOR NEXT BUCKET                     
         CLI   THSWKFLG,C'Y'       SPL AS-RUN THIS WEEK?                        
         BNE   LSCH0020            NO  - USE LOSS AS-IS                         
         MVI   THSWKFLG,C'N'       YES - TURN OFF FLAG                          
         LA    R1,RCONELEM         FIND TRUE ACTIV DATE ELT                     
LSCH0010 EQU   *                                                                
         ZIC   R0,1(R1)            ELT LENGTH                                   
         AR    R1,R0               BUMP TO NEXT ELT                             
         CLI   0(R1),0             END OF RECORD?                               
         BE    LSCH0020            YES - NO DATE - USE $$                       
         CLI   0(R1),X'08'         TRUE ACTIV DATE ELT?                         
         BNE   LSCH0010            NO  - GO BACK FOR NEXT                       
         MVC   WORK(3),RCONACTA-RCONACEL(1)                                     
*                                  UNLOAD TRUE ACTIVITY DATE                    
         GOTO1 DATCON,DMCB,(3,WORK),(0,WORK+12)                                 
*                                  CONV 3-BYTE DATE TO EBCDIC YYMMDD            
*                                  TRUE DATE MUST BE SET TO MONDAY              
*                                     OF WEEK OF ACTIVITY                       
         GOTO1 GETDAY,DMCB,WORK+12,FULL                                         
*                                  GET DAY OF WEEK                              
         CLC   FULL(3),SPACES                                                   
         BNE   *+6                                                              
         DC    H'0'                                                             
         ZIC   RE,DMCB             DAY OF WEEK RETURNED                         
         BCTR  RE,R0               DECREMENT BY 1                               
         LNR   RE,RE               NEGATE FOR SUBTRACTION                       
         CLI   RREPPROF+27,C'Y'    DAILY PACING?                                
         BNE   LSCH0015            NO                                           
         SR    RE,RE               CLEAR DAY ADJUSTMENT                         
LSCH0015 EQU   *                                                                
         ST    RE,DMCB+8                                                        
         GOTO1 ADDAY,DMCB,WORK+12,WORK+4                                        
         GOTO1 DATCON,DMCB,(0,WORK+4),(2,WORK)                                  
*                                  CONVERT YYMMDD EBCDIC TO 2-BYTE              
         CLC   WORK(2),QWMONFOR    CHECK TRUE ACTIV DATE                        
*                                     VS CURRENT AS-AT DATE                     
         BNE   LSCH0050            NOT 'THIS WEEK' - GO FOR NEXT                
*                                     BUCKET                                    
LSCH0020 EQU   *                                                                
         SR    RF,RF               SET CC = ZERO                                
         B     LSCH0100            EXIT ROUTINE                                 
LSCH0050 EQU   *                                                                
         LTR   RB,RB               SET CC NOT = ZERO                            
LSCH0100 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
* EXTENTION ROUTINES                                                  *         
***********************************************************************         
         SPACE 1                                                                
         DS    0F                                                               
EXTRA    NMOD1 0,**RG2X**                                                       
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
         SRL   RF,24                                                            
         SLL   RF,2                                                             
         B     *+4(RF)                                                          
*                                                                               
         B     HIGH                                                             
         B     SEQ                                                              
         B     GETCONT                                                          
         B     GETBUD                                                           
         B     GETPROD                                                          
         B     GETCOM                                                           
         B     GETSTA                                                           
         B     GETEOM                                                           
         B     GETSET                                                           
         B     PUTBUFF                                                          
         B     HIGHBUFF                                                         
         B     SEQBUFF                                                          
         B     RSETBUFF                                                         
         B     PUTMERGE                                                         
         B     DUMPBUFF                                                         
         B     GETBUY                                                           
         B     GETSPB              SPECIAL BUYLINE CODE                         
*                                                                               
EXIT     XIT1                                                                   
         EJECT                                                                  
*                                                                               
*        DATA MANAGER INTERFACE (DIRECTORY)                                     
*                                                                               
         SPACE 1                                                                
HIGH     LA    RF,DMRDHI                                                        
         MVC   KEYSAVE,KEY                                                      
         B     LINKDIR                                                          
*                                                                               
SEQ      LA    RF,DMRSEQ                                                        
         MVC   KEYSAVE,KEY                                                      
         B     LINKDIR                                                          
*                                                                               
LINKDIR  ST    RF,DMCB                                                          
         MVC   TRACEKEY,KEY                                                     
         MVC   DMCB(1),DMINBTS                                                  
         GOTO1 DATAMGR,DMCB,,REPDIR,KEY,KEY,0                                   
         B     DMCHECK                                                          
         EJECT                                                                  
*                                                                               
*        DATA MANAGER INTERFACE (FILE GETS)                                     
*                                                                               
         SPACE                                                                  
GETCONT  LA    RF,RCONREC                                                       
         B     LINKFILE                                                         
*                                                                               
GETBUD   LA    RF,RBUDREC                                                       
         B     LINKFILE                                                         
*                                                                               
GETPROD  LA    RF,RPRDREC                                                       
         B     LINKFILE                                                         
*                                                                               
GETCOM   LA    RF,IOAREA                                                        
         B     LINKFILE                                                         
*                                                                               
GETSTA   LA    RF,RSTAREC                                                       
         B     LINKFILE                                                         
*                                                                               
GETEOM   LA    RF,REOMREC                                                       
         B     LINKFILE                                                         
*                                                                               
GETSET   LA    RF,IOAREA                                                        
         B     LINKFILE                                                         
*                                                                               
GETBUY   LA    RF,RBUYREC                                                       
         B     LINKFILE                                                         
*                                                                               
GETSPB   LA    RF,IOAREA                                                        
         B     LINKFILE                                                         
*                                                                               
*                                                                               
LINKFILE LR    R2,RF                                                            
         GOTO1 DATAMGR,DMCB,(DMINBTS,GETREC),REPFILE,KEY+28,           X        
               (R2),(0,DMWORK)                                                  
         MVC   LASTIO,DMCB+12      SAVE THESE VALUES                            
         MVC   LASTDA,KEY+28                                                    
         MVC   LASTLEN,27(R2)                                                   
         B     DMCHECK                                                          
         EJECT                                                                  
*                                                                               
*        DATA MANAGER INTERFACE (CHECK ERRORS)                                  
*                                                                               
         SPACE                                                                  
DMCHECK  TM    DMCB+8,X'10'        TEST FOR RECORD NOT FOUND                    
         BZ    DM010                                                            
         TM    29(R2),X'80'        IS RECORD MARKED FOR DELETION                
         BZ    DM020               NO - ERROR                                   
         LTR   RB,RB               YES - RETURN WITH CC NE 0                    
         B     EXIT                                                             
*                                                                               
DM010    TM    DMCB+8,X'EF'        TEST FOR OTHER ERRORS                        
         BZ    EXIT                                                             
*                                                                               
DM020    MVC   WORK(41),=C'*** DATA MANAGER ERROR IN INPUT PHASE ***'           
         GOTO1 LOGIO,WORK+48,1,(41,WORK)                                        
         MVC   WORK(41),SPACES                                                  
         BASR  RE,RF                                                            
         BAS   RE,DMTRACE                                                       
         DC    H'0'            BLOW UP                                          
         EJECT                                                                  
*                                                                               
*        ROUTINE TO TRACE DATA MANAGER CALLS                                    
*                                                                               
         SPACE                                                                  
DMTRACE  NTR1                                                                   
         MVC   P,SPACES                                                         
         LM    R2,R5,DMCB                                                       
         MVC   TRACEDM8,DMCB+8                                                  
         MVC   P(8),0(R2)          COMMAND                                      
         MVC   P+10(8),0(R3)       FILE                                         
         LA    R6,4                                                             
         CLC   3(3,R3),=C'DIR'                                                  
         BNE   DMTRACE2                                                         
         LA    R4,TRACEKEY                                                      
         GOTO1 HEXOUT,DMCB,(R4),P+20,32,=C'N'                                   
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,(R1),(R5)                                                 
         GOTO1 HEXOUT,DMCB,(R5),P+20,32,=C'N'                                   
         B     DMTRACE4                                                         
*                                                                               
DMTRACE2 GOTO1 HEXOUT,DMCB,(R4),P+20,(R6),=C'N'                                 
         LA    R5,34(R5)                                                        
         GOTO1 HEXOUT,DMCB,(R5),P+75,25                                         
*                                                                               
DMTRACE4 DS    0H                                                               
         GOTO1 HEXOUT,DMCB,TRACEDM8,P+130,1                                     
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 REPORT                                                           
         B     EXIT                                                             
         SPACE 2                                                                
TRACEDM8 DS    C                                                                
         EJECT                                                                  
*                                                                               
*              BUFFALO I/O                                                      
*                                                                               
PUTBUFF  ST    R5,FULL                                                          
         L     R5,BUFFC                                                         
         USING BUFFALOD,R5                                                      
         CLC   BUFFSOFA,BUFFCRMX                                                
         BL    PU010                                                            
         ST    RE,DUB              LINES IN CORE FULL                           
         L     RE,=A(WKSPACE)                                                   
         MVC   0(L'BFREC,RE),BFREC   SAVE BUFFALO RECORD                        
         GOTO1 APUTMERG            WRITE THEM OUT TO MERGER                     
         L     RE,=A(WKSPACE)                                                   
         MVC   BFREC,0(RE)         RESTORE BUFFALO RECORD                       
         L     RE,DUB                                                           
*                                                                               
PU010    EQU   *                                                                
         L     R5,FULL                                                          
         LA    R1,=C'PUT'                                                       
         B     BUFFX                                                            
*                                                                               
*                                                                               
HIGHBUFF XC    BFKEY,BFKEY                                                      
         LA    R1,=C'HIGH'                                                      
         B     BUFFX                                                            
*                                                                               
SEQBUFF  LA    R1,=C'SEQ'                                                       
         B     BUFFX                                                            
*                                                                               
RSETBUFF LA    R1,=C'RESET'                                                     
         B     BUFFX                                                            
*                                                                               
BUFFX    ST    R1,DMCB                                                          
         GOTO1 BUFFALO,DMCB,,BUFFC,BFREC,1                                      
         TM    DMCB+8,X'80'                                                     
         B     EXIT                                                             
         EJECT                                                                  
PUTMERGE DS    0H                                                               
         GOTO1 AHIGHBUF            READ FIRST BUFFALO RECORD                    
         BNZ   EXIT                                                             
*                                                                               
PG010    EQU   *                                                                
         GOTO1 MERGER,DMCB,=C'PUT',BFREC   PUT IT TO MERGER                     
         PUT   BKUP,BFREC          PUT TO RESTART FILE                          
         GOTO1 ASEQBUFF            READ NEXT BUFFALO RECORD                     
         BZ    PG010                                                            
         GOTO1 ARSETBUF            RESET BUFFALO                                
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
*        DUMP ROUTINES FOR TRACE                                                
*                                                                               
         SPACE                                                                  
DUMPBUFF CLI   RECORD,C'C'                                                      
         BNE   DB005                                                            
         MVC   P(10),=C'CONTRACT ='                                             
         ZAP   DUB,=P'0'                                                        
         MVO   DUB+3(5),RCONKCON                                                
         EDIT  (P5,DUB+3),(8,P+12)                                              
         MVI   SPACING,2                                                        
         GOTO1 REPORT              DUMP CONTRACT NUMBER                         
         B     DB010                                                            
*                                                                               
DB005    CLI   RECORD,C'B'                                                      
         BE    *+6                                                              
***>>>   BE    EXIT                DON'T PRINT BUDGET RECORDS                   
         DC    H'0'                                                             
         MVC   P(13),=C'BUDGET YEAR ='                                          
         MVC   P+14(2),RBUDKYR                                                  
         MVI   SPACING,2                                                        
         GOTO1 REPORT              DUMP BUDGET RECORD YEAR                      
         B     DB010                                                            
*                                                                               
DB010    EQU   *                                                                
         MVC   P(08),=C'COMMENT:'                                               
         MVC   P+9(20),BFCOM                                                    
         MVI   SPACING,1                                                        
         GOTO1 REPORT                                                           
*                                                                               
         LA    R2,P                                                             
         LA    R3,PSECOND                                                       
         LA    R4,BFKEY                                                         
         LA    R5,12                                                            
*                                                                               
DB020    MVC   0(9,R2),0(R4)                                                    
         GOTO1 HEXOUT,DMCB,(R2),(R3),9,=C'SEP'                                  
         MVC   132(9,R3),9(R3)                                                  
         MVI   9(R3),C' '                                                       
         LA    R2,10(R2)                                                        
         LA    R3,10(R3)                                                        
         LA    R4,9(R4)                                                         
         BCT   R5,DB020                                                         
         MVC   PSECOND+119(12),SPACES                                           
         MVI   SPACING,2                                                        
         GOTO1 REPORT              DUMP KEYS                                    
         LA    R3,P                                                             
         LA    R4,BFACCS                                                        
         LA    R5,20                                                            
*                                                                               
DB030    GOTO1 HEXOUT,DMCB,(R4),(R3),4,=C'SEP'                                  
         MVC   132(4,R3),4(R3)                                                  
         MVI   4(R3),C' '                                                       
         LA    R3,5(R3)                                                         
         LA    R4,4(R4)                                                         
         BCT   R5,DB030                                                         
         MVC   P+99(32),SPACES                                                  
         MVI   SPACING,3                                                        
         GOTO1 REPORT              DUMP ACCUMULATORS                            
         B     EXIT                                                             
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*        ROUTINE TO SET UP MONTH INFORMATION                                    
*                                                                               
         SPACE                                                                  
SETUPMON NMOD1 0,*SUPM*                                                         
*                                                                               
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED THROUGH - DON'T CHANGE IT                      
*                                                                               
*                                                                               
         BAS   RE,ASATPROC         SET UP AS-AT DATES                           
*                                                                               
         CLI   QWCURST3+2,0        ANY DAY IN DATE?                             
         BE    SMON0010            NO  - DON'T SET UP MONTHLY                   
*                                     ACTIVITY DATES                            
*                                                                               
*   SET UP MONTHLY ACTIVITY DATES:  CONVERT FROM BINARY TO YYMMDD               
*                                                                               
         GOTO1 DATCON,DMCB,(3,QWCURST3),(0,WORK)                                
         GOTO1 DATCON,DMCB,(3,QWCURND3),(0,WORK+6)                              
         MVC   WORK+12(6),WORK     SAVE EBCDIC START DATE                       
         MVC   WORK+18(6),WORK+6   SAVE EBCDIC END   DATE                       
*                                                                               
*   CALCULATE LAST YEAR'S START/END DATES                                       
*                                                                               
         PACK  DUB(2),WORK(2)      REQUEST START DATE                           
         SP    DUB(2),=P'1'        SUBTRACT 1 FROM REQ START DATE               
         UNPK  WORK(2),DUB(2)                                                   
         OI    WORK+1,X'F0'                                                     
         PACK  DUB(2),WORK+6(2)    REQUEST END DATE                             
         SP    DUB(2),=P'1'        SUBTRACT 1 FROM REQ END   DATE               
         UNPK  WORK+6(2),DUB(2)                                                 
         OI    WORK+7,X'F0'                                                     
*                                                                               
*   FOUR MONTH ACTIVITY DATES ARE CALCULATED:  THIS YEAR START/END,             
*     LAST YEAR START/END                                                       
*                                                                               
*   TEST                                                                        
**       MVC   P+1(08),=C'R2/SMON='                                             
**       ST    R2,P+12                                                          
**       GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         GOTO1 GETMDAY,DMCB,WORK+12,QWMONACT                                    
         GOTO1 (RF),(R1),WORK+18,QWMONACT+2                                     
         GOTO1 (RF),(R1),WORK,QWMONACT+4                                        
         GOTO1 (RF),(R1),WORK+6,QWMONACT+6                                      
         SPACE 4                                                                
SMON0010 EQU   *                   SET UP START-END OF KEYMONTH                 
         CLI   QWACCOPT,C'A'       ACCOUNTING OPTION REQUESTED?                 
         BNE   SMON0080            NO  - DON'T CHECK FOR EOM RECORD             
*                                                                               
SMON0020 OC    QWCURND,QWCURND     ANY END DATE?                                
         BZ    SMON0080            NO  -                                        
         XC    KEY,KEY             BUILD EOM KEY                                
         MVI   KEY,X'18'                                                        
         MVC   KEY+24(2),QREP                                                   
         MVC   KEY+26(1),QWCURND   INSERT YEAR FROM CURRENT END                 
         GOTO1 AHIGH                                                            
         CLC   KEY(27),KEYSAVE     KEY FOUND?                                   
         BE    *+6                 YES                                          
         DC    H'0'                NO EOM RECORD - ABORT                        
*                                                                               
*   THERE SHOULD BE A NEATER WAY TO HANDLE THIS                                 
*                                                                               
         GOTO1 AGETEOM             RETRIEVE RECORD                              
*                                                                               
SMON0030 EQU   *                                                                
         ZIC   R5,QWCURND+1        GET MONTH OF 'END MONTH'                     
         BCTR  R5,0                MAKE IT ZERO RELATIVE                        
         SPACE 1                                                                
SMON0040 SLL   R5,1                                                             
         LA    R5,REOMDATE(R5)                 GET MONTH BEFORE                 
         MVC   HALF,0(R5)                      END OF 'MONTH BEFORE'            
*                                                                               
*   IF REQUESTOR BEGINS WITH 'EOM=', THE SIX BYTES FOLLOWING CONTAIN            
*     AN EOM OVERRIDE DATE WHICH MUST BE CONVERTED TO TWO-BYTE                  
*     FORMAT BEFORE REPLACING THE VALUE TAKEN FROM THE EOM RECORD.              
*     THIS VALUE IS THE END-OF-MONTH DATE OF THE MONTH BEFORE THAT              
*     WITH WHICH THE REPORT IS CONCERNED.                                       
*     THIS IS FOLLOWED BY '/#', WHERE # IS NUMBER OF WEEKS IN THE               
*     PERIOD.  THIS IS USED TO CALCULATE THE END DATE                           
*                                                                               
         CLC   QWREQ+QUESTOR-QRECORD(4),=C'EOM='  EOM OVERRIDE?                 
         BNE   SMON0050                         NO                              
         GOTO1 DATCON,DMCB,QWREQ+QUESTOR+4-QRECORD,(2,HALF)                     
SMON0050 EQU   *                                                                
*                                                                               
*   CONVERT 'END DATE OF MONTH BEFORE'                                          
*                                                                               
         GOTO1 DATCON,DMCB,(2,HALF),WORK                                        
*                                                                               
*   ADD 1 DAY TO GET DATE OF 1ST DATE OF NEXT MONTH                             
*                                                                               
         GOTO1 ADDAY,(R1),WORK,WORK+6,1                                         
         GOTO1 DATCON,(R1),WORK+6,(2,QWKEYMON)                                  
*                                                                               
*   IF REQUESTOR = 'EOM=', THE END OF THE 'NEXT MONTH' IS CALCULATED            
*      FROM THE VALUE ENTERED AS '/#', WHERE # IS THE NUMBER OF WEEKS           
*      IN THE PERIOD.                                                           
*                                                                               
         CLC   QWREQ+QUESTOR-QRECORD(4),=C'EOM='  EOM OVERRIDE?                 
         BNE   SMON0070                         NO                              
         ZIC   R1,QWREQ+QUESTOR+11-QRECORD      YES - GET # OF WEEKS            
         SLL   R1,28               DROP ZONE BITS                               
         SRL   R1,28                                                            
         SR    R3,R3               INITIALIZE DAY COUNTER                       
SMON0060 EQU   *                                                                
         LA    R3,7(R3)            ADD 1 WEEK'S DAYS                            
         BCT   R1,SMON0060         LOOP NUMBER OF WEEKS                         
         GOTO1 ADDAY,DMCB,WORK,WORK+6,(R3)                                      
         GOTO1 DATCON,(R1),WORK+6,(2,QWKEYMON+2)                                
         B     SMON0080                                                         
SMON0070 EQU   *                                                                
         MVC   QWKEYMON+2(2),2(R5)                                              
*                                  END OF THIS MONTH                            
SMON0080 EQU   *                                                                
*                                                                               
         LA    R4,QWMONINF         BUILD MONTHLY INFO LIST                      
         SR    R5,R5                                                            
         XC    QWMONINF,QWMONINF                                                
         MVC   WORK(2),QWCURST                                                  
         MVC   WORK+2(2),QWPRIST                                                
         OC    QWMONADJ,QWMONADJ   TEST REQ WITHIN ONE YEAR                     
         BNZ   SMON0090                                                         
         MVI   WORK+1,1            YES- START FROM JAN                          
         MVI   WORK+3,1                                                         
*                                                                               
SMON0090 EQU   *                                                                
         MVC   WORK+4(2),QWPRIST   CALCULATE 2 YEARS PRIOR                      
         IC    R5,WORK+4                                                        
         BCTR  R5,0                DECREMENT PRIOR YEAR BY 1                    
         STC   R5,WORK+4                                                        
         MVC   WORK+6(2),QWCURST   CALCULATE NEXT YEAR                          
         IC    R5,WORK+6                                                        
         LA    R5,1(R5)            ADD 1 YEAR TO CURRENT YEAR                   
         STC   R5,WORK+6                                                        
*                                                                               
SMON0100 MVC   0(2,R4),WORK        CURRENT YEAR/MO                              
         MVC   2(2,R4),WORK+2      PRIOR YEAR/NO                                
         MVC   4(2,R4),WORK+4      2 YEAR PRIOR YEAR/MO                         
         MVC   6(2,R4),WORK+6      NEXT YEAR                                    
         CLI   WORK+1,12           IS IT DECEMBER?                              
         BL    SMON0110            NO                                           
         MVI   WORK+3,1            SET PRIOR YEAR MONTH = JAN                   
         MVC   WORK+4(2),WORK+2    SET 2 YEAR PRIOR= PRIOR JAN                  
         MVI   WORK+1,1            SET CURRENT YEAR MONTH = JAN                 
         MVC   WORK+2(2),WORK      SET PRIOR YEAR = CURRENT JAN                 
         IC    R5,WORK             ADD 1 TO CURRENT YEAR                        
         LA    R5,1(R5)                                                         
         STC   R5,WORK                                                          
         MVI   WORK+7,1            SET NEXT YEAR MONTH = JAN                    
         IC    R5,WORK+6           ADD 1 TO NEXT YEAR                           
         LA    R5,1(R5)                                                         
         STC   R5,WORK+6                                                        
         B     SMON0120                                                         
*                                                                               
SMON0110 IC    R5,WORK+1           NO - INCREMENT THE MONTH                     
         LA    R5,1(R5)                                                         
         STC   R5,WORK+1                                                        
         STC   R5,WORK+3                                                        
         STC   R5,WORK+5                                                        
         STC   R5,WORK+5                                                        
*                                                                               
SMON0120 CLC   QWCURND,WORK        HAVE WE PASSED PERIOD END                    
         BL    SMON0130                                                         
         LA    R4,8(R4)                                                         
         B     SMON0100                                                         
*                                                                               
SMON0130 EQU   *                                                                
*                                                                               
*   TO ESTABLISH THE MASTER MONTH TABLE FOR THE DATE RANGE COVERING             
*     ALL REQUESTS, THE EARLIEST AND LATEST DATES MUST BE TRAPPED.              
*                                                                               
         MVC   WORK+32(4),QSTART   SET DATE TO YR-2000 FORMAT                   
         MVC   WORK+36(2),=C'01'   INSERT DAY                                   
         GOTO1 DATCON,DMCB,(0,WORK+32),(0,WORK+38)                              
*                                                                               
*   TEST                                                                        
*        MVC   P+1(13),=C'WORK+38/SVQST'                                        
*        MVC   P+15(4),WORK+38                                                  
*        MVI   P+19,C'/'                                                        
*        MVC   P+20(4),SVQSTART                                                 
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         CLC   WORK+38(4),SVQSTART SAVE EARLIEST START DATE                     
         BNL   SMON0140                                                         
         MVC   SVQSTART,WORK+38    SAVE EBCDIC FORMAT                           
         MVC   SVQSTRT2,QWCURST    SAVE TWO BYTE FORMAT                         
SMON0140 EQU   *                                                                
         MVC   WORK+32(4),QEND     SET DATE TO YR-2000 FORMAT                   
         MVC   WORK+36(2),=C'01'   INSERT DAY                                   
         GOTO1 DATCON,DMCB,(0,WORK+32),(0,WORK+38)                              
         CLC   WORK+38(4),SVQEND   SAVE LATEST  END   DATE                      
         BNH   SMON0150                                                         
         MVC   SVQEND,WORK+38      SAVE EBCDIC FORMAT                           
         MVC   SVQEND2,QWCURND     SAVE TWO BYTE FORMAT                         
SMON0150 EQU   *                   DETERMINE REQUEST BROADCAST RANGE            
         MVC   WORK(4),QSTART      SET START DATE                               
         MVC   WORK+4(2),=C'01'    SET DAY OF DATE                              
         GOTO1 GETBROAD,DMCB,(1,WORK),WORK+6,GETDAY,ADDAY                       
*                                  BROADCAST DATES OF START MONTH               
         GOTO1 DATCON,DMCB,(0,WORK+6),(2,QWBCSTST)                              
*                                  CONVERT START TO COMPRESSED FORMAT           
         CLC   QSTART(4),QEND      START = END DATE?                            
         BE    SMON0152                                                         
         MVC   WORK(4),QEND        SET END   DATE                               
         GOTO1 GETBROAD,DMCB,(1,WORK),WORK+6,GETDAY,ADDAY                       
*                                  BROADCAST DATES OF END   MONTH               
SMON0152 EQU   *                   DETERMINE REQUEST BROADCAST RANGE            
         GOTO1 DATCON,DMCB,(0,WORK+12),(2,QWBCSTND)                             
*                                  CONVERT END   TO COMPRESSED FORMAT           
*                                  CONVERT EXTRA DATES, IF ANY                  
*                                                                               
         LA    R7,QWREQ3           A(THIRD REQUEST RECORD)                      
         USING QREC3D,R7                                                        
         OC    Q3XTRFRM(12),Q3XTRFRM                                            
*                                  ANYTHING IN FIELD?                           
         BZ    SMON0155            NO                                           
         CLC   Q3XTRFRM(12),SPACES DITTO                                        
         BE    SMON0155            NO                                           
         GOTO1 DATCON,DMCB,(0,Q3XTRFRM),(2,QWXTRAFM)                            
*                                  CONVERT START TO COMPRESSED FORMAT           
         GOTO1 DATCON,DMCB,(0,Q3XTRTO),(2,QWXTRATO)                             
*                                  CONVERT END   TO COMPRESSED FORMAT           
SMON0155 EQU   *                                                                
         CLC   =C'DUMPMONFOR',QUESTOR    REQUEST FOR TABLE DUMP?                
         BNE   SMON0160            NO  - FINISHED                               
*                                                                               
*   SPECIAL REQUEST TO DISPLAY THE START/END DATES                              
*                                                                               
         MVC   P+1(16),=C'BROADCAST DATES:'                                     
         LA    R6,P+20             SET A(PRINT LINE)                            
         LA    R5,QWBCSTST         A(BROADCAST START DATE)                      
         LA    R0,2                LOOP CONTROL                                 
SMON0154 EQU   *                                                                
         CLC   0(2,R5),=X'0000'    ANY ENTRY?                                   
         BE    SMON0156            NO                                           
         GOTO1 HEXOUT,DMCB,(R5),(R6),2,=C'TOG'                                  
         GOTO1 DATCON,DMCB,(2,(R5)),(X'20',6(R6))                               
         LA    R6,14(R6)           A(PRINT ENTRY)                               
SMON0156 EQU   *                                                                
         LA    R5,2(R5)            A(NEXT BDCST ENTRY)                          
         BCT   R0,SMON0154         GO BACK FOR NEXT                             
         GOTO1 REPORT              PRINT OUT THE LINE                           
         OC    QWXTRAFM(4),QWXTRAFM                                             
*                                  ANY DATES?                                   
         BZ    SMON0160            NO                                           
         MVC   P+1(11),=C'EXTRA DATES'                                          
         GOTO1 DATCON,DMCB,(2,QWXTRAFM),(0,P+20)                                
         GOTO1 DATCON,DMCB,(2,QWXTRATO),(0,P+30)                                
         GOTO1 REPORT              PRINT OUT THE LINE                           
*                                                                               
SMON0160 XIT1                                                                   
         EJECT                                                                  
*                                                                               
*        GETMDAY ROUTINE RETURNS MONDAY DATE FOR WEEK GIVEN                     
*                INPUT = YYMMDD                                                 
*                OUTPUT= 2-BYTE BINARY                                          
         SPACE                                                                  
GETMDAY  NTR1                                                                   
         LM    R5,R6,0(R1)         R5=A(INPUT), R6=A(OUTPUT)                    
*                                                                               
GETM0000 EQU   *                                                                
         CLC   0(6,R5),=C'940229' ****2YR PRIOR OF LEAP YR 96 ****              
         BE    GETM0010                                                         
         CLC   0(6,R5),=C'950229' ****PRIOR YEAR FOR LEAP YR 96 ****            
         BE    GETM0010                                                         
         CLC   0(6,R5),=C'970229' ****NEXT YEAR FOR LEAP YR 96 ****             
         BE    GETM0010                                                         
         CLC   0(6,R5),=C'980229' ****2YR PRIOR OF LEAP YR 00 ****              
         BE    GETM0010                                                         
         CLC   0(6,R5),=C'990229' ****PRIOR YEAR FOR LEAP YR 00 ****            
         BE    GETM0010                                                         
         CLC   0(6,R5),=C'010229' ****NEXT YEAR FOR LEAP YR 00 ****             
         BE    GETM0010                                                         
         CLC   0(6,R5),=C'020229' ****2YR PRIOR OF LEAP YR 04 ****              
         BE    GETM0010                                                         
         CLC   0(6,R5),=C'030229' ****PRIOR YEAR FOR LEAP YR 04 ****            
         BE    GETM0010                                                         
         CLC   0(6,R5),=C'050229' ****NEXT YEAR FOR LEAP YR 04 ****             
         BNE   GETM0020                                                         
GETM0010 EQU   *                                                                
         MVC   3(3,R5),=C'301'     ***PREVIOUS YEAR MUST BE MARCH 01***         
GETM0020 EQU   *                                                                
         GOTO1 GETDAY,DMCB,(R5),FULL                                            
         CLI   DUBLDUBL,0          FIRST CALL FROM SET4DATS?                    
         BNE   GETM0024            NO  - ALREADY SET                            
         MVC   DUBLDUBL(1),DMCB    YES - SAVE 'DAY OF WEEK'                     
GETM0024 EQU   *                                                                
         CLC   FULL(3),SPACES                                                   
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         SR    RE,RE                                                            
         IC    RE,DMCB             DAY NUMBER                                   
         BCTR  RE,R0                                                            
         LNR   RE,RE                                                            
         CLI   RREPPROF+27,C'Y'    DAILY PACING?                                
         BNE   GETM0030            NO                                           
         SR    RE,RE               CLEAR DAY ADJUSTMENT                         
GETM0030 EQU   *                                                                
         ST    RE,DMCB+8           PUT IN NUMBER OF DAYS TO SUBTRACT            
*                                                                               
         GOTO1 ADDAY,DMCB,(R5),DUB                                              
*                                                                               
         GOTO1 DATCON,(R1),DUB,(2,(R6))                                         
*                                                                               
         CLC   =C'DUMPMONFOR',QUESTOR    REQUEST FOR TABLE DUMP?                
         BNE   GETM0040            NO                                           
*                                                                               
         MVC   P+1(15),=C'GETMDAY - POST:'                                      
         MVC   P+18(6),0(R5)                                                    
         GOTO1 HEXOUT,DMCB,(R6),P+28,2,=C'TOG'                                  
         GOTO1 DATCON,DMCB,(2,(R6)),(X'20',P+38)                                
         GOTO1 REPORT                                                           
*                                                                               
GETM0040 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*  THIS ROUTINE SETS 'FORECAST' DATE BUCKETS USING AS AT DATES.  IF             
*     AN AS-AT TO-DATE HAS BEEN ENTERED, INDICATING A REQUEST FOR               
*     AS-AT RANGE TESTING, FOUR ADDITIONAL DATES ARE GENERATED.                 
*                                                                               
ASATPROC NTR1                                                                   
         XC    QWMONFOR(16),QWMONFOR INITIALIZE MONTH FCST TABLE                
         GOTO1 DATCON,DMCB,(4,RCDATE),(0,WORK)                                  
         CLC   QASAT,SPACES        ANY AS-AT DATE OVERRIDE?                     
         BE    *+10                NO                                           
         MVC   WORK(6),QASAT       YES - USE IT                                 
*                                  NOW CHECK FOR NEXT-YEAR OFFSET               
*   TEST                                                                        
*        MVC   P+1(08),=C'PROFILE:'                                             
*        MVC   P+12(30),RREPPROF                                                
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
*                                  NOW CHECK FOR NEXT-YEAR OFFSET               
*   TEST                                                                        
*        MVC   P+1(09),=C'NRRGFLAG='                                            
*        MVC   P+12(1),NRRGFLAG                                                 
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         CLC   =C'3G',QRGPROG      NRGON GENERATOR?                             
         BE    ASPO0010            YES                                          
         CLC   =C'4G',QRGPROG      NRGON GENERATOR?                             
         BE    ASPO0010            YES                                          
         CLC   =C'6G',QRGPROG      NRGON GENERATOR?                             
         BNE   ASPO0020            NO                                           
ASPO0010 EQU   *                                                                
*                                                                               
         CLI   RREPPROF+12,C'Y'    ANY AS-AT OFFSET?                            
         BNE   ASPO0020            NO                                           
         BAS   RE,ASATNEXT         YES - BUMP AS-AT TO NEXT YEAR                
*                                                                               
ASPO0020 EQU   *                                                                
         MVC   WORK+36(6),WORK     USE WORK+36 TO SET DR CUTOFF                 
         GOTO1 =A(DRCUTOFF),DMCB,(RC)                                           
*                                  SET DR CUTOFF                                
         LA    R6,QWMONFOR        A(MONTH FORECAST DATE TABLE)                  
*                                                                               
*   SET 'CURRENT AS-AT DATE' (FROM), AND THREE DATES BASED ON IT                
*                                                                               
         GOTO1 SET4DATS,DMCB,(R6)                                               
*                                                                               
*   CHECK FOR AN AS-AT TO-DATE.  IF PRESENT, INSERT FOUR DATES                  
*                                                                               
         LA    R7,QWREQ2           A(2ND REQUEST CARD IN SET)                   
         USING QREC2D,R7                                                        
*                                                                               
         CLC   Q2ASAT2,SPACES      ANY AS-AT TO-DATE?                           
         BE    ASPO0040            NO  - FINISHED                               
         MVC   WORK(6),Q2ASAT2     LOAD AS-AT TO-DATE                           
*                                                                               
         DROP  R7                                                               
*                                                                               
         LA    R6,QWMONFOR         RELOAD A(MON FCST TABLE)                     
         LA    R6,8(R6)            A(MON FCST TABLE: TO-DATES)                  
*                                                                               
*   SET 'CURRENT AS-AT DATE' (TO), AND THREE DATES BASED ON IT                  
*                                                                               
         GOTO1 SET4DATS,DMCB,(R6)                                               
*                                                                               
ASPO0040 EQU *                                                                  
         GOTO1 DATCON,DMCB,(2,QWMONFOR),(0,WORK+48)                             
         LA    R3,7                BACK UP ONE WEEK                             
         LNR   R3,R3                                                            
         GOTO1 ADDAY,DMCB,WORK+48,WORK+54,(R3)                                  
         GOTO1 DATCON,DMCB,(0,WORK+54),(2,QWLASTWK)                             
         CLC   =C'DUMPMONFOR',QUESTOR    REQUEST FOR TABLE DUMP?                
         BNE   ASPO0100            NO  - FINISHED                               
*                                                                               
*   SPECIAL REQUEST TO DISPLAY THE TABLE, THEN DUMP RUN                         
*                                                                               
         MVC   P+1(07),=C'MONFOR='                                              
         GOTO1 REPORT                                                           
*                                                                               
         LA    R6,P                SET A(PRINT LINE)                            
         LA    R5,QWMONFOR         A(MONTH FORECAST TABLE)                      
         LA    R0,8                LOOP CONTROL                                 
ASPO0060 EQU   *                                                                
         CLC   0(2,R5),=X'0000'    ANY ENTRY?                                   
         BE    ASPO0080            NO                                           
         GOTO1 HEXOUT,DMCB,(R5),(R6),2,=C'TOG'                                  
         PRINT GEN                                                              
         GOTO1 DATCON,DMCB,(2,(R5)),(X'20',6(R6))                               
         PRINT NOGEN                                                            
         LA    R6,16(R6)           A(PRINT ENTRY)                               
ASPO0080 EQU   *                                                                
         LA    R5,2(R5)            A(NEXT MONFOR ENTRY)                         
         BCT   R0,ASPO0060         GO BACK FOR NEXT                             
         GOTO1 REPORT              PRINT OUT THE LINE                           
         GOTO1 HEXOUT,DMCB,QWLASTWK,P+2,2,=C'TOG'                               
         PRINT GEN                                                              
         GOTO1 DATCON,DMCB,(2,QWLASTWK),(X'20',P+8)                             
         GOTO1 REPORT              PRINT OUT THE LINE                           
         PRINT NOGEN                                                            
ASPO0100 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*  THIS ROUTINE SETS THE SET OF FOUR DATES FOR AS-AT PROCESSING.                
*                                                                               
SET4DATS NTR1                                                                   
         XC    DUBLDUBL,DUBLDUBL   CLEAR INDICATORS - SERVES AS A               
*                                     ONE-TIME SWITCH FOR SET4DATS              
*                                                                               
         L     R6,0(R1)            RESET A(TABLE ENTRIES)                       
         GOTO1 GETMDAY,DMCB,WORK,(R6)                                           
*                                  USE CURRENT AS-AT DATE                       
*                                     THIS CALL SETS 'DAY OF WEEK'              
*                                        FOR REMAINDER OF SET4DATS              
*                                                                               
*   SPECIAL NRRGON PROCESSING IF FLAG IS SET:                                   
         CLI   NRRGFLAG,C'Y'       SPECIAL DATE SETUP?                          
         BNE   SETD0020            NO                                           
         MVC   6(2,R6),0(R6)       YES - MOVE CURRENT DATE TO                   
*                                     'NEXT' DATE FIELD, WHICH IS               
*                                     BEING USED AS 'LAST' DATE IN              
*                                     SPECIAL PROCESSING                        
*                                                                               
SETD0020 EQU   *                                                                
         LA    R6,2(R6)            A(PRIOR AS-AT DATE)                          
*                                                                               
* GET BROADCAST YEAR OF AS-AT DATE:  MAY NOT BE SAME - IE:                      
*    DEC30/91 IS BROADCAST YEAR 92.  (CHECK THE CALENDAR).                      
*    TAKE THE YEAR FROM THE TO-DATE PORTION, FOR SAME REASON.                   
*                                                                               
         GOTO1 GETBROAD,DMCB,WORK,WORK+12                                       
         MVC   WORK+6(2),WORK+18   CALCULATE START BDCST YEAR                   
         MVC   WORK+8(4),=C'0115'  SET JAN15 OF YEAR                            
         GOTO1 GETBROAD,DMCB,WORK+6,WORK+12                                     
*                                                                               
*  CALCULATE WEEK # FROM BDCAST YEAR START THRU CURR AS AT DATE                 
*                                                                               
         GOTO1 =V(PERVERT),DMCB,WORK+12,WORK                                    
         ZICM  RF,DMCB+12,2        SAVE WEEK# OF CURR AS AT DATE                
         OC    DMCB+10(2),DMCB+10  ANY PERVERT DAYS REMAINING?                  
         BNZ   SETD0040            YES - DON'T ADJUST WEEK #                    
         BCTR  RF,0                NO  - DECREMENT WEEK #                       
SETD0040 EQU   *                                                                
         STCM  RF,3,WORK+32        SAVE WEEK# OF CURR AS AT DATE                
         GOTO1 DATCON,DMCB,(0,WORK+6),(3,DOUBLE)                                
         ZIC   RF,DOUBLE           EXTRACT YEAR FROM DATE                       
         BCTR  RF,0                SUBTRACT 1 FROM YEAR                         
         STC   RF,DOUBLE           PUT YEAR BACK                                
         GOTO1 DATCON,DMCB,(3,DOUBLE),(0,WORK+6)                                
*                                                                               
*  NEXT TEST FOR RRGON UPDATE ONLY                                              
*                                                                               
         SR    RE,RE                                                            
         LA    R7,QWREQ2           A(2ND REQUEST CARD IN SET)                   
         USING QREC2D,R7                                                        
*                                                                               
         CLI   Q2RRGON,C'Y'        RRGON UPDATE RUN?                            
*                                                                               
         DROP  R7                                                               
*                                                                               
         BNE   SETD0060            NO                                           
         LA    RE,1                YES - SET FLAG                               
SETD0060 EQU   *                                                                
         GOTO1 SETASAT,DMCB,(R6),(RE)                                           
*                                                                               
*   SPECIAL NRRGON PROCESSING IF FLAG IS SET:                                   
         CLI   NRRGFLAG,C'Y'       SPECIAL DATE SETUP?                          
         BNE   SETD0080            NO                                           
         MVC   2(2,R6),0(R6)       YES - MOVE PRIOR DATE TO                     
*                                     2YR PRIOR  DATE FIELD.                    
         B     SETD0180            EXIT - ALL FOUR DATES ARE SET                
*                                                                               
SETD0080 EQU   *                                                                
         LA    R6,2(R6)            A(2YR PRIOR AS AT DATE)                      
         GOTO1 DATCON,DMCB,(0,WORK+6),(3,DOUBLE)                                
         ZIC   RF,DOUBLE           EXTRACT YEAR FROM DATE                       
         BCTR  RF,0                SUBTRACT 1 FROM YEAR                         
         STC   RF,DOUBLE           PUT YEAR BACK                                
         GOTO1 DATCON,DMCB,(3,DOUBLE),(0,WORK+6)                                
***>>>                                                                          
         SR    RE,RE               SET 1-WEEK DISPLACEMENT VALUE                
         CLC   =C'3G',QRGPROG      NRGON GENERATOR?                             
         BE    SETD0100            YES                                          
         CLC   =C'4G',QRGPROG      NRGON GENERATOR?                             
         BE    SETD0100            YES                                          
         CLC   =C'6G',QRGPROG      NRGON GENERATOR?                             
         BNE   SETD0120            NO                                           
SETD0100 EQU   *                                                                
*                                                                               
         CLI   RREPPROF+12,C'Y'    ANY AS-AT OFFSET?                            
         BNE   SETD0120            NO                                           
*                                                                               
*  NEXT TEST FOR RRGON UPDATE ONLY                                              
*                                                                               
         LA    R7,QWREQ2           A(2ND REQUEST CARD IN SET)                   
         USING QREC2D,R7                                                        
*                                                                               
         CLI   Q2RRGON,C'Y'        RRGON UPDATE RUN?                            
*                                                                               
         DROP  R7                                                               
*                                                                               
         BNE   SETD0120            NO                                           
         LA    RE,1                YES - SET FLAG                               
SETD0120 EQU   *                                                                
***>>>                                                                          
         GOTO1 SETASAT,DMCB,(R6),(RE)                                           
         GOTO1 DATCON,DMCB,(0,WORK+6),(3,DOUBLE)                                
         ZIC   RF,DOUBLE           EXTRACT YEAR FROM DATE                       
         CLI   NRRGFLAG,C'Y'       NRRGON DATE ADJUSTMENT NEEDED?               
         BNE   SETD0140            NO                                           
         LA    RF,1(RF)            YES - ADD 1:  CALCULATE 'LAST' YEAR          
*                                     'NEXT' YEAR BECOMES 'LAST' YEAR           
         B     SETD0160                                                         
SETD0140 EQU   *                                                                
         LA    RF,3(RF)            ADD 3:  CALCULATE NEXT YEAR                  
SETD0160 EQU   *                                                                
         STC   RF,DOUBLE           PUT YEAR BACK                                
         GOTO1 DATCON,DMCB,(3,DOUBLE),(0,WORK+6)                                
         LA    R6,2(R6)            A(NEXT YEAR AS AT DATE)                      
         GOTO1 SETASAT,DMCB,(R6),0                                              
SETD0180 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*  THIS ROUTINE CALCULATES THE MONDAY DATE OF THE NTH WEEK OF THE               
*     BROADCAST YEAR                                                            
*     IF 'DAILY PACING' IS USED, THE VALUE IN DUBLDUBL (DAY OF                  
*     WEEK) IS ADDED TO POSITION TO CORRECT DAY WITHIN WEEK.                    
*                                                                               
SETASAT  NTR1                                                                   
         L     R6,0(R1)            RESET A(MONFORC TABLE ENTRY)                 
         L     R3,4(R1)            RRGON UPDATE FLAG                            
         GOTO1 GETBROAD,DMCB,WORK+6,WORK+12                                     
         ZICM  R2,WORK+32,2        INSERT WEEK# OF CURRENT DATE                 
         CH    R2,=H'52'           IS CURRENT WEEK # 53?                        
*                                                                               
*   WEEK # IS UNDERSTATED BY 1.  DAYS 1-7 ARE WEEK 1, BUT PERVERT               
*    CALCULATION RETURNS 0.                                                     
*                                                                               
         BNE   SASA0004            NO                                           
         BCTR  R2,0                YES - SET IT TO 52 FOR OTHER YEARS           
SASA0004 EQU   *                                                                
         MH    R2,=H'7'            MULT BY 7 = # OF DAYS                        
         LTR   R3,R3               RRGON UPDATE FLAG SET?                       
         BZ    SASA0008            NO                                           
         LA    R2,7(R2)            YES - SKIP TO NEXT MONDAY                    
SASA0008 EQU   *                                                                
         CLI   RREPPROF+27,C'Y'    DAILY PACING?                                
         BNE   SASA0012            NO                                           
         ZIC   RF,DUBLDUBL         YES - SET REG TO 'DAY OF WEEK'               
         BCTR  RF,0                MAKE ZERO RELATIVE                           
         AR    R2,RF               ADD DAY DISPLACEMENT IN WEEK                 
SASA0012 EQU   *                                                                
         PRINT GEN                                                              
         GOTO1 ADDAY,DMCB,WORK+12,WORK+18,(R2)                                  
         PRINT NOGEN                                                            
         GOTO1 GETMDAY,DMCB,WORK+18,(R6)                                        
*                                                                               
*   FINAL CALL INSERTS MONDAY DATE OF WEEK# INTO MONFOR TABLE                   
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*  THIS ROUTINE CALCULATES AS-AT OVERRIDE IN NEXT YEAR.                         
*                                                                               
ASATNEXT NTR1                                                                   
*                                                                               
* GET BROADCAST YEAR OF AS-AT DATE:  MAY NOT BE SAME - IE:                      
*    DEC30/91 IS BROADCAST YEAR 02.  (CHECK THE CALENDAR).                      
*    TAKE THE YEAR FROM THE TO-DATE PORTION, FOR SAME REASON.                   
*                                                                               
         GOTO1 GETBROAD,DMCB,WORK,WORK+12                                       
         MVC   WORK+6(2),WORK+18   CALCULATE START BDCST YEAR                   
         MVC   WORK+8(4),=C'0115'  SET JAN15 OF YEAR                            
         GOTO1 GETBROAD,DMCB,WORK+6,WORK+12                                     
*                                                                               
*  CALCULATE WEEK # FROM BDCAST YEAR START THRU CURR AS AT DATE                 
*                                                                               
         GOTO1 =V(PERVERT),DMCB,WORK+12,WORK                                    
         ZICM  RF,DMCB+12,2        SAVE WEEK# OF CURR AS AT DATE                
         OC    DMCB+10(2),DMCB+10  ANY PERVERT DAYS REMAINING?                  
         BNZ   ANEX0020            YES - DON'T ADJUST WEEK #                    
         BCTR  RF,0                NO  - DECREMENT WEEK #                       
ANEX0020 EQU   *                                                                
         STCM  RF,3,WORK+32        SAVE WEEK# OF CURR AS AT DATE                
         GOTO1 DATCON,DMCB,(0,WORK+6),(3,DOUBLE)                                
         ZIC   RF,DOUBLE           EXTRACT YEAR FROM DATE                       
         LA    RF,1(RF)            ADD 1:  CALCULATE NEXT YEAR                  
         STC   RF,DOUBLE           PUT YEAR BACK                                
         GOTO1 DATCON,DMCB,(3,DOUBLE),(0,WORK+6)                                
         GOTO1 GETBROAD,DMCB,WORK+6,WORK+12                                     
*                                                                               
         ZICM  R2,WORK+32,2        INSERT WEEK# OF CURRENT DATE                 
         CH    R2,=H'52'           IS CURRENT WEEK # 53?                        
*                                                                               
*   WEEK # IS UNDERSTATED BY 1.  DAYS 1-7 ARE WEEK 1, BUT PERVERT               
*    CALCULATION RETURNS 0.                                                     
*                                                                               
         BNE   ANEX0040            NO                                           
         BCTR  R2,0                YES - SET IT TO 52 FOR OTHER YEARS           
ANEX0040 EQU   *                                                                
         MH    R2,=H'7'            MULT BY 7 = # OF DAYS                        
         PRINT GEN                                                              
         GOTO1 ADDAY,DMCB,WORK+12,WORK+18,(R2)                                  
         PRINT NOGEN                                                            
         GOTO1 GETMDAY,DMCB,WORK+18,WORK+48                                     
         GOTO1 DATCON,DMCB,(2,WORK+48),(0,WORK)                                 
*                                                                               
*   FINAL CALL CONVERTS COMPRESSED FORMAT TO EBCDIC IN WORK                     
         XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*  THIS ROUTINE SETS THE DIRECT RESPONSE CUTOFF DATE:                           
*        DATE OF RUN IS ADJUSTED:                                               
*              IF DATE OF RUN IS WEDNESDAY, DATE IS USED AS IS                  
*              IF DATE OF RUN IS NOT WEDNESDAY, FOLLOWING                       
*                 WEDNESDAY IS CALCULATED, AND ITS DATE USED.                   
*        IF AS-AT DATE, AS CALCULATED ABOVE, IF AFTER 14TH OF MONTH,            
*              CURRENT YEAR/MONTH IS SET, ELSE PREVIOUS IS SET                  
*                                                                               
*                                                                               
*                                                                               
DRCUTOFF NMOD1 0,*DRCUT*                                                        
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         MVC   WORK+42(6),WORK+36                                               
         GOTO1 GETDAY,DMCB,WORK+42,FULL                                         
*                                  GET DAY OF WEEK                              
         CLI   DMCB,3              IS RUNDATE WEDNESDAY?                        
         BE    DRCU0060            YES - USE IT FOR CUTOFF TEST                 
         LA    RF,WEDADJST                                                      
DRCU0010 EQU   *                                                                
         CLI   0(RF),0             END OF TABLE?                                
         BNE   *+6                                                              
         DC    H'0'                DAY NOT FOUND                                
         CLC   DMCB(1),0(RF)       DAY OF WEEK VS TABLE                         
         BE    DRCU0020            FOUND                                        
         LA    RF,5(RF)            BUMP TO NEXT ENTRY                           
         B     DRCU0010            GO BACK FOR NEXT                             
DRCU0020 EQU   *                                                                
         ZICM  R3,1(RF),4          GET DAY ADJUSTMENT TO WED                    
         GOTO1 ADDAY,DMCB,WORK+42,WORK+36,(R3)                                  
*                                                                               
*   TEST                                                                        
         CLC   =C'DUMPMONFOR',QUESTOR    REQUEST FOR DATE DISPLAY?              
         BNE   DRCU0060            NO                                           
         MVC   P+1(13),=C'+42/+36/(R3)='                                        
         MVC   P+14(6),WORK+42                                                  
         MVI   P+20,C'/'                                                        
         MVC   P+21(6),WORK+36                                                  
         MVI   P+27,C'/'                                                        
         EDIT  (R3),(6,P+28),FILL=0,WRK=MYWORK                                  
         GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         B     DRCU0060                                                         
*                                                                               
MYWORK   DS    CL20                                                             
*                                                                               
*   WEDNESDAY ADJUSTMENT TABLE:  EACH ENTRY IS TWO CHARACTERS                   
*        CHAR 1:  DAY OF WEEK                                                   
*        CHAR 2:  ADJUSTMENT VALUE  - SUN THRU TUESDAY ADJUST                   
*                                     THU THRU SATURDAY DON'T                   
*                                                                               
WEDADJST DC    X'01',X'00000002'         MONDAY                                 
         DC    X'02',X'00000001'         TUESDAY                                
         DC    X'04',X'FFFFFFFF'         THURSDAY - BACK UP 1 DAY               
         DC    X'05',X'FFFFFFFE'         FRIDAY   - BACK UP 2 DAYS              
         DC    X'06',X'00000004'         SATURDAY                               
         DC    X'07',X'00000003'         SUNDAY                                 
         DC    X'0000'                                                          
DRCU0060 EQU   *                                                                
         GOTO1 DATCON,DMCB,(0,WORK+36),(3,WORK+42)                              
*                                  CONVERT DATE TO BINARY YMD                   
         CLI   WORK+44,X'0F'       DAY 15TH OR AFTER?                           
         BL    DRCU0080            NO  - SET PREVIOUS MONTH                     
         MVC   QWDRCOFF,WORK+42    YES - SAVE YM OF AS-AT DATE                  
         B     DRCU0160            EXIT                                         
DRCU0080 EQU   *                   SET PREVIOUS MONTH                           
         CLI   WORK+43,1           IS MONTH JANUARY?                            
         BE    DRCU0100            YES                                          
         ZIC   RF,WORK+43          NO  - DECREMENT 1 MONTH                      
         BCTR  RF,0                                                             
         STC   RF,WORK+43          REINSERT MONTH                               
         MVC   QWDRCOFF,WORK+42    SAVE YM OF AS-AT DATE                        
         B     DRCU0160            EXIT                                         
DRCU0100 EQU   *                                                                
         MVI   WORK+43,12          JANUARY: OVERLAY WITH DECEMBER               
         ZIC   RF,WORK+42          DECREMENT YEAR BY 1                          
         BCTR  RF,0                                                             
         STC   RF,WORK+42                                                       
         MVC   QWDRCOFF,WORK+42    SAVE YM OF AS-AT DATE                        
         B     DRCU0160            EXIT                                         
DRCU0160 EQU   *                                                                
         MVC   QWDRCOFP,QWDRCOFF   SET PRIOR YEAR CUTOFF                        
         ZIC   RF,QWDRCOFP         BACK UP 1 YEAR                               
         BCTR  RF,0                                                             
         STC   RF,QWDRCOFP         RESTORE YEAR                                 
         CLI   QWDRCOFP,96         LEAP YEAR?  1996                             
         BE    DRCU0180            YES - ANY DATE OKAY                          
         CLI   QWDRCOFP,100        LEAP YEAR?  2000                             
         BE    DRCU0180            YES - ANY DATE OKAY                          
         CLI   QWDRCOFP,104        LEAP YEAR?  2004                             
         BE    DRCU0180            YES - ANY DATE OKAY                          
         CLI   QWDRCOFP,108        LEAP YEAR?  2008                             
         BE    DRCU0180            YES - ANY DATE OKAY                          
         CLI   QWDRCOFP,112        LEAP YEAR? 2112                              
         BE    DRCU0180            YES - ANY DATE OKAY                          
         CLC   QWDRCOFP+1(2),=X'021D'                                           
*                                  NO  - FEB 29?                                
         BNE   DRCU0180            NO  - OKAY                                   
         MVC   QWDRCOFP+1(2),=X'021C'                                           
*                                  YES - SET TO FEB 28                          
DRCU0180 EQU   *                                                                
         CLC   =C'DUMPMONFOR',QUESTOR    REQUEST FOR DATE DISPLAY?              
         BNE   DRCU0200            NO  - FINISHED                               
         MVC   P+1(10),=C'DR CUTOFF:'                                           
         MVC   WORK+48(2),QWDRCOFF                                              
         MVI   WORK+50,1                                                        
         GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+15)                                 
         MVC   WORK+48(2),QWDRCOFP                                              
         MVI   WORK+50,1                                                        
         GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+25)                                 
         GOTO1 REPORT                                                           
DRCU0200 EQU   *                                                                
         XC    WORK+36(20),WORK+36 CLEAR THE WORK AREA                          
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*  CCCUTNEX  -  CHECKS CUTOFF DATE FOR SPECIAL NRRGON DATE ADJUST-              
*     MENT, CHECKING DATE OFFSET FOR BUCKET AGAINST PRIOR YEAR,                 
*     AS-AT DATE CURRENT.       .                                               
*                                                                               
CCCUTNEX NMOD1 0,*CNEX*                                                         
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         LA    RF,QWREQ3                                                        
         USING QREC3D,RF                                                        
*                                                                               
*   TEST                                                                        
*        MVC   P+1(27),=C'REQ/PROF/TYPE/PRIDATE/COFF/'                          
*        MVC   P+30(1),Q3DIRRES    INSERT REQUEST CARD OPTION                   
*        MVC   P+32(1),RREPPROF+8  INSERT REP PROFILE                           
*        MVC   P+34(1),RCONTYPE                                                 
*        MVC   WORK+48(2),PRIDATE(R4)                                           
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+36)                                 
*        MVC   WORK+48(2),QWDRCOFF                                              
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+46)                                 
*        XC    WORK+48(12),WORK+48                                              
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+60,4,=C'TOG'                              
*        MVC   WORK+48(4),SKIPDATE+NXASATIN(R4)                                 
*        EDIT  (4,WORK+48),(8,P+72)                                             
*        MVC   WORK+48(4),SKIPDATE+NXASATOR(R4)                                 
*        EDIT  (4,WORK+48),(8,P+82)                                             
*        GOTO1 REPORT                                                           
*        LA    RF,QWREQ3           RESET A(REQUEST CARD 3)                      
*   TEST END                                                                    
*                                                                               
         CLI   Q3DIRRES,C'Y'       EXCLUDE DIRECT RESPONSE?                     
         BNE   CCNX0400            NO  - EXIT CC = ZERO                         
         DROP  RF                                                               
*                                                                               
         CLC   RCONTYPE,RREPPROF+8 YES - CONTYPE = DIRECT RESPONSE?             
*                                     STORED IN REP PROFILE POS # 9             
         BNE   CCNX0400            NO  - EXIT CC = ZERO                         
         CLC   PRIDATE(2,R4),QWDRCOFF                                           
*                                  YES - PRIOR TO CUTOFF DATE?                  
         BL    CCNX0400            YES - EXIT CC = ZERO                         
CCNX0300 EQU   *                                                                
         LTR   RB,RB               NO  - SET CC NOT ZERO                        
*                                     DON'T USE DATA                            
         B     CCNX0600                                                         
CCNX0400 EQU   *                                                                
         SR    R0,R0                                                            
CCNX0600 EQU   *                                                                
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*   SAME COMMENT APPLIES TO PAID PROGRAMMING FOR SPECIAL NRRGON                 
*        DATE ADJUSTMENT.                                                       
*   PAID PROGRAMMING CUTOFF TESTING:                                            
*        1.  IF NOT PP CUTOFF OPTIONED REP, EXIT CC = ZERO                      
*        2.  IF ORDER NOT CONTYPE 'Z' (PAID PRO), EXIT CC = ZERO                
*        3.  IF CURDATE(R4) LESS THAN PP CUTOFF DATE, EXIT CC = ZERO            
*            IE: CURDATE = 9512  PP CUTOFF 9601:  USE DATA                      
*            IE: CURDATE = 9512  PP CUTOFF 9512:  DON'T USE DATA                
*                                                                               
PPCUTNEX NMOD1 0,*PNEX*                                                         
         L     RC,0(R1)                                                         
         LA    RF,QWREQ3                                                        
         USING QREC3D,RF                                                        
*                                                                               
*   TEST                                                                        
*        MVC   P+1(27),=C'REQ/PROF/TYPE/CURDATE/COFF/'                          
*        MVC   P+30(1),Q3PAYPRO    INSERT REQUEST CARD OPTION                   
*        MVC   P+32(1),RREPPROF+9  INSERT REP PROFILE                           
*        MVC   P+34(1),RCONTYPE                                                 
*        MVC   WORK+48(2),CURDATE(R4)                                           
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+36)                                 
*        MVC   WORK+48(2),QWDRCOFF                                              
*        MVI   WORK+50,1                                                        
*        GOTO1 DATCON,DMCB,(3,WORK+48),(5,P+46)                                 
*        GOTO1 REPORT                                                           
*        XC    WORK+48(12),WORK+48                                              
*        LA    RF,QWREQ3           RESET A(REQUEST CARD 3)                      
*   TEST END                                                                    
*                                                                               
         CLI   Q3PAYPRO,C'Y'       EXCLUDE DIRECT RESPONSE?                     
         BNE   PPNX0400            NO  - EXIT CC = ZERO                         
         DROP  RF                                                               
*                                                                               
         CLC   RCONTYPE,RREPPROF+9 YES - CONTYPE = PAID PROGRAMMING?            
*                                     STORED IN REP PROFILE POS # 10            
         BNE   PPNX0400            NO  - EXIT CC = ZERO                         
         CLC   PRIDATE(2,R4),QWDRCOFF                                           
*                                  YES - PRIOR TO CUTOFF DATE?                  
         BL    PPNX0400            YES - EXIT CC = ZERO                         
PPNX0300 EQU   *                                                                
         LTR   RB,RB               NO  - SET CC NOT ZERO                        
*                                     DON'T USE DATA                            
         B     PPNX0600                                                         
PPNX0400 EQU   *                                                                
         SR    R0,R0                                                            
PPNX0600 EQU   *                                                                
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*  SPLMKT$$  -  CALCULATES THE MARKET $$ FOR AN ORDER BASED ON THE              
*     REP'D STATION % FROM THE SPL ELEMENT, AND THE TOTAL ORDERED               
*     $$ AVAILABLE FOR THE MONTH.                                               
*                                                                               
SPLMKT$$ NMOD1 0,*SPL$*                                                         
         L     RC,FILEC                                                         
         USING FILED,RC                                                         
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED THROUGH - DON'T CHANGE IT                      
*                                                                               
         L     R3,0(R1)            RESET A(COLUMN IN ARRAY)                     
         L     R1,4(R1)            RESET CURRENT BOOKED DOLLARS                 
*                                                                               
*   SPL CALCULATIONS:                                                           
*   WHEN CONTRACT IS A 'WIN':                                                   
*        MONTHLY AMOUNT IS PASSED IN R1.  THE SPL PERCENT IS                    
*        IN THE CONTRACT SPECIFIC AREA.   TO CALCULATE THE TOTAL                
*        MARKET $$ FOR THE PERIOD:  MONTHLY AMOUNT/SPL PERCENT.                 
*        THE RESULT IS THEN PLACED IN THE COLUMN SPECIFIED BY R3.               
*      ADDITIONALLY, A 'WIN' MAY BE A CREDIT:  NEGATIVE DOLLARS IN              
*        R1.  IN SUCH A CASE, R1 WILL BE SET TO ZERO, AND RESULTS               
*        PASSED FORWARD.                                                        
*                                                                               
*   WHEN CONTRACT IS A 'LOSS':                                                  
*        THERE WILL BE NO VALUE IN R1.  THE SPL PERCENT IN THE                  
*        CONTRACT SPECIFIC AREA WILL CONTAIN THE TOTAL MARKET BUDGET            
*        $$ RATHER THAN AN SPL PERCENT.  THIS VALUE IS TO BE ADDED              
*        TO THE TOTAL MARKET $$ FIGURE, WHICH WILL >>DECREASE<< THE             
*        SPL AS-RUN FIGURE.                                                     
*                                                                               
*        WHEN AMOUNT PASSED IN IS CURRENT FORECAST FOR SPL AS-RUN               
*        (ESTIMATED), THE CURR FORECAST VALUE IS PASSED IN, DESPITE             
*        THE FACT THAT THERE WILL BE !! NO !! SPL PCT FOR CONTRACT.             
*                                                                               
SM$$0020 EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        ST    R1,FULL             SAVE TEMPORARILY                             
*        L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
*        L     RF,CSSPLPCT(RE)     GET SPL PCT FOR CONTRACT                     
*        MVC   P+1(12),=C'LOSS FLAG = '                                         
*        MVC   P+14(1),CSSPLOSS(RE)                                             
*        EDIT  (RF),(6,P+20)                                                    
*        GOTO1 HEXOUT,DMCB,RCONKCON,P+42,4,=C'TOG'                              
*        GOTO1 REPORT                                                           
*        L     R1,FULL             RESTORE R1                                   
*   END TEST                                                                    
*                                                                               
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     RF,CSSPLPCT(RE)     GET SPL PCT FOR CONTRACT                     
*                                                                               
*   CSSPLOSS IS SET IN CONTRACT ANALYZER MODULE.  IT IS 'N' ONLY IF             
*      CONTRACT HAS AN SPL ELEMENT, AND REP'D STATION HAS A PERCENT             
*      OF THE ACTION.  IF SPL ELEMENT EXISTS, AND REP'D STATION HAS             
*      NO PERCENT, VALUE IS 'Y' (LOSS).  IF NO SPL ELEMENT, VALUE IS            
*      X'00'.                                                                   
*   ONE FURTHER NOTE:  MANY CONTRACTS WERE ENTERED WITH 0% FOR ALL              
*      STATIONS, AND THE ORDER HAS DOLLARS.  THIS IS REPORTED HERE              
*      AS 'NOT A LOSS', BUT RESULTS IN DRASTICALLY INFLATING THE                
*      CALCULATED SHARE, BY ADDING THE ORDER DOLLARS TO THE NUMERATOR,          
*      AND $0 (ORDER DOLLARS / 0%) TO THE DENOMINATOR OF THE CALC.              
*      SUCH ORDERS WILL BE TREATED SAME AS 'CREDITS' - THEY WILL NOT            
*      BE CONSIDERED IN THE CALCULATION.                                        
*                                                                               
         CLI   CSSPLOSS(RE),C'N'   SPL NOT A LOSS?                              
         BNE   SM$$0140            NO  - LOSS OR NO SPL                         
         LTR   RF,RF               IT'S A WIN - ANY SPL PERCENT?                
         BZ    SM$$0040            NO  - TREAT SAME AS CREDIT                   
         LTR   R1,R1               CHECK FOR 'CREDIT': NEGATIVE                 
         BNM   SM$$0060            NOT NEGATIVE: PROCEED                        
SM$$0040 EQU   *                                                                
         SR    R1,R1               NEGATIVE: SET R1 TO ZERO                     
SM$$0060 EQU   *                                                                
         SR    R0,R0                                                            
         M     R0,=F'10000'        MULT MONTHLY $ BY 10,000                     
*                                     PCT FIGURE IS XX.XX                       
         SLDA  R0,1                DOUBLE FOR ROUNDING                          
         LTR   R0,R0               VALUE NEEDS BOTH REGISTERS?                  
         BZ    SM$$0080            NO  - PROCEED                                
         C     RF,=F'4'            YES - CHECK DIVISOR SIGNIFICANCE             
         BH    SM$$0080            SIGNIFICANT ENOUGH TO PROCEED                
         SR    RF,RF               NOT SIGNIFICANT: DON'T DIVIDE                
SM$$0080 EQU   *                                                                
         AR    R1,RF               ADD PCT AMOUNT FOR ROUNDING                  
         LTR   RF,RF               ANY PERCENT?                                 
         BNZ   SM$$0100            YES                                          
         SR    R1,R1               NO % = NO MARKET $$                          
         B     SM$$0120                                                         
SM$$0100 EQU   *                                                                
         DR    R0,RF               AMOUNT/PERCENT=MARKET $$                     
         SRA   R1,1                DIVIDE BY 2                                  
SM$$0120 EQU   *                                                                
         A     R1,0(R3)            ADD AMOUNT IN SPL MKT$ BUCKET                
         ST    R1,0(R3)            STORE IT BACK                                
         B     SM$$0180            GO FOR NEXT BUCKET                           
SM$$0140 EQU   *                   SPL WAS A LOSS                               
*                                                                               
*   A LOSS HAS BEEN IDENTIFIED.  CHECK TO ENSURE THAT THE                       
*      CONTRACT'S FLIGHT DATES FALL WITHIN THE REPORT PERIOD.                   
*                                                                               
         GOTO1 DATCON,DMCB,(3,RCONDATE),(0,WORK)   GET FLIGHT START/            
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                      END DATES         
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
         MVC   FLIGHTST,FULL                                                    
         GOTO1 DATCON,DMCB,(3,RCONDATE+3),(0,WORK)                              
         GOTO1 GETBROAD,DMCB,WORK,WORK+6                                        
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,FULL)                                 
         MVC   FLIGHTND,FULL                                                    
         CLC   FLIGHTND,QWCURST    FLIGHT ENDS BEFORE REP PERIOD?               
         BL    SM$$0180            YES - GO FOR NEXT BUCKET                     
         CLC   QWCURND(2),FLIGHTST FLIGHT STARTS AFTER REP PERIOD?              
         BL    SM$$0180            YES - GO FOR NEXT BUCKET                     
SM$$0160 EQU   *                                                                
         L     RE,ACONSPEC         A(CONTRACT SPECIFIC DATA)                    
         L     RF,CSSPLPCT(RE)     GET SPL PCT FOR CONTRACT                     
         MH    RF,=H'100'          DECIMAL ALIGN                                
         ST    RF,0(R3)            LOSS - VALUE RETURNED FROM SPL WAS           
*                                     MARKET $$ - USE AS IS                     
SM$$0180 EQU   *                                                                
*                                                                               
         XIT1                      EXIT ROUTINE                                 
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*    FOR MARKET ORDER, THIS ROUTINE SORTS THE STATIONS WITHIN THE               
*      MARKETS INTO ALPHA SEQUENCE.                                             
*                                                                               
SORTSTAS NMOD1 0,*SORS*                                                         
         L     RC,12(R1)           RESET A(WORKSPACE)                           
         XC    IOAREA+2(2),IOAREA+2       WIPE OUT FLAG                         
         LM    R4,R6,0(R1)         LOAD PARAMETERS                              
*                                  R4 = A(FIRST ELEMENT)                        
*                                  R5 = COUNT                                   
*                                  R6 = LENGTH                                  
         LR    R7,R4               SET A(SECOND ELT): A(1ST ELT)                
         AR    R7,R6               + L(ENTRY) = A(2ND ELT)                      
*        MVC   IOAREA+2(2),DSTNREP(R4)    SET REP CODE                          
SS001    EQU   *                                                                
         SR    R3,R3               INITIALIZE COUNTER TO ZERO                   
SS003    EQU   *                                                                
         CLI   0(R7),2             NEXT ELT A STATION ELT?                      
         BNE   SS015               NO                                           
*        CLC   IOAREA+2(2),DSTNREP(R7)   SAME REP?                              
*        BNE   SS015               NO                                           
         CLC   DMKTNAM(20,R4),DMKTNAM(R7)    SAME MARKET?                       
         BNE   SS020               NO                                           
         LA    R3,1(R3)            YES - INCREMENT COUNTER                      
         AR    R7,R6               INCREASE A(2ND ELEMENT)                      
         B     SS003               GO BACK FOR NEXT                             
*                                                                               
SS015    EQU   *                                                                
         MVC   IOAREA+2(2),=X'FFFF' SET END FLAG                                
*                                                                               
SS020    EQU   *                                                                
         LTR   R3,R3               MORE THAN ONE STATION?                       
         BZ    SS030               NO                                           
         LA    R3,1(R3)            YES - ADD 1 FOR 1ST STATION                  
         GOTO1 XSORT,DMCB,(0,(R4)),(R3),(R6),5,DSTNCALL                         
*                                                                               
SS030    EQU   *                                                                
         CLC   IOAREA+2(2),=X'FFFF' END OF ROUTINE?                             
         BE    SS099               YES                                          
         LR    R4,R7               RESET A(1ST ELT)                             
         AR    R7,R6               RESET A(2ND ELT)                             
         B     SS001               GO BACK FOR NEXT                             
*                                                                               
SS099    EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*    FOR BUYLINE CODE DATA, THE ORIGINAL CONTRACT MUST BE DUMMIED               
*        UP WITH BUCKETS GENERATED BY THE BUYLINES INDICATED                    
*        IN THE 9B01 PASSIVE KEYS.  THE CONTRACT IS THEN PASSED                 
*        BACK TO REGULAR PROCESSING.                                            
*        TEMPORARY STORAGE FOR KEY PROCESSING, ETC, WILL BE SET                 
*        UP IN THE 'RCTGREC' FILE AREA.  THIS IS NOT USED DURING                
*        THE EXECUTION OF THESE MODULES, AND PROVIDES UNIQUE, NON-              
*        REUSED TEMPORARY SPACE.                                                
*                                                                               
BUYCODER NMOD1 0,*BCOD*                                                         
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         L     R3,4(R1)            RESET A(REPCODE IN USE)                      
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN  -  DONT CHANGE IT                          
*                                                                               
         CLI   BYCODFLG,2          NO MORE DATA PASS?                           
         BE    BCOD0970            YES - EXIT CC NOT ZERO                       
         CLI   BYCODFLG,1          CONTRACT JUST PROCESSED?                     
         BNE   BCOD0005            NO  -                                        
*                                  YES                                          
         GOTO1 =V(HELLO),DMCB,(C'D',=C'REPFILE'),(X'03',RCONREC),0,0            
         GOTO1 =V(HELLO),DMCB,(C'D',=C'REPFILE'),(X'04',RCONREC),0,0            
*                                  DROP BUCKETS FROM RECORD                     
BCOD0005 EQU   *                                                                
         OC    BYCODKEY,BYCODKEY   ANY KEY IN SAVE AREA?                        
         BNZ   BCOD0010            YES                                          
         XC    KEY,KEY             NO  - SET UP NEW 9B01                        
         MVC   KEY(2),=X'9B01'     INSERT KEY TYPE                              
         MVC   KEY+11(2),0(R3)     INSERT REP CODE IN USE                       
         MVC   BYCODKEY,KEY        SAVE THIS KEY FOR START                      
         MVI   BYCODFLG,0          CLEAR BUY CODE FLAG                          
BCOD0010 EQU   *                                                                
         MVC   KEY(27),BYCODKEY    START/RESTART AT BREAK KEY                   
         GOTO1 AHIGH               READ FOR HIGH KEY                            
         B     BCOD0030                                                         
BCOD0020 EQU   *                                                                
         GOTO1 ASEQ                                                             
BCOD0030 EQU   *                                                                
         CLC   KEY(13),BYCODKEY    SAME KEY TYPE/REP?                           
         BE    BCOD0040            YES                                          
*                                  NO  - END OF DATA FOR REP                    
         CLI   BYCODFLG,1          CONTRACT TO PROCESS?                         
         BNE   BCOD0970            NO  - EXIT CC NOT ZERO                       
*                                     NO CONTRACT TO PROCESS                    
         MVI   BYCODFLG,2          YES - SET 'PROCESS, THEN END'                
         B     BCOD0960            EXIT CC ZERO                                 
BCOD0040 EQU   *                                                                
         OC    BYCODKEY+13(7),BYCODKEY+13                                       
*                                  ANY BUY CODE AND CONTRACT#?                  
         BNZ   BCOD0050            YES - NOT FIRST TIME                         
         MVC   BYCODKEY,KEY        NO  - FORCE SAME KEY                         
*                                     FORCES NEXT TEST 'EQUAL'                  
BCOD0050 EQU   *                                                                
         CLC   KEY(20),BYCODKEY    SAME KEY TYPE/REP/BUY CODE/CON#?             
         BE    BCOD0080            YES - PROCESS IT                             
         MVC   BYCODKEY,KEY        NO  - SAVE KEY FOR RESTART                   
         CLI   BYCODFLG,0          CONTRACT TO PROCESS?                         
         BE    BCOD0020            NO  - PROCESS NEXT KEY                       
         B     BCOD0960            YES - EXIT CC ZERO                           
BCOD0080 EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        MVC   P+1(10),=C'DATE TEST:'                                           
*        GOTO1 HEXOUT,DMCB,BYCODKEY,P+13,27,=C'TOG'                             
*        GOTO1 REPORT                                                           
*        GOTO1 REPORT                                                           
*   TEST FILTER END                                                             
*                                                                               
         LA    RE,KEY                                                           
         USING RBY3KEY,RE                                                       
         OC    RBY3KFEN,RBY3KFEN        ANY END DATE?                           
         BNZ   BCOD0085                 YES                                     
         MVC   RBY3KFEN,RBY3KFST        NO  - SET END TO START                  
BCOD0085 EQU   *                                                                
         CLI   RBY3KFST+1,1        MONTH OF START = JANUARY?                    
         BNE   BCOD0090            NO  - JUST DECREASE MONTH                    
         MVI   RBY3KFST+1,12       YES - SET TO DECEMBER                        
         ZIC   RF,RBY3KFST         DECREASE YEAR BY 1                           
         BCTR  RF,0                                                             
         STC   RF,RBY3KFST         REPLACE YEAR                                 
         B     BCOD0100                                                         
BCOD0090 EQU   *                                                                
         ZIC   RF,RBY3KFST+1                                                    
         BCTR  RF,0                DECREASE MONTH BY 1                          
         STC   RF,RBY3KFST+1       REPLACE MONTH                                
BCOD0100 EQU   *                                                                
*                                                                               
*   TEST                                                                        
*        MVC   P+1(10),=C'DATES USED'                                           
*        MVC   P+12(3),RBY3KFST                                                 
*        MVC   P+16(3),RBY3KFEN                                                 
*        MVC   P+20(3),QWCURST                                                  
*        MVC   P+24(3),QWCURND                                                  
*        MVC   P+28(3),QWPRIST                                                  
*        MVC   P+32(3),QWPRIND                                                  
*        MVC   P+36(8),QWMONACT                                                 
**       GOTO1 REPORT                                                           
*                                                                               
*   TEST                                                                        
*        MVC   P+1(08),=C'R2/BCOD='                                             
*        ST    R2,P+12                                                          
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
*        GOTO1 REPORT                                                           
***      LA    RE,KEY                   RESTORE USING FOR KEY                   
*   TEST FILTER END                                                             
*                                                                               
         CLC   RBY3KFEN(2),QWCURST BUY FLT END BEFORE REPORT                    
*                                     CURRENT PERIOD START?                     
         BL    BCOD0120            YES - CHECK PRIOR YEAR                       
         CLC   RBY3KFST(2),QWCURND BUY FLT START AFTER REPORT                   
*                                     CURRENT PERIOD END?                       
         BNH   BCOD0160            NO  - FLIGHTED WITHIN REPORT PERIOD          
*                                  YES - NOT WITHIN CURR YEAR'S REPORT          
BCOD0120 EQU   *                                                                
         CLC   RBY3KFEN(2),QWPRIST BUY FLT END BEFORE REPORT                    
*                                     PRIOR   PERIOD START?                     
         BL    BCOD0140            YES - NOT IN REPORT AT ALL                   
         CLC   RBY3KFST(2),QWPRIND BUY FLT START AFTER REPORT                   
*                                     PRIOR   PERIOD END?                       
         BNH   BCOD0160            NO  - FLIGHTED WITHIN REPORT PERIOD          
BCOD0140 EQU   *                                                                
*                                                                               
*   TEST                                                                        
***      MVC   P+1(13),=C'NOT IN FLIGHT'                                        
***      GOTO1 HEXOUT,DMCB,BYCODKEY,P+16,27,=C'TOG'                             
***      GOTO1 REPORT                                                           
***      GOTO1 REPORT                                                           
*   TEST FILTER END                                                             
*                                                                               
         B     BCOD0020            NOT WITHIN REPORT:                           
*                                     RECORD NOT USED - DON'T SAVE KEY          
         DROP  RE                                                               
BCOD0160 EQU   *                                                                
*                                                                               
*   TEST                                                                        
***      MVC   P+1(13),=C'*** IN FLIGHT'                                        
***      GOTO1 HEXOUT,DMCB,BYCODKEY,P+16,27,=C'TOG'                             
***      GOTO1 REPORT                                                           
***      GOTO1 REPORT                                                           
*   TEST FILTER END                                                             
*                                                                               
         MVC   BYCODKEY,KEY        SAVE KEY FOR 'NEXT'                          
         CLC   RCONKCON,BYCODKEY+16                                             
*                                  CONTRACT ALREADY LOADED?                     
         BE    BCOD0180            YES                                          
         XC    KEY,KEY                                                          
         MVI   KEY,X'8C'           INSERT RECORD KEY TYPE                       
         MVC   KEY+21(2),RCREPFL   INSERT REP CODE                              
         ZAP   DUB(5),=P'99999999'                                              
         ZAP   WORK(5),=P'0'                                                    
         MVO   WORK(5),BYCODKEY+16(4)                                           
         SP    DUB(5),WORK(5)                                                   
         MVO   WORK(5),DUB(5)                                                   
         MVC   KEY+23(4),WORK      INSERT CONTRACT # 9'S COMP'D                 
         GOTO1 AHIGH               READ KEY                                     
         CLC   KEY(27),KEYSAVE     FOUND?                                       
         BE    *+6                 YES                                          
         DC    H'0'                NO  - MUST BE ON FILE                        
         GOTO1 AGETCONT            RETRIEVE CONTRACT RECORD                     
*                                                                               
*   TEST                                                                        
***      MVC   RCONBUYR,=C'BILLUHRBILLUHRBILLUH'                                
*                                                                               
         GOTO1 =V(HELLO),DMCB,(C'D',=C'REPFILE'),(X'03',RCONREC),0,0            
         GOTO1 =V(HELLO),DMCB,(C'D',=C'REPFILE'),(X'04',RCONREC),0,0            
*                                  DROP BUCKETS FROM RECORD                     
         MVC   KEY,BYCODKEY        RESET BUY CODE KEY                           
         GOTO1 AHIGH               REREAD BUY CODE PASSIVE                      
BCOD0180 EQU   *                                                                
         GOTO1 AGETBUY                                                          
*                                                                               
*        FILL IN ROUTINE BLOCK FOR REGENBUC                                     
*                                                                               
         L     RF,ADCONLST                                                      
         USING ADCONSD,RF                                                       
         MVC   DBCOMFCS,VCOMFACS   SET A(COMFACS)                               
         L     RF,=V(RECUP)                                                     
         ST    RF,P5                                                            
         L     RF,=A(BUCKETS)                                                   
         ST    RF,P6                                                            
*   TEST                                                                        
***      MVC   RBUYREC+2(14),=C'BIXXUHRBIXXUHR'                                 
*                                                                               
*                                                                               
         OC    RBUYCOS,RBUYCOS     ANY COST IN THIS BUY?                        
         BZ    BCOD0190            NO  - DON'T UPDATE BUCKETS                   
         GOTOX (RFBUCKUP,VREPFACS),DMCB,RBUYREC,(2,RCONREC),           X        
               DBCOMFCS,GETBROAD,,                                              
         BE    *+6                                                              
         DC    H'0'                MUST UPDATE CORRECTLY                        
BCOD0190 EQU   *                                                                
*                                                                               
*                                                                               
*   TEST FOR BUCKET CONSTRUCTION                                                
**       CLC   =X'00018805',RCONKCON                                            
**       BNE   TEST0045                                                         
**       MVC   P+1(04),=C'BUY='                                                 
**       MVC   P+5(27),RBUYREC                                                  
**       GOTO1 REPORT                                                           
*                                                                               
*   TEST                                                                        
**       LA    R6,RCONREC          SET A(AREA TO DISPLAY)                       
**       GOTO1 =V(PRNTBL),DMCB,0,(R6),C'DUMP',0320,=C'2D'                       
*   TEST                                                                        
*                                                                               
TEST0045 EQU   *                                                                
*   TEST END                                                                    
*                                                                               
BCOD0200 EQU   *                                                                
         BAS   RE,RESETDAT              RESET ACTIVITY DATES IN ELTS            
*                                                                               
         MVI   BYCODFLG,1          SET 'CONTRACT TO PROCESS'                    
         MVC   NEW5FELT+2(3),BYCODKEY+13                                        
*                                  INSERT PASSIVE BUYCODE FOR TEMP ELT          
         XC    NEW5FELT+5(7),NEW5FELT+5                                         
*                                  CLEAR LOWER PART OF ELT                      
         B     BCOD0020            GO BACK FOR NEXT PASSIVE                     
*                                                                               
BCOD0960 EQU   *                                                                
         GOTO1 =V(HELLO),DMCB,(C'D',=C'REPFILE'),(X'5F',RCONREC),0,0            
*                                  DELETE OLD 'TEMP' ELT                        
         XC    KEY,KEY             RETRIEVE ATTRIBUTES FROM CODE                
         MVI   KEY,X'4B'           INSERT BUYLINE CODE REC TYPE                 
         MVC   KEY+21(2),RCREPFL   INSERT REP FILE                              
         MVI   KEY+23,1            SET TYPE OF CODE TO 'CODE'                   
         MVC   KEY+24(3),NEW5FELT+2                                             
*                                  INSERT PASSIVE BUYCODE                       
         GOTO1 AHIGH               READ FOR KEY                                 
         CLC   KEY(27),KEYSAVE     KEY MUST BE THERE                            
         BE    *+6                                                              
         DC    H'0'                                                             
         GOTO1 AGETSPB                                                          
         LA    RF,IOAREA           SET A(SPEC BUYLINE CODE REC)                 
         USING RSPBRECD,RF                                                      
         MVC   NEW5FELT+5(6),RSPCTYPS                                           
*                                  INSERT CODE TYPES INTO ELEMENT               
         DROP  RF                                                               
*                                                                               
         GOTO1 =V(HELLO),DMCB,(C'P',=C'REPFILE'),RCONREC,NEW5FELT,0             
*                                  INSERT NEW TEMP ELT INTO CONTRACT            
         SR    R0,R0               SET CC ZERO                                  
         B     BCOD0980                                                         
BCOD0970 EQU   *                                                                
         LTR   RB,RB                                                            
BCOD0980 EQU   *                                                                
         XIT1                                                                   
NEW5FELT DC    X'5F0C'                                                          
         DC    10X'00'                                                          
         EJECT                                                                  
RESETDAT NTR1                                                                   
*                                                                               
         USING QWKD,R2                                                          
*                                                                               
*   R2 PREVIOUSLY SET AND PASSED IN  -  DONT CHANGE IT                          
*                                                                               
         LA    R3,RCONELEM              SET A(DESCRIPTIVE ELT)                  
RSDT0020 EQU   *                                                                
         CLI   0(R3),0                  END OF RECORD?                          
         BE    RSDT0800                 YES - FINISHED                          
         CLI   0(R3),3                  ESTIMATE BUCKET?                        
         BNE   RSDT0100                 NO  -                                   
         USING RCONBKEL,R3                                                      
         CLC   RCONBKYR(2),QWCURST      BUCKET MONTH OF SERVICE EARLIER         
*                                          THAN REPORT REQUEST PERIOD?          
         BL    RSDT0040                 YES - ASAT = TODAY, LAST YEAR           
         MVC   RCONBKWK,QWMONFOR        NO  - ASAT = TODAY, THIS YEAR           
         B     RSDT0100                                                         
RSDT0040 EQU   *                                                                
         MVC   RCONBKWK,QWMONFOR+2      ASAT = TODAY, LAST YEAR                 
RSDT0100 EQU   *                                                                
         ZIC   RF,1(R3)                 BUMP TO NEXT ELEMENT                    
         AR    R3,RF                                                            
         B     RSDT0020                 GO BACK FOR NEXT                        
RSDT0800 EQU   *                                                                
         XIT1                                                                   
         DROP  R3                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*              WORKING STORAGE                                                  
*                                                                               
         SPACE                                                                  
RGWORKC  DS    0D                                                               
*                                                                               
*   WORKAREA LAYOUT CODE MOVED TO A LIBRARY ELEMENT ON 9/27/01.                 
*   BILL UHR.                                                                   
*                                                                               
         DC    CL8'*STORGE*'                                                    
*                                                                               
AXTRA    DS    0F                  EXTENTION ROUTINE ADDRESSES                  
AHIGH    DS    A                                                                
ASEQ     DS    A                                                                
AGETCONT DS    A                                                                
AGETBUD  DS    A                                                                
AGETPROD DS    A                                                                
AGETCOM  DS    A                                                                
AGETSTA  DS    A                                                                
AGETEOM  DS    A                                                                
AGETSET  DS    A                                                                
APUTBUFF DS    A                                                                
AHIGHBUF DS    A                                                                
ASEQBUFF DS    A                                                                
ARSETBUF DS    A                                                                
APUTMERG DS    A                                                                
ADUMPBUF DS    A                                                                
AGETBUY  DS    A                                                                
AGETSPB  DS    A                                                                
AXTRAN   EQU   (*-AXTRA)/L'AXTRA                                                
*                                                                               
RELO     DS    A                                                                
BUFFC    DS    A                                                                
AMONROW  DS    A                                                                
COVPARM1 DS    A                                                                
COVPARM2 DS    A                                                                
ABOPEL   DS    A                                                                
ASAREL   DS    A                                                                
ASTAEL   DS    A                                                                
VREPFACS DS    A                   NEW: FOR A(REPFACS)                          
R3STORE  DS    F                                                                
R4STORE  DS    F                                                                
REGSTOR  DS    F                                                                
KCOMPLEN DS    F                                                                
RECAPLVL DS    H                                                                
CURST    DS    H                                                                
CURND    DS    H                                                                
PRIST    DS    H                                                                
PRIND    DS    H                                                                
CAVLMON  DS    H                                                                
PAVLMON  DS    H                                                                
FLIGHTST DS    H                                                                
FLIGHTND DS    H                                                                
CURST3   DS    CL3                 3-BYTE BINARY DATE                           
CURND3   DS    CL3                 3-BYTE BINARY DATE                           
PRIST3   DS    CL3                 3-BYTE BINARY DATE                           
PRIND3   DS    CL3                 3-BYTE BINARY DATE                           
ACCOPT   DS    CL1                 ACCOUNTING OPTION                            
REQDAY   DS    CL1                 DAY FROM REQUEST START                       
*                                     SPACE  =  NO REQUEST DAY                  
YMS      DS    CL2                                                              
YME      DS    CL2                                                              
BUDLOYR  DS    CL2                                                              
BUDHIYR  DS    CL2                                                              
RUNDATE  DS    XL3                                                              
SPLDT    DS    XL3                                                              
CURRUNDT DS    XL3                                                              
PRIRUNDT DS    XL3                                                              
MONTHROW DC    XL(RGROWSZ-1)'00'                                                
SVMONTH  DS    XL2                                                              
RPTNUM   DS    X                                                                
REQNUM   DS    X                                                                
REQST    DS    X                                                                
REQEND   DS    X                                                                
INFCODE  DS    X                                                                
REQTOTS  DS    C                                                                
TOTSONLY DS    C                                                                
RPTFILT  DS    C                                                                
SPEC     DS    C                                                                
PERIOD   DS    C                                                                
SALES    DS    C                                                                
AVAILS   DS    C                                                                
BUDGETS  DS    C                                                                
YEAR     DS    C                                                                
MONTH    DS    C                                                                
BUDYR    DS    C                                                                
RECORD   DS    C                                                                
MONTHTYP DS    C                                                                
COMIND   DS    X                   COMMISSION INDICATOR                         
COMICON  EQU   X'80'                                                            
COMIBUD  EQU   X'40'                                                            
RDIND    DS    X                   READ INDICATOR                               
RDIPRD   EQU   X'80'                                                            
RDISABOP EQU   X'40'                                                            
COMST    DS    XL2                                                              
COMND    DS    XL2                                                              
KEYSTORE DS    XL(RGKEYLEN)                                                     
COMSTORE DS    XL(RGCMTLEN)                                                     
TRACEKEY DS    CL32                                                             
BYCODKEY DS    CL27                SAVE AREA FOR BUY CODE PROCESSING            
BYCODFLG DS    XL1'00'             BUY CODE PROCESSING FLAG                     
FGROUP   DS    CL1                                                              
FSBGROUP DS    CL1                                                              
FSTATION DS    CL5                                                              
FOFFICE  DS    CL2                                                              
FAGENCY  DS    CL4                                                              
FAGYOFF  DS    CL2                                                              
FADV     DS    CL4                                                              
STASAVE  DS    CL5                                                              
STATVB   DS    CL2                                                              
STAOWN   DS    CL3                                                              
STARANK  DS    C                                                                
STAAFFL  DS    CL3                                                              
STAMKT   DS    CL4                                                              
STASAV   DS    CL5                                                              
SVCODE   DS    CL1                                                              
SVKEY    DS    XL(L'KEY)                                                        
QRECORD2 DS    CL80                                                             
QRECORD3 DS    CL80                                                             
*                                                                               
AVLMSK   DS    X                                                                
RAVLMSK  DS    X                                                                
QAVLMSK  DS    X                                                                
CURREJCT EQU   1                                                                
PRIREJCT EQU   2                                                                
REJECTED EQU   3                                                                
RESOLVED EQU   X'80'                                                            
*                                                                               
AVLDTMSK DS    X                                                                
RUNDATS  EQU   1                                                                
ASATDATS EQU   2                                                                
*                                                                               
SVDISP   DS    H                                                                
*                                                                               
FRST2    DS    A         ADDRESS OF FIRST STATION ELEMENT IN SPACEND            
SFRST2   DS    A         A(1ST ELEMENT FOR SORTING IN SECTIONS                  
SVR4ADDR DS    A         A(BUFFALO ROW ADDRESS IN PROGRESS)                     
*                                                                               
SVADV    DS    CL4                                                              
SVPRD    DS    CL3                                                              
SVSTA    DS    CL5                                                              
*                                                                               
COSPEC#  DS    X                   COMPANY ROW SPEC #                           
TESTREP  DS    CL2                 TEST REP FOR STA ROW SPEC                    
NUMCTYPS DS    X                   # CONTRACT TYPES IN BUDGET RECORD            
CTYPREQD DS    CL1                 CONTRACT TYPES REQUESTED FLAG                
CTYPDONE DS    X                   CONTRACT TYPES PROCESSED COUNTER             
CTYPBACK DS    CL1                 CONTRACT TYPE FOR ROW SPEC                   
SVQSTART DC    XL6'FFFFFFFFFFFF'   EARLIEST REQUEST START DATE                  
SVQSTRT2 DS    XL2                 EARLIEST:  TWO BYTE FORMAT                   
SVQEND   DC    CL6'000000'         LATEST   REQUEST END   DATE                  
SVQEND2  DS    XL2                 LATEST:    TWO BYTE FORMAT                   
NEWSTART DC    XL6'FFFFFFFFFFFF'                                                
NUMRATES DS    XL1                 NUMBER OF COMMISSION RECORDS                 
THSWKFLG DS    CL1                 SPL AS-RUN THIS WEEK FLAG                    
NRRGFLAG DC    CL1'N'              Y = ADJUST ARRAY/AS-AT DATES                 
SHRGOAL  DS    F                   SHARE GOAL VALUE                             
ACMKTFLD DS    A                   A(CMKT FIELD ON BUFFREC)                     
APMKTFLD DS    A                   A(PMKT FIELD ON BUFFREC)                     
ACPMKFLD DS    A                   A(CPMK FIELD ON BUFFREC)                     
APPMKFLD DS    A                   A(PPMK FIELD ON BUFFREC)                     
ACFMKFLD DS    A                   A(CFMK FIELD ON BUFFREC)                     
APFMKFLD DS    A                   A(PFMK FIELD ON BUFFREC)                     
AESTTFLD DS    A                   A(ESTIMATED TOTAL ON BUFFREC)                
ANEXTSET DS    F                   A(NEXT SET SLOT)                             
AFRSTSET DS    F                   A(FIRST SET SLOT)                            
OUTCOUNT DS    F                   OUTPUT RECORD COUNTER                        
*                                                                               
XFE      DC    XL8'FEFEFEFEFEFEFEFE'                                            
*                   0.0.0.0.0.0.0.0.0.1.1.1.1.1.1.                              
*                   .1.2.3.4.5.6.7.8.9.0.1.2.3.4.5.6.7.8.9.0                    
CMBOREPI DC    CL40'IRIRMGGPI2I8I9D4RMIFS1AQCNSJRTL7IBNXUO00'                   
CMBOREPT DC    CL28'7S7S5T6T7T8T9TT00T1S2S3S8S00'                               
CMBOREPK DC    CL30'K3K3BFKUKFEACRK4S3RSQDNUG8J000'                             
CMBOREPN DC    CL10'V6V6NPV500'                                                 
CMBOREPM DC    CL12'MSMSU1U2UR00'                                               
*                                                                               
*   NOTE:  'COMBO' STATION REPORTING MAY BE TURNED OFF BY INSERTING             
*          '00' IN FIRST ENTRY OF TABLE.  FOR THIS REASON, 'IR' HAS             
*          BEEN INCLUDED TWICE SO THAT, IF TABLE IS TURNED OFF, A               
*          VALUE IS NOT ACCIDENTALLY LOST.                                      
*                                                                               
CMBOREP  DC    CL1'N'              MASTER OR SUBSIDIARY FLAG                    
CMBOMSTR DS    CL2                 MASTER CODE                                  
NOPRIFLG DS    CL1                 DON'T USE PRIOR DATA FLAG                    
NOCURFLG DS    CL1                 DON'T USE CURRENT DATA FLAG                  
USESPBUD DS    CL1                 Y = CYCLE THRU SALESPERSON BUDGETS           
         EJECT                                                                  
       ++INCLUDE RESVCTAB                                                       
         EJECT                                                                  
       ++INCLUDE DEDBLOCK                                                       
         EJECT                                                                  
BKUP     DCB   DDNAME=RRGBKUP,DSORG=PS,EODAD=RFIR0760,LRECL=RGRECLEN,  X        
               BLKSIZE=16*RGRECLEN,MACRF=(GM,PM),RECFM=FB                       
*                                                                               
CARDFILE DCB   DDNAME=CARDOUT,DSORG=PS,RECFM=F,LRECL=80,MACRF=PM,      X        
               BLKSIZE=80                                                       
         SPACE 2                                                                
         DS    0D                                                               
         DC    CL8'*BUFREC*'                                                    
BFREC    DS    0CL(RGRECLEN)       BUFFALO RECORD                               
BFKEY    DS    XL(RGKEYLEN)        KEY                                          
BFCOM    DS    CL(RGCMTLEN)        COMMENTS                                     
BFACCS   DS    XL(RGDTALEN)        ACCUMULATORS                                 
*                                                                               
BFRECSV  DS    CL(RGRECLEN)        BUFF REC SAVE AREA                           
         SPACE 2                                                                
SORTCARD DC    CL80'SORT FIELDS=(1,000,A),FORMAT=BI,WORK=1'                     
RECCARD  DC    CL80'RECORD TYPE=F,LENGTH=000'                                   
LOGMSG   DC    CL95'REPAK REPORT GENERATOR INPUT PHASE COMPLETED. PLEASC        
               E PRESS ENTER TO CONTINUE WITH OUTPUT PHASE.'                    
LLOGMSG  EQU   95                                                               
         SPACE 2                                                                
         DS    0D                                                               
         DC    CL8'*TOTKEY*'                                                    
TOTKEYS  DS    10CL(RGKEYLEN)      TOTAL KEYS                                   
TOTKEYSX EQU   *-1                                                              
         DS    C                                                                
         SPACE 2                                                                
         DS    0D                                                               
         DC    CL8'*IOAREA*'                                                    
IOAREA   DS    2000X               1000 BYTE IO AREA                            
         SPACE 2                                                                
         DS    0D                                                               
         DC    CL8'*RPSPEC*'                                                    
RPSPECS  DC    100XL(RPS050X-RPSPECD)'00'  REPORT SPEC WORK AREAS               
         DC    100XL(RPS100X-RPS050X)'00'  REPORT SPEC WORK AREAS               
         DC    100XL(RPSPECX-RPS100X)'00'  ADDITIONAL AREA                      
         DC    028XL(RPS050X-RPSPECD)'00'  REPORT SPEC WORK AREAS               
         DC    028XL(RPS100X-RPS050X)'00'  REPORT SPEC WORK AREAS               
         DC    028XL(RPSPECX-RPS100X)'00'  ADDITIONAL AREA                      
*                                          MAX 128 REPORTS                      
RPSPECSX EQU   *-1                                                              
         SPACE 2                                                                
         DS    0D                                                               
         DC    CL8'*COMTAB*'                                                    
COMTAB   DS    (NCOMTAB)XL(LCOMTAB)        COMMISSION TABLE                     
COMTABX  EQU   *-1                                                              
         DC    XL2'00'             DELIMITER                                    
LCOMTAB  EQU   18                                                               
NCOMSTAT EQU   0                   STATION CALL LETTERS                         
NCOMOFF  EQU   5                   OFFICE                                       
NCOMADV  EQU   7                   ADVERTISER CODE                              
NCOMTYP  EQU   11                  CONTRACT TYPE                                
NCOMDATE EQU   12                  START DATE                                   
NCOMRATE EQU   14                  RATE                                         
NCOMTAB  EQU   1000                                                             
         SPACE 2                                                                
         DS    0D                                                               
         DC    CL8'**BUFF**'                                                    
         BUFF  LINES=1000,ROWS=1,COLUMNS=20,FLAVOR=BINARY,             X        
               KEYLIST=(108,A),COMMENT=20                                       
*                       9X12                                                    
*              KEYLIST=(144,A),COMMENT=20                                       
*                       9X16                                                    
*                                                                               
*   LENGTH OF KEYLIST MUST BE CHANGED IF # ROWS IS CHANGED.!.!.!                
*                                                                               
         SPACE 2                                                                
         DS    0D                                                               
         DC    CL8'*QWAREA*'                                                    
QWAREA   EQU   *                                                                
         DC    (64*(QWEND-QWKD))X'00'  REQUEST WORK AREA                        
QWAREAX  EQU   *-1                     MAX 64 REQUESTS                          
*                                                                               
*                                                                               
WKSPACE  DS    XL1000                                                           
         ORG   WKSPACE+500                                                      
ARRAYR5  DS    CL39                ARRAY FOR R5 DATE OPTION                     
*                                  12 3-CHAR ENTRIES                            
*                                  BYTES 1  -  2  =  BINARY DATE: YM            
*                                  BYTE 3         =  FLAG BYTE                  
*                                     X'80'  =  INCLUDE PRIOR DATA              
*                                     X'40'  =  INCLUDE CURRENT DATA            
*                                  LAST ENTRY IS DELIMITER                      
*                                                                               
         ORG   WKSPACE+600                                                      
BUCKETS  DS    CL200               200 BYTE OUTPUT AREA FOR REGENBUC            
RBLOCK   DS    5F                  ROUTINE BLOCK FOR REGENBUC                   
         ORG                                                                    
*                                                                               
*   QRECORD TABLE:                                                              
*        1ST CHAR:   LENGTH OF TABLE ENTRY                                      
*        2ND CHAR:   REQUEST RECORD NUMBER:  AS OF APR13/94, THERE              
*                    ARE THREE (3) MAXIMUM REQUEST RECORDS                      
*                                                                               
*        3RD CHAR:   DISPLACEMENT INTO REQUEST RECORD OF FIELD                  
*        4TH CHAR:   LENGTH OF FIELD                                            
*                    FIELD TITLE FOR FOOTING                                    
*                                                                               
QTAB     DC    AL1(11,1,QREGION-QRECORD,L'QREGION-1),CL7'REGION='               
         DC    AL1(08,1,QOFFICE-QRECORD,L'QOFFICE-1),CL4'OFF='                  
         DC    AL1(12,3,Q3OFFSET-QREC3,L'Q3OFFSET-1),CL8'OFF SET='              
         DC    AL1(08,1,QDIV-QRECORD,L'QDIV),CL4'DIV='                          
         DC    AL1(11,1,QMAN-QRECORD,L'QMAN-1),CL7'PERSON='                     
         DC    AL1(12,2,QSETSAL-QREC2,L'QSETSAL-1),CL8'S/P SET='                
         DC    AL1(11,1,QAGENCY-QRECORD,L'QAGENCY-1),CL7'AGENCY='               
         DC    AL1(09,3,Q3SETTER-QREC3,L'Q3SETTER-1),CL5'TERR='                 
         DC    AL1(12,2,QSETAGY-QREC2,L'QSETAGY-1),CL8'AGY SET='                
         DC    AL1(12,1,QAGYOFF-QRECORD,L'QAGYOFF-1),CL8'AGY OFF='              
         DC    AL1(08,1,QADV-QRECORD,L'QADV-1),CL4'ADV='                        
         DC    AL1(12,2,QSETADV-QREC2,L'QSETADV-1),CL8'ADV SET='                
         DC    AL1(09,1,QPRODUCT-QRECORD,L'QPRODUCT-1),CL5'PROD='               
         DC    AL1(10,1,QCLASS-QRECORD,L'QCLASS-1),CL6'CLASS='                  
         DC    AL1(10,1,QCATY-QRECORD,L'QCATY-1),CL6'CATGY='                    
         DC    AL1(10,1,QGROUP-QRECORD,L'QGROUP),CL6'GROUP='                    
         DC    AL1(12,2,QSETGSG-QREC2,L'QSETGSG-1),CL8'GRP SET='                
         DC    AL1(12,1,QSTATYPE-QRECORD,L'QSTATYPE-1),CL8'STATYPE='            
         DC    AL1(12,1,QCONTYPE-QRECORD,L'QCONTYPE-1),CL8'CONTYPE='            
         DC    AL1(13,3,Q3CTYSET-QREC3,L'Q3CTYSET-1),CL9'CTYP SET='             
         DC    AL1(12,1,QSTATION-QRECORD,L'QSTATION-1),CL8'STATION='            
         DC    AL1(12,3,Q3STASET-QREC3,L'Q3STASET-1),CL8'STA SET='              
         DC    AL1(07,3,Q3DIRRES-QREC3,L'Q3DIRRES-1),CL3'DR='                   
         DC    AL1(07,3,Q3PAYPRO-QREC3,L'Q3PAYPRO-1),CL3'PP='                   
         DC    AL1(11,3,Q3ALTCAL-QREC3,L'Q3ALTCAL-1),CL7'ALTCAL='               
         DC    AL1(10,3,Q3TRADE-QREC3,L'Q3TRADE-1),CL6'TRADE='                  
         DC    AL1(09,1,QASAT-QRECORD,L'QASAT-1),CL5'ASAT='                     
         DC    AL1(12,2,Q2ASAT2-QREC2,L'Q2ASAT2-1),CL8'ASAT TO='                
         DC    AL1(08,2,QCONUNC-QREC2,L'QCONUNC-1),CL4'U/C='                    
         DC    AL1(08,2,Q2TVB-QREC2,L'Q2TVB-1),CL4'TVB='                        
         DC    AL1(10,2,Q2OWNER-QREC2,L'Q2OWNER-1),CL6'OWNER='                  
         DC    AL1(08,2,Q2MARKET-QREC2,L'Q2MARKET-1),CL4'MKT='                  
         DC    AL1(12,3,Q3SETMKT-QREC3,L'Q3SETMKT-1),CL8'MKT SET='              
         DC    AL1(09,2,Q2RANK-QREC2,L'Q2RANK-1),CL5'RANK='                     
         DC    AL1(11,2,Q2PPSON-QREC2,L'Q2PPSON-1),CL7'PTPSON='                 
         DC    AL1(11,2,Q2NCNUM-QREC2,L'Q2NCNUM-1),CL7'NETCON='                 
         DC    AL1(11,2,Q2DEVSP-QREC2,L'Q2DEVSP-1),CL7'DEVSAL='                 
         DC    AL1(11,2,QDEVCTYP-QREC2,L'QDEVCTYP-1),CL7'DEVTYP='               
         DC    AL1(09,3,Q3SUPDET-QREC3,L'Q3SUPDET-1),CL5'CUR$='                 
         DC    AL1(13,3,Q3XTRFRM-QREC3,L'Q3XTRFRM-1),CL9'SPL FROM='             
         DC    AL1(11,3,Q3XTRTO-QREC3,L'Q3XTRTO-1),CL7'SPL TO='                 
         DC    AL1(08,3,Q3REPSET-QREC3,L'Q3REPSET-1),CL4'REP='                  
         DC    AL1(08,3,Q3JNLOST-QREC3,L'Q3JNLOST-1),CL4'R#=R'                  
         DC    AL1(08,3,Q3BKBILL-QREC3,L'Q3BKBILL-1),CL4'BB=B'                  
         DC    AL1(07,3,Q3COMBUD-QREC3,L'Q3COMBUD-1),CL3'CB='                   
         DC    AL1(08,3,Q3NATLOC-QREC3,L'Q3NATLOC-1),CL4'N/L='                  
         DC    AL1(09,3,Q3RERFLG-QREC3,L'Q3RERFLG-1),CL5'RER=R'                 
         DC    AL1(08,3,Q3OWNMKT-QREC3,L'Q3OWNMKT-1),CL4'O/M='                  
         DC    AL1(07,3,Q3BLCODE-QREC3,L'Q3BLCODE-1),CL3'BC='                   
         DC    AL1(07,3,Q3BLATT1-QREC3,L'Q3BLATT1-1),CL3'A1='                   
         DC    AL1(07,3,Q3BLATT2-QREC3,L'Q3BLATT2-1),CL3'A2='                   
         DC    X'00'                                                            
         EJECT                                                                  
*                                                                               
         EJECT                                                                  
*                                                                               
*        DSECT TO COVER RPSPECS                                                 
*                                                                               
         SPACE                                                                  
RPSPECD  DSECT                                                                  
*                                                                               
RPREQ    DS    X                   REQUEST NUM                                  
RPRPT    DS    X                   REPORT NUM                                   
RPROWS   DS    XL((RGROWMAX-1)*7)  IMPLODED ROW SPECS                           
*                                  0   = ROW DATA CODE                          
*                                  1-3 = AL3(ROW IN BUFFALO KEY)                
*                                  4-6 = AL3(ROWFILT SPECS)                     
RPCONCOL DS    XL(RGCOLMAX*7)      IMPLODED CONTRACT COL SPECS                  
*                                  0   = X'80' APPLY COMMISSSION                
*                                        X'01' PERIOD                           
*                                        X'02' YTD                              
*                                        X'04' PENDING COLUMN: DON'T            
*                                              DELIVER IF 'SPLITPND'            
*                                              AND ORDER IS  - NOT -            
*                                              PENDING!!!!                      
*                                  1-3 = AL3(COL IN BUFFALO COLS)               
*                                  4-6 = AL3(COL POST ROUTINE)                  
RPS050X  EQU   *                                                                
*                                                                               
*    NOTE  REPORT SPEC WORK AREA EXCEEDS 32K.  LABEL RPS050X INSERTED           
*        TO PERMIT SEPARATION AND ASSIGNMENT OF APPROPRIATE SPACE.              
*        NEW FIELDS SHOULD BE INSERTED AFTER RPS050X.                           
*        (SEE 'RPSPECS' LABEL EARLIER)                                          
*                                                                               
RPBUDCP  DS    A                   CURRENT PERIOD BUDGET COL ADDR               
RPBUDCY  DS    A                   CURRENT YTD BUDGET COL ADDR                  
RPREVCP  DS    A                   CURRENT PERIOD REVENUE COL ADDR              
*                                                                               
*   DO NOT - REPEAT, NOT - SEPARATE THE NEXT FOUR ITEMS                         
*                                                                               
RPSPL$AD DS    A                   SPL DOLLARS COLUMN ADDR                      
RPSPLMAD DS    A                   SPL MKT DOLLARS COLUMN ADDR                  
RPSPLDAD DS    A                   GROSS SPL DOLLARS COLUMN ADDR                
RPSPLGAD DS    A                   GROSS SPL MKT DOLLARS COLUMN ADDR            
RPSPLLEN EQU   *-RPSPL$AD                                                       
RPRECAP  DS    A                   A(RECAP SPEC)                                
RPAGGREG DS    A                   A(AGGREG SPEC)                               
RPAGGSPL DS    A                   A(AGGSPL SPEC)                               
RPBUDPAS DS    A                   A(BUDPAS SPEC)                               
RPSTATYP DS    A                   0   = Y IF THERE IS A STATYPE SPEC           
*                                  1-3 = A(STATYPE ROW ADDRESS)                 
RPMONEY  DS    C                   MONEY SPEC FLAG                              
*                                  0  =  PRINT IN THOUSANDS OF DOLLARS          
*                                  1  =  PRINT EXACT DOLLARS                    
*                                  2  =  PRINT ROUNDED DOLLARS                  
RPSPLSTA DS    C                   SPL DOLLARS/STATION ROW #                    
RPFLAGS  DS    X                   X'01' BUDGET COL(S) EXIST                    
*                                  X'02' THIS IS A RANK REPORT                  
*                                  X'04' THERE IS A 'MONTH' ROW                 
*                                  X'08' MONEY = DOLLARS                        
*                                  X'10' THERE IS A STATYPE ROW                 
*                                  X'20' THERE IS AN ONLINE SPEC                
*                                  X'40' THIS IS AN AVL REPORT                  
*                                  X'80' THIS IS A PENDING REPORT               
RPFLAG2  DS    X                   X'01' COMMENTS REQUIRED ON REPORT            
*                                  X'02' THIS IS A SPLITPND REPORT              
*                                  X'04' THIS IS A TRUE FCST REPORT             
*                                  X'08' THIS IS A TRUE PEND REPORT             
*                                  X'10' SKIP FORECAST RECORDS                  
*                                  X'20' GROSS SPL $$ CALC NEEDED               
*                                                                               
RPZERORW DS    CL3                 A(ROW IN BUFFALO KEY TO BE CLEARED           
*                                     OF VALUE (AGGREG'S ONLY)                  
RPMONROW DS    C                   MONTH ROW TYPE                               
RPMKTOT  DS    A                   0   =Y IF STAMKT SPEC FOR RADIO              
*                                  1-3 A(STAMKT ROW ADDRESS)                    
RPFILT   DS    A                   A(RPTFILT SPECS)                             
RPS100X  EQU   *                                                                
*                                                                               
*    NOTE  REPORT SPEC WORK AREA EXCEEDS 32K.  LABEL RPS100X INSERTED           
*        TO PERMIT SEPARATION AND ASSIGNMENT OF APPROPRIATE SPACE.              
*        NEW FIELDS SHOULD BE INSERTED AFTER RPS100X.                           
*        (SEE 'RPSPECS' LABEL EARLIER)                                          
*                                                                               
RPMISFLG DS    CL8                 RPTFLAGS AND ATTENDANT MEANINGS.             
*                                  SEE FULL DOCUMENTATION IN RRGON              
*                                     BUHR.DDS.TEXT(RRGDOC)                     
*                                  X'08' =  'INCOMPLETE' ORDERS ONLY            
*                                                                               
*   PRIOR/2YR PRIOR BUDGET FIELDS                                               
*                                                                               
RPBUDCPP DS    A                   PRIOR   PERIOD BUDGET COL ADDR               
RPBUDCYP DS    A                   PRIOR   YTD BUDGET COL ADDR                  
RPBUDCP2 DS    A                   2YR PRI PERIOD BUDGET COL ADDR               
RPBUDCY2 DS    A                   2YR PRI YTD BUDGET COL ADDR                  
RPSPECX  EQU   *                                                                
         EJECT                                                                  
*                                                                               
*        DSECT TO COVER COLKEY2T                                                
*                                                                               
         SPACE                                                                  
COLKEY2D DSECT                                                                  
         DS    CL2                                                              
CK2REC   DS    CL1                                                              
CK2RTN   DS    CL3                                                              
CK2PND   DS    CL1                                                              
         EJECT                                                                  
         PRINT ON                                                               
       ++INCLUDE REPFACSQ                                                       
         EJECT                                                                  
       ++INCLUDE REREPQWKDD                                                     
         EJECT                                                                  
       ++INCLUDE REREPSPEQU                                                     
         EJECT                                                                  
       ++INCLUDE DDBUFFALOD                                                     
         EJECT                                                                  
       ++INCLUDE REGENALL1A                                                     
       ++INCLUDE REREPWORKD                                                     
         EJECT                                                                  
QREC2D   DSECT                                                                  
       ++INCLUDE REGENREQ2                                                      
         EJECT                                                                  
QREC3D   DSECT                                                                  
       ++INCLUDE REGENREQ3                                                      
         EJECT                                                                  
       ++INCLUDE REXADDRD                                                       
         EJECT                                                                  
       ++INCLUDE DDMASTD                                                        
       ++INCLUDE REREPMODES                                                     
         EJECT                                                                  
       ++INCLUDE DDBIGBOX                                                       
         PRINT ON                                                               
         EJECT                                                                  
       ++INCLUDE RESUBREPS                                                      
         EJECT                                                                  
RCOMRECD DSECT                                                                  
       ++INCLUDE REGENCOM                                                       
RSETRECD DSECT                                                                  
       ++INCLUDE REGENSET                                                       
RSETLOAD DSECT                                                                  
RSETRNAM DS    F                   ADDRESS OF SET NAME IN REQST REC             
RSETWADD DS    F                   ADDRESS OF SET IN QWKD SPACE                 
RSETRSIZ DS    F                   SIZE OF ENTRY                                
RSETRTYP DS    CL2                 SET RECORD TYPE (IE, AD/AG)                  
RSETRFLG DS    CL1                 EXCLUSION FLAG VALUE                         
RSETROFF DS    CL1                 EXCLUSION FLAG ADDR OFFSET                   
RSETRMST DS    CL1                 SKIP/CHECK FOR MASTER/SUBS                   
*                                  0  =  SKIP                                   
*                                  1  =  CHECK                                  
RSPBRECD DSECT                                                                  
       ++INCLUDE REGENSPEC                                                      
*                                                                               
*  DSECT FOR ASCB                                                               
         IHAASCB                                                                
*                                                                               
*  REDEFINED STORAGE USED BY THE ROUTINE TO SET UP REPORT SPEC                  
*      WORK AREAS IN THIS MODULE ONLY.  SERVES AS TEMPORARY                     
*      STORAGE FOR THE DURATION OF THE ROUTINE.                                 
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'058REREPRG02T04/02/04'                                      
         END                                                                    

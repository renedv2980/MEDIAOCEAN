*          DATA SET SPSYSDRV1  AT LEVEL 131 AS OF 02/10/21                      
*CATALP SPSYSD1                                                                 
                                                                                
***********************************************************************         
*                                                                     *         
*          SPSYSDRV1 - SYSTEM DRIVER FOR SPOT WRITER (ROOT PROGRAM)   *         
*                                                                     *         
***********************************************************************         
* USER    JIRA       DATE                  CHANGE LOG                 *         
* ---- ----------  -------- ----------------------------------------- *         
* AKAT SPEC-52229  02/10/21 SET SBPRD WHEN PRDNAME KEYWORD IS USED    *         
* AKAT SPEC-43482  10/20/20 SUPPORT NEW UNIVERSE KEYWORDS             *         
* AKAT SPEC-31519  11/07/19 NEW NET2CPP KEYWORD SUPPORT               *         
* AKAT SPEC-27405  06/17/19 ALLOW PGROUP REQUEST FOR MULI-CLIENT REQ  *         
* AKAT SPEC-22456  04/25/18 SKIP TARGET OPTIMIZATION FOR COMSCORE     *         
* AKAT SPEC-11692  02/16/18 NEW TARGET3 & TARGET4 KEYWORD SUPPORT     *         
* AKAT SPEC-10776  10/23/17 NEW MKTYPE KEYWORD SUPPORT                *         
* AKAT SPEC-6939   03/02/17 SUPPORT COMSCORE DEMO LOOKUPS FOR 17.1.5  *         
* AKAT SPEC-15     02/10/17 SUPPORT NEW SQAD CPM (JUST A RELINK)      *         
* AKAT MOXSYS-150  10/06/16 SUPPORT COMSCORE DEMOS                    *         
* AKAT DSSUP-7224  03/31/16 ROT KEYWORD WILL NOW SUPPORT OOWR ESTS    *         
* AKAT MOSTK-20    03/17/16 NEW -CM BAND SUPPORT FOR IHEART RADIO     *         
* AKAT MOSTK-77    01/25/16 SUPPORT NEW MGDTL KEYWORD SUPPORT         *         
* 03OCT13 118 AKAT-- CALL BLDMGN INSTEAD OF BLDMGA                  *           
* 05AUG13 117 AKAT-- REPORT DIGITAL STATIONS AS -DV AND -SM         *           
* 24SEP12 116 AKAT-- SUPPORT NEW INVREP KEYWORD                     *           
* 24AUG12 115 AKAT-- NEW SQAD OPTIONS 3 AND 4 SUPPORT               *           
* 07MAY12 114 AKAT-- NEW ATIMED KEYWORD SUPPORT                     *           
* 08FEB12 113 AKAT-- CHANGE HEADLINES FOR COST2CPP                  *           
* 01FEB12 112 AKAT-- CHOPPER SHOULD ALWAYS USE 198 CHAR PRINT LINES *           
* 10NOV11 111 AKAT-- ONLY EXECUTE BUYCOM ROUTINE WHEN USING MAT/UNM *           
*                 -- AND FIX 2-BYTE BUYLINE BUG                     *           
* 27JUL11 110 JNEW-- ADDRESS OPTIMIZATION                           *           
* 04MAY11 109 AKT -- SET NETWORK IN OSTA ROUTINE                    *           
* 12APR10 108 AKT -- CML STORAGE NOW IN SPWRIWORKD                  *           
* 22DEC09 107 AKT -- TREAT $0 "MATCH=NO" SPOTS AS MATCHED           *           
*                 -- AND FIX BUG WHEN PRINTING SQAD HEADLINES       *           
* 11DEC09 106 AKT -- SAME CANADIAN CABLE SUFFIX BUG FOR INETSTA     *           
* 04DEC09 105 AKT -- PROPER TEST FOR CANADIAN CABLE SUFFIX IS X'B0' *           
* 11NOV09 104 AKT -- RESET DEMONAME FOR HEAD3 IN CASE >1 DEMO       *           
* 04NOV09 103 AKT -- REPORT 2-BYTE BUYLINES AS 3 CHARS              *           
* 03NOV09 102 AKT -- FIX BUYDET LENGTH BUG                          *           
* 15OCT09 101 AKT -- SUPPORT 2-BYTE BUYLINES                        *           
* 08SEP08 100 AKT -- SBQBOOK NOW 24 BYTES TO SUPPORT BK5 & BK6      *           
* 02JUN08 99 AKT -- HONOR NEW BTIMES OPTION FOR TIMES KEYWORD       *           
* 19MAY08 98 AKT -- PRINT BIG LIST OF MAKEGOODS PROPERLY!           *           
* 31MAR08 97 AKT -- NEW ACOM RECORD SUPPORT                         *           
* 19DEC07 95 AKT -- NEW GM BILLING RESTRUCTURE SUPPORT              *           
* 01DEC07 94 AKT -- OM/BUY MERGE SUPPORT                            *           
* 02NOV07 93 AKT -- FIX BUG IN DEMO HEADLINES ROUTINE FOR DOWNLOAD  *           
* 19OCT07 92 EFJ -- MAKE SURE DON'T DIVIDE BY 0 IN INBUY AND DEAL   *           
*                   WITH NEGATIVE AMTS IN INBUY AND OUTBUY          *           
* 06JUL06 88 AKT -- NEW EQLEN KEYWORD TO SUPPORT NEW SPOT LENGTHS   *           
* 24MAY06 87 AKT -- OUTBUY SHOULD CHECK BUY D/A FOR X'FF'           *           
* 14APR06 86 AKT -- ECREATE SHOULD PRINT DAY WHEN USING YYMMDD OPT  *           
* 06APR06 85 AKT -- TEST GLINDS FOR TOTAL LINE SINCE R2 IS NOT SET  *           
* 10MAR06 84 AKT -- NEVER PASS DRIVER AN INPUT OF BDTIMST > 2400 HRS*           
*                   THIS CAUSES CANADIAN NTWRK/LOCAL TO PRINT TWICE *           
* 01MAR06 83 AKT -- SUPPORT FOR 5 CHARACTER FM STATIONS             *           
* 13JAN06 82 EFJ -- GET LINE NUMBER FROM INVOICE                    *           
*                -- SUPPORT MAT AND UNM COL FILTERS ON INVOICES     *           
*                -- MOVE RECTAB FOR MORE ADDRESSABILITY             *           
* 05OCT05 81 EFJ -- CHANGE EASI STATION GROUP NAME                  *           
* 20JUL05 80 EFJ -- 2 CHARACTER OFFICE CODE SUPPORT                 *           
* 06DEC04 79 EFJ -- MORE BYID CHANGES FOR LCI                       *           
* 16NOV04 78 EFJ -- MORE BYID CHANGES FOR LCI                       *           
* 20SEP04 77 AKT -- SPACE PAD INPUT FOR BUY-ID                      *           
* 17AUG04 76 AKT -- USE RCPACK TO UNPACK SBSREP                     *           
* 25JUN04 75 EFJ -- BYID CHANGES FOR LCI                            *           
* 20JUL04 74 AKT -- ADD PROCOM TO RECTAB                            *           
* 08JUL04 73 AKT -- CASH/TRADE COLUMN FILTERS FOR OM KEYWORDS       *           
* 09JUN04 72 EFJ -- SUPPORT FOR PER=FF (FISCAL FOLLIES) IN FMTPER   *           
* 27MAY04 71 AKT -- MOVE C'B' FOR STANETB FROM GLARGS TO GLARGS+2   *           
* 26MAY04 70 AKT -- SUPPORT NEW STANETB KEYWORD (STANET WITH BAND)  *           
* 14APR04 69 PWE -- MASDPT= FILTER                                  *           
* 13JAN04 68 AKT -- MAKE SURE R2 IS SET IN ODPT                     *           
* 15DEC03 67 EFJ -- USE IDUMMY TO PASS VALUE OF GLARGS+2            *           
* 25NOV03 66 EFJ -- SUPPORT 6 CHARACTER STA FORMAT                  *           
* 17NOV03 65 AKT -- GET OUT OF INBUY IF WE ARE NOT PROCESSING A BUY *           
* 06NOV03 64 PWE -- FIX AFFID, CANADA NWK: USE OF ONLY NWK MKT0 BUYS*           
* 30OCT03 63 AKT -- 2-CHAR CLIENT GROUP                             *           
* 22OCT03 62 AKT -- DONT SET MIDNIGHT TO ZERO IN IATIME             *           
* 14OCT03 61 PWE -- FIX LINE K/W FOR MEDIA 'N'                      *           
* 10OCT03 60 EFJ -- MOVE ECREATE TO NAMEPOOL                        *           
* 06OCT03 59 EFJ -- USE INV DETAIL DATE FOR IPER (NOT MOS FROM KEY) *           
* 19SEP03 58 EFJ -- CHANGE DEFAULT OUTPUT OF ECREATE                *           
* 15SEP03 57 EFJ -- NEW ECREATE KWD                                 *           
* 22AUG03 56 EFJ -- NEW DATE OUTPUT OPTION                          *           
*                -- FIX QTR KEYWORD (SEE WRI0B ALSO)                *           
* 12MAY03 54 PWE -- FIX AFFIL K/W FOR MEDIA 'N'                     *           
* 02APR03 53 EFJ -- SUPPORT 5 CHARACTER SQAD RADIO DPT CODES        *           
*                -- FIX GETDNAME                                    *           
* 19MAR03 52 EFJ -- MAKE SURE SBSQDBFA ALLOCATED BEFORE USING!      *           
* 10OCT02 50 EFJ -- SUPPORT 2 CHAR MGR SCHEMES                      *           
* 20AUG02 49 EFJ -- FIX IPER FOR SBPROCBH                           *           
* 11JUN02 48 EFJ -- CLTACC KEYWORD                                  *           
* 17MAY02 47 EFJ -- SUPPORT INVOICE CONTRACT# IN BYID KEYWORD       *           
* 22OCT01 45 EFJ -- NEW RUNDATE KEYWORD                             *           
* 13SEP01 44 EFJ -- CANADIAN NETWORK DISPLAY                        *           
*                -- CHANGE *+4 TO *+8 FOR IDF                       *           
* 08AUG01 43 EFJ -- FIX CANADA SHOW CODE OVERRIDE                   *           
* 09MAY01 42 EFJ -- PURPOSE CODE KEYWORD                            *           
* 21JAN01 41 EFJ -- NEW KEYWORDS FOR RATING SERVICE MARKET NUMBER   *           
* 18JAN01 40 EFJ -- ONLY SHOW 12 CHARS OF PROG NAME FOR CAN NETWORK *           
*                   WHEN REPORTING MARKET 0                         *           
* 01NOV00 39 EFJ -- FIX OADJ FOR NUMERIC OUTPUT                     *           
* 30OCT00 38 EFJ -- INCREASE MGAREA AGAIN!                          *           
* 04OCT00 37 EFJ -- SUPPORT USER COMMENT RECS                       *           
* 07JUL00 36 EFJ -- INCREASE MGAREA                                 *           
* 26JUN00 35 EFJ -- UNDO L33 ISTANET CHANGES                        *           
* 20JUN00 34 EFJ -- ADD OJ1DIFF TO ICOMPTAB                         *           
* 11MAY00 32 BOB -- FIX ICNET AND ISTA FOR MKT ZERO BUYS            *           
* 27APR00 32 EFJ -- FIX ILEN FOR PROCSL                             *           
* 24MAR00 31 BOB -- NO SQD DPT CD FOR DPT TOTAL RECS                *           
* 08MAR00 30 EFJ -- CHECK DIDEMU WHEN CHECKING OTHER DEMOS          *           
* 02FEB00 29 EFJ -- SUPPORT FOR UPGRADES                            *           
* 08NOV99 28 BOB -- FINAL CHANGES FOR SQAD                          *           
* 08NOV99 27 BOB -- FIX OMED FOR CROSS MEDIA TOTALS                 *           
* 10AUG99 26 BOB -- MODIFY HCCP FOR SQAD CPP'S                      *           
* 10MAR99 25 EFJ -- TRAP ALL EXEC RTNS ON FINAL EXIT                *           
*                -- MOVE OPRD & OEST TO EXTRA                       *           
* 19FEB99 24 EFJ -- SUPPORT ISO DATE OPTION                         *           
*                -- USE WORK, NOT DUB FOR FMTPER                    *           
* 26JAN99 23 EFJ -- DON'T CALL BRDMON FOR CALENDAR MONTHS (PER=C)   *           
* 06JAN99 22 EFJ -- ALLOW UP TO 4 BOOKS                             *           
* 01DEC98 21 EFJ -- FIX ERROR IN OWEEK INTRODUCED AT L20            *           
* 19NOV98 20 EFJ -- MAKE RFPDATE PRINT CCYYMMDD                     *           
* 02NOV98 19 EFJ -- SUPPORT RFPDATE OPTION - STANDARD DATE FORMATS  *           
* 12AUG98 18 EFJ -- CALL BRDMON TO GET CORRECT OUTPUT MON FOR OOW   *           
* 17JUL98 17 EFJ -- DON'T LOOP ON BAD BDDAY                         *           
* 22JUN98 16 EFJ -- FUDGE PRIAFT FOR X'0001' TO BE PRIOR            *           
* 01JUN98 15 EFJ -- UPDATE IPER FOR NEW PW MODE                     *           
* 06MAY98 14 EFJ -- Y2K                                             *           
* 16MAR98 13 EFJ -- SKIP NEGATIVE BYLINES IF COST KEYWORD USED      *           
* 03DEC97 12 EFJ -- DON'T DIE ON NO BILL MONTHS                     *           
* 24NOV97 11 EFJ -- L 10 ON OUTPUT TOO...                           *           
* 19NOV97 10 EFJ -- SUPPORT BUY COST IN DOLLARS, NOT PENNIES        *           
* 12NOV97 09 EFJ -- SUPPORT SBPROCB1                                *           
* 03NOV97 08 EFJ -- PRINT 'NET' IN CPP HEADS                        *           
* 19AUG97 07 EFJ -- SUPPORT PERIOD FILTERS FOR SBPROCNV             *           
* 26JUN97 06 EFJ -- OUTPUT FULL DPT-LEN ON DOWNLOAD/SOLID           *           
* 05JUN97 05 EFJ -- FIX EXIT CODE IN OGRPCODE                       *           
* 04JUN97 04 EFJ -- NO MATCH IF NO PERIOD IN COL                    *           
*                -- MOVE OGRPCODE TO EXTRA                          *           
* 08MAY97 03 EFJ -- SUPPORT NEW COL EST FILTER                      *           
*                -- SUPPORT COLPD OPTION FOR COL PERIOD FILTER      *           
* 01APR97 02 EFJ -- SUPPORT NEW COL PERIOD FILTER                   *           
* 01APR97 01 EFJ -- LEVEL RESET                                     *           
*-------------------------------------------------------------------*           
*-------------------------------------------------------------------*           
* 14MAR97 56 EFJ -- INCREASE MGAREA                                 *           
* 26DEC96 55 EFJ -- SAVE DEMO ON TARGET KEYWORD (FOR TGT FIRST)     *           
* 19NOV96 54 EFJ -- SUPPORT XPRDNAME FOR XFILE                      *           
* 12NOV96 53 EFJ -- ALWAYS GET MKTNAME ON OUTPUT IF RANK IS ROW     *           
* 07NOV96 52 SP  -- CALL OFFOUT FOR HEX CLT OFFICES                 *           
* 01NOV96 51 EFJ -- UPDATE IPER/OPER FOR AVGMON KEYWORD             *           
* 17OCT96 50 EFJ -- FIXES FOR CABLE AGG                             *           
* 09SEP96 49 EFJ -- MAKE SURE BAND IS -A OR -F BEFORE ADDING M      *           
* 29AUG96 48 EFJ -- ADD R TO XCLTOFF                                *           
* 27AUG96 47 EFJ -- SFI! MISSED IT BY 1 INSTRUCTION                 *           
* 22AUG96 46 BOB -- CHANGE IPER TO HANDLE SBPROCCA                  *           
* 21AUG96 45 EFJ -- FIX SF BCT*- TO GOTO1...                        *           
* 21AUG96 44 EFJ -- CHANGE XCLTOFF ON INPUT TO SORT PROPERLY        *           
* 20AUG96 42 EFJ -- DON'T KEEP MKT NUMBER IN SORT REC FOR XFILE     *           
* 19AUG96 41 EFJ -- SPECIAL CLTOFF SUPPORT FOR DDB CROSS-FILE       *           
*                -- MOVE HDEM2 & HCPP2 TO EXTRA                     *           
* 26JUN96 40 EFJ -- SUPPORT SPSYSDRV4                               *           
* 21JUN96 39 EFJ -- SKIP OUTPUT FOR HEADS FOR TOTAL PAGES           *           
* 23MAY96 38 EFJ -- SUPPORT LEN FROM INVOICE RECORDS                *           
* 06MAY96 37 EFJ -- SUPPORT ADATE/ADAY/ATIME FROM INVOICE RECS      *           
*                -- MOVE HDEMH12 TO EXTRA                           *           
* 22MAR96 36 EFJ -- SUPPORT SLOCKIN FLOWCHARTING                    *           
* 21NOV95 35 EFJ -- UPDATE IPER TO HANDLE OLD STYLE INVOICE RECS    *           
* 07NOV95 34 EFJ -- ALLOW EST 0 FOR INVOICE DATA                    *           
* 31OCT95 33 EFJ -- UPDATE IPER TO HANDLE INVOICE RECS              *           
* 23OCT95 32 EFJ -- NEW MODE TABLE ENTRY                            *           
* 10OCT95 31 EFJ -- MOVE SOME ROUTINES AROUND                       *           
* 20SEP95 30 EFJ -- SUPPORT CANADIAN NETWORK VIA CNET               *           
* 15SEP95 29 EFJ -- SUPPORT SREP COL FILTER                         *           
* 11SEP95 28 EFJ -- APPLY COL DATE FILTER TO PW STUFF               *           
* 26JUL95 27 EFJ -- ALLOW INTERNAL COMPUTE FOR OPDCPP               *           
* 21JUL95 26 EFJ -- ALLOW INTERNAL COMPUTE FOR OPCPP                *           
* 17JUL95 25 EFJ -- FIX BUG IN OUTDPTLN IF ONLY $ DPTS              *           
* 13JUL95 24 EFJ -- REVAMP COL FILTS - DO ALL EXT FILTS TOGETHER    *           
* 07JUL95 23 EFJ -- ORIG/SPILL COLUMN FILTERS                       *           
* 05JUL95 22 EFJ -- SUPPORT EXTENDED COLUMN FILTERS                 *           
* 26JUN95 21 EFJ -- YA IPER UPDATE                                  *           
* 13JUN95 20 EFJ -- UPDATE IPER YET AGAIN...YET AGAIN...YET AGAIN...*           
* 18MAY95 19 EFJ -- UPDATE IPER YET AGAIN...YET AGAIN...            *           
* 18APR95 18 EFJ -- CHANGE OWEEK TO OUTPUT MM/DD/YY IF DOWNLOAD     *           
* 04APR95 17 EFJ -- CHANGE COMMENT                                  *           
* 30MAR95 16 EFJ -- FIX STA & STANET KEYWORDS                       *           
* 28MAR95 15 EFJ -- UPDATE IPER YET AGAIN...                        *           
* 21MAR95 14 EFJ -- UPDATE IPER TO HANDLE ANOTHER NEW PW MODE       *           
*                -- ADD RECTAB ENTRY FOR NEW MODE                   *           
* 14MAR95 13 EFJ -- UPDATE IPER TO HANDLE NEW PW MODE               *           
* 03JAN95 12 EFJ -- PGR NAME BUG                                    *           
* 12DEC94 11 EFJ -- YA PW BUG                                       *           
* 29NOV94 10 EFJ -- USE CORRES VERSION OF BLDMGA & NEW DSECT        *           
*                -- FIX EXTRANEOUS CHARACTER ON MAKEGOOD GROUP =    *           
* 28OCT94 09 EFJ -- FIX BUG IN OSTA FOR 'ALL' STATIONS              *           
* 10OCT94 08 EFJ -- ALLOW ,TITLE TO BE USED WITH EDATES             *           
* 24AUG94 07 EFJ -- ALLOW INTERNAL COMPUTE FOR OPBYDEM              *           
* 22AUG94 06 EFJ -- CODE TO SUPPORT SPWRIRTB AS CATALP INSTEAD      *           
*                   OF INCLUDE                                      *           
* 25JUL94 02 EFJ -- LEVEL RESET                                     *           
*                -- FIX MEDIA '*' BUG  - USING 'R' NAME FOR 'X'     *           
*-------------------------------------------------------------------*           
*-------------------------------------------------------------------*           
* 06JUN94 24 TCS -- REWORK SYSD                                     *           
* 01JUL94 24 EFJ -- MERGE W/SPSYSDRIVC                              *           
* 06JUN94 23 TCS -- SUPPORT NEW MAKEGOODS                           *           
* 23MAY94 22 EFJ -- NEW KEYWORD - STAFFCH                           *           
* 23MAY94 21 EFJ -- NEW KEYWORD - ADATED                            *           
* 18MAY94 20 EFJ -- COST2PS KEYWORD (COST2 PER SPOT)                *           
* 13MAY94 19 EFJ -- BUYC2 KEYWORD (SAME AS BUYC WITH 2ND COST)      *           
* 05MAY94 18 EFJ -- BYCDATE & GLCDATE KEYWORDS                      *           
* 26APR94 17 EFJ -- MARKET WEIGHT KEYWORD                           *           
* 25APR94 16 EFJ -- NEW INFO COL KEYWORD                            *           
* 19APR94 15 EFJ -- SUPPORT SPOT LENGTH COL FILTER                  *           
* 12APR94 14 EFJ -- SUPPORT ADJACENCY CODE COL FILTER               *           
* 21JUL94 14 EFJ -- SUPPORT WESTERN PW                              *           
* 08APR94 13 EFJ -- NEW KEYWORDS - ATIMEM & ADATER                  *           
*                -- MOVE OADATE, OATIME & OAPROG TO DRIVE3          *           
* 20JUL94 13 EFJ -- FIX BUG IN OUTMKT                               *           
* 28MAR94 12 EFJ -- SUPPORT FOR ATTCODE KEYWORD                     *           
* 14JUL94 12 EFJ -- SUPPORT FOR NEW DATAINDS                        *           
* 22MAR94 11 EFJ -- SUPPORT FOR SECOND COST KEYWORDS                *           
*                -- MOVE CMML AND UDEF ROUTINES TO DRIVE3           *           
*                -- SET DICLT IN DATAIND5 WHERE IT BELONGS (NOT 8)  *           
* 22FEB94 10 TCS -- ADD NETWORK TO CANADIAN MEDIA=* REQUEST         *           
* 17FEB94 09 EFJ -- YET ANOTHER INFOMERCIAL RE-WORK                 *           
* 16FEB94 08 EFJ -- DISPLAY IFRSPDTW AS RANGE, NOT JUST START DATE  *           
* 15FEB94 07 EFJ -- FIX ERROR IN ROUTLIST ENTRY (OOPS...)           *           
* 14FEB94 06 EFJ -- SUPPORT FOR NEW ROW - CLT CML NUM               *           
* 03FEB94 05 EFJ -- NEW ROWS FOR INFOMERCIALS - IFRSPDT/DTW/DTM     *           
*                -- REMOVE TEMP HARD CODE                           *           
* 27JAN94 04 TCS -- ONLY PRINT START DATE FOR SINGLE DAY BUYS       *           
* 13JAN94 03 EFJ -- NEW KEYWORDS FOR INFOMERCIALS                   *           
* 07JAN94 02 EFJ -- INFOMERCIAL REWORK                              *           
* 05JAN94 00 EFJ -- HISTORY LOST.  LEVEL RESET                      *           
*                                                                   *           
*********************************************************************           
         TITLE 'SPSYSDRV1 - ROOT FOR SPOTPAK WRITER SYSTEM DRIVER'              
SPSYSD1  CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,**SPD1**,R7,R8                                                 
         L     RA,0(R1)                                                         
         USING GLOBALD,RA                                                       
         L     RC,GLAWORKD                                                      
         USING GEND,RC                                                          
         L     R9,ASYSD                                                         
         USING SYSD,R9                                                          
         CLC   BLDMGN,=F'0'        TEST ADDRESSES RESOLVED                      
         BNE   SYSD10              YES                                          
*                                                                               
* GET BLDMGN                                                                    
         XC    DMCB(24),DMCB                                                    
         MVC   DMCB+4(4),=X'D9000AC2'                                           
         GOTO1 CALLOV,DMCB,0                                                    
         CLI   4(R1),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                                                             
         MVC   BLDMGN,DMCB         SAVE MODULE ADDRESS                          
* GET SPLENTAB                                                                  
         MVC   DMCB+4(4),=X'D9000A57'                                           
         GOTO1 CALLOV,DMCB,0       GET SPLENTAB                                 
         CLI   4(R1),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                                                             
         MVC   ALENTAB,DMCB        SAVE TABLE ADDRESS                           
*                                                                               
         LA    R0,AXTRAN           SET EXTENTION ROUTINES                       
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         LARL  R1,EXTRA                                                         
         ST    R1,AXTRA(RE)                                                     
         STC   RF,AXTRA(RE)                                                     
         LA    RF,1(RF)                                                         
         LA    RE,4(RE)                                                         
         BCT   R0,*-16                                                          
*                                                                               
SYSD10   CLI   GLHOOK,GLINIT       INITIALIZATION                               
         BE    INIT                                                             
*                                                                               
         CLI   GLHOOK,GLRESOLV     RESOLVE ADDRESSES                            
         BE    RESOLVE                                                          
*                                                                               
         CLI   GLHOOK,GLINCOMP     INTERNAL COMPUTES                            
         BE    INTCOMP                                                          
*                                                                               
         CLI   GLHOOK,GLROUT       EXECUTE ROUTINES                             
         BE    EXEC                                                             
*                                                                               
         CLI   GLHOOK,GLPUTSRT     PUT SORT RECORD                              
         BE    PUTSRT                                                           
*                                                                               
XIT      XIT1  ,                                                                
         EJECT                                                                  
* INITIALIZATION                                                                
*                                                                               
INIT     XC    SVREP,SVREP                                                      
         LA    R1,LEVELS           DETERMINE THE DETAIL LEVEL                   
         LA    R0,L'LEVELS                                                      
         SR    RE,RE                                                            
         CLI   0(R1),0                                                          
         BE    *+16                                                             
         LA    R1,1(R1)                                                         
         LA    RE,1(RE)                                                         
         BCT   R0,*-16                                                          
         STC   RE,DETLEV                                                        
         B     XIT                                                              
         EJECT                                                                  
* RESOLVE ROUTINE ADDRESSES                                                     
*                                                                               
RESOLVE  L     R2,=V(SPWRIRTB)                                                  
         USING WRIRTBD,R2                                                       
*                                                                               
SR10     CLI   0(R2),FF                                                         
         BE    SRX                                                              
         CLC   WRLABEL,GLLABEL                                                  
         BE    SR20                                                             
         LA    R2,WRIRTBL(R2)                                                   
         B     SR10                                                             
*                                                                               
SR20     CLI   WROVLY,1            IS ROUTINE IN THIS OVERLAY?                  
         BNE   SR22                                                             
         SR    R1,R1               YES                                          
         ICM   R1,3,WRRNUM                                                      
         SLL   R1,2                                                             
         LAY   R1,ROUTTAB-4(R1)                                                 
         ST    R1,GLAROUT                                                       
         B     SR24                                                             
*                                                                               
SR22     L     RF,=V(SPSYSD2)      ROUTINE IS IN SYSDRV2 OR SYSDRV3             
         CLI   WROVLY,2                                                         
         BE    SR23                                                             
         L     RF,=V(SPSYSD3)                                                   
         CLI   WROVLY,3                                                         
         BE    SR23                                                             
         L     RF,=V(SPSYSD4)      OR IS IN SYSDRV4                             
         CLI   WROVLY,4                                                         
         BE    SR23                                                             
         DC    H'0'                                                             
SR23     BASR  RE,RF               GO AND RESOLVE (R2=A(TABLE ENTRY))           
*                                                                               
SR24     TM    WRINDS1,DIBYDEM+DIDEMNDX   TEST BUY DEMO INPUT LABEL             
         BNZ   SR26                                                             
         TM    WRINDS6,DIDEMU      BYUDEM ALSO                                  
         BO    SR26                                                             
         TM    WRINDS2,DIGLDEM     OR GOAL                                      
         BO    SR26                                                             
         TM    WRINDS6,DISTDEM     OR DEMO STACK                                
         BO    SR26                                                             
         TM    WRINDS7,DISLDEM     OR STATION LOCKIN DEMO                       
         BZ    SR30                                                             
*                                                                               
SR26     CLC   NDEMOS,GLARGS+1     YES - GLARGS+1 = DEMO NUMBER                 
         BNL   SR30                                                             
         MVC   NDEMOS,GLARGS+1     KEEP TRACK OF MAX DEMOS                      
*                                                                               
SR30     OC    DATAIND,WRINDS1                                                  
         OC    DATAIND2,WRINDS2                                                 
         OC    DATAIND3,WRINDS3                                                 
         OC    DATAIND4,WRINDS4                                                 
         OC    DATAIND5,WRINDS5                                                 
         OC    DATAIND6,WRINDS6                                                 
         OC    DATAIND7,WRINDS7                                                 
         OC    DATAIND8,WRINDS8                                                 
         OC    DATAIND9,WRINDS9                                                 
         OC    DTAIND10,WRINDS10                                                
         OC    DTAIND11,WRINDS11                                                
         OC    DTAIND12,WRINDS12                                                
*                                                                               
SRX      B     XIT                                                              
         DROP  R2                                                               
         EJECT                                                                  
* CONTROL INTERNAL COMPUTES                                                     
*                                                                               
INTCOMP  LARL  R1,ICOMPTAB                                                      
*                                                                               
INTCOMP2 CLI   0(R1),0             SEE IF ALLOW INTERNAL COMPUTE FOR            
         BE    XIT                 THIS OUTPUT ROUTINE                          
         CLC   GLLABEL,0(R1)                                                    
         BE    EXEC                                                             
         LA    R1,8(R1)                                                         
         B     INTCOMP2                                                         
         SPACE 2                                                                
         EJECT                                                                  
* EXECUTING ROUTINES                                                            
*                                                                               
EXEC     MVC   WORK,BLANKS         PRESET WORK AREAS                            
         ZAP   DUB,=P'0'                                                        
         L     R2,GLAIFLD          R2=A(INPUT)                                  
         L     R3,GLAOFLD          R3=A(OUTPUT)                                 
         CLI   GLMODE,GLOUTPUT                                                  
         BE    SX150                                                            
*                                  ** INPUT ROUTINE **                          
         CLI   SBMODE,SBPROCBH     BILL HEADER?                                 
         BNE   EXEC5                                                            
         L     R4,SBAIO1           (R4) -> TO BILL HEADER RECORD                
         L     R5,AAORLK           ADDRESS OF AOR BLOCK                         
         B     EXEC10                                                           
*                                                                               
EXEC5    L     R4,SBACURCH         ADDRESS CURRENT CHUNK FOR INPUT              
         USING SCHUNKD,R4                                                       
         LR    R5,R4                                                            
         USING SGLCHNKD,R5                                                      
*                                                                               
EXEC10   CLC   GLLABEL(5),=C'IUDEF'  TEST USER DEFINITION FIELD                 
         BE    SX130               YES-SKIP ALL FILTERS                         
         CLC   GLLABEL(5),=C'IUCOM'  OR USER COMMENT FIELD                      
         BE    SX130               YES-SKIP ALL FILTERS                         
*                                                                               
         CLI   GLARGS,0            TEST ANY ARGS                                
         BE    SX40                                                             
         LA    R0,2                YES -                                        
         LA    RE,GLARGS           ARGS MAY HAVE RECORD TYPE(S)                 
         SR    R1,R1                                                            
*                                                                               
SX05     L     RF,=A(RECTAB)       TEST THIS RECORD NEEDED FOR THIS             
*                                  INPUT FIELD                                  
SX10     CLI   0(RF),FF                                                         
         BE    SX30                                                             
         CLC   0(1,RE),0(RF)                                                    
         BNE   SX20                                                             
         CLI   1(RF),0             TEST ARGS NOT USED FOR RECORD TYPE           
         BE    SX40                YES - OK                                     
         CLC   SBMODE,1(RF)        NO - COMPARE RECORD TYPES                    
         BE    SX40                EQ - OK                                      
         LA    R1,1                                                             
         B     SX30                NE - CONTINUE TO SCAN ARGS                   
*                                                                               
SX20     LA    RF,2(RF)                                                         
         B     SX10                                                             
*                                                                               
SX30     LA    RE,1(RE)                                                         
         CLI   0(RE),0                                                          
         BE    *+8                                                              
         BCT   R0,SX05                                                          
         LTR   R1,R1                                                            
         BNZ   XIT                 REJECT                                       
         B     SX40                                                             
*                                                                               
SX40     ZICM  RF,AXTCOLS,3        TEST EXTENDED COLUMN FILTERS                 
         BZ    SX42                                                             
         ZICM  RE,GLARGS+6,1       COLUMN NUMBER                                
         BZ    SX42                0 = NOT A COLUMN                             
         BCTR  RE,0                                                             
         MHI   RE,EXTCOLSL         INDEX TO TABLE                               
         AR    RF,RE                                                            
         USING EXTCOLSD,RF                                                      
         OC    EXTPD,EXTPD         NEW PERIOD FILTER?                           
         BZ    SX42                 NO                                          
         LA    R6,EXTPD                                                         
         B     *+12                                                             
         DROP  RF                                                               
*                                                                               
SX42     ICM   R6,15,GLARGS+12     TEST PERIOD DATE                             
         BZ    SX70                                                             
         CLI   SBMODE,SBPROCNV                                                  
         BNE   SX44                                                             
         L     RE,SBAIO1                                                        
         CLI   0(RE),X'0B'         OLD STYLE INVOICE REC?                       
         BNE   *+14                                                             
         MVC   HALF,INVKDAT-INVKEY(RE)                                          
         B     SX60                                                             
         MVC   HALF,SNVKMOS-SNVKEY(RE)                                          
         XC    HALF,XFF                                                         
         B     SX60                                                             
*                                                                               
SX44     L     RE,SBACURCH                                                      
         MVC   HALF,2(RE)                                                       
         CLI   SBMODE,SBPROCPW                                                  
         BE    SX60                                                             
         CLI   SBMODE,SBPROCP2                                                  
         BE    SX60                                                             
         L     R1,SBACURCH                                                      
         MVC   HALF,SLDATE-SSLCHNKD(R1)                                         
         CLI   SBMODE,SBPROCSL                                                  
         BE    SX60                                                             
         MVC   HALF,SCDATE                                                      
         CLI   SBMODE,SBPROCSP     YES - ONLY ACCEPT CHUNK IF                   
         BE    SX60                      DATE MATCHES                           
         MVC   HALF,SGDATE                                                      
         CLI   SBMODE,SBPROCGL                                                  
         BE    SX60                                                             
         L     R1,SBACHUNK                                                      
         MVC   HALF,0(R1)                                                       
         CLI   SBMODE,SBPROCES     AUTHORIZATION $                              
         BE    SX60                                                             
         CLI   SBMODE,SBPROCB1                                                  
         BE    *+12                                                             
         CLI   SBMODE,SBPROCBL                                                  
         BNE   SX70                                                             
         LR    RE,R5               STATION BILL                                 
         USING STABELEM,RE                                                      
         MVC   HALF,STABBDT                                                     
         CLI   DATEOPT,DOBILL      TEST DATE=BD                                 
         BE    SX60                YES-USE DATE OF BILLING                      
         TM    OPTIND4,OPTCOLBD    TEST COL FILT DATE=BD                        
         BNZ   SX60                 YES - USE DATE OF BILLING                   
         L     R1,ABILMNTH         NO-EXTRACT BILLING PERIOD START DATE         
         LA    R0,NBILMNTH            FROM BILLING MONTHS TABLE                 
*                                                                               
SX50     OC    0(6,R1),0(R1)                                                    
         BZ    XIT                 MAY NOT BE AT LEAST 1 FULL BILL MON          
***         BNZ   *+6                                                           
***         DC    H'0'                                                          
         CLC   STABPER,0(R1)                                                    
         BNE   *+14                                                             
         MVC   HALF,2(R1)                                                       
         B     SX60                                                             
         LA    R1,6(R1)                                                         
         BCT   R0,SX50                                                          
         DC    H'0'                                                             
         DROP  RE                                                               
*                                                                               
SX60     DS    0H                                                               
         OC    0(4,R6),0(R6)       IF NO START AND END, NO MATCH                
         BZ    XIT                                                              
*                                                                               
         OC    0(2,R6),0(R6)       IS THERE A PERIOD START?                     
         BZ    *+14                 NO - ONLY TEST END PERIOD                   
         CLC   HALF,0(R6)                                                       
         BL    XIT                                                              
         OC    2(2,R6),2(R6)       IS THERE A PERIOD END?                       
         BZ    *+14                 NO                                          
         CLC   HALF,2(R6)                                                       
         BH    XIT                                                              
*                                                                               
SX70     CLI   GLARGS+10,0         TEST DAYPART FILTER                          
         BE    SX90                                                             
         TM    GLARGS+11,GLIIADJ   SEE IF IT'S REALLY ADJACENCY CODE            
         BZ    SX80                 NO                                          
*                                                                               
         CLI   SBMODE,SBPROCSP     TEST BUY RECORD                              
         BNE   SX90                 NO - SKIP CHECK                             
         L     RE,SBAIO1                                                        
         USING BUYRECD,RE                                                       
         CLC   BDPROGT,GLARGS+10                                                
         BNE   XIT                                                              
         B     SX90                                                             
         DROP  RE                                                               
*                                                                               
SX80     TM    GLARGS+10,X'40'                                                  
         BZ    SX85                                                             
         CLC   SBDPTCD,GLARGS+10                                                
         BNE   XIT                                                              
         B     SX90                                                             
SX85     MVC   BYTE,GLARGS+10                                                   
         OI    BYTE,X'40'                                                       
         BRAS  RE,CHKMDPT                                                       
         BNE   XIT                                                              
*                                                                               
SX90     OC    GLARGS+7(3),GLARGS+7   TEST STATION OR PRODUCT FILTER            
         BZ    SX100                                                            
         TM    GLARGS+11,GLIIPRD                                                
         BO    SX92                                                             
         CLC   SBBSTA,GLARGS+7     STATION FILTER                               
         BNE   XIT                                                              
         B     SX100                                                            
*                                                                               
SX92     CLC   SBPRD,GLARGS+7      PRODUCT FILTER                               
         BNE   XIT                                                              
*                                                                               
SX100    CLI   SBMODE,SBPROCSP     TEST BUY RECORD                              
         BNE   SX110                                                            
*                                                                               
         TM    OPTIND6,OPT6NM0B    IF USING MARKET0 BUYS                        
         BZ    SX101                                                            
         L     RE,SBAIO1                                                        
         USING BUYRECD,RE                                                       
         OC    BUYMSTA(2),BUYMSTA  TEST MARKET ZERO BUY                         
         BNZ   XIT                 NOPE-DITCH IT                                
         DROP  RE                                                               
*                                                                               
* NOTE ABOVE IS ESSENTIAL FOR GETTING MAT/UNM WORKING AT NETWORK LEVEL          
* THE CODE DROPS ALL LOCAL BUYS REGARDLESS OF WHETHER COL IS $ OR NOT           
* AS PER CANADA ACCOUNT TEAM/PRODUCT WHO SAID WOULD NOT BE A PROBLEM            
* DUE TO NATURE OF REPORTS IN WHICH CANADA AGYS WOULD NEED AFFID DATA           
* OTHERWISE WOULD NEED TO CLEAR $ IN ALL BUY $ BASED SYSDRV ROUTINES            
*                                                                               
*                                                                               
SX101    LA    R1,GLARGS                                                        
         USING GLARGSD,R1                                                       
         TM    GLIIND,GLIIMAT+GLIIUNM  USING MAT/UNM COLUMN FILTERS             
         BZ    SX106               NO                                           
         BRAS  RE,BUYCOM           SEE IF WE HAVE MATCH=NO COMMENT              
*                                                                               
         TM    GLIIND,GLIIMAT      REJECT IF MATCHED FILTER AND SPOT IS         
         BZ    SX105               UNMATCHED                                    
         CLIY  MATCHED,C'Y'        MATCH=NO COMMENT?                            
         BE    SX106               YES - TREAT AS MATCHED!                      
         OC    SCADATE,SCADATE                                                  
         BZ    XIT                                                              
*                                                                               
SX105    TM    GLIIND,GLIIUNM      REJECT IF UNMATCHED FILTER AND SPOT          
         BZ    SX106               IS MATCHED                                   
         OC    SCADATE,SCADATE                                                  
         BNZ   XIT                                                              
         CLIY  MATCHED,C'Y'        MATCHED?                                     
         BE    XIT                 YES - REJECT!                                
         DROP  R1                                                               
*                                                                               
SX106    TM    DATAIND9,DICPS      TEST COST KEYWORD                            
         BZ    SX110                NO                                          
         TM    SCGROSS,X'80'        YES - SKIP NEGATIVE BYLINES                 
         BNZ   XIT                                                              
*                                                                               
SX110    CLI   SBMODE,SBPROCNV     TEST INVOICE DETAIL                          
         BNE   SX111                                                            
         LA    RF,GLARGS                                                        
         USING GLARGSD,RF                                                       
         TM    GLIIND,GLIIMAT      REJECT IF MATCHED FILTER AND AFFID           
         BZ    *+12                IS UNMATCHED                                 
         CLI   SNVIDBES-SNVIDELD(R4),0                                          
         BE    XIT                                                              
         TM    GLIIND,GLIIUNM      REJECT IF UNMATCHED FILTER AND AFFID         
         BZ    *+12                IS MATCHED                                   
         CLI   SNVIDBES-SNVIDELD(R4),0                                          
         BNE   XIT                                                              
         DROP  RF                                                               
*                                                                               
SX111    ZICM  RF,AXTCOLS,3        TEST EXTENDED COLUMN FILTERS                 
         BZ    SX130                                                            
         ZICM  RE,GLARGS+6,1       COLUMN NUMBER                                
         BZ    SX130               0 = NOT A COLUMN                             
         BCTR  RE,0                                                             
         MHI   RE,EXTCOLSL         INDEX TO TABLE                               
         AR    RF,RE                                                            
         USING EXTCOLSD,RF                                                      
*                                                                               
         CLI   EXTSLEN,0                                                        
         BE    *+14                NO SPOT LENGTH FILTER                        
         CLC   SBLEN,EXTSLEN       LENGTH = FILTER LENGTH?                      
         BNE   XIT                  NO - REJECT                                 
*                                                                               
         CLI   SBMODE,SBPROCSP     TEST BUY RECORD                              
         BNE   SX112                                                            
         TM    EXTFLAG1,EXTORIG    ORIG FILTER?                                 
         BZ    *+12                 NO                                          
         TM    ININD,INISPILL      SPILL MKT?                                   
         BNZ   XIT                  YES - REJECT                                
*                                                                               
         TM    EXTFLAG1,EXTSPIL    SPILL FILTER?                                
         BZ    *+12                 NO                                          
         TM    ININD,INISPILL      SPILL MKT?                                   
         BZ    XIT                  NO - REJECT                                 
*                                                                               
SX112    OC    EXTSREP,EXTSREP     SPECIAL REP FILTER?                          
         BZ    *+14                                                             
         CLC   EXTSREP,SBSREP      CORRECT SPECIAL REP?                         
         BNE   XIT                  NO - EXIT                                   
*                                                                               
         CLI   EXTEST,0            ESTIMATE FILTER?                             
         BZ    SX114                                                            
         CLC   EXTEST,SBBEST       CORRECT ESTIMATE?                            
         BNE   XIT                  NO - EXIT                                   
*                                                                               
SX114    LA    R1,OMTYPE           OM CASH/TRADE FILTER                         
         CLI   SBMODE,SBPROCOM     TEST OM RECORD                               
         BE    SX115                                                            
         CLI   SBMODE,SBPROCSP     PROCESSING BUYS?                             
         BNE   SX117               NO                                           
         CLI   GLARGS,C'B'         PROCESSING A BUY KEYWORD?                    
         BNE   SX114A              NOPE                                         
         LA    R1,SBBYTYPE         BUY CASH/TRADE FILTER                        
         B     SX115                                                            
*                                                                               
SX114A   LHI   RE,SBQREAD2-SBLOCK                                               
         LA    RE,SBLOCK(RE)                                                    
         TM    0(RE),SBQRD2OM      READING OM KEYWORDS?                         
         BZ    SX117               NO                                           
*                                                                               
SX115    TM    EXTFLAG1,EXTCASH    CASH COLUMN FILTER?                          
         BZ    SX116               NO                                           
         CLI   0(R1),C'C'          YES - DO WE HAVE A CASH ORDER?               
         BNE   XIT                 NO, DONE                                     
*                                                                               
SX116    TM    EXTFLAG1,EXTTRD     TRADE COLUMN FILTER?                         
         BZ    SX117               NO                                           
         CLI   0(R1),C'T'          YES - DO WE HAVE A TRADE ORDER?              
         BNE   XIT                                                              
*                                                                               
SX117    CLI   SBMODE,SBPROCSP     PROCESSING BUYS?                             
         BE    SX130               YES, DON'T FILTER LMG/REG                    
         LA    R1,GMBILTYP         LMG/REG FOR BILL RECORD                      
         CLI   SBMODE,SBPROCBL     BILL RECORD?                                 
         BE    SX117A              YES                                          
         LA    R1,SBGMBILL         LMG/REG FOR BILL HEADER RECORD               
         CLI   SBMODE,SBPROCBH     BILL HEADER RECORD?                          
         BNE   SX130               NOPE                                         
*                                                                               
SX117A   TM    EXTFLAG1,EXTLMG     WANT ONLY LMG BILL RECORDS?                  
         BZ    SX118               NO                                           
         CLI   0(R1),C'L'          YES - DO WE HAVE AN LMG REC?                 
         BNE   XIT                 NO, DONE                                     
*                                                                               
SX118    TM    EXTFLAG1,EXTREG     WANT ONLY REG BILL RECORDS?                  
         BZ    SX130               NO                                           
         CLI   0(R1),C'R'          YES - DO WE HAVE A REGIONAL REC?             
         BNE   XIT                 NO, DONE                                     
         DROP  RF                                                               
*                                                                               
SX130    L     R1,GLADTENT         ADDRESS INPUT FIELD                          
         USING DRIND,R1                                                         
         MVC   GLMAXTLV,MAXTOTLV   SET MAX TOT LEVEL FOR DRIVER                 
         CLI   DRINLEV,1           TEST LEVEL ONE                               
         BH    SX140                                                            
         MVI   INDATA,0            YES - RESET DATA INDICATOR                   
         XC    LEVELSWS,LEVELSWS         RESET PUT TO SORT SWITCHES             
*                                                                               
SX140    L     R3,SBAIO1           R3=A(IO AREA)                                
         SR    R6,R6                                                            
         B     SXX                                                              
         DROP  R1                                                               
*                                  ** OUTPUT ROUTINE **                         
SX150    MVC   OUTAREA,BLANKS      PRESET SOME FIELDS FOR OUTPUT                
         L     R1,GLADTENT                                                      
         USING DROD,R1                                                          
         CLI   DROLTYP,C'N'        TEST NO PRINT                                
         BNE   SX160                                                            
         CLI   GLHOOK,GLINCOMP     YES-GO THROUGH IF INTERNAL COMPUTE           
         BE    SX160                                                            
         CLC   =C'OBILBL',GLLABEL  EXIT NOW UNLESS IT'S BILLABLE                
         BE    SX160                                                            
         CLC   =C'OXBILBL',GLLABEL EXIT NOW UNLESS IT'S BILLABLE                
         BNE   XIT                                                              
*                                                                               
SX160    MVC   MYPOSO,DROPOS                                                    
         MVC   MYOLEN,DROLEN                                                    
         OC    TOTLEVS,TOTLEVS     TEST COUNTING REQUIRED                       
         BZ    SXX                                                              
         MVC   BYTE,COUNTLEV       YES-TEST THIS IS THE COUNT LEVEL             
         NI    BYTE,X'7F'                                                       
         CLC   DROLEV,BYTE                                                      
         BNE   SXX                                                              
         GOTO1 PUTCNTEL            YES-PUT OUT A COUNT ELEMENT                  
         DROP  R1                                                               
*                                                                               
SXX      L     RE,GLAROUT       ** BRANCH TO I/O ROUTINE **                     
         SLL   RE,8                                                             
         SRL   RE,8                                                             
*                                                                               
         L     RF,=V(SPSYSD4)      IS THE ROUTINE IN DRIVE4?                    
         SLL   RF,8                                                             
         SRL   RF,8                                                             
         CR    RE,RF                                                            
         BNL   SXX10                  YES, GO THERE                             
*                                                                               
         L     RF,=V(SPSYSD3)      IS THE ROUTINE IN DRIVE3?                    
         SLL   RF,8                                                             
         SRL   RF,8                                                             
         CR    RE,RF                                                            
         BNL   SXX10                  YES, GO THERE                             
*                                                                               
         L     RF,=V(SPSYSD2)      IS THE ROUTINE IN THIS PROGRAM?              
         SLL   RF,8                                                             
         SRL   RF,8                                                             
         CR    RE,RF                                                            
         BNL   SXX10                                                            
         ST    RE,FULL                                                          
         BAS   RE,GOEXEC                                                        
         B     SXX30                                                            
*                                                                               
SXX10    LA    R1,LEVELSWS                                                      
         BASR  RE,RF                                                            
         BNE   SXX30                                                            
         LA    RE,GENOUT                                                        
         ST    RE,FULL                                                          
         BAS   RE,GOEXEC                                                        
*                                                                               
SXX30    B     XIT                                                              
*                                                                               
         SPACE 2                                                                
GOEXEC   NTR1  ,                   JUST SO WE HAVE A PLACE TO RETURN TO         
         L     RE,FULL                                                          
         BR    RE                                                               
*                                                                               
         EJECT                                                                  
* ABOUT TO PASS DRIVER RECORD TO THE SORT                                       
*                                                                               
PUTSRT   OC    LEVELSWS,LEVELSWS   TEST ALREADY WANT TO SUPPRESS                
         BZ    PUTSRT2                                                          
         LA    RE,L'LEVELSWS                                                    
         LA    RF,LEVELSWS                                                      
         CLI   0(RF),C'Y'                                                       
         BE    PUTSRT2                                                          
         LA    RF,1(RF)                                                         
         BCT   RE,*-12                                                          
         B     PUTSRT9                                                          
*                                                                               
PUTSRT2  TM    OPTIND,OPTIREP      TEST REP=0 DISALLOWED                        
         BZ    PUTSRT3                                                          
         TM    DATAIND4,DISREP     YES-TEST SPECIAL REP IN ROWS                 
         BZ    *+14                                                             
         CLC   SBSREP,ZEROS        YES-TEST SPECIAL REP = 0                     
         BE    PUTSRT9                 YES-IGNORE IT                            
         TM    DATAIND5,DIPREP     TEST PAYING REP                              
         BZ    *+14                                                             
         CLC   SBPREP,ZEROS        YES-TEST PAYING REP = 0                      
         BE    PUTSRT9                                                          
         TM    DATAIND5,DITREP     TEST TIME SHEET REP                          
         BZ    PUTSRT3                                                          
         CLC   SBTREP,ZEROS        YES-TEST TIME SHEET REP = 0                  
         BE    PUTSRT9                                                          
*                                                                               
PUTSRT3  CLC   SBQCMLCL,BLANKS     TEST COMMERCIAL CLASS FILTER                 
         BNH   PUTSRT6                                                          
         LA    R1,CMLCLAS                                                       
         LA    RE,SBQCMLCL                                                      
         LA    R0,L'SBQCMLCL                                                    
PUTSRT4  CLI   0(RE),C' '                                                       
         BNH   PUTSRT5                                                          
         CLI   0(RE),C'*'                                                       
         BE    PUTSRT5                                                          
         CLC   0(1,R1),0(RE)                                                    
         BNE   PUTSRT9                                                          
PUTSRT5  LA    R1,1(R1)                                                         
         LA    RE,1(RE)                                                         
         BCT   R0,PUTSRT4                                                       
*                                                                               
PUTSRT6  TM    ROWIND,ROWINOMK     TEST SUPPRESS MARKET DETAILS                 
         BZ    PUTSRT7                                                          
         CLI   MKTLEV,0            AND MARKET IS A ROW                          
         BE    PUTSRT7                                                          
         L     R1,GLAIO                                                         
         CLC   DETLEV,1(R1)        AND THIS IS A DETAIL RECORD                  
         BNE   PUTSRT7                                                          
         TM    GLINDS2,GLPUTDT     BUT NOT A DETAILED TOTAL                     
         BO    PUTSRT7                                                          
         TM    ININD,INIDPTOT      AND IT'S A DAYPART TOTAL                     
         BO    PUTSRT9             YES-THIS RECORD IS NOT NEEDED                
*                                                                               
PUTSRT7  B     PUTSRTX                                                          
*                                                                               
PUTSRT9  MVI   GLHOOK,GLDONT                                                    
*                                                                               
PUTSRTX  B     XIT                                                              
         EJECT                                                                  
* INPUT ROUTINES FOR ROWS                                                       
*                                                                               
ICOMPUTE ZAP   0(8,R2),=P'0'       COMPUTE                                      
         B     XIT                                                              
*                                                                               
IDUMMY   MVC   0(1,R2),GLARGS+2      DUMMY                                      
         B     XIT                                                              
*                                                                               
IMED     MVC   0(1,R2),SBQMED      MEDIA                                        
         CLI   SBQMED,C'*'                                                      
         BNE   XIT                                                              
         MVC   0(1,R2),SBMED                                                    
         B     XIT                                                              
*                                                                               
ISUBMED  MVC   0(1,R2),SBMED       SUBMEDIA                                     
         B     XIT                                                              
*                                                                               
ICGR1    MVC   0(2,R2),SBBCGR      CLIENT GROUP 1                               
         CLC   0(2,R2),=X'9999'                                                 
         BE    *+10                                                             
         OC    0(2,R2),SBCG1MSK                                                 
         LA    R1,SBCGR1NM                                                      
         B     ICGRNM                                                           
*                                                                               
ICGR2    MVC   0(2,R2),SBBCGR      CLIENT GROUP 2                               
         LA    R1,SBCGR2NM                                                      
*                                                                               
ICGRNM   CLI   GLARGS,C'N'                                                      
         BNE   XIT                                                              
         MVC   8(2,R2),0(R2)                                                    
         CLC   SBBCGR,=X'9999'                                                  
         BE    ICGRNM2                                                          
         MVC   DUB(2),SBBCGR                                                    
         MVC   SBBCGR,0(R2)                                                     
         GOTO1 GETCGRNM                                                         
         MVC   SBBCGR,DUB                                                       
         CLC   0(24,R1),=CL24'** UNKNOWN **'                                    
         BNE   ICGRNM4                                                          
ICGRNM2  MVC   0(8,R1),XFE                                                      
ICGRNM4  MVC   0(8,R2),0(R1)                                                    
         B     XIT                                                              
*                                                                               
ICLTOFF  BRAS  RE,OUTCOFF          CLIENT OFFICE                                
         B     XIT                                                              
*                                                                               
ICLT     MVC   0(3,R2),SBCLT       CLIENT                                       
         CLI   GLARGS,C'N'                                                      
         BNE   XIT                                                              
         MVC   0(8,R2),SBCLTNM                                                  
         MVC   8(3,R2),SBCLT                                                    
         B     XIT                                                              
*                                                                               
ICLTACOF MVC   0(2,R2),SBCACCOF   CLIENT ACCOUNTING OFFICE CODE                 
         B     XIT                                                              
*                                                                               
ICLTACC  LR    R1,R9              CLIENT LIMIT ACCESS                           
         AHI   R1,SBCACCES-SYSD                                                 
         MVC   0(3,R2),0(R1)                                                    
         B     XIT                                                              
*                                                                               
ICLTINT  MVC   0(8,R2),SBCLTIFC   CLIENT INTERFACE NUMBER                       
         B     XIT                                                              
*                                                                               
IPGR1    MVC   0(2,R2),SBBPGR      PRODUCT GROUP 1                              
         CLC   0(2,R2),=X'9999'                                                 
         BE    XIT                                                              
         OC    0(2,R2),SBPG1MSK                                                 
         MVC   2(1,R2),SBPGR1LN                                                 
         B     XIT                                                              
*                                                                               
IPGR2    MVC   0(2,R2),SBBPGR      PRODUCT GROUP 2                              
         MVC   2(1,R2),SBPGR2LN                                                 
         B     XIT                                                              
                                                                                
IPRD     CLI   GLARGS+2,C'X'       SPECIAL XFILE PRD KEYWORD?                   
         BNE   *+14                                                             
         MVC   0(20,R2),SBPRDNM                                                 
         B     XIT                                                              
*                                                                               
         CLI   GLARGS,C'N'         PRODUCT                                      
         BNE   *+14                                                             
         MVC   0(8,R2),SBPRDNM                                                  
         LA    R2,8(R2)                                                         
         MVC   0(3,R2),SBPRD                                                    
         MVC   3(3,R2),SBPRD2                                                   
         CLC   SBPRD,=C'POL'                                                    
         BNE   XIT                                                              
         MVC   0(3,R2),XFD                                                      
         B     XIT                                                              
*                                                                               
IEDATES  DS    0H                  EST DATES                                    
         GOTO1 GETESTNM                                                         
         BNE   XIT                                                              
         MVC   0(L'SBESTSTP,R2),SBESTSTP                                        
         MVC   2(L'SBESTNDP,R2),SBESTNDP                                        
         B     XIT                                                              
*                                                                               
IEST     CLI   GLARGS,C'N'         ESTIMATE                                     
         BE    *+12                                                             
         CLI   GLARGS,C'D'                                                      
         BNE   IEST2                                                            
         GOTO1 GETESTNM            GET ESTIMATE DETAILS                         
         CLI   GLARGS,C'N'                                                      
         BE    IEST1                                                            
         LLC   RE,GLARGS+1         DEMO                                         
         BCTR  RE,0                                                             
         MHI   RE,3                                                             
         LA    RE,SBESTDEM(RE)                                                  
         MVC   3(3,R2),0(RE)                                                    
         B     IEST2                                                            
*                                                                               
IEST1    MVC   0(8,R2),SBESTNM     NAME                                         
         LA    R2,8(R2)                                                         
*                                                                               
IEST2    MVC   1(1,R2),SBBEST                                                   
         MVC   2(1,R2),SBBPRD                                                   
         TM    SBQPIND,SBQPOLES    TEST FORCE POOL ESTIMATES                    
         BO    *+12                                                             
         TM    DATAIND2,DIPRD      OR PRODUCT IS NOT A ROW                      
         BO    *+8                                                              
         MVI   2(R2),X'FF'         YES-THEN LUMP ALL ESTS UNDER POL             
         MVI   0(R2),0                                                          
         CLI   SBQSEPES,C'Y'                                                    
         BE    XIT                                                              
         MVC   1(1,R2),ESTSTART                                                 
         B     XIT                                                              
*                                                                               
IESTFLT  MVC   0(3,R2),SBESTFLT    ESTIMATE FILTERS                             
         B     XIT                                                              
*                                                                               
IRTLSCH  MVC   0(2,R2),SBRTLSCH    RETAIL SCHEME CODE                           
         B     XIT                                                              
*                                                                               
IECREATE GOTO1 GETESTNM                                                         
         MVC   0(2,R2),ECREATE     EST CREATE DATE                              
         MVC   2(2,R2),ECREATE     TO MAKE FMTPER HAPPY LATER                   
         B     XIT                                                              
*                                                                               
IMGR1    MVC   0(2,R2),SBBMGR      MARKET GROUP 1                               
         CLC   0(2,R2),=X'9999'                                                 
         BE    IMGR12                                                           
         CLC   0(2,R2),=X'9998'                                                 
         BE    IMGR12                                                           
         OC    0(2,R2),SBMG1MSK                                                 
IMGR12   LA    R1,SBMGR1NM                                                      
         B     IMGRNM                                                           
*                                                                               
IMGR2    MVC   0(2,R2),SBBMGR      MARKET GROUP 2                               
         CLC   0(2,R2),=X'9999'                                                 
         BE    IMGR22                                                           
         CLC   0(2,R2),=X'9998'                                                 
         BE    IMGR22                                                           
         OC    0(2,R2),SBMG2MSK                                                 
IMGR22   LA    R1,SBMGR2NM                                                      
         B     IMGRNM                                                           
*                                                                               
IMGR3    MVC   0(2,R2),SBBMGR      MARKET GROUP 3                               
         LA    R1,SBMGR3NM                                                      
*                                                                               
IMGRNM   CLI   GLARGS,C'N'                                                      
         BNE   XIT                                                              
         MVC   8(2,R2),0(R2)                                                    
         CLC   SBBMGR,=X'9999'                                                  
         BE    IMGRNM2                                                          
         CLC   SBBMGR,=X'9998'                                                  
         BE    IMGRNM2                                                          
         MVC   DUB(2),SBBMGR                                                    
         MVC   SBBMGR,0(R2)                                                     
         GOTO1 GETMGRNM                                                         
         MVC   SBBMGR,DUB                                                       
         CLC   0(24,R1),=CL24'** UNKNOWN **'                                    
         BNE   IMGRNM4                                                          
IMGRNM2  MVC   0(8,R1),XFE                                                      
IMGRNM4  MVC   0(8,R2),0(R1)                                                    
         B     XIT                                                              
*                                                                               
*                                                                               
IMKTR    MVC   0(2,R2),SBMRNUM     MARKET IN RANK ORDER                         
         LA    R2,2(R2)                                                         
*                                                                               
IMKT     MVC   0(2,R2),SBBMKT      MARKET                                       
         MVC   2(1,R2),MKTIND                                                   
         CLI   GLARGS,C'N'                                                      
         BNE   XIT                                                              
         CLI   GLARGS+2,C'X'       DON'T WANT MKT NUMBER FOR XFILE MKT          
         BE    IMKT10                                                           
         MVC   8(3,R2),0(R2)                                                    
         MVC   0(8,R2),SBMKTNM                                                  
         B     XIT                                                              
IMKT10   MVC   0(24,R2),SBMKTNM                                                 
         B     XIT                                                              
*                                                                               
IMKTWT   DS    0H                  MARKET WEIGHT                                
         MVC   0(4,R2),SBMKTWGT                                                 
         B     XIT                                                              
*                                                                               
IMKTRNK  MVC   0(1,R2),SBMKTRNK    MARKET RANK                                  
         B     XIT                                                              
*                                                                               
IRSM     MVC   0(2,R2),SBBRSM0     ASSUME NSI                                   
         CLI   GLARGS+2,C'A'       UNLESS ARB                                   
         BNE   *+10                                                             
         MVC   0(2,R2),SBBRSM1                                                  
         CLI   GLARGS+2,C'T'       MKTYPE KEYWORD?                              
         BNE   XIT                 NO                                           
         MVC   0(2,R2),SBBMKT      MARKET                                       
         MVC   2(2,R2),SBBRSM0     NSI MARKET                                   
         B     XIT                                                              
*                                                                               
ISGR1    MVC   0(2,R2),SBBSGR      STATION GROUP 1                              
         CLC   0(2,R2),=X'9999'                                                 
         BE    *+10                                                             
         OC    0(2,R2),SBSG1MSK                                                 
         LA    R1,SBSGR1NM                                                      
         B     ISGRNM                                                           
*                                                                               
ISGR2    MVC   0(2,R2),SBBSGR      STATION GROUP 2                              
         LA    R1,SBSGR2NM                                                      
*                                                                               
ISGRNM   CLI   GLARGS,C'N'                                                      
         BNE   XIT                                                              
         MVC   8(2,R2),0(R2)                                                    
         CLC   SBBSGR,=X'9999'                                                  
         BE    ISGRNM2                                                          
         MVC   DUB(2),SBBSGR                                                    
         MVC   SBBSGR,0(R2)                                                     
         GOTO1 GETSGRNM                                                         
         MVC   SBBSGR,DUB                                                       
         CLC   0(24,R1),=CL24'** UNKNOWN **'                                    
         BNE   ISGRNM4                                                          
ISGRNM2  MVC   0(8,R1),XFE                                                      
ISGRNM4  MVC   0(8,R2),0(R1)                                                    
         B     XIT                                                              
*                                                                               
ISTA     XC    0(8,R2),0(R2)                                                    
         MVC   0(5,R2),SBSTA                                                    
         CLI   SBMED,C'N'                                                       
         BNE   *+12                                                             
         MVI   4(R2),C'N'                                                       
         B     ISTAX                                                            
         CLC   SBCBLNET,BLANKS                                                  
         BNH   ISTAX                                                            
         MVC   5(3,R2),SBCBLNET                                                 
ISTAX    OC    0(8,R2),BLANKS                                                   
         B     XIT                                                              
*                                                                               
ICNET    DS    0H                  CABLE NETWORK                                
         LA    RE,SBAGYREC                                                      
         USING AGYRECD,RE                                                       
         CLI   AGYPROF+7,C'C'      CANADIAN?                                    
         BNE   ICNET10                                                          
         OC    SBBMKT,SBBMKT       IF MARKET ZERO BUY                           
         BNZ   *+14                                                             
         MVC   0(4,R2),SBSTA          RETURN STATION=MARKET ID                  
         B     ICNETX                                                           
         MVC   0(4,R2),SBNETWK     ELSE RETURN NETWORK                          
ICNETX   DS    0H                                                               
         B     XIT                                                              
         DROP  RE                                                               
*                                                                               
ICNET10  MVC   0(3,R2),SBCBLNET    CABLE NETWORK                                
         CLC   SBCBLNET,BLANKS                                                  
         BH    XIT                                                              
         MVC   0(3,R2),XFE                                                      
         B     XIT                                                              
*                                                                               
ISTANET  MVC   0(8,R2),BLANKS      STATION/NETWORK                              
         MVC   0(4,R2),SBSTA                                                    
         CLI   GLARGS+2,C'B'       WANT BAND?                                   
         BNE   ISTANET5            NO                                           
         CLI   SBMED,C'R'          MEDIA=RADIO?                                 
         BNE   ISTANET5            NO                                           
         MVC   0(5,R2),SBSTA       SAVE STATION WITH THE BAND                   
         B     XIT                                                              
*                                                                               
ISTANET5 CLI   SBMED,C'N'          TEST MEDIA=NETWORK                           
         BNE   XIT                                                              
         CLC   SBBMKT,=X'FFFE'     YES-IF MKT=NETWORKS                          
         BE    XIT                 THEN PASS NETWORK ONLY (=STATION)            
         MVC   4(3,R2),SBCBLNET                                                 
         CLI   SBBSTA+2,X'B0'      USED TO BE X'C0' - NFG!                      
         BNL   *+10                                                             
         MVC   4(4,R2),SBNETWK                                                  
         OC    4(4,R2),BLANKS                                                   
         B     XIT                                                              
*                                                                               
INETSTA  MVC   4(3,R2),SBCBLNET    NETWORK.STATION                              
         CLI   SBBSTA+2,X'B0'                                                   
         BNL   *+10                                                             
         MVC   0(4,R2),SBNETWK     NETWORK/STATION                              
         CLI   SBMED,C'T'                                                       
         BNE   *+10                                                             
         MVC   0(4,R2),=C'*TV*'                                                 
         MVC   4(4,R2),SBSTA                                                    
         TM    SBINDS,SBINETBL     TEST NETWORK BILLING                         
         BZ    XIT                                                              
         MVC   4(4,R2),BLANKS      YES-NETWORK ONLY                             
         B     XIT                                                              
*                                                                               
ISTANM   LA    R1,SYSD             STATION NAME                                 
         AHI   R1,SBSTANM-SYSD                                                  
         MVC   0(24,R2),0(R1)                                                   
         B     XIT                                                              
*                                                                               
ISTACITY LA    R1,SYSD             STATION CITY                                 
         AHI   R1,SBSTACTY-SYSD                                                 
         MVC   0(24,R2),0(R1)                                                   
         B     XIT                                                              
*                                                                               
ISTAST   MVC   0(3,R2),SBSTAST     STATION STATE                                
         B     XIT                                                              
*                                                                               
ISTAAD   LA    RE,SYSD             STATION ADDRESS                              
         LR    R1,RE                                                            
         AHI   RE,SBSTANM-SYSD                                                  
         MVC   0(24,R2),0(RE)                                                   
         AHI   R1,SBSTACTY-SYSD                                                 
         MVC   24(24,R2),0(R1)                                                  
         MVC   48(3,R2),SBSTAST                                                 
         B     XIT                                                              
*                                                                               
IAFFIL   MVC   0(3,R2),SBAFFIL     AFFILIATE                                    
         LA    RE,SBAGYREC                                                      
         CLI   AGYPROF+7-AGYRECD(RE),C'C'      CANADIAN?                        
         BNE   XIT                                                              
         MVC   3(1,R2),SBSTYPE     4TH BYTE HELD IN UNUSED 'TYPE'               
         CLC   SBBMKT,=X'FFFE'     TEST NETWORKS                                
         BNE   XIT                                                              
         MVC   0(4,R2),BLANKS      LOOKS WRONG IF APPLY AT THIS LEVEL           
         B     XIT                                                              
*                                                                               
ICHAN    MVC   0(4,R2),SBCHAN      CHANNEL                                      
         MVI   4(R2),C' '                                                       
         CLI   SBMED,C'R'          RADIO?                                       
         BNE   XIT                 NO                                           
         CLI   SBSTA+4,C'F'        FM?                                          
         BNE   XIT                 NO                                           
         CLI   SBCHAN+3,C'.'       HAVE DECIMAL PLACE?                          
         BE    XIT                 YES, HAVE CORRECT FORMAT                     
         MVI   3(R2),C'.'                                                       
         MVC   4(1,R2),SBCHAN+3                                                 
         B     XIT                                                              
*                                                                               
ISIZE    MVC   0(1,R2),SBSIZE      SIZE                                         
         B     XIT                                                              
*                                                                               
IFORMAT  MVC   0(4,R2),SBSTAFOR    FORMAT                                       
         B     XIT                                                              
*                                                                               
ISTAFAX  MVC   0(12,R2),SBSTAFAX   STATION FAX                                  
         B     XIT                                                              
*                                                                               
IMSO     LR    R1,R9               CABLE SYSTEM MSO NAME                        
         AHI   R1,SBCBLMSO-SYSD                                                 
         MVC   0(15,R2),0(R1)                                                   
         B     XIT                                                              
*                                                                               
IICNM    LR    R1,R9               CABLE SYSTEM INTERCONNECT NAME               
         AHI   R1,SBCBLIC-SYSD                                                  
         MVC   0(20,R2),0(R1)                                                   
         B     XIT                                                              
*                                                                               
IDPTLEN  MVC   0(9,R2),SBDPTLEN    DAYPART/LENGTH                               
         B     XIT                                                              
*                                                                               
IDPT     DS    0H                  DAYPART                                      
         CLI   GLARGS+2,C'S'       IF SQAD DPT                                  
         BE    IDPTSQD                                                          
         MVC   0(4,R2),SBDPTGRP    SPOTPAK DAYPART                              
         MVC   4(4,R2),SBDPT                                                    
         B     XIT                                                              
*                                                                               
IDPTSQD  DS    0H                  SQAD DAYPART CODE                            
         TM    ININD,INIDPTOT      SKIP IF DPT TOTAL RECORD                     
         BO    IDPTSQDX                                                         
*                                                                               
         LHI   RE,SBSQDBFA-SBLOCK                                               
         LA    RE,SBLOCK(RE)                                                    
         ICM   RE,15,0(RE)         POINT TO SQAD BUFFER                         
         BZ    IDPTSQDX                                                         
*                                                                               
         USING SQDBUFFD,RE         ESTABLISH BUFFER                             
         LA    RF,SQDDPTTB         POINT TO DAYPART TRANSLATION TABLE           
*                                  CL1(DPTMENU),CL1(DPT),CL2(SQAD DPT           
*                                                                               
IDPSQD10 OC    0(SQDDPTL,RF),0(RF) SKIP IF EOT REACHED                          
         BZ    IDPTSQDX                                                         
         CLC   SBDPTMEN,SQDDPMNU-SQDDPTTB(RF) MATCH CURRENT DPT MENU            
         BNE   IDPSQD20                                                         
         CLC   SBDPTCD,SQDDPTAG-SQDDPTTB(RF) MATCH BUY'S DPT                    
         BE    IDPSQD30                                                         
*                                                                               
IDPSQD20 LA    RF,SQDDPTL(RF)      BUMP TO NEXT ENTRY                           
         B     IDPSQD10                                                         
*                                                                               
IDPSQD30 MVC   0(L'SQDDPTSQ,R2),SQDDPTSQ-SQDDPTTB(RF) SET SQAD DPT CODE         
         DROP  RE                                                               
*                                                                               
         CLI   SBMED,C'R'          GET 5 CHARACTER EXPANSION FOR RADIO          
         BNE   IDPTSQDX                                                         
         LA    RE,SQADTABR                                                      
*                                                                               
IDPSQD40 CLC   0(L'SQDDPTSQ,R2),0(RE)                                           
         BE    IDPSQD50                                                         
         AHI   RE,7                                                             
         CLI   0(RE),X'FF'         EOT?                                         
         BE    IDPTSQDX                                                         
         B     IDPSQD40                                                         
*                                                                               
IDPSQD50 MVC   0(5,R2),2(RE)                                                    
*                                                                               
IDPTSQDX B     XIT                                                              
*                                                                               
SQADTABR DC   CL2'AM',CL5'AMDRV'                                                
         DC   CL2'DA',CL5'DAY  '                                                
         DC   CL2'PM',CL5'PMDRV'                                                
         DC   CL2'EV',CL5'EVE  '                                                
         DC   CL2'AV',CL5'AVG  '                                                
         DC   CL2'WE',CL5'WE   '                                                
         DC   CL2'AP',CL5'TAP  '                                                
         DC   X'FF'                                                             
*                                                                               
ILEN     CLI   SBMODE,SBPROCSP                                                  
         BE    ILEN10                                                           
         CLI   SBMODE,SBPROCGL                                                  
         BE    ILEN10                                                           
         CLI   SBMODE,SBPROCSL                                                  
         BE    ILEN10                                                           
         CLI   SBMODE,SBPROCNV                                                  
         BNE   XIT                                                              
         CLI   0(R4),X'40'                                                      
         BNE   XIT                                                              
         MVC   0(1,R2),SNVIDSLN-SNVIDELD(R4)                                    
         B     *+10                                                             
ILEN10   MVC   0(1,R2),SBLEN       SPOT LENGTH                                  
         CLI   GLARGS+1,C'E'       GET EQU LEN?                                 
         BNE   XIT                 NO, EXIT                                     
         BRAS  RE,GETSLEN          GET EQUIVALENT SPOT LENGTH                   
         B     XIT                                                              
*                                                                               
*                                  RATING BOOK                                  
IBOOK    MVC   0(4,R2),=X'FFFF0000'  ESTIMATED                                  
         CLI   SBEDEMTY,C'R'       TEST DEMO TYPE IS RERATE OR AFFID            
         BE    *+12                                                             
         CLI   SBEDEMTY,C'A'                                                    
         BNE   XIT                                                              
         LR    R5,R9                                                            
         AHI   R5,SBQBOOK-SYSD                                                  
         MVC   0(4,R2),0(R5)       YES-SET THE ACTUAL BOOK                      
         B     XIT                                                              
*                                                                               
ITGT     DS    0H                  TARGET DEMO                                  
*                                                                               
         GOTO1 GETESTNM                                                         
*                                                                               
         LA    R3,SBESTDEM         TARGET/TARGET2                               
         LLC   R4,GLARGS           TGT=1, TGT2=2, TGT3=3, TGT4=4                
*                                                                               
         CLI   GLARGS,2            TARGET3/TARGET4?                             
         BNH   ITGT10              NO                                           
         LHI   R3,SBESTDM2-SBLOCK  TARGET3/TARGET4                              
         LA    R3,SBLOCK(R3)       A(TARGET3/TARGET4)                           
         SHI   R4,2                -2 SO WE CAN USE AS INDEX                    
*                                                                               
ITGT10   BCTR  R4,0                -1 FOR INDEX                                 
         MHI   R4,3                INDEX INTO SBESTDEM/SBESTDM2                 
         AR    R4,R3               A(DEMO)                                      
*                                                                               
         GOTO1 AGETTGT,DMCB,(R4),DEMONAME                                       
*                                                                               
         MVC   0(7,R2),DEMONAME                                                 
         B     XIT                                                              
*                                                                               
ITEXT    MVI   0(R2),C' '          TEXT                                         
         B     XIT                                                              
*                                                                               
IRUNDATE MVC   0(2,R2),SBBTODAY                                                 
         B     XIT                                                              
*                                                                               
IPER     DS    0H                  PERIOD                                       
         BRAS  RE,INPER                                                         
         B     XIT                                                              
         EJECT                                                                  
* INPUT ROUTINES FOR BUY DETAILS                                                
*                                                                               
IBUY     GOTO1 AIBUY                                                            
         B     XIT                                                              
         SPACE 2                                                                
ILINE    CLI   GLARGS+2,C'M'       SPECIAL BUYLINE KWD?                         
         BE    ILINE10                                                          
         L     RE,SBAIO1           BUYLINE NUMBER                               
         USING BUYRECD,RE                                                       
         MVC   0(13,R2),XFE                                                     
         CLI   SBMODE,SBPROCSP                                                  
         BNE   XIT                                                              
         MVC   0(13,R2),BUYKEY                                                  
         TM    BUYRCNTL,BUYRLN2    2-BYTE BUYLINE?                              
         BNZ   *+14                YES                                          
         MVI   BUYKBUY-BUYKEY(R2),0            CONVERT 1-BYTE TO 2-BYTE         
         MVC   BUYKBUY+1-BUYKEY(1,R2),BUYKBUY                                   
* FIX CANADIAN NETWORK - NOT SURE WHY TAKE ENTIRE KEY HERE BUT...               
* THIS MEANS NETWORK AND LOCAL BUYLINES BECOME DISCRETE ENTITIES!               
         LA    RF,SBAGYREC                                                      
         CLI   AGYPROF+7-AGYRECD(RF),C'C'      CANADIAN?                        
         BNE   XIT                             (DO FOR ALL MEDIA TYPES          
         XC    0(13,R2),0(R2)                  SO NO DIFF BETWEEN THEM)         
         MVC   BUYKBUY+1-BUYKEY(1,R2),BUYKBUY  ONLY HOLD LINE#                  
         TM    BUYRCNTL,BUYRLN2    2-BYTE BUYLINE?                              
         BZ    *+10                NO                                           
         MVC   BUYKBUY-BUYKEY(2,R2),BUYKBUY    ONLY HOLD LINE#                  
         B     XIT                                                              
*                                                                               
* NOTE: ENTRY REC HAS ROOM FOR TWO BYTES FOR EXPANDED LINE NUMBERS              
ILINE10  MVC   0(2,R2),XFE                                                      
         CLI   SBMODE,SBPROCSP                                                  
         BNE   ILINE12                                                          
         L     RE,SBAIO1                                                        
         USING BUYRECD,RE                                                       
         MVI   0(R2),0             CONVERT 1-BYTE BUYLINE TO 2-BYTES            
         MVC   1(1,R2),BUYKBUY                                                  
         TM    BUYRCNTL,BUYRLN2    ALREADY A 2-BYTE BUYLINE?                    
         BZ    *+10                NO                                           
         MVC   0(2,R2),BUYKBUY     YES - MOVE THE 2 BYTES                       
         DROP  RE                                                               
         B     XIT                                                              
*                                                                               
ILINE12  CLI   SBMODE,SBPROCNV                                                  
         BNE   XIT                                                              
         MVI   0(R2),0                                                          
         MVC   1(1,R2),SNVIDBLN-SNVIDELD(R4)                                    
         OC    SNVIDTBL-SNVIDELD(2,R4),SNVIDTBL-SNVIDELD(R4)                    
         BZ    XIT                                                              
         MVC   0(2,R2),SNVIDTBL-SNVIDELD(R4)                                    
         B     XIT                                                              
*                                                                               
         SPACE 2                                                                
IPROG    L     RE,SBAIO1           PROGRAM NAME                                 
         USING BUYRECD,RE                                                       
         MVC   0(17,R2),BLANKS                                                  
         MVC   0(11,R2),UNKNOWN                                                 
         CLI   SBMODE,SBPROCSP                                                  
         BNE   XIT                                                              
         LHI   R1,16               17 - 1                                       
         LA    RF,BDPROGRM                                                      
         TM    SBQCAN,SBQCBYM0                                                  
         BZ    IPRG10                                                           
         LHI   R1,11               12 - 1                                       
         OC    BUYKMSTA(2),BUYKMSTA    MARKET 0?                                
         BNZ   IPRG10                   NO                                      
         CLI   0(RF),C'='          SHOW CODE OVERRIDE?                          
         BE    IPRG10               YES - SHOW ENTIRE PROGRAM                   
         AHI   RF,5                 NO - SKIP SHOW CODE                         
*                                                                               
IPRG10   EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),0(RF)                                                    
         B     XIT                                                              
         DROP  RE                                                               
         SPACE 2                                                                
IROT     L     RE,SBAIO1           DAY ROTATION                                 
         USING BUYRECD,RE                                                       
         CLI   SBMODE,SBPROCSP                                                  
         BNE   XIT                                                              
         CLI   BDDAY,X'80'                                                      
         BE    XIT                                                              
         SR    R1,R1                                                            
         ICM   R1,8,BDDAY                                                       
         BZ    XIT                                                              
         MVC   0(1,R2),BDSEDAY                                                  
         MVC   1(1,R2),BDDAY                                                    
         B     XIT                                                              
*&&DO                                                                           
         STCM  R1,8,1(R2)                                                       
         LA    RF,1                                                             
IROT2    SLL   R1,1                                                             
         LTR   R1,R1                                                            
         BM    *+12                                                             
         LA    RF,1(RF)                                                         
         B     IROT2                                                            
         STC   RF,0(R2)                                                         
         B     XIT                                                              
*&&                                                                             
         SPACE 2                                                                
ITIMES   L     RE,SBAIO1           TIMES                                        
         MVC   0(4,R2),XFE                                                      
         CLI   SBMODE,SBPROCSP                                                  
         BNE   XIT                                                              
         MVC   0(4,R2),BDTIMST                                                  
                                                                                
         DROP  RE                                                               
*                                                                               
ITIM10   LA    R1,0(R2)                                                         
         BRAS  RE,FMTTIME                                                       
*                                                                               
         OC    0(4,R2),0(R2)       MIDNIGHT?                                    
         BNZ   XIT                                                              
         MVI   0(R2),C'M'                                                       
         B     XIT                                                              
*                                                                               
IBYID    CLI   SBMODE,SBPROCNV     BUY ID/CONTRACT NUMBER                       
         BNE   IBYID10                                                          
         MVC   0(12,R2),ELEM+29    INVOICE CONTRACT NUMBER                      
         B     IBYID40                                                          
*                                                                               
IBYID10  CLI   SBMODE,SBPROCSP     FIND BUY ID                                  
         BNE   IBYIDX                                                           
         L     RE,SBAIO1                                                        
         USING BUYRECD,RE                                                       
         CLI   GLARGS+2,C'M'       BYIDMG KEYWORD?                              
         BE    *+10                                                             
         MVC   0(11,R2),UNKNOWN                                                 
         SR    R0,R0                                                            
         LA    R1,BDELEM                                                        
*                                                                               
IBYID20  CLI   0(R1),0                                                          
         BE    IBYIDX                                                           
         CLI   0(R1),X'70'                                                      
         BE    IBYID30                                                          
         IC    R0,1(R1)                                                         
         AR    R1,R0                                                            
         B     IBYID20                                                          
*                                                                               
IBYID30  MVC   0(12,R2),3(R1)                                                   
*                                                                               
IBYID40  CLI   GLARGS+2,C'M'       BYIDMG KEYWORD?                              
         BNE   IBYIDX                                                           
         CLI   SBCEXTRA+2,C'Y'     TEST BUY ID REQ'D                            
         BE    IBYID50              YES - DON'T SHOW AS MG GROUP                
         CLI   SBCEXTRA+2,C'A'     TEST MKTGRP ID'S ACTIVE THIS CLT             
         BL    IBYID50              NO - DON'T SHOW IT                          
         CLI   SBCEXTRA+2,C'Z'                                                  
         BH    IBYID50                                                          
         CLC   SBCEXTRA+2(1),0(R2) IS IT THIS MGRP?                             
         BNE   IBYID50              NO - CLEAR IT OUT                           
*                                                                               
         XR    RF,RF               GET THE STATIONS HOME MKT                    
         ICM   RF,3,SBBSTMKT                                                    
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  FULL,DUB                                                         
         CLC   FULL,1(R2)          TEST IF THIS BUY IN THE HOME MKT             
         BNE   IBYIDX               NO LEAVE IT BE                              
*                                                                               
IBYID50  MVC   0(12,R2),BLANKS                                                  
*                                                                               
IBYIDX   OC    0(12,R2),BLANKS     SPACE PAD TO PREVENT 2 SORT RECORDS          
         B     XIT                                                              
*                                                                               
IPURP    L     RE,SBAIO1           PURPOSE CODE                                 
         SR    R0,R0                                                            
         LA    R1,GDIDR-GOALRECD(RE)                                            
         CLI   SBMODE,SBPROCGL                                                  
         BE    IPURP50                                                          
*                                                                               
         LA    R1,BDELEM-BUYRECD(RE)                                            
         CLI   SBMODE,SBPROCSP                                                  
         BNE   IPURPX                                                           
*                                                                               
IPURP10  CLI   0(R1),0                                                          
         BE    IPURPX                                                           
         CLI   0(R1),X'70'                                                      
         BNE   IPURP20                                                          
         AHI   R1,3                                                             
         B     IPURP50                                                          
*                                                                               
IPURP20  IC    R0,1(R1)                                                         
         AR    R1,R0                                                            
         B     IPURP10                                                          
*                                                                               
IPURP50  MVC   0(1,R2),SBMED                                                    
         MVC   1(6,R2),0(R1)                                                    
         OC    1(6,R2),BLANKS                                                   
*                                                                               
IPURPX   B     XIT                                                              
*                                                                               
OPURP    MVC   LABLAREA(7),=C'PURPOSE'                                          
         MVC   CODEAREA(6),CZZ                                                  
         MVC   NAMEAREA(11),UNKNOWN                                             
         CLC   0(7,R2),BLANKS                                                   
         BNH   OPURPX                                                           
         MVC   CODEAREA(6),1(R2)                                                
*                                  GET PURPOSE DESCRIPTION                      
         LHI   R0,PURPTABQ         MAX PURPTAB ENTRIES                          
         L     RE,APURPTAB                                                      
*                                                                               
OPURP10  OC    0(7,RE),0(RE)                                                    
         BZ    OPURPX                                                           
         CLC   0(7,RE),0(R2)       MED & CODE                                   
         BE    OPURP20                                                          
         AHI   RE,PURPTABL         L'PURPTAB ENTRY                              
         BCT   R0,OPURP10                                                       
         DCHO                                                                   
*                                                                               
OPURP20  MVC   NAMEAREA(30),7(RE)                                               
*                                                                               
OPURPX   B     GENOUT                                                           
*                                                                               
IADJ     CLI   SBMODE,SBPROCSP     PROGRAM ADJACENCY CODE                       
         BNE   XIT                                                              
         L     RE,SBAIO1                                                        
         MVC   0(1,R2),BDPROGT                                                  
         B     XIT                                                              
         DROP  RE                                                               
         SPACE 2                                                                
IBYTYPE  MVC   0(1,R2),SBBYTYPE    BUY TYPE                                     
         B     XIT                                                              
         SPACE 2                                                                
IPREP    MVC   0(3,R2),SBPREP      PAYING REP                                   
         MVC   SBREP,SBPREP                                                     
         B     IREPNM                                                           
*                                                                               
ITREP    MVC   0(3,R2),SBTREP      TIME SHEET REP                               
         MVC   SBREP,SBTREP                                                     
         B     IREPNM                                                           
*                                                                               
*                                  SPECIAL REP                                  
ISREP    CLI   GLARGS+2,C'V'       INVREP KEYWORD?                              
         BNE   ISREP1              NO                                           
         MVC   0(3,R2),ZEROS       YES - INIT TO C'000'                         
         CLI   SBMODE,SBPROCNV     READING INVOICE RECORDS?                     
         BNE   IREPNM              NO - DONE                                    
         MVC   0(3,R2),INVSREP     INVOICE SPECIAL REP                          
         B     IREPNM              DONE                                         
*                                                                               
ISREP1   CLI   SBMODE,SBPROCSP     TEST READING BUY RECORDS                     
         BNE   ISREP2                                                           
         CLI   GLARGS,C'B'         YES-TEST FROM BUY RECORD ONLY                
         BE    ISREP2              YES                                          
         CLC   SBSREP,ZEROS        NO-TEST REP=0                                
         BNE   ISREP2                                                           
         OC    SBESTSR,SBESTSR     IS THERE A SPECIAL REP FROM THE EST?         
         BZ    ISREP2              NO, DO NOT CALL RCPACK WITH NULLS!           
         GOTO1 RCPACK,DMCB,(C'U',SBESTSR),SBSREP                                
ISREP2   MVC   0(3,R2),SBSREP                                                   
         MVC   SBREP,SBSREP                                                     
*                                                                               
IREPNM   CLI   GLARGS,C'N'                                                      
         BNE   XIT                                                              
         CLC   SVREP,SBREP                                                      
         BE    IREPNM2                                                          
         MVC   SVREP,SBREP                                                      
         MVC   SBREPNM,BLANKS                                                   
         CLC   SBREP,ZEROS                                                      
         BE    IREPNM2                                                          
         GOTO1 GETREPNM                                                         
         BE    IREPNM2                                                          
         GOTO1 AGETREP                                                          
         GOTO1 PUTREPNM                                                         
IREPNM2  MVC   0(22,R2),SBREPNM                                                 
         B     XIT                                                              
         SPACE 2                                                                
INAMES   MVC   0(12,R2),SBBYRNM    BUYER NAME                                   
         CLI   GLARGS+1,1                                                       
         BE    XIT                                                              
         MVC   0(12,R2),SBBLRNM    BILLER NAME                                  
         B     XIT                                                              
         SPACE 2                                                                
IADATE   MVC   0(2,R2),XFF         AFFIDAVIT DATE                               
         CLI   SBMODE,SBPROCSP                                                  
         BNE   IADATE2                                                          
         OC    SCADATE,SCADATE                                                  
         BZ    XIT                                                              
         MVC   0(2,R2),SCADATE                                                  
         B     XIT                                                              
*                                                                               
IADATE2  CLI   SBMODE,SBPROCNV                                                  
         BNE   XIT                                                              
         CLI   0(R4),X'40'                                                      
         BNE   XIT                                                              
         LLC   R6,SNVIDDAY-SNVIDELD(R4)                                         
         GOTO1 DATCON,DMCB,(2,ELEM+25),(0,WORK)                                 
         GOTO1 ADDAY,(R1),WORK,WORK,(R6)                                        
         GOTO1 DATCON,(R1),(0,WORK),(2,(R2))                                    
         B     XIT                                                              
*                                                                               
IADAY    MVC   1(3,R2),CZZ         AFFIDAVIT DAY                                
         MVI   0(R2),8                                                          
         CLI   SBMODE,SBPROCSP                                                  
         BNE   IADAY2                                                           
         OC    SCADATE,SCADATE                                                  
         BZ    XIT                                                              
         GOTO1 DATCON,DMCB,(2,SCADATE),DUB                                      
         B     IADAY4                                                           
*                                                                               
IADAY2   CLI   SBMODE,SBPROCNV                                                  
         BNE   XIT                                                              
         CLI   0(R4),X'40'                                                      
         BNE   XIT                                                              
         LLC   R6,SNVIDDAY-SNVIDELD(R4)                                         
         GOTO1 DATCON,DMCB,(2,ELEM+25),(0,DUB)                                  
         GOTO1 ADDAY,(R1),DUB,DUB,(R6)                                          
*                                                                               
IADAY4   GOTO1 GETDAY,(R1),DUB,FULL                                             
         CLC   FULL(3),BLANKS                                                   
         BE    XIT                                                              
         MVC   0(1,R2),0(R1)                                                    
         MVC   1(3,R2),FULL                                                     
         B     XIT                                                              
*                                                                               
IATIME   BRAS  RE,INATIME          AFFIDAVIT TIME                               
         B     XIT                 EXIT                                         
*                                                                               
IAPROG   MVC   0(16,R2),BLANKS     AFFIDAVIT PROGRAM                            
         MVC   0(11,R2),UNKNOWN                                                 
         CLI   SBMODE,SBPROCSP                                                  
         BNE   XIT                                                              
         MVC   0(16,R2),SBLKPROG                                                
         B     XIT                                                              
         EJECT                                                                  
* OUTPUT ROUTINES                                                               
*                                                                               
OMED     MVC   LABLAREA(5),=C'MEDIA'       ** MEDIA **                          
         MVC   SBMED,0(R2)                                                      
         CLI   GLARGS,C'N'         NAME ONLY                                    
         BE    OMED2                                                            
         MVC   CODEAREA(1),0(R2)                                                
         CLI   GLARGS,C'C'         CODE ONLY                                    
         BE    GENOUT                                                           
         CLI   GLARGS,C'W'         WARNER-LAMBERT                               
         BNE   OMED2                                                            
         MVI   CODEAREA,C'S'                                                    
         MVC   CODEAREA+1(1),0(R2)                                              
         B     GENOUT                                                           
*                                                                               
OMED2    LA    RE,SBMEDNM                                                       
         LA    R1,SYSD                                                          
         CLI   SBQMED,C'*'         TEST MEDIA ALL REQUEST                       
         BNE   OMED4                                                            
*                                                                               
         TM    GLINDS,GLTOTLIN     THIS A TOTAL LINE?                           
         BNZ   GENOUT              YES                                          
***      CLI   0(R2),X'FF'         THIS A TOTAL REC?                            
***      BE    GENOUT               YES - CAN'T RESOLVE NAME HERE               
*                                                                               
         CLI   0(R2),C'T'          YES-                                         
         BE    OMED4                                                            
         LR    RE,R1                                                            
         CLI   0(R2),C'R'                                                       
         BNE   *+12                                                             
         AHI   RE,SBMEDNMR-SYSD                                                 
         B     OMED4                                                            
         CLI   0(R2),C'N'                                                       
         BNE   *+12                                                             
         AHI   RE,SBMEDNMN-SYSD                                                 
         B     OMED4                                                            
         CLI   0(R2),C'X'                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         AHI   RE,SBMEDNMX-SYSD                                                 
*                                                                               
OMED4    MVC   NAMEAREA(L'SBMEDNM),0(RE)                                        
         AHI   R1,SBCMEDNM-SYSD                                                 
         CLC   0(L'SBCMEDNM,R1),BLANKS   TEST SPECIAL MED NAME FOR CLT          
         BNH   GENOUT                                                           
         MVC   NAMEAREA(L'SBCMEDNM),0(R1)  YES                                  
         B     GENOUT                                                           
         SPACE 2                                                                
OSUBMED  MVC   LABLAREA(6),=C'TV/NET'      ** SUBMEDIA **                       
         MVC   CODEAREA(1),0(R2)                                                
         B     GENOUT                                                           
         EJECT                                                                  
* CLIENT OUTPUT ROUTINES                                                        
*                                                                               
         SPACE 2                                                                
OCLTOFF  MVC   LABLAREA(13),=C'CLIENT OFFICE'  ** CLIENT OFFICE **              
         CLI   1(R2),X'FF'                                                      
         BNE   OCLT10                                                           
         MVI   1(R2),C' '                                                       
         GOTO1 =V(OFFOUT),DMCB,0(R2),HEXOUT,CODEAREA                            
         CLI   CODEAREA,C' '                                                    
         BNE   *+14                                                             
         MVC   CODEAREA(1),CODEAREA+1                                           
         MVI   CODEAREA+1,C' '                                                  
*                                                                               
OCLT10   MVC   CODEAREA(2),0(R2)                                                
         CLI   GLARGS,C'X'                                                      
         BNE   *+10                                                             
         MVC   CODEAREA+1(1),1(R2)      XFILE HAS 2 CHAR OFFC                   
         B     GENOUT                                                           
         SPACE 2                                                                
OCLTINT  MVC   LABLAREA(14),=C'INTERFACE CODE'  CLIENT INTERFACE CODE           
         MVC   CODEAREA(8),0(R2)                                                
         B     GENOUT                                                           
         SPACE 2                                                                
OCLTACOF MVC   LABLAREA(14),=C'ACCOUNT OFFICE' ACCOUNTING OFFICE CODE           
         MVC   CODEAREA(2),0(R2)                                                
         B     GENOUT                                                           
         SPACE 2                                                                
OCLTACC  MVC   LABLAREA(12),=C'LIMIT ACCESS'  CLIENT LIMIT ACCESS CODE          
         MVC   CODEAREA(3),0(R2)                                                
         B     GENOUT                                                           
         SPACE 2                                                                
OCGR1    CLI   GLARGS,C'N'         ** CLIENT GROUP 1 **                         
         BNE   *+8                                                              
         LA    R2,8(R2)                                                         
         CLC   0(2,R2),XFF                                                      
         BE    GENOUT                                                           
         MVC   SBBCGR,0(R2)                                                     
         MVC   LABLAREA(L'SBCGR1BK),SBCGR1BK                                    
*        MVC   CODEAREA(1),SBQCGRD                                              
         BRAS  RE,CGRCODE                                                       
         LA    R1,SBCGR1LN                                                      
         GOTO1 AOGRPCD                                                          
         CLI   GLARGS,C'C'                                                      
         BE    GENOUT                                                           
         CLC   NAMEAREA(L'UNKNOWN),UNKNOWN                                      
         BE    GENOUT                                                           
         GOTO1 GETCGRNM,SBCGR1NM                                                
         MVC   NAMEAREA(L'SBCGR1NM),SBCGR1NM                                    
         B     GENOUT                                                           
         SPACE 2                                                                
OCGR2    CLI   GLARGS,C'N'         ** CLIENT GROUP 2 **                         
         BNE   *+8                                                              
         LA    R2,8(R2)                                                         
         CLC   0(2,R2),XFF                                                      
         BE    GENOUT                                                           
         MVC   SBBCGR,0(R2)                                                     
         MVC   LABLAREA(L'SBCGR2BK),SBCGR2BK                                    
*        MVC   CODEAREA(1),SBQCGRD                                              
         BRAS  RE,CGRCODE                                                       
         LA    R1,SBCGR2LN                                                      
         GOTO1 AOGRPCD                                                          
         CLI   GLARGS,C'C'                                                      
         BE    GENOUT                                                           
         CLC   NAMEAREA(L'UNKNOWN),UNKNOWN                                      
         BE    GENOUT                                                           
         GOTO1 GETCGRNM,SBCGR2NM                                                
         MVC   NAMEAREA(L'SBCGR2NM),SBCGR2NM                                    
         B     GENOUT                                                           
         SPACE 2                                                                
OCLT     CLI   GLARGS,C'N'         ** CLIENT **                                 
         BNE   *+8                                                              
         LA    R2,8(R2)                                                         
         CLC   0(3,R2),XFF         TEST DETAIL TOTAL                            
         BE    GENOUT                                                           
         MVC   LABLAREA(6),=C'CLIENT'                                           
         MVC   SBCLT,0(R2)                                                      
         CLI   GLARGS,C'N'                                                      
         BE    OCLT2                                                            
         MVC   CODEAREA(3),SBCLT                                                
         CLI   GLARGS,C'C'                                                      
         BE    GENOUT                                                           
OCLT2    GOTO1 GETCLTNM                                                         
         MVC   NAMEAREA(L'SBCLTNM),SBCLTNM                                      
         B     GENOUT                                                           
         EJECT                                                                  
* STATION OUTPUT ROUTIMES                                                       
*                                                                               
         SPACE 1                                                                
OSGR1    CLI   GLARGS,C'N'         ** STATION GROUP 1 **                        
         BNE   *+8                                                              
         LA    R2,8(R2)                                                         
         CLC   0(2,R2),XFF                                                      
         BE    GENOUT                                                           
         MVC   SBBSGR,0(R2)                                                     
         MVC   LABLAREA(L'SBSGR1BK),SBSGR1BK                                    
         MVC   CODEAREA(1),SBQSGRD                                              
         LA    R1,SBSGR1LN                                                      
         GOTO1 AOGRPCD                                                          
         CLI   GLARGS,C'C'                                                      
         BE    OSGRX                                                            
         CLC   NAMEAREA(L'UNKNOWN),UNKNOWN                                      
         BE    OSGRX                                                            
         GOTO1 GETSGRNM,SBSGR1NM                                                
         MVC   NAMEAREA(L'SBSGR1NM),SBSGR1NM                                    
         B     OSGRX                                                            
*                                                                               
OSGR2    CLI   GLARGS,C'N'         ** STATION GROUP 2 **                        
         BNE   *+8                                                              
         LA    R2,8(R2)                                                         
         CLC   0(2,R2),XFF                                                      
         BE    GENOUT                                                           
         MVC   SBBSGR,0(R2)                                                     
         MVC   LABLAREA(L'SBSGR2BK),SBSGR2BK                                    
         MVC   CODEAREA(1),SBQSGRD                                              
         LA    R1,SBSGR2LN                                                      
         GOTO1 AOGRPCD                                                          
         CLI   GLARGS,C'C'                                                      
         BE    OSGRX                                                            
         CLC   NAMEAREA(L'UNKNOWN),UNKNOWN                                      
         BE    OSGRX                                                            
         GOTO1 GETSGRNM,SBSGR2NM                                                
         MVC   NAMEAREA(L'SBSGR2NM),SBSGR2NM                                    
*                                                                               
OSGRX    CLC   =C'*100',CODEAREA                                                
         BNE   *+10                                                             
         MVC   CODEAREA(4),=C'EASI'                                             
         B     GENOUT                                                           
*                                                                               
OSTA     DS    0H                                                               
         TM    SBQREAD,SBQRDINF                                                 
         BZ    OSTA1                                                            
         CLC   0(5,R2),CAA         ALL STATION (IN INFTAB)?                     
         BH    *+14                                                             
         MVC   CODEAREA(3),=C'ALL'                                              
         B     GENOUT                                                           
*                                                                               
OSTA1    CLC   0(5,R2),CAA         TEST 'ALL' STATIONS                          
         BNE   *+12                                                             
         MVI   PRTSW,C'N'          YES - DON'T PRINT THIS LINE                  
         B     XIT                                                              
         CLC   0(5,R2),XFF         TEST DETAIL TOTAL                            
         BE    GENOUT                                                           
         MVC   LABLAREA(7),=C'STATION'                                          
         CLI   GLARGS,C'N'                                                      
         BNE   *+10                                                             
         MVC   LABLAREA(7),=C'NETWORK'                                          
         MVC   SBSTA,0(R2)                                                      
         MVC   SBCBLNET,5(R2)                                                   
         MVC   CODEAREA(4),0(R2)                                                
         CLI   4(R2),C'N'          TEST NETWORK                                 
         BE    GENOUT                                                           
         CLC   5(3,R2),BLANKS      TEST CABLE NETWORK                           
         BNH   OSTA2                                                            
         MVI   CODEAREA+4,C'/'                                                  
         MVC   CODEAREA+5(3),5(R2)                                              
         B     GENOUT                                                           
*                                                                               
OSTA2    MVI   CODEAREA+4,C'-'                                                  
         MVC   CODEAREA+5(1),4(R2)                                              
         CLI   4(R2),C'A'          TEST RADIO BANDS                             
         BE    OSTA3                                                            
         CLI   4(R2),C'F'                                                       
         BE    OSTA3                                                            
         CLI   4(R2),C'S'          DIGITAL RADIO?                               
         BE    OSTA3                                                            
         CLI   4(R2),C'C'          DIGITAL RADIO?                               
         BNE   *+8                 NO                                           
OSTA3    MVI   CODEAREA+6,C'M'                                                  
         CLI   4(R2),C'D'          DIGITAL TV?                                  
         BNE   *+8                 NO                                           
         MVI   CODEAREA+6,C'V'                                                  
         CLI   4(R2),C'T'                                                       
         BE    *+12                                                             
         CLI   4(R2),C' '                                                       
         BH    *+10                                                             
         MVC   CODEAREA+5(2),=C'TV'                                             
*                                                                               
         CLI   GLARGS,C'6'         6 CHAR OUTPUT FMT?                           
         BNE   OSTAX                                                            
         LA    R0,C'-'             GO FIND A '-'                                
         LA    RF,CODEAREA                                                      
         LA    RE,L'CODEAREA(RF)                                                
         SRST  RE,RF                                                            
***         BC    1,*-4               DON'T NEED IF LENGTH <256                 
         BC    2,OSTAX             NOT FOUND                                    
         LR    R1,RE               R1=A(CHARACTER FOUND)                        
         SR    RE,RF               RE=# BYTES INTO FIELD                        
         LHI   RF,L'CODEAREA-1                                                  
         SR    RF,RE               LENGTH FOR EXECUTED MOVE                     
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),1(R1)       SHIFT EVERYTHING LEFT 1 CHAR                 
*                                                                               
OSTAX    B     GENOUT                                                           
*                                                                               
*                                                                               
*                                  ** CABLE NETWORK **                          
OCNET    MVC   LABLAREA(13),=C'CABLE NETWORK'                                   
         LA    RF,2                                                             
         LA    RE,SBAGYREC                                                      
         USING AGYRECD,RE                                                       
         CLI   AGYPROF+7,C'C'      CANADIAN?                                    
         DROP  RE                                                               
         BNE   OCNET10              NO                                          
         MVC   SBNETWK,0(R2)                                                    
         LA    RF,3                                                             
         B     *+10                                                             
*                                                                               
OCNET10  MVC   SBCBLNET,0(R2)                                                   
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),0(R2)                                                
         CLC   0(3,R2),XFE                                                      
         BNE   GENOUT                                                           
         MVC   CODEAREA(3),=C'???'                                              
         B     GENOUT                                                           
*                                                                               
OSTANET  CLC   0(4,R2),XFF         ** STATION/NETWORK **                        
         BE    GENOUT                                                           
         CLC   0(4,R2),CAA         TEST 'ALL' STATIONS                          
         BNE   *+12                                                             
         MVI   PRTSW,C'N'          YES - DON'T PRINT THIS LINE                  
         B     XIT                                                              
         MVC   LABLAREA(7),=C'STATION'                                          
         CLI   GLARGS,C'N'                                                      
         BNE   *+10                                                             
         MVC   LABLAREA(7),=C'NETWORK'                                          
         MVC   CODEAREA(4),0(R2)                                                
         CLI   GLARGS+2,C'B'       WANT TO PRINT BAND?                          
         BNE   OSTANET5            NO                                           
         CLI   4(R2),C'A'          AM?                                          
         BE    *+12                YES                                          
         CLI   4(R2),C'F'          FM?                                          
         BNE   OSTANET5            NO                                           
         MVI   CODEAREA+4,C'-'                                                  
         MVC   CODEAREA+5(1),4(R2)                                              
         MVI   CODEAREA+6,C'M'                                                  
         B     GENOUT                                                           
*                                                                               
OSTANET5 CLC   4(4,R2),BLANKS                                                   
         BE    GENOUT                                                           
         MVI   CODEAREA+4,C'/'                                                  
         MVC   CODEAREA+5(4),4(R2)                                              
         B     GENOUT                                                           
*                                                                               
ONETSTA  CLC   0(4,R2),XFF         ** NETWORK/STATION **                        
         BE    GENOUT                                                           
         MVC   LABLAREA(9),=C'NETWK/STA'                                        
         MVC   CODEAREA(4),0(R2)                                                
         CLC   4(4,R2),BLANKS                                                   
         BE    GENOUT                                                           
         MVI   CODEAREA+4,C'/'                                                  
         MVC   CODEAREA+5(4),4(R2)                                              
         CLC   4(4,R2),XFF                                                      
         BNE   GENOUT                                                           
         MVC   CODEAREA+5(4),=C'*ALL'                                           
         B     GENOUT                                                           
*                                                                               
OSTANM   MVC   LABLAREA(12),=C'STATION NAME'   ** STATION NAME **               
         MVC   NAMEAREA(9),UNKNOWN+1                                            
         CLI   0(R2),X'FE'                                                      
         BE    GENOUT                                                           
         MVC   NAMEAREA(24),0(R2)                                               
         B     GENOUT                                                           
*                                                                               
OSTACITY MVC   LABLAREA(12),=C'STATION CITY'   ** STATION CITY **               
         MVC   NAMEAREA(9),UNKNOWN+1                                            
         CLI   0(R2),X'FE'                                                      
         BE    GENOUT                                                           
         MVC   NAMEAREA(24),0(R2)                                               
         B     GENOUT                                                           
*                                                                               
OSTAST   MVC   LABLAREA(13),=C'STATION STATE'   ** STATION STATE **             
         MVC   NAMEAREA(3),=C'???'                                              
         CLI   0(R2),X'FE'                                                      
         BE    GENOUT                                                           
         MVC   NAMEAREA(3),0(R2)                                                
         B     GENOUT                                                           
*                                                                               
OSTAAD   MVC   0(55,R3),BLANKS     ** STATION ADDRESS **                        
         CLI   0(R2),X'FE'                                                      
         BNE   *+14                                                             
         MVC   0(9,R3),UNKNOWN+1                                                
         B     XIT                                                              
         MVC   0(24,R3),0(R2)                                                   
         LA    R1,23(R3)                                                        
         BAS   RE,OSTAAD2                                                       
         MVC   0(24,R1),24(R2)                                                  
         LA    R1,23(R1)                                                        
         BAS   RE,OSTAAD2                                                       
         MVC   0(3,R1),48(R2)                                                   
         B     XIT                                                              
OSTAAD2  CLI   0(R1),C' '                                                       
         BH    *+10                                                             
         BCTR  R1,0                                                             
         B     OSTAAD2                                                          
         MVI   1(R1),C','                                                       
         MVI   2(R1),C' '                                                       
         LA    R1,3(R1)                                                         
         BR    RE                                                               
*                                  ** AFFILIATE **                              
OAFFIL   CLC   0(3,R2),=C'ALL'     TEST 'ALL' AFFILIATES                        
         BNE   *+12                                                             
         MVI   PRTSW,C'N'          YES - DON'T PRINT THIS LINE                  
         B     XIT                                                              
         CLC   0(3,R2),XFF         TEST DETAIL TOTAL                            
         BE    GENOUT                                                           
         MVC   LABLAREA(9),=C'AFFILIATE'                                        
         MVC   CODEAREA(3),0(R2)                                                
         LA    RE,SBAGYREC                                                      
         CLI   AGYPROF+7-AGYRECD(RE),C'C'      CANADIAN?                        
         BNE   GENOUT                                                           
         MVC   CODEAREA(4),0(R2)                                                
         B     GENOUT                                                           
*                                  ** CHANNEL **                                
OCHAN    CLI   0(R2),X'FF'                                                      
         BNE   OCHAN2                                                           
         OC    1(3,R2),1(R2)       TEST 'ALL' CHANNELS                          
         BNZ   *+12                                                             
         MVI   PRTSW,C'N'          YES - DON'T PRINT THIS LINE                  
         B     XIT                                                              
         CLC   0(4,R2),XFF         TEST DETAIL TOTAL                            
         BE    GENOUT                                                           
OCHAN2   MVC   LABLAREA(7),=C'CHANNEL'                                          
         MVC   CODEAREA(5),0(R2)                                                
         B     GENOUT                                                           
*                                  ** STATION SIZE **                           
OSIZE    MVC   LABLAREA(4),=C'SIZE'                                             
         MVC   CODEAREA(1),0(R2)                                                
         B     GENOUT                                                           
*                                  ** STATION FORMAT **                         
OFORMAT  MVC   LABLAREA(6),=C'FORMAT'                                           
         MVC   CODEAREA(4),0(R2)                                                
         B     GENOUT                                                           
*                                  ** STATION FAX **                            
OSTAFAX  MVC   LABLAREA(3),=C'FAX'                                              
         MVC   CODEAREA(12),0(R2)                                               
         B     GENOUT                                                           
*                                  ** CABLE SYSTEM MSO NAME **                  
OMSO     MVC   LABLAREA(8),=C'MSO NAME'                                         
         MVC   NAMEAREA(15),0(R2)                                               
         B     GENOUT                                                           
*                                  ** CABLE SYSTEM INTERCONNECT NAME **         
OICNM    MVC   LABLAREA(12),=C'INTERCONNECT'                                    
         MVC   NAMEAREA(20),0(R2)                                               
         B     GENOUT                                                           
         EJECT                                                                  
* MISC OUTPUT ROUTINES                                                          
*                                                                               
         SPACE 1                                                                
OBOOK    MVC   LABLAREA(4),=C'BOOK'   ** BOOK **                                
         CLC   0(2,R2),XFF                                                      
         BNE   *+14                                                             
         MVC   CODEAREA(5),=C'ESTIM'                                            
         B     GENOUT                                                           
         MVC   CODEAREA(3),0(R2)                                                
         CLC   0(3,R2),=C'ACT'                                                  
         BE    GENOUT                                                           
         MVC   DUB(4),0(R2)                                                     
         MVC   DUB+4(2),=C'01'                                                  
         GOTO1 DATCON,DMCB,(0,DUB),(6,CODEAREA)                                 
         B     GENOUT                                                           
*                                                                               
*                                  ** TARGET **                                 
OTGT     BRAS  RE,OUTTGT           FOR ADDRESSABILITY                           
         B     GENOUT                                                           
*                                                                               
* ESTIMATE DATES                                                                
OEDATES  DS    0H                                                               
         MVC   LABLAREA(09),=C'EST DATES'                                       
         LA    R4,NAMEAREA                                                      
         BAS   RE,PRIAFT                                                        
         GOTO1 DATCON,DMCB,(X'12',0(R2)),(5,NAMEAREA)                           
         B     GENOUT                                                           
         EJECT                                                                  
* ESTIMATE OUTPUT ROUTINE                                                       
*                                                                               
OEST     GOTO1 AOEST                                                            
         B     GENOUT                                                           
*                                                                               
OESTFLT  MVC   LABLAREA(11),=C'EST FILTERS'                                     
         MVC   CODEAREA(3),0(R2)                                                
         TM    GLDOWNLD,GLDLACTV   DOWNLOAD ACTIVE?                             
         BZ    OE10                NO                                           
         CLI   CODEAREA,C' '       IS THERE A C' ' FILTER?                      
         BNE   GENOUT              NOPE                                         
         MVI   CODEAREA,C'_'       YES, INDICATE IT FOR DRIVDOWN                
         B     GENOUT                                                           
*                                                                               
OE10     CLI   CODEAREA,C' '       MAKE SURE SQUASHER KEEPS BLANKS              
         BNE   *+8                                                              
         MVI   CODEAREA,1          (MAKE IT AN UNPRINTABLE CHARACTER)           
         CLI   CODEAREA+1,C' '                                                  
         BNE   *+8                                                              
         MVI   CODEAREA+1,1                                                     
         B     GENOUT                                                           
*                                                                               
ORTLSCH  MVC   LABLAREA(13),=C'RETAIL SCHEME'    RETAIL SCHEME CODE             
         MVC   CODEAREA(2),0(R2)                                                
         B     GENOUT                                                           
*                                                                               
OECREATE L     R1,GLADTENT         EST CREATE DATE                              
         LA    R1,DROLEN-DROD(R1)                                               
         LA    R4,CODEAREA                                                      
         MVI   BYTE,C'E'                                                        
         GOTO1 AFMTPER                                                          
         B     GENOUT                                                           
         EJECT                                                                  
* PRODUCT GROUP AND PRODUCT OUTPUT ROUTINES                                     
*                                                                               
OPGR1    CLC   0(2,R2),XFF                                                      
         BE    GENOUT                                                           
         MVC   SBBPGR,0(R2)                                                     
         MVC   CODEAREA(1),SBQPGRD                                              
         LLC   R1,2(R2)                                                         
         STC   R1,SBPGR1LN                                                      
         LA    R1,SBPGR1LN                                                      
         GOTO1 AOGRPCD                                                          
         MVC   SBPGR1BK,BLANKS                                                  
         GOTO1 GETPGRNM,SBPGR1NM                                                
         MVC   LABLAREA(L'SBPGR1BK),SBPGR1BK                                    
         CLI   GLARGS,C'C'                                                      
         BE    GENOUT                                                           
         CLC   NAMEAREA(L'UNKNOWN),UNKNOWN                                      
         BE    GENOUT                                                           
         MVC   NAMEAREA(L'SBPGR1NM),SBPGR1NM                                    
         B     GENOUT                                                           
         SPACE 2                                                                
OPGR2    CLC   0(2,R2),XFF                                                      
         BE    GENOUT                                                           
         MVC   SBBPGR,0(R2)                                                     
         MVC   CODEAREA(1),SBQPGRD                                              
         LLC   R1,2(R2)                                                         
         STC   R1,SBPGR2LN                                                      
         LA    R1,SBPGR2LN                                                      
         GOTO1 AOGRPCD                                                          
         MVC   SBPGR2BK,BLANKS                                                  
         GOTO1 GETPGRNM,SBPGR2NM                                                
         MVC   LABLAREA(L'SBPGR2BK),SBPGR2BK                                    
         CLI   GLARGS,C'C'                                                      
         BE    GENOUT                                                           
         CLC   NAMEAREA(L'UNKNOWN),UNKNOWN                                      
         BE    GENOUT                                                           
         MVC   NAMEAREA(L'SBPGR2NM),SBPGR2NM                                    
         B     GENOUT                                                           
         SPACE 2                                                                
OPRD     GOTO1 AOPRD                                                            
         B     GENOUT                                                           
         EJECT                                                                  
* MARKET GROUP AND MARKET OUTPUT ROUTINES                                       
*                                                                               
OMGR1    CLI   GLARGS,C'N'                                                      
         BNE   *+8                                                              
         LA    R2,8(R2)                                                         
         CLC   0(2,R2),XFF                                                      
         BE    GENOUT                                                           
         MVC   LABLAREA(L'SBMGR1BK),SBMGR1BK                                    
*         MVC   CODEAREA(1),SBQMGRD                                             
         BRAS  RE,MGRCODE                                                       
         LA    R1,SBMGR1LN                                                      
         GOTO1 AOGRPCD                                                          
         CLI   GLARGS,C'C'                                                      
         BE    GENOUT                                                           
         CLC   NAMEAREA(L'UNKNOWN),UNKNOWN                                      
         BE    GENOUT                                                           
         CLC   NAMEAREA(L'NETWORKS),NETWORKS                                    
         BE    GENOUT                                                           
         MVC   SBBMGR,0(R2)                                                     
         GOTO1 GETMGRNM,SBMGR1NM                                                
         MVC   NAMEAREA(L'SBMGR1NM),SBMGR1NM                                    
         B     GENOUT                                                           
         SPACE 2                                                                
OMGR2    CLI   GLARGS,C'N'                                                      
         BNE   *+8                                                              
         LA    R2,8(R2)                                                         
         CLC   0(2,R2),XFF                                                      
         BE    GENOUT                                                           
         MVC   LABLAREA(L'SBMGR2BK),SBMGR2BK                                    
*         MVC   CODEAREA(1),SBQMGRD                                             
         BRAS  RE,MGRCODE                                                       
         LA    R1,SBMGR2LN                                                      
         GOTO1 AOGRPCD                                                          
         CLI   GLARGS,C'C'                                                      
         BE    GENOUT                                                           
         CLC   NAMEAREA(L'UNKNOWN),UNKNOWN                                      
         BE    GENOUT                                                           
         CLC   NAMEAREA(L'NETWORKS),NETWORKS                                    
         BE    GENOUT                                                           
         MVC   SBBMGR,0(R2)                                                     
         GOTO1 GETMGRNM,SBMGR2NM                                                
         MVC   NAMEAREA(L'SBMGR2NM),SBMGR2NM                                    
         B     GENOUT                                                           
         SPACE 2                                                                
OMGR3    CLI   GLARGS,C'N'                                                      
         BNE   *+8                                                              
         LA    R2,8(R2)                                                         
         CLC   0(2,R2),XFF                                                      
         BE    GENOUT                                                           
         MVC   LABLAREA(L'SBMGR3BK),SBMGR3BK                                    
*         MVC   CODEAREA(1),SBQMGRD                                             
         BRAS  RE,MGRCODE                                                       
         LA    R1,SBMGR3LN                                                      
         GOTO1 AOGRPCD                                                          
         CLI   GLARGS,C'C'                                                      
         BE    GENOUT                                                           
         CLC   NAMEAREA(L'UNKNOWN),UNKNOWN                                      
         BE    GENOUT                                                           
         CLC   NAMEAREA(L'NETWORKS),NETWORKS                                    
         BE    GENOUT                                                           
         MVC   SBBMGR,0(R2)                                                     
         GOTO1 GETMGRNM,SBMGR3NM                                                
         MVC   NAMEAREA(L'SBMGR3NM),SBMGR3NM                                    
         B     GENOUT                                                           
         SPACE 2                                                                
OMKTR    LA    R2,2(R2)            ** MARKET IN RANK ORDER **                   
*                                                                               
OMKT     DS   0H                                                                
         CLI   GLARGS+1,C'X'       XFILE MKT KEYWORD?                           
         BE    OMKT10               YES                                         
         GOTO1 AOMKT               ** MARKET **                                 
         BNE   XIT                                                              
         B     GENOUT                                                           
OMKT10   MVC   NAMEAREA(L'SBMKTNM),0(R2)                                        
         B     GENOUT                                                           
         SPACE 2                                                                
OMKTRNK  GOTO1 AOMKTRNK            ** MARKET RANK **                            
         BNE   XIT                                                              
         B     GENOUT                                                           
         EJECT                                                                  
* DAYPART OUTPUT ROUTINE                                                        
*                                                                               
ODPT     CLI   1(R2),C''          SUPPRESS $ DAYPARTS (FIRST CHAR OF           
         BE    DP99                                     NAME IS C'')           
         CLI   5(R2),C''                                                       
         BE    DP99                                                             
         MVC   LABLAREA(7),=C'DAYPART'                                          
         LA    R3,CODEAREA                                                      
         OI    OUTIND,OUTIDTOT                                                  
         MVC   0(7,R3),BLANKS                                                   
         LTR   R2,R2               MAKE SURE R2 IS SET                          
         BZ    *+14                                                             
         OC    0(8,R2),0(R2)                                                    
         BNZ   *+14                                                             
         MVC   0(7,R3),UNKNOWN+2                                                
         B     DPX                                                              
         CLC   4(4,R2),XFF         DAYPART GROUP TOTAL                          
         BNE   DP10                                                             
         CP    DPTCNTR,=P'1'       TEST FOR MORE THAN ONE DPT IN GRP            
         BNH   DP99                                                             
         MVC   0(3,R3),1(R2)                                                    
         MVI   3(R3),C'-'                                                       
         MVC   4(3,R3),=C'TOT'                                                  
         B     DPX                                                              
*                                                                               
DP10     NI    OUTIND,FF-OUTIDTOT  NOT DAYPART TOTAL                            
         OC    1(3,R2),1(R2)                                                    
         BZ    DP90                                                             
         CLC   DPTGRPSV,1(R2)      TEST FOR NEW DAYPART GROUP                   
         BE    DP90                                                             
         ZAP   DPTCNTR,=P'0'       RESET DPT COUNTER                            
         MVC   DPTGRPSV,1(R2)                                                   
*                                                                               
DP90     MVC   0(3,R3),5(R2)                                                    
         CP    DPTCNTR,=P'2'       AUGMENT DAYPART COUNTER                      
         BNL   *+10                                                             
         AP    DPTCNTR,=P'1'                                                    
         B     DPX                                                              
*                                                                               
DP99     MVI   PRTSW,C'N'          DON'T PRINT                                  
         B     XIT                                                              
*                                                                               
DPX      L     R3,GLAOFLD                                                       
         B     GENOUT                                                           
         SPACE 2                                                                
* DAYPART/LENGTH OUTPUT                                                         
*                                                                               
ODPTLEN  DS    0H                                                               
         GOTO1 AODPTLEN                                                         
         B     XIT                                                              
         SPACE 2                                                                
* SPOT LENGTH OUTPUT ROUTINE                                                    
*                                                                               
OLEN     MVC   LABLAREA(6),=C'LENGTH'                                           
         CLI   0(R2),0                                                          
         BNE   *+14                                                             
         MVC   CODEAREA(3),=C'???'                                              
         B     GENOUT                                                           
         CLI   0(R2),X'FF'                                                      
         BE    GENOUT                                                           
         EDIT  (1,0(R2)),(3,CODEAREA),ALIGN=LEFT                                
         B     GENOUT                                                           
         EJECT                                                                  
* PERIOD ROW OUTPUT ROUTINES                                                    
*                                                                               
OPER     MVC   BYTE,GLARGS         DAY/MONTH/QUARTER/YEAR                       
         MVC   LABLAREA(3),=C'DAY'                                              
         CLI   GLARGS,C'D'                                                      
         BE    OPER2                                                            
         MVC   LABLAREA(4),=C'YEAR'                                             
         CLI   GLARGS,C'Y'                                                      
         BE    OPER2                                                            
         MVC   LABLAREA(5),=C'MONTH'                                            
         CLI   GLARGS,C'M'                                                      
         BE    OPER2                                                            
         MVC   LABLAREA(7),=C'QUARTER'                                          
         CLI   GLARGS,C'Q'                                                      
         BE    OPER2                                                            
         DC    H'0'                                                             
OPER2    LA    R4,CODEAREA                                                      
         BAS   RE,PRIAFT                                                        
         BNE   OPERX                                                            
         L     R1,GLADTENT                                                      
         LA    R1,DROLEN-DROD(R1)                                               
         GOTO1 AFMTPER                                                          
OPERX    B     GENOUT                                                           
*                                                                               
ORUNDATE MVC   LABLAREA(8),=C'RUN DATE'                                         
         LA    R4,NAMEAREA                                                      
         BAS   RE,PRIAFT                                                        
         BNE   GENOUT                                                           
         ST    R4,DMCB+4                                                        
         MVI   DMCB+4,10           MM/DD/YY DEFAULT                             
*                                                                               
         TM    OPTIND2,OPTIYMD                                                  
         BZ    ORUND10                                                          
         MVI   DMCB+4,X'20'        YYMMDD - NOT FUNNY                           
         B     ORUND40                                                          
*                                                                               
ORUND10  TM    OPTIND5,OPTRFPDT                                                 
         BNZ   *+12                                                             
         TM    OPTIND3,OPTICYMD    TEST CCYYMMDD FORMAT                         
         BZ    ORUND20                                                          
         MVI   DMCB+4,20           YYYYMMDD                                     
         B     ORUND40                                                          
*                                                                               
ORUND20  TM    OPTIND5,OPTISO                                                   
         BZ    ORUND30                                                          
         MVI   DMCB+4,23           YYYY-MM-DD  ISO 8601                         
         B     ORUND40                                                          
*                                                                               
ORUND30  TM    OPTIND6,OPT6MDY                                                  
         BZ    ORUND40                                                          
         MVI   DMCB+4,13           MMMDD/YY                                     
*                                                                               
ORUND40  GOTO1 DATCON,DMCB,(2,(R2))                                             
         B     GENOUT                                                           
*                                                                               
OWEEK    MVC   LABLAREA(4),=C'WEEK'                                             
         LA    R4,NAMEAREA                                                      
         BAS   RE,PRIAFT                                                        
         BNE   GENOUT                                                           
         ST    R4,DMCB+4                                                        
*                                                                               
         CLI   GLARGS,C'Y'         TEST YYMMDD FORMAT                           
         BE    *+12                                                             
         TM    OPTIND2,OPTIYMD                                                  
         BZ    OWEEK10                                                          
         MVI   DMCB+4,X'20'        YYMMDD - NOT FUNNY                           
         B     OWEEK40                                                          
*                                                                               
OWEEK10  TM    OPTIND5,OPTRFPDT                                                 
         BNZ   *+12                                                             
         TM    OPTIND3,OPTICYMD    TEST CCYYMMDD FORMAT                         
         BZ    OWEEK12                                                          
         MVI   DMCB+4,20           YYYYMMDD                                     
         B     OWEEK40                                                          
*                                                                               
OWEEK12  TM    OPTIND5,OPTISO                                                   
         BZ    OWEEK20                                                          
         MVI   DMCB+4,23           YYYY-MM-DD  ISO 8601                         
         B     OWEEK40                                                          
*                                                                               
OWEEK20  TM    DOWNOPT,GLDLACTV                                                 
         BZ    OWEEK22                                                          
         MVI   DMCB+4,10           MM/DD/YY                                     
         B     OWEEK40                                                          
*                                                                               
OWEEK22  TM    OPTIND6,OPT6MDY                                                  
         BZ    OWEEK30                                                          
         MVI   DMCB+4,13           MMMDD/YY                                     
         B     OWEEK40                                                          
*                                                                               
OWEEK30  MVI   DMCB+4,7            MMMDD-MMMDD                                  
         GOTO1 DATCON,DMCB,(X'12',(R2))                                         
         B     GENOUT                                                           
*                                                                               
OWEEK40  GOTO1 DATCON,DMCB,(2,(R2))                                             
         B     GENOUT                                                           
*                                                                               
*                                                                               
OFLT     MVC   LABLAREA(6),=C'FLIGHT'     CHILD SPOT FLIGHT                     
         OC    0(4,R2),0(R2)                                                    
         BZ    GENOUT                                                           
         GOTO1 DATCON,DMCB,(X'12',(R2)),(5,NAMEAREA)                            
         B     GENOUT                                                           
*                                                                               
ODAY     MVC   LABLAREA(3),=C'DAY'     DAY                                      
         LA    R4,NAMEAREA                                                      
         BAS   RE,PRIAFT                                                        
         BNE   GENOUT                                                           
         GOTO1 DATCON,DMCB,(2,(R2)),DUB                                         
         GOTO1 GETDAY,(R1),DUB,(R4)                                             
         CLC   0(3,R4),BLANKS                                                   
         BNE   *+6                                                              
         DC    H'0'                                                             
         MVI   3(R4),C' '                                                       
         GOTO1 DATCON,(R1),DUB,(4,4(R4))                                        
         B     GENOUT                                                           
*                                                                               
PRIAFT   LR    R0,RE                                                            
         NI    OPTIND2,255-OPTITITL   PERIOD DOES NOT GO TO TITLE               
         CLC   0(4,R2),=F'1'                                                    
         BE    *+14                                                             
         OC    0(4,R2),0(R2)                                                    
         BNZ   *+14                                                             
         MVC   0(6,R4),=C'*PRIOR'                                               
         B     PRIAFTN                                                          
         CLC   0(4,R2),XFE                                                      
         BNE   *+14                                                             
         MVC   0(6,R4),=C'*AFTER'                                               
         B     PRIAFTN                                                          
         CLC   0(4,R2),XFF                                                      
         BNE   *+14                                                             
         MVC   0(5,R4),=C'*ALL*'                                                
         B     PRIAFTN                                                          
         CLC   0(4,R2),XFD                                                      
         BNE   PRIAFTY                                                          
         MVC   0(6,R4),=C'*????*'                                               
PRIAFTN  LTR   RE,R0               CC NE - DO NOT FORMAT DATES                  
         BR    RE                                                               
PRIAFTY  LA    R1,GLARGS                                                        
         TM    GLOIND-GLARGSD(R1),GLOITITL  TEST PERIOD SHOULD GO TO            
         BZ    *+14                         THE REPORT TITLE                    
         OI    OPTIND2,OPTITITL             YES-INDICATE IT'S SO                
         MVC   SBBQSTP(4),0(R2)                 AND SAVE THE DATES              
         LR    RE,R0                                                            
         CR    RE,RE               CC EQ - FORMAT DATES                         
         BR    RE                                                               
         EJECT                                                                  
* OUTPUT ROUTINES FOR BUY DETAILS                                               
*                                                                               
OBUY     GOTO1 AOBUY                                                            
         B     XIT                                                              
         SPACE 2                                                                
OLINE    MVC   0(3,R3),=C'???'                                                  
         XR    RE,RE                                                            
         LHI   RF,13-1                                                          
         ICM   RE,3,BUYKBUY-BUYKEY(R2)                                          
         CLI   GLARGS,C'M'         SPECIAL BUYLINE NUMBER?                      
         BNE   OLINE10                                                          
         LHI   RF,0                                                             
         ICM   RE,3,0(R2)                                                       
*                                                                               
OLINE10  EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R2),XFE         BUYLINE NUMBER                               
         BE    XIT                                                              
         CVD   RE,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(3,R3),DUB         ** REPORT 3 CHARS FOR NOW **                 
         B     XIT                                                              
         SPACE 2                                                                
OPROG    MVC   LABLAREA(7),=C'PROGRAM'  PROGRAM NAME                            
         MVC   NAMEAREA(17),0(R2)                                               
         B     GENOUT                                                           
         SPACE 2                                                                
OROT     MVC   LABLAREA(8),=C'ROTATION'   DAYS ROTATION                         
         CLI   1(R2),0                                                          
         BNE   *+14                                                             
         MVC   NAMEAREA(7),UNKNOWN+2                                            
         B     GENOUT                                                           
*                                                                               
         GOTO1 DAYUNPK,DMCB,(0(R2),1(R2)),(0,NAMEAREA)                          
*                                                                               
***      LA    R5,1(R2)                                                         
***      GOTO1 DAYUNPK,DMCB,(R5),NAMEAREA                                       
         B     GENOUT                                                           
         SPACE 2                                                                
OTIMES   MVC   LABLAREA(5),=C'TIMES'    TIMES                                   
         CLC   0(4,R2),XFE                                                      
         BNE   *+14                                                             
         MVC   NAMEAREA(7),UNKNOWN+2                                            
         B     GENOUT                                                           
         CLI   0(R2),C'M'          MIDNIGHT?                                    
         BNE   *+10                                                             
         XC    0(4,R2),0(R2)                                                    
         XR    R0,R0                                                            
         ICM   R0,3,0(R2)          START TIME                                   
         CHI   R0,2400             GREATER THAN 2400?                           
         BNH   OTIMES1             NO                                           
         SHI   R0,2400             YES - SUBTRACT 2400 HOURS                    
         STCM  R0,3,0(R2)                                                       
         ICM   R0,3,2(R2)          END TIME                                     
         CHI   R0,2400             GREATER THAN 2400?                           
         BNH   OTIMES1             NO                                           
         SHI   R0,2400             YES - SUBTRACT 2400 HOURS                    
         STCM  R0,3,2(R2)                                                       
*                                                                               
OTIMES1  CLI   GLARGS,C'M'         MILITARY TIME OPTION                         
         BNE   OTIMES2                                                          
         SR    RE,RE                                                            
         ICM   RE,3,0(R2)                                                       
         CVD   RE,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  NAMEAREA(4),DUB                                                  
         MVI   NAMEAREA+4,C'-'                                                  
         MVC   NAMEAREA+5(4),NAMEAREA                                           
         ICM   RE,3,2(R2)                                                       
         BZ    GENOUT                                                           
         CVD   RE,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  NAMEAREA+5(4),DUB                                                
         B     GENOUT                                                           
OTIMES2  DS    0H                                                               
         GOTO1 UNTIME,DMCB,(R2),NAMEAREA                                        
         B     GENOUT                                                           
         SPACE 2                                                                
OBYID    MVC   LABLAREA(6),=C'BUY ID'   BUY ID                                  
         CLC   SBCIDTIT,BLANKS                                                  
         BNH   *+10                                                             
         MVC   LABLAREA(10),SBCIDTIT                                            
         MVC   NAMEAREA(12),0(R2)                                               
*&&DO                                                                           
         CLI   GLARGS,C'M'         BYIDMG KEYWORD?                              
         BNE   OBYIDX                                                           
         CLC   0(12,R2),BLANKS     ANY INPUT?                                   
         BH    OBYIDX               YES                                         
         MVI   PRTSW,C'N'           NO - SKIP THIS LINE                         
*&&                                                                             
*                                                                               
OBYIDX   B     GENOUT                                                           
         SPACE 2                                                                
OBYTYPE  MVC   LABLAREA(8),=C'BUY TYPE' BUY TYPE                                
         MVC   NAMEAREA(4),=C'CASH'                                             
         CLI   0(R2),C'C'                                                       
         BE    GENOUT                                                           
         MVC   NAMEAREA(5),=C'TRADE'                                            
         CLI   0(R2),C'T'                                                       
         BE    GENOUT                                                           
         MVC   NAMEAREA(5),=C'*ALL*'                                            
         CLI   0(R2),X'FF'                                                      
         BE    GENOUT                                                           
         MVC   NAMEAREA(L'UNKNOWN),UNKNOWN                                      
         B     GENOUT                                                           
         SPACE 2                                                                
OADJ     MVC   LABLAREA(14),=C'ADJACENCY CODE'                                  
         CLI   SBCPROF+9,C'0'                                                   
         BE    GENOUT                                                           
         CLI   SBCPROF+9,C'1'      TEST ALPHA REQ'D                             
         BNE   *+14                 NO                                          
         MVC   CODEAREA(1),0(R2)                                                
         B     GENOUT                                                           
*                                                                               
         SR    R0,R0                                                            
         IC    R0,0(R2)                                                         
         SRDL  R0,4                                                             
         STC   R0,CODEAREA                                                      
         OI    CODEAREA,X'F0'                                                   
         SRL   R1,28                                                            
         STC   R1,CODEAREA+1                                                    
         OI    CODEAREA+1,X'F0'                                                 
         B     GENOUT                                                           
         SPACE 2                                                                
OPREP    MVC   LABLAREA(10),=C'PAYING REP'                                      
         B     OREP                                                             
*                                                                               
OTREP    MVC   LABLAREA(14),=C'TIME SHEET REP'                                  
         B     OREP                                                             
*                                                                               
OSREP    MVC   LABLAREA(11),=C'SPECIAL REP'                                     
*                                                                               
OREP     CLI   GLARGS,C'N'                                                      
         BNE   *+14                                                             
         MVC   NAMEAREA(22),0(R2)                                               
         B     GENOUT                                                           
         MVC   SBREP,0(R2)                                                      
         CLC   SBREP,ZEROS         TEST REP=000                                 
         BE    *+10                YES-LEAVE OUTPUT BLANK                       
         MVC   CODEAREA(3),SBREP                                                
         CLI   GLARGS,C'C'                                                      
         BE    GENOUT                                                           
         CLC   SVREP,SBREP                                                      
         BE    OREP2                                                            
         MVC   SVREP,SBREP                                                      
         MVC   SBREPNM,BLANKS                                                   
         CLC   SBREP,ZEROS                                                      
         BE    GENOUT                                                           
         GOTO1 GETREPNM                                                         
         BE    OREP2                                                            
         GOTO1 AGETREP                                                          
         GOTO1 PUTREPNM                                                         
OREP2    MVC   NAMEAREA(22),SBREPNM                                             
         B     GENOUT                                                           
         SPACE 2                                                                
ONAMES   MVC   NAMEAREA(12),0(R2)                                               
         CLI   GLARGS,1                                                         
         BNE   ONAMES10                                                         
         MVC   SBBYRNM,0(R2)            BUYER NAME                              
         MVC   LABLAREA(5),=C'BUYER'                                            
         B     GENOUT                                                           
*                                                                               
ONAMES10 MVC   SBBLRNM,0(R2)            BILLER NAME                             
         MVC   LABLAREA(6),=C'BILLER'                                           
         B     GENOUT                                                           
         EJECT                                                                  
* PRODUCT INTERFACE CODE I/O ROUTINES                                           
*                                                                               
IPRDINT  MVC   0(4,R2),SBPRDINT                                                 
         B     XIT                                                              
*                                                                               
OPRDINT  MVC   LABLAREA(14),=C'INTERFACE CODE'                                  
         MVC   CODEAREA(4),0(R2)                                                
         B     GENOUT                                                           
         EJECT                                                                  
* HEADLINE ROUTINES                                                             
*                                                                               
         SPACE 1                                                                
HAR      MVI   GLARGS+15,1         AVERAGE RATING                               
         GOTO1 AHDEM2                                                           
         LA    R3,198(R3)                                                       
         MVI   GLARGS+15,2                                                      
         GOTO1 AHDEM2                                                           
         LA    R3,198(R3)                                                       
         MVC   0(7,R3),=C'AVERAGE'                                              
         B     XIT                                                              
*                                                                               
HDEM     DS    0H                  DEMO                                         
         CLI   GLARGS+15,0                                                      
         BE    HDEM1                                                            
         GOTO1 AHDEM2                                                           
         B     XIT                                                              
HDEM1    LA    R0,4                                                             
         LA    R1,1                                                             
HDEM1A   STC   R1,GLARGS+15                                                     
         GOTO1 AHDEM2                                                           
         LA    R1,1(R1)                                                         
         LA    R3,198(R3)                                                       
         BCT   R0,HDEM1A                                                        
         B     XIT                                                              
*                                                                               
HSTBDEM  MVI   GLARGS+15,1         BUY DEMO STACK                               
         GOTO1 AHDEMH12                                                         
         LA    R3,198(R3)                                                       
         MVI   GLARGS+15,2                                                      
         GOTO1 AHDEMH12                                                         
         B     XIT                                                              
*                                                                               
HDCPP    DS    0H                  CHILD SPOT DELIVERED CPP                     
         L     R1,GLADTENT                                                      
         LLC   RF,DRHDWDTH-DRHDD(R1)                                            
         CHI   RF,9                                                             
         BNH   *+8                                                              
         LA    RF,9                                                             
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),=C'DELIVERED'                                            
         LA    R3,198(R3)                                                       
         B     HCPP02                                                           
*                                                                               
HCPP     DS    0H                  COST PER POINT                               
         CLI   GLARGS+15,0                                                      
         BE    HCPP02                                                           
         GOTO1 AHCPP2                                                           
         B     XIT                                                              
HCPP02   LA    R0,4                                                             
         LA    R1,1                                                             
HCPP02A  STC   R1,GLARGS+15                                                     
         GOTO1 AHCPP2                                                           
         LA    R1,1(R1)                                                         
         LA    R3,198(R3)                                                       
         BCT   R0,HCPP02A                                                       
         B     XIT                                                              
*                                                                               
*                                  ** DEMO STACK HEADER ROUTINE **              
HSTDEM   MVC   0(7,R3),BLANKS                                                   
         GOTO1 AGETDEM,DEMONAME                                                 
         BNE   XIT                                                              
         MVC   0(7,R3),DEMONAME                                                 
         B     XIT                                                              
*                                                                               
         EJECT                                                                  
*                                  DEMO INDEX                                   
HDEMNDX  CLI   GLARGS+15,0                                                      
         BE    *+12                                                             
         BAS   RE,HDEMNDX2                                                      
         B     XIT                                                              
         LA    R1,1                                                             
         LA    RF,3                                                             
         STC   R1,GLARGS+15                                                     
         BAS   RE,HDEMNDX2                                                      
         LA    R1,1(R1)                                                         
         LA    R3,198(R3)                                                       
         BCT   RF,*-16                                                          
         B     XIT                                                              
*                                                                               
HDEMNDX2 LR    R0,RE                                                            
         CLI   GLARGS+15,1         HEAD1                                        
         BNE   HDEMNDX4                                                         
         MVC   0(7,R3),BLANKS                                                   
         GOTO1 AGETDEM,DEMONAME                                                 
         BNE   HDEMNDXX                                                         
         MVC   0(7,R3),DEMONAME                                                 
         B     HDEMNDXX                                                         
HDEMNDX4 BAS   RE,HINDEX           HEAD2                                        
HDEMNDXX LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
*                                  DOLLAR INDEX                                 
HDOLNDX  CLI   GLARGS+15,0                                                      
         BE    *+12                                                             
         BAS   RE,HDOLNDX2                                                      
         B     XIT                                                              
         LA    R1,1                                                             
         LA    RF,3                                                             
         STC   R1,GLARGS+15                                                     
         BAS   RE,HDOLNDX2                                                      
         LA    R1,1(R1)                                                         
         LA    R3,198(R3)                                                       
         BCT   RF,*-16                                                          
         B     XIT                                                              
*                                                                               
HDOLNDX2 LR    R0,RE                                                            
         CLI   GLARGS+15,1         HEAD1                                        
         BNE   *+14                                                             
         MVC   0(4,R3),=C'COST'                                                 
         B     *+8                                                              
         BAS   RE,HINDEX                                                        
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
HINDEX   CLI   GLARGS+15,2         HEAD2                                        
         BNE   *+12                                                             
         MVC   0(7,R3),=C'INDEX V'                                              
         BR    RE                                                               
         CLI   GLARGS+15,3         HEAD3                                        
         BE    *+6                                                              
         DC    H'0'                                                             
         TM    SBQDATA,SBQDGOAL                                                 
         BZ    *+12                                                             
         MVC   0(4,R3),=C'GOAL'                                                 
         BR    RE                                                               
         TM    SBQDATA,SBQDORD                                                  
         BZ    *+12                                                             
         MVC   0(7,R3),=C'ORDERED'                                              
         BR    RE                                                               
         TM    SBQDATA,SBQDPUR                                                  
         BZ    *+12                                                             
         MVC   0(5,R3),=C'PURCH'                                                
         BR    RE                                                               
         DC    H'0'                                                             
         EJECT                                                                  
* FORMAT PERIOD HEADLINE                                                        
*                                                                               
HPER     ICM   R2,15,GLARGS        TEST ANY DATES                               
         BZ    XIT                                                              
         LR    R4,R3                                                            
         STCM  R2,8,BYTE           BYTE=PERIOD TYPE D/W/M/Q/H/Y                 
         L     R1,GLADTENT                                                      
         LA    R1,DRHDWDTH-DRHDD(R1)                                            
         GOTO1 AFMTPER                                                          
         B     XIT                                                              
         SPACE 2                                                                
* FORMAT BUY DETAILS HEADLINE                                                   
*                                                                               
HBUY     CLI   GLARGS+15,0                                                      
         BE    *+12                                                             
         BAS   RE,HBUY2                                                         
         B     XIT                                                              
         LA    R0,3                                                             
         LA    R1,1                                                             
         STC   R1,GLARGS+15                                                     
         BAS   RE,HBUY2                                                         
         LA    R1,1(R1)                                                         
         LA    R3,198(R3)                                                       
         BCT   R0,*-16                                                          
         B     XIT                                                              
*                                                                               
HBUY2    L     R2,GLADTENT         CLEAR HEADLINE                               
         LLC   RF,DRHDWDTH-DRHDD(R2)                                            
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         XC    0(0,R3),0(R3)                                                    
         CLI   GLARGS+15,1         ARGS+15=HEADLINE NUMBER                      
         BNE   HBUY2A                                                           
         MVC   0(33,R3),=C'EST-LIN  BUY PERIOD  WKS  DPT LNG'                   
         CLI   GLARGS,C'C'                                                      
         BNE   *+10                                                             
         MVC   34(4,R3),=C'COST'                                                
         CLI   GLARGS,C'N'                                                      
         BNE   HBUY2X                                                           
         MVC   34(8,R3),=C'NET COST'                                            
         B     HBUY2X                                                           
*                                                                               
HBUY2A   CLI   GLARGS+15,2                                                      
         BNE   HBUY2B                                                           
         MVI   0(R3),C'-'                                                       
         MVC   1(32,R3),0(R3)                                                   
         CLI   GLARGS,C'C'                                                      
         BNE   HBUY2X                                                           
         MVC   33(10,R3),0(R3)                                                  
         B     HBUY2X                                                           
*                                                                               
HBUY2B   CLI   GLARGS+15,3                                                      
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   3(3,R3),=C'DAY'                                                  
         MVC   12(4,R3),=C'TIME'                                                
         MVC   26(7,R3),=C'PROGRAM'                                             
*                                                                               
HBUY2X   BR    RE                                                               
         SPACE 2                                                                
* FORMAT BUY ID HEADLINE                                                        
*                                                                               
HBYID    MVC   0(6,R3),=C'BUY ID'                                               
         CLC   SBCIDTIT,BLANKS                                                  
         BNH   XIT                                                              
         MVC   0(10,R3),SBCIDTIT                                                
         B     XIT                                                              
         SPACE 2                                                                
* NETWORK/STATION HEADLINE                                                      
*                                                                               
HNETSTA  MVC   0(9,R3),=C' NETWORK '                                            
         CLI   SBQNETWK,C'N'                                                    
         BE    XIT                                                              
         MVC   1(7,R3),=C'STATION'                                              
         CLI   SBQNETWK,C'L'                                                    
         BE    XIT                                                              
         MVC   0(9,R3),=C'NETWK/STA'                                            
         B     XIT                                                              
         SPACE 2                                                                
* COMMERCIAL HEADLINE                                                           
*                                                                               
HCML     MVC   0(4,R3),=C'FILM'                                                 
         CLI   SBMED,C'R'                                                       
         BNE   XIT                                                              
         MVC   0(8,R3),=C'COMMERCL'                                             
         CLI   GLARGS,C'C'                                                      
         BE    XIT                                                              
         MVC   0(10,R3),=C'COMMERCIAL'                                          
         B     XIT                                                              
         EJECT                                                                  
* GROUP HEADLINES                                                               
*                                                                               
HCGR1    MVC   0(L'SBCGR1BK,R3),SBCGR1BK                                        
         B     XIT                                                              
*                                                                               
HCGR2    MVC   0(L'SBCGR2BK,R3),SBCGR2BK                                        
         B     XIT                                                              
*                                                                               
HPGR1    MVC   0(L'SBPGR1BK,R3),SBPGR1BK                                        
         B     XIT                                                              
*                                                                               
HPGR2    MVC   0(L'SBPGR2BK,R3),SBPGR2BK                                        
         B     XIT                                                              
*                                                                               
HMGR1    MVC   0(L'SBMGR1BK,R3),SBMGR1BK                                        
         B     XIT                                                              
*                                                                               
HMGR2    MVC   0(L'SBMGR2BK,R3),SBMGR2BK                                        
         B     XIT                                                              
*                                                                               
HMGR3    MVC   0(L'SBMGR3BK,R3),SBMGR3BK                                        
         B     XIT                                                              
*                                                                               
HSGR1    MVC   0(L'SBSGR1BK,R3),SBSGR1BK                                        
         B     XIT                                                              
*                                                                               
HSGR2    MVC   0(L'SBSGR2BK,R3),SBSGR2BK                                        
         B     XIT                                                              
         EJECT                                                                  
* GENERAL TOTAL ROUTINE FOR DETAIL ROWS                                         
*                                                                               
TOTAL    LLC   RF,GLARGS                                                        
         LA    RF,ROWWIDS-1(RF)    RF=L'SPACE FOR TOTAL                         
         CLI   0(RF),5             AT LEAST 5                                   
         BL    TOTAL9                                                           
         OC    COUNT,COUNT         TEST FOR COUNT                               
         BZ    TOTAL2                                                           
         MVI   PARAS,C'('                                                       
         EDIT  (2,COUNT),(8,PARAS+1),ALIGN=LEFT                                 
         LR    R1,R0                                                            
         LA    RE,PARAS+1(R1)                                                   
         MVI   0(RE),C')'                                                       
         LA    R1,2(R1)                                                         
         STC   R1,BYTE                                                          
         CLC   BYTE,0(RF)          BYTE=L'COUNT                                 
         BNH   TOTAL2                                                           
         XC    COUNT,COUNT         IF NO ROOM, DON'T PRINT                      
*                                                                               
TOTAL2   SR    R4,R4               TEST MARKET WEIGHTING                        
         BAS   RE,TESTWGT                                                       
         BNE   *+12                                                             
         CLI   0(RF),7             YES-AT LEAST SPACE FOR 7 CHARS               
         BNL   *+14                                                             
         OC    COUNT,COUNT                                                      
         BZ    TOTAL9                                                           
         LLC   R6,0(RF)            R6=L'AVAILABLE SPACE                         
         LLC   RE,ROWWIDTH         ADJUST R3=A(ROW TO RIGHT OF                  
         CLI   GLARGS,1                        TOTALING ROW)                    
         BNH   *+10                                                             
         BCTR  RF,0                                                             
         IC    RE,0(RF)                                                         
         SR    RE,R6                                                            
         LA    R3,0(RE,R3)                                                      
         MVC   BLOCK(80),BLANKS                                                 
         MVC   BLOCK(5),=C'*ALL*'                                               
         OC    COUNT,COUNT         FORMAT COUNT                                 
         BZ    TOTAL4                                                           
         LLC   RE,BYTE                                                          
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   BLOCK+26(0),PARAS                                                
*                                                                               
TOTAL4   LTR   R4,R4               FORMAT WEIGHT                                
         BZ    TOTAL6                                                           
         GOTO1 AFMTWGT,BLOCK+6                                                  
         BE    TOTAL6                                                           
         OC    COUNT,COUNT                                                      
         BZ    TOTAL9                                                           
*                                                                               
TOTAL6   GOTO1 SQUASHER,DMCB,BLOCK,80                                           
         LA    R4,4                                                             
         GOTO1 CHOPPER,(R1),(80,BLOCK),((R6),0(R3)),(198,(R4))                  
         B     XIT                                                              
*                                                                               
TOTAL9   MVI   GLHOOK,GLEDIT       LET DRIVER DO IT                             
         B     XIT                                                              
         EJECT                                                                  
* MARKET RANK TOTAL ROUTINE                                                     
*                                                                               
TMKTRNK  GOTO1 ATMKTRNK                                                         
         B     XIT                                                              
         EJECT                                                                  
* SHARED OUTPUT ROUTINE                                                         
* LABLAREA HAS PREFIX                                                           
* CODEAREA HAS CODE                                                             
* NAMEAREA HAS NAME                                                             
*                                                                               
GENOUT   TM    GLINDS,X'40'        TEST TOTALS ROUTINE                          
         BO    TOTOUT              YES                                          
         CLI   MYLTYP,C'H'         FOR HEADLINES, MOVE OUT THE LOT              
         BNE   GENOUT2                                                          
         TM    DOWNOPT,GLDLACTV+GLDLHEAD   EXCEPT IF DOWNLOADING HEADS          
         BO    GENOUT2                                                          
         TM    GLINDS,GLTOTLIN     THIS A TOTAL LINE?                           
         BZ    GENOUT1                                                          
         L     RE,GLADTENT                                                      
         CLC   GLLEVEL,DROLEV-DROD(RE)                                          
         BL    GENOUTX                                                          
GENOUT1  DS    0H                                                               
         MVC   0(L'OUTAREA,R3),OUTAREA                                          
         B     GENOUTX                                                          
*                                                                               
GENOUT2  OC    CODENNAM,BLANKS                                                  
         GOTO1 SQUASHER,DMCB,CODENNAM,49                                        
         TM    OPTIND2,OPTITRUN    TEST TRUNCATE OPTION                         
         BZ    GENOUT4                                                          
         LLC   RE,MYOLEN           YES-MOVE FOR LENGTH OF ROW                   
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     GENOUTX                                                          
         MVC   0(0,R3),CODENNAM                                                 
*                                                                               
GENOUT4  LA    R1,CODENNAM         SET UP FOR CHOPPER                           
         ST    R1,DMCB             A(INPUT)                                     
         MVI   DMCB,49             L'INPUT                                      
         ST    R3,DMCB+4           A(OUTPUT)                                    
         MVC   DMCB+4(1),MYOLEN    LENGTH OF OUTPUT                             
         LA    R1,4                MAX N'LINES                                  
         ST    R1,DMCB+8                                                        
***      MVI   DMCB+8,C'P'         SET P3 BYTE 1 TO C'P'                        
***      CLI   WIDTHOPT,C'W'       UNLESS ITS WIDE                              
***      BNE   *+8                                                              
         MVI   DMCB+8,198          WHEN PRINT LINES ARE 198 APART               
         GOTO1 CHOPPER,DMCB                                                     
***                                                                             
* HANDLE ACOM RECORD                                                            
***                                                                             
GENOUTX  TM    DTAIND11,DIACOM     WANT ACOM RECORD?                            
         BZ    XIT                 NO                                           
         TM    GLINDS4,GLHEADHK    HOOK COMES FROM DRIVHEAD?                    
         BZ    XIT                 NO                                           
         L     RE,GLADTENT                                                      
         USING DROD,RE                                                          
         CLC   ACOMLEV,DROLEV      IS THIS THE RIGHT LEVEL?                     
         BNE   XIT                 NO                                           
         CLC   LASTFLD,CODEAREA    PROCESSED ACOM FOR THIS ALREADY?             
         BE    XIT                 YES                                          
         MVC   LASTFLD,CODEAREA    NO - SET THIS AS LAST PROCESSED!             
         DROP  RE                                                               
*                                                                               
         GOTO1 GETACOM             HAVE CLIENT OR AGENCY LEVEL ACOM?            
         BNE   XIT                 NO                                           
*                                                                               
         MVC   GLAXTRAH,ACOMREC    STORE A(ACOM REC) IN GLAXTRAH                
         B     XIT                                                              
         EJECT                                                                  
* SHARED TOTAL ROUTINE                                                          
*                                                                               
TOTOUT   MVC   BLOCK(80),BLANKS                                                 
         LLC   R6,ROW1WIDE                                                      
         CLC   LABLAREA,BLANKS                                                  
         BNH   TOTOUT2                                                          
         CLI   ROWWIDTH,7                                                       
         BL    TOTOUT2                                                          
         LA    RF,L'LABLAREA                                                    
         LA    R1,LABLAREA+L'LABLAREA-1                                         
         CLI   0(R1),C' '                                                       
         BH    *+10                                                             
         BCTR  R1,0                                                             
         BCT   RF,*-10                                                          
         LA    RF,1(RF)                                                         
         CR    RF,R6                                                            
         BNH   TOTOUT4                                                          
         LLC   R6,ROWWIDTH                                                      
         CR    RF,R6                                                            
         BNH   TOTOUT4                                                          
*                                                                               
TOTOUT2  CHI   R6,3                                                             
         BL    TOTOUTX                                                          
         MVC   BLOCK(3),=C'ALL'                                                 
         LA    R1,BLOCK+4                                                       
         CHI   R6,5                                                             
         BL    TOTOUT6                                                          
         MVC   BLOCK(5),=C'*ALL*'                                               
         LA    R1,BLOCK+6                                                       
         CHI   R6,8                                                             
         BL    TOTOUT6                                                          
         MVC   BLOCK(8),=C'*TOTALS*'                                            
         LA    R1,BLOCK+9                                                       
         B     TOTOUT6                                                          
*                                                                               
TOTOUT4  MVI   BLOCK,C'*'                                                       
         MVC   BLOCK+1(15),LABLAREA                                             
         MVC   BLOCK+17(7),=C'TOTALS*'                                          
         LA    R1,BLOCK+25                                                      
*                                                                               
TOTOUT6  BAS   RE,TESTWGT                                                       
         BNE   TOTOUT7                                                          
         GOTO1 AFMTWGT                                                          
TOTOUT7  OC    COUNT,COUNT                                                      
         BZ    TOTOUT8                                                          
         MVI   BLOCK+45,C'('                                                    
         EDIT  (2,COUNT),(8,BLOCK+46),ALIGN=LEFT                                
         LR    R1,R0                                                            
         LA    R1,BLOCK+46(R1)                                                  
         MVI   0(R1),C')'                                                       
*                                                                               
TOTOUT8  GOTO1 SQUASHER,DMCB,BLOCK,80                                           
         LA    R1,5                                                             
         ST    R1,DMCB+8                                                        
         MVI   DMCB+8,198                                                       
         GOTO1 CHOPPER,DMCB,(80,BLOCK),((R6),0(R3))                             
*                                                                               
TOTOUTX  MVC   OUTAREA,BLANKS                                                   
         B     XIT                                                              
         EJECT                                                                  
* ROUTINE TO TEST WHETHER MARKET WEIGHTING COMMENT IS NEEDED IN TOTAL           
* OUTPUT : CC EQ - YES  R4=N'MARKETS,R5=TOTAL WEIGHT                            
*          CC NE - NO                                                           
*                                                                               
TESTWGT  LR    R0,RE                                                            
         CLI   MKTLEV,0            TEST MARKET IS A ROW                         
         BE    TESTWGT2                                                         
         TM    OUTIND,OUTICRMK     AND TOTAL IS ACROSS MARKETS                  
         BZ    TESTWGT2                                                         
         CLI   SBQMKTWT,C'N'       AND MARKET WEIGHTING IS IN EFFECT            
         BE    TESTWGT2                                                         
         ICM   R5,15,TOTWGT        AND THERE IS A DECENT MARKET WEIGHT          
         BZ    TESTWGT2                                                         
         ICM   R4,15,TOTMKT                                                     
         BZ    TESTWGT2                                                         
         LR    RE,R0               YES-THEN MARKET WEIGHTING IS ON              
         CR    RE,RE                                                            
         BR    RE                                                               
*                                                                               
TESTWGT2 LTR   RE,R0                                                            
         BR    RE                                                               
         EJECT                                                                  
FF       EQU   X'FF'                                                            
*                                                                               
AXTRA    DS    0F               ** EXTENTION ROUTINE ADDRESSES **               
AGETDEM  DC    A(0)                                                             
AGETTGT  DC    A(0)                                                             
AFMTPER  DC    A(0)                                                             
AGETREP  DC    A(0)                                                             
AIBUY    DC    A(0)                                                             
AOBUY    DC    A(0)                                                             
AOMKT    DC    A(0)                                                             
AOMKTRNK DC    A(0)                                                             
ATMKTRNK DC    A(0)                                                             
AODPTLEN DC    A(0)                                                             
AFMTWGT  DC    A(0)                                                             
AHDEMH12 DC    A(0)                                                             
AHDEM2   DC    A(0)                                                             
AHCPP2   DC    A(0)                                                             
AOGRPCD  DC    A(0)                                                             
AOEST    DC    A(0)                                                             
AOPRD    DC    A(0)                                                             
AXTRAN   EQU   (*-AXTRA)/L'AXTRA                                                
*                                                                               
BLDMGN   DC    A(0)                V(BLDMGN)                                    
ALENTAB  DC    A(0)                V(SPLENTAB)                                  
*                                                                               
DEMONAME DS    CL7                                                              
LEVELSWS DS    CL32                                                             
SVREP    DS    CL3                                                              
DETLEV   DS    XL1                                                              
*                                                                               
SINGNUM  DS    XL2                MAKE EACH BILL HEADER REC UNIQUE              
*                                                                               
CAA      DC    CL5'AAAAA'                                                       
CZZ      DC    CL6'ZZZZZZ'                                                      
XFF      DC    XL16'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF'                           
XFE      DC    XL13'FEFEFEFEFEFEFEFEFEFEFEFEFE'                                 
XFD      DC    XL4'FDFDFDFD'                                                    
ZEROS    DC    CL4'0000'                                                        
UNKNOWN  DC    C'**UNKNOWN**'                                                   
NETWORKS DC    C'**NETWORKS**'                                                  
BLANKS   DC    80C' '                                                           
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
* ROUTINE TABLE                                                                 
*                                                                               
ROUTTAB  J     ICOMPUTE            001                                          
         J     IDUMMY                                                           
         J     IMED                                                             
         J     OMED                                                             
         J     ISUBMED             005                                          
         J     OSUBMED                                                          
         J     ICGR1                                                            
         J     OCGR1                                                            
         J     ICGR2                                                            
         J     OCGR2               010                                          
         J     ICLTOFF                                                          
         J     OCLTOFF                                                          
         J     ICLT                                                             
         J     OCLT                                                             
         J     ICLTACOF            015                                          
         J     OCLTACOF                                                         
         J     ICLTINT                                                          
         J     OCLTINT                                                          
         J     IPGR1                                                            
         J     OPGR1               020                                          
         J     IPGR2                                                            
         J     OPGR2                                                            
         J     IPRD                                                             
         J     IPRD                                                             
         J     OPRD                025                                          
         J     IEST                                                             
         J     IEST                                                             
         J     IEST                                                             
         J     OEST                                                             
         J     IEDATES             030                                          
         J     OEDATES                                                          
         J     ITGT                                                             
         J     OTGT                                                             
         J     IESTFLT                                                          
         J     OESTFLT             035                                          
         J     IRTLSCH                                                          
         J     ORTLSCH                                                          
         J     IMGR1                                                            
         J     OMGR1                                                            
         J     IMGR2               040                                          
         J     OMGR2                                                            
         J     IMGR3                                                            
         J     OMGR3                                                            
         J     IMKT                                                             
         J     IMKT                045                                          
         J     OMKT                                                             
         J     IMKTR                                                            
         J     OMKTR                                                            
         J     IMKTRNK                                                          
         J     OMKTRNK             050                                          
         J     IMKTWT                                                           
         J     ISGR1                                                            
         J     OSGR1                                                            
         J     ISGR2                                                            
         J     OSGR2               055                                          
         J     ISTA                                                             
         J     OSTA                                                             
         J     ICNET                                                            
         J     OCNET                                                            
         J     ISTANET             060                                          
         J     OSTANET                                                          
         J     INETSTA                                                          
         J     ONETSTA                                                          
         J     ISTANM                                                           
         J     OSTANM              065                                          
         J     ISTACITY                                                         
         J     OSTACITY                                                         
         J     ISTAST                                                           
         J     OSTAST                                                           
         J     ISTAAD              070                                          
         J     OSTAAD                                                           
         J     IAFFIL                                                           
         J     OAFFIL                                                           
         J     ICHAN                                                            
         J     OCHAN               075                                          
         J     ISIZE                                                            
         J     OSIZE                                                            
         J     IFORMAT                                                          
         J     OFORMAT                                                          
         J     ISTAFAX             080                                          
         J     OSTAFAX                                                          
         J     IMSO                                                             
         J     OMSO                                                             
         J     IICNM                                                            
         J     OICNM               085                                          
         J     IDPT                                                             
         J     ODPT                                                             
         J     IDPTLEN                                                          
         J     ODPTLEN                                                          
         J     ILEN                090                                          
         J     OLEN                                                             
         J     IPER                                                             
         J     OPER                                                             
         J     OWEEK                                                            
         J     IPER                095                                          
         J     OFLT                                                             
         J     ODAY                                                             
         J     IBUY                                                             
         J     OBUY                                                             
         J     ILINE               100                                          
         J     OLINE                                                            
         J     IBOOK                                                            
         J     OBOOK                                                            
         J     IBYID                                                            
         J     OBYID               105                                          
         J     IBYTYPE                                                          
         J     OBYTYPE                                                          
         J     IPREP                                                            
         J     OPREP                                                            
         J     ITREP               110                                          
         J     OTREP                                                            
         J     ISREP                                                            
         J     OSREP                                                            
         J     IADJ                                                             
         J     OADJ                115                                          
         J     INAMES                                                           
         J     ONAMES                                                           
         J     IPRDINT                                                          
         J     OPRDINT                                                          
         J     IADATE              120                                          
         J     IADAY                                                            
         J     IATIME                                                           
         J     IAPROG                                                           
         J     IPROG                                                            
         J     OPROG               125                                          
         J     IROT                                                             
         J     OROT                                                             
         J     ITIMES                                                           
         J     OTIMES                                                           
         J     ITEXT               130                                          
         J     HDEM                                                             
         J     HCPP                                                             
         J     HDCPP                                                            
         J     HAR                                                              
         J     HDEMNDX             135                                          
         J     HDOLNDX                                                          
         J     HPER                                                             
         J     HCGR1                                                            
         J     HCGR2                                                            
         J     HPGR1               140                                          
         J     HPGR2                                                            
         J     HMGR1                                                            
         J     HMGR2                                                            
         J     HMGR3                                                            
         J     HSGR1               145                                          
         J     HSGR2                                                            
         J     HNETSTA                                                          
         J     HBUY                                                             
         J     HBYID                                                            
         J     HSTDEM              150                                          
         J     HSTBDEM                                                          
         J     HCML                                                             
         J     TOTAL                                                            
         J     TMKTRNK                                                          
         J     IRSM                155                                          
         J     IPURP                                                            
         J     OPURP                                                            
         J     IRUNDATE                                                         
         J     ORUNDATE                                                         
         J     ICLTACC             160                                          
         J     OCLTACC                                                          
         J     IECREATE                                                         
         J     OECREATE                                                         
         EJECT                                                                  
*                                                                               
ICOMPTAB DC    CL8'OCPP    '                                                    
         DC    CL8'ODCPP   '                                                    
         DC    CL8'OBYDEM  '                                                    
         DC    CL8'OGLDEM  '                                                    
         DC    CL8'OORDEM  '                                                    
         DC    CL8'OSLDEM  '                                                    
         DC    CL8'OSPT    '                                                    
         DC    CL8'OBYAR   '                                                    
         DC    CL8'OBILBL  '                                                    
         DC    CL8'OPBYDEM '                                                    
         DC    CL8'OPCPP   '                                                    
         DC    CL8'OPDCPP  '                                                    
         DC    CL8'OJ1DIFF '                                                    
         DC    CL8'OXBILBL '                                                    
         DC    X'00'                                                            
*                                                                               
RECTAB   DC    C'E',AL1(SBPROCES)        ESTIMATES                              
         DC    C'B',AL1(SBPROCSP)        BUYS                                   
         DC    C'G',AL1(SBPROCGL)        GOALS                                  
         DC    C'S',AL1(SBPROCBL)        BILLS                                  
*** PROCB1 ONLY FOR CLT$BILL KEYWORD (WESTERN)                                  
         DC    C'1',AL1(SBPROCB1)        BILLS - CUR=X'01'                      
         DC    C'H',AL1(SBPROCBH)        BILL HEADERS                           
         DC    C'I',AL1(SBPROCIN)        INFOMERCIALS                           
         DC    C'F',AL1(SBPROCSP)        BUY INFOMERCIALS                       
         DC    C'L',AL1(SBPROCSL)        STATION LOCKIN                         
         DC    C'J',AL1(SBPROCPW)        WESTERN PW (MKT)                       
         DC    C'2',AL1(SBPROCP2)        WESTERN PW (STA)                       
         DC    C'V',AL1(SBPROCNV)        INVOICE                                
         DC    C'O',AL1(SBPROCOM)        OM RECORD                              
         DC    C'X',AL1(0)               (USED FOR DEMO/DOLLAR INDEXES)         
         DC    C'N',AL1(0)               (USED FOR NAMES)                       
         DC    C'Q',AL1(0)               (USED FOR QTR PERIOD)                  
         DC    C'M',AL1(0)               (USED FOR MON PERIOD)                  
         DC    C'W',AL1(0)               (USED FOR WEEK PERIOD)                 
         DC    C'K',AL1(0)               (USED FOR STACK)                       
         DC    X'FF'                                                            
         EJECT                                                                  
* EXTENTION ROUTINES                                                            
*                                                                               
         DS    0D                                                               
EXTRA    NMOD1 0,**SPDX**,R7                                                    
         L     RC,GLAWORKD                                                      
         USING GEND,RC                                                          
         SRL   RF,24                                                            
         SLL   RF,2                                                             
         B     *+4(RF)                                                          
*                                                                               
         B     GETDEM                                                           
         B     GETTGT                                                           
         B     FMTPER                                                           
         B     GETREP                                                           
         B     INBUY                                                            
         B     OUTBUY                                                           
         B     OUTMKT                                                           
         B     OUTMKTRK                                                         
         B     TOTMKTRK                                                         
         B     OUTDPTLN                                                         
         B     FMTWGT                                                           
         B     HDEMH12                                                          
         B     HDEM2                                                            
         B     HCPP2                                                            
         B     OGRPCODE                                                         
         B     OUTEST                                                           
         B     OUTPRD                                                           
*                                                                               
XIT2     XIT1  ,                                                                
         EJECT                                                                  
* ROUTINE TO GET DEMO NAME                                                      
*                                                                               
GETDEM   LR    R4,R1               R4=A(DEMO NAME) FOR OUTPUT                   
         LLC   R1,GLARGS                                                        
         BCTR  R1,0                                                             
         MHI   R1,7                                                             
         LA    R1,DEMNAMES(R1)                                                  
         TM    DATAIND5,DITARGET   TEST TARGET DEMO IN HEADLINES                
         BZ    GETDEM1                                                          
         LA    RE,TGTDEM           YES-EXTRACT DEMO NAME FROM                   
         CLI   GLARGS,1                TARGET OUTPUT ROUTINE'S                  
         BE    GETDEMA                 SAVED AREA                               
         LA    RE,TGTDEM2                                                       
         CLI   GLARGS,2                                                         
         BE    GETDEMA                                                          
         LA    RE,TGTDEM3                                                       
         CLI   GLARGS,3                                                         
         BE    GETDEMA                                                          
         LA    RE,TGTDEM4                                                       
         CLI   GLARGS,4                                                         
         BNE   GETDEM1                                                          
*                                                                               
GETDEMA  MVC   0(7,R4),0(RE)                                                    
         OC    0(7,R4),0(R4)       HAVE DEMO NAME?                              
         BNZ   GETDEM6             YES                                          
         TM    GLDOWNLD,GLDLACTV   DOWNLOAD ACTIVE?                             
         BZ    GETDEM6             NO - OTHERWISE MAYBE TGTDEM NOT SET          
*                                                                               
GETDEM1  CLI   GLARGS+3,0          TEST DEMO MODIFIER IS RATING                 
         BE    GETDEM4                                                          
         L     R1,ADEMLST          NO-GET THE NAME                              
         LLC   R2,GLARGS                                                        
         BCTR  R2,0                                                             
         MHI   R2,3                                                             
         LA    R2,0(R1,R2)                                                      
         MVC   FULL(3),0(R2)                                                    
         MVC   FULL+1(1),GLARGS+3    MODIFIER                                   
         CLI   2(R2),0             COMSCORE DEMO?                               
         BE    GETDEM2             YES                                          
         CLI   1(R2),C'R'                                                       
         BE    GETDEM2                                                          
         CLI   1(R2),C'I'                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         MVI   FULL+1,C'X'                                                      
         CLI   GLARGS+3,C'S'                                                    
         BE    GETDEM2                                                          
         MVI   FULL+1,C'Q'                                                      
         CLI   GLARGS+3,C'P'                                                    
         BE    GETDEM2                                                          
         DC    H'0'                                                             
*                                                                               
GETDEM2  LA    R2,FULL                                                          
         BAS   RE,GETDNAME         GET DEMO NAME                                
*                                                                               
GETDEM4  MVC   0(7,R4),0(R1)       SAVE DEMO NAME                               
*                                                                               
GETDEM6  OC    0(7,R4),0(R4)       TEST ANY DEMO NAME                           
         BNZ   *+10                                                             
         LTR   RE,RE                                                            
         B     GETDEMX                                                          
         CR    RE,RE                                                            
*                                                                               
GETDEMX  B     XIT2                                                             
         EJECT                                                                  
* ROUTINE TO GET TARGET DEMO NAME                                               
* INPUT  : PARM1=A(TARGET DEMO CODE)                                            
* OUTPUT : PARM2=A(DEMO NAME)                                                   
*                                                                               
GETTGT   LM    R2,R3,0(R1)                                                      
         BAS   RE,GETDNAME                                                      
         MVC   0(7,R3),0(R1)                                                    
         B     XIT2                                                             
         EJECT                                                                  
*                                                                               
* ROUTINE TO GET DEMO NAME                                                      
* INPUT  : R2=A(DEMO CODE)                                                      
* OUTPUT : R1=A(DEMO NAME)                                                      
*                                                                               
GETDNAME LR    R0,RE                                                            
         LA    RF,NMYDEMOS         MIGHT HAVE FOUND NAME ALREADY                
         LA    R5,MYDEMOS                                                       
*                                                                               
         CLI   2(R2),0             COMSCORE DEMO?                               
         BE    GETDN3              YES - CLEAR MYDEMOS!                         
*                                                                               
GETDN2   OC    0(3,R5),0(R5)                                                    
         BZ    GETDN4                                                           
         CLC   0(3,R5),0(R2)                                                    
         BE    GETDN6              NAME FOUND                                   
         LA    R5,10(R5)                                                        
         BCT   RF,GETDN2                                                        
GETDN3   LA    R5,MYDEMOS                                                       
         XC    MYDEMOS(80),MYDEMOS                                              
*                                                                               
GETDN4   MVC   0(3,R5),0(R2)       GET THE NAME                                 
*                                                                               
         LAY   R6,DBAREA                                                        
         USING DBLOCKD,R6                                                       
         XC    DBLOCK,DBLOCK                                                    
         MVI   DBFUNCT,DBGETDEM                                                 
         MVI   DBTPTT,C'T'                                                      
         MVC   DBCOMFCS,SBCOMFAC                                                
         MVC   DBFILE,=C'TP '                                                   
*                                                                               
         MVI   DBSELMED,C'T'                                                    
         CLI   SBMED,C'R'                                                       
         BNE   *+12                                                             
         MVI   DBSELMED,C'R'                                                    
         B     GETDN5                                                           
*                                                                               
         CLI   SBCEXTRA,C'U'       TEST US DEMOS                                
         BE    GETDN5                                                           
*                                                                               
         LA    R1,SBAGYREC                                                      
         USING AGYHDR,R1                                                        
         CLI   AGYPROF+7,C'C'                                                   
         BNE   GETDN5                                                           
         MVI   DBSELMED,C'C'                                                    
         DROP  R1                                                               
*                                                                               
GETDN5   GOTO1 DEMOCON,DMCB,(1,(R2)),(2,3(R5)),(C'S',DBLOCK),0,COMDLIST         
*                                                                               
GETDN6   LA    R1,3(R5)            R1=A(DEMO NAME)                              
*                                                                               
GETDNX   LR    RE,R0                                                            
         BR    RE                                                               
         DROP  R6                                                               
         EJECT                                                                  
* GENERAL ROUTINE TO FORMAT A PERIOD                                            
* R1=A(OUTPUT WIDTH)                                                            
* R2=A(INPUT FIELD)                                                             
* R4=A(OUTPUT FIELD)                                                            
* BYTE=PERIOD TYPE D/W/M/Q                                                      
*                                                                               
FMTPER   OC    0(4,R2),0(R2)       TEST ANY DATES                               
         BZ    FPX                 NO                                           
         CLI   BYTE,C'Q'           QUARTERS                                     
         BNE   FP100                                                            
         LA    RF,WORK                                                          
         ST    RF,DMCB+4                                                        
         MVI   DMCB+4,20           YYYYMMDD                                     
         TM    OPTIND5,OPTRFPDT                                                 
         BNZ   FP010                                                            
         MVI   DMCB+4,X'20'        YYMMDD - NOT FUNNY                           
         MVI   0(R4),C'Q'                                                       
         LA    R4,1(R4)                                                         
         CLI   0(R1),7                                                          
         BL    *+14                                                             
         MVC   0(2,R4),=C'TR'                                                   
         LA    R4,2(R4)                                                         
         MVI   1(R4),C'/'                                                       
*                                                                               
FP010    GOTO1 DATCON,DMCB,(2,2(R2))                                            
         GOTO1 (RF),(R1),(2,2(R2)),(X'23',FULL)                                 
         TM    OPTIND5,OPTRFPDT                                                 
         BZ    *+14                                                             
         MVC   0(4,R4),WORK                                                     
         B     *+10                                                             
         MVC   2(2,R4),WORK                                                     
*                                                                               
         XR    R1,R1                                                            
         XR    RE,RE                                                            
         ICM   RE,1,SBSPPROF+6     GET FY START MON                             
         BNZ   *+8                                                              
         LHI   RE,1                DEFAULT TO JAN                               
*                                                                               
         LLC   RF,FULL+1           GET PERIOD MONTH #                           
         SR    RF,RE               GET MONTH # REL TO Q1 START MON              
         BNM   *+12                                                             
         AHI   RF,12                                                            
         LHI   R1,1                FLAG FOR PRIOR YEAR                          
*                                                                               
         SR    RE,RE                                                            
         D     RE,=F'3'            GET QTR NUMBER                               
         AHI   RF,1                                                             
*                                                                               
FP081    LTR   R1,R1               TEST NEED YEAR BEFORE                        
         BZ    FP090                                                            
         LR    R0,RF                                                            
         GOTO1 DATCON,DMCB,(2,2(R2)),(0,WORK)                                   
         MVC   DMCB+8,=F'-1'                                                    
         GOTO1 ADDAY,DMCB,(C'Y',WORK),(X'20',WORK)                              
         TM    OPTIND5,OPTRFPDT                                                 
         BZ    FP82                                                             
         GOTO1 DATCON,DMCB,(0,WORK),(20,WORK)                                   
         MVC   0(4,R4),WORK                                                     
         B     *+10                                                             
FP82     MVC   2(2,R4),WORK                                                     
         LR    RF,R0                                                            
*                                                                               
FP090    TM    OPTIND5,OPTRFPDT                                                 
         BZ    FP92                                                             
         MVI   4(R4),C'0'                                                       
         STC   RF,5(R4)                                                         
         OI    5(R4),X'F0'                                                      
         B     FPX                                                              
*                                                                               
FP92     STC   RF,0(R4)                                                         
         OI    0(R4),X'F0'                                                      
         B     FPX                                                              
*                                                                               
FP100    DS    0H                                                               
         CLI   PEROPT,PEROFF       FISCAL FOLLIES?                              
         BE    FP110                YES - JUST USE MONTH OF PER END             
         CLI   DATEFORM,2          USE CALENDAR MONTHS?                         
         BE    FP110                YES                                         
         CLI   DATEFORM,3          USE CALENDAR MONTHS?                         
         BE    FP110                YES                                         
         TM    ININD,INIOWSDY                                                   
         BZ    FP110                                                            
         GOTO1 =V(BRDMON),DMCB,(X'FF',2(R2)),2(R2)                              
*                                                                               
FP110    XC    WORK,WORK                                                        
         LA    R1,WORK                                                          
         ST    R1,DMCB+4                                                        
         MVI   DMCB+4,X'20'                                                     
         CLI   BYTE,C'E'           SPECIAL FOR ECREATE                          
         BE    *+12                                                             
         CLI   BYTE,C'M'           MONTHS                                       
         BNE   FP140                                                            
         CLI   DATEFORM,4          TEST BROADCAST OR CALENDAR MONTHS            
         BNL   FP130                                                            
         TM    OPTIND2,OPTIYMD     YES-                                         
         BO    FP120                                                            
         MVI   DMCB+4,23                                                        
         TM    OPTIND5,OPTISO      TEST YYYY-MM-DD  ISO 8601                    
         BO    FP120                                                            
         MVI   DMCB+4,20                                                        
         TM    OPTIND3,OPTICYMD    TEST CCYYMMDD                                
         BO    FP120                                                            
         TM    OPTIND5,OPTRFPDT                                                 
         BO    FP120                                                            
         MVI   DMCB+4,13           MMMDD/YY                                     
         TM    OPTIND6,OPT6MDY                                                  
         BO    FP120                                                            
         CLI   BYTE,C'E'           ALSO DEFAULT OUTPUT TYPE FOR ECREATE         
         BE    FP120                                                            
*                                                                               
         MVI   DMCB+4,6                                                         
*                                                                               
FP120    GOTO1 DATCON,DMCB,(2,2(R2))                                            
         CLI   GLARGS+1,C'A'       AVG MON KEYWORD?  (MMM ONLY)                 
         BNE   *+14                 NO                                          
         MVC   0(3,R4),WORK                                                     
         B     FPX                                                              
*                                                                               
         MVC   0(6,R4),WORK                                                     
         TM    OPTIND5,OPTRFPDT                                                 
         BZ    *+14                                                             
         MVC   6(2,R4),ZEROS                                                    
         B     FPX                                                              
*                                                                               
         TM    OPTIND2,OPTIYMD                                                  
         BZ    FP125                                                            
         CLI   BYTE,C'E'           SPECIAL FOR ECREATE                          
         BE    FPX                                                              
         MVC   4(2,R4),ZEROS                                                    
         B     FPX                                                              
*                                                                               
FP125    TM    OPTIND6,OPT6MDY                                                  
         BO    *+12                                                             
         CLI   BYTE,C'E'           ALSO DEFAULT OUTPUT TYPE FOR ECREATE         
         BNE   *+14                                                             
         MVC   0(8,R4),WORK                                                     
         B     FPX                                                              
*                                                                               
         TM    OPTIND5,OPTISO                                                   
         BZ    FPX                                                              
         MVC   0(10,R4),WORK                                                    
         MVC   8(2,R4),ZEROS                                                    
         B     FPX                                                              
*                                                                               
FP130    TM    OPTIND2,OPTIYMD        OTHER MONTH TYPES                         
         BO    FP135                                                            
         MVI   DMCB+4,23                                                        
         TM    OPTIND5,OPTISO                                                   
         BNZ   FP135                                                            
         MVI   DMCB+4,20                                                        
         TM    OPTIND5,OPTRFPDT                                                 
         BNZ   FP135                                                            
         MVI   DMCB+4,13           MMMDD/YY                                     
         TM    OPTIND6,OPT6MDY                                                  
         BO    FP135                                                            
         CLI   BYTE,C'E'           ALSO DEFAULT OUTPUT TYPE FOR ECREATE         
         BE    FP120                                                            
*                                                                               
         MVI   DMCB+4,4                                                         
*                                                                               
FP135    GOTO1 DATCON,DMCB,(2,0(R2))                                            
         MVC   0(6,R4),WORK                                                     
*                                                                               
         TM    OPTIND6,OPT6MDY                                                  
         BO    *+12                                                             
         CLI   BYTE,C'E'           ALSO DEFAULT OUTPUT TYPE FOR ECREATE         
         BNE   *+14                                                             
         MVC   0(8,R4),WORK                                                     
         B     FPX                                                              
*                                                                               
         TM    OPTIND5,OPTISO                                                   
         BZ    FPX                                                              
         MVC   0(10,R4),WORK                                                    
         B     FPX                                                              
*                                                                               
FP140    CLI   BYTE,C'W'              WEEKS/DAYS                                
         BE    *+12                                                             
         CLI   BYTE,C'D'                                                        
         BNE   FP170                                                            
         TM    OPTIND2,OPTIYMD                                                  
         BO    FP150                                                            
         TM    OPTIND3,OPTICYMD                                                 
         BO    FP150                                                            
         MVI   DMCB+4,23                                                        
         TM    OPTIND5,OPTISO      TEST YYYY-MM-DD ISO 8601                     
         BO    FP150                                                            
         MVI   DMCB+4,20                                                        
         TM    OPTIND3,OPTICYMD    TEST CCYYMMDD                                
         BO    FP150                                                            
         TM    OPTIND5,OPTRFPDT                                                 
         BO    FP150                                                            
         MVI   DMCB+4,13           MMMDD/YY                                     
         TM    OPTIND6,OPT6MDY                                                  
         BO    FP150                                                            
*                                                                               
         MVI   DMCB+4,7                                                         
*                                                                               
FP150    GOTO1 DATCON,DMCB,(2,(R2))     MMMDD OR YYMMDD                         
         MVC   0(6,R4),WORK                                                     
*                                                                               
         TM    OPTIND5,OPTISO                                                   
         BNZ   *+14                                                             
         MVC   0(10,R4),WORK                                                    
         B     FPX                                                              
*                                                                               
         TM    OPTIND6,OPT6MDY                                                  
         BZ    *+14                                                             
         MVC   0(8,R4),WORK                                                     
         B     FPX                                                              
*                                                                               
         TM    OPTIND5,OPTRFPDT                                                 
         BNZ   FPX                                                              
         TM    OPTIND2,OPTIYMD                                                  
         BO    FPX                                                              
         TM    OPTIND3,OPTICYMD    TEST CCYYMMDD                                
         BO    FPX                                                              
*                                                                               
FP160    CLI   BYTE,C'W'           TEST WEEK                                    
         BNE   FPX                                                              
         TM    SBQPER,SBQPDY       AND DAYS ALSO IN COLUMNS                     
         BZ    FPX                                                              
         MVI   5(R4),C'-'          YES-ALSO PRINT WEEK END DATE                 
         GOTO1 (RF),(R1),(2,2(R2)),(7,6(R4))                                    
         B     FPX                                                              
*                                                                               
FP170    CLI   BYTE,C'Y'           YEARS                                        
         BNE   FP190                                                            
         GOTO1 DATCON,DMCB,(2,2(R2)),(X'23',FULL)                               
         MVC   0(2,R4),=C'19'                                                   
         CLI   FULL,80                                                          
         BNL   *+10                                                             
         MVC   0(2,R4),=C'20'                                                   
         LLC   RF,FULL                                                          
         CLI   SBSPPROF+6,1                                                     
         BNH   FP180                                                            
         BCTR  RF,0                                                             
         LTR   RF,RF                                                            
         BNM   FP180                                                            
         MVC   0(2,R4),=C'19'                                                   
         LA    RF,99                                                            
*                                                                               
FP180    CVD   RF,WORK                                                          
         OI    WORK+7,X'0F'                                                     
         UNPK  2(2,R4),WORK(8)                                                  
         B     FPX                                                              
*                                                                               
FP190    CLI   BYTE,C'H'           HALF YEARS                                   
         BNE   FPX                                                              
         GOTO1 DATCON,DMCB,(2,2(R2)),(X'23',FULL)  GET END DATE YMD             
         LLC   RF,FULL             RF=YEAR                                      
         LLC   RE,FULL+1           RE=MONTH                                     
         CLI   SBSPPROF+6,1        TEST BASE MONTH = JAN                        
         BNH   FP200                                                            
         LLC   R1,SBSPPROF+6       NO-                                          
         BCTR  R1,0                                                             
         SR    RE,R1                                                            
         BP    FP200                                                            
         LA    RE,12(RE)                                                        
         BCTR  RF,0                SUBTRACT 1 TO GET START YEAR                 
         LTR   RF,RF                                                            
         BNM   FP200                                                            
         LA    RF,99                                                            
*                                                                               
FP200    MVC   0(3,R4),=C'H1/'                                                  
         CHI   RE,6                TEST H1                                      
         BNH   *+8                 YES                                          
         MVI   1(R4),C'2'          NO-THEN MUST BE H2                           
         CVD   RF,WORK             FORMAT THE YEAR                              
         OI    WORK+7,X'0F'                                                     
         UNPK  3(2,R4),WORK(8)                                                  
*                                                                               
FPX      B     XIT2                                                             
         EJECT                                                                  
* ROUTINE TO GET A REP RECORD                                                   
* INPUT  : SBREP   = 3-CHAR REP CODE                                            
* OUTPUT : SBREPNM = REP NAME                                                   
*                                                                               
GETREP   LA    R6,KEY              READ REP RECORD                              
         USING REPRECD,R6                                                       
         MVI   REPKEY,C'0'                                                      
         MVC   REPKEY+1(16),REPKEY                                              
         MVI   REPKTYPE,C'R'                                                    
         MVC   REPKMED,SBQMED                                                   
         CLI   SBQMED,C'*'                                                      
         BNE    *+10                                                            
         MVC   REPKMED,SBMED                                                    
         MVC   REPKREP,SBREP                                                    
         MVC   REPKAGY,AGENCY                                                   
         L     R6,AIO2                                                          
         ST    R6,AIO                                                           
         MVC   SBREPNM,=CL24'* UNKNOWN *'                                       
         GOTO1 DATAMGR,DMCB,=C'DMREAD',=C'STATION',KEY,AIO                      
         CLI   8(R1),0                                                          
         BNE   *+16                                                             
         MVC   SBREPNM,FILLER                                                   
         MVC   SBREPNM(L'RNAME),RNAME   EXTRACT REP NAME                        
         B     XIT2                                                             
         DROP  R6                                                               
         EJECT                                                                  
* INPUT ROUTINE FOR BUY RECORD DETAILS                                          
*                                                                               
INBUY    CLI   SBMODE,SBPROCSP     PROCESS A BUY RECORD?                        
         BNE   INBUYX              NO, GET OUT                                  
         L     R3,SBAIO1           ADDRESS THE BUY RECORD                       
         USING BUYRECD,R3                                                       
         CLC   BUYKEY,BUYKEYSV     TEST NEW BUY KEY                             
         BE    INBUY8                                                           
         MVC   BUYKEYSV,BUYKEY                                                  
         CLI   GLARGS+1,C'M'       MGDTL KEYWORD?                               
         BE    INBUY7              YES - JUST CALL BLDMGN                       
         MVC   BYEST,BUYKEST       YES-FORMAT BUY DETAILS                       
         MVC   BYLINE1,BUYKBUY     SAVE TWO BYTES OF BUYLINE                    
         TM    BUYRCNTL,BUYRLN2    2-BYTE BUYLINE?                              
         BNZ   *+14                YES                                          
         MVI   BYLINE1,0           CONVERT 1-BYTE LINE TO 2-BYTE LINE           
         MVC   BYLINE1+1(1),BUYKBUY                                             
         XC    BYLINE2,BYLINE2                                                  
         MVC   BYSTART,BDSTART                                                  
         MVC   BYEND,BDEND                                                      
         MVC   BYWKS,BDWKS                                                      
         MVC   BYDPT,BDDAYPT                                                    
         MVC   BYLEN,BDSEC                                                      
         MVC   BYDAY,BDDAY                                                      
         MVC   BYTIME,BDTIMST                                                   
         MVC   BYSEDAY,BDSEDAY                                                  
         MVC   BYPROG,BDPROGRM                                                  
         MVC   BYDA,SBRECDA        RECORD ADDRESS                               
         CLI   GLARGS+1,C'C'       COST IS OPTIONAL                             
         BNE   INBUY1                                                           
         SR    R1,R1                                                            
         TM    GLARGS+2,X'01'      USE SECOND COST?                             
         BZ    INBUY0               NO                                          
*                                                                               
         LA    RE,BDELEM                                                        
         SR    R0,R0                                                            
*                                                                               
         IC    R0,1(RE)                                                         
         AR    RE,R0                                                            
         CLI   0(RE),0             END OF REC?                                  
         BE    *+16                 NO 2ND COST                                 
         CLI   0(RE),X'71'                                                      
         BNE   *-18                                                             
         ICM   R1,15,2(RE)                                                      
         B     *+8                                                              
*                                                                               
INBUY0   ICM   R1,7,BDCOST                                                      
         TM    BDCIND,BDCMINSQ     TEST COST IS NEGATIVE                        
         BNZ   *+12                                                             
         TM    BDCIND2,BDC2NEG     BDCRNEGQ (HOPE SCAN FINDS!)                  
         BZ    *+6                                                              
         LCR   R1,R1                                                            
         TM    BDCIND2,X'20'       TEST CANADIAN                                
         BO    *+12                                                             
         TM    BDCIND2,X'10'       TEST RATE IN DOLLARS                         
         BNZ   INBUY0A                                                          
*                                                                               
         TM    BDSTAT,X'01'        TEST NETWORK                                 
         BZ    INBUY2                                                           
         TM    BDCIND2,X'01'       TEST IN PENNIES                              
         BO    INBUY2                                                           
INBUY0A  MHI   R1,100              CONVERT DOLLARS TO PENNIES                   
         B     INBUY2                                                           
*                                                                               
INBUY1   CLI   GLARGS+1,C'N'       TEST NET COST REQUIRED                       
         BNE   INBUY3                                                           
         L     R4,SBACHUNK         YES-EXTRACT NET COST FROM CHUNK TAB          
         USING SCHUNKD,R4                                                       
         ICM   R1,15,SCNET                                                      
         BZ    INBUY2                                                           
         L     RF,SCSPOTS                                                       
         C     RF,=F'1'                                                         
         BNH   INBUY2                                                           
         SR    R0,R0               DIVIDE BY N'SPOTS                            
         SLDA  R0,1                                                             
         DR    R0,RF                                                            
         LTR   R1,R1                                                            
         BM    *+8                                                              
         LA    R1,1(R1)                                                         
         SRA   R1,1                                                             
*                                                                               
INBUY2   STCM  R1,15,BYCOST                                                     
*                                                                               
INBUY3   MVI   BYIND,0                                                          
         MVI   BYPKGIND,0                                                       
*                                                                               
         SR    R0,R0               LOOK FOR COMMENT AND PACKAGE                 
         LA    R1,BDELEM           ELEMENTS                                     
INBUY4   CLI   0(R1),0                                                          
         BE    INBUY7                                                           
         CLI   0(R1),X'66'                                                      
         BNE   *+12                                                             
         OI    BYIND,BYICOM                                                     
         B     INBUY6                                                           
         CLI   0(R1),5                                                          
         BNE   INBUY6                                                           
         USING PKGELEM,R1                                                       
         MVC   BYPKGIND,PKGIND     FOUND-SET PACKAGE INDICATOR                  
         NI    BYPKGIND,X'FF'-X'10'      TURN OFF 2-BYTE BUYLINE FLAG!          
         CLI   PKGIND,2            TEST PACKAGE SLAVE                           
         BE    INBUY4A                                                          
         CLI   PKGIND,X'12'        TEST PACKAGE SLAVE                           
         BE    INBUY4A                                                          
         CLI   PKGIND,6            OR REVISION SLAVE                            
         BE    INBUY4A                                                          
         CLI   PKGIND,X'16'        OR REVISION SLAVE                            
         BNE   INBUY4B                                                          
*                                                                               
INBUY4A  MVC   BYLINE2,BYLINE1     ALREADY CONVERTED TO 2-BYTE BUYLINE          
         MVC   BYLINE1,PKGLINES    YES-SET MASTER LINE NUMBER                   
         TM    PKGIND,X'10'        2-BYTE BUYLINE NUMBER?                       
         BNZ   INBUY4B             YES                                          
         MVI   BYLINE1,0                                                        
         MVC   BYLINE1+1(1),PKGLINES                                            
*                                                                               
INBUY4B  CLI   PKGIND,8            TEST MAKEGOOD SLAVE                          
         BE    *+12                                                             
         CLI   PKGIND,X'18'        TEST MAKEGOOD SLAVE                          
         BNE   INBUY6                                                           
         MVC   BYLINE2,PKGLINES    YES-SET MAKEGOOD MASTER                      
         TM    PKGIND,X'10'        2-BYTE BUYLINE NUMBER?                       
         BNZ   *+14                YES                                          
         MVI   BYLINE2,0                                                        
         MVC   BYLINE2+1(1),PKGLINES                                            
         MVC   BYMGDATE,BDMGDATE           MAKEGOOD MISSED DATE                 
         MVC   BYMGSPOT,BDMGSPOT           MAKEGOOD SPOT NUMBER                 
         DROP  R1                                                               
*                                                                               
INBUY6   IC    R0,1(R1)                                                         
         AR    R1,R0                                                            
         B     INBUY4                                                           
*                                                                               
INBUY7   CLI   BYPKGIND,8          TEST OLD MAKEGOOD                            
         BE    INBUY8              YES                                          
         L     RF,=A(MGAREA)       NO-GET TABLE OF NEW MAKEGOODS                
         USING MGABLKD,RF                                                       
         XC    0(256,RF),0(RF)                                                  
         MVI   MGAACT,MGAQBLN      BUILD A BUYLINE TABLE                        
         MVC   MGAACOM,SBCOMFAC                                                 
         LA    RE,((MGALNQ+7)/8)*8  GET PARM LEN IN DBLWDS                      
         AR    RE,RF                                                            
         ST    RE,MGATAB           TABLE IS BEYOND PARM AREA                    
         XC    0(MGERECL,RE),0(RE)                                              
         MVC   MGATABLN,=H'20000'                                               
         ST    R3,MGABUY                                                        
         GOTO1 BLDMGN,(RF)                                                      
         L     RF,=A(MGAREA)                                                    
         CLI   MGAERR,0                                                         
         BE    *+14                                                             
         CLI   MGAERR,MGAQDMIS                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         L     R1,MGATAB                                                        
         OC    0(MGERECL,R1),0(R1) TEST FOR ANY MAKEGOOD ACTIVITY ON            
         BZ    INBUY8              THIS LINE                                    
         OI    BYIND,BYIMG         YES                                          
         DROP  RF                                                               
*                                                                               
INBUY8   CLI   GLARGS+1,C'M'       MGDTL KEYWORD?                               
         BE    INBUY12             YES - JUST PASS BYIND                        
         TM    ROWIND,ROWIBYCM     TEST BUYLINE COMMENTS NEEDED                 
         BO    *+8                                                              
         NI    BYIND,255-BYICOM    NO-DON'T LOOK FOR THEM ON OUTPUT             
         CLI   GLARGS+1,C'C'                                                    
         BE    INBUY10                                                          
         CLI   GLARGS+1,C'N'                                                    
         BE    INBUY10                                                          
         MVC   0(L'BUYDET,R2),BUYDET                                            
         B     INBUYX                                                           
*                                                                               
INBUY10  MVC   0(L'BUYDETC,R2),BUYDETC                                          
         B     INBUYX                                                           
*                                                                               
INBUY12  XC    0(4,R2),0(R2)       CLEAR INPUT IN CASE WE GET GARBAGE           
         TM    BYIND,BYIMG         HAVE MAKEGOOD ACTIVITY ON THIS BUY?          
         BZ    *+10                NO                                           
         MVC   0(4,R2),SBRECDA     YES - PASS BUY D/A                           
*                                                                               
INBUYX   B     XIT2                                                             
         EJECT                                                                  
* OUTPUT ROUTINE FOR BUY RECORD DETAILS                                         
*                                                                               
OUTBUY   CLI   GLARGS,C'M'         MGDTL KEYWORD?                               
         BNE   OUTBUY00            NO                                           
         OC    0(4,R2),0(R2)       HAVE D/A?                                    
         BZ    OUTBUYX             NO - EXIT                                    
         CLC   0(4,R2),XFF         TOTAL LINE (OR DOWNLOAD WITH DET=N)          
         BE    OUTBUYX             YES - EXIT                                   
         XC    BUYDETC,BUYDETC     CLEAR BUYLINE DETAILS                        
         MVC   BYDA,0(R2)          SET D/A                                      
         OI    BYIND,BYIMG         SET HAVE MAKEGOOD ON BUY FLAG                
         LR    R4,R3               MOVE OUTPUT HERE                             
         B     OUTBUY5             CALL BLDMGN                                  
*                                                                               
OUTBUY00 CLI   GLARGS,C'C'         TEST COST INCLUDED                           
         BE    *+14                                                             
         MVC   BUYDET,0(R2)                                                     
         B     *+10                                                             
         MVC   BUYDETC,0(R2)                                                    
         CLC   BYDA,XFF            TOTAL LINE (OR DOWNLOAD WITH DET=N)          
         BE    OUTBUYX             YES - EXIT                                   
*                                                                               
         EDIT  BYEST,(3,(R3)),FILL=0    ESTIMATE                                
         MVI   3(R3),C'-'                                                       
         XR    R1,R1                                                            
         ICM   R1,3,BYLINE1        BUYLINE NUMBER                               
         CLI   BYPKGIND,2          TEST PACKAGE SLAVE                           
         BE    *+12                                                             
         CLI   BYPKGIND,6          OR REVISION SLAVE                            
         BNE   *+8                                                              
         ICM   R1,3,BYLINE2        YES-LINE NUMBER IS SLAVE LINE NUMBER         
         EDIT  (R1),(3,4(R3)),FILL=0                                            
         GOTO1 DATCON,DMCB,(3,BYSTART),(4,9(R3))                                
         CLC   BYSTART,BYEND                                                    
         BE    OUTBUY0                                                          
         MVI   14(R3),C'-'                                                      
         GOTO1 (RF),(R1),(3,BYEND),(4,15(R3))                                   
*                                                                               
OUTBUY0  DS    0H                                                               
         EDIT  BYWKS,(2,21(R3))                                                 
         MVC   26(1,R3),BYDPT                                                   
         EDIT  BYLEN,(3,30(R3))                                                 
         CLI   GLARGS,C'C'         OPTIONAL COST                                
         BNE   OUTBUY1                                                          
         MVI   34(R3),C'$'                                                      
         ICM   RF,15,BYCOST                                                     
         C     RF,=F'9999999'                                                   
         BH    OUTBUY0A                                                         
         EDIT  BYCOST,(9,35(R3)),2,ALIGN=LEFT,MINUS=YES                         
         B     OUTBUY1                                                          
OUTBUY0A EDIT  BYCOST,(9,35(R3)),ALIGN=LEFT,DROP=2,MINUS=YES                    
*                                                                               
OUTBUY1  LA    R4,198(R3)                                                       
         GOTO1 DAYUNPK,DMCB,(BYSEDAY,BYDAY),(0,3(R4))                           
         DS    0H                                                               
         GOTO1 UNTIME,(R1),BYTIME,12(R4)                                        
         MVC   26(17,R4),BYPROG                                                 
         LA    R4,198(R4)                                                       
         CLI   BYPKGIND,0                                                       
         BE    OUTBUY5                                                          
         LA    R4,198(R4)                                                       
         CLI   BYPKGIND,1          TEST PACKAGE MASTER                          
         BNE   *+14                                                             
         MVC   12(16,R4),=C'*PACKAGE MASTER*'                                   
         B     OUTBUY4A                                                         
         CLI   BYPKGIND,5          TEST REVISION MASTER                         
         BNE   *+14                                                             
         MVC   12(17,R4),=C'*REVISION MASTER*'                                  
         B     OUTBUY4A                                                         
         CLI   BYPKGIND,2          TEST PACKAGE SLAVE                           
         BNE   *+14                                                             
         MVC   12(4,R4),=C'PKG='                                                
         B     OUTBUY2                                                          
         CLI   BYPKGIND,6          OR REVISION SLAVE                            
         BNE   OUTBUY4                                                          
         MVC   12(4,R4),=C'REV='                                                
*                                                                               
OUTBUY2  EDIT  BYLINE1,(3,16(R4)),FILL=0   YES-EDIT THE MASTER LINE NUM         
         B     OUTBUY4A                                                         
*                                                                               
OUTBUY4  CLI   BYPKGIND,8          TEST MAKEGOOD SLAVE                          
         BNE   OUTBUY5                                                          
         MVC   12(12,R4),=C'M/G FOR LINE'   YES-                                
         EDIT  BYLINE2,(3,25(R4)),FILL=0    EDIT THE MAKEGOOD MASTER            
         OC    BYMGDATE,BYMGDATE                                                
         BZ    OUTBUY4A                                                         
         GOTO1 DATCON,DMCB,(2,BYMGDATE),(4,29(R4))   MAKEGOOD DATE              
         CLI   BYMGSPOT,1                                                       
         BNH   OUTBUY4A                                                         
         MVI   34(R4),C'-'                                                      
         EDIT  BYMGSPOT,(2,35(R4)),FILL=0            MAKEGOOD SPOT NUM          
*                                                                               
OUTBUY4A LA    R4,198(R4)                                                       
*                                                                               
OUTBUY5  TM    BYIND,BYICOM+BYIMG  TEST NEED COMMENTS OR MAKEGOOD               
         BZ    OUTBUYX                                                          
         XC    KEY,KEY             YES-READ THE BUY RECORD                      
         MVC   KEY+14(4),BYDA                                                   
         MVC   AIO,AIO2                                                         
         GOTO1 GETREC                                                           
         TM    BYIND,BYIMG         TEST MAKEGOOD ACTIVITY                       
         BZ    OUTBUY6                                                          
         L     RF,=A(MGAREA)       NO-GET TABLE OF NEW MAKEGOODS                
         USING MGABLKD,RF                                                       
         XC    0(256,RF),0(RF)                                                  
         MVI   MGAACT,MGAQBLN      BUILD A BUYLINE TABLE                        
         MVC   MGAACOM,SBCOMFAC                                                 
         LA    RE,((MGALNQ+7)/8)*8  GET PARM LEN IN DBLWDS                      
         AR    RE,RF                                                            
         ST    RE,MGATAB           TABLE IS BEYOND PARM AREA                    
         XC    0(MGERECL,RE),0(RE)                                              
         MVC   MGATABLN,=H'20000'                                               
         MVC   MGABUY,AIO2                                                      
         GOTO1 BLDMGN,(RF)                                                      
         L     RF,=A(MGAREA)                                                    
         CLI   MGAERR,0                                                         
         BE    *+14                                                             
         CLI   MGAERR,MGAQDMIS                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         L     R1,MGATAB                                                        
         USING MGENTRYD,R1                                                      
         DROP  RF                                                               
         XC    0(2,RF),0(RF)                                                    
         SR    R0,R0                                                            
         XC    FULL,FULL                                                        
*                                                                               
OUTBUY5A OC    0(MGERECL,R1),0(R1)  LOOP THRU MAKEGOOD ENTRIES                  
         BZ    OUTBUY6                                                          
         CLC   MGECODE,=C'PR'      IGNORE MISSED NOT MADEGOOD                   
         BE    OUTBUY5F                                                         
         CLI   MGETYPE,1           TEST MAKEGOOD LINE                           
         BNE   OUTBUY5B                                                         
         LTR   R0,R0               YES-PRINT MAKEGOOD LINE ONCE                 
         BNZ   OUTBUY5F                                                         
         LA    R0,1                                                             
         MVC   0(17,R4),=C'MAKEGOOD GROUP = '                                   
         MVC   17(2,R4),MGECODE                                                 
         LA    R4,198(R4)                                                       
*                                                                               
OUTBUY5B CLI  MGETYPE,0            TEST MISSED SPOT                             
         BNE  OUTBUY5F                                                          
         LR   RE,RF                                                             
*                                                                               
OUTBUY5C OC   0(2,RE),0(RE)        YES-PRINT EACH MAKEGOOD CODE ONCE            
         BZ   OUTBUY5D                                                          
         CLC  0(2,RE),MGECODE                                                   
         BE   OUTBUY5F                                                          
         LA   RE,2(RE)                                                          
         B    OUTBUY5C                                                          
*                                                                               
OUTBUY5D MVC  0(2,RE),MGECODE                                                   
         XC   2(2,RE),2(RE)                                                     
         ICM  RE,15,FULL                                                        
         BZ   OUTBUY5E                                                          
         MVC  0(2,RE),=C', '                                                    
         LA   RE,2(RE)                                                          
         LA   R5,2(R5)                                                          
         B    *+18                                                              
*                                                                               
OUTBUY5E MVC  0(15,R4),=C'MISSED GROUP = '                                      
         LA   RE,15(R4)                                                         
         LA   R5,15                                                             
*                                                                               
         CHI  R5,40                 HAVE ENOUGH ROOM TO PRINT ONE MORE?         
         BNH  *+12                  YES                                         
         LA   R4,198(R4)            NO - BUMP TO NEXT LINE                      
         LR   RE,R4                 BEGIN PRINTING HERE                         
         XR   R5,R5                                                             
*                                                                               
         MVC  0(2,RE),MGECODE                                                   
         LA   RE,2(RE)                                                          
         LA   R5,2(R5)                                                          
         ST   RE,FULL                                                           
*                                                                               
OUTBUY5F LA    R1,MGERECL(R1)                                                   
         B     OUTBUY5A                                                         
         DROP  R1                                                               
*                                                                               
OUTBUY6  TM    BYIND,BYICOM        TEST FOR COMMENTS                            
         BZ    OUTBUYX                                                          
         LA    R5,BDELEM-BUYRECD(R5)                                            
         SR    R0,R0                                                            
*                                                                               
OUTBUY7  CLI   0(R5),0             FIND COMMENT ELEMENTS                        
         BE    OUTBUYX                                                          
         CLI   0(R5),X'66'                                                      
         BNE   OUTBUY8                                                          
         USING COMELEM,R5                                                       
         LLC   R6,CMLEN                                                         
         SHI   R6,(CMDATA-COMELEM)                                              
         BNP   OUTBUY8                                                          
         GOTO1 CHOPPER,DMCB,((R6),CMDATA),(MYOLEN,(R4)),(198,4)                 
         ICM   RF,15,8(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         LA    R4,198(R4)                                                       
         BCT   RF,*-4                                                           
*                                                                               
OUTBUY8  IC    R0,1(R5)                                                         
         AR    R5,R0                                                            
         B     OUTBUY7                                                          
         DROP  R5                                                               
*                                                                               
OUTBUYX  B     XIT2                                                             
         EJECT                                                                  
* MARKET OUTPUT ROUTINE                                                         
* OUTPUT : CC EQ - OK                                                           
*             NE - SUPPRES THE PRINT LINE                                       
*                                                                               
OUTMKT   CLI   GLARGS,C'N'         ** MARKET **                                 
         BNE   *+8                                                              
         LA    R2,8(R2)                                                         
         CLC   0(2,R2),XFFS        TEST DETAIL TOTAL                            
         BE    OUTMKTX                                                          
         CLC   0(2,R2),=X'FFFD'    TEST 'ALL' MARKETS                           
         BNE   *+12                                                             
         MVI   PRTSW,C'N'          YES-SUPPRESS PRINT LINE                      
         B     OUTMKT99                                                         
         MVC   SBBMKT,0(R2)        SET BINARY MARKET                            
         TM    ROWIND2,ROWIRANK    IF RANK IS A ROW,                            
         BNZ   OUTMKT2              ALWAYS SET MARKET DETAILS                   
         L     RF,GLADTENT                                                      
         USING DROD,RF                                                          
         L     RE,GLATHID                                                       
         CLC   DROLEV,GLDETLEV-GLINTD(RE)   TEST MARKET IS DETAIL LEVEL         
         BNE   OUTMKT4                                                          
         DROP  RF                                                               
         NI    OUTIND,FF-OUTICRMK          NOT ACROSS MARKETS                   
         CLC   SBBMKT,=X'FFFE'             TEST NETWORKS                        
         BNE   OUTMKT2                                                          
         MVC   SBMKT,XF0S                                                       
         MVC   SBMKTNM,FILLER                                                   
         MVC   SBMKTNM(8),=C'NETWORKS'                                          
         B     OUTMKT4                                                          
*                                                                               
OUTMKT2  EDIT  SBBMKT,(4,SBMKT),FILL=0     YES - SET MARKET DETAILS             
         GOTO1 GETMKTNM                    (WE DIDN'T GET MARKET FIRST)         
         CLI   SBQMKTWT,C'N'               TEST MARKET WEIGHTING                
         BE    OUTMKT4                                                          
         GOTO1 GETMKTWT                    YES - GET THE MKT WGT                
*                                                                               
OUTMKT4  TM    ROWIND,ROWINOMK     TEST SUPPRESS MARKET DETAILS                 
         BZ    *+12                                                             
         MVI   PRTSW,C'N'          YES-SUPPRESS PRINT LINE                      
         B     OUTMKT99                                                         
*                                                                               
         CLI   GLARGS,C'T'                 REPORT MARKET TYPE?                  
         BNE   OUTMKT5                     NO                                   
         L     RF,ACOMFACS                 A(COMFACS)                           
         ICM   RF,15,CDEMTABS-COMFACSD(RF) A(DEMTABS)                           
         GOTO1 (RF),DMCB,NSIMKTS           GET A(NSI MKTS TABLE)                
         ICM   RF,15,0(R1)                 HAVE A(TABLE)IN P1?                  
         BNZ   *+6                         YES                                  
         DC    H'0'                        NO - DEATH                           
*                                                                               
         L     RE,4(R1)                    L'TABLE ENTRY IN P2                  
         USING NMKTD,RF                    NSI MARKET TABLE DSECT               
*                                                                               
OUTMKT4A CLI   0(RF),X'FF'                 END OF TABLE?                        
         BE    OUTMKTX                     YES - DONE                           
         CLC   NMKTNUM,2(R2)               MATCH ON NSI MARKET?                 
         BE    OUTMKT4B                    YES                                  
         AR    RF,RE                       BUMP TO NEXT TABLE ENTRY             
         B     OUTMKT4A                    PROCESS NEXT TABLE ENTRY             
*                                                                               
OUTMKT4B MVC   CODEAREA(15),NMKTDESC       MARKET TYPE DESCRIPTION              
         B     OUTMKTX                     DONE                                 
         DROP  RF                          DROP NMKTD USING                     
*                                                                               
OUTMKT5  MVC   LABLAREA(6),=C'MARKET'                                           
         LA    R1,NAMEAREA                                                      
         CLI   GLARGS,C'N'                                                      
         BE    OUTMKT6                                                          
         MVC   CODEAREA(4),SBMKT                                                
         CLI   GLARGS,C'C'                                                      
         BE    OUTMKT8                                                          
*                                                                               
OUTMKT6  MVC   NAMEAREA(L'SBMKTNM),SBMKTNM                                      
         LA    R1,L'SBMKTNM+1(R1)                                               
         CLI   MYLTYP,C'P'                                                      
         BE    OUTMKT7                                                          
         CLI   MYLTYP,C'H'         TEST HEADLINE WITH MARKET COVERAGE           
         BNE   OUTMKT8             AND SPILL OR ORIG                            
         CLI   SBQMKTWT,C'N'                                                    
         BE    OUTMKT8                                                          
         CLI   2(R2),C'O'                                                       
         BE    *+12                                                             
         CLI   2(R2),C'S'                                                       
         BNE   OUTMKT8                                                          
         LA    R1,NAMEAREA+18      YES-LEAVE ENOUGH ROOM IN HEADLINE            
         MVI   NAMEAREA+17,C' '                                                 
         B     OUTMKT8                                                          
*                                                                               
OUTMKT7  LLC   RF,MYOLEN                                                        
         CLI   GLARGS,C'B'                                                      
         BNE   *+8                                                              
         SHI   RF,5                                                             
         SHI   RF,10                                                            
         BNP   OUTMKT8                                                          
         LA    R1,NAMEAREA(RF)                                                  
*                                                                               
OUTMKT8  CLI   2(R2),C'O'          TEST ORIGINATING MARKET                      
         BNE   OUTMKT10                                                         
         CLI   MYLTYP,C'P'         YES-TEST MARKET IN HEADLINES OR MID          
         BE    OUTMKT9                                                          
         MVC   0(6,R1),=C'*ORIG*'  YES                                          
         LA    R1,7(R1)                                                         
         B     OUTMKT12                                                         
*                                                                               
OUTMKT9  CLI   GLARGS,C'C'         MARKET IN DETAIL - TEST CODE ONLY            
         BNE   *+14                                                             
         MVC   198(4,R3),=C'*OR*'                     YES                       
         B     OUTMKT12                                                         
         LA    R1,NAMEAREA+17                                                   
         CLI   SBQMKTWT,C'N'                                                    
         BE    *+8                                                              
         LA    R1,NAMEAREA+7                                                    
         MVI   0(R1),C' '                                                       
         MVC   1(6,R1),=C'*ORIG*'                                               
         LA    R1,7(R1)                                                         
         B     OUTMKT12                                                         
*                                                                               
OUTMKT10 CLI   2(R2),C'S'          TEST SPILL MARKET                            
         BNE   OUTMKT12                                                         
         CLI   MYLTYP,C'P'                                                      
         BE    OUTMKT11                                                         
         MVC   0(7,R1),=C'*SPILL*'                                              
         LA    R1,8(R1)                                                         
         B     OUTMKT12                                                         
*                                                                               
OUTMKT11 CLI   GLARGS,C'C'                                                      
         BNE   *+14                                                             
         MVC   198(4,R3),=C'*SP*'                                               
         B     OUTMKT12                                                         
         LA    R1,NAMEAREA+16                                                   
         CLI   SBQMKTWT,C'N'                                                    
         BE    *+8                                                              
         LA    R1,NAMEAREA+6                                                    
         MVI   0(R1),C' '                                                       
         MVC   1(7,R1),=C'*SPILL*'                                              
         LA    R1,8(R1)                                                         
*                                                                               
OUTMKT12 CLI   GLARGS,C'C'                                                      
         BE    OUTMKTX                                                          
         CLI   SBQMKTWT,C'N'       TEST MARKET WEIGHTING                        
         BE    OUTMKTX                                                          
         ICM   R5,15,SBMKTWGT      YES-DISPLAY COVERAGE                         
         CLI   MYLTYP,C'M'                                                      
         BNE   OUTMKT14                                                         
         MVC   GLMIDXTR,FILLER                                                  
         MVC   GLMIDXTR(9),=C'COVERAGE='                                        
         LA    R6,GLMIDXTR+9                                                    
         B     OUTMKT16                                                         
*                                                                               
OUTMKT14 CLI   MYLTYP,C'H'                                                      
         BE    *+12                                                             
         MVI   0(R1),C' '                                                       
         LA    R1,1(R1)                                                         
         MVC   0(4,R1),=C'CVG='                                                 
         LA    R6,4(R1)                                                         
*                                                                               
OUTMKT16 EDIT  (R5),(6,(R6)),2,ALIGN=LEFT                                       
         AR    R6,R0                                                            
         CLI   MYLTYP,C'P'         TEST DETAIL LINE                             
         BNE   OUTMKT18                                                         
         LA    R1,NAMEAREA+L'NAMEAREA  YES-CLEAR REST TO SPACES                 
         SR    R1,R6                                                            
         BNP   OUTMKTX                                                          
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R6),FILLER                                                   
         B     OUTMKTX                                                          
*                                                                               
OUTMKT18 CLI   MYLTYP,C'H'                                                      
         BNE   OUTMKTX                                                          
         LA    R1,L'NAMEAREA                                                    
         ST    R1,DMCB+4                                                        
         GOTO1 SQUASHER,DMCB,NAMEAREA                                           
         B     OUTMKTX                                                          
*                                                                               
OUTMKT99 LTR   RB,RB                                                            
         B     XIT2                                                             
*                                                                               
OUTMKTX  CR    RB,RB                                                            
         B     XIT2                                                             
         EJECT                                                                  
* MARKET RANK OUTPUT ROUTINE                                                    
*                                                                               
OUTMKTRK SR    R0,R0                                                            
         LLC   R1,0(R2)                                                         
         D     R0,=F'10'                                                        
         LTR   R0,R0               TEST THIS IS A CUME LINE                     
         BNZ   *+12                                                             
         STC   R1,SVMKTRNK         NO-SAVE THE MARKET RANK CODE                 
         B     OMKTRNK2                                                         
         TM    GLINDS,GLTOTLIN     YES-TEST TOTAL LINE                          
         BO    *+12                                                             
         OI    SVMKTRNK,X'80'      NO-INDICATE WE'RE CUMING NOW                 
         B     OMKTRNK9               AND SUPPRESS THE DETAIL LINE              
         TM    OUTIND,OUTIMRTO     YES-TEST IT'S MKTRNK TOTAL                   
         BZ    OMKTRNK9            NO-SUPPRESS OTHER TOTALS                     
         LLC   RE,SVMKTRNK         YES-TEST THERE WERE DETAILS                  
         SLL   RE,25                                                            
         SRL   RE,25                                                            
         CR    R1,RE                                                            
         BNE   OMKTRNK9            NO-SUPPRESS                                  
*                                                                               
OMKTRNK2 MVC   LABLAREA(11),=C'MARKET RANK'                                     
         MVC   NAMEAREA(8),=C'MARKETS '                                         
         BCTR  R1,0                                                             
         MHI   R1,6                                                             
         LTR   R0,R0                                                            
         BNZ   *+12                                                             
         LA    R1,MKTRNKTB(R1)                                                  
         B     OMKTRNK4                                                         
         CLI   0(R2),75                                                         
         BNE   *+14                                                             
         MVC   NAMEAREA(11),=C'ALL MARKETS'                                     
         B     OMKTRNKX                                                         
         LA    R1,TMKRKTAB-6(R1)                                                
*                                                                               
OMKTRNK4 MVC   NAMEAREA+8(6),0(R1)                                              
         B     OMKTRNKX                                                         
*                                                                               
OMKTRNK9 MVI   PRTSW,C'N'                                                       
         LTR   RB,RB               RETURN CC NE                                 
         B     XIT2                                                             
*                                                                               
OMKTRNKX CR    RB,RB               RETURN CC EQ                                 
         B     XIT2                                                             
*                                                                               
MKTRNKTB DC    CL6'1-10  '                                                      
         DC    CL6'11-20 '                                                      
         DC    CL6'21-30 '                                                      
         DC    CL6'31-40 '                                                      
         DC    CL6'41-50 '                                                      
         DC    CL6'51-100'                                                      
         DC    CL6'101+  '                                                      
         EJECT                                                                  
* MARKET RANK TOTAL ROUTINE                                                     
*                                                                               
TOTMKTRK CLI   GLARGS,C'H'                                                      
         BE    TMKTRNK2                                                         
         CLI   GLARGS,C'M'                                                      
         BE    TMKTRNK2                                                         
         LLC   RF,GLARGS                                                        
         LA    RF,ROWWIDS-1(RF)                                                 
         LLC   R1,0(RF)                                                         
         STC   R1,BYTE                                                          
         LLC   RE,ROWWIDTH         ADJUST R3=A(ROW TO RIGHT OF                  
         CLI   GLARGS,1                        TOTALING ROW)                    
         BNH   *+10                                                             
         BCTR  RF,0                                                             
         IC    RE,0(RF)                                                         
         SR    RE,R1                                                            
         LA    R3,0(RE,R3)                                                      
         B     TMKTRNK4                                                         
*                                                                               
TMKTRNK2 MVC   BYTE,ROW1WIDE                                                    
         CLI   BYTE,7                                                           
         BNL   TMKTRNK4                                                         
         MVC   BYTE,ROWWIDTH                                                    
*                                                                               
TMKTRNK4 CLI   BYTE,6                                                           
         BL    TMKTRNK9                                                         
         MVC   BLOCK(80),FILLER                                                 
         CLI   SVMKTRNK,X'87'      TEST ALL MARKETS                             
         BNE   TMKTRNK6                                                         
         MVC   BLOCK(3),=C'ALL'                                                 
         MVC   BLOCK+4(4),=C'MKTS'                                              
         CLI   BYTE,7                                                           
         BL    *+10                                                             
         MVC   BLOCK+4(7),=C'MARKETS'                                           
         MVC   BLOCK+12(5),=C'TOTAL'                                            
         B     TMKTRNK8                                                         
*                                                                               
TMKTRNK6 MVC   BLOCK(4),=C'MKTS'                                                
         CLI   BYTE,7                                                           
         BL    *+10                                                             
         MVC   BLOCK(7),=C'MARKETS'                                             
         LLC   R1,SVMKTRNK                                                      
         SLL   R1,25                                                            
         SRL   R1,25                                                            
         BCTR  R1,0                                                             
         MHI   R1,6                                                             
         TM    SVMKTRNK,X'80'                                                   
         BZ    *+12                                                             
         LA    R1,TMKRKTAB-6(R1)                                                
         B     TMKTRNK7                                                         
         CLI   GLARGS,C'H'                                                      
         BE    *+12                                                             
         CLI   GLARGS,C'M'                                                      
         BNE   TMKTRNK9                                                         
         LA    R1,MKTRNKTB(R1)                                                  
*                                                                               
TMKTRNK7 MVC   BLOCK+8(6),0(R1)                                                 
         MVC   BLOCK+15(5),=C'TOTAL'                                            
*                                                                               
TMKTRNK8 GOTO1 SQUASHER,DMCB,BLOCK,80                                           
         LA    R4,4                                                             
         GOTO1 CHOPPER,(R1),(80,BLOCK),(BYTE,0(R3)),(198,(R4))                  
         B     XIT2                                                             
*                                                                               
TMKTRNK9 MVI   GLHOOK,GLEDIT       LET DRIVER EDIT                              
         B     XIT2                                                             
*                                                                               
TMKRKTAB DC    CL6'1-20'                                                        
         DC    CL6'1-30'                                                        
         DC    CL6'1-40'                                                        
         DC    CL6'1-50'                                                        
         DC    CL6'1-100'                                                       
         EJECT                                                                  
* DAYPART/LENGTH OUTPUT ROUTINE                                                 
*                                                                               
OUTDPTLN CLI   1(R2),C''          SUPPRESS $ DAYPARTS                          
         BE    DL99                                                             
         CLI   5(R2),C''                                                       
         BE    DL99                                                             
         OI    OUTIND,OUTICRDP+OUTIDTOT                                         
         MVC   0(10,R3),FILLER                                                  
         CLC   0(9,R2),XFFS                                                     
         BNE   DL10                                                             
         CP    DLCNTR,=P'1'        TEST FOR MORE THAN ONE DETAIL                
         BNH   DL99                                                             
         TM    SBQDPTLN,SBQDLTOT   TEST FOR SPOT LENGTH TOTALS                  
         BZ    *+12                                                             
         CLI   SLCNTRS+2,0         YES - TEST FOR MORE THAN 1 SPTLEN            
         BE    DL99                      NO - DON'T PRINT TOTAL                 
         MVC   1(9,R3),=C'* TOTAL *'                                            
         B     DLX                                                              
*                                                                               
DL10     CLC   0(8,R2),XFFS        SPOT LENGTH TOTAL                            
         BNE   DL40                                                             
         CLI   8(R2),1             TEST LEN=1                                   
         BE    DL99                YES-DROP IT                                  
         LA    R0,L'SLCNTRS/2                                                   
         LA    R1,SLCNTRS                                                       
*                                                                               
DL20     CLC   0(1,R1),8(R2)                                                    
         BE    DL30                                                             
         LA    R1,2(R1)                                                         
         BCT   R0,DL20                                                          
*         DC    H'0'                                                            
         B     DL99                IF NOT FOUND, ONLY $ DPTS                    
*                                                                               
DL30     CP    1(1,R1),=P'1'                                                    
         BNH   DL99                                                             
         MVC   1(6,R3),=C'TOTAL-'                                               
         B     DL97                                                             
*                                                                               
DL40     NI    OUTIND,FF-OUTICRDP  NOT CROSS DPT TOTAL                          
         CLC   4(5,R2),XFFS        DAYPART GROUP TOTAL                          
         BNE   DL50                                                             
         CP    DPTCNTR,=P'1'       TEST FOR MORE THAN ONE DPT IN GRP            
         BNH   DL99                                                             
         MVC   0(3,R3),1(R2)                                                    
         MVI   3(R3),C'-'                                                       
         MVC   4(6,R3),=C'TOTAL*'                                               
         B     DLX                                                              
*                                                                               
DL50     CLI   8(R2),X'FF'         TEST FOR DAYPART TOTAL                       
         BE    DL95                                                             
         NI    OUTIND,FF-OUTIDTOT  NOT DAYPART TOTAL                            
         CP    DLCNTR,=P'2'        AUGMENT DPTLEN DETAIL COUNTER                
         BNL   *+10                                                             
         AP    DLCNTR,=P'1'                                                     
         LA    R0,L'SLCNTRS/2      AUGMENT APPROPRIATE SPOT LENGTH CNTR         
         LA    R1,SLCNTRS                                                       
*                                                                               
DL60     CLI   0(R1),0                                                          
         BE    DL70                                                             
         CLC   0(1,R1),8(R2)                                                    
         BE    DL80                                                             
         LA    R1,2(R1)                                                         
         BCT   R0,DL60                                                          
         DC    H'0'                                                             
*                                                                               
DL70     MVC   0(1,R1),8(R2)                                                    
         ZAP   1(1,R1),=P'0'                                                    
*                                                                               
DL80     CP    1(1,R1),=P'2'                                                    
         BNL   *+10                                                             
         AP    1(1,R1),=P'1'                                                    
         MVI   7(R3),C'-'                                                       
         CP    LENCNTR,=P'1'       TEST LENGTH COUNTER = 1                      
         BNE   *+14                                                             
         CLC   LENSV,8(R2)         AND LENGTH SAME AS LAST                      
         BE    DL82                YES-AVOID INCREMENTING LEN COUNTER           
         MVC   LENSV,8(R2)                                                      
         CP    LENCNTR,=P'2'       INCREMENT LENGTH COUNTER                     
         BNL   DL82                                                             
         AP    LENCNTR,=P'1'                                                    
*                                                                               
DL82     TM    DOWNOPT,GLDLACTV    DOWNLOAD?                                    
         BNZ   *+12                 YES                                         
         TM    GLINDS2,GLPWHOLE    SOLID?                                       
         BZ    *+14                 NO                                          
         MVC   4(3,R3),5(R2)       ALWAYS PRINT AS FULL DPT-LEN                 
         MVI   7(R3),C'-'                                                       
*                                                                               
         CP    LENCNTR,=P'1'       IS IT GREATER THAN 1                         
         BH    DL97                                                             
         OC    1(3,R2),1(R2)       NO - FORMAT THE DAYPART                      
         BZ    DL90                                                             
         CLC   DPTGRPSV,1(R2)      TEST FOR NEW DAYPART GROUP                   
         BE    DL90                                                             
         ZAP   DPTCNTR,=P'0'       RESET DPT COUNTER                            
         MVC   DPTGRPSV,1(R2)                                                   
         MVC   0(3,R3),1(R2)                                                    
         MVI   3(R3),C'-'                                                       
*                                                                               
DL90     MVC   4(3,R3),5(R2)                                                    
         CP    DPTCNTR,=P'2'       AUGMENT DAYPART COUNTER                      
         BNL   *+10                                                             
         AP    DPTCNTR,=P'1'                                                    
         B     DL97                                                             
*                                                                               
DL95     CP    LENCNTR,=P'1'       DAYPART TOTAL                                
         BNH   *+14                - ONLY PRINT IF MORE THAN 1 LENGTH           
         MVC   7(3,R3),=C'TOT'                                                  
         B     *+8                                                              
         MVI   PRTSW,C'N'                                                       
         ZAP   LENCNTR,=P'0'       INIT LENGTH COUNTER                          
         MVI   LENSV,0                                                          
         B     DLX                                                              
*                                                                               
DL97     CLI   8(R2),100              EDIT THE SPOT LENGTH                      
         BNL   DL98                                                             
         EDIT  (1,8(R2)),(2,8(R3))                                              
         B     DLX                                                              
DL98     EDIT  (1,8(R2)),(3,7(R3))                                              
         B     DLX                                                              
*                                                                               
DL99     MVI   PRTSW,C'N'          DON'T PRINT                                  
*                                                                               
DLX      B     XIT2                                                             
         EJECT                                                                  
* ROUTINE TO FORMAT N'MARKETS AND TOTAL MARKET WEIGHT TO TOTAL LINE             
* INPUT  : R1=A(PRINT POSITION)                                                 
*          R4=N'MARKETS                                                         
*          R5=TOTAL WEIGHT                                                      
*          R6=MAX PRINT WIDTH                                                   
* OUTPUT : CC EQ - OK                                                           
*             NE - NOT ENOUGH ROOM                                              
*                                                                               
FMTWGT   DS    0H                                                               
         LR    R2,R1                                                            
         MVC   PARAS(10),BLANKS                                                 
         EDIT  (R4),(3,PARAS),ALIGN=LEFT                                        
         LA    R1,5                                                             
         AR    R1,R0                                                            
         EDIT  (R5),(6,PARAS+3),2,ALIGN=LEFT                                    
         LA    RE,4                                                             
         AR    RE,R0                                                            
         CR    R1,RE                                                            
         BNL   *+6                                                              
         LR    R1,RE                                                            
         CR    R1,R6                                                            
         BH    FMTWGT2                                                          
         MVC   0(5,R2),=C'MKTS='                                                
         MVC   5(3,R2),PARAS                                                    
         MVC   9(4,R2),=C'CVG='                                                 
         MVC   13(6,R2),PARAS+3                                                 
         CR    RB,RB                                                            
         B     FMTWGTX                                                          
*                                                                               
FMTWGT2  LTR   RB,RB                                                            
*                                                                               
FMTWGTX  B     XIT2                                                             
         EJECT                                                                  
*                                                                               
*                                                                               
HDEMH12  DS    0H                  FORMAT DEMO AND CPP HEADS 1 AND 2            
         CLI   GLARGS+15,1         GLARGS+15=HEADLINE NUMBER                    
         BNE   HDH2                                                             
         MVC   0(7,R3),BLANKS                                                   
         GOTO1 AGETDEM,DEMONAME    GET DEMO NAME                                
         BNE   HDHX                                                             
         CLI   GLARGS+1,C'U'                                                    
         BNE   *+14                                                             
         MVC   0(7,R3),=C'UPGRADE'                                              
         B     HDHX                                                             
         CLI   GLARGS+1,C'G'                                                    
         BNE   *+14                                                             
         MVC   0(7,R3),=C'GOAL   '                                              
         B     HDHX                                                             
         CLI   GLARGS+1,C'K'                                                    
         BNE   *+14                                                             
         MVC   0(11,R3),=C'GOAL LOCKED'                                         
         B     HDHX                                                             
         CLI   GLARGS+1,C'N'                                                    
         BNE   *+14                                                             
         MVC   0(8,R3),=C'NET GOAL'                                             
         B     HDHX                                                             
         CLI   GLARGS+1,C'O'                                                    
         BNE   *+14                                                             
         MVC   0(7,R3),=C'ORDERED'                                              
         B     HDHX                                                             
         CLI   GLARGS+1,C'P'                                                    
         BNE   *+14                                                             
         MVC   0(7,R3),=C'PURCH  '                                              
         B     HDHX                                                             
         CLI   GLARGS+1,C'C'                                                    
         BNE   *+14                                                             
         MVC   0(7,R3),=C'COST2  '                                              
         B     HDHX                                                             
         CLI   GLARGS+1,C'D'                                                    
         BNE   *+14                                                             
         MVC   0(7,R3),=C'NETCOS2'                                              
         B     HDHX                                                             
         CLI   GLARGS+1,C'R'                                                    
         BNE   *+14                                                             
         MVC   0(7,R3),=C'ACHVD  '                                              
         B     HDHX                                                             
         CLI   GLARGS+1,C'A'                                                    
         BNE   *+14                                                             
         MVC   0(7,R3),=C'AFDVT  '                                              
         B     HDHX                                                             
         CLI   GLARGS+1,C'0'       CHECK FOR SQUAD CPP                          
         BL    *+8                                                              
         B     HDHX                                                             
         CLI   GLARGS+1,C'L'                                                    
         BNE   *+14                                                             
         MVC   0(7,R3),=C'LOCKIN '                                              
         B     HDHX                                                             
         CLI   GLARGS+1,C'V'       UNIVERSE KEYWORDS?                           
         BE    *+6                 YES                                          
         DC    H'0'                                                             
         MVC   0(7,R3),=C'UNIV   '                                              
         B     HDHX                                                             
*                                                                               
HDH2     CLI   GLARGS+15,2         HEAD2                                        
         BNE   HDHX                                                             
         MVC   0(7,R3),BLANKS                                                   
         TM    DOWNOPT,GLDLACTV    IF DOWNLOADING,                              
         BZ    HDH22                                                            
         GOTO1 AGETDEM,DEMONAME    NEED TO GET DEMO NAME AGAIN                  
         BNE   HDHX                                                             
HDH22    OC    DEMONAME,DEMONAME                                                
         BZ    HDHX                                                             
         MVC   0(7,R3),DEMONAME                                                 
*                                                                               
HDHX     B     XIT2                                                             
*                                                                               
         EJECT                                                                  
HDEM2    DS    0H                                                               
         CLI   GLARGS+15,2                                                      
         BH    HDEM3                                                            
         GOTO1 AHDEMH12            HEADS 1 AND 2                                
         B     XIT2                                                             
HDEM3    CLI   GLARGS+15,3         HEAD3                                        
         BNE   HD2                                                              
         CLI   GLARGS+4,C'B'       TEST BONUS DEMOS                             
         BNE   *+14                                                             
         MVC   0(6,R3),=C' BONUS'  YES                                          
         B     XIT2                                                             
         LA    R1,GLARGS                                                        
         USING GLARGSD,R1                                                       
         CLI   GLARGS+4,C'N'       TEST NON-ADJUSTED DEMOS                      
         BNE   HD1                                                              
         MVC   0(7,R3),=C' NONADJ' YES                                          
         TM    GLHIND,GLHIWGT                                                   
         BZ    XIT2                                                             
         LA    R3,198(R3)                                                       
*                                                                               
HD1      TM    GLHIND,GLHIWGT      TEST DEMO IS WEIGHTED                        
         BZ    HD4                                                              
         MVC   0(6,R3),=C' WGTED'  YES                                          
         B     XIT2                                                             
         DROP  R1                                                               
*                                                                               
HD2      CLI   GLARGS+15,4         HEAD4                                        
         BE    *+6                                                              
         DC    H'0'                                                             
         CLI   GLARGS+4,C'B'                                                    
         BNE   XIT2                                                             
*                                                                               
HD4      TM    DATAIND3,DIBOOK     TEST BOOK IS A ROW                           
         BO    XIT2                                                             
*                                                                               
         LR    R1,R9                                                            
         AHI   R1,SBQBOOK-SYSD                                                  
         OC    4(20,R1),4(R1)      NO - TEST MORE THAN ONE RERATE BOOK          
         BZ    XIT2                                                             
*                                                                               
         CLI   GLARGS+1,C'R'       YES- TEST RERATE OR AFFID                    
         BE    *+12                                                             
         CLI   GLARGS+1,C'A'                                                    
         BNE   XIT2                                                             
         BAS   RE,FMTBOOK          YES- FORMAT THE BOOK                         
         B     XIT2                                                             
*                                                                               
FMTBOOK  LR    R0,RE               FORMAT BOOK TO HEADLINE                      
         LR    R5,R9                                                            
         AHI   R5,SBQBOOK-SYSD                                                  
         LLC   RF,GLARGS+2         BOOK                                         
         CHI   RF,2                                                             
         BL    FMTBK2                                                           
         BCTR  RF,0                                                             
         MHI   RF,4                                                             
         AR    R5,RF                                                            
*                                                                               
FMTBK2   MVC   DUB(4),0(R5)                                                     
         MVC   DUB+4(2),=C'01'                                                  
         GOTO1 DATCON,DMCB,(0,DUB),(6,0(R3))                                    
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
         EJECT                                                                  
HCPP2    DS    0H                                                               
         CLI   GLARGS+15,2                                                      
         BH    HCPP3                                                            
         GOTO1 AHDEMH12            HEADS 1 AND 2                                
         B     XIT2                                                             
HCPP3    CLI   GLARGS+15,3         HEAD3                                        
         BE    HCPP3A                                                           
*                                                                               
         CLI   GLARGS+15,4                                                      
         BNH   *+6                                                              
         DC    H'0'                MAX 4 HEADLINES                              
*                                                                               
         CLI   GLARGS+1,C'1'       HEADING 4 ONLY AVAILABLE FOR SQAD            
         BNL   HCPP40                                                           
         B     HCPPX                                                            
*                                                                               
HCPP3A   DS    0H                                                               
*                                                                               
         MVC   0(7,R3),BLANKS                                                   
*                                                                               
         GOTO1 AGETDEM,DEMONAME    RESET DEMO NAME IN CASE >1 DEMO!             
*                                                                               
         OC    DEMONAME,DEMONAME                                                
         BZ    XIT2                                                             
*                                                                               
         CLI   GLARGS+2,C'N'       NET CPP?                                     
         BNE   *+14                                                             
         MVC   0(7,R3),=C'NET CPP'                                              
         B     HCPP4                                                            
*                                                                               
         CLI   GLARGS+1,C'1'       SQAD AVG CPP                                 
         BL    HCPP3B                                                           
*                                                                               
         LHI   RE,SBSQDQT1-SBLOCK                                               
*                                                                               
         XR    RF,RF               RF WAS NEVER CLEARED!                        
         ICM   RF,1,GLARGS+2       GET SQAD OPTION NUMBER                       
         BNZ   *+8                                                              
         LA    RF,1                   DEFAULT TO 1                              
*                                                                               
         BCTR  RF,0                DECREMENT FOR INDEXING                       
         MHI   RF,SBSQDOPL         INDEX TO SQAD OPTION                         
         CHI   RF,8                SQAD 3/4 OPTION?                             
         BL    *+12                NO                                           
         SHI   RF,8                YES - START AT INDEX 0 OR 4                  
         LHI   RE,SBSQDQT3-SBLOCK  SQAD 3/4 OPTIONS START HERE                  
*                                                                               
         LA    RE,SBLOCK(RE)       POINT TO SQAD OPTIONS                        
         LA    R1,0(RE,RF)         POINT TO SQAD OPTION                         
*                                                                               
*        PRINT SQAD QUARTER - YQ - BINARY AT 0(R1)                              
*                                                                               
SQAD02   MVC   2(1,R3),1(R1)       PRINT QUARTER                                
         OI    2(R3),X'F0'                                                      
*                                                                               
         MVI   3(R3),C'Q'          PRINT QUARTER SYMBOL                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,0(R1)          GET YEAR                                     
         CVD   RF,DUB              CVD                                          
         OI    DUB+7,X'0F'         FORCE SIGN                                   
         UNPK  FULL(3),DUB         PRINT YEAR                                   
         MVC   4(2,R3),FULL+1                                                   
*                                                                               
         B     HCPPX                                                            
*                                                                               
HCPP3B   DS    0H                                                               
*                                                                               
         MVC   2(3,R3),=C'CPP'                                                  
*                                                                               
HCPP4    DS    0H                                                               
*                                                                               
         CLI   DEMONAME,C'R'                                                    
         BE    XIT2                                                             
         CLI   DEMONAME,C'E'                                                    
         BE    XIT2                                                             
         CLI   GLARGS+2,C'N'       NET CPP?                                     
         BNE   *+12                                                             
         MVI   7(R3),C'M'                                                       
         B     XIT2                                                             
         MVI   4(R3),C'M'                                                       
         B     XIT2                                                             
*                                                                               
HCPP40   DS    0H                  PRINT SQAD RELEASE                           
*                                                                               
         LHI   RE,SBSQDQT1-SBLOCK                                               
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,GLARGS+2       GET SQAD OPTION NUMBER                       
         BNZ   *+8                                                              
         LA    RF,1                DEFAULT TO 1                                 
*                                                                               
         BCTR  RF,0                DECREMENT FOR INDEXING                       
         MHI   RF,SBSQDOPL         INDEX TO SQAD OPTION                         
         CHI   RF,8                SQAD 3/4 OPTION?                             
         BL    *+12                NO                                           
         SHI   RF,8                YES - START AT INDEX 0 OR 4                  
         LHI   RE,SBSQDQT3-SBLOCK  SQAD 3/4 OPTIONS START HERE                  
*                                                                               
         LA    RE,SBLOCK(RE)       POINT TO SQAD OPTIONS                        
         LA    R1,0(RE,RF)         POINT TO SQAD OPTION                         
*                                                                               
*        PRINT SQAD RELEASE - MMMYY                                             
*                                                                               
         XC    FULL,FULL                                                        
         MVC   FULL(2),2(R1)       MOVE RELEASE TO WORK AREA - YM BIN           
*                                                                               
         GOTO1 DATCON,DMCB,(3,FULL),(6,1(R3))                                   
*                                                                               
HCPPX    DS    0H                                                               
         B     XIT2                                                             
*                                                                               
         EJECT                                                                  
* GENERAL ROUTINE FOR OUTPUTTING GROUP CODES                                    
*                                                                               
OGRPCODE DS    0H                                                               
         UNPK  DUB(5),0(3,R2)                                                   
         ZICM  RF,0(R1),1                                                       
         BZ    OGRPCDX                                                          
         BCTR  RF,0                                                             
         LA    R1,CODEAREA+1       MGRPS CAN BE 2 CHARS NOW...                  
         CLI   0(R1),C' '                                                       
         BNH   *+8                                                              
         AHI   R1,1                                                             
         EX    RF,OGRPMVC                                                       
         CLC   0(2,R2),=X'9999'                                                 
         BNE   *+10                                                             
         MVC   NAMEAREA(L'UNKNOWN),UNKNOWN                                      
         CLC   0(2,R2),=X'9998'          TEST POSSIBLE 'NETWORKS' GROUP         
         BNE   OGRPCD2                                                          
         LA    RE,SBAGYREC               YES-TEST CANADIAN MEDIA C OR N         
         USING AGYRECD,RE                                                       
         CLI   AGYPROF+7,C'C'                                                   
         BNE   OGRPCD2                                                          
         CLI   SBMED,C'N'                                                       
         BE    *+12                                                             
         CLI   SBMED,C'C'                                                       
         BNE   OGRPCD2                                                          
         MVC   NAMEAREA(L'NETWORK2),NETWORK2    YES-IT'S THE NETWORKS           
         EX    RF,OGRPAST                                                       
         DROP  RE                                                               
*                                                                               
OGRPCD2  CLI   GLARGS,C'C'                                                      
         BNE   *+10                                                             
         MVC   NAMEAREA,BLANKS                                                  
         CLI   GLARGS,C'N'                                                      
         BNE   *+10                                                             
         MVC   CODEAREA,BLANKS                                                  
OGRPCDX  B     XIT2                                                             
*                                                                               
OGRPMVC  MVC   0(0,R1),DUB                                                      
OGRPAST  MVC   0(0,R1),=C'****'                                                 
NETWORK2 DC    C'**NETWORKS**'                                                  
*                                                                               
* OUTPUT ROUTINE FOR ESTIMATE                                                   
OUTEST   DS    0H                                                               
         CLI   GLARGS,C'N'                                                      
         BNE   *+8                                                              
         LA    R2,8(R2)                                                         
         CLC   0(3,R2),XFF         TEST DETAIL TOTAL                            
         BE    OUTESTX                                                          
         MVC   LABLAREA(8),=C'ESTIMATE'                                         
         MVC   SBBEST,1(R2)                                                     
         CLI   SBBEST,0            TEST ESTIMATE=0                              
         BNE   OEST1                                                            
* EST 0 OK FOR PG EST, CLEARANCE STATUS, AND INVOICE RECS                       
         TM    SBQREAD,SBQRDPG+SBQRDCLS+SBQRDINV                                
         BNZ   OEST1                                                            
         MVC   SBBEST,SBQEST       ESTIMATE MUST BE REQUEST START EST           
*                                                                               
OEST1    EDIT  SBBEST,(3,SBEST),FILL=0                                          
         CLI   SBQSEPES,C'Y'                                                    
         BE    OEST6                                                            
         CLC   SBQEST,SBQESTND                                                  
         BE    OEST6                                                            
         CLI   SBQEST,1                                                         
         BNE   OEST5                                                            
         CLI   SBQESTND,255                                                     
         BNE   OEST5                                                            
         MVC   CODEAREA(3),=C'ALL'                                              
         CLC   SBQESFLT,BLANKS     ESTIMATE FILTERING                           
         BNH   OUTESTX                                                          
         MVC   NAMEAREA(10),=C'FILTERED ('                                      
         LA    R0,L'SBQESFLT                                                    
         LA    R1,SBQESFLT                                                      
         LA    RE,C'1'                                                          
         LA    RF,NAMEAREA+10                                                   
*                                                                               
OEST2    CLI   0(R1),C'*'                                                       
         BE    OEST4                                                            
         CLI   0(R1),C' '                                                       
         BE    OEST4                                                            
         STC   RE,0(RF)                                                         
         MVI   1(RF),C'='                                                       
         TM    0(R1),X'40'         TEST NEGATIVE FILTER                         
         BO    *+12                                                             
         MVI   2(RF),C'-'                                                       
         LA    RF,1(RF)                                                         
         MVC   2(1,RF),0(R1)                                                    
         OI    2(RF),X'40'         INSURE UPPER CASE                            
         MVI   3(RF),C','                                                       
         LA    RF,4(RF)                                                         
*                                                                               
OEST4    LA    R1,1(R1)                                                         
         LA    RE,1(RE)                                                         
         BCT   R0,OEST2                                                         
         BCTR  RF,0                                                             
         MVI   0(RF),C')'                                                       
         B     OUTESTX                                                          
*                                                                               
OEST5    CLI   MYOLEN,7                                                         
         BNL   *+14                                                             
         MVC   CODEAREA(3),=C'ALL'                                              
         B     OUTESTX                                                          
         MVC   CODEAREA(3),SBEST                                                
         MVI   CODEAREA+3,C'-'                                                  
         EDIT  SBQESTND,(3,SBEST),FILL=0                                        
         MVC   CODEAREA+4(3),SBEST                                              
         B     OUTESTX                                                          
*                                                                               
OEST6    CLI   GLARGS,C'N'                                                      
         BE    OEST8                                                            
         MVC   CODEAREA(3),SBEST                                                
         CLI   GLARGS,C'C'                                                      
         BE    OUTESTX                                                          
*                                                                               
OEST8    CLI   SBBEST,0            TEST EST=0                                   
         BNE   OEST10                                                           
         MVC   NAMEAREA(11),UNKNOWN                                             
         TM    SBQREAD,SBQRDPG                                                  
         BZ    OUTESTX                                                          
         MVC   NAMEAREA(14),=C'* ESTIMATE 0 *'   FOR PG EST 0                   
         B     OUTESTX                                                          
*                                                                               
OEST10   MVC   SBBPRD,2(R2)        GETESTNM NEEDS PRODUCT                       
         GOTO1 GETESTNM                                                         
         BNE   OUTESTX                                                          
         CLI   GLARGS,C'D'                                                      
         BE    *+14                                                             
         MVC   NAMEAREA(L'SBESTNM),SBESTNM                                      
         B     OUTESTX                                                          
* EST DATES INSTEAD OF NAME                                                     
         GOTO1 DATCON,DMCB,(X'12',SBESTSTP),(5,NAMEAREA)                        
OUTESTX  B     XIT2                                                             
         EJECT                                                                  
*                                                                               
* OUTPUT ROUTINE FOR PRODUCT                                                    
OUTPRD   BRAS  RE,OPRODUCT                                                      
         J     XIT2                                                             
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
BUYKEYSV DC    XL13'00'                                                         
XFFS     DC    XL16'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF'                           
XF0S     DC    CL4'0000'                                                        
FILLER   DC    CL80' '                                                          
*                                                                               
SVMKTRNK DS    XL1                                                              
*                                                                               
BUYDET   DS    0XL(BYBLEN)                                                      
BUYDETC  DS    0XL(BYBLENC)                                                     
BYEST    DS    XL1                                                              
BYLINE1  DS    XL2                                                              
BYLINE2  DS    XL2                                                              
BYSTART  DS    XL3                                                              
BYEND    DS    XL3                                                              
BYWKS    DS    XL1                                                              
BYDPT    DS    CL1                                                              
BYLEN    DS    XL1                                                              
BYDAY    DS    XL1                                                              
BYTIME   DS    XL4                                                              
BYSEDAY  DS    XL1                                                              
BYPROG   DS    XL17                                                             
BYPKGIND DS    XL1                                                              
BYMGDATE DS    XL2                                                              
BYMGSPOT DS    XL1                                                              
BYIND    DS    XL1                                                              
BYICOM   EQU   X'80'               PRINT COMMENTS                               
BYIMG    EQU   X'40'               MAKEGOOD ACTIVITY                            
BYDA     DS    XL4                                                              
BYBLEN   EQU   *-BYEST             BUY BUFFER LENGTH                            
BYCOST   DS    XL4                 OPTIONAL COST                                
BYBLENC  EQU   *-BYEST             BUY BUFFER LENGTH WITH COST                  
*                                                                               
MYDEMOS  DC    80X'00'                                                          
NMYDEMOS EQU   8                                                                
*                                                                               
MATCHED  DS    C                                                                
         DS    0D                                                               
DBAREA   DS    CL256                                                            
         DS    0D                                                               
         DC    CL8'*MGAREA*'                                                    
MGAREA   DS    20256C               256 BYTE PARMS/20000 BYTE TABLE             
         SPACE 2                                                                
         DROP  R7,R8,RB                                                         
*                                                                               
OUTTGT   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   LABLAREA(6),=C'TARGET'                                           
         LA    R1,TGTDEM                                                        
         CLI   GLARGS,2                                                         
         BNE   *+12                                                             
         MVI   LABLAREA+6,C'2'                                                  
         LA    R1,TGTDEM2                                                       
         CLI   GLARGS,3                                                         
         BNE   *+12                                                             
         MVI   LABLAREA+6,C'3'                                                  
         LA    R1,TGTDEM3                                                       
         CLI   GLARGS,4                                                         
         BNE   *+12                                                             
         MVI   LABLAREA+6,C'4'                                                  
         LA    R1,TGTDEM4                                                       
         MVC   NAMEAREA(7),0(R2)                                                
         MVC   0(L'TGTDEM,R1),0(R2)                                             
*                                                                               
OTGTX    J     XIT                                                              
         DROP  RB                                                               
*                                                                               
BUYCOM   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVIY  MATCHED,C'N'                                                     
         L     R3,SBAIO1                                                        
         USING BUYRECD,R3                                                       
         LA    R1,BDELEM                                                        
*                                                                               
BC00     CLI   0(R1),0             END OF BUY RECORD?                           
         BE    BCX                 YES - NO COMMENT ELEMENT                     
         CLI   0(R1),X'66'         HAVE A COMMENT ELEMENT?                      
         BE    BC10                YES                                          
         LLC   R0,1(R1)                                                         
         AR    R1,R0                                                            
         B     BC00                                                             
*                                                                               
BC10     CLC   =C'MATCH=NO',3(R1)  MATCH=NO COMMENT?                            
         BNE   BCX                 YES - TREAT AS MATCHED!                      
         MVIY  MATCHED,C'Y'                                                     
*                                                                               
BCX      J     XIT                                                              
         DROP  RB                                                               
********************************************************************            
* GET MARKET GROUP SCHEME CODE                                     *            
********************************************************************            
         SPACE 1                                                                
MGRCODE  NTR1  BASE=*,LABEL=*                                                   
         LA    RF,SPMGRTAB                                                      
         LHI   RE,(SPMGRTBX-SPMGRTAB)/L'SPMGRTAB                                
         CLC   SBQMGRD,2(RF)                                                    
         BE    MGRC10                                                           
         AHI   RF,L'SPMGRTAB                                                    
         BCT   RE,*-14                                                          
         MVI   CODEAREA,C'?'                                                    
         B     MGRCX                                                            
*                                                                               
MGRC10   MVC   CODEAREA(2),0(RF)                                                
*                                                                               
MGRCX    J     XIT                                                              
       ++INCLUDE SPMGRTAB                                                       
         DROP  RB                                                               
********************************************************************            
* FORMAT MILITARY TIME > 2400 (24 HOURS)                           *            
********************************************************************            
FMTTIME  NTR1  BASE=*,LABEL=*                                                   
         LA    R2,2                                                             
         XR    R0,R0                                                            
*                                                                               
FTIM10   ICM   R0,3,0(R1)          START TIME                                   
         CHI   R0,2400             GREATER THAN 1 DAY (24 HOURS)?               
         BNH   *+8                 NO                                           
         SHI   R0,2400             YES - SUBTRACT 24 HOURS                      
*                                                                               
FTIM20   STCM  R0,3,0(R1)                                                       
         LA    R1,2(R1)                                                         
         BCT   R2,FTIM10                                                        
*                                                                               
         TM    OPTIND6,OPT6BCST    SORT STARTING AT 6AM?                        
         BZ    FTIMX               NO                                           
         SHI   R1,4                POINT TO START/END DATE                      
         ICM   R0,3,0(R1)          START TIME                                   
         CLI   SBMED,C'R'          RADIO?                                       
         BE    *+12                NO                                           
         CLI   SBMED,C'X'          NETWORK RADIO?                               
         BNE   *+12                NO                                           
         CHI   R0,500              START TIME BEFORE 5AM?                       
         B     *+8                 NO                                           
         CHI   R0,600              START TIME BEFORE 6AM?                       
         BNL   FTIMX               NO                                           
         AHI   R0,2400             YES - BUMP START/END TIME BY 1 DAY           
         STCM  R0,3,0(R1)                                                       
         ICM   R0,3,2(R1)                                                       
         BZ    FTIMX                                                            
         AHI   R0,2400                                                          
         STCM  R0,3,2(R1)                                                       
*                                                                               
FTIMX    J     XIT                                                              
         DROP  RB                                                               
********************************************************************            
* GET CLIENT GROUP SCHEME CODE                                     *            
********************************************************************            
         SPACE 1                                                                
CGRCODE  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         LA    RF,SPCGRTAB                                                      
         LHI   RE,(SPCGRTBX-SPCGRTAB)/3                                         
*                                                                               
CGRC05   CLC   SBQCGRD,2(RF)           SCHEME MATCH?                            
         BE    CGRC10                  YES                                      
         LA    RF,3(RF)                BUMP                                     
         BCT   RE,CGRC05               CHECK NEXT                               
*                                                                               
         MVI   CODEAREA,C'?'                                                    
         B     CGRCX                                                            
*                                                                               
CGRC10   MVC   CODEAREA(2),0(RF)                                                
*                                                                               
CGRCX    J     XIT                                                              
         SPACE 2                                                                
       ++INCLUDE SPCGRTAB                                                       
         DROP  RB                                                               
         EJECT                                                                  
         SPACE 2                                                                
********************************************************************            
* COMMON PERIOD INPUT ROUTINE                                      *            
********************************************************************            
*                                                                               
         USING SGLCHNKD,R5                                                      
INPER    NTR1  BASE=*,LABEL=*                                                   
         CLI   SBMODE,SBPROCBH                                                  
         BNE   IPER1                                                            
         XC    FULL,FULL                                                        
         MVC   FULL(2),BKEYYSRV-BKEY(R4)                                        
         MVI   FULL+2,1            SET A DAY!                                   
         GOTO1 DATCON,DMCB,(3,FULL),(2,HALF)                                    
         LA    R6,HALF                                                          
         B     IPER4                                                            
*                                                                               
IPER1    L     R6,SBACURCH                                                      
         CLI   SBMODE,SBPROCWP                                                  
         BNE   *+12                                                             
         LA    R6,2(R6)                                                         
         B     IPER4                                                            
*                                                                               
         CLI   SBMODE,SBPROCPW                                                  
         BNE   IPER1A                                                           
         CLI   0(R6),X'06'         PROCESSING BILLING ADJ?                      
         LA    R6,2(R6)                                                         
         BNE   IPER4                NO                                          
         CLI   GLARGS,C'W'         ONLY AN ISSUE FOR WEEKS                      
         BNE   IPER4                                                            
         MVI   4(R2),1             FORCE SEPERATE SORT RECORD                   
*                                                                               
* GET LAST DATE OF B'CAST MONTH OF BILLING ADJ S.T. IT WILL                     
* ALWAYS PRINT AFTER THE LAST WEEK PER OF THE MONTH                             
         GOTO1 DATCON,DMCB,(2,0(R6)),(0,DUB)                                    
         GOTO1 GETBROAD,(R1),(1,DUB),WORK,GETDAY,ADDAY                          
         GOTO1 DATCON,(R1),(0,WORK+6),(2,HALF)                                  
         LA    R6,HALF                                                          
         B     IPER4                                                            
*                                                                               
IPER1A   CLI   SBMODE,SBPROCNV                                                  
         BNE   IPER1B                                                           
         L     RE,SBAIO1                                                        
         LA    R6,HALF                                                          
         CLI   0(RE),X'0B'         OLD STYLE INVOICE REC?                       
         BNE   *+14                                                             
         MVC   HALF,INVKDAT-INVKEY(RE)                                          
         B     IPER4                                                            
*                                                                               
         MVC   HALF,SNVKMOS-SNVKEY(RE)    DEFAULT - PERIOD FROM KEY             
         XC    HALF,=X'FFFF'                                                    
*                                                                               
         CLI   0(R4),X'40'         IF DETAIL ELEM, GET DATE FROM THERE          
         BNE   IPER4                                                            
         LLC   R6,SNVIDDAY-SNVIDELD(R4)           # DAYS FROM START             
         GOTO1 DATCON,DMCB,(2,ELEM+25),(0,WORK)                                 
         GOTO1 ADDAY,(R1),WORK,WORK,(R6)          DATE OF DETAIL                
         GOTO1 DATCON,(R1),(0,WORK),(2,HALF)                                    
         LA    R6,HALF                                                          
         B     IPER4                                                            
*                                                                               
IPER1B   LA    R6,2(R6)                                                         
         CLI   SBMODE,SBPROCP2                                                  
         BE    IPER4                                                            
         LA    R6,SCDATE                                                        
         CLI   SBMODE,SBPROCSP                                                  
         BE    IPER4                                                            
         LA    R6,SGDATE                                                        
         CLI   SBMODE,SBPROCGL                                                  
         BE    IPER4                                                            
         LA    R6,SLDATE-SSLCHNKD(R4)                                           
         CLI   SBMODE,SBPROCSL                                                  
         BE    IPER4                                                            
         L     R6,SBACHUNK                                                      
         CLI   SBMODE,SBPROCES                                                  
         BE    IPER4                                                            
         LA    R6,HALF                                                          
         CLI   SBMODE,SBPROCB1                                                  
         BE    *+8                                                              
         CLI   SBMODE,SBPROCBL                                                  
         BE    *+8                                                              
         CLI   SBMODE,SBPROCCA                                                  
         BE    *+14                                                             
         MVC   0(4,R2),=X'FDFDFDFD'  DON'T BLOW UP                              
         B     IPX                                                              
         LR    RE,R5               BILLING RECORD-                              
         USING STABELEM,RE                                                      
         MVC   HALF,STABBDT                                                     
         CLI   DATEOPT,DOBILL      TEST DATE=BD                                 
         BE    IPER4               YES-USE BILLING DATE                         
         L     R1,ABILMNTH         NO-EXTRACT BILLING PERIOD START DATE         
         LA    R0,NBILMNTH            FROM BILLING MONTHS TABLE                 
*                                                                               
IPER2    OC    0(6,R1),0(R1)                                                    
         BZ    IPER12              NOT FOUND                                    
         CLC   STABPER,0(R1)                                                    
         BNE   *+14                                                             
         MVC   HALF,2(R1)                                                       
         B     IPER4                                                            
         LA    R1,6(R1)                                                         
         BCT   R0,IPER2                                                         
         DC    H'0'                                                             
         DROP  RE                                                               
*                                                                               
IPER4    XC    0(4,R2),0(R2)                                                    
         L     R1,ADAYS                                                         
         CLI   GLARGS,C'D'                                                      
         BE    IPER6                                                            
         L     R1,AWEEKS                                                        
         CLI   GLARGS,C'W'                                                      
         BE    IPER6                                                            
         CLI   GLARGS,C'F'         CHILD SPOT FLIGHTS USE WEEKS TABLE           
         BE    IPER6                                                            
         L     R1,AMONTHS                                                       
         CLI   GLARGS,C'M'                                                      
         BE    IPER6                                                            
         L     R1,AQTRS                                                         
         CLI   GLARGS,C'Q'                                                      
         BE    IPER6                                                            
         L     R1,AYEARS                                                        
         CLI   GLARGS,C'Y'                                                      
         BE    IPER6                                                            
         DC    H'0'                                                             
*                                                                               
IPER6    OC    0(4,R1),0(R1)                                                    
         BZ    IPER8                                                            
         CLC   0(2,R6),0(R1)                                                    
         BL    IPX                 BEFORE PERIOD                                
         CLC   0(2,R6),2(R1)                                                    
         BNH   IPER10                                                           
         LA    R1,4(R1)                                                         
         B     IPER6                                                            
*                                                                               
IPER8    MVC   0(4,R2),=X'FEFEFEFE'  AFTER PERIOD                               
         B     IPX                                                              
*                                                                               
IPER10   MVC   0(2,R2),0(R1)       PERIOD START                                 
         MVC   2(2,R2),2(R1)       PERIOD END                                   
         CLI   GLARGS+2,C'A'                                                    
         BNE   IPX                                                              
         XC    0(2,R2),0(R2)                                                    
         NI    2(R2),X'FF'-X'FE'   ZERO OUT END YEAR                            
         NI    3(R2),X'FF'-X'1F'   ZERO OUT END DAY                             
         B     IPX                                                              
*                                                                               
IPER12   MVC   0(4,R2),=X'FDFDFDFD' PERIOD UNKNOWN                              
*                                                                               
IPX      J     XIT                                                              
         DROP  R5,RB                                                            
         EJECT                                                                  
********************************************************************            
* CHECK DAYPART BELONGS TO MASTER DAYPART (COLUMN FILTER)                       
* INPUT  : BYTE=MASTER DAYPART FILTER                                           
* OUTPUT : CC EQ - DAYPART BELONGS TO MASTER DAYPART GROUP                      
*             NE - DAYPART REJECTED                                             
********************************************************************            
*                                                                               
CHKMDPT  NTR1  BASE=*,LABEL=*                                                   
         LA    R1,SBDPTTAB         GET A(DAYPART TABLE)                         
         SR    RF,RF                                                            
CHKMD2   CLI   0(R1),0             LOOK FOR MASTER DAYPART IN TABLE             
         JE    CHKMDNE                                                          
         SR    RE,RE                                                            
         IC    RE,1(R1)                                                         
         SRL   RE,4                                                             
         CLC   BYTE,0(R1)                                                       
         JE    CHKMD3              FOUND                                        
         LR    RF,RE                                                            
         LA    R1,5(R1)                                                         
         J     CHKMD2                                                           
CHKMD3   LTR   RE,RE               RE=DAYPART GROUP NUMBER                      
         JZ    CHKMDNE             NOT PART OF A GROUP                          
         CR    RE,RF               IF GROUP=PREV GROUP THEN                     
         JE    CHKMDNE             NOT FIRST IN GROUP SO NOT MASTER!            
*                                                                               
CHKMD4   CLI   0(R1),0             LOOK FOR DAYPART IN MASTER'S GROUP           
         JE    CHKMDNE                                                          
         SR    RF,RF                                                            
         IC    RF,1(R1)                                                         
         SRL   RF,4                                                             
         CR    RE,RF               TEST THIS DAYPART PART OF GROUP              
         JNE   CHKMDNE                                                          
         CLC   0(1,R1),SBDPTCD                                                  
         JE    CHKMDEQ             FOUND                                        
         LA    R1,5(R1)                                                         
         J     CHKMD4                                                           
*                                                                               
CHKMDNE  LHI   RE,1                                                             
         J     *+8                                                              
CHKMDEQ  LHI   RE,2                                                             
         CHI   RE,2                                                             
         J     XIT                                                              
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
GETSLEN  NTR1  BASE=*,LABEL=*                                                   
         LARL  R1,ALENTAB                                                       
         L     R1,0(R1)            POINT TO LENGTH TABLE                        
         LH    RE,0(R1)            ENTRY LENGTH                                 
         L     RF,2(R1)            EOT DSPL                                     
         AR    RF,R1               RELOCATE EOT ADDRESS                         
         AHI   R1,6                POINT TO FIRST ENTRY                         
*                                                                               
         MVC   HALF(1),SBQMED      MEDIA                                        
         CLI   SBQMED,C'*'         ALL MEDIA REQUEST?                           
         BNE   *+10                NO                                           
         MVC   HALF(1),SBMED       YES - USE SBMED INSTEAD                      
*                                                                               
         MVI   BYTE,C'T'                                                        
         CLI   HALF,C'T'                                                        
         BE    ILEN20                                                           
         CLI   HALF,C'N'                                                        
         BE    ILEN20                                                           
         CLI   HALF,C'C'                                                        
         BE    ILEN20                                                           
*                                                                               
         MVI   BYTE,C'R'                                                        
         CLI   HALF,C'R'                                                        
         BE    ILEN20                                                           
         CLI   HALF,C'X'                                                        
         BE    ILEN20                                                           
         DC    H'0'                                                             
*                                                                               
ILEN20   CLC   =C'00',0(R1)        TEST DEFAULT TABLE                           
         BE    ILEN30                                                           
         CLC   0(2,R1),SBAGY       ELSE MATCH AGY                               
         BNE   *+14                                                             
ILEN30   CLC   BYTE,2(R1)          AND MEDIA                                    
         BE    ILEN40                                                           
*                                                                               
         BXLE  R1,RE,ILEN20                                                     
         DC    H'0'                                                             
*                                                                               
ILEN40   AHI   R1,4                POINT BEYOND HEADER                          
         LLC   R3,0(R2)            GET SLN                                      
         AR    R3,R3               X 2                                          
         AR    R1,R3               POINT TO ENTRY                               
         MVC   0(1,R2),1(R1)       ACTUAL SPOT LENGTH                           
         J     XIT                                                              
         DROP  RB                                                               
*                                                                               
OUTCOFF  NTR1  BASE=*,LABEL=*                                                   
         LA    R1,WORK                                                          
         XC    WORK,WORK                                                        
         USING OFFICED,R1                                                       
         MVI   OFCSYS,C'S'                                                      
         L     RF,ATWA                                                          
         MVC   OFCAUTH,6(RF)                                                    
         MVC   OFCLMT,6(RF)                                                     
         MVC   OFCAGY,SBAGY                                                     
         MVC   OFCOFC,SBCOFF                                                    
         GOTO1 OFFICER,DMCB,(C'2',WORK),(0,ACOMFACS)                            
         LA    R1,WORK                                                          
         TM    OFCINDS,OFCINOLA    AGY USING 2 CHAR OFFICES?                    
         BNZ   ICLTOFF4             NO                                          
         CLI   DMCB,0                                                           
         BNE   ICLTOFF6                                                         
         B     ICLTOFF8                                                         
*                                                                               
ICLTOFF4 MVC   0(1,R2),OFCOFC       NO - SAVE ON CHAR CODE AND SET FLAG         
         MVI   1(R2),X'FF'                                                      
         J     XIT                                                              
*                                                                               
ICLTOFF6 MVC   0(2,R2),=C'**'      UNKNOWN OFFICE                               
         J     XIT                                                              
*                                                                               
ICLTOFF8 MVC   0(2,R2),OFCOFC2     SAVE OFF 2 CHARACTER OFFICE                  
         DROP  R1                                                               
*                                                                               
         CLI   GLARGS+2,C'X'       SPECIAL CROSS-FILE KEYWORD?                  
         JNE   XIT                                                              
*                                                                               
         CLC   SBQAGY,=C'GB'                                                    
         BNE   ICOFF10                                                          
         CLI   SBCOFF,C'1'                                                      
         JNE   XIT                                                              
         MVC   0(2,R2),=C'GB'                                                   
         J     XIT                                                              
*                                                                               
ICOFF10  CLC   SBQAGY,=C'TR'                                                    
         BNE   ICOFF20                                                          
         CLI   SBCOFF,C'1'                                                      
         BE    ICOFF12                                                          
         CLI   SBCOFF,C'2'                                                      
         BE    ICOFF12                                                          
         CLI   SBCOFF,C'6'                                                      
         JNE   XIT                                                              
*                                                                               
ICOFF12  MVC   0(2,R2),=C'DA'                                                   
         J     XIT                                                              
*                                                                               
ICOFF20  CLC   SBQAGY,=C'NE'                                                    
         JNE   XIT                                                              
         CLI   SBCOFF,C'R'                                                      
         BNE   *+14                                                             
         MVC   0(2,R2),=C'RR'                                                   
         J     XIT                                                              
         CLI   SBCOFF,C'Y'                                                      
         BNE   *+14                                                             
         MVC   0(2,R2),=C'NY'                                                   
         J     XIT                                                              
         CLI   SBCOFF,C'C'                                                      
         BNE   *+14                                                             
         MVC   0(2,R2),=C'CH'                                                   
         J     XIT                                                              
         CLI   SBCOFF,C'L'                                                      
         BE    ICOFF30                                                          
         CLI   SBCOFF,C'E'                                                      
         BE    ICOFF30                                                          
         CLI   SBCOFF,C'M'                                                      
         JNE   XIT                                                              
*                                                                               
ICOFF30  MVC   0(2,R2),=C'LA'                                                   
         J     XIT                                                              
*                                                                               
OPRODUCT NTR1  BASE=*,LABEL=*                                                   
         CLI   GLARGS,C'N'                                                      
         BNE   *+8                                                              
         LA    R2,8(R2)                                                         
         CLC   0(3,R2),=X'FFFFFF'  TEST DETAIL TOTAL                            
         BE    OUTPRDX                                                          
         MVC   LABLAREA(7),=C'PRODUCT'                                          
         CLC   0(3,R2),=X'FEFEFE'  TEST UNALLOCATED                             
         BNE   OPRD1                                                            
         MVI   SBBPRD,FF                                                        
         CLI   GLARGS,C'N'                                                      
         BE    *+10                                                             
         MVC   CODEAREA(3),=C'POL'                                              
         CLI   GLARGS,C'C'                                                      
         BE    OPRD4                                                            
         MVC   NAMEAREA(11),=C'UNALLOCATED'                                     
         B     OPRD4                                                            
*                                                                               
OPRD1    CLC   0(3,R2),=X'FDFDFD'  TEST POL                                     
         BNE   *+10                                                             
         MVC   0(3,R2),=C'POL'                                                  
         CLI   GLARGS,C'N'                                                      
         BE    OPRD2                                                            
         CLI   GLARGS,C'X'         SPECIAL XFILE PRDNAME KEYWORD?               
         BNE   *+14                 NO                                          
         MVC   NAMEAREA(20),0(R2)                                               
         B     OPRD4                                                            
         MVC   CODEAREA(3),0(R2)                                                
         CLC   3(3,R2),=C'   '     TEST PIGGYBACK                               
         BNH   OPRD2                                                            
         MVI   CODEAREA+3,C'-'     YES                                          
         MVC   CODEAREA+4(3),3(R2)                                              
*                                                                               
OPRD2    L     R1,SBAPRDBF                                                      
         USING PRDBUFFD,R1                                                      
         LHI   RE,PRDBUFFL                                                      
         LA    R0,256                                                           
         CLC   PBALPH,0(R2)                                                     
         BE    *+16                                                             
         LA    R1,0(R1,RE)                                                      
         BCT   R0,*-14                                                          
         B     OPRD4                                                            
         MVC   SBBPRD,PBBCODE                                                   
         MVI   SBBPRD2,0                                                        
         MVC   SBPRDINT,PBINT                                                   
         CLI   GLARGS,C'C'                                                      
         BE    OPRD4                                                            
         MVC   NAMEAREA(L'PBNAME),PBNAME                                        
         CLC   3(3,R2),=C'   '     TEST PIGGYBACK                               
         BNH   OPRD4                                                            
         L     R1,SBAPRDBF         YES-GET BINARY CODE AND NAME                 
         LA    R0,256                                                           
         CLC   PBALPH,3(R2)                                                     
         BE    *+14                                                             
         LA    R1,0(R1,RE)                                                      
         BCT   R0,*-14                                                          
         DC    H'0'                                                             
         MVC   SBBPRD2,PBBCODE                                                  
         LLC   RF,MYOLEN           FORMAT SECOND NAME                           
         CLI   GLARGS,C'N'                                                      
         BE    *+16                                                             
         CLI   MYPOSO,C'P'                                                      
         BNE   *+8                                                              
         SHI   RF,8                                                             
         SRA   RF,1                                                             
         LTR   RF,RF                                                            
         BNP   OPRD4                                                            
         LA    RE,L'PBNAME                                                      
         CR    RF,RE                                                            
         BNH   *+6                                                              
         LR    RF,RE                                                            
         LA    R5,L'NAMEAREA                                                    
         SR    R5,RF                                                            
         BCTR  R5,0                                                             
         CR    R5,RE                                                            
         BNH   *+6                                                              
         LR    R5,RE                                                            
         BCTR  R5,0                                                             
         LA    RF,NAMEAREA(RF)                                                  
         MVI   0(RF),C'-'                                                       
         EX    R5,*+8                                                           
         B     OPRD4                                                            
         MVC   1(0,RF),PBNAME                                                   
*                                                                               
OPRD4    MVC   SBPRD,CODEAREA      SAVE PROUCT CODE                             
         CLI   GLARGS,C'N'         REPORT PRODUCT NAME ONLY?                    
         BNE   *+20                NO                                           
         CLC   SBPRD,=X'404040'    WAS CODEAREA SPACES?                         
         BNE   *+10                NO - SBPRD IS SET                            
         MVC   SBPRD,0(R2)         SET PRODUCT CODE                             
         MVC   SBPRDNM,NAMEAREA    AND NAME                                     
         MVC   SBPRD2,3(R2)        AND SECOND PRODUCT                           
         DROP  R1                                                               
OUTPRDX  J     XIT                                                              
*                                                                               
INATIME  NTR1  BASE=*,LABEL=*                                                   
         MVC   0(2,R2),=X'FFFF'    AFFIDAVIT TIME                               
         CLI   SBMODE,SBPROCSP                                                  
         BNE   IATIME2                                                          
         OC    SCATIME,SCATIME                                                  
         JZ    XIT                                                              
         MVC   0(2,R2),SCATIME                                                  
         J     XIT                                                              
*                                                                               
IATIME2  CLI   SBMODE,SBPROCNV                                                  
         JNE   XIT                                                              
         CLI   0(R4),X'40'                                                      
         JNE   XIT                                                              
         SR    R0,R0                                                            
         ZICM  R1,SNVIDTIM-SNVIDELD(R4),2                                       
         D     R0,=F'60'           CONVERT TO MILITARY TIME                     
         MHI   R1,100                                                           
         AR    R1,R0                                                            
         AHI   R1,600              (0 = 6:00A)                                  
         CHI   R1,2400             EARLY MORNING?                               
         BNH   *+8                 DONT GET FUCKED ON 12 MIDNIGHT               
         SHI   R1,2400             YES                                          
         STCM  R1,3,0(R2)                                                       
         CLI   GLARGS+2,X'01'      PASS IN SEQ NUM?                             
         JNE   XIT                 NO                                           
         MVC   2(1,R2),SNVIDSEQ-SNVIDELD(R4)                                    
         J     XIT                                                              
         LTORG                                                                  
*                                                                               
         DROP  RB                                                               
*                                                                               
         EJECT                                                                  
DBLOCKD  DSECT                                                                  
*                                                                               
       ++INCLUDE DEDBLOCK                                                       
         EJECT                                                                  
*        INCLUDE SPGENSTAB                                                      
*        INCLUDE SPGENREP                                                       
*        INCLUDE SPGENCOM                                                       
*        INCLUDE SPGENCLRST                                                     
*        INCLUDE SPMGADN                                                        
*        INCLUDE DRGLOBAL                                                       
*        INCLUDE DRIVETABLE                                                     
*        INCLUDE DRINTRECD                                                      
*        INCLUDE DDSPOOLD                                                       
*        INCLUDE DDSPLWORKD                                                     
*        INCLUDE DDOFFICED                                                      
*        INCLUDE SPWRIFFD                                                       
*        INCLUDE SPWRIF1D                                                       
*        INCLUDE MAAORLKD                                                       
*        INCLUDE SPGENSNV                                                       
*        INCLUDE SPGENINV                                                       
*        INCLUDE SPSQDBUFFD                                                     
*        INCLUDE DDUCOMD                                                        
         PRINT OFF                                                              
       ++INCLUDE SPGENSTAB                                                      
REPRECD  DSECT                                                                  
       ++INCLUDE SPGENREP                                                       
COMHDRD  DSECT                                                                  
       ++INCLUDE SPGENCOM                                                       
       ++INCLUDE SPGENCLRST                                                     
       ++INCLUDE SPMGADN                                                        
       ++INCLUDE DRGLOBAL                                                       
       ++INCLUDE DRIVETABLE                                                     
       ++INCLUDE DRINTRECD2                                                     
       ++INCLUDE DDSPOOLD                                                       
       ++INCLUDE DDSPLWORKD                                                     
       ++INCLUDE DDOFFICED                                                      
       ++INCLUDE SPWRIFFD                                                       
         ORG   CONTAGH                                                          
       ++INCLUDE SPWRIF1D                                                       
         PRINT ON                                                               
         EJECT                                                                  
       ++INCLUDE SPWRIWORKD                                                     
         EJECT                                                                  
* SPGENBUY                                                                      
         PRINT OFF                                                              
BUYRECD  DSECT                                                                  
       ++INCLUDE SPGENBUY                                                       
         PRINT ON                                                               
         SPACE 1                                                                
* SPGENGOAL                                                                     
         PRINT OFF                                                              
GOALRECD DSECT                                                                  
       ++INCLUDE SPGENGOAL                                                      
         PRINT ON                                                               
         SPACE 1                                                                
* SPGENAGY                                                                      
         PRINT OFF                                                              
AGYRECD  DSECT                                                                  
       ++INCLUDE SPGENAGY                                                       
         PRINT ON                                                               
         SPACE 1                                                                
* SPGENINFO                                                                     
         PRINT OFF                                                              
       ++INCLUDE SPGENINFO                                                      
         PRINT ON                                                               
         SPACE 1                                                                
* SPGENBILL                                                                     
         PRINT OFF                                                              
BILLRECD DSECT                                                                  
       ++INCLUDE SPGENBILL                                                      
         EJECT                                                                  
       ++INCLUDE MAAORLKD                                                       
         PRINT ON                                                               
* SPGENSNV                                                                      
         PRINT OFF                                                              
SNVRECD  DSECT                                                                  
       ++INCLUDE SPGENSNV                                                       
         PRINT ON                                                               
* SPGENINV                                                                      
         PRINT OFF                                                              
INVRECD  DSECT                                                                  
       ++INCLUDE SPGENINV                                                       
         PRINT ON                                                               
* SPSQDBUFFD                                                                    
         PRINT OFF                                                              
       ++INCLUDE SPSQDBUFFD                                                     
         PRINT ON                                                               
         PRINT OFF                                                              
       ++INCLUDE DDUCOMD                                                        
         PRINT OFF                                                              
       ++INCLUDE DEDEMTABD                                                      
       ++INCLUDE DDCOMFACS                                                      
         PRINT ON                                                               
         SPACE 1                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'131SPSYSDRV1 02/10/21'                                      
         END                                                                    

*          DATA SET SPREPORT   AT LEVEL 028 AS OF 02/26/19                      
*CATALP SPREPORT                                                                
         TITLE 'MODULE EXECUTES SPECS AND CONTROLS PRINTING'                    
*                                                                               
* CHANGE LOG                                                                    
*                                                                               
* BPLA  CHANGES TO SUPPORT WIDE PRINTING                                        
*       -UP TO 198 PRINT POSITIONS                                              
*       SPECIAL CODING IS REQUIRED IN THE REPORT TO USE                         
*       THIS FEATURE                                                            
*       INCLUDE MEL'S SPOT LENGTH CHANGES                                       
*                                                                               
*******************************************************************             
* R3 : INPUT PARAMETER TO ROUTINE PRINCON                         *             
* R7 : WORKING REGISTER FOR STRINGS FROM DATA DICTIONARY          *             
*                                                                 *             
*******************************************************************             
SPREPORT CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 SPREPX-SPREPD,**REPT**                                           
         USING SPREPD,RC                                                        
         L     RA,=V(SPWORKC)                                                   
         USING SPWORKD,RA                                                       
         LA    R9,2048(RA)                                                      
         LA    R9,2048(R9)                                                      
         USING SPWORKD+4096,R9                                                  
         LA    R8,2048(RB)                                                      
         LA    R8,2048(R8)                                                      
         USING SPREPORT+4096,R8                                                 
         MVC   USERRD,4(RD)        SAVE CALLER'S SAVE AREA ADDRESS              
*                                                                               
         CLI   FORCEHED,C'P'       TEST FORCING PAGE NUMBER                     
         BNE   PCPR6                                                            
         CLI   RCWHATPR,0          IF NOT IN DUAL PRINTING REPORT               
         BE    PCPR4               SO JUST RESET TO 'Y'                         
*                                                                               
         LA    R2,MYPAGE1                                                       
         LA    R3,MYSUBPG1                                                      
         CLI   RCWHATPR,2                                                       
         BNE   PCPR2                                                            
         LA    R2,MYPAGE2                                                       
         LA    R3,MYSUBPG2                                                      
*                                                                               
PCPR2    MVC   0(2,R2),PAGE                                                     
         MVC   0(2,R3),SUBPAGE                                                  
*                                                                               
PCPR4    MVI   FORCEHED,C'Y'       THEN SET NORMAL FORCEHED OPTION              
*                                                                               
PCPR6    DS    0H                                                               
         MVC   APRINT,=V(PRINTS)                                                
         CLI   RCWHATPR,0                                                       
         BE    PCPRX                                                            
*                                                                               
         MVC   PAGE,MYPAGE1                                                     
         MVC   SUBPAGE,MYSUBPG1                                                 
*                                                                               
         CLI   RCWHATPR,2                                                       
         BNE   PCPRX                                                            
         MVC   APRINT,=V(PRINTS2)                                               
         MVC   PAGE,MYPAGE2                                                     
         MVC   SUBPAGE,MYSUBPG2                                                 
*                                                                               
PCPRX    CLI   RCFLONLY,C'Y'                                                    
         BE    PC00                                                             
         BC    0,NODICT                                                         
         OI    *-3,X'F0'           FIRST DICATE CALL ONE-TIME-ONLY              
*                                                                               
         XC    REPDMCB,REPDMCB                                                  
         LA    R1,REPDMCB                                                       
         USING DICTATED,R1                                                      
         MVI   DDACTN,DDACTNL      TRANSLATE LIST                               
         MVI   DDRETN,DDCASEU                                                   
         MVI   DDSYS,2                                                          
         MVC   DDLANG,RCLANG                                                    
         LA    RF,DCLIST                                                        
         STCM  RF,7,DDIADR                                                      
         LA    RF,DSLIST                                                        
         STCM  RF,7,DDOADR                                                      
*                                                                               
         GOTO1 DICTATE                                                          
         DROP  R1                                                               
         EJECT                                                                  
*              SET UP FOR 132 OR 198 PRINT SUPPORT                              
         SPACE                                                                  
NODICT   MVC   PWIDTH,=F'132'      PRESET FOR REGULAR PRINT LINES               
         MVI   WIDEOPT,C'N'                                                     
         LA    R1,HEAD1                                                         
         ST    R1,AH1                                                           
         LA    R1,HEAD14                                                        
         ST    R1,AHLAST      ADDRESS OF LAST HEADLINE                          
         LA    R1,MID1                                                          
         ST    R1,AM1                                                           
         LA    R1,MID2                                                          
         ST    R1,AM2                                                           
         LA    R1,P                DEFAULT IS FOR 14 P1-P14                     
         ST    R1,AP1                                                           
         LA    R1,P14                                                           
         ST    R1,APLAST                                                        
         XC    NPLINES,NPLINES                                                  
         MVI   NPLINES+3,14                                                     
*                                                                               
         L     R1,=V(MASTC)                                                     
         USING MASTD,R1                                                         
         MVC   REPMAX,MAXLINES                                                  
         CLI   MCMAXLIN,0                                                       
         BE    *+10                                                             
         MVC   REPMAX,MCMAXLIN     USE MCMAXLIN IF SPECIFIED                    
         DROP  R1                                                               
         SPACE 1                                                                
SETW2    L     R1,ABOX                                                          
*                                                                               
         LR    R2,R1                                                            
         LTR   R2,R2                                                            
         BZ    SETW4                                                            
         USING BOXD,R2                                                          
         CLC   BOXWIDTH,=F'132'    CHECK FOR WIDE PRINT                         
         BNH   SETW4                                                            
         MVC   PWIDTH,=F'198'      SET UP FOR WIDE PRINT LINES                  
         MVI   WIDEOPT,C'Y'                                                     
         L     R2,BOXAWIDE                                                      
         USING WIDED,R2                                                         
         LA    R1,XHEAD1                                                        
         ST    R1,AH1                                                           
         LA    R1,XHEAD14                                                       
         ST    R1,AHLAST           ADDRESS OF LAST HEADLINE                     
         LA    R1,XMID1                                                         
         ST    R1,AM1                                                           
         LA    R1,XMID2                                                         
         ST    R1,AM2                                                           
         LA    R1,XP                                                            
         ST    R1,AP1                                                           
         LA    R1,XP4                                                           
         ST    R1,APLAST                                                        
         MVI   NPLINES+3,4                                                      
         DROP  R2                                                               
         SPACE 1                                                                
SETW4    MVI   MYSPACES,C' '                                                    
         MVC   MYSPACES+1(197),MYSPACES                                         
         L     R1,PWIDTH                                                        
         BCTR  R1,0                                                             
         ST    R1,EXWIDE           WIDTH-1 FOR EX INSTRUCTIONS                  
         EJECT                                                                  
*                                                                               
         EJECT                                                                  
* OPTION JUST TO CLEAR ALL PRINT LINES                                          
         SPACE 2                                                                
PC00     CLI   FORCECLR,C'N'                                                    
         BE    PC4                                                              
         MVI   FORCECLR,C'N'                                                    
         SPACE 2                                                                
PC1      L     R2,AH1                                                           
         LA    R3,14                                                            
         BAS   RE,SPCLEAR                                                       
         SPACE 1                                                                
PC3      L     R2,AM1                                                           
         LA    R3,2                                                             
         BAS   RE,SPCLEAR                                                       
         SPACE 1                                                                
         L     R2,AP1                                                           
         L     R3,NPLINES                                                       
         BAS   RE,SPCLEAR                                                       
         MVC   FOOT1,SPACES                                                     
         MVC   FOOT2,SPACES                                                     
         B     PCEXT                                                            
         SPACE 1                                                                
SPCLEAR  L     R1,EXWIDE                                                        
         SPACE 1                                                                
SPCLEAR2 EX    R1,R2CLEAR                                                       
         A     R2,PWIDTH                                                        
         BCT   R3,SPCLEAR2                                                      
         BR    RE                                                               
         SPACE 1                                                                
R2CLEAR  MVC   0(0,R2),MYSPACES                                                 
R2TEST   CLC   0(0,R2),MYSPACES                                                 
         EJECT                                                                  
* CONTROL SPEC PROCESSING                                                       
         SPACE 2                                                                
PC4      CLI   SKIPSPEC,C'Y'                                                    
         BE    PC6                                                              
         CLI   RCFLONLY,C'Y'                                                    
         BE    PC5                                                              
         CLI   FORCEHED,C'Y'       DONT EXECUTE SPECS IF JUST                   
         BE    PC5                 HANDLING PLINES                              
         CLI   FORCEMID,C'Y'                                                    
         BE    PC5                                                              
         CLI   FORCEFUT,C'Y'                                                    
         BE    PC5                                                              
         SR    RF,RF               CHECK IF LINE + ALLOWLIN EXCEEDS MAX         
         IC    RF,LINE                                                          
         SR    R0,R0                                                            
         IC    R0,ALLOWLIN                                                      
         MVI   ALLOWLIN,0                                                       
         AR    RF,R0                                                            
         IC    R0,MAXLINES                                                      
         CR    RF,R0                                                            
         BL    PC4B                                                             
         MVI   FORCEHED,C'Y'       SO ENSURE HEADLINES                          
         B     PC5                                                              
         SPACE 2                                                                
*                                                                               
PC4B     L     R2,APLAST           HOW MANY PRINT LINES ARE THERE               
         L     R3,NPLINES                                                       
         L     R1,EXWIDE                                                        
         SPACE 1                                                                
PC4D     EX    R1,R2TEST                                                        
         BNE   PC4F                                                             
         S     R2,PWIDTH                                                        
         BCT   R3,PC4D                                                          
         LA    R3,1                                                             
         SPACE 2                                                                
PC4F     ZIC   R2,SPACING          ADD IN SPACING                               
         CLC   RCSPACNG,SPACING                                                 
         BNH   *+8                                                              
         IC    R2,RCSPACNG                                                      
         AR    R3,R2                                                            
         BCTR  R3,0                -1                                           
         ZIC   R2,LINE             AND PRESENT LINE COUNT                       
         AR    R3,R2                                                            
         ZIC   R2,MAXLINES         WILL THEY FIT                                
         CR    R3,R2                                                            
         BNH   PC14                                                             
         MVI   FORCEHED,C'Y'                                                    
         SPACE 2                                                                
PC5      EQU   *                                                                
         BAS   RE,PROCSPEC                                                      
         SPACE 2                                                                
PC5A     CLI   RCFLONLY,C'Y'                                                    
         BNE   PC6                                                              
         MVI   RCFLONLY,C'N'                                                    
         B     PCEXT                                                            
         EJECT                                                                  
* CONTROL OF HEADLINE PRINTING                                                  
         SPACE 2                                                                
PC6      CLI   FORCEHED,C'N'                                                    
         BE    PC12                                                             
         MVI   FORCEHED,C'N'                                                    
         SPACE 2                                                                
PC10     MVI   FORCEMID,C'Y'                                                    
         CLC   FOOT1(132),SPACES                                                
         BE    PC11                                                             
         CLI   FIRSTFUT,C'Y'                                                    
         BE    PC11                                                             
         GOTO1 APRINT,REPARA,SPACES,=C'BC09'                                    
*                                                                               
         CLI   RQEMAIL,C'Y'                                                     
         BNE   PC10A                                                            
         GOTO1 =V(EMLPUT),(R1)                                                  
*                                                                               
PC10A    LA    R2,FOOT1                                                         
         LA    R3,2                                                             
         GOTOR PRINCON                                                          
         MVI   FORCEFUT,C'N'                                                    
         B     PC11                                                             
         SPACE 2                                                                
FIRSTFUT DC    C'Y'                                                             
         SPACE 2                                                                
PC11     MVI   FIRSTFUT,C'N'                                                    
         GOTO1 APRINT,REPARA,MYSPACES,=C'BC01'                                  
*                                                                               
         CLI   RQEMAIL,C'Y'                                                     
         BNE   PC11AAA                                                          
         GOTO1 =V(EMLPUT),(R1)                                                  
*                                                                               
PC11AAA  LH    R1,ACTPAGES                                                      
         LA    R1,1(R1)                                                         
         STH   R1,ACTPAGES                                                      
         OC    MAXPAGES,MAXPAGES                                                
         BZ    PC11AA                                                           
         CLC   ACTPAGES,MAXPAGES                                                
         BNH   PC11AA                                                           
         DC    H'0'                                                             
         SPACE 2                                                                
PC11AA   DS    0H                                                               
         MVI   LINE,1                                                           
*                                                                               
PC11AB   ICM   RF,15,HEADHOOK      USER SUPPLIED HEADLINE HOOK                  
         BZ    PC11A                                                            
*                                                                               
         BAS   RE,GOHOOK                                                        
         SPACE 2                                                                
PC11A    L     R2,AH1                                                           
         LA    R3,14                                                            
         GOTOR PRINCON                                                          
*                                                                               
         CLI   HEADHOOK,C'R'       TEST ADDITIONAL HEADLINE REQUEST             
         BE    PC11AB                                                           
*                                                                               
         SR    R4,R4                                                            
         MVC   REPDUB(4),PAGE      ADD 1 TO PAGE AND SUBPAGE                    
         LH    R4,REPDUB                                                        
         SLL   R4,16                                                            
         SRL   R4,16                                                            
         AH    R4,=H'1'                                                         
         STH   R4,REPDUB                                                        
         LH    R4,REPDUB+2                                                      
         SLL   R4,16                                                            
         SRL   R4,16                                                            
         AH    R4,=H'1'                                                         
         STH   R4,REPDUB+2                                                      
         MVC   PAGE(4),REPDUB                                                   
*                                                                               
*  CONTROL OF COMMENT PRINTING                                                  
         CLI   FORCECMT,C'Y'       FORCE TO PRINT AFTER HEADS                   
         BNE   PC12                                                             
         MVI   FORCECMT,C'N'                                                    
         GOTOR PRTCOM           PRINT ANY COMMENT                               
         SPACE 2                                                                
         EJECT                                                                  
*                   CONTROL OF MIDLINE PRINTING                                 
         SPACE 2                                                                
PC12     CLI   FORCEMID,C'N'                                                    
         BE    PC13                                                             
*                                                                               
PC12A    MVI   FORCEMID,C'N'                                                    
         MVI   MIDHOOK,0           RESET USER RETURN                            
         OC    MIDHOOK,MIDHOOK     USER SUPPLIED MIDLINE HOOK                   
         BZ    PC12B                                                            
         GOTO1 MIDHOOK,REPARA,(RA)                                              
*                                                                               
PC12B    L     R2,AM1                                                           
         LA    R3,2                                                             
         GOTOR PRINCON                                                          
*                                                                               
         CLI   MIDHOOK,C'R'        TEST USER REQUESTED RETURN                   
         BE    PC12A                                                            
         CLC   LINE,MAXLINES                                                    
         BNL   PC10                                                             
         EJECT                                                                  
* CONTROL OF COMMENT PRINTING                                                   
*                                                                               
PC13     DS    0H                                                               
PC13C    DS    0H                                                               
         CLI   FORCECMT,C'M'       FORCE TO PRINT AFTER MIDS                    
         BNE   PC14                                                             
         MVI   FORCECMT,C'N'                                                    
         GOTOR PRTCOM           PRINT ANY COMMENT                               
         SPACE 2                                                                
* CONTROL OF PRINT LINES                                                        
         SPACE 2                                                                
PC14     DS    0H                                                               
         L     R2,AP1                                                           
         L     R3,NPLINES                                                       
         BAS   RE,PRINP                                                         
         MVI   SPACING,1                                                        
*                                                                               
PC14C    DS    0H                                                               
         CLI   FORCECMT,C'I'       TEST IMMEDIATE COMMENT PRINT                 
         BNE   PC15                                                             
*                              NOTE- COMMENT PRINTING LOGIC HERE                
*                              IS A COPY OF THAT AT HEADLINE/MIDLINE            
*                              (PRTCOM) BUT USING P'S NOT H'S.                  
         MVI   FORCECMT,C'N'                                                    
* CLEAR P LINES FOR COMMENTS                                                    
         L     R2,AP1                                                           
         L     R3,NPLINES                                                       
         BAS   RE,SPCLEAR                                                       
* NOW EXTRACT COMMENTS FROM COMMENT REC                                         
         L     R2,AP1                                                           
         SR    R3,R3                                                            
         L     R6,ADCOMREC                                                      
         CLI   0(R6),0             TEST COMMENT PRESENT                         
         BE    PC15                NO                                           
         LA    R6,24(R6)           POINT TO FIRST ELEMENT                       
PC14C2   CLI   0(R6),5             FIND A COMMENT LINE                          
         BNE   PC14C4                                                           
         ZIC   RE,1(R6)            GET ELEM LEN                                 
         SH    RE,=H'3'            SET FOR EX                                   
         BM    PC14C4                                                           
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),2(R6) * EXECUTED *                                       
         A     R2,PWIDTH                                                        
         LA    R3,1(R3)            BUMP LINE COUNT                              
         L     R0,APLAST                                                        
         CR    R2,R0               TEST USED TOO MANY LINES                     
         BH    PC14C6              IF SO, STOP NOW                              
PC14C4   SR    R0,R0                                                            
         IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
         CLI   0(R6),0                                                          
         BNE   PC14C2                                                           
* NOW PRINT COMMENT                                                             
PC14C6   DS    0H                  SEE IF WILL FIT ON PAGE                      
         ZIC   R0,LINE                                                          
         AR    R3,R0                                                            
         IC    R0,MAXLINES                                                      
         CR    R3,R0                                                            
         BNH   PC14C7                                                           
*                                  WILL NOT FIT                                 
*                                  CLEAR P LINES OF COMMENT                     
         L     R2,AP1                                                           
         L     R3,NPLINES                                                       
         BAS   RE,SPCLEAR                                                       
*                                                                               
         MVI   FORCECMT,C'M'       FORCE TO PRINT AFTER MIDS                    
         MVI   FORCEHED,C'Y'       ON NEXT PAGE                                 
         B     PC4                                                              
*                                                                               
PC14C7   DS    0H                                                               
         L     R2,AP1                                                           
         L     R3,NPLINES                                                       
         GOTOR PRINCON                                                          
*                                                                               
         SPACE 2                                                                
* CONTROL OF FOOTLINE PRINTING                                                  
         SPACE 2                                                                
PC15     DS    0H                                                               
         CLI   FORCEFUT,C'N'                                                    
         BE    PC17                                                             
         MVI   FORCEFUT,C'N'                                                    
         GOTO1 APRINT,REPARA,SPACES,=C'BC09'                                    
*                                                                               
         CLI   RQEMAIL,C'Y'                                                     
         BNE   PC16                                                             
         GOTO1 =V(EMLPUT),(R1)                                                  
*                                                                               
PC16     LA    R2,FOOT1                                                         
         LA    R3,2                                                             
         GOTOR PRINCON                                                          
         MVI   FORCEHED,C'Y'                                                    
PC17     LA    R2,MYPAGE1                                                       
         LA    R3,MYSUBPG1                                                      
         CLI   RCWHATPR,2                                                       
         BNE   *+12                                                             
         LA    R2,MYPAGE2                                                       
         LA    R3,MYSUBPG2                                                      
         MVC   0(2,R2),PAGE                                                     
         MVC   0(2,R3),SUBPAGE                                                  
*                                                                               
         CLI   CLEARHED,C'N'       GO BACK TO CLEAR JUST THE PRINT              
         BE    PC3                 LINES OR, OPTIONALLY, ALL LINES              
         B     PC1                                                              
         EJECT                                                                  
* CONTROL PRINTING OF A BLOCK                                                   
* INPUT : R3                                                                    
         SPACE 2                                                                
         EJECT                                                                  
* SPECIAL ROUTINE FOR PRINT LINES                                               
         SPACE 2                                                                
PRINP    NTR1                                                                   
         BCTR  R3,R0                                                            
         SPACE 2                                                                
         L     R1,EXWIDE                                                        
PRINP2   LR    RF,R2                                                            
         A     RF,PWIDTH                                                        
         EX    R1,*+8                                                           
         B     *+10                                                             
         CLC   0(0,RF),MYSPACES   SINGLE PRINT UNTIL LAST                       
         BE    PC36                                                             
         GOTO1 APRINT,REPARA,(R2),=C'BL01'                                      
*                                                                               
         CLI   RQEMAIL,C'Y'                                                     
         BNE   PC35                                                             
         GOTO1 =V(EMLPUT),(R1)                                                  
*                                                                               
PC35     SR    R1,R1                                                            
         IC    R1,LINE                                                          
         LA    R1,1(R1)                                                         
         STC   R1,LINE                                                          
         A     R2,PWIDTH                                                        
         L     R1,EXWIDE      MUST RESET R1                                     
         BCT   R3,PRINP2                                                        
         SPACE 2                                                                
PC36     MVC   CONTROL(3),=C'BL0'  USERS SPACING FOR ONE OR 2/2                 
         MVC   REPDUB(1),SPACING                                                
         CLC   RCSPACNG,SPACING                                                 
         BNH   *+10                                                             
         MVC   REPDUB(1),RCSPACNG                                               
         MVC   CONTROL+3(1),REPDUB                                              
         OI    CONTROL+3,X'F0'                                                  
         GOTO1 APRINT,REPARA,(R2),CONTROL                                       
*                                                                               
         CLI   RQEMAIL,C'Y'                                                     
         BNE   PC37                                                             
         GOTO1 =V(EMLPUT),(R1)                                                  
*                                                                               
PC37     SR    R0,R0                                                            
         SR    R1,R1                                                            
         IC    R1,REPDUB                                                        
         IC    R0,LINE                                                          
         AR    R1,R0                                                            
         STC   R1,LINE                                                          
         XIT1                                                                   
         SPACE 2                                                                
PCEXT    MVI   SKIPSPEC,C'N'                                                    
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
MYPAGE1  DC    H'1'                                                             
MYSUBPG1 DC    H'0'                                                             
MYPAGE2  DC    H'1'                                                             
MYSUBPG2 DC    H'0'                                                             
         LTORG                                                                  
         EJECT                                                                  
* EXECUTE THE SPEC POOL                                                         
         SPACE 2                                                                
PROCSPEC NTR1                                                                   
         L     R2,SPECS            POINT TO SPEC POOL                           
         SR    R3,R3                                                            
         MVI   PROGSW,C'Y'         PRESET SWITCHES                              
         MVI   FILTSW,C'Y'                                                      
*                                                                               
         MVI   LANGSW,C'Y'         ASSUME THERE ARE NO FILTERING                
         MVI   CTRYSW,C'Y'          OF LANGUAGE AND COUNTRY                     
*                                                                               
         CLI   RCSUBPRG,0                                                       
         BE    EX1                                                              
         MVI   PROGSW,C'N'                                                      
         SPACE 2                                                                
EX1      CLI   RCFLONLY,C'Y'       PRESET I/O VALUES TO N                       
         BNE   EX4                                                              
         MVC   FCOMMAND(24),=24C'N'                                             
         B     EX4                                                              
         SPACE 2                                                                
         SPACE 2                                                                
EX2      IC    R3,1(R2)                                                         
         AR    R2,R3               GET NEXT SPEC                                
         SPACE 2                                                                
EX4      SR    RF,RF                                                            
         IC    RF,0(R2)                                                         
         SLL   RF,2                                                             
         A     RF,=A(INBRTAB)      GO TO ROUTINE                                
         L     RF,0(RF)                                                         
         BASR  RE,RF               DON'T COME BACK HERE !                       
         DC    H'0'                                                             
         SPACE 2                                                                
EX6      XIT                                                                    
         SPACE 2                                                                
EX8      MVI   PROGSW,C'N'                                                      
         MVI   FILTSW,C'Y'         RESET FOR SUB-PROGRAM FILTERING              
         B     EX2                                                              
         SPACE 2                                                                
EX10     CLC   RCSUBPRG(1),2(R2)   CHECK MATCH OF SUB-PROGRAM                   
         BNE   EX2                                                              
         MVI   PROGSW,C'Y'                                                      
         B     EX2                                                              
         SPACE 2                                                                
EX12     CLC   RCSUBPRG(1),2(R2)   SPROG N THRU M FEATURE                       
         BL    EX2                                                              
         CLC   RCSUBPRG(1),3(R2)                                                
         BH    EX2                                                              
         MVI   PROGSW,C'Y'                                                      
         B     EX2                                                              
         SPACE 2                                                                
EX20     MVC   FCPHASE,2(R2)       USE 'PHASE' FEATURE                          
         B     EX2                                                              
*                                                                               
EX20A    DS    0H                                                               
         MVI   LANGSW,C'N'         ASSUME NO MATCH                              
         CLC   RCLANG,2(R2)        CHECK MATCH OF LANGUAGE CODE                 
         BNE   EX2                                                              
         MVI   LANGSW,C'Y'                                                      
         B     EX2                                                              
EX20B    DS    0H                                                               
         MVI   CTRYSW,C'N'         ASSUME NO MATCH                              
         CLC   RCCTRY,2(R2)        CHECK MATCH OF COUNTRY CODE                  
         BNE   EX2                                                              
         MVI   CTRYSW,C'Y'                                                      
         B     EX2                                                              
*                                                                               
         EJECT                                                                  
* FILE AND RUN CONTROL SPECS                                                    
         SPACE 2                                                                
EX26     CLI   RCFLONLY,C'Y'                                                    
         BNE   EX2                                                              
         CLI   FILTSW,C'Y'                                                      
         BNE   EX2                                                              
         CLI   PROGSW,C'Y'                                                      
         BNE   EX2                                                              
         SPACE 1                                                                
         SR    R4,R4                                                            
         IC    R4,2(R2)                                                         
         BCTR  R4,R0                                                            
         LA    R4,FCOMMAND(R4)                                                  
         MVI   0(R4),C'Y'                                                       
         B     EX2                                                              
         SPACE 2                                                                
EX28     CLI   RCFLONLY,C'Y'                                                    
         BNE   EX2                                                              
         CLI   FILTSW,C'Y'                                                      
         BNE   EX2                                                              
         CLI   PROGSW,C'Y'                                                      
         BNE   EX2                                                              
         CLI   2(R2),2                                                          
         BH    EX32                                                             
         BE    EX30                                                             
         MVI   SPACING,1                                                        
         B     EX2                                                              
         SPACE 2                                                                
EX30     MVI   SPACING,2                                                        
         B     EX2                                                              
         SPACE 2                                                                
EX32     CLI   2(R2),4                                                          
         BH    EX36                                                             
         BE    EX34                                                             
         MVI   SPACING,3                                                        
         B     EX2                                                              
         SPACE 2                                                                
EX34     MVI   RCLINEUP,C'Y'                                                    
         B     EX2                                                              
         SPACE 2                                                                
EX36     CLI   2(R2),6                                                          
         BH    EX40                                                             
         BE    EX38                                                             
         MVI   RCREQREP,C'Y'                                                    
         B     EX2                                                              
         SPACE 2                                                                
EX38     MVI   RCREQREP,C'N'                                                    
         B     EX2                                                              
         SPACE 2                                                                
EX40     CLI   2(R2),8                                                          
         BH    EX44                                                             
         BE    EX42                                                             
         MVI   RCREQSUM,C'Y'                                                    
         B     EX2                                                              
         SPACE 2                                                                
EX42     MVI   RCREQSUM,C'N'                                                    
         B     EX2                                                              
         SPACE 2                                                                
EX44     CLI   2(R2),9                                                          
         BH    EX45                                                             
         SR    R4,R4                                                            
         IC    R4,3(R2)                                                         
         CVD   R4,REPDUB                                                        
         UNPK  RCPROG,REPDUB                                                    
         OI    RCPROG+1,X'F0'                                                   
         B     EX2                                                              
         SPACE 2                                                                
EX45     CLI   2(R2),10                                                         
         BH    EX45A                                                            
         MVI   RCFILTER,C'N'                                                    
         B     EX2                                                              
         SPACE 2                                                                
EX45A    MVC   MAXLINES,2(R2)                                                   
         B     EX2                                                              
         EJECT                                                                  
* PRINT SPEC CONTROL AND LITERALS                                               
         SPACE 2                                                                
EX46     CLI   RCFLONLY,C'Y'                                                    
         BE    EX2                                                              
         CLI   PROGSW,C'Y'                                                      
         BNE   EX2                                                              
         CLI   FILTSW,C'Y'                                                      
         BNE   EX2                                                              
         CLI   LANGSW,C'Y'                                                      
         BNE   EX2                                                              
         CLI   CTRYSW,C'Y'                                                      
         BNE   EX2                                                              
         MVC   REPDUB(2),2(R2)     WORK OUT DISLACEMENT                         
         L     R5,AH1                                                           
         AH    R5,REPDUB           ADD DISPLACEMENT                             
         CLI   0(R2),13                                                         
         BE    EX48                                                             
         SR    RF,RF               WORK OUT BRANCH BY INSTRUCTION NUM           
         IC    RF,4(R2)                                                         
         SLL   RF,2                                                             
         A     RF,=A(PRBRTAB)                                                   
         L     RF,0(RF)                                                         
         BASR  RE,RF                                                            
         DC    H'0'                DON'T COME BACK HERE !                       
         SPACE 2                                                                
*                                                                               
* TRANSLATE LITERALS FROM SPEC IF NECESSARY                                     
EX48     DS    0H                                                               
         CLI   4(R2),X'20'         TEST LITERAL NEEDS DICTIONARY LOOKUP         
         BL    EX49                                                             
         CLI   4(R2),X'2F'                                                      
         BH    EX49                                                             
*                                                                               
         XC    REPDMCB,REPDMCB                                                  
         LA    R1,REPDMCB          BUILD DICTATE PARAMETER LIST                 
         USING DICTATED,R1                                                      
         MVI   DDACTN,DDACTNS      RESOLVE SINGLE EXPRESSION INTO SPEC          
         MVI   DDRETN,DDCASEU                                                   
         MVI   DDSYS,2             SPOT SYSTEM                                  
         MVC   DDLANG,RCLANG                                                    
         LA    RF,4(R2)                                                         
         STCM  RF,7,DDIADR                                                      
         GOTO1 DICTATE                                                          
         DROP  R1                                                               
*                                                                               
EX49     DS    0H                                                               
         SR    R4,R4               HANDLE LITERALS                              
         IC    R4,1(R2)                                                         
         SH    R4,=H'5'            LENGTH IS L'ELEMENT - 4                      
         EX    R4,MUVLIT                                                        
         B     EX2                                                              
         SPACE 2                                                                
MUVLIT   MVC   0(0,R5),4(R2)                                                    
         EJECT                                                                  
*        ROUTINES FOR PRINT SPECS (0-3)                                         
         SPACE 1                                                                
EX50     MVC   0(110,R5),SPACES    SPACES                                       
         CLI   SKIPSPEC,C'T'                                                    
         BE    EX2                                                              
         L     R1,EXWIDE                                                        
         EX    R1,*+8                                                           
         B     EX2                                                              
         MVC   0(0,R5),SPACES                                                   
         B     EX2                                                              
         SPACE 2                                                                
EX52     DS    0H                                                               
         MVC   0(L'SP@RUNON,R5),SP@RUNON                                        
         LR    R7,R5                                                            
         LA    R7,L'SP@RUNON-1(R7)                                              
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         GOTO1 DATCON,REPARA,(4,RCDATE),(8,2(R7))                               
         MVC   L'SP@RUNON+10(L'SP@AT,R5),SP@AT                                  
*&&DO                                                                           
         GETIME STANDARD                                                        
         ST    R1,REPWORK                                                       
*&&                                                                             
*&&OS                                                                           
         TIME                                                                   
         SRL   R0,4                                                             
         ST    R0,REPWORK                                                       
*&&                                                                             
         XC    REPDUB,REPDUB                                                    
         MVC   REPDUB+5(3),REPWORK                                              
         OI    REPDUB+7,X'0F'                                                   
         CVB   R6,REPDUB                                                        
         LA    R7,L'SP@AT+11(R7)                                                
         EDIT  (R6),(5,0(R7)),2                                                 
*                                                                               
         B     EX2                                                              
         SPACE 2                                                                
EX54     DS    0H                                                               
*---->   MVC   0(7,R5),=C'SPNN ON'                                              
         MVC   0(L'SP@SPNN,R5),SP@SPNN                                          
         MVC   2(2,R5),RCPROG                                                   
         GOTO1 DATCON,REPARA,(4,RCDATE),(8,8(R5))                               
         MVI   16(R5),C'-'                                                      
*&&DO                                                                           
         GETIME STANDARD                                                        
         ST    R1,REPWORK                                                       
*&&                                                                             
*&&OS                                                                           
         TIME                                                                   
         SRL   R0,4                                                             
         ST    R0,REPWORK                                                       
*&&                                                                             
         XC    REPDUB,REPDUB                                                    
         MVC   REPDUB+5(3),REPWORK                                              
         OI    REPDUB+7,X'0F'                                                   
         CVB   R6,REPDUB                                                        
         EDIT  (R6),(5,17(R5)),2                                                
         B     EX2                                                              
         SPACE 2                                                                
EX56     DS    0H                                                               
         MVC   0(L'SP@PAGE,R5),SP@PAGE                                          
         LR    R7,R5                                                            
         LA    R7,L'SP@PAGE-1(R7)                                               
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         EDIT  PAGE,(4,2(R7)),ALIGN=LEFT                                        
         B     EX2                                                              
         SPACE 2                                                                
EX57     DS    0H                                                               
         MVC   0(L'SP@SBPG,R5),SP@SBPG                                          
         LR    R7,R5                                                            
         LA    R7,L'SP@SBPG-1(R7)                                               
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         EDIT  SUBPAGE,(4,2(R7)),ALIGN=LEFT                                     
         B     EX2                                                              
         EJECT                                                                  
* ROUTINES FOR PRINT SPECS (4-5)                                                
         SPACE 2                                                                
EX58     CLC   QSTART(12),SPACES                                                
         BE    EX2                                                              
         MVC   0(L'SP@PERD,R5),SP@PERD                                          
         LA    R5,L'SP@PERD-1(R5)                                               
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
         LA    R5,2(R5)                                                         
         CLC   QSTART(6),SPACES    PERIOD                                       
         BE    EX62                                                             
         MVC   0(L'SP@FROM,R5),SP@FROM                                          
         LA    R5,L'SP@FROM-1(R5)                                               
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
         LA    R5,2(R5)                                                         
         SPACE 2                                                                
EX60     CLC   QSTART+4(2),SPACES                                               
         BNE   EX61                                                             
         MVC   QSTART+4(2),=C'01'                                               
         GOTO1 DATCON,REPWORK,(0,QSTART),(6,0(R5))                              
         MVC   QSTART+4(2),SPACES                                               
         CLC   QEND,SPACES                                                      
         BE    EX2                                                              
         LA    R5,7(R5)                                                         
         B     EX62                                                             
         SPACE 2                                                                
EX61     GOTO1 DATCON,REPWORK,(0,QSTART),(5,0(R5))                              
         CLC   QEND(6),SPACES                                                   
         BE    EX2                                                              
         LA    R5,9(R5)                                                         
         SPACE 2                                                                
EX62     CLC   QEND(6),SPACES                                                   
         BE    EX2                                                              
         MVC   0(L'SP@TO,R5),SP@TO                                              
         LR    R7,R5                                                            
         LA    R7,L'SP@TO-1(R7)                                                 
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         LA    R7,2(R7)                                                         
         CLC   QEND+4(2),SPACES                                                 
         BNE   EX63                                                             
         MVC   QEND+4(2),=C'01'                                                 
         GOTO1 DATCON,REPWORK,(0,QEND),(6,0(R7))                                
         MVC   QEND+4(2),SPACES                                                 
         B     EX2                                                              
         SPACE 2                                                                
EX63     EQU   *                                                                
         GOTO1 DATCON,REPWORK,(0,QEND),(5,3(R5))                                
         CLC   =C'ES',QSTAUTO      SHOW AN ASTERISK IF EST DATES USED           
         BNE   EX2                                                              
         MVI   12(R5),C'*'                                                      
         B     EX2                                                              
         SPACE 2                                                                
EX64     DS    0H                                                               
         MVC   0(L'SP@RQSTR,R5),SP@RQSTR                                        
         LR    R7,R5                                                            
         LA    R7,L'SP@RQSTR-1(R7)                                              
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         LA    R7,2(R7)                                                         
         MVC   0(12,R7),QUESTOR                                                 
         CLC   AGY,=C'NW'          THIS PIECE OF CRAP IS FOR                    
         BNE   EX2                 GEORGE BURROWS                               
         CLC   CLT(2),=C'KP'                                                    
         BNE   EX2                                                              
         CLI   QUESTOR+3,C'.'      MUST BE AN NN.NN FIELD                       
         BNE   EX2                                                              
         CLI   QUESTOR+6,C'$'      CHECK FOR A DOLLAR SIGN                      
         BE    EX65                                                             
         CLI   QUESTOR+6,C'%'      OR A PERCENT SIGN                            
         BNE   EX2                                                              
         SPACE 1                                                                
EX65     MVC   10(12,R5),SPACES                                                 
         B     EX2                                                              
         EJECT                                                                  
* ROUTINES FOR APRINT SPECS (6-17)                                              
         SPACE 2                                                                
EX66     L     RF,ADAGY                                                         
         USING AGYRECD,RF                                                       
         TM    AGYFLAG1,X'40'      SPECIAL MEDIA NAMES                          
         BNO   EX67                                                             
         L     R6,ADCLT                                                         
         USING CLTHDR,R6                                                        
         CLC   CMEDNAME,SPACES                                                  
         BNH   EX67                                                             
         MVC   0(10,R5),CMEDNAME   SPECIAL MEDIA NAME                           
         B     EX2                                                              
         SPACE                                                                  
EX67     MVC   0(10,R5),MEDNM      MEDIA                                        
         CLI   QORIGBUY,C'Y'                                                    
         BNE   EX2                                                              
         MVC   11(10,R5),=C'*ORIGINAL*'                                         
         B     EX2                                                              
         SPACE 2                                                                
EX68     MVC   0(33,R5),AGYNM      AGENCY NAME                                  
         B     EX2                                                              
         SPACE 2                                                                
EX70     MVC   0(33,R5),AGYADR     AGENCY ADDRESS                               
         B     EX2                                                              
         SPACE 2                                                                
EX72     CLI   MODE,CLTLAST        CLIENT ROUTINES                              
         BH    EX2                                                              
         MVC   0(L'SP@CLI,R5),SP@CLI                                            
         MVC   9(3,R5),CLT                                                      
         MVC   13(24,R5),CLTNM                                                  
         B     EX2                                                              
         SPACE 2                                                                
EX74     CLI   MODE,CLTLAST                                                     
         BH    EX2                                                              
         MVC   0(24,R5),CLTNM                                                   
         B     EX2                                                              
         SPACE 2                                                                
EX76     CLI   MODE,PRDLAST        PRODUCT ROUTINES                             
         BH    EX2                                                              
         MVC   0(L'SP@PRO,R5),SP@PRO                                            
         MVC   9(3,R5),PRODUCT                                                  
         MVC   13(24,R5),PRDNM                                                  
         CLC   PRD2,SPACES                                                      
         BNH   EX2                                                              
         LA    RF,11(R5)                                                        
         CLI   0(RF),C' '                                                       
         BNH   *+8                                                              
         LA    RF,1(RF)                                                         
         MVI   0(RF),C'-'                                                       
         MVC   1(3,RF),PRD2                                                     
         MVI   4(RF),C' '                                                       
         MVC   5(10,RF),PRDNM                                                   
         MVI   15(RF),C'-'                                                      
         MVC   16(10,RF),PRDNM2                                                 
         B     EX2                                                              
         SPACE 2                                                                
EX78     CLI   MODE,PRDLAST                                                     
         BH    EX2                                                              
         MVC   0(24,R5),PRDNM                                                   
         B     EX2                                                              
         SPACE 2                                                                
EX80     CLI   MODE,CLTLAST        ESTIMATE ROUTINES                            
         BH    EX2                                                              
         CLC   QEST(2),=C'NO'                                                   
         BE    EX82                                                             
         CLC   QEST(3),=C'ALL'                                                  
         BE    EX80B                                                            
         CLC   QESTEND,SPACES                                                   
         BNE   EX84                                                             
         B     EX81                                                             
EX80B    DS    0H                                                               
         CLI   MODE,PRDLAST                                                     
         BH    EX2                                                              
         SPACE 2                                                                
EX81     DS    0H                                                               
         MVC   0(L'SP@EST,R5),SP@EST                                            
         MVC   9(3,R5),ESTIMATE                                                 
         MVC   13(24,R5),ESTNM                                                  
         B     EX2                                                              
         SPACE 2                                                                
EX82     DS    0H                                                               
         MVC   0(L'SP@ALLES,R5),SP@ALLES                                        
         ICM   R6,15,ADCLT                                                      
         BZ    EX83                                                             
         USING CLTHDR,R6                                                        
         CLI   CEXTRA+6,C'Y'                                                    
         BNE   EX83                                                             
         DROP  R6                                                               
* SUPPORT OPTION TO PRINT NAME OF LOWEST EST IF QEST=NO *                       
         LA    R5,14(R5)                                                        
         CLC   QESTEND,SPACES      TEST FILTERS ACTIVE                          
         BE    EX82X               NO                                           
         SH    R5,=H'14'                                                        
         MVC   0(L'SP@ESTFL,R5),SP@ESTFL                                        
         MVC   8(2,R5),=C'=('                                                   
         MVC   10(10,R5),SPACES                                                 
* THE NEXT 3 INSTRUCTIONS REALLY SUCK *                                         
         CLC   =C'ME',AGY                                                       
         BNE   *+10                                                             
         MVC   0(L'SP@EST,R5),SP@EST                                            
         LA    R0,3                                                             
         LA    R1,QESTEND                                                       
         LA    R5,10(R5)                                                        
EX82A    CLI   0(R1),C' '                                                       
         BE    EX82B                                                            
         MVC   0(1,R5),0(R1)                                                    
         TM    0(R1),X'40'         TEST NEGATIVE FILTER                         
         BO    EX82B                                                            
* NEGATIVE FILTER *                                                             
         MVI   0(R5),C'-'                                                       
         MVC   1(1,R5),0(R1)                                                    
         OI    1(R5),X'40'         CONVERT TO UPPER CASE                        
         LA    R5,1(R5)                                                         
*                                                                               
EX82B    LA    R5,2(R5)            LEAVE SPACE BETWEEN FILTERS                  
         LA    R1,1(R1)                                                         
         BCT   R0,EX82A                                                         
*                                                                               
         BCTR  R5,0                                                             
         MVI   0(R5),C')'                                                       
EX82X    MVC   2(24,R5),ESTNM                                                   
         B     EX2                                                              
*                                                                               
EX83     BAS   RE,FLTRES                                                        
         B     EX2                                                              
         SPACE 2                                                                
EX84     DS    0H                                                               
         MVC   0(L'SP@ESTGR,R5),SP@ESTGR                                        
         MVC   15(3,R5),QEST                                                    
         MVC   19(3,R5),QESTEND                                                 
         SPACE 1                                                                
* THIS IS FOR A STUPID JWT OPTION TO PRINT NAME ON SOME SERIES REQ'S *          
         SPACE 1                                                                
         L     R6,ADCLT                                                         
         USING CLTHDR,R6                                                        
         CLI   CPROF+7,C'*'                                                     
         BE    EX84A                                                            
         TM    CPROF+7,X'F0'       TEST NUMERIC                                 
         BNO   EX2                 NO                                           
         PACK  DUB,QEST                                                         
         CVB   RE,DUB                                                           
         PACK  DUB,QESTEND                                                      
         CVB   RF,DUB                                                           
         SR    RF,RE                                                            
         PACK  DUB,CPROF+7(1)                                                   
         CVB   RE,DUB                                                           
         SR    RE,RF                                                            
         BM    EX2                                                              
EX84A    MVC   0(16,R5),SPACES                                                  
         MVC   0(L'SP7ESTGR,R5),SP7ESTGR                                        
         MVC   8(3,R5),QEST                                                     
         MVC   12(3,R5),QESTEND                                                 
         MVC   16(24,R5),ESTNM                                                  
         B     EX2                                                              
         SPACE 2                                                                
EX86     CLI   MODE,CLTLAST                                                     
         BH    EX2                                                              
         MVC   0(24,R5),ESTNM                                                   
         B     EX2                                                              
         SPACE 2                                                                
EX88     CLI   MODE,CLTLAST                                                     
         BH    EX2                                                              
         MVC   0(L'SP@ALL,R5),SP@ALL                                            
         CLC   QEST(2),=C'NO'                                                   
         BE    EX2                                                              
         MVC   0(3,R5),ESTIMATE                                                 
         CLC   QESTEND,SPACES                                                   
         BE    EX2                                                              
         MVI   3(R5),C'-'                                                       
         MVC   4(3,R5),QESTEND                                                  
         B     EX2                                                              
         EJECT                                                                  
EX90     CLI   MODE,MKTLAST        MARKET ROUTINES                              
         BH    EX2                                                              
         CLI   SPSUPMKT,C'Y'                                                    
         BE    EX2                                                              
         MVC   0(L'SP6MRKT,R5),SP6MRKT                                          
         MVC   7(4,R5),MKT                                                      
         MVC   12(24,R5),MKTNM                                                  
         OC    SPWEIGHT,SPWEIGHT                                                
         BZ    EX2                                                              
         LR    R7,R5                                                            
         A     R7,PWIDTH                                                        
         MVC   12(L'SP@COV,R7),SP@COV                                           
*                                                                               
         LR    R7,R5                                                            
         A     R7,PWIDTH                                                        
         LA    R7,24(R7)                                                        
*                                                                               
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
*                                                                               
         LA    R7,1(R7)                                                         
         MVI   0(R7),C'='                                                       
         CURED (4,SPWEIGHT),(8,1(R7)),2,ALIGN=LEFT,DMCB=REPDMCB                 
         B     EX2                                                              
         SPACE 2                                                                
EX92     CLI   MODE,CBHLAST        STATION ROUTINES                             
         BH    EX2                                                              
         MVC   0(L'SP@STATN,R5),SP@STATN                                        
         LR    R7,R5                                                            
         LA    R7,L'SP@STATN-1(R7)                                              
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         MVC   2(8,R7),BIGSTA                                                   
         B     EX2                                                              
         SPACE 2                                                                
EX100    PACK  REPDUB,RCPROG                                                    
         CVB   R0,REPDUB                                                        
         GOTO1 REQCARVE,REPARA,(C'S',QAREA),((R0),AREA+64),(2,AREA)             
         L     R0,PWIDTH                                                        
         GOTO1 CHOPPER,REPARA,(250,AREA+64),((R0),(R5)),(C'P',2)                
         B     EX2                                                              
         EJECT                                                                  
* ROUTINES FOR PRODUCT GROUP & MARKET GROUP                                     
         SPACE 2                                                                
EX102    CLI   MODE,PGR1LAST                                                    
         BH    EX2                                                              
         MVC   00(12,R5),PGR1BK        PGR BREAK 1                              
         MVC   13(05,R5),PGR1                                                   
         MVC   20(24,R5),PGR1NM                                                 
         CLC   PGR1LEN,PGR2LEN                                                  
         BE    EX106                                                            
         CLI   MODE,PGR2LAST                                                    
         BH    EX106                                                            
         A     R5,PWIDTH                                                        
         MVC   0(12,R5),PGR2BK                                                  
         MVC   13(05,R5),PGR2                                                   
         MVC   20(24,R5),PGR2NM                                                 
*****    MVC   132+00(12,R5),PGR2BK    PGR BREAK 2                              
*****    MVC   132+13(05,R5),PGR2                                               
*****    MVC   132+20(24,R5),PGR2NM                                             
         B     EX106               PGR3 NO LONGER USED                          
         SPACE 2                                                                
EX104    CLI   MODE,MGR1LAST                                                    
         BH    EX2                                                              
         MVC   00(12,R5),MGR1BK        MGR BREAK1                               
         MVC   13(06,R5),MGR1N                                                  
         MVC   20(24,R5),MGR1NM                                                 
         CLC   MGR1LEN,MGR2LEN                                                  
         BE    EX106                                                            
         CLI   MODE,MGR2LAST                                                    
         BH    EX106                                                            
         A     R5,PWIDTH                                                        
         MVC   0(12,R5),MGR2BK                                                  
         MVC   13(06,R5),MGR2N                                                  
         MVC   20(24,R5),MGR2NM                                                 
*                                                                               
*****    MVC   132+00(12,R5),MGR2BK                                             
*****    MVC   132+13(06,R5),MGR2N                                              
*****    MVC   132+20(24,R5),MGR2NM                                             
         CLC   MGR2LEN,MGR3LEN                                                  
         BE    EX106                                                            
         CLI   MODE,MGR3LAST                                                    
         BH    EX106                                                            
         A     R5,PWIDTH                                                        
         MVC   0(12,R5),MGR3BK                                                  
         MVC   13(06,R5),MGR3N                                                  
         MVC   20(24,R5),MGR3NM                                                 
*                                                                               
*****    MVC   264+00(12,R5),MGR3BK                                             
*****    MVC   264+13(06,R5),MGR3N                                              
*****    MVC   264+20(24,R5),MGR3NM                                             
         B     EX2                                                              
         SPACE 2                                                                
EX106    B     EX2                                                              
         MVC   AREA+120(20),AREA                                                
         GOTO1 SQUASHER,REPARA,AREA,120                                         
         CLI   REPARA+7,48         KEEP IT DOWN TO 48 BYTES                     
         BNH   EX108                                                            
         MVC   AREA+140(24),SPACES TAKE OUT NAME1                               
         MVC   AREA(120),AREA+120                                               
         GOTO1 (RF),(R1),,120                                                   
         CLI   REPARA+7,48                                                      
         BNH   EX108                                                            
         MVC   AREA+170(24),SPACES TAKE OUT NAME2                               
         MVC   AREA(120),AREA+120                                               
         GOTO1 (RF),(R1),,120                                                   
         SPACE 2                                                                
EX108    MVC   0(50,R5),AREA                                                    
         B     EX2                                                              
         EJECT                                                                  
* ROUTINE FOR DAYPART/RATING/BOOK/EQUIV                                         
         SPACE 2                                                                
EX110    DS    0H                                                               
         MVC   0(L'SP@ALDP,R5),SP@ALDP                                          
         LR    R7,R5                                                            
         LA    R7,L'SP@ALDP-1(R7)                                               
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         LA    R7,1(R7)                                                         
         MVI   0(R7),C'('                                                       
         MVI   2(R7),C')'                                                       
         MVC   5(L'SP@ALSL,R7),SP@ALSL                                          
         MVC   1(1,R7),QDPTMENU                                                 
         CLI   QDPTMENU,C' '       MENU NUMBER REQUESTED                        
         BNE   EX111                                                            
         L     R6,ADEST                                                         
         USING ESTHDR,R6                                                        
         MVC   1(1,R7),EDAYMENU   OR FROM EST HDR.                              
         SPACE 2                                                                
EX111    CLI   1(R7),C'0'                                                       
         BNE   EX2                                                              
         MVC   0(33,R5),SPACES                                                  
         B     EX2                                                              
         SPACE 2                                                                
EX112    DS    0H                                                               
         CLI   QRERATE,C' '        TEST RERATING                                
         BE    EX113               NO - SPCL DEMO ADJ FCTRS NOT APPLIC          
         L     R6,ADCLT                                                         
         USING CLTHDR,R6                                                        
         CLI   CEXTRA+12,C'Y'      TEST SPCL DEMO ADJ FCTRS                     
         BNE   EX113                                                            
         MVC   0(4,R5),=C'DF=N'    ASSUME NOT IN USE                            
         OC    SPDFPROF,SPDFPROF   TEST READ PROFILE                            
         BZ    EX112X              NO                                           
         CLI   SPDFPROF,C'*'       FACTORS APPLY FOR ALL MENUS                  
         BE    EX112B              YUP                                          
* TEST ESTIMATE IN PROFILE                                                      
         L     RF,ADEST                                                         
         LA    RF,EDAYMENU-ESTHDR(RF)  POINT TO EDAYMENU                        
         CLI   QDPTMENU,C' '           TEST DPT MENU OVERRIDE                   
         BE    *+8                     NO                                       
         LA    RF,QDPTMENU                                                      
*                                                                               
         LA    R0,16                                                            
         LA    R1,SPDFPROF                                                      
*                                                                               
EX112A   CLC   0(1,RF),0(R1)                                                    
         BE    EX112B                                                           
         LA    R1,1(R1)                                                         
         BCT   R0,EX112A                                                        
         B     EX112X                                                           
*                                                                               
EX112B   MVI   3(R5),C'Y'          INDICATE FACTORS USED                        
*                                                                               
EX112X   LA    R5,5(R5)                                                         
*                                                                               
EX113    L     R6,ADCLT                                                         
         USING CLTHDR,R6                                                        
         MVC   0(L'SP@RTG,R5),SP@RTG                                            
         LR    R7,R5                                                            
         AHI   R7,L'SP@RTG                                                      
*                                                                               
         MVC   1(L'SP@NSIC,R7),SP@NSIC                                          
         GOTO1 DATCON,REPARA,(5,0),(20,REPDUB)                                  
         MVC   4(4,R7),REPDUB                                                   
         CLI   Q2USER+2,C'W'                                                    
         BNE   *+8                                                              
         MVI   3(R7),C'W'                                                       
         CLI   CPROF+3,C'0'                                                     
         BE    EX113D                                                           
*                                                                               
         CLI   QMED,C'R'           RADIO STILL HAS ARB                          
         BE    EX113B                                                           
         CLI   QBOOK1,C'0'         TEST BOOK NUMERIC                            
         BH    EX113A              YES                                          
         CLC   QEND(4),=C'9403'    HAVE A LOOK AT REQUEST PERIOD                
         BNH   EX113B              NOT AFTER MAR/94 SO SAY ARB                  
         B     EX113C                                                           
*                                                                               
EX113A   CLC   QBOOK1(4),=C'9402'  IF BOOK IS LATER THAN FEB/94                 
         BH    EX113C                IT IS NOT ARB                              
*                                                                               
EX113B   MVC   1(L'SP@NSIC,R7),SPACES                                           
***      MVC   1(L'SP@ARB,R7),SP@ARB                                            
         MVC   1(L'SP@ARB,R7),=C'NAM'                                           
*                                                                               
EX113C   L     RF,ADAGY                                                         
         USING AGYRECD,RF                                                       
         CLI   AGYPROF+7,C'C'                                                   
         BNE   EX113D                                                           
         CLI   CEXTRA,C'U'                                                      
         BE    EX113D                                                           
         MVC   1(L'SP@NSIC,R7),SPACES                                           
         MVC   1(L'SP@BBM,R7),SP@BBM                                            
*                                                                               
EX113D   AHI   R5,27                                                            
         CLI   0(R5),C' '                                                       
         BNE   *+8                                                              
         BCT   R5,*-8                                                           
         AHI   R5,2                                                             
*                                                                               
         CLI   QRERATE,C'I'        TEST AFFID                                   
         BNE   EX2                                                              
*                                                                               
         ICM   RE,15,ASV1W         GET WEEKLY PROFILE ADDRESS                   
         BZ    EX2                                                              
*                                                                               
         CLI   0(RE),C'Y'          TEST ALL BUYS GET WEEKLY                     
         BE    EX113E                                                           
         CLI   1(RE),C'Y'          TEST -S BUYS GET WEEKLY                      
         BE    EX113E                                                           
         CLI   2(RE),C' '          TEST SPCL CHAR GETS WEEKLY                   
         BNH   EX2                 NO                                           
         CLI   2(RE),X'6D'         UNDERSCORE DOESN'T COUNT                     
         BE    EX2                                                              
*                                                                               
EX113E   MVC   0(2,R5),=C'W='                                                   
         MVC   2(3,R5),0(RE)       MOVE PROFILE                                 
*                                                                               
         CLI   4(R5),X'6D'         TEST LAST CHAR (3) FOR UNDERSCORE            
         BNE   *+8                 WHICH LOOKS DREADFUL WHEN PRINTED            
         MVI   4(R5),C' '          SO MAKE IT A BLANK                           
         B     EX2                                                              
         SPACE 2                                                                
EX114    ST    R5,REPSAVE                                                       
         CLI   QRERATE,C'U'        TEST UPGRADE                                 
         BNE   EX115                                                            
         MVC   0(29,R5),=C'UPGRADE PUT=JUL/97,SHR=FEB/97'                       
         MVC   REPDUB(4),QBOOK1                                                 
         MVC   REPDUB+4(2),=C'01'                                               
         GOTO1 DATCON,REPARA,REPDUB,(6,12(R5))                                  
         MVC   REPDUB(4),Q2BOOK2                                                
         GOTO1 DATCON,REPARA,REPDUB,(6,23(R5))                                  
         B     EX2                                                              
EX115    MVC   0(L'SP2ACHVD,R5),SP2ACHVD                                        
         CLI   QRERATE,C'I'                                                     
         BNE   *+10                                                             
         MVC   0(L'SP@AFDON,R5),SP@AFDON                                        
         CLC   QBOOK1,SPACES                                                    
         BNE   EX116                                                            
         MVC   0(L'SP@PURCH,R5),SP@PURCH                                        
         LA    R5,1(R5)                                                         
         SPACE 2                                                                
EX116    DS    0H                                                               
         LA    R5,12(R5)           LOOK AT MAX LENGTH                           
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
         LA    R5,2(R5)                                                         
         L     R6,ADEST                                                         
         USING ESTHDR,R6                                                        
         MVC   AREA(4),QBOOK1      BOOK FROM REQUEST                            
         MVC   AREA+4(2),=C'01'                                                 
         CLC   QBOOK1(2),=C'AC'    ACTUAL BOOK REQUESTED                        
         BNE   *+14                                                             
         MVC   0(L'SP@ACTL,R5),SP@ACTL                                          
         B     EX119                                                            
         CLC   QBOOK1(2),=C'LA'    LATEST BOOK REQUESTED                        
         BNE   *+14                                                             
         MVC   0(L'SP@LATES,R5),SP@LATES                                        
         B     EX119                                                            
         CLC   QBOOK1(2),=C'VA'    VARIOUS BOOK REQUESTED                       
         BNE   *+14                                                             
         MVC   0(L'SP@VAR,R5),SP@VAR                                            
         B     EX119                                                            
         CLC   QBOOK1,SPACES                                                    
         BNE   EX118                                                            
         MVC   0(L'SP@LATES,R5),SP@LATES                                        
         OC    EBOOK,EBOOK                                                      
         BZ    EX119                                                            
         MVC   AREA+10(2),EBOOK    OR ESTIMATE HEADER                           
         MVI   AREA+12,1                                                        
         GOTO1 DATCON,REPARA,(3,AREA+10),(0,AREA)                               
         SPACE 2                                                                
         MVC   0(L'SP@LATES,R5),SPACES OVERWRITE WITH DATE                      
EX118    GOTO1 DATCON,REPARA,(0,AREA),(6,0(R5))                                 
         SPACE 2                                                                
EX119    DS    0H                                                               
         LA    R5,8(R5)            MAX LENGTH                                   
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
         LA    R5,2(R5)                                                         
         MVC   0(L'SP@BOOK,R5),SP@BOOK                                          
         CLC   QHUT1,=C'NO'                                                     
         BE    EX123                                                            
         LA    R5,L'SP@BOOK-1(R5)                                               
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
         LA    R5,2(R5)                                                         
*                                                                               
         CLI   QHUT1,C'B'          INDICATES NBOOK AVERAGE                      
         BNE   EX119A                                                           
         MVI   0(R5),C'('                                                       
         MVC   1(2,R5),QHUT1                                                    
         MVC   3(3,R5),=C'AVG'                                                  
         MVI   6(R5),C')'                                                       
         B     EX123                                                            
*                                                                               
EX119A   CLC   QHUT1,SPACES                                                     
         BE    EX120                                                            
         PACK  REPDUB,QHUT1                                                     
         CVB   R0,REPDUB                                                        
         STC   R0,AREA                                                          
         B     EX122                                                            
         SPACE 2                                                                
EX120    DS    0H                                                               
         MVC   0(L'SP@AUTP,R5),SP@AUTP                                          
         CLC   QBOOK1(2),=C'AC'                                                 
         BE    EX123                                                            
         CLI   EHUTADJ,0                                                        
         BE    EX123                                                            
         SR    RF,RF                                                            
         IC    RF,EHUTADJ                                                       
         SRL   RF,4                                                             
         STC   RF,AREA                                                          
         NI    AREA,X'0F'                                                       
         SPACE 2                                                                
EX122    DS    0H                                                               
         MVI   0(R5),C'('                                                       
         MVC   5(L'SP@ADJ,R5),SP@ADJ                                            
         MVI   8(R5),C')'                                                       
         SR    RF,RF                                                            
         IC    RF,AREA                                                          
         BCTR  RF,0                                                             
         MH    RF,=H'3'                                                         
         LA    RF,MONTHS(RF)                                                    
         MVC   1(3,R5),0(RF)                                                    
         MVI   4(R5),C' '                                                       
         SPACE 2                                                                
EX123    CLI   QOPT5,C'Y'                                                       
         BNE   EX2                                                              
         L     R5,REPSAVE                                                       
         LR    R7,R5                                                            
         A     R7,PWIDTH                                                        
         MVI   0(R7),C'*'                                                       
         LA    R7,2(R7)                                                         
         MVC   0(L'SP0ACHVD,R7),SP0ACHVD                                        
         LA    R7,L'SP0ACHVD-1(R7)                                              
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         LA    R7,2(R7)                                                         
         MVC   0(L'SP@BOAFF,R7),SP@BOAFF                                        
         LA    R7,L'SP@BOAFF-1(R7)                                              
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         LA    R7,2(R7)                                                         
         MVI   0(R7),C'*'                                                       
         B     EX2                                                              
         SPACE 2                                                                
EX124    DS    0H                                                               
         MVC   0(L'SP@EQUB,R5),SP@EQUB                                          
         LR    R7,R5                                                            
         LA    R7,L'SP@EQUB-1(R7)                                               
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         LA    R7,2(R7)                                                         
         MVC   0(4,R7),=C'= 29'                                                 
         MVC   4(L'SP@SEC,R7),SP@SEC                                            
*                                                                               
         BRAS  RE,GETEQ                                                         
         B     EX2                                                              
         SPACE 2                                                                
EX130    LA    RE,COMPTAB                                                       
         SPACE 2                                                                
EX132    CLI   0(RE),X'FF'                                                      
         BE    EX2                                                              
         CLC   0(1,RE),QCOMPARE                                                 
         BE    EX134                                                            
         SR    RF,RF                                                            
         IC    RF,1(RE)                                                         
         LA    RE,2(RE,RF)                                                      
         B     EX132                                                            
         SPACE 2                                                                
EX134    DS    0H                                                               
         ZIC   R1,1(RE)            L'STRING                                     
         ICM   RE,7,2(RE)          A(STRING)                                    
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     EX2                                                              
         MVC   0(0,R5),0(RE)                                                    
         SPACE 2                                                                
COMPTAB  DC    C' ',AL1(L'SP@GVSP),AL3(SP@GVSP)                                 
         DC    C'A',AL1(L'SP@GVSP),AL3(SP@GVSP)                                 
         DC    C'B',AL1(L'SP@GVSA),AL3(SP@GVSA)                                 
         DC    C'C',AL1(L'SP@PVSR),AL3(SP@PVSR)                                 
         DC    C'D',AL1(L'SP@PVSA),AL3(SP@PVSA)                                 
         DC    C'E',AL1(L'SP@LVSP),AL3(SP@LVSP)                                 
         DC    C'F',AL1(L'SP@LVSA),AL3(SP@LVSA)                                 
         DC    C'L',AL1(L'SP@GVSL),AL3(SP@GVSL)                                 
         DC    C'H',AL1(L'SP@GVPR),AL3(SP@GVPR)                                 
         DC    C'I',AL1(L'SP@GVPA),AL3(SP@GVPA)                                 
         DC    C'J',AL1(L'SP@GVLR),AL3(SP@GVLR)                                 
         DC    C'K',AL1(L'SP@GVLA),AL3(SP@GVLA)                                 
         DC    X'FF'                                                            
         EJECT                                                                  
* SPECIAL SPECS FOR MARKET GROUPS, MARKET & WEIGHT                              
         SPACE 2                                                                
EX140    CLC   MGR3BK,SPACES       WE ALWAYS WANT TO SKIP A LINE                
         BE    EX142               EXCEPT WHEN ALL 3 LEVELS ARE PRESENT         
         CLI   MODE,MKTLAST        AND WE ARE SHOWING MARKET & WEIGHT           
         BH    EX142                                                            
         OC    SPWEIGHT,SPWEIGHT                                                
         BNZ   EX144                                                            
         SPACE 2                                                                
EX142    A     R5,PWIDTH                                                        
         SPACE 2                                                                
EX144    CLC   MGR1BK,SPACES      IF THERE ARE NO MARKET GROUPS,                
         BNE   EX145               USE REGULAR MARKET ROUTINE                   
         CLI   MODE,MKTLAST                                                     
         BNH   EX90                                                             
         SPACE 2                                                                
EX145    CLI   MODE,PRDLAST                                                     
         BH    EX2                                                              
         BE    EX148                                                            
         MVC   0(12,R5),MGR1BK     GROUP LEVEL 1                                
         MVC   13(6,R5),MGR1N                                                   
         MVC   20(24,R5),MGR1NM                                                 
         A     R5,PWIDTH                                                        
         CLI   MODE,MGR2LAST                                                    
         BH    EX148                                                            
         CLC   MGR1LEN,MGR2LEN                                                  
         BE    EX146                                                            
         MVC   0(12,R5),MGR2BK     GROUP LEVEL 2                                
         MVC   13(6,R5),MGR2N                                                   
         MVC   20(24,R5),MGR2NM                                                 
         A     R5,PWIDTH                                                        
         CLI   MODE,MGR3LAST                                                    
         BH    EX148                                                            
         CLC   MGR2LEN,MGR3LEN                                                  
         BE    EX146                                                            
         MVC   0(12,R5),MGR3BK     GROUP LEVEL 3                                
         MVC   13(6,R5),MGR3N                                                   
         MVC   20(24,R5),MGR3NM                                                 
         A     R5,PWIDTH                                                        
         SPACE 2                                                                
EX146    CLI   MODE,MKTLAST        MARKET                                       
         BH    EX148                                                            
         CLI   SPSUPMKT,C'Y'                                                    
         BE    EX2                                                              
         MVC   0(L'SP6MRKT,R5),SP6MRKT                                          
         MVC   13(4,R5),MKT                                                     
         MVC   20(24,R5),MKTNM                                                  
*                                                                               
         CLI   QMGR,C'0'           MARKET RANKING                               
         BL    EX147                                                            
*                                                                               
         LA    RF,19               # TO MOVE (5 LOSTED)                         
         LA    RE,38(R5)           END OF MKT NAME - 5                          
EX146A   MVC   5(1,RE),0(RE)       MOVE - 19 TO 24,18 TO 23,ETC                 
         BCTR  RE,0                LESS 1 FROM ADDRESS IN RE                    
         BCT   RF,EX146A           19 X                                         
         MVC   20(5,R5),MRANK      STORE RANK                                   
EX147    A     R5,PWIDTH                                                        
         B     EX150                                                            
         SPACE 2                                                                
EX148    OC    SPNOMKTS,SPNOMKTS                                                
         BZ    EX2                                                              
         MVC   0(L'SP7MRKT,R5),SP7MRKT                                          
         LR    R7,R5                                                            
         LA    R7,L'SP7MRKT-1(R7)                                               
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         LA    R7,1(R7)                                                         
         MVI   0(R7),C'='                                                       
         LA    R7,1(R7)                                                         
         EDIT  (4,SPNOMKTS),(4,0(R7)),ALIGN=LEFT                                
         LR    R7,R5                                                            
         LA    R7,13(R7)                                                        
         MVC   0(4,R7),=C'****'                                                 
         LA    R7,7(R7)                                                         
         MVC   0(L'SP@COV,R7),SP@COV                                            
         LA    R7,L'SP@COV-1(R7)                                                
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         LA    R7,1(R7)                                                         
         MVI   0(R7),C'='                                                       
         OC    SPWEIGHT,SPWEIGHT                                                
         BNZ   *+14                                                             
         XC    13(16,R5),13(R5)                                                 
         B     EX2                                                              
         LA    R7,1(R7)                                                         
         CURED (4,SPWEIGHT),(6,0(R7)),2,ALIGN=LEFT,DMCB=REPDMCB                 
         B     EX2                                                              
         SPACE 2                                                                
EX150    OC    SPWEIGHT,SPWEIGHT                                                
         BZ    EX2                                                              
         MVC   20(L'SP@COV,R5),SP@COV                                           
         LR    R7,R5                                                            
         LA    R7,L'SP@COV+20-1(R7)                                             
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         LA    R7,1(R7)                                                         
         MVI   0(R7),C'='                                                       
         CURED (4,SPWEIGHT),(6,1(R7)),2,ALIGN=LEFT,DMCB=REPDMCB                 
         B     EX2                                                              
         EJECT                                                                  
* SPECIAL ROUTINES FOR PRODUCT GROUPS, CLI/PROD/EST                             
         SPACE 2                                                                
EX152    CLI   MODE,PGR1LAST                                                    
         BH    EX2                                                              
         CLC   PGR1BK,SPACES       IF NO PRODUCT GROUPS, THE ORIGINAL           
         BNH   EX2                 CLI/PROD/EST SPECS CAN STAND                 
         MVC   0(44,R5),SPACES     OTHERWISE WE LINE THINGS UP                  
         LR    R7,R5                                                            
         A     R7,PWIDTH                                                        
         MVC   0(44,R7),SPACES                                                  
         A     R7,PWIDTH                                                        
         MVC   0(44,R7),SPACES                                                  
         A     R7,PWIDTH                                                        
         MVC   0(44,R7),SPACES                                                  
         A     R7,PWIDTH                                                        
         MVC   0(44,R7),SPACES                                                  
         A     R7,PWIDTH                                                        
         MVC   0(44,R7),SPACES                                                  
*                                                                               
****     MVC   132(44,R5),SPACES                                                
****     MVC   264(44,R5),SPACES                                                
****     MVC   396(44,R5),SPACES                                                
****     MVC   528(44,R5),SPACES                                                
****     MVC   660(44,R5),SPACES                                                
*                                                                               
         MVC   0(L'SP@CLI,R5),SP@CLI                                            
         MVC   13(3,R5),CLT                                                     
         MVC   20(24,R5),CLTNM                                                  
         A     R5,PWIDTH                                                        
         MVC   0(12,R5),PGR1BK     GROUP LEVEL 1                                
         MVC   13(5,R5),PGR1                                                    
         MVC   20(24,R5),PGR1NM                                                 
         A     R5,PWIDTH                                                        
         CLI   MODE,PGR2LAST       GROUP LEVEL 2                                
         BH    EX156                                                            
         CLC   PGR2BK,SPACES                                                    
         BNH   EX154                                                            
         MVC   0(12,R5),PGR2BK                                                  
         MVC   13(5,R5),PGR2                                                    
         MVC   20(24,R5),PGR2NM                                                 
         A     R5,PWIDTH                                                        
         SPACE 2                                                                
EX154    CLI   MODE,PRDLAST        PRODUCT                                      
         BH    EX156                                                            
         MVC   0(L'SP@PRO,R5),SP@PRO                                            
         MVC   13(3,R5),PRODUCT                                                 
         MVC   20(24,R5),PRDNM                                                  
         A     R5,PWIDTH                                                        
         SPACE 2                                                                
EX156    CLI   MODE,CLTLAST        ESTIMATE                                     
         BH    EX2                                                              
         CLC   QEST(2),=C'NO'                                                   
         BE    EX158                                                            
         CLC   QEST(3),=C'EST'                                                  
         BNE   EX157                                                            
         CLI   MODE,PRDLAST                                                     
         BH    EX2                                                              
         SPACE 2                                                                
EX157    DS    0H                                                               
         MVC   0(L'SP@EST,R5),SP@EST                                            
         CLC   QESTEND,SPACES                                                   
         BNE   EX160                                                            
         MVC   13(3,R5),ESTIMATE                                                
         MVC   20(24,R5),ESTNM                                                  
         B     EX2                                                              
         SPACE 2                                                                
EX158    DS    0H                                                               
         MVC   0(L'SP@ALLES,R5),SP@ALLES                                        
         BAS   RE,FLTRES                                                        
         B     EX2                                                              
         SPACE 2                                                                
EX160    DS    0H                                                               
         MVC   13(L'SP@GROUP,R5),SP@GROUP                                       
         MVC   20(3,R5),QEST                                                    
         MVI   23(R5),C'-'                                                      
         MVC   24(3,R5),QESTEND                                                 
         B     EX2                                                              
         EJECT                                                                  
*  SPECIAL ROUTINES FOR ESTIMATE FILTERS                                        
         SPACE 2                                                                
FLTRES   NTR1                                                                   
*                                                                               
         CLC   QESTEND,SPACES                                                   
         BE    FLTRESX                                                          
*                                                                               
         MVC   0(27,R5),SPACES                                                  
         MVC   0(L'SP8ALLES,R5),SP8ALLES                                        
         LA    R5,L'SP8ALLES-1(R5)                                              
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
         LA    R5,2(R5)                                                         
         MVI   0(R5),C'-'                                                       
         LA    R5,2(R5)                                                         
         MVC   0(L'SP@FLTRS,R5),SP@FLTRS                                        
         LA    R5,L'SP@FLTRS-1(R5)                                              
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
         LA    R5,2(R5)                                                         
         MVI   0(R5),C'('                                                       
         LA    RE,QESTEND                                                       
         ZAP   DUB,=P'1'                                                        
         LR    RF,R5                                                            
         LA    RF,1(RF)                                                         
*                                                                               
FLTRES2  CLI   0(RE),C' '                                                       
         BE    FLTRES4                                                          
         CLI   0(RE),C'*'                                                       
         BE    FLTRES4                                                          
         OI    DUB+7,X'0F'                                                      
         UNPK  0(1,RF),DUB                                                      
         MVI   1(RF),C'='                                                       
         TM    0(RE),X'40'         TEST NEGATIVE FILTER                         
         BO    *+12                                                             
         MVI   2(RF),C'-'                                                       
         LA    RF,1(RF)                                                         
         MVC   2(1,RF),0(RE)                                                    
         OI    2(RF),C' '          INSURE UPPER CASE ON - FILTERS               
         MVI   3(RF),C','                                                       
         LA    RF,4(RF)                                                         
*                                                                               
FLTRES4  LA    RE,1(RE)                                                         
         AP    DUB,=P'1'                                                        
         CP    DUB,=P'3'                                                        
         BNH   FLTRES2                                                          
         BCTR  RF,0                                                             
         MVI   0(RF),C')'                                                       
*                                                                               
FLTRESX  XIT1                                                                   
         EJECT                                                                  
GOHOOK   NTR1                                                                   
*                                                                               
*        EXECUTES USER'S HEADHOOK ROUTINE                                       
*                                                                               
         L     RE,USERRD                                                        
         LM    R0,RC,20(RE)                                                     
         BASR  RE,RF                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
DCLIST   DS    0D                                                               
         DCDDL SP#ACHVD,11,LABEL=SP2ACHVD                                       
         DCDDL SP#ACHVD,10,LABEL=SP0ACHVD                                       
         DCDDL SP#ACTL,6                                                        
         DCDDL SP#ADJ,3                                                         
         DCDDL SP#AFDON,12,R                                                    
         DCDDL SP#ALDP,14                                                       
         DCDDL SP#ALL,4                                                         
         DCDDL SP#ALLES,13,LABEL=SP@ALLES                                       
         DCDDL SP#ALLES,8,LABEL=SP8ALLES                                        
         DCDDL SP#ALSL,16                                                       
         DCDDL SP#ARB,3                                                         
         DCDDL SP#AT,2                                                          
         DCDDL SP#AUTP,6,C                                                      
         DCDDL SP#BBM,3                                                         
         DCDDL SP#BOAFF,18                                                      
         DCDDL SP#BOOK,4                                                        
         DCDDL SP#CLI,6                                                         
         DCDDL SP#COV,10                                                        
         DCDDL SP#EQUB,18                                                       
         DCDDL SP#EST,8                                                         
         DCDDL SP#ESTFL,8                                                       
         DCDDL SP#ESTGR,7,LABEL=SP7ESTGR                                        
         DCDDL SP#ESTGR,14,LABEL=SP@ESTGR                                       
         DCDDL SP#FLTRS,10                                                      
         DCDDL SP#FROM,4                                                        
         DCDDL SP#GROUP,6                                                       
         DCDDL SP#GVLA,35,C                                                     
         DCDDL SP#GVLR,39,C                                                     
         DCDDL SP#GVPA,34,C                                                     
         DCDDL SP#GVPR,35,C                                                     
         DCDDL SP#GVSA,25,C                                                     
         DCDDL SP#GVSL,25,C                                                     
         DCDDL SP#GVSP,25,C                                                     
         DCDDL SP#LATES,7                                                       
         DCDDL SP#LVSP,25,C                                                     
         DCDDL SP#LVSA,25,C                                                     
         DCDDL SP#MRKT,7,LABEL=SP7MRKT                                          
         DCDDL SP#MRKT,6,LABEL=SP6MRKT                                          
         DCDDL SP#NSI,3                                                         
         DCDDL SP#NSIC,21                                                       
         DCDDL SP#PAGE,4                                                        
         DCDDL SP#PERD,7                                                        
         DCDDL SP#PRO,7                                                         
         DCDDL SP#PURCH,12                                                      
         DCDDL SP#PVSR,25,C                                                     
         DCDDL SP#PVSA,25,C                                                     
         DCDDL SP#RATIS,17                                                      
         DCDDL SP#RTG,4                                                         
         DCDDL SP#RQSTR,9                                                       
         DCDDL SP#RUNON,6                                                       
         DCDDL SP#SBPG,7                                                        
         DCDDL SP#SEC,8                                                         
         DCDDL SP#SPNN,7                                                        
         DCDDL SP#STATN,7                                                       
         DCDDL SP#TO,3                                                          
         DCDDL SP#VAR,4                                                         
DCLISTX  DC    X'00'                                                            
*                                                                               
DSLIST   DS    0D                                                               
         DSDDL PRINT=YES                                                        
DSLISTX  EQU   *                                                                
         EJECT                                                                  
* TABLE OF INTERNAL BRANCH VALUES                                               
         SPACE 2                                                                
         DS    0F                                                               
INBRTAB  DC    AL4(EX6)     0      END OF SPECS                                 
         DC    AL4(EX8)     1      PROGRAM RESET                                
         DC    AL4(EX10)    2              FILTER                               
         DC    AL4(EX2)     3                                                   
         DC    AL4(EX2)     4                                                   
         DC    AL4(EX2)     5                                                   
         DC    AL4(EX20A)   6      LANGUAGE SPEC                                
         DC    AL4(EX20B)   7      COUNTRY SPEC                                 
         DC    AL4(EX12)    8      THRU SPEC                                    
         DC    AL4(EX20)    9      USE SPEC                                     
         DC    AL4(EX26)   10      FILE CONTROL SPEC                            
         DC    AL4(EX28)   11      RUN CONTROL SPEC                             
         DC    AL4(EX46)   12      PRINT KEYWORD SPEC                           
         DC    AL4(EX46)   13      PRINT LITERAL SPEC                           
         EJECT                                                                  
* BRANCH TABLE FOR PRINT SPECS                                                  
         SPACE 2                                                                
         DS    0F                                                               
PRBRTAB  DC    AL4(EX50)    0      SPACES                                       
         DC    AL4(EX52)    1      RUN                                          
         DC    AL4(EX54)    2      REPORT                                       
         DC    AL4(EX56)    3      PAGE                                         
         DC    AL4(EX58)    4      PERIOD                                       
         DC    AL4(EX64)    5      REQUESTOR                                    
         DC    AL4(EX66)    6      MEDIA                                        
         DC    AL4(EX68)    7      AGYNAME                                      
         DC    AL4(EX70)    8      AGYADD                                       
         DC    AL4(EX72)    9      CLIENT                                       
         DC    AL4(EX74)   10      CLINAME                                      
         DC    AL4(EX102)  11      PRDGRP                                       
         DC    AL4(EX76)   12      PRODUCT                                      
         DC    AL4(EX78)   13      PRONAME                                      
         DC    AL4(EX2)    14                                                   
         DC    AL4(EX80)   15      ESTIMATE                                     
         DC    AL4(EX86)   16      ESTNAME                                      
         DC    AL4(EX88)   17      ESTNUM                                       
         DC    AL4(EX90)   18      MARKET                                       
         DC    AL4(EX92)   19      STATION                                      
         DC    AL4(EX104)  20      MKTGRP                                       
         DC    AL4(EX110)  21      DAYPART                                      
         DC    AL4(EX112)  22      RATING                                       
         DC    AL4(EX114)  23      BOOK                                         
         DC    AL4(EX124)  24      EQUIV                                        
         DC    AL4(EX130)          COMPARE                                      
         DC    AL4(EX140)   26     MGROUP                                       
         DC    AL4(EX152)   27     PGROUP                                       
         DC    11AL4(EX2)   28-38                                               
         DC    AL4(EX100)          REQDETS                                      
         DROP  RB                                                               
         EJECT                                                                  
*=================================================================              
* DETERMINE EQUIVALENCE FACTOR FROM TABLES                                      
*=================================================================              
                                                                                
GETEQ    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     R1,SLNADDR          PICK UP PREVIOUS ENTRY ADDRESS               
         CLC   EQVAGY,AGY          AND IF AGENCY MATCHES                        
         BNE   GETEQ2                                                           
         CLC   EQVMED,MED          AND MEDIA MATCHES                            
         BNE   GETEQ2              IT'S THE RIGHT TABLE ENTRY                   
*                                                                               
         SR    R0,R0               ALREADY HAVE THE FACTOR                      
         ICM   R0,1,EQVSECS                                                     
         BZ    GETEQ42                                                          
         B     GETEQ40                                                          
*                                                                               
GETEQ2   MVC   EQVAGY,AGY                                                       
         MVC   EQVMED,MED                                                       
*                                                                               
         L     R1,VSLNTAB                                                       
         LH    RE,0(R1)            ENTRY LENGTH                                 
         L     RF,2(R1)            DSPL TO EOT                                  
         AR    RF,R1               SET EOT ADDRESS                              
         AHI   R1,6                POINT TO FIRST ENTRY                         
*                                                                               
         MVI   BYTE,C'R'                                                        
         CLI   MED,C'R'                                                         
         BE    GETEQ10                                                          
         CLI   MED,C'X'                                                         
         BE    GETEQ10                                                          
*                                                                               
         MVI   BYTE,C'T'                                                        
         CLI   MED,C'T'                                                         
         BE    GETEQ10                                                          
         CLI   MED,C'N'                                                         
         BE    GETEQ10                                                          
         CLI   MED,C'C'                                                         
         BE    GETEQ10                                                          
         DC    H'0'                                                             
*                                                                               
GETEQ10  CLC   =C'00',0(R1)        TEST DEFAULT TABLE                           
         BE    GETEQ12                                                          
         CLC   0(2,R1),AGY         ELSE MATCH AGY                               
         BNE   *+14                                                             
GETEQ12  CLC   2(1,R1),BYTE        AND MEDIA                                    
         BE    GETEQ14                                                          
         BXLE  R1,RE,GETEQ10                                                    
         DC    H'0'                                                             
*                                                                               
GETEQ14  AHI   R1,4                POINT BEYOND HEADER                          
         ST    R1,SLNADDR          SAVE TABLE ENTRY ADDRESS                     
*                                                                               
GETEQ20  LHI   RE,30*2                                                          
         A     RE,SLNADDR          POINT TO 30 SEC ENTRY                        
         SR    R1,R1                                                            
         IC    R1,0(RE)            GET 30 SEC DSPL                              
         LA    RE,EQTAB(R1)        POINT TO 30 SEC FACTOR                       
*                                                                               
         LHI   RF,60*2                                                          
         A     RF,SLNADDR          POINT TO 60 SEC ENTRY                        
         SR    R1,R1                                                            
         IC    R1,0(RF)            GET 60 SEC DSPL                              
         LA    RF,EQTAB(R1)        POINT TO 60 SEC FACTOR                       
*                                                                               
         CLC   0(2,RE),0(RF)       IF 30/60 FACTORS EQUAL, NO EQUIV             
         BE    GETEQ42                                                          
*                                                                               
         MVI   EQVSECS,30                                                       
         CLC   0(2,RE),=H'1000'    IS 30 SEC 1000                               
         BE    GETEQ40                                                          
*                                                                               
         MVI   EQVSECS,60                                                       
         CLC   0(2,RF),=H'1000'                                                 
         BE    GETEQ40                                                          
                                                                                
* NEED TO FIND FIRST 1000 IN TABLE                                              
                                                                                
         L     R1,SLNADDR          GET CURRENT TABLE                            
         LHI   R0,250              LOOP LIMIT                                   
*                                                                               
GETEQ30  OC    0(2,R1),0(R1)       TEST ENTRY PRESENT                           
         BZ    GETEQ32                                                          
*                                                                               
         SR    RE,RE                                                            
         IC    RE,0(R1)            DSPL TO EQ FACTOR                            
         LA    RE,EQTAB(RE)                                                     
         CLC   0(2,RE),=H'1000'                                                 
         BE    GETEQ34                                                          
*                                                                               
GETEQ32  AHI   R1,2                                                             
         BCT   R0,GETEQ32                                                       
         B     GETEQ42                                                          
*                                                                               
GETEQ34  L     R0,SLNADDR                                                       
         SR    R0,R1                                                            
         LPR   R0,R0                                                            
         SRL   R0,1                DIVIDE BY 2                                  
         STC   R0,EQVSECS          SAVE THE SPOTLENGTH                          
*                                                                               
GETEQ40  SR    R0,R0                                                            
         IC    R0,EQVSECS                                                       
         EDIT  (R0),(3,1(R7))                                                   
         B     GETEQX                                                           
*                                                                               
GETEQ42  MVC   0(29,R5),SPACES     SUPPRESS EQUIVALENCE                         
*                                                                               
GETEQX   XIT1                                                                   
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
PRINCON  NTR1  BASE=*,LABEL=*                                                   
         MVC   REPWORK,SPACES                                                   
         LR    R4,R2                                                            
         LR    R5,R3                                                            
         LA    R6,REPWORK                                                       
         L     R1,EXWIDE                                                        
         SPACE 2                                                                
PC20     EX    R1,P4TEST           BUILD A TABLE OF PRINT LINE BYTES            
         BE    *+8                                                              
         MVI   0(R6),C'P'                                                       
         A     R4,PWIDTH                                                        
         LA    R6,1(R6)                                                         
         BCT   R5,PC20                                                          
         SPACE 2                                                                
* NOW CONVERT TO PRINTING NUMBERS                                               
         LA    R6,REPWORK                                                       
         SPACE 2                                                                
PC22     CLC   0(16,R6),SPACES     ANY LEFT                                     
         BE    PC30                NO                                           
         SPACE 2                                                                
PC26     LA    R8,2                                                             
         CLC   1(15,R6),SPACES     IS THIS THE LAST                             
         BE    PC28                                                             
         CLC   1(2,R6),=C' P'                                                   
         BE    PC28                                                             
         LA    R8,1                                                             
         CLI   1(R6),C'P'                                                       
         BE    PC28                                                             
         LA    R8,3                                                             
         SPACE 2                                                                
PC28     STC   R8,0(R6)                                                         
         AR    R6,R8                                                            
         SR    RE,RE                                                            
         IC    RE,LINE                                                          
         AR    RE,R8                                                            
         STC   RE,LINE                                                          
         B     PC22                                                             
         SPACE 2                                                                
PC30     LA    R6,REPWORK          NOW PRINT R2 = DATA                          
*                                            R3 = N'LINES                       
*                                            R6 = SKIP NUMBERS                  
PC32     CLI   0(R6),C' '                                                       
         BE    PC34                                                             
         MVC   CONTROL(3),=C'BL0'                                               
         MVC   CONTROL+3(1),0(R6)                                               
         OI    CONTROL+3,X'F0'                                                  
         L     R1,EXWIDE                                                        
         EX    R1,P2SPACES     ENSURE PRINTABLE CHARACTERS                      
         GOTO1 APRINT,REPARA,(R2),CONTROL                                       
*                                                                               
         CLI   RQEMAIL,C'Y'                                                     
         BNE   PC34                                                             
         GOTO1 =V(EMLPUT),(R1)                                                  
*                                                                               
PC34     A     R2,PWIDTH                                                        
         LA    R6,1(R6)                                                         
         BCT   R3,PC32                                                          
         XIT1                                                                   
P4TEST   CLC   0(0,R4),MYSPACES                                                 
P2SPACES OC    0(0,R2),MYSPACES                                                 
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
* ROUTINE TO PRINT COMMENT                                                      
*                                                                               
PRTCOM   NTR1  BASE=*,LABEL=*                                                   
* CLEAR HEADLINES FOR COMMENTS                                                  
         L     R2,AH1                                                           
         LA    R3,14                                                            
         BAS   RE,PPCLEAR                                                       
* NOW EXTRACT COMMENTS FROM COMMENT REC                                         
         L     R2,AH1                                                           
         L     R6,ADCOMREC                                                      
         CLI   0(R6),0             TEST COMMENT PRESENT                         
         BE    PRTCOMX             NO                                           
         LA    R6,24(R6)           POINT TO FIRST ELEMENT                       
PCM4     CLI   0(R6),5             FIND A COMMENT LINE                          
         BNE   PCM6                                                             
         ZIC   RE,1(R6)            GET ELEM LEN                                 
         SH    RE,=H'3'            SET FOR EX                                   
         BM    PCM6                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),2(R6) * EXECUTED *                                       
         A     R2,PWIDTH                                                        
         L     R0,AHLAST           LAST HEADLINE                                
         CR    R2,R0               TEST USED MORE THAN 14 LINES                 
         BH    PCM8                IF SO, STOP NOW                              
PCM6     SR    R0,R0                                                            
         IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
         CLI   0(R6),0                                                          
         BNE   PCM4                                                             
* NOW PRINT COMMENT                                                             
PCM8     L     R2,AH1                                                           
         LA    R3,14                                                            
         GOTOR PRINCON                                                          
*                                                                               
PRTCOMX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
PPCLEAR  L     R1,EXWIDE                                                        
         SPACE 1                                                                
PPCLEAR2 EX    R1,P2CLEAR                                                       
         A     R2,PWIDTH                                                        
         BCT   R3,PPCLEAR2                                                      
         BR    RE                                                               
         SPACE 1                                                                
P2CLEAR  MVC   0(0,R2),MYSPACES                                                 
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
* DSECT FOR THIS MODULE                                                         
         SPACE 2                                                                
SPREPD   DSECT                                                                  
REPDUB   DS    D                                                                
REPDMCB  DS    CL24                                                             
REPWORK  DS    CL40                                                             
CONTROL  DS    CL4                                                              
PROGSW   DS    CL1                                                              
FILTSW   DS    CL1                                                              
WIDEOPT  DS    CL1                                                              
REPMAX   DS    XL1                                                              
MYSPACES DS    CL198                                                            
PWIDTH   DS    F                                                                
EXWIDE   DS    F                                                                
APRINT   DS    A                                                                
AH1      DS    A                                                                
AM1      DS    A                                                                
AM2      DS    A                                                                
AP1      DS    A                                                                
APLAST   DS    A                                                                
AHLAST   DS    A                                                                
AF1      DS    A                                                                
NPLINES  DS    F                                                                
LANGSW   DS    CL1                                                              
CTRYSW   DS    CL1                                                              
AREA     DS    640C                                                             
REPARA   DS    6F                                                               
REPSAVE  DS    F                                                                
USERRD   DS    F                                                                
SPREPX   EQU   *                                                                
         PRINT OFF                                                              
       ++INCLUDE SPREPMODES                                                     
       ++INCLUDE SPGENCLT                                                       
       ++INCLUDE SPGENEST                                                       
AGYRECD  DSECT                                                                  
       ++INCLUDE SPGENAGY                                                       
         EJECT                                                                  
       ++INCLUDE SPREPWORKD                                                     
* SPDDEQUS                                                                      
       ++INCLUDE SPDDEQUS                                                       
* DDDICTATED                                                                    
       ++INCLUDE DDDICTATED                                                     
* DDMASTD                                                                       
       ++INCLUDE DDMASTD                                                        
*                                                                               
*        NEEDED FOR WIDE PRINTING                                               
*                                                                               
         PRINT ON                                                               
       ++INCLUDE DDBIGBOX                                                       
       ++INCLUDE DDWIDED                                                        
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'028SPREPORT  02/26/19'                                      
         END                                                                    

*          DATA SET PPBLDREV   AT LEVEL 030 AS OF 05/26/05                      
*CATALP PPBLDREV                                                                
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         TITLE 'INSERTION ORDERS - BUILD REASONS FOR REVISION'                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
BLDREV   CSECT                                                                  
         NMOD1 0,BLDREV,RR=R5                                                   
*                                                                               
         ST    R5,RELO                                                          
         B     *+8                                                              
RELO     DC    F'0'                                                             
*                                                                               
         L     RC,0(R1)                                                         
         USING POLWRKD,RC                                                       
         USING T41FFFD,RA                                                       
         USING IOWORKD,R8                                                       
         L     R9,PPFILEC                                                       
         LA    R5,1(R9)                                                         
         LA    R5,4095(R5)                                                      
         USING POLFILED,R9,R5                                                   
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JNZ   BLDRX                                                            
*                                                                               
         L     R2,4(R1)                                                         
         MVC   WRK70,0(R2)         LAST I/O ELEM IN WRK70                       
*                                                                               
* TRY SETTING DICTIONARY HERE USING PUBLANG                                     
*                                                                               
         L     RE,=A(DICSECTB)                                                  
         A     RE,RELO                                                          
         USING DICSECTB,RE                                                      
         XC    DMCB,DMCB                                                        
         LA    R1,DMCB                                                          
         USING DICTATED,R1                                                      
         MVI   DDACTN,DDACTNL      TRANSLATE LIST                               
         MVI   DDRETN,DDCASEU                                                   
         MVI   DDSYS,4                                                          
         MVI   DDLANG,0            DEFAULT TO ENGLISH                           
         CLI   PUBLANG,C'F'                                                     
         BNE   *+8                                                              
         MVI   DDLANG,4            4 IS FRENCH                                  
*                                                                               
         MVC   MYLANG,PUBLANG                                                   
*                                                                               
         LA    RF,DCLIST                                                        
         STCM  RF,7,DDIADR                                                      
         LA    RF,DSLIST                                                        
         STCM  RF,7,DDOADR                                                      
         L     RF,VCOMFACS                                                      
         USING COMFACSD,RF                                                      
         GOTO1 CDICTATE                                                         
         DROP  R1,RE,RF                                                         
*                                                                               
         L     R5,=A(DICSECTB)                                                  
         A     R5,RELO                                                          
         USING DICSECTB,R5                                                      
*                                                                               
         LA    R3,SPACEND                                                       
         LA    R3,160(R3)          START ON 3RD LINE                            
*                                                                               
         CLI   REVOPT,C'Y'         SUPPRESSING SYSTEM REVISION MSG?             
         BE    BLDR10              MUST STILL DO RC= COMMENTS                   
*                                                                               
BLDR2    DS    0H                                                               
         LA    R2,WRK70                                                         
         USING PIOELEM,R2                                                       
*                                  INSERTION DATE                               
         CLC   PBUYKDAT,PIOIDATE                                                
         BE    BLDR4                                                            
*--->    MVC   03(23,R3),=C'-INSERTION DATE CHANGED'                            
         MVC   03(L'PP@IOB1,R3),PP@IOB1                                         
         LA    R3,80(R3)                                                        
*--->    MVC   04(4,R3),=C'FROM'                                                
         MVC   04(L'PP@FROM,R3),PP@FROM                                         
         GOTO1  DATCON,DMCB,(3,PIOIDATE),(5,WORK)                               
*                                                                               
         CLI   MYLANG,C'F'                                                      
         BNE   *+8                                                              
         BAS   RE,FRDATE                                                        
*                                                                               
*--->    MVC   09(8,R3),WORK                                                    
         LR    RE,R3                                                            
         LA    RE,8(RE)            SCAN BACKWARDS FOR NON-SPACE                 
BLDR2B   CLI   0(RE),C' '                                                       
         BH    BLDR2C                                                           
         BCT   RE,BLDR2B                                                        
*                                                                               
BLDR2C   MVC   2(8,RE),WORK                                                     
*                                                                               
         MVC   TSLDATE,WORK        SAVE OLD DATE IN STATUS                      
         LA    R3,80(R3)                                                        
*                                  SPACE/LINEAGE                                
BLDR4    DS    0H                                                               
         CLI   QMEDIA,C'N'                                                      
         BE    BLDR6                                                            
*                                                                               
         MVC   WORK(17),PBDSPACE                                                
         CLI   WORK,X'FF'          OUTDOOR - 3 PACKED FIELDS                    
         BE    *+10                CAN'T OR WITH SPACES                         
         OC    WORK(17),SPACES                                                  
         MVC   WORK+17(17),PIOSPACE                                             
         CLI   WORK+17,X'FF'       OUTDOOR SPECIAL FLDS                         
         BE    *+10                                                             
         OC    WORK+17(17),SPACES                                               
         CLC   WORK(17),WORK+17                                                 
         BE    BLDR8                                                            
*--->    MVC   03(19,R3),=C'-SPACE CHANGED FROM'                                
*--->    MVC   23(17,R3),PIOSPACE                                               
         MVC   03(L'PP@IOB2,R3),PP@IOB2                                         
         LA    RE,L'PP@IOB2+3(R3)                                               
BLDR4C   CLI   0(RE),C' '          SCAN BACKWARDS FOR NON-SPACE                 
         BH    BLDR4D                                                           
         BCT   RE,BLDR4C                                                        
*                                                                               
BLDR4D   MVC   2(17,RE),PIOSPACE                                                
*                                                                               
* NOTE USE OF WORK+17  (WAS PIOSPACE)                                           
*                                                                               
         MVC   TSLSPACE(17),WORK+17                                             
         LA    R3,80(R3)                                                        
         B     BLDR8                                                            
*                                                                               
BLDR6    DS    0H                                                               
         CP    PBDUNITS,PIOUNITS                                                
         BNE   BLDR6B                                                           
         CP    PBDCLMS,PIOCLMS                                                  
         BNE   BLDR6B                                                           
         CLC   PBDUIND,PIOUIND                                                  
         BNE   BLDR6B                                                           
         CLC   PBDCL,PIOPRM                                                     
         BNE   BLDR6B                                                           
         MVC   WORK(6),PIOSAU                                                   
         MVC   WORK+6(6),PBDSPACE                                               
         OC    WORK(12),SPACES                                                  
         CLC   WORK(6),WORK+6                                                   
         BE    BLDR8                                                            
*                                                                               
BLDR6B   DS    0H                                                               
*--->    MVC   03(19,R3),=C'-SPACE CHANGED FROM'                                
         MVC   03(L'PP@IOB2,R3),PP@IOB2                                         
         LA    R3,80(R3)                                                        
         LA    R4,W                                                             
         XC    W,W                                                              
         OC    PIOSAU,SPACES                                                    
         MVC   WORK(20),SPACES                                                  
         LA    R6,PIOSAU                                                        
         LA    R7,WORK                                                          
         CLI   PIOSAU,C'*'                                                      
         BNE   PB27                                                             
         LA    R6,1(R6)                                                         
         MVI   0(R7),C'*'                                                       
         LA    R7,1(R7)                                                         
*                                                                               
PB27     DS    0H                                                               
         CLI   0(R6),C' '                                                       
         BE    PB29                NO SPACE                                     
         CLI   0(R6),C'S'          TEST FOR SAU                                 
         BE    PB27A0              NO                                           
         MVC   0(8,R7),PIOSAU                                                   
         B     PB27B                                                            
PB27A0   MVC   0(3,R7),=C'SAU'                                                  
         MVC   4(10,R7),1(R6)                                                   
         MVC   0(10,R4),0(R7)                                                   
         LA    R6,9(R4)                                                         
PB27A    CLI   0(R6),C' '          FIND END OF FIELD                            
         BH    PB28                                                             
         BCTR  R6,0                                                             
         B     PB27A                                                            
*                                                                               
PB27B    DS    0H                                                               
         MVC   0(8,R4),0(R7)                                                    
         LA    R6,8(R4)                                                         
         B     PB27A                                                            
*                                                                               
PB28     LR    R4,R6                                                            
         LA    R4,2(R4)                                                         
*                                                                               
PB29     DS    0H                                                               
         LA    R0,1                                                             
         MVI   0(R4),C'0'                                                       
         CLI   PIOUIND,X'89'       LOWER CASE I - INCHES 2 DECIMALS             
         BNE   PB35                                                             
         ZAP   DUB,PIOUNITS                                                     
         EDIT  (P8,DUB),(10,(R4)),2,ALIGN=LEFT                                  
         AR    R4,R0                                                            
*--->    MVC   0(2,R4),=C'IN'                                                   
         MVC   0(L'PP@INCH,R4),PP@INCH                                          
         B     BLDR6D                                                           
*                                                                               
PB35     ZAP   DUB,PIOUNITS                                                     
         BZ    *+8                                                              
         BAS   RE,BLDREDL                                                       
*                                                                               
         AR    R4,R0                                                            
         MVI   0(R4),C'L'                                                       
         CLI   PIOUIND,C'I'                                                     
         BNE   *+14                                                             
*--->    MVC   0(2,R4),=C'IN'                                                   
         MVC   0(L'PP@INCH,R4),PP@INCH                                          
         LA    R4,1(R4)                                                         
*                                                                               
         CP    PIOCLMS,=P'0'                                                    
         BE    BLDR6D                                                           
         ZAP   DUB,PIOUNITS                                                     
         BZ    BLDR6D                                                           
         MVI   2(R4),C'('                                                       
         LA    R4,3(R4)                                                         
         DP    DUB,PIOCLMS                                                      
         ZAP   DUB,DUB(8-L'PIOCLMS)                                             
         BAS   RE,BLDREDL                                                       
         AR    R4,R0                                                            
         MVI   0(R4),C'X'                                                       
         LA    R4,1(R4)                                                         
         ZAP   DUB,PIOCLMS                                                      
         BAS   RE,BLDREDL                                                       
         AR    R4,R0                                                            
         MVI   0(R4),C')'                                                       
         CLI   PIOPRM,C' '                                                      
         BNH   BLDR6D                                                           
         MVC   2(1,R4),PIOPRM                                                   
         MVI   3(R4),C'C'                                                       
*                                                                               
BLDR6D   DS    0H                                                               
         MVC   04(30,R3),W                                                      
         MVC   TSLSPACE(30),W      SAVE OLD SPACE STATUS                        
         LA    R3,80(R3)                                                        
*                                  AD NUMBER CHANGE                             
BLDR8    DS    0H                                                               
         CLC   PBDJOB,PIOJOB                                                    
         BE    BLDR8X                                                           
*--->    MVC   03(18,R3),=C'-AD OR COPY CHANGE'                                 
         MVC   03(L'PP@IOB3,R3),PP@IOB3                                         
         MVI   TSLJOB,C'Y'         SET JOB CHANGE IN STATUS                     
         LA    R3,80(R3)                                                        
*                                                                               
BLDR8X   DS    0H                                                               
         BRAS  RE,CKLEGALW         CHECK LEGAL WARNIGS REVISION                 
*                                                                               
* NOW SEE IF POSITION INS CHANGED                                               
* NOTE - PP72REV USES LASTIOD INSTEAD OF DUB PACK LAST IO DATE                  
*                                                                               
*                                                                               
         XC    DUB,DUB                                                          
         GOTO1 DATCON,DMCB,(3,PIODATE),(2,DUB)                                  
         DROP  R2                                                               
*                                                                               
         MVI   RATESW,0                                                         
         MVI   POSISW,0                                                         
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'24'        CK IF PI COMM CHG SINCE LASTIO               
BLDR91   DS    0H                                                               
         BRAS  RE,NXTEL                                                         
         BNE   BLDR93                                                           
         USING PCHGELEM,R2                                                      
         CLC   PCHGDAT,DUB                                                      
         BL    BLDR91                                                           
*                                                                               
* SPECIAL NOTE:THE INSTRUCTION ABOVE IS DIFFERENT THAN                          
* IN PP72REV, WHICH IS BNH                                                      
* THE INSTUCTION HERE IS BL SINCE I CAN'T                                       
* TELL IF THE I/O WAS PRODUCED BEFORE OR AFTER                                  
* SINCE IT OCCURRED ON THE SAME DAY AND I DON'T RECORD TIME OF DAY              
*                                                                               
         CLI   RATEOPT,C'Y'        RATE CHANGE TO CAUSE AN I/O?                 
         BNE   BLDR91C                                                          
         CLI   RATESW,1            ALEARDY DID A RATE CHG?                      
         BE    BLDR91C                                                          
         TM    PCHGIND1,X'40'                                                   
         BZ    BLDR91C                                                          
         MVC   03(12,R3),=C'-RATE CHANGE'                                       
         MVI   TSLJOB+1,C'Y'       SET JOB CHANGE IN STATUS                     
         MVI   RATESW,1                                                         
         LA    R3,80(R3)                                                        
*                                                                               
BLDR91C  DS    0H                                                               
         TM    PCHGIND3,X'01'      POSITION INSTRUCTIONS CHANGE                 
         BZ    BLDR91                                                           
         CLI   POSISW,1            ALEARDY DID A POS INS CHG?                   
         BE    BLDR91                                                           
*--->    MVC   03(29,R3),=C'-POSITION INSTRUCTIONS CHANGE'                      
         MVC   03(L'PP@IOB4,R3),PP@IOB4                                         
         MVI   TSLJOB+1,C'Y'       SET JOB CHANGE IN STATUS                     
         LA    R3,80(R3)                                                        
         MVI   POSISW,1                                                         
         B     BLDR91              CAN STOP LOOKING                             
         DROP  R2                                                               
*                                                                               
BLDR93   DS    0H                                                               
BLDR10   DS    0H                  NOW LOOK FOR RC= COMMENTS                    
         LA    R2,PINSREC+33                                                    
         MVI   ELCODE,X'66'                                                     
         CLI   0(R2),X'66'                                                      
         BE    BLDR10D                                                          
BLDR10B  DS    0H                                                               
         BRAS  RE,NXTEL                                                         
         BNE   BLDR12              DONE                                         
*                                                                               
BLDR10D  DS    0H                                                               
         CLC   2(3,R2),=C'RC='                                                  
         BNE   BLDR10B                                                          
         SR    R4,R4                                                            
         IC    R4,1(R2)                                                         
         CHI   R4,5                CK FOR NOTHING AFTER RC=                     
         BE    BLDR10F                                                          
         AHI   R4,-6                                                            
         XC    W,W                                                              
         EX    R4,*+8                                                           
         B     *+10                                                             
         MVC   W(0),5(R2)                                                       
         MVI   03(R3),C'-'                                                      
         MVC   04(35,R3),W                                                      
BLDR10F  LA    R3,80(R3)                                                        
         B     BLDR10B                                                          
*                                                                               
BLDR12   DS    0H                   NOW SEE IF ANY REASONS                      
         LA    R3,SPACEND                                                       
         LA    R3,80(R3)                                                        
         OC    81(79,R3),81(R3)                                                 
         BZ    BLDR12B             NONE                                         
*--->    MVC   01(23,R3),=C'**REASON FOR REVISION**'                            
         MVC   01(L'PP@IOB5,R3),PP@IOB5                                         
*                                                                               
BLDR12B  DS    0H                                                               
BLDRX    XIT1                                                                   
*                                                                               
BLDREDL  DS    0H                                                               
         EDIT  (P8,DUB),(10,(R4)),ALIGN=LEFT                                    
         BR    RE                                                               
*                                                                               
NXTEL    ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLC   ELCODE,0(R2)                                                     
         JE    NXTELX              CC IS EQUAL                                  
         CLI   0(R2),0                                                          
         JNE   NXTEL                                                            
         LTR   R2,R2               CC IS NOT EQUAL                              
NXTELX   BR    RE                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FRDATE   NTR1                      CONVERT DATE IN WORK (MMMDD/YY)              
         LA    R1,DATETAB                                                       
FRDAT2   CLI   0(R1),X'FF'         END OF TABLE                                 
         BNE   *+6                                                              
         DC    H'0'                SOMEHTING VERY WRONG                         
*                                                                               
         CLC   WORK(3),0(R1)                                                    
         BE    FRDAT10                                                          
         LA    R1,6(R1)                                                         
         B     FRDAT2                                                           
*                                  TO FRENCH                                    
FRDAT10  MVC   WORK(3),3(R1)                                                    
         J     BLDRX                                                            
*                                                                               
DATETAB  DC    C'JANJAN'                                                        
         DC    C'FEBFEV'                                                        
         DC    C'MARMAR'                                                        
         DC    C'APRAVR'                                                        
         DC    C'MAYMAI'                                                        
         DC    C'JUNJUN'                                                        
         DC    C'JULJUL'                                                        
         DC    C'AUGAOU'                                                        
         DC    C'SEPSEP'                                                        
         DC    C'OCTOCT'                                                        
         DC    C'NOVNOV'                                                        
         DC    C'DECDEC'                                                        
         DC    X'FF'                                                            
WRK70    DS    XL70                CURRENTLY ONLY 50 BYTES USED                 
*                                                                               
MYLANG   DS    CL1                                                              
*                                                                               
RATESW   DS    CL1                                                              
POSISW   DS    CL1                                                              
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
CKLEGALW NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         NI    NEEDOIND,X'FF'-X'80'                                             
*                                                                               
         CLI   0(R2),X'70'                                                      
         BE    *+6                                                              
         DC    H'0'                MUST STILL BE POINTING AT I/O ELEM           
         USING PIOELEM,R2                                                       
         MVC   LWSVCODE+0(1),PIOLWCD                                            
         MVC   LWSVCODE+1(1),PIOQUCD                                            
         DROP  R2                                                               
*                                                                               
         XC    LWSVBUY,LWSVBUY                                                  
         ST    R2,LWSVR2                                                        
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'94'        LEGAL WARNING ELEM CODE IN BUY               
         BRAS  RE,NXTEL                                                         
         BE    CKLEGW30            IF NOT FOUND, USE DEFAULT                    
*                                                                               
         LA    R2,PPRDREC+33                                                    
         MVI   ELCODE,X'40'        LEGAL WARNINGS ELEM IN PRD REC               
         BRAS  RE,NXTEL                                                         
         BNE   CKLEGW50            NOT FOUND, COMPARE VALUES ANYWAY             
*                                                                               
         MVC   LWSVPRDC,2(R2)                                                   
         BAS   RE,LWQUARTR         GET QUARTER NUMBER                           
*                                                                               
         CLI   LWSVBUY+1,C'1'      QUARTER 1?                                   
         BNE   *+14                                                             
         MVC   LWSVBUY(1),LWSVPRDC+0                                            
         B     CKLEGW50                                                         
         CLI   LWSVBUY+1,C'2'      QUARTER 2?                                   
         BNE   *+14                                                             
         MVC   LWSVBUY(1),LWSVPRDC+1                                            
         B     CKLEGW50                                                         
         CLI   LWSVBUY+1,C'3'      QUARTER 3?                                   
         BNE   *+14                                                             
         MVC   LWSVBUY(1),LWSVPRDC+2                                            
         B     CKLEGW50                                                         
         CLI   LWSVBUY+1,C'4'      QUARTER 4?                                   
         BNE   *+14                                                             
         MVC   LWSVBUY(1),LWSVPRDC+3                                            
         B     CKLEGW50                                                         
         DC    H'0'                THERE ARE ONLY 4 QUARTERS IN A YEAR!         
*                                                                               
CKLEGW30 MVC   LWSVBUY,2(R2)       CODES FROM LW ELEM IN BUY                    
         CLI   LWSVBUY,C'X'        X FOR NONE?                                  
         BNE   *+8                                                              
         MVI   LWSVBUY,0                                                        
*                                                                               
CKLEGW50 CLC   LWSVCODE,LWSVBUY    SAME CODES?                                  
         BE    CKLEGWX             YES, THEN NO REVISIONS                       
*                                                                               
         MVC   03(31,R3),=C'-LEGAL WARNING COMMENTS CHANGED'                    
         LA    R3,80(R3)                                                        
*                                                                               
         OI    NEEDOIND,X'80'      TURN ON LEGALW NEEDED ONLY INDICATOR         
*                                                                               
CKLEGWX  L     R2,LWSVR2                                                        
         XIT1  REGS=(R3)           POINTER FOR PRINT BLOCK                      
*                                                                               
LWQUARTR DS    0H                  DETERMING QUARTER FROM INS DATE              
         CLI   PBUYKDAT+1,X'03'    MONTH IS GREATER THAN MARCH?                 
         BH    *+10                                                             
         MVI   LWSVBUY+1,C'1'      QUARTER 1                                    
         BR    RE                                                               
         CLI   PBUYKDAT+1,X'06'    MONTH IS GREATER THAN JUNE?                  
         BH    *+10                                                             
         MVI   LWSVBUY+1,C'2'      QUARTER 2                                    
         BR    RE                                                               
         CLI   PBUYKDAT+1,X'09'    MONTH IS GREATER THAN SEPTEMBER?             
         BH    *+10                                                             
         MVI   LWSVBUY+1,C'3'      QUARTER 3                                    
         BR    RE                                                               
         CLI   PBUYKDAT+1,X'0C'    MONTH IS GREATER THAN DECEMBER?              
         BH    *+10                                                             
         MVI   LWSVBUY+1,C'4'      QUARTER 4                                    
         BR    RE                                                               
         DC    H'0'                GREATER THAN DECEMBER, BAD!                  
*                                                                               
LWSVR2   DS   F                                                                 
LWSVCODE DS   CL2                  LW COMMENT CODES IN I/O ELEM                 
LWSVBUY  DS   CL2                  LW COMMENT CODES IN LW  ELEM                 
LWSVPRDC DS   CL4                                                               
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         PRINT OFF                                                              
*                                                                               
       ++INCLUDE PPIOBLDD          DICTIONARY FOR PP72REV AND PPBLDREV          
         EJECT                                                                  
*                                                                               
       ++INCLUDE PPINSWRK1                                                      
         EJECT                                                                  
*                                                                               
       ++INCLUDE POLFILE                                                        
         EJECT                                                                  
*                                                                               
       ++INCLUDE PPINSWRK2                                                      
         EJECT                                                                  
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'030PPBLDREV  05/26/05'                                      
         END                                                                    

*          DATA SET DDPRINT    AT LEVEL 007 AS OF 07/28/20                      
*PROCESS USING(WARN(15))                                                        
*CATALP PRINT                                                                   
         TITLE 'DDS PRINT CONTROLLER'                                           
         PRINT NOGEN                                                            
PRINT    CSECT ,                   ENTRY POINT=6                                
         ENTRY PRINT00             ENTRY POINT TO NO-OP DDPRINT                 
         ENTRY PRINT2                                                           
         ENTRY PRINTS              SHORT 132 PRINT                              
         ENTRY VPRINT              PRINTS TO REPLACE ACVPRINT                   
         ENTRY PRINTS2             SHORT 132 PRINT2                             
         ENTRY PPGPRINT                                                         
         ENTRY CCWPRINT                                                         
*                                                                               
         ENTRY PRNTER                                                           
         ENTRY REMOTEC                                                          
         ENTRY BOXAREA                                                          
         ENTRY FAXINFO                                                          
         ENTRY FLSHAREA                                                         
         ENTRY SPLAREA                                                          
         ENTRY ISPRTACT                                                         
         ENTRY LSTRMKEY                                                         
*                                                                               
         ENTRY PRNTER2                                                          
         ENTRY REMOTEC2                                                         
         ENTRY BOXAREA2                                                         
         ENTRY FAXINFO2                                                         
         ENTRY FLSHARE2                                                         
         ENTRY SPLAREA2                                                         
         ENTRY ISPRTAC2                                                         
         ENTRY LSTRMKE2                                                         
*                                                                               
         WXTRN ADWAIT                                                           
         WXTRN DICTATE                                                          
         WXTRN DYNALLOC                                                         
         WXTRN FAXLINK                                                          
         WXTRN LOGO                                                             
         WXTRN LOGOC                                                            
         WXTRN LOGOPASS                                                         
         WXTRN MASTC                                                            
         WXTRN REMPQCIA                                                         
         WXTRN REMPQCI2                                                         
         WXTRN REMPQKEY                                                         
         WXTRN REMPQKE2                                                         
         WXTRN SSB                                                              
         WXTRN WIDE                                                             
*                                                                               
         J     PRINT00             ENTRY POINT=6                                
VPRINT   DS    0H                                                               
PRINTS   J     PRINT00             ENTRY POINT=5                                
PRINTS2  J     PRINT00             ENTRY POINT=4                                
PRINT2   J     PRINT00             ENTRY POINT=3                                
CCWPRINT J     PRINT00             ENTRY POINT=2                                
PPGPRINT J     PRINT00             ENTRY POINT=1                                
*                                                                               
PRINT00  NMOD1 0,**PRNT**,RA                                                    
         L     RF,4(RD)            FIND ENTRY POINT NUMBER                      
         L     RF,16(RF)                                                        
         LA    RF,0(RF)            CLEAR HOB                                    
         SR    RF,RB                                                            
         LCR   RF,RF                                                            
         SRL   RF,2                                                             
         ICM   RE,15,=V(MASTC)                                                  
         BZ    PRINTB0                                                          
         USING MASTD,RE                                                         
         CLI   MCREPTS,C'F'        FORCE TO PRINT2                              
         BE    PRINTB02            LEAVE WHICH AND WHAT ALONE                   
*                                                                               
PRINTB0  L     RC,=A(PRAREA1)      MOST CALLS USE PRAREA1                       
         CHI   RF,3                                                             
         BE    PRINTB02                                                         
         CHI   RF,4                                                             
         BNE   *+8                                                              
PRINTB02 L     RC,=A(PRAREA2)      USE PRAREA2 IF PRINT2 CALL                   
         USING PRAREAD,RC                                                       
         STC   RF,WHERE            SAVE ENTRY POINT IN WHERE                    
         SLL   RF,2                                                             
*                                                                               
         EX    0,*+4(RF)           PRINT 1 OR 2                                 
         B     PRINTB1                                                          
         MVI   WHICH,1                                                          
         MVI   WHICH,1                                                          
         MVI   WHICH,2                                                          
         MVI   WHICH,2                                                          
         MVI   WHICH,1                                                          
         MVI   WHICH,1                                                          
*                                                                               
PRINTB1  EX    0,*+4(RF)           WHAT TYPE OF CALL NORMAL/PPG/CCW             
         B     PRINTB2                                                          
         MVI   WHAT,C'P'                                                        
         MVI   WHAT,C'C'                                                        
         MVI   WHAT,C'N'                                                        
         MVI   WHAT,C'P'                                                        
         MVI   WHAT,C'P'                                                        
         MVI   WHAT,C'N'                                                        
*                                                                               
PRINTB2  L     R2,4(R1)                                                         
         L     R3,0(R1)                                                         
         L     R9,AREMOTEC                                                      
         USING REMOTED,R9                                                       
         L     R8,ABOXAREA                                                      
         USING BOXD,R8                                                          
         MVI   SPACES,C' '                                                      
         MVC   SPACES+1(L'SPACES-1),SPACES                                      
         EJECT                                                                  
***********************************************************************         
*CLOSE ROUTINES                                                       *         
***********************************************************************         
CLOSE    CLI   0(R1),7             TEST FOR SPECIAL CLOSE COMMANDS              
         BNE   CLOSE1                                                           
         CLC   0(7,R3),=C'CLO/ERR'                                              
         BNE   CLOSE0                                                           
         MVI   OPENINFO,X'FE'      SET CLOSE ERROR                              
         MVI   OPENINFO+1,0                                                     
         CLI   7(R3),C'='                                                       
         BNE   CLOSE2                                                           
         MVC   OPENINFO+1(1),8(R3) SET CLOSE ERROR REASON CODE                  
         B     CLOSE2                                                           
CLOSE0   CLC   0(7,R3),=C'CLO/PUR'                                              
         BNE   *+12                                                             
         MVI   OPENINFO,X'FD'      SET CLOSE PURGE                              
         B     CLOSE2                                                           
         CLC   0(7,R3),=C'CLO/USR'                                              
         BNE   CLOSE1                                                           
         XC    OPENINFO,OPENINFO   NOTE - USER PASSES KEY IN PARAM2             
         MVI   OPENINFO,X'FC'      SET CLO/USR                                  
         LA    R1,OPENINFO+1                                                    
         MVC   UKUSRINF-UKRECD(L'UKUSRINF,R1),0(R2)                             
         B     CLOSE2                                                           
*                                                                               
CLOSE1   CLI   0(R1),5             TEST FOR FLUSH & CLOSE                       
         BNE   PRINT1                                                           
         CLC   0(5,R3),=C'FLUSH'   IGNORE FLUSH                                 
         BE    XIT                                                              
         CLC   0(5,R3),=C'CLOSE'   TEST CLOSE                                   
         BNE   PRINT1                                                           
         MVI   OPENINFO,X'FF'      SET REGULAR CLOSE COMMAND                    
*                                                                               
CLOSE2   OC    REMOTKEY,REMOTKEY   ARE WE PRINTING REMOTE                       
         BZ    CLOSE3                                                           
         TM    REMFLAG,X'20'       YES - IS REPORT OPEN                         
         BZ    CLOSEX                                                           
         GOTO1 REMPUTEM,OPENINFO   YES - CLOSE THE REPORT                       
         NI    REMFLAG,255-X'20'                                                
         XC    REMOTKEY,REMOTKEY   CLEAR KEY FIELDS                             
         XC    LASTKEY,LASTKEY                                                  
         CLI   REMOTPRT,0          TEST LOCAL PRINTING ALSO                     
         BE    CLOSEX              NO - EXIT                                    
*                                                                               
CLOSE3   L     RF,ASPLAREA         CLOSE SPOOL TAPE                             
         CLI   0(RF),2                                                          
         BNE   CLOSE4                                                           
         MVI   0(RF),0                                                          
         LA    R5,SPOOLT                                                        
         B     CLOSE6                                                           
*                                                                               
CLOSE4   CLI   LASTWIDE,0          CLOSE REGULAR PRINTER                        
         BE    CLOSEX                                                           
         MVI   LASTWIDE,0                                                       
         LA    R5,PRNTER0                                                       
*                                                                               
CLOSE6   CLOSE ((R5))              CLOSE PRINT FILE                             
         LTR   RF,RF                                                            
         JNZ   *+2                 DIE IF CLOSE ERROR                           
*                                                                               
CLOSEX   B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
*ROUTINE TO PRINT A LINE                                              *         
***********************************************************************         
PRINT1   L     R1,AFAXINFO                                                      
         USING FAXINFOD,R1                                                      
         CLI   FXISTAT,FXISPEND    IF FAX IS PENDING                            
         BE    PRINTFX                                                          
         CLI   FXISTAT,FXISCLOS    OR CLOSE IS PENDING                          
         BNE   PRINT1B                                                          
*                                                                               
PRINTFX  MVC   SAVWHERE,WHERE      PROTECT WHAT WE HAVE DONE SO FAR             
         MVI   REMOTCLS,C'G'       FORCE CLASS TO 'G'                           
         GOTO1 =V(FAXLINK)         INITIALIZE FAX & PRINT HEADER PAGE           
         MVC   WHERE(3),SAVWHERE                                                
         B     PRINT1B                                                          
*                                                                               
PRINT1B  LA    R4,DUMDUM                                                        
         CLI   WHAT,C'P'           PPGPRINT                                     
         BNE   *+8                                                              
         LA    R4,DUMDUM+1                                                      
         MVI   ISPRTACT,C'Y'       INDICATE PRINT ACTIVE                        
         MVC   0(PLN,R4),SPACES                                                 
         MVC   PLN(PLN,R4),SPACES                                               
         ICM   R1,15,BOXWIDTH      HOW MANY CHARACTERS                          
         BNZ   *+8                                                              
         LA    R1,PLN                                                           
         CLI   WHAT,C'P'           PPGPRINT                                     
         BNE   *+6                                                              
         BCTR  R1,0                1 LESS FOR PPG                               
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R4),0(R3)       MOVE USERS DATA INTO MY BUFFER               
*                                                                               
PRINT1C  TM    BOXDDCTL,X'80'      TEST IF DATA DCTNRY REQUIRED                 
         BZ    PRINT3XX            NO                                           
         STM   R1,R2,DUB           YES TEST FOR DCTNRY ESCAPE CHRS              
         BCTR  R1,0                                                             
         L     RE,=A(TRTDD)                                                     
         EX    R1,*+8                                                           
         B     *+10                                                             
         TRT   DUMDUM+1(0),0(RE)                                                
         BNZ   PRINT3                                                           
         LM    R1,R2,DUB                                                        
         B     PRINT3XX                                                         
*                                                                               
PRINT3   MVI   PARA+0,C'T'         SET TRANSLATE WHOLE PRINT LINE               
         MVI   PARA+1,C'U'         SET CASE TO UPPER                            
         TM    BOXDDCTL,X'40'                                                   
         BZ    *+8                                                              
         MVI   PARA+1,C'L'         SET CASE TO LOWER                            
         MVC   PARA+2(1),BOXSYS    SET SYSTEM                                   
         MVC   PARA+3(1),BOXLANG   SET LANGUAGE                                 
         LA    RF,DUMDUM+1         SET ADR AND LEN OF DATA                      
         ST    RF,PARA+4                                                        
         L     RF,DUB                                                           
         STC   RF,PARA+4                                                        
         ICM   RF,15,=V(DICTATE)   GO TO V(DICTATE) FOR TRANSLATION             
         BZ    PRINT3X                                                          
         LA    R1,PARA                                                          
         BASR  RE,RF                                                            
PRINT3X  LM    R1,R2,DUB                                                        
*                                                                               
PRINT3XX EQU   *                   REPLACE INVALID CHRS BY BLANKS               
*&&US*&& B     PRINT4                                                           
         STM   R1,R2,DUB                                                        
         BCTR  R1,0                                                             
         L     RE,=A(VALCHRS)                                                   
         EX    R1,*+8                                                           
         B     *+10                                                             
         TR    DUMDUM+1(0),0(RE)                                                
         LM    R1,R2,DUB                                                        
*                                                                               
PRINT4   CLI   WHAT,C'C'           CCWPRINT                                     
         BE    PRINT4A                                                          
         CLI   0(R2),C'T'          TEST TRANSLATE ONLY CALL                     
         BNE   PRINT4A                                                          
         CLI   WHAT,C'P'           PPGPRINT                                     
         BNE   *+6                                                              
         BCTR  R4,0                                                             
         EX    R1,*+8                                                           
         B     XIT                                                              
         MVC   0(0,R3),0(R4)       RETURN TRANSLATED LINE                       
*                                                                               
PRINT4A  LA    R3,DUMDUM                                                        
         CLI   WHAT,C'C'           CCWPRINT                                     
         BE    PRINT5                                                           
         PACK  DUB,2(2,R2)                                                      
         CVB   R4,DUB                                                           
         CLI   0(R2),C'B'                                                       
         BE    PRNTB2              PRINT BEFORE LOGIC                           
         B     PRNTA2              PRINT AFTER LOGIC                            
*                                                                               
PRINT5   BAS   RE,BOXPUT           FINAL PUT AND RETURN TO USER                 
*NOP*    MVI   BOXFONT,0           RETURN TO DEFAULT FONT                       
         ICM   RF,15,=V(ADWAIT)    GET ADDRESS OF COMMON WAIT ROUTINE           
         BZ    PRINTX                                                           
         LA    R1,=X'00008000'     POINT TO POSTED ECB                          
         O     R1,=X'80000000'     MAKE R1 NEGATIVE                             
         BASR  RE,RF                                                            
*                                                                               
PRINTX   B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
*CONTROL OF WRITING BEFORE PRINTING                                   *         
***********************************************************************         
PRNTB2   CLI   1(R2),C'C'          CHANNEL CONTROL                              
         BNE   PRNTB3                                                           
         LA    R4,BCTAB(R4)                                                     
         MVC   0(1,R3),0(R4)                                                    
         B     PRINT5                                                           
*                                                                               
PRNTB3   CHI   R4,3                LESS THAN 4 LINES                            
         BH    PRNTB4                                                           
         LA    R4,BLTAB(R4)                                                     
         MVC   0(1,R3),0(R4)                                                    
         B     PRINT5                                                           
*                                                                               
PRNTB4   MVI   0(R3),X'19'         WRITE BEFORE 3                               
*                                                                               
PRNTB5   BAS   RE,BOXPUT           LOOP FOR MORE THAN 3 LINES                   
         AHI   R4,-3                                                            
         BZ    PRINTX                                                           
         CHI   R4,3                                                             
         BH    PRNTB6                                                           
         LA    R4,SLTAB(R4)                                                     
         MVC   0(1,R3),0(R4)                                                    
         B     PRINT5                                                           
*                                                                               
PRNTB6   MVI   0(R3),X'1B'                                                      
         B     PRNTB5                                                           
         EJECT                                                                  
***********************************************************************         
*CONTROL OF WRITING AFTER SPACING                                     *         
***********************************************************************         
PRNTA2   CLI   1(R2),C'C'                                                       
         BNE   PRNTA5                                                           
         LA    R4,SCTAB(R4)                                                     
         MVC   0(1,R3),0(R4)                                                    
*                                                                               
PRNTA3   BAS   RE,BOXPUT           SPACE CONTROL                                
PRNTA4   MVI   0(R3),X'01'                                                      
         B     PRINT5              NOW GO AND WRITE WITHOUT ADVANCING           
*                                                                               
PRNTA5   CHI   R4,3                                                             
         BH    PRNTA6                                                           
         LTR   R4,R4               CHECK FOR AFTER 0                            
         BZ    PRNTA4                                                           
         LA    R4,SLTAB(R4)                                                     
         MVC   0(1,R3),0(R4)                                                    
         B     PRNTA3                                                           
*                                                                               
PRNTA6   MVI   0(R3),X'1B'         LOOP FOR SPACING 3 LINES                     
         BAS   RE,BOXPUT           SPACE DOWN 3 LINES                           
         AHI   R4,-3                                                            
         B     PRNTA5                                                           
         EJECT                                                                  
***********************************************************************         
*ROUTINE TO INTERCEPT PUTS AND CHECK FOR BOX MERGING                  *         
***********************************************************************         
BOXPUT   NTR1                                                                   
         CLI   BOXMINI,C'Y'                                                     
         BE    MIN2                                                             
         CLI   BOXOFF,C'X'         CALLER KNOWS BEST ABOUT BOXES                
         BE    BOXPUT1                                                          
         CLI   BOXOFF,C'Y'                                                      
         BE    BOXPUT0                                                          
         CLI   BOXFLASH,C'Y'                                                    
         BE    BOXPUT2                                                          
         CLI   BOXYORN,C'Y'                                                     
         BE    BOXPUT2                                                          
         CLI   BOXSHADE,0                                                       
         BNE   BOXPUT2                                                          
         B     BOXPUT1                                                          
*                                                                               
BOXPUT0  CLI   BOXCOUNT,1          ARE WE AT THE TOP OF PAGE?                   
         BNE   BOXPUT2             IGNORE BOXOFF=Y UNTIL WE ARE                 
*                                                                               
BOXPUT1  BAS   RE,PUT              NOTHING SPECIAL WANTED                       
         B     BOXPUTX                                                          
*                                                                               
BOXPUT2  CLI   BOXINIT,0           TEST BOXES INITIALIZED                       
         BNE   BOXPUT4                                                          
         BAS   RE,BOXSETUP                                                      
         MVI   BOXINIT,1                                                        
         MVC   BOXLASTL,BOXCOLS                                                 
         MVC   BOXLASTR,BOXCOLSR                                                
BOXPUT4  TM    DUMDUM,X'02'        WAS COMMAND SKIP                             
         BNO   BOXPUT5                                                          
         NI    DUMDUM,X'FD'        CHANGE TO PRINT BLANKS AND SPACE             
         MVC   DUMDUM+1(PLN),SPACES                                             
         MVC   DUMR,SPACES                                                      
*                                                                               
BOXPUT5  MVC   SAVECOM,DUMDUM      LINE ROUTINES HERE                           
         TM    SAVECOM,X'80'                                                    
         BO    BOXPUT8                                                          
         MVI   DUMDUM,X'09'        ALWAYS PRINT AND SPACE 1                     
         BAS   RE,BOXPUT6                                                       
         CLI   SAVECOM,X'09'                                                    
         BE    BOXPUT16                                                         
         MVI   DUMDUM+1,C' '       ONCE MORE FOR SPACE 2                        
         MVC   DUMDUM+2(PLN-1),DUMDUM+1                                         
         MVC   DUMR,SPACES                                                      
         BAS   RE,BOXPUT6                                                       
         CLI   SAVECOM,X'19'                                                    
         BNE   BOXPUT16                                                         
         MVC   DUMDUM+1(PLN),SPACES                                             
         MVC   DUMR,SPACES                                                      
         BAS   RE,BOXPUT6          AND AGAIN FOR SPACE 3                        
         B     BOXPUT16                                                         
*                                                                               
BOXPUT6  NTR1                                                                   
         GOTO1 BOXMERGE,BOXPARA,(BOXCOUNT,DUMDUM+1)                             
         BAS   RE,PUT                                                           
         LLC   R1,BOXCOUNT                                                      
         LA    R1,1(R1)                                                         
         STC   R1,BOXCOUNT                                                      
         B     XIT                                                              
*                                                                               
BOXPUT8  CLI   BOXFLASH,C'Y'                                                    
         BE    BOXPUT14                                                         
         CLI   BOXSTAT,C'I'        SKIPPING TO CHANNEL N                        
         BNE   BOXPUT12            ARE WE WITHIN A BOX                          
         CLC   BOXCOUNT,BOXLOW                                                  
         BE    BOXPUT10                                                         
         CLI   BOXBLANK,C'N'                                                    
         BE    BOXPUT10                                                         
         GOTO1 BOXMERGE,BOXPARA,(C'C',DUMDUM+1)                                 
         MVI   DUMDUM,X'09'                                                     
         BAS   RE,PUT              THEN TIDY UP BOX - PRINTING SIDE             
         MVI   DUMDUM+1,C' '                                                    
         MVC   DUMDUM+2(PLN-1),DUMDUM+1                                         
         MVC   DUMR,SPACES                                                      
*                                                                               
BOXPUT10 GOTO1 BOXMERGE,BOXPARA,(C'B',DUMDUM+1)                                 
         MVI   DUMDUM,X'09'                                                     
         BAS   RE,PUT              PRINTING BOTTOM OF BOX HERE                  
         MVC   DUMDUM(1),SAVECOM                                                
         MVC   DUMDUM+1(PLN),SPACES                                             
         MVC   DUMR,SPACES                                                      
*                                                                               
BOXPUT12 BAS   RE,PUT              NOW SKIP TO CHANNEL                          
         MVI   BOXCOUNT,1          SET LINE COUNT TO 1 FOR CHANNEL 1            
         CLI   DUMDUM,X'89'                                                     
         BE    BOXPUT16                                                         
         MVI   BOXCOUNT,58         AND TO 58 FOR CHANNEL 9                      
         B     BOXPUT16                                                         
*                                                                               
BOXPUT14 CLI   BOXCOUNT,57         PATTERN INVOLVED                             
         BH    BOXPUT12            SO MAKE SURE IT ALL PRINTS                   
         CLI   BOXCOUNT,1                                                       
         BE    BOXPUT12                                                         
         MVI   DUMDUM,X'09'                                                     
         BAS   RE,BOXPUT6                                                       
         MVC   DUMDUM(1),SAVECOM                                                
         MVC   DUMDUM+1(PLN),SPACES                                             
         MVC   DUMR,SPACES                                                      
         B     BOXPUT14                                                         
*                                                                               
BOXPUT16 MVC   BOXLASTL,BOXCOLS    SAVE CURRENT COLUMNS                         
         MVC   BOXLASTR,BOXCOLSR                                                
*                                                                               
BOXPUTX  LLC   R1,BOXCOUNT         NEXT ROW NUMBER                              
         IC    R1,BOXROWS-1(R1)                                                 
         STC   R1,BOXNEXT                                                       
         CLI   BOXSTAT,C'I'        ARE WE IN A BOX                              
         BE    XIT                 YES                                          
         MVI   BOXSTAT,C'B'        BEFORE FIRST BOX                             
         CLC   BOXCOUNT,BOXHIGH                                                 
         BL    XIT                                                              
         MVI   BOXSTAT,C'A'        AFTER LAST BOX                               
         CLC   BOXCOUNT,BOXLOW                                                  
         BH    XIT                                                              
         MVI   BOXSTAT,C'T'        BETWEEN BOXES (LAST BOX CLOSED BY            
         B     XIT                 BOXREQ=C, OR BOXROWS(BOXCOUNT)=B)            
         EJECT                                                                  
***********************************************************************         
*ROUTINES TO INITIALIZE BOXAREAS                                      *         
***********************************************************************         
BOXSETUP MVI   BOXLOW,0                                                         
         MVI   BOXHIGH,0                                                        
*                                                                               
         LA    R1,BOXROWS          INIT BOXROWS                                 
         LA    R0,BOXROWSL                                                      
         MVI   DASH,C' '                                                        
         LA    RF,1                                                             
*                                                                               
BOXSET2  CLI   0(R1),C'T'                                                       
         BNE   BOXSET4                                                          
         CLI   BOXHIGH,0                                                        
         BNE   *+8                                                              
         STC   RF,BOXHIGH          SAVE LINE NO OF HIGHEST BOX                  
         MVI   DASH,C'-'                                                        
         B     BOXSET8                                                          
BOXSET4  CLI   0(R1),C'B'                                                       
         BNE   BOXSET6                                                          
         STC   RF,BOXLOW           SAVE LINE NO OF LOWEST BOX                   
         MVI   DASH,C' '                                                        
         B     BOXSET8                                                          
BOXSET6  CLI   0(R1),C'M'                                                       
         BE    BOXSET8                                                          
         CLI   0(R1),C'D'                                                       
         BE    BOXSET8                                                          
         MVC   0(1,R1),DASH                                                     
BOXSET8  LA    R1,1(R1)                                                         
         LA    RF,1(RF)                                                         
         BCT   R0,BOXSET2                                                       
         B     BOXSETCL            THEN BOXCOLS                                 
*                                                                               
BOXSETLA LA    R1,BOXLASTL         INIT BOXLASTL (ENTRY ONLY)                   
         B     *+8                                                              
*                                                                               
BOXSETCL LA    R1,BOXCOLS          INIT BOXCOLS                                 
         MVI   DASH,C' '                                                        
         LA    R0,L'BOXCOLS*2                                                   
         XR    RF,RF                                                            
*                                                                               
BOXSET10 CLI   0(R1),C'L'                                                       
         BE    BOXSET11                                                         
         CLI   0(R1),C'O'                                                       
         BNE   BOXSET12                                                         
BOXSET11 MVI   DASH,C'-'           OPEN NEW BOX                                 
         AHI   RF,1                COUNT DEPTH                                  
         B     BOXSET18                                                         
BOXSET12 CLI   0(R1),C'R'                                                       
         BNE   BOXSET14                                                         
         AHI   RF,-1               DECREMENT DEPTH                              
         BP    BOXSET18                                                         
         MVI   DASH,C' '           LAST ONE CLOSED                              
         XR    RF,RF               RESET IN CASE UNMATCHED RIGHTS               
         B     BOXSET18                                                         
BOXSET14 CLI   0(R1),C'C'                                                       
         BE    BOXSET18                                                         
         CLI   0(R1),C'D'                                                       
         BE    BOXSET18                                                         
         CLI   0(R1),C'X'                                                       
         BE    BOXSET15                                                         
         CLI   0(R1),C'V'                                                       
         BE    BOXSET16                                                         
         MVC   0(1,R1),DASH                                                     
         B     BOXSET18                                                         
BOXSET15 LTR   RF,RF                                                            
         BNZ   BOXSET18                                                         
         MVI   0(R1),C' '          X OUTSIDE BOX IS CHANGED TO BLANK            
         B     BOXSET18                                                         
BOXSET16 LTR   RF,RF                                                            
         BZ    BOXSET18                                                         
         MVI   0(R1),C'C'          V INSIDE BOX IS CHANGED TO CENTER            
BOXSET18 LA    R1,1(R1)                                                         
         BCT   R0,BOXSET10                                                      
*                                                                               
BOXSETX  BR    RE                                                               
         EJECT                                                                  
***********************************************************************         
*ROUTINES FOR COMPRESSED (MINI) BOX SCHEME                            *         
***********************************************************************         
MIN2     CLI   DUMDUM,X'89'        CHANNEL 1 - FORCE END OF BOX                 
         BNE   MIN4                                                             
         MVC   BOXCOLS,SPACES                                                   
         MVC   BOXCOLSR,SPACES                                                  
*                                                                               
MIN4     LA    R1,DUMDUM+1                                                      
         LA    RF,LASTDUM+1                                                     
         LA    RE,BOXCOLS                                                       
         LA    R2,BOXLASTL                                                      
         LA    R3,BOXSCORL                                                      
         L     R0,BOXWIDTH                                                      
         AHI   R0,1                                                             
         MVI   THISH,C' '                                                       
*                                                                               
MIN6     OI    0(R1),X'C0'         CONVERT PRINT CHARACTERS                     
         CLI   0(R1),X'FF'                 INTO CO-FF RANGE                     
         BNE   *+8                                                              
         MVI   0(R1),X'CF'         DOUBLE-QUOTE IS CF (FF IS INVALID)           
         CLI   0(R1),X'C0'                                                      
         BNE   *+8                                                              
         MVI   0(R1),X'40'         SPACE STAYS AS X'40'                         
         MVC   DUB(1),0(RE)                                                     
         MVC   DUB+1(1),0(R2)                                                   
         CLC   DUB(2),=C'LL'       CONTROL HORIZONTAL LINE                      
         BE    MIN8                LEFT TURNS IT ON                             
         CLI   DUB,C'L'                                                         
         BNE   *+8                                                              
         MVI   THISH,X'ED'                                                      
         CLI   DUB+1,C'L'                                                       
         BNE   *+8                                                              
         MVI   THISH,X'ED'                                                      
         CLI   DUB,C'R'            RIGHT TURNS IT OFF                           
         BNE   *+8                                                              
         MVI   THISH,C' '                                                       
         CLI   DUB+1,C'R'                                                       
         BNE   *+8                                                              
         MVI   THISH,C' '                                                       
*                                                                               
MIN8     CLI   THISH,C' '          ANY HORIZ REQUIRED?                          
         BE    MIN12                                                            
         CLI   0(RF),X'80'         IF PREVIOUS WAS LEFT SPACE                   
         BNE   *+12                REPLACE THIS WITH BOTTOM LEFT                
         MVI   0(RF),X'AD'                                                      
         B     MIN12                                                            
         CLI   0(RF),X'C0'         IF PREVIOUS WAS SPACE                        
         BNE   *+12                REPLACE THIS WITH BOTTOM                     
         MVI   0(RF),X'ED'                                                      
         B     MIN12                                                            
         MVI   0(R3),X'ED'         ELSE SET UP THE UNDERSCORE                   
*                                                                               
MIN12    CLI   0(RE),C' '          ANY CHARACTER (L/C/R) IN COLS.               
         BE    *+8                 CAUSES VERTICAL LINE TO PRINT                
         NI    0(R1),X'BF'         SO CONVERT CO-FF TO 80-BF                    
         CLI   0(R1),X'00'                                                      
         BNE   *+8                                                              
         MVI   0(R1),X'80'         LH SPACE IS X'80'                            
         CLC   DUB(2),=C' R'       IF WE'RE ENDING A RIGHT BOX                  
         BNE   MIN14                                                            
         CLI   0(RF),X'40'         AND PREVIOUS CONTENTS ARE CLEAR              
         BNE   MIN14                                                            
         MVI   0(RF),X'BF'         THEN PUT IN THE BOTTOM LEFT                  
*                                                                               
MIN14    LA    R1,1(R1)                                                         
         LA    RF,1(RF)                                                         
         LA    RE,1(RE)                                                         
         LA    R2,1(R2)                                                         
         LA    R3,1(R3)                                                         
         BCT   R0,MIN6                                                          
*                                                                               
         LA    R3,DUMDUM                                                        
         MVC   BOXLASTL,BOXCOLS                                                 
         MVC   BOXLASTR,BOXCOLSR                                                
         MVC   SAVEL,DUMDUM        SAVE THIS PRINT LINE                         
         MVC   SAVER,DUMDUM+PLN+1                                               
         CLI   LASTDUM,C' '                                                     
         BE    MIN20                                                            
         MVC   DUMDUM(PLN+1),LASTDUM                                            
         MVC   DUMDUM+PLN+1(PLN),LASTDUMR                                       
         CLC   BOXSCORL,SPACES     SEE IF WE NEED ANY HORIZONTALS               
         BNE   MIN16                                                            
         CLC   BOXSCORR,SPACES                                                  
         BE    MIN18                                                            
*                                                                               
MIN16    MVI   DUMDUM,X'01'                                                     
         BAS   RE,PUT              THIS WE WILL ACHIEVE BY UNDERSCORING         
         MVC   DUMDUM+1(PLN),BOXSCORL      THE PREVIOUS LINE                    
         MVC   DUMDUM+PLN+1(PLN),BOXSCORR                                       
         MVC   BOXSCORL,SPACES                                                  
         MVC   BOXSCORR,SPACES                                                  
         MVC   DUMDUM(1),LASTDUM                                                
*                                                                               
MIN18    BAS   RE,PUT              PRINT PREVIOUS LINE                          
*                                                                               
MIN20    MVC   LASTDUM,SAVEL       SAVE THIS LINE                               
         MVC   LASTDUMR,SAVER                                                   
*                                                                               
MINX     B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
*RELEASE A LINE TO POOL OR REMOTE Q                                   *         
***********************************************************************         
PUT      NTR1                                                                   
         ICM   RF,15,=V(LOGOC)                                                  
         BZ    PUT4                                                             
         USING LOGOD,RF                                                         
         CLI   DUMDUM,X'8B'                                                     
         BE    PUT2                                                             
         CLI   DUMDUM,X'89'                                                     
         BE    PUT2                                                             
         L     R1,LOGORUNL         ADD 1 TO LINES                               
         LA    R1,1(R1)                                                         
         ST    R1,LOGORUNL                                                      
         B     PUT4                                                             
*                                                                               
PUT2     L     R1,LOGORUNP         OR PAGES                                     
         LA    R1,1(R1)                                                         
         ST    R1,LOGORUNP                                                      
*                                                                               
         OC    REMOTKEY,REMOTKEY   TEST PRINTING REMOTE                         
         BNZ   PUT4                YES - NO SEGMENTATION                        
*                                  SEGMENTATION LOGIC                           
         L     R1,LOGOSGTD                                                      
         LA    R1,1(R1)            ADD 1 TO THIS SEGMENT                        
         ST    R1,LOGOSGTD                                                      
         C     R1,LOGOSGMX         TEST IF SEGMENTATION IS ON                   
         BL    PUT4                                                             
         MVI   LOGOTYPE,C'M'       END THIS SEGMENT                             
         OC    LOGOSEG,LOGOSEG                                                  
         BNE   *+8                                                              
         MVI   LOGOSEG+3,1                                                      
         MVI   LOGOSGCN,C'E'                                                    
         ST    RF,PARA                                                          
         GOTO1 =V(LOGO),PARA                                                    
         LA    R2,PRNTER0                                                       
         SETPRT (2)                                                             
         L     RF,=V(LOGOC)                                                     
         L     R1,LOGOSEG                                                       
         LA    R1,1(R1)            ADD 1 TO SEGMENT NUMBER                      
         ST    R1,LOGOSEG                                                       
         MVI   LOGOSGCN,C'S'       START NEXT SEGMENT                           
         ST    RF,PARA                                                          
         GOTO1 =V(LOGO),PARA                                                    
         L     RF,=V(LOGOC)                                                     
         XC    LOGOSGTD,LOGOSGTD                                                
         MVI   LOGOSGCN,0                                                       
         DROP  RF                                                               
*                                                                               
PUT4     OC    REMOTKEY,REMOTKEY                                                
         BZ    PUT6                                                             
         BAS   RE,REMPUT                                                        
         CLI   REMOTPRT,0                                                       
         BE    PUTX                                                             
*                                                                               
PUT6     L     R4,ASPLAREA                                                      
         CLI   0(R4),0             TEST TAPE SPOOLING                           
         BNE   PUT16               YES                                          
*                                                                               
         CLI   LASTWIDE,0          IS SYSPRINT OPEN                             
         BE    PUT7                IF NOT GO TO OPEN                            
         ICM   RF,15,=V(MASTC)                                                  
         BZ    *+12                                                             
         TM    MCFLAGS-MASTD(RF),MCOUT198    TEST FIXED LEN OUTPUT              
         BO    PUT8                          YES - NEVER REOPEN                 
         CLC   LASTWIDE,BOXWIDTH+3 IS THE WIDTH CORRECT?                        
         BNE   REOPEN                                                           
         CLC   LASTOPT,BOXOPTCD    CHANGE OF OPTCD=J                            
         BE    PUT8                                                             
*                                                                               
REOPEN   LA    R4,PRNTER0          THEN CLOSE PREVIOUS SYSPRINT                 
         CLOSE ((R4))                                                           
         LTR   RF,RF                                                            
         JNZ   *+2                 DIE IF CLOSE ERROR                           
*                                                                               
PUT7     MVC   LASTOPT,BOXOPTCD                                                 
         L     RE,BOXWIDTH         PICK UP REPORT WIDTH                         
         LTR   RE,RE                                                            
         BNZ   *+8                                                              
         LHI   RE,132              DEFAULT IS 132                               
         ST    RE,BOXWIDTH                                                      
         STC   RE,LASTWIDE         SAVE THIS                                    
         AHI   RE,1                ADD 1 FOR THE CONTROL CHARACTER              
         NI    PRNTER0+52,X'FE'    TURN OFF OPTCD BIT                           
*                                                                               
         CLI   BOXOPTCD,C'J'                                                    
         BNE   *+12                                                             
         OI    PRNTER0+52,X'01'    OPTIONALLY TURN ON                           
         AHI   RE,1                PLUS ONE FOR OPTCD                           
*                                                                               
         ICM   RF,15,=V(MASTC)                                                  
         BZ    PUT7A                                                            
         TM    MCFLAGS-MASTD(RF),MCOUT198   TEST FIX OUTLEN AT 198              
         BZ    *+8                          NO                                  
         LHI   RE,199                       198 + 1 FOR OPTCD                   
*                                                                               
PUT7A    STH   RE,PRNTER0+82       MODIFY THE DCB WITH RECORD LENGTH            
         LA    R4,PRNTER0                                                       
         OPEN  ((R4),OUTPUT)                                                    
         LTR   RF,RF                                                            
         JNZ   *+2                 DIE IF CLOSE ERROR                           
*                                                                               
PUT8     CLI   BOXOFFST,0          OPTION TO OFFSET TO RIGHT                    
         BE    PUT10                                                            
         MVC   DUMR,1(R3)                                                       
         MVC   1(PLN,R3),SPACES                                                 
         LLC   R1,BOXOFFST                                                      
         LA    R1,1(R1,R3)                                                      
         MVC   0(PLN,R1),DUMR                                                   
*                                                                               
PUT10    CLI   BOXOPTCD,C'J'       IS OPTCD=J SET                               
         BNE   PUT15                                                            
         BCTR  R3,0                BACK UP TO PREVIOUS BYTE                     
         MVC   0(1,R3),1(R3)       MOVE IN CONTROL CHARACTER                    
         MVC   1(1,R3),BOXFONT     AND FONT NUMBER (0-3)                        
         CLI   BOXHEADF,0          OPTION TO SELECT FONT                        
         BE    PUT11               BASED ON LINE NUMBER                         
         MVI   1(R3),0             USE FONT 0                                   
         CLC   BOXCOUNT,BOXHEADF   IF PRESENT COUNT IS LESS                     
         BL    PUT11                                                            
         MVI   1(R3),1             ELSE USE FONT 1                              
*                                                                               
PUT11    CLI   0(R3),X'8B'         NEW PAGE                                     
         BE    *+8                                                              
         CLI   0(R3),X'89'         NEW PAGE                                     
         BNE   PUT14                                                            
         SR    RE,RE                                                            
         ICM   RE,1,BOXPGDF#                                                    
         BZ    PUT14               DEFAULT OR LAST ONE SET                      
         CLI   BOXPGDF#,10         ALLOW UPTO 10                                
         BH    PUT14                                                            
         BCTR  RE,0                                                             
         MHI   RE,6                                                             
         A     RE,BOXPGDEF         FORMATS WITHIN MAIN PAGEDEF                  
         CLC   0(6,RE),SPACES                                                   
         BNH   PUT14                                                            
         MVC   IDMPGDF(6),0(RE)    MOVE IN PAGEDEF NAME                         
         PUT   PRNTER0,IDM         INVOKE DATA MAP                              
         MVC   1(1,R3),0(R3)       REPLACE CONTROL CHARACTER                    
         B     PUTX                                                             
*                                                                               
PUT14    PUT   PRNTER0,(R3)                                                     
         MVC   1(1,R3),0(R3)       REPLACE CONTROL CHARACTER                    
         B     PUTX                                                             
*                                                                               
PUT15    PUT   PRNTER0,(R3)                                                     
         B     PUTX                                                             
*                                  WRITING TO SPOOL TAPES                       
PUT16    CLI   0(R4),1             IS TAPE OPEN                                 
         BH    PUT20                                                            
         L     RE,BOXWIDTH         PICK UP REPORT WIDTH                         
         LTR   RE,RE                                                            
         BNZ   *+8                                                              
         LA    RE,132              DEFAULT IS 132                               
         LA    RE,1(RE)            ADD 1 FOR THE CONTROL CHARACTER              
         STH   RE,SPOOLT+82        MODIFY THE DCB WITH RECORD LENGTH            
         MHI   RE,20               SET BLOCKING FACTOR OF 20                    
         STH   RE,SPOOLT+62        MODIFY THE DCB WITH BLOCK SIZE               
         ICM   RF,15,=V(DYNALLOC)                                               
         BZ    PUT18                                                            
         IC    R0,2(R4)            OPTIONAL +N GENERATION                       
         GOTO1 (RF),PARA,(X'08',SPLPRINT),((R0),4(R4))                          
*                                                                               
PUT18    OPEN  (SPOOLT,(OUTPUT))                                                
         LTR   RF,RF                                                            
         JNZ   *+2                 DIE IF OPEN ERROR                            
         MVI   0(R4),2                                                          
*                                                                               
PUT20    CLI   1(R4),0             TEST TAPE SPOOLING ACTIVE                    
         BE    PUT10                                                            
         PUT   SPOOLT,(R3)                                                      
*                                                                               
PUTX     B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
*ROUTINES TO HANDLE REMOTE PRINTING                                   *         
***********************************************************************         
REMPUT   NTR1                                                                   
         ICM   RF,15,=V(LOGOPASS)  IS THIS A LINE FROM V(LOGO)                  
         BZ    REMPUT1                                                          
         CLI   0(RF),C'Y'                                                       
         BNE   REMPUT1                                                          
*&&UK*&& B     REMPUTX             NO LOGOS TO PRTQ IN UK                       
*                                                                               
REMPUT1  TM    REMFLAG,X'80'       TEST FIRST TIME                              
         BO    REMPUT2                                                          
         GOTO1 REMOTAOP,PARA       YES - OPEN THE PRTQ                          
         CLI   PARA,X'FF'                                                       
         JE    *+2                 DIE IF CANT OPEN PRTQ                        
         OI    REMFLAG,X'80'       SET FIRST TIME DONE                          
*                                                                               
REMPUT2  CLC   LASTKEY,REMOTKEY    WRAP UP LAST REPORT ON KEY CHANGE            
         BE    REMPUT9                                                          
         OC    LASTKEY,LASTKEY                                                  
         BZ    REMPUT4                                                          
         MVI   OPENINFO,X'FF'                                                   
         GOTO1 REMPUTEM,OPENINFO                                                
         NI    REMFLAG,255-X'20'   SET THIS REPORT NOW CLOSED                   
*                                                                               
REMPUT4  LA    R1,OPENINFO         INITIALIZE THIS REPORT                       
         USING PQPLD,R1                                                         
         XC    OPENINFO,OPENINFO                                                
         MVI   QLEXTRA,X'FF'                                                    
         XC    REMPQK,REMPQK                                                    
         MVI   REMPQF,0                                                         
         XC    REMPQA,REMPQA                                                    
         ICM   RF,15,=V(MASTC)     TEST MASTC RESOLVED                          
         BZ    REMPUT5                                                          
         CLI   WHICH,2             TEST PRINT2 ENTRY                            
         BNE   REMPUT4A                                                         
         MVC   REMPQK,MCREMP2K-MASTD(RF)                                        
         MVC   REMPQF,MCREMP2F-MASTD(RF)                                        
         MVC   REMPQA,MCREMP2A-MASTD(RF)                                        
         B     REMPUT6                                                          
*                                                                               
REMPUT4A MVC   REMPQK,MCREMPQK-MASTD(RF)                                        
         MVC   REMPQF,MCREMPQF-MASTD(RF)                                        
         MVC   REMPQA,MCREMPQA-MASTD(RF)                                        
         B     REMPUT6                                                          
*                                                                               
REMPUT5  ICM   RF,15,VREMPQKY      MASTC NOT RESOLVED - TEST KEY IS             
         BZ    *+10                                                             
         MVC   REMPQK,0(RF)                                                     
         ICM   RF,15,VREMPQCI                                                   
         BZ    REMPUT6                                                          
         MVI   REMPQF,0                                                         
         MVC   REMPQA,0(RF)                                                     
*                                                                               
REMPUT6  OC    REMPQK,REMPQK       TEST PQ REPORT KEY GIVEN                     
         BZ    REMPUT8                                                          
         MVC   QLSRCID(7),REMPQK   SET KEY OF EXISTING FILE                     
         CLC   REMPQA,=H'1'        0=REPLACE REPORT,1=EXTEND REPORT             
         BH    REMPU65             ELSE USE DISKADDR FOR SOON REPORT            
         BL    *+12                                                             
         MVI   QLFLAG,QLFLKEY+QLFLRALL+QLFLXTND SET KEY AND EXTEND              
         B     REMPUT62                                                         
         MVI   QLFLAG,QLFLKEY+QLFLRALL SET PASSING KEY                          
         TM    REMFLAG,X'40'       TEST IF FIRST REPLACE REPORT                 
         BZ    REMPUT62            YES                                          
         OI    QLFLAG,QLFLXTND     NO SET EXTENDING EXISTING FILE               
REMPUT62 GOTO1 REMPUTEM,OPENINFO   RE-OPEN TO REPLACE/EXTEND REPORT             
         OI    REMFLAG,X'20'+X'40' SET THIS REPORT OPEN                         
         LA    R1,OPENINFO                                                      
         MVC   REMPQF,QLREPRCF                                                  
         MVC   REMPQA,QLREPRCI     EXTRACT AND SAVE REPORT DISK ADDR            
         L     R1,REMOTABF                                                      
         CLC   PQKEY-PQRECD(5,R1),REMPQK                                        
         JNE   *+2                 DIE IF KEY GIVEN IS NOT KEY READ             
         B     REMPUT6X                                                         
*                                                                               
REMPU65  MVI   QLFLAG,QLFLCIDA+QLFLRALL+QLFLRDT SET PASSING DISKADDR            
         MVC   QLREPRCF,REMPQF                                                  
         MVC   QLREPRCI,REMPQA     SET DISKADDR OF FIRST CI                     
         LA    RF,PQRETTAB         SET DEFAULT RETAIN CLASS                     
         MVC   QLRETNL,0(RF)                                                    
         MVC   QLRETND,2(RF)                                                    
*                                                                               
REMPUT6A LA    RF,L'PQRETTAB(RF)   SEARCH RETAIN CLASS TABLE                    
         OC    0(2,RF),0(RF)                                                    
         BZ    REMPUT6B                                                         
         CLC   REMOTRET,4(RF)      MATCH ON CLASS                               
         BNE   REMPUT6A                                                         
         MVC   QLRETNL,0(RF)       COPY VALUES FOR CLASS                        
         MVC   QLRETND,2(RF)                                                    
*                                                                               
REMPUT6B GOTO1 REMPUTEM,OPENINFO   DO SPECIAL PRTQUE RE-OPEN                    
         OI    REMFLAG,X'20'+X'40' SET THIS REPORT OPEN                         
         L     R1,REMOTABF                                                      
         USING PQRECD,R1           R1=A(PQ BUFFER)                              
         CLC   PQKEY(5),REMPQK                                                  
         JNE   *+2                 DIE IF KEY GIVEN IS NOT KEY READ             
         TM    PQTYPE,PQTYNEW      TEST OLD/NEW PQ FORMAT                       
         BZ    REMPUT7                                                          
         MVC   PQCLASS,REMOTCLS    UPDATE BUFFER WITH REPORT VALUES             
         MVC   REMOTRNO,PQREPNO                                                 
         ICM   R0,1,REMOTLPP                                                    
         BNZ   *+8                                                              
         LA    R0,68               DEFAULT LPP IS 68                            
         STC   R0,PQLPP                                                         
         OI    PQLINET,X'C0'       CONVERT TO WIDE REPORT                       
         MVI   PQLINEW,198                                                      
         CLC   BOXWIDTH,=F'198'    SET WIDTH FROM BOXWIDTH IF > 198             
         BNH   *+10                                                             
         MVC   PQLINEW,BOXWIDTH+3                                               
         MVC   PQFORMS,REMOTFNO                                                 
         MVC   PQCHARS,REMOTCHR                                                 
         MVC   PQCOPIES,REMOTCPY                                                
         MVC   PQDESC,REMOTKEY                                                  
         CLI   REMOTFLG,X'FA'      TEST NEW STYLE LAYOUT                        
         BL    REMPUT6X            NO                                           
*                                                                               
REMPUT6C MVC   PQDESC,REMOTDSC     REPORT DESCRIPTION                           
         CLC   PQDESC,SPACES                                                    
         BH    REMPUT6D                                                         
         MVC   PQDESC,SPACES       SET DESCRIPTION TO SPP                       
         MVC   PQDESC+0(1),REMOTSYS                                             
         MVC   PQDESC+1(2),REMOTPRG                                             
*                                                                               
REMPUT6D MVC   PQSYS,REMOTSYS      SYSTEM/PROGRAM/AGENCY                        
         MVC   PQPRG,REMOTPRG                                                   
         MVC   PQPRGSUB,REMOTSUB                                                
*                                                                               
REMPUT6E TM    PQATTB,PQATPW       TEST IF SECURITY ALREADY DEFINED             
         BO    REMPUT6F                                                         
         MVC   PQPSWD,REMOTPAS     REPORT PASSWORD                              
         TM    REMOTSF1,REMOTNON   TEST IF VALID SECURITY FLAG                  
         BZ    *+12                YES                                          
         MVI   REMOTSF1,0          NO CLEAR SECURITY FLAGS                      
         MVI   REMOTSF2,0                                                       
         MVC   PQSECF1,REMOTSF1                                                 
         MVC   PQSECF2,REMOTSF2                                                 
         CLI   PQSECF1,0           TEST IF FLAGS SET                            
         BE    *+12                                                             
         OI    PQATTB,PQATPW       YES SET SECURE REPORT                        
         B     REMPUT6F                                                         
         OC    PQPSWD,PQPSWD       TEST IF VALUE SET                            
         BZ    REMPUT6F                                                         
         CLC   PQPSWD,SPACES                                                    
         BE    REMPUT6F                                                         
         OC    PQPSWD,SPACES       CONVERT PIN TO UPPER CASE                    
         OI    PQSECF1,PQSIPIN     SET PASSWORD CONTAINS A PIN                  
         OI    PQATTB,PQATPW       SET SECURE REPORT                            
*                                                                               
REMPUT6F TM    REMOTTYP,PQTYDL     TEST AND SET DOWNLOADABLE                    
         BZ    REMPUT6G                                                         
         OI    PQTYPE,PQTYDL                                                    
         B     REMPUT6J            DON'T ARCHIVE                                
*                                                                               
REMPUT6G TM    REMOTTYP,PQTYSQL    TEST AND SET SQL CONVERTABLE                 
         BZ    REMPUT6I                                                         
         OI    PQTYPE,PQTYSQL                                                   
         CLC   PQDESC+3(2),SPACES  TEST IF DESC ALREADY SET FOR SQL             
         BNE   *+12                                                             
         CLI   PQDESC+5,C'@'                                                    
         BE    REMPUT6J                                                         
         MVC   PQDESC,SPACES       C'SPP  @ABCDEF' IS DESC FOR SQL              
         MVC   PQDESC+0(1),REMOTSYS                                             
         MVC   PQDESC+1(2),REMOTPRG                                             
         CLC   REMOTSQL,SPACES     TEST IF SQL TRANSFORM CODE DEFINED           
         BNH   REMPUT6J                                                         
         MVI   PQDESC+5,C'@'                                                    
         MVC   PQDESC+6(5),REMOTSQL                                             
         B     REMPUT6J            DON'T ARCHIVE                                
*                                                                               
REMPUT6I CLI   REMOTRTY,C'A'       TEST AND SET REPORT TYPE                     
         BL    *+10                                                             
         MVC   PQREPTY,REMOTRTY                                                 
         CLI   REMOTARC,C'A'       TEST AND SET ARCHIVE CLASS                   
         BL    *+10                                                             
         MVC   PQARC,REMOTARC                                                   
         NI    PQTYP1,PQTYNCD                                                   
         OC    PQTYP1,REMOTTY1                                                  
         CLI   PQARC,C'A'          SET ARCHIVABLE IF VALID ARC CLASS            
         BL    *+16                                                             
         TM    PQTYP1,PQTYAE+PQTYAR+PQTYAD                                      
         BNZ   *+8                                                              
         OI    PQTYP1,PQTYAR                                                    
*                                                                               
REMPUT6J TM    REMOTSTA,PQSTIN     TEST AND SET REPORT STATUS                   
         BZ    *+8                                                              
         OI    PQSTAT,PQSTIN       SET INVISIBLE                                
*                                                                               
REMPUT6X B     REMPUT9                                                          
*                                                                               
REMPUT7  EQU   *                   CODE FOR OLD STYLE PQ                        
         MVC   PQCLASS,REMOTCLS    UPDATE BUFFER WITH REPORT VALUES             
         MVC   REMOTRNO,PQREPNO                                                 
         ICM   R0,1,REMOTLPP                                                    
         BNZ   *+8                                                              
         LA    R0,68               DEFAULT LPP IS 68                            
         STC   R0,PQLPP                                                         
         OI    PQLINET,X'C0'       CONVERT TO WIDE REPORT                       
         MVI   PQLINEW,198                                                      
         CLC   BOXWIDTH,=F'198'    SET WIDTH FROM BOXWIDTH IF > 198             
         BNH   *+10                                                             
         MVC   PQLINEW,BOXWIDTH+3                                               
         MVC   PQFORMS,REMOTFNO                                                 
         MVC   PQCHARS,REMOTCHR                                                 
         MVC   PQCOPIES,REMOTCPY                                                
         MVC   PQDESC,REMOTKEY                                                  
         CLI   REMOTFLG,X'FA'      TEST NEW STYLE LAYOUT                        
         BL    REMPUT7X            NO                                           
*                                                                               
REMPUT7C MVC   PQDESC,REMOTDSC     REPORT DESCRIPTION                           
         CLC   PQDESC,SPACES                                                    
         BH    REMPUT7D                                                         
         MVC   PQDESC,SPACES       SET DESCRIPTION TO SPP                       
         MVC   PQDESC+0(1),REMOTSYS                                             
         MVC   PQDESC+1(2),REMOTPRG                                             
*                                                                               
REMPUT7D MVC   PQSYS,REMOTSYS      SYSTEM/PROGRAM/AGENCY                        
         MVC   PQPRG,REMOTPRG                                                   
         MVC   PQPRGSUB,REMOTSUB                                                
*                                                                               
REMPUT7E TM    PQATTB,PQATPW       TEST IF SECURITY ALREADY DEFINED             
         BO    REMPUT7F                                                         
         MVC   PQPSWD,REMOTPAS     REPORT PASSWORD                              
         TM    REMOTSF1,REMOTNON   TEST IF VALID SECURITY FLAG                  
         BZ    *+12                YES                                          
         MVI   REMOTSF1,0          NO CLEAR SECURITY FLAGS                      
         MVI   REMOTSF2,0                                                       
         MVC   PQSECF1,REMOTSF1                                                 
         MVC   PQSECF2,REMOTSF2                                                 
         CLI   PQSECF1,0           TEST IF FLAGS SET                            
         BE    *+12                                                             
         OI    PQATTB,PQATPW       YES SET SECURE REPORT                        
         B     REMPUT7F                                                         
         OC    PQPSWD,PQPSWD       TEST IF VALUE SET                            
         BZ    REMPUT7F                                                         
         CLC   PQPSWD,SPACES                                                    
         BE    REMPUT7F                                                         
         OC    PQPSWD,SPACES       CONVERT PIN TO UPPER CASE                    
         OI    PQSECF1,PQSIPIN     SET PASSWORD CONTAINS A PIN                  
         OI    PQATTB,PQATPW       SET SECURE REPORT                            
*                                                                               
REMPUT7F TM    REMOTTYP,PQTYDL     TEST AND SET DOWNLOADABLE                    
         BZ    REMPUT7G                                                         
         OI    PQTYPE,PQTYDL                                                    
         B     REMPUT7J            DON'T ARCHIVE                                
*                                                                               
REMPUT7G TM    REMOTTYP,PQTYSQL    TEST AND SET SQL CONVERTABLE                 
         BZ    REMPUT7I                                                         
         OI    PQTYPE,PQTYSQL                                                   
         CLC   PQDESC+3(2),SPACES  TEST IF DESC ALREADY SET FOR SQL             
         BNE   *+12                                                             
         CLI   PQDESC+5,C'@'                                                    
         BE    REMPUT7J                                                         
         MVC   PQDESC,SPACES       C'SPP  @ABCDEF' IS DESC FOR SQL              
         MVC   PQDESC+0(1),REMOTSYS                                             
         MVC   PQDESC+1(2),REMOTPRG                                             
         CLC   REMOTSQL,SPACES     TEST IF SQL TRANSFORM CODE DEFINED           
         BNH   REMPUT7J                                                         
         MVI   PQDESC+5,C'@'                                                    
         MVC   PQDESC+6(5),REMOTSQL                                             
         B     REMPUT7J            DON'T ARCHIVE                                
*                                                                               
REMPUT7I CLI   REMOTRTY,C'A'       TEST AND SET REPORT TYPE                     
         BL    *+10                                                             
         MVC   PQREPTY,REMOTRTY                                                 
         CLI   REMOTARC,C'A'       TEST AND SET ARCHIVE CLASS                   
         BL    *+10                                                             
         MVC   PQARC,REMOTARC                                                   
         NI    PQTYP1,PQTYNCD                                                   
         OC    PQTYP1,REMOTTY1                                                  
         CLI   PQARC,C'A'          SET ARCHIVABLE IF VALID ARC CLASS            
         BL    *+16                                                             
         TM    PQTYP1,PQTYAE+PQTYAR+PQTYAD                                      
         BNZ   *+8                                                              
         OI    PQTYP1,PQTYAR                                                    
*                                                                               
REMPUT7J TM    REMOTSTA,PQSTIN     TEST AND SET REPORT STATUS                   
         BZ    *+8                                                              
         OI    PQSTAT,PQSTIN       SET INVISIBLE                                
*                                                                               
REMPUT7X B     REMPUT9                                                          
*                                                                               
REMPUT8  LA    R1,OPENINFO         INITIALIZE FOR NEW REPORT (OFFLINE)          
         USING PQPLD,R1                                                         
         MVC   QLSRCID,REMOTDST                                                 
         MVC   QLSUBID,REMOTJID                                                 
         MVC   QLSTAT,REMOTSTA                                                  
         MVC   QLCLASS,REMOTCLS                                                 
         OI    QLLINET,X'C0'                                                    
         MVI   QLLINEW,198                                                      
         CLC   BOXWIDTH,=F'198'    SET WIDTH FROM BOXWIDTH IF > 198             
         BNH   *+10                                                             
         MVC   QLLINEW,BOXWIDTH+3                                               
         MVC   QLLPP,REMOTLPP                                                   
         CLI   QLLPP,0                                                          
         BNE   *+8                                                              
         MVI   QLLPP,68                                                         
         MVC   QLFORMS,REMOTFNO                                                 
         MVC   QLCHARS,REMOTCHR                                                 
         MVC   QLCOPIES,REMOTCPY                                                
         MVC   QLPSWD,REMOTPAS                                                  
         TM    REMOTSF1,REMOTNON   TEST IF VALID SECURITY FLAG                  
         BZ    *+16                YES                                          
         MVI   QLSECF1,0           NO CLEAR SECURITY FLAGS                      
         MVI   QLSECF2,0                                                        
         B     *+16                                                             
         MVC   QLSECF1,REMOTSF1                                                 
         MVC   QLSECF2,REMOTSF2                                                 
         MVC   QLDESC,REMOTKEY                                                  
         CLI   REMOTFLG,X'FA'      TEST NEW STYLE LAYOUT                        
         BL    REMPUT8F            NO                                           
*                                                                               
REMPUT8A MVC   QLDESC,REMOTDSC     REPORT DESCRIPTION                           
         CLC   QLDESC,SPACES                                                    
         BH    REMPUT8B                                                         
         MVC   QLDESC,SPACES       SET DESCRIPTION TO SPP                       
         MVC   QLDESC+0(1),REMOTSYS                                             
         MVC   QLDESC+1(2),REMOTPRG                                             
REMPUT8B MVC   QLSYS,REMOTSYS      SYSTEM/PROGRAM/AGENCY                        
         MVC   QLPRG,REMOTPRG                                                   
         MVC   QLPRGSUB,REMOTSUB                                                
*                                                                               
REMPUT8D TM    REMOTTYP,QLTYDL     TEST DOWNLOADABLE REPORT                     
         BZ    REMPUT8E                                                         
         OI    QLTYPE,QLTYDL                                                    
         B     REMPUT8F                                                         
*                                                                               
REMPUT8E TM    REMOTTYP,QLTYSQL    TEST SQL TYPE REPORT                         
         BZ    REMPUT8F                                                         
         OI    QLTYPE,QLTYSQL                                                   
         CLC   QLDESC+3(2),SPACES  TEST IF DESC ALREADY SET FOR SQL             
         BNE   *+12                                                             
         CLI   QLDESC+5,C'@'                                                    
         BE    REMPUT8F                                                         
         MVC   QLDESC,SPACES       C'SPP  @ABCDEF' IS DESC FOR SQL              
         MVC   QLDESC+0(1),REMOTSYS                                             
         MVC   QLDESC+1(2),REMOTPRG                                             
         CLC   REMOTSQL,SPACES     TEST IF SQL TRANSFORM CODE DEFINED           
         BNH   REMPUT8F                                                         
         MVI   QLDESC+5,C'@'                                                    
         MVC   QLDESC+6(5),REMOTSQL                                             
*                                                                               
REMPUT8F LA    RF,PQRETTAB         GET RETAIN CLASS                             
         MVC   QLRETNL,0(RF)       START WITH DEFAULT                           
         MVC   QLRETND,2(RF)                                                    
REMPUT8G LA    RF,L'PQRETTAB(RF)                                                
         OC    0(2,RF),0(RF)       END OF TABLE                                 
         BZ    REMPUT8H                                                         
         CLC   REMOTRET,4(RF)      MATCH ON CLASS                               
         BNE   REMPUT8G                                                         
         MVC   QLRETNL,0(RF)       COPY VALUES FOR CLASS                        
         MVC   QLRETND,2(RF)                                                    
*                                                                               
REMPUT8H TM    QLTYPE,QLTYSQL+QLTYDL    DONT ARCHIVE DOWN OR SQL                
         BNZ   REMPUT8X                                                         
         CLI   REMOTRTY,C'A'       TEST IF VALID REPORT TYPE                    
         BL    *+10                                                             
         MVC   QLREPTY,REMOTRTY                                                 
         CLI   REMOTARC,C'A'       TEST IF VALID ARCHIVE CLASS                  
         BL    *+10                                                             
         MVC   QLARC,REMOTARC                                                   
         MVC   QLTYP1,REMOTTY1                                                  
         CLI   QLARC,C'A'          SET ARCHIVABLE IF VALID ARC CLASS            
         BL    *+16                                                             
         TM    QLTYP1,QLTYAE+QLTYAR+QLTYAD                                      
         BNZ   *+8                                                              
         OI    QLTYP1,QLTYAR                                                    
*                                                                               
REMPUT8X GOTO1 REMPUTEM,OPENINFO   DO NORMAL PRTQUE OPEN                        
         OI    REMFLAG,X'20'+X'40' SET THIS REPORT OPEN                         
         MVC   REMOTRNO,PLREPNO    GET BACK REPORT NUMBER                       
*                                                                               
REMPUT9  MVC   LASTKEY,REMOTKEY    PRINT NORMAL PRINT LINE                      
         GOTO1 REMPUTEM,DUMDUM                                                  
*                                                                               
REMPUTX  B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
*DMPRINT COMMANDS - R1=A(PRINT LINE)                                  *         
***********************************************************************         
REMPUTEM NTR1                                                                   
         LR    R2,R1                                                            
         SR    R0,R0                                                            
         LA    RF,=C'DMPRINT'                                                   
         CLI   0(R2),X'FC'         TEST FOR CLOSE TYPE COMMANDS                 
         BL    REMPUTM1                                                         
         LA    RF,=C'CLOSE'                                                     
         CLI   0(R2),X'FF'         TEST REGULAR CLOSE                           
         BE    REMPUTM1                                                         
         LA    RF,=C'CLO/ERR'                                                   
         CLI   0(R2),X'FE'                                                      
         BNE   REMPUTM0                                                         
         MVC   WORK(7),0(RF)                                                    
         MVI   WORK+7,C'='                                                      
         MVC   WORK+8(1),1(R2)     SET CLO/ERR=R WHERE R IS REASON CODE         
         LA    RF,WORK                                                          
         B     REMPUTM1                                                         
REMPUTM0 LA    RF,=C'CLO/PUR'                                                   
         CLI   0(R2),X'FD'                                                      
         BE    REMPUTM1                                                         
         LA    RF,=C'CLO/USR'                                                   
         LA    R0,1(R2)            R0=A(USER KEY)                               
*                                                                               
REMPUTM1 GOTO1 REMOTADM,PARA,(RF),=C'PRTQUE',(R0),(R2),REMOTABF                 
         CLI   8(R1),0                                                          
         BE    REMPUTMA                                                         
         L     RF,=A(PQERRS)                                                    
REMPUTM2 CLI   0(RF),0             TEST END OF TABLE - UNKNOWN ERROR            
         BE    REMPUTM3                                                         
         CLC   0(1,RF),8(R1)                                                    
         BE    REMPUTM3                                                         
         LA    RF,L'PQERRS(RF)                                                  
         B     REMPUTM2                                                         
REMPUTM3 MVC   REMPUTE1(3),0(RF)   DMCB+8/ABEND CODE                            
         MVC   REMPUTE4(25),3(RF)  TEXT                                         
         MVC   REMPUTE5,SPACES     REPORT ID                                    
REMPUTM4 LR    RF,RD               LOOK FOR DMPRT'S WORKING STORAGE             
         CLC   0(4,RF),=C'PRTQ'                                                 
         BE    REMPUTM5                                                         
         L     RF,8(RF)                                                         
         CLC   0(4,RF),=C'PRTQ'                                                 
         BE    REMPUTM5                                                         
         L     RF,8(RF)                                                         
         CLC   0(4,RF),=C'PRTQ'                                                 
         BNE   REMPUTM6                                                         
REMPUTM5 LA    RF,72(RF)           RF=A(DMPRTQ'S W/S)                           
         CLC   0(8,RF),=C'PQWSINFO'                                             
         BNE   REMPUTM6                                                         
         CLC   12(4,RF),=C'PRTQ'   TEST IF USERPRTQ NAME FILLED IN              
         BNE   REMPUTM6                                                         
         MVC   REMPUTE4+4(1),16(RF)                                             
         LA    RF,24(RF)           POINT TO REPTINFO                            
         OC    0(2,RF),0(RF)                                                    
         BZ    REMPUTM6                                                         
         MVC   REMPUTE5(3),2(RF)   REPORT ID                                    
         MVI   REMPUTE5+3,C','                                                  
         SR    R0,R0                                                            
         ICM   R0,3,5(RF)          REPORT SEQUENCE NUMBER                       
         CVD   R0,REMPUTDW                                                      
         OI    REMPUTDW+7,X'0F'                                                 
         UNPK  REMPUTE5+4(5),REMPUTDW                                           
REMPUTM6 LA    R3,REMPUTE3         POINT TO MESSAGE LENGTH                      
         WTO   TEXT=(R3)                                                        
         LA    R1,PARA                                                          
         SR    R0,R0                                                            
         IC    R0,8(R1)            R0=DMCB+8                                    
         STC   R0,REMPUTE1                                                      
REMPUTM7 XC    LASTKEY,LASTKEY                                                  
         LA    R1,PARA                                                          
         SR    R0,R0                                                            
         IC    R0,REMPUTE1         R0=DMCB+8                                    
         LH    R3,REMPUTE2         R3=ABEND CODE                                
         ABEND (3)                                                              
*                                                                               
REMPUTDW DC    D'0'                                                             
REMPUTER DC    H'0'                                                             
         DC    X'00'               ALIGN                                        
REMPUTE1 DC    X'00'               DMCB+8                                       
REMPUTE2 DC    H'0'                ABEND CODE                                   
REMPUTE3 DC    H'36'               WTO MSG LENGTH                               
REMPUTE4 DC    CL26' '             WTO ERR MESSAGE                              
REMPUTE5 DC    CL10' '             WTO ERR REPORT                               
*                                                                               
REMPUTMA CLI   0(R2),X'FC'         TEST CLOSE TYPE COMMAND                      
         BL    REMPUTMX                                                         
         L     RF,REMOTABF                                                      
         USING PQRECD,RF                                                        
         MVC   REMOTPAG,PQPAGES    PASS BACK PAGES AND LINES USED               
         MVC   REMOTLIN,PQLINES+1                                               
         TM    PQTYPE,PQTYNEW      TEST OLD/NEW PQ FORMAT                       
         BO    *+16                                                             
         MVC   REMOTPAG,PQPAGES                                                 
         MVC   REMOTLIN,PQLINES+1                                               
*&&US                                                                           
***********************************************************************         
*THIS PART OF CODE CAN GO AWAY WHEN                                   *         
*1.THIS VERSION IS RELINKED BY ALL CONTROLLERS                        *         
*2.THEN THE NEW FASPOON IS MADE LIVE (MAKE UPD REP INVISIBLE FIRST)   *         
***********************************************************************         
         TM    PQSTAT,PQSTIN       THIS IS INVISIBLE?                           
         BO    REMXXX              YES                                          
*                                                                               
         CLI   0(R2),X'FF'         TEST CLOSE OR CLO/USR                        
         BE    *+12                                                             
         CLI   0(R2),X'FC'                                                      
         BNE   REMPUTME                                                         
         SR    RF,RF                                                            
         ICM   RF,15,=V(SSB)                                                    
         BZ    REMPUTME                                                         
         USING SSOOFF,RF                                                        
         CLC   0(3,RF),=X'0000FF'  TEST OFFLINE EXTENDED SSB                    
         BNE   REMPUTME                                                         
         TM    SSOSTAT2,SSOSRWRK   TEST WRITING TO FACWRK                       
         BZ    REMPUTME                                                         
         TM    SSOFLAG2,SSO2AWRK   TEST RECORDS ADDED TO FACWRK                 
         BZ    REMPUTME                                                         
         MVC   WORK(5),=C'INVIS'   MAKE REPORT INVISIBLE                        
         LA    RF,WORK                                                          
         LA    R0,1(R2)            R0=A(USER KEY)                               
         GOTO1 REMOTADM,PARA,(RF),=C'PRTQUE',(R0),(R2),REMOTABF                 
         B     REMPUTME                                                         
*                                                                               
REMXXX   DS    0H                                                               
         USING PQRECD,RF                                                        
         TM    PQTYPE,PQTYUPDT     UPDATIVE SOON REPORT?                        
         BNO   REMPUTME            NO                                           
*                                                                               
         CLI   0(R2),X'FE'         TEST CLO/ERR                                 
         BE    REMPUTMD            MARK IT VISIBLE                              
         CLI   0(R2),X'FF'         TEST CLOSE OR CLO/USR                        
         BE    *+12                                                             
         CLI   0(R2),X'FC'                                                      
         BNE   REMPUTME                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,15,=V(SSB)                                                    
         BZ    REMPUTME                                                         
         USING SSOOFF,RF                                                        
         CLC   0(3,RF),=X'0000FF'  TEST OFFLINE EXTENDED SSB                    
         BNE   REMPUTME                                                         
         TM    SSOSTAT2,SSOSRWRK   TEST WRITING TO FACWRK                       
         BZ    REMPUTMD            NO                                           
         TM    SSOFLAG2,SSO2AWRK   TEST RECORDS ADDED TO FACWRK                 
         BNZ   REMPUTME            YES                                          
*                                                                               
REMPUTMD MVC   WORK(5),=C'VISIB'   MAKE REPORT INVISIBLE                        
         LA    RF,WORK                                                          
         LA    R0,1(R2)            R0=A(USER KEY)                               
         GOTO1 REMOTADM,PARA,(RF),=C'PRTQUE',(R0),(R2),REMOTABF                 
*                                                                               
REMPUTME EQU   *                                                                
*&&                                                                             
*                                                                               
REMPUTMX B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
*ROUTINE TO MERGE POSSIBLE BOX DATA WITH PRINT LINE                   *         
*BOXPARA=PARAMETER LIST AS FOLLOWS                                    *         
*                                                                     *         
*P1/B0   ROW NUMBER (1-100) OR T=TOP,M=MIDDLE,B=BOTTOM,C=CONTINUE     *         
*P1/B1-3 A(PRINT LINE)                                                *         
***********************************************************************         
BOXMERGE NTR1                                                                   
         MVC   ROWTYPE,BOXPARA     T/M/B/C/ROW                                  
         CLI   ROWTYPE,BOXROWSL                                                 
         BH    BOX4                T/M/B/C OVERRIDES BOXREQ AND ROW             
         CLI   BOXREQ,C' '                                                      
         BNH   BOX2                IF NO BOXREQ, USE BOXROWS ENTRY              
         CLI   BOXREQ,C'N'                                                      
         BE    BOX2                BOXREQ=N NEW BOX, USES BOXROWS ENTRY         
         MVI   ROWTYPE,C'T'                                                     
         CLI   BOXREQ,C'O'                                                      
         BE    BOX4                BOXREQ=O OPEN A BOX, FORCES TOP              
         MVI   ROWTYPE,C'B'                                                     
         CLI   BOXREQ,C'C'                                                      
         BE    BOX4                BOXREQ=C CLOSE A BOX, FORCES BOTTOM          
         MVI   ROWTYPE,C'M'                                                     
         CLI   BOXREQ,C'B'                                                      
         BE    BOX4                BOXREQ=B RULE A LINE, FORCES MID             
         MVI   ROWTYPE,C'D'                                                     
         CLI   BOXREQ,C'D'                                                      
         BE    BOX4                BOXREQ=D FORCES DOTTED MID                   
*                                                                               
BOX2     LLC   RF,BOXPARA          ROW NUMBER                                   
         IC    RF,BOXROWS-1(RF)                                                 
         STC   RF,ROWTYPE                                                       
*                                                                               
BOX4     CLI   ROWTYPE,C'M'        IF WE ARE DOING MIDS                         
         BNE   BOX4B                                                            
         OC    BOXALTCL,BOXALTCL   USER CAN PASS ALTERNATE BOXCOLS              
         BZ    BOX4B                                                            
         LLC   R1,BOXALTCL         FIRST BYTE IS OPTIONAL LENGTH                
         LTR   R1,R1                                                            
         BNZ   *+8                                                              
         LA    R1,198              DEFAULT IS 198                               
         BCTR  R1,0                                                             
         L     RE,BOXALTCL                                                      
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   BOXCOLS(0),0(RE)    MOVE IN BOXCOLS                              
         XC    BOXALTCL,BOXALTCL                                                
*                                                                               
BOX4B    CLI   BOXSTAT,C'I'        ARE WE IN A BOX                              
         BE    BOX5                                                             
         CLI   ROWTYPE,C'T'        IF NOT IGNORE ALL BUT TOP                    
         BNE   BOX62                                                            
BOX5     CLI   ROWTYPE,C'C'        IF INSIDE A BOX, 'C' OR ' '                  
         BE    *+12                                                             
         CLI   ROWTYPE,C' '                                                     
         BNE   *+8                                                              
         MVI   ROWTYPE,C'-'        BECOMES '-'                                  
         CLI   BOXYORN,C'Y'                                                     
         BNE   BOX60               DO NO MORE IF BOXES NOT ACTIVE               
*                                                                               
BOX6     LA    R5,BOXCOLS          PRESET USING BOXCOLS                         
         MVI   NEWBOX,C'N'         AND BOXCOLS SAME AS LAST TIME                
         ICM   RF,15,BOXHOOK       CALL USERS HOOK IF REQUIRED                  
         BZ    BOX7                PARMS=CL1'ROWTYPE',AL3(LINE),                
         MVC   DUB,BOXPARA         AL1(BOXCOUNT),AL3(BOXD)                      
         MVC   DUB(1),ROWTYPE                                                   
         GOTO1 (RF),DUB,,(BOXCOUNT,(R8))                                        
         MVC   ROWTYPE,DUB         USER CAN RESET ROWTYPE                       
         CLI   BOXINIT,0           TEST HOOK WANTS FULL REINIT                  
         BNE   BOX7                                                             
         BAS   RE,BOXSETUP         DO IT                                        
         MVI   BOXINIT,1                                                        
         MVC   BOXLASTL,BOXCOLS    AND SET OLD SAME AS NEW                      
         MVC   BOXLASTR,BOXCOLSR                                                
         B     BOX50               THEN DO ROWTYPE V BOXCOLS                    
*                                                                               
BOX7     CLC   BOXLASTL,BOXCOLS    SEE IF OLD AND NEW COLS DIFFERENT            
         BNE   *+14                                                             
         CLC   BOXLASTR,BOXCOLSR                                                
         BE    BOX50               IF SAME JUST DO ROWTYPE V BOXCOLS            
         MVI   NEWBOX,C'Y'         INDICATE DIFFERENT                           
         BAS   RE,BOXSETCL         BOXCOLS MAY HAVE CHANGED                     
         BAS   RE,BOXSETLA         BOXLASTL MAY HAVE CHANGED                    
*                                                                               
BOX8     CLI   ROWTYPE,C'T'        IF TOP DO IT V NEW BOXCOLS                   
         BE    BOX50                                                            
         CLI   ROWTYPE,C'B'        IF BOTTOM IT V OLD BOXCOLS                   
         BNE   BOX9                                                             
         LA    R5,BOXLASTL                                                      
         B     BOX50                                                            
BOX9     CLI   BOXREQ,C'N'         REQUEST TO HANDLE NEW BOXES                  
         BE    BOX10                                                            
         CLI   ROWTYPE,C'-'        IF CONTINUATION (NOT MID OR D)               
         BE    BOX50               DO IT V NEW BOXCOLS, IGNORING CHANGE         
         EJECT                                                                  
***********************************************************************         
*MERGE BOX DATA, HANDLING CHANGES TO BOXCOLS                          *         
*                                                                     *         
*THE ROUTINE IS USED IF BOXCOLS HAS CHANGED. AND IT IS EITHER A MID   *         
*(OR DOTTED MID) REQUEST, INCLUDING BOXREQ=B (OR D), OR IT IS A       *         
*CONTINUED LINE (ROW='-') AND BOXREQ=N. IT IS NOT EXECUTED UNLESS     *         
*BOXCOLS HAS CHANGED.                                                 *         
*                                                                     *         
*THIS ROUTINE HANDLES THE HORRIFIC TASK OF TIDYING UP THE BOXES SO    *         
*THERE ARE NO LOOSE ENDS LEFT IN MID AIR. IT WILL ALSO OPEN AND CLOSE *         
*BOXES ENCLOSED IN, BUT UNCONNECTED WITH, EXISTING BOXES TO ANY DEPTH *         
*                                                                     *         
*NOTE THAT EACH COLUMN CAN BE A TOP, MIDDLE, BOTTOM OR CONTINUATION,  *         
*DEPENDING ON THE CHANGE IN THE BOX STRUCTURE.                        *         
***********************************************************************         
BOX10    LA    R3,SHADE            R3=ROW/COLUMN WORK AREA                      
         L     R4,BOXPARA          R4=A(PRINT LINE)                             
         LA    R5,BOXCOLS          R5=BOXCOLS/BOXLASTL                          
         XR    R6,R6               BOXCOLS (NEW) BOXCOUNT                       
         LR    R7,R6               BOXLASTL (OLD) BOXCOUNT                      
         LA    R0,L'SHADE*2                                                     
         MVI   DASH,C'-'           CLEAR HORIZONTAL (RIGHT FILL)                
*                                                                               
BOX12    CLI   0(R5),C'L'          START NEW COLUMN GET NEW BOX DEPTH           
         BE    *+12                                                             
         CLI   0(R5),C'O'                                                       
         BNE   BOX13                                                            
         AHI   R6,1                                                             
         B     BOX14                                                            
BOX13    CLI   0(R5),C'R'                                                       
         BNE   BOX14                                                            
         AHI   R6,-1                                                            
         BP    BOX14                                                            
         XR    R6,R6                                                            
BOX14    CLI   BOXLASTL-BOXCOLS(R5),C'L' GET OLD BOX DEPTH                      
         BE    *+12                                                             
         CLI   BOXLASTL-BOXCOLS(R5),C'O'                                        
         BNE   BOX15                                                            
         AHI   R7,1                                                             
         B     BOX16                                                            
BOX15    CLI   BOXLASTL-BOXCOLS(R5),C'R'                                        
         BNE   BOX16                                                            
         AHI   R7,-1                                                            
         BP    BOX16                                                            
         XR    R7,R7                                                            
*                                                                               
BOX16    MVC   THISROW,ROWTYPE     PRESET ROW TYPE                              
         MVC   THISCOL,0(R5)       PRESET NEW COLUMN TYPE                       
         CLC   0(1,R5),BOXLASTL-BOXCOLS(R5) HAS THIS COLUMN CHANGED             
         BE    BOX30               NO                                           
                                                                                
***********************************************************************         
*COLUMN TYPE HAS CHANGED. LOOK UP RESULTING BOX CHAR IN COLCHTAB      *         
***********************************************************************         
BOX18    MVC   DUB(1),BOXLASTL-BOXCOLS(R5) OLD CHARACTER                        
         MVC   DUB+1(1),0(R5)              NEW CHARACTER                        
         L     R2,=A(COLCHTAB)     R2=COLUMN CHANGE TABLE                       
BOX19    CLC   0(2,R2),DUB                                                      
         BE    BOX20                                                            
         LA    R2,L'COLCHTAB(R2)                                                
         CLI   0(R2),X'FF'                                                      
         BNE   BOX19                                                            
                                                                                
***********************************************************************         
*IF ROW IS A MID OR DOTTED MID TYPE, JUST SUBSTITUTE THE RESULTING    *         
*CHARACTER (ROW/COLUMN TYPE)                                          *         
***********************************************************************         
BOX20    CLI   ROWTYPE,C'-'        IS THIS A BOX ROW                            
         BE    BOX22               NO - HAVE TO PUT IN HORIZONTALS              
         MVC   THISROW(2),2(R2)    COPY PAIR FOR BOX ROW                        
         CLI   ROWTYPE,C'M'        IF MID ROW                                   
         BNE   BOX30                                                            
         CLI   THISROW,C'D'        FORCE DOTTED ROW CHARACTER                   
         BNE   BOX30                                                            
         MVI   THISROW,C'M'        TO MID ROW CHARACTER                         
         B     BOX30                                                            
                                                                                
***********************************************************************         
*ROW IS A CONTINUE TYPE, SO WE HAVE TO DECIDE IF ANY RULING OFF OF    *         
*A COLUMN IS REQUIRED, AS WELL AS SUBSTITUTING THE CHARACTER.         *         
*                                                                     *         
*RULING OFF IS DONE TO THE LEFT AND/OR THE RIGHT. LEFT RULE IS DONE   *         
*BY GOING BACKWARDS OVER WORK ALREADY DONE, RIGHT RULE IS DONE BY     *         
*SETTING DASH TO THE ROW TYPE AND TAKING IT INTO ACCOUNT ON EACH      *         
*SUBSEQUENT CHARACTER.                                                *         
*                                                                     *         
*RULING IS EITHER A SIMPLE LINE TO THE NEXT/PREVIOUS BOX COLUMN, OR   *         
*IF A BOX EDGE IS INVOLVED, THE FILL MAY GO EITHER WAY ACCORDING TO   *         
*WHETHER AN ENCLOSED BOX IS BEING OPENED OR CLOSED.                   *         
***********************************************************************         
BOX22    MVC   THISROW(2),4(R2)    COPY PAIR FOR NON BOX ROW                    
         CLC   6(2,R2),SPACES      ANY FILLING TO DO                            
         BE    BOX30               NO                                           
         CLI   6(R2),C' '          LEFT FILLING ?                               
         BE    BOX26               NO - MUST BE RIGHT                           
                                                                                
***********************************************************************         
*LEFT FILLING IS INDICATED. BUT SEE IF BOX OPEN/CLOSE AND RIGHT FILL  *         
*INSTEAD IF REQUIRED.                                                 *         
***********************************************************************         
         CLI   6(R2),C'Y'          LEFT FILLING ?                               
         BE    BOX25               YES - GO TO IT                               
*                                                                               
         CLI   6(R2),C'O'          OPENING BOX (TOP LEFT)                       
         BNE   BOX23                                                            
         LTR   R7,R7               OLD ALREADY IN A BOX                         
         BNZ   BOX22A              YES                                          
         CLI   1(R2),C'O'          CHANGING TO OPEN LEFT ?                      
         BE    BOX29               YES - JUST RIGHT FILL                        
         CHI   R6,1                NEW ALREADY IN A BOX                         
         BH    BOX28               YES CHANGE TO CENTRE                         
         B     BOX29               RIGHT FILL                                   
BOX22A   CHI   R6,1                NEW ALREADY IN A BOX                         
         BNH   BOX25               NO - FILL LEFT TO OLD BOX                    
         CLI   1(R2),C'O'          CHANGING TO OPEN LEFT ?                      
         BE    BOX29               YES - JUST RIGHT FILL                        
         CLI   DASH,C'-'           RIGHT FILLING ALREADY ?                      
         BNE   BOX28               YES - CHANGE TO CENTRE                       
         MVI   THISCOL,C'L'        CHANGE TO LEFT TO START INSIDE BOX           
         B     BOX29               RIGHT FILL                                   
*                                                                               
BOX23    CLI   6(R2),C'C'          CLOSING BOX (BOTTOM LEFT)                    
         BNE   BOX26                                                            
         LTR   R6,R6               NEW ALREADY IN A BOX                         
         BNZ   BOX23A              YES                                          
         CLI   0(R2),C'O'          CHANGING FROM OPEN LEFT ?                    
         BE    BOX29               YES - JUST RIGHT FILL                        
         CHI   R7,1                OLD ALREADY IN A BOX                         
         BH    BOX28               NO - CHANGE TO CENTRE                        
         B     BOX29               RIGHT FILL                                   
BOX23A   CHI   R7,1                OLD ALREADY IN A BOX                         
         BNH   BOX25               NO - FILL LEFT TO OLD BOX                    
         CLI   0(R2),C'O'          CHANGING FROM OPEN LEFT ?                    
         BE    BOX29               YES - JUST RIGHT FILL                        
         CLI   DASH,C'-'           RIGHT FILLING ALREADY ?                      
         BNE   BOX28               YES - CHANGE TO CENTRE                       
         MVI   THISCOL,C'L'        CHANGE TO LEFT TO START INSIDE BOX           
         B     BOX29               RIGHT FILL                                   
                                                                                
***********************************************************************         
*GO BACK OVER PREVIOUS COLUMNS DRAWING RULE TO LEFT UNTIL PREVIOUS    *         
*BOX COLUMN REACHED. CHANGE IT TO JOIN UP IF NECCESSARY               *         
***********************************************************************         
BOX25    LR    RE,R3                                                            
         MVI   DASH,C'M'           SET MID HORIZONTAL FILL                      
BOX25A   BCTR  RE,0                POINT TO PREV COLUMN WORK AREA               
         CLI   LASTDUM-SHADE(RE),C'-' FILL ONLY TO PREVIOUS BOX COLUMN          
         BNE   BOX25B                                                           
         MVC   0(1,RE),DASH        CHANGING ROW TO FILL TYPE (M OR D)           
         B     BOX25A                                                           
BOX25B   CLI   0(RE),C'-'          IF BOX COL IN CONTINUE TYPE ROW,             
         BNE   BOX25D                                                           
         MVC   0(1,RE),DASH        CHANGE IT TO FILL TYPE (M OR D)              
         CLI   LASTDUM-SHADE(RE),C'O' THEN CHANGE ALL BUT O TO LEFT             
         BE    BOX25F                                                           
         MVI   LASTDUM-SHADE(RE),C'L'                                           
         B     BOX25F                                                           
BOX25D   CLI   LASTDUM-SHADE(RE),C'R' IF ORIGINALY RIGHT BOX                    
         BNE   BOX25E                                                           
         MVI   LASTDUM-SHADE(RE),C'C' CHANGE TO CENTER SO IT JOINS UP           
         B     BOX25F                                                           
BOX25E   CLI   LASTDUM-SHADE(RE),C' ' IF ORIGINALY BLANK (COLMN DELETE)         
         BNE   BOX25F                                                           
         MVI   LASTDUM-SHADE(RE),C'L' CHANGE TO LEFT SO IT JOINS UP             
BOX25F   MVI   DASH,C'-'           RESET FILL CHAR                              
*                                                                               
         CLI   6(R2),C' '          DID WE COME HERE FROM LEFT FILL              
         BE    BOX38               NO - MUST HAVE BEEN RIGHT OPEN/CLOSE         
         CLI   7(R2),C' '          IS THERE A RIGHT FILL TO DO                  
         BE    BOX38               NO                                           
                                                                                
***********************************************************************         
*RIGHT FILLING IS INDICATED. BUT SEE IF BOX OPEN.CLOSE AND LEFT FILL  *         
*INSTEAD IF REQUIRED.                                                 *         
***********************************************************************         
BOX26    CLI   7(R2),C'Y'          RIGHT FILLING                                
         BE    BOX29               YES                                          
         CLI   7(R2),C'O'          OPENING BOX (TOP RIGHT)                      
         BNE   BOX27                                                            
         LTR   R7,R7               OLD STILL IN A BOX                           
         BNZ   BOX26A              YES                                          
         LTR   R6,R6               MORE NEW BOX                                 
         BZ    BOX25               NO - LEFT FILL                               
         MVI   THISCOL,C'C'        YES CHANGE TO CENTER                         
         B     BOX25               LEFT                                         
BOX26A   LTR   R6,R6               MORE NEW BOX                                 
         BZ    BOX28               NO - FILL RIGHT TO OLD BOX                   
         MVI   THISCOL,C'R'        CHANGE TO RIGHT TO END INSIDE BOX            
         B     BOX25               LEFT FILL                                    
*                                                                               
BOX27    CLI   7(R2),C'C'          CLOSING BOX (BOTTOM RIGHT)                   
         BNE   BOX30                                                            
         LTR   R6,R6               NEW STILL IN A BOX                           
         BNZ   BOX27A              YES                                          
         LTR   R7,R7               MORE OLD BOX                                 
         BZ    BOX25               NO - LEFT FILL                               
         MVI   THISCOL,C'C'        YES CHANGE TO CENTER                         
         B     BOX25               LEFT                                         
BOX27A   LTR   R7,R7               MORE OLD BOX                                 
         BZ    BOX28               NO - FILL RIGHT TO NEW BOX                   
         MVI   THISCOL,C'R'        CHANGE TO RIGHT TO END INSIDE BOX            
         B     BOX25               LEFT FILL                                    
*                                                                               
BOX28    CLI   DASH,C'-'           CHANGE TO CENTRE                             
         BE    BOX29               IF FILLING FROM LEFT                         
         MVI   THISCOL,C'C'        CHANGE TO CENTRE                             
*                                                                               
BOX29    MVI   DASH,C'M'           SET MID FILL CHAR.                           
         B     BOX38               FILL RIGHT TO NEW BOX                        
                                                                                
***********************************************************************         
*BEFORE FINISHING WITH COLUMN, CHECK IF A RIGHT FILL IS IN PROGRESS   *         
*(DASH NOT EQ '-') AND DO IT UNLESS WEVE REACHED A BOX COLUMN, WHEN   *         
*THE CHARACTER MAY NEED TO CHANGE SO IT JOINS UP                      *         
***********************************************************************         
BOX30    CLI   DASH,C'-'           IS RIGHT FILL ACTIVE                         
         BE    BOX38               NO - NEXT COLUMN                             
         CLI   THISCOL,C'-'        IS THIS A CONTINUE COLUMN                    
         BNE   BOX32               NO - TERMINATE RIGHT FILL                    
         MVC   THISROW,DASH        DASH = RIGHT FILL ROW CHAR (M OR D)          
         B     BOX38               NEXT CHAR                                    
*                                                                               
BOX32    CLI   THISROW,C'-'        IF CONTINUE TYPE ROW,                        
         BNE   BOX34                                                            
         MVC   THISROW,DASH        CHANGE IT TO FILL TYPE (M OR D)              
         CLI   THISCOL,C'O'        THEN CHANGE ANYTHING BUT O TO RIGHT          
         BE    BOX36                                                            
         MVI   THISCOL,C'R'                                                     
         B     BOX36                                                            
BOX34    CLI   THISCOL,C'L'        IF LEFT BOX ORIGINALLY                       
         BNE   BOX35                                                            
         MVI   THISCOL,C'C'        CHANGE IT TO CENTER SO IT JOINS UP           
         B     BOX36                                                            
BOX35    CLI   THISCOL,C' '        IF ORIGINALY BLANK (COLUMN DELETE)           
         BNE   BOX36                                                            
         MVI   THISCOL,C'R'        CHANGE TO RIGHT SO IT JOINS UP               
BOX36    MVI   DASH,C'-'           CANCEL RIGHT FILL                            
*                                                                               
BOX38    MVC   0(1,R3),THISROW     COPY ROW VALUE FOR COLUMN                    
         MVC   LASTDUM-SHADE(1,R3),THISCOL AND COLUMN VALUE                     
         CLI   0(R5),C'X'          REMOVE SPECIAL COLUMN DELETE                 
         BNE   BOX39                                                            
         MVI   0(R5),C'-'          REPLACING WITH '-'                           
         LTR   R6,R6                                                            
         BNZ   BOX39                                                            
         MVI   0(R5),C' '          OR SPACE IF NOT IN A BOX                     
BOX39    LA    R3,1(R3)            BUMP TO NEXT CHARACTER                       
         LA    R4,1(R4)                                                         
         LA    R5,1(R5)                                                         
         BCT   R0,BOX12                                                         
                                                                                
***********************************************************************         
*FINAL PART OF CHANGED BOX LOGIC IS TO PUT THE RESULTING CHARACTERS   *         
*INTO THE PRINT LINE.                                                 *         
***********************************************************************         
BOX40    LA    R3,SHADE            R3=ROW WORK AREA                             
         L     R4,BOXPARA          R4=A(PRINT LINE)                             
         LA    R5,LASTDUM          R5=COLUMN WORK AREA                          
         LA    R0,L'SHADE*2                                                     
BOX42    CLI   0(R4),C' '          DONT PRINT BOX OVER USER'S LINE              
         BNE   BOX48                                                            
         MVC   THISROW,0(R3)                                                    
         MVC   THISCOL,0(R5)                                                    
         BAS   RE,BOXGET           CHARACTER CONVERSION TABLE LOOKUP            
BOX48    LA    R3,1(R3)            BUMP TO NEXT CHARACTER                       
         LA    R4,1(R4)                                                         
         LA    R5,1(R5)                                                         
         BCT   R0,BOX42                                                         
         B     BOX60                                                            
         EJECT                                                                  
***********************************************************************         
*MERGE BOX DATA WITHOUT HANDLING CHANGES TO BOXCOLS                   *         
*THE ROUTINE IS ALWAYS USED IF BOXCOLS HAS NOT CHANGED. AND IT IS     *         
*ALWAYS USED FOR TOP AND BOTTOM ROWS, USING THE NEW OR OLD BOXCOLS    *         
*RESPECTIVELY. IT WILL NOT PROCESS MID OR DOTTED MIDS IF BOXCOLS HAS  *         
*CHANGED. IT WILL ALWAYS PROCESS CONTINUED LINES (ROW = '-') EVEN IF  *         
*BOXCOLS HAS CHANGED, UNLESS THE CHANGE IS NOTIFIED VIA BOXREQ=N.     *         
***********************************************************************         
BOX50    L     R4,BOXPARA          R4=A(PRINT LINE)                             
         XR    R6,R6                                                            
         LA    R0,L'BOXCOLS*2                                                   
         MVC   THISROW,ROWTYPE                                                  
BOX52    MVI   THISCOL,C'C'                                                     
         CLI   0(R5),C'L'          COUNT UNPAIRED LEFTS                         
         BE    *+12                                                             
         CLI   0(R5),C'O'                                                       
         BNE   BOX54                                                            
         AHI   R6,1                                                             
         CHI   R6,1                                                             
         BH    BOX57               TREAT AS CENTER IF NOT FIRST                 
         B     BOX56                                                            
BOX54    CLI   0(R5),C'R'          UNCOUNT PAIRED RIGHTS                        
         BNE   BOX55                                                            
         AHI   R6,-1                                                            
         BP    BOX57               TREAT AS CENTER IF NOT FIRST                 
         XR    R6,R6               RESET IN CASE EXCESS RIGHTS                  
         B     BOX56                                                            
BOX55    CLI   0(R5),C'X'          IGNORE SPECIAL COLUMN DELETE                 
         BNE   BOX56                                                            
         MVI   0(R5),C'-'          REPLACING WITH '-'                           
         LTR   R6,R6                                                            
         BNZ   BOX56                                                            
         MVI   0(R5),C' '          OR SPACE IF NOT IN A BOX                     
BOX56    MVC   THISCOL,0(R5)       COMPLETE 2 CHARACTER ROW/COL                 
BOX57    CLI   0(R4),C' '          DONT PRINT BOX OVER USER'S LINE              
         BNE   BOX58                                                            
         BAS   RE,BOXGET           CHARACTER CONVERSION TABLE LOOKUP            
BOX58    LA    R4,1(R4)            NEXT CHARACTER                               
         LA    R5,1(R5)                                                         
         BCT   R0,BOX52                                                         
         B     BOX60                                                            
*                                                                               
BOXGET   L     RF,=A(BOXTABLE)     RF=CHARACTER CONVERSION TABLE                
BOXGET2  CLC   0(2,RF),THISROW     LOOK UP IN TABLE                             
         BE    BOXGET4                                                          
         LA    RF,L'BOXTABLE(RF)                                                
         CLI   0(RF),X'FF'                                                      
         BNE   BOXGET2                                                          
BOXGET4  MVC   0(1,R4),2(RF)       SET BOX CHARACTER IN LINE                    
         BR    RE                                                               
*                                                                               
BOX60    CLI   ROWTYPE,C'T'                                                     
         BNE   BOX61                                                            
         MVI   BOXSTAT,C'I'        SET INSIDE BOX IF DONE TOP                   
         B     BOX62                                                            
BOX61    CLI   ROWTYPE,C'B'                                                     
         BNE   BOX62                                                            
         MVI   BOXSTAT,C' '        CLEAR INSIDE BOX IF DONE BOTTOM              
         EJECT                                                                  
***********************************************************************         
*MERGE SHADING                                                        *         
***********************************************************************         
BOX62    MVC   SHADE,SPACES                                                     
         MVC   SHADER,SHADE                                                     
         CLI   BOXSHADE,0                                                       
         BE    BOX64                                                            
         CLI   BOXSHADE,3          SHADING PATTERN                              
         BL    BOX70                                                            
         CLI   BOXSHADE,4                                                       
         BNE   BOX64                                                            
         MVC   SHADE(1),BOXSHCH1   STRIPES                                      
         TM    BOXCOUNT,X'01'                                                   
         BO    *+10                                                             
         MVC   SHADE(1),BOXSHCH2                                                
         CLI   SHADE,X'00'         CONVERT NULL TO SPACE                        
         BNE   *+8                                                              
         MVI   SHADE,X'40'                                                      
         MVC   SHADE+1(PLN-1),SHADE                                             
         MVC   SHADER,SHADE                                                     
*                                                                               
BOX64    CLI   BOXFLASH,C'Y'       IS FLASH OPERATIVE                           
         BNE   BOX80                                                            
         LLC   R1,BOXCOUNT         POSITION INTO PATTERN                        
         BCTR  R1,0                                                             
         MHI   R1,PLN                                                           
         A     R1,BOXAPAT                                                       
         LA    RF,SHADE                                                         
         LA    R0,L'BOXCOLS                                                     
         CLI   BOXSHCH1,0                                                       
         BNE   *+8                                                              
         MVI   BOXSHCH1,BOX_SH     SET SHADING CHARACTER                        
*                                                                               
BOX66    CLI   0(R1),1             1=PATTERN OPERATIVE                          
         BNE   BOX68                                                            
         MVC   0(1,RF),BOXSHCH1                                                 
         B     BOX69                                                            
*                                                                               
BOX68    CLI   0(R1),2             2=PATTERN REVERSE                            
         BNE   BOX69                                                            
         MVI   0(RF),X'40'         SO REMOVE EVEN STRIPES                       
*                                                                               
BOX69    LA    R1,1(R2)                                                         
         LA    RF,1(RF)                                                         
         BCT   R0,BOX66                                                         
         B     BOX80                                                            
*                                                                               
BOX70    MVI   BYTE,0              HANDLE SHADING IN/OUT OF BOXES               
         CLI   BOXSTAT,C'I'                                                     
         BNE   BOX71               NOT IN BOX                                   
         LLC   R1,BOXCOUNT                                                      
         LA    R1,BOXROWS-1(R1)                                                 
         CLI   0(R1),C' '                                                       
         BE    BOX71                                                            
         MVI   BYTE,1              MAY-BE IN                                    
*                                                                               
BOX71    LA    R1,SHADE                                                         
         LA    RF,BOXCOLS                                                       
         LA    R0,L'BOXCOLS*2                                                   
*                                                                               
BOX72    CLI   BYTE,0                                                           
         BE    BOX74                                                            
         CLI   0(RF),C'L'                                                       
         BNE   *+8                                                              
         MVI   BYTE,2              DEFINITELY IN                                
         CLI   0(RF),C'R'                                                       
         BNE   *+8                                                              
         MVI   BYTE,1              OUT FOR THE MOMENT                           
*                                                                               
BOX74    CLI   BOXSHADE,1          INSIDE BOXES                                 
         BNE   BOX76                                                            
         CLI   BYTE,2                                                           
         BNE   BOX78                                                            
         MVC   0(1,R1),BOXSHCH1                                                 
         B     BOX78                                                            
*                                                                               
BOX76    CLI   BYTE,2              OUTSIDE BOXES                                
         BE    BOX78                                                            
         MVC   0(1,R1),BOXSHCH1                                                 
*                                                                               
BOX78    LA    R1,1(R1)                                                         
         LA    RF,1(RF)                                                         
         BCT   R0,BOX72                                                         
*                                                                               
BOX80    L     R1,BOXPARA          USER'S LINE                                  
         LA    RF,SHADE                                                         
         L     R0,BOXWIDTH         HOW MANY CHARACTERS                          
         LTR   R0,R0                                                            
         BNZ   *+8                                                              
         LA    R0,PLN                                                           
*                                                                               
BOX82    CLI   0(R1),C' '          MERGE IN SHADE IF LINE STILL SPACES          
         BNE   BOX84                                                            
         MVC   0(1,R1),0(RF)                                                    
*                                                                               
BOX84    LA    R1,1(R1)                                                         
         LA    RF,1(RF)                                                         
         BCT   R0,BOX82                                                         
*                                                                               
BOXX     MVI   BOXREQ,C' '                                                      
         B     XIT                                                              
*                                                                               
XIT      XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
*LITERALS AND CONSTANTS AND SPOOLT DBC                                *         
***********************************************************************         
         LTORG                                                                  
*                                                                               
       ++INCLUDE DMPRTQC           PRTQ CLASSES                                 
*                                                                               
BLTAB    DC    X'01091119'         WRITE BEFORE LINES 0-3                       
BCTAB    DC    X'89899199A1A9B1'                CHANNELS 0-6                    
         DC    X'B9C1C9D1D9E18B'                CHANNELS 7-12 (13=01)           
*                                                                               
SLTAB    DC    X'010B131B'         WRITE AFTER  LINES 0-3                       
SCTAB    DC    X'8B8B939BA3ABB3'                CHANNELS 0-6                    
         DC    X'BBC3CBD3DBE3'                  CHANNELS 7-12                   
*                                                                               
SPLPRINT DC    C'SPLPRINT'                                                      
*                                                                               
IDM      DS    0XL17                                                            
         DC    X'5A'               CARRIAGE CONTROL                             
         DC    X'0010'             LENGTH                                       
         DC    X'D3ABCA'           INVOKE FORM                                  
         DC    X'00'               FLAG                                         
         DC    X'0000'             SQUENCE #                                    
IDMPGDF  DC    CL8' '              PAGEDEF                                      
         DC    240X'40'                                                         
*                                                                               
         DS    0F                                                               
SPOOLT   DCB   DDNAME=SPLPRINT,MACRF=(PM),DSORG=PS,RECFM=FBM,LRECL=133          
         EJECT                                                                  
***********************************************************************         
*PRINT AREA1 - USE PRAREAD AS DSECT                                   *         
***********************************************************************         
PRAREA1  DS    0D                                                               
         DC    A(REMOTEC)          DEFINE ADCONS                                
         DC    A(BOXAREA)                                                       
         DC    A(SPLAREA)                                                       
         DC    A(FAXINFO)                                                       
         DC    V(REMPQKEY)                                                      
         DC    V(REMPQCIA)                                                      
*                                                                               
         DS    D                   DUB                                          
         DS    CL24                WORK                                         
         DS    2F                  BOXPARA                                      
         DS    6F                  PARA                                         
*                                                                               
         DS    XL1                 WHERE                                        
         DS    XL1                 WHAT                                         
         DS    XL1                 WHICH                                        
         DS    XL3                 SAVEWHERE                                    
         DS    XL1                 REMPQF FIRST BYTE OF 0TTTTT                  
         DS    XL1                 N/D                                          
*                                                                               
LSTRMKEY DS    0F                  THIS MUST STAY WITH NEXT!                    
         DC    XL18'00'            LASTKEY                                      
*                                                                               
         DC    X'01'               BOXCOUNT                                     
         DS    XL7                 REMPQK                                       
         DS    XL2                 REMPQA LAST TWO BYTES OF 0TTTTT              
         DC    X'00'               REMFLAG                                      
         DC    AL1(0)              LASTWIDE                                     
         DC    AL1(0)              LASTOPT                                      
         DC    C' '                ROWTYPE                                      
         DC    C' '                THISROW                                      
         DC    C' '                THISCOL                                      
         DS    C                   THISH                                        
         DS    C                   BYTE                                         
         DS    C                   SAVECOM                                      
         DS    C                   DASH                                         
         DS    C                   NEWBOX                                       
         DS    0D                                                               
*                                                                               
ISPRTACT DC    X'00'               ACTIVITY SWITCH                              
         DS    CL(PLN+1)           SAVEL                                        
         DS    CL(PLN)             SAVER                                        
         DS    CL1                 RE NEEDED IF OPTCD=J                         
         DS    CL(PLN+1)           DUMDUM                                       
         DS    CL(PLN)             DUMR                                         
         DC    CL(PLN)' '          SHADE                                        
         DC    CL(PLN)' '          SHADER                                       
         DC    CL(PLN+1)' '        LASTDUM                                      
         DC    CL(PLN+1)' '        LASTDUMR                                     
         DC    XL(PLN+4)'00'       OPENINFO USED FOR PRINT QUEUE OPEN           
         DC    CL(PLN)' '          SPACES                                       
         EJECT                                                                  
***********************************************************************         
*DCBS REMOTEC AND BOXAREA                                             *         
***********************************************************************         
         DS    0F                                                               
PRNTER   DCB   DDNAME=SYSPRINT,MACRF=(PM),DSORG=PS,RECFM=FBM,LRECL=133          
*                                                                               
         DS    0D                                                               
REMOTEC  DC    80X'00'                                                          
*                                                                               
BOXAREA  DC    8X'00'                                                           
         DC    264C' '                                                          
         DC    CL100' '                                                         
         DC    28X'00'                                                          
         DC    4X'00'                                                           
         DC    A(FLSHAREA)                                                      
         DC    A(0)                WAS V(BLOWUP)                                
         DC    F'132'                                                           
         DC    20X'00'                                                          
         DC    A(PAGEDEF)                                                       
         DC    A(FAXINFO)                                                       
         DC    A(0)                ALTERNATE COLUMNS                            
         DC    A(0)                HOOK                                         
         DC    V(WIDE)                                                          
         DC    264C' '                                                          
         DC    264C' '                                                          
*                                                                               
SPLAREA  DC    24X'00'             OPENINFO BYTES 1-2                           
*                                  GENERATION BYTE 3                            
*                                  DSN DETAILS AT BYTE 5(20)                    
*                                                                               
FAXINFO  DS    0D                  SUPPORT FOR SENDING FAXES                    
         DC    X'00'               STATUS                                       
         DC    X'00'                                                            
         DC    H'0'                SENDER ID NUMBER                             
         DC    CL2' '              AGENCY CODE                                  
         DC    CL5' '              FAX RECORD NUMBER                            
         DC    CL3' '              EXPANSION AREA                               
         DC    10X'00'             SPARE                                        
*                                                                               
         DC    A(0)                A(FAX TELEPHONE NUMBER)                      
         DC    A(0)                A(ATTENTION)                                 
         DC    A(0)                COMMENTS 1                                   
         DC    A(0)                COMMENTS 2                                   
         DC    A(0)                COMMENTS 3                                   
         DC    A(0)                COMMENTS 4                                   
         DC    A(0)                COMMENTS 5                                   
         DC    A(0)                COMMENTS 6                                   
         DC    A(0)                SPARE                                        
         DC    A(0)                SPARE                                        
         DC    A(0)                SPARE                                        
*                                                                               
         DC    C'++DDS SSRR TRN '                                               
         DC    CL58' '                                                          
         DC    CL7' '                                                           
*                                                                               
FLSHAREA DC    (60*PLN)X'00'                                                    
*                                                                               
PAGEDEF  DC    (10*6)X'00'                                                      
*                                                                               
PRAREA1X EQU   *                                                                
         EJECT                                                                  
***********************************************************************         
*PRINT AREA2 - USE PRAREAD AS DSECT                                   *         
***********************************************************************         
PRAREA2  DS    0D                                                               
         DC    A(REMOTEC2)         DEFINE ADCONS                                
         DC    A(BOXAREA2)                                                      
         DC    A(SPLAREA2)                                                      
         DC    A(FAXINFO2)                                                      
         DC    V(REMPQKE2)                                                      
         DC    V(REMPQCI2)                                                      
*                                                                               
         DS    D                   DUB                                          
         DS    CL24                WORK                                         
         DS    2F                  BOXPARA                                      
         DS    6F                  PARA                                         
*                                                                               
         DS    XL1                 WHERE                                        
         DS    XL1                 WHAT                                         
         DS    XL1                 WHICH                                        
         DS    XL3                 SAVEWHERE                                    
         DS    XL1                 REMPQF                                       
         DS    XL1                 N/D                                          
*                                                                               
LSTRMKE2 DS    0F                  THIS MUST STAY WITH NEXT!                    
         DC    XL18'00'            LASTKEY                                      
*                                                                               
         DC    X'01'               BOXCOUNT                                     
         DS    XL7                 REMPQK                                       
         DS    XL2                 REMPQA                                       
         DC    X'00'               REMFLAG                                      
         DC    AL1(0)              LASTWIDE                                     
         DC    AL1(0)              LASTOPT                                      
         DC    C' '                ROWTYPE                                      
         DC    C' '                THISROW                                      
         DC    C' '                THISCOL                                      
         DS    C                   THISH                                        
         DS    C                   BYTE                                         
         DS    C                   SAVECOM                                      
         DS    C                   DASH                                         
         DS    C                   NEWBOX                                       
         DS    0D                                                               
*                                                                               
ISPRTAC2 DC    X'00'               ACTIVITY SWITCH                              
         DS    CL(PLN+1)           SAVEL                                        
         DS    CL(PLN)             SAVER                                        
         DS    CL1                 RE NEEDED IF OPTCD=J                         
         DS    CL(PLN+1)           DUMDUM                                       
         DS    CL(PLN)             DUMR                                         
         DC    CL(PLN)' '          SHADE                                        
         DC    CL(PLN)' '          SHADER                                       
         DC    CL(PLN+1)' '        LASTDUM                                      
         DC    CL(PLN+1)' '        LASTDUMR                                     
         DC    XL(PLN+4)'00'       OPENINFO USED FOR PRINT QUEUE OPEN           
         DC    CL(PLN)' '          SPACES                                       
         EJECT                                                                  
**********************************************************************          
*DCBS REMOTEC AND BOXAREA                                            *          
**********************************************************************          
         DS    0F                                                               
PRNTER2  DCB   DDNAME=SYSPRIN2,MACRF=(PM),DSORG=PS,RECFM=FBM,LRECL=133          
*                                                                               
         DS    0D                                                               
REMOTEC2 DC    80X'00'                                                          
*                                                                               
BOXAREA2 DC    8X'00'                                                           
         DC    264C' '                                                          
         DC    CL100' '                                                         
         DC    28X'00'                                                          
         DC    4X'00'                                                           
         DC    A(FLSHARE2)                                                      
         DC    A(0)                WAS V(BLOWUP)                                
         DC    F'132'                                                           
         DC    20X'00'                                                          
         DC    A(PAGEDEF2)                                                      
         DC    A(FAXINFO2)                                                      
         DC    A(0)                ALTERNATE COLUMNS                            
         DC    A(0)                HOOK                                         
         DC    V(WIDE)                                                          
         DC    264C' '                                                          
         DC    264C' '                                                          
*                                                                               
SPLAREA2 DC    24X'00'             OPENINFO BYTES 1-2                           
*                                  GENERATION BYTE 3                            
*                                  DSN DETAILS AT BYTE 5(20)                    
*                                                                               
FAXINFO2 DS    0D                  SUPPORT FOR SENDING FAXES                    
         DC    X'00'               STATUS                                       
         DC    X'00'                                                            
         DC    H'0'                SENDER ID#                                   
         DC    CL2' '              AGENCY CODE                                  
         DC    CL5' '              FAX RECORD NUMBER                            
         DC    CL3' '              (IN CASE I NEED TO EXPAND)                   
         DC    10X'00'             SPARE                                        
*                                                                               
         DC    A(0)                A(FAX TELEPHONE NUMBER)                      
         DC    A(0)                A(ATTENTION)                                 
         DC    A(0)                COMMENTS 1                                   
         DC    A(0)                COMMENTS 2                                   
         DC    A(0)                COMMENTS 3                                   
         DC    A(0)                COMMENTS 4                                   
         DC    A(0)                COMMENTS 5                                   
         DC    A(0)                COMMENTS 6                                   
         DC    A(0)                SPARE                                        
         DC    A(0)                SPARE                                        
         DC    A(0)                SPARE                                        
*                                                                               
         DC    C'++DDS SSRR TRN '                                               
         DC    CL58' '                                                          
         DC    CL7' '                                                           
*                                                                               
FLSHARE2 DC    (60*PLN)X'00'                                                    
*                                                                               
PAGEDEF2 DC    (10*6)X'00'                                                      
*                                                                               
PRAREA2X EQU   *                                                                
         EJECT                                                                  
***********************************************************************         
*PRTQ ERROR MESSAGES AND DATA DICTIONARY ESCAPE CHARACTERS            *         
***********************************************************************         
         DS    0F                                                               
PQERRS   DS    0XL28                                                            
         DC    X'80',AL2(130),CL25'PRTQ--EOF'                                   
         DC    X'81',AL2(131),CL25'PRTQ--EOF NO PART#1 CIS'                     
         DC    X'82',AL2(132),CL25'PRTQ--EOF NO PART#2 CIS'                     
         DC    X'84',AL2(133),CL25'PRTQ--REPORT TOO BIG'                        
         DC    X'88',AL2(134),CL25'PRTQ--USERID MAX REPORTS'                    
         DC    X'40',AL2(135),CL25'PRTQ--DISK ERROR'                            
         DC    X'41',AL2(136),CL25'PRTQ--FORMAT ERR ON OPEN'                    
         DC    X'42',AL2(137),CL25'PRTQ--FORMAT ERR ON CLOSE'                   
PQERRSX  DC    X'00',AL2(138),CL25'PRTQ--UNKNOWN ERROR'                         
*                                                                               
TRTDD    DC    XL16'00000000000000000000000000000000'  00-0F                    
         DC    XL16'00000000000000000000000000000000'  10-1F                    
         DC    XL16'03030404040401040303040404040000'  20-2F                    
         DC    XL16'00000000000000000000000000000000'  30-3F                    
         DC    XL16'00000000000000000000000000000000'  40-4F                    
         DC    XL16'00000000000000000000000000000000'  50-5F                    
         DC    XL16'00000000000000000000000000000000'  60-6F                    
         DC    XL16'00000000000000000000000000000000'  70-7F                    
         DC    XL16'00000000000000000000000000000000'  80-8F                    
         DC    XL16'00000000000000000000000000000000'  90-9F                    
         DC    XL16'00000000000000000000000000000000'  A0-AF                    
         DC    XL16'00000000000000000000000000000000'  B0-BF                    
         DC    XL16'00000000000000000000000000000000'  C0-CF                    
         DC    XL16'00000000000000000000000000000000'  D0-DF                    
         DC    XL16'00000000000000000000000000000000'  E0-EF                    
         DC    XL16'00000000000000000000000000000000'  F0-FF                    
         EJECT                                                                  
***********************************************************************         
*VALID PRINTABLE CHARACTERS INCLUDING BOX CHARACTERS                  *         
*                                                                     *         
*BOX_CR  8F    INTERSECTION                                           *         
*BOX_BL  AB    BOTTOM LEFT CORNER                                     *         
*BOX_TL  AC    TOP LEFT CORNER                                        *         
*BOX_BR  BB    BOTTOM RIGHT CORNER                                    *         
*BOX_TR  BC    TOP RIGHT CORNER                                       *         
*BOX_HO  BF    HORIZONTAL                                             *         
*BOX_BT  CB    BOTTOM TEE                                             *         
*BOX_TT  CC    TOP TEE                                                *         
*BOX_LT  EB    LEFT TEE                                               *         
*BOX_RT  EC    RIGHT TEE                                              *         
*BOX_VE  FA    VERTICAL                                               *         
***********************************************************************         
VALCHRS  DC    XL16'40404040404040404040404040404040'  00-0F                    
         DC    XL16'40404040404040404040404040404040'  10-1F                    
         DC    XL16'40404040404040404040404040404040'  20-2F                    
         DC    XL16'40404040404040404040404040404040'  30-3F                    
         DC    XL16'404042404040404040404A4B4C4D4E4F'  40-4F                    
         DC    XL16'504040404040404040405A5B5C5D5E5F'  50-5F                    
         DC    XL16'606140404040404040406A6B6C6D6E6F'  60-6F                    
         DC    XL16'404040404040404040797A7B7C7D7E7F'  70-7F                    
         DC    XL16'40818283848586878889404040408E8F'  80-8F                    
         DC    XL16'4091929394959697989940404040409F'  90-9F                    
         DC    XL16'40A1A2A3A4A5A6A7A8A9ABAC40404040'  A0-AF                    
         DC    XL16'40404040404040404040BBBC404040BF'  B0-BF                    
         DC    XL16'C0C1C2C3C4C5C6C7C8C940CBCC404040'  C0-CF                    
         DC    XL16'D0D1D2D3D4D5D6D7D8D9404040404040'  D0-DF                    
         DC    XL16'E040E2E3E4E5E6E7E8E940EBEC404040'  E0-EF                    
         DC    XL16'F0F1F2F3F4F5F6F7F8F9FAFB40404040'  F0-FF                    
         EJECT                                                                  
***********************************************************************         
*FORMAT LOOK UP TABLE. ARRANGED TO REDUCE SEARCH LENGTH.              *         
*THE DOTTED ENTRIES (D) HAVE BEEN CHANGED TO BE THE SAME AS SOLID.    *         
*                                                                     *         
*+0(1)   ROW VALUE, T=TOP,M=MID,D=DOTTED MID,-=INSIDE BOX,B=BOTTOM    *         
*+1(1)   COLUMN VALUE,L=LEFT,O=OPEN LEFT,C=CENTER VERTICAL,           *         
*        D=DOTTED CENTER,-=INSIDE BOX,R=RIGHT,                        *         
*        BLANK=OUTSIDE BOX,V=STANDALONE VERTICAL                      *         
*+2(1)   BOX CHARACTER FOR ROW/COLUMN INTERSECTION                    *         
***********************************************************************         
BOXTABLE DS    0XL3                                                             
         DC    C'--',X'40'                                                      
         DC    C'-C',AL1(BOX_VE)   VERTICAL                                     
         DC    C'- ',X'40'                                                      
         DC    C'-L',AL1(BOX_VE)   VERTICAL                                     
         DC    C'-R',AL1(BOX_VE)   VERTICAL                                     
*                                                                               
         DC    C'M-',AL1(BOX_HO)   HORIZONTAL                                   
         DC    C'MC',AL1(BOX_CR)   INTERSECTION                                 
         DC    C'M ',X'40'                                                      
         DC    C'ML',AL1(BOX_LT)   LEFT TEE                                     
         DC    C'MR',AL1(BOX_RT)   RIGHT TEE                                    
*                                                                               
         DC    C'T-',AL1(BOX_HO)   HORIZONTAL                                   
         DC    C'TC',AL1(BOX_TT)   TOP TEE                                      
         DC    C'T ',X'40'                                                      
         DC    C'TL',AL1(BOX_TL)   TOP LEFT CORNER                              
         DC    C'TR',AL1(BOX_TR)   TOP RIGHT CORNER                             
*                                                                               
         DC    C'B-',AL1(BOX_HO)   HORIZONTAL                                   
         DC    C'BC',AL1(BOX_BT)   BOTTOM TEE                                   
         DC    C'B ',X'40'                                                      
         DC    C'BL',AL1(BOX_BL)   BOTTOM LEFT CORNER                           
         DC    C'BR',AL1(BOX_BR)   BOTTOM RIGHT CORNER                          
*                                                                               
         DC    C'-V',AL1(BOX_VE)   VERTICAL                                     
         DC    C'MV',AL1(BOX_VE)   VERTICAL                                     
         DC    C'TV',AL1(BOX_VE)   VERTICAL                                     
         DC    C'BV',AL1(BOX_VE)   VERTICAL                                     
*                                                                               
         DC    C'-O',X'40'                                                      
         DC    C'MO',AL1(BOX_HO)   HORIZONTAL                                   
         DC    C'TO',AL1(BOX_HO)   HORIZONTAL                                   
         DC    C'BO',AL1(BOX_HO)   HORIZONTAL                                   
*                                                                               
         DC    C'-D',AL1(BOX_VE)   VERTICAL DOTTED            (X'FB')           
         DC    C'D-',AL1(BOX_HO)   HORIZONTAL                                   
         DC    C'MD',AL1(BOX_CR)   MIDDLE ROW/VERTICAL DOTTED (X'8E')           
         DC    C'DC',AL1(BOX_CR)   INTERSECTION                                 
         DC    C'D ',X'40'                                                      
         DC    C'DL',AL1(BOX_LT)   LEFT TEE                                     
         DC    C'DR',AL1(BOX_RT)   RIGHT TEE                                    
         DC    C'DV',AL1(BOX_VE)   VERTICAL                                     
         DC    C'TD',AL1(BOX_TT)   TOP ROW/VERTICAL DOTTED    (X'CE')           
         DC    C'BD',AL1(BOX_BT)   BOTTOM ROW/VERTICAL DOTTED (X'CD')           
         DC    C'DD',AL1(BOX_CR)   DOTTED INTERSECTION        (X'CE')           
*                                                                               
         DC    X'FF',C'  '                                                      
         EJECT                                                                  
***********************************************************************         
*COLUMN CHANGE TABLE                                                  *         
*                                                                     *         
*+0(1)   OLD COLUMN VALUE, L,O,C,D,-,R,BLANK,V(,X)                    *         
*+1(1)   NEW COLUMN VALUE, L,O,C,D,-,R,BLANK,V,X                      *         
*+2(2)   REQUIRED ROW/COLUMN CHARS IF MID ROW                         *         
*        IF COLUMN CHAR IS D, REPLACE WITH ROWTYPE IF NOT D           *         
*+4(2)   REQUIRED ROW/COLUMN CHARS IF NOT MID ROW                     *         
*+6(1)   Y=HORIZONTAL TO LEFT NEEDED IF NOT MID ROW                   *         
*        O/C=IF POSSIBLE INTERNAL BOX TOP/BOTTOM LEFT                 *         
*+7(1)   Y=HORIZONTAL TO RIGHT NEEDED IF NOT MID ROW                  *         
*        O/C=IF POSSIBLE INTERNAL BOX TOP/BOTTOM RIGHT                *         
***********************************************************************         
COLCHTAB DS    0XL8                                                             
         DC    C'LO',C'BL-L  '                                                  
         DC    C'OL',C'TL-L  '                                                  
         DC    C'LC',C'MCMRY '                                                  
         DC    C'CL',C'MCMRY '                                                  
         DC    C'LD',C'MCMRY '                                                  
         DC    C'DL',C'MCMRY '                                                  
         DC    C'L-',C'BCBRC '                                                  
         DC    C'-L',C'TCTRO '                                                  
         DC    C'LR',C'MCMCYY'                                                  
         DC    C'RL',C'MCMCYY'                                                  
         DC    C'L ',C'BLBLC '                                                  
         DC    C' L',C'TLTLO '                                                  
         DC    C'LV',C'MLML Y'                                                  
         DC    C'VL',C'MLML Y'                                                  
         DC    C'LX',C'BLB   '                                                  
         DC    C'XL',C'TLT   '                                                  
         DC    C'OC',C'TCTRY '                                                  
         DC    C'CO',C'MCBRY '                                                  
         DC    C'OD',C'TCTRY '                                                  
         DC    C'DO',C'BCBRY '                                                  
         DC    C'O-',C'BOBOC '                                                  
         DC    C'-O',C'TOTOO '                                                  
         DC    C'OR',C'TCTRY '                                                  
         DC    C'RO',C'BCBRY '                                                  
         DC    C'O ',C'BOBOC '                                                  
         DC    C' O',C'TOTOO '                                                  
         DC    C'OV',C'TLTL R'                                                  
         DC    C'VO',C'BLBL R'                                                  
         DC    C'OX',C'BOB   '                                                  
         DC    C'XO',C'TOT   '                                                  
         DC    C'CD',C'MC-C  '                                                  
         DC    C'DC',C'MC-C  '                                                  
         DC    C'C-',C'BCBCYY'                                                  
         DC    C'-C',C'TCTCYY'                                                  
         DC    C'CR',C'MCML Y'                                                  
         DC    C'RC',C'MCML Y'                                                  
         DC    C'C ',C'BCBCYY'                                                  
         DC    C' C',C'TCTCYY'                                                  
         DC    C'CV',C'MCMCYY'                                                  
         DC    C'VC',C'MCMCYY'                                                  
         DC    C'CX',C'BCB   '                                                  
         DC    C'XC',C'TCT   '                                                  
         DC    C'D-',C'BDBDYY'                                                  
         DC    C'-D',C'TDTDYY'                                                  
         DC    C'DR',C'MCML Y'                                                  
         DC    C'RD',C'MCML Y'                                                  
         DC    C'D ',C'BDBDYY'                                                  
         DC    C' D',C'TDTDYY'                                                  
         DC    C'DV',C'MCMCYY'                                                  
         DC    C'VD',C'MCMCYY'                                                  
         DC    C'DX',C'BDB   '                                                  
         DC    C'XD',C'TDT   '                                                  
         DC    C'-R',C'TCTL O'                                                  
         DC    C'R-',C'BCBL C'                                                  
         DC    C'- ',C'B-B-YY'                                                  
         DC    C' -',C'T-T-YY'                                                  
         DC    C'-V',C'TCTCYY'                                                  
         DC    C'V-',C'BCBCYY'                                                  
         DC    C'-X',C'----  '                                                  
         DC    C'X-',C'----  '                                                  
         DC    C'R ',C'BRBR C'                                                  
         DC    C' R',C'TRTR O'                                                  
         DC    C'RV',C'MRMRY '                                                  
         DC    C'VR',C'MRMRY '                                                  
         DC    C'RX',C'BRB   '                                                  
         DC    C'XR',C'TRT   '                                                  
         DC    C' V',C'-C-C  '                                                  
         DC    C'V ',C'----  '                                                  
*                                                                               
         DC    X'FFFF',C'----  '                                                
         EJECT                                                                  
***********************************************************************         
*DSECT TO COVER PRAREA 1 OR 2                                         *         
***********************************************************************         
PRAREAD  DSECT                                                                  
*                                                                               
AREMOTEC DS    A                   DEFINE ADCONS                                
ABOXAREA DS    A                                                                
ASPLAREA DS    A                                                                
AFAXINFO DS    A                                                                
VREMPQKY DS    V                                                                
VREMPQCI DS    V                                                                
*                                                                               
DUB      DS    D                                                                
WORK     DS    CL24                                                             
BOXPARA  DS    2F                                                               
PARA     DS    6F                                                               
*                                                                               
WHERE    DS    XL1                                                              
WHAT     DS    XL1                                                              
WHICH    DS    XL1                                                              
SAVWHERE DS    XL3                                                              
REMPQF   DS    XL1                                                              
         DS    XL1                                                              
*                                                                               
         DS    0F                  LSTRMKEY THIS MUST STAY WITH NEXT!           
LASTKEY  DC    XL18'00'                                                         
*                                                                               
BOXCOUNT DC    X'01'                                                            
REMPQK   DS    XL7                                                              
REMPQA   DS    XL2                                                              
REMFLAG  DC    X'00'                                                            
LASTWIDE DC    AL1(0)                                                           
LASTOPT  DC    AL1(0)                                                           
ROWTYPE  DC    C' '                                                             
THISROW  DC    C' '                                                             
THISCOL  DC    C' '                                                             
THISH    DS    C                                                                
BYTE     DS    C                                                                
SAVECOM  DS    C                                                                
DASH     DS    C                                                                
NEWBOX   DS    C                                                                
         DS    0D                                                               
         DC    X'00'               ISPRTACT ACTIVITY SWITCH                     
PLN      EQU   132                                                              
SAVEL    DS    CL(PLN+1)                                                        
SAVER    DS    CL(PLN)                                                          
         DS    CL1                 BYTE BEFORE NEEDED IF OPTCD=J                
DUMDUM   DS    CL(PLN+1)                                                        
DUMR     DS    CL(PLN)                                                          
SHADE    DC    CL(PLN)' '                                                       
SHADER   DC    CL(PLN)' '                                                       
LASTDUM  DC    CL(PLN+1)' '                                                     
LASTDUMR DC    CL(PLN+1)' '                                                     
OPENINFO DC    XL(PLN+4)'00'       USED FOR PRINT QUEUE OPEN                    
SPACES   DC    CL(PLN)' '                                                       
         EJECT                                                                  
***********************************************************************         
*DUMMY DCB USED FOR REGULAR PRINTING                                  *         
***********************************************************************         
         DS    0F                                                               
PRNTER0  DCB   DDNAME=SYSPRINT,MACRF=(PM),DSORG=PS,RECFM=FBM,LRECL=133          
*                                                                               
         DS    0D                                                               
         DC    80X'00'             REMOTEC                                      
*                                                                               
         DC    8X'00'              BOXAREA                                      
         DC    264C' '                                                          
         DC    CL100' '                                                         
         DC    28X'00'                                                          
         DC    4X'00'                                                           
         DS    A                                                                
         DC    A(0)                WAS V(BLOWUP)                                
         DC    F'132'                                                           
         DC    20X'00'                                                          
         DS    A                                                                
         DS    A                                                                
         DC    A(0)                ALTERNATE COLUMNS                            
         DC    A(0)                HOOK                                         
         DS    V                                                                
         DC    264C' '                                                          
         DC    264C' '                                                          
*                                                                               
         DC    24X'00'             SPLAREA OPENINFO BYTES 1-2                   
*                                  GENERATION BYTE 3                            
*                                  DSN DETAILS AT BYTE 5(20)                    
*                                                                               
         DS    0D                  SUPPORT FOR SENDING FAXES                    
         DC    X'00'               STATUS                                       
         DC    X'00'                                                            
         DC    H'0'                SENDER ID#                                   
         DC    CL2' '              AGENCY CODE                                  
         DC    CL5' '              FAX RECORD NUMBER                            
         DC    CL3' '              (IN CASE I NEED TO EXPAND)                   
         DC    10X'00'             SPARE                                        
*                                                                               
         DC    A(0)                A(FAX TELEPHONE NUMBER)                      
         DC    A(0)                A(ATTENTION)                                 
         DC    A(0)                COMMENTS 1                                   
         DC    A(0)                COMMENTS 2                                   
         DC    A(0)                COMMENTS 3                                   
         DC    A(0)                COMMENTS 4                                   
         DC    A(0)                COMMENTS 5                                   
         DC    A(0)                COMMENTS 6                                   
         DC    A(0)                SPARE                                        
         DC    A(0)                SPARE                                        
         DC    A(0)                SPARE                                        
*                                                                               
         DC    C'++DDS SSRR TRN '                                               
         DC    CL58' '                                                          
         DC    CL7' '                                                           
*                                                                               
         DC    (60*PLN)X'00'       FLSHAREA                                     
         EJECT                                                                  
***********************************************************************         
*DSECTS                                                               *         
***********************************************************************         
*DDBIGBOX                                                                       
       ++INCLUDE DDBIGBOX                                                       
                                                                                
*DDBOXEQUS                                                                      
       ++INCLUDE DDBOXEQUS                                                      
                                                                                
*DDFAXINFOD                                                                     
       ++INCLUDE DDFAXINFOD                                                     
                                                                                
*DDREMOTED                                                                      
       ++INCLUDE DDREMOTED                                                      
                                                                                
*DMPRTQL                                                                        
       ++INCLUDE DMPRTQL                                                        
                                                                                
*DMPRTQK                                                                        
       ++INCLUDE DMPRTQK                                                        
                                                                                
*DMPRTQD                                                                        
       ++INCLUDE DMPRTQD                                                        
                                                                                
*DDLOGOD                                                                        
       ++INCLUDE DDLOGOD                                                        
                                                                                
*DDMASTD                                                                        
       ++INCLUDE DDMASTD                                                        
                                                                                
*FASSBOFF                                                                       
       ++INCLUDE FASSBOFF                                                       
                                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'007DDPRINT   07/28/20'                                      
         END                                                                    

*          DATA SET AXROUTGB   AT LEVEL 216 AS OF 05/29/19                      
*CATALP AXROUTGB                                                                
* IN UPDATE MODE, DXAXREC IS CHANGE OR ADD WITH RECOVERY HEADER!                
* DXACPYB IS THE COPY                                                           
                                                                                
         TITLE 'EXTRACT ROUTINES FOR AXTRACT'                                   
                                                                                
***********************************************************************         
* LEVEL CHANGE COMMENTS                                               *         
* ---------------------                                               *         
* JSHA 22MAY18 213 (SPEC-17676) SAP WORKCODE TO NEW MEDIA TYPE        *         
* JSHA 01AUG18 214 (SPEC-21582) FIX NETWORK FIELD FOR REP POSTINGS    *         
* MNAS 30NOV18 215 (SPEC-12263) DS CLEARANCE & CURRENCY CONVERSION    *         
* JSHA 28MAR19 216 (SPEC-32154) FIX NET PAYABLE IN NETWORK FIELD      *         
***********************************************************************         
                                                                                
AXROUTG  CSECT                                                                  
         ENTRY AXACCT              ACCOUNT RECORD                               
         ENTRY AXTRNS              TRANSACTION RECORD                           
         ENTRY AXTOTS              TRANSACTION RECORD                           
         ENTRY AXFRH               FILE RECON HEADER REC                        
         PRINT NOGEN                                                            
*                                                                               
EQXIT    CR    RB,RB                                                            
         J     EXIT                                                             
*                                                                               
NEQXIT   LTR   RB,RB                                                            
*                                                                               
EXIT     XIT1                                                                   
         EJECT                                                                  
*===============================================================                
* AXACCT - EXTRACT NAMES FROM ACCOUNT RECORDS                                   
*                                                                               
* AL4 A(WORKD)                                                                  
* AL4 A(EXTRACT RECORD)                                                         
* AL4 A(ACCFILE RECORD)                                                         
*===============================================================                
                                                                                
AXACCT   NMOD1 0,*AXACCT*                                                       
         LR    R9,RB                                                            
         AHI   R9,4096                                                          
         USING AXACCT+4096,R9                                                   
*                                                                               
         L     RC,0(R1)                                                         
         USING WORKD,RC                                                         
*                                                                               
         L     RA,AADDRESS                                                      
         USING ADDRESSD,RA                                                      
*                                                                               
         ST    R1,APARM                                                         
         MVC   PARM(16),0(R1)      EXTRACT PARAMETER LIST                       
         LM    R2,R3,4(R1)                                                      
*                                                                               
         L     RE,=A(MXTRT)                                                     
         ST    RE,AMXTRT                                                        
*                                                                               
         LA    R2,0(R2)            CLEAR HOB                                    
         USING AXGMACC,R2          R2=A(EXTRACT RECORD)                         
         LA    R3,0(R3)                                                         
         USING ACTKEY,R3           R3=A(ACCFILE RECORD)                         
*                                                                               
         XC    AXGMLEN,AXGMLEN     RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   AXGMLEN(2),=Y(AXGMACCX-AXGMACC)                                  
         MVI   AXGMACTN,C'A'                                                    
*                                                                               
         CLI   PARM+4,C'L'         TEST LOAD MODE                               
         BE    AXA2                YES- ALL RECORDS ARE ADDS                    
*                                                                               
         L     RE,VDXBLOCK         A(EXTRACT CONTROL DATA BLOCK)                
         USING DXBLOCKD,RE                                                      
         CLI   DXACTION,C'C'       ELSE TEST UPDATE ACTION                      
         BNE   AXA2                                                             
         MVI   AXGMACTN,C'C'                                                    
         DROP  RE                                                               
                                                                                
AXA2     MVI   AXGMSEQ-1,MYMXTRTQ                                               
         MVI   AXGMGIN-1,MYMXTRTQ                                               
         MVI   AXGMMSTR-1,MYMXTRTQ                                              
         MVI   AXGMACCD-1,MYMXTRTQ                                              
         MVI   AXGMACNM-1,MYMXTRTQ                                              
         MVI   AXGMCAC-1,MYMXTRTQ                                               
         MVI   AXGMRAC-1,MYMXTRTQ                                               
         MVI   AXGMACCX-1,MYMXTRTQ                                              
*                                                                               
         BRAS  RE,GETGIN                                                        
         CLI   PARM+4,C'L'         TEST LOAD MODE                               
         BE    *+8                 YES                                          
         LA    R3,28(R3)           POINT BEYOND RECOVERY HEADER                 
*                                                                               
         CLI   ACTKACT,C' '        TEST ACCOUNT PRESENT                         
         JH    AXA10               YES - EXTRACT ACCOUNT NAME                   
*                                                                               
AXASKIP  MVC   DMCB(16),PARM       RESTORE CALLING PARMS                        
         MVI   DMCB+8,X'FF'        TELL CONTROLLER NO RECORD                    
         J     EXIT                                                             
*                                                                               
AXA10    L     RE,=A(AXGMACCQ)                                                  
         MVC   AXGMTYPE,0(RE)                                                   
*                                                                               
         MVC   AXGMACCD,ACTKUNT    MOVE U/L/ACCT                                
*                                                                               
*&&DO                                                                           
* - REMOVING PER JEANNE ON 20130409                                             
*                                                                               
         CLC   =C'SX',ACTKUNT                                                   
         JE    AXASKIP                                                          
*&&                                                                             
*                                                                               
         MVC   AXGMMSTR,=C'VE'                                                  
         CLC   =C'SJ',ACTKUNT                                                   
         JNE   AXA20                                                            
         MVC   AXGMMSTR,=C'PR'                                                  
         CLI   ACTKACT+3,C' '      TEST PRODUCT PRESENT                         
         JNE   AXA20               YES                                          
         MVC   AXGMMSTR,=C'CL'                                                  
*------->                                                                       
*------->                                                                       
         LA    R5,ACTRFST                                                       
         MVI   ELCODE,PPRELQ                                                    
         BRAS  RE,FRSTEL                                                        
         JE    *+6                                                              
         DC    H'0'                                                             
         CLC   =C'SS',PPRGAOFF-PPREL(R5)                                        
         JNE   AXA20                                                            
         MVC   SKIPCLT,ACTKACT                                                  
         J     AXASKIP                                                          
SKIPCLT  DC    CL3' '                                                           
         DC    X'00'                                                            
*------->                                                                       
*------->                                                                       
*                                                                               
AXA20    CLC   SKIPCLT,ACTKACT     SKIPPING THIS CLIENT                         
         JE    AXASKIP                                                          
*                                                                               
         TM    ACTRSTAT,ACTSDELT+ACTSCLOS                                       
         JNZ   AXASKIP                                                          
*                                                                               
         BRAS  RE,SETLDGR          SET LEDGER TYPE                              
*                                                                               
         CLC   =C'SV',ACTKUNT      FOR SV/SX ONLY IF NOT LOCKED                 
         JE    *+14                                                             
         CLC   =C'SX',ACTKUNT                                                   
         JNE   AXA22                                                            
         TM    ACTRSTAT,ACTSLOCK                                                
         JO    AXASKIP                                                          
         J     AXA30                                                            
*                                                                               
AXA22    MVI   ELCODE,RSTELQ                                                    
         LA    R5,ACTRFST                                                       
         BRAS  RE,FRSTEL                                                        
         JNE   AXA30                                                            
*                                                                               
         CLI   LDGPQSTU,C'Y'                                                    
         JE    AXA24                                                            
         CLC   =C'SW',ACTKUNT                                                   
         JE    AXA24                                                            
         J     AXA26                                                            
*                                                                               
AXA24    CLC   =X'B00101',RSTTDATE-RSTEL(R5)                                    
         JH    AXASKIP                                                          
         J     AXA30                                                            
*                                                                               
AXA26    CLC   =C'SY',ACTKUNT                                                   
         JNE   AXA30                                                            
         CLC   =X'B20101',RSTTDATE-RSTEL(R5)                                    
         JH    AXASKIP                                                          
         J     AXA30                                                            
*                                                                               
AXA30    AP    SEQNUM,=P'1'                                                     
         OI    SEQNUM+5,X'0F'                                                   
         UNPK  AXGMSEQ,SEQNUM                                                   
         MVC   AXGMACNM,MYSPACES                                                
*                                                                               
         MVI   ELCODE,NAMELQ                                                    
         LA    R5,ACTRFST          R5=A(FIRST ELEMENT)                          
         BRAS  RE,FRSTEL           GET ELEMENT FROM RECORD                      
         JNE   AXA40                                                            
*                                                                               
         LLC   RF,NAMLN-NAMEL(R5)                                               
         AHI   RF,-3                                                            
         JM    AXA40                                                            
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   AXGMACNM(0),NAMEREC-NAMEL(R5)                                    
*                                                                               
         L     RF,AMXTRT                                                        
         TR    AXGMACNM,0(RF)                                                   
*                                                                               
*===============================================================                
* FOR CLIENTS AND PRODUCTS, EXTRACT RECEIVABLE AND COST A/C'S                   
*===============================================================                
                                                                                
AXA40    CLI   ACTKACT,C' '           TEST CLIENT PRESENT                       
         JNH   EXIT                   NO - EXIT                                 
         CLI   ACTKACT+6,C' '         TEST JOB                                  
         JH    EXIT                   YES - EXIT                                
                                                                                
* CLIENT OR PRODUCT - GET ACCOUNT CODES                                         
                                                                                
         LA    R5,ACTRFST          R5=A(FIRST ELEMENT)                          
         SR    R0,R0                                                            
*                                                                               
         MVI   ELCODE,PPRELQ       PRODUCTION PROFILE ELEM                      
         LA    R5,ACTRFST                                                       
         BRAS  RE,FRSTEL                                                        
         JNE   EXIT                                                             
*                                                                               
         USING PPRELD,R5                                                        
         MVC   AXGMRAC,PPRRECVA    RECVLBL ACCOUNT (NO CUL)                     
         MVC   AXGMCAC,PPRCOSTA    COSTING ACCOUNT                              
         J     EXIT                                                             
         DROP  R2,R3,R5                                                         
         DROP  R9,RB                                                            
         LTORG                                                                  
         EJECT                                                                  
*===============================================================                
* AXTOTS - PUT OUT TOTAL RECORD                                                 
*                                                                               
* AL4 A(WORKD)                                                                  
* AL4 A(EXTRACT RECORD)                                                         
*===============================================================                
                                                                                
AXTOTS   NMOD1 0,*AXTOTS*                                                       
         LR    R9,RB                                                            
         AHI   R9,4096                                                          
         USING AXACCT+4096,R9                                                   
*                                                                               
         L     RC,0(R1)                                                         
         USING WORKD,RC                                                         
*                                                                               
         L     RA,AADDRESS                                                      
         USING ADDRESSD,RA                                                      
*                                                                               
         ST    R1,APARM                                                         
         MVC   PARM(16),0(R1)      EXTRACT PARAMETER LIST                       
         L     R2,4(R1)                                                         
*                                                                               
         L     RE,=A(MXTRT)                                                     
         ST    RE,AMXTRT                                                        
*                                                                               
         CP    SEQNUM,=P'0'        TEST NO OUTPUT RECORDS                       
         JNE   AXTOT2                                                           
         MVC   DMCB(16),PARM       RESTORE PARMS                                
         MVI   DMCB+8,X'FF'        TELL CONTROLLER TO SKIP REC                  
         J     EXIT                                                             
*                                                                               
AXTOT2   LA    R2,0(R2)            CLEAR HOB                                    
         USING AXGTTOT,R2                                                       
*                                                                               
         MVC   0(2,R2),=Y(AXGTTOTX-AXGTTOT) SET RECLEN                          
*                                                                               
         MVI   AXGTDRS-1,MYMXTRTQ                                               
         MVI   AXGTCRS-1,MYMXTRTQ                                               
         MVI   AXGTRECS-1,MYMXTRTQ                                              
         MVI   AXGTTOTX-1,MYMXTRTQ                                              
*                                                                               
         L     RE,=A(AXGMTOTQ)                                                  
         MVC   AXGTTYPE,0(RE)                                                   
*                                                                               
         ZAP   DUB,TOTALDR                                                      
         BRAS  RE,TOTCVDP                                                       
         MVC   AXGTDRS,P16                                                      
*                                                                               
         ZAP   DUB,TOTALCR                                                      
         BRAS  RE,TOTCVDP                                                       
         MVC   AXGTCRS,P16                                                      
*                                                                               
         EDIT  (P6,SEQNUM),(8,AXGTRECS),ALIGN=LEFT,ZERO=NOBLANK                 
         J     EXIT                                                             
*                                                                               
TOTCVDP  EDIT  (P8,DUB),P16,2,FLOAT=-,COMMAS=NO,ZERO=NOBLANK,          X        
               ALIGN=LEFT                                                       
         BR    RE                                                               
         LTORG                                                                  
         EJECT                                                                  
*===============================================================                
* AXFRH - CREATE HEADER FOR FILE RECON RUN                                      
*                                                                               
* AL4 A(WORKD)                                                                  
* AL4 A(EXTRACT RECORD)                                                         
*===============================================================                
                                                                                
AXFRH    NMOD1 0,*AXHDR*                                                        
         LR    R9,RB                                                            
         AHI   R9,4096                                                          
         USING AXACCT+4096,R9                                                   
*                                                                               
         L     RC,0(R1)                                                         
         USING WORKD,RC                                                         
*                                                                               
         L     RA,AADDRESS                                                      
         USING ADDRESSD,RA                                                      
*                                                                               
         ST    R1,APARM                                                         
         MVC   PARM(16),0(R1)      EXTRACT PARAMETER LIST                       
         L     R2,4(R1)                                                         
*                                                                               
         L     RE,=A(MXTRT)                                                     
         ST    RE,AMXTRT                                                        
*                                                                               
         LA    R2,0(R2)            CLEAR HOB                                    
         USING AXGMFRH,R2                                                       
*                                                                               
         MVC   0(2,R2),=Y(AXGMFRHX-AXGMFRH) SET RECLEN                          
*                                                                               
         MVI   AXGMFTY-1,MYMXTRTQ                                               
         MVI   AXGMFACT-1,MYMXTRTQ                                              
         MVI   AXGMFDT-1,MYMXTRTQ                                               
         MVI   AXGMFTM-1,MYMXTRTQ                                               
         MVI   AXGMFNM-1,MYMXTRTQ                                               
         MVI   AXGMFSDT-1,MYMXTRTQ                                              
         MVI   AXGMFEDT-1,MYMXTRTQ                                              
         MVI   AXGMFRHX-1,MYMXTRTQ                                              
*                                                                               
         L     RE,=A(AXGMFRHQ)                                                  
         MVC   AXGMFTY,0(RE)                                                    
*                                                                               
         L     RE,VDXBLOCK         A(EXTRACT CONTROL DATA BLOCK)                
         USING DXBLOCKD,RE                                                      
*                                                                               
         MVC   AXGMFNM(19),=C'FILE RECONCILIATION'                              
         MVC   AXGMFSDT,DXUSER                                                  
         MVC   AXGMFEDT,DXUSER+6                                                
         DROP  RE                                                               
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
*=========================================================                      
* AXTRNC - EXTRACT TRANSACTION DETAILS                                          
* AL4 A(WORK AREA)                                                              
* AL4 A(EXTRACT RECORD)                                                         
* AL4 A(ACCFILE RECORD)                                                         
*=========================================================                      
*                                                                               
AXTRNS   NMOD1 0,*AXTRNS*                                                       
*                                                                               
         LR    R9,RB                                                            
         AHI   R9,4096                                                          
         USING AXTRNS+4096,R9                                                   
*                                                                               
         L     RC,0(R1)                                                         
         USING WORKD,RC                                                         
*                                                                               
         L     RA,AADDRESS                                                      
         USING ADDRESSD,RA                                                      
*                                                                               
         ST    R1,APARM                                                         
         MVC   PARM(16),0(R1)      EXTRACT PARAMETER LIST                       
*                                                                               
         L     R2,4(R1)                                                         
         LA    R2,0(R2)            CLEAR HOB                                    
         L     R6,12(R1)           SXDTABD                                      
         LA    R6,0(R6)            CLEAR HOB                                    
         USING AXG$TRN,R2          R2=A(EXTRACT RECORD)                         
         USING SXDTABD,R6          R6=A(EXTRACT SYSTEM TABLE ENTRY)             
*                                                                               
         XC    AXG$LEN,AXG$LEN                                                  
         MVC   AXG$LEN(2),=Y(AXG$TRNX-AXG$TRN)                                  
         MVC   AXG$TYPE,AXGMTRNQ                                                
         MVI   AXG$ACTN,C'A'                                                    
         CLI   PARM+4,C'L'         TEST LOAD MODE                               
         BE    AXT005              YES- ALL RECORDS ARE ADDS                    
                                                                                
*============================================================                   
* UPDATE MODE - SKIP ADDS THAT ARE IN DRAFT STATUS                              
* SKIP ADD IF IT IS IN DRAFT STATUS                                             
* SKIP CHG IF IT IS IN DRAFT STATUS  AND                                        
* SKIP COPY/CHG IF COPY IS NOT IN DRAFT STATUS                                  
*============================================================                   
                                                                                
         L     R3,PARM+8           POINT TO ADD OR CHG RECORD                   
         LA    R3,28(R3)                                                        
         USING TRNRECD,R3                                                       
*                                                                               
         TM    TRNRSTAT,TRNSDRFT   IF IT'S DRAFT                                
         JO    AXTSKIP             SKIP IT                                      
*                                                                               
         L     RE,VDXBLOCK         R7=A(EXTRACT CONTROL DATA BLOCK)             
         USING DXBLOCKD,RE                                                      
         CLI   DXACTION,C'C'       TEST ACTION IS CHANGE                        
         JNE   AXT005              NO - GO PROCESS ADD                          
**NOP**  MVI   AXG$ACTN,C'C'       DRAFT --> LIVE IS AN ADD!                    
                                                                                
         L     R3,DXACPYB          POINT TO COPY RECORD                         
         LA    R3,28(R3)                                                        
         USING TRNRECD,R3                                                       
         DROP  RE                                                               
*                                                                               
         TM    TRNRSTAT,TRNSDRFT   IF COPY IS DRAFT                             
         JO    AXT005              PROCESS THIS TRANSACTION                     
*                                                                               
AXTSKIP  MVC   DMCB(16),PARM       RESTORE PARMS                                
         MVI   DMCB+8,X'FF'        TELL CONTROLLER TO SKIP REC                  
         J     EXIT                                                             
                                                                                
*======================================================                         
* PUT DELIMITER AFTER EACH FIELD                                                
*======================================================                         
                                                                                
AXT005   LA    R1,AXTRNTAB                                                      
         LA    R0,(AXTRNTBX-AXTRNTAB)/L'AXTRNTAB                                
*                                                                               
AXT010   LH    RE,0(R1)            GET DSPL TO DELIM LOCATION                   
         AR    RE,R2               POINT TO IT IN RECORD                        
         MVI   0(RE),MYMXTRTQ                                                   
         LA    R1,L'AXTRNTAB(R1)                                                
         JCT   R0,AXT010                                                        
*                                                                               
         BRAS  RE,GETGIN                                                        
*                                                                               
         L     R3,PARM+8           GET ADDRESS OF NEW RECORD                    
         LA    R3,0(R3)            CLEAR HOB                                    
         USING TRNRECD,R3          R3=A(ACCFILE RECORD)                         
         CLI   PARM+4,C'L'         TEST LOAD MODE                               
         JE    *+8                                                              
         LA    R3,28(R3)           POINT BEYOND RECOVERY DATA                   
*                                                                               
         MVC   AXG$ACCD,TRNKULA     MOVE U/L/ACCT                               
         MVC   AXG$CONT,TRNKULC     MOVE CONTRA U/L/ACCT                        
*                                                                               
*        CLC   TRNKULA,=CL14'SSNFOBNN'                                          
*        BNE   *+8                                                              
*        BE    *+4                                                              
*                                                                               
         BAS   RE,SETLDGR          SET LEDGER TYPE                              
         XC    ELADDRS(ELADDRX-ELADDRS),ELADDRS                                 
*                                                                               
         BAS   RE,GETELEMS         GET ELEMENT ADDRESSES                        
*                                                                               
         MVI   SAPRUN,C'N'                                                      
         L     RE,VDXBLOCK         A(EXTRACT CONTROL DATA BLOCK)                
         USING DXBLOCKD,RE                                                      
         CLC   =C'SAP',DXUSER                                                   
         JNE   AXT015                                                           
         TM    LDG,RCVLDGQ+PAYLDGQ                                              
         JZ    AXTSKIP                                                          
         MVI   SAPRUN,C'Y'                                                      
         DROP  RE                                                               
*                                                                               
         USING SAPKEYD,R5                                                       
         LA    R5,AXG$KEY                                                       
         GOTOR VHEXOUT,DMCB,TRNKCPY,SAPKCMP,1,=C'TOG'                           
         MVC   SAPKACC,TRNKULA     UNIT/LEDGER/ACCOUNT                          
         MVC   SAPKOFF,TRNKOFF     OFFICE CODE                                  
         GOTOR VHEXOUT,DMCB,TRNKCCPY,SAPKCCPY,1,=C'TOG'                         
         MVC   SAPKCACC,TRNKULC    CONTRA UNIT/LEDGER/ACCOUNT                   
         LA    R4,TRNKDATE                                                      
         BAS   RE,GODATCON                                                      
         MVC   SAPKTDTE,WORK       TRANSACTION DATE                             
         MVC   SAPKREF,TRNKREF     TRANSACTION REFERENCE                        
         GOTOR VHEXOUT,DMCB,TRNKSBR,SAPKSQ#,1,=C'TOG'                           
         DROP  R5                                                               
*                                                                               
         MVC   AXG$MSYS(14),=CL14'MEDIAOCEAN_CA_'                               
         MVC   AXG$MSYS+14(2),SXDTAGY                                           
*&&DO                                                                           
         LARL  RE,AGYTAB                                                        
AXT014A  CLI   0(RE),0                                                          
         JE    AXT015                                                           
         CLC   SXDTAGY,0(RE)                                                    
         JE    *+12                                                             
         LA    RE,L'AGYTAB(RE)                                                  
         J     AXT014A                                                          
         MVC   AXG$MSYS+14(2),2(RE)                                             
*&&                                                                             
*                                                                               
AXT015   CLI   PARM+4,C'L'         TEST LOAD MODE                               
         JNE   AXT020                                                           
*                                                                               
         LT    R5,ATRSEL           FILTER ON ACTIVITY DATE!                     
         JNZ   *+6                                                              
         DC    H'0'                                                             
         CLC   MYSDATE2,TRSDATE-TRSEL(R5)                                       
         JH    AXTSKIP                                                          
         CLC   MYEDATE2,TRSDATE-TRSEL(R5)                                       
         JL    AXTSKIP                                                          
         CLI   PARM+4,C'L'         TEST LOAD MODE                               
         JNE   AXT020                                                           
         OC    TRSUDAT-TRSEL(L'TRSUDAT,R5),TRSUDAT-TRSEL(R5)                    
         JNZ   AXTSKIP                                                          
*                                                                               
AXT020   LT    R5,ATRNEL                                                        
         JNZ   *+6                                                              
         DC    H'0'                                                             
         USING TRNELD,R5                                                        
         CLI   TRNTYPE,12  <===    JCLE SAYS NO TYPE 12'S                       
         JE    AXTSKIP     <===                                                 
*                                                                               
         LLC   R0,TRNTYPE                                                       
         BRAS  RE,CVD                                                           
         MVC   AXG$TTYP,P16+13     TRANSACTION TYPE                             
*                                                                               
         CLC   =C'SJ',TRNKUNT      SKIP SJ/TYPE 49'S                            
         JNE   AXT025                                                           
         CLI   TRNTYPE,49                                                       
         JE    AXTSKIP                                                          
*                                                                               
AXT025   AP    SEQNUM,=P'1'                                                     
         OI    SEQNUM+5,X'0F'                                                   
         UNPK  AXG$SEQ,SEQNUM                                                   
*                                                                               
         GOTO1 VDATCON,DMCB,(1,TRNDATE),(X'20',AXG$TRDT) TRANS DATE             
*                                                                               
         BAS   RE,GETOFFC                                                       
*                                                                               
         MVC   AXG$TRRF,TRNREF                                                  
         LLC   R0,TRNSUB                                                        
         BRAS  RE,CVD                                                           
         MVC   AXG$TRSR,P16+13                                                  
*                                                                               
         ZAP   DUB,TRNAMNT         TRANSACTION AMOUNT                           
         CLI   SAPRUN,C'Y'         IS THIS AN SAP RUN?                          
         JNE   AXT027              IF NOT, NO NEED CONTINUE                     
         TM    LDG,PAYLDGQ                                                      
         JZ    AXT027                                                           
         CP    DUB,=P'0'           IF SO, SKIP 0 DOLLAR PAYABLES                
         JE    AXASKIP                                                          
*                                                                               
AXT027   LA    RE,TOTALDR          ADD TO REPORT TOTALS                         
         LA    RF,AXG$DR                                                        
         MVI   DRORCR,C'D'                                                      
*                                                                               
         TM    TRNSTAT,TRNSDR                                                   
         JO    AXT030                                                           
*                                                                               
         LA    RE,TOTALCR                                                       
         LA    RF,AXG$CR                                                        
         MVI   DRORCR,C'C'                                                      
*                                                                               
AXT030   AP    0(8,RE),DUB                                                      
         MVC   AXG$STYP,=C'INV'    ASSUME INV                                   
         CP    DUB,=P'0'                                                        
         JNL   *+10                                                             
         MVC   AXG$STYP,=C'CRM'    OTHERWISE CRM                                
*                                                                               
         CLI   SAPRUN,C'Y'         IS THIS AN SAP RUN?                          
         JNE   AXT031              IF NOT, NO NEED TO CHECK DR/CR               
         TM    LDG,RCVLDGQ                                                      
         JZ    AXT031                                                           
         CLI   DRORCR,C'C'         IS IT CREDIT?                                
         JNE   AXT031                                                           
         MP    DUB,=P'-1'          REVERSE THE SIGN                             
AXT031   BAS   RE,TRNCVDP                                                       
         MVC   0(16,RF),P16                                                     
         MVC   AXG$NETA,0(RF)                                                   
*                                                                               
         CLI   SAPRUN,C'Y'         IS THIS AN SAP RUN?                          
         JNE   AXT045              IF NOT, NO NEED TO CHECK DR/CR               
         TM    LDG,PAYLDGQ                                                      
         JZ    AXT040                                                           
         CLI   DRORCR,C'D'         IS IT DEBIT                                  
         JE    AXT033                                                           
AXT033   LA    RE,VARTAB                                                        
AXT035   CLI   0(RE),0             ARE WE DONE?                                 
         JE    AXT040                                                           
         CLC   TRNKULA,0(RE)       MATCH ON U/L/A                               
         JNE   *+20                                                             
         MVC   AXG$STYP,=C'VAR'       SET TRANSACTION TYPE AS VAR               
         MVC   AXG$MATL,=CL14'M00025' MOVE IN MATERIAL                          
         J     AXT045                                                           
         LA    RE,L'VARTAB(RE)                                                  
         J     AXT035                                                           
*                                                                               
AXT040   MVC   AXG$TAXC(2),=C'MI'  DEFAULT FOR PAYABLES                         
         TM    LDG,PAYLDGQ                                                      
         JO    *+10                                                             
         MVC   AXG$TAXC(2),=C'MO'  RECEIVABLES                                  
*                                                                               
         CLI   PARM+4,C'L'         TEST LOAD MODE                               
         JNE   AXT042                                                           
         TM    LDG,RCVLDGQ         IF LOAD MODE AND DOING RCV                   
         JO    AXT045              SEND DR AND CR                               
*                                                                               
AXT042   LA    R1,BNE              BRANCH NOT EQUAL                             
         TM    LDG,PAYLDGQ                                                      
         JZ    *+8                 YES                                          
         LA    R1,BE               BRANCH EQUAL                                 
         CLI   DRORCR,C'D'         IS IT DEBIT                                  
         EX    R1,*+6                                                           
         NOPR  0                   IF ODD AND CR, EVEN IF DR                    
         BC    0,AXTSKIP           BRANCH IF NOT OK                             
*                                                                               
AXT045   CLC   =C'SS',TRNKUNT      FOR SS/SP THAN THERE'S NO TAX                
         JE    AXT080                                                           
         CLC   =C'SP',TRNKUNT                                                   
         JE    AXT080                                                           
         MVI   BYTE,0                                                           
         ZAP   DUB,=P'0'                                                        
         LT    R1,ASCIEL                                                        
         JZ    AXT080                                                           
         ZAP   DUBGST,=P'0'                                                     
         ZAP   DUBQST,=P'0'                                                     
         ZAP   DUBHST,=P'0'                                                     
AXT050   CLI   0(R1),0             END OF ELEMS?                                
         JE    AXT070                                                           
         CLI   0(R1),SCIELQ                                                     
         JE    AXT060                                                           
AXT055   SR    R0,R0                                                            
         IC    R0,1(R1)                                                         
         AR    R1,R0                                                            
         J     AXT050                                                           
*                                                                               
         USING SCIELD,R1                                                        
AXT060   CLI   SCITYPE,SCITTAXP    GST TAX?                                     
         JNE   *+12                                                             
         LA    RE,DUBGST                                                        
         J     AXT065                                                           
         CLI   SCITYPE,SCITTQST    GST OR HST TAX?                              
         JNE   AXT055                                                           
         CLC   =C'PQS',SCISUBPR    QST?                                         
         JNE   *+12                                                             
         LA    RE,DUBQST                                                        
         J     AXT065                                                           
         LA    RE,DUBHST                                                        
         CLC   =C'ONH',SCISUBPR    HST-ON?                                      
         JE    AXT065                                                           
         CLC   =C'NBH',SCISUBPR    HST-NB?                                      
         JE    AXT065                                                           
         CLC   =C'NSH',SCISUBPR    HST-NS?                                      
         JE    AXT065                                                           
         CLC   =C'PEH',SCISUBPR    HST-PE?                                      
         JE    AXT065                                                           
         CLC   =C'NFH',SCISUBPR    HST-NF?                                      
         JNE   AXT055                                                           
AXT065   AP    0(L'DUB,RE),SCIAMNT         ACCUMULATE THE TAXES                 
         J     AXT055                                                           
         DROP  R1                                                               
*                                                                               
AXT070   CP    DUBGST,=P'0'           DID WE GET A GST TAX?                     
         JNZ   AXT070A                                                          
         CP    DUBHST,=P'0'           DID WE GET A HST TAX?                     
         JNZ   AXT070A                                                          
         CP    DUBQST,=P'0'           DID WE GET A QST TAX?                     
         JZ    AXT080                                                           
*                                                                               
         USING TAXATBD,RE                                                       
AXT070A  LA    RE,TAXATAB                                                       
         SR    R0,R0                                                            
AXT071   CLI   0(RE),0                                                          
         JE    AXT080                                                           
         ICM   RF,15,TAXADUB                                                    
*        CP    0(L'DUB,RF),=P'0'      DID WE HAVE A TAX?                        
*        JNZ   *+12                                                             
         J     *+12                                                             
AXT071A  LA    RE,TAXALNQ(RE)                                                   
         J     AXT071                                                           
*                                                                               
         MVC   BYTE,TAXAIND                                                     
         CP    0(L'DUB,RF),=P'0'      DID WE HAVE A TAX?                        
         JZ    AXT072                                                           
         ZAP   DUB,0(L'DUB,RF)     SAVE OFF TAX AMOUNT IN DUB FOR EDIT          
         ST    RE,FULL             SAVE RE                                      
         BAS   RE,TRNCVDP                                                       
         L     RE,FULL             RESTORE RE                                   
         LR    RF,R2               SET UP RF FOR ADDING DISPLACEMENT            
         ICM   R0,3,TAXAFLD                                                     
         AR    RF,R0                                                            
         MVC   0(L'AXG$TAXA_HST,RF),P16                                         
*                                                                               
AXT072   LR    RF,R2               SET UP RF FOR ADDING DISPLACEMENT            
         ICM   R0,3,TAXACOD                                                     
         AR    RF,R0                                                            
         MVC   0(L'AXG$TAXM_HST,RF),MYSPACES                                    
*                                                                               
         USING TAXTBD,R1                                                        
         LA    R1,TAXTAB                                                        
AXT075   CLI   0(R1),0                                                          
         JE    *+14                USE DEFAULT                                  
         CLC   BYTE,TAXTIND                                                     
         JNE   AXT077                                                           
         LR    RF,R2               SET UP RF FOR ADDING DISPLACEMENT            
         ICM   R0,3,TAXACOD                                                     
         AR    RF,R0                                                            
         MVC   0(L'AXG$TAXM_HST,RF),TAXTSRCD                                    
         TM    LDG,PAYLDGQ                                                      
         JNO   AXT071A                                                          
         LR    RF,R2               SET UP RF FOR ADDING DISPLACEMENT            
         ICM   R0,3,TAXACOD                                                     
         AR    RF,R0                                                            
         MVC   0(L'AXG$TAXM_HST,RF),TAXTPYCD                                    
         J     AXT071A                                                          
AXT077   LA    R1,TAXTLNQ(R1)                                                   
         J     AXT075                                                           
         DROP  R1,RE                                                            
*                                                                               
AXT080   CLI   0(R5),TRNELQ                                                     
         BE    *+8                                                              
         BNE   *+4                                                              
         GOTO1 VDATCON,DMCB,(1,TRNDATE),(X'20',AXG$ACDT)  ACTV DT               
*                                                                               
         MVC   AXG$BREF,TRNBTCH                                                 
         LLC   RE,1(R5)            GET ELEMENT LENGTH                           
         AHI   RE,-TRNLN1Q         - LEN TO START OF NARRATIVE                  
         JNP   AXT095                                                           
*                                                                               
         TM    LDG,SJLDGQ          TEST SJ                                      
         JZ    AXT085                                                           
         CLC   =C'99',TRNANAL      WORK CODE 99 IS SPECIAL                      
         JNE   AXT085                                                           
         LA    RE,15               JUST 15 BYTES OF NARRATIVE                   
*                                                                               
AXT085   L     RF,NARCOUNT         BUMP COUNT OF RECS WITH NARR                 
         AHI   RF,1                                                             
         ST    RF,NARCOUNT                                                      
*                                                                               
         LA    RF,NARCNT20                                                      
         CHI   RE,20                                                            
         JNH   AXT090                                                           
         LA    RF,NARCNT40                                                      
         CHI   RE,40                                                            
         JNH   AXT090                                                           
         LA    RF,NARCNT60                                                      
         CHI   RE,60                                                            
         JNH   AXT090                                                           
         LA    RF,NARCNT80                                                      
*                                                                               
AXT090   L     R0,0(RF)                                                         
         AHI   R0,1                                                             
         ST    R0,0(RF)                                                         
*                                                                               
         BCTR  RE,0                                                             
         LA    R1,TRNNARR                                                       
         EXRL  RE,MVNARR           MVC  AXG$NARR,0(R1)                          
         TR    AXG$NARR,MXTRT                                                   
*                                                                               
AXT095   LT    R5,ATRSEL           X'60' TRANS STATUS ELEMENT                   
         JNZ   *+6                                                              
         DC    H'0'                                                             
         USING TRSELD,R5                                                        
*                                                                               
         MVC   FULL(2),TRSPMOS                                                  
         MVI   FULL+2,1                                                         
         LA    R4,FULL                                                          
         BAS   RE,GODATCON                                                      
         MVC   AXG$MOA,WORK        ACTIVITY MONTH YYMM ONLY                     
* THIS DATE IS COMPRESSED - SO BE CAREFUL!                                      
         GOTO1 VDATCON,DMCB,(2,TRSDATE),(X'20',AXG$ACDT) ACVTY DATE             
         DROP  R5                                                               
*                                                                               
         TM    LDG,RCVLDGQ+INCLDGQ+PAYLDGQ                                      
         JZ    AXT115                                                           
*                                                                               
         CLC   TRNKREF,=C'5B0172'  IDF CODE                                     
         JNE   *+8                                                              
         J     *+4                                                              
*                                                                               
         TM    LDG,PAYLDGQ                                                      
         JZ    AXT097                                                           
         MVC   AXG$SYS,TRNKLDG            FOR PAYABLES, USE LEDGER              
         CLI   AXG$SYS,C'U'               FOR NET                               
         JNE   *+8                                                              
         MVI   AXG$SYS,C'N'               MAKE IT N                             
         CLI   AXG$SYS,C'Q'               FOR CANADIAN PRINT                    
         JNE   *+8                                                              
         MVI   AXG$SYS,C'P'               MAKE IT P                             
         CLI   AXG$SYS,C'T'               FOR CANADIAN SPOT                     
         JNE   *+8                                                              
         MVI   AXG$SYS,C'S'               MAKE IT S                             
*                                                                               
AXT097   MVC   AXG$MOS,AXG$TRDT    DEFAULT MOS IS TRNS DATE YYMM                
         LT    R5,AMDTEL           X'1A' = MEDIA TRANSFER ELEM                  
         JZ    *+12                                                             
         LA    RE,MDTMOS-MDTELD(R5)                                             
         J     AXT105                                                           
         LT    R5,AMDPEL           X'6A' = PACKED VERSION                       
         JZ    *+12                                                             
         LA    RE,MDPMOS-MDPELD(R5)                                             
         J     AXT105                                                           
         LT    R5,AGDAEL           X'EF' = GENERAL DATE ELEM                    
         JZ    AXT111                                                           
         SR    R1,R1                                                            
AXT100   CLI   0(R5),0             END OF ELEMENTS?                             
         JE    AXT111                                                           
         CLI   0(R5),GDAELQ                                                     
         JNE   *+20                                                             
         CLI   GDATYPE-GDAELD(R5),GDAMMOS                                       
         JNE   *+12                                                             
         LA    RE,GDAYYMM-GDAELD(R5)                                            
         J     AXT105                                                           
         IC    R1,1(R5)                                                         
         AR    R5,R1                                                            
         J     AXT100                                                           
*                                                                               
AXT105   MVC   FULL(2),0(RE)                                                    
         OC    FULL(2),FULL                                                     
         JZ    AXT107                                                           
         MVI   FULL+2,1                                                         
         LA    R4,FULL                                                          
         BAS   RE,GODATCON                                                      
         MVC   AXG$MOS,WORK               MOVE YYMM ONLY                        
*                                                                               
AXT107   CLI   0(R5),GDAELQ                                                     
         JE    *+10                                                             
         MVC   AXG$SYS,MDTSYS-MDTELD(R5)  GOOD FOR BOTH MDT/MDP ELEMS           
*                                                                               
AXT110   CLI   0(R5),MDTELQ                                                     
         JNE   AXT111                                                           
         USING MDTELD,R5                                                        
         TM    MDTSTAT,MDTSMIQ                                                  
         JZ    AXT111                                                           
         MVC   AXG$SYS,MDTMED2                                                  
         DROP  R5                                                               
*                                                                               
AXT111   LT    R5,AMBIEL           X'F3' = NEW BILLING TRANSFER ELEM            
         JZ    AXT112                                                           
         MVC   AXG$SYS,MBISYS-MBIELD(R5)  MOVE IN MEDIA SYSTEM                  
         MVC   AXG$MED,MBIMED-MBIELD(R5)  MOVE IN MEDIA                         
         MVC   AXG$CLT,MBICLI-MBIELD(R5)  MOVE IN MEDIA BILLING CLIENT          
*                                                                               
AXT112   CLI   SAPRUN,C'Y'         IS THIS AN SAP RUN?                          
         JNE   AXT115              IF NOT, CONTINUE                             
         CLI   AXG$SYS,C'J'        IS THIS FOR PRODUCTION?                      
         JE    AXASKIP             DO NOT DO PRODUCTION FOR SAP.                
*        JNE   AXT115              IF NOT, CONTINUE                             
*        TM    LDG,RCVLDGQ         IS THIS A RECEIVABLE LEDGER?                 
*        JZ    AXASKIP             IF NOT, NO NEED TO CONTINUE                  
*                                                                               
AXT115   BRAS  RE,GETCLT                                                        
*                                                                               
         BRAS  RE,GETMED                                                        
*                                                                               
         BRAS  RE,GETPRD                                                        
*                                                                               
         TM    LDG,MEDLDGQ         GET ESTIMATE FOR SZ                          
         JZ    AXT115AA                                                         
         CLI   AXG$SYS,C' '        IS THE SYSTEM FIELD BLANK?                   
         JNE   AXT115AA                                                         
         MVC   AXG$SYS,TRNKACT     MOVE IN FIRST BYTE OF ACCOUNT                
         CLI   AXG$MED,C' '        IS THE MEDIA FIELD BLANK?                    
         JNE   AXT115AA                                                         
         MVC   AXG$MED,TRNKACT+1   MOVE IN NEXT BYTE OF ACCOUNT                 
*                                                                               
AXT115AA MVI   AXG$VORR,C'V'                                                    
         CLI   ITMREP,C'Y'         IS THIS A REP?                               
         JNE   AXT115Z                                                          
         MVI   AXG$VORR,C'R'                                                    
         LA    R0,L'TRNKACT                                                     
         LA    RE,TRNKACT+L'TRNKACT-1                                           
AXT115W  CLI   0(RE),X'40'                                                      
         JNH   AXT115Y                                                          
         CLI   0(RE),C'S'          IS THIS A SPECIAL REP?                       
         JNE   AXT115Z                                                          
         MVI   0(RE),X'40'         REMOVE THE S FOR SPECIAL REPS                
         J     AXT115Z                                                          
AXT115Y  AHI   RE,-1                                                            
         J     AXT115W                                                          
*                                                                               
AXT115Z  MVC   AXG$PAYE(L'TRNKACT-1),TRNKACT+1                                  
*                                                                               
         TM    LDG,RCVLDGQ+INCLDGQ+PAYLDGQ                                      
         JZ    *+8                                                              
         BRAS  RE,GETEST                                                        
*                                                                               
         TM    LDG,RCVLDGQ+INCLDGQ+PAYLDGQ+EXPLDGQ+SJLDGQ+SCLDGQ                
         JZ    *+8                                                              
         BRAS  RE,GETJOB                                                        
*                                                                               
         CLI   SAPRUN,C'Y'                                                      
         JNE   AXT119                                                           
         MVC   AXG$INS#,MYSPACES   INSERTION NUMBER BLANK FOR NOW               
*                                                                               
         USING FXTABD,RE                                                        
         LA    RE,FXTAB                                                         
AXT115A  CLI   FXTSYS,0            ARE WE DONE?                                 
         JE    AXT115C                                                          
         CLC   AXG$SYS,FXTSYS               SAME SYSTEM?                        
         JNE   AXT115B                                                          
         CLC   TRNKACT+1(L'TRNKACT-1),FXTACC   SAME ACCT MINUS MEDIA?           
         JNE   AXT115B                                                          
         MVC   AXG$STYP,=C'F/X'    SET TRANSACTION TYPE AS F/X                  
         MVC   AXG$CURR,FXTCURR    SET CURRENCY FROM TABLE                      
         J     AXT115C                                                          
AXT115B  LA    RE,FXTBLNQ(RE)                                                   
         J     AXT115A                                                          
         DROP  RE                                                               
*                                                                               
         USING MEDTBD,R1                                                        
AXT115C  LARL  R1,MEDTAB                                                        
AXT116   CLI   0(R1),0                                                          
         JE    AXT118                                                           
         CLC   MEDTSYS,AXG$SYS        SAME SYSTEM?                              
         JNE   AXT117                                                           
         CLC   MEDTMED,AXG$MED        SAME MEDIA?                               
         JNE   AXT117                                                           
         MVC   AXG$MEDT,MEDTMEDT      MOVE IN MEDIA TYPE                        
         MVC   AXG$SMED,MEDTSMED      MOVE IN SUBMEDIA                          
         CLC   AXG$STYP,=C'VAR'       IS THIS A VAR RECORD?                     
         JNE   *+14                                                             
         CLC   AXG$MATL,=CL14'M00025' IS MATERIAL ALREADY SET?                  
         JE    AXT119                                                           
         MVC   AXG$MATL,MEDTMATL      MOVE IN MATERIAL                          
         J     AXT119                                                           
AXT117   LA    R1,MEDTLNQ(R1)                                                   
         J     AXT116                                                           
         DROP  R1                                                               
*                                                                               
         USING PXTABD,R1                                                        
AXT118   LA    R1,PXTAB                                                         
AXT118A  CLI   0(R1),0                                                          
         JE    AXT119                                                           
         CLC   AXG$SYS,PXTSYS                 SAME SYSTEM?                      
         JNE   AXT118B                                                          
         CLC   TRNKACT+1(L'TRNKACT-1),PXTACC  SAME ACCOUNT MINUS MEDIA?         
         JNE   AXT118B                                                          
         MVC   AXG$MATL,PXTMATCD              MOVE IN MATERIAL                  
         J     AXT119                                                           
AXT118B  LA    R1,PXTBLNQ(R1)                                                   
         J     AXT118A                                                          
         DROP  R1                                                               
*                                                                               
AXT119   TM    LDG,EXPLDGQ         TEST EXPENSE LDGR                            
         BZ    AXT135                                                           
         L     R5,ATRNEL                                                        
         CLI   TRNTYPE-TRNEL(R5),12                                             
         JNE   AXT120                                                           
         LT    R5,AEXOEL                                                        
         JZ    AXT120                                                           
         MVC   AXG$DEPT+2(3),EXODEP-EXOEL(R5)                                   
         J     AXT135                                                           
*                                                                               
AXT120   DS    0H                                                               
         CLC   =C'SE',TRNKUNT                                                   
         JNE   AXT135                                                           
         LT    R5,AAPEEL               THIS FOR SJ ONLY!                        
         JZ    AXT125                                                           
         LLC   RE,APENUM-APEELD(R5)    GET NUMBER OF SUBELS                     
         LA    R4,APENTRY-APEELD(R5)                                            
         USING APENTRY,R4                                                       
*                                                                               
AXT125   CLC   =C'2D',APENACT      TEST FOR DEPARTMENT                          
         JE    AXT130                                                           
         LLC   R0,0(R4)            GET LENGTH OF SUBEL                          
         AR    R4,R0               POINT TO NEXT ONE                            
         JCT   RE,AXT125                                                        
         J     AXT135                                                           
*                                                                               
AXT130   LLC   RE,0(R4)            GET LENGTH OF SUBEL                          
         AHI   RE,-7               LEN/STAT/2D/OF/-1                            
         CHI   RE,6                CAN ONLY HANDLE 7 CHARS OF DEPT              
         JNH   *+8                                                              
         LA    RE,6                                                             
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   AXG$DEPT(0),APENACT+4   MOVE DEPARTMENT ONLY                     
         DROP  R4                                                               
*                                                                               
AXT135   DS    0H                                                               
**NOP**  MVC   AXG$BSRC,TRNKCACT    BILLING SOURCE=CONTRA ACCT                  
*                                                                               
         BAS   RE,GETINV            INVOICE NUMBER                              
*                                                                               
         ZAP   WORK+20(8),=P'0'                                                 
         LT    R5,AMDTEL                                                        
         JZ    AXT140                                                           
         ICM   R0,15,MDTNET-MDTELD(R5)                                          
         CVD   R0,DUB                                                           
         BRAS  RE,TRNCVDP                                                       
         MVC   AXG$BNET,P16        NET BILLING                                  
         ZAP   WORK+20(8),DUB                                                   
*                                                                               
         ICM   R0,15,MDTCOM-MDTELD(R5)                                          
         CVD   R0,DUB                                                           
         BRAS  RE,TRNCVDP                                                       
         MVC   AXG$BINC,P16        BILLING INCOME                               
         J     AXT140                                                           
*                                                                               
         LT    R5,AMDPEL                                                        
         JZ    AXT140                                                           
         ZAP   DUB,MDPNET-MDPELD(6,R5)                                          
         BRAS  RE,TRNCVDP                                                       
         MVC   AXG$BNET,P16                                                     
         ZAP   WORK+20(8),DUB                                                   
         ZAP   DUB,MDPCOM-MDPELD(6,R5)                                          
         BRAS  RE,TRNCVDP                                                       
         MVC   AXG$BINC,P16                                                     
*                                                                               
AXT140   CLI   SAPRUN,C'Y'         IS THIS AN SAP RUN?                          
         JNE   AXT145              IF NOT, NO NEED TO NET BILLING'              
         CLI   PARM+4,C'L'         TEST LOAD MODE                               
         BE    AXT145              YES - NO NEED TO CHECK NET BILLING           
*        TM    LDG,RCVLDGQ                                                      
*        JZ    AXT145                                                           
*        CP    WORK+20(8),=P'0'    IF NET BILLING-SKIP                          
*        JE    AXASKIP                                                          
AXT145   LT    R5,ARALEL                                                        
         JZ    AXT160                                                           
         MVC   ELCODE,0(R5)                                                     
         CLI   DRORCR,C'C'         TEST CREDIT                                  
         BE    AXT165              YES - GET FROM NARRATIVE                     
*                                                                               
AXT150   CLI   RALTYPE-RALEL(R5),RALTALC   CHECK NUMBER                         
         JE    AXT155                                                           
         BRAS  RE,NEXTEL                                                        
         JE    AXT150                                                           
         J     AXT160                                                           
*                                                                               
AXT155   MVC   AXG$CHEK,RALAREF-RALEL(R5)                                       
         LA    R4,RALADAT-RALEL(R5) CHECK DATE                                  
         BAS   RE,GODATCON                                                      
         MVC   AXG$CKDT,WORK                                                    
         J     AXT165                                                           
*                                                                               
AXT160   TM    LDG,SCLDGQ          TEST SC                                      
         JZ    AXT165                                                           
         L     R5,ATRNEL                                                        
         MVC   AXG$CHEK(6),TRNREF-TRNEL(R5)                                     
         MVC   AXG$CKDT,AXG$TRDT   TRANS DATE=CHECK DATE                        
*                                                                               
AXT165   TM    LDG,RCVLDGQ+PAYLDGQ+SJLDGQ  DUE DATE                             
         JZ    AXT170                                                           
         LT    R5,ADUEEL                                                        
         JZ    AXT168                                                           
         LA    R4,DUEDATE-DUEEL(R5)                                             
* THIS DATE IS COMPRESSED - SO BE CAREFUL!                                      
         GOTO1 VDATCON,DMCB,(2,(R4)),(X'20',AXG$DUDT)                           
         J     AXT170                                                           
*                                                                               
AXT168   L     R5,ATRNEL                                                        
         MVC   WORK(3),TRNDATE-TRNEL(R5)                                        
         GOTO1 VDATCON,DMCB,(1,WORK),(0,WORK+3)   GET TODAY'S DATE              
         GOTO1 VADDAY,DMCB,(C'D',WORK+3),(X'20',WORK+9),F'30'                   
         MVC   AXG$DUDT,WORK+9                                                  
*                                                                               
AXT170   DS    0H                                                               
*&&DO                                                                           
         TM    LDG,RCVLDGQ+SJLDGQ    BILL DATE                                  
         JZ    AXT175                                                           
*                                                                               
         L     R5,ATRNEL                                                        
         LA    R4,TRNDATE-TRNEL(R5)                                             
         BAS   RE,GODATCON                                                      
         MVC   AXG$BLDT,WORK                                                    
*                                                                               
AXT175   LT    R5,AFFTEL                                                        
         JZ    AXT190                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT180   CLI   FFTTYPE-FFTEL(R5),FFTTINVN                                       
         JE    AXT185                                                           
         BRAS  RE,NEXTEL                                                        
         JE    AXT180                                                           
         J     AXT192                                                           
*                                                                               
AXT185   LLC   RE,FFTDLEN-FFTEL(R5)  GET TEXT LENGTH                            
         LA    R0,L'AXG$BILL                                                    
         CR    RE,R0                                                            
         JNH   *+6                                                              
         LR    RE,R0                                                            
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   AXG$BILL(0),FFTDATA-FFTEL(R5)                                    
         J     AXT192                                                           
*                                                                               
AXT190   TM    LDG,PAYLDGQ+INCLDGQ+RCVLDGQ+SCLDGQ+SJLDGQ                        
         JNZ   *+14                                                             
         CLC   =C'SZ',TRNKUNT                                                   
         JNE   AXT192                                                           
         MVC   AXG$BILL(6),TRNKREF                                              
         CLI   AXG$BILL,C' '                                                    
         JH    AXT192                                                           
         L     R5,ATRNEL                                                        
         MVC   AXG$BILL(6),TRNREF-TRNEL(R5)                                     
*&&                                                                             
*                                                                               
AXT192   CLC   AXG$STYP,=C'VAR'    IF VAR, CHECK FOR SLUSH ACCOUNT              
         JNE   AXT195                                                           
         LT    R5,AFFTEL                                                        
         JZ    AXT195                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT192A  CLI   FFTTYPE-FFTEL(R5),FFTTPYAC                                       
         JE    AXT192B                                                          
         BRAS  RE,NEXTEL                                                        
         JE    AXT192A                                                          
         J     AXT195                                                           
*                                                                               
AXT192B  MVC   AXG$NETW,MYSPACES     CLEAR FIELD AS WE HAVE OVERRIDE            
         LLC   RE,FFTDLEN-FFTEL(R5)  GET TEXT LENGTH                            
         LA    R0,AXG$NETW                                                      
         CR    RE,R0                                                            
         JNH   *+6                                                              
         LR    RE,R0                                                            
         BCTR  RE,0                                                             
         MVC   AXG$NETW(0),FFTDATA-FFTEL(R5)                                    
         EX    RE,*-6                                                           
*                                                                               
AXT195   TM    LDG,RCVLDGQ         DEPOSIT DATE                                 
         JZ    AXT210                                                           
         CLI   DRORCR,C'C'         TEST CREDIT                                  
         JE    AXT210                                                           
*                                                                               
         LT    R5,ARALEL                                                        
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT200   CLI   RALTYPE-RALEL(R5),RALTALC                                        
         JE    AXT205                                                           
         BRAS  RE,NEXTEL                                                        
         JE    AXT200                                                           
         J     AXT210                                                           
*                                                                               
AXT205   LA    R4,RALADEP-RALEL(R5)                                             
         BAS   RE,GODATCON                                                      
         MVC   AXG$DPDT,WORK                                                    
*                                                                               
AXT210   TM    LDG,PAYLDGQ+RCVLDGQ    OFFSET DATE                               
         JZ    AXT225                                                           
*&&DO                                                                           
         MVI   AXG$XCHR,C'0'                                                    
         MVC   AXG$XCHR+1(L'AXG$XCHR-1),AXG$XCHR                                
*&&                                                                             
         MVC   AXG$XCHR,MYSPACES                                                
         CLC   AXG$STYP,=C'F/X'    KEEP CURRENCY AS SET BY FXTAB                
         JE    AXT213              FOR ANY F/X POSTINGS                         
         MVC   AXG$CURR,=C'USD'    OTHERWISE ASSUME USD CURRENCY                
         CLC   =C'ST',TRNKUNT      FOR ST/SQ THAN IT'S CAD                      
         JE    AXT212                                                           
         CLC   =C'SQ',TRNKUNT                                                   
         JE    AXT212                                                           
         TM    LDG,RCVLDGQ         CAD FOR A/R                                  
         JZ    AXT213                                                           
AXT212   MVC   AXG$CURR,=C'CAD'    CHANGE TO CAD FOR CANADIAN LEDGERS           
*                                                                               
AXT213   LT    R5,AFFTEL                                                        
         JZ    AXT214                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT213A  CLI   FFTTYPE-FFTEL(R5),FFTTACUR                                       
         JE    AXT213B                                                          
         BRAS  RE,NEXTEL                                                        
         JE    AXT213A                                                          
         J     AXT214                                                           
*                                                                               
AXT213B  MVC   AXG$CURR,MYSPACES     CLEAR FIELD AS WE HAVE OVERRIDE            
         LLC   RE,FFTDLEN-FFTEL(R5)  GET TEXT LENGTH                            
         LA    R0,AXG$CURR                                                      
         CR    RE,R0                                                            
         JNH   *+6                                                              
         LR    RE,R0                                                            
         BCTR  RE,0                                                             
         MVC   AXG$CURR(0),FFTDATA-FFTEL(R5)                                    
         EX    RE,*-6                                                           
*                                                                               
AXT214   CLI   DRORCR,C'C'         TEST CREDIT                                  
         JE    AXT225                                                           
*                                                                               
         LT    R5,ARALEL                                                        
         JZ    AXT225                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT215   CLI   RALTYPE-RALEL(R5),RALTOFS                                        
         JE    AXT220                                                           
         BRAS  RE,NEXTEL                                                        
         JE    AXT215                                                           
         J     AXT225                                                           
*                                                                               
AXT220   LA    R4,RALODAT-RALEL(R5)                                             
         BAS   RE,GODATCON                                                      
         MVC   AXG$OFDT,WORK                                                    
*                                                                               
AXT225   DS    0H                                                               
*&&DO                                                                           
AXT225   TM    LDG,SCLDGQ          CLEARED DATE (SC ONLY)                       
         JZ    AXT240                                                           
         LT    R5,AGDAEL                                                        
         JZ    AXT240                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT230   CLI   GDATYPE-GDAEL(R5),GDATRECN                                       
         JE    AXT235                                                           
         BRAS  RE,NEXTEL                                                        
         JE    AXT230                                                           
         J     AXT240                                                           
*                                                                               
AXT235   LA    R4,GDADATE2-GDAEL(R5)                                            
         BAS   RE,GODATCON                                                      
         MVC   AXG$CLDT,WORK                                                    
*&&                                                                             
AXT240   TM    LDG,RCVLDGQ+SCLDGQ    WRITE-OFF DATE                             
         JZ    AXT255                                                           
         LT    R5,ARALEL                                                        
         JZ    AXT255                                                           
         CLI   DRORCR,C'C'         TEST CREDIT                                  
         JE    AXT255                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT245   CLI   RALTYPE-RALEL(R5),RALTWOF                                        
         JE    AXT250                                                           
         BRAS  RE,NEXTEL                                                        
         JE    AXT245                                                           
         J     AXT255                                                           
*                                                                               
AXT250   LA    R4,RALWDAT-RALEL(R5)                                             
         BAS   RE,GODATCON                                                      
         MVC   AXG$WODT,WORK                                                    
*                                                                               
AXT255   TM    LDG,RCVLDGQ           TRANSFER DATE                              
         JZ    AXT270                                                           
         LT    R5,ARALEL                                                        
         JZ    AXT270                                                           
         CLI   DRORCR,C'C'         TEST CREDIT                                  
         JE    AXT270                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT260   CLI   RALTYPE-RALEL(R5),RALTTTO                                        
         JE    AXT265                                                           
         BRAS  RE,NEXTEL                                                        
         JE    AXT260                                                           
         J     AXT270                                                           
*                                                                               
AXT265   LA    R4,RALTDAT-RALEL(R5)                                             
         BAS   RE,GODATCON                                                      
         MVC   AXG$XFDT,WORK                                                    
*                                                                               
AXT270   DS    0H                                                               
*&&DO                                                                           
AXT270   TM    LDG,SCLDGQ          STATEMENT DATE                               
         JZ    AXT275                                                           
         LT    R5,ATRSEL                                                        
         JZ    AXT275                                                           
* THIS DATE IS COMPRESSED - SO BE CAREFUL!                                      
         LA    R4,TRSBSTDT-TRSEL(R5)                                            
         GOTO1 VDATCON,DMCB,(2,(R4)),(X'20',AXG$STDT)                           
*&&                                                                             
****** NOTE - VOID DATE FROM NARRATIVE ONLY *****                               
*&&DO                                                                           
AXT275   TM    LDG,INCLDGQ+EXPLDGQ   INVOICE DATE                               
         JZ    AXT280                                                           
         L     R5,ATRNEL                                                        
         LA    R4,TRNDATE-TRNEL(R5)                                             
         BAS   RE,GODATCON                                                      
         MVC   AXG$INDT,WORK                                                    
*&&                                                                             
AXT280   TM    LDG,PAYLDGQ+RCVLDGQ   BANK CODE                                  
         JZ    AXT295                                                           
         LT    R5,ASPAEL                                                        
         JZ    AXT295                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT285   CLI   SPATYPE-SPAEL(R5),SPATBANK                                       
         JE    AXT290                                                           
         BRAS  RE,NEXTEL                                                        
         JE    AXT285                                                           
         J     AXT295                                                           
*                                                                               
AXT290   MVC   AXG$BKCD,SPAAULA-SPAEL(R5)                                       
*                                                                               
AXT295   DS    0H                                                               
*&&DO                                                                           
AXT295   TM    LDG,EXPLDGQ+SCLDGQ                                               
         JZ    AXT305                                                           
         LT    R5,AAPEEL                                                        
         JZ    AXT305                                                           
         CLC   =C'SV',APENACT-APEEL(R5)                                         
         JE    AXT300                                                           
         CLC   =C'SW',APENACT-APEEL(R5)                                         
         JE    AXT300                                                           
         CLC   =C'SX',APENACT-APEEL(R5)                                         
         JE    AXT300                                                           
         CLC   =C'SY',APENACT-APEEL(R5)                                         
         JNE   AXT305                                                           
*                                                                               
AXT300   MVC   AXG$VNCD,APENACT-APEEL(R5)                                       
*&&                                                                             
AXT305   TM    LDG,RCVLDGQ+SJLDGQ                                               
         JZ    AXT320                                                           
         LT    R5,ARALEL                                                        
         JZ    AXT320                                                           
         CLI   DRORCR,C'C'         TEST CREDIT                                  
         JE    AXT320                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT310   CLI   RALTYPE-RALEL(R5),RALTWOF                                        
         JE    AXT315                                                           
         BRAS  RE,NEXTEL                                                        
         JE    AXT310                                                           
         J     AXT320                                                           
*                                                                               
AXT315   MVC   AXG$WOAC,RALWULA-RALEL(R5)                                       
         MVC   AXG$WONU,RALWREF-RALEL(R5)                                       
         MVC   AXG$WODT,RALWDAT-RALEL(R5)                                       
*                                                                               
AXT320   CLI   LDGVWXY,C'Y'        INVOICE NUMBER                               
         JE    AXT330                                                           
         CLC   =C'SZ',TRNKUNT                                                   
         JE    AXT330                                                           
*                                                                               
         CLI   SAPRUN,C'Y'                                                      
         JNE   AXT325                                                           
         TM    LDG,RCVLDGQ                                                      
         JZ    AXT325                                                           
         L     R5,ATRNEL                                                        
         CLI   TRNTYPE-TRNEL(R5),9   TYPE 9 ONLY                                
         JNE   AXT325                                                           
         MVC   AXG$SINV,TRNREF-TRNEL(R5)                                        
*                                                                               
AXT325   TM    LDG,INCLDGQ+RCVLDGQ+SCLDGQ                                       
         JNZ   AXT330                                                           
         TM    LDG,SJLDGQ                                                       
         JZ    AXT345                                                           
         L     R5,ATRNEL                                                        
         CLI   TRNTYPE-TRNEL(R5),6   TYPES 6+7 ONLY                             
         JE    AXT330                                                           
         CLI   TRNTYPE-TRNEL(R5),7                                              
         JNE   AXT345                                                           
*                                                                               
AXT330   LT    R5,AFFTEL                                                        
         JZ    AXT345                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT335   CLI   FFTTYPE-FFTEL(R5),FFTTINVN                                       
         JE    AXT340                                                           
         BRAS  RE,NEXTEL                                                        
         JE    AXT335                                                           
         J     AXT345                                                           
*                                                                               
AXT340   LLC   RE,FFTDLEN-FFTEL(R5)  GET DATA LENGTH                            
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   AXG$INV(0),FFTDATA-FFTEL(R5)                                     
         J     AXT365                                                           
*                                                                               
AXT345   CLI   LDGVWXY,C'Y'                                                     
         JE    AXT350                                                           
         CLC   =C'SZ',TRNKUNT                                                   
         JE    AXT350                                                           
         TM    LDG,INCLDGQ+RCVLDGQ+SCLDGQ                                       
         JZ    AXT355                                                           
*                                                                               
AXT350   L     R5,ATRNEL                                                        
         MVC   AXG$INV(L'TRNREF),TRNREF-TRNEL(R5)                               
         J     AXT365                                                           
*                                                                               
AXT355   CLI   LDGPQSTU,C'Y'                                                    
         JNE   AXT360                                                           
         LT    R5,AXPYEL                                                        
         JZ    AXT360                                                           
         MVC   AXG$INV(L'XPYINV),XPYINV-XPYEL(R5)                               
         J     AXT365                                                           
*                                                                               
AXT360   TM    LDG,SJLDGQ                                                       
         JZ    AXT365                                                           
         L     R5,ATRNEL                                                        
         CLI   TRNTYPE-TRNEL(R5),6   NOT FOR TYPES 6/7                          
         JE    AXT365                                                           
         CLI   TRNTYPE-TRNEL(R5),7                                              
         JNE   AXT365                                                           
*                                                                               
         LT    R5,APTAEL                                                        
         JNE   AXT365                                                           
         TM    PTASTAT1-PTAEL(R5),PTASPEND  IGNORE IF THIS BIT ON               
         JO    AXT365                                                           
*                                                                               
         LA    R1,PTARBLNO-PTAEL(R5)                                            
         CLC   1(5,R1),MYSPACES    ANY INV NUMBER?                              
         JNH   AXT365              NO DATA                                      
         MVC   AXG$INV(1),0(R1)    MOVE IN MEDIA PORTION                        
         MVI   AXG$INV+1,C'-'                                                   
         MVC   AXG$INV+2(2),1(R1)  MOVE IN YM PORTION                           
         MVI   AXG$INV+4,C'-'                                                   
         MVC   AXG$INV+5(4),3(R1)  MOVE IN REF PORTION                          
*                                                                               
AXT365   MVC   AXG$VCH#,MYSPACES   SET VOUCHER #                                
         UNPK  WORK(8),SEQNUM                                                   
         MVC   AXG$VCH#(6),WORK+2                                               
         GOTO1 =V(DATTIM),DMCB,(X'01',FULL)                                     
         GOTOR VHEXOUT,DMCB,FULL,WORK,4,=C'TOG'                                 
         MVC   AXG$VCH#+6(8),WORK                                               
*                                                                               
AXT385   TM    LDG,RCVLDGQ+INCLDGQ                                              
         JZ    AXT400                                                           
         LT    R5,AFFTEL                                                        
         JZ    AXT400                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT390   CLI   FFTTYPE-FFTEL(R5),FFTTAOR                                        
         JE    AXT395                                                           
         BRAS  RE,NEXTEL                                                        
         JE    AXT390                                                           
         J     AXT400                                                           
*                                                                               
AXT395   MVC   AXG$AOAC,FFTPRAOR-FFTEL(R5)   AOR ACCOUNT                        
         MVC   AXG$AOBL(L'FFTRTAOR),FFTRTAOR-FFTEL(R5) AOR BILLNUM              
         ZAP   DUB,FFTAMAOR-FFTEL(6,R5)      AOR AMOUNT                         
         TM    FFTSTAT2-FFTEL(R5),FFTCR                                         
         JZ    *+10                                                             
         MP    DUB,=P'-1'                                                       
         BRAS  RE,TRNCVDP                                                       
         MVC   AXG$AOR$,P16                                                     
*                                                                               
AXT400   CLC   =C'SI',TRNKULA                                                   
         JE    *+14                                                             
         CLC   =C'SK',TRNKULA                                                   
         JNE   AXT415                                                           
         LT    R5,ARFLEL                                                        
         JZ    AXT415                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
AXT405   CLI   RFLTYPE-RFLEL(R5),RFLWC                                          
         JE    AXT410                                                           
         BRAS  RE,NEXTEL                                                        
         JE    AXT405                                                           
         J     AXT415                                                           
*                                                                               
AXT410   MVC   AXG$WKCD,RFLDATA-RFLEL(R5)                                       
         J     AXT420                                                           
*                                                                               
AXT415   TM    LDG,SJLDGQ          IS IT SJ                                     
         JZ    AXT420                                                           
         L     R5,ATRNEL                                                        
         CLC   =C'**',TRNANAL-TRNEL(R5)                                         
         JE    AXT420                                                           
         MVC   AXG$WKCD,TRNANAL-TRNEL(R5)                                       
*                                                                               
AXT420   TM    LDG,SJLDGQ          TEST SJ                                      
         JNE   AXT425                                                           
         LT    R5,ASPDEL                                                        
         JZ    AXT425                                                           
         CLC   =C'SI',SPDACCS-SPDEL(R5)                                         
         JE    *+14                                                             
         CLC   =C'SK',SPDACCS-SPDEL(R5)                                         
         JNE   AXT425                                                           
         MVC   AXG$INAC,SPDACCS-SPDEL(R5)                                       
*                                                                               
AXT425   BRAS  RE,GETNARR          GET NARRATIVE DATA                           
         J     EXIT                                                             
         EJECT                                                                  
*                                                                               
* TAX TABLE                                                                     
*                                                                               
TAXATAB  DS    0D                                                               
         DC    X'80',AL4(DUBGST),AL2(AXG$TAXA_GST-AXG$TRN)                      
         DC    AL2(AXG$TAXM_GST-AXG$TRN)                                        
         DC    X'40',AL4(DUBQST),AL2(AXG$TAXA_QST-AXG$TRN)                      
         DC    AL2(AXG$TAXM_QST-AXG$TRN)                                        
         DC    X'20',AL4(DUBHST),AL2(AXG$TAXA_HST-AXG$TRN)                      
         DC    AL2(AXG$TAXM_HST-AXG$TRN)                                        
         DC    X'00'                                                            
*                                                                               
TAXTAB   DS    0D                                                               
GST      DC    X'80',CL14'M00034',CL14'M00035'                                  
QST      DC    X'40',CL14'M00030',CL14'M00031'                                  
HST      DC    X'20',CL14'M00028',CL14'M00029'                                  
         DC    X'00',CL14'M00028',CL14'M00029'                                  
*                                                                               
DUBGST   DS    PL8                 GST TAX AMOUNT                               
DUBQST   DS    PL8                 QST TAX AMOUNT                               
DUBHST   DS    PL8                 HST TAX AMOUNT                               
*                                                                               
* VARIANCE TABLE                                                                
*                                                                               
VARTAB   DS    0CL14                                                            
         DC    CL14'STBPAYADJ'                                                  
         DC    CL14'SSBPAYADJ'                                                  
         DC    CL14'STTSLUSH'                                                   
         DC    CL14'SSTSLUSH'                                                   
         DC    CL14'STZPAYADJ'                                                  
         DC    CL14'SSZPAYADJ'                                                  
         DC    CL14'SSZZZZZ'                                                    
         DC    CL14'STZZZZZ'                                                    
         DC    X'00'                                                            
                                                                                
*                                                                               
FXTAB    DS    0C                                                               
         DC    C'P',CL11'0999',C'USD'                                           
         DC    C'P',CL11'0991',C'GBP'                                           
         DC    C'P',CL11'0992',C'EUR'                                           
         DC    C'P',CL11'0993',C'JPY'                                           
         DC    C'P',CL11'0994',C'MXN'                                           
         DC    C'S',CL11'999',C'USD'                                            
         DC    C'S',CL11'991',C'GBP'                                            
         DC    C'S',CL11'992',C'EUR'                                            
         DC    C'S',CL11'993',C'JPY'                                            
         DC    C'S',CL11'994',C'MXN'                                            
         DC    X'00'                                                            
*                                                                               
PXTAB    DS    0CL12                                                            
         DC    C'P',CL11'7778',CL14'M00035'     REVENUE                         
         DC    X'00'                                                            
         EJECT                                                                  
GODATCON NTR1                                                                   
         MVC   WORK(6),MYSPACES                                                 
         OC    0(2,R4),0(R4)       IF Y/M ARE ZERO, EXIT                        
         JZ    EXIT                                                             
         GOTO1 VDATCON,DMCB,(1,(R4)),(X'20',WORK)                               
         J     EXIT                                                             
         EJECT                                                                  
*===========================================================                    
* GET ADDRESSES OF ELEMENTS THAT MAY BE USED                                    
*===========================================================                    
                                                                                
GETELEMS NTR1                                                                   
         LA    R4,ELLIST                                                        
*                                                                               
GETELEM2 MVC   ELCODE,0(R4)                                                     
         LA    R5,TRNRFST          R5=A(FIRST ELEMENT)                          
         BRAS  RE,FRSTEL                                                        
         JNE   GETELEM4                                                         
         XR    RE,RE                                                            
         ICM   RE,7,1(R4)                                                       
         ST    R5,0(RE)            SAVE ELEM ADDR                               
*                                                                               
GETELEM4 LA    R4,4(R4)                                                         
         CLI   0(R4),X'FF'                                                      
         JNE   GETELEM2                                                         
         J     EXIT                                                             
         DS    0A                                                               
ELLIST   DS    0XL24                                                            
         DC    X'1A',AL3(AMDTEL)                                                
         DC    X'23',AL3(AOTHEL)                                                
         DC    X'2C',AL3(ASPAEL)                                                
         DC    X'30',AL3(ARSTEL)                                                
         DC    X'44',AL3(ATRNEL)                                                
         DC    X'46',AL3(AXPYEL)                                                
         DC    X'4C',AL3(ASPDEL)                                                
         DC    X'4F',AL3(ACPJEL)                                                
         DC    X'50',AL3(ASCIEL)                                                
         DC    X'60',AL3(ATRSEL)                                                
         DC    X'61',AL3(ADUEEL)                                                
         DC    X'63',AL3(AGLDEL)                                                
         DC    X'65',AL3(AANOEL)                                                
         DC    X'6A',AL3(AMDPEL)                                                
         DC    X'77',AL3(APTAEL)                                                
         DC    X'97',AL3(AEXOEL)                                                
         DC    X'BA',AL3(ALNKEL)                                                
         DC    X'C0',AL3(AAPEEL)                                                
         DC    X'C5',AL3(ARFLEL)                                                
         DC    X'D4',AL3(APAKEL)                                                
         DC    X'D9',AL3(ARALEL)                                                
         DC    X'DB',AL3(AFFTEL)                                                
         DC    X'E5',AL3(AGDAEL)                                                
         DC    X'F3',AL3(AMBIEL)                                                
         DC    X'FF',AL3(0)                                                     
*                                                                               
ELADDRS  DS    0A                                                               
AANOEL   DS    A                                                                
AAPEEL   DS    A                                                                
ACPJEL   DS    A                                                                
ASCIEL   DS    A                                                                
ADUEEL   DS    A                                                                
AEXOEL   DS    A                                                                
AFFTEL   DS    A                                                                
AGDAEL   DS    A                                                                
AGLDEL   DS    A                                                                
ALNKEL   DS    A                                                                
AMBIEL   DS    A                                                                
AMDPEL   DS    A                                                                
AMDTEL   DS    A                                                                
AOTHEL   DS    A                                                                
APAKEL   DS    A                                                                
APTAEL   DS    A                                                                
ARALEL   DS    A                                                                
ARFLEL   DS    A                                                                
ARSTEL   DS    A                                                                
ASPAEL   DS    A                                                                
ASPDEL   DS    A                                                                
ATRNEL   DS    A                                                                
ATRSEL   DS    A                                                                
AXPYEL   DS    A                                                                
ELADDRX  EQU   *                                                                
         EJECT                                                                  
*==========================================================                     
* FIND THE OFFICE CODE                                                          
*==========================================================                     
                                                                                
         USING TRNRECD,R3                                                       
GETOFFC  NTR1                                                                   
         CLC   =C'SJ',TRNKUNT                                                   
         JE    GETOFF2                                                          
         L     R5,ATRNEL                                                        
         MVC   AXG$OFFC,TRNOFFC-TRNEL(R5)                                       
         CLI   AXG$OFFC,C' '                                                    
         JH    EXIT                                                             
*                                                                               
GETOFF2  LT    R5,AGLDEL                                                        
         JZ    GETOFF4                                                          
         MVC   AXG$OFFC,GLDOFFC-GLDEL(R5)                                       
         CLC   AXG$OFFC,MYSPACES   DID WE GET AN OFFICE FROM THE GB EL?         
         JNH   GETOFF4                                                          
         J     EXIT                                                             
*                                                                               
GETOFF4  LT    R5,APAKEL                                                        
         JZ    GETOFF6                                                          
         MVC   AXG$OFFC,PAKOFF-PAKEL(R5)                                        
         CLC   AXG$OFFC,MYSPACES   DID WE GET AN OFFICE FROM THE PAY?           
         JNH   GETOFF6                                                          
         J     EXIT                                                             
*                                                                               
GETOFF6  LT    R5,AANOEL                                                        
         JZ    EXIT                                                             
         MVC   AXG$OFFC,ANOOFFC-ANOELD(R5)                                      
         J     EXIT                                                             
         EJECT                                                                  
*===========================================================                    
* GET INVOICE NUMBER                                                            
*===========================================================                    
                                                                                
GETINV   NTR1                                                                   
         L     R5,ATRNEL                                                        
         CLI   LDGVWXY,C'Y'        IS IT SV,SW,SX,SY                            
         JNE   GETINV2                                                          
         MVC   AXG$INV(L'TRNREF),TRNREF-TRNELD(R5)                              
         J     GETINVX                                                          
*                                                                               
GETINV2  LT    R5,AXPYEL                                                        
         JZ    GETINV10                                                         
         CLI   LDGPQSTU,C'Y'       IS IT SP,SQ,SS,ST,SU                         
         JNE   GETINV10                                                         
         MVC   AXG$INV(L'XPYINV),XPYINV-XPYELD(R5)                              
         J     GETINVX                                                          
*                                                                               
GETINV10 LT    R5,AFFTEL                                                        
         JZ    GETINVX                                                          
         MVI   ELCODE,FFTELQ                                                    
*                                                                               
GETINV12 CLI   FFTTYPE-FFTEL(R5),FFTTINVN                                       
         JE    GETINV14                                                         
         BRAS  RE,NEXTEL                                                        
         JE    GETINV12                                                         
         J     GETINVX                                                          
*                                                                               
GETINV14 LLC   RE,FFTDLEN-FFTEL(R5)  GET TEXT LEN                               
         CHI   RE,L'AXG$INV                                                     
         JNH   *+8                                                              
         LA    RE,L'AXG$INV                                                     
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   AXG$INV(0),FFTDATA-FFTEL(R5)                                     
*                                                                               
GETINVX  J     EXIT                                                             
         EJECT                                                                  
*===============================================================                
* MATCH TEXT IN NARRATIVE ELEMENT TO TABLE ENTRIES                              
* WRITE-OFF #SS11 DATE APR26/12 A/C SES0303 SHIRL SE                            
*===============================================================                
GETNARR  NTR1                                                                   
*                                                                               
         L     R5,ATRNEL                                                        
         USING TRNELD,R5                                                        
         LLC   R0,1(R5)            GET ELEMENT LENGTH                           
         AHI   R0,-TRNLN1Q         - LEN TO START OF NARRATIVE                  
         JNP   NEQXIT                                                           
         CHI   R0,12              NEED AT LEAST 12 CHARS                        
         JNH   NEQXIT                                                           
         LA    R1,TRNNARR                                                       
         STM   R0,R1,DUB                                                        
*                                                                               
         CLI   DRORCR,C'C'         TEST CREDIT                                  
         JNE   GETN30                                                           
*                                                                               
* ROUTINES PRIOR TO GETN30 ARE FOR CREDITS ONLY!                                
*                                                                               
         LA    R0,12                                                            
         LA    R1,=CL12'CHECK NUMBER'                                           
         BAS   RE,NARRSCAN                                                      
         JNE   GETN10                                                           
*                                                                               
         MVC   AXG$CHEK,13(R5)                                                  
*                                                                               
         LA    R1,AXG$CHEK                                                      
         LA    R0,L'AXG$CHEK                                                    
         BAS   RE,GETBLNK                                                       
*                                                                               
GETN04   LA    R0,5                                                             
         LA    R1,=C'DATED'                                                     
         BAS   RE,NARRSCAN                                                      
         JNE   GETN06                                                           
         LA    R0,6(R5)                                                         
         BAS   RE,NARRDT                                                        
         MVC   AXG$CKDT,WORK                                                    
*                                                                               
GETN06   LA    R0,12                                                            
         LA    R1,=CL12'DEPOSITED ON'                                           
         BAS   RE,NARRSCAN                                                      
         JNE   GETN10                                                           
         LA    R0,13(R5)           POINT TO DATE                                
         BAS   RE,NARRDT                                                        
         MVC   AXG$DPDT,WORK                                                    
*                                                                               
GETN10   LA    R0,17                                                            
         LA    R1,=CL17'WRITE-OFF ACCOUNT'    ??????????                        
         BAS   RE,NARRSCAN                                                      
         JNE   GETN12                                                           
         MVC   AXG$WOAC,18(R5)     WRITE-OFF ACCOUNT                            
         LA    R0,L'AXG$WOAC                                                    
         LA    R1,AXG$WOAC                                                      
         BAS   RE,GETBLNK                                                       
         J     GETN14                                                           
*                                                                               
GETN12   LA    R0,11                                                            
         LA    R1,=CL11'WRITE-OFF #'                                            
         BAS   RE,NARRSCAN                                                      
         JNE   GETN20                                                           
         MVC   AXG$WONU,11(R5)     WRITE-OFF NUM (NO SPACE AFTER #)             
         LA    R0,L'AXG$WONU                                                    
         LA    R1,AXG$WONU                                                      
         BAS   RE,GETBLNK                                                       
*                                                                               
GETN14   LA    R0,4                                                             
         LA    R1,=CL4'DATE'                                                    
         BAS   RE,NARRSCAN                                                      
         JNE   GETN16                                                           
         LA    R0,5(R5)            WRITE-OFF DATE (TEXT2)                       
         BAS   RE,NARRDT                                                        
         MVC   AXG$WODT,WORK                                                    
*                                                                               
GETN16   LA    R0,3                                                             
         LA    R1,=CL3'A/C'                                                     
         BAS   RE,NARRSCAN                                                      
         JNE   GETN18                                                           
         MVC   AXG$WOAC,4(R5)                                                   
*                                                                               
GETN18   LA    R0,9                                                             
         LA    R1,=CL9'REFERENCE'                                               
         BAS   RE,NARRSCAN                                                      
         JNE   GETN20                                                           
         MVC   AXG$WONU,10(R5)     WRITE-OFF NUMBER                             
*                                                                               
GETN20   LA    R0,9                                                             
         LA    R1,=CL9'OFFSET ON'                                               
         BAS   RE,NARRSCAN                                                      
         JNE   GETN30                                                           
         LA    R0,10(R5)           TRANSFER DATE                                
         BAS   RE,NARRDT                                                        
         MVC   AXG$OFDT,WORK                                                    
*                                                                               
GETN30   LA    R0,14                                                            
         LA    R1,=C'TRANSFERRED TO'                                            
         BAS   RE,NARRSCAN                                                      
         JNE   GETN40                                                           
         MVC   AXG$XFAC,15(R5)     TRANSFER TO ACCOUNT                          
*                                                                               
GETN40   LA    R0,15                                                            
         LA    R1,=CL15'CHECK VOIDED ON'                                        
         BAS   RE,NARRSCAN                                                      
         JNE   GETNX                                                            
         LA    R0,16(R5)           VOID DATE                                    
         BAS   RE,NARRDT                                                        
         MVC   AXG$VDDT,WORK                                                    
*                                                                               
GETNX    J     EXIT                                                             
*                                                                               
* CONVERT MMMDD/YY  --> YYMMDD - NO FUNNIES                                     
*                                                                               
NARRDT   NTR1                                                                   
         GOTO1 VDATVAL,DMCB,(0,(R0)),(X'80',WORK)                               
         J     EXIT                                                             
*                                                                               
* FIND LAST CHAR AND SET BLANKS AFTER IT                                        
*                                                                               
GETBLNK  CLI   0(R1),C' '                                                       
         JNH   GETBLNK4                                                         
         LA    R1,1(R1)                                                         
         JCT   R0,GETBLNK                                                       
         BR    RE                                                               
*                                                                               
GETBLNK2 MVI   0(R1),C' '                                                       
*                                                                               
GETBLNK4 LA    R1,1(R1)                                                         
         JCT   R0,GETBLNK2                                                      
         BR    RE                                                               
                                                                                
*==========================================================                     
* DUB+0 IS ADDRESS OF NARRATIVE                                                 
* DUB+4 IS LENGTH OF NARRATIVE                                                  
* R0 IS LENGTH OF SEARCH STRING                                                 
* R1 IS ADDRESS OF TEXT STRING                                                  
*==========================================================                     
                                                                                
NARRSCAN NTR1                                                                   
         LM    R4,R5,DUB           NARRATIVE LENGTH/ADDRESS                     
         LR    RE,R0               GET SEARCH STRING LENGTH                     
         BCTR  RE,0                                                             
*                                                                               
NARRSCN2 EX    RE,*+8              MATCH TEXT 1                                 
         J     *+10                                                             
         CLC   0(0,R1),0(R5)       SEARCH STRING TO NARR                        
         JE    NARRSCNX                                                         
         LA    R5,1(R5)                                                         
         CR    R4,RE               ENOUGH CHARS LEFT TO MATCH?                  
         JNH   NEQXIT                                                           
         JCT   R4,NARRSCN2                                                      
         J     NEQXIT                                                           
*                                                                               
NARRSCNX XIT1 REGS=(R5)                                                         
*                                                                               
CVD      CVD   R0,DUB                                                           
         LTR   R0,R0                                                            
         BM    *+8                                                              
         OI    DUB+7,X'0F'                                                      
         UNPK  P16,DUB                                                          
         BR    RE                                                               
*                                                                               
*** CAN BE CALLED ONLY FROM AXTRNS!!!! ***                                      
TRNCVDP  EDIT  (P8,DUB),P16,2,FLOAT=-,COMMAS=NO,ZERO=NOBLANK,          X        
               ALIGN=LEFT                                                       
         BR    RE                                                               
         PRINT NOGEN                                                            
         EJECT                                                                  
AXTRNTAB DS    0H                                                               
         DC    AL2(AXG#05-AXG$TRN)                                              
         DC    AL2(AXG#06-AXG$TRN)                                              
         DC    AL2(AXG#07-AXG$TRN)                                              
         DC    AL2(AXG#08-AXG$TRN)                                              
         DC    AL2(AXG#09-AXG$TRN)                                              
         DC    AL2(AXG#10-AXG$TRN)                                              
         DC    AL2(AXG#11-AXG$TRN)                                              
         DC    AL2(AXG#12-AXG$TRN)                                              
         DC    AL2(AXG#13-AXG$TRN)                                              
         DC    AL2(AXG#14-AXG$TRN)                                              
         DC    AL2(AXG#15-AXG$TRN)                                              
         DC    AL2(AXG#16-AXG$TRN)                                              
         DC    AL2(AXG#17-AXG$TRN)                                              
         DC    AL2(AXG#18-AXG$TRN)                                              
         DC    AL2(AXG#19-AXG$TRN)                                              
         DC    AL2(AXG#20-AXG$TRN)                                              
         DC    AL2(AXG#21-AXG$TRN)                                              
         DC    AL2(AXG#22-AXG$TRN)                                              
         DC    AL2(AXG#23-AXG$TRN)                                              
         DC    AL2(AXG#24-AXG$TRN)                                              
         DC    AL2(AXG#25-AXG$TRN)                                              
         DC    AL2(AXG#26-AXG$TRN)                                              
         DC    AL2(AXG#27-AXG$TRN)                                              
         DC    AL2(AXG#28-AXG$TRN)                                              
         DC    AL2(AXG#29-AXG$TRN)                                              
         DC    AL2(AXG#30-AXG$TRN)                                              
         DC    AL2(AXG#31-AXG$TRN)                                              
         DC    AL2(AXG#32-AXG$TRN)                                              
         DC    AL2(AXG#33-AXG$TRN)                                              
         DC    AL2(AXG#34-AXG$TRN)                                              
         DC    AL2(AXG#35-AXG$TRN)                                              
         DC    AL2(AXG#36-AXG$TRN)                                              
         DC    AL2(AXG#37-AXG$TRN)                                              
         DC    AL2(AXG#38-AXG$TRN)                                              
         DC    AL2(AXG#39-AXG$TRN)                                              
         DC    AL2(AXG#40-AXG$TRN)                                              
         DC    AL2(AXG#41-AXG$TRN)                                              
         DC    AL2(AXG#42-AXG$TRN)                                              
         DC    AL2(AXG#43-AXG$TRN)                                              
         DC    AL2(AXG#44-AXG$TRN)                                              
         DC    AL2(AXG#45-AXG$TRN)                                              
         DC    AL2(AXG#46-AXG$TRN)                                              
         DC    AL2(AXG#47-AXG$TRN)                                              
         DC    AL2(AXG#48-AXG$TRN)                                              
         DC    AL2(AXG#49-AXG$TRN)                                              
         DC    AL2(AXG#50-AXG$TRN)                                              
         DC    AL2(AXG#51-AXG$TRN)                                              
         DC    AL2(AXG#52-AXG$TRN)                                              
         DC    AL2(AXG#53-AXG$TRN)                                              
         DC    AL2(AXG#54-AXG$TRN)                                              
         DC    AL2(AXG#55-AXG$TRN)                                              
         DC    AL2(AXG#56-AXG$TRN)                                              
         DC    AL2(AXG#57-AXG$TRN)                                              
         DC    AL2(AXG#58-AXG$TRN)                                              
         DC    AL2(AXG#59-AXG$TRN)                                              
         DC    AL2(AXG#60-AXG$TRN)                                              
         DC    AL2(AXG#61-AXG$TRN)                                              
         DC    AL2(AXG#62-AXG$TRN)                                              
         DC    AL2(AXG#63-AXG$TRN)                                              
         DC    AL2(AXG#64-AXG$TRN)                                              
         DC    AL2(AXG#65-AXG$TRN)                                              
         DC    AL2(AXG#66-AXG$TRN)                                              
         DC    AL2(AXG#67-AXG$TRN)                                              
         DC    AL2(AXG#68-AXG$TRN)                                              
         DC    AL2(AXG#69-AXG$TRN)                                              
AXTRNTBX EQU   *                                                                
         EJECT                                                                  
         LTORG                                                                  
       ++INCLUDE AXRECIDG                                                       
         EJECT                                                                  
       ++INCLUDE MXTRT                                                          
         EJECT                                                                  
*===========================================================                    
* SET LEDGER                                                                    
*===========================================================                    
                                                                                
SETLDGR  NTR1  BASE=*,LABEL=*                                                   
         MVI   LDG,0                                                            
         MVI   LDGVWXY,C'N'                                                     
         MVI   LDGPQSTU,C'N'                                                    
*                                                                               
         BAS   RE,CHKRCV                                                        
         BNE   *+8                                                              
         OI    LDG,RCVLDGQ                                                      
*                                                                               
         BAS   RE,CHKPAY                                                        
         BNE   *+8                                                              
         OI    LDG,PAYLDGQ                                                      
*                                                                               
         BAS   RE,CHKINC                                                        
         BNE   *+8                                                              
         OI    LDG,INCLDGQ                                                      
*                                                                               
         BAS   RE,CHKEXP                                                        
         BNE   *+8                                                              
         OI    LDG,EXPLDGQ                                                      
*                                                                               
         BAS   RE,CHKMED                                                        
         BNE   *+8                                                              
         OI    LDG,MEDLDGQ                                                      
*                                                                               
         CLC   =C'SC',TRNKUNT                                                   
         BNE   *+8                                                              
         OI    LDG,SCLDGQ                                                       
*                                                                               
         CLC   =C'SE',TRNKUNT                                                   
         BNE   *+8                                                              
         OI    LDG,SELDGQ                                                       
*                                                                               
         CLC   =C'SJ',TRNKUNT                                                   
         BNE   *+8                                                              
         OI    LDG,SJLDGQ                                                       
*                                                                               
         BAS   RE,CHKPQST                                                       
         BNE   *+8                                                              
         MVI   LDGPQSTU,C'Y'                                                    
*                                                                               
         BAS   RE,CHKVWXY                                                       
         BNE   *+8                                                              
         MVI   LDGVWXY,C'Y'                                                     
*                                                                               
         J     EXIT                                                             
*                                                                               
RCVLDGQ  EQU   X'80'                                                            
PAYLDGQ  EQU   X'40'                                                            
INCLDGQ  EQU   X'20'                                                            
EXPLDGQ  EQU   X'10'                                                            
MEDLDGQ  EQU   X'08'                                                            
SCLDGQ   EQU   X'04'                                                            
SJLDGQ   EQU   X'02'                                                            
SELDGQ   EQU   X'01'                                                            
*                                                                               
BE       EQU   X'80'               BRANCH EQUAL                                 
BNE      EQU   X'70'               BRANCH NOT EQUAL                             
*                                                                               
CHKRCV   LA    R1,RCVLDG                                                        
         LA    R0,(RCVLDGX-RCVLDG)/2                                            
         B     CHKLDG                                                           
*                                                                               
CHKPAY   LA    R1,PAYLDG                                                        
         LA    R0,(PAYLDGX-PAYLDG)/2                                            
         B     CHKLDG                                                           
*                                                                               
CHKINC   LA    R1,INCLDG                                                        
         LA    R0,(INCLDGX-INCLDG)/2                                            
         B     CHKLDG                                                           
*                                                                               
CHKEXP   LA    R1,EXPLDG                                                        
         LA    R0,(EXPLDGX-EXPLDG)/2                                            
         B     CHKLDG                                                           
*                                                                               
CHKMED   LA    R1,MEDLDG                                                        
         LA    R0,(MEDLDGX-MEDLDG)/2                                            
         B     CHKLDG                                                           
*                                                                               
CHKPQST  LA    R1,PQSTULST                                                      
         LA    R0,(PQSTULSTX-PQSTULST)/2                                        
         B     CHKLDG                                                           
*                                                                               
CHKVWXY  LA    R1,VWXYLST                                                       
         LA    R0,(VWXYLSTX-VWXYLST)/2                                          
         B     CHKLDG                                                           
*                                                                               
CHKLDG   CLC   TRNKUNT(2),0(R1)                                                 
         BER   RE                                                               
         LA    R1,2(R1)                                                         
         BCT   R0,CHKLDG                                                        
         LTR   RB,RB                                                            
         BR    RE                                                               
*                                                                               
RCVLDG   DC    C'SBSR'                                                          
RCVLDGX  EQU   *                                                                
INCLDG   DC    C'SI'                                                            
INCLDGX  EQU   *                                                                
PAYLDG   DC    C'SPSQSSSTSUSVSWSXSY'                                            
PAYLDGX  EQU   *                                                                
EXPLDG   DC    C'SBSE'                                                          
EXPLDGX  EQU   *                                                                
MEDLDG   DC    C'SZ'                                                            
MEDLDGX  EQU   *                                                                
*                                                                               
PQSTULST DC    C'SPSQSSSTSU'                                                    
PQSTULSTX EQU  *                                                                
VWXYLST  DC    C'SVSWSXSY'                                                      
VWXYLSTX EQU   *                                                                
         LTORG                                                                  
*==============================================================                 
* EXTRACT CLIENT CODE                                                           
*==============================================================                 
                                                                                
         USING TRNRECD,R3                                                       
GETCLT   NTR1  BASE=*,LABEL=*                                                   
         MVI   MEDPYBL,C'N'                                                     
         MVI   ITMREP,C'N'         ASSUME IT'S NOT A REP                        
*                                                                               
*==============>                                                                
*==============>                                                                
*==============>                                                                
         CP    SEQNUM,IDFSEQ                                                    
         JNE   GETC0                                                            
         J     GETC0                                                            
IDFSEQ   DC    PL4'991'                                                         
*==============>                                                                
*==============>                                                                
*==============>                                                                
*                                                                               
GETC0    CLC   =C'SJ',TRNKCUNT                                                  
         JNE   *+10                                                             
         MVC   AXG$CLT,TRNKCACT                                                 
*                                                                               
         CLI   AXG$CLT,C' '                                                     
         JH    GETCLTX                                                          
*                                                                               
GETC2    LT    R5,AMDTEL                                                        
         JNZ   GETC4                                                            
         LT    R5,AMDPEL                                                        
         JZ    GETC6                                                            
*                                                                               
GETC4    MVC   AXG$CLT,MDTCLI-MDTEL(R5)                                         
         CLI   AXG$CLT,C' '                                                     
         JH    GETCLTX                                                          
*                                                                               
GETC6    LT    R5,ACPJEL                                                        
         JZ    GETC8                                                            
         CLI   CPJTYPE-CPJELD(R5),C'J'        TEST PRODUCTION                   
         JNE   GETC8                                                            
         MVC   AXG$CLT,CPJCLI-CPJELD(R5)                                        
         J     GETCLTX                                                          
*                                                                               
GETC8    CLC   =C'SR',TRNKCACT     TEST CONTRA=SR                               
         JNE   GETC10                                                           
         CLI   SRLDGCLT,0          TEST CLIENT CODE IN SR                       
         JE    GETC10                                                           
         LLC   RE,SRLDGCLT                                                      
         LA    RE,TRNKCACT(RE)     POINT TO CLIENT IN CONTRA                    
         MVC   AXG$CLT,0(RE)                                                    
         J     GETCLTX                                                          
*                                                                               
GETC10   CLI   LDGCLT,0            TEST ACCOUNT HAS CLT CODE                    
         JE    GETC12              NO                                           
         LLC   RE,LDGCLT                                                        
         LA    RE,TRNKACT-1(RE)    POINT TO CLIENT IN ACCT                      
         MVC   AXG$CLT,0(RE)                                                    
         J     GETCLTX                                                          
*                                                                               
GETC12   TM    LDG,SCLDGQ                                                       
         JZ    GETC16                                                           
*                                                                               
         LRL   R5,ATRNEL                                                        
         CLI   TRNTYPE-TRNEL(R5),33                                             
         JE    GETC14                                                           
         CLI   TRNTYPE-TRNEL(R5),34                                             
         JE    GETC14                                                           
         CLI   TRNTYPE-TRNEL(R5),35                                             
         JNE   GETC15                                                           
GETC14   MVC   AXG$CLT,TRNKCACT+2  FORMAT IS T/CLT/PRD                          
         J     GETC16                                                           
*                                                                               
GETC15   LT    R5,ASPDEL                                                        
         JZ    GETC16                                                           
         CLC   =C'SJ',SPDACCS-SPDEL(R5)                                         
         JNE   GETC16                                                           
         MVC   AXG$CLT,SPDACCS+2-SPDEL(R5)                                      
         J     GETCLTX                                                          
*                                                                               
GETC16   CLC   =C'SB',TRNKUNT                                                   
         JE    *+14                                                             
         CLC   =C'SE',TRNKUNT                                                   
         JNE   GETC18                                                           
*                                                                               
         LT    R5,AEXOEL                                                        
         JZ    GETC18                                                           
         MVC   AXG$CLT,EXOCLI-EXOEL(R5)                                         
         J     GETCLTX                                                          
*                                                                               
GETC18   LT    R5,AFFTEL                                                        
         JZ    GETC20                                                           
         MVC   ELCODE,0(R5)                                                     
*                                                                               
GETC18A  CLI   FFTTYPE-FFTEL(R5),FFTTCLPR                                       
         JE    GETC18X                                                          
         BRAS  RE,NEXTEL                                                        
         JE    GETC18A                                                          
         J     GETC20                                                           
*                                                                               
GETC18X  MVC   AXG$CLT,FFTCLAC-FFTEL(R5)                                        
         J     GETCLTX                                                          
*                                                                               
GETC20   CLC   =C'SJ',TRNKUNT                                                   
         JNE   *+14                                                             
         MVC   AXG$CLT,TRNKACT                                                  
         J     GETCLTX                                                          
*                                                                               
         LRL   R5,ATRNEL           NOW TEST FOR MEDIA PAYABLE                   
         MVI   ITMREP,C'N'         ASSUME IT'S NOT A REP                        
         CLI   TRNTYPE-TRNEL(R5),12                                             
         JE    GETC22                                                           
         CLI   TRNTYPE-TRNEL(R5),33                                             
         JE    GETC22                                                           
         MVI   ITMREP,C'Y'         FOR SPOT/NET 34/35 ARE REPS                  
         CLI   TRNTYPE-TRNEL(R5),34                                             
         JE    GETC22                                                           
         CLI   TRNTYPE-TRNEL(R5),35                                             
         JE    GETC22                                                           
         MVI   ITMREP,C'N'         FOR PRINT 49 IS NOT A REP                    
         CLI   TRNTYPE-TRNEL(R5),49                                             
         JE    GETC22                                                           
         MVI   ITMREP,C'Y'         BUT 50 IS                                    
         CLI   TRNTYPE-TRNEL(R5),50                                             
         JE    GETC22                                                           
         MVI   ITMREP,C'N'         FOR TYPE 13, CHECK TO SEE IF REP             
         CLI   TRNTYPE-TRNEL(R5),13                                             
         JNE   GETC30                                                           
         TM    LDG,PAYLDGQ                                                      
         JZ    GETC30                                                           
         CLI   TRNKCACT,X'40'      IS THERE SOMETHING IN CONTRA?                
         JNH   GETC22                                                           
         MVI   ITMREP,C'Y'                                                      
*                                                                               
GETC22   MVI   MEDPYBL,C'Y'                                                     
         MVC   AXG$CLT,TRNKCACT+9                                               
         LA    RE,TRNKACT+1                                                     
         LA    R1,7                SET INITIAL LENGTH                           
         CLI   AXG$SYS,C'S'        FOR NET PAYABLES, SET LENGTH AS 4            
         JNE   *+16                                                             
         CLI   TRNKACT,C'N'                                                     
         JNE   *+8                                                              
         LA    R1,3                SET INITIAL LENGTH                           
         CLI   ITMREP,C'Y'         IS ITEM A REP?                               
         JNE   GETC24                                                           
         LA    RE,TRNKULC                                                       
         CLI   AXG$SYS,C'P'                                                     
         BE    GETC24                                                           
         LA    RE,TRNKCACT+1                                                    
GETC24   MVC   AXG$NETW(0),0(RE)                                                
         EX    R1,*-6                                                           
         J     GETCLTX                                                          
*                                                                               
GETC30   TM    LDG,PAYLDGQ                                                      
         JZ    GETCLTX                                                          
         LT    R5,ALNKEL                                                        
         JZ    *+10                                                             
         MVC   AXG$CLT,LNKAGJB+2-LNKELD(R5)                                     
*                                                                               
GETCLTX  XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
*==============================================================                 
* EXTRACT PRODUCT CODE                                                          
*==============================================================                 
                                                                                
         USING TRNRECD,R3                                                       
GETPRD   NTR1  BASE=*,LABEL=*                                                   
         MVC   AXG$PRD,MYSPACES    INIT FIELD TO SPACES                         
         MVC   AXG$PRD(3),AXG$CLT  NO KIDDING - CONCATENATE!                    
         CLI   AXG$PRD,C' '        IF NO CLIENT                                 
         JNH   GETPRDX             THEN CERTAINLY NO PRODUCT!                   
*                                                                               
         CLC   =C'SJ',TRNKCUNT                                                  
         JNE   *+14                                                             
         MVC   AXG$PRD+3(3),TRNKCACT+3                                          
         J     GETP2                                                            
*                                                                               
GET      CLC   =C'SJ',TRNKUNT                                                   
         JNE   *+10                                                             
         MVC   AXG$PRD+3(3),TRNKACT+3                                           
*                                                                               
GETP2    CLI   AXG$PRD+3,C' '                                                   
         JH    GETPRDX                                                          
*                                                                               
         TM    LDG,PAYLDGQ                                                      
         JZ    GETP4                                                            
         CLI   MEDPYBL,C'Y'        IS IT A MEDIA PAYABLE                        
         JNE   GETP4               NO                                           
         MVC   AXG$PRD+3(3),TRNKREF                                             
         OI    AXG$PRD+5,X'40'                                                  
         J     GETPRDX                                                          
*                                                                               
GETP4    LT    R5,AMDTEL                                                        
         JNZ   *+14                                                             
         LT    R5,AMDPEL                                                        
         JZ    GETP6                                                            
         MVC   AXG$PRD+3(3),MDTPRD-MDTELD(R5)                                   
*                                                                               
GETP6    CLI   AXG$PRD+3,C' '                                                   
         JH    GETPRDX                                                          
*                                                                               
         LT    R5,AOTHEL                                                        
         JZ    GETP10                                                           
         TM    LDG,PAYLDGQ         TEST PAYABLE LEDGER                          
         JO    GETP8                                                            
         TM    LDG,SCLDGQ          OR SC                                        
         JO    GETP8                                                            
         CLI   OTHPROF-OTHELD(R5),C'P'                                          
         JE    GETP8                                                            
         CLI   OTHPROF-OTHELD(R5),C'S'                                          
         JE    GETP8                                                            
         CLI   OTHPROF-OTHELD(R5),C'J'                                          
         JNE   GETP10                                                           
         LRL   RE,ATRNEL                                                        
         CLI   TRNTYPE-TRNEL(RE),9   EXCLUDE TYPE 9                             
         JE    GETP10                                                           
*                                                                               
GETP8    MVC   AXG$PRD+3(3),OTHNUM-OTHELD(R5)                                   
*                                                                               
GETP10   CLI   AXG$PRD+3,C' '                                                   
         JH    GETPRDX                                                          
*                                                                               
         LT    R5,ACPJEL                                                        
         JZ    GETP12                                                           
         CLI   CPJTYPE-CPJEL(R5),C'J'                                           
         JNE   GETP12                                                           
         MVC   AXG$PRD+3(3),CPJPRO-CPJELD(R5)                                   
*                                                                               
GETP12   CLI   AXG$PRD+3,C' '                                                   
         JH    GETPRDX                                                          
*                                                                               
         CLC   =C'SJ',TRNKCULC                                                  
         JNE   GETP14                                                           
         MVC   AXG$PRD+3(3),TRNKCACT+3                                          
*                                                                               
GETP14   CLI   AXG$PRD+3,C' '                                                   
         JH    GETPRDX                                                          
*                                                                               
         TM    LDG,SCLDGQ                                                       
         JZ    GETP20                                                           
         LRL   R5,ATRNEL                                                        
         LA    R1,GETP8LST                                                      
         LA    R0,GETP8LSX-GETP8LST                                             
*                                                                               
GETP16   CLC   0(1,R1),TRNTYPE-TRNEL(R5)                                        
         JE    GETP18                                                           
         LA    R1,1(R1)                                                         
         JCT   R0,GETP16                                                        
         J     GETP20                                                           
*                                                                               
GETP18   MVC   AXG$PRD+3(3),TRNKCACT+3                                          
         J     GETP20                                                           
*                                                                               
GETP8LST DC    AL1(13,33,34,35,49,50)                                           
GETP8LSX EQU   *                                                                
*                                                                               
GETP20   TM    LDG,SCLDGQ          IS IT SC                                     
         JZ    GETP28                                                           
*                                                                               
         LRL   R5,ATRNEL                                                        
         CLI   TRNTYPE-TRNEL(R5),33                                             
         JE    GETP24                                                           
         CLI   TRNTYPE-TRNEL(R5),34                                             
         JE    GETP24                                                           
         CLI   TRNTYPE-TRNEL(R5),35                                             
         JNE   GETP24                                                           
GETP24   MVC   AXG$PRD,TRNKCACT+6  FORMAT IS T/CLT/PRD                          
         J     GETP28                                                           
*                                                                               
GETP26   LT    R5,ASPDEL                                                        
         JZ    GETP28                                                           
         CLC   =C'SJ',SPDACCS-SPDEL(R5)                                         
         JNE   GETP28                                                           
         MVC   AXG$PRD,SPDACCS+5-SPDEL(R5)                                      
*                                                                               
GETP28   CLI   AXG$PRD+3,C' '                                                   
         JH    GETPRDX                                                          
*                                                                               
         TM    LDG,EXPLDGQ         TEST EXPENSE LEDGER                          
         JZ    GETP30                                                           
         LT    R5,AEXOEL                                                        
         JZ    GETP30                                                           
         LRL   RE,ATRNEL                                                        
         CLI   TRNTYPE-TRNEL(RE),12                                             
         JNE   GETP30                                                           
         MVC   AXG$PRD+3(3),EXOPRO-EXOEL(R5)                                    
*                                                                               
GETP30   CLI   AXG$PRD+3,C' '                                                   
         JH    GETPRDX                                                          
*                                                                               
         LT    R5,AFFTEL                                                        
         JZ    GETPRDX                                                          
*                                                                               
         MVC   ELCODE,0(R5)                                                     
GETP34   CLI   FFTTYPE-FFTEL(R5),FFTTCLPR                                       
         JE    GETP36                                                           
         BRAS  RE,NEXTEL                                                        
         JE    GETP34                                                           
         J     GETPRDX                                                          
*                                                                               
GETP36   MVC   AXG$PRD+3(3),FFTPRAC-FFTEL(R5)                                   
         CLI   AXG$PRD+3,C' '                                                   
         JH    GETPRDX                                                          
*                                                                               
GETP38   TM    LDG,PAYLDGQ                                                      
         JZ    GETPRDX                                                          
         LT    R5,ALNKEL                                                        
         JZ    *+10                                                             
         MVC   AXG$PRD,LNKAGJB+5-LNKELD(R5)                                     
                                                                                
GETPRDX  CLC   AXG$PRD+3(3),MYSPACES DID WE GET A VALID PRODUCT?                
         JH    *+10                                                             
         MVC   AXG$PRD+3(3),MYSPACES SPACE OUT PRODUCT                          
         XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
*==============================================================                 
* EXTRACT ESTIMATE                                                              
*==============================================================                 
                                                                                
         USING TRNRECD,R3                                                       
GETEST   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         LRL   RE,ATRNEL                                                        
         CLI   TRNTYPE-TRNELD(RE),10  TYPE 10 DOES NOT HAVE EST                 
         JE    GETESTX                                                          
*                                                                               
         TM    LDG,PAYLDGQ+SCLDGQ  TEST CLEARANCE (PAYABLE+SC)                  
         JNZ   GETE2                                                            
         CLC   =C'SZ',TRNKULA      +SZ                                          
         JNE   GETE4                                                            
*                                                                               
GETE2    LRL   R5,ATRNEL                                                        
         CLI   TRNTYPE-TRNELD(R5),9  SKIP TYPE 9 TRANSACTIONS                   
         JE    GETE4                                                            
*                                                                               
         LT    R5,AXPYEL                                                        
         JZ    GETE4                                                            
         XR    R0,R0                                                            
         ICM   R0,3,XPYEST-XPYELD(R5)                                           
         JZ    GETE4                                                            
         CVD   R0,DUB                                                           
         EDIT  (R0),(3,AXG$EST),ALIGN=RIGHT,FILL=0                              
         J     GETEST20                                                         
*                                                                               
GETE4    LT    R5,AMDTEL                                                        
         JNZ   GETE6                                                            
         LT    R5,AMDPEL                                                        
         JZ    GETE10                                                           
*                                                                               
GETE6    CLI   MDTSYS-MDTEL(R5),C'J'  TEST PROD                                 
         JNE   GETE6X                 NO                                        
         LRL   RE,ATRNEL                                                        
         CLI   TRNTYPE-TRNELD(RE),9   TYPE 9 HAS ESTIMATE!                      
         JNE   GETE10                                                           
GETE6X   MVC   AXG$EST,MDTEST-MDTEL(R5)                                         
         J     GETEST20                                                         
*                                                                               
GETE10   LT    R5,AOTHEL                                                        
         JZ    GETEST20                                                         
         CLI   OTHPROF-OTHELD(R5),C'J'  NOT FOR PROD                            
         JE    GETEST20                                                         
         MVC   AXG$EST,OTHNUM-OTHELD(R5)                                        
*                                                                               
GETEST20 LT    R5,AFFTEL                                                        
         JZ    GETEST99                                                         
         MVI   ELCODE,FFTELQ                                                    
*                                                                               
GETEST22 CLI   FFTTYPE-FFTEL(R5),FFTTESTN                                       
         JE    GETEST24                                                         
         BRAS  RE,NEXTEL                                                        
         JE    GETEST22                                                         
         J     GETEST99                                                         
*                                                                               
GETEST24 MVC   AXG$EST,FFTOESTN-FFTEL(R5)  ESTIMATE NUMBER IN CHAR              
*                                                                               
GETEST99 CLC   AXG$EST,MYSPACES            DID WE GET AN ESTIMATE?              
         JH    GETESTX                                                          
         MVC   AXG$EST,=CL6'999999'        IF NOT SET-USE DEFAULT               
*                                                                               
GETESTX  XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
*===========================================================                    
* GET JOB NUMBER                                                                
*===========================================================                    
                                                                                
GETJOB   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         TM    LDG,SJLDGQ          TEST SJ                                      
         JZ    GETJ1                                                            
         MVC   AXG$JOB,TRNKACT+6   MOVE JOB FROM KEY                            
         J     GETJOBX                                                          
*                                                                               
GETJ1    TM    LDG,PAYLDGQ                                                      
         JZ    GETJ2                                                            
         LT    R5,AOTHEL                                                        
         JZ    GETJ2                                                            
         CLI   OTHNUM-OTHEL(R5),C' '                                            
         JNH   GETJ2                                                            
         MVC   AXG$JOB,OTHNUM+6-OTHELD(R5)                                      
         J     GETJOBX                                                          
*                                                                               
GETJ2    LT    R5,AMDTEL                                                        
         JNZ   *+14                                                             
         LT    R5,AMDPEL                                                        
         JZ    GETJ10                                                           
*                                                                               
         CLI   MDTSYS-MDTEL(R5),C'J'                                            
         JNE   GETJ4                                                            
         MVC   AXG$JOB,MDTJOB-MDTEL(R5)                                         
         J     GETJOBX                                                          
*                                                                               
GETJ4    CLI   MDTJOB+3-MDTEL(R5),C' '                                          
         JNH   GETJ10                                                           
*                                                                               
         LRL   RE,ATRNEL                                                        
         LA    R0,GETJ4LSX-GETJ4LST                                             
         LA    R1,GETJ4LST                                                      
*                                                                               
GETJ6    CLC   0(1,R1),TRNTYPE-TRNEL(RE)                                        
         JE    GETJ8                                                            
         LA    R1,1(R1)                                                         
         JCT   R0,GETJ6                                                         
         J     GETJ10                                                           
*                                                                               
GETJ4LST DC    AL1(26,30,55,56,58)                                              
GETJ4LSX EQU   *                                                                
*                                                                               
GETJ8    MVC   AXG$JOB,MDTJOB-MDTEL(R5)                                         
         J     GETJOBX                                                          
*                                                                               
GETJ10   LT    R5,AOTHEL                                                        
         JZ    GETJ12                                                           
         CLI   OTHPROF-OTHEL(R5),C'J'                                           
         JNE   GETJ12                                                           
         MVC   AXG$JOB,OTHNUM-OTHEL(R5)                                         
         J     GETJOBX                                                          
*                                                                               
GETJ12   LT    R5,ACPJEL                                                        
         JZ    GETJ14                                                           
         CLI   CPJTYPE-CPJEL(R5),C'J'                                           
         JNE   GETJ14                                                           
         MVC   AXG$JOB,CPJJOB-CPJEL(R5)                                         
         J     GETJOBX                                                          
*                                                                               
GETJ14   TM    LDG,SCLDGQ          IS IT SC                                     
         JZ    GETJ16                                                           
         LT    R5,ASPDEL                                                        
         JZ    GETJ16                                                           
         CLC   =C'SJ',SPDACCS-SPDEL(R5)                                         
         JNE   GETJ16                                                           
         MVC   AXG$JOB,SPDACCS+8-SPDEL(R5)                                      
         J     GETJOBX                                                          
*                                                                               
GETJ16   TM    LDG,SCLDGQ                                                       
         JZ    GETJ18                                                           
         LT    R5,AOTHEL                                                        
         JZ    GETJ18                                                           
         LRL   RE,ATRNEL                                                        
         CLI   TRNTYPE-TRNEL(RE),3    TYPE 3 TRANS ONLY                         
         JNE   GETJ18                                                           
         MVC   AXG$JOB,OTHNUM-OTHEL(R5)                                         
         J     GETJOBX                                                          
*                                                                               
GETJ18   TM    LDG,PAYLDGQ                                                      
         JZ    GETJOBX                                                          
         LT    R5,ALNKEL                                                        
         JZ    *+10                                                             
         MVC   AXG$JOB,LNKAGJB+8-LNKELD(R5)                                     
*                                                                               
GETJOBX  XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
*==========================================================                     
* EXTRACT THE MEDIA CODE FROM SOMEWHERE IN THE RECORD                           
*==========================================================                     
                                                                                
         USING TRNRECD,R3                                                       
GETMED   NTR1  BASE=*,LABEL=*                                                   
         CLC   =C'SJ',TRNKUNT                                                   
         JNE   GETM2                                                            
         MVC   AXG$MED,TRNKACT+6   FIRST CHAR OF JOB FOR SJ                     
         J     GETMEDX                                                          
                                                                                
GETM2    LT    R5,AMDTEL                                                        
         JZ    GETM4                                                            
         MVC   AXG$MED,MDTMED-MDTEL(R5)                                         
         CLI   AXG$MED,C' '                                                     
         JNE   GETMEDX                                                          
*                                                                               
         MVC   AXG$MED,MDTMED2-MDTEL(R5)                                        
         TM    MDTSTAT-MDTEL(R5),MDTSMIQ                                        
         JZ    GETM4                                                            
         CLI   AXG$MED,C' '                                                     
         JNE   GETMEDX                                                          
*                                                                               
GETM4    LT    R5,ACPJEL                                                        
         JZ    GETM6                                                            
         MVC   AXG$MED,CPJTYPE-CPJELD(R5)                                       
         CLI   AXG$MED,C' '                                                     
         JH    GETMEDX                                                          
*                                                                               
GETM6    LT    R5,AOTHEL                                                        
         JZ    GETM8                                                            
         MVC   AXG$MED,OTHPROF-OTHELD(R5)                                       
         CLC   =C'SJ',TRNKULC      TEST CONTRA IS SJ                            
         JNE   GETM6X                                                           
         MVC   AXG$MED,OTHNUM+6-OTHELD(R5)                                      
*                                                                               
GETM6X   CLI   AXG$MED,C' '                                                     
         JH    GETMEDX                                                          
*                                                                               
GETM8    LT    R5,AMBIEL                                                        
         JZ    GETM10                                                           
         MVC   AXG$MED,MBIMED-MBIELD(R5)                                        
         J     GETMEDX                                                          
*                                                                               
GETM10   TM    LDG,PAYLDGQ                                                      
         JZ    GETMEDX                                                          
         LA    R1,TRNKACT                                                       
         CLI   ITMREP,C'Y'         IS ITEM A REP?                               
         JE    *+14                                                             
         CLC   AXG$STYP,=C'VAR'    OR A VAR?                                    
         JNE   GETM15                                                           
         LA    R1,TRNKCACT                                                      
         CLI   AXG$SYS,C'P'        IS THIS PRINT?                               
         JNE   GETM15                                                           
         LA    R1,TRNKCCPY                                                      
GETM15   MVC   AXG$MED,0(R1)                                                    
*                                                                               
GETMEDX  XIT1                                                                   
*                                                                               
         EJECT                                                                  
         LTORG                                                                  
*                                                                               
NEXTEL   SR    R0,R0                                                            
         ICM   R0,1,1(R5)                                                       
         JNZ   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         AR    R5,R0                                                            
         CLI   0(R5),0                                                          
         JE    NEXTELX                                                          
*                                                                               
FRSTEL   CLC   ELCODE,0(R5)                                                     
         JNE   NEXTEL                                                           
         BR    RE                                                               
*                                                                               
NEXTELX  LTR   RB,RB                                                            
         BR    RE                                                               
         EJECT                                                                  
         USING AXG$TRN,R2                                                       
MVNARR   MVC   AXG$NARR(0),0(R1)                                                
         DROP  R2                                                               
MYMXTRTQ EQU   C'|'                                                             
*                                                                               
         EJECT                                                                  
*============================================================                   
* EXTRACT THE GIN FROM THE RECOVERY TRAILER                                     
*============================================================                   
                                                                                
         USING AXG$TRN,R2          R2=A(EXTRACT RECORD)                         
         USING TRNRECD,R3          R3=A(ACCFILE RECORD)                         
*                                                                               
GETGIN   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     RE,VDXBLOCK         A(EXTRACT CONTROL DATA BLOCK)                
         USING DXBLOCKD,RE                                                      
         MVC   DUB,DXRGIN                                                       
         OC    DUB,DUB                                                          
         JZ    GETGIN2                                                          
*                                                                               
         GOTO1 VHEXOUT,DMCB,DUB,AXG$GIN,4,=C'TOG'                               
         L     R0,DUB+4                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  AXG$GIN+8(8),DUB                                                 
         J     EXIT                                                             
*                                                                               
GETGIN2  J     EXIT                                                             
         LTORG                                                                  
*          DATA SET TAXROUTS   AT LEVEL 028 AS OF 02/24/11                      
         EJECT                                                                  
*          DATA SET TASYSVAL   AT LEVEL 185 AS OF 05/12/10                      
*=====================================================================          
*              SSNPCK - ENCRYPTS SS#                                            
*                                  P1=A(SS#)                                    
*                                  P2=A(PID)                                    
*                                    CC=EQ GOOD ENCRYPTION                      
*                                    CC=NEQ BAD ENCRYPTION                      
*=====================================================================          
                                                                                
SSNPCK   NTR1  BASE=*,LABEL=*                                                   
         L     R2,4(R1)                                                         
         MVC   0(6,R2),MYSPACES    BLANK OUT PID                                
*                                                                               
         LA    R4,9                TEST SS# FOR NON NUMERIC                     
         L     R3,0(R1)                                                         
SSNPCK5  CLI   0(R3),C'0'                                                       
         BL    *+12                                                             
         CLI   0(R3),C'9'                                                       
         BNH   SSNPCK7                                                          
         LTR   RB,RB               CC=NEQ                                       
         B     SSNPKXT                                                          
*                                                                               
SSNPCK7  LA    R3,1(R3)            BUMP TO NEXT CHAR                            
         BCT   R4,SSNPCK5                                                       
*                                                                               
         L     R3,0(R1)                                                         
         PACK  DUB,0(9,R3)         CONVERT CHARACTER SSN TO HEX SSN             
         NI    DUB+7,X'FC'                                                      
         CVB   RE,DUB                                                           
         ST    RE,FULL             FULL=HEX SSN                                 
*                                                                               
         LA    R3,6                6 DIGITS                                     
         L     R2,4(R1)            PID # ADDRESS                                
         LA    RF,BASE36TB                                                      
SSNPK10  CLI   0(RF),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'00'                                                            
         BAS   RE,SSNPCALC                                                      
         BNE   SSNPKXT                                                          
         MVC   0(1,R2),BYTE        NEXT DIGIT OF PID #                          
         LA    RF,L'BASE36TB(RF)                                                
         LA    R2,1(R2)                                                         
         BCT   R3,SSNPK10                                                       
         CR    RB,RB               CC=EQ                                        
*                                                                               
SSNPKXT  XIT1                                                                   
         EJECT                                                                  
*                                                                               
SSNPCALC NTR1                                                                   
         XR    R0,R0                                                            
         L     R1,FULL             SSN                                          
         D     R0,0(RF)            DIVIDE BY BASE 36 NUMBER                     
         XC    HALF,HALF                                                        
         STC   R1,HALF+1                                                        
         ZICM  R0,0(RF),4                                                       
         MH    R0,HALF             MULTIPLY QUOTIENT BY POWER OF 36             
         L     RE,FULL                                                          
         SR    RE,R0               SUBTRACT PRODUCT FROM REMAINING SSN          
         ST    RE,FULL             KEEP TRACK OF REMAINING SSN                  
*                                                                               
         LA    R3,BASE36T2                                                      
SCALC30  CLI   0(R3),X'FF'                                                      
         BE    SCALCNO                                                          
         CLC   HALF+1(1),0(R3)     FIND MATCH IN TABLE                          
         BE    SCALC40                                                          
         LA    R3,L'BASE36T2(R3)                                                
         B     SCALC30                                                          
SCALC40  MVC   BYTE,1(R3)          COMPLEMENTED BASE 36 NUMBER                  
*                                                                               
SCALCYES CR    RB,RB                                                            
         B     *+6                                                              
SCALCNO  LTR   RB,RB                                                            
         B     SSNUPXT                                                          
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*=====================================================================          
*              SSNUNPK - DECRYPTS PID                                           
*                                  P1=A(PID)                                    
*                                  P2=A(SSN)                                    
*                                    CC=EQ GOOD DECRYPTION                      
*                                    CC=NEQ BAD DECRYPTION                      
*=====================================================================          
                                                                                
SSNUPK   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     R3,4(R1)            CLEAR OUT SS#, IN CASE PID INVALID           
         MVC   0(9,R3),MYSPACES                                                 
*                                                                               
         L     R2,0(R1)            PID #                                        
         LA    R3,6                6 DIGITS                                     
         LA    RF,BASE36TB                                                      
         XR    R0,R0                                                            
SSNUP10  CLI   0(RF),X'FF'         EOT?                                         
         BNE   SSNUP20                                                          
         LTR   RB,RB                                                            
         B     SSNUPXT             LEAVE, WITH SS# AS BLANK                     
SSNUP20  BAS   RE,SSNUCALC         UNPACK CALCULATIONS                          
         BNE   SSNUPXT                                                          
         A     R0,FULL                                                          
         LA    RF,L'BASE36TB(RF)                                                
         LA    R2,1(R2)                                                         
         BCT   R3,SSNUP10                                                       
         L     R3,4(R1)                                                         
         EDIT  (R0),(9,(R3)),ZERO=NOBLANK,FILL=0                                
         CR    RB,RB                                                            
SSNUPXT  XIT1                                                                   
         EJECT                                                                  
*                                                                               
SSNUCALC NTR1                                                                   
         LA    R3,BASE36T2                                                      
SCALU10  CLI   0(R3),X'FF'                                                      
         BE    SCALUNO                                                          
         CLC   0(1,R2),1(R3)       FIND MATCH OF BASE 36 NUM IN TABLE           
         BE    SCALU20                                                          
         LA    R3,L'BASE36T2(R3)                                                
         B     SCALU10                                                          
SCALU20  XC    HALF,HALF                                                        
         MVC   HALF+1(1),0(R3)     HEX EQUIVALENT NUMBER                        
         ZICM  RE,0(RF),4                                                       
         MH    RE,HALF                                                          
         STCM  RE,15,FULL                                                       
*                                                                               
SCALUYES CR    RB,RB                                                            
         B     *+6                                                              
SCALUNO  LTR   RB,RB                                                            
         B     SSNUPXT                                                          
*                                                                               
         LTORG                                                                  
         SPACE                                                                  
BASE36TB DS    0F                                                               
         DC    F'60466176'         36 TO THE 5TH POWER                          
         DC    F'1679616'          36 TO THE 4TH POWER                          
         DC    F'46656'            36 TO THE 3RD POWER                          
         DC    F'1296'             36 TO THE 2ND POWER                          
         DC    F'36'               36 TO THE 1ST POWER                          
         DC    F'1'                36 TO THE ZERO POWER                         
         DC    X'FFFFFFFF'                                                      
         SPACE                                                                  
BASE36T2 DS    0XL2                                                             
         DC    XL1'0',CL1'C'                                                    
         DC    XL1'1',CL1'U'                                                    
         DC    XL1'2',CL1'7'                                                    
         DC    XL1'3',CL1'N'                                                    
         DC    XL1'4',CL1'2'                                                    
         DC    XL1'5',CL1'A'                                                    
         DC    XL1'6',CL1'T'                                                    
         DC    XL1'7',CL1'K'                                                    
         DC    XL1'8',CL1'Z'                                                    
         DC    XL1'9',CL1'8'                                                    
         DC    XL1'A',CL1'R'                                                    
         DC    XL1'B',CL1'Q'                                                    
         DC    XL1'C',CL1'D'                                                    
         DC    XL1'D',CL1'0'                                                    
         DC    XL1'E',CL1'X'                                                    
         DC    XL1'F',CL1'B'                                                    
         DC    XL1'10',CL1'J'                                                   
         DC    XL1'11',CL1'V'                                                   
         DC    XL1'12',CL1'5'                                                   
         DC    XL1'13',CL1'S'                                                   
         DC    XL1'14',CL1'G'                                                   
         DC    XL1'15',CL1'P'                                                   
         DC    XL1'16',CL1'W'                                                   
         DC    XL1'17',CL1'L'                                                   
         DC    XL1'18',CL1'9'                                                   
         DC    XL1'19',CL1'6'                                                   
         DC    XL1'1A',CL1'Y'                                                   
         DC    XL1'1B',CL1'1'                                                   
         DC    XL1'1C',CL1'F'                                                   
         DC    XL1'1D',CL1'M'                                                   
         DC    XL1'1E',CL1'4'                                                   
         DC    XL1'1F',CL1'I'                                                   
         DC    XL1'20',CL1'3'                                                   
         DC    XL1'21',CL1'E'                                                   
         DC    XL1'22',CL1'H'                                                   
         DC    XL1'23',CL1'O'                                                   
         DC    X'FF'                                                            
         EJECT                                                                  
*                                                                               
* AGENCY OVERRIDE MEDIA/SUBMEDIA/MATERIAL TABLE                                 
*                                                                               
MEDTAB   DS    0D                                                               
         DC    C'S',C'T',C'ST',C'T ',CL14'M00019'                               
         DC    C'S',C'R',C'SR',C'R ',CL14'M00018'                               
         DC    C'S',C'N',C'NT',C'V ',CL14'M00010'                               
         DC    C'S',C'X',C'NU',C'N ',CL14'M00017'                               
         DC    C'P',C'B',C'IN',C'07',CL14'M00007'                               
         DC    C'P',C'I',C'IN',C'07',CL14'M00007'                               
         DC    C'P',C'M',C'MA',C'02',CL14'M00002'                               
         DC    C'P',C'N',C'NP',C'01',CL14'M00001'                               
         DC    C'P',C'O',C'OH',C'05',CL14'M00005'                               
         DC    C'P',C'S',C'DS',C'S ',CL14'M00007'                               
         DC    C'P',C'T',C'TM',C'03',CL14'M00003'                               
         DC    C'P',C'L',C'OC',C'L ',CL14'M00007'                               
         DC    C'P',C'V',C'IN',C'07',CL14'M00007'                               
         DC    C'P',C'W',C'IN',C'07',CL14'M00007'                               
         DC    C'P',C'D',C'IN',C'07',CL14'M00007'                               
         DC    C'J',C'F',C'  ',C'  ',CL14'M00037'                               
         DC    X'00'                                                            
                                                                                
*                                                                               
*                                                                               
*=====================================================                          
* RECOVERY RECORD TRAILER                                                       
*=====================================================                          
                                                                                
RCVTRLD  DSECT                                                                  
       ++INCLUDE DMRCVREXT                                                      
         EJECT                                                                  
       ++INCLUDE AXWORKGB                                                       
*                                                                               
SAPKEYD  DSECT                                                                  
SAPKCMP  DS    CL2                 TRANSACTION COMPANY CODE                     
SAPKACC  DS    CL14                TRANSACTION ACCOUNT CODE                     
SAPKOFF  DS    CL2                 TRANSACTION OFFICE  CODE                     
SAPKCCPY DS    CL2                 TRANSACTION CONTRA COMPANY CODE              
SAPKCACC DS    CL14                TRANSACTION CONTRA ACCOUNT CODE              
SAPKTDTE DS    CL6                 TRANSACTION DATE                             
SAPKREF  DS    CL6                 TRANSACTION REFERENCE                        
SAPKSQ#  DS    CL2                 TRANSACTION SEQUENCE #                       
SAPKLNQ  EQU   *-SAPKEYD                                                        
*                                                                               
WORKD    DSECT                                                                  
         ORG   OVWORK                                                           
P16      DS    XL16                                                             
APARM    DS    A                                                                
AMXTRT   DS    A                                                                
ELCODE   DS    X                                                                
LDG      DS    X                                                                
DRORCR   DS    C                                                                
MEDPYBL  DS    C                                                                
SAPRUN   DS    C                                                                
ITMREP   DS    C                                                                
*                                                                               
LDGPQSTU DC    X'00'                                                            
LDGVWXY  DC    X'00'                                                            
*                                                                               
NARRTABD DSECT                                                                  
NARLEN1   DS    AL1                                                             
NARRSCAN1 DS   CL15                                                             
NARLEN2   DS    AL1                                                             
NARRSCAN2 DS   CL15                                                             
NARADDR   DS    A                                                               
*                                                                               
TAXTBD   DSECT                                                                  
TAXTIND  DS   XL1                                                               
TAXTSRCD DS   CL14                                                              
TAXTPYCD DS   CL14                                                              
TAXTLNQ  EQU  *-TAXTBD                                                          
*                                                                               
TAXATBD  DSECT                                                                  
TAXAIND  DS   XL1                  TAX INDICATOR                                
TAXADUB  DS   AL4                  TAX AMOUNT BUCKET                            
TAXAFLD  DS   AL2                  DISPLACEMENT TO SAP TAX AMOUNT FIELD         
TAXACOD  DS   AL2                  DISPLACEMENT TO SAP TAX CODE FIELD           
TAXALNQ  EQU  *-TAXATBD                                                         
*                                                                               
PXTABD   DSECT                                                                  
PXTSYS   DS   CL1                  SYSTEM (P/S)                                 
PXTACC   DS   CL11                 ACCOUNT                                      
PXTMATCD DS   CL14                 MATERIAL CODE                                
PXTBLNQ  EQU  *-PXTABD                                                          
*                                                                               
FXTABD   DSECT                                                                  
FXTSYS   DS   CL1                  SYSTEM (P/S)                                 
FXTACC   DS   CL11                 ACCOUNT                                      
FXTCURR  DS   CL3                  CURRENCY CODE                                
FXTBLNQ  EQU  *-FXTABD                                                          
*                                                                               
MEDTBD   DSECT                                                                  
MEDTSYS  DS    CL1                 SYSTEM                                       
MEDTMED  DS    CL1                 MEDIA                                        
MEDTMEDT DS    CL2                 SAP MEDIA TYPE                               
MEDTSMED DS    CL2                 SAP SUB MEDIA                                
MEDTMATL DS    CL14                SAP MATERIAL                                 
MEDTLNQ  EQU   *-MEDTBD                                                         
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'216AXROUTGB  05/29/19'                                      
         END                                                                    

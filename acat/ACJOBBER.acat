*          DATA SET ACJOBBER   AT LEVEL 064 AS OF 04/06/16                      
*CATALP ACJOBBER                                                                
*                                                                               
* YNGX 064 16NOV15 <PCA02009> SUPPORT WC-LEVEL ESTIMATED HOURS FOR AURA         
*                                                                               
************************************************************                    
*                                                          *                    
* ACJOBBER - T00A85                                        *                    
*                                                          *                    
* BUILD A TABLE OF JOB VALUES DEFINED BY A COLUMN LIST.    *                    
* CALLER PASSES INTERFACE BLOCK DEFINED BY ACJOBBLOCK.     *                    
* ACJOBBER RETURNS A TABLE OF COLUMN VALUES FOR THE        *                    
* JOB'S SCHEME.                                            *                    
*                                                          *                    
* ON ENTRY, P1=A(JOB BLOCK)                                *                    
*                                                          *                    
* ON EXIT,  JBERROR EQ  0 IF OK                            *                    
*                   NEQ 0 FOR ERROR                        *                    
*                                                          *                    
************************************************************                    
JOBBER   TITLE 'T00A85 - JOB LOOKUP MODULE'                                     
ACJOBBER CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 WORKX-WORKD,**ACJOB*,RA,R9,RR=RE,CLEAR=YES                       
         USING WORKD,RC            RC = A(LOCAL WORKING STORAGE)                
         ST    R1,APARM            SAVE A(PARM LIST)                            
         ST    RE,RELO                                                          
         ST    RD,AWORK                                                         
         L     R8,0(R1)                                                         
         USING JBLOCKD,R8          R8 = A(JOB BLOCK)                            
         MVC   USERRD,4(RD)        SAVE LINK BACK TO USER                       
*                                                                               
         LA    R1,OVROUT           SET A(ROOT ROUTINES IN W/S)                  
         LA    R0,OVROUTN                                                       
         XR    RE,RE                                                            
         L     RF,=A(ROUTS)                                                     
         A     RF,RELO             RF=A(GLOBAL ROUTINES)                        
JOB00    STCM  RE,1,0(R1)          SET ROUTINE NUMBER                           
         STCM  RF,7,1(R1)          SET ROUTINE ADDRESS                          
         LA    R1,4(R1)                                                         
         LA    RE,1(RE)                                                         
         BCT   R0,JOB00                                                         
*                                                                               
         L     RE,=A(RELTAB)                                                    
         A     RE,RELO                                                          
         ST    RE,ARELTAB                                                       
*                                                                               
         L     RE,=A(COPTAB)                                                    
         A     RE,RELO                                                          
         ST    RE,ACOPTAB                                                       
*                                                                               
         L     RE,=A(COMMTAB)                                                   
         A     RE,RELO                                                          
         ST    RE,ACOMTAB                                                       
*                                                                               
         LH    RE,=Y(GOJBLK-WORKD)                                              
         LA    RE,WORKD(RE)        SET  A(GOBLOCK)                              
         ST    RE,AGOBLOCK                                                      
*                                                                               
         LH    RE,=Y(BLOCK-WORKD)                                               
         LA    RE,WORKD(RE)        SET  A(BLOCK)                                
         ST    RE,ABLOCK                                                        
*                                                                               
         MVI   JBERROR,0                                                        
         XC    JBVALUES,JBVALUES                                                
         MVI   JBACOLTB,0          MAKE SURE HOB IS ZERO                        
         MVI   JBAOPVTB,0                                                       
         L     R1,JBACOM           SET COMFACS ADDRESSES                        
         USING COMFACSD,R1                                                      
         MVC   VDATAMGR,CDATAMGR                                                
         MVC   VHELLO,CHELLO                                                    
         MVC   VSCANNER,CSCANNER                                                
         DROP  R1                                                               
         MVI   SPACES,C' '                                                      
         MVC   SPACES+1(L'SPACES-1),SPACES                                      
*                                                                               
         L     RE,AGOBLOCK                                                      
         L     R4,JBAGOBLK                                                      
         LA    RF,L'GOBLOCK                                                     
         LR    R5,RF                                                            
         MVCL  RE,R4               MOVE TO JOBBER GOBLOCK                       
*                                                                               
         USING GOBLOCKD,RE                                                      
         L     RE,AGOBLOCK                                                      
         XC    GOAKEY,GOAKEY       CLEAR CALLER'S RESTORE KEY                   
         XC    GOAEXT,GOAEXT       CLEAR POINTERTS TO EXTENSION                 
         XC    GOAPAN,GOAPAN       GOBLOCK AND PANEL BLOCK                      
*                                                                               
         MVC   CUL,GOSELCUL        EXTRACT COMPANY/UNIT/LEDGER                  
         MVC   CLIENT,GOSELCLI     AND CLIENT                                   
         MVC   PRODUCT,GOSELPRO    PRODUCT                                      
         MVC   JOBNUM,GOSELJOB     AND FINALLY JOB                              
         MVC   WORKCODE,GOSELWC    WORK CODE                                    
         ZAP   MAXPER,GOOVRPER     EXTRACT MAXIMUM PERCENT OF EST               
         MVC   NEEDAE,GONEEDAE     EXTRACT APPROVED ESTIMATE OPTION             
         MVC   BILTYP,GOBILTYP     EXTRACT BILLING TYPE                         
         MVC   BILAM1(12),GOBILAM1 EXTRACT BILLING AMOUNTS/PERCENTS             
         MVC   SELECTED,GOSELEST   SAVE SELECTED ESTIMATES (MCS)                
         TM    JBSELFUN,JBGETSS    SINGLE SELECTED ESTIMATE?                    
         BZ    JOB1A                                                            
         XC    SELECTED,SELECTED                                                
         MVC   SELECTED(1),JBSELEST                                             
*                                                                               
JOB1A    MVC   SELECTE2,SELECTED                                                
         DROP  RE                                                               
*                                                                               
         MVI   ELCODE,JOBELQ       GET JOB ELEMENT                              
         L     R4,JBAJOB                                                        
         BAS   RE,GETEL                                                         
         BE    *+6                 MUST BE THERE                                
         DC    H'0'                                                             
*                                                                               
         USING JOBELD,R6                                                        
         ST    R6,AJOBEL                                                        
         MVI   JBXJOB,NO           SET X-JOB SWITCH TO NO                       
         MVI   JBOLDAPP,NO         SET OLD ESTIMATE APPROVE TO NO               
         MVI   JBNEWEST,NO         SET NEW ESTIMATE SWITCH TO NOS               
*                                                                               
         TM    JOBSTA1,JOBSNEST    TEST JOB IS ON NEW ESTIMATES                 
         BZ    *+8                 YES                                          
         MVI   JBNEWEST,YES                                                     
         TM    JOBSTA1,JOBSMCSE    TEST JOB IS BRANDOCEAN                       
         BZ    *+8                 YES                                          
         MVI   JBNEWEST,JBMCSQ                                                  
*                                                                               
         TM    JOBSTA1,JOBSUEST    DOES JOB HAVE UNAPPROVED ESTIMATE?           
         BO    JOB02               YES                                          
         MVI   JBOLDAPP,YES        NO, INDICATE APPROVED                        
*                                                                               
JOB02    TM    JOBSTA1,JOBSXJOB    IS THIS AN X-JOB ?                           
         BZ    *+8                 NO                                           
         MVI   JBXJOB,YES          YES                                          
         BAS   RE,SETPER           SET PERCENT OF ESTIMATE TO BILL              
         DROP  R6                                                               
*                                                                               
         CLI   JBNEWEST,JBMCSQ     FOR MCS ESTIMATES                            
         BE    JOB50                                                            
*                                                                               
         TM    JBSELFUN,JBGETEST   TEST FOR ESTIMATE PASSED                     
         BZ    JOB03                                                            
         L     RE,JBAIO            YES-SAVE ESTIMATE KEY                        
         MVC   LERKEY,0(RE)                                                     
*                                                                               
         USING JBCLD,R3                                                         
JOB03    L     R3,JBACOLS          SEE IF WE HAVE ANY SUPPLEMENTS               
*                                                                               
JOB04    CLI   JBCLTYP,0           END OF LIST ?                                
         BE    JOB06               YES                                          
         CLI   JBCLTYP,JBCLSUPP    NO, DO WE HAVE A SUPPLEMENT ?                
         BE    *+12                YES                                          
         LA    R3,JBCLENQ(R3)      NO                                           
         B     JOB04                                                            
*                                                                               
         BAS   RE,LSTEST           GET ALL REVISIONS                            
         BAS   RE,SETCOL           CHANGE COLUMNS ACCORDINGLY                   
*                                                                               
JOB06    BAS   RE,BLDOPS           BUILD OPERAND LIST                           
         BAS   RE,INCOL            INITIALIZE COLTAB                            
         CLI   ADJOPSW,YES         TEST TO ADJUST OPERAND LIST                  
         BNE   *+8                                                              
         BAS   RE,ADJOP            YES                                          
         BAS   RE,CALCMAX          CALCULATE MAXIMUM TABLE SIZES                
         BAS   RE,INOPV            INITIALIZE OPERAND VALUE TABLE               
*                                                                               
         CLI   ESTSW,YES           TEST TO READ ESTIMATES                       
         BNE   JOB14                                                            
*                                                                               
         TM    JBSELFUN,JBGETEST   TEST ESTIMATE RECORD PASSED                  
         BZ    JOB12               NO                                           
*                                                                               
         MVC   KEY,LERKEY          RESTORE SAVED ESTIMATE KEY                   
         BAS   RE,READ             RE-READ--CASE OF INTERVENING IOS             
         BE    *+6                                                              
         DC    H'0'                                                             
         L     R4,JBAIO                                                         
         USING EVERECD,R4                                                       
         MVC   ESTYPE,EVEKTYPE     EXTRACT EST TYPE/VERSION                     
         MVC   ESTVERS,EVEKVER                                                  
*                                                                               
         LA    RF,EVEKEY+(EVEKWC-EVEKEY)                                        
         OC    0(L'EVEKWC,RF),0(RF)   IS IT A TIME EST RECORD?                  
         BZ    JOB10                  NO                                        
         GOTO1 GETEST1R,0                                                       
         B     JOB14                                                            
*                                                                               
JOB10    GOTO1 GETEST,0                                                         
         B     JOB14                                                            
         DROP  R4                                                               
*                                                                               
JOB12    LA    RF,EST              RF=A(ESTIMATE READING ROUTINE)               
         CLI   JBNEWEST,YES        TEST FOR NEW ESTIMATES                       
         BE    *+8                                                              
         LA    RF,OLDEST                                                        
         BASR  RE,RF                                                            
*                                                                               
JOB14    CLI   POSW,YES            TEST TO READ PURCHASE ORDERS                 
         BNE   *+8                                                              
         BAS   RE,PO                                                            
         CLI   ACTSW,YES           TEST TO READ ACTUALS                         
         BNE   *+8                                                              
         BAS   RE,ACT                                                           
         CLI   RATESW,YES          TEST TO GET COMMISSION RATES                 
         BNE   *+8                                                              
         BAS   RE,RATE                                                          
         BAS   RE,SLUSH            ADD SLUSH CATEGORY                           
*                                                                               
         BAS   RE,ROLL             ROLL-UP THE SUB-TOTALS                       
         CLI   CATFRMSW,YES        TEST FOR ANY CATEGORY FORMULAS               
         BNE   JOB16               NO                                           
         BAS   RE,LINK             BUILD A LINKED RESOLUTION LIST               
         BAS   RE,RESOLVE          RESOLVE THE LINKED LIST                      
*                                                                               
JOB16    OC    JBAWCTB,JBAWCTB     DO WE HAVE A SPECIAL W/C TABLE ?             
         BZ    JOB18               NO                                           
         BAS   RE,LINKWC           YES, LINK AND RESOLVE THEM, IF ANY           
         BAS   RE,RESOLWC                                                       
*                                                                               
JOB18    BAS   RE,COLUMN           PROCESS THE COLUMNS                          
         B     JOB90                                                            
*                                                                               
JOB50    DS    0H                  FOR MCS/BO ESTIMATES PROCESS HERE            
*                                  ******************************               
         MVI   ELCODE,RSTELQ       GET RST ELEMENT                              
         L     R4,JBAJOB                                                        
         BAS   RE,GETEL                                                         
         BE    *+6                 MUST BE THERE                                
         DC    H'0'                                                             
                                                                                
         USING RSTELD,R6                                                        
         MVI   MCSESW,NO                                                        
         CLI   RSTLN,RSTLN3Q                                                    
         BL    JOB55                                                            
         TM    RSTSTAT6,RSTSMCSE   ANY ESTIMATES EXISTING?                      
         BZ    JOB55                                                            
         MVI   MCSESW,YES                                                       
         DROP  R6                                                               
*                                                                               
JOB55    GOTO1 AMCSCOL             SET COLUMNS ROUTINE                          
*                                                                               
         GOTO1 AMCSINI             INITIALISE TABLES AND MCS VALUE              
*                                                                               
         CLI   MCSESW,YES                                                       
         BNE   JOB60               IF NO ESTIMATES SKIP                         
*                                                                               
         GOTO1 AMCSPUT             ELSE PUT DATA TO TABLE                       
         BE    JOB60                                                            
         MVI   JBERROR,JBERRCOL    COLUMN TABLE OVERFLOW                        
         B     JOBERR                                                           
*                                                                               
JOB60    CLI   POSW,YES            TEST TO READ PURCHASE ORDERS                 
         BNE   JOB65                                                            
         BAS   RE,PO                                                            
*                                                                               
JOB65    CLI   ACTSW,YES           TEST TO READ ACTUALS                         
         BNE   JOB70                                                            
         BAS   RE,ACT                                                           
*                                                                               
JOB70    DS    0H                  END OF MCS PROCESSING                        
         XR    R0,R0                                                            
         XR    R1,R1                                                            
         USING MJETABD,R7                                                       
         L     R7,JBACOLTB         COUNT N'ROWS USED                            
         L     RE,JBACOLTB                                                      
         A     RE,JBLCOLTB         RE=MAX EOT                                   
         IC    R1,MJETLEN          R1=L'ENTRY                                   
JOB72    CR    R7,RE                                                            
         BNL   JOB74               (TABLE FULL)                                 
         CLI   0(R7),MJETTEQ       TEST END OF TABLE                            
         BE    JOB74                                                            
         AR    R7,R1                                                            
         AHI   R0,1                                                             
         B     JOB72                                                            
JOB74    STH   R0,JBNROWS          N'ROWS                                       
         STH   R1,JBLCOL           L'ROW                                        
         L     RE,MCSCNO                                                        
         STC   RE,JBNCOLS          N'COLS IN A ROW                              
         B     JOB90                                                            
*                                                                               
JOB90    ICM   RE,15,JBAKEY        GET USER KEY                                 
         BZ    JOBX                NONE                                         
*                                                                               
         MVC   KEY,0(RE)           RE-READ TO RE-ESTABLISH                      
         BAS   RE,READ             KEY SEQUENCE FOR CALLER                      
         BE    JOBX                                                             
         DC    H'0'                                                             
*                                                                               
JOBX     L     RE,AGOBLOCK                                                      
         USING GOBLOCKD,RE                                                      
         MVC   GOSELWC,WORKCODE    RESTORE ORIGINAL WORK CODE                   
         DROP  RE                                                               
         XMOD1 1                                                                
*                                                                               
EXIT     XIT1                                                                   
*                                                                               
JOBERR   L     RD,AWORK            EXIT RIGHT OUT OF MODULE                     
         B     JOBX                                                             
         EJECT                                                                  
****************************************************************                
* SUB-ROUTINE TO BUILD A LIST OF ESTIMATES. USED TO DETERMINE  *                
* WHAT R'S RELATE TO THE S REQUESTED.                          *                
* CALLED FROM MAIN LINE IF SUPPLEMENTS ARE REQUESTED           *                
****************************************************************                
*                                                                               
LSTEST   NTR1  ,                                                                
         LA    R4,KEY                                                           
         LA    R5,ESTLIST                                                       
         USING EVERECD,R4                                                       
         XC    EVEKEY,EVEKEY                                                    
         MVI   EVEKTYP,EVEKTYPQ                                                 
         MVI   EVEKSUB,EVEKSUBQ                                                 
         MVC   EVEKCPY(3),CUL                                                   
         MVC   EVEKCLI,CLIENT                                                   
         MVC   EVEKPRO,PRODUCT                                                  
         MVC   EVEKJOB,JOBNUM                                                   
         MVI   EVEKTYPE,EVEKTREV                                                
         OI    DMINBTS,X'08'       READ DELETED RECORDS                         
         GOTO1 HIGH                                                             
         B     LSTEST2                                                          
*                                                                               
LSTEST1  LA    R4,KEY                                                           
         GOTO1 SEQ                                                              
*                                                                               
LSTEST2  CLC   EVEKEY(EVEKVER-EVEKEY),KEYSAVE                                   
         BNE   LSTESTX                                                          
*                                                                               
         MVC   0(2,R5),EVEKTYPE    ADD TYPE/REVISION NUMBER TO LIST             
         LA    R5,2(R5)                                                         
         LA    R3,1(R3)            BUMP ESTIMATE LIST COUNTER                   
         B     LSTEST1                                                          
*                                                                               
LSTESTX  B     EXIT                                                             
         EJECT                                                                  
****************************************************************                
* SUB-ROUTINE TO UPDATE THE COLUMN LIST FROM ESTIMATE LIST     *                
* (ESTLIST) BUILT IN LSTEST.                                   *                
* CALLED FROM MAIN LINE                                        *                
****************************************************************                
         SPACE 1                                                                
         USING JBCLD,R3                                                         
SETCOL   NTR1  ,                                                                
         L     R3,JBACOLS          R3=A(COLUMN LIST)                            
*                                                                               
SETCOL1  CLI   JBCLTYP,0           TEST FOR EOL                                 
         BE    SETCOLX             YES                                          
         CLI   JBCLTYP,JBCLSUPP    IS IT A SUPPLEMENT ?                         
         BE    SETCOL3             YES                                          
*                                                                               
SETCOL2  LA    R3,JBCLENQ(R3)                                                   
         B     SETCOL1                                                          
*                                                                               
SETCOL3  ZIC   RE,JBCLCN1V                                                      
         SLL   RE,1                MULTIPLY BY 2                                
         LA    R5,ESTLIST(RE)                                                   
*                                                                               
         MVC   JBCLSNV,JBCLCN1E    SAVE SUPPLEMENT                              
*                                                                               
         MVC   JBCLCN1E,0(R5)                                                   
         MVC   JBCLCN1V,1(R5)                                                   
*                                                                               
         BCTR  R5,0                                                             
         BCTR  R5,0                                                             
         MVC   JBCLCN2,JBCLCN1                                                  
         MVC   JBCLCN2E,0(R5)                                                   
         MVC   JBCLCN2V,1(R5)                                                   
*                                                                               
         MVI   JBCLOPER,C'-'       ALWAYS A MINUS                               
         MVI   JBCLTYP,JBCLFRM                                                  
         B     SETCOL2                                                          
*                                                                               
SETCOLX  B     EXIT                                                             
         EJECT                                                                  
****************************************************************                
* FIND COLUMN LIST ENTRY (JBACOLS) IN COLUMN OPERAND TABLE     *                
* (COPTAB).                                                    *                
* CALL ADDOPER TO ADD ENTRY TO OPERAND TABLE (OPTAB)           *                
* CALLED FROM MAIN LINE                                        *                
****************************************************************                
*                                                                               
BLDOPS   NTR1  ,                                                                
         L     R3,JBACOLS          R3=A(COLUMN LIST)                            
         USING JBCLD,R3                                                         
*                                                                               
BLDOPS2  CLI   JBCLTYP,0           TEST FOR EOL                                 
         BE    BLDOPS20            YES                                          
*                                                                               
         ZIC   R1,JBNCOLS                                                       
         LA    R1,1(R1)            INCREMENT COLUMN COUNT                       
         STC   R1,JBNCOLS                                                       
         L     R7,ACOPTAB          R7=A(COLUMN OPERAND TABLE)                   
         USING COPTABD,R7                                                       
         LA    R0,NCOPTAB          R0=TABLE ENTRY COUNT                         
*                                                                               
BLDOPS4  CLC   JBCLCN1,COPNUM      ENTRY ALWAYS HAS ONE COLUMN                  
         BE    BLDOPS6             MATCH ON COLUMN DATA NUMBER                  
         LA    R7,COPTABL(R7)                                                   
         BCT   R0,BLDOPS4                                                       
*                                                                               
         MVI   JBCLTYP,JBCLUNKN    NOTE UNKNOWN COLUMN OPERAND                  
         B     BLDOPS15                                                         
*                                                                               
BLDOPS6  ZIC   R0,COPNOPER         R0=N'COLUMN OPERANDS                         
         LA    R4,COPERS           R4=A(OPERAND)                                
*                                                                               
BLDOPS7  MVC   CLDATA,JBCLCN1      INITIALIZE COLUMN DATA                       
         MVC   CLNUM,0(R4)         SET OPERAND NUMBER                           
         TM    COPIND1,COPEST      TEST FOR ESTIMATE                            
         BZ    *+10                                                             
         XC    CLEST(2),CLEST      CLEAR OUT ESTIMATE FIELDS                    
         BAS   RE,ADDOPER          ADD UNIQUE OPERANDS TO LIST                  
         LA    R4,L'OPERNUM(R4)                                                 
         BCT   R0,BLDOPS7                                                       
*                                                                               
         CLI   JBCLTYP,JBCLFRM     TEST FOR FORMULA                             
         BNE   BLDOPS15            NO                                           
         L     R7,ACOPTAB          R7=A(COLUMN OPERAND TABLE)                   
         USING COPTABD,R7                                                       
         LA    R0,NCOPTAB          R0=TABLE ENTRY COUNT                         
*                                                                               
BLDOPS10 CLC   JBCLCN2,COPNUM      ENTRY ALWAYS HAS ONE COLUMN                  
         BE    BLDOPS12            MATCH ON COLUMN DATA NUMBER                  
         LA    R7,COPTABL(R7)                                                   
         BCT   R0,BLDOPS10                                                      
*                                                                               
         MVI   JBCLTYP,JBCLUNKN    NOTE UNKNOWN OPERAND                         
         B     BLDOPS15            SKIP THIS COLUMN ENTRY                       
*                                                                               
BLDOPS12 ZIC   R0,COPNOPER                                                      
         LA    R4,COPERS                                                        
*                                                                               
BLDOPS13 MVC   CLDATA,JBCLCN2      INITIALIZE COLUMN DATA                       
         MVC   CLNUM,0(R4)         SET OPERAND NUMBER                           
         TM    COPIND1,COPEST      TEST FOR ESTIMATE                            
         BZ    *+10                                                             
         XC    CLEST(2),CLEST      CLEAR OUT ESTIMATE FIELDS                    
         BAS   RE,ADDOPER                                                       
         LA    R4,L'OPERNUM(R4)                                                 
         BCT   R0,BLDOPS13                                                      
*                                                                               
BLDOPS15 LA    R3,JBCLENQ(R3)                                                   
         B     BLDOPS2                                                          
*                                                                               
BLDOPS20 ZIC   RE,JBNCOLS                                                       
         MH    RE,=Y(L'JBCOLVAL)                                                
         TM    JBSELFUN,JBGET1R    DO WE WANT THE 1R ACCOUNTS?                  
         BZ    BLDOPS30            NO                                           
         LA    RE,JBCOLV1R-JBCOLD(RE) YES, USE DIFFERENT LENGTH                 
         B     BLDOPS40                                                         
*                                                                               
BLDOPS30 LA    RE,JBCOLVAL-JBCOLD(RE) USE SHORTER LENGTH FOR THIS               
*                                                                               
BLDOPS40 STH   RE,JBLCOL           SET LENGTH OF COLUMN ENTRY                   
         L     R1,JBLCOLTB         R1=MAX LENGTH OF COLUMN TABLE                
         SR    R0,R0                                                            
         DR    R0,RE               COMPUT MAXIMUM N'COLUMNS                     
         ST    R1,MAXCOLS                                                       
*                                                                               
BLDOPSX  B     EXIT                                                             
         EJECT                                                                  
****************************************************************                
* ADD UNIQUE OPERAND ENTRY TO OPERAND TABLE (OPTAB)            *                
* CALLED FROM BLDOPS AND ADJOP                                 *                
*                                                              *                
* AT ENTRY, R7=COPTAB, CLDATA(4)=COLUMN DATA NUMBER/ESTIMATE   *                
* TYPE/ESTIMATE NUMBER TO BE ADDED.                            *                
****************************************************************                
*                                                                               
ADDOPER  NTR1  ,                                                                
         CLC   CLNUM,=AL2(JBDMAXPE) TEST FOR MAX PERCENT OF ESTIMATE            
         BE    ADDOPERX            YES-DO NOT ADD AS OPERAND                    
         LA    R5,OPTAB            R5=A(OPERAND TABLE)                          
         USING OPERD,R5                                                         
         SR    R0,R0                                                            
         ICM   R0,1,JBNOPERS       R0=N'OPERANDS                                
         BZ    ADDOPER4            NONE RIGHT NOW SO ADD AN ENTRY               
*                                                                               
ADDOPER2 CLC   CLDATA(CLKEYL),OPERNUM   TEST FOR MATCH ON OPERAND               
         BE    ADDOPERX            YES-NOT A UNIQUE ENTRY                       
         LA    R5,OPERL(R5)                                                     
         BCT   R0,ADDOPER2                                                      
*                                                                               
ADDOPER4 XC    0(OPERL,R5),0(R5)   CLEAR OUT AN ENTRY                           
         MVC   OPERNUM(CLKEYL),CLDATA   ADD NEW ENTRY                           
         ZIC   R1,JBNOPERS         INCREMENT OPERAND COUNT                      
         LA    R1,1(R1)                                                         
         STC   R1,JBNOPERS                                                      
         TM    COPIND1,COPGETES    TEST TO READ ESTIMATES                       
         BZ    *+8                                                              
         MVI   ESTSW,YES           YES-SET TO READ THEM                         
         TM    COPIND1,COPGETTR    SET TO READ TRANSACTIONS                     
         BZ    *+8                                                              
         MVI   ACTSW,YES                                                        
         TM    COPIND1,COPGETPO    TEST TO READ PURCHASE ORDERS                 
         BZ    *+8                                                              
         MVI   POSW,YES                                                         
         TM    COPIND1,COPGETCO    TEST TO GET COMMISSION RATES                 
         BZ    *+8                                                              
         MVI   RATESW,YES                                                       
         TM    COPIND1,COPWCOM     TEST NEED WORKCODE RATES                     
         BZ    *+8                 NO                                           
         MVI   WCOMSW,YES          YES-SET SWITCH                               
         TM    COPIND1,COPEREST    TEST TO COMPUTE PERCENT OF EST               
         BZ    *+8                                                              
         MVI   PERESTSW,YES                                                     
         TM    COPIND1,COPHIREV    TEST TO READ HIGHEST REVISION                
         BZ    *+8                                                              
         MVI   HIREVSW,YES                                                      
*                                                                               
         TM    COPIND2,COPHOURS    TEST HOURS REQUIRED                          
         BZ    *+8                                                              
         MVI   HOURSW,YES                                                       
*                                                                               
ADDOPERX B     EXIT                                                             
         EJECT                                                                  
*****************************************************************               
* READ SCHEME AND CATEGORY RECORDS AND CALL PROCAT              *               
*****************************************************************               
*                                                                               
INCOL    NTR1  ,                                                                
         LA    R7,COLENT                                                        
         USING JBCOLD,R7                                                        
         XC    COLENT,COLENT       RESERVE ROW ONE FOR JOB TOTALS               
         MVI   JBCOLTYP,JBCOLTJB   JOB TOTALS                                   
         GOTO1 ADDCOL,0                                                         
*                                                                               
         OC    JBSELSCH,JBSELSCH   TEST IF SCHEME PASSED                        
         BZ    INCOLX              NO-EXIT RIGHT NOW                            
*                                                                               
         OC    JBASCH,JBASCH       TEST IF SCHEME BLOCK PASSED                  
         BZ    INCOL1              NO                                           
         BAS   RE,GETSCH           USE SCHEME BLOCK INSTEAD OF                  
         B     INCOLX              READING RECORDS                              
*                                                                               
INCOL1   XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING SCHRECD,R4                                                       
         MVI   SCHKTYP,SCHKTYPQ    BUILD SCHEME KEY                             
         MVI   SCHKSUB,SCHKSUBQ                                                 
         MVC   SCHKCUL,CUL                                                      
         MVC   SCHKCODE,JBSELSCH                                                
         MVC   KEYSAVE,KEY                                                      
         GOTO1 VDATAMGR,DMCB,DMRDHI,ACCOUNT,KEY,IOAREA,0                        
         MVC   SCHKEY,IOAREA       EXTRACT RETURNED KEY                         
         CLC   SCHKEY,KEYSAVE                                                   
         BE    INCOL2                                                           
*                                                                               
         MVI   JBERROR,JBERRSCH    SET ERROR AND EXIT FOR                       
         B     JOBERR              BAD SCHEME                                   
*                                                                               
INCOL2   LA    R4,IOAREA                                                        
         MVI   ELCODE,SCSELQ       GET SCHEME CATEGORY SEQUENCE EL              
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                BIG PROBLEM IF NOT THERE                     
         USING SCSELD,R6                                                        
         ZIC   R2,SCSLN            GET ELEMENT LENGTH                           
         SH    R2,=Y(SCSCAT-SCSELD)                                             
         SRA   R2,1                R2=N'CATEGORIES                              
         BZ    INCOLX                                                           
         LA    R3,SCSCAT           R3=CATEGORY LIST POINTER                     
*                                                                               
INCOL4   XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING CATRECD,R4                                                       
         MVI   CATKTYP,CATKTYPQ                                                 
         MVI   CATKSUB,CATKSUBQ                                                 
         MVC   CATKCUL,CUL                                                      
         MVC   CATKSCH,JBSELSCH                                                 
         MVC   CATKCODE,0(R3)      EXTRACT CATEGORY CODE                        
         CLC   CATKCODE,XFF        TEST FOR SLUSH CATEGORY                      
         BE    INCOL10             YES-GET NEXT ENTRY                           
         BAS   RE,HIGH                                                          
         CLC   CATKEY,KEYSAVE      TEST IF RECORD FOUND                         
         BE    *+6                                                              
         DC    H'0'                                                             
         GOTO1 PROCAT,DMCB,JBAIO                                                
*                                                                               
INCOL10  LA    R3,L'CATKCODE(R3)   NEXT CATEGORY CODE                           
         BCT   R2,INCOL4           READ NEXT RECORD                             
*                                                                               
INCOLX   B     EXIT                                                             
         EJECT                                                                  
**************************************************************                  
* GET SCHEME RECORD PASSED, ADDRESS CATGEORIES & CALL PROCAT *                  
**************************************************************                  
*                                                                               
GETSCH   NTR1  ,                                                                
         L     R3,JBASCH           R3=A(SCHEME BLOCK)                           
         USING SCBLOCK,R3                                                       
         L     R4,SCAFSTCT         R4=A(CATEGORY RECORD)                        
         USING CATRECD,R4                                                       
*                                                                               
GETSCH2  CLI   0(R4),0             TEST FOR EOB                                 
         BE    GETSCHX                                                          
         CLC   CATKCODE,XFF        TEST FOR SLUSH                               
         BE    GETSCH4             YES-SKIP OVER IT                             
         GOTO1 PROCAT,DMCB,(R4)                                                 
*                                                                               
GETSCH4  SR    R1,R1                                                            
         ICM   R1,3,CATRECD+ACCORLEN                                            
         LA    R4,1(R1,R4)         NEXT CATEGORY RECORD                         
         B     GETSCH2                                                          
*                                                                               
GETSCHX  B     EXIT                                                             
         DROP  R3,R4                                                            
         EJECT                                                                  
********************************************************************            
* BUILD COLUMN TABLE ENTRY (COLENT) FOR EACH CATEGORY AND          *            
* CALL ADDCOL.                                                     *            
*                                                                  *            
* CALLED FROM INCOL AND GETSCH                                     *            
*                                                                  *            
* AT ENTRY, P1=A(CATEGORY RECORD)                                  *            
********************************************************************            
*                                                                               
PROCAT   NTR1  ,                                                                
         L     R4,0(R1)            P1=A(CATEGORY RECORD)                        
         USING CATRECD,R4                                                       
         MVI   ELCODE,CADELQ       GET CATEGORY DESCRIPTION ELEMENT             
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         USING CADELD,R6                                                        
         ST    R6,ACATEL           SAVE A(ELEMENT)                              
         CLI   CADTYPE,CADTWORK   TEST FOR WORKCODE LIST                        
         BNE   PROCAT6             NO                                           
*                                                                               
         LA    R6,CATRECD+ACCORFST R6=A(FIRST ELEMENT)                          
         USING CWKELD,R6                                                        
*                                                                               
PROCAT1  CLI   0(R6),0             TEST FOR EOR                                 
         BE    PROCAT6             YES                                          
         CLI   0(R6),CWKELQ        TEST FOR CATEGORY WORKCODE ELEMENT           
         BNE   PROCAT4                                                          
*                                                                               
         XC    COLENT,COLENT                                                    
         MVC   JBCOLCAT,CATKCODE   EXTRACT CATEGORY CODE                        
         MVC   JBCOLTYP,CWKTYPE    AND TYPE OF ELEMENT                          
         CLI   CWKTYPE,1           TEST FOR WORK CODE                           
         BNE   PROCAT3                                                          
*                                                                               
         CLC   CWKCAT,SPACES                                                    
         BNH   PROCAT2                                                          
         OC    JBAWCTBL,JBAWCTBL   DO WE HAVE A SPECIAL W/C TABLE ?             
         BZ    *+8                 NO                                           
         BAS   RE,BLDTBLE                                                       
*                                                                               
PROCAT2  MVC   JBCOLWC(3),CWKWORK  EXTRACT WORK CODE/SUFFIX                     
*                                                                               
PROCAT3  GOTO1 ADDCOL,0            ADD A NEW COLUMN ENTRY                       
         CLI   CWKTYPE,3           TEST FOR AGENCY COMMISSION LINE              
         BNE   *+8                                                              
         MVI   ADJOPSW,YES         SET TO ADJUST OPERAND LIST                   
*                                                                               
PROCAT4  ZIC   R0,1(R6)                                                         
         AR    R6,R0               NEXT ELEMENT                                 
         B     PROCAT1                                                          
*                                                                               
PROCAT6  XC    COLENT,COLENT       CLEAR ENTRY FOR CATEGORY                     
         MVC   JBCOLCAT,CATKCODE   EXTRACT CATEGORY CODE                        
         MVI   JBCOLTYP,JBCOLTCT   SET FOR CATEGORY                             
         L     R6,ACATEL                                                        
         USING CADELD,R6                                                        
         CLI   CADTYPE,CADTWORK    TEST FOR WORKCODE LIST                       
         BE    PROCAT10            YES                                          
*                                                                               
         CLI   CADTYPE,CADTFORM    TEST FOR FORMULA                             
         BE    PROCAT8                                                          
*                                                                               
         CLI   CADTYPE,CADTAGY     MAKE SURE ITS AGENCY COMMISSION              
         BE    *+6                                                              
         DC    H'0'                                                             
         MVI   JBCOLTYP,JBCOLTCA   SET FOR CATEGORY AGENCY COMMISSION           
         MVI   ADJOPSW,YES         SET TO ADJUST OPERAND LIST                   
         B     PROCAT10                                                         
*                                                                               
PROCAT8  MVI   JBCOLTYP,JBCOLTCF   SET FOR CATEGORY FORMULA                     
         BAS   RE,ADDCAT           ADD CATEGORY FORMULA TABLE ENTRY             
*                                                                               
PROCAT10 GOTO1 ADDCOL,0                                                         
*                                                                               
PROCATX  B     EXIT                                                             
         DROP  R4,R6                                                            
         EJECT                                                                  
********************************************************************            
* CALCULATE MAXIMUM NUMBER OF OPERAND VALUE TABLE ROWS             *            
* CALLED FROM MAIN LINE                                            *            
********************************************************************            
*                                                                               
CALCMAX  ST    RE,SAVERE                                                        
*                                                                               
         L     RF,JBLOPVTB         RF=L'OPERAND VALUE TABLE                     
         SR    RE,RE                                                            
         ZIC   R0,JBNOPERS                                                      
         MH    R0,=Y(L'JBCOLVAL)   R0=L'OPERAND VALUE ENTRY=DIVISOR             
         DR    RE,R0                                                            
         ST    RF,MAXOPVS                                                       
         L     RE,SAVERE                                                        
         BR    RE                                                               
         EJECT                                                                  
********************************************************************            
* INITIALIZE OPERAND VALUE TABLE (JBAOPVTB)                        *            
* CALLED FROM MAIN LINE                                            *            
********************************************************************            
*                                                                               
INOPV    ST    RE,SAVERE                                                        
         LH    RE,JBNROWS                                                       
         C     RE,MAXOPVS          TEST OVERFLOW OF OPERAND VALUE TABLE         
         BNH   INOPV2              NO                                           
         MVI   JBERROR,JBERROPV                                                 
         B     JOBERR                                                           
*                                                                               
INOPV2   L     RE,JBAOPVTB         RE=A(OPERAND VALUE TABLE)                    
         ZIC   R0,JBNOPERS         R0=N'OPERANDS                                
         MH    R0,JBNROWS          N'OPERANDS*N'ROWS=N'ACCUMULATORS             
         ZAP   0(L'JBCOLVAL,RE),=P'0'                                           
         LA    RE,L'JBCOLVAL(RE)                                                
         BCT   R0,*-10                                                          
         L     RE,SAVERE                                                        
         BR    RE                                                               
         EJECT                                                                  
********************************************************************            
* BUILD COLUMN TABLE ENTRY (COLENT) FOR SLUSH AND CALL ADDCOL      *            
*                                                                  *            
* CALLED FROM MAIN LINE                                            *            
********************************************************************            
*                                                                               
SLUSH    ST    RE,SAVERE                                                        
         LA    R7,COLENT                                                        
         USING JBCOLD,R7                                                        
         XC    COLENT,COLENT                                                    
         MVI   JBCOLTYP,JBCOLTCT                                                
         MVC   JBCOLCAT,SLUSHCAT                                                
         GOTO1 ADDCOL,1                                                         
         L     RE,SAVERE                                                        
         BR    RE                                                               
         EJECT                                                                  
********************************************************************            
* ADD COLUMN TABLE ENTRY (COLENT) TO COLUMN OUTPUT TABLE (JBACOLTB)*            
* AND INITIALIZES JBCOLVAL.                                        *            
*                                                                  *            
* AT ENTRY, COLENT CONTAINS JBCOLTYP,JBCOLCOD,JBCOLCAT             *            
*           AND R1=0 TO ONLY ADD COLUMN OUTPUT TABLE ENTRY         *            
*                 =1 TO ADD BOTH COLUMN AND OPERAND VALUE ENTRIES  *            
*                                                                  *            
* ON EXIT, ACOLENT POINTS TO ENTRY JUST ADDED                      *            
*                                                                  *            
* CALLED FROM INCOL, PROCAT, GETWC & SLUSH                         *            
********************************************************************            
*                                                                               
ADDCOL   NTR1  ,                                                                
         STC   R1,BYTE                                                          
         LA    R7,COLENT           R7=A(COLUMN ENTRY TO ADD)                    
         USING JBCOLD,R7                                                        
         LH    R3,JBLCOL           R3=L'COLUMN                                  
         L     R5,JBACOLTB         R5=A(COLUMN OUTPUT TABLE ENTRY)              
*                                                                               
         LH    R2,JBNROWS                                                       
         LA    R2,1(R2)            INCREMENT N'ROWS                             
         STH   R2,JBNROWS                                                       
*                                                                               
         C     R2,MAXCOLS          TEST TOO BIG FOR COLUMN TABLE                
         BH    ADDCOLC                                                          
*                                                                               
         STCM  R2,3,JBCOLROW                                                    
         BCTR  R2,0                                                             
         MR    R2,R2               N'ROWS*L'ROW                                 
         LA    R5,0(R3,R5)         INDEX TO NEW POSITION                        
         ST    R5,ACOLENT          SAVE A(NEW ENTRY)                            
         DROP  R7                                                               
         USING JBCOLD,R5                                                        
*                                                                               
         LA    R1,JBCOLVAL-JBCOLD                                               
         LA    RE,JBCOLVAL                                                      
         TM    JBSELFUN,JBGET1R    DO WE WANT THE 1R ACCOUNTS?                  
         BZ    *+12                NO                                           
         LA    R1,JBCOLV1R-JBCOLD                                               
         LA    RE,JBCOLV1R         YES, COLVAL IN DIFFERENT SPOT                
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R5),COLENT                                                   
*                                                                               
         ZIC   R0,JBNCOLS                                                       
         ZAP   0(L'JBCOLVAL,RE),=P'0'                                           
         LA    RE,L'JBCOLVAL(RE)                                                
         BCT   R0,*-10                                                          
*                                                                               
         CLI   BYTE,0              TEST TO ADD OPERAND VALUE ENTRY              
         BE    ADDCOLX             NO                                           
*                                                                               
         LH    R3,JBNROWS          INITIALIZE OPERAND VALUE TABLE               
         C     R3,MAXOPVS          TEST OVERFLOW OPERAND VALUE TAB              
         BH    ADDCOLO                                                          
         BCTR  R3,0                                                             
         ZIC   R0,JBNOPERS         R0=N'OPERANDS                                
         LR    R1,R0                                                            
         MH    R0,=Y(L'JBCOLVAL)   R0=L'OPERAND VALUE ENTRY                     
         MR    R2,R0               INDEX INTO TABLE                             
         A     R3,JBAOPVTB         R3=A(OPERAND VALUE TABLE)                    
         ZAP   0(L'JBCOLVAL,R3),=P'0'                                           
         LA    R3,L'JBCOLVAL(R3)                                                
         BCT   R1,*-10                                                          
*                                                                               
ADDCOLX  B     EXIT                                                             
*                                                                               
ADDCOLC  MVI   JBERROR,JBERRCOL    COLUMN TABLE OVERFLOW                        
         B     JOBERR                                                           
*                                                                               
ADDCOLO  MVI   JBERROR,JBERROPV    OPERAND VALUE TABLE OVERFLOW                 
         B     JOBERR                                                           
         DROP  R5                                                               
         EJECT                                                                  
*****************************************************************               
* ADD ENTRY TO CATEGORY FORMULA TABLE (CATTAB)                  *               
*                                                               *               
* CALLED FROM PROCAT                                            *               
*                                                               *               
* AT ENTRY, R4=A(CATEGORY RECORD), R6=A(CATEGORY ELEMENT)       *               
*****************************************************************               
*                                                                               
ADDCAT   NTR1  ,                                                                
         USING CATRECD,R4                                                       
         USING CADELD,R6                                                        
         MVI   CATFRMSW,YES        SET SWITCH FOR FORMULAS PRESENT              
         XC    WORK,WORK                                                        
         LA    RE,WORK             BUILD NEW ENTRY AT WORK                      
         USING CATTABD,RE                                                       
         MVC   CATCODE,CATKCODE    EXTRACT 'TO' CATEGORY CODE                   
         ZIC   R1,CADLINP          GET L'INPUT STRING                           
         LA    R2,CADLINP(R1)      POINT PAST INPUT                             
         ZIC   R1,0(R2)            GET L'FORMULA MINI-EL                        
         BCTR  R1,0                COMPUTE FORMULA LENGTH                       
         LA    R2,1(R2)            POINT TO FORMULA                             
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   CATFORM(0),0(R2)                                                 
         LA    R1,CATFORM-CATTABD+1(R1)                                         
         STC   R1,CATLEN                                                        
*                                                                               
         LH    R2,CATTABL          GET L'TABLE                                  
         LR    RF,R1               NEW ENTRY'S LENGTH                           
         AR    RF,R2               ADD IN TABLE LENGTH                          
         LA    R0,L'CATTAB                                                      
         CR    RF,R0               TEST IF TABLE BLOWN                          
         BNH   *+6                                                              
         DC    H'0'                                                             
         STH   RF,CATTABL          SET NEW TABLE LENGTH                         
         LA    R2,CATTAB(R2)       R2=A(NEW ENTRY)                              
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),WORK        MOVE IN NEW ENTRY                            
*                                                                               
ADDCATX  B     EXIT                                                             
         DROP  R4,R6,RE                                                         
         EJECT                                                                  
***********************************************************************         
* ADJUST OPERAND TABLE TO ACCUMULATE AGENCY COMMISSION LINES          *         
*                                                                     *         
* CALLED FROM MAIN LINE                                               *         
***********************************************************************         
*                                                                               
ADJOP    NTR1  ,                                                                
         LA    R5,OPTAB            R5=OPERAND TABLE                             
         USING OPERD,R5                                                         
         ZIC   R4,JBNOPERS         R4=N'OPERANDS                                
*                                                                               
ADJOP2   L     R6,ACOMTAB                                                       
*                                                                               
ADJOP3   CLC   0(2,R6),=X'0000'    TEST FOR EOT                                 
         BE    ADJOP8              NEXT OPERAND                                 
         CLC   OPERNUM,0(R6)       TEST IF OPERAND OF INTEREST                  
         BE    ADJOP4              YES                                          
         LA    R6,L'COMMTAB(R6)                                                 
         B     ADJOP3                                                           
*                                                                               
ADJOP4   MVC   CLDATA,OPERD        EXTRACT OPERAND DATA                         
         MVC   CLNUM,2(R6)         SET COMMISSION DATA NUMBER                   
         L     R7,ACOPTAB          NOW FIND ITS COPTAB ENTRY                    
         USING COPTABD,R7                                                       
         LA    R0,NCOPTAB                                                       
         CLC   CLNUM,COPNUM                                                     
         BE    ADJOP6                                                           
         LA    R7,COPTABL(R7)                                                   
         BCT   R0,*-14                                                          
         DC    H'0'                BIG PROBLEM                                  
*                                                                               
ADJOP6   BAS   RE,ADDOPER          ADD OPERAND ENTRY IF NEEDED                  
*                                                                               
ADJOP8   LA    R5,OPERL(R5)        NEXT OPERAND ENTRY                           
         BCT   R4,ADJOP2                                                        
*                                                                               
ADJOPX   B     EXIT                                                             
         DROP  R5,R7                                                            
         EJECT                                                                  
***************************************************************                 
* SET PEREST WITH PERCENTAGE OF ESTIMATE TO BILL              *                 
*                                                             *                 
* CALLED FROM MAIN LINE                                       *                 
***************************************************************                 
*                                                                               
SETPER   ZAP   PEREST,=P'0'                                                     
         CLI   BILTYP,C'A'         SPECIAL AUTO BILL ?                          
         BNE   SETPER1             NO                                           
         OC    JBPEREST,JBPEREST   YES, WAS AN AMOUNT PASSED ?                  
         BZ    SETPER1             NO                                           
         ZAP   PEREST,JBPEREST     YES, USE IT                                  
*                                                                               
SETPER1  CLI   BILTYP,C'E'         TEST FOR PERCENT OF ESTIMATE BILL            
         BNER  RE                  NO-EXIT                                      
         ST    RE,SAVERE                                                        
         L     RE,AJOBEL                                                        
         USING JOBELD,RE                                                        
         L     R1,BILAM1           FIRST BILLING PERCENTAGE                     
         TM    JOBBIST,X'80'       TEST IF FIRST BILL DONE                      
         BZ    SETPER2             NO                                           
*                                                                               
         A     R1,BILAM2                                                        
         TM    JOBBIST,X'40'       TEST IF SECOND BILL DONE                     
         BZ    SETPER2                                                          
*                                                                               
         A     R1,BILAM3                                                        
*                                                                               
SETPER2  CVD   R1,DUB                                                           
         ZAP   PEREST,DUB          SAVE COMPUTED PERCENT                        
*                                                                               
SETPERX  L     RE,SAVERE                                                        
         BR    RE                                                               
         DROP  RE                                                               
         EJECT                                                                  
******************************************************************              
* READ ESTIMATE RECORDS, DEDUCE THE ORIGINAL AND CURRENT ESTIMATE*              
* AND CALL GETEST OR GETEST1R.                                   *              
*                                                                *              
* CALLED FROM MAIN LINE CODE.                                    *              
******************************************************************              
*                                                                               
EST      NTR1  ,                                                                
         LA    R4,KEY                                                           
         USING EVERECD,R4                                                       
         XC    EVEKEY,EVEKEY                                                    
         MVI   EVEKTYP,EVEKTYPQ                                                 
         MVI   EVEKSUB,EVEKSUBQ                                                 
         MVC   EVEKCPY(3),CUL                                                   
         MVC   EVEKCLI,CLIENT                                                   
         MVC   EVEKPRO,PRODUCT                                                  
         MVC   EVEKJOB,JOBNUM                                                   
         MVC   LERKEY,KEY          SAVE THE KEY                                 
*                                                                               
EST1     BAS   RE,HIGH                                                          
         B     EST3                                                             
*                                                                               
EST2     LA    R4,KEY                                                           
         BAS   RE,READ                                                          
         BAS   RE,SEQ                                                           
*                                                                               
EST3     CLC   EVEKEY(EVEKTYPE-EVEKEY),KEYSAVE TEST SAME JOB                    
         BNE   EST6                NO-NOW DO ORIGINAL AND CURRENT ESTS          
*                                                                               
         LA    RF,EVEKEY+(EVEKWC-EVEKEY)                                        
         OC    0(L'EVEKWC,RF),0(RF)   IS IT A TIME EST RECORD?                  
         BZ    *+12                   NO                                        
         TM    JBSELFUN,JBGET1R    YES, DO WE WANT THE 1R DETAILS?              
         BZ    EST2                NO, SKIP THIS ONE                            
*                                                                               
         L     R4,JBAIO            R4=A(RECORD)                                 
         MVC   ESTYPE,EVEKTYPE     EXTRACT TYPE/VERSION                         
         MVC   ESTVERS,EVEKVER                                                  
*                                                                               
         CLI   EVEKTYPE,EVEKTREV   TEST FOR REVISION                            
         BNE   EST4                NO-PLANNING ESTIMATE                         
*                                                                               
         CLI   JBLOWREV,0          TEST IF FIRST REVISION                       
         BNE   *+10                                                             
         MVC   JBLOWREV,EVEKVER    YES-SET REVISION NUMBER                      
         MVC   JBHIREV,EVEKVER     UPDATE HIGHEST REVISION NUMBER               
*                                                                               
         USING EAPELD,R6                                                        
         MVI   ELCODE,EAPELQ       SEARCH FOR APPROVAL ELEMENT                  
         BAS   RE,GETEL                                                         
         BNE   EST4                NO-UNAPPROVED                                
         MVC   JBHIAPP,EVEKVER     NOTE ITS REVISION NUMBER                     
         MVC   JBHIAPDT,EAPDATE    SAVE THE APPROVAL DATE                       
         MVC   JBHIAPBY,EAPPBY     SAVE THE APRROVER NAME                       
         DROP  R6                                                               
*                                                                               
EST4     BAS   RE,TSTEST           TEST IF ESTIMATE IS AN OPERAND               
         BNE   EST2                NO-GET NEXT RECORD                           
*                                                                               
         LA    RF,EVEKEY+(EVEKWC-EVEKEY)                                        
         OC    0(L'EVEKWC,RF),0(RF)   IS IT A TIME EST RECORD?                  
         BZ    EST5                   NO                                        
         GOTO1 GETEST1R,0                                                       
         B     EST2                                                             
*                                                                               
EST5     GOTO1 GETEST,0            GET ESTIMATE VALUES FROM RECORD              
         B     EST2                GET NEXT RECORD                              
*                                                                               
EST6     CLI   JBLOWREV,0          TEST FOR ANY REVISIONS                       
         BE    ESTX                NO-EXIT RIGHT NOW                            
*                                                                               
         MVI   JBORGTYP,EVEKTREV                                                
         MVC   JBORGVER,JBLOWREV   ORIGINAL ESTIMATE=LOWEST REVISION            
         MVI   JBCURTYP,EVEKTREV                                                
         MVC   JBCURVER,JBHIREV    CURRENT ESTIMATE=HIGHEST REVISION            
         CLI   NEEDAE,YES          UNLESS YOU NEED APPROVED ESTIMATE            
         BNE   EST8                TO BILL                                      
         CLI   JBHIAPP,0           AND YOU HAVE AN APPROVED ESTIMATE            
         BE    EST8                                                             
         MVC   JBCURVER,JBHIAPP    THEN ITS THE HIGHEST APPROVED ONE            
*                                                                               
EST8     XC    ESTYPE(2),ESTYPE    CLEAR OUT KEY VALUES                         
         LA    R4,KEY                                                           
         MVC   KEY,LERKEY          RESTORE THE KEY                              
         MVC   EVEKTYPE,JBORGTYP                                                
         MVC   EVEKVER,JBORGVER                                                 
         BAS   RE,READ                                                          
*                                                                               
         GOTO1 GETEST,1                                                         
*                                                                               
         OC    JBAOE,JBAOE         TEST FOR ORIGINAL EST BUFFER                 
         BZ    EST8AA                                                           
         L     RE,JBAOE                                                         
         L     R4,JBAIO                                                         
         LH    RF,ACCORLEN(R4)                                                  
         LR    R5,RF                                                            
         MVCL  RE,R4               COPY RECORD TO BUFFER                        
*                                                                               
EST8AA   TM    JBSELFUN,JBGET1R    DO WE WANT THE 1R ACCOUNTS?                  
         BZ    EST9                NO, GO GET CURRENT                           
         LA    R4,KEY              YES, READ FOR THOSE RECORDS                  
*                                                                               
EST8A    BAS   RE,SEQ                                                           
         CLC   EVEKEY(EVEKWC-EVEKEY),KEYSAVE   DO WE HAVE ANY?                  
         BNE   EST9                NO, DO CURRENT                               
         LA    RF,EVEKEY+(EVEKWC-EVEKEY)                                        
         OC    0(L'EVEKWC,RF),0(RF)   DOUBLE CHECK FOR TIME                     
         BNZ   *+6                                                              
         DC    H'0'                IF NOT, I MADE A MISTAKE                     
         GOTO1 GETEST1R,1                                                       
         B     EST8A                                                            
*                                                                               
EST9     LA    R4,KEY                                                           
         MVC   KEY,LERKEY          RESTORE THE KEY                              
         MVC   EVEKTYPE,JBCURTYP                                                
         MVC   EVEKVER,JBCURVER                                                 
         BAS   RE,READ                                                          
         GOTO1 GETEST,2                                                         
*                                                                               
         OC    JBACE,JBACE         TEST FOR CURRENT EST BUFFER                  
         BZ    EST10A                                                           
         L     RE,JBACE                                                         
         L     R4,JBAIO                                                         
         LH    RF,ACCORLEN(R4)                                                  
         LR    R5,RF                                                            
         MVCL  RE,R4               COPY RECORD TO BUFFER                        
*                                                                               
EST10A   TM    JBSELFUN,JBGET1R    DO WE WANT THE 1R ACCOUNTS?                  
         BZ    EST10               NO, GO GET CURRENT                           
         LA    R4,KEY              YES, READ FOR THOSE RECORDS                  
*                                                                               
EST10AA  BAS   RE,SEQ                                                           
         CLC   EVEKEY(EVEKWC-EVEKEY),KEYSAVE   DO WE HAVE ANY?                  
         BNE   EST10               NO, DO CURRENT                               
         LA    RF,EVEKEY+(EVEKWC-EVEKEY)                                        
         OC    0(L'EVEKWC,RF),0(RF)   DOUBLE CHECK FOR TIME                     
         BNZ   *+6                                                              
         DC    H'0'                IF NOT, I MADE A MISTAKE                     
         GOTO1 GETEST1R,2                                                       
         B     EST10AA                                                          
*                                                                               
EST10    CLI   HIREVSW,YES         TEST TO READ HIGHEST REVISION                
         BNE   EST14               NO                                           
*        CLC   JBCURVER,JBHIREV    TEST CURRENT ESTIMATE=HI REV                 
*        BE    EST12               YES-NO NEED TO READ IT AGAIN                 
*                                                                               
         LA    R4,KEY                                                           
         MVC   KEY,LERKEY          RESTORE THE KEY                              
         MVI   EVEKTYPE,EVEKTREV                                                
         MVC   EVEKVER,JBHIREV                                                  
         BAS   RE,READ                                                          
         GOTO1 GETEST,7                                                         
*                                                                               
         TM    JBSELFUN,JBGET1R    DO WE WANT THE 1R ACCOUNTS?                  
         BZ    EST14               NO, GO GET CURRENT                           
         LA    R4,KEY              YES, READ FOR THOSE RECORDS                  
*                                                                               
EST10BB  BAS   RE,SEQ                                                           
         CLC   EVEKEY(EVEKWC-EVEKEY),KEYSAVE   DO WE HAVE ANY?                  
         BNE   EST14               NO, DO CURRENT                               
         LA    RF,EVEKEY+(EVEKWC-EVEKEY)                                        
         OC    0(L'EVEKWC,RF),0(RF)   DOUBLE CHECK FOR TIME                     
         BNZ   *+6                                                              
         DC    H'0'                IF NOT, I MADE A MISTAKE                     
         GOTO1 GETEST1R,7                                                       
         B     EST10BB                                                          
*                                                                               
EST14    CLI   JBCURVER,1          IS CURRENT ESTIMATE REVISION 1?              
         BE    ESTX                YES, THERE IS NO PREVIOUS THEN               
         ZIC   R1,JBCURVER                                                      
         BCTR  R1,0                                                             
         LA    R4,KEY                                                           
         MVC   KEY,LERKEY          RESTORE THE KEY                              
         MVC   EVEKTYPE,JBCURTYP                                                
         STC   R1,EVEKVER                                                       
         BAS   RE,READ                                                          
         GOTO1 GETEST,8                                                         
*                                                                               
         TM    JBSELFUN,JBGET1R    DO WE WANT THE 1R ACCOUNTS?                  
         BZ    ESTX                NO, WE ARE DONE                              
         LA    R4,KEY              YES, READ FOR THOSE RECORDS                  
*                                                                               
EST15    BAS   RE,SEQ                                                           
         CLC   EVEKEY(EVEKWC-EVEKEY),KEYSAVE   DO WE HAVE ANY?                  
         BNE   ESTX                NO, DONE                                     
         LA    RF,EVEKEY+(EVEKWC-EVEKEY)                                        
         OC    0(L'EVEKWC,RF),0(RF)   DOUBLE CHECK FOR TIME                     
         BNZ   *+6                                                              
         DC    H'0'                IF NOT, I MADE A MISTAKE                     
         GOTO1 GETEST1R,8                                                       
         B     EST15                                                            
*                                                                               
ESTX     B     EXIT                                                             
         EJECT                                                                  
******************************************************************              
* CHECK IF ESTIMATE IS AN OPERAND                                *              
*                                                                *              
* AT ENTRY, JBAIO=A(ESTIMATE RECORD)                             *              
*                                                                *              
* ON EXIT, CC=EQ IF YES, CC=NEQ IF NO                            *              
*                                                                *              
* CALLED FROM EST                                                *              
******************************************************************              
*                                                                               
TSTEST   NTR1  ,                                                                
         L     R4,JBAIO                                                         
         USING EVERECD,R4                                                       
         LA    R5,OPTAB            R5=A(OPERAND TABLE)                          
         USING OPERD,R5                                                         
         ZIC   R0,JBNOPERS                                                      
*                                                                               
TSTEST2  CLC   EVEKTYPE(2),OPEREST MATCH ON ESTIMATE TYPE/VERSION               
         BE    OK                                                               
         LA    R5,OPERL(R5)                                                     
         BCT   R0,TSTEST2                                                       
         B     NOTOK                                                            
         EJECT                                                                  
******************************************************************              
* PROCESS AND ESTIMATE AND CALL ROUTINES TO POST TO NECESSARY    *              
* TABLES.                                                        *              
*                                                                *              
* AT ENTRY, R1=0 FOR REGULAR ESTIMATE,1=ORIGINAL ESTIMATE        *              
* 2=CURRENT ESTIMATE, 7=HIGHEST REVISION, 8=PREVIOUS ESTIMATE    *              
*                                                                *              
* CALLED FROM EST AND MAIN LINE TO HANDLE ESTIMATE RECORD PASSED *              
* TO JOBBER                                                      *              
******************************************************************              
*                                                                               
GETEST   NTR1  ,                                                                
         ST    R1,FULL             SAVE PARM                                    
         L     R4,JBAIO                                                         
         USING EVERECD,R4                                                       
         LA    R6,EVERECD+ACCORFST R6=ELEMENT POINTER                           
         USING EDAELD,R6                                                        
         XC    LOOK1R,LOOK1R                                                    
*                                                                               
GETEST2  CLI   0(R6),0             TEST FOR EOR                                 
         BE    GETESTX             YES, DONE                                    
         CLI   0(R6),EDAELQ        LOOK FOR ESTIMATE DATA ELEMENT               
         BNE   GETEST3             NOT FOUND                                    
         TM    EDATYPE,EDATWORK    TEST FOR WORKCODE ESTIMATE                   
         BNZ   GETEST4                                                          
*                                                                               
GETEST3  ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     GETEST2             NEXT ELEMENT                                 
*                                                                               
GETEST4  MVC   LOOKWC,EDAWORK      EXTRACT WORKCODE                             
         MVI   LOOKSUFF,C'C'       START WITH COMMISSIONABLE                    
         BAS   RE,GETWC            LOOK UP THE WORKCODE                         
         ZAP   WORK2,EDACOMM       NET=COMMISSIONABLE ESTIMATE                  
         ZAP   NET,WORK2                                                        
         BAS   RE,SETCOMM                                                       
         ZAP   HOURS,=P'0'                                                      
         ZAP   HOURSB,=P'0'                                                     
         ZAP   HOURSN,=P'0'                                                     
         ZAP   HOURSR,=P'0'                                                     
         TM    EDATYPE,EDATTEST    TEST HOURS ON WC ELEMENT                     
         BZ    *+10                                                             
         ZAP   HOURS,EDAHOURS                                                   
*                                                                               
         TM    EDATYPE,EDATBNR     TEST TYPE OF HOURS BY WC                     
         BZ    GETEST6                                                          
         ZAP   HOURSB,EDABHRS                                                   
         ZAP   HOURSN,EDANHRS                                                   
         ZAP   HOURSR,EDARHRS                                                   
*                                                                               
GETEST6  BAS   RE,GETOPV           GET OPERAND VALUE ENTRY                      
         ZAP   DUB,NET                                                          
         LA    R1,JBDEST                                                        
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         ZAP   DUB,GROSS                                                        
         LA    R1,JBDESTG                                                       
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         ZAP   DUB,COMM                                                         
         LA    R1,JBDESTC                                                       
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         ZAP   DUB,HOURS           HOURS                                        
         LA    R1,JBDESTH                                                       
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         ZAP   DUB,HOURSB          B HOURS                                      
         LA    R1,JBDESTHB                                                      
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         ZAP   DUB,HOURSN          N HOURS                                      
         LA    R1,JBDESTHN                                                      
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         ZAP   DUB,HOURSR          R HOURS                                      
         LA    R1,JBDESTHR                                                      
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         CLI   FULL+3,2            TEST CURRENT ESTIMATE CALL                   
         BNE   GETEST7             NO                                           
         CLI   PERESTSW,YES        TEST PERCENT OF ESTIMATE NEEDED              
         BNE   GETEST7                                                          
*                                                                               
         ZAP   WORK2,EDACOMM                                                    
         MP    WORK2,PEREST                                                     
         SRP   WORK2,64-4,5        COMPUTE CUR EST*PEREST                       
         ZAP   NET,WORK2           SAVE IT                                      
         ZAP   DUB,NET                                                          
         GOTO1 POSTEST,JBDPCUR                                                  
*                                                                               
         MP    WORK2,LOOKRATE      COMPUTE COMMISSION                           
         SRP   WORK2,64-6,5                                                     
         ZAP   DUB,WORK2                                                        
         GOTO1 POSTEST,JBDPCURC                                                 
*                                                                               
         AP    DUB,NET             COMPUTE GROSS                                
         GOTO1 POSTEST,JBDPCURG                                                 
*                                                                               
GETEST7  CLI   EDALN,EDALNQ1       TEST FOR COMMISSIONABLE ONLY                 
         BE    GETEST3             YES-GET NEXT ELEMENT                         
*                                                                               
GETEST8  MVI   LOOKSUFF,C'N'       FOLLOW WITH NON-COMMISSIONABLE               
         BAS   RE,GETWC            LOOK UP THE WORKCODE                         
         ZAP   WORK2,EDANCOM       NET=NON-COMMISSIONABLE ESTIMATE              
         ZAP   NET,WORK2                                                        
         ZAP   GROSS,NET           GROSS=NET                                    
         ZAP   COMM,=P'0'          COMMISSION=ZERO                              
         BAS   RE,GETOPV                                                        
         ZAP   DUB,NET                                                          
         LA    R1,JBDEST                                                        
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
         LA    R1,JBDESTG                                                       
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         CLI   FULL+3,2            TEST CURRENT ESTIMATE                        
         BNE   GETEST9                                                          
         CLI   PERESTSW,YES        TEST NEED PER OF EST                         
         BNE   GETEST9                                                          
*                                                                               
         ZAP   WORK2,EDANCOM                                                    
         MP    WORK2,PEREST                                                     
         SRP   WORK2,64-4,5                                                     
         ZAP   DUB,WORK2                                                        
         GOTO1 POSTEST,JBDPCUR                                                  
         GOTO1 POSTEST,JBDPCURG                                                 
*                                                                               
GETEST9  B     GETEST3             NEXT ELEMENT                                 
*                                                                               
GETESTX  B     EXIT                                                             
         EJECT                                                                  
******************************************************************              
* PROCESS AND ESTIMATE AND CALL ROUTINES TO POST TO NECESSARY    *              
* TABLES.                                                        *              
*                                                                *              
* AT ENTRY, R1=0 FOR REGULAR ESTIMATE,1=ORIGINAL ESTIMATE        *              
* 2=CURRENT ESTIMATE, 7=HIGHEST REVISION, 8=PREVIOUS ESTIMATE    *              
*                                                                *              
* CALLED FROM EST AND MAIN LINE TO HANDLE ESTIMATE RECORD PASSED *              
* TO JOBBER                                                      *              
******************************************************************              
*                                                                               
GETEST1R NTR1  ,                                                                
         ST    R1,FULL             SAVE PARM                                    
         TM    JBSELFUN,JBGET1R    ARE THEY LOOKING FOR 1R?                     
         BZ    GETE1RX             NO                                           
*                                                                               
         L     R4,JBAIO                                                         
         USING EVERECD,R4                                                       
         MVC   LOOKWC,EVEKWC                                                    
         USING EVERECD,R4                                                       
         LA    R6,EVERECD+ACCORFST R6=ELEMENT POINTER                           
         USING EPTELD,R6                                                        
*                                                                               
GETE1R2  CLI   0(R6),0             TEST FOR EOR                                 
         BE    GETE1RX             YES, DONE                                    
         CLI   0(R6),EPTELQ        LOOK FOR ESTIMATE PERSON ELEMENTS            
         BE    GETE1R4                                                          
*                                                                               
GETE1R3  ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     GETE1R2             NEXT ELEMENT                                 
*                                                                               
GETE1R4  MVC   LOOK1R,EPTULA                                                    
         MVI   LOOKSUFF,C'C'       START WITH COMMISSIONABLE                    
         BAS   RE,GETWC            LOOK UP THE WORKCODE                         
         ZAP   WORK2,EPTAMNT       NET=COMMISSIONABLE ESTIMATE                  
         ZAP   NET,WORK2                                                        
         BAS   RE,SETCOMM                                                       
         ZAP   HOURS,=P'0'                                                      
*                                                                               
         TM    EPTINDS,EPTIHOUR    TEST HOURS ON WC ELEMENT                     
         BZ    GETE1R6                                                          
         ZAP   HOURSB,EPTBHRS                                                   
         ZAP   HOURSN,EPTNHRS                                                   
         ZAP   HOURSR,EPTRHRS                                                   
*                                                                               
         ZAP   HOURS,EPTBHRS                                                    
         AP    HOURS,EPTNHRS                                                    
         AP    HOURS,EPTRHRS                                                    
*                                                                               
GETE1R6  BAS   RE,GETOPV           GET OPERAND VALUE ENTRY                      
         ZAP   DUB,NET                                                          
         LA    R1,JBDEST                                                        
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
         ZAP   DUB,GROSS                                                        
         LA    R1,JBDESTG                                                       
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
         ZAP   DUB,COMM                                                         
         LA    R1,JBDESTC                                                       
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         ZAP   DUB,HOURS           HOURS                                        
         LA    R1,JBDESTH                                                       
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         ZAP   DUB,HOURSB          B HOURS                                      
         LA    R1,JBDESTHB                                                      
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         ZAP   DUB,HOURSN          N HOURS                                      
         LA    R1,JBDESTHN                                                      
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         ZAP   DUB,HOURSR          R HOURS                                      
         LA    R1,JBDESTHR                                                      
         A     R1,FULL                                                          
         GOTO1 POSTEST,(R1)                                                     
*                                                                               
         CLI   FULL+3,2            TEST CURRENT ESTIMATE CALL                   
         BNE   GETE1R9             NO                                           
         CLI   PERESTSW,YES        TEST PERCENT OF ESTIMATE NEEDED              
         BNE   GETE1R9                                                          
*                                                                               
         ZAP   WORK2,EPTAMNT                                                    
         MP    WORK2,PEREST                                                     
         SRP   WORK2,64-4,5        COMPUTE CUR EST*PEREST                       
         ZAP   DUB,WORK2                                                        
         GOTO1 POSTEST,JBDPCUR                                                  
         GOTO1 POSTEST,JBDPCURG                                                 
*                                                                               
GETE1R9  B     GETE1R3             NEXT ELEMENT                                 
*                                                                               
GETE1RX  B     EXIT                                                             
         EJECT                                                                  
******************************************************************              
* READ OLD ESTIMATE RECORDS AND CALL ROUTINES TO POST TO         *              
* NECESSARY TABLES                                               *              
*                                                                *              
* CALLED FROM MAIN LINE CODE.                                    *              
******************************************************************              
*                                                                               
OLDEST   NTR1  ,                                                                
         L     R4,JBAJOB           R4=A(JOB RECORD)                             
         USING ACTRECD,R4                                                       
         LA    R6,ACCORFST(R4)                                                  
*                                                                               
OLDEST2  CLI   0(R6),0             TEST FOR EOR                                 
         BE    OLDESTX             YES                                          
         CLI   0(R6),ESTELQ        TEST FOR ESTIMATE ELEMENT                    
         BE    OLDEST4                                                          
*                                                                               
OLDEST3  ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     OLDEST2                                                          
*                                                                               
         USING ESTELD,R6                                                        
OLDEST4  MVC   LOOKWC,ESTWORK      EXTRACT WORKCODE                             
         MVI   LOOKSUFF,0                                                       
         BAS   RE,GETWC                                                         
*                                                                               
OLDEST6  ZAP   WORK2,ESTORIG       ORIGINAL ESTIMATE                            
         ZAP   NET,WORK2                                                        
         BAS   RE,SETCOMM                                                       
*                                                                               
OLDEST7  BAS   RE,GETOPV                                                        
         ZAP   DUB,NET                                                          
         GOTO1 POSTEST,JBDORG                                                   
         ZAP   DUB,GROSS                                                        
         GOTO1 POSTEST,JBDORGG                                                  
         ZAP   DUB,COMM                                                         
         GOTO1 POSTEST,JBDORGC                                                  
*                                                                               
OLDEST8  ZAP   WORK2,ESTCURR       CURRENT ESTIMATE                             
         ZAP   NET,WORK2                                                        
         BAS   RE,SETCOMM                                                       
*                                                                               
OLDEST9  ZAP   DUB,NET                                                          
         GOTO1 POSTEST,JBDCUR                                                   
         ZAP   DUB,GROSS                                                        
         GOTO1 POSTEST,JBDCURG                                                  
         ZAP   DUB,COMM                                                         
         GOTO1 POSTEST,JBDCURC                                                  
*                                                                               
OLDEST10 CLI   PERESTSW,YES        TEST COMPUTE PER OF EST                      
         BNE   OLDEST15            NO                                           
*                                                                               
         ZAP   WORK2,ESTCURR                                                    
         MP    WORK2,PEREST                                                     
         SRP   WORK2,64-4,5        COMPUTE CUR EST*PEREST                       
         ZAP   NET,WORK2           SAVE IT                                      
         ZAP   DUB,NET                                                          
         GOTO1 POSTEST,JBDPCUR                                                  
*                                                                               
         MP    WORK2,LOOKRATE      COMPUTE COMMISSION                           
         SRP   WORK2,64-6,5                                                     
         ZAP   DUB,WORK2                                                        
         GOTO1 POSTEST,JBDPCURC                                                 
*                                                                               
         AP    DUB,NET             COMPUTE GROSS                                
         GOTO1 POSTEST,JBDPCURG                                                 
*                                                                               
OLDEST15 B     OLDEST3                                                          
*                                                                               
OLDESTX  B     EXIT                                                             
         DROP  R4,R6                                                            
         EJECT                                                                  
******************************************************************              
* POST ESTIMATE VALUES TO THE OPERAND VALUE TABLE (JBAOPVTB)     *              
*                                                                *              
* AT ENTRY, R1=DATA NUMBER, DUB=VALUE, AND AOPVALUE=A(OPERAND    *              
*           VALUE ENTRY)                                         *              
*                                                                *              
* CALLED FROM GETEST, GETEST1R AND OLDEST                        *              
******************************************************************              
*                                                                               
POSTEST  NTR1  ,                                                                
         STH   R1,HALF                                                          
         L     R4,AOPVALUE         R4=A(OPERAND VALUE ENTRY)                    
         LA    R5,OPTAB            R5=A(OPERAND TABLE)                          
         USING OPERD,R5                                                         
         ZIC   R0,JBNOPERS         R0=OPERAND COUNTER                           
*                                                                               
POSTEST2 CLC   HALF,OPERNUM        TEST FOR DATA NUMBER                         
         BNE   POSTEST3                                                         
         CLI   OPEREST,0           TEST FOR SPECIFIC ESTIMATE                   
         BE    POSTEST4            NO                                           
         CLC   OPEREST,ESTYPE      MATCH ON ESTIMATE TYPE                       
         BNE   POSTEST3                                                         
         CLC   OPERVER,ESTVERS     MATCH ON VERSION NUMBER                      
         BE    POSTEST4                                                         
*                                                                               
POSTEST3 LA    R4,L'JBCOLVAL(R4)   NEXT OPERAND VALUE                           
         LA    R5,OPERL(R5)        NEXT OPERAND LIST ENTRY                      
         BCT   R0,POSTEST2                                                      
         B     POSTESTX            ALL DONE                                     
*                                                                               
POSTEST4 AP    0(L'JBCOLVAL,R4),DUB UPDATE ACCUMULATOR                          
*                                                                               
POSTESTX B     EXIT                                                             
         EJECT                                                                  
**************************************************************                  
* READ OPEN PURCHASE ORDERS AND CALL GETPO.                  *                  
*                                                            *                  
* CALLED FROM MAIN LINE                                      *                  
**************************************************************                  
*                                                                               
PO       NTR1  ,                                                                
         MVC   KEY,SPACES                                                       
         LA    R4,KEY                                                           
         USING TRNRECD,R4                                                       
         L     RE,JBAJOB           RE=A(JOB RECORD)                             
         MVC   TRNKCULA,0(RE)      EXTRACT THE JOB'S KEY                        
         MVC   TRNKWORK,=C'**'     SET FOR PURCHASE ORDERS                      
*                                                                               
PO1      BAS   RE,HIGH                                                          
         B     PO3                                                              
*                                                                               
PO2      LA    R4,KEY                                                           
         BAS   RE,SEQ                                                           
*                                                                               
PO3      CLC   TRNKEY(TRNKCULC-TRNRECD),KEYSAVE                                 
         BNE   POX                 NO MORE PURCHASE ORDERS                      
*                                                                               
         L     R4,JBAIO                                                         
         CLI   ACCORFST(R4),TRNELQ TEST RECORD STARTS W TRANSACTION             
         BNE   PO2                 NO-MUST BE HEADER                            
*                                                                               
         BAS   RE,GETPO            GET THE PURCHASE ORDER VALUES                
         LA    R4,KEY                                                           
         ZIC   R1,TRNKSBR                                                       
         LA    R1,1(R1)            BUMP AHEAD TO NEXT RECORD                    
         STC   R1,TRNKSBR          GETOPT CALL MEANS RE-ESTABLISH               
         B     PO1                 READ SEQUENCE                                
*                                                                               
POX      B     EXIT                                                             
         EJECT                                                                  
**************************************************************                  
* GET PO VALUES AND CALL ROUTINES TO POST TO NECESSARY TABLES*                  
*                                                            *                  
* CALLED FROM PO                                             *                  
**************************************************************                  
*                                                                               
GETPO    NTR1  ,                                                                
         L     R4,JBAIO                                                         
         LH    RE,ACCORLEN(R4)     GET RECORD LENGTH                            
         LA    RE,0(R4,RE)                                                      
         MVI   0(RE),0             MAKE SURE EOR IS CLEARED                     
         LA    R6,ACCORFST(R4)     R6=A(ELEMENT)                                
         USING OAMELD,R6                                                        
*                                                                               
GETPO2   CLI   0(R6),0             TEST FOR EOR                                 
         BE    GETPOX              YES                                          
         CLI   0(R6),OAMELQ        TEST FOR ORDER AMOUNT ELEMENT                
         BE    GETPO4                                                           
*                                                                               
GETPO3   ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     GETPO2                                                           
*                                                                               
GETPO4   CLI   JBNEWEST,JBMCSQ     FOR MCS ESTIMATES                            
         BE    GETPO8                                                           
*                                                                               
         TM    OAMSTAT,OAMSNOCM    TEST FOR NON-COMM ITEM                       
         BO    GETPO6              YES                                          
         MVC   LOOKWC,OAMWORK      GET WORKCODE                                 
         MVI   LOOKSUFF,C'C'       SET FOR COMMISSIONABLE                       
         BAS   RE,GETWC            FIND THE COLUMN FOR WORKCODE                 
*                                                                               
         ZAP   WORK2,OAMAMNT       PURCHASE ORDER AMOUNT                        
         SP    WORK2,OAMIVAL       DEDUCT INVOICED AMOUNT                       
         BNM   *+10                DON'T LET IT GO NEGATIVE                     
         ZAP   WORK2,=P'0'                                                      
         ZAP   NET,WORK2                                                        
         BAS   RE,SETCOMM          SET THE COMMISSION RATE                      
         B     GETPO7                                                           
*                                                                               
GETPO6   MVC   LOOKWC,OAMWORK                                                   
         MVI   LOOKSUFF,C'N'       SET FOR NON-COMMISSIONABLE                   
         BAS   RE,GETWC                                                         
         ZAP   WORK2,OAMAMNT                                                    
         SP    WORK2,OAMIVAL       DEDUCT INVOICED AMOUNT                       
         BNM   *+10                DON'T LET IT GO NEGATIVE                     
         ZAP   WORK2,=P'0'                                                      
         ZAP   NET,WORK2                                                        
         ZAP   GROSS,NET                                                        
         ZAP   COMM,=P'0'                                                       
*                                                                               
GETPO7   BAS   RE,GETOPV           GET OPERAND VALUE ENTRY                      
         ZAP   DUB,NET             NOW POST THE NUMBERS                         
         GOTO1 POSTVAL,JBDPO                                                    
         ZAP   DUB,GROSS                                                        
         GOTO1 POSTVAL,JBDPOG                                                   
         ZAP   DUB,COMM                                                         
         GOTO1 POSTVAL,JBDPOC                                                   
         B     GETPO3              NEXT ELEMENT                                 
*                                                                               
GETPO8   GOTO1 AMCSORD                                                          
         BE    GETPO3                                                           
         MVI   JBERROR,JBERRCOL    COLUMN TABLE OVERFLOW                        
         B     JOBERR                                                           
*                                                                               
GETPOX   B     EXIT                                                             
         EJECT                                                                  
**************************************************************                  
* POST VALUES TO OPERAND VALUE TABLE (JBAOPVTB)              *                  
*                                                            *                  
* CALLED FROM GETPO, GETACT AND RATE                         *                  
*                                                            *                  
* AT ENTRY, R1=DATA NUMBER, DUB=VALUE, AOPVALUE=A(OPERAND    *                  
*           VALUE ENTRY)                                     *                  
**************************************************************                  
*                                                                               
POSTVAL  NTR1  ,                                                                
         STH   R1,HALF                                                          
         L     R4,AOPVALUE                                                      
         LA    R5,OPTAB                                                         
         USING OPERD,R5                                                         
         ZIC   R0,JBNOPERS                                                      
*                                                                               
POSTVAL2 CLC   OPERNUM,HALF        MATCH ON DATA NUMBER                         
         BE    POSTVAL4                                                         
         LA    R4,L'JBCOLVAL(R4)   NEXT VALUE                                   
         LA    R5,OPERL(R5)                                                     
         BCT   R0,POSTVAL2                                                      
         B     POSTVALX                                                         
*                                                                               
POSTVAL4 AP    0(L'JBCOLVAL,R4),DUB                                             
*                                                                               
POSTVALX B     EXIT                                                             
         EJECT                                                                  
**************************************************************                  
* READ TRANSACTION RECORDS AND CALL GETACT                   *                  
*                                                            *                  
* CALLED FROM MAIN LINE                                      *                  
**************************************************************                  
*                                                                               
ACT      NTR1  ,                                                                
         MVC   KEY,SPACES                                                       
         LA    R4,KEY                                                           
         USING TRNRECD,R4                                                       
         L     RE,JBAJOB           RE=A(JOB RECORD)                             
         MVC   TRNKCULA,0(RE)      EXTRACT THE JOB'S KEY                        
         MVI   TRNKWORK,C'A'       SET TO SKIP TO TRANSACTIONS                  
         BAS   RE,HIGH                                                          
         B     ACT3                                                             
*                                                                               
ACT2     LA    R4,KEY                                                           
         BAS   RE,SEQ                                                           
*                                                                               
ACT3     CLC   TRNKCULA,KEYSAVE    TEST SAME JOB                                
         BNE   ACTX                NO-ALL DONE                                  
         CLC   TRNKWORK,=C'99'     TEST FOR BILLS                               
         BE    ACTX                YES-ALL DONE                                 
*                                                                               
         L     R4,JBAIO                                                         
         OC    ACCOPEEL(ACCOPLEN,R4),ACCOPEEL(R4)                               
         BNZ   ACTX                YES - SKIP PEELED                            
*** CHECK THIS OUT                                                              
*                                                                               
         CLI   ACCORFST(R4),TRNELQ TEST RECORD STARTS W TRANSACTION             
         BNE   ACT2                NO-MUST BE HEADER                            
         CLI   JBGETDFT,C'Y'       INCLUDE DRAFT & LIVE TRANSACTIONS ?          
         BE    ACT6                YES                                          
         TM    ACCOSTAT(R4),TRNSDRFT NI, IS THIS A DRAFT?                       
         BZ    ACT4                NO                                           
         CLI   JBGETDFT,C'O'       YES, DO WE WANT DRAFTS ONLY ?                
         BE    ACT6                YES                                          
         B     ACT2                NO, SKIP IT                                  
*                                                                               
ACT4     CLI   JBGETDFT,C'O'       THIS IS LIVE, DO WE WANT IT ?                
         BE    ACT2                NO, ONLY WANT DRAFTS                         
*                                                                               
ACT6     BAS   RE,GETACT           GET THE ACTUAL VALUES                        
*                                  SEQUENCE MAY HAVE CHANGED IN GETOPT          
         BAS   RE,HIGH             REREAD LAST RECORD                           
         B     ACT2                GET NEXT                                     
*                                                                               
ACTX     B     EXIT                                                             
         EJECT                                                                  
**************************************************************                  
* GET ACTUAL VALUES AND CALL ROUTINES TO POST TO NECESSARY   *                  
* TABLES                                                     *                  
*                                                            *                  
* CALLED FROM ACT                                            *                  
**************************************************************                  
*                                                                               
         USING TRNELD,R6                                                        
GETACT   NTR1  ,                                                                
         L     R4,JBAIO                                                         
         LA    R6,ACCORFST(R4)     R6=A(ELEMENT)                                
*                                                                               
GETACT2  CLI   JBNEWEST,JBMCSQ     FOR MCS ESTIMATES                            
         BE    GETACT20                                                         
*                                                                               
         TM    TRNSTAT,TRNSNOCM    TEST FOR NON-COMM ITEM                       
         BO    GETACT4             YES                                          
         MVC   LOOKWC,TRNANAL      GET WORKCODE                                 
         MVI   LOOKSUFF,C'C'       SET FOR COMMISSIONABLE                       
         BAS   RE,GETWC            FIND THE COLUMN FOR WORKCODE                 
         ZAP   WORK2,TRNAMNT       TRANSACTION AMOUNT                           
         CLI   JBXJOB,YES          IS THIS AN X-JOB ?                           
         BNE   *+8                                                              
         BAS   RE,GETXAMT          YES, GET AMOUNT FOR X'50' ELEMENT            
         ZAP   NET,WORK2                                                        
         BAS   RE,SETCOMM                                                       
         B     GETACT6                                                          
*                                                                               
GETACT4  MVC   LOOKWC,TRNANAL                                                   
         MVI   LOOKSUFF,C'N'       SET FOR NON-COMMISSIONABLE                   
         BAS   RE,GETWC                                                         
         ZAP   WORK2,TRNAMNT       TRANSACTION AMOUNT                           
         CLI   JBXJOB,YES          IS THIS AN X-JOB ?                           
         BNE   *+8                                                              
         BAS   RE,GETXAMT          YES, GET AMOUNT FOR X'50' ELEMENT            
         ZAP   NET,WORK2                                                        
         ZAP   GROSS,NET                                                        
         ZAP   COMM,=P'0'                                                       
*                                                                               
GETACT6  ZAP   HOURS,=P'0'                                                      
         USING PRTELD,R6                                                        
         SR    RE,RE                                                            
*                                                                               
GETACT8  IC    RE,1(R6)                                                         
         AR    R6,RE                                                            
         CLI   0(R6),0                                                          
         BE    GETACT10                                                         
         CLI   0(R6),PRTELQ        LOOK FOR PERSONNEL RATE ELEMENT              
         BNE   GETACT8                                                          
         AP    HOURS,PRTHOUR       GET HOURS                                    
         B     GETACT8                                                          
*                                                                               
GETACT10 BAS   RE,GETOPV           GET OPERAND VALUE ENTRY                      
         ZAP   DUB,NET             NOW POST THE NUMBERS                         
         GOTO1 POSTVAL,JBDACT                                                   
         ZAP   DUB,GROSS                                                        
         GOTO1 POSTVAL,JBDACTG                                                  
         ZAP   DUB,COMM                                                         
         GOTO1 POSTVAL,JBDACTC                                                  
         ZAP   DUB,HOURS                                                        
         GOTO1 POSTVAL,JBDACTH                                                  
         B     GETACTX                                                          
*                                                                               
GETACT20 GOTO1 AMCSACT                                                          
         BE    GETACTX                                                          
         MVI   JBERROR,JBERRCOL    COLUMN TABLE OVERFLOW                        
         B     JOBERR                                                           
*                                                                               
GETACTX  B     EXIT                                                             
         DROP  R6                                                               
         EJECT                                                                  
**************************************************************                  
* COMPUTE COMMISSION                                         *                  
*                                                            *                  
* AT ENTRY, WORK2=NET, LOOKRATE=COMMISSION RATE              *                  
*                                                            *                  
* ON EXIT, COMM AND GROSS ARE SET                            *                  
*                                                            *                  
* CALLED FROM GETEST, OLDEST, GETPO & GETACT                 *                  
**************************************************************                  
*                                                                               
SETCOMM  MP    WORK2,LOOKRATE                                                   
         SRP   WORK2,64-6,5                                                     
         B     SETCOMMX                                                         
*                                                                               
SETCOMMX ZAP   COMM,WORK2                                                       
         AP    WORK2,NET                                                        
         ZAP   GROSS,WORK2                                                      
         BR    RE                                                               
         EJECT                                                                  
**************************************************************                  
* GET ACTUAL AMOUNT OF TRANSACTION IN X'50' ELEMENT FOR      *                  
* EXPENSE JOB POSTINGS.                                      *                  
*                                                            *                  
* ON EXIT, WORK2 IS SET                                      *                  
*                                                            *                  
* CALLED FROM GETACT                                         *                  
**************************************************************                  
*                                                                               
         USING SCIELD,R6                                                        
GETXAMT  NTR1  ,                                                                
         MVI   ELCODE,SCIELQ                                                    
         BAS   RE,GETEL                                                         
         BE    GETXAMT4                                                         
         B     GETXAMTX            USE TRANSACTION AMOUNT IF NO X'50'           
*                                                                               
GETXAMT2 SR    RF,RF                                                            
         IC    RF,1(R6)                                                         
         AR    R6,RF                                                            
         CLI   0(R6),0             END OF RECORD ?                              
         BE    GETXAMTX            YES                                          
         CLI   0(R6),SCIELQ        NO, X'50' ELEMENT ?                          
         BNE   GETXAMT2            NO, KEEP LOOKING                             
*                                                                               
GETXAMT4 CLI   SCITYPE,SCITSJXP    IS THIS THE EXPENSE AMOUNT ?                 
         BNE   GETXAMT2            NO, KEEP LOOKING                             
         ZAP   WORK2,SCIAMNT       YES, SAVE IT                                 
*                                                                               
GETXAMTX B     EXIT                                                             
         DROP  R6                                                               
         EJECT                                                                  
**************************************************************                  
* LOOP THROUGH COLUMN OUTPUT TABLE (JBACOLTB) AND CALL       *                  
* GETWC, GETOPV AND POSTVAL TO ADD COMMISSION RATE TO        *                  
* OPERAND VALUE TABLE (JBAOPVTB)                             *                  
*                                                            *                  
* CALLED FROM MAIN LINE                                      *                  
**************************************************************                  
*                                                                               
RATE     NTR1  ,                                                                
         L     R5,JBACOLTB         R5=A(COLUMN OUTPUT TABLE)                    
         USING JBCOLD,R5                                                        
         LH    R2,JBNROWS          R2=LOOP COUNTER                              
         LH    R4,JBLCOL           R4=L'TABLE ENTRY                             
*                                                                               
RATE2    CLI   JBCOLTYP,JBCOLTWC   TEST FOR WORKCODE LINE                       
         BNE   RATE4               NO                                           
*                                                                               
         MVC   LOOKWC,JBCOLWC      EXTRACT WORKCODE                             
         MVC   LOOKSUFF,JBCOLSUF   SUFFIX                                       
         MVC   LOOK1R,JBCOL1R      AND 1R                                       
         BAS   RE,GETWC                                                         
         BAS   RE,GETOPV                                                        
         ZAP   DUB,LOOKRATE                                                     
         GOTO1 POSTVAL,JBDRATE                                                  
*                                                                               
RATE4    LA    R5,0(R4,R5)         NEXT ENTRY                                   
         BCT   R2,RATE2                                                         
*                                                                               
RATEX    B     EXIT                                                             
         DROP  R5                                                               
         EJECT                                                                  
**************************************************************                  
* FIND LOOKWC AND LOOKSUFF IN COLUMN OUTPUT TABLE (JBACOLTB) *                  
* AND CALL GETRATE                                           *                  
*                                                            *                  
* ON ENTRY, LOOKWC & LOOKSUFF=WORKCODE TO BE LOOKED UP       *                  
*                                                            *                  
* ON EXIT, LOOKROW=ROW NUMBER                                *                  
*          LOOKRATE=COMMISSION RATE TO 4 DECIMALS            *                  
*          ACOLENT=A(COLUMN TABLE ENTRY FOR WC)              *                  
*                                                            *                  
* CALLED FROM GETEST, GETEST1R, OLDEST, GETPO, GETACT & RATE *                  
**************************************************************                  
*                                                                               
GETWC    NTR1  ,                                                                
         L     R5,JBACOLTB         R5=A(COLUMN TABLE)                           
         USING JBCOLD,R5                                                        
         LH    R4,JBLCOL           R4=L'COLUMN TABLE ENTRY                      
         SR    R2,R2                                                            
         ICM   R2,3,JBNROWS        R2=N'ROWS                                    
         BZ    GETWC6              NONE                                         
*                                                                               
GETWC2   CLI   JBCOLTYP,JBCOLTWC   TEST FOR WORKCODE ENTRY                      
         BNE   GETWC3                                                           
         CLC   LOOKWC,JBCOLWC      MATCH ON WORKCODE                            
         BNE   GETWC3                                                           
         CLI   JBCOLSUF,0          TEST FOR SUFFIX                              
         BE    GETWC4              NO                                           
         CLC   LOOKSUFF,JBCOLSUF   MATCH ON SUFFIX                              
         BE    GETWC4              YES                                          
*                                                                               
GETWC3   LA    R5,0(R4,R5)                                                      
         BCT   R2,GETWC2                                                        
         B     GETWC6                                                           
*                                                                               
GETWC4   MVC   LOOKROW,JBCOLROW    EXTRACT ROW NUMBER                           
         MVC   LOOKSUFF,JBCOLSUF   SET ACTUAL SUFFIX                            
         OC    LOOK1R,LOOK1R       DO WE HAVE A PERSON?                         
         BNZ   GETWC5              YES                                          
*                                                                               
GETWC4A  ST    R5,ACOLENT                                                       
         BAS   RE,GETRATE          FETCH THE RATE                               
         B     GETWCX                                                           
*                                                                               
GETWC5   CLC   LOOK1R,JBCOL1R      MATCH ON 1R ACCOUNT                          
         BE    GETWC4A             YES                                          
         MVC   SVCATCOD,JBCOLCAT   SAVE CATEGORY CODE                           
         B     GETWC3                                                           
*                                                                               
GETWC6   OC    LOOK1R,LOOK1R       DO WE HAVE A PERSON?                         
         BZ    GETWC7              NO                                           
         XC    COLENT,COLENT       CLEAR COLUMN ENTRY                           
         LA    R5,COLENT                                                        
         MVI   JBCOLTYP,JBCOLTWC   SET WORKCODE TYPE                            
         MVC   JBCOLWC,LOOKWC      SET WORKCODE                                 
         MVC   JBCOLCAT,SVCATCOD   SET CATEGORY                                 
         MVC   JBCOL1R,LOOK1R      SET THE 1R ACCOUNT                           
         GOTO1 ADDCOL,1            ADD THE NEW COLUMN                           
         MVC   LOOKROW,JBCOLROW                                                 
         B     GETWCX                                                           
*                                                                               
GETWC7   XC    COLENT,COLENT       CLEAR COLUMN ENTRY                           
         LA    R5,COLENT                                                        
         MVI   JBCOLTYP,JBCOLTWC   SET WORKCODE TYPE                            
         MVC   JBCOLWC,LOOKWC      SET WORKCODE                                 
         MVC   JBCOLCAT,SLUSHCAT   SET SLUSH CATEGORY                           
         GOTO1 ADDCOL,1                                                         
         L     R5,ACOLENT          ADDRESS NEW ENTRY                            
         MVC   LOOKROW,JBCOLROW    EXTRACT ROW NUMBER                           
         BAS   RE,GETRATE          NOW GET THE COMMISSION RATE                  
         MVI   LOOKSUFF,0          SET ACTUAL SUFFIX                            
*                                                                               
GETWCX   B     EXIT                                                             
         EJECT                                                                  
**************************************************************                  
* GET COMMISSION RATE FOR A COLUMN OUTPUT TABLE (JBACOLTB)   *                  
* ENTRY                                                      *                  
*                                                            *                  
* ON ENTRY, R5=A(COLUMN TABLE ENTRY)                         *                  
*                                                            *                  
* IN EXIT, LOOKRATE=COMMISSION RATE TO 4 DECIMALS            *                  
*                                                            *                  
* CALLED FROM GETWC                                          *                  
**************************************************************                  
*                                                                               
GETRATE  NTR1  ,                                                                
         USING JBCOLD,R5                                                        
         OC    JBCOLCOM,JBCOLCOM   TEST IF COMMISSION PRESENT                   
         BNZ   GETRATE4            YES-JUST COPY IT OVER INTO LOOKRATE          
*                                                                               
         CLI   WCOMSW,YES          TEST IF WORKCODE COMMISSION NEEDED           
         BE    GETRATE1            YES                                          
         ZAP   JBCOLCOM,=P'0'      SLOT IN ZERO AS RATE                         
         B     GETRATE4                                                         
*                                                                               
GETRATE1 CLI   JBCOLSUF,C'N'       TEST FOR NON-COMMISSIONABLE WC               
         BNE   GETRATE2            NO                                           
         ZAP   JBCOLCOM,=P'0'                                                   
         B     GETRATE4                                                         
*                                                                               
GETRATE2 L     R3,AGOBLOCK                                                      
         USING GOBLOCKD,R3                                                      
         MVC   GOSELWC,JBCOLWC     SET WORKCODE                                 
         GOTO1 JBGETOPT,DMCB,GOBLOCK                                            
         MVC   JBCOLCOM,GOAGYCOM   EXTRACT AGENCY COMMISSION                    
*                                                                               
GETRATE4 ZAP   LOOKRATE,JBCOLCOM                                                
         B     EXIT                                                             
         DROP  R3                                                               
         EJECT                                                                  
**************************************************************                  
* FIND THE OPERAND VALUE TABLE (JABOPVTB) ENTRY FOR A        *                  
* WORKCODE                                                   *                  
*                                                            *                  
* ON ENTRY, R5=A(COLUMN TABLE ENTRY)                         *                  
*                                                            *                  
* IN EXIT, AOPVALUE=A(OPERAND VALUE TABLE ENTRY)             *                  
*                                                            *                  
* CALLED FROM ROLL, RESOLVE, COLUMN, GETEST, GETEST1R, OLDEST*                  
*             GETPO, GETACT AND RATE                         *                  
**************************************************************                  
*                                                                               
GETOPV   ST    RE,SAVERE                                                        
         ZIC   RE,JBNOPERS                                                      
         MH    RE,=Y(L'JBCOLVAL)                                                
         LH    RF,LOOKROW                                                       
         BCTR  RF,0                                                             
         MR    RE,RE                                                            
         A     RF,JBAOPVTB                                                      
         ST    RF,AOPVALUE                                                      
*                                                                               
GETOPVX  L     RE,SAVERE                                                        
         BR    RE                                                               
         EJECT                                                                  
***************************************************************                 
* ROLL UP THE WORKCODE AMOUNTS TO SUBTOTAL, AGENCY COMMISSION *                 
* AND CATEGORY ROWS                                           *                 
*                                                             *                 
* CALLED FROM MAIN LINE                                       *                 
***************************************************************                 
*                                                                               
ROLL     NTR1  ,                                                                
         L     R5,JBACOLTB         R5=A(COLUMN TABLE)                           
         USING JBCOLD,R5                                                        
         LH    R6,JBLCOL           R6=BXLE INCREMENT-L'COLUMN ENTRY             
         LR    R7,R6                                                            
         MH    R7,JBNROWS          R7=BXLE LIMIT                                
         LA    R7,0(R5,R7)         ADD IN A(TABLE)                              
         BCTR  R7,0                                                             
*                                                                               
ROLL2    CLI   JBCOLTYP,JBCOLTWC   TEST FOR WORKCODE ROW                        
         BNE   ROLL20              NO                                           
*                                                                               
         MVC   LOOKROW,JBCOLROW                                                 
         BAS   RE,GETOPV                                                        
         MVC   AFROMVAL,AOPVALUE   FROM ROW--OPERAND VALUES                     
         MVI   AGYSW,NO            SET SWITCHES FOR AGENCY COMM                 
         MVI   SUBSW,NO            AND SUB-TOTALS ROWS                          
         MVI   AGYCATSW,NO         AND AGENCY COMMISSION CATEGORIES             
         LA    R4,0(R6,R5)         R4=LOOK AHEAD BXLE POINTER                   
         LR    R2,R6               LOOK AHEAD INCREMENT                         
         LR    R3,R7               LOOK AHEAD LIMIT                             
*                                                                               
ROLL4    CLC   JBCOLCAT,JBCOLCAT-JBCOLD(R4) TEST SAME CATEGORY                  
         BE    ROLL5               YES                                          
         CLI   AGYCATSW,YES        TEST AGENCY COMM CATEGORY POSTED             
         BE    ROLL20              YES-STOP LOOK AHEAD                          
         CLI   JBCOLTYP-JBCOLD(R4),JBCOLTCA  TEST AGY COMM CATEGORY             
         BNE   ROLL10              NO-NEXT ROW                                  
         MVI   AGYCATSW,YES                                                     
         B     ROLL9                                                            
*                                                                               
ROLL5    CLI   JBCOLTYP-JBCOLD(R4),JBCOLTSB TEST SUB-TOTAL ROW                  
         BNE   ROLL6               NO                                           
         CLI   SUBSW,YES           TEST IF SUB-TOTAL ALREADY DONE               
         BE    ROLL10              YES-KEEP LOOKING AHEAD                       
         MVI   SUBSW,YES           NO-ROLL IT UP                                
         B     ROLL9                                                            
*                                                                               
ROLL6    CLI   JBCOLTYP-JBCOLD(R4),JBCOLTAG  TEST AGENCY COMMISSION ROW         
         BNE   ROLL8                                                            
         CLI   AGYSW,YES           TEST ROW ALREADY DONE                        
         BE    ROLL10              YES                                          
         MVI   AGYSW,YES                                                        
         B     ROLL9                                                            
*                                                                               
ROLL8    CLI   JBCOLTYP-JBCOLD(R4),JBCOLTCT TEST CATEGORY                       
         BNE   ROLL10                                                           
*                                                                               
         MVC   LOOKROW,=H'1'       POST THE JOB TOTALS                          
         BAS   RE,GETOPV                                                        
         MVC   ATOVAL,AOPVALUE                                                  
         MVI   OP,PLUS             ADD                                          
         BAS   RE,UPACC                                                         
*                                                                               
ROLL9    MVC   LOOKROW,JBCOLROW-JBCOLD(R4)                                      
         BAS   RE,GETOPV                                                        
         MVC   ATOVAL,AOPVALUE                                                  
         MVI   OP,PLUS             ADD                                          
         BAS   RE,UPACC            UPDATE ACCUMULATORS                          
*                                                                               
ROLL10   BXLE  R4,R2,ROLL4         KEEP LOOKING AHEAD                           
*                                                                               
ROLL20   BXLE  R5,R6,ROLL2                                                      
*                                                                               
ROLLX    B     EXIT                                                             
         EJECT                                                                  
***************************************************************                 
* UPDATE OPERNAD VALUE ACCUMULATORS                           *                 
*                                                             *                 
* AT ENTRY, AFROMVAL=A(FROM VALUES), ATOVAL=A(TO VALUES) AND  *                 
* OP=OPERATION (+ OR -)                                       *                 
*                                                             *                 
* CALLED FROM ROLL                                            *                 
***************************************************************                 
*                                                                               
UPACC    ST    RE,SAVERE                                                        
         L     RE,AFROMVAL                                                      
         L     RF,ATOVAL                                                        
         ZIC   R0,JBNOPERS         R0=LOOP COUNTER                              
         LA    R1,OPTAB                                                         
         USING OPERD,R1                                                         
*                                                                               
UPACC2   CLC   OPERNUM,=AL2(JBDRATE) TEST FOR COMMISSION RATE                   
         BE    UPACC4              YES-SKIP ACCUMLATOR UPDATE                   
         CLI   JBSELRND,JBRNDDOL   ARE WE ROUNDING ?                            
         BNE   UPACC3              NO                                           
         CLI   JBRNDCOM,JBRNDCNO   YES, COMMISSION ALSO ?                       
         BNE   UPACC2A             YES                                          
         CLC   OPERNUM,=AL2(JBDESTC) NO, IS THIS COMMISSION ?                   
         BNL   UPACC3              YES, SKIP OVER ROUND                         
*                                                                               
UPACC2A  SRP   0(L'JBCOLVAL,RE),64-2,5                                          
         SRP   0(L'JBCOLVAL,RE),2,0                                             
*                                                                               
UPACC3   CLI   OP,C'-'             TEST FOR SUBTRACTION                         
         BE    *+14                                                             
         AP    0(L'JBCOLVAL,RF),0(L'JBCOLVAL,RE)                                
         B     *+10                                                             
         SP    0(L'JBCOLVAL,RF),0(L'JBCOLVAL,RE)                                
*                                                                               
UPACC4   LA    R1,OPERL(R1)                                                     
         LA    RE,L'JBCOLVAL(RE)                                                
         LA    RF,L'JBCOLVAL(RF)                                                
         BCT   R0,UPACC2                                                        
*                                                                               
UPACCX   L     RE,SAVERE                                                        
         BR    RE                                                               
         DROP  R1                                                               
         EJECT                                                                  
****************************************************************                
* BUILD TABLE OF SPECIAL WORKCODES                             *                
*                                                              *                
* AT ENTRY, R4=A(CATEGORY RECORD)                              *                
*           R6=A(CATEGORY WORKCODE ELEMENT)                    *                
*                                                              *                
* CALLED FROM PROCAT                                           *                
****************************************************************                
*                                                                               
         USING CATRECD,R4                                                       
         USING JBWCTABD,R5                                                      
         USING CWKELD,R6                                                        
BLDTBLE  NTR1                                                                   
         L     R5,JBAWCTB          A(WCTABLE)                                   
         L     R3,JBAWCTBL         L(WCTABLE)                                   
         LA    R3,0(R5,R3)                                                      
         BCTR  R3,0                BXLE LIMIT                                   
*                                                                               
BLDT02   CLI   0(R5),X'00'         ANY ROOM  FOR ENTRY                          
         BE    BLDT04              YES, MOVE IT IN                              
         LA    R2,JBWCTABL                                                      
         BXLE  R5,R2,BLDT02                                                     
         DC    H'0'                                                             
         DC    C'SPECIAL WORKCODE TABLE FULL'                                   
*                                                                               
BLDT04   MVC   JBWCKEY,CWKWORK                                                  
         MVC   JBWCREF,CWKCAT                                                   
         MVC   JBWCHOME,CATKCODE                                                
*                                                                               
BLDTX    B     EXIT                                                             
         DROP  R4,R5,R6                                                         
         EJECT                                                                  
*******************************************************************             
* BUILD A LINKED RESOLUTION LIST FOR THE CATEGORY FORMULAS        *             
*                                                                 *             
* CALLED FROM MAIN LINE                                           *             
*******************************************************************             
*                                                                               
LINK     NTR1  ,                                                                
         LA    RE,IOAREA           CLEAR IOAREA FOR LINKED LIST                 
         LA    RF,L'IOAREA                                                      
         SR    R1,R1                                                            
         MVCL  RE,R0                                                            
*                                                                               
         LA    R5,CATTAB           R5=A(CATEGORY TABLE)                         
         USING CATTABD,R5                                                       
         SR    R2,R2               R2=BXLE INCREMENT REGISTER                   
         LH    R3,CATTABL                                                       
         LA    R3,0(R5,R3)                                                      
         BCTR  R3,0                R3=BXLE LIMIT                                
*                                                                               
LINK2    XC    LINKREC,LINKREC     BUILD LINKED LIST ENTRIES                    
         LA    R6,LINKREC          R6=A(LINKED LIST RECORD)                     
         USING LINKLSTD,R6                                                      
         GOTO1 FINDROW,CATCODE                                                  
         BNE   *+6                                                              
         DC    H'0'                DUMP IF CANNOT FIND 'TO' CAT                 
         MVC   LINKTO,HALF         SET 'TO' ROW NUMBER                          
         LA    R4,CATFORM          R4=FORMULA POINTER                           
         ZIC   R1,CATLEN                                                        
         SH    R1,=Y(CATFORM-CATTABD) LENGTH OF FORMULA                         
         SR    R0,R0                                                            
         D     R0,=F'3'                                                         
         LR    R7,R1               SET R7=LOOP COUNTER                          
*                                                                               
LINK4    MVC   LINKOP,0(R4)        SET OPERATION                                
         GOTO1 FINDROW,1(R4)                                                    
         BE    LINK5               DID NOT FIND OPERAND                         
         MVC   LINKFROM,HALF       SET 'FROM' ROW                               
         BAS   RE,INSERT           INSERT NEW ENTRY IN LIST                     
*                                                                               
LINK5    LA    R4,3(R4)            NEXT FORMULA OPERATION/OPERAND               
         BCT   R7,LINK4                                                         
*                                                                               
LINK6    IC    R2,CATLEN           R2=ENTRY LENGTH                              
         BXLE  R5,R2,LINK2                                                      
*                                                                               
LINKX    B     EXIT                                                             
         DROP  R5,R6                                                            
         EJECT                                                                  
*******************************************************************             
* BUILD A LINKED RESOLUTION LIST FOR SPECIAL WORKCODES            *             
*                                                                 *             
* CALLED FROM MAIN LINE                                           *             
*******************************************************************             
*                                                                               
LINKWC   NTR1  ,                                                                
         LA    RE,IOAREA           CLEAR IOAREA FOR LINKED LIST                 
         LA    RF,L'IOAREA                                                      
         SR    R1,R1                                                            
         MVCL  RE,R0                                                            
*                                                                               
         USING JBWCTABD,R5                                                      
         L     R5,JBAWCTB          A(WCTABLE)                                   
         L     R3,JBAWCTBL         L(WCTABLE)                                   
         LA    R3,0(R5,R3)                                                      
         BCTR  R3,0                R3=BXLE LIMIT                                
*                                                                               
         USING LINKLSTD,R6                                                      
LINKWC2  CLI   0(R5),X'00'         ANY ENTRIES                                  
         BE    LINKWCX             NO                                           
         LA    R6,LINKREC          R6=A(LINKED LIST RECORD)                     
         XC    LINKREC,LINKREC     BUILD LINKED LIST ENTRIES                    
         MVC   LINKCODE,JBWCKEY                                                 
         MVC   LINKREF,JBWCREF                                                  
         MVC   LINKHOME,JBWCHOME                                                
         GOTO1 FINDROW,JBWCHOME                                                 
         BNE   *+6                                                              
         DC    H'0'                DUMP IF CANNOT FIND 'TO' CAT                 
         MVC   LINKTO,HALF         SET 'TO' ROW NUMBER                          
*                                                                               
         GOTO1 FINDROW,JBWCREF                                                  
         BE    LINKWC4             DID NOT FIND OPERAND                         
         MVC   LINKFROM,HALF       SET 'FROM' ROW                               
         BAS   RE,INSERT           INSERT NEW ENTRY IN LIST                     
*                                                                               
LINKWC4  LA    R2,JBWCTABL         R2=ENTRY LENGTH                              
         BXLE  R5,R2,LINKWC2                                                    
*                                                                               
LINKWCX  B     EXIT                                                             
         DROP  R5,R6                                                            
         EJECT                                                                  
*******************************************************************             
* FIND THE ROW NUMBER FOR A CATEGORY                              *             
*                                                                 *             
* AT ENTRY, R1=A(CATEGORY CODE)                                   *             
* ON EXIT, CC=EQ IF NOT FOUND, CC=NEQ IF FOUND AND HALF=ROW NUMBER*             
*                                                                 *             
* CALLED FROM LINK                                                *             
*******************************************************************             
*                                                                               
FINDROW  ST    RE,SAVERE                                                        
         MVC   DUB(2),0(R1)                                                     
         XC    HALF,HALF                                                        
         L     RE,JBACOLTB         RE=A(COLUMN TABLE)                           
         USING JBCOLD,RE                                                        
         LH    R0,JBNROWS                                                       
*                                                                               
FINDROW2 CLI   JBCOLTYP,JBCOLTCT   TEST FOR CATEGORY                            
         BL    FINDROW3                                                         
         CLI   JBCOLTYP,JBCOLTCF                                                
         BH    FINDROW3                                                         
         CLC   JBCOLCAT,DUB        TEST IF ITS THE RIGHT CATEGORY               
         BE    FINDROW4            YES                                          
*                                                                               
FINDROW3 AH    RE,JBLCOL           NEXT ENTRY LENGTH                            
         BCT   R0,FINDROW2                                                      
         B     FINDROWX                                                         
*                                                                               
FINDROW4 MVC   HALF,JBCOLROW       EXTRACT ITS ROW NUMBER                       
*                                                                               
FINDROWX OC    HALF,HALF           SET CC ON EXIT                               
         L     RE,SAVERE                                                        
         BR    RE                                                               
         DROP  RE                                                               
         EJECT                                                                  
*****************************************************************               
* INSERT A NEW LINKED LIST ENTRY                                *               
*                                                               *               
* AT ENTRY, LINKREC CONTAINS NEW ENTRY                          *               
*                                                               *               
* CALLED FROM LINK                                              *               
*****************************************************************               
*                                                                               
INSERT   NTR1  ,                                                                
         LA    R2,IOAREA                                                        
         USING LINKLSTD,R2                                                      
         XC    BEFORE(8),BEFORE    CLEAR BEFORE AND AFTER POINTERS              
         LA    R3,LINKREC          R3 NOW = A(NEW LINKED LIST ENTRY)            
*                                                                               
INSERT2  ICM   R2,15,LINKFRST      GET A(FIRST LOGICAL ENTRY)                   
         BNZ   INSERT4             YES-ONE IS THERE                             
*                                  BUILD ANCHOR ENTRY                           
         LA    R2,IOAREA                                                        
         LA    R3,LINKLSTL(R2)     R3=NEW ENTRY LOCATION                        
         MVC   0(LINKLSTL,R3),LINKREC INSERT NEW ENTRY                          
         STCM  R3,15,LINKFRST      SET ANCHOR ENTRY FIRST POINTER               
         STCM  R3,15,LINKLAST      SET ANCHOR ENTRY LAST POINTER                
         STCM  R3,15,LINKHIGH      SET ANCHOR ENTRY HIGHEST POINTER             
         DROP  R2                                                               
         USING LINKLSTD,R3                                                      
         STCM  R2,15,LINKFRWD      FORWARD POINTER 1ST ENTRY                    
         STCM  R2,15,LINKLAST      LAST POINTER 1ST ENTRY                       
         B     INSERTX                                                          
         DROP  R3                                                               
*                                  BUILD ANCHOR ENTRY                           
******************************************************************              
*          --INSERTION CRITERIA--                                *              
* NEW ENTRY'S FROM MUST BE AFTER ALL TO REFERENCES TO SAME ROW   *              
* NEW ENTRY'S TO ROW MUST BE BEFORE AND FROM REFERENCES TO IT    *              
******************************************************************              
*                                                                               
         USING LINKLSTD,R2                                                      
INSERT4  CLC   LINKTO,LINKFROM-LINKLSTD(R3)                                     
         BNE   *+8                                                              
         ST    R2,AFTER                                                         
         CLC   LINKFROM,LINKTO-LINKLSTD(R3)                                     
         BNE   INSERT6                                                          
         OC    BEFORE,BEFORE                                                    
         BNZ   *+8                                                              
         ST    R2,BEFORE                                                        
*                                                                               
INSERT6  ICM   R2,15,LINKFRWD      NEXT ENTRY                                   
         CLI   LINKOP,LINKEND      TEST FOR LOGICAL EOL                         
         BNE   INSERT4                                                          
*                                                                               
INSERT8  LA    R2,IOAREA           PTFA (POINT TO ANCHOR)                       
         ICM   R4,15,LINKHIGH      NOW POINTING TO ANCHOR                       
         LA    R4,LINKLSTL(R4)     ADD NEW ENTRY TO END                         
         STCM  R4,15,LINKHIGH      RESET ANCHOR'S POINTER TO END                
         MVC   0(LINKLSTL,R4),LINKREC INSERT NEW ENTRY                          
*                                                                               
         ICM   R2,15,BEFORE        R2=A(ENTRY TO INSERT BEFORE)                 
         BZ    *+12                NONE                                         
         ICM   R2,15,LINKBACK      R2=ENTRY TO INSERT AFTER                     
         B     INSERT9                                                          
*                                                                               
         ICM   R2,15,AFTER         R2=A(ENTRY TO INSERT AFTER)                  
         BNZ   INSERT9                                                          
         LA    R2,IOAREA           NONE-ADD TO END OF LOGICAL LIST              
         ICM   R2,15,LINKLAST                                                   
*                                                                               
* R2=A(ENTRY TO INSERT NEW ENTRY AFTER) AND R4=A(NEW ENTRY)                     
*                                                                               
INSERT9  MVC   LINKFRWD-LINKLSTD(L'LINKFRWD,R4),LINKFRWD                        
         STCM  R4,15,LINKFRWD      ADD AFTER POINTS TO NEW ENTRY                
         ICM   R2,15,LINKFRWD-LINKLSTD(R4)                                      
         MVC   LINKBACK-LINKLSTD(L'LINKBACK,R4),LINKBACK                        
         STCM  R4,15,LINKBACK                                                   
*                                                                               
INSERTX  B     EXIT                                                             
         DROP  R2                                                               
         EJECT                                                                  
******************************************************************              
* RESOLVE THE LINKED LIST OF CATEGORY FORMULAS                   *              
*                                                               *               
* AT ENTRY, IOAREA CONTAINS LIST                                *               
*                                                               *               
* CALLED FROM MAIN LINE                                         *               
******************************************************************              
*                                                                               
RESOLVE  NTR1  ,                                                                
         LA    R2,IOAREA                                                        
         USING LINKLSTD,R2                                                      
*                                                                               
RESOLVE2 ICM   R2,15,LINKFRWD                                                   
         BZ    RESOLVEX                                                         
         CLI   LINKOP,LINKEND      TEST FOR ANCHOR ENTRY                        
         BE    RESOLVEX                                                         
*                                                                               
         MVC   OP,LINKOP           SET OPERATION                                
         MVC   LOOKROW,LINKFROM    FROM ROW'S NUMBER                            
         BAS   RE,GETOPV                                                        
         MVC   AFROMVAL,AOPVALUE                                                
*                                                                               
         MVI   CASW,C'N'                                                        
         L     R5,JBACOLTB                                                      
         USING JBCOLD,R5                                                        
         LH    RE,LOOKROW                                                       
         BCTR  RE,0                                                             
         MH    RE,JBLCOL           INDEX TO COLUMN ENTRY                        
         LA    R5,0(RE,R5)                                                      
         CLI   JBCOLTYP,JBCOLTCA   TEST FOR AGY COMM CATEGORY                   
         BNE   *+8                                                              
         MVI   CASW,C'Y'           YES-SET SWITCH ACCORDINGLY                   
*                                                                               
         MVC   LOOKROW,LINKTO                                                   
         BAS   RE,GETOPV                                                        
         MVC   ATOVAL,AOPVALUE                                                  
         LA    RF,UPACC                                                         
         CLI   CASW,C'N'           TEST FROM CATEGORY IS NOT AGY COMM           
         BE    *+8                                                              
         LA    RF,UPCA                                                          
         BASR  RE,RF               UPDATE ACCUMULATORS                          
         B     RESOLVE2                                                         
*                                                                               
RESOLVEX B     EXIT                                                             
         DROP  R2,R5                                                            
         EJECT                                                                  
******************************************************************              
* RESOLVE THE LINKED LIST OF SPECIAL WORKCODES                   *              
*                                                               *               
* AT ENTRY, IOAREA CONTAINS LIST                                *               
*                                                               *               
* CALLED FROM MAIN LINE                                         *               
******************************************************************              
*                                                                               
         USING LINKLSTD,R2                                                      
         USING JBWCTABD,R5                                                      
RESOLWC  NTR1  ,                                                                
         LA    R2,IOAREA                                                        
         L     R5,JBAWCTB          WCTABLE                                      
*                                                                               
RESOLWC2 ICM   R2,15,LINKFRWD                                                   
         BZ    RESOLWCX                                                         
         CLI   LINKCODE,LINKEND                                                 
         BE    RESOLWCX                                                         
*                                                                               
         MVC   JBWCKEY,LINKCODE    SET CODE, REFERENCE AND HOME                 
         MVC   JBWCREF,LINKREF      CATEGORIES                                  
         MVC   JBWCHOME,LINKHOME                                                
         LA    R5,JBWCTABL(R5)     BUMP TO NEXT ENTRY                           
         B     RESOLWC2                                                         
*                                                                               
RESOLWCX B     EXIT                                                             
         DROP  R2,R5                                                            
         EJECT                                                                  
*****************************************************************               
* SPECIAL SUB-ROUTINE TO UPDATE ACCUMULATORS WHEN FROM CATEGORY *               
* IS AN AGENCY COMMISSION CATEGORY--CALLED FROM RESOLVE.        *               
* AT ENTRY, AFROMVAL AND ATOVAL MUST BE SET BY CALLER           *               
*           AND OP = '+' OR '-'                                 *               
*****************************************************************               
*                                                                               
UPCA     NTR1  ,                                                                
         ZIC   R2,JBNOPERS         R2=LOOP COUNTER                              
         L     R3,AFROMVAL         R3=A(FROM VALUES)                            
         L     R5,ATOVAL           R5=A(TO VALUES)                              
         LA    R4,OPTAB                                                         
         USING OPERD,R4                                                         
*                                                                               
UPCA2    L     R6,ACOMTAB          R6=A(COMMISSION DATATYPE TABLE)              
         LR    RE,R3               SET DEFAULT FROM VALUE ADDRESS               
*                                                                               
UPCA3    CLC   0(2,R6),=X'0000'    TEST FOR EOT                                 
         BE    UPCA8               YES                                          
         CLC   OPERNUM,0(R6)       TEST TO SUBSTITUTE COMMISSION                
         BE    UPCA4               FOR THIS OPERAND VALUE                       
         LA    R6,L'COMMTAB(R6)                                                 
         B     UPCA3                                                            
*                                                                               
UPCA4    MVC   FULL(2),2(R6)       EXTRACT COMMISSION VALUE TO BE               
         MVC   FULL+2(2),OPEREST   ALSO SLOT IN ESTIMATE DATA                   
         LA    R1,OPTAB            SUBSTITUTED                                  
         ZIC   R0,JBNOPERS         R0=LOOP COUNTER                              
         L     RE,AFROMVAL         RE=A(FROM VALUE)                             
*                                                                               
UPCA6    CLC   FULL,OPERNUM-OPERD(R1) TEST VALUE IS IN OPERAND LIST             
         BE    UPCA8                                                            
         LA    R1,OPERL(R1)                                                     
         LA    RE,L'JBCOLVAL(RE)                                                
         BCT   R0,UPCA6                                                         
         B     UPCA10              SUBSTITUTION CANNOT BE PERFORMED             
*                                                                               
UPCA8    CLI   OP,C'-'                                                          
         BE    *+14                                                             
         AP    0(L'JBCOLVAL,R5),0(L'JBCOLVAL,RE)                                
         B     *+10                                                             
         SP    0(L'JBCOLVAL,R5),0(L'JBCOLVAL,RE)                                
*                                                                               
UPCA10   LA    R3,L'JBCOLVAL(R3)                                                
         LA    R5,L'JBCOLVAL(R5)                                                
         LA    R4,OPERL(R4)                                                     
         BCT   R2,UPCA2                                                         
*                                                                               
UPCAX    B     EXIT                                                             
         DROP  R4                                                               
         EJECT                                                                  
******************************************************************              
* FILL IN THE COLUMN OUTPUT TABLE (JBACOLTB)                     *              
*                                                                *              
* CALLED FROM MAIN LINE                                          *              
******************************************************************              
*                                                                               
COLUMN   NTR1  ,                                                                
         L     R5,JBACOLTB         R5=A(COLUMN OUTPUT TABLE)                    
         USING JBCOLD,R5                                                        
         LH    R2,JBNROWS          R2=LOOP COUNTER                              
*                                                                               
COLUMN2  MVC   LOOKROW,JBCOLROW                                                 
         BAS   RE,GETOPV           GET ITS OPERAND VALUE ENTRY                  
         MVI   AGYCOMSW,YES                                                     
         CLI   JBCOLTYP,JBCOLTAG   TEST FOR AGENCY COMMISSION LINE              
         BE    COLUMN4             YES                                          
         CLI   JBCOLTYP,JBCOLTCA   TEST FOR COMMISSION CATEGORY                 
         BE    COLUMN4             YES                                          
         MVI   AGYCOMSW,NO         NOT AN AGENCY COMMISSION ONLY ROW            
*                                                                               
COLUMN4  L     R3,JBACOLS          R3=A(COLUMN LIST)                            
         USING JBCLD,R3                                                         
         LA    R4,JBCOLVAL         R4=A(COLUMN OUTPUT VALUE)                    
         TM    JBSELFUN,JBGET1R    DO WE WANT THE 1R ACCOUNTS?                  
         BZ    *+8                 NO                                           
         LA    R4,JBCOLV1R         YES, COLVAL IN DIFFERENT SPOT                
*                                                                               
COLUMN6  CLI   JBCLTYP,0           TEST FOR END OF COLUMN LIST                  
         BE    COLUMN20            YES-ROW                                      
         CLI   JBCLTYP,JBCLUNKN    TEST FOR UNKNOWN ENTRY                       
         BE    COLUMN10            YES                                          
*                                                                               
         MVC   CLDATA,JBCLCN1      SET COLUMN LIST DATA                         
         ZAP   CLVAL1,=P'0'                                                     
         BAS   RE,FINDCOP          FIND THE COLUMN OPERAND ENTRY                
         BNE   *+14                                                             
         BAS   RE,FORM             EXECUTE ITS FORMULA                          
         ZAP   CLVAL1,DUB          SAVE THE RESULT                              
*                                                                               
         CLI   JBCLTYP,JBCLFRM     TEST FOR FORMULA                             
         BNE   COLUMN8             NO                                           
         MVC   CLDATA,JBCLCN2      SECOND OPERAND                               
         ZAP   CLVAL2,=P'0'                                                     
         BAS   RE,FINDCOP                                                       
         BNE   *+14                                                             
         BAS   RE,FORM                                                          
         ZAP   CLVAL2,DUB                                                       
*                                                                               
         LA    RF,CLVAL1           RF=A(FIRST COLUMN VALUE)                     
         LA    R1,CLVAL2                                                        
         MVC   OP,JBCLOPER         OPERATION SIGN                               
         BAS   RE,OPERATE                                                       
*                                                                               
COLUMN8  ZAP   0(L'JBCOLVAL,R4),CLVAL1 SET RESULT IN TABLE                      
*                                                                               
COLUMN10 LA    R3,JBCLENQ(R3)      NEXT COLUMN ENTRY                            
         LA    R4,L'JBCOLVAL(R4)   NEXT OUTPUT ENTRY                            
         B     COLUMN6                                                          
*                                                                               
COLUMN20 AH    R5,JBLCOL                                                        
         BCT   R2,COLUMN2                                                       
*                                                                               
COLUMNX  B     EXIT                                                             
         EJECT                                                                  
******************************************************************              
* FIND THE COLUMN OPERAND TABLE (COPTAB) ENTRY                   *              
*                                                                *              
* AT ENTRY, CLDATA CONTAINS COLUMN DATA NUMBER                   *              
* ON EXIT, CC=EQ TO PROCESS COLUMN OPERAND ENTRY POINTED AT BY R7*              
*          CC=NEQ TO RETURN ZERO FOR COLUMN                      *              
*                                                                *              
* CALLED FROM COLUMN                                             *              
******************************************************************              
*                                                                               
FINDCOP  ST    RE,SAVERE                                                        
         L     R7,ACOPTAB          R7=A(COLUMN OPERAND TABLE ENTRY)             
         USING COPTABD,R7                                                       
         LA    R0,NCOPTAB          R0=COUNTER                                   
*                                                                               
FINDCOP2 CLC   CLNUM,COPNUM        MATCH ON DATA NUMBER                         
         BE    FINDCOP4                                                         
         LA    R7,COPTABL(R7)                                                   
         BCT   R0,FINDCOP2                                                      
         DC    H'0'                                                             
*                                                                               
FINDCOP4 CLI   AGYCOMSW,YES        TEST FOR AGENCY COMMISSION ROW               
         BNE   FINDCOPY            NO                                           
         MVC   CLNUM,COPCOM        RESET COMMISSION DATA NUMBER                 
         OC    CLNUM,CLNUM         TEST IF ANY DATA NUMBER FOR IT               
         BZ    FINDCOPN            NO-ITS ZERO                                  
*                                                                               
         L     R7,ACOPTAB                                                       
         USING COPTABD,R7                                                       
         LA    R0,NCOPTAB                                                       
*                                                                               
FINDCOP5 CLC   CLNUM,COPNUM                                                     
         BE    FINDCOPY                                                         
         LA    R7,COPTABL(R7)                                                   
         BCT   R0,FINDCOP5                                                      
         DC    H'0'                                                             
*                                                                               
FINDCOPY CR    RB,RB                                                            
         B     FINDCOPX                                                         
*                                                                               
FINDCOPN LTR   RB,RB                                                            
*                                                                               
FINDCOPX L     RE,SAVERE                                                        
         BR    RE                                                               
         EJECT                                                                  
*******************************************************************             
* EXECUTE THE COLUMN'S POLISH STRING NOTATION                     *             
*                                                                 *             
* AT ENTRY, R7=A(COLUMN OPERAND TABLE ENTRY)                      *             
*           CLDATA=COLUMN NUMBER/ESTIMATE TYPE/ESTIMATE VERSION   *             
*           AOPVALUE=A(OPERAND VALUE TABLE ENTRY)                 *             
* ON EXIT, DUB CONTAINS RESULT                                    *             
*                                                                 *             
* CALLED FROM COLUMN.                                             *             
*******************************************************************             
*                                                                               
FORM     NTR1  ,                                                                
         USING COPTABD,R7                                                       
         ZIC   R6,COPNOPER         R6=N'OPERANDS                                
         LA    R4,COPERS           R4=A(OPERAND DATA NUMBERS)                   
         LA    R3,OPDLIST          R3=A(OPERAND VALUE LIST)                     
*                                                                               
FORM2    BAS   RE,GETVAL           GET THE OPERAND'S VALUE                      
         ZAP   0(L'DUB,R3),DUB     SET THE VALUE INTO LIST                      
         LA    R4,2(R4)            NEXT DATA NUMBER                             
         LA    R3,L'DUB(R3)        NEXT VALUE POSITION                          
         BCT   R6,FORM2                                                         
*                                                                               
         LA    R3,OPDLIST                                                       
         LA    R4,STACK            R4=A(CALCULATION STACK)                      
         LA    R5,COPOLISH         R5=A(POLISH FORMULA)                         
*                                                                               
FORM4    TM    0(R5),X'40'         TEST OPERAND/OPERATION                       
         BO    FORM6               OPERATION                                    
*                                                                               
         ZIC   R1,0(R5)            GET OPERAND NUMBER                           
         BCTR  R1,0                                                             
         SLL   R1,3                INDEX INTO LIST                              
         LA    R1,0(R3,R1)                                                      
         MVC   0(L'DUB,R4),0(R1)   PUSH THE VALUE ONTO STACK                    
         B     FORM8                                                            
*                                                                               
FORM6    SH    R4,=Y(L'DUB)        POP THE STACK                                
         CLI   0(R5),C'='          TEST FOR END OF FORMULA                      
         BE    FORM10              YES                                          
         SH    R4,=Y(L'DUB)        BACK UP ANOTHER OPERAND                      
         LA    RF,0(R4)            RF=A(OPERAND 1)                              
         LA    R1,L'DUB(R4)        R1=A(OPERAND 2)                              
         MVC   OP,0(R5)            SET OPERATION                                
         BAS   RE,OPERATE                                                       
*                                                                               
FORM8    LA    R4,L'DUB(R4)                                                     
         LA    R5,1(R5)            NEXT ITEM IN FORMULA                         
         B     FORM4                                                            
*                                                                               
FORM10   MVC   DUB,0(R4)           EXTRACT RESULT                               
*                                                                               
FORMX    B     EXIT                                                             
         EJECT                                                                  
*****************************************************************               
* GET THE OPERAND VALUE (JBAOPVTB)                              *               
*                                                               *               
* AT ENTRY, R4=A(OPERAND DATA NUMBER), CLDATA SET FROM CALL TO  *               
*           FORM, AND AOPVALUE=A(OPERAND VALUE ENTRY)           *               
*                                                               *               
* ON EXIT, DUB CONTAINS RESULT                                  *               
*                                                               *               
* CALLED FROM FORM                                              *               
*****************************************************************               
*                                                                               
GETVAL   ST    RE,SAVERE                                                        
         ZAP   DUB,=P'0'                                                        
         LA    RE,WORK             BUILD OPERAND ENTRY FOR LOOKUP               
         USING OPERD,RE                                                         
         XC    OPERD(OPERL),OPERD                                               
         MVC   OPERNUM,0(R4)       SET DATA NUMBER FOR LOOKUP                   
         MVC   OPEREST(2),CLEST    SET EXTRA ESTIMATE DATA                      
*                                                                               
GETVAL1  CLC   OPERNUM,=AL2(JBDMAXPE) TEST FOR MAX PER OF EST                   
         BE    GETVAL4                                                          
         LA    RE,OPTAB            RE=A(OPERAND TABLE)                          
         ZIC   R0,JBNOPERS                                                      
         L     RF,AOPVALUE         RF=A(OPERAND VALUE ENTRY)                    
*                                                                               
GETVAL2  CLC   OPERD(OPERL),WORK   MATCH ON OPERAND                             
         BE    GETVAL3             YES                                          
         LA    RF,L'JBCOLVAL(RF)                                                
         LA    RE,OPERL(RE)                                                     
         BCT   R0,GETVAL2                                                       
         DC    H'0'                                                             
*                                                                               
GETVAL3  ZAP   DUB,0(L'JBCOLVAL,RF)                                             
         B     GETVALX                                                          
*                                                                               
GETVAL4  ZAP   DUB,MAXPER          SET MAX EST                                  
*                                                                               
GETVALX  L     RE,SAVERE                                                        
         BR    RE                                                               
         DROP  RE                                                               
         EJECT                                                                  
****************************************************************                
* PERFORM AN OPERATION                                         *                
*                                                              *                
* AT ENTRY, RF=A(OPERAND 1), R1=A(OPERAND 2), OP=OPERATION     *                
*                                                              *                
* ON EXIT, RF=A(RESULT)                                        *                
*                                                              *                
* CALLED FROM COLUMN AND FORM                                  *                
****************************************************************                
*                                                                               
OPERATE  ST    RE,SAVERE                                                        
         CLI   OP,PLUS             TEST FOR ADDITION                            
         BE    OPADDR                                                           
         CLI   OP,MINUS            TEST FOR SUBTRACTION                         
         BE    OPSUBR                                                           
         CLI   OP,MULTIPLY         TEST FOR MULTIPLICATION                      
         BE    OPMULTR                                                          
         CLI   OP,MULTPER          TEST FOR MULTIPLY BY PERCENTAGE              
         BE    OPMULPR                                                          
         CLI   OP,PERCENT          TEST FOR PERCENTAGE                          
         BE    OPPERCR                                                          
*                                                                               
OPADDR   AP    0(L'DUB,RF),0(L'DUB,R1)                                          
         B     OPERATEX                                                         
*                                                                               
OPSUBR   SP    0(L'DUB,RF),0(L'DUB,R1)                                          
         B     OPERATEX                                                         
*                                                                               
OPMULTR  ZAP   WORK(16),0(L'DUB,RF)                                             
         MP    WORK(16),0(L'DUB,R1)                                             
         SRP   WORK(16),64-2,5                                                  
         ZAP   0(L'DUB,RF),WORK(16)                                             
         B     OPERATEX                                                         
*                                                                               
OPMULPR  ZAP   WORK(16),0(L'DUB,RF)                                             
         MP    WORK(16),0(L'DUB,R1)                                             
         SRP   WORK(16),1,0                                                     
         CLI   JBSELRND,JBRNDDOL   TEST FOR ROUNDING TO DOLLARS                 
         BE    OPMULPR2                                                         
*                                                                               
         SRP   WORK(16),64-5,5     ROUNDED DIVIDE TO TWO DECIMALS               
         B     OPMULPR4                                                         
*                                                                               
OPMULPR2 SRP   WORK(16),64-7,5                                                  
         SRP   WORK(16),2,0                                                     
*                                                                               
OPMULPR4 ZAP   0(L'DUB,RF),WORK(16)                                             
         B     OPERATEX                                                         
*                                                                               
OPPERCR  CP    0(L'DUB,R1),=P'0'   TEST FOR ZERO DIVISOR                        
         BNE   *+14                                                             
         ZAP   0(L'DUB,RF),=P'0'                                                
         B     OPERATEX                                                         
*                                                                               
         ZAP   WORK(16),0(L'DUB,RF)                                             
         SRP   WORK(16),5,0        *10000 *10 FOR ROUNDING                      
         DP    WORK(16),0(L'DUB,R1)                                             
         SRP   WORK(8),64-1,5      ROUND BACK TO TWO DECIMALS                   
         ZAP   0(L'DUB,RF),WORK(8)                                              
*                                                                               
OPERATEX L     RE,SAVERE                                                        
         BR    RE                                                               
         EJECT                                                                  
* DATA MANAGER INTERFACE                                                        
*                                                                               
READ     NTR1  ,                                                                
         MVC   COMMAND,DMREAD                                                   
         MVC   KEYSAVE,KEY                                                      
         B     ACCFILE                                                          
         SPACE 1                                                                
SEQ      NTR1  ,                                                                
SEQSKIP  MVC   COMMAND,DMRSEQ                                                   
         OI    DMINBTS,X'08'       PASS DELETES                                 
         B     ACCFILE                                                          
         SPACE 1                                                                
HIGH     NTR1  ,                                                                
         MVC   COMMAND,DMRDHI                                                   
         MVC   KEYSAVE,KEY                                                      
         OI    DMINBTS,X'08'                                                    
         SPACE 1                                                                
ACCFILE  GOTO1 VDATAMGR,DMCB,(DMINBTS,COMMAND),ACCOUNT,KEY,JBAIO,0              
         L     RE,JBAIO            EXTRACT KEY FROM RECORD                      
         MVC   KEY,0(RE)                                                        
         CLC   COMMAND,DMREAD      TEST FOR READ                                
         BE    ACCFILE2            YES                                          
         TM    ACCOSTAT(RE),TRNSDELT   TEST FOR DELETED RECORD                  
         BO    SEQSKIP             SKIP DELETED RECORD                          
         SPACE 1                                                                
ACCFILE2 NI    DMINBTS,X'FF'-X'08' TURN OFF PASS DELETES                        
         TM    DMCB+8,X'12'                                                     
         BNZ   NOTOK               RECORD NOT FOUND/DELETED                     
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         B     OK                                                               
         EJECT                                                                  
* EXIT POINTS SETTING CONDITION CODE                                            
*                                                                               
OK       CR    RB,RB                                                            
         B     EXIT                                                             
         SPACE 1                                                                
NOTOK    LTR   RB,RB                                                            
         B     EXIT                                                             
         SPACE 2                                                                
* SUB-ROUTINE TO GET ELEMENTS                                                   
*                                                                               
* AT ENTRY, R4=A(RECORD)                                                        
* ON EXIT,CC=EQ IF ELEM FOUND AND R6=A(ELEMENT) AND CC=NEQ IF NOT               
*         FOUND                                                                 
*                                                                               
GETEL    LR    R0,RE                                                            
         GOTO1 VHELLO,DMCB,(C'G',ACCOUNT),(ELCODE,(R4)),0                       
         L     R6,12(R1)                                                        
         LR    RE,R0                                                            
         CLI   12(R1),0                                                         
         BR    RE                                                               
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
XFF      DC    16X'FF'                                                          
         SPACE 2                                                                
* CONSTANTS                                                                     
*                                                                               
SLUSHCAT DC    C'&&&&'             SLUSH CATEGORY CODE                          
DMREAD   DC    C'DMREAD'                                                        
DMRDHI   DC    C'DMRDHI'                                                        
DMRSEQ   DC    C'DMRSEQ'                                                        
DMGETQ   DC    C'GETREC'                                                        
ACCOUNT  DC    C'ACCOUNT'                                                       
ACCDIR   DC    C'ACCDIR  '                                                      
ACCMST   DC    C'ACCMST  '                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* ROUTINES                                                            *         
***********************************************************************         
         SPACE 1                                                                
ROUTS    NMOD1 0,*JOBROUT,RA                                                    
         L     RC,4(RD)                                                         
         L     RC,68(RC)                                                        
         SRL   RF,32-8                                                          
         SLL   RF,2                                                             
         B     *+4(RF)                                                          
         B     MCSIOR                                                           
         B     MCSINI                                                           
         B     MCSPUT                                                           
         B     MCSORD                                                           
         B     MCSACT                                                           
         B     MCSTAB                                                           
         B     MCSCOL                                                           
         B     MCSPTAB                                                          
         SPACE 1                                                                
ROUTSL   MVI   DUB,0                                                            
         B     *+8                                                              
ROUTSE   MVI   DUB,1                                                            
         B     *+8                                                              
ROUTSH   MVI   DUB,2                                                            
         CLI   DUB,1                                                            
ROUTSX   XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
* MCS IO ROUTINES                                                     *         
***********************************************************************         
         SPACE 1                                                                
MCSIOR   DS    0H                                                               
*                                                                               
         MVC   DMINBTS,0(R1)                                                    
         XR    RF,RF                                                            
         ICM   RF,7,1(R1)                                                       
         MVC   COMMAND,0(RF)                                                    
         CLC   COMMAND,DMGETQ                                                   
         BE    MCSIOR2                                                          
*                                                                               
         GOTO1 VDATAMGR,DMCB,COMMAND,ACCDIR,KEY,KEY                             
         BNE   MCSIORX                                                          
*                                                                               
         MVC   DMDSKADR,KEY+ESTKDA-ESTRECD                                      
         CLI   DMINBTS,1                                                        
         BE    MCSIORX                                                          
         MVC   COMMAND,DMGETQ                                                   
*                                                                               
MCSIOR2  GOTO1 VDATAMGR,DMCB,COMMAND,ACCMST,DMDSKADR,JBAIO,WORK                 
         BE    MCSIORX                                                          
         DC    H'0'                                                             
*                                                                               
MCSIORX  B     ROUTSX                                                           
         EJECT                                                                  
***********************************************************************         
* MCS - INITIALISE TABLES AND ESTIMATE VALUES                         *         
***********************************************************************         
         SPACE 1                                                                
         USING ESTRECD,R4                                                       
         USING MJETABD,R7                                                       
MCSINI   DS    0H                                                               
*                                                                               
         MVI   POSW,NO                                                          
         MVI   EHSW,NO                                                          
         MVI   ACTSW,NO                                                         
         MVI   JBSELERR,NO                                                      
*                                                                               
         TM    JBSELFUN,JBGETSE+JBGETSS  (SINGLE) SELECTED?                     
         BZ    MCSINI00                                                         
         OC    SELECTED,SELECTED   IF NO SELECTED THEN UNSET BIT                
         BNZ   MCSINI00                                                         
         NI    JBSELFUN,FFQ-(JBGETSE+JBGETSS)                                   
*                                                                               
MCSINI00 LA    RE,JBRETCOL         RETURN COLUMN LIST                           
         XR    RF,RF                                                            
*                                                                               
MCSINI05 CLI   0(RE),JBRETEND      END OF LIST?                                 
         BE    MCSINI10                                                         
         AHI   RF,1                                                             
         CLI   0(RE),JBRETACN      ACTUALS?                                     
         BNE   *+8                                                              
         MVI   ACTSW,YES                                                        
         CLI   0(RE),JBRETACG                                                   
         BNE   *+8                                                              
         MVI   ACTSW,YES                                                        
         CLI   0(RE),JBRETACV                                                   
         BNE   *+8                                                              
         MVI   ACTSW,YES                                                        
         CLI   0(RE),JBRETACC                                                   
         BNE   *+8                                                              
         MVI   ACTSW,YES                                                        
         CLI   0(RE),JBRETPON      ORDERS?                                      
         BNE   *+8                                                              
         MVI   POSW,YES                                                         
         CLI   0(RE),JBRETPOG                                                   
         BNE   *+8                                                              
         MVI   POSW,YES                                                         
         CLI   0(RE),JBRETPOV                                                   
         BNE   *+8                                                              
         MVI   POSW,YES                                                         
         CLI   0(RE),JBRETPOC                                                   
         BNE   *+8                                                              
         MVI   POSW,YES                                                         
         CLI   0(RE),JBRETCEH                                                   
         BNE   *+8                                                              
         MVI   EHSW,YES                                                         
         CLI   0(RE),JBRETOEH                                                   
         BNE   *+8                                                              
         MVI   EHSW,YES                                                         
         CLI   0(RE),JBRETHEH                                                   
         BNE   *+8                                                              
         MVI   EHSW,YES                                                         
         AHI   RE,1                                                             
         B     MCSINI05                                                         
*                                                                               
MCSINI10 ST    RF,MCSCNO                                                        
*                                                                               
         L     R7,JBACOLTB         INITIALISE COLUMN TABLE                      
         MVI   MJETTYP,MJETTTQ                                                  
         XC    MJETWCD,MJETWCD                                                  
         XC    MJET1RA,MJET1RA                                                  
         LA    RE,MJETVAL                                                       
*                                                                               
MCSINI15 ZAP   0(L'MJETVAL,RE),=P'0'                                            
         AHI   RE,L'MJETVAL                                                     
         BCT   RF,MCSINI15                                                      
*                                                                               
         L     RF,MCSCNO                                                        
         MHI   RF,L'MJETVAL                                                     
         AHI   RF,MJETLNQ                                                       
         STC   RF,MJETLEN                                                       
         AR    R7,RF                                                            
         MVI   MJETTYP,MJETTEQ                                                  
*                                                                               
         L     R7,JBACOLTB                                                      
         MVC   SMJENTRY,MJETABD                                                 
         MVI   SMJENTRY+MJETTYP-MJETABD,MJETTWQ                                 
*                                                                               
         CLI   MCSESW,YES          ANY MCS ESTIMATES PRESENT?                   
         BNE   MCSINIX                                                          
*                                                                               
         TM    JBSELFUN,JBGETEST   ESTIMATE PASSED?                             
         BZ    MCSINI25                                                         
         MVC   KEY,LERKEY                                                       
         GOTO1 AMCSIOR,DMCB,(0,DMREAD)                                          
         JNE   *+2                                                              
         L     R4,JBAIO                                                         
         LA    RF,ESTRFST(R4)                                                   
*                                                                               
         USING EMDELD,RF                                                        
MCSINI20 DS    0H                  (SET MCS VALUES FOR THIS RECORD)             
         DROP  RF                                                               
*                                                                               
MCSINI25 LA    R4,KEY              BUILD START KEY                              
         XC    ESTKEY,ESTKEY                                                    
         MVI   ESTKTYP,ESTKTYPQ                                                 
         MVI   ESTKSUB,ESTKSUBQ                                                 
         MVC   ESTKCPY,CUL                                                      
         MVC   ESTKCLI,CLIENT                                                   
         MVC   ESTKPRO,PRODUCT                                                  
         MVC   ESTKJOB,JOBNUM                                                   
         MVC   LERKEY,ESTKEY                                                    
         LA    R5,MCSALL                                                        
*                                                                               
MCSINI30 GOTO1 AMCSIOR,DMCB,(1,DMRDHI)                                          
         BE    MCSINI40                                                         
         DC    H'0'                                                             
*                                                                               
MCSINI35 GOTO1 AMCSIOR,DMCB,(1,DMRSEQ)                                          
         BE    MCSINI40                                                         
         DC    H'0'                                                             
*                                                                               
MCSINI40 CLC   LERKEY(ESTKLNO-ESTRECD),ESTKEY   END OF JOB                      
         BNE   MCSINI85                                                         
         CLI   ESTKSEQ,ESTKSMQ     ONLY INTERESTED IN MAIN                      
         BNE   MCSINI35                                                         
         TM    JBSELFUN,JBGETSE+JBGETSS  (SINGLE) SELECTED?                     
         BZ    MCSINI50                                                         
         LA    RE,SELECTED                                                      
*                                                                               
MCSINI45 CLI   0(RE),0                                                          
         BE    MCSINI35                                                         
         CLC   ESTKLNO,0(RE)                                                    
         BE    MCSINI50                                                         
         AHI   RE,1                                                             
         B     MCSINI45                                                         
*                                                                               
MCSINI50 TM    ESTKSTA1,ESTKCAPP   FILTER ON ESTIMATES REQUIRED                 
         BNZ   MCSINI55                                                         
         TM    ESTKSTA1,ESTKSUBM                                                
         BZ    MCSINI35                                                         
         MVC   MCSHUE,ESTKLNO      SET HIGHEST UNAPPROVED                       
         MVI   0(R5),UNAPQ                                                      
         B     MCSINI60                                                         
*                                                                               
MCSINI55 MVC   MCSHAE,ESTKLNO      SET HIGHEST APPROVED                         
         MVI   0(R5),APPRQ         AND ADD 'APPROVED ESTIMATE'                  
         CLI   MCSORE,0                                                         
         BE    MCSINI56                                                         
         CLC   MCSORE,ESTKLNO      ORIGINAL ESTIMATE SET?                       
         BL    MCSINI60                                                         
*                                                                               
MCSINI56 MVC   MCSORE,ESTKLNO      FIRST APPROVED ESTIMATE IS 'OE'              
*                                                                               
MCSINI60 MVC   1(1,R5),ESTKLNO     AND SAVE TO LIST                             
         AHI   R5,2                                                             
*                                                                               
MCSINI65 TM    JBSELFUN,JBGETSE+JBGETSS  (SINGLE) SELECTED?                     
         BZ    MCSINI35                                                         
         LA    RE,SELECTE2                                                      
*                                                                               
MCSINI70 CLI   0(RE),0                                                          
         BE    MCSINI35                                                         
         CLC   ESTKLNO,0(RE)                                                    
         BE    MCSINI80                                                         
         AHI   RE,1                                                             
         B     MCSINI70                                                         
*                                                                               
MCSINI80 MVI   0(RE),FFQ                                                        
         B     MCSINI35                                                         
*                                                                               
MCSINI85 TM    JBSELFUN,JBGETSE+JBGETSS  (SINGLE) SELECTED?                     
         BZ    MCSIN100                                                         
         LA    RE,SELECTE2                                                      
*                                                                               
MCSINI90 CLI   0(RE),0                                                          
         BE    MCSIN100                                                         
         CLI   0(RE),FFQ                                                        
         BNE   MCSINI95                                                         
         AHI   RE,1                                                             
         B     MCSINI90                                                         
*                                                                               
MCSINI95 MVI   JBSELERR,YES                                                     
*                                                                               
MCSIN100 MVC   MCSHIE,MCSHAE       SET 'HIGHEST ESTIMATE'                       
         CLC   MCSHAE,MCSHUE                                                    
         BH    *+10                                                             
         MVC   MCSHIE,MCSHUE                                                    
         MVC   MCSCUE,MCSHUE                                                    
         CLI   MCSHAE,0                                                         
         BE    MCSIN105                                                         
         MVC   MCSCUE,MCSHAE                                                    
*                                                                               
MCSIN105 CLI   MCSHIE,1            SET MCSPRE                                   
         BNH   MCSIN120                                                         
         LA    RE,MCSALL+L'MCSALL-2                                             
         LA    RF,(L'MCSALL)/2                                                  
         MVI   BYTE,UNAPQ                                                       
         MVI   BYTE,APPRQ                                                       
                                                                                
MCSIN110 OC    0(2,RE),0(RE)                                                    
         BZ    MCSIN115                                                         
         CLC   BYTE,0(RE)                                                       
         BNE   MCSIN115                                                         
         CLC   MCSHIE,1(RE)                                                     
         BNH   MCSIN115                                                         
         MVC   MCSPRE,1(RE)                                                     
         B     MCSIN120                                                         
*                                                                               
MCSIN115 SHI   RE,2                                                             
         BCT   RF,MCSIN110                                                      
*                                                                               
MCSIN120 MVC   JBHIREV,MCSHIE      HIGHEST ESTIMATE                             
         MVC   JBHIAPP,MCSHAE      HIGHEST APPROVED                             
         MVC   JBORGVER,MCSORE     ORIGINAL ESTIMATE                            
         MVC   JBCURVER,MCSCUE     CURRENT ESTIMATE                             
*                                                                               
MCSINIX  DS    0H                                                               
         B     ROUTSX                                                           
         SPACE 2                                                                
         DROP  R4,R7                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* MCS GET ESTIMATES AND PUT DATA TO TABLE                             *         
***********************************************************************         
         SPACE 1                                                                
         USING ESTRECD,R4                                                       
         USING MJETABD,R7                                                       
MCSPUT   DS    0H                                                               
*                                                                               
         XC    SVWCCOD,SVWCCOD                                                  
         XC    SVWC1RA,SVWC1RA                                                  
         ZAP   SVWCHRS,=P'0'                                                    
*                                                                               
         LA    R4,KEY                                                           
         MVC   ESTKEY,LERKEY                                                    
         TM    JBSELFUN,JBGETEST   ESTIMATE PASSED?                             
         BNZ   MCSPUT06                                                         
         LA    R5,MCSALL                                                        
         B     MCSPUT04                                                         
*                                                                               
MCSPUT02 AHI   R5,2                NEXT ENTRY                                   
*                                                                               
MCSPUT04 CLI   0(R5),0             END OF TABLE?                                
         BE    MCSPUT90                                                         
         MVC   ESTKLNO,1(R5)                                                    
*                                                                               
MCSPUT06 MVI   ESTKSEQ,1           READ FOR ESTIMATES                           
         MVC   CERKEY,ESTKEY                                                    
         GOTO1 AMCSIOR,DMCB,(0,DMRDHI)                                          
         BE    MCSPUT10                                                         
         DC    H'0'                                                             
*                                                                               
MCSPUT08 MVC   ESTKEY,LASTKEY      RESTORE PREVIOUS KEY                         
         GOTO1 AMCSIOR,DMCB,(0,DMRDHI)                                          
         BE    *+6                                                              
         DC    H'0'                                                             
MCSPUT09 GOTO1 AMCSIOR,DMCB,(0,DMRSEQ)                                          
         BE    MCSPUT10                                                         
         DC    H'0'                                                             
*                                                                               
MCSPUT10 CLC   CERKEY(ESTKSEQ-ESTRECD),ESTKEY                                   
         BNE   MCSPUT02                                                         
         MVC   LASTKEY,ESTKEY      SAVE KEY                                     
         L     R3,JBAIO                                                         
         AHI   R3,ESTRFST-ESTRECD                                               
*                                                                               
*                                  DETERMINE ESTIMATE PUT TYPE(S)               
*                                                                               
         MVI   MCSSTA,MCSSAQ       REGULAR EST. (FOR ALL AS IN MCSALL)          
         CLC   ESTKLNO,MCSCUE                                                   
         BNE   *+8                                                              
         OI    MCSSTA,MCSSCQ       CURRENT EST. (FOR ALL AS IN MCSALL)          
         CLC   ESTKLNO,MCSORE                                                   
         BNE   *+8                                                              
         OI    MCSSTA,MCSSOQ       ORIGINAL ESTIMATE                            
         CLC   ESTKLNO,MCSHIE                                                   
         BNE   *+8                                                              
         OI    MCSSTA,MCSSHQ       HIGHEST ESTIMATE                             
*                                                                               
         USING ERDELD,R3                                                        
MCSPUT12 CLI   ERDEL,0             GET W/C ELEMENT AND PASS TO TABLE            
         BNE   *+12                                                             
         BAS   RE,MCSDOH           DO HOURS FOR LAST TIME                       
         B     MCSPUT08                                                         
*                                                                               
         CLI   ERDEL,ERDELQ        IS IT AN ESTIMATE ROW ELEMENT?               
         BE    MCSPUT14            NO, GET THE NEXT ELEMENT                     
*                                                                               
MCSPUT13 LLC   R0,ERDLN            NEXT ELEMENT                                 
         AR    R3,R0                                                            
         B     MCSPUT12                                                         
*                                                                               
MCSPUT14 MVC   BYTE,ERDTYP                                                      
         CLI   ERDTYP,ERDTIRQ      BR'O TIME + 1R A/C                           
         BNE   MCSPUT1A                                                         
         BAS   RE,MCSDOH                                                        
         B     MCSPUT54                                                         
*                                                                               
MCSPUT1A CLI   ERDTYP,ERDTWDQ      W/C DATA                                     
         BNE   MCSPUT54                                                         
         BAS   RE,MCSDOH           DO HOURS                                     
         BNE   ROUTSH                                                           
*                                                                               
         L     R7,JBACOLTB                                                      
         ZAP   DUB1,ERDWAMT        AGENCY AMOUNT                                
         ZAP   DUB2,ERDWCAM        AGENCY COMMISSION AMOUNT                     
         ZAP   DUB3,ERDWVAM        AGENCY VAT AMOUNT                            
         ZAP   DUB4,=P'0'                                                       
         ZAP   DUB5,=P'0'                                                       
         ZAP   DUB6,=P'0'                                                       
         MVC   LOOKWC,ERDWCOD      WORKCODE                                     
         BAS   RE,GETMRAT          LOOK UP THE RATE                             
         ZAP   DUB4,LOOKRATE       SAVE RATE                                    
         MVC   SVTYPE01,ERDEL      SAVE WORKCODE ELEMENT                        
         BAS   RE,CLRDPL                                                        
         BNE   MCSPUT13            SKIP ZERO ENTRY                              
         GOTO1 AMCSPTAB                                                         
*        B     MCSPUT13                                                         
*                                                                               
MCSPUT53 CLI   ERDLN,ERDWLX1Q      TEST EXTENDED WC DATA EL                     
         JL    MCSPUT13                                                         
*                                                                               
MCSPUT54 CLI   EHSW,YES            ESTIMATED HOURS?                             
         BNE   MCSPUT13                                                         
         TM    MCSSTA,MCSSCQ       CURRENT ESTIMATE                             
*        BZ    MCSPUT13                                                         
         CLI   ERDTYP,ERDTIRQ      PERSON RATE/HOURS ELEMENT                    
         BE    MCSPUT55                                                         
         CLI   ERDTYP,ERDTWDQ                                                   
         BNE   MCSPUT56            NO                                           
         CLI   ERDLN,ERDWLX1Q      TEST EXTENDED WC DATA EL                     
         JL    MCSPUT56                                                         
         AP    SVWCHRS,ERDWHRS     WC-LEVEL HOURS HELD HERE                     
         J     MCSPUT56                                                         
MCSPUT55 AP    SVWCHRS,ERDIHRS     HOURS NOW HELD HERE                          
         MVC   SVWC1RA,ERDITAC     SAVE 1R A/C                                  
         ZAP   PL16,ERDIHRS        CALC ESTIMATE TIME VALUE                     
         MP    PL16,ERDIRAT                                                     
         ZAP   DUB,PL16                                                         
         SRP   DUB,64-2,5                                                       
         AP    SVWCHVL,DUB                                                      
         B     MCSPUT13                                                         
*                                                                               
MCSPUT56 TM    JBSELFUN,JBGET1R    TEST CALLED FROM SCRIBE                      
         BNZ   MCSPUT13            YES - EXCLUDE HOURS FROM ITEMS               
         CLI   ERDTYP,ERDTIDQ      ITEM ELEMENT?                                
         BNE   MCSPUT13            NO, GET NEXT                                 
         TM    ERDIIND,ERDIITQ                                                  
         BZ    MCSPUT13                                                         
         AP    SVWCHRS,ERDIMUL                                                  
         B     MCSPUT13                                                         
*&&UK                                                                           
         USING PTAELD,R3                                                        
MCSPUT60 CLI   PTATYPE,PTATRAL                                                  
         BNE   MCSPUT34                                                         
         OC    PTADATE,PTADATE     NO DATE MEANS NO IN USE                      
         BZ    MCSPUT34                                                         
         TM    PTASTAT1,PTASPEND   PENDING IS DRAFT - IGNORE THESE              
         BNZ   MCSPUT34                                                         
         L     R7,JBACOLTB                                                      
         ZAP   DUB1,=P'0'                                                       
         ZAP   DUB2,=P'0'                                                       
         ZAP   DUB3,=P'0'                                                       
         ZAP   DUB4,=P'0'                                                       
         ZAP   DUB5,PTANET                                                      
         ZAP   DUB6,PTARCOM                                                     
*                                                                               
         TM    MCSSTA,MCSSCQ       CURRENT ESTIMATE (AND REGULAR)?              
         BZ    MCSPUT62                                                         
         MVI   MCSTYP,MCSTCE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSPUT62 TM    MCSSTA,MCSSOQ       ORIGINAL ESTIMATE?                           
         BZ    MCSPUT64                                                         
         MVI   MCSTYP,MCSTOE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSPUT64 TM    MCSSTA,MCSSHQ       HIGHEST ESTIMATE?                            
         BZ    MCSPUT66                                                         
         MVI   MCSTYP,MCSTHE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSPUT66 TM    JBSELFUN,JBGETDE    GET DETAILS?                                 
         BZ    MCSPUT34                                                         
*                                                                               
         L     R7,JBACOLTB                                                      
*                                                                               
MCSPUT68 XR    R1,R1               (FIRST ENTRY IS TOTAL LINE)                  
         IC    R1,MJETLEN                                                       
         AR    R7,R1                                                            
*                                                                               
         CLI   MJETTYP,MJETTEQ                                                  
         BNE   MCSPUT70                                                         
         LR    RE,R1               ADD DUMMY ENTRY                              
         SHI   RE,1                                                             
         MVC   MJETABD(0),SMJENTRY                                              
         EX    RE,*-6                                                           
         MVC   MJETWCD,PTAEWRK                                                  
         AR    R1,R7                                                            
         MVI   0(R1),MJETTEQ                                                    
         L     RE,JBACOLTB                                                      
         A     RE,JBLCOLTB                                                      
         CR    R7,RE                                                            
         BL    MCSPUT72                                                         
         B     ROUTSH                                                           
*                                                                               
MCSPUT70 CLI   MJETTYP,MJETTWQ     W/C ENTRY?                                   
         BNE   MCSPUT68                                                         
         CLC   MJETWCD,PTAEWRK                                                  
         BNE   MCSPUT68                                                         
*                                                                               
MCSPUT72 MVC   SVWCCOD,PTAEWRK                                                  
         TM    MCSSTA,MCSSCQ       CURRENT ESTIMATE (AND REGULAR)?              
         BZ    MCSPUT74                                                         
         MVI   MCSTYP,MCSTCE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSPUT74 TM    MCSSTA,MCSSOQ       ORIGINAL ESTIMATE?                           
         BZ    MCSPUT76                                                         
         MVI   MCSTYP,MCSTOE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSPUT76 TM    MCSSTA,MCSSHQ       HIGHEST ESTIMATE?                            
         BZ    MCSPUT34                                                         
         MVI   MCSTYP,MCSTHE                                                    
         GOTO1 AMCSTAB                                                          
         B     MCSPUT34                                                         
*&&                                                                             
MCSPUT90 BAS   RE,MCSDOH           ALL ESTIMATES PROCESSED - DO HOURS           
         BNE   ROUTSH                                                           
*                                                                               
MCSPUTX  B     ROUTSE              ALL ESTIMATE PROCESSED                       
*                                                                               
         DROP  R3,R4,R7                                                         
*                                                                               
         EJECT                                                                  
         USING ERDELD,R3                                                        
         USING ESTRECD,R4                                                       
         USING MJETABD,R7                                                       
MCSPTAB  LA    R3,SVTYPE01                                                      
         TM    MCSSTA,MCSSCQ       CURRENT ESTIMATE (AND REGULAR)?              
         BZ    MCSPT02                                                          
         MVI   MCSTYP,MCSTCE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSPT02  TM    MCSSTA,MCSSOQ       ORIGINAL ESTIMATE?                           
         BZ    MCSPT04                                                          
         MVI   MCSTYP,MCSTOE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSPT04  TM    MCSSTA,MCSSHQ       HIGHEST ESTIMATE?                            
         BZ    MCSPT06                                                          
         MVI   MCSTYP,MCSTHE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSPT06  TM    JBSELFUN,JBGETDE    GET DETAILS?                                 
         BZ    MCSPTX                                                           
*                                                                               
         L     R7,JBACOLTB                                                      
*                                                                               
MCSPT08  XR    R1,R1               (FIRST ENTRY IS TOTAL LINE)                  
         IC    R1,MJETLEN                                                       
         AR    R7,R1                                                            
*                                                                               
         CLI   MJETTYP,MJETTEQ     TEST EOT                                     
         BNE   MCSPT10                                                          
         LR    RE,R1               ADD DUMMY ENTRY                              
         SHI   RE,1                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   MJETABD(0),SMJENTRY                                              
         MVC   MJETWCD,ERDWCOD     GET WORKCODE                                 
         AR    R1,R7                                                            
         MVI   0(R1),MJETTEQ       SET NEW EOT                                  
         L     RE,JBACOLTB                                                      
         A     RE,JBLCOLTB                                                      
         CR    R7,RE                                                            
         JL    MCSPT12                                                          
         B     ROUTSH              TABLE FULL                                   
*                                                                               
MCSPT10  CLI   MJETTYP,MJETTWQ     W/C ENTRY?                                   
         BNE   MCSPT08                                                          
         CLC   MJETWCD,ERDWCOD                                                  
         BNE   MCSPT08                                                          
         OC    MJET1RA,MJET1RA     TEST W/C LEVEL                               
         BNZ   MCSPT08             NO                                           
*                                                                               
MCSPT12  MVC   SVWCCOD,ERDWCOD                                                  
         TM    MCSSTA,MCSSCQ       CURRENT ESTIMATE (AND REGULAR)?              
         BZ    MCSPT14                                                          
         MVI   MCSTYP,MCSTCE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSPT14  TM    MCSSTA,MCSSOQ       ORIGINAL ESTIMATE?                           
         BZ    MCSPT16                                                          
         MVI   MCSTYP,MCSTOE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSPT16  TM    MCSSTA,MCSSHQ       HIGHEST ESTIMATE?                            
         BZ    MCSPTX                                                           
         MVI   MCSTYP,MCSTHE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSPTX   B     ROUTSE                                                           
         EJECT                                                                  
*                                                                               
**********************************************************************          
* ADD HOURS TO WC LEVEL ENTRY, AND WC+1R LEVEL ENTRY (IF THAT EXISTS)*          
**********************************************************************          
*                                                                               
         USING MJETABD,R7                                                       
MCSDOH   NTR1                                                                   
         CLI   EHSW,YES                                                         
         BNE   MCSDOHX                                                          
         CP    SVWCHRS,=P'0'                                                    
         BE    MCSDOHX                                                          
*                                                                               
         L     R7,JBACOLTB         ADD TO TOTAL (1ST ENTRY)                     
         ZAP   DUB1,=P'0'                                                       
         ZAP   DUB2,=P'0'                                                       
         ZAP   DUB3,=P'0'                                                       
         ZAP   DUB5,SVWCHRS                                                     
         ZAP   DUB6,=P'0'                                                       
         ZAP   DUB7,=P'0'                                                       
         OC    SVWC1RA,SVWC1RA     TEST HOURS AT 1R LEVEL                       
         BZ    *+10                                                             
         ZAP   DUB1,SVWCHVL        SET HRS*RATE VALUE                           
*                                                                               
         TM    MCSSTA,MCSSCQ       CURRENT ESTIMATE (AND REGULAR)?              
         BZ    MCSDOH05                                                         
         MVI   MCSTYP,MCSTCE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSDOH05 TM    MCSSTA,MCSSOQ       ORIGINAL ESTIMATE?                           
         BZ    MCSDOH10                                                         
         MVI   MCSTYP,MCSTOE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSDOH10 TM    MCSSTA,MCSSHQ       HIGHEST ESTIMATE?                            
         BZ    MCSDOH15                                                         
         MVI   MCSTYP,MCSTHE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSDOH15 TM    JBSELFUN,JBGETDE    GET DETAILS?                                 
         BZ    MCSDOHX                                                          
*                                                                               
         L     R7,JBACOLTB                                                      
*                                                                               
MCSDOH20 XR    R1,R1               (FIRST ENTRY IS TOTAL LINE)                  
         IC    R1,MJETLEN                                                       
         AR    R7,R1                                                            
*                                                                               
         CLI   MJETTYP,MJETTEQ                                                  
         BNE   MCSDOH25                                                         
         LR    RE,R1               ADD DUMMY ENTRY                              
         SHI   RE,1                                                             
         MVC   MJETABD(0),SMJENTRY                                              
         EX    RE,*-6                                                           
         MVC   MJETWCD,SVWCCOD                                                  
         MVC   MJET1RA,SVWC1RA                                                  
         AR    R1,R7                                                            
         MVI   0(R1),MJETTEQ                                                    
         L     RE,JBACOLTB                                                      
         A     RE,JBLCOLTB                                                      
         CR    R7,RE                                                            
         BL    MCSDOH30                                                         
         B     ROUTSH                                                           
*                                                                               
MCSDOH25 CLI   MJETTYP,MJETTWQ     W/C ENTRY?                                   
         BNE   MCSDOH20                                                         
         CLC   MJETWCD,SVWCCOD     MATCH W/C                                    
         BNE   MCSDOH20                                                         
         CLC   MJET1RA,SVWC1RA     MATCH 1R A/C (OR 00'S)                       
         BNE   MCSDOH20                                                         
         OC    SVWC1RA,SVWC1RA     TEST W/C LEVEL ENTRY                         
         BNZ   MCSDOH30                                                         
         ZAP   DUB1,=P'0'          HOURS*RATE VALUE ALREADY INCLUDED            
*                                                                               
MCSDOH30 TM    MCSSTA,MCSSCQ       CURRENT ESTIMATE (AND REGULAR)?              
         BZ    MCSDOH35                                                         
         MVI   MCSTYP,MCSTCE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSDOH35 TM    MCSSTA,MCSSOQ       ORIGINAL ESTIMATE?                           
         BZ    MCSDOH40                                                         
         MVI   MCSTYP,MCSTOE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSDOH40 TM    MCSSTA,MCSSHQ       HIGHEST ESTIMATE?                            
         BZ    MCSDOH45                                                         
         MVI   MCSTYP,MCSTHE                                                    
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSDOH45 OC    SVWC1RA,SVWC1RA     TEST ADDED HOURS TO W/C LVL ENTRY            
         BZ    MCSDOHX             YES - FINISHED                               
         XC    SVWC1RA,SVWC1RA                                                  
         B     MCSDOH15            ELSE DO IT NOW                               
*                                                                               
MCSDOHX  XC    SVWC1RA,SVWC1RA                                                  
         ZAP   SVWCHVL,=P'0'                                                    
         ZAP   SVWCHRS,=P'0'                                                    
         CLI   BYTE,ERDTIRQ                                                     
         BE    ROUTSE                                                           
         XC    SVWCCOD,SVWCCOD                                                  
         B     ROUTSE                                                           
*                                                                               
         EJECT                                                                  
GETMRAT  NTR1                                                                   
         L     R3,AGOBLOCK                                                      
         USING GOBLOCKD,R3                                                      
         MVC   GOSELWC,LOOKWC      SET WORKCODE                                 
         GOTO1 JBGETOPT,DMCB,GOBLOCK                                            
         MVC   LOOKRATE,GOAGYCOM   EXTRACT AGENCY COMMISSION                    
         XIT1                                                                   
         DROP  R3                                                               
*                                                                               
CLRDPL   MVI   BYTE,1                                                           
         CLI   JBSELRND,JBRNDDOL                                                
         BNE   CLRDP2                                                           
         ZAP   WORK2,DUB1                                                       
         SRP   WORK2,64-2,5                                                     
         SRP   WORK2,2,0                                                        
         ZAP   DUB1,WORK2                                                       
         ZAP   WORK2,DUB2                                                       
         SRP   WORK2,64-2,5                                                     
         SRP   WORK2,2,0                                                        
         ZAP   DUB2,WORK2                                                       
         ZAP   WORK2,DUB3                                                       
         SRP   WORK2,64-2,5                                                     
         SRP   WORK2,2,0                                                        
         ZAP   DUB3,WORK2                                                       
CLRDP2   CLI   JBSELWRK,JBNOZERO                                                
         BNE   CLRDPLT                                                          
         MVI   BYTE,0                                                           
         CP    DUB1,=P'0'                                                       
         BE    *+8                                                              
         MVI   BYTE,1                                                           
         CP    DUB2,=P'0'                                                       
         BE    *+8                                                              
         MVI   BYTE,1                                                           
         CP    DUB3,=P'0'                                                       
         BE    *+8                                                              
         MVI   BYTE,1                                                           
         CP    DUB4,=P'0'                                                       
         BE    *+8                                                              
         MVI   BYTE,1                                                           
         TP    DUB5                                                             
         BNZ   CLRDPLT                                                          
         CP    DUB5,=P'0'                                                       
         BE    *+8                                                              
         MVI   BYTE,1                                                           
*                                                                               
CLRDPLT  CLI   BYTE,1                                                           
         BR    RE                                                               
*                                                                               
         EJECT                                                                  
***********************************************************************         
* MCS TABLE - PUT COLUMN VALUES TO ROW                                *         
***********************************************************************         
         SPACE 1                                                                
         USING MJETABD,R7                                                       
MCSTAB   DS    0H                                                               
*                                                                               
         LA    R2,JBRETCOL                                                      
         XR    R3,R3                                                            
*                                                                               
MCSTAB02 CLI   0(R2),JBRETEND                                                   
         BE    MCSTABX                                                          
*                                                                               
         CLI   MCSTYP,MCSTCE                                                    
         BNE   MCSTAB04                                                         
         CLI   0(R2),JBRETCEN                                                   
         BE    MCSTAB12                                                         
         CLI   0(R2),JBRETCEG                                                   
         BE    MCSTAB14                                                         
         CLI   0(R2),JBRETCEV                                                   
         BE    MCSTAB16                                                         
         CLI   0(R2),JBRETCEC                                                   
         BE    MCSTAB18                                                         
         CLI   0(R2),JBRETPBC                                                   
         BE    MCSTAB20                                                         
         CLI   0(R2),JBRETPBG                                                   
         BE    MCSTAB22                                                         
         CLI   0(R2),JBRETMXC                                                   
         BE    MCSTAB24                                                         
         CLI   0(R2),JBRETRAT                                                   
         BE    MCSTAB26                                                         
         CLI   0(R2),JBRETCEH                                                   
         BE    MCSTAB27                                                         
         B     MCSTAB90                                                         
*                                                                               
MCSTAB04 CLI   MCSTYP,MCSTOE                                                    
         BNE   MCSTAB06                                                         
         CLI   0(R2),JBRETOEN                                                   
         BE    MCSTAB12                                                         
         CLI   0(R2),JBRETOEG                                                   
         BE    MCSTAB14                                                         
         CLI   0(R2),JBRETOEV                                                   
         BE    MCSTAB16                                                         
         CLI   0(R2),JBRETOEC                                                   
         BE    MCSTAB18                                                         
         CLI   0(R2),JBRETMXO                                                   
         BE    MCSTAB19                                                         
         CLI   0(R2),JBRETOEH                                                   
         BE    MCSTAB27                                                         
         B     MCSTAB90                                                         
*                                                                               
MCSTAB06 CLI   MCSTYP,MCSTHE                                                    
         BNE   MCSTAB08                                                         
         CLI   0(R2),JBRETHEN                                                   
         BE    MCSTAB12                                                         
         CLI   0(R2),JBRETHEG                                                   
         BE    MCSTAB14                                                         
         CLI   0(R2),JBRETHEV                                                   
         BE    MCSTAB16                                                         
         CLI   0(R2),JBRETHEC                                                   
         BE    MCSTAB18                                                         
         CLI   0(R2),JBRETHEH                                                   
         BE    MCSTAB27                                                         
         B     MCSTAB90                                                         
*                                                                               
MCSTAB08 CLI   MCSTYP,MCSTAC                                                    
         BNE   MCSTAB10                                                         
         CLI   0(R2),JBRETACN                                                   
         BE    MCSTAB12                                                         
         CLI   0(R2),JBRETACG                                                   
         BE    MCSTAB14                                                         
         CLI   0(R2),JBRETACV                                                   
         BE    MCSTAB16                                                         
         CLI   0(R2),JBRETACC                                                   
         BE    MCSTAB18                                                         
         B     MCSTAB90                                                         
*                                                                               
MCSTAB10 CLI   MCSTYP,MCSTPO                                                    
         BNE   MCSTAB90                                                         
         CLI   0(R2),JBRETPON                                                   
         BE    MCSTAB12                                                         
         CLI   0(R2),JBRETPOG                                                   
         BE    MCSTAB14                                                         
         CLI   0(R2),JBRETPOV                                                   
         BE    MCSTAB16                                                         
         CLI   0(R2),JBRETPOC                                                   
         BE    MCSTAB18                                                         
         B     MCSTAB90                                                         
*                                                                               
MCSTAB12 LR    R1,R3               ADD NET ENTRY                                
         MHI   R1,L'MJETVAL                                                     
         AHI   R1,MJETLNQ                                                       
         AR    R1,R7                                                            
         AP    0(L'MJETVAL,R1),DUB1                                             
         B     MCSTAB90                                                         
*                                                                               
MCSTAB14 LR    R1,R3               ADD GROSS ENTRY                              
         MHI   R1,L'MJETVAL                                                     
         AHI   R1,MJETLNQ                                                       
         AR    R1,R7                                                            
         AP    0(L'MJETVAL,R1),DUB1                                             
         ZAP   WORK2,DUB1                                                       
         MP    WORK2,DUB4                                                       
         SRP   WORK2,64-6,5                                                     
         AP    0(L'MJETVAL,R1),WORK2                                            
         B     MCSTAB90                                                         
*                                                                               
MCSTAB16 LR    R1,R3               ADD VAT ENTRY                                
         MHI   R1,L'MJETVAL                                                     
         AHI   R1,MJETLNQ                                                       
         AR    R1,R7                                                            
         AP    0(L'MJETVAL,R1),DUB3                                             
         B     MCSTAB90                                                         
*                                                                               
MCSTAB18 LR    R1,R3               ADD COMMISSION ENTRY                         
         MHI   R1,L'MJETVAL                                                     
         AHI   R1,MJETLNQ                                                       
         AR    R1,R7                                                            
         ZAP   WORK2,DUB1                                                       
         MP    WORK2,DUB4                                                       
         SRP   WORK2,64-6,5                                                     
         AP    0(L'MJETVAL,R1),WORK2                                            
         B     MCSTAB90                                                         
*                                                                               
MCSTAB19 LR    R1,R3               ADD MAXOE ENTRY                              
         MHI   R1,L'MJETVAL                                                     
         AHI   R1,MJETLNQ                                                       
         AR    R1,R7                                                            
         ZAP   WORK2,DUB1                                                       
         MP    WORK2,MAXPER                                                     
         SRP   WORK2,64-4,5        COMPUTE CUR EST*MAXPE                        
         AP    0(L'MJETVAL,R1),WORK2                                            
         B     MCSTAB90                                                         
*                                                                               
MCSTAB20 LR    R1,R3               ADD PEBCE ENTRY                              
         MHI   R1,L'MJETVAL                                                     
         AHI   R1,MJETLNQ                                                       
         AR    R1,R7                                                            
         ZAP   WORK2,DUB1                                                       
         MP    WORK2,PEREST                                                     
         SRP   WORK2,64-4,5        COMPUTE CUR EST*PEREST                       
         AP    0(L'MJETVAL,R1),WORK2                                            
         B     MCSTAB90                                                         
*                                                                               
MCSTAB22 LR    R1,R3               ADD PEBCEG ENTRY                             
         MHI   R1,L'MJETVAL                                                     
         AHI   R1,MJETLNQ                                                       
         AR    R1,R7                                                            
         ZAP   WORK2,DUB1                                                       
         MP    WORK2,PEREST                                                     
         SRP   WORK2,64-4,5        COMPUTE CUR EST*PEREST                       
         AP    0(L'MJETVAL,R1),WORK2                                            
         MP    WORK2,DUB4                                                       
         SRP   WORK2,64-6,5                                                     
         AP    0(L'MJETVAL,R1),WORK2                                            
         B     MCSTAB90                                                         
*                                                                               
MCSTAB24 LR    R1,R3               ADD MAXCE ENTRY                              
         MHI   R1,L'MJETVAL                                                     
         AHI   R1,MJETLNQ                                                       
         AR    R1,R7                                                            
         ZAP   WORK2,DUB1                                                       
         MP    WORK2,MAXPER                                                     
         SRP   WORK2,64-4,5        COMPUTE CUR EST*MAXPE                        
         AP    0(L'MJETVAL,R1),WORK2                                            
         B     MCSTAB90                                                         
*                                                                               
MCSTAB26 LR    R1,R3               ADD RATE ENTRY                               
         MHI   R1,L'MJETVAL                                                     
         AHI   R1,MJETLNQ                                                       
         AR    R1,R7                                                            
         ZAP   0(L'MJETVAL,R1),DUB4                                             
         B     MCSTAB90                                                         
*                                                                               
MCSTAB27 LR    R1,R3               ADD HOURS ENTRY                              
         MHI   R1,L'MJETVAL                                                     
         AHI   R1,MJETLNQ                                                       
         AR    R1,R7                                                            
         AP    0(L'MJETVAL,R1),DUB5                                             
         B     MCSTAB90                                                         
*                                                                               
MCSTAB90 AHI   R2,1                                                             
         AHI   R3,1                                                             
         B     MCSTAB02                                                         
*                                                                               
MCSTABX  B     ROUTSE                                                           
         DROP  R7                                                               
         EJECT                                                                  
***********************************************************************         
* MCS COLUMN SETTING ROUTINE                                          *         
***********************************************************************         
         SPACE 1                                                                
MCSCOL   DS    0H                                                               
*                                                                               
         CLI   JBRETCOL,JBRETEND   COLUMN LIST PASSED?                          
         BNE   MCSCOLX                                                          
*                                                                               
         ICM   R4,15,JBORICLI      A(ORGIGINAL LIST) SET?                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         GOTO1 VSCANNER,DMCB,(R4),ABLOCK,0                                      
         CLI   4(R1),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
         ZIC   R6,4(R1)            R6=LOOP COUNTER                              
         L     R4,ABLOCK           R4=A(SCANNER BLOCK)                          
*                                                                               
         CLI   1(R4),0             TEST FOR DIVIDED FIELD                       
         BE    *+6                 MUST BE A PROBLEM                            
         DC    H'0'                                                             
*                                                                               
         CLI   0(R4),0             TEST FOR COMMA ONLY                          
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         CLI   0(R4),8             TEST FOR BIG STRING                          
         BNH   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         XC    JBRETCOL,JBRETCOL                                                
         LA    R2,JBRETCOL                                                      
         XR    R3,R3                                                            
*                                                                               
MCSCOL05 L     RE,ARELTAB                                                       
*                                                                               
MCSCOL10 CLI   0(RE),0             CHECK IN SUPPORTED KEYWORD TABLE             
         BE    MCSCOL15                                                         
*                                                                               
         ZIC   R1,0(R4)            GET LENGTH                                   
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         CLC   12(0,R4),1(RE)                                                   
         BE    MCSCOL20                                                         
         AHI   RE,9                                                             
         B     MCSCOL10                                                         
*                                                                               
MCSCOL15 CHI   R3,L'JBRETCOL-1     FOR UNSUPPORTED KEYWORDS ADD DUMMY           
         BNL   MCSCOL25                                                         
         MVI   0(R2),JBRETDUM                                                   
         AHI   R2,1                                                             
         B     MCSCOL30                                                         
*                                                                               
MCSCOL20 CHI   R3,L'JBRETCOL-1     BUILD COLUMN ENTRY                           
         BNL   MCSCOL25                                                         
         MVC   0(1,R2),0(RE)                                                    
         AHI   R2,1                                                             
         B     MCSCOL30                                                         
*                                                                               
MCSCOL25 DC    H'0'                TOO MANY ENTRIES                             
*                                                                               
MCSCOL30 LA    R4,32(R4)                                                        
         BCT   R6,MCSCOL05                                                      
*                                                                               
MCSCOLX  B     ROUTSE                                                           
         EJECT                                                                  
***********************************************************************         
* MCS PUT ORDER DATA TO TABLE                                         *         
***********************************************************************         
         SPACE 1                                                                
         USING OAMELD,R6                                                        
         USING MJETABD,R7                                                       
MCSORD   DS    0H                                                               
*                                                                               
         L     R7,JBACOLTB         POINT TO TOTALS                              
         TM    JBSELFUN,JBGETDE    GET DETAILS?                                 
         BZ    MCSORD12                                                         
*                                                                               
MCSORD05 XR    R1,R1               (FIRST ENTRY IS TOTAL LINE)                  
         IC    R1,MJETLEN                                                       
         AR    R7,R1                                                            
*                                                                               
         CLI   MJETTYP,MJETTEQ                                                  
         BNE   MCSORD10                                                         
         LR    RE,R1               ADD DUMMY ENTRY                              
         SHI   RE,1                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   MJETABD(0),SMJENTRY SET DUMMY ENTRY                              
         MVC   MJETWCD,OAMWORK                                                  
         LA    R1,0(R7,R1)                                                      
         MVI   0(R1),MJETTEQ                                                    
         L     RE,JBACOLTB                                                      
         A     RE,JBLCOLTB                                                      
         CR    R7,RE                                                            
         BL    MCSORD12                                                         
         B     ROUTSH                                                           
*                                                                               
MCSORD10 CLI   MJETTYP,MJETTWQ     W/C ENTRY?                                   
         BNE   MCSORD05                                                         
         CLC   MJETWCD,OAMWORK                                                  
         BNE   MCSORD05                                                         
*                                                                               
MCSORD12 LA    R1,BNMQ                                                          
         CP    OAMAMNT,=P'0'       IS ORDER NEGATIVE?                           
         BNM   *+8                                                              
         LA    R1,BNPQ                                                          
         ZAP   DUB1,OAMAMNT        PURCHASE ORDER AMOUNT                        
         SP    DUB1,OAMIVAL        DEDUCT INVOICED AMOUNT                       
         NOP   MCSORD14            DON'T LET IT GO NEGATIVE/POSITIVE            
         EX    R1,*-4                                                           
         ZAP   DUB1,=P'0'                                                       
*                                                                               
MCSORD14 ZAP   DUB2,=P'0'                                                       
         ZAP   DUB3,=P'0'                                                       
         ZAP   DUB4,=P'0'                                                       
*                                                                               
         TM    OAMSTAT,OAMSNOCM    TEST FOR NON-COMM ITEM                       
         BNZ   MCSORD25                                                         
         DS    0H                  APPLY COMM - OUTSTANDING                     
*                                                                               
MCSORD25 BAS   RE,CLRDPL                                                        
*                                                                               
         MVI   MCSTYP,MCSTPO                                                    
         TM    JBSELFUN,JBGETDE    GET DETAILS?                                 
         BZ    MCSORD30                                                         
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSORD30 L     R7,JBACOLTB                                                      
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSORDX  B     ROUTSE                                                           
         DROP  R6,R7                                                            
         EJECT                                                                  
***********************************************************************         
* MCS PUT ACTUALS DATA TO TABLE                                       *         
***********************************************************************         
         SPACE 1                                                                
         USING TRNRECD,R4                                                       
         USING TRNELD,R6                                                        
         USING MJETABD,R7                                                       
MCSACT   DS    0H                                                               
*                                                                               
         L     R7,JBACOLTB         POINT TO TOTALS                              
         TM    JBSELFUN,JBGETDE    GET DETAILS?                                 
         BZ    MCSACT20                                                         
*                                                                               
MCSACT05 XR    R1,R1               (FIRST ENTRY IS TOTAL LINE)                  
         IC    R1,MJETLEN                                                       
         AR    R7,R1                                                            
*                                                                               
         CLI   MJETTYP,MJETTEQ                                                  
         BNE   MCSACT10                                                         
         LR    RE,R1               ADD                                          
         SHI   RE,1                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   MJETABD(0),SMJENTRY                                              
         MVC   MJETWCD,TRNKWORK                                                 
         LA    R1,0(R7,R1)                                                      
         MVI   0(R1),MJETTEQ                                                    
         L     RE,JBACOLTB                                                      
         A     RE,JBLCOLTB                                                      
         CR    R7,RE                                                            
         BL    MCSACT20                                                         
         B     ROUTSH                                                           
*                                                                               
MCSACT10 CLI   MJETTYP,MJETTWQ     W/C ENTRY?                                   
         BNE   MCSACT05                                                         
         CLC   MJETWCD,TRNKWORK                                                 
         BNE   MCSACT05                                                         
*                                                                               
MCSACT20 ZAP   DUB1,TRNAMNT        PURCHASE ORDER AMOUNT                        
         ZAP   DUB2,=P'0'                                                       
         ZAP   DUB3,=P'0'                                                       
         ZAP   DUB4,=P'0'                                                       
*                                                                               
         TM    TRNSTAT,TRNSNOCM    TEST FOR NON-COMM ITEM                       
         BNZ   MCSACT25                                                         
         DS    0H                  APPLY COMM - OUTSTANDING                     
*                                                                               
MCSACT25 BAS   RE,CLRDPL                                                        
*                                                                               
         MVI   MCSTYP,MCSTAC                                                    
         TM    JBSELFUN,JBGETDE    GET DETAILS?                                 
         BZ    MCSACT30                                                         
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSACT30 L     R7,JBACOLTB                                                      
         GOTO1 AMCSTAB                                                          
*                                                                               
MCSACTX  B     ROUTSE                                                           
         DROP  R4,R6,R7                                                         
         EJECT                                                                  
***********************************************************************         
* TABLE OF MCS COLUMNS RELATING TO NON MCS COLUMNS                    *         
***********************************************************************         
         SPACE 2                                                                
RELTAB   DS    0XL9                                                             
         DC    AL1(JBRETOEN),CL8'OE      '                                      
         DC    AL1(JBRETOEG),CL8'OEG     '                                      
         DC    AL1(JBRETOEC),CL8'OEC     '                                      
         DC    AL1(JBRETOEN),CL8'OEN     '                                      
         DC    AL1(JBRETOEV),CL8'OEV     '                                      
         DC    AL1(JBRETCEN),CL8'CE      '                                      
         DC    AL1(JBRETCEG),CL8'CEG     '                                      
         DC    AL1(JBRETCEC),CL8'CEC     '                                      
         DC    AL1(JBRETCEN),CL8'CEN     '                                      
         DC    AL1(JBRETCEV),CL8'CEV     '                                      
         DC    AL1(JBRETHEN),CL8'HR      '                                      
         DC    AL1(JBRETHEG),CL8'HRG     '                                      
         DC    AL1(JBRETHEC),CL8'HRC     '                                      
         DC    AL1(JBRETHEV),CL8'HRT     '                                      
         DC    AL1(JBRETACN),CL8'ACT     '                                      
         DC    AL1(JBRETACG),CL8'ACTG    '                                      
         DC    AL1(JBRETACC),CL8'ACTC    '                                      
         DC    AL1(JBRETACV),CL8'ACTV    '                                      
         DC    AL1(JBRETPON),CL8'PO      '                                      
         DC    AL1(JBRETPOG),CL8'POG     '                                      
         DC    AL1(JBRETPOC),CL8'POC     '                                      
         DC    AL1(JBRETPOV),CL8'POV     '                                      
         DC    AL1(JBRETPBC),CL8'PEBCE   '                                      
         DC    AL1(JBRETPBG),CL8'PEBCEG  '                                      
         DC    AL1(JBRETMXC),CL8'MAXCE   '                                      
         DC    AL1(JBRETRAT),CL8'RATE    '                                      
         DC    AL1(JBRETMXO),CL8'MAXOE   '                                      
         DC    AL1(JBRETOEH),CL8'OEH     '                                      
         DC    AL1(JBRETCEH),CL8'CEH     '                                      
         DC    AL1(JBRETHEH),CL8'HRH     '                                      
         DC    AL1(0)              EOT                                          
         EJECT                                                                  
         EJECT                                                                  
* TABLE OF DATA NUMBERS THAT REQUIRE ADDITION OF COMMISSION COLUMNS             
* FOR AGENCY COMMISSION ROWS                                                    
*                                                                               
COMMTAB  DS    0XL4                                                             
         DC    AL2(JBDEST,JBDESTC)                                              
         DC    AL2(JBDESTG,JBDESTC)                                             
         DC    AL2(JBDESTH,JBDESTC)                                             
         DC    AL2(JBDORG,JBDORGC)                                              
         DC    AL2(JBDORGG,JBDORGC)                                             
         DC    AL2(JBDCUR,JBDCURC)                                              
         DC    AL2(JBDCURG,JBDCURC)                                             
         DC    AL2(JBDHR,JBDHRC)                                                
         DC    AL2(JBDHRG,JBDHRC)                                               
         DC    AL2(JBDACT,JBDACTC)                                              
         DC    AL2(JBDACTG,JBDACTC)                                             
         DC    AL2(JBDPO,JBDPOC)                                                
         DC    AL2(JBDPOG,JBDPOC)                                               
         DC    AL2(JBDPRV,JBDPRVC)                                              
         DC    AL2(JBDPRVG,JBDPRVC)                                             
         DC    AL2(0,0)            EOT                                          
         EJECT                                                                  
* COLUMN OPERAND TABLE- COVERED BY COPTABD                                      
*                                                                               
COPTAB   DS    0CL(COPTABL)                                                     
*                                                                               
         DC    AL2(JBDEST)         ESTIMATE (NET)                               
         DC    AL1(COPGETES)                                                    
         DC    AL2(JBDESTC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDEST,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDESTN)        ESTIMATE (NET FORCED)                        
         DC    AL1(COPGETES)                                                    
         DC    AL2(JBDESTC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDEST,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDESTG)        ESTIMATE GROSS                               
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(JBDESTC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDESTG,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDESTC)        ESTIMATE COMMISSION                          
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDESTC,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDESTH)        ESTIMATE HOURS                               
         DC    AL1(COPGETES)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDESTH,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDESTHB)       ESTIMATE HOURS B                             
         DC    AL1(COPGETES)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDESTHB,0,0,0,0)                                            
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDESTHN)       ESTIMATE HOURS N                             
         DC    AL1(COPGETES)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDESTHN,0,0,0,0)                                            
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDESTHR)       ESTIMATE HOURS R                             
         DC    AL1(COPGETES)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDESTHR,0,0,0,0)                                            
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDORG)         ORIGINAL ESTIMATE                            
         DC    AL1(COPGETES)                                                    
         DC    AL2(JBDORGC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDORG,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDORGN)        ORIGINAL ESTIMATE (FORCED NET)               
         DC    AL1(COPGETES)                                                    
         DC    AL2(JBDORGC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDORG,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDORGG)        ORIGINAL ESTIMATE GROSS                      
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(JBDORGC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDORGG,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDORGC)        ORIGINAL ESTIMATE COMMISSION                 
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDORGC,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDORGH)        ORIGINAL ESTIMATE HOURS                      
         DC    AL1(COPGETES)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDORGH,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDORGHB)        ORIGINAL ESTIMATE HOURS B                   
         DC    AL1(COPGETES)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDORGHB,0,0,0,0)                                            
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDORGHN)        ORIGINAL ESTIMATE HOURS N                   
         DC    AL1(COPGETES)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDORGHN,0,0,0,0)                                            
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDORGHR)       ORIGINAL ESTIMATE HOURS R                    
         DC    AL1(COPGETES)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDORGHR,0,0,0,0)                                            
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDCUR)         CURRENT ESTIMATE                             
         DC    AL1(COPGETES)                                                    
         DC    AL2(JBDCURC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDCUR,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDCURN)        CURRENT ESTIMATE (FORCED NET)                
         DC    AL1(COPGETES)                                                    
         DC    AL2(JBDCURC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDCUR,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDCURG)        CURRENT ESTIMATE GROSS                       
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(JBDCURC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDCURG,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDCURC)        CURRENT ESTIMATE COMMISSION                  
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDCURC,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDCURH)        CURRENT ESTIMATE HOURS                       
         DC    AL1(COPGETES)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDCURH,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDCURHB)       CURRENT ESTIMATE HOURS B                     
         DC    AL1(COPGETES)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDCURHB,0,0,0,0)                                            
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDCURHN)       CURRENT ESTIMATE HOURS N                     
         DC    AL1(COPGETES)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDCURHN,0,0,0,0)                                            
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDCURHR)       CURRENT ESTIMATE HOURS R                     
         DC    AL1(COPGETES)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDCURHR,0,0,0,0)                                            
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDHR)         HIGHEST REVISION ESTIMATE                     
         DC    AL1(COPGETES+COPHIREV)                                           
         DC    AL2(JBDHRC)                                                      
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDHR,0,0,0,0)                                               
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDHRG)         HIGHEST REVISION GROSS                       
         DC    AL1(COPGETES+COPWCOM+COPHIREV)                                   
         DC    AL2(JBDHRC)                                                      
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDHRG,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDHRC)         HIGHEST REVISION COMMISSION                  
         DC    AL1(COPGETES+COPWCOM+COPHIREV)                                   
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDHRC,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDHRH)         HIGHEST REVISION HOURS                       
         DC    AL1(COPGETES+COPHIREV)                                           
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDHRH,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDHRHB)        HIGHEST REVISION HOURS B                     
         DC    AL1(COPGETES+COPHIREV)                                           
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDHRHB,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDHRHN)        HIGHEST REVISION HOURS N                     
         DC    AL1(COPGETES+COPHIREV)                                           
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDHRHN,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDHRHR)        HIGHEST REVISION HOURS R                     
         DC    AL1(COPGETES+COPHIREV)                                           
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDHRHR,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDACT)         ACTUAL CHARGES                               
         DC    AL1(COPGETTR)                                                    
         DC    AL2(JBDACTC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDACT,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDACTG)        ACTUAL CHARGES GROSS                         
         DC    AL1(COPGETTR+COPWCOM)                                            
         DC    AL2(JBDACTC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDACTG,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDACTC)        ACTUAL CHARGES COMMISSION                    
         DC    AL1(COPGETTR+COPWCOM)                                            
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDACTC,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDACTH)        ACTUAL CHARGES HOURS                         
         DC    AL1(COPGETTR)                                                    
         DC    AL2(0)                                                           
         DC    AL1(COPHOURS)                                                    
         DC    XL2'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDACTH,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDPO)          PURCHASE ORDERS                              
         DC    AL1(COPGETPO)                                                    
         DC    AL2(JBDPOC)                                                      
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDPO,0,0,0,0)                                               
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDPOG)        PURCHASE ORDERS GROSS                         
         DC    AL1(COPGETPO+COPWCOM)                                            
         DC    AL2(JBDPOC)                                                      
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDPOG,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDPOC)         PURCHASE ORDERS COMMISSION                   
         DC    AL1(COPGETPO+COPWCOM)                                            
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDPOC,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDRATE)        COMMISSION RATE                              
         DC    AL1(COPGETCO+COPWCOM)                                            
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDRATE,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDPRV)         PREVIOUS ESTIMATE                            
         DC    AL1(COPGETES)                                                    
         DC    AL2(JBDPRVC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDPRV,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDPRVN)        PREVIOUS ESTIMATE                            
         DC    AL1(COPGETES)                                                    
         DC    AL2(JBDPRVC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDPRV,0,0,0,0)                                              
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDPRVG)        PREVIOUS ESTIMATE GROSS                      
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(JBDPRVC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDPRVG,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDPRVC)        PREVIOUS ESTIMATE COMMISSION                 
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDPRVC,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDBAL)         BALANCE=CURRENT ESTIMATE-ACTUALS             
         DC    AL1(COPGETES+COPGETTR)                                           
         DC    AL2(JBDBALC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDCUR,JBDACT,0,0,0)                                         
         DC    X'01',X'02',C'-',C'=',6X'00'                                     
*                                                                               
         DC    AL2(JBDBALG)        BALANCE GROSS                                
         DC    AL1(COPGETES+COPGETTR+COPWCOM)                                   
         DC    AL2(JBDBALC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDCURG,JBDACTG,0,0,0)                                       
         DC    X'01',X'02',C'-',C'=',6X'00'                                     
*                                                                               
         DC    AL2(JBDBALC)        BALANCE COMMISSION                           
         DC    AL1(COPGETES+COPGETTR+COPWCOM)                                   
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDCURC,JBDACTC,0,0,0)                                       
         DC    X'01',X'02',C'-',C'=',6X'00'                                     
*                                                                               
         DC    AL2(JBDUNC)         UNCOMMITTED                                  
         DC    AL1(COPGETES+COPGETTR+COPGETPO)                                  
         DC    AL2(JBDUNCC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(3)                                                           
         DC    AL2(JBDCUR,JBDACT,JBDPO,0,0)                                     
         DC    X'01',X'02',X'03',C'+',C'-',C'=',4X'00'                          
*                                                                               
         DC    AL2(JBDUNCG)        UNCOMMITTED GROSS                            
         DC    AL1(COPGETES+COPGETTR+COPGETPO+COPWCOM)                          
         DC    AL2(JBDUNCC)                                                     
         DC    XL3'00'                                                          
         DC    AL1(3)                                                           
         DC    AL2(JBDCURG,JBDACTG,JBDPOG,0,0)                                  
         DC    X'01',X'02',X'03',C'+',C'-',C'=',4X'00'                          
*                                                                               
         DC    AL2(JBDUNCC)        UNCOMMITTED COMMISSION                       
         DC    AL1(COPGETES+COPGETTR+COPGETPO+COPWCOM)                          
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(3)                                                           
         DC    AL2(JBDCURC,JBDACTC,JBDPOC,0,0)                                  
         DC    X'01',X'02',X'03',C'+',C'-',C'=',4X'00'                          
*                                                                               
         DC    AL2(JBDPCOM)        PERCENT COMMITTED                            
         DC    AL1(COPGETES+COPGETPO+COPGETTR)                                  
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(3)                                                           
         DC    AL2(JBDACT,JBDPO,JBDCUR,0,0)                                     
         DC    X'01',X'02',C'+',X'03',C'%',C'=',4X'00'                          
*                                                                               
         DC    AL2(JBDPCOMG)       PERCENT COMMITTED GROSS                      
         DC    AL1(COPGETES+COPGETPO+COPGETTR+COPWCOM)                          
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(3)                                                           
         DC    AL2(JBDACTG,JBDPOG,JBDCURG,0,0)                                  
         DC    X'01',X'02',C'+',X'03',C'%',C'=',4X'00'                          
*                                                                               
         DC    AL2(JBDPCOMC)       PERCENT COMMITTED COMMISSION                 
         DC    AL1(COPGETES+COPGETPO+COPGETTR+COPWCOM)                          
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(3)                                                           
         DC    AL2(JBDACTC,JBDPOC,JBDCURC,0,0)                                  
         DC    X'01',X'02',C'+',X'03',C'%',C'=',4X'00'                          
*                                                                               
         DC    AL2(JBDPUNC)        PERCENT UNCOMMITTED                          
         DC    AL1(COPGETES+COPGETTR+COPGETPO)                                  
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(3)                                                           
         DC    AL2(JBDCUR,JBDACT,JBDPO,0,0)                                     
         DC    X'01',X'02',X'03',C'+',C'-',X'01',C'%',C'=',2X'00'               
*                                                                               
         DC    AL2(JBDPUNCG)       PERCENT UNCOMMITTED GROSS                    
         DC    AL1(COPGETES+COPGETTR+COPGETPO+COPWCOM)                          
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(3)                                                           
         DC    AL2(JBDCURG,JBDACTG,JBDPOG,0,0)                                  
         DC    X'01',X'02',X'03',C'+',C'-',X'01',C'%',C'=',2X'00'               
*                                                                               
         DC    AL2(JBDPUNCC)       PERCENT UNCOMMITTED COMMISSION               
         DC    AL1(COPGETES+COPGETTR+COPGETPO+COPWCOM)                          
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(3)                                                           
         DC    AL2(JBDCURC,JBDACTC,JBDPOC,0,0)                                  
         DC    X'01',X'02',X'03',C'+',C'-',X'01',C'%',C'=',2X'00'               
*                                                                               
         DC    AL2(JBDMEST)         MAXIMUM ESTIMATE (NET)                      
         DC    AL1(COPGETES)                                                    
         DC    AL2(JBDMESTC)                                                    
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDEST,JBDMAXPE,0,0,0)                                       
         DC    X'01',X'02',C'P',C'=',6X'00'                                     
*                                                                               
         DC    AL2(JBDMESTG)       MAXIMUM ESTIMATE GROSS                       
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(JBDMESTC)                                                    
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDESTG,JBDMAXPE,0,0,0)                                      
         DC    X'01',X'02',C'P',C'=',6X'00'                                     
*                                                                               
         DC    AL2(JBDMESTC)       MAXIMUM ESTIMATE COMMISSION                  
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDESTC,JBDMAXPE,0,0,0)                                      
         DC    X'01',X'02',C'P',C'=',6X'00'                                     
*                                                                               
         DC    AL2(JBDMCUR)        MAXIMUM CURRENT ESTIMATE                     
         DC    AL1(COPGETES)                                                    
         DC    AL2(JBDMCURC)                                                    
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDCUR,JBDMAXPE,0,0,0)                                       
         DC    X'01',X'02',C'P',C'=',6X'00'                                     
*                                                                               
         DC    AL2(JBDMCURG)       MAXIMUM CURRENT ESTIMATE GROSS               
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(JBDMCURC)                                                    
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDCURG,JBDMAXPE,0,0,0)                                      
         DC    X'01',X'02',C'P',C'=',6X'00'                                     
*                                                                               
         DC    AL2(JBDMCURC)       MAXIMUM CURRENT ESTIMATE COMMISSION          
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDCURC,JBDMAXPE,0,0,0)                                      
         DC    X'01',X'02',C'P',C'=',6X'00'                                     
*                                                                               
         DC    AL2(JBDMORG)        MAXIMUM ORIGINAL ESTIMATE                    
         DC    AL1(COPGETES)                                                    
         DC    AL2(JBDMORGC)                                                    
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDORG,JBDMAXPE,0,0,0)                                       
         DC    X'01',X'02',C'P',C'=',6X'00'                                     
*                                                                               
         DC    AL2(JBDMORGG)       MAXIMUM ORIGINAL ESTIMATE GROSS              
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(JBDMORGC)                                                    
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDORGG,JBDMAXPE,0,0,0)                                      
         DC    X'01',X'02',C'P',C'=',6X'00'                                     
*                                                                               
         DC    AL2(JBDMORGC)       MAXIMUM ORIGINAL ESTIMATE COMMISSION         
         DC    AL1(COPGETES+COPWCOM)                                            
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(2)                                                           
         DC    AL2(JBDORGC,JBDMAXPE,0,0,0)                                      
         DC    X'01',X'02',C'P',C'=',6X'00'                                     
*                                                                               
         DC    AL2(JBDPCUR)        PERCENT OF CURRENT EST TO BILL               
         DC    AL1(COPGETES+COPEREST)                                           
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDPCUR,0,0,0,0)                                             
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDPCURG)       PERCENT OF CURRENT EST TO BILL GROSS         
         DC    AL1(COPGETES+COPWCOM+COPEREST)                                   
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDPCURG,0,0,0,0)                                            
         DC    X'01',C'=',8X'00'                                                
*                                                                               
         DC    AL2(JBDPCURC)       PER OF CE TO BILL GROSS COMMISSION           
         DC    AL1(COPGETES+COPWCOM+COPEREST)                                   
         DC    AL2(0)                                                           
         DC    XL3'00'                                                          
         DC    AL1(1)                                                           
         DC    AL2(JBDPCURC,0,0,0,0)                                            
         DC    X'01',C'=',8X'00'                                                
*                                                                               
NCOPTAB  EQU   (*-COPTAB)/L'COPTAB                                              
*                                                                               
SEPTAB   DC    AL1(4),C'+-*%'      FIELD DIVIDER                                
         DC    AL1(1),C','                                                      
         DC    AL1(1),C','                                                      
         DC    AL1(1),C','                                                      
*                                                                               
         EJECT                                                                  
*                                                                               
* DSECT TO COVER ACJOBBER WORKING STORAGE                                       
*                                                                               
WORKD    DSECT                                                                  
APARM    DS    A                                                                
RELO     DS    A                                                                
AWORK    DS    A                   RD AT ENTRY                                  
USERRD   DS    A                   USER REGISTER 13                             
SAVERE   DS    A                                                                
*                                                                               
VDATAMGR DS    V                                                                
VHELLO   DS    V                                                                
VSCANNER DS    V                                                                
*                                                                               
ARELTAB  DS    A                   A(RELTAB)                                    
ACOPTAB  DS    A                   A(COPTAB)                                    
ACOMTAB  DS    A                   A(COMMTAB)                                   
AGOBLOCK DS    A                   A(GOBLOCK)                                   
ABLOCK   DS    A                   A(BLOCK)                                     
*                                                                               
OVROUT   DS    0A                  ROUTINE ADDRESSES                            
AMCSIOR  DS    A                                                                
AMCSINI  DS    A                                                                
AMCSPUT  DS    A                                                                
AMCSORD  DS    A                                                                
AMCSACT  DS    A                                                                
AMCSTAB  DS    A                                                                
AMCSCOL  DS    A                                                                
AMCSPTAB DS    A                                                                
OVROUTN  EQU   (*-OVROUT)/L'OVROUT                                              
*                                                                               
DMCB     DS    8F                                                               
WORK     DS    XL64                                                             
WORK2    DS    CL16                                                             
PL16     DS    PL16                                                             
DUB      DS    D                                                                
DUB1     DS    D                                                                
DUB2     DS    D                                                                
DUB3     DS    D                                                                
DUB4     DS    D                                                                
DUB5     DS    D                                                                
DUB6     DS    D                                                                
DUB7     DS    D                                                                
FULL     DS    F                                                                
HALF     DS    H                                                                
*                                                                               
THREE    DS    XL3                                                              
BYTE     DS    X                                                                
ELCODE   DS    X                                                                
SPACES   DS    CL80                                                             
*                                                                               
DMDSKADR DS    F                                                                
DMINBTS  DS    X                                                                
COMMAND  DS    CL6                                                              
KEY      DS    CL(ACCORLEN)                                                     
KEYSAVE  DS    CL(L'KEY)                                                        
SVCATCOD DS    CL(L'CATKCODE)                                                   
SVTYPE01 DS    CL(ERDWLNQ)                                                      
*                                                                               
CUL      DS    CL3                 COMPANY/UNIT/LEDGER                          
CLIENT   DS    CL6                 CLIENT CODE (SPACE PADDED)                   
PRODUCT  DS    CL6                 PRODUCT CODE (SPACE PADDED)                  
JOBNUM   DS    CL6                 JOB NUMBER (SPACE PADDED)                    
WORKCODE DS    CL2                 WORK CODE                                    
NEEDAE   DS    C                   Y=NEED APPROVED ESTIMATES TO BILL            
BILTYP   DS    C                   BILLING TYPE                                 
BILAM1   DS    F                   BILLING AMOUNT/PERCENT 1                     
BILAM2   DS    F                                                                
BILAM3   DS    F                                                                
*                                                                               
*                                                                               
SVWCCOD  DS    CL2                                                              
SVWCHRS  DS    PL6                                                              
SVWCHVL  DS    PL6                                                              
SVWC1RA  DS    CL12                                                             
*                                                                               
ESTSW    DS    C                   ESTIMATE SWITCH Y=READ ESTIMATES             
ACTSW    DS    C                   ACTUALS SWITCH Y=READ ACTUALS                
POSW     DS    C                   PURCHASE ORDER SWITCH Y=READ POS             
EHSW     DS    C                   ESTIMATE HOURS SWITCH Y/N                    
RATESW   DS    C                   COMMISSION RATES Y=READ COMMISSIONS          
WCOMSW   DS    C                   Y=NEED WORKCODE COMMISSION RATES             
PERESTSW DS    C                   Y=COMPUTE PERCENT OF EST NUMBERS             
HIREVSW  DS    C                   Y=READ AND POST HIGHEST REVISION             
ADJOPSW  DS    C                   Y=ADJUST OPERAND LIST                        
AGYSW    DS    C                   Y=AGENCY COMMISSION POSTED                   
SUBSW    DS    C                   Y=SUB-TOTAL POSTED                           
AGYCATSW DS    C                   Y=AGENCY COMMISSION CATEGORY POSTED          
CATFRMSW DS    C                   Y=CATEGORY FORMULAS PRESENT                  
AGYCOMSW DS    C                   Y=ROW IS COMMISSION ONLY                     
CASW     DS    C                                                                
HOURSW   DS    C                   Y=HOURS REQUIRED                             
*                                                                               
SELECTED DS    XL(L'GOSELEST)                                                   
SELECTE2 DS    XL(L'GOSELEST)                                                   
MCSESW   DS    C                                                                
SMJENTRY DS    XL(MJETLNQ+20*L'MJETVAL+2)                                       
*                                                                               
MCSVALS  DS    0F                                                               
MCSCNO   DS    F                                                                
MCSTYP   DS    XL1                                                              
MCSTCE   EQU   1                                                                
MCSTOE   EQU   2                                                                
MCSTHE   EQU   3                                                                
MCSTAC   EQU   4                                                                
MCSTPO   EQU   5                                                                
MCSHAE   DS    XL1                 HIGHEST APPROVED                             
MCSHUE   DS    XL1                 HIGHEST UNAPPROVED                           
MCSORE   DS    XL1                 ORIGINAL                                     
MCSCUE   DS    XL1                 CURRENT                                      
MCSHIE   DS    XL1                 HIGHEST                                      
MCSPRE   DS    XL1                                                              
MCSSTA   DS    XL1                                                              
MCSSAQ   EQU   X'80'               REGULAR ESTIMATE                             
MCSSOQ   EQU   X'40'               ORIGINAL ESTIMATE                            
MCSSCQ   EQU   X'20'               CURRENT ESTIMATE                             
MCSSHQ   EQU   X'10'               HIGHEST ESTIMATE                             
MCSALL   DS    XL512                                                            
MCSERV   DS    0XL7                                                             
MCSERI   DS    XL1                 EXCHANGE RATE INDICATOR                      
MCSEXC   DS    XL5                 EXCHANGE RATE (READ/INPUT)                   
MCSAFS   DS    XL1                 AGENCY --> FOREIGN SHIFT                     
MCSFAS   DS    XL1                 FOREIGN --> AGENCY SHIFT                     
MCSVALQ  EQU   *-MCSVALS                                                        
*                                                                               
ESTLIST  EQU   MCSALL                                                           
*                                                                               
MAXCOLS  DS    F                   MAXIMUM COLUMN TABLE ROWS                    
MAXOPVS  DS    F                   MAXIMUM OPERAND VALUE TABLE ROWS             
*                                                                               
CLDATA   DS    0CL(L'JBCLDATA)                                                  
CLNUM    DS    XL2                                                              
CLEST    DS    C                                                                
CLVER    DS    X                                                                
CLKEYL   EQU   *-CLDATA                                                         
         DS    CL(L'JBCLDATA-(*-CLDATA)) SPARE                                  
CLVAL1   DS    PL8                                                              
CLVAL2   DS    PL8                                                              
*                                                                               
COLENT   DS    CL(JBCOLV1R-JBCOLD) DEFINE LARGER TABLE                          
*                                                                               
ESTYPE   DS    C                   ESTIMATE TYPE                                
ESTVERS  DS    X                   ESTIMATE VERSION                             
*                                                                               
         DS    0F                                                               
LOOKWC   DS    CL2                 LOOKUP WORKCODE                              
LOOKSUFF DS    C                   LOOKUP WORKCODE SUFFIX                       
         DS    C                                                                
LOOKROW  DS    H                   ROW NUMBER FOR WORKCODE                      
LOOKRATE DS    PL4                 WORKCODE COMMISSION RATE                     
LOOK1R   DS    CL14                1R ACCOUNT/PERSON CODE                       
*                                                                               
MAXPER   DS    PL(L'GOOVRPER)      MAXIMUM PERCENT OF ESTIMATE                  
PEREST   DS    PL4                 PERCENT OF ESTIMATE TO BILL (2 DEC.)         
*                                                                               
GROSS    DS    PL6                                                              
NET      DS    PL6                                                              
COMM     DS    PL6                                                              
HOURS    DS    PL6                 NUMBER OF ALL HOURS                          
HOURSB   DS    PL6                 NUMBER OF B HOURS                            
HOURSN   DS    PL6                 NUMBER OF N HOURS                            
HOURSR   DS    PL6                 NUMBER OF R HOURS                            
*                                                                               
OP       DS    C                   OPERATION                                    
OPDLIST  DS    CL60                                                             
STACK    DS    CL80                                                             
*                                                                               
ACATEL   DS    A                   A(CATEGORY DESCRIPTION ELEMENT)              
AJOBEL   DS    A                   A(JOB ELEMENT)                               
AOPVALUE DS    A                                                                
ACOLENT  DS    A                                                                
AFROMVAL DS    A                                                                
ATOVAL   DS    A                                                                
*                                                                               
BEFORE   DS    A                                                                
AFTER    DS    A                                                                
LINKREC  DS    XL(LINKLSTL)                                                     
*                                                                               
LERKEY   DS    CL(L'KEY)           SAVED ESTIMATE KEY                           
CERKEY   DS    CL(L'KEY)           CURRENT ESTIMATE KEY                         
LASTKEY  DS    CL(L'KEY)           LAST RECORD READ                             
*                                                                               
OPTAB    DS    (MAXOPS)CL(OPERL)   OPERAND TABLE                                
*                                                                               
CATTABL  DS    H                   L'CATEGORY TABLE                             
CATTAB   DS    CL300                                                            
*                                                                               
IOAREA   DS    CL2000                                                           
*                                                                               
BLOCK    DS    CL1000              BUFFER FOR PARSNIP CALL                      
*                                                                               
GOJBLK   DS    (GOBLOCKX-GOBLOCK)X GOBLOCK  AREA                                
*                                                                               
WORKX    EQU   *                                                                
         EJECT                                                                  
* ACGOBLOCK                                                                     
         PRINT OFF                                                              
GOBLOCKD DSECT                                                                  
       ++INCLUDE ACGOBLOCK                                                      
JBLOCKD  DSECT                                                                  
       ++INCLUDE ACJOBBLOCK                                                     
         EJECT                                                                  
       ++INCLUDE ACJOBBERD                                                      
         EJECT                                                                  
* DSECT TO COVER COLUMN OPERAND TABLE                                           
*                                                                               
COPTABD  DSECT                     **COLUMN OPERAND TABLE ENTRY**               
COPNUM   DS    XL2                 COLUMN DATA NUMBER                           
COPIND1  DS    X                   INDICATOR 1                                  
COPEST   EQU   X'80'               COLUMN IS AN ESTIMATE                        
COPHIREV EQU   X'40'               GET HIGHEST REVISION                         
COPEREST EQU   X'20'               COMPUTE PERCENT OF EST NUMBERS               
COPWCOM  EQU   X'10'               NEED WORKCODE COMMISSION RATES               
COPGETES EQU   X'08'               GET ESTIMATE RECORDS                         
COPGETTR EQU   X'04'               GET TRANSACTION RECORDS                      
COPGETPO EQU   X'02'               GET PURCHASE ORDER RECORDS                   
COPGETCO EQU   X'01'               GET COMMISSION RATES                         
COPCOM   DS    XL2                 DATA NUM. FOR COMMISSION ROW LOOKUP          
COPIND2  DS    X                   INDICATOR 2                                  
COPHOURS EQU   X'80'               HOURS REQUIRED                               
         DS    XL2                 SPARE                                        
COPNOPER DS    X                   N'DATA OPERANDS                              
COPERS   DS    XL10                OPERANDS                                     
COPOLISH DS    XL10                REVERSE POLISH NOTATION FORMULA              
COPTABL  EQU   *-COPTABD           COLUMN OPERAND TABLE ENTRY LENGTH            
         EJECT                                                                  
* DSECT TO COVER OPERAND TABLE ENTRY                                            
*                                                                               
OPERD    DSECT                     **OPERAND TABLE ENTRY**                      
OPERNUM  DS    XL2                 OPERAND DATA NUMBER                          
OPEREST  DS    C                   ESTIMATE TYPE                                
OPERVER  DS    X                   ESTIMATE VERSION NUMBER                      
         DS    XL2                 SPARE                                        
OPERL    EQU   *-OPERD                                                          
         EJECT                                                                  
* DSECT TO COVER CATEGORY FORMULA TABLE                                         
*                                                                               
CATTABD  DSECT                     **CATEGORY FORMULA TABLE ENTRY**             
CATCODE  DS    CL(L'CATKCODE)      TO CATEGORY CODE                             
CATLEN   DS    X                   L'CATEGORY FORMULA + 3                       
CATFORM  DS    0C                  CATEGORY FORMUAL                             
         EJECT                                                                  
* DSECT TO COVER LINKED LIST FOR RESOLVING CATEGORY FORMULAS                    
*                                                                               
LINKLSTD DSECT                                                                  
LINKFRWD DS    AL4                 POINTER TO NEXT LOGICAL ENTRY                
LINKBACK DS    AL4                 POINTER TO PREVIOUS LOGICAL ENTRY            
LINKFRST EQU   LINKFRWD            ANCHOR POINTER TO 1ST LOGICAL ENTRY          
LINKLAST EQU   LINKBACK            ANCHOR POINTER TO LAST LOGICAL ENTRY         
LINKOP   DS    C                   OPERATION                                    
LINKEND  EQU   0                   EOT MARKER                                   
LINKFROM DS    XL2                 ROW NUMBER FOR 'FROM' ROW                    
LINKTO   DS    XL2                 ROW NUMBER FOR 'TO' ROW                      
         ORG   LINKFROM                                                         
LINKHIGH DS    AL4                 POINTER TO LAST ACTUAL ENTRY                 
LINKCODE DS    CL3                 SPECIAL WORKCODE                             
LINKREF  DS    CL2                 REFERENCE CATEGORY                           
LINKHOME DS    CL2                 SOURCE CATEGORY                              
LINKLSTL EQU   *-LINKLSTD          LINKED LIST ENTRY LENGTH                     
         EJECT                                                                  
* EQUATES                                                                       
*                                                                               
YES      EQU   C'Y'                                                             
NO       EQU   C'N'                                                             
MAXOPS   EQU   30                  MAXIMUM OPERANDS                             
PLUS     EQU   C'+'                                                             
MINUS    EQU   C'-'                                                             
MULTIPLY EQU   C'*'                                                             
MULTPER  EQU   C'P'                MULTIPLY BY PERCENTAGE                       
PERCENT  EQU   C'%'                                                             
FFQ      EQU   X'FF'                                                            
APPRQ    EQU   C'A'                                                             
UNAPQ    EQU   C'U'                                                             
BNPQ     EQU   X'D0'               NOT PLUS                                     
BNMQ     EQU   X'B0'               NOT MINUS                                    
         EJECT                                                                  
SCBLOCKD DSECT                                                                  
       ++INCLUDE ACSCBLOCK                                                      
         PRINT ON                                                               
* ACGENFILE                                                                     
         PRINT OFF                                                              
       ++INCLUDE ACGENFILE                                                      
         PRINT ON                                                               
* DDCOMFACS                                                                     
         PRINT OFF                                                              
       ++INCLUDE DDCOMFACS                                                      
         PRINT ON                                                               
* FAFACTS                                                                       
         PRINT OFF                                                              
       ++INCLUDE FAFACTS                                                        
         PRINT ON                                                               
* ACDDEQUS                                                                      
         PRINT OFF                                                              
       ++INCLUDE ACDDEQUS                                                       
         PRINT ON                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'064ACJOBBER  04/06/16'                                      
         END                                                                    

*          DATA SET DEDEMGEN   AT LEVEL 072 AS OF 05/01/02                      
*CATALP DEMGEN                                                                  
         TITLE 'DEMGEN - DEMO CONVERSION PREPROCESSOR'                          
         PRINT NOGEN                                                            
DEMGEN   CSECT                                                                  
         NBASE 0,*DEMGEN*,=V(REGSAVE),R3,R7,RR=R5,CLEAR=YES                     
         L     RA,=V(CPRINT)                                                    
         USING DPRINT,RA                                                        
* INITIALIZATION ROUTINES                                                       
         MVI   PHSW,C'Y'                                                        
         L     RE,=V(DSCTCODE)                                                  
         ST    RE,NXTDCODE                                                      
         L     RE,=V(DSCTAREA)                                                  
         ST    RE,NXTDSCT                                                       
         L     RE,=V(FRMTAREA)                                                  
         ST    RE,NXTFRMT                                                       
         L     RE,=V(DDEFAREA)                                                  
         ST    RE,CURRDDEF                                                      
         L     RE,=V(FORMAREA)                                                  
         ST    RE,NEXTFORM                                                      
         GOTO1 =V(STXITER),PARAS,DMPLIST                                        
         MVI   CTYPE,C'1'                                                       
         XC    FORMCNT,FORMCNT                                                  
         MVI   ELEMSW,0                                                         
         MVI   CODESW,0                                                         
         L     RE,=V(ELEMA)                                                     
         ST    RE,ELMPNT                                                        
         L     RE,=V(MDISP)                                                     
         ST    RE,CURMDISP                                                      
         OPEN  (IRDR)                                                           
         XC    ZDSECT,ZDSECT                                                    
READ     GOTO1 =V(CARDS),PARAS,P,=C'RE00'                                       
         CLC   P(2),=C'/*'                                                      
         BE    OUTPUT                                                           
         CLC   P(4),=C'PAN='       DID USER SPECIFY A PAN BOOK                  
         BNE   READ4                                                            
         L     RE,=A(STACK2)                                                    
         MVC   10(8,RE),P+6                                                     
         MVC   PANNAME,P+4                                                      
         L     RE,=A(STACK2A)                                                   
         MVC   9(8,RE),PANNAME+2                                                
         MVI   CTYPE,C'1'                                                       
         BAS   RE,OUTSTK                                                        
         GOTO1 =V(PANIC),PARAS,(X'80',=C'READ'),=C'PAN',PANNAME,C               
         TM    PARAS+8,X'10'                                                    
         BNO   READ1                                                            
         MVC   P+85(23),=C'PAN-NAME NOT IN LIBRARY'                             
         GOTO1 =V(PRINTER)                                                      
         B     READ                                                             
         SPACE 2                                                                
READ1    MVC   P(80),C                                                          
         GOTO1 =V(PRINTER)                                                      
         SPACE 2                                                                
READ2    BAS   RE,DATA             LOOP ROUND PAN BOOK                          
         CLI   CODESW,1                                                         
         BE    READ3                                                            
         CLI   P,C'*'                                                           
         BE    READ3                                                            
         CLC   P+9(6),=C'ENDCOD'                                                
         BE    READ3                                                            
         GOTO1 =V(PRINTER)                                                      
READ3    DS    0H                                                               
         GOTO1 =V(PANIC),PARAS,(X'80',=C'READ'),=C'PAN',PANNAME,P               
         CLC   P+9(5),=C'CHECK'                                                 
         BE    READ3                                                            
         CLC   P(2),=C'/*'                                                      
         BNE   READ2                                                            
         B     OUTPUT                                                           
         SPACE 2                                                                
READ4    BAS   RE,DATA             DATA CARDS SUBMITTED DIRECT                  
         GOTO1 =V(PRINTER)                                                      
         B     READ                                                             
         SPACE 2                                                                
PUT      NTR1                                                                   
         L     R2,COUNT                                                         
         LA    R2,1(R2)                                                         
         ST    R2,COUNT                                                         
         ST    R2,CSEQ                                                          
         EJECT                                                                  
DATA     NTR1                                                                   
         LA    R9,P+15             INITIALIZE SCAN                              
         ST    R9,STRTSCAN                                                      
         CLI   CODESW,1                                                         
         BE    DATA10                                                           
         CLC   P+9(4),=C'    '                                                  
         BNE   *+10                                                             
         MVC   P+9(6),PREVKWRD                                                  
         MVC   PREVKWRD,P+9                                                     
         CLI   ELEMSW,1            ELEMENT IN PROCESS                           
         BE    DATA22A                                                          
         CLC   P+9(4),=C'ELEM'     START ELEMENT DEFINITIONS                    
         BE    DATA22                                                           
         CLC   P+9(5),=C'PHASE'                                                 
         BNE   DATA01                                                           
         MVC   PHSW,P+16                                                        
         B     XIT                                                              
DATA01   DS    0H                                                               
         CLC   P+9(4),=C'REC '                                                  
         BNE   DATA02                                                           
         MVC   LINE,=PL2'99'                                                    
         MVC   TITLE(25),=C'RECORD DEFINITION SECTION'                          
         L     RE,NXTDCODE         TABLE FORMAT                                 
         ST    RE,CURRDCDE          0-4 EXTERNAL FILE NAME                      
         LA    RE,1(RE)               5 INTERNAL FILE NAME                      
         ST    RE,NXTDCODE          6-9 START OF FORMAT TABLE                   
         L     RE,NXTDSCT          10-13 START OF DSECT TABLE                   
         ST    RE,CURRDSCT                                                      
         LA    RE,14(RE)                                                        
         ST    RE,NXTDSCT                                                       
         L     RE,CURRDSCT                                                      
         MVC   0(4,RE),P+15        EXTERNAL DSECT CODE                          
         L     RF,CURRDCDE                                                      
         MVC   5(1,RE),0(RF)       INTERNAL DSECT CODE                          
         L     RF,NXTFRMT                                                       
         LA    RF,1(RF)                                                         
         ST    RF,NXTFRMT                                                       
         MVC   6(4,RE),NXTFRMT     A(FORMAT TABLE)                              
         ST    RF,CURRFRMT                                                      
         MVC   10(4,RE),CURRDDEF   A(DSECT TABLE)                               
         B     XIT                                                              
         EJECT                                                                  
DATA02   CLC   P+9(4),=C'DESC'                                                  
         BNE   DATA04                                                           
         MVI   OPTYP,C'D'                                                       
DATA021  BAS   RE,SCAN                                                          
         CLI   KWLEN,0                                                          
         BNE   DATA021A                                                         
         CLI   OPTYP,C'F'          FIELD CARD IN PROCESS                        
         BE    DATA066                                                          
         L     R8,CURRFRMT          NO - BUMP FORMAT POINTER                    
         LA    R8,8(R8)                                                         
         ST    R8,CURRFRMT                                                      
         ST    R8,NXTFRMT                                                       
         B     XIT                                                              
DATA021A CLI   KWLEN,1             1 CHARACTER                                  
         BNE   DATA024                                                          
         CLI   OPTYP,C'F'          FIELD CARD IN PROCESS                        
         BE    *+8                                                              
         L     R8,CURRFRMT         MUST BE PRECISION                            
         MVC   1(1,R8),KEYWORD                                                  
         MVC   0(1,R8),KWLEN                                                    
         L     R9,=V(PRECTAB)                                                   
         MVI   ERROR,DPRCERR                                                    
DATA022  CLI   0(R9),0                                                          
         BE    PRECERR                                                          
         CLC   OPLEN,0(R9)                                                      
         BE    DATA022B                                                         
DATA022A ZIC   RF,0(R9)                                                         
         AR    R9,RF                                                            
         LA    R9,3(R9)                                                         
         B     DATA022                                                          
DATA022B ZIC   RF,0(R9)                                                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   3(0,R9),OPERAND                                                  
         BNE   DATA022A                                                         
         MVC   4(2,R8),1(R9)                                                    
         B     DATA021                                                          
         SPACE 2                                                                
DATA024  CLC   KEYWORD(6),=C'FORMAT'                                            
         BNE   DATA026                                                          
         MVI   ERROR,DFMTERR                                                    
         CLI   OPERAND,C'N'                                                     
         BE    *+8                                                              
         CLI   OPERAND,C'C'                                                     
         BE    *+8                                                              
         CLI   OPERAND,C'P'                                                     
         BE    *+8                                                              
         CLI   OPERAND,C'B'                                                     
         BNE   PRECERR                                                          
         MVC   2(1,R8),OPERAND                                                  
         B     DATA021                                                          
         SPACE 2                                                                
DATA026  CLC   KEYWORD(6),=C'LENGTH'                                            
         BNE   DATA028                                                          
         MVI   ERROR,DLENERR                                                    
         BAS   R9,CNVB                                                          
         BNE   PRECERR                                                          
         MVC   6(2,R8),OPERAND+2                                                
         B     DATA021                                                          
         SPACE 2                                                                
DATA028  MVI   ERROR,DESCERR                                                    
         CLI   OPTYP,C'D'                                                       
         BE    PRECERR                                                          
         MVI   ERROR,FLDERR                                                     
         B     PRECERR                                                          
         EJECT                                                                  
DATA04   CLC   P+9(3),=C'SET'                                                   
         BNE   DATA06                                                           
         BAS   RE,SCAN                                                          
         BAS   R9,CNVB                                                          
         BNE   PRECERR                                                          
         MVC   CURRDISP,OPERAND                                                 
         L     RE,CURRDISP                                                      
         ST    RE,CURRDISP                                                      
         B     XIT                                                              
         EJECT                                                                  
DATA06   CLC   P+9(5),=C'FIELD'                                                 
         BNE   DATA08                                                           
         MVI   ERROR,FIDERR                                                     
         XC    FORMAT,FORMAT                                                    
         MVI   OPTYP,C'F'                                                       
         L     RE,CURRDSCT                                                      
         MVC   FULL,6(RE)          SET FORMAT FOR THIS FIELD                    
         L     RF,FULL                                                          
DATA062  CLC   P+15(1),1(RF)       CHECK FOR FORMAT TABLE ENTRY                 
         BE    DATA064                                                          
         L     R8,CURRDDEF                                                      
         MVI   0(R8),C'*'                                                       
         CLC   P+15(4),=C'SPAC'                                                 
         BE    DATA062A                                                         
         CLC   P+15(4),=C'ZERO'                                                 
         BE    DATA062B                                                         
         LA    RF,8(RF)                                                         
         CLI   0(RF),0                                                          
         BE    DATA064                                                          
         B     DATA062                                                          
DATA062A MVC   FORMAT,=X'0100D70000000001'                                      
         LA    R8,FORMAT                                                        
         BAS   RE,SCAN                                                          
         B     DATA021                                                          
DATA062B MVC   FORMAT,=X'0100C30000000001'                                      
         LA    R8,FORMAT                                                        
         BAS   RE,SCAN                                                          
         B     DATA021                                                          
DATA064  MVC   FDPREC(4),4(RF)                                                  
         MVC   FDFRMT,2(RF)                                                     
         BAS   RE,SCAN                                                          
         CLI   OPLEN,0                                                          
         BE    PRECERR                                                          
         L     R8,CURRDDEF                                                      
         MVC   0(7,R8),=C'       '                                              
         ZIC   RE,OPLEN                                                         
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R8),OPERAND                                                  
         LA    R8,FORMAT                                                        
         B     DATA021                                                          
DATA066  MVI   ERROR,FIDERR                                                     
         L     R8,CURRDDEF                                                      
         OC    FORMAT,FORMAT                                                    
         BZ    PRECERR                                                          
         MVC   7(2,R8),CURRDISP+2  SET DSECT DISPLACEMENT                       
         MVC   HALF,FDLEN                                                       
         L     RE,CURRDISP                                                      
         AH    RE,HALF                                                          
         ST    RE,CURRDISP                                                      
         MVC   9(4,R8),FDPREC                                                   
         MVC   13(1,R8),FDFRMT                                                  
         LA    R8,14(R8)                                                        
         ST    R8,CURRDDEF                                                      
         B     XIT                                                              
         EJECT                                                                  
DATA08   CLC   P+9(4),=C'CODE'     BAL CODE FOLLOWS                             
         BNE   DATA10                                                           
         MVI   CODESW,1                                                         
         MVC   LINE,=PL2'99'                                                    
         MVC   TITLE,SPACES                                                     
         MVC   TITLE(26),=C'PROCESSING CONTROL SECTION'                         
         B     XIT                                                              
         SPACE 2                                                                
DATA10   CLC   P+9(6),=C'ENDCOD'                                                
         BNE   DATA12              END OF BAL CODE                              
         MVI   CODESW,0                                                         
         B     XIT                                                              
         SPACE 2                                                                
DATA12   CLI   CODESW,1            BAL ACTIVATED                                
         BNE   DATA14                                                           
         BAS   R9,OUT               YES - PUT IT OUT                            
         B     XIT                                                              
         EJECT                                                                  
DATA14   CLC   P+9(4),=C'PROC'                                                  
         BNE   DATA16                                                           
         XC    CONTROL,CONTROL                                                  
         XC    SUBORD,SUBORD                                                    
         XC    ORDER,ORDER                                                      
DATA140  BAS   RE,SCAN                                                          
         CLI   KWLEN,0                                                          
         BE    DATA14X                                                          
         CLC   KEYWORD(7),=C'CONTROL'   SET CONTROL DSECT                       
         BNE   DATA142                                                          
         MVC   CONTROL,=C'    '                                                 
         ZIC   RE,OPLEN                                                         
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   CONTROL(0),OPERAND                                               
         B     DATA140                                                          
         SPACE 2                                                                
DATA142  CLC   KEYWORD(5),=C'ORDER'     SET PROCESSING ORDER                    
         BNE   DATA144                                                          
         LA    RE,ORDER                                                         
         LA    RF,OPERAND                                                       
         LA    R6,0                                                             
DATA142A CLI   0(RF),C'/'                                                       
         BNE   *+12                                                             
         LA    RF,1(RF)                                                         
         B     DATA142A                                                         
         CLI   0(RF),0                                                          
         BE    DATA140                                                          
         MVC   0(1,RE),0(RF)                                                    
         LA    R6,1(R6)                                                         
         STC   R6,1(RE)                                                         
         LA    RE,2(RE)                                                         
         LA    RF,1(RF)                                                         
         B     DATA142A                                                         
         SPACE 2                                                                
DATA144  CLC   KEYWORD(6),=C'SUBORD'    SET SUBORDINATE DSECTS                  
         BNE   DATA146                                                          
         OC    PRFRMDSP,PRFRMDSP                                                
         BZ    *+10                                                             
         MVC   SUBORD(4),=C'FORM'                                               
         LA    RE,SUBORD                                                        
         CLI   0(RE),0             FIND AN OPEN SLOT                            
         BE    *+12                                                             
         LA    RE,4(RE)                                                         
         B     *-12                                                             
         LR    R0,RE                                                            
         MVC   0(4,RE),=C'    '                                                 
         LA    RF,OPERAND                                                       
DATA144A CLI   0(RF),C'/'          FIND FIELD SEPARATOR                         
         BNE   DATA144B                                                         
         LA    RF,1(RF)                                                         
         CLI   0(RF),0                                                          
         BE    DATA140                                                          
         LR    R0,RE                                                            
DATA144B CLI   0(RF),0                                                          
         BE    DATA140                                                          
         CLI   0(RF),C'/'                                                       
         BE    DATA144C                                                         
         MVC   0(1,RE),0(RF)                                                    
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)                                                         
         B     DATA144B                                                         
DATA144C LR    RE,R0                                                            
         LA    RE,4(RE)                                                         
         MVC   0(4,RE),=C'    '                                                 
         B     DATA144A                                                         
DATA146  DS    0H                                                               
DATA14X  GOTO1 =V(PRINTER)                                                      
         BAS   RE,PROC                                                          
         B     XIT                                                              
         EJECT                                                                  
DATA16   CLC   P+9(5),=C'FORM '                                                 
         BNE   DATA18                                                           
         CLI   FORMHEAD,1                                                       
         BNE   DATA160                                                          
         MVC   TITLE,SPACES                                                     
         MVC   LINE,=PL2'99'                                                    
         MVC   TITLE(25),=C'FORMULA DEFINTION SECTION'                          
         MVI   FORMHEAD,0                                                       
DATA160  DS    0C                                                               
         CLI   FORMCONT,1          CONTINUATION                                 
         BE    DATA161                                                          
         LA    RE,POLIN                                                         
         LA    RF,500                                                           
         XCEF                                                                   
DATA161  DS    0H                                                               
         LA    RE,POLIN            FIND OPENING                                 
         CLI   0(RE),0                                                          
         BE    *+12                                                             
         LA    RE,1(RE)                                                         
         B     *-12                                                             
         MVI   FORMCONT,0                                                       
         LA    RF,P+15                                                          
DATA162  CLI   0(RF),C' '                                                       
         BE    DATA164                                                          
         MVC   0(1,RE),0(RF)                                                    
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)                                                         
         B     DATA162                                                          
         SPACE 2                                                                
DATA164  BCTR  RE,0                                                             
         CLI   0(RE),C','                                                       
         BNE   *+12                                                             
         MVI   FORMCONT,1                                                       
         B     XIT                                                              
         LA    RE,1(RE)                                                         
         MVI   0(RE),C' '                                                       
         GOTO1 =V(PRINTER)                                                      
         LA    RE,POLOUT                                                        
         LA    RF,500                                                           
         XCEF                                                                   
         GOTO1 =V(POLISH),PARAS,POLIN,POLOUT                                    
         MVC   P(132),POLOUT                                                    
         GOTO1 =V(PRINTER)                                                      
         MVI   P,0                                                              
         MVC   P(132),POLOUT+132                                                
         GOTO1 =V(PRINTER)                                                      
         L     RE,NEXTFORM         GET FORMULA START                            
         LA    RF,POLOUT                                                        
         LA    R6,4                                                             
         LA    RE,4(RE)            SPACE FOR NEXT FORMULA ADDRESS               
DATA166  MVC   0(1,RE),0(RF)                                                    
         LA    R6,1(R6)                                                         
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)                                                         
         CLI   0(RF),0                                                          
         BNE   DATA166                                                          
         MVI   FORMCONT,0                                                       
         L     RE,NEXTFORM                                                      
         LR    RF,RE                                                            
         AR    RE,R6                                                            
         LA    RE,1(RE)                                                         
         ST    RE,NEXTFORM                                                      
         MVC   0(4,RF),NEXTFORM                                                 
         B     XIT                                                              
         SPACE 2                                                                
DATA18   CLC   P+9(4),=C'END '                                                  
         BNE   DATA20                                                           
         L     RE,CURRDDEF                                                      
         LA    RE,14(RE)                                                        
         ST    RE,CURRDDEF                                                      
         B     XIT                                                              
         SPACE 2                                                                
DATA20   CLC   P+9(8),=C'FULLPRES' FULL FORMULA PRECISION                       
         BNE   DATA22               (DEFAULT IS TO HUNDREDS)                    
         MVI   CPRES,0                                                          
         B     XIT                                                              
         SPACE 2                                                                
DATA22   TM    P+15,X'F0'          ELEMENT CODE INPUT                           
         BNO   DATA22B                                                          
         MVI   ELEMSW,1                                                         
DATA22A  CLC   P+9(4),=C'ELEM'                                                  
         BNE   GENREC                                                           
         TM    P+15,X'F0'          NUMERIC                                      
         BNO   DATA22B              NO- GET FIELD NAME                          
         BAS   RE,SCAN                                                          
         BAS   R9,CNVB                                                          
         BNE   PRECERR                                                          
         MVC   CELEM,OPERAND+3     SET CURRENT ELEMENT CODE                     
DATA22B  BAS   RE,SCAN                                                          
         CLI   OPLEN,0             END OF CARD                                  
         BE    XIT                  GET NEXT                                    
         CLI   OPLEN,7                                                          
         BH    PRECERR                                                          
         L     RE,ELMPNT           SET POINTER                                  
         MVC   0(1,RE),CELEM        MOVE IN CURRENT ELEMENT                     
         LA    R1,OPERAND                                                       
         LA    R0,8                                                             
         CLI   0(R1),0             PAD WITH SPACES                              
         BNE   *+8                                                              
         MVI   0(R1),C' '                                                       
         LA    R1,1(R1)                                                         
         BCT   R0,*-16                                                          
         MVC   1(7,RE),OPERAND      MOVE IN FIELD NAME                          
         LA    RE,8(RE)                                                         
         ST    RE,ELMPNT                                                        
         B     DATA22B                                                          
         SPACE 2                                                                
         EJECT                                                                  
GENREC   MVC   SVCARD,P            SAVE CURRENT CARD                            
         MVC   P,SPACES                                                         
         MVI   ELEMSW,0            RESTORE ELEMENT STORE SWITCH                 
         L     R9,=V(ELEMA)                                                     
GENREC2  CLI   0(R9),0             END OF ELEMENT SAVE                          
         BE    GENREC3                                                          
         MVC   P+9(5),=C'FIELD'    CREATE WORK RECORD DSECT                     
         MVC   P+15(7),1(R9)                                                    
         BAS   RE,DATA                                                          
         GOTO1 =V(PRINTER)                                                      
         L     R8,CURRDDEF                                                      
         SH    R8,=H'14'                                                        
         USING DDEFDSCT,R8                                                      
         L     RE,CURMDISP         CREATE MASTER DISP TABLE                     
         USING MDISPD,RE                                                        
         MVC   MDELEM,0(R9)        ELEMENT CODE                                 
         MVC   MDNAME,1(R9)        DEMO NAME                                    
         MVC   MDPREC,DDPREC       PRECISION                                    
         LA    RE,MDLEN(RE)                                                     
         ST    RE,CURMDISP                                                      
         LA    R9,8(R9)                                                         
         B     GENREC2                                                          
         DROP  R8                                                               
         SPACE 2                                                                
* FINISH OFF MASTER DISPLACEMENT TABLE                                          
GENREC3  L     RE,=V(MDISP)                                                     
         ST    RE,CURMDISP                                                      
         MVI   CURREL,0                                                         
         MVI   CURRFNO,0                                                        
GENREC4  L     RE,CURMDISP                                                      
         CLI   0(RE),0                                                          
         BE    GENRECX                                                          
         CLC   CURREL,MDELEM                                                    
         BE    *+8                                                              
         MVI   CURRFNO,0                                                        
         MVC   CURREL,MDELEM                                                    
         MVC   MDFNO,CURRFNO                                                    
         ZIC   RF,CURRFNO                                                       
         LA    RF,1(RF)                                                         
         STC   RF,CURRFNO                                                       
         L     RF,=V(DCODES)                                                    
GENREC5  CLI   0(RF),X'FF'         FIND DEMO NUMBER                             
         BE    GENREC7                                                          
         CLC   MDNAME+1(6),0(RF)                                                
         BE    GENREC6                                                          
         LA    RF,7(RF)                                                         
         B     GENREC5                                                          
GENREC6  MVC   MDDNO,6(RF)                                                      
GENREC7  DS    0H'0'                                                            
         MVC   P+9(2),=C'DC'                                                    
         MVC   P+15(23),=C'C'' '',AL1(   ),X''      '' '                        
         LA    RF,P+15                                                          
         USING MDPLD,RF                                                         
         MVC   MDPLDNM,MDNAME                                                   
         ZIC   R1,MDELEM                                                        
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  MDPLENO,DUB+6(2)                                                 
         ZIC   R1,MDDNO                                                         
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  MDPLDNO,DUB+6(2)                                                 
         ZIC   R1,MDFNO                                                         
         OI    DUB+7,X'0F'                                                      
         UNPK  MDPLFNO,DUB+6(2)                                                 
         ZIC   R1,MDFNO                                                         
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  MDPLFNO,DUB+6(2)                                                 
         MVC   HALF,MDPREC                                                      
         LH    R1,HALF                                                          
         MVI   MDPLPRS,C'8'        SET FOR IMPLIED DECIMAL                      
         LTR   R1,R1                                                            
         BP    *+10                                                             
         LPR   R1,R1                                                            
         MVI   MDPLPRS,C'4'        SET FOR TRUNCATED DECIMAL                    
         STC   R1,MDPLPRS+1                                                     
         OI    MDPLPRS+1,X'F0'                                                  
         MVC   MDPLMOD,MDNAME                                                   
         LA    RE,MDLEN(RE)                                                     
         ST    RE,CURMDISP                                                      
         GOTO1 =V(PRINTER)                                                      
         DROP  RF                                                               
         B     GENREC4                                                          
*                                                                               
GENRECX  MVC   P(80),SVCARD                                                     
         MVI   ELEMSW,0                                                         
         L     RE,=V(ELEMA)                                                     
         ST    RE,ELMPNT                                                        
         L     RE,=V(MDISP)                                                     
         ST    RE,CURMDISP                                                      
         B     XIT                                                              
         EJECT                                                                  
* GENERATE CONVERSION CODE                                                      
PROC     NTR1                                                                   
         L     R4,=V(DSCTAREA)                                                  
PROC00   CLC   CONTROL,0(R4)                                                    
         BE    PROC00A                                                          
         LA    R4,14(R4)                                                        
         CLI   0(R4),0                                                          
         BNE   PROC00                                                           
         MVC   P(4),CONTROL                                                     
         MVC   P+5(23),=C'CONTROL DSECT NOT FOUND'                              
         GOTO1 =V(PRINTER)                                                      
         B     XIT                                                              
         SPACE 2                                                                
* CONTROL DSECT FOUND - PROCESS IT                                              
PROC00A  MVC   PDSECT,10(R4)                                                    
         MVC   PFILNAM,5(R4)                                                    
         MVC   CFILNAM,5(R4)       SAVE CONTROL FILE NAME                       
         MVI   FRSTFORM,1                                                       
         XC    CNTRCNT,CNTRCNT                                                  
         L     RE,=V(CONTROLC)                                                  
         L     RF,=F'9000'                                                      
         XCEF                                                                   
         SR    R5,R5                                                            
         L     RF,=V(CONTROLC)                                                  
         USING CNTLDSCT,RF                                                      
         L     R4,PDSECT           GET CONTROL DSECT                            
         USING DDEFDSCT,R4                                                      
PROC01   CLI   0(R4),0                                                          
         BE    PROC016                                                          
         LA    RE,ORDER                                                         
PROC012  CLC   0(1,RE),0(R4)       FIND SEQUENCE                                
         BE    PROC014                                                          
         MVI   CDSEQ,X'FF'                                                      
         LA    RE,2(RE)                                                         
         CLI   0(RE),0                                                          
         BNE   PROC012                                                          
         B     *+10                                                             
         SPACE 2                                                                
PROC014  MVC   CDSEQ,1(RE)         BUILD TO PORTION OF CONTROL                  
         MVC   CDNAM,DDNAM                                                      
         MVC   CDTDCDE,PFILNAM                                                  
         MVC   CDTFL,DDFL                                                       
         MVC   CDTDSP,DDDSP                                                     
         MVC   CDTFMT,DDFRMT                                                    
         MVC   CDTPREC,DDPREC                                                   
         LA    RF,22(RF)                                                        
         LA    R4,14(R4)                                                        
         L     R6,CNTRCNT                                                       
         LA    R6,1(R6)                                                         
         ST    R6,CNTRCNT                                                       
         B     PROC01                                                           
         SPACE 2                                                                
* SORT CONTROL TABLE INTO PROCESSING ORDER                                      
PROC016  L     R9,=V(CONTROLC)                                                  
         L     R6,CNTRCNT                                                       
         GOTO1 =V(XSORT),PARAS,(0,(R9)),(R6),22,1,0                             
         XC    SORDTAB(40),SORDTAB                                              
         LA    R4,SUBORD                                                        
         LA    R5,SORDTAB                                                       
         L     RF,=V(DSCTAREA)                                                  
PROC017  CLC   0(4,R4),0(RF)                                                    
         BE    PROC0172                                                         
         LA    RF,14(RF)                                                        
         CLI   0(RF),C' '                                                       
         BE    PROC017                                                          
         CLI   0(RF),0                                                          
         BNE   PROC017                                                          
         MVC   P(4),0(R4)                                                       
         MVC   P+5(22),=C'SUBORD DSECT NOT FOUND'                               
         GOTO1 =V(PRINTER)                                                      
         B     XIT                                                              
PROC0172 MVC   0(4,R5),10(RF)      SET DSECT ADDRESS                            
         MVC   0(1,R5),5(RF)       SET DSECT CODE                               
         LA    R4,4(R4)                                                         
         CLI   0(R4),0                                                          
         BE    PROC0174                                                         
         LA    R5,4(R5)                                                         
         XC    0(4,R5),0(R5)                                                    
         L     RF,=V(DSCTAREA)                                                  
         B     PROC017                                                          
         SPACE 2                                                                
PROC0174 LA    R5,SORDTAB          POINT R6 TO SUBORDINATE RECORD               
         L     R6,0(R5)                                                         
         DROP  RF                                                               
         DROP  R4                                                               
         LA    R6,0(R6)                                                         
         MVC   PFILNAM,0(R5)                                                    
         L     R4,=V(CONTROLC)                                                  
         USING CNTLDSCT,R4                                                      
         USING DDEFDSCT,R6                                                      
PROC018  CLC   1(7,R4),0(R6)       SAME FIELD                                   
         BE    PROC020             YES - SAVE IT                                
         LA    R6,14(R6)            NO - TRY NEXT                               
         CLI   0(R6),0             END                                          
         BNE   PROC018             NO - PROCESS NEXT                            
         LA    R5,4(R5)                                                         
         L     R6,0(R5)            TRY ANOTHER DSECT                            
         LA    R6,0(R6)                                                         
         MVC   PFILNAM,0(R5)                                                    
         OC    0(4,R5),0(R5)       END OF DSECTS                                
         BNZ   PROC018                                                          
PROC019  LA    R4,22(R4)            YES - TRY NEXT FIELD                        
         LA    R5,SORDTAB                                                       
         L     R6,0(R5)                                                         
         MVC   PFILNAM,0(R5)                                                    
         LA    R6,0(R6)                                                         
         CLI   0(R4),0             END OF CONTROL                               
         BNE   PROC018              NO - PROCESS NEXT CONTROL FIELD             
         B     PROC022              YES - TRY FORMULAS                          
PROC020  MVC   CDFDCDE,PFILNAM                                                  
         MVC   CDFFL,DDFL                                                       
         MVC   CDFDSP,DDDSP                                                     
         MVC   CDFFMT,DDFRMT                                                    
         MVC   CDFPREC,DDPREC                                                   
         B     PROC019                                                          
         EJECT                                                                  
* GET FORMULAS AND INSERT IN TABLE                                              
PROC022  DS    0H                                                               
         L     R4,=V(CONTROLC)                                                  
         CLI   0(R4),0             FIND END OF CONTROL TABLE                    
         BE    *+12                                                             
         LA    R4,22(R4)                                                        
         B     *-12                                                             
         ST    R4,FORMSTRT                                                      
         SPACE 2                                                                
* SCAN FOR UNDEFINED FIELDS                                                     
         L     R4,=V(CONTROLC)                                                  
PROC024  CLI   0(R4),0                                                          
         BE    PROC20              END OF CONTROL                               
         CLI   CDFDCDE,0           ALREADY PROCESSED                            
         BE    PROC025              NO - TRY FORMULA                            
PROC0242 LA    R4,22(R4)            YES - TRY NEXT                              
         B     PROC024                                                          
         SPACE 2                                                                
PROC025  L     R8,=V(FORMAREA)                                                  
PROC0251 OC    0(4,R8),0(R8)                                                    
         BZ    PROC0242                                                         
         LA    R9,4(R8)            FIND FORMULA FOR THIS FIELD                  
         ST    R9,STRTSCAN                                                      
         BAS   RE,SCAN                                                          
         MVC   DUB,SPACES                                                       
         ZIC   RE,OPLEN                                                         
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   DUB(0),OPERAND                                                   
         LA    RE,CURRFLST                                                      
         L     RF,=F'500'                                                       
         XCEF                                                                   
         CLC   1(7,R4),DUB         FORMULA OK                                   
         BE    PROC026              YES - SEE IF ALL FIELDS AVAILABLE           
PROC0252 L     R9,0(R8)             NO - TRY NEXT                               
         LR    R8,R9                                                            
         B     PROC0251                                                         
         SPACE 2                                                                
* MATCH FORMULA FIELDS TO SUBORDINATE DSECTS                                    
PROC026  BAS   RE,SCAN                                                          
         CLI   OPLEN,1             OPERATOR                                     
         BE    PROC026              YES - BYPASS                                
         CLI   OPLEN,0             END                                          
         BE    PROC028              YES - PROCESS FORMULA                       
         MVC   DUB,SPACES           NO - MATCH TO SUBORDINATE DSECT             
         ZIC   RE,OPLEN                                                         
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   DUB(0),OPERAND                                                   
         LA    R5,SORDTAB                                                       
         L     R6,0(R5)                                                         
         LA    R6,0(R6)                                                         
PROC0261 CLC   0(7,R6),DUB         FIELD FOUND                                  
         BE    PROC027              YES - TRY NEXT INPUT                        
         LA    R6,14(R6)            NO - TRY NEXT SUBORD                        
         CLI   0(R6),0                                                          
         BNE   PROC0261                                                         
         LA    R5,4(R5)                                                         
         L     R6,0(R5)                                                         
         LA    R6,0(R6)                                                         
         OC    0(4,R5),0(R5)       END OF SUBORD                                
         BZ    PROC0252             YES - TRY NEXT FORMULA                      
         B     PROC0261                                                         
* SAVE FIELDS TO BE CONVERTED FOR FORMULA                                       
PROC027  LA    RE,CURRFLST                                                      
         CLI   0(RE),0                                                          
         BE    *+12                                                             
         LA    RE,15(RE)                                                        
         B     *-12                                                             
         MVC   0(14,RE),0(R6)                                                   
         MVC   14(1,RE),0(R5)                                                   
         B     PROC026                                                          
         SPACE 2                                                                
PROC028  MVI   CDFDCDE,X'FF'       SET FORMULA FLAG                             
         ST    R8,FULL                                                          
         MVC   CDFDCDE+1(4),FULL                                                
         ST    R4,SVCONTRL                                                      
         MVC   PFILNAM,0(R5)                                                    
         LA    R6,CURRFLST                                                      
PROC0281 L     R4,FORMSTRT         SEE IF FIELD CONVERTED                       
         LA    RE,0                                                             
         L     RE,PRFRMDSP         GET PREVIOUS FORMULA DISPLACEMENT            
         SPACE 2                                                                
PROC0282 CLI   0(R4),0                                                          
         BE    PROC0283                                                         
         CLC   CDNAM,DDNAM         FIELD CONVERTED                              
         BE    PROC0284             YES - TRY NEXT FORMULA FIELD                
         LA    R4,22(R4)            NO - TRY NEXT CONVERTED FIELD               
         B     PROC0282                                                         
         SPACE 2                                                                
PROC0283 MVI   CDSEQ,X'FE'         BUILD TO INFO                                
         MVI   CDTDCDE,C'Z'                                                     
         MVC   CDNAM,DDNAM                                                      
         MVI   CDTFL,4                                                          
         L     RE,PRFRMDSP         GET DISPLACEMENT OF NEXT FIELD               
         STH   RE,HALF                                                          
         LA    RE,4(RE)            SET NEXT DISPLACEMENT                        
         ST    RE,PRFRMDSP                                                      
         MVC   CDTDSP,HALF                                                      
         MVI   CDTFMT,C'B'                                                      
         MVC   CDTPREC,=H'-2'                                                   
         CLI   0(R6),C'R'                                                       
         BNE   *+10                                                             
         MVC   CDTPREC,=H'1'                                                    
         CLI   CPRES,2                                                          
         BE    *+10                                                             
         MVC   CDTPREC,=H'0'                                                    
         MVC   CDFDCDE,14(R6)                                                   
         MVC   CDFFL,DDFL                                                       
         MVC   CDFDSP,DDDSP                                                     
         MVC   CDFFMT,DDFRMT                                                    
         MVC   CDFPREC,DDPREC                                                   
PROC0284 LA    R6,15(R6)           GET NEXT FORMULA FIELD                       
         CLI   0(R6),0                                                          
         BNE   PROC0281                                                         
         L     R4,SVCONTRL         RESTORE CONTROL POINTER                      
         LA    R4,22(R4)                                                        
         B     PROC024                                                          
         EJECT                                                                  
* GENERATE DSECT FOR FORMULAS                                                   
PROC20   OC    ZDSECT,ZDSECT       DO WE ALREADY HAVE A DSECT                   
         BNZ   PROC201              YES - ADD TO IT                             
         L     RE,NXTDSCT                                                       
         ST    RE,CURRDSCT                                                      
         LA    RE,14(RE)                                                        
         ST    RE,NXTDSCT                                                       
         L     RE,CURRDSCT                                                      
         ST    RE,ZDSECT                                                        
         MVC   0(4,RE),=C'FORM'                                                 
         MVI   5(RE),C'Z'                                                       
         L     RF,NXTFRMT                                                       
         LA    RF,1(RF)                                                         
         ST    RF,NXTFRMT                                                       
         MVC   6(4,RE),NXTFRMT                                                  
         ST    RF,CURRFRMT                                                      
         MVC   10(4,RE),CURRDDEF                                                
         XC    CURRDISP,CURRDISP                                                
PROC201  L     R4,=V(CONTROLC)                                                  
PROC202  CLI   0(R4),0             END                                          
         BE    PROC30                                                           
         CLI   CDTDCDE,C'Z'                                                     
         BE    *+12                                                             
         LA    R4,22(R4)                                                        
         B     PROC202                                                          
         L     R6,CURRDDEF                                                      
         MVC   DDNAM,CDNAM                                                      
         MVC   DDDSP,CDTDSP                                                     
         MVC   DDPREC,CDTPREC                                                   
         MVI   DDFL,4                                                           
         MVI   DDFRMT,C'B'                                                      
         LA    R6,14(R6)                                                        
         ST    R6,CURRDDEF                                                      
         LA    R4,22(R4)                                                        
         B     PROC202                                                          
         EJECT                                                                  
* GENERATE CONVERSION CODE                                                      
PROC30   L     R4,=V(CONTROLC)                                                  
         XC    CNTRCNT,CNTRCNT                                                  
         MVI   PREVFILE,0                                                       
         L     RE,=V(SORTAREA)                                                  
         ST    RE,FORMLIST                                                      
         L     RF,=F'40000'                                                     
         XCEF                                                                   
PROC301  CLI   0(R4),0                                                          
         BE    PROC301A                                                         
         MVC   0(1,R4),CDFDCDE                                                  
         CLI   CDFDCDE,0                                                        
         BNE   *+8                                                              
         MVI   0(R4),X'FF'                                                      
         L     R6,CNTRCNT                                                       
         LA    R6,1(R6)                                                         
         ST    R6,CNTRCNT                                                       
         LA    R4,22(R4)                                                        
         B     PROC301                                                          
PROC301A L     R9,=V(CONTROLC)                                                  
         GOTO1 =V(XSORT),PARAS,(0,(R9)),(R6),22,1,0                             
         L     R4,=V(CONTROLC)                                                  
PROC302  CLI   0(R4),0                                                          
         BE    PROC3021                                                         
         CLC   PREVFILE,0(R4)                                                   
         BE    PROC301B                                                         
         CLI   PREVFILE,0                                                       
         BE    PROC302E                                                         
         CLI   PREVFILE,X'FF'                                                   
         BE    PROC3021                                                         
         MVC   P+9(8),=C'XMOD1 1 '                                              
         BAS   R9,OUT                                                           
         MVC   P+9(8),=C'SPACE 2 '                                              
         BAS   R9,OUT                                                           
         L     R9,=A(STACK4)                                                    
         MVC   7(1,R9),PREVFILE                                                 
         MVI   CTYPE,C'8'                                                       
         BAS   RE,OUTSTK                                                        
         L     R8,=V(SORTAREA)                                                  
         B     PROC302A                                                         
PROC3021 MVC   P+9(08),=C'XMOD1 1 '                                             
         BAS   R9,OUT                                                           
         L     R8,=V(SORTAREA)                                                  
PROC302A CLI   0(R8),0                                                          
         BE    PROC302D                                                         
         CLI   0(R8),6             MVC WORD OUTPUT                              
         BE    *+8                                                              
         CLI   0(R8),5             LABEL                                        
         BNE   PROC302B                                                         
         CLI   FRSTFORM,1          FIRST FORMULA FOR THIS SECTION               
         BNE   PR302AA              YES - SET TO START                          
         MVC   P(17),=C'$.YFEND  DS    0H'                                      
         BAS   R9,OUT                                                           
         MVI   FRSTFORM,0                                                       
         B     PR302AB                                                          
* SET END OF PREVIOUS FORMULA                                                   
PR302AA  DS    0C                                                               
         MVC   P+9(23),=C'DC    AL1(2),C''='',H''0'' '                          
         BAS   R9,OUT                                                           
         MVC   P+9(19),=C'DC    X''FF'',AL3(0) '                                
         BAS   R9,OUT                                                           
PR302AB  MVC   P(18),=C'FR**     DS    0F '                                     
         MVC   HALF,3(R8)                                                       
         LH    R9,HALF                                                          
         CVD   R9,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+2(2),DUB+6(2)                                                  
         LA    R8,5(R8)                                                         
         MVC   P+9(34),=C'DC    AL1(1),AL1(5),AL2(C000-C000)  '                 
         CLI   HALF,6                                                           
         BNE   *+8                                                              
         MVI   P+19,C'3'           SET HALF WORD OUTPUT                         
         MVC   P+33(4),1(R8)                                                    
         MVC   P+38(1),1(R8)                                                    
         BAS   R9,OUT                                                           
         LA    R8,5(R8)                                                         
         B     PROC302A                                                         
PROC302B CLI   0(R8),1                                                          
         BNE   PROC302C                                                         
         MVC   P+9(34),=C'DC    AL1(1),AL1(1),AL2(Z000-Z000) '                  
         MVC   P+33(4),1(R8)                                                    
         MVC   P+38(1),1(R8)                                                    
         CLI   1(R8),C'Y'                                                       
         BNE   *+8                                                              
         MVI   P+26,C'4'           FLAG CONSTANT                                
         BAS   R9,OUT                                                           
         LA    R8,5(R8)                                                         
         B     PROC302A                                                         
PROC302C CLI   0(R8),2                                                          
         BNE   PROC302D                                                         
         MVC   P+9(23),=C'DC    AL1(2),C''*'',H''0'' '                          
         MVC   P+24(1),1(R8)                                                    
         BAS   R9,OUT                                                           
         LA    R8,5(R8)                                                         
         B     PROC302A                                                         
PROC302D L     R8,=V(SORTAREA)                                                  
         CLI   0(R8),0                                                          
         BE    PROC302E                                                         
* END OF FORMULAS FOR THIS SECTION                                              
         MVC   P+9(23),=C'DC    AL1(2),C''='',H''0'' '                          
         BAS   R9,OUT                                                           
         MVC   P+9(19),=C'DC    X''FF'',AL3(0) '                                
         BAS   R9,OUT                                                           
         MVC   P+9(12),=C'DC    X''FF'' '                                       
         BAS   R9,OUT                                                           
PROC302E DS    0H                                                               
         MVC   P+9(5),=C'LTORG'                                                 
         BAS   R9,OUT                                                           
         MVC   P+9(5),=C'EJECT'                                                 
         BAS   R9,OUT                                                           
         CLI   0(R4),0                                                          
         BE    PRTSRC                                                           
         MVC   PREVFILE,0(R4)                                                   
         CLI   PREVFILE,X'FF'                                                   
         BE    *+10                                                             
         MVC   OVRFILE,PREVFILE    SET FOR PROC FILE                            
         MVC   P(14),=C'*.PROC   CSECT'                                         
         MVC   P(1),PREVFILE                                                    
         CLI   PREVFILE,X'FF'                                                   
         BNE   *+16                                                             
         MVC   P(14),=C'$*.PROC  CSECT'                                         
         MVC   P+1(1),PHSW                                                      
         BAS   R9,OUT                                                           
         MVC   P+9(14),=C'NMOD1 0,*.PROC'                                       
         MVC   P+17(1),PREVFILE                                                 
         CLI   PREVFILE,X'FF'                                                   
         BNE   *+16                                                             
         MVC   P+9(15),=C'NMOD1 0,$*.PROC'                                      
         MVC   P+18(1),PHSW                                                     
         BAS   R9,OUT                                                           
         MVC   P+9(14),=C'USING *DSCT,R6  '                                     
         MVC   P+15(1),CDTDCDE                                                  
         BAS   R9,OUT                                                           
         MVC   P+9(14),=C'USING *DSCT,R7  '                                     
         MVC   P+15(1),0(R4)                                                    
         CLI   P+15,X'FF'                                                       
         BNE   *+8                                                              
         MVI   P+15,C'Z'                                                        
         BAS   R9,OUT                                                           
         CLI   PREVFILE,X'FF'                                                   
         BE    PROC302F                                                         
         MVC   P+9(14),=C'USING ZDSCT,R5 '                                      
         BAS   R9,OUT                                                           
         MVC   P+9(12),=C'LR    R2,RB '                                         
         BAS   R9,OUT                                                           
         MVC   P+9(18),=C'LA    R2,2048(RB) '                                   
         BAS   R9,OUT                                                           
         MVC   P+9(18),=C'LA    R2,2048(R2) '                                   
         BAS   R9,OUT                                                           
         MVC   P+9(21),=C'USING *.PROC+4096,R2  '                               
         MVC   P+15(1),PREVFILE                                                 
         BAS   R9,OUT                                                           
         B     PROC301B                                                         
PROC302F MVC   P+9(12),=C'LR    R2,RB '                                         
         BAS   R9,OUT                                                           
         MVC   P+9(18),=C'LA    R2,2048(RB) '                                   
         BAS   R9,OUT                                                           
         MVC   P+9(18),=C'LA    R2,2048(R2) '                                   
         BAS   R9,OUT                                                           
         MVC   P+9(21),=C'USING $*.PROC+4096,R2 '                               
         MVI   FRSTFORM,1                                                       
         MVC   P+16(1),PHSW                                                     
         BAS   R9,OUT                                                           
         MVI   CTYPE,C'7'                                                       
         BAS   RE,OUTSTK                                                        
PROC301B DS    0H                                                               
         CLI   CDFDCDE,0                                                        
         BNE   *+12                                                             
         LA    R4,22(R4)                                                        
         B     PROC302                                                          
         CLI   CDFDCDE,X'FF'                                                    
         BE    PROC40                                                           
         MVC   FFRMT,CDFFMT                                                     
         MVC   TFRMT,CDTFMT                                                     
         MVC   TO(1),CDTDCDE                                                    
         MVC   HALF,CDTDSP                                                      
         LH    RF,HALF                                                          
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  TO+1(4),DUB+5(3)                                                 
         MVC   HALF,CDFDSP                                                      
         LH    RF,HALF                                                          
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  FROM+1(4),DUB+5(3)                                               
         MVC   FROM(1),CDFDCDE                                                  
         MVC   P(132),SPACES                                                    
         MVI   P,C'*'                                                           
         MVC   P+2(7),CDNAM                                                     
         BAS   R9,OUT                                                           
         MVC   HALF,CDTPREC        GET PRECISION DEF                            
         LH    RF,HALF                                                          
         MVC   HALF,CDFPREC                                                     
         SH    RF,HALF                                                          
         STH   RF,DEC                                                           
         CLC   CONVFMT,=C'BN'                                                   
         BNE   *+8                                                              
         BAS   RE,CTOB                                                          
         CLC   CONVFMT,=C'BC'                                                   
         BNE   *+8                                                              
         BAS   RE,CTOB                                                          
         CLC   CONVFMT,=C'BP'                                                   
         BNE   *+8                                                              
         BAS   RE,PTOB                                                          
         CLC   CONVFMT,=C'BB'                                                   
         BNE   *+8                                                              
         BAS   RE,BTOB                                                          
         CLC   CONVFMT,=C'CC'                                                   
         BNE   PROC304                                                          
         CLC   CDFFL,CDTFL                                                      
         BNH   *+10                                                             
         MVC   CONVFMT,=C'C2'                                                   
PROC304  CLC   CONVFMT,=C'CC'                                                   
         BNE   *+8                                                              
         BAS   RE,CTOC                                                          
         CLC   CONVFMT,=C'C2'                                                   
         BNE   *+8                                                              
         BAS   RE,CTOC2                                                         
         LA    R4,22(R4)                                                        
         B     PROC302                                                          
* MATCH FORMULAS TO Z DSECT AND GENERATE STACK LIST                             
PROC40   MVC   FULL,CDFDCDE+1      GET FORMULA ADDRESS                          
         L     R6,FULL                                                          
         LA    R9,4(R6)                                                         
         ST    R9,STRTSCAN                                                      
         BAS   RE,SCAN                                                          
         MVC   P+2(7),OPERAND                                                   
         MVI   P,C'*'                                                           
         BAS   R9,OUT                                                           
         ST    R4,SVCONTRL                                                      
         L     R4,=V(CONTROLC)                                                  
         ZIC   RE,OPLEN                                                         
         BCTR  RE,0                                                             
PROC41   CLI   0(R4),0                                                          
         BE    PROC40X                                                          
         EX    RE,*+8              FIND FORM FIELD                              
         B     *+10                                                             
         CLC   1(0,R4),OPERAND                                                  
         BE    *+12                                                             
         LA    R4,22(R4)                                                        
         B     PROC41                                                           
         SPACE 2                                                                
         MVC   TO(1),CDTDCDE                                                    
         MVC   HALF,CDTDSP                                                      
         LH    R9,HALF                                                          
         CVD   R9,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  TO+1(4),DUB+5(3)                                                 
         L     R9,FORMLIST                                                      
         LH    RE,FORMCNT                                                       
         LA    RE,1(RE)                                                         
         STH   RE,FORMCNT                                                       
         MVI   0(R9),X'05'                                                      
         CLI   CDTFL,2                                                          
         BNE   *+8                                                              
         MVI   0(R9),X'06'         SET FOR HALF WORD OUTPUT                     
         MVC   1(2,R9),=C'FR'                                                   
         MVC   3(2,R9),FORMCNT                                                  
         MVC   P+9(13),=C'LA    R8,FR** '                                       
         CVD   RE,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+20(2),DUB+6(2)                                                 
         LA    R9,5(R9)                                                         
         ST    R9,FORMLIST                                                      
         BAS   R9,OUT                                                           
         L     R8,FORMLIST                                                      
         MVI   0(R8),1             SET TO FIELD                                 
         MVC   1(4,R8),TO                                                       
         LA    R8,5(R8)                                                         
         ST    R8,FORMLIST                                                      
         MVC   P+9(24),=C'GOTO1 VDEMCALC,DUB,(R8) '                             
         BAS   R9,OUT                                                           
         SPACE 2                                                                
PROC402  BAS   RE,SCAN             GET OPERANDS                                 
         CLI   OPLEN,0             END                                          
         BE    PROC40X                                                          
         CLI   OPLEN,1             OPERATOR                                     
         BE    PROC403                                                          
         TM    OPERAND,X'F0'       NUMERIC                                      
         BO    PROC404                                                          
         L     RF,ZDSECT                                                        
         MVC   FULL,10(RF)                                                      
         L     RF,FULL                                                          
PROC4021 ZIC   RE,OPLEN            FIND FIELD IN Z DSECT                        
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         CLC   OPERAND(0),0(RF)                                                 
         BE    *+12                                                             
         LA    RF,14(RF)                                                        
         B     PROC4021                                                         
         MVI   TO,C'Z'                                                          
         MVC   HALF,7(RF)                                                       
         LH    R9,HALF                                                          
         CVD   R9,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  TO+1(4),DUB+5(3)                                                 
         L     R8,FORMLIST                                                      
         MVI   0(R8),1                                                          
         MVC   1(4,R8),TO                                                       
         LA    R8,5(R8)                                                         
         ST    R8,FORMLIST                                                      
         B     PROC402                                                          
         SPACE 2                                                                
PROC403  L     R8,FORMLIST                                                      
         MVI   0(R8),2                                                          
         MVC   1(1,R8),OPERAND                                                  
         LA    R8,5(R8)                                                         
         ST    R8,FORMLIST                                                      
         B     PROC402                                                          
         SPACE 2                                                                
* NUMERIC FIELD - USE IT                                                        
PROC404  B     PROC403                                                          
PROC40X  L     R4,SVCONTRL                                                      
         LA    R4,22(R4)                                                        
         B     PROC302                                                          
         EJECT                                                                  
* PRINT DATA SOURCES FOR CONTROL RECORD                                         
PRTSRC   L     R4,=V(CONTROLC)                                                  
         MVC   TITLE,SPACES                                                     
         MVC   LINE,=PL2'99'                                                    
         MVC   TITLE(29),=C'CONTROL RECORD SOURCE SECTION'                      
PRTSRC1  CLI   0(R4),0                                                          
         BE    PRTSRCX                                                          
         MVC   P(7),1(R4)                                                       
         MVC   P+10(8),=C'DIRECT  '                                             
         CLI   CDFDCDE,0                                                        
         BNE   *+10                                                             
         MVC   P+10(8),=C'NOT USED'                                             
         CLI   CDFDCDE,X'FF'                                                    
         BNE   *+10                                                             
         MVC   P+10(8),=C'FORMULA '                                             
         GOTO1 =V(PRINTER)                                                      
         LA    R4,22(R4)                                                        
         B     PRTSRC1                                                          
PRTSRCX  DS    0H                                                               
         MVC   P+9(5),=C'LTORG'                                                 
         BAS   R9,OUT                                                           
         MVC   P+9(5),=C'EJECT'                                                 
         BAS   R9,OUT                                                           
         B     XIT                                                              
         EJECT                                                                  
* CONVERT CHARACTER TO BINARY                                                   
CTOB     NTR1                                                                   
         MVC   P(132),SPACES                                                    
         MVC   P+09(30),=C'TM    *****+(L''*****-1),X''F0'' '                   
         MVC   P+15(5),FROM                                                     
         MVC   P+24(5),FROM                                                     
         BAS   R9,OUT                                                           
         MVC   P+09(11),=C'BO    *+10 '                                         
         BAS   R9,OUT                                                           
         MVC   P+09(20),=C'MVC   *****,=16C''0'' '                              
         MVC   P+15(5),FROM                                                     
         BAS   R9,OUT                                                           
         MVC   P+09(16),=C'PACK  DUB,***** '                                    
         MVC   P+19(5),FROM                                                     
         BAS   R9,OUT                                                           
         MVC   P+09(13),=C'CVB   RF,DUB '                                       
         BAS   R9,OUT                                                           
         OC    DEC,DEC                                                          
         BZ    CTOB1                                                            
         MVC   P+9(18),=C'MVC   HALF,=H''0*'' '                                 
         LH    RE,DEC                                                           
         MVI   P+23,C'-'                                                        
         LTR   RE,RE                                                            
         BM    *+8                                                              
         MVI   P+23,C'0'                                                        
         LPR   RE,RE                                                            
         STC   RE,P+24                                                          
         OI    P+24,X'F0'                                                       
         BAS   R9,OUT                                                           
         MVC   P+9(17),=C'BAL   R9,PRECIS .'                                    
         MVC   P+24(1),FROM                                                     
         BAS   R9,OUT                                                           
CTOB1    MVC   P+9(14),=C'ST    RF,FULL '                                       
         BAS   R9,OUT                                                           
         MVC   P+9(29),=C'MVC   *****,FULL+(4-L''*****) '                       
         MVC   P+15(5),TO                                                       
         MVC   P+31(5),TO                                                       
         BAS   R9,OUT                                                           
         B     XIT                                                              
         EJECT                                                                  
CTOC     NTR1                                                                   
         MVC   P(132),SPACES                                                    
         MVC   P+9(18),=C'MVC   *****,***** '                                   
         MVC   P+15(5),TO                                                       
         MVC   P+21(5),FROM                                                     
         BAS   R9,OUT                                                           
         B     XIT                                                              
         EJECT                                                                  
         SPACE 2                                                                
CTOC2    NTR1                                                                   
         MVC   P(132),SPACES                                                    
         MVC   P+9(19),=C'MVC   *****,SPACES '                                  
         MVC   P+15(5),TO                                                       
         BAS   R9,OUT                                                           
         MVC   P+9(29),=C'MVC   *****(L''*****-1),***** '                       
         MVC   P+15(5),TO                                                       
         MVC   P+23(5),FROM                                                     
         MVC   P+32(5),FROM                                                     
         BAS   R9,OUT                                                           
         B     XIT                                                              
         SPACE 2                                                                
BTOB     NTR1                                                                   
         MVC   P(132),SPACES                                                    
         MVC   P+9(17),=C'XC    *****,*****'                                    
         MVC   P+15(5),TO                                                       
         MVC   P+21(5),TO                                                       
         BAS   R9,OUT                                                           
         OC    DEC,DEC                                                          
         BZ    BTOB1                                                            
         MVC   P+9(18),=C'MVC   HALF,=H''0*'' '                                 
         LH    RE,DEC                                                           
         MVI   P+23,C'-'                                                        
         LTR   RE,RE                                                            
         BM    *+8                                                              
         MVI   P+23,C'0'                                                        
         LPR   RE,RE                                                            
         STC   RE,P+24                                                          
         OI    P+24,X'F0'                                                       
         BAS   R9,OUT                                                           
         MVC   P+9(17),=C'BAL   R9,PRECIS .'                                    
         MVC   P+24(1),FROM                                                     
         BAS   R9,OUT                                                           
BTOB1    DS    0H                                                               
  MVC   P+9(44),=C'MVC *****+(L''*****-L''*****)(L''*****),*****'               
         MVC   P+13(5),TO                                                       
         MVC   P+22(5),TO                                                       
         MVC   P+30(5),FROM                                                     
         MVC   P+39(5),FROM                                                     
         MVC   P+46(5),FROM                                                     
         BAS   R9,OUT                                                           
         B     XIT                                                              
         SPACE                                                                  
         EJECT                                                                  
* CONVERT PACKED TO BINARY                                                      
PTOB     NTR1                                                                   
         MVC   P+9(30),=C'TM    *****+(L''*****-1),X''08'' '                    
         MVC   P+15(5),FROM                                                     
         MVC   P+24(5),FROM                                                     
         BAS   R9,OUT                                                           
         MVC   P+9(11),=C'BO    *+14 '                                          
         BAS   R9,OUT                                                           
         MVC   P+9(18),=C'XC    *****,***** '                                   
         MVC   P+15(5),FROM                                                     
         MVC   P+21(5),FROM                                                     
         BAS   R9,OUT                                                           
         MVC   P+9(30),=C'OI    *****+(L''*****-1),X''0F'' '                    
         MVC   P+15(5),FROM                                                     
         MVC   P+24(5),FROM                                                     
         BAS   R9,OUT                                                           
         MVC   P+9(16),=C'ZAP   DUB,***** '                                     
         MVC   P+19(5),FROM                                                     
         BAS   R9,OUT                                                           
         MVC   P+9(13),=C'CVB   RF,DUB '                                        
         BAS   R9,OUT                                                           
         OC    DEC,DEC                                                          
         BZ    PTOB1                                                            
         MVC   P+9(18),=C'MVC   HALF,=H''0*'' '                                 
         LH    RE,DEC                                                           
         MVI   P+23,C'-'                                                        
         LTR   RE,RE                                                            
         BM    *+8                                                              
         MVI   P+23,C'0'                                                        
         LPR   RE,RE                                                            
         STC   RE,P+24                                                          
         OI    P+24,X'F0'                                                       
         BAS   R9,OUT                                                           
         MVC   P+9(17),=C'BAL   R9,PRECIS .'                                    
         MVC   P+24(1),FROM                                                     
         BAS   R9,OUT                                                           
PTOB1    MVC   P+9(14),=C'ST    RF,FULL '                                       
         BAS   R9,OUT                                                           
         MVC   P+9(29),=C'MVC   *****,FULL+(4-L''*****) '                       
         MVC   P+15(5),TO                                                       
         MVC   P+31(5),TO                                                       
         BAS   R9,OUT                                                           
         B     XIT                                                              
         EJECT                                                                  
OUT      MVC   C,P                                                              
         CLI   CODESW,1            ACCEPT CODE AS IS                            
         BE    OUT4                                                             
*                                                                               
         LA    R0,80               FIX UP FILE NAMES                            
         LA    R1,C                                                             
OUT2     CLI   0(R1),C'$'                                                       
         BNE   *+10                                                             
         MVC   0(1,R1),OVRFILE                                                  
         LA    R1,1(R1)                                                         
         BCT   R0,OUT2                                                          
         LA    R0,80                                                            
         LA    R1,C                                                             
OUT3     CLI   0(R1),C'.'                                                       
         BNE   *+10                                                             
         MVC   0(1,R1),CFILNAM                                                  
         LA    R1,1(R1)                                                         
         BCT   R0,OUT3                                                          
*                                                                               
OUT4     CLI   DSCTSW,1            SEND TO BAL SOURCE FILE                      
         BE    *+10                                                             
         MVC   P(132),SPACES                                                    
         MVC   IOA(80),C                                                        
         PUT   RPL=OUTRPL                                                       
*        MVC   P(80),C                      TESTING ONLY                        
*        MVC   P+81(3),=C'OUT'                                                  
*        GOTO1 =V(PRINTER)                                                      
*        MVC   P(132),SPACES                                                    
         CLI   DSCTSW,1                                                         
         BNER  R9                                                               
         CLI   P,C'*'                                                           
         BER   R9                                                               
         CLC   P+9(5),=C'EJECT'                                                 
         BER   R9                                                               
         CLC   P+9(5),=C'LTORG'                                                 
         BER   R9                                                               
         GOTO1 =V(PRINTER)                                                      
         BR    R9                                                               
         SPACE 2                                                                
PRECERR  EDIT  ERROR,(3,P+82)                                                   
         BAS   R9,OUT                                                           
         GOTO1 =V(PRINTER)                                                      
         B     XIT                                                              
         EJECT                                                                  
*              ROUTINES FOR OUTPUT PHASE                                        
         SPACE 3                                                                
OUTPUT   BAS   RE,BLDDSCT                                                       
         MVI   DSCTSW,0                                                         
         MVI   CTYPE,C'9'                                                       
         BAS   RE,OUTSTK                                                        
         ENDREQ RPL=OUTRPL                                                      
         LA    R8,OUTRPL                                                        
         USING IFGRPL,R8                                                        
         L     R7,RPLRBAR          JOB NUMBER                                   
         CLOSE (IRDR)                                                           
         XBASE                                                                  
         SPACE 2                                                                
XIT      XIT1                                                                   
OUTSTK   NTR1                                                                   
         L     R6,=V(STACK)                                                     
OUTSTK1  CLI   0(R6),X'FF'                                                      
         BE    OUTSTKX                                                          
         CLC   CTYPE,0(R6)                                                      
         BNE   OUTSTK2                                                          
         MVC   P(80),1(R6)                                                      
         BAS   R9,OUT                                                           
OUTSTK2  LA    R6,81(R6)                                                        
         B     OUTSTK1                                                          
OUTSTKX  XIT                                                                    
         EJECT                                                                  
SCAN     NTR1                                                                   
         L     RE,STRTSCAN                                                      
         IC    RF,0(RE)            FORCE PROTECTION CHECK                       
         STC   RF,0(RE)                                                         
         XC    SCANWRK,SCANWRK                                                  
SCAN1    SR    R6,R6                                                            
         LA    R4,OPERAND                                                       
SCAN2    CLI   0(RE),C'='          DEFINE PREV AS KEYWORD                       
         BE    SCAN3                                                            
         CLI   0(RE),C' '          DEFINE PREV AS OPERAND                       
         BE    SCANX                                                            
         CLI   0(RE),C','          DEFINE PREV AS OPERAND                       
         BE    SCANX                                                            
         MVC   0(1,R4),0(RE)                                                    
         LA    R6,1(R6)                                                         
         STC   R6,OPLEN                                                         
         C     R6,=F'20'                                                        
         BL    *+6                                                              
         DC    H'0'                                                             
         LA    R4,1(R4)                                                         
         LA    RE,1(RE)                                                         
         B     SCAN2                                                            
         SPACE 2                                                                
SCAN3    MVC   KWLEN,OPLEN         FOUND = MUST BE KEYWORD                      
         L     RE,STRTSCAN                                                      
         ZIC   RF,KWLEN                                                         
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   KEYWORD(0),0(RE)                                                 
         LA    RE,1(RE,RF)                                                      
         ST    RE,STRTSCAN                                                      
         XC    OPLEN(21),OPLEN                                                  
         B     SCAN1                                                            
         SPACE 2                                                                
SCANX    STC   R6,OPLEN                                                         
         LA    RE,1(RE)                                                         
         ST    RE,STRTSCAN                                                      
         XIT1                                                                   
         SPACE 2                                                                
CNVB     ZIC   RE,OPLEN                                                         
         LA    RF,OPERAND                                                       
         MVI   SW1,0                                                            
CNVB1    TM    0(RF),X'F0'             CHECK FOR NUMERIC FIELD                  
         BO    *+10                                                             
         CLI   SW1,1               ERROR                                        
         BR    R9                                                               
         LA    RF,1(RF)                                                         
         BCT   RE,CNVB1                                                         
         ZIC   RE,OPLEN            CONVERT TO BINARY                            
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         PACK  DUB,OPERAND(0)                                                   
         XC    OPERAND,OPERAND                                                  
         CVB   RF,DUB                                                           
         ST    RF,FULL                                                          
         MVC   OPERAND(4),FULL                                                  
         BR    R9                                                               
DPRCERR  EQU   01                                                               
DFMTERR  EQU   02                                                               
DLENERR  EQU   03                                                               
FIDERR   EQU   04                                                               
DESCERR  EQU   5                                                                
FLDERR   EQU   16                                                               
         DROP  R6                                                               
         EJECT                                                                  
BLDDSCT  NTR1                                                                   
         L     R6,=V(DSCTAREA)                                                  
         MVI   DSCTSW,1                                                         
BLDSCT1  CLI   0(R6),0                                                          
         BE    XIT                                                              
         MVC   PFILNAM,5(R6)                                                    
         MVC   PDSECT,10(R6)                                                    
         MVC   TITLE,SPACES                                                     
         MVC   LINE,=PL2'99'                                                    
         MVC   TITLE(4),0(R6)                                                   
         MVC   TITLE+5(21),=C'RECORD LAYOUT SECTION'                            
         L     R5,PDSECT                                                        
         USING DDEFDSCT,R5                                                      
        MVC   P(4),=C'    '                                                     
         MVC   P+9(5),=C'LTORG'                                                 
         BAS   R9,OUT                                                           
         MVC   P+9(5),=C'EJECT'                                                 
         BAS   R9,OUT                                                           
         MVC   P(16),=C'ADSCT    DSECT  '                                       
         MVC   P(1),PFILNAM                                                     
         BAS   R9,OUT                                                           
         OC    DDDSP,DDDSP                                                      
         BZ    BLDSCT1A                                                         
         MVC   P(18),=C'*0000    DS    0C '                                     
         MVC   P(1),PFILNAM                                                     
         BAS   R9,OUT                                                           
BLDSCT1A DS    0C                                                               
         MVC   P+9(8),=C'ORG   *+'                                              
        MVC   HALF,DDDSP                                                        
         LH    R8,HALF                                                          
         LTR   R8,R8                                                            
         BZ    *+6                                                              
         BCTR  R8,0                                                             
         CVD   R8,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+17(4),DUB+5(3)                                                 
         BAS   R9,OUT                                                           
         SPACE 2                                                                
BLDSCT2  CLI   0(R5),0                                                          
         BE    BLDSCT3                                                          
         MVC   P+35(7),DDNAM                                                    
         MVC   P+9(2),=C'DS'                                                    
         MVC   P+15(2),=C'CL'                                                   
         ZIC   R8,DDFL                                                          
         CVD   R8,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+17(4),DUB+5(3)                                                 
         MVC   HALF,DDDSP                                                       
         LH    R8,HALF                                                          
         CVD   R8,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+1(4),DUB+5(3)                                                  
         MVC   P(1),PFILNAM                                                     
         BAS   R9,OUT                                                           
         LA    R5,14(R5)                                                        
         B     BLDSCT2                                                          
         SPACE 2                                                                
BLDSCT3  LA    R6,14(R6)                                                        
         B     BLDSCT1                                                          
         LTORG                                                                  
         EJECT                                                                  
*              CONSTANTS, WORK AREAS                                            
         SPACE 3                                                                
DUB      DS    D                                                                
WORK     DS    CL32                                                             
PARAS    DS    6F                                                               
DMPLIST  DS    0F                  STXITER LIST                                 
         DC    V(REGSAVE),V(XSORT)                                              
DL1      DC    V(DEMGEN),V(STXEND)                                              
         ORG   *-4                                                              
         DC    X'80'                                                            
FULL     DS    F                                                                
HALF     DS    H                                                                
FORMCNT  DS    H                   FORMULA COUNTER                              
FORMLIST DS    F                                                                
PRFRMDSP DC    F'0'                                                             
PANNAME  DC    CL10' '                                                          
CTYPE    DS    C                                                                
FORMHEAD DC    X'01'                                                            
PHSW     DS    C                                                                
OVRFILE  DS    C                                                                
CFILNAM  DS    C                   CONTROL FILE NAME                            
FRSTFORM DS    C                                                                
CELEM    DS    C                                                                
CURREL   DS    C                                                                
CURRFNO  DS    C                                                                
ELEMSW   DS    C                                                                
ELMPNT   DS    F                   ELEMENT TABLE POINTER                        
CURMDISP DS    F                   MASTER DISPLACEMENT POINTER                  
CSEQ     DC    F'0'                                                             
C        DS    CL80                                                             
SVCARD   DS    CL80                                                             
COUNT    DC    F'1'                                                             
DSCTSW   DC    X'00'                                                            
SCANWRK  DS    CL42                                                             
         ORG   SCANWRK                                                          
KWLEN    DS    CL1                                                              
KEYWORD  DS    CL20                                                             
         SPACE 2                                                                
OPLEN    DS    CL1                                                              
OPERAND  DS    CL20                                                             
CURRDCDE DS    F                                                                
CURRDDEF DS    F                                                                
CURRDISP DS    F                                                                
CURRDSCT DS    F                                                                
CURRFRMT DS    F                                                                
NXTDCODE DS    F                                                                
NXTDSCT  DS    F                                                                
NXTFRMT  DS    F                                                                
FORMSTRT DS    F                                                                
SORDTAB  DS    10F                 LIST OF SUBORDINATE DSECT ADDRESSES          
DEC      DS    H                                                                
STRTSCAN DS    F                                                                
ERROR    DS    C                                                                
SW1      DS    C                                                                
OPTYP    DS    C                                                                
FORMAT   DS    CL8                                                              
         ORG   FORMAT                                                           
FDIDLN   DS    CL1                                                              
FDID     DS    CL1                                                              
FDFRMT   DS    CL1                                                              
         DS    CL1                                                              
FDPREC   DS    CL2                                                              
FDLEN    DS    CL2                                                              
CONTROL  DS    CL4                                                              
SUBORD   DS    CL28                                                             
ORDER    DS    CL40                                                             
CODESW   DS    CL1                                                              
FORMCONT DS    CL1                                                              
POLIN    DS    CL500                                                            
POLOUT   DS    CL500                                                            
NEXTFORM DS    F                                                                
PDSECT   DS    F                                                                
PFILNAM  DS    C                                                                
PREVFILE DS    C                                                                
ZDSECT   DS    F                                                                
CNTRCNT  DS    F                                                                
SVCONTRL DS    F                                                                
CONVFMT  DS    0CL2                                                             
TFRMT    DS    CL1                 TO FORMAT                                    
FFRMT    DS    CL1                 FROM FORMAT                                  
FROM     DS    CL5                 FROM FIELD                                   
TO       DS    CL5                 TO FIELD                                     
PREVKWRD DS    CL6                                                              
OPA      DS    CL1                                                              
OPB      DS    CL1                                                              
KEYW     DS    CL1                                                              
         SPACE 2                                                                
*              LTORG FOR CPPGEN                                                 
         EJECT                                                                  
CPRES    DC    X'02'                                                            
* DATA FORMAT TABLE                                                             
DDFRMTAB DC    AL1(7),C'N',C'NUMERIC'                                           
         DC    AL1(6),C'P',C'PACKED'                                            
         DC    AL1(6),C'B',C'BINARY'                                            
         DC    AL1(9),C'C',C'CHARACTER'                                         
         DC    AL1(0)                                                           
CURRFLST DS    500C                                                             
         SPACE 2                                                                
IOA      DS    CL90                                                             
IRDR     ACB   AM=VSAM,MACRF=(ADR,SEQ,OUT),DDNAME=DDCARD                        
OUTRPL   RPL   ACB=IRDR,OPTCD=(ADR,SEQ,SYN,NUP),RECLEN=80,AREA=IOA,    X        
               AREALEN=80                                                       
         IFGRPL                                                                 
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
* PRECISION TABLE                                                               
PRECTAB  CSECT                                                                  
         DC    AL1(4),X'0002',C'DEC2'                                           
         DC    AL1(3),X'0002',C'.XX'                                            
         DC    AL1(4),X'0001',C'DEC1'                                           
         DC    AL1(2),X'0001',C'.X'                                             
         DC    AL1(4),X'0003',C'DEC3'                                           
         DC    AL1(4),X'0003',C'.XXX'                                           
         DC    AL1(5),X'0000',C'UNITS'                                          
         DC    AL1(4),X'FFFF',C'TENS'                                           
         DC    AL1(3),X'FFFF',C'(0)'                                            
         DC    AL1(8),X'FFFE',C'HUNDREDS'                                       
         DC    AL1(7),X'FFFE',C'HUNDRED'                                        
         DC    AL1(4),X'FFFE',C'(00)'                                           
         DC    AL1(9),X'FFFD',C'THOUSANDS'                                      
         DC    AL1(5),X'FFFD',C'(000)'                                          
         DC    AL1(6),X'FFFC',C'(0000)'                                         
         DC    AL1(8),X'FFFD',C'THOUSAND'                                       
         SPACE 2                                                                
         EJECT                                                                  
DSCTCODE CSECT                                                                  
         DC    C'ABCDEFGHIJKLMNOPQRSTUVWXYZ '                                   
DSCTAREA CSECT                                                                  
         DS    2800C                                                            
DDEFAREA CSECT                                                                  
         DS    28000C                                                           
FRMTAREA CSECT                                                                  
         DS    20000C                                                           
FORMAREA CSECT                                                                  
         DS    20000C                                                           
CONTROLC CSECT                                                                  
         DS    9000C                                                            
ELEMA    CSECT                                                                  
         DS    9000C                                                            
MDISP    CSECT                                                                  
         DS    9000C                                                            
STXEND   CSECT                                                                  
         DS    C                                                                
         SPACE 2                                                                
CNTLDSCT DSECT                                                                  
CDSEQ    DS    CL1                 PROCESSING SEQUENCE                          
CDNAM    DS    CL7                 FIELD NAME                                   
CDTDCDE  DS    CL1                 TO DSECT CODE                                
CDTFL    DS    CL1                 TO FIELD LENGTH                              
CDTDSP   DS    CL2                 TO DISPLACEMENT                              
CDTFMT   DS    CL1                 TO FORMAT                                    
CDTPREC  DS    CL2                 TO PRECISION                                 
CDFDCDE  DS    CL1                 FROM DSECT CODE                              
CDFFL    DS    CL1                 FROM FIELD LENGTH                            
CDFDSP   DS    CL2                 FROM DISPLACEMENT                            
CDFFMT   DS    CL1                 FROM FORMAT                                  
CDFPREC  DS    CL2                 FROM PRECISION                               
         SPACE 2                                                                
DDEFDSCT DSECT                                                                  
DDNAM    DS    CL7                 FIELD NAME                                   
DDDSP    DS    CL2                 DISPLACEMENT                                 
DDPREC   DS    CL2                 PRECISION                                    
         DS    C                                                                
DDFL     DS    CL1                 FIELD LENGTH                                 
DDFRMT   DS    CL1                 FORMAT                                       
         SPACE 2                                                                
MDISPD   DSECT                     MASTER DISP TABLE                            
MDNAME   DS    CL7                  DEMO NAME                                   
MDELEM   DS    C                    ELEMENT CODE                                
MDFNO    DS    C                    FIELD NUMBER IN ELEMENT                     
MDPREC   DS    CL2                  FIELD PRECISION                             
MDDNO    DS    C                    DEMO NUMBER                                 
MDLAST   DS    0C                                                               
MDLEN    EQU   MDLAST-MDNAME                                                    
         SPACE 2                                                                
MDPLD    DSECT                     MASTER DISPLACEMENT PRINT DSECT              
         DS    CL2                                                              
MDPLMOD  DS    CL1                 MODIFIER                                     
         DS    CL6                                                              
MDPLDNO  DS    CL3                 DEMO NUMBER                                  
         DS    CL4                                                              
MDPLENO  DS    CL2                 ELEMENT NUMBER                               
MDPLFNO  DS    CL2                 FIELD NUMBER                                 
MDPLPRS  DS    CL2                 PRECISION                                    
         DS    CL3                                                              
MDPLDNM  DS    CL7                 DEMO NAME                                    
         EJECT                                                                  
       ++INCLUDE DDDPRINT                                                       
         SPACE 2                                                                
SORTAREA CSECT                                                                  
         DS    41000C                                                           
DCODES   CSECT                                                                  
         DC    C'HOMES ',AL1(001)                                               
         DC    C'METROA',AL1(002)                                               
         DC    C'METROB',AL1(003)                                               
         DC    C'ADJ1  ',AL1(004)                                               
         DC    C'ADJ2  ',AL1(005)                                               
         DC    C'ADJ3  ',AL1(006)                                               
         DC    C'FEB-P ',AL1(007)                                               
         DC    C'MAY-P ',AL1(008)                                               
         DC    C'JUL-P ',AL1(009)                                               
         DC    C'NOV-P ',AL1(010)                                               
         DC    C'HH-W1 ',AL1(011)                                               
         DC    C'HH-W2 ',AL1(012)                                               
         DC    C'HH-W3 ',AL1(013)                                               
         DC    C'HH-W4 ',AL1(014)                                               
         DC    C'REACH ',AL1(015)                                               
         DC    C'CABLE ',AL1(016)                                               
         DC    C'CBL-A ',AL1(017)                                               
         DC    C'CBL-B ',AL1(018)                                               
         DC    C'W25   ',AL1(197)                                               
         DC    C'M25   ',AL1(217)                                               
         DC    C'V25   ',AL1(121)                                               
         DC    C'W211  ',AL1(019)                                               
         DC    C'M211  ',AL1(020)                                               
         DC    C'V211  ',AL1(122)                                               
         DC    C'W68   ',AL1(198)                                               
         DC    C'M68   ',AL1(218)                                               
         DC    C'V68   ',AL1(161)                                               
         DC    C'W611  ',AL1(021)                                               
         DC    C'M611  ',AL1(022)                                               
         DC    C'V611  ',AL1(123)                                               
         DC    C'W911  ',AL1(199)                                               
         DC    C'M911  ',AL1(219)                                               
         DC    C'V911  ',AL1(162)                                               
         DC    C'W1214 ',AL1(024)                                               
         DC    C'M1214 ',AL1(074)                                               
         DC    C'V1214 ',AL1(124)                                               
         DC    C'W1217 ',AL1(025)                                               
         DC    C'M1217 ',AL1(075)                                               
         DC    C'V1217 ',AL1(125)                                               
         DC    C'W1517 ',AL1(026)                                               
         DC    C'M1517 ',AL1(076)                                               
         DC    C'V1517 ',AL1(126)                                               
         DC    C'W2+   ',AL1(027)                                               
         DC    C'M2+   ',AL1(077)                                               
         DC    C'V2+   ',AL1(127)                                               
         DC    C'W1221 ',AL1(023)                                               
         DC    C'M1221 ',AL1(111)                                               
         DC    C'V1221 ',AL1(187)                                               
         DC    C'W1224 ',AL1(028)                                               
         DC    C'M1224 ',AL1(078)                                               
         DC    C'V1224 ',AL1(128)                                               
         DC    C'W1234 ',AL1(029)                                               
         DC    C'M1234 ',AL1(079)                                               
         DC    C'V1234 ',AL1(129)                                               
         DC    C'W1249 ',AL1(030)                                               
         DC    C'M1249 ',AL1(080)                                               
         DC    C'V1249 ',AL1(130)                                               
         DC    C'W1254 ',AL1(031)                                               
         DC    C'M1254 ',AL1(081)                                               
         DC    C'V1254 ',AL1(131)                                               
         DC    C'W1264 ',AL1(032)                                               
         DC    C'M1264 ',AL1(082)                                               
         DC    C'V1264 ',AL1(132)                                               
         DC    C'W12+  ',AL1(033)                                               
         DC    C'M12+  ',AL1(083)                                               
         DC    C'V12+  ',AL1(133)                                               
         DC    C'W1524 ',AL1(034)                                               
         DC    C'M1524 ',AL1(084)                                               
         DC    C'V1524 ',AL1(134)                                               
         DC    C'W1534 ',AL1(035)                                               
         DC    C'M1534 ',AL1(085)                                               
         DC    C'V1534 ',AL1(135)                                               
         DC    C'W1549 ',AL1(036)                                               
         DC    C'M1549 ',AL1(086)                                               
         DC    C'V1549 ',AL1(136)                                               
         DC    C'W1554 ',AL1(037)                                               
         DC    C'M1554 ',AL1(087)                                               
         DC    C'V1554 ',AL1(137)                                               
         DC    C'W1564 ',AL1(038)                                               
         DC    C'M1564 ',AL1(088)                                               
         DC    C'V1564 ',AL1(138)                                               
         DC    C'W15+  ',AL1(039)                                               
         DC    C'M15+  ',AL1(089)                                               
         DC    C'V15+  ',AL1(139)                                               
         DC    C'W1820 ',AL1(068)                                               
         DC    C'M1820 ',AL1(112)                                               
         DC    C'V1820 ',AL1(188)                                               
         DC    C'W1824 ',AL1(040)                                               
         DC    C'M1824 ',AL1(090)                                               
         DC    C'V1824 ',AL1(140)                                               
         DC    C'W1834 ',AL1(041)                                               
         DC    C'M1834 ',AL1(091)                                               
         DC    C'V1834 ',AL1(141)                                               
         DC    C'W1844 ',AL1(200)                                               
         DC    C'M1844 ',AL1(210)                                               
         DC    C'V1844 ',AL1(220)                                               
         DC    C'W1849 ',AL1(042)                                               
         DC    C'M1849 ',AL1(092)                                               
         DC    C'V1849 ',AL1(142)                                               
         DC    C'W1854 ',AL1(043)                                               
         DC    C'M1854 ',AL1(093)                                               
         DC    C'V1854 ',AL1(143)                                               
         DC    C'W1864 ',AL1(044)                                               
         DC    C'M1864 ',AL1(094)                                               
         DC    C'V1864 ',AL1(144)                                               
         DC    C'W18+  ',AL1(045)                                               
         DC    C'M18+  ',AL1(095)                                               
         DC    C'V18+  ',AL1(145)                                               
         DC    C'W2124 ',AL1(069)                                               
         DC    C'M2124 ',AL1(113)                                               
         DC    C'V2124 ',AL1(189)                                               
         DC    C'W2134 ',AL1(070)                                               
         DC    C'M2134 ',AL1(114)                                               
         DC    C'V2134 ',AL1(190)                                               
         DC    C'W2149 ',AL1(071)                                               
         DC    C'M2149 ',AL1(115)                                               
         DC    C'V2149 ',AL1(191)                                               
         DC    C'W2154 ',AL1(072)                                               
         DC    C'M2154 ',AL1(116)                                               
         DC    C'V2154 ',AL1(192)                                               
         DC    C'W2164 ',AL1(073)                                               
         DC    C'M2164 ',AL1(117)                                               
         DC    C'V2164 ',AL1(193)                                               
         DC    C'W21+  ',AL1(067)                                               
         DC    C'M21+  ',AL1(118)                                               
         DC    C'V21+  ',AL1(194)                                               
         DC    C'W2529 ',AL1(196)                                               
         DC    C'M2529 ',AL1(227)                                               
         DC    C'V2529 ',AL1(163)                                               
         DC    C'W2534 ',AL1(046)                                               
         DC    C'M2534 ',AL1(096)                                               
         DC    C'V2534 ',AL1(146)                                               
         DC    C'W2544 ',AL1(201)                                               
         DC    C'M2544 ',AL1(211)                                               
         DC    C'V2544 ',AL1(221)                                               
         DC    C'W2549 ',AL1(047)                                               
         DC    C'M2549 ',AL1(097)                                               
         DC    C'V2549 ',AL1(147)                                               
         DC    C'W2554 ',AL1(048)                                               
         DC    C'M2554 ',AL1(098)                                               
         DC    C'V2554 ',AL1(148)                                               
         DC    C'W2564 ',AL1(049)                                               
         DC    C'M2564 ',AL1(099)                                               
         DC    C'V2564 ',AL1(149)                                               
         DC    C'W25+  ',AL1(050)                                               
         DC    C'M25+  ',AL1(100)                                               
         DC    C'V25+  ',AL1(150)                                               
         DC    C'W3034 ',AL1(207)                                               
         DC    C'M3034 ',AL1(228)                                               
         DC    C'V3034 ',AL1(164)                                               
         DC    C'W3539 ',AL1(208)                                               
         DC    C'M3539 ',AL1(229)                                               
         DC    C'V3539 ',AL1(165)                                               
         DC    C'W3544 ',AL1(202)                                               
         DC    C'M3544 ',AL1(212)                                               
         DC    C'V3544 ',AL1(222)                                               
         DC    C'W3549 ',AL1(051)                                               
         DC    C'M3549 ',AL1(101)                                               
         DC    C'V3549 ',AL1(151)                                               
         DC    C'W3554 ',AL1(052)                                               
         DC    C'M3554 ',AL1(102)                                               
         DC    C'V3554 ',AL1(152)                                               
         DC    C'W3564 ',AL1(053)                                               
         DC    C'M3564 ',AL1(103)                                               
         DC    C'V3564 ',AL1(153)                                               
         DC    C'W35+  ',AL1(054)                                               
         DC    C'M35+  ',AL1(104)                                               
         DC    C'V35+  ',AL1(154)                                               
         DC    C'W4044 ',AL1(209)                                               
         DC    C'M4044 ',AL1(195)                                               
         DC    C'V4044 ',AL1(166)                                               
         DC    C'W4549 ',AL1(203)                                               
         DC    C'M4549 ',AL1(213)                                               
         DC    C'V4549 ',AL1(223)                                               
         DC    C'W4554 ',AL1(204)                                               
         DC    C'M4554 ',AL1(214)                                               
         DC    C'V4554 ',AL1(224)                                               
         DC    C'W4564 ',AL1(205)                                               
         DC    C'M4564 ',AL1(215)                                               
         DC    C'V4564 ',AL1(225)                                               
         DC    C'W45+  ',AL1(206)                                               
         DC    C'M45+  ',AL1(216)                                               
         DC    C'V45+  ',AL1(226)                                               
         DC    C'W5054 ',AL1(055)                                               
         DC    C'M5054 ',AL1(105)                                               
         DC    C'V5054 ',AL1(155)                                               
         DC    C'W5064 ',AL1(056)                                               
         DC    C'M5064 ',AL1(106)                                               
         DC    C'V5064 ',AL1(156)                                               
         DC    C'W50+  ',AL1(057)                                               
         DC    C'M50+  ',AL1(107)                                               
         DC    C'V50+  ',AL1(157)                                               
         DC    C'W5564 ',AL1(058)                                               
         DC    C'M5564 ',AL1(108)                                               
         DC    C'V5564 ',AL1(158)                                               
         DC    C'W55+  ',AL1(059)                                               
         DC    C'M55+  ',AL1(109)                                               
         DC    C'V55+  ',AL1(159)                                               
         DC    C'W65+  ',AL1(060)                                               
         DC    C'M65+  ',AL1(110)                                               
         DC    C'V65+  ',AL1(160)                                               
         DC    C'LOH   ',AL1(064)                                               
         DC    C'WMOMS ',AL1(066)                                               
         DC    C'WWRK  ',AL1(065)                                               
         DC    C'WW1820',AL1(230)                                               
         DC    C'WW2124',AL1(231)                                               
         DC    C'WW2534',AL1(232)                                               
         DC    C'WW3544',AL1(233)                                               
         DC    C'WW4549',AL1(234)                                               
         DC    C'WW5054',AL1(235)                                               
         DC    C'WW55+ ',AL1(236)                                               
         DC    C'WW1849',AL1(237)                                               
         DC    C'WW2554',AL1(238)                                               
         DC    C'HWC6  ',AL1(240)                                               
         DC    C'HWC12 ',AL1(241)                                               
         DC    C'HWC18 ',AL1(242)                                               
         DC    X'FF'                                                            
         EJECT                                                                  
*              STACK OF STANDARD CARDS                                          
        SPACE 3                                                                 
STACK    CSECT                                                                  
         DC    CL37'1//ZENP JOB ,ZENP,CLASS=A,MSGCLASS=X,'                      
         DC    CL44'MSGLEVEL=(1,1)'                                             
         DC    CL81'1//*MAIN CLASS=SYSTEMS'                                     
         DC    CL81'1//*FORMAT PR,DDNAME=SYSPRINT,FORMS=1S'                     
         DC    CL81'1//       EXEC DEMGEN,REGION=512K'                          
*        DC    CL81'1//STEPLIB DD DSN=SYS1.DDS.PANLIB,DISP=SHR'                 
*        DC    CL81'1//LOADLIB DD DSN=DDS.LOADLIB,DISP=SHR'                     
*        DC    CL81'1//PANDD1 DD DSN=PAN.DOS.MVS.LIBRARY,DISP=SHR'              
*        DC    CL81'1//SYSIN DD DSN=*'                                          
STACK2   DC    CL81'1++UPDATE ********,0,ALL'                                   
STACK2A  DC    CL81'1*CATALP ********'                                          
STACK3   DC    CL81'1         TITLE ''DEMO CONVERSION'' '                       
         DC    CL81'7         LA    RE,$.YFEND '                                
         DC    CL81'7         CLI    $.YFRST,1 '                                
         DC    CL81'7         BNE   $.YPROCX'                                   
         DC    CL81'7$.YPROC1   CLI   1(RE),255 '                               
         DC    CL81'7         BE    $.YPROCX '                                  
         DC    CL81'7         LH    RF,2(RE)  '                                 
         DC    CL81'7         CLI   0(RE),3 '                                   
         DC    CL81'7         BE    *+8 '                                       
         DC    CL81'7         CLI   0(RE),1'                                    
         DC    CL81'7         BNE   $.YPROC2 '                                  
         DC    CL81'7         LR    R3,R6 '                                     
         DC    CL81'7         CLI   1(RE),1  '                                  
         DC    CL81'7         BNE   *+6 '                                       
         DC    CL81'7         LR    R3,R7  '                                    
         DC    CL81'7         CLI   1(RE),4  '                                  
         DC    CL81'7         BNE   *+8 '                                       
         DC    CL81'7         LA    R3,$.YSTRT '                                
         DC    CL81'7         AR    RF,R3 '                                     
         DC    CL81'7         ST    RF,FULL '                                   
         DC    CL81'7         MVC   1(3,RE),FULL+1 '                            
         DC    CL81'7         MVI   $.YFRST,0 '                                 
         DC    CL81'7$.YPROC2   LA    RE,4(RE) '                                
         DC    CL81'7         CLI   0(RE),X''FF'' '                             
         DC    CL81'7         BNE   $.YPROC1 '                                  
         DC    CL81'7         LA    RE,4(RE) '                                  
         DC    CL81'7         CLI   0(RE),X''FF'' '                             
         DC    CL81'7         BE    $.YPROCX  '                                 
         DC    CL81'7         B     $.YPROC1 '                                  
         DC    CL81'7         SPACE 2 '                                         
         DC    CL81'7$.YFRST    DC    X''01'' '                                 
         DC    CL81'7$.YSTRT    DS    0F '                                      
         DC    CL81'7         DC    F''10'' '                                   
         DC    CL81'7         DC    F''100'' '                                  
         DC    CL81'7         DC    F''1000'' '                                 
         DC    CL81'7$.YPROCX  DS    0H '                                       
STACK4   DC    CL81'8PRECIS*. LH    RE,HALF '                                   
         DC    CL81'8         LPR   RE,RE    '                                  
         DC    CL81'8         LA    R0,1 '                                      
         DC    CL81'8         MH    R0,=H''10'' '                               
         DC    CL81'8         BCT   RE,*-4 '                                    
         DC    CL81'8         SR    RE,RE '                                     
         DC    CL81'8         TM    HALF,X''80'' '                              
         DC    CL81'8         BO    *+8 '                                       
         DC    CL81'8         MR    RE,R0 '                                     
         DC    CL81'8         BR    R9 '                                        
         DC    CL81'8         LPR   RE,R0 '                                     
         DC    CL81'8         ST    RE,FULL '                                   
         DC    CL81'8         LR    RE,RF '                                     
         DC    CL81'8         SR    RF,RF '                                     
         DC    CL81'8         SRDA  RE,31 '                                     
         DC    CL81'8         D     RE,FULL '                                   
         DC    CL81'8         A     RF,=F''1'' '                                
         DC    CL81'8         SRA   RF,1 '                                      
         DC    CL81'8         BR    R9 '                                        
         DC    CL81'8         DS    H '                                         
         DC    CL81'9         DC    X''00'' '                                   
         DC    CL81'9         SPACE 2'                                          
         DC    CL81'9         END '                                             
         DC    CL81'9/*'                                                        
         DC    X'FF'                                                            
         SPACE 2                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'072DEDEMGEN  05/01/02'                                      
         END                                                                    

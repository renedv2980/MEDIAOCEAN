*          DATA SET FASCRUNCHS AT LEVEL 005 AS OF 05/01/02                      
*CATALP FASCRNCA                                                                
         TITLE 'FASCRUNCH - EXECUTE A FACPAK SCRIPT'                            
***********************************************************************         
* FASCRUNCH PROCESSES A SET OF SCRIPT COMMANDS BASED ON PARAMETERS    *         
* PASSED AND RETURNED IN FACPAK CONTROL BLOCK FATBHD                  *         
* SCRIPT IS VALIDATED FOR CORRECT SYNTAX AND THEN EXECUTED            *         
***********************************************************************         
         SPACE 1                                                                
SCRUNCH  CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 WORKX-WORKD,**SCRU**,RA,R9,R8,RR=RE,CLEAR=YES                    
*                                                                               
         ENTRY SCRASH              FASCRUNCH ABEND REENTRY POINT                
*                                                                               
         USING WORKD,RC                                                         
         ST    RE,RELO                                                          
         ST    RC,CRWORK                                                        
         ST    RD,SAVERD                                                        
         LR    RF,R1                                                            
         ST    RF,ATCB                                                          
         B     MAIN                                                             
         EJECT                                                                  
***********************************************************************         
* MAIN CONTROL ROUTINE                                                *         
***********************************************************************         
         SPACE 1                                                                
MAIN     EQU   *                                                                
*                                                                               
         L     RF,=A(INITIAL)      INITIALISATION                               
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
*                                                                               
         BAS   RE,VALIDATE         VALIDATE AND COMPILE SCRIPT                  
         BNE   MVALER              EXIT IF ERROR                                
*                                                                               
         BAS   RE,EXECUTE          EXECUTE SCRIPT                               
         BNE   MEXEER              EXIT IF ERROR                                
*                                                                               
         BAS   RE,SETTBH           SET VALUES IN TBH                            
*                                                                               
         L     RF,=A(CLOSSCT)      CLOSE DOWN SCRIPT TRACING                    
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
*                                                                               
         CLI   ABNDFLAG,C'Y'       TEST ABEND EXIT                              
         BE    SCRUNCHX                                                         
         L     R1,ATCB                                                          
         LA    R2,1                CALL MONITOR - NORMAL END OF SCRIPT          
         GOTO1 =V(MONITOR)                                                      
         B     SCRUNCHX            EXIT OK                                      
*                                                                               
MVALER   EQU   *                   HERE IF VALIDATION ERROR                     
         BAS   RE,SETTBH           SET RETURN VALUES IN TBHD                    
*                                                                               
         L     RF,=A(CLOSSCT)      CLOSE DOWN SCRIPT TRACING                    
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
*                                                                               
         B     SCRUNCHX                                                         
*                                                                               
MEXEER   EQU   *                   HERE IF EXECUTION ERROR                      
         BAS   RE,SETTBH           SET RETURN VALUES IN TBHD                    
*                                                                               
         L     RF,=A(CLOSSCT)      CLOSE DOWN SCRIPT TRACING                    
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
*                                                                               
         CLI   ABNDFLAG,C'Y'       TEST ABEND EXIT                              
         BE    SCRUNCHX                                                         
*                                                                               
         L     R1,ATCB                                                          
         LA    R2,2                                                             
         GOTO1 =V(MONITOR)         CALL MONITOR - ABNORMAL ABEND SCRIPT         
         B     SCRUNCHX                                                         
*                                                                               
SCRUNCHX EQU   *                   EXIT SCRUNCH                                 
*                                                                               
         L     RF,AUTL                                                          
*                                  TURN OFF TWA TRACE FLAG IN UTL               
         NI    TSTAT4-UTLD(RF),X'FF'-TST4TWA                                    
         NI    TSTAT1-UTLD(RF),X'F0'  RESET VIOLATION FLAGS                     
*                                                                               
         L     R3,ATCB                                                          
         USING TCBD,R3                                                          
         ICM   R3,15,TCBSCRPT      POINT R3 TO CALLING TASK ECB                 
         BZ    EXIT                                                             
         ICM   R1,15,TCBSVECB      POST ECB IN CALLING TASK                     
         BZ    EXIT                                                             
         OI    0(R1),X'40'                                                      
         B     EXIT                                                             
         DROP  R3                                                               
*                                                                               
EXIT     XMOD1 1                                                                
         EJECT                                                                  
***********************************************************************         
* SET RETURN VALUES IN TBHD                                           *         
***********************************************************************         
         SPACE 1                                                                
SETTBH   EQU   *                                                                
         L     R1,ATBUFF                                                        
         USING TBHDATA,R1                                                       
         MVC   TBHSCERR,ERRCODE    SAVE SCRIPT ERROR CODE                       
         L     RF,SCRIPLOC                                                      
         S     RF,ASCRIPT                                                       
         STCM  RF,3,TBHSCDSP       SAVE DISPLACEMENT TO ERROR IN SCRIPT         
         L     RF,OUDATLOC         UPDATE OUTPUT DATA AREA LENGTH               
         S     RF,ASCRIPOD                                                      
         STCM  RF,3,TBHSCLOD                                                    
         DROP  R1                                                               
         BR    RE                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE AND COMPILE SCRIPT                                         *         
***********************************************************************         
         SPACE 1                                                                
VALIDATE NTR1                                                                   
         L     RF,ASCRIPT          SET SCRIPT LOCATION POINTER TO START         
         ST    RF,SCRIPLOC                                                      
*                                  LOOP THROUGH SCRIPT                          
VALILP1  MVC   SCPCODE,0(RF)       SAVE SCRIPT CONTROL CODE AND                 
         OC    SCPCODE,SPACES        CONVERT TO UPPERCASE                       
         CLC   SCPCODE,=AL2(S_END)                                              
         BE    VALI020             EXIT IF END OF SCRIPT CONTROL CODE           
*                                                                               
         BAS   RE,VALCODE          VALIDATE SCRIPT CONTROL CODE                 
         BNE   VALIER1             EXIT IF ERROR                                
*                                                                               
         BAS   RE,VALPARM          VALIDATE SCRIPT CONTROL PARAMETERS           
         BNE   VALINO              EXIT IF ERROR                                
*                                                                               
         L     R5,SCTPTR           R5=A(SCRIPT CONTROL TABLE ENTRY)             
         USING SCOTABD,R5                                                       
         ICM   RF,15,SCTVAL        CALL SCRIPT CONTROL VALIDATION               
         BZ    VALI010               ROUTINE IF SPECIFIED                       
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         BNE   VALINO              EXIT IF ERROR                                
*                                                                               
VALI010  L     RF,SCRIPLOC         SET LOCATION OF NEXT SCRIPT CONTROL          
         B     VALILP1               CODE AND CONTINUE LOOP                     
*                                                                               
VALI020  BAS   RE,VALSYMT          VALIDATE SYMBOL TABLE                        
         BNE   VALINO                EXIT IF ERROR                              
         B     VALIOK                ELSE EXIT OK                               
*                                                                               
VALIER1  MVC   ERRCODE,=Y(EQVALI1) SET VALIDATION ERROR CODE                    
         B     VALINO                 AND EXIT WITH ERROR                       
*                                                                               
VALINO   B     NO                  ERROR EXIT                                   
VALIOK   B     YES                 EXIT OK                                      
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE SYMBOL TABLE - CHECK ALL LABEL DEFINITIONS COMPLETE        *         
***********************************************************************         
         SPACE 1                                                                
VALSYMT  NTR1                                                                   
         USING SYMTABD,R6                                                       
         L     R6,ASYMTAB                                                       
*                                                                               
VSYM010  C     R6,ASYMTNXT                                                      
         BE    VSYMOK                                                           
         C     R6,ASYMTABX                                                      
         BNL   VSYMOK                                                           
         TM    SYTTYPE,SYTTFLBQ                                                 
         BO    VSYM020                                                          
         TM    SYTTYPE,SYTTWLBQ                                                 
         BO    VSYM020                                                          
         OC    SYTADDR,SYTADDR                                                  
         BZ    VSYMER1                                                          
*                                                                               
VSYM020  LA    R6,SYMTABL(R6)                                                   
         B     VSYM010                                                          
*                                                                               
VSYMER1  MVC   ERRCODE,=Y(EQVSYM1)                                              
         B     VSYMNO                                                           
*                                                                               
VSYMNO   B     NO                  ERROR EXIT                                   
VSYMOK   B     YES                 EXIT OK                                      
         DROP  R6                                                               
         EJECT                                                                  
***********************************************************************         
* EXECUTE COMPILED SCRIPT                                             *         
***********************************************************************         
         SPACE 1                                                                
EXECUTE  NTR1                                                                   
         L     RF,ASCRIPT          SET SCRIPT LOCATION POINTER TO START         
         ST    RF,SCRIPLOC                                                      
*                                  LOOP THROUGH SCRIPT                          
EXECLP1  EQU   *                                                                
         MVC   LOGLINE,=CL40' '    CLEAR SCRIPT TRACE LOG EVENT LINE            
         MVC   LASTINP,INDATRDL    SAVE LAST INPUT DATA AREA POINTER            
         MVC   LASTOUP,OUDATLOC    SAVE LAST OUTPUT DATA AREA POINTER           
         MVC   LASTWRP,SCWORKL     SAVE LAST WORK DATA AREA POINTER             
         MVC   SCPCODE,0(RF)       SAVE SCRIPT CONTROL CODE AND                 
         OC    SCPCODE,SPACES        CONVERT TO UPPER CASE                      
         CLC   SCPCODE,=AL2(S_END)                                              
         BE    EXECOK              EXIT IF END OF SCRIPT CONTROL CODE           
*                                                                               
         BAS   RE,VALCODE          VALIDATE SCRIPT CONTROL CODE                 
         BNE   EXECER1             EXIT IF ERROR                                
*                                                                               
         L     R5,SCTPTR           R5=A(SCRIPT CONTROL TABLE ENTRY)             
         USING SCOTABD,R5                                                       
         ICM   RF,15,SCTEXEC       CALL SCRIPT CONTROL EXECUTE ROUTINE          
         BZ    EXEC100               IF SPECIFIED                               
         TM    SCTEXEC,X'80'       TEST INDIRECT ADDRESS FLAGGED                
         BO    EXEC010                                                          
*                                  PROCESS DIRECT ADDRESS                       
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         BNE   EXECNO              EXIT IF ERROR                                
         CLI   EXITFLAG,C'Y'       EXIT IF EXIT FLAG SET                        
         BE    EXECOK                                                           
         B     EXEC100                                                          
*                                  PROCESS INDIRECT ADDRESS                     
EXEC010  EQU   *                                                                
         A     RF,RELO                                                          
         AR    RF,RB                                                            
         BASR  RE,RF                                                            
         BNE   EXECNO              EXIT IF ERROR                                
         CLI   EXITFLAG,C'Y'       EXIT IF EXIT FLAG SET                        
         BE    EXECOK                                                           
         B     EXEC100                                                          
*                                                                               
EXEC100  EQU   *                                                                
         L     RF,=A(SCTRACE)      CALL SCRIPT TRACE ROUTINE                    
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         L     RF,SCRIPLOC         SET LOCATION OF NEXT SCRIPT CONTROL          
         B     EXECLP1               CODE AND CONTINUE WITH LOOP                
*                                                                               
EXECER1  MVC   ERRCODE,=Y(EQEXEC1) EXIT WITH EXECUTE ERROR                      
         B     EXECNO                                                           
*                                                                               
EXECNO   B     NO                  ERROR EXIT                                   
EXECOK   B     YES                 EXIT OK                                      
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE SCRIPT CONTROL CODE AT SCRIPLOC LOCATION IN SCRIPT         *         
* RETURN A(ENTRY IN SCRIPT CONTROL TABLE) IN SCTPTR                   *         
* AND MOVE SCRIPLOC TO NEXT POSITION PAST CONTROL CODE                *         
* ELSE EXIT WITH ERROR CODE IF INVALID SCRIPT CONTROL CODE            *         
***********************************************************************         
         SPACE 1                                                                
VALCODE  NTR1                                                                   
         L     R5,ASCOTAB          R5=A(START OF SCRIPT CONTROL TABLE)          
         USING SCOTABD,R5                                                       
*                                  LOOP THROUGH SCRIPT CONTROL TABLE            
VCOD010  CLC   SCTCODE,=YL2(0)     EXIT WITH ERROR IF END OF TABLE              
         BE    VCODNO                                                           
         CLC   SCTCODE,SCPCODE     COMPARE CONTROL CODE IN TABLE                
         BE    VCOD040             EXIT IF MATCH FOUND                          
         LA    R5,SCTDATA          MOVE TABLE POINTER TO NEXT ENTRY             
VCOD020  CLC   0(2,R5),=YL2(0)                                                  
         BE    VCOD030                                                          
         LA    R5,SCTDATAL(R5)                                                  
         B     VCOD020                                                          
VCOD030  LA    R5,2(R5)                                                         
         B     VCOD010             LOOP TO NEXT ENTRY                           
*                                  HERE IF CONTROL CODE ENTRY FOUND             
VCOD040  ST    R5,SCTPTR           SAVE A(SCRIPT CONTROL TABLE ENTRY)           
         GOTO1 BUMPSLOC,L'SCTCODE  MOVE SCRIPT LOCATION ONWARD                  
         B     VCODOK                                                           
*                                                                               
VCODNO   B     NO                  ERROR EXIT                                   
VCODOK   B     YES                 EXIT OK                                      
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE SCRIPT CONTROL INSTRUCTION PARAMETERS                      *         
* A(ENTRY IN SCRIPT CONTROL TABLE) IN SCTPTR                          *         
* AND MOVE SCRIPLOC TO NEXT POSITION PAST CONTROL CODE                *         
* ELSE EXIT WITH ERROR CODE IF INVALID SCRIPT CONTROL CODE            *         
***********************************************************************         
         SPACE 1                                                                
VALPARM  NTR1                                                                   
         L     R5,SCTPTR           R5=A(SCRIPT CONTROL TABLE ENTRY)             
         USING SCOTABD,R5                                                       
         LA    R5,SCTDATA          R5=A(SCRIPT DATA ITEM CONTROLS)              
         DROP  R5                                                               
         USING SCTDATA,R5                                                       
*                                  LOOP THROUGH DATA PARAMETER CONTROLS         
VPAR010  CLC   SCTDNUM,=YL2(0)     EXIT AT END OF ENTRY                         
         BE    VPAROK                                                           
         L     R6,ADCVTAB          R6=A(DATA ITEM CONVERSION TABLE)             
         USING DCVTABD,R6                                                       
*                                  FIND DATA ITEM IN CONVERSION TABLE           
VPAR020  CLC   DCTDNUM,=YL2(0)     EXIT WITH ERROR IF NOT FOUND                 
         BE    VPARER1                                                          
         CLC   DCTDNUM,SCTDNUM                                                  
         BE    VPAR030                                                          
         LA    R6,DCVTABL(R6)                                                   
         B     VPAR020                                                          
*                                                                               
VPAR030  ICM   RF,15,DCTVAL        RF=A(DATA ITEM VALIDATION ROUTINE)           
         BZ    VPAR100                                                          
         LA    RF,WORKD(RF)                                                     
         ICM   RF,15,0(RF)                                                      
         BZ    VPAR100                                                          
         SR    R3,R3                                                            
         SR    R4,R4                                                            
         ICM   R3,3,SCTDMIN        SET DATA ITEM MINIMUM LENGTH                 
         ICM   R4,3,SCTDMAX        SET DATA ITEM MAXIMUM LENGTH                 
*                                  CALL DATA ITEM VALIDATION ROUTINE            
         GOTO1 (RF),CRPARM,SCRIPLOC,(R3),(R4),RR=RELO                           
         BNE   VPARNO              EXIT IF ERROR                                
         ICM   R1,15,0(R1)         GET LENGTH OF DATA ITEM PARAMETER            
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
*                                                                               
VPAR100  LA    R5,SCTDATAL(R5)     GET NEXT DATA ITEM IN SCRIPT                 
         B     VPAR010               CONTROL TABLE ENTRY                        
*                                                                               
VPARER1  MVC   ERRCODE,=Y(EQVPAR1) PARAMETER VALIDATION ERROR                   
         B     VPARNO                                                           
*                                                                               
VPARNO   B     NO                  ERROR EXIT                                   
VPAROK   B     YES                 EXIT OK                                      
         DROP  R5,R6                                                            
         EJECT                                                                  
***********************************************************************         
* BUMP SCRIPT LOCATION COUNTER                                        *         
* ADD VALUE IN (R1) TO VALUE IN SCRIPLOC                              *         
***********************************************************************         
         SPACE 1                                                                
BUMPSLOC NTR1                                                                   
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R1,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         XIT1                                                                   
         SPACE 1                                                                
         EJECT                                                                  
***********************************************************************         
* S_$CT CONNECT CONTROL VALIDATION ROUTINE                            *         
***********************************************************************         
         SPACE 1                                                                
CTVAL    NTR1                                                                   
         TM    CTFLAGS,CTFSYSQ     TEST SYSTEM ENTERED                          
         BZ    CTVAER1                                                          
         TM    CTFLAGS,CTFPRGQ     TEST PROGRAM ENTERED                         
         BZ    CTVAER2                                                          
         TM    CTFLAGS,CTFUSRQ     TEST USERID ENTERED                          
         BZ    CTVAER3                                                          
         B     CTVAOK                                                           
*                                  ERROR EXITS                                  
CTVAER1  MVC   ERRCODE,=Y(EQCTVA1)                                              
         B     CTVANO                                                           
CTVAER2  MVC   ERRCODE,=Y(EQCTVA2)                                              
         B     CTVANO                                                           
CTVAER3  MVC   ERRCODE,=Y(EQCTVA3)                                              
         B     CTVANO                                                           
*                                                                               
CTVANO   B     NO                  ERROR EXIT                                   
CTVAOK   B     YES                 EXIT OK                                      
         SPACE 1                                                                
***********************************************************************         
* S_USRS USER-ID SCRIPT CONTROL VALIDATION ROUTINE                    *         
***********************************************************************         
         SPACE 1                                                                
USRVAL   NTR1                                                                   
         OI    CTFLAGS,CTFUSRQ     SET USERID ENTERED                           
         B     USRVOK                                                           
*                                                                               
USRVNO   B     NO                                                               
USRVOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_SYSS SYSTEM SCRIPT CONTROL VALIDATION ROUTINE                     *         
***********************************************************************         
         SPACE 1                                                                
SYSVAL   NTR1                                                                   
         OI    CTFLAGS,CTFSYSQ     SET SYSTEM ENTERED                           
         B     SYSVOK                                                           
*                                                                               
SYSVNO   B     NO                                                               
SYSVOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PRGS PROGRAM SCRIPT CONTROL VALIDATION ROUTINE                    *         
***********************************************************************         
         SPACE 1                                                                
PRGVAL   NTR1                                                                   
         OI    CTFLAGS,CTFPRGQ     SET PROGRAM ENTERED                          
         B     PRGVOK                                                           
*                                                                               
PRGVNO   B     NO                                                               
PRGVOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PWDS PASSWORD SCRIPT CONTROL VALIDATION ROUTINE                   *         
***********************************************************************         
         SPACE 1                                                                
PWDVAL   NTR1                                                                   
         OI    CTFLAGS,CTFPWDQ     SET PASSWORD ENTERED                         
         B     PWDVOK                                                           
*                                                                               
PWDVNO   B     NO                                                               
PWDVOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_IAM IAM=TESTID SCRIPT CONTROL VALIDATION ROUTINE                  *         
***********************************************************************         
         SPACE 1                                                                
IAMVAL   NTR1                                                                   
         OI    CTFLAGS,CTFIAMQ     SET IAM=TESTID ENTERED                       
         B     IAMVOK                                                           
*                                                                               
IAMVNO   B     NO                                                               
IAMVOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_READ BLOCK INPUT SCRIPT CONTROL VALIDATION ROUTINE                *         
***********************************************************************         
         SPACE 1                                                                
BLKIVAL  NTR1                                                                   
         L     R1,ATBUFF                                                        
         USING TBHDATA,R1                                                       
         TM    TBHCNTL,TBHCTEST                                                 
         BNZ   BLIVOK                                                           
         DROP  R1                                                               
         OC    AINPROUT,AINPROUT                                                
         BZ    BLIVER1                                                          
         B     BLIVOK                                                           
*                                                                               
BLIVER1  MVC   ERRCODE,=Y(EQBLIV1)                                              
         B     BLIVNO                                                           
*                                                                               
BLIVNO   B     NO                                                               
BLIVOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_WRITE BLOCK OUTPUT SCRIPT CONTROL VALIDATION ROUTINE              *         
***********************************************************************         
         SPACE 1                                                                
BLKOVAL  NTR1                                                                   
         L     R1,ATBUFF                                                        
         USING TBHDATA,R1                                                       
         TM    TBHCNTL,TBHCTEST                                                 
         BNZ   BLOVOK                                                           
         DROP  R1                                                               
         OC    AOUTROUT,AOUTROUT                                                
         BZ    BLOVER1                                                          
         B     BLOVOK                                                           
*                                                                               
BLOVER1  MVC   ERRCODE,=Y(EQBLOV1)                                              
         B     BLOVNO                                                           
*                                                                               
BLOVNO   B     NO                                                               
BLOVOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_SAVERR SAVE ERROR MESSAGE IN BUFFER - VALIDATION ROUTINE          *         
***********************************************************************         
         SPACE 1                                                                
SAVEVAL  NTR1                                                                   
         OC    AERRBUFF,AERRBUFF                                                
         BZ    SAVVER1                                                          
         B     SAVVOK                                                           
*                                                                               
SAVVER1  MVC   ERRCODE,=Y(EQSAVV1)                                              
         B     SAVVNO                                                           
*                                                                               
SAVVNO   B     NO                                                               
SAVVOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_ECHO ECHO BACK SCRIPT CODE EXECUTE ROUTINE                        *         
***********************************************************************         
         SPACE 1                                                                
ERREXEC  NTR1                                                                   
*                                  RETURN HALF WORD VALUE IN ERRCODE            
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,ERRCODE                                  
         B     ERRENO              SIMULATE ERROR EXIT                          
*                                                                               
ERRENO   B     NO                                                               
ERREOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_SRV SET SERVICE REQUEST - EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
SRVEXEC  NTR1                                                                   
         L     RF,=A(SERVICE)                                                   
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
* S_IAM IAM=TESTID - EXECUTE ROUTINE - TESTID FROM SCRIPT PARAMETER   *         
***********************************************************************         
         SPACE 1                                                                
IAMSEXEC NTR1                                                                   
         MVI   TIDLEN,0                                                         
         MVC   TESTID,=CL10' '                                                  
*                                  GET EBCDIC TESTID FROM SCRIPT                
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,TESTID,L'TESTID                          
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
         LR    RF,R5                                                            
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         LTR   RF,RF                                                            
         BZ    IAMS020             EXIT IF ZERO LENGTH                          
         STC   RF,TIDLEN           SAVE LENGTH OF EBCDIC TESTID                 
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         OC    TESTID(0),TESTID                                                 
         BNZ   IAMS010                                                          
         MVC   TESTID,=CL10' '                                                  
         B     IAMS020                                                          
*                                                                               
IAMS010  L     RF,=A(IAMTEST)                                                   
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         BNE   IAMSNO                                                           
*                                                                               
IAMS020  GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     IAMSOK                                                           
*                                  ERROR EXITS                                  
IAMSER1  MVC   ERRCODE,=Y(EQIAMS1)                                              
         B     IAMINO                                                           
*                                                                               
IAMSNO   B     NO                  ERROR EXIT                                   
IAMSOK   B     YES                 EXIT OK                                      
         EJECT                                                                  
***********************************************************************         
* S_IAM IAM=TESTID - EXECUTE ROUTINE - TESTID FROM INPUT AREA         *         
***********************************************************************         
         SPACE 1                                                                
IAMIEXEC NTR1                                                                   
         MVI   TIDLEN,0                                                         
         MVC   TESTID,=CL10' '                                                  
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         ICM   RF,3,HALF           MOVE DATA FROM CURRENT LOCATION IN           
         ICM   RE,15,INDATRDL        INPUT TO TESTID FIELD                      
         LTR   RF,RF                                                            
         BZ    IAMI020             EXIT IF ZERO LENGTH                          
         STC   RF,TIDLEN           SAVE LENGTH OF EBCDIC TESTID                 
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   TESTID(0),0(RE)                                                  
         EX    RF,*+8                                                           
         B     *+10                                                             
         OC    TESTID(0),TESTID                                                 
         BNZ   IAMI010                                                          
         MVC   TESTID,=CL10' '                                                  
         B     IAMI020                                                          
*                                                                               
IAMI010  L     RF,=A(IAMTEST)                                                   
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         BNE   IAMINO                                                           
*                                                                               
IAMI020  L     RF,INDATRDL         MOVE INPUT DATA AREA LOCATION                
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,INDATRDL                                                      
*                                                                               
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     IAMIOK                                                           
*                                  ERROR EXITS                                  
IAMIER1  MVC   ERRCODE,=Y(EQIAMI1)                                              
         B     IAMINO                                                           
*                                                                               
IAMINO   B     NO                  ERROR EXIT                                   
IAMIOK   B     YES                 EXIT OK                                      
         EJECT                                                                  
***********************************************************************         
* S_USRS GET USERID FROM SCRIPT - EXECUTE ROUTINE                     *         
***********************************************************************         
         SPACE 1                                                                
USRSEXEC NTR1                                                                   
*                                  GET EBCDIC USER ID FROM SCRIPT               
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,USERID,L'USERID                          
         ICM   RF,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         LTR   RF,RF                                                            
         BZ    USSEER1             ERROR IF ZERO LENGTH                         
         STC   RF,USRLEN           SAVE LENGTH OF EBCDIC USERID                 
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   USERID(0),SPACES                                                 
         BE    USSEER1             ERROR IF BLANK                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         OC    USERID(0),USERID                                                 
         BZ    USSEER1             ERROR IF NULLS                               
         ICM   R1,15,0(R1)                                                      
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     USSEOK                                                           
*                                  ERROR EXITS                                  
USSEER1  MVC   ERRCODE,=Y(EQUSSE1)                                              
         B     USSENO                                                           
*                                                                               
USSENO   B     NO                                                               
USSEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_SYSS GET SYSTEM FROM SCRIPT - EXECUTE ROUINE                      *         
***********************************************************************         
         SPACE 1                                                                
SYSSEXEC NTR1                                                                   
*                                  GET SYSTEM FROM SCRIPT PARAMETER             
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,SYSTEM,L'SYSTEM                          
         ICM   RF,15,0(R1)         SAVE LENGTH SCRIPT PARAMETER                 
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         LTR   RF,RF                                                            
         BZ    SYSEER1             ERROR IF ZERO LENGTH                         
         STC   RF,SYSLEN           SAVE LENGTH SYSTEM CODE                      
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   SYSTEM(0),SPACES                                                 
         BE    SYSEER1             ERROR IF BLANK                               
         ICM   R1,15,0(R1)                                                      
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     SYSEOK                                                           
*                                  ERROR EXITS                                  
SYSEER1  MVC   ERRCODE,=Y(EQSYSE1)                                              
         B     SYSENO                                                           
*                                                                               
SYSENO   B     NO                                                               
SYSEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PRGS GET PROGRAM FROM SCRIPT - EXECUTE ROUTINE                    *         
***********************************************************************         
         SPACE 1                                                                
PRGSEXEC NTR1                                                                   
*                                  GET PROGRAM FROM SCRIPT PARAMETER            
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,PROGRAM,L'PROGRAM                        
         ICM   RF,15,0(R1)         SAVE LENGTH SCRIPT PARAMETER                 
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         LTR   RF,RF                                                            
         BZ    PRSEER1             ERROR IF ZERO LENGTH                         
         STC   RF,PRGLEN           SAVE LENGTH PROGRAM CODE                     
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   PROGRAM(0),SPACES                                                
         BE    PRSEER1             ERROR IF BLANK                               
         ICM   R1,15,0(R1)                                                      
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     PRSEOK                                                           
*                                  ERROR EXITS                                  
PRSEER1  MVC   ERRCODE,=Y(EQPRSE1)                                              
         B     PRSENO                                                           
*                                                                               
PRSENO   B     NO                                                               
PRSEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PWDS GET PASSWORD FROM SCRIPT - EXECUTE ROUTINE                   *         
***********************************************************************         
         SPACE 1                                                                
PWDSEXEC NTR1                                                                   
*                                  GET EBCDIC PASSWORD FROM SCRIPT              
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,PASSWD,L'PASSWD                          
         ICM   RF,15,0(R1)         SAVE LENGTH SCRIPT PARAMETER                 
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         STC   RF,PWDLEN           SAVE LENGTH PASSWORD CODE                    
         ICM   R1,15,0(R1)                                                      
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     PWSEOK                                                           
*                                                                               
PWSENO   B     NO                                                               
PWSEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_USRI GET USERID FROM INPUT DATA AREA - EXECUTE ROUTINE            *         
***********************************************************************         
         SPACE 1                                                                
USRDEXEC NTR1                                                                   
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         ICM   RF,3,HALF           MOVE DATA FROM CURRENT LOCATION IN           
         ICM   RE,15,INDATRDL        INPUT TO USERID FIELD                      
         LTR   RF,RF                                                            
         BZ    USDEER1             ERROR IF ZERO LENGTH                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   USERID(0),0(RE)                                                  
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   USERID(0),SPACES                                                 
         BE    USDEER1             ERROR IF BLANK                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         OC    USERID(0),USERID                                                 
         BZ    USDEER1             ERROR IF ZEROES                              
         LA    RF,1(RF)                                                         
         STC   RF,USRLEN           SAVE LENGTH OF EBCDIC USERID                 
         L     RF,INDATRDL         MOVE INPUT DATA AREA LOCATION                
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,INDATRDL                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     USDEOK                                                           
*                                  ERROR EXITS                                  
USDEER1  MVC   ERRCODE,=Y(EQUSDE1)                                              
         B     USDENO                                                           
*                                                                               
USDENO   B     NO                                                               
USDEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_SYSI GET SYSTEM FROM INPUT DATA AREA - EXECUTE ROUTINE            *         
***********************************************************************         
         SPACE 1                                                                
SYSDEXEC NTR1                                                                   
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         ICM   RF,3,HALF           MOVE DATA FROM CURRENT LOCATION IN           
         ICM   RE,15,INDATRDL        INPUT TO SYSTEM FIELD                      
         LTR   RF,RF                                                            
         BZ    SYDEER1             ERROR IF ZERO LENGTH                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   SYSTEM(0),0(RE)                                                  
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   SYSTEM(0),SPACES                                                 
         BE    SYDEER1             ERROR IF BLANK                               
         LA    RF,1(RF)                                                         
         STC   RF,SYSLEN           SAVE LENGTH OF SYSTEM                        
         L     RF,INDATRDL         MOVE INPUT DATA AREA LOCATION                
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,INDATRDL                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     SYDEOK                                                           
*                                  ERROR EXITS                                  
SYDEER1  MVC   ERRCODE,=Y(EQSYDE1)                                              
         B     USDENO                                                           
*                                                                               
SYDENO   B     NO                                                               
SYDEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PRGI GET PROGRAM FROM INPUT DATA AREA - EXECUTE ROUTINE           *         
***********************************************************************         
         SPACE 1                                                                
PRGDEXEC NTR1                                                                   
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         ICM   RF,3,HALF           MOVE DATA FROM CURRENT LOCATION IN           
         ICM   RE,15,INDATRDL        INPUT TO SYSTEM FIELD                      
         LTR   RF,RF                                                            
         BZ    PRDEER1             ERROR IF ZERO LENGTH                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   PROGRAM(0),0(RE)                                                 
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   PROGRAM(0),SPACES                                                
         BE    PRDEER1             ERROR IF BLANK                               
         LA    RF,1(RF)                                                         
         STC   RF,PRGLEN           SAVE LENGTH OF PROGRAM                       
         L     RF,INDATRDL         MOVE INPUT DATA AREA LOCATION                
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,INDATRDL                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     PRDEOK                                                           
*                                  ERROR EXITS                                  
PRDEER1  MVC   ERRCODE,=Y(EQPRDE1)                                              
         B     USDENO                                                           
*                                                                               
PRDENO   B     NO                                                               
PRDEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PWDI GET PASSWORD FROM INPUT DATA AREA - EXECUTE ROUTINE          *         
***********************************************************************         
         SPACE 1                                                                
PWDDEXEC NTR1                                                                   
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         ICM   RF,3,HALF           MOVE DATA FROM CURRENT LOCATION IN           
         ICM   RE,15,INDATRDL        INPUT TO SYSTEM FIELD                      
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   PASSWD(0),0(RE)                                                  
         LA    RF,1(RF)                                                         
         STC   RF,PWDLEN           SAVE LENGTH OF PASSWORD                      
         L     RF,INDATRDL         MOVE INPUT DATA AREA LOCATION                
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,INDATRDL                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     PWDEOK                                                           
*                                                                               
PWDENO   B     NO                                                               
PWDEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_EXIT EXIT - EXECUTE ROUTINE                                       *         
***********************************************************************         
         SPACE 1                                                                
EXITEXEC NTR1                                                                   
         MVI   EXITFLAG,C'Y'       SET EXIT FLAG TO YES                         
         B     EXITOK                                                           
*                                                                               
EXITNO   B     NO                                                               
EXITOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_EXITEQ EXIT IF EQUAL CONDITION - EXECUTE ROUTINE                  *         
***********************************************************************         
         SPACE 1                                                                
EXEEEXEC NTR1                                                                   
         TM    CONDCODE,CCEQUALQ   TEST CONDITION CODE EQUAL                    
         BZ    EXEEOK                                                           
         MVI   EXITFLAG,C'Y'       SET EXIT FLAG TO YES IF ON                   
         B     EXEEOK                                                           
*                                                                               
EXEENO   B     NO                                                               
EXEEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_EXITNE EXIT IF NOT EQUAL CONDITION - EXECUTE ROUTINE              *         
***********************************************************************         
         SPACE 1                                                                
EXENEXEC NTR1                                                                   
         TM    CONDCODE,CCEQUALQ   TEST CONDITION CODE EQUAL                    
         BO    EXENOK                                                           
         MVI   EXITFLAG,C'Y'       SET EXIT FLAG TO YES IF NOT ON               
         B     EXENOK                                                           
*                                                                               
EXENNO   B     NO                                                               
EXENOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_ABEND CALL MONITOR TO ABEND - EXECUTE ROUTINE                     *         
***********************************************************************         
         SPACE 1                                                                
ABNDEXEC NTR1                                                                   
         L     R1,ATCB                                                          
         LA    R2,4                                                             
         GOTO1 =V(MONITOR)         CALL MONITOR - SCRIPT ABEND REQUEST          
         MVI   EXITFLAG,C'Y'       SET EXIT FLAG TO YES                         
         MVI   ABNDFLAG,C'Y'       SET ABEND FLAG TO ON                         
         B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_COMMIT COMMIT UPDATES DONE SO FAR - EXECUTE ROUTINE               *         
***********************************************************************         
         SPACE 1                                                                
OKEXEC   NTR1                                                                   
         L     R1,ATCB                                                          
         LA    R2,3                                                             
         GOTO1 =V(MONITOR)         CALL MONITOR - COMMIT REQUEST                
*                                                                               
OKEXX    B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_FIRST POSTION TO FIRST FIELD IN TWA                               *         
***********************************************************************         
         SPACE 1                                                                
FRSTEXEC NTR1                                                                   
         GOTO1 FRSTFLD,CRPARM      LOCATE FIRST FIELD                           
         B     FRSEOK                                                           
*                                                                               
FRSENO   B     NO                                                               
FRSEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_FSTPRO POSTION TO FIRST PROTECTED FIELD IN TWA                    *         
***********************************************************************         
         SPACE 1                                                                
FPROEXEC NTR1                                                                   
         GOTO1 FRSTPRO,CRPARM      LOCATE FIRST PROTECTED FIELD                 
         B     FPREOK                                                           
*                                                                               
FPRENO   B     NO                                                               
FPREOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_HOME POSTION TO FIRST UNPROTECTED FIELD IN TWA                    *         
***********************************************************************         
         SPACE 1                                                                
HOMEEXEC NTR1                                                                   
         GOTO1 FRSTUNP,CRPARM      LOCATE FIRST UNPROTECTED FIELD               
         BNE   HOMENO                                                           
         B     HOMEOK                                                           
*                                                                               
HOMENO   B     NO                                                               
HOMEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_FLDOFF POSITION TO OFFSET WITHIN TWA FIELD - EXECUTE ROUTINE      *         
***********************************************************************         
         SPACE 1                                                                
FOFFEXEC NTR1                                                                   
*                                  GET OFFSET VALUE FROM SCRIPT                 
         GOTO1 LOADBYT,CRPARM,SCRIPLOC,TWAFOFF                                  
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     FOFEOK                                                           
*                                                                               
FOFENO   B     NO                                                               
FOFEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_NEXT POSITION TO NEXT FIELD IN TWA                                *         
***********************************************************************         
         SPACE 1                                                                
NEXTEXEC NTR1                                                                   
         GOTO1 NXTFLD,CRPARM       GOTO TO NEXT FIELD IN TWA                    
         BNE   NEXENO                                                           
         B     NEXEOK                                                           
*                                                                               
NEXENO   B     NO                                                               
NEXEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_TAB POSITION TO NEXT UNPROTECTED FIELD IN TWA                     *         
***********************************************************************         
         SPACE 1                                                                
TABEXEC  NTR1                                                                   
         GOTO1 TABUNP,CRPARM       GOTO NEXT UNPROTECTED FIELD                  
         BNE   TABENO                                                           
         B     TABEOK                                                           
*                                                                               
TABENO   B     NO                                                               
TABEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_NXTPRO POSITION TO NEXT PROTECTED FIELD IN TWA                    *         
***********************************************************************         
         SPACE 1                                                                
NPROEXEC NTR1                                                                   
         GOTO1 TABPRO,CRPARM       GOTO TO NEXT PROTECTED FIELD                 
         BNE   NPRONO                                                           
         B     NPROOK                                                           
*                                                                               
NPRONO   B     NO                                                               
NPROOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_NTH LOCATE NTH FIELD - EXECUTE ROUTINE                            *         
***********************************************************************         
         SPACE 1                                                                
LOCFEXEC NTR1                                                                   
*                                  GET FIELD # FROM SCRIPT                      
         GOTO1 LOADBYT,CRPARM,SCRIPLOC,BYTE                                     
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
         GOTO1 LTWAFLD,CRPARM,BYTE,C'F' LOCATE FIELD IN TWA                     
         BNE   LOCFNO              ERROR EXIT                                   
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     LOCFOK                                                           
*                                                                               
LOCFNO   B     NO                                                               
LOCFOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_NTHPRO LOCATE NTH PROTECTED FIELD - EXECUTE ROUTINE               *         
***********************************************************************         
         SPACE 1                                                                
LOCPEXEC NTR1                                                                   
*                                  GET FIELD # FROM SCRIPT                      
         GOTO1 LOADBYT,CRPARM,SCRIPLOC,BYTE                                     
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGFTH                
         GOTO1 LTWAFLD,CRPARM,BYTE,C'P' LOCATE NTH PROTECTED FLD IN TWA         
         BNE   LOCPNO              ERROR EXIT                                   
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     LOCPOK                                                           
*                                                                               
LOCPNO   B     NO                                                               
LOCPOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_NTHUNP LOCATE NTH UNPROTECTED FIELD - EXECUTE ROUTINE             *         
***********************************************************************         
         SPACE 1                                                                
LOCUEXEC NTR1                                                                   
*                                  GET FIELD # FROM SCRIPT                      
         GOTO1 LOADBYT,CRPARM,SCRIPLOC,BYTE                                     
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGFTH                
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE NTH UNPROT. FLD IN TWA           
         BNE   LOCUNO              ERROR EXIT                                   
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     LOCUOK                                                           
*                                                                               
LOCUNO   B     NO                                                               
LOCUOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_LOCNUM LOCATE A FIELD WITH FIELD NUMBER EXECUTE ROUTINE           *         
***********************************************************************         
         SPACE 1                                                                
LOCNEXEC NTR1                                                                   
*                                  GET FIELD NUMBER FROM SCRIPT                 
         GOTO1 LOADBYT,CRPARM,SCRIPLOC,BYTE                                     
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
         GOTO1 LTWANUM,CRPARM,BYTE LOCATE TWA FIELD WITH NUMBER                 
         BNE   LOCNNO              ERROR EXIT                                   
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     LOCNOK                                                           
*                                                                               
LOCNNO   B     NO                                                               
LOCNOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_LOCTXT LOCATE FIELD WITH TEXT COMPARE SCRIPT EXECUTE ROUTINE      *         
***********************************************************************         
         SPACE 1                                                                
LOCTEXEC NTR1                                                                   
*                                  GET COMPARE TEXT FROM SCRIPT                 
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,WORK,99                                  
         ICM   R5,15,0(R1)         SAVE LENGTH SCRIPT PARAMETER                 
         LR    RF,R5                                                            
         BCTR  RF,0                                                             
         BCTR  RF,0                SET LENGTH COMPARE TEXT                      
         GOTO1 LTWATXT,CRPARM,WORK,(RF) LOCATE TWA FIELD WITH THIS TEXT         
         BNE   LOCTNO              ERROR EXIT                                   
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     LOCTOK                                                           
*                                                                               
LOCTNO   B     NO                                                               
LOCTOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_LOCDIC LOCATE FIELD WITH DICTIONARY NUMBER EXECUTE ROUTINE        *         
***********************************************************************         
         SPACE 1                                                                
LOCDEXEC NTR1                                                                   
*                                  GET DICTIONARY NUMBER FROM SCRIPT            
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH SCRIPT PARAMETER                 
         GOTO1 LTWADIC,CRPARM,HALF LOCATE TWA FIELD WITH DICTIONARY#            
         BNE   LOCDNO              ERROR EXIT                                   
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     LOCDOK                                                           
*                                                                               
LOCDNO   B     NO                                                               
LOCDOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_LOCLBL LOCATE A FIELD WITH SYMBOLIC LABEL                         *         
***********************************************************************         
         SPACE 1                                                                
LOCLEXEC NTR1                                                                   
         XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING SYMTABD,R2          GET LABEL NAME FROM SCRIPT                   
         L     RF,SCRIPLOC                                                      
         MVC   SYTNAME,0(RF)                                                    
         MVI   BYTE,SYTTFLBQ                                                    
*                                  GET SYMBOLIC TABLE ENTRY FOR LABEL           
         GOTO1 LOADSLB,CRPARM,WORK,BYTE                                         
         BNE   LOCLNO                                                           
         ICM   RF,15,SYTADDR       GET ASSOCIATED TWA FIELD ADDRESS             
         STCM  RF,15,TWALOC                                                     
         MVI   TWAFOFF,0                                                        
         LA    R1,2                                                             
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     LOCLOK                                                           
*                                                                               
LOCLNO   B     NO                                                               
LOCLOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_LOCATB LOCATE NEXT TWA FIELD WITH ATRRIBUTE                       *         
***********************************************************************         
         SPACE 1                                                                
LOCAEXEC NTR1                                                                   
         GOTO1 LOADBYT,CRPARM,SCRIPLOC,BYTE                                     
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
         XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING FATTABD,R2                                                       
         MVC   FATVAL,BYTE                                                      
*                                  GET FIELD ATTRIBUTE TABLE ENTRY              
         GOTO1 GETFATT,CRPARM,WORK                                              
         BNE   LOCANO                                                           
         ICM   RF,15,FATTWA        GET ASSOCIATED TWA ADDRESS                   
         STCM  RF,15,TWALOC                                                     
         MVI   TWAFOFF,0                                                        
*                                  GET FIELD ATTRIBUTE TABLE ENTRY              
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     LOCAOK                                                           
*                                                                               
LOCANO   B     NO                                                               
LOCAOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_LOCWRK LOCATE A WORK AREA SYMBOLIC LABEL                          *         
***********************************************************************         
         SPACE 1                                                                
LOCWEXEC NTR1                                                                   
         XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING SYMTABD,R2          GET LABEL NAME FROM SCRIPT                   
         L     RF,SCRIPLOC                                                      
         MVC   SYTNAME,0(RF)                                                    
         MVI   BYTE,SYTTWLBQ                                                    
*                                  GET SYMBOLIC TABLE ENTRY FOR LABEL           
         GOTO1 LOADSLB,CRPARM,WORK,BYTE                                         
         BNE   LOCWNO                                                           
         ICM   RF,15,SYTADDR       GET ASSOCIATED WORK AREA ADDRESS             
         STCM  RF,15,SCWORKL                                                    
         LA    R1,2                                                             
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     LOCWOK                                                           
*                                                                               
LOCWNO   B     NO                                                               
LOCWOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_LOCCUR LOCATE A FIELD WITH CURRENT CURSOR POSITION                *         
***********************************************************************         
         SPACE 1                                                                
LOCCEXEC NTR1                                                                   
         L     R4,ATBUFF                                                        
         USING TBHDATA,R4                                                       
*                                                                               
         SR    R3,R3                                                            
         L     R5,ATWA                                                          
         LA    R5,64(R5)                                                        
         USING FLDHDRD,R5                                                       
*                                                                               
LOCC010  IC    R3,FLDLEN                                                        
         CH    R3,=H'9'                                                         
         BL    LOCCER1                                                          
         CLI   FLDATB,X'FF'                                                     
         BE    LOCC030                                                          
         OC    TBHCURD,TBHCURD                                                  
         BZ    LOCC020                                                          
         L     RF,ATWA                                                          
         LR    RE,R5                                                            
         SR    RE,RF                                                            
         CLM   RE,3,TBHCURD                                                     
         BE    LOCC100                                                          
         BH    LOCCOK                                                           
         B     LOCC030                                                          
*                                                                               
LOCC020  OC    TBHCURS,TBHCURS                                                  
         BZ    LOCCOK                                                           
         CLC   TBHCURS,FLDADR                                                   
         BL    LOCCOK                                                           
         SR    RF,RF                                                            
         IC    RF,FLDLEN                                                        
         SH    RF,=H'8'                                                         
         TM    FLDATB,FATBXHDR                                                  
         BZ    *+8                                                              
         SH    RF,=H'8'                                                         
         SR    R0,R0                                                            
         ICM   R0,3,FLDADR                                                      
         AR    RF,R0                                                            
         CLM   RF,3,TBHCURS                                                     
         BH    LOCC100                                                          
*                                                                               
LOCC030  AR    R5,R3               BUMP TO NEXT FIELD                           
         B     LOCC010                                                          
*                                                                               
LOCC100  ST    R5,TWALOC                                                        
         B     LOCCOK                                                           
*                                                                               
LOCCER1  MVC   ERRCODE,=Y(EQLTWN1)                                              
         B     LOCCNO                                                           
         DROP  R4,R5                                                            
*                                                                               
LOCCNO   B     NO                                                               
LOCCOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_LOCOFF LOCATE TO OFFSET IN TWA - EXECUTE ROUTINE                  *         
***********************************************************************         
         SPACE 1                                                                
LOCOEXEC NTR1                                                                   
*                                  GET HALF WORD OFFSET VALUE                   
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH SCRIPT PARAMETER                 
         L     RF,ATWA                                                          
         SR    RE,RE                                                            
         ICM   RE,3,HALF                                                        
         AR    RF,RE                                                            
         ST    RF,TWAMEM                                                        
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     LOCOOK              (AS OPOSED TO TWA FIELD)                     
*                                                                               
LOCONO   B     NO                                                               
LOCOOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_LBLS DEFINE A SCRIPT LABEL - EXECUTE ROUTINE                      *         
***********************************************************************         
         SPACE 1                                                                
DFSLEXEC NTR1                                                                   
         LA    R1,2                                                             
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     DFSEOK                                                           
*                                                                               
DFSENO   B     NO                                                               
DFSEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_LBLT DEFINE A TWA FIELD LABEL - EXECUTE ROUTINE                   *         
***********************************************************************         
         SPACE 1                                                                
DFFLEXEC NTR1                                                                   
         XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING SYMTABD,R2          GET LABEL NAME FROM SCRIPT                   
         L     RF,SCRIPLOC                                                      
         MVC   SYTNAME,0(RF)                                                    
         MVI   BYTE,SYTTFLBQ                                                    
         ICM   RF,15,TWALOC        GET CURRRENT TWA FIELD LOCATION              
         STCM  RF,15,SYTADDR       SAVE IN SYMBOL TABLE                         
         MVC   SYTTYPE,BYTE                                                     
         MVI   SYTINDS,0                                                        
*                                  SET SYMBOLIC TABLE ENTRY FOR LABEL           
         GOTO1 SETSLB,CRPARM,WORK,BYTE                                          
         BNE   DFFENO                                                           
         LA    R1,2                                                             
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     DFFEOK                                                           
*                                                                               
DFFENO   B     NO                                                               
DFFEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_LBLW DEFINE A WORK AREA LABEL - EXECUTE ROUTINE                   *         
***********************************************************************         
         SPACE 1                                                                
DFWLEXEC NTR1                                                                   
         XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING SYMTABD,R2          GET LABEL NAME FROM SCRIPT                   
         L     RF,SCRIPLOC                                                      
         MVC   SYTNAME,0(RF)                                                    
         MVI   BYTE,SYTTWLBQ                                                    
         ICM   RF,15,SCWORKL       GET CURRENT WORK AREA LOCATION               
         STCM  RF,15,SYTADDR       SAVE IN SYMBOL TABLE                         
         MVC   SYTTYPE,BYTE                                                     
         MVI   SYTINDS,0                                                        
*                                  SET SYMBOLIC TABLE ENTRY FOR LABEL           
         GOTO1 SETSLB,CRPARM,WORK,BYTE                                          
         BNE   DFWENO                                                           
         LA    R1,2                                                             
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     DFWEOK                                                           
*                                                                               
DFWENO   B     NO                                                               
DFWEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_ATBT DEFINE A TWA FIELD ATTRIBUTE - EXECUTE ROUTINE               *         
***********************************************************************         
         SPACE 1                                                                
DFFAEXEC NTR1                                                                   
         GOTO1 LOADBYT,CRPARM,SCRIPLOC,BYTE                                     
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
*                                  GET SYMBOLIC TABLE ENTRY FOR LABEL           
         GOTO1 PUTFATT,CRPARM,BYTE                                              
         BNE   DFAENO                                                           
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     DFAEOK                                                           
*                                                                               
DFAENO   B     NO                                                               
DFAEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_BR BRANCH TO LABEL UNCONDITIONALLY EXECUTE ROUTINE                *         
***********************************************************************         
         SPACE 1                                                                
BRANEXEC NTR1                                                                   
         BAS   RE,DECUNT           DECREMENT LOOP COUNT                         
         BNE   BRAENO                                                           
         XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING SYMTABD,R2          GET LABEL NAME FROM SCRIPT                   
         L     RF,SCRIPLOC                                                      
         MVC   SYTNAME,0(RF)                                                    
         MVI   BYTE,SYTTSLBQ                                                    
*                                  GET SYMBOLIC TABLE ENTRY FOR LABEL           
         GOTO1 LOADSLB,CRPARM,WORK,BYTE                                         
         BNE   BRAENO                                                           
         ICM   RF,15,SYTADDR       GET ASSOCIATED SCRIPT ADDRESS                
         ST    RF,SCRIPLOC         MOVE INTO SCRIPLOC                           
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    BRAEOK                                                           
*                                  LOG BRANCH EVENT FOR TRACE                   
         GOTO1 LOGBR,CRPARM,SYTNAME                                             
         B     BRAEOK                                                           
         DROP  R2                                                               
*                                                                               
BRAENO   B     NO                                                               
BRAEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_BE BRANCH TO A LABEL IF EQUAL EXECUTE ROUTINE                     *         
***********************************************************************         
         SPACE 1                                                                
BREQEXEC NTR1                                                                   
         BAS   RE,DECUNT           DECREMENT LOOP COUNT                         
         BNE   BREENO                                                           
         TM    CONDCODE,CCEQUALQ   TEST CONDITION CODE EQUAL                    
         BO    BREE010                                                          
         LA    R1,2                GET LENGTH SCRIPT PARAMETER                  
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     BREEOK                                                           
*                                  HERE IF CC EQUAL                             
BREE010  XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING SYMTABD,R2          GET LABEL NAME FROM SCRIPT                   
         L     RF,SCRIPLOC                                                      
         MVC   SYTNAME,0(RF)                                                    
         MVI   BYTE,SYTTSLBQ                                                    
*                                  GET SYMBOLIC TABLE ENTRY FOR LABEL           
         GOTO1 LOADSLB,CRPARM,WORK,BYTE                                         
         BNE   BREENO                                                           
         ICM   RF,15,SYTADDR       GET ASSOCIATED SCRIPT ADDRESS                
         ST    RF,SCRIPLOC         MOVE INTO SCRIPLOC                           
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    BREEOK                                                           
*                                  LOG BRANCH EVENT FOR TRACE                   
         GOTO1 LOGBR,CRPARM,SYTNAME                                             
         B     BREEOK                                                           
         DROP  R2                                                               
*                                                                               
BREENO   B     NO                                                               
BREEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_BNE BRANCH TO A LABEL IF NOT EQUAL EXECUTE ROUTINE                *         
***********************************************************************         
         SPACE 1                                                                
BRNEEXEC NTR1                                                                   
         BAS   RE,DECUNT           DECREMENT LOOP COUNT                         
         BNE   BRNENO                                                           
         TM    CONDCODE,CCEQUALQ   TEST CONDITION CODE EQUAL                    
         BZ    BRNE010                                                          
         LA    R1,2                                                             
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     BRNEOK                                                           
*                                  HERE IF CC NOT EQUAL                         
BRNE010  XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING SYMTABD,R2          GET LABEL NAME FROM SCRIPT                   
         L     RF,SCRIPLOC                                                      
         MVC   SYTNAME,0(RF)                                                    
         MVI   BYTE,SYTTSLBQ                                                    
*                                  GET SYMBOLIC TABLE ENTRY FOR LABEL           
         GOTO1 LOADSLB,CRPARM,WORK,BYTE                                         
         BNE   BRNENO                                                           
         ICM   RF,15,SYTADDR       GET ASSOCIATED SCRIPT ADDRESS                
         ST    RF,SCRIPLOC         MOVE INTO SCRIPLOC                           
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    BRNEOK                                                           
*                                  LOG BRANCH EVENT FOR TRACE                   
         GOTO1 LOGBR,CRPARM,SYTNAME                                             
         B     BRNEOK                                                           
         DROP  R2                                                               
*                                                                               
BRNENO   B     NO                                                               
BRNEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_BH BRANCH TO A LABEL IF HIGHER EXECUTE ROUTINE                    *         
***********************************************************************         
         SPACE 1                                                                
BRHIEXEC NTR1                                                                   
         BAS   RE,DECUNT           DECREMENT LOOP COUNT                         
         BNE   BHIENO                                                           
         TM    CONDCODE,CCHIGHQ    TEST CONDITION CODE HIGHER                   
         BO    BHIE010                                                          
         LA    R1,2                GET LENGTH SCRIPT PARAMETER                  
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     BHIEOK                                                           
*                                  HERE IF CC EQUAL                             
BHIE010  XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING SYMTABD,R2          GET LABEL NAME FROM SCRIPT                   
         L     RF,SCRIPLOC                                                      
         MVC   SYTNAME,0(RF)                                                    
         MVI   BYTE,SYTTSLBQ                                                    
*                                  GET SYMBOLIC TABLE ENTRY FOR LABEL           
         GOTO1 LOADSLB,CRPARM,WORK,BYTE                                         
         BNE   BHIENO                                                           
         ICM   RF,15,SYTADDR       GET ASSOCIATED SCRIPT ADDRESS                
         ST    RF,SCRIPLOC         MOVE INTO SCRIPLOC                           
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    BHIEOK                                                           
*                                  LOG BRANCH EVENT FOR TRACE                   
         GOTO1 LOGBR,CRPARM,SYTNAME                                             
         B     BHIEOK                                                           
         DROP  R2                                                               
*                                                                               
BHIENO   B     NO                                                               
BHIEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_BL BRANCH TO A LABEL IF LOWER EXECUTE ROUTINE                     *         
***********************************************************************         
         SPACE 1                                                                
BRLOEXEC NTR1                                                                   
         BAS   RE,DECUNT           DECREMENT LOOP COUNT                         
         BNE   BLOENO                                                           
         TM    CONDCODE,CCLOWQ     TEST CONDITION CODE LOWER                    
         BO    BLOE010                                                          
         LA    R1,2                GET LENGTH SCRIPT PARAMETER                  
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     BLOEOK                                                           
*                                  HERE IF CC EQUAL                             
BLOE010  XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING SYMTABD,R2          GET LABEL NAME FROM SCRIPT                   
         L     RF,SCRIPLOC                                                      
         MVC   SYTNAME,0(RF)                                                    
         MVI   BYTE,SYTTSLBQ                                                    
*                                  GET SYMBOLIC TABLE ENTRY FOR LABEL           
         GOTO1 LOADSLB,CRPARM,WORK,BYTE                                         
         BNE   BLOENO                                                           
         ICM   RF,15,SYTADDR       GET ASSOCIATED SCRIPT ADDRESS                
         ST    RF,SCRIPLOC         MOVE INTO SCRIPLOC                           
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    BLOEOK                                                           
*                                  LOG BRANCH EVENT FOR TRACE                   
         GOTO1 LOGBR,CRPARM,SYTNAME                                             
         B     BLOEOK                                                           
         DROP  R2                                                               
*                                                                               
BLOENO   B     NO                                                               
BLOEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_BNH BRANCH TO A LABEL IF NOT HIGHER EXECUTE ROUTINE               *         
***********************************************************************         
         SPACE 1                                                                
BRNHEXEC NTR1                                                                   
         BAS   RE,DECUNT           DECREMENT LOOP COUNT                         
         BNE   BNHENO                                                           
         TM    CONDCODE,CCHIGHQ    TEST CONDITION CODE NOT HIGHER               
         BZ    BNHE010                                                          
         LA    R1,2                GET LENGTH SCRIPT PARAMETER                  
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     BNHEOK                                                           
*                                  HERE IF CC EQUAL                             
BNHE010  XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING SYMTABD,R2          GET LABEL NAME FROM SCRIPT                   
         L     RF,SCRIPLOC                                                      
         MVC   SYTNAME,0(RF)                                                    
         MVI   BYTE,SYTTSLBQ                                                    
*                                  GET SYMBOLIC TABLE ENTRY FOR LABEL           
         GOTO1 LOADSLB,CRPARM,WORK,BYTE                                         
         BNE   BNHENO                                                           
         ICM   RF,15,SYTADDR       GET ASSOCIATED SCRIPT ADDRESS                
         ST    RF,SCRIPLOC         MOVE INTO SCRIPLOC                           
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    BNHEOK                                                           
*                                  LOG BRANCH EVENT FOR TRACE                   
         GOTO1 LOGBR,CRPARM,SYTNAME                                             
         B     BNHEOK                                                           
         DROP  R2                                                               
*                                                                               
BNHENO   B     NO                                                               
BNHEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_BNL BRANCH TO A LABEL IF NOT LOWER EXECUTE ROUTINE                *         
***********************************************************************         
         SPACE 1                                                                
BRNLEXEC NTR1                                                                   
         BAS   RE,DECUNT           DECREMENT LOOP COUNT                         
         BNE   BNLENO                                                           
         TM    CONDCODE,CCLOWQ     TEST CONDITION CODE NOT LOWER                
         BZ    BNLE010                                                          
         LA    R1,2                GET LENGTH SCRIPT PARAMETER                  
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     BNLEOK                                                           
*                                  HERE IF CC EQUAL                             
BNLE010  XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING SYMTABD,R2          GET LABEL NAME FROM SCRIPT                   
         L     RF,SCRIPLOC                                                      
         MVC   SYTNAME,0(RF)                                                    
         MVI   BYTE,SYTTSLBQ                                                    
*                                  GET SYMBOLIC TABLE ENTRY FOR LABEL           
         GOTO1 LOADSLB,CRPARM,WORK,BYTE                                         
         BNE   BNLENO                                                           
         ICM   RF,15,SYTADDR       GET ASSOCIATED SCRIPT ADDRESS                
         ST    RF,SCRIPLOC         MOVE INTO SCRIPLOC                           
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    BNLEOK                                                           
*                                  LOG BRANCH EVENT FOR TRACE                   
         GOTO1 LOGBR,CRPARM,SYTNAME                                             
         B     BNLEOK                                                           
         DROP  R2                                                               
*                                                                               
BNLENO   B     NO                                                               
BNLEOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* DECREMENT SCRIPT LOOP COUNT                                         *         
***********************************************************************         
         SPACE 1                                                                
DECUNT   NTR1                                                                   
         ICM   RF,15,LOOPCUNT                                                   
         BCTR  RF,0                                                             
         LTR   RF,RF                                                            
         BZ    DECUER1                                                          
         STCM  RF,15,LOOPCUNT                                                   
         B     DECUOK                                                           
*                                                                               
DECUER1  MVC   ERRCODE,=Y(EQDECU1)                                              
         B     DECUNO                                                           
*                                                                               
DECUNO   B     NO                                                               
DECUOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_CMIS COMPARE INPUT AREA TO DATA IN SCRIPT PARAMETER               *         
***********************************************************************         
         SPACE 1                                                                
COISEXEC NTR1                                                                   
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET DATA STRING FROM SCRIPT                  
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,WORK,99                                  
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         LR    RF,R5                                                            
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         LTR   RF,RF                                                            
         BZ    CISE020                                                          
         L     R1,INDATRDL         GET CURRENT INPUT DATA LOCATION              
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                COMPARE WITH SCRIPT DATA                     
         CLC   0(0,R1),WORK          AND SET CONDITION CODE                     
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     CISE010                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     CISE010                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
CISE010  EQU   *                                                                
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    CISE020                                                          
*                                  LOG COMPARE EVENT FOR TRACE                  
         LA    RF,1(RF)                                                         
         GOTO1 LOGCMP,CRPARM,(RF),INDATRDL,WORK                                 
*                                                                               
CISE020  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         GOTO1 BUMPSLOC,(R5)                                                    
         B     CISEOK                                                           
*                                                                               
CISENO   B     NO                                                               
CISEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_CMIF COMPARE INPUT AREA FIELD TO DATA IN SCRIPT PARAMETER         *         
*  - THE WHOLE WIDTH OF THE FIELD IS COMPARED                         *         
***********************************************************************         
         SPACE 1                                                                
COIFEXEC NTR1                                                                   
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET DATA STRING FROM SCRIPT                  
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,WORK,99                                  
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         LR    RF,R5                                                            
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         LR    RE,RF                                                            
         L     R1,INDATRDL         TEST FIELD FITS LENGTH                       
*                                  SEARCH FOR NEXT FIELD SEPARATOR              
CIFE010  CLC   0(1,R1),EOD         UNTIL END OF DATA FOUND                      
         BE    CIFE020                                                          
         CLC   0(1,R1),FLDSEP      TEST FOR SEPARATOR CHARACTER                 
         BE    CIFE020                                                          
         LA    R1,1(R1)            LOOP TO NEXT CHARATER IN INPUT               
         BCTR  RF,0                                                             
         B     CIFE010                                                          
*                                                                               
CIFE020  LTR   RF,RF                                                            
         BNZ   CIFE110                                                          
         LTR   RE,RE                                                            
         BZ    CIFE110                                                          
         L     R1,INDATRDL         GET CURRENT INPUT DATA LOCATION              
         LR    RF,RE                                                            
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                COMPARE WITH SCRIPT DATA                     
         CLC   0(0,R1),WORK          AND SET CONDITION CODE                     
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     CIFE100                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     CIFE100                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
CIFE100  EQU   *                                                                
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    CIFE110                                                          
*                                  LOG COMPARE EVENT FOR TRACE                  
         LA    RF,1(RF)                                                         
         GOTO1 LOGCMP,CRPARM,(RF),INDATRDL,WORK                                 
*                                                                               
CIFE110  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         GOTO1 BUMPSLOC,(R5)                                                    
         B     CIFEOK                                                           
*                                                                               
CIFENO   B     NO                                                               
CIFEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_CMWS COMPARE WORK AREA TO DATA IN SCRIPT PARAMETER                *         
***********************************************************************         
         SPACE 1                                                                
COWSEXEC NTR1                                                                   
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET DATA STRING FROM SCRIPT                  
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,WORK,99                                  
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         LR    RF,R5                                                            
         BCTR  RF,0                                                             
         BCTR  RF,0                GET TEXT FROM CURRENT TWA FIELD              
         LTR   RF,RF                                                            
         BZ    CWSE020                                                          
         L     R1,SCWORKL          GET CURRENT WORK AREA DATA LOCATION          
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                COMPARE WITH SCRIPT DATA                     
         CLC   0(0,R1),WORK          AND SET CONDITION CODE                     
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     CWSE010                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     CWSE010                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
CWSE010  EQU   *                                                                
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    CWSE020                                                          
*                                  LOG COMPARE EVENT FOR TRACE                  
         LA    RF,1(RF)                                                         
         GOTO1 LOGCMP,CRPARM,(RF),SCWORKL,WORK                                  
*                                                                               
CWSE020  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         GOTO1 BUMPSLOC,(R5)                                                    
         B     CWSEOK                                                           
*                                                                               
CWSENO   B     NO                                                               
CWSEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_CMWF COMPARE WORK AREA TO DATA IN CURRENT TWA FIELD               *         
***********************************************************************         
         SPACE 1                                                                
COWFEXEC NTR1                                                                   
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                                                               
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         ICM   RF,3,HALF           MOVE DATA FROM CURRENT TWA FIELD             
         LTR   RF,RF                                                            
         BZ    CWFE020                                                          
         GOTO1 GETTWA,CRPARM,WORK,(RF)  TO SAVE AREA                            
         BNE   CWFENO              ERROR EXIT                                   
         L     R1,SCWORKL          GET CURRENT WORK AREA DATA LOCATION          
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                COMPARE WITH FIELD DATA                      
         CLC   0(0,R1),WORK          AND SET CONDITION CODE                     
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     CWFE010                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     CWFE010                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
CWFE010  EQU   *                                                                
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    CWFE020                                                          
*                                  LOG COMPARE EVENT FOR TRACE                  
         LA    RF,1(RF)                                                         
         GOTO1 LOGCMP,CRPARM,(RF),SCWORKL,WORK                                  
*                                                                               
CWFE020  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         GOTO1 BUMPSLOC,(R5)                                                    
         B     CWFEOK                                                           
*                                                                               
CWFENO   B     NO                                                               
CWFEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_CMIP COMPARE INPUT AREA DATA READ POINTER TO VALUE                *         
***********************************************************************         
         SPACE 1                                                                
COIPEXEC NTR1                                                                   
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET DATA STRING FROM SCRIPT                  
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,INDATRDL         CURRENT INPUT AREA LOCATION                  
         S     RF,ASCRIPID         GET ADDRESS START OF INPUT AREA              
         CH    RF,HALF             COMPARE INPUT POINTER TO PARAMETER           
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     CIPE010                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     CIPE010                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
CIPE010  GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     CIPEOK                                                           
*                                                                               
CIPENO   B     NO                                                               
CIPEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_INPS ENTER DATA INTO TWA DIRECT FROM SCRIPT PARAMETER             *         
***********************************************************************         
         SPACE 1                                                                
ETISEXEC NTR1                                                                   
*                                  GET DATA STRING FROM SCRIPT                  
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,WORK,99                                  
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         LR    RF,R5                                                            
         BCTR  RF,0                                                             
         BCTR  RF,0                LOAD DATA INTO CURRENT TWA FIELD             
         STCM  RF,3,HALF                                                        
         GOTO1 LOADFLD,CRPARM,WORK,(RF)                                         
         BNE   ETISNO              ERROR EXIT                                   
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    ETIS010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         GOTO1 LOGMOV,CRPARM,(RF),WORK                                          
*                                                                               
ETIS010  EQU   *                                                                
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     ETISOK                                                           
*                                                                               
ETISNO   B     NO                                                               
ETISOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_OUTS MOVE DATA INTO SCRIPT FROM TWA                               *         
***********************************************************************         
         SPACE 1                                                                
MTOSEXEC NTR1                                                                   
         L     R2,SCRIPLOC         GET 2 BYTE LENGTH FROM SCRIPT                
         PACK  DUB,0(2,R2)                                                      
         CVB   RF,DUB                                                           
         LA    R5,2(RF)            SAVE LENGTH OF SCRIPT PARAMETER              
         LA    R2,2(R2)            R2=LOCATION IN SCRIPT TO OUTPUT DATA         
*                                  MOVE DATA FROM CURRENT TWA FIELD             
         GOTO1 GETTWA,CRPARM,(R2),(RF) INTO SCRIPT                              
         BNE   MTOSNO              ERROR EXIT                                   
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     MTOSOK                                                           
*                                                                               
MTOSNO   B     NO                                                               
MTOSOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_INPI ENTER DATA INTO TWA FROM INPUT DATA AREA                     *         
***********************************************************************         
         SPACE 1                                                                
ETIDEXEC NTR1                                                                   
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         ICM   RF,3,HALF           MOVE DATA FROM CURRENT LOCATION IN           
         GOTO1 LOADFLD,CRPARM,INDATRDL,(RF) INPUT TO CURRENT TWA FIELD          
         BNE   ETIDNO              ERROR EXIT                                   
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    ETID010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         GOTO1 LOGMOV,CRPARM,(RF),INDATRDL                                      
*                                                                               
ETID010  EQU   *                                                                
         L     RF,INDATRDL         MOVE INPUT DATA AREA LOCATION                
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,INDATRDL                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     ETIDOK                                                           
*                                                                               
ETIDNO   B     NO                                                               
ETIDOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_OUTO MOVE DATA FROM TWA INTO OUTPUT DATA AREA                     *         
***********************************************************************         
         SPACE 1                                                                
MTODEXEC NTR1                                                                   
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         GOTO1 TSTOUT,CRPARM,HALF  TEST OUTPUT DATA AREA OVERFLOW               
         BNE   MTODNO              EXIT IF ERROR                                
         SR    RF,RF                                                            
         ICM   RF,3,HALF           MOVE DATA FROM CURRENT TWA FIELD             
         GOTO1 GETTWA,CRPARM,OUDATLOC,(RF) TO CURRENT LOCN. IN OUTPUT           
         BNE   MTODNO              ERROR EXIT                                   
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    MTOD010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         GOTO1 LOGMOV,CRPARM,(RF),OUDATLOC                                      
*                                                                               
MTOD010  EQU   *                                                                
         L     RF,OUDATLOC         MOVE OUTPUT DATA AREA LOCATION               
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,OUDATLOC                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     MTODOK                                                           
*                                                                               
MTODNO   B     NO                                                               
MTODOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_INPIF ENTER DATA INTO TWA FROM INPUT DATA FIELD AND SET INPUT     *         
* LOCATION TO NEXT FIELD                                              *         
***********************************************************************         
         SPACE 1                                                                
ETIFEXEC NTR1                                                                   
         L     RF,INDATRDL         GET LOCATION OF NEXT FIELD                   
*                                  SEARCH FOR NEXT FIELD SEPARATOR              
ETIF010  CLC   0(1,RF),EOD         UNTIL END OF DATA FOUND                      
         BE    ETIFOK                                                           
         CLC   0(1,RF),FLDSEP      TEST FOR SEPARATOR CHARACTER                 
         BE    ETIF020                                                          
         LA    RF,1(RF)            LOOP TO NEXT CHARATER IN INPUT               
         B     ETIF010                                                          
*                                                                               
ETIF020  LA    R5,1(RF)            SAVE LOCATION OF NEXT INPUT FIELD            
         S     RF,INDATRDL         RF=LENGTH THIS INPUT FIELD                   
         STCM  RF,3,HALF                                                        
*                                  MOVE DATA FROM THIS INPUT FIELD              
         GOTO1 LOADFLD,CRPARM,INDATRDL,(RF) TO CURRENT TWA FIELD                
         BNE   ETIFNO              ERROR EXIT                                   
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    ETIF100                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         GOTO1 LOGMOV,CRPARM,(RF),INDATRDL                                      
*                                                                               
ETIF100  EQU   *                                                                
         ST    R5,INDATRDL         SET INPUT LOCATION TO NEXT FIELD             
         B     ETIFOK                                                           
*                                                                               
ETIFNO   B     NO                                                               
ETIFOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_NXTIF SET INPUT LOCATION TO NEXT FIELD                            *         
***********************************************************************         
         SPACE 1                                                                
NXIFEXEC NTR1                                                                   
         L     RF,INDATRDL         GET LOCATION OF NEXT FIELD                   
*                                  SEARCH FOR NEXT FIELD SEPARATOR              
NXIF010  CLC   0(1,RF),EOD         UNTIL END OF DATA FOUND                      
         BE    NXIFOK                                                           
         CLC   0(1,RF),FLDSEP      TEST FOR SEPARATOR CHARACTER                 
         BE    NXIF020                                                          
         LA    RF,1(RF)            LOOP TO NEXT CHARATER IN INPUT               
         B     NXIF010                                                          
*                                                                               
NXIF020  LA    R5,1(RF)            SAVE LOCATION OF NEXT INPUT FIELD            
         ST    R5,INDATRDL         SET INPUT LOCATION TO NEXT FIELD             
         B     NXIFOK                                                           
*                                                                               
NXIFNO   B     NO                                                               
NXIFOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_OUTOF MOVE DATA INTO OUTPUT AREA FIELD FROM TWA AND SET OUTPUT    *         
* LOCATION TO NEXT FIELD                                              *         
***********************************************************************         
         SPACE 1                                                                
MTOFEXEC NTR1                                                                   
         XC    WORK,WORK                                                        
         LA    RF,L'WORK           MOVE DATA FROM CURRENT TWA FIELD             
         GOTO1 GETTWA,CRPARM,WORK,(RF) TO WORK AREA                             
         BNE   MTOFNO              ERROR EXIT                                   
         L     R5,0(R1)                                                         
         STH   R5,HALF                                                          
         GOTO1 TSTOUT,CRPARM,HALF  CHECK OUTPUT DATA AREA OVERFLOW              
         BNE   MTOFNO              EXIT IF ERROR                                
         L     RF,OUDATLOC         MOVE DATA TO OUTPUT AREA                     
         BCTR  R5,0                                                             
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   0(0,RF),WORK                                                     
         LA    RF,1(R5,RF)         POSITION TO END OF OUTPUT FIELD              
         MVC   0(1,RF),FLDSEP      OUTPUT FIELD SEPARATOR CHARACTER             
         LA    RF,1(RF)            BUMP PAST FIELD SEPARATOR                    
         ST    RF,OUDATLOC                                                      
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    MTOF010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         GOTO1 LOGMOV,CRPARM,(RF),WORK                                          
*                                                                               
MTOF010  EQU   *                                                                
         B     MTOFOK                                                           
*                                                                               
MTOFNO   B     NO                                                               
MTOFOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_OUTI MOVE DATA FROM TWA INTO INPUT DATA AREA                      *         
***********************************************************************         
         SPACE 1                                                                
MTIDEXEC NTR1                                                                   
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         GOTO1 TSTINP,CRPARM,HALF  CHECK INPUT DATA AREA OVERFLOW               
         BNE   MTIDNO              EXIT IF ERROR                                
         SR    RF,RF                                                            
         ICM   RF,3,HALF           MOVE DATA FROM CURRENT TWA FIELD             
         GOTO1 GETTWA,CRPARM,INDATWRL,(RF) TO CURRENT INPUT WRITE LOCN.         
         BNE   MTIDNO              ERROR EXIT                                   
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    MTID010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         GOTO1 LOGMOV,CRPARM,(RF),INDATWRL                                      
*                                                                               
MTID010  EQU   *                                                                
         L     RF,INDATWRL         MOVE INPUT DATA AREA WRITE                   
         AH    RF,HALF               LOCATION TO NEXT POSITION                  
         ST    RF,INDATWRL                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     MTIDOK                                                           
*                                                                               
MTIDNO   B     NO                                                               
MTIDOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_OUTW MOVE DATA FROM TWA INTO WORK AREA                            *         
***********************************************************************         
         SPACE 1                                                                
MTOWEXEC NTR1                                                                   
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
*        GOTO1 TSTOUT,CRPARM,HALF  TEST WORK DATA AREA OVERFLOW                 
*        BNE   MTOWNO              EXIT IF ERROR                                
         SR    RF,RF                                                            
         ICM   RF,3,HALF           MOVE DATA FROM CURRENT TWA FIELD             
         GOTO1 GETTWA,CRPARM,SCWORKL,(RF) TO CURRENT LOCN. IN WORK              
         BNE   MTOWNO              ERROR EXIT                                   
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    MTOW010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         GOTO1 LOGMOV,CRPARM,(RF),SCWORKL                                       
*                                                                               
MTOW010  EQU   *                                                                
         L     RF,SCWORKL          MOVE WORK AREA LOCATION                      
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,SCWORKL                                                       
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     MTOWOK                                                           
*                                                                               
MTOWNO   B     NO                                                               
MTOWOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_INPW ENTER DATA INTO TWA FIELD FROM SCRIPT WORK AREA              *         
***********************************************************************         
         SPACE 1                                                                
ETWLEXEC NTR1                                                                   
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         ICM   RF,3,HALF           MOVE DATA FROM CURRENT LOCN. IN WORK         
         GOTO1 LOADFLD,CRPARM,SCWORKL,(RF) AREA TO CURRENT TWA FIELD            
         BNE   ETWLNO              ERROR EXIT                                   
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    ETWL010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         GOTO1 LOGMOV,CRPARM,(RF),SCWORKL                                       
*                                                                               
ETWL010  EQU   *                                                                
         L     RF,SCWORKL          MOVE WORK AREA LOCATION                      
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,SCWORKL                                                       
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     ETWLOK                                                           
*                                                                               
ETWLNO   B     NO                                                               
ETWLOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_MVIO MOVE DATA FROM INPUT DATA AREA TO OUTPUT DATA AREA           *         
***********************************************************************         
         SPACE 1                                                                
MVIOEXEC NTR1                                                                   
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         GOTO1 TSTOUT,CRPARM,HALF  CHECK OUTPUT DATA AREA OVERFLOW              
         BNE   MVIONO              EXIT IF ERROR                                
         SR    RF,RF                                                            
         L     R1,OUDATLOC                                                      
         L     RE,INDATRDL                                                      
         ICM   RF,3,HALF           MOVE DATA FROM INPUT TO OUTPUT AREA          
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),0(RE)                                                    
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    MVIO010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         LA    RF,1(RF)                                                         
         GOTO1 LOGMOV,CRPARM,(RF),OUDATLOC                                      
*                                                                               
MVIO010  EQU   *                                                                
         L     RF,INDATRDL         MOVE INPUT DATA AREA LOCATION TO             
         AH    RF,HALF               NEXT POSITION                              
         ST    RF,INDATRDL                                                      
         L     RF,OUDATLOC         MOVE OUTPUT DATA AREA LOCATION               
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,OUDATLOC                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     MVIOOK                                                           
*                                                                               
MVIONO   B     NO                                                               
MVIOOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_MVIW MOVE DATA FROM INPUT DATA AREA TO CURRENT POSN. IN WORK AREA *         
***********************************************************************         
         SPACE 1                                                                
MVIWEXEC NTR1                                                                   
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         L     R1,SCWORKL                                                       
         L     RE,INDATRDL                                                      
         ICM   RF,3,HALF           MOVE DATA FROM INPUT TO WORK AREA            
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),0(RE)                                                    
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    MVIW010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         LA    RF,1(RF)                                                         
         GOTO1 LOGMOV,CRPARM,(RF),SCWORKL                                       
*                                                                               
MVIW010  EQU   *                                                                
         L     RF,INDATRDL         MOVE INPUT DATA AREA LOCATION TO             
         AH    RF,HALF               NEXT POSITION                              
         ST    RF,INDATRDL                                                      
         L     RF,SCWORKL          MOVE WORK AREA LOCATION                      
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,SCWORKL                                                       
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     MVIWOK                                                           
*                                                                               
MVIWNO   B     NO                                                               
MVIWOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_MVWO MOVE DATA FROM CURRENT POSN. IN WORK AREA TO OUTPUT AREA     *         
***********************************************************************         
         SPACE 1                                                                
MVWOEXEC NTR1                                                                   
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         GOTO1 TSTOUT,CRPARM,HALF  CHECK OUTPUT DATA AREA OVERFLOW              
         BNE   MVWONO              EXIT IF ERROR                                
         SR    RF,RF                                                            
         L     R1,OUDATLOC                                                      
         L     RE,SCWORKL                                                       
         ICM   RF,3,HALF           MOVE DATA FROM WORK TO OUTPUT AREA           
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),0(RE)                                                    
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    MVWO010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         LA    RF,1(RF)                                                         
         GOTO1 LOGMOV,CRPARM,(RF),OUDATLOC                                      
*                                                                               
MVWO010  EQU   *                                                                
         L     RF,SCWORKL          MOVE WORK AREA LOCATION TO                   
         AH    RF,HALF               NEXT POSITION                              
         ST    RF,SCWORKL                                                       
         L     RF,OUDATLOC         MOVE OUTPUT DATA AREA LOCATION               
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,OUDATLOC                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     MVWOOK                                                           
*                                                                               
MVWONO   B     NO                                                               
MVWOOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_MVSO MOVE DATA FROM SCRIPT TO OUTPUT DATA AREA                    *         
***********************************************************************         
         SPACE 1                                                                
MVSOEXEC NTR1                                                                   
*                                  GET DATA STRING FROM SCRIPT                  
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,WORK,99                                  
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         LR    RF,R5                                                            
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         STCM  RF,3,HALF                                                        
         GOTO1 TSTOUT,CRPARM,HALF  CHECK OUTPUT DATA AREA OVERFLOW              
         BNE   MVSONO              EXIT IF ERROR                                
         SR    RF,RF                                                            
         L     R1,OUDATLOC                                                      
         LA    RE,WORK                                                          
         ICM   RF,3,HALF           MOVE DATA FROM SCRIPT TO OUTPUT AREA         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),0(RE)                                                    
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    MVSO010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         GOTO1 LOGMOV,CRPARM,(RF),OUDATLOC                                      
*                                                                               
MVSO010  EQU   *                                                                
         L     RF,OUDATLOC         MOVE OUTPUT DATA AREA LOCATION               
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,OUDATLOC                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     MVSOOK                                                           
*                                                                               
MVSONO   B     NO                                                               
MVSOOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_MVSI MOVE DATA FROM SCRIPT TO INPUT DATA AREA                     *         
***********************************************************************         
         SPACE 1                                                                
MVSIEXEC NTR1                                                                   
*                                  GET DATA STRING FROM SCRIPT                  
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,WORK,99                                  
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         LR    RF,R5                                                            
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         STCM  RF,3,HALF                                                        
*                                  CHECK INPUT DATA AREA OVERFLOW               
         SR    RF,RF                                                            
         L     R1,INDATRDL                                                      
         LA    RE,WORK                                                          
         ICM   RF,3,HALF           MOVE DATA FROM SCRIPT TO INPUT AREA          
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),0(RE)                                                    
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    MVSI010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         GOTO1 LOGMOV,CRPARM,(RF),WORK                                          
*                                                                               
MVSI010  EQU   *                                                                
         L     RF,INDATRDL         MOVE INPUT DATA AREA READ LOCATION           
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,INDATRDL                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     MVSIOK                                                           
*                                                                               
MVSIER1  MVC   ERRCODE,=Y(EQTINP1)                                              
         B     MVSINO                                                           
*                                                                               
MVSINO   B     NO                                                               
MVSIOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_MVSW MOVE DATA FROM SCRIPT TO WORK AREA                           *         
***********************************************************************         
         SPACE 1                                                                
MVSWEXEC NTR1                                                                   
*                                  GET DATA STRING FROM SCRIPT                  
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,WORK,99                                  
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         LR    RF,R5                                                            
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         STCM  RF,3,HALF                                                        
*                                                                               
         SR    RF,RF                                                            
         L     R1,SCWORKL                                                       
         LA    RE,WORK                                                          
         ICM   RF,3,HALF           MOVE DATA FROM INPUT TO WORK AREA            
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),0(RE)                                                    
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    MVSW010                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         GOTO1 LOGMOV,CRPARM,(RF),WORK                                          
*                                                                               
MVSW010  EQU   *                                                                
         L     RF,SCWORKL          MOVE WORK AREA LOCATION                      
         AH    RF,HALF               TO NEXT POSITION                           
         ST    RF,SCWORKL                                                       
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     MVSWOK                                                           
*                                                                               
MVSWNO   B     NO                                                               
MVSWOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_CURO MOVE CURSOR POSITION TO OUTPUT AREA - EXECUTE ROUTINE        *         
***********************************************************************         
         SPACE 1                                                                
CTODEXEC NTR1                                                                   
         BAS   RE,GETCURP                                                       
         BAS   RE,GETFPOS                                                       
         LA    RF,L'CURPOS+L'FLDPOS                                             
         STH   RF,HALF                                                          
         GOTO1 TSTOUT,CRPARM,HALF  CHECK OUTPUT DATA AREA OVERFLOW              
         BNE   CTODNO              EXIT IF ERROR                                
         L     R1,OUDATLOC         MOVE CURSOR POSITION TO TWA FIELD            
         MVC   0(L'CURPOS,R1),CURPOS                                            
         MVC   L'CURPOS(L'FLDPOS,R1),FLDPOS                                     
         L     RF,OUDATLOC         MOVE OUTPUT DATA AREA LOCATION               
         AH    RF,=AL2(L'CURPOS+L'FLDPOS)  TO NEXT POSITION                     
         ST    RF,OUDATLOC                                                      
         B     CTODOK                                                           
*                                                                               
CTODNO   B     NO                                                               
CTODOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_CUROF MOVE CURSOR POSITION TO OUTPUT FIELD - EXECUTE ROUTINE      *         
***********************************************************************         
         SPACE 1                                                                
CTOFEXEC NTR1                                                                   
         BAS   RE,GETCURP                                                       
         BAS   RE,GETFPOS                                                       
         LA    RF,L'CURPOS+L'FLDPOS                                             
         STH   RF,HALF                                                          
         GOTO1 TSTOUT,CRPARM,HALF  CHECK OUTPUT DATA AREA OVERFLOW              
         BNE   CTOFNO              EXIT IF ERROR                                
         L     RF,OUDATLOC         MOVE DATA TO OUTPUT AREA                     
         MVC   0(L'CURPOS,RF),CURPOS                                            
         MVC   L'CURPOS(L'FLDPOS,R1),FLDPOS                                     
         LA    RF,L'CURPOS+L'FLDPOS(RF)  POSITION TO END OF OUTPUT FLD          
         MVC   0(1,RF),FLDSEP      OUTPUT FIELD SEPARATOR CHARACTER             
         LA    RF,1(RF)            BUMP PAST FIELD SEPARATOR                    
         ST    RF,OUDATLOC                                                      
         B     CTOFOK                                                           
*                                                                               
CTOFNO   B     NO                                                               
CTOFOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_CURS MOVE CURSOR POSITION TO SCRIPT - EXECUTE ROUTINE             *         
***********************************************************************         
         SPACE 1                                                                
CTOSEXEC NTR1                                                                   
         BAS   RE,GETCURP                                                       
         BAS   RE,GETFPOS                                                       
         L     RF,SCRIPLOC                                                      
         MVC   0(L'CURPOS,RF),CURPOS                                            
         MVC   L'CURPOS(L'FLDPOS,RF),FLDPOS                                     
         LA    RF,L'CURPOS+L'FLDPOS                                             
         GOTO1 BUMPSLOC,(RF)       MOVE SCRIPLOC PAST DATA                      
         B     CTOSOK                                                           
*                                                                               
CTOSNO   B     NO                                                               
CTOSOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_CURI MOVE CURSOR POSITION TO INPUT AREA - EXECUTE ROUTINE         *         
***********************************************************************         
         SPACE 1                                                                
CTIDEXEC NTR1                                                                   
         BAS   RE,GETCURP                                                       
         BAS   RE,GETFPOS                                                       
         LA    RF,L'CURPOS+L'FLDPOS                                             
         STH   RF,HALF                                                          
         GOTO1 TSTINP,CRPARM,HALF  CHECK INPUT DATA AREA OVERFLOW               
         BNE   CTIDNO              EXIT IF ERROR                                
         L     R1,INDATWRL         MOVE CURSOR POSITION TO TWA FIELD            
         MVC   0(L'CURPOS,R1),CURPOS                                            
         MVC   L'CURPOS(L'FLDPOS,R1),FLDPOS                                     
         L     RF,INDATWRL         MOVE INPUT DATA AREA LOCATION                
         AH    RF,=AL2(L'CURPOS+L'FLDPOS)  TO NEXT POSITION                     
         ST    RF,INDATWRL                                                      
         B     CTIDOK                                                           
*                                                                               
CTIDNO   B     NO                                                               
CTIDOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_RESO MOVE RESULTS TO OUTPUT AREA - EXECUTE ROUTINE                *         
***********************************************************************         
         SPACE 1                                                                
RTODEXEC NTR1                                                                   
         BAS   RE,GETREST                                                       
         BAS   RE,GETERRP                                                       
         BAS   RE,GETCURP                                                       
         BAS   RE,GETFPOS                                                       
         LA    RF,L'RESULTS+L'ERRPOS+L'CURPOS+L'FLDPOS                          
         STH   RF,HALF                                                          
         GOTO1 TSTOUT,CRPARM,HALF  CHECK OUTPUT DATA AREA OVERFLOW              
         BNE   RTODNO              EXIT IF ERROR                                
         L     R1,OUDATLOC         MOVE RESULTS TO TWA FIELD                    
         MVC   0(L'RESULTS,R1),RESULTS                                          
         MVC   L'RESULTS(L'ERRPOS,R1),ERRPOS                                    
         MVC   L'RESULTS+L'ERRPOS(L'CURPOS,R1),CURPOS                           
         MVC   L'RESULTS+L'ERRPOS+L'CURPOS(L'FLDPOS,R1),FLDPOS                  
         L     RF,OUDATLOC         MOVE OUTPUT DATA AREA LOCATION               
*                                  TO NEXT POSITION                             
         AH    RF,=AL2(L'RESULTS+L'ERRPOS+L'CURPOS+L'FLDPOS)                    
         ST    RF,OUDATLOC                                                      
         B     RTODOK                                                           
*                                                                               
RTODNO   B     NO                                                               
RTODOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_RESOF MOVE RESULTS TO OUTPUT FIELD - EXECUTE ROUTINE              *         
***********************************************************************         
         SPACE 1                                                                
RTOFEXEC NTR1                                                                   
         BAS   RE,GETREST                                                       
         BAS   RE,GETERRP                                                       
         BAS   RE,GETCURP                                                       
         BAS   RE,GETFPOS                                                       
         LA    RF,L'RESULTS+L'ERRPOS+L'CURPOS+L'FLDPOS                          
         STH   RF,HALF                                                          
         GOTO1 TSTOUT,CRPARM,HALF  CHECK OUTPUT DATA AREA OVERFLOW              
         BNE   RTOFNO              EXIT IF ERROR                                
         L     RF,OUDATLOC         MOVE DATA TO OUTPUT AREA                     
         MVC   0(L'RESULTS,R1),RESULTS                                          
         MVC   L'RESULTS(L'ERRPOS,R1),ERRPOS                                    
         MVC   L'RESULTS+L'ERRPOS(L'CURPOS,R1),CURPOS                           
         MVC   L'RESULTS+L'ERRPOS+L'CURPOS(L'FLDPOS,R1),FLDPOS                  
         LA    RF,L'RESULTS+L'ERRPOS+L'CURPOS+L'FLDPOS(RF)                      
         MVC   0(1,RF),FLDSEP      OUTPUT FIELD SEPARATOR CHARACTER             
         LA    RF,1(RF)            BUMP PAST FIELD SEPARATOR                    
         ST    RF,OUDATLOC                                                      
         B     RTOFOK                                                           
*                                                                               
RTOFNO   B     NO                                                               
RTOFOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_RESS MOVE RRESULTS TO SCRIPT - EXECUTE ROUTINE                    *         
***********************************************************************         
         SPACE 1                                                                
RTOSEXEC NTR1                                                                   
         BAS   RE,GETREST                                                       
         BAS   RE,GETERRP                                                       
         BAS   RE,GETCURP                                                       
         BAS   RE,GETFPOS                                                       
         L     RF,SCRIPLOC                                                      
         MVC   0(L'RESULTS,R1),RESULTS                                          
         MVC   L'RESULTS(L'ERRPOS,R1),ERRPOS                                    
         MVC   L'RESULTS+L'ERRPOS(L'CURPOS,R1),CURPOS                           
         MVC   L'RESULTS+L'ERRPOS+L'CURPOS(L'FLDPOS,R1),FLDPOS                  
         LA    RF,L'RESULTS+L'ERRPOS+L'CURPOS+L'FLDPOS                          
         GOTO1 BUMPSLOC,(RF)       MOVE SCRIPLOC PAST DATA                      
         B     RTOSOK                                                           
*                                                                               
RTOSNO   B     NO                                                               
RTOSOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_RESI MOVE RESULTS TO INPUT AREA - EXECUTE ROUTINE                 *         
***********************************************************************         
         SPACE 1                                                                
RTIDEXEC NTR1                                                                   
         BAS   RE,GETREST                                                       
         BAS   RE,GETERRP                                                       
         BAS   RE,GETCURP                                                       
         BAS   RE,GETFPOS                                                       
         LA    RF,L'RESULTS+L'ERRPOS+L'CURPOS+L'FLDPOS                          
         STH   RF,HALF                                                          
         GOTO1 TSTINP,CRPARM,HALF  CHECK INPUT DATA AREA OVERFLOW               
         BNE   RTIDNO              EXIT IF ERROR                                
         L     R1,INDATWRL         MOVE CURSOR POSITION TO TWA FIELD            
         MVC   0(L'RESULTS,R1),RESULTS                                          
         MVC   L'RESULTS(L'ERRPOS,R1),ERRPOS                                    
         MVC   L'RESULTS+L'ERRPOS(L'CURPOS,R1),CURPOS                           
         MVC   L'RESULTS+L'ERRPOS+L'CURPOS(L'FLDPOS,R1),FLDPOS                  
         L     RF,INDATWRL         MOVE INPUT DATA AREA LOCATION                
*                                  TO NEXT POSITION                             
         AH    RF,=AL2(L'RESULTS+L'ERRPOS+L'CURPOS+L'FLDPOS)                    
         ST    RF,INDATWRL                                                      
         B     RTIDOK                                                           
*                                                                               
RTIDNO   B     NO                                                               
RTIDOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_SAVERR SAVE ERROR MESSAGE IN BUFFER - EXECUTE ROUTINE             *         
***********************************************************************         
         SPACE 1                                                                
SAVEEXEC NTR1                                                                   
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
         MVI   ERRSLOT,0           INITIALISE ERROR BUFFER SLOT #               
         L     RF,AERRBNXT         RF=A(NEXT ENTRY IN ERROR BUFFER)             
         C     RF,AERRBEND         EXIT WITH CC .NE. IF OVERFLOW                
         BNL   SAVEOK              CLEAR NEXT ENTRY IF NOT END                  
         OI    CONDCODE,CCEQUALQ   SET CC .EQ.                                  
         L     R5,ATWA                                                          
         LA    R5,64(R5)           R5=A(ERROR MESAGE FIELD IN TWA)              
         USING FLDHDRD,R5                                                       
         L     RF,AERRBUFF         RF=A(FIRST ENTRY IN ERROR BUFFER)            
*                                  TEST ERROR MESSAGE ALREADY SAVED             
SAVE010  C     RF,AERRBNXT                                                      
         BNL   SAVE020                                                          
         CLC   0(ERRORLEN,RF),FLDDATA                                           
         BE    SAVE030             EXIT IF ALREADY SAVED                        
         LA    RF,ERRORLEN(RF)     POINT TO NEXT ENTRY IN ERROR BUFFER          
         C     RF,AERRBEND                                                      
         BNL   SAVEOK                                                           
         B     SAVE010                                                          
*                                                                               
SAVE020  MVC   0(ERRORLEN,RF),FLDDATA  MOVE OUT ERROR MESSAGE                   
         LA    RE,ERRORLEN(RF)     POINT TO NEXT ENTRY IN ERROR BUFFER          
         ST    RE,AERRBNXT                                                      
         C     RE,AERRBEND                                                      
         BNL   SAVE030             CLEAR NEXT ENTRY IF NOT END                  
         XC    0(ERRORLEN,RE),0(RE)                                             
         B     SAVE030                                                          
*                                  HERE WITH RF=A(ERROR BUFFER SLOT)            
SAVE030  ICM   RE,15,AERRBUFF      CALCULATE ERROR BUFFER SLOT #                
         SR    RF,RE                                                            
         SR    RE,RE                                                            
         D     RE,=AL4(ERRORLEN)                                                
         LA    RF,1(RF)                                                         
         STC   RF,ERRSLOT                                                       
         B     SAVEOK              EXIT OK                                      
*                                                                               
SAVENO   B     NO                                                               
SAVEOK   B     YES                                                              
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* S_TRON TURN ON TWA TRACE FLAG IN UTL                                *         
***********************************************************************         
         SPACE 1                                                                
TRONEXEC NTR1                                                                   
         L     RF,AUTL                                                          
*                                  TURN ON TWA TRACE FLAG IN UTL                
         OI    TSTAT4-UTLD(RF),TST4TWA                                          
         B     TRNEOK                                                           
*                                                                               
TRNENO   B     NO                                                               
TRNEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_TROFF TURN OFF TWA TRACE FLAG IN UTL                              *         
***********************************************************************         
         SPACE 1                                                                
TROFEXEC NTR1                                                                   
         L     RF,AUTL                                                          
*                                  TURN OFF TWA TRACE FLAG IN UTL               
         NI    TSTAT4-UTLD(RF),X'FF'-TST4TWA                                    
         B     TRFEOK                                                           
*                                                                               
TRFENO   B     NO                                                               
TRFEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_ERASE ERASE CURRENT TWA FIELD - EXECUTE ROUTINE                   *         
***********************************************************************         
         SPACE 1                                                                
ERASEXEC NTR1                                                                   
         GOTO1 LOADFLD,CRPARM,SPACES,99                                         
         BNE   ERASNO              ERROR EXIT                                   
         B     ERASOK                                                           
*                                                                               
ERASNO   B     NO                                                               
ERASOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_READ READ IN NEXT INPUT DATA AREA BLOCK                           *         
***********************************************************************         
         SPACE 1                                                                
BLKIEXEC NTR1                                                                   
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
         OI    CONDCODE,CCEQUALQ                                                
         L     R1,ATBUFF                                                        
         USING TBHDATA,R1                                                       
         TM    TBHCNTL,TBHCTEST                                                 
         BNZ   BLKI010                                                          
         DROP  R1                                                               
         ICM   R1,15,AINPPARM                                                   
         ICM   RF,15,AINPROUT                                                   
         BASR  RE,RF                                                            
         ICM   RF,15,ASCRIPID                                                   
         STCM  RF,15,INDATRDL                                                   
         STCM  RF,15,INDATWRL                                                   
         TM    0(R1),X'80'                                                      
         BZ    BLKIOK                                                           
*                                                                               
BLKI010  NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     BLKIOK                                                           
*                                                                               
BLKINO   B     NO                                                               
BLKIOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_WRITE WRITE OUT LAST OUTPUT DATA AREA BLOCK                       *         
***********************************************************************         
         SPACE 1                                                                
BLKOEXEC NTR1                                                                   
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
         OI    CONDCODE,CCEQUALQ                                                
         L     R1,ATBUFF                                                        
         USING TBHDATA,R1                                                       
         TM    TBHCNTL,TBHCTEST                                                 
         BNZ   BLKOOK                                                           
         DROP  R1                                                               
         ICM   R1,15,AOUTPARM                                                   
         ICM   RF,15,AOUTROUT                                                   
         BASR  RE,RF                                                            
         ICM   RF,15,ASCRIPOD                                                   
         STCM  RF,15,OUDATLOC                                                   
         TM    0(R1),X'80'                                                      
         BZ    BLKOOK                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     BLKOOK                                                           
*                                                                               
BLKONO   B     NO                                                               
BLKOOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_SETC SET SCRIPT COMMAND COUNTER                                   *         
***********************************************************************         
         SPACE 1                                                                
SETCEXEC NTR1                                                                   
*                                  GET VALUE OF LOCATION FROM SCRIPT            
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R1,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         ST    RF,COUNTER                                                       
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     SETCOK                                                           
*                                                                               
SETCNO   B     NO                                                               
SETCOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_INC INCREMENT SCRIPT COMMAND COUNTER                              *         
***********************************************************************         
         SPACE 1                                                                
INCEXEC  NTR1                                                                   
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
         L     R1,COUNTER          UPDATE CURRENT COUNTER VALUE                 
         LA    R1,1(R1)                                                         
         ST    R1,COUNTER                                                       
         CLC   COUNTER,=F'0'                                                    
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     INCE010                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     INCE010                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
INCE010  EQU   *                                                                
         B     INCEOK                                                           
*                                                                               
INCENO   B     NO                                                               
INCEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_DEC DECREMENT SCRIPT COMMAND COUNTER                              *         
***********************************************************************         
         SPACE 1                                                                
DECEXEC  NTR1                                                                   
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
         L     R1,COUNTER          UPDATE CURRENT COUNTER VALUE                 
         BCTR  R1,0                                                             
         ST    R1,COUNTER                                                       
         CLC   COUNTER,=F'0'                                                    
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     DECE010                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     DECE010                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
DECE010  EQU   *                                                                
         B     INCEOK                                                           
*                                                                               
DECENO   B     NO                                                               
DECEOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_SAVFP SAVE CURENT TWA FIELD POSITION POINTER                      *         
***********************************************************************         
         SPACE 1                                                                
SAVFEXEC NTR1                                                                   
         ICM   R1,15,TWALOC                                                     
         USING FLDHDRD,R1                                                       
         MVC   SAVEFLD,FLDADR                                                   
         DROP  R1                                                               
         B     SAVFOK                                                           
*                                                                               
SAVFNO   B     NO                                                               
SAVFOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_RESFP RESTORE SAVED TWA FIELD POSITION POINTER                    *         
***********************************************************************         
         SPACE 1                                                                
RESFEXEC NTR1                                                                   
         GOTO1 LTWAADR,CRPARM,SAVEFLD  LOCATE TWA FIELD ADDRESS                 
         BNE   RESFNO              ERROR EXIT                                   
         B     RESFOK                                                           
*                                                                               
RESFNO   B     NO                                                               
RESFOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_FILLO - EXECUTE ROUTINE - FILL OUTPUT AREA WITH HEX CODE          *         
***********************************************************************         
         SPACE 1                                                                
FILOEXEC NTR1                                                                   
         L     RF,=A(FILLOUT)                                                   
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
* S_SEP - EXECUTE ROUTINE - SET FIELD SEPARATOR CHARACTER             *         
***********************************************************************         
         SPACE 1                                                                
SEPEXEC  NTR1                                                                   
         L     RF,=A(SETSEP)                                                    
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
* S_SETIP SET INPUT DATA AREA LOCATION                                *         
***********************************************************************         
         SPACE 1                                                                
SIDLEXEC NTR1                                                                   
*                                  GET VALUE OF LOCATION FROM SCRIPT            
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R1,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,ASCRIPID         GET ADDRESS START OF INPUT AREA              
         AH    RF,HALF             ADD VALUE FROM SCRIPT TO INPUT               
         ST    RF,INDATRDL           AREA LOCATION                              
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     SIDLOK                                                           
*                                                                               
SIDLNO   B     NO                                                               
SIDLOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_ADDIP ADD VALUE TO CURRENT INPUT DATA AREA LOCATION POINTER       *         
***********************************************************************         
         SPACE 1                                                                
AIDLEXEC NTR1                                                                   
*                                  GET VALUE TO ADD FROM SCRIPT                 
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R1,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,INDATRDL         GET CURRENT LOCATION IN INPUT AREA           
         AH    RF,HALF             ADD VALUE TO LOCATION FROM SCRIPT            
         ST    RF,INDATRDL                                                      
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     AIDLOK                                                           
*                                                                               
AIDLNO   B     NO                                                               
AIDLOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_SUBIP SUBTRACT VALUE FROM CURRENT INPUT DATA AREA LOCATION POINTER*         
***********************************************************************         
         SPACE 1                                                                
SUILEXEC NTR1                                                                   
*                                  GET VALUE TO SUBTRACT FROM SCRIPT            
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R1,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,INDATRDL         GET CURRENT LOCATION IN INPUT AREA           
         SH    RF,HALF             SUBTRACT VALUE FROM LOCATION POINTER         
         CLM   RF,15,ASCRIPID                                                   
         BH    *+8                                                              
         ICM   RF,15,ASCRIPID                                                   
         ST    RF,INDATRDL                                                      
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     SUILOK                                                           
*                                                                               
SUILNO   B     NO                                                               
SUILOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_SETOP SET OUTPUT DATA AREA LOCATION                               *         
***********************************************************************         
         SPACE 1                                                                
SODLEXEC NTR1                                                                   
*                                  GET VALUE OF LOCATION FROM SCRIPT            
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R1,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,ASCRIPOD         GET ADDRESS START OF OUTPUT AREA             
         AH    RF,HALF             ADD VALUE FROM SCRIPT TO OUTPUT              
         ST    RF,OUDATLOC           AREA LOCATION                              
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     SODLOK                                                           
*                                                                               
SODLNO   B     NO                                                               
SODLOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_ADDOP ADD VALUE TO CURRENT OUTPUT AREA LOCATION POINTER           *         
***********************************************************************         
         SPACE 1                                                                
AODLEXEC NTR1                                                                   
*                                  GET VALUE TO ADD FROM SCRIPT                 
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R1,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,OUDATLOC         GET CURRENT LOCATION IN OUTPUT AREA          
         AH    RF,HALF             ADD VALUE TO LOCATION FROM SCRIPT            
         ST    RF,OUDATLOC                                                      
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     AODLOK                                                           
*                                                                               
AODLNO   B     NO                                                               
AODLOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_SUBOP SUBTRACT VALUE FROM CURRENT OUTPUT AREA LOCATION POINTER    *         
***********************************************************************         
         SPACE 1                                                                
SUOLEXEC NTR1                                                                   
*                                  GET VALUE TO ADD FROM SCRIPT                 
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R1,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,OUDATLOC         GET CURRENT LOCATION IN OUTPUT AREA          
         SH    RF,HALF             SUBTRACT VALUE FROM LOCATION POINTER         
         CLM   RF,15,ASCRIPOD                                                   
         BH    *+8                                                              
         ICM   RF,15,ASCRIPOD                                                   
         ST    RF,OUDATLOC                                                      
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     SUOLOK                                                           
*                                                                               
SUOLNO   B     NO                                                               
SUOLOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_SETWP SET WORK AREA LOCATION POINTER                              *         
***********************************************************************         
         SPACE 1                                                                
SWDLEXEC NTR1                                                                   
*                                  GET VALUE OF LOCATION FROM SCRIPT            
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R1,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,ASCWORK          GET ADDRESS START OF WORK AREA               
         AH    RF,HALF             ADD VALUE FROM SCRIPT TO WORK                
         ST    RF,SCWORKL            AREA LOCATION                              
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     SWDLOK                                                           
*                                                                               
SWDLNO   B     NO                                                               
SWDLOK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_ADDWP ADD VALU TO CURRENT WORK AREA LOCATION POINTER              *         
***********************************************************************         
         SPACE 1                                                                
AWDLEXEC NTR1                                                                   
*                                  GET VALUE TO ADD FROM SCRIPT                 
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R1,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,SCWORKL          GET CURRENT LOCATION IN WORK AREA            
         AH    RF,HALF             ADD VALUE TO LOCATION FROM SCRIPT            
         ST    RF,SCWORKL                                                       
         GOTO1 BUMPSLOC,(R1)       MOVE SCRIPLOC PAST PARAMETER                 
         B     AWDLOK                                                           
*                                                                               
AWDLNO   B     NO                                                               
AWDLOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_SETIRP SET INPUT DATA AREA RECORD POINTER                         *         
***********************************************************************         
         SPACE 1                                                                
RECIEXEC NTR1                                                                   
*                                  GET VALUE OF RECORD # FROM SCRIPT            
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,ASCRIPID         GET ADDRESS START OF INPUT AREA              
         SR    RE,RE                                                            
         ICM   RE,3,HALF                                                        
         BZ    RECINO                                                           
*                                                                               
RECI010  CLC   0(4,RF),ENDREC                                                   
         BE    RECINO                                                           
         PACK  DUB,0(4,RF)                                                      
         CVB   R1,DUB                                                           
         BCT   RE,*+8                                                           
         B     RECI020                                                          
         LA    RF,4(R1,RF)                                                      
         B     RECI010                                                          
*                                                                               
RECI020  STCM  R1,3,INRECLEN                                                    
         LA    RF,4(RF)                                                         
         ST    RF,INDATRDL                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     RECIOK                                                           
*                                                                               
RECINO   B     NO                                                               
RECIOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_SETORP SET OUTPUT DATA AREA RECORD POINTER                        *         
***********************************************************************         
         SPACE 1                                                                
RECOEXEC NTR1                                                                   
*                                  GET VALUE OF RECORD # FROM SCRIPT            
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,ASCRIPOD         GET ADDRESS START OF INPUT AREA              
         SR    RE,RE                                                            
         ICM   RE,3,HALF                                                        
         BZ    RECONO                                                           
*                                                                               
RECO010  BCT   RE,*+8                                                           
         B     RECO020                                                          
         CLC   0(4,RF),ENDREC                                                   
         BZ    RECONO                                                           
         PACK  DUB,0(4,RF)                                                      
         CVB   R1,DUB                                                           
         LA    RF,4(R1,RF)                                                      
         B     RECO010                                                          
*                                                                               
RECO020  XC    OURECLEN,OURECLEN                                                
         LA    RF,4(RF)                                                         
         ST    RF,OUDATLOC                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     RECOOK                                                           
*                                                                               
RECONO   B     NO                                                               
RECOOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_SETORL SET OUTPUT DATA AREA RECORD LENGTH                         *         
***********************************************************************         
         SPACE 1                                                                
RECLEXEC NTR1                                                                   
*                                  GET VALUE OF LENGTH FROM SCRIPT              
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,OURECLEN                                 
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,OUDATLOC         GET CURRENT LOCATION IN OUTPUT               
         SR    RE,RE                                                            
         ICM   RE,3,HALF                                                        
         CVD   RE,DUB                                                           
         UNPK  0(4,RF),DUB(8)      MOVE OUT 4 DIGIT RECORD LENGTH               
         OI    3(RF),X'F0'                                                      
         GOTO1 BUMPSLOC,(R5)       MOVE SCRIPLOC PAST PARAMETER                 
         B     RECLOK                                                           
*                                                                               
RECLNO   B     NO                                                               
RECLOK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* S_$CT CONNECT EXECUTE ROUTINE                                       *         
***********************************************************************         
         SPACE 1                                                                
CTEXEC   NTR1                                                                   
*                                                                               
         MVI   CONNTEST,C'N'                                                    
         L     RF,=A(CONNECT)                                                   
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         XIT1                                                                   
         SPACE 1                                                                
***********************************************************************         
* S_$CTT CONNECT WITH TEST RETURN EXECUTE ROUTINE                     *         
***********************************************************************         
         SPACE 1                                                                
CTTEXEC  NTR1                                                                   
*                                                                               
         MVI   CONNTEST,C'Y'                                                    
         L     RF,=A(CONNECT)                                                   
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
* S_ENTWA ENTER KEY SCRIPT EXECUTE ROUTINE (NO TWA RESET)             *         
***********************************************************************         
         SPACE 1                                                                
ENTWEXEC NTR1                                                                   
         MVI   BYTE,X'00'          SET TBHAID VALUE                             
         MVI   SVTWLFLG,C'Y'       SET SAVE TWA LOCATION FLAG TO YES            
         GOTO1 GOTOMON,CRPARM      GOTO FAMONITOR                               
         BNE   ENTWNO              ERROR EXIT                                   
         B     ENTWOK              EXIT OK                                      
*                                                                               
ENTWNO   B     NO                                                               
ENTWOK   B     YES                                                              
         XIT1                                                                   
         SPACE 1                                                                
***********************************************************************         
* S_ENTER ENTER KEY SCRIPT CODE EXECUTE ROUTINE                       *         
***********************************************************************         
         SPACE 1                                                                
ENTREXEC NTR1                                                                   
         MVI   BYTE,0              SET TBHAID VALUE                             
         MVI   SVTWLFLG,C'N'       SET SAVE TWA LOCATION FLAG TO NO             
         GOTO1 GOTOMON,CRPARM      GOTO FAMONITOR                               
         BNE   ENTENO              ERROR EXIT                                   
         B     ENTEOK              EXIT OK                                      
*                                                                               
ENTENO   B     NO                                                               
ENTEOK   B     YES                                                              
         XIT1                                                                   
         SPACE 1                                                                
***********************************************************************         
* S_PF01 PFKEY 01 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF01EXEC NTR1                                                                   
         MVI   BYTE,1              SET TBHAID VALUE                             
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM      GOTO FAMONITOR                               
         BNE   PF01NO              ERROR EXIT                                   
         B     PF01OK              EXIT OK                                      
*                                                                               
PF01NO   B     NO                                                               
PF01OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF02 PFKEY 02 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF02EXEC NTR1                                                                   
         MVI   BYTE,2              SET TBHAID VALUE                             
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM      GOTO FAMONITOR                               
         BNE   PF02NO              ERROR EXIT                                   
         B     PF02OK              EXIT OK                                      
*                                                                               
PF02NO   B     NO                                                               
PF02OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF03 PFKEY 03 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF03EXEC NTR1                                                                   
         MVI   BYTE,3              SET TBHAID VALUE                             
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM      GOTO FAMONITOR                               
         BNE   PF03NO              ERROR EXIT                                   
         B     PF03OK              EXIT OK                                      
*                                                                               
PF03NO   B     NO                                                               
PF03OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF04 PFKEY 04 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF04EXEC NTR1                                                                   
         MVI   BYTE,4              SET TBHAID VALUE                             
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM      GOTO FAMONITOR                               
         BNE   PF04NO              ERROR EXIT                                   
         B     PF04OK              EXIT OK                                      
*                                                                               
PF04NO   B     NO                                                               
PF04OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF05 PFKEY 05 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF05EXEC NTR1                                                                   
         MVI   BYTE,5              SET TBHAID VALUE                             
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM      GOTO FAMONITOR                               
         BNE   PF05NO              ERROR EXIT                                   
         B     PF05OK              EXIT OK                                      
*                                                                               
PF05NO   B     NO                                                               
PF05OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF06 PFKEY 06 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF06EXEC NTR1                                                                   
         MVI   BYTE,6              SET TBHAID VALUE                             
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM      GOTO FAMONITOR                               
         BNE   PF06NO              ERROR EXIT                                   
         B     PF06OK              EXIT OK                                      
*                                                                               
PF06NO   B     NO                                                               
PF06OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF07 PFKEY 07 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF07EXEC NTR1                                                                   
         MVI   BYTE,7              YOU KNOW THE REST...                         
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF07NO                                                           
         B     PF07OK                                                           
*                                                                               
PF07NO   B     NO                                                               
PF07OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF08 PFKEY 08 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF08EXEC NTR1                                                                   
         MVI   BYTE,8                                                           
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF08NO                                                           
         B     PF08OK                                                           
*                                                                               
PF08NO   B     NO                                                               
PF08OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF09 PFKEY 09 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF09EXEC NTR1                                                                   
         MVI   BYTE,9                                                           
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF09NO                                                           
         B     PF09OK                                                           
*                                                                               
PF09NO   B     NO                                                               
PF09OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF10 PFKEY 10 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF10EXEC NTR1                                                                   
         MVI   BYTE,10                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF10NO                                                           
         B     PF10OK                                                           
*                                                                               
PF10NO   B     NO                                                               
PF10OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF11 PFKEY 11 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF11EXEC NTR1                                                                   
         MVI   BYTE,11                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF11NO                                                           
         B     PF11OK                                                           
*                                                                               
PF11NO   B     NO                                                               
PF11OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF12 PFKEY 12 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF12EXEC NTR1                                                                   
         MVI   BYTE,12                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF12NO                                                           
         B     PF12OK                                                           
*                                                                               
PF12NO   B     NO                                                               
PF12OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF13 PFKEY 13 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF13EXEC NTR1                                                                   
         MVI   BYTE,13                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF13NO                                                           
         B     PF13OK                                                           
*                                                                               
PF13NO   B     NO                                                               
PF13OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF14 PFKEY 14 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF14EXEC NTR1                                                                   
         MVI   BYTE,14                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF14NO                                                           
         B     PF14OK                                                           
*                                                                               
PF14NO   B     NO                                                               
PF14OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF15 PFKEY 15 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF15EXEC NTR1                                                                   
         MVI   BYTE,15                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF15NO                                                           
         B     PF15OK                                                           
*                                                                               
PF15NO   B     NO                                                               
PF15OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF16 PFKEY 16 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF16EXEC NTR1                                                                   
         MVI   BYTE,16                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF16NO                                                           
         B     PF16OK                                                           
*                                                                               
PF16NO   B     NO                                                               
PF16OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF17 PFKEY 17 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF17EXEC NTR1                                                                   
         MVI   BYTE,17                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF17NO                                                           
         B     PF17OK                                                           
*                                                                               
PF17NO   B     NO                                                               
PF17OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF18 PFKEY 18 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF18EXEC NTR1                                                                   
         MVI   BYTE,18                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF18NO                                                           
         B     PF18OK                                                           
*                                                                               
PF18NO   B     NO                                                               
PF18OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF19 PFKEY 19 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF19EXEC NTR1                                                                   
         MVI   BYTE,19                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF19NO                                                           
         B     PF19OK                                                           
*                                                                               
PF19NO   B     NO                                                               
PF19OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF20 PFKEY 20 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF20EXEC NTR1                                                                   
         MVI   BYTE,20                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF20NO                                                           
         B     PF20OK                                                           
*                                                                               
PF20NO   B     NO                                                               
PF20OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF21 PFKEY 21 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF21EXEC NTR1                                                                   
         MVI   BYTE,21                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF21NO                                                           
         B     PF21OK                                                           
*                                                                               
PF21NO   B     NO                                                               
PF21OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF22 PFKEY 22 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF22EXEC NTR1                                                                   
         MVI   BYTE,22                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF22NO                                                           
         B     PF22OK                                                           
*                                                                               
PF22NO   B     NO                                                               
PF22OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF23 PFKEY 23 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF23EXEC NTR1                                                                   
         MVI   BYTE,23                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF23NO                                                           
         B     PF23OK                                                           
*                                                                               
PF23NO   B     NO                                                               
PF23OK   B     YES                                                              
         SPACE 1                                                                
***********************************************************************         
* S_PF24 PFKEY 24 SCRIPT CODE EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
PF24EXEC NTR1                                                                   
         MVI   BYTE,24                                                          
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   PF24NO                                                           
         B     PF24OK                                                           
*                                                                               
PF24NO   B     NO                                                               
PF24OK   B     YES                                                              
         EJECT                                                                  
***********************************************************************         
* INITIALISE TIA TWA FIELD BUFFER                                     *         
***********************************************************************         
         SPACE 1                                                                
INITTIA  EQU   *                                                                
         ICM   R1,15,ATIA                                                       
         BZR   RE                                                               
         LA    RF,4                                                             
         STCM  RF,3,4(R1)                                                       
         LA    R1,64(R1)                                                        
         MVC   0(4,R1),=XL4'03FFFF00'                                           
         BR    RE                                                               
         EJECT                                                                  
***********************************************************************         
* GET CURRENT EROR BUFFER SLOT NUMBNER INTO WORK AREA ERRPOS          *         
***********************************************************************         
         SPACE 1                                                                
GETERRP  NTR1                                                                   
*                                  LOAD ERROR BUFFER                            
         L     RF,=A(LOADERR)                                                   
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         SR    RE,RE                                                            
         IC    RE,ERRSLOT                                                       
         CVD   RE,DUB                                                           
         UNPK  ERRPOS(2),DUB(8)                                                 
         OI    ERRPOS+1,X'F0'                                                   
         XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
* GET CURRENT CURSOR POSITION INTO WORK CURPOS                        *         
***********************************************************************         
         SPACE 1                                                                
GETCURP  NTR1                                                                   
         L     R1,ATBUFF                                                        
         USING TBHDATA,R1                                                       
         MVC   CUROFF,TBHCURD                                                   
         XC    CURFLD,CURFLD                                                    
*                                                                               
         SR    RF,RF               FIND NEAREST UNPROTECTED FIELD               
         L     R5,ATWA             IN TWA                                       
         LA    R5,64(R5)                                                        
         USING FLDHDRD,R5                                                       
*                                                                               
GCUR010  IC    RF,FLDLEN                                                        
         CH    RF,=H'9'                                                         
         BL    GCUR100                                                          
         CLI   FLDATB,X'FF'                                                     
         BE    GCUR020                                                          
GCUR012  TM    FLDATB,FATBPROT                                                  
         BZ    GCUR030                                                          
         B     GCUR020                                                          
*                                                                               
GCUR020  AR    R5,RF                                                            
         B     GCUR010             BUMP TO NEXT FIELD                           
*                                                                               
GCUR030  LR    RE,R5                                                            
         L     R1,ATWA                                                          
         SR    RE,R1                                                            
         CLM   RE,3,CUROFF                                                      
         BH    GCUR100                                                          
         SR    R1,R1                                                            
         ICM   R1,3,CURFLD                                                      
         LA    R1,1(R1)                                                         
         STCM  R1,3,CURFLD                                                      
         B     GCUR020                                                          
*                                                                               
GCUR100  SR    RE,RE                                                            
         ICM   RE,3,CURFLD                                                      
         DROP  R5                                                               
*                                                                               
         CVD   RE,DUB                                                           
         UNPK  CURPOS(3),DUB(8)                                                 
         OI    CURPOS+2,X'F0'                                                   
*                                                                               
         L     R1,ATBUFF                                                        
         USING TBHDATA,R1                                                       
         SR    RE,RE                                                            
         ICM   RE,1,TBHCURI                                                     
         CVD   RE,DUB                                                           
         UNPK  CURPOS+3(2),DUB(8)                                               
         OI    CURPOS+4,X'F0'                                                   
         XIT1                                                                   
         DROP  R1                                                               
         EJECT                                                                  
***********************************************************************         
* GET INPUT FIELD POSITION AND FORMAT                                 *         
***********************************************************************         
         SPACE 1                                                                
GETFPOS  NTR1                                                                   
         L     R1,ATBUFF                                                        
         USING TBHDATA,R1                                                       
         XC    WORK,WORK                                                        
         LA    R2,WORK                                                          
         USING FLPTABD,R2                                                       
         MVC   FLPTWA,TBHCURD                                                   
*                                  GET FIELD POSITION TABLE ENTRY               
         GOTO1 GETFPOT,CRPARM,WORK                                              
         BNE   GPOS010             NO MATCH                                     
         SR    RE,RE               ELSE FORMAT FOR OUTPUT                       
         ICM   RE,3,FLPINP                                                      
         CVD   RE,DUB                                                           
         UNPK  FLDPOS(5),DUB(8)                                                 
         OI    FLDPOS+4,X'F0'                                                   
         B     GPOSOK                                                           
*                                                                               
GPOS010  ICM   RE,15,INDATRDL      DEFAULT USE NEXT POSTION IN INPUT            
         S     RE,ASCRIPID                                                      
         CVD   RE,DUB                                                           
         UNPK  FLDPOS(5),DUB(8)                                                 
         OI    FLDPOS+4,X'F0'                                                   
         B     GPOSOK                                                           
*                                                                               
GPOSNO   B     NO                                                               
GPOSOK   B     YES                                                              
         DROP  R1,R2                                                            
         SPACE 2                                                                
***********************************************************************         
* GET CURRENT RESULTS FIELD FROM SCREEN MESSAGE FIELD                 *         
***********************************************************************         
         SPACE 1                                                                
GETREST  NTR1                                                                   
         SR    RF,RF                                                            
         L     R5,ATWA                                                          
         LA    R5,64(R5)                                                        
         USING FLDHDRD,R5                                                       
*                                  MOVE OUT DEFAULT 'OK' MESSAGE                
         MVC   RESULTS,SPACES                                                   
         MVC   RESULTS(7),=CL7'OK#0000'                                         
*                                  TEST FOR ERROR MESSAGE                       
         ICM   RF,15,=V(SSB)       CHECK ONLINE                                 
         BZ    GRESX                                                            
         CLC   FLDDATA+2(1),SSBSYSCH-SSBD(RF)                                   
         BNE   GRES010             TEST FOR SYSTEM ERROR MESSAGE CHAR.          
         CLI   FLDDATA,C'E'                                                     
         BNE   GRES010             TEST FOR FIRST CHARACTER 'E' IN MSG.         
         MVC   RESULTS,FLDDATA     MOVE OUT ERROR MESSAGE                       
         MVC   RESULTS+7(L'RESULTS-7),SPACES                                    
         B     GRESX                                                            
*                                                                               
GRES010  CLC   FLDDATA(3),=CL3'OK#'                                             
         BNE   GRESX                                                            
         MVC   RESULTS,FLDDATA     MOVE OUT 'OK' MESSAGE                        
         B     GRESX                                                            
*                                                                               
GRESX    XIT1                                                                   
         DROP  R5                                                               
         SPACE 1                                                                
YES      SR    RC,RC               RETURN CC EQUAL                              
NO       LTR   RC,RC               RETURN CC NOT EQUAL                          
XIT      XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
         DS    0D                                                               
ENDREC   DC    CL4'0000'                                                        
SPACES   DC    CL99' '                                                          
$ABEND   DC    X'01FF'                                                          
LOOPINIT DC    F'9999'                                                          
         EJECT                                                                  
* DATA ITEM IO VALIDATION AND FORMATTING TABLE                                  
* FIXED LENGTH ENTRIES FOR EACH ITEM TYPE:                                      
*        YL2   DATA TYPE CODE                                                   
*        AL4   INPUT VALIDATION ROUTINE                                         
*        AL4   OUTPUT FORMATTING ROUTINE                                        
*        AL4   DATA UPDATE ROUTINE                                              
*        XL2   VALIDATION INDICATORS                                            
*                                                                               
* TABLE TERMINATED BY 0                                                         
*                                                                               
DCVTAB   DS    0D                                                               
         DS    0XL(DCVTABL)                                                     
         DC    YL2(DTCHAR),AL4(VALCHAR-WORKD,0,0),AL1(0,0)                      
         DC    YL2(DTBYTE),AL4(VALBYTE-WORKD,0,0),AL1(0,0)                      
         DC    YL2(DTHINT),AL4(VALHINT-WORKD,0,0),AL1(0,0)                      
         DC    YL2(DTFINT),AL4(VALFINT-WORKD,0,0),AL1(0,0)                      
         DC    YL2(DTSLAB),AL4(VALSLAB-WORKD,0,0),AL1(0,0)                      
         DC    YL2(DTFLAB),AL4(VALFLAB-WORKD,0,0),AL1(0,0)                      
         DC    YL2(DTWLAB),AL4(VALWLAB-WORKD,0,0),AL1(0,0)                      
         DC    YL2(DTHEX2),AL4(VALHEX2-WORKD,0,0),AL1(0,0)                      
         DC    YL2(DTLEN2),AL4(VALLEN2-WORKD,0,0),AL1(0,0)                      
         DC    YL2(0)                                                           
DCVTABX  EQU   *                                                                
         EJECT                                                                  
*                                                                               
* LOCAL TABLES                                                                  
*                                                                               
* TABLE OF SCRIPT CONTROL FUNCTIONS                                             
* VARIABLE LENGTH ENTRIES FOR EACH CONTROL:                                     
*        YL2   CONTROL CODE                                                     
*        AL4   CONTROL VALIDATION ROUTINE                                       
*        XL1   IF X'80' BIT ON THEN ADDRESS BELOW IS INDIRECT                   
*        AL3   A(CONTROL EXECUTE ROUTINE)                                       
* + LIST OF;                                                                    
*        YL2   (DATA ITEM CODE,MINIMUM LENGTH,MAXIMUM LENGTH,FLAGS)             
*        AL4   (0) END OF ENTRY                                                 
*                                                                               
* TABLE TERMINATED BY 0                                                         
*                                                                               
SCOTAB   DS    0D                                                               
*                                  ECHO ERROR                                   
         DC    AL2(S_ECHO)                                                      
         DC    AL4(0)                                                           
         DC    AL4(ERREXEC)                                                     
         DC    YL2(DTHINT,1,4,0)                                                
         DC    YL2(0)                                                           
*                                  LOAD SERVICE REQUEST                         
         DC    AL2(S_SRV)            SETTING PROGRAM CODE                       
         DC    AL4(0)                                                           
         DC    AL4(SRVEXEC)                                                     
         DC    YL2(DTHEX2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  CONNECT                                      
         DC    AL2(S_$CT)                                                       
         DC    AL4(CTVAL)                                                       
         DC    AL4(CTEXEC)                                                      
         DC    YL2(0)                                                           
*                                  CONNECT WITH TEST RETURN                     
         DC    AL2(S_$CTT)                                                      
         DC    AL4(CTVAL)                                                       
         DC    AL4(CTTEXEC)                                                     
         DC    YL2(0)                                                           
*                                  SET USER-ID VALUE FROM SCRIPT                
         DC    AL2(S_USRS)                                                      
         DC    AL4(USRVAL)                                                      
         DC    AL4(USRSEXEC)                                                    
         DC    YL2(DTCHAR,3,10,0)                                               
         DC    YL2(0)                                                           
*                                  SET SYSTEM VALUE FROM SCRIPT                 
         DC    AL2(S_SYSS)                                                      
         DC    AL4(SYSVAL)                                                      
         DC    AL4(SYSSEXEC)                                                    
         DC    YL2(DTCHAR,1,7,0)                                                
         DC    YL2(0)                                                           
*                                  SET PROGRAM VALUE FROM SCRIPT                
         DC    AL2(S_PRGS)                                                      
         DC    AL4(PRGVAL)                                                      
         DC    AL4(PRGSEXEC)                                                    
         DC    YL2(DTCHAR,1,20,0)                                               
         DC    YL2(0)                                                           
*                                  SET PASSWORD VALUE FROM SCRIPT               
         DC    AL2(S_PWDS)                                                      
         DC    AL4(PWDVAL)                                                      
         DC    AL4(PWDSEXEC)                                                    
         DC    YL2(DTCHAR,1,10,0)                                               
         DC    YL2(0)                                                           
*                                  SET USER-ID VALUE FROM INPUT DATA            
         DC    AL2(S_USRI)                                                      
         DC    AL4(USRVAL)                                                      
         DC    AL4(USRDEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  SET SYSTEM VALUE FROM INPUT DATA             
         DC    AL2(S_SYSI)                                                      
         DC    AL4(SYSVAL)                                                      
         DC    AL4(SYSDEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  SET PROGRAM VALUE FROM INPUT DATA            
         DC    AL2(S_PRGI)                                                      
         DC    AL4(PRGVAL)                                                      
         DC    AL4(PRGDEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  SET PASSWORD VALUE FROM INPUT DATA           
         DC    AL2(S_PWDI)                                                      
         DC    AL4(PWDVAL)                                                      
         DC    AL4(PWDDEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  EXIT SCRIPT                                  
         DC    AL2(S_EXIT)                                                      
         DC    AL4(0)                                                           
         DC    AL4(EXITEXEC)                                                    
         DC    YL2(0)                                                           
*                                  EXIT SCRIPT IF EQUAL CONDITION               
         DC    AL2(S_EXITEQ)                                                    
         DC    AL4(0)                                                           
         DC    AL4(EXEEEXEC)                                                    
         DC    YL2(0)                                                           
*                                  EXIT SCRIPT IF NOT EQUAL CONDITION           
         DC    AL2(S_EXITNE)                                                    
         DC    AL4(0)                                                           
         DC    AL4(EXENEXEC)                                                    
         DC    YL2(0)                                                           
*                                  NO OP - DO NOTHING                           
         DC    AL2(S_NOP)                                                       
         DC    AL4(0)                                                           
         DC    AL4(0)                                                           
         DC    YL2(0)                                                           
*                                  EXIT TO MONITIOR FOR ABEND                   
         DC    AL2(S_ABEND)                                                     
         DC    AL4(0)                                                           
         DC    AL4(ABNDEXEC)                                                    
         DC    YL2(0)                                                           
*                                  COMMIT UPDATES DONE SO FAR                   
         DC    AL2(S_COMMIT)                                                    
         DC    AL4(0)                                                           
         DC    AL4(OKEXEC)                                                      
         DC    YL2(0)                                                           
*                                  POSITION TO FIRST                            
         DC    AL2(S_FIRST)          FIELD IN TWA                               
         DC    AL4(0)                                                           
         DC    AL4(FRSTEXEC)                                                    
         DC    YL2(0)                                                           
*                                  POSITION TO FIRST                            
         DC    AL2(S_FST)            FIELD IN TWA                               
         DC    AL4(0)                                                           
         DC    AL4(FRSTEXEC)                                                    
         DC    YL2(0)                                                           
*                                  POSITION TO FIRST                            
         DC    AL2(S_FSTPRO)         PROTECTED FIELD                            
         DC    AL4(0)                                                           
         DC    AL4(FPROEXEC)                                                    
         DC    YL2(0)                                                           
*                                  POSITION TO FIRST                            
         DC    AL2(S_FSTUNP)         UNPROTECTED FIELD                          
         DC    AL4(0)                                                           
         DC    AL4(HOMEEXEC)                                                    
         DC    YL2(0)                                                           
*                                  POSITION TO FIRST                            
         DC    AL2(S_HOME)           UNPROTECTED FIELD                          
         DC    AL4(0)                                                           
         DC    AL4(HOMEEXEC)                                                    
         DC    YL2(0)                                                           
*                                  POSITION TO OFFSET WITHIN FIELD              
         DC    AL2(S_FLDOFF)                                                    
         DC    AL4(0)                                                           
         DC    AL4(FOFFEXEC)                                                    
         DC    YL2(DTBYTE,1,3,0)                                                
         DC    YL2(0)                                                           
*                                  POSITION TO NEXT FIELD                       
         DC    AL2(S_NEXT)                                                      
         DC    AL4(0)                                                           
         DC    AL4(NEXTEXEC)                                                    
         DC    YL2(0)                                                           
*                                  POSITION TO NEXT FIELD                       
         DC    AL2(S_NXT)                                                       
         DC    AL4(0)                                                           
         DC    AL4(NEXTEXEC)                                                    
         DC    YL2(0)                                                           
*                                  POSITION TO NEXT                             
         DC    AL2(S_TAB)            UNPROTECTED FIELD                          
         DC    AL4(0)                                                           
         DC    AL4(TABEXEC)                                                     
         DC    YL2(0)                                                           
*                                  POSITION TO NEXT                             
         DC    AL2(S_NXTUNP)         UNPROTECTED FIELD                          
         DC    AL4(0)                                                           
         DC    AL4(TABEXEC)                                                     
         DC    YL2(0)                                                           
*                                  POSITION TO NEXT PROTECTED FIELD             
         DC    AL2(S_NXTPRO)                                                    
         DC    AL4(0)                                                           
         DC    AL4(NPROEXEC)                                                    
         DC    YL2(0)                                                           
*                                  LOCATE NTH FIELD                             
         DC    AL2(S_NTH)                                                       
         DC    AL4(0)                                                           
         DC    AL4(LOCFEXEC)                                                    
         DC    YL2(DTBYTE,1,3,0)                                                
         DC    YL2(0)                                                           
*                                  LOCATE NTH PROTECTED FIELD                   
         DC    AL2(S_NTHPRO)                                                    
         DC    AL4(0)                                                           
         DC    AL4(LOCPEXEC)                                                    
         DC    YL2(DTBYTE,1,3,0)                                                
         DC    YL2(0)                                                           
*                                  LOCATE NTH UNPROTECTED FIELD                 
         DC    AL2(S_NTHUNP)                                                    
         DC    AL4(0)                                                           
         DC    AL4(LOCUEXEC)                                                    
         DC    YL2(DTBYTE,1,3,0)                                                
         DC    YL2(0)                                                           
*                                  LOCATE A FIELD WITH FIELD NUMBER             
         DC    AL2(S_LOCNUM)                                                    
         DC    AL4(0)                                                           
         DC    AL4(LOCNEXEC)                                                    
         DC    YL2(DTBYTE,1,3,0)                                                
         DC    YL2(0)                                                           
*                                  LOCATE A FIELD WITH TEXT COMPARE             
         DC    AL2(S_LOCTXT)                                                    
         DC    AL4(0)                                                           
         DC    AL4(LOCTEXEC)                                                    
         DC    YL2(DTCHAR,1,99,0)                                               
         DC    YL2(0)                                                           
*                                  LOCATE A FIELD WITH DICTIONARY #             
         DC    AL2(S_LOCDIC)                                                    
         DC    AL4(0)                                                           
         DC    AL4(LOCDEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  LOCATE A FIELD WITH SYMBOLIC LABEL           
         DC    AL2(S_LOCLBL)                                                    
         DC    AL4(0)                                                           
         DC    AL4(LOCLEXEC)                                                    
         DC    YL2(DTFLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  LOCATE NEXT FIELD WITH ATTRIBUTE             
         DC    AL2(S_LOCATB)                                                    
         DC    AL4(0)                                                           
         DC    AL4(LOCAEXEC)                                                    
         DC    YL2(DTBYTE,1,3,0)                                                
         DC    YL2(0)                                                           
*                                  LOCATE A WORK AREA LABEL                     
         DC    AL2(S_LOCWRK)                                                    
         DC    AL4(0)                                                           
         DC    AL4(LOCWEXEC)                                                    
         DC    YL2(DTWLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  LOCATE THE CURSOR POSITION                   
         DC    AL2(S_LOCCUR)                                                    
         DC    AL4(0)                                                           
         DC    AL4(LOCCEXEC)                                                    
         DC    YL2(0)                                                           
*                                  LOCATE TO OFFSET IN TWA                      
         DC    AL2(S_LOCOFF)                                                    
         DC    AL4(0)                                                           
         DC    AL4(LOCOEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  POSITION TO NEXT FIELD WITHIN                
         DC    AL2(S_NXTFF)          CURRENT TWA FIELD                          
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(NXFFEXEC-SCRUNCH)                                            
         DC    YL2(0)                                                           
*                                  DEFINE A SCRIPT LABEL                        
         DC    AL2(S_LBLS)                                                      
         DC    AL4(0)                                                           
         DC    AL4(DFSLEXEC)                                                    
         DC    YL2(DTSLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  DEFINE A FIELD LABEL                         
         DC    AL2(S_LBLT)                                                      
         DC    AL4(0)                                                           
         DC    AL4(DFFLEXEC)                                                    
         DC    YL2(DTFLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  DEFINE A WORK AREA LABEL                     
         DC    AL2(S_LBLW)                                                      
         DC    AL4(0)                                                           
         DC    AL4(DFWLEXEC)                                                    
         DC    YL2(DTWLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  DEFINE A FIELD ATTRIBUTE                     
         DC    AL2(S_ATBT)                                                      
         DC    AL4(0)                                                           
         DC    AL4(DFFAEXEC)                                                    
         DC    YL2(DTBYTE,1,3,0)                                                
         DC    YL2(0)                                                           
*                                  BRANCH TO LABEL UNCONDITIONALLY              
         DC    AL2(S_BR)                                                        
         DC    AL4(0)                                                           
         DC    AL4(BRANEXEC)                                                    
         DC    YL2(DTSLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  BRANCH TO LABEL IF EQUAL                     
         DC    AL2(S_BE)                                                        
         DC    AL4(0)                                                           
         DC    AL4(BREQEXEC)                                                    
         DC    YL2(DTSLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  BRANCH TO LABEL IF NOT EQUAL                 
         DC    AL2(S_BNE)                                                       
         DC    AL4(0)                                                           
         DC    AL4(BRNEEXEC)                                                    
         DC    YL2(DTSLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  BRANCH TO LABEL IF HIGER                     
         DC    AL2(S_BH)                                                        
         DC    AL4(0)                                                           
         DC    AL4(BRHIEXEC)                                                    
         DC    YL2(DTSLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  BRANCH TO LABEL IF LOWER                     
         DC    AL2(S_BL)                                                        
         DC    AL4(0)                                                           
         DC    AL4(BRLOEXEC)                                                    
         DC    YL2(DTSLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  BRANCH TO LABEL IF NOT HIGHER                
         DC    AL2(S_BNH)                                                       
         DC    AL4(0)                                                           
         DC    AL4(BRNHEXEC)                                                    
         DC    YL2(DTSLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  BRANCH TO LABEL IF NOT LOWER                 
         DC    AL2(S_BNL)                                                       
         DC    AL4(0)                                                           
         DC    AL4(BRNLEXEC)                                                    
         DC    YL2(DTSLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  BRANCH TO LABEL IF ZERO                      
         DC    AL2(S_BZ)           (SAME AS EQUAL)                              
         DC    AL4(0)                                                           
         DC    AL4(BREQEXEC)                                                    
         DC    YL2(DTSLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  BRANCH TO LABEL IF NOT ZERO                  
         DC    AL2(S_BNZ)          (SAME AS NOT EQUAL)                          
         DC    AL4(0)                                                           
         DC    AL4(BRNEEXEC)                                                    
         DC    YL2(DTSLAB,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  COMPARE TWA FIELD WITH INPUT DATA            
         DC    AL2(S_TSTI)                                                      
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSTIEXEC-SCRUNCH)                                            
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  COMPARE TWA FIELD WITH INPUT DATA            
         DC    AL2(S_CMTI)                                                      
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSTIEXEC-SCRUNCH)                                            
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  COMPARE TWA FIELD WITH INPUT FIELD           
         DC    AL2(S_TSTIF)                                                     
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSTFEXEC-SCRUNCH)                                            
         DC    YL2(0)                                                           
*                                  COMPARE TWA FIELD WITH INPUT FIELD           
         DC    AL2(S_CMTIF)                                                     
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSTFEXEC-SCRUNCH)                                            
         DC    YL2(0)                                                           
*                                  COMPARE TWA FIELD WITH SCRIPT DATA           
         DC    AL2(S_TSTS)                                                      
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSTSEXEC-SCRUNCH)                                            
         DC    YL2(DTCHAR,0,99,0)                                               
         DC    YL2(0)                                                           
*                                  COMPARE TWA FIELD WITH SCRIPT DATA           
         DC    AL2(S_CMTS)                                                      
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSTSEXEC-SCRUNCH)                                            
         DC    YL2(DTCHAR,0,99,0)                                               
         DC    YL2(0)                                                           
*                                  COMPARE NO ERROR IN TWA MESSAGE FLD          
         DC    AL2(S_TSTOK)                                                     
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSTOEXEC-SCRUNCH)                                            
         DC    YL2(0)                                                           
*                                  COMPARE TWA WITH HEX BYTE                    
         DC    AL2(S_TSTHEX)                                                    
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSTHEXEC-SCRUNCH)                                            
         DC    YL2(DTHEX2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  COMPARE TWA FIELD WITH HEX BYTE              
         DC    AL2(S_TSTFX)                                                     
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSFXEXEC-SCRUNCH)                                            
         DC    YL2(DTHEX2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  COMPARE TWA WITH BIT VALUE                   
         DC    AL2(S_TSTBIT)                                                    
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSTBEXEC-SCRUNCH)                                            
         DC    YL2(DTHEX2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  COMPARE FOR ERROR IN TWA MESSAGE FLD         
         DC    AL2(S_TSTERR)                                                    
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSTEEXEC-SCRUNCH)                                            
         DC    YL2(0)                                                           
*                                  COMPARE FOR ERROR # IN TWA MESSAGE           
         DC    AL2(S_TSTERN)                                                    
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSENEXEC-SCRUNCH)                                            
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  TEST FOR CURSOR IN CURRENT TWA FIELD         
         DC    AL2(S_TSTCUR)                                                    
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSTCEXEC-SCRUNCH)                                            
         DC    YL2(0)                                                           
*                                  TEST SCREEN LINE NUMBER                      
         DC    AL2(S_TSTLIN)                                                    
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSTLEXEC-SCRUNCH)                                            
         DC    YL2(DTBYTE,1,3,0)                                                
         DC    YL2(0)                                                           
*                                  COMPARE TWA FIELD OFSET WITH VALUE           
         DC    AL2(S_TSTOFF)                                                    
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(TSOFEXEC-SCRUNCH)                                            
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  COMPARE INPUT AREA TO SCRIPT DATA            
         DC    AL2(S_CMIS)                                                      
         DC    AL4(0)                                                           
         DC    AL4(COISEXEC)                                                    
         DC    YL2(DTCHAR,0,99,0)                                               
         DC    YL2(0)                                                           
*                                  COMPARE INPUT FIELD TO SCRIPT DATA           
         DC    AL2(S_CMIF)                                                      
         DC    AL4(0)                                                           
         DC    AL4(COIFEXEC)                                                    
         DC    YL2(DTCHAR,0,99,0)                                               
         DC    YL2(0)                                                           
*                                  COMPARE INPUT AREA POINTER                   
         DC    AL2(S_CMIP)                                                      
         DC    AL4(0)                                                           
         DC    AL4(COIPEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  COMPARE WORK AREA TO SCRIPT DATA             
         DC    AL2(S_CMWS)                                                      
         DC    AL4(0)                                                           
         DC    AL4(COWSEXEC)                                                    
         DC    YL2(DTCHAR,0,99,0)                                               
         DC    YL2(0)                                                           
*                                  COMPARE WORK AREA TO TWA FIELD DATA          
         DC    AL2(S_CMWF)                                                      
         DC    AL4(0)                                                           
         DC    AL4(COWFEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  COMPARE INPUT AREA TO FIELD                  
         DC    AL2(S_CMIFF)          WITHIN CURRENT TWA FIELD                   
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(CIFFEXEC-SCRUNCH)                                            
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  COMPARE INPUT AREA TO WORK AREA              
         DC    AL2(S_CMIW)           FOR GIVEN LENGTH                           
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(CMIWEXEC-SCRUNCH)                                            
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  ENTER DATA INTO TWA FROM INPUT               
         DC    AL2(S_INPI)           DATA AREA GIVEN DATA LENGTH                
         DC    AL4(0)                                                           
         DC    AL4(ETIDEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  MOVE DATA INTO OUTPUT DATA AREA              
         DC    AL2(S_OUTO)           FROM TWA GIVEN DATA LENGH                  
         DC    AL4(0)                                                           
         DC    AL4(MTODEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  ENTER DATA INTO TWA DIRECT FROM              
         DC    AL2(S_INPS)           SCRIPT DATA LENGTH IMPLICIT                
         DC    AL4(0)                                                           
         DC    AL4(ETISEXEC)                                                    
         DC    YL2(DTCHAR,1,99,0)                                               
         DC    YL2(0)                                                           
*                                  ENTER DATA INTO TWA FROM WORK AREA           
         DC    AL2(S_INPW)                                                      
         DC    AL4(0)                                                           
         DC    AL4(ETWLEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  MOVE DATA INTO SCRIPT FROM TWA               
         DC    AL2(S_OUTS)           DATA LENGTH IMPLICIT                       
         DC    AL4(0)                                                           
         DC    AL4(MTOSEXEC)                                                    
         DC    YL2(DTCHAR,1,99,0)                                               
         DC    YL2(0)                                                           
*                                  ENTER DATA INTO TWA FROM INPUT AREA          
         DC    AL2(S_INPIF)          FIELD AND POSITION TO NEXT FIELD           
         DC    AL4(0)                                                           
         DC    AL4(ETIFEXEC)                                                    
         DC    YL2(0)                                                           
*                                  OTO NEXT INPUT FIELD                         
         DC    AL2(S_NXTIF)                                                     
         DC    AL4(0)                                                           
         DC    AL4(NXIFEXEC)                                                    
         DC    YL2(0)                                                           
*                                  MOVE DATA FROM TWA INTO OUTPUT AREA          
         DC    AL2(S_OUTOF)          FIELD AND POSITION TO NEXT FIELD           
         DC    AL4(0)                                                           
         DC    AL4(MTOFEXEC)                                                    
         DC    YL2(0)                                                           
*                                  MOVE DATA FROM TWA INTO INPUT AREA           
         DC    AL2(S_OUTI)           GIVEN DATA LENGTH                          
         DC    AL4(0)                                                           
         DC    AL4(MTIDEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  MOVE DATA INTO WORK AREA                     
         DC    AL2(S_OUTW)           FROM TWA GIVEN DATA LENGH                  
         DC    AL4(0)                                                           
         DC    AL4(MTOWEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  MOVE DATA TO WORK AREA FROM TWA              
         DC    AL2(S_OUTFW)          FIELD WITIN FIELD FOR GIVEN LENGTH         
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(MTFWEXEC-SCRUNCH)                                            
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  MOVE DATA FROM INPUT DATA AREA TO            
         DC    AL2(S_MVIO)           OUTPUT DATA AREA GIVEN DATA LENGTH         
         DC    AL4(0)                                                           
         DC    AL4(MVIOEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  MOVE DATA FROM INPUT DATA AREA TO            
         DC    AL2(S_MVIW)           CURRENT POSITION IN WORK AREA              
         DC    AL4(0)                                                           
         DC    AL4(MVIWEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  MOVE DATA FROM CURRENT POSITION IN           
         DC    AL2(S_MVWO)           WORK AREA TO OUTPUT DATA AREA              
         DC    AL4(0)                                                           
         DC    AL4(MVWOEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  MOVE DATA FROM SCRIPT PARAMETER TO           
         DC    AL2(S_MVSO)           OUTPUT DATA AREA                           
         DC    AL4(0)                                                           
         DC    AL4(MVSOEXEC)                                                    
         DC    YL2(DTCHAR,1,99,0)                                               
         DC    YL2(0)                                                           
*                                  MOVE DATA FROM SCRIPT PARAMETER TO           
         DC    AL2(S_MVSI)           INPUT DATA AREA                            
         DC    AL4(0)                                                           
         DC    AL4(MVSIEXEC)                                                    
         DC    YL2(DTCHAR,1,99,0)                                               
         DC    YL2(0)                                                           
*                                  MOVE DATA FROM SCRIPT PARAMETER TO           
         DC    AL2(S_MVSW)           WORK AREA                                  
         DC    AL4(0)                                                           
         DC    AL4(MVSWEXEC)                                                    
         DC    YL2(DTCHAR,1,99,0)                                               
         DC    YL2(0)                                                           
*                                  MOVE CURSOR POSITION TO OUTPUT AREA          
         DC    AL2(S_CURO)                                                      
         DC    AL4(0)                                                           
         DC    AL4(CTODEXEC)                                                    
         DC    YL2(0)                                                           
*                                  MOVE CURSOR POSITION TO OUTPUT FIELD         
         DC    AL2(S_CUROF)                                                     
         DC    AL4(0)                                                           
         DC    AL4(CTOFEXEC)                                                    
         DC    YL2(0)                                                           
*                                  MOVE CURSOR POSITION TO SCRIPT               
         DC    AL2(S_CURS)                                                      
         DC    AL4(0)                                                           
         DC    AL4(CTOSEXEC)                                                    
         DC    YL2(0)                                                           
*                                  MOVE CURSOR POSITION TO INPUT AREA           
         DC    AL2(S_CURI)                                                      
         DC    AL4(0)                                                           
         DC    AL4(CTIDEXEC)                                                    
         DC    YL2(0)                                                           
*                                  MOVE RESULTS TO OUTPUT AREA                  
         DC    AL2(S_RESO)                                                      
         DC    AL4(0)                                                           
         DC    AL4(RTODEXEC)                                                    
         DC    YL2(0)                                                           
*                                  MOVE RESULTS TO OUTPUT FIELD                 
         DC    AL2(S_RESOF)                                                     
         DC    AL4(0)                                                           
         DC    AL4(RTOFEXEC)                                                    
         DC    YL2(0)                                                           
*                                  MOVE RESULTS TO SCRIPT                       
         DC    AL2(S_RESS)                                                      
         DC    AL4(0)                                                           
         DC    AL4(RTOSEXEC)                                                    
         DC    YL2(0)                                                           
*                                  MOVE RESULTS TO INPUT AREA                   
         DC    AL2(S_RESI)                                                      
         DC    AL4(0)                                                           
         DC    AL4(RTIDEXEC)                                                    
         DC    YL2(0)                                                           
*                                  SAVE ERROR MESSAGE IN BUFFER                 
         DC    AL2(S_SAVERR)                                                    
         DC    AL4(SAVEVAL)                                                     
         DC    AL4(SAVEEXEC)                                                    
         DC    YL2(0)                                                           
*                                  BACKUP OFFSET IN CURRENT TWA FIELD           
         DC    AL2(S_BACKUP)         TO FIRST NON SPACE CHARACTER               
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(BACKEXEC-SCRUNCH)                                            
         DC    YL2(0)                                                           
*                                  TURN ON TWA TRACE FLAG IN UTL                
         DC    AL2(S_TRON)                                                      
         DC    AL4(0)                                                           
         DC    AL4(TRONEXEC)                                                    
         DC    YL2(0)                                                           
*                                  TURN OFF TWA TRACE FLAG IN UTL               
         DC    AL2(S_TROFF)                                                     
         DC    AL4(0)                                                           
         DC    AL4(TROFEXEC)                                                    
         DC    YL2(0)                                                           
*                                  TURN ON SCRIPT TRACING                       
         DC    AL2(S_SCTON)                                                     
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(STONEXEC-SCRUNCH)                                            
         DC    YL2(0)                                                           
*                                  TURN OFF SCRIPT TRACING                      
         DC    AL2(S_SCTOFF)                                                    
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(STOFEXEC-SCRUNCH)                                            
         DC    YL2(0)                                                           
*                                  ERASE CURRENT TWA FIELD                      
         DC    AL2(S_ERASE)                                                     
         DC    AL4(0)                                                           
         DC    AL4(ERASEXEC)                                                    
         DC    YL2(0)                                                           
*                                  READ IN NEXT INPUT DATA BLOCK                
         DC    AL2(S_READ)                                                      
         DC    AL4(BLKIVAL)                                                     
         DC    AL4(BLKIEXEC)                                                    
         DC    YL2(0)                                                           
*                                  WRITE OUT LAST OUTPUT DATA BLOCK             
         DC    AL2(S_WRITE)                                                     
         DC    AL4(BLKOVAL)                                                     
         DC    AL4(BLKOEXEC)                                                    
         DC    YL2(0)                                                           
*                                  SET SCRIPT COMMAND COUNTER VALUE             
         DC    AL2(S_SETC)                                                      
         DC    AL4(0)                                                           
         DC    AL4(SETCEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  INCREMENT SCRIPT COMMAND COUNTER             
         DC    AL2(S_INC)                                                       
         DC    AL4(0)                                                           
         DC    AL4(INCEXEC)                                                     
         DC    YL2(0)                                                           
*                                  DECREMENT SCRIPT COMMAND COUNTER             
         DC    AL2(S_DEC)                                                       
         DC    AL4(0)                                                           
         DC    AL4(DECEXEC)                                                     
         DC    YL2(0)                                                           
*                                  SAVE CURRENT TWA FIELD LOCATION              
         DC    AL2(S_SAVFP)                                                     
         DC    AL4(0)                                                           
         DC    AL4(SAVFEXEC)                                                    
         DC    YL2(0)                                                           
*                                  RESTORE SAVED TWA FIELD LOCATION             
         DC    AL2(S_RESFP)                                                     
         DC    AL4(0)                                                           
         DC    AL4(RESFEXEC)                                                    
         DC    YL2(0)                                                           
*                                  FILL OUTPUT AREA WITH HEX CODE               
         DC    AL2(S_FILLO)          FROM CURRENT POSITION                      
         DC    AL4(0)                                                           
         DC    AL4(FILOEXEC)                                                    
         DC    YL2(DTHEX2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  SET FIELD SEPARATOR CHARACTER                
         DC    AL2(S_SEP)                                                       
         DC    AL4(0)                                                           
         DC    AL4(SEPEXEC)                                                     
         DC    YL2(DTHEX2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  SET INPUT DATA AREA LOCATION                 
         DC    AL2(S_SETIP)                                                     
         DC    AL4(0)                                                           
         DC    AL4(SIDLEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  ADD VALUE TO CURRENT INPUT DATA              
         DC    AL2(S_ADDIP)          AREA LOCATION                              
         DC    AL4(0)                                                           
         DC    AL4(AIDLEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  SUBTRACT VALUE FROM CURRENT INPUT            
         DC    AL2(S_SUBIP)          DATA AREA LOCATION                         
         DC    AL4(0)                                                           
         DC    AL4(SUILEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  ADD VALUE TO CURRENT TWA FIELD               
         DC    AL2(S_ADDTWA)         OFFSET POINTER                             
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(ADTWEXEC-SCRUNCH)                                            
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  SUBTRACT VALUE FROM CURRENT TWA              
         DC    AL2(S_SUBTWA)         FIELD OFFSET POINTER                       
         DC    AL4(0)                                                           
         DC    XL1'80'                                                          
         DC    AL3(SUTWEXEC-SCRUNCH)                                            
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  SET OUTPUT DATA AREA LOCATION                
         DC    AL2(S_SETOP)                                                     
         DC    AL4(0)                                                           
         DC    AL4(SODLEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  ADD VALUE TO CURRENT OUTPUT DATA             
         DC    AL2(S_ADDOP)          AREA LOCATION                              
         DC    AL4(0)                                                           
         DC    AL4(AODLEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  SUBTRACT VALUE FROM CURRENT OUTPUT           
         DC    AL2(S_SUBOP)          DATA AREA LOCATION                         
         DC    AL4(0)                                                           
         DC    AL4(SUOLEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  SET WORK AREA LOCATION POINTER               
         DC    AL2(S_SETWP)                                                     
         DC    AL4(0)                                                           
         DC    AL4(SWDLEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  ADD VALUE TO CURRENT WORK AREA               
         DC    AL2(S_ADDWP)          LOCATION POINTER                           
         DC    AL4(0)                                                           
         DC    AL4(AWDLEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  SET INPUT DATA RECORD POINTER                
         DC    AL2(S_SETIRP)                                                    
         DC    AL4(0)                                                           
         DC    AL4(RECIEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  SET OUTPUT DATA RECORD POINTER               
         DC    AL2(S_SETORP)                                                    
         DC    AL4(0)                                                           
         DC    AL4(RECOEXEC)                                                    
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  SET OUTPUT DATA RECORD LENGTH                
         DC    AL2(S_SETORL)                                                    
         DC    AL4(0)                                                           
         DC    AL4(0)                                                           
         DC    YL2(DTHINT,1,5,0)                                                
         DC    YL2(0)                                                           
*                                  IAM=TESTID - PASS CONTROL                    
         DC    AL2(S_IAMI)            TO =TEST SERVICE REQUEST                  
         DC    AL4(IAMVAL)            TESTID FROM INPUT DATA AREA               
         DC    AL4(IAMIEXEC)                                                    
         DC    YL2(DTLEN2,2,2,0)                                                
         DC    YL2(0)                                                           
*                                  IAM=TESTID - PASS CONTROL                    
         DC    AL2(S_IAMS)           TO =TEST SERVICE REQUEST                   
         DC    AL4(IAMVAL)           TESTID FROM SCRIPT PAAMETER                
         DC    AL4(IAMSEXEC)                                                    
         DC    YL2(DTCHAR,0,10,0)                                               
         DC    YL2(0)                                                           
*                                  ENTER KEY - PASS CONTROL                     
         DC    AL2(S_ENTWA)          TO MONITOR - NO TWA RESET                  
         DC    AL4(0)                                                           
         DC    AL4(ENTWEXEC)                                                    
         DC    YL2(0)                                                           
*                                  ENTER KEY - PASS CONTROL                     
         DC    AL2(S_ENTER)          TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(ENTREXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 01 - PASS CONTROL                      
         DC    AL2(S_PF01)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF01EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 02 - PASS CONTROL                      
         DC    AL2(S_PF02)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF02EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 03 - PASS CONTROL                      
         DC    AL2(S_PF03)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF03EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 04 - PASS CONTROL                      
         DC    AL2(S_PF04)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF04EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 05 - PASS CONTROL                      
         DC    AL2(S_PF05)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF05EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 06 - PASS CONTROL                      
         DC    AL2(S_PF06)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF06EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 07 - PASS CONTROL                      
         DC    AL2(S_PF07)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF07EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 08 - PASS CONTROL                      
         DC    AL2(S_PF08)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF08EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 09 - PASS CONTROL                      
         DC    AL2(S_PF09)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF09EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 10 - PASS CONTROL                      
         DC    AL2(S_PF10)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF10EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 11 - PASS CONTROL                      
         DC    AL2(S_PF11)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF11EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 12 - PASS CONTROL                      
         DC    AL2(S_PF12)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF12EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 13 - PASS CONTROL                      
         DC    AL2(S_PF13)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF13EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 14 - PASS CONTROL                      
         DC    AL2(S_PF14)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF14EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 15 - PASS CONTROL                      
         DC    AL2(S_PF15)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF15EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 16 - PASS CONTROL                      
         DC    AL2(S_PF16)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF16EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 17 - PASS CONTROL                      
         DC    AL2(S_PF17)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF17EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 18 - PASS CONTROL                      
         DC    AL2(S_PF18)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF18EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 19 - PASS CONTROL                      
         DC    AL2(S_PF19)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF19EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 20 - PASS CONTROL                      
         DC    AL2(S_PF20)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF20EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 21 - PASS CONTROL                      
         DC    AL2(S_PF21)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF21EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 22 - PASS CONTROL                      
         DC    AL2(S_PF22)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF22EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 23 - PASS CONTROL                      
         DC    AL2(S_PF23)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF23EXEC)                                                    
         DC    YL2(0)                                                           
*                                  PFKEY 24 - PASS CONTROL                      
         DC    AL2(S_PF24)           TO MONITOR                                 
         DC    AL4(0)                                                           
         DC    AL4(PF24EXEC)                                                    
         DC    YL2(0)                                                           
*                                                                               
SCOTABX  DC    YL2(0)                                                           
         EJECT                                                                  
***********************************************************************         
* FOLLOWING TABLES/SUBROUTINES ARE ONLY ADDRESSABLE VIA =A(.....)     *         
***********************************************************************         
         SPACE 1                                                                
         DROP  RB,RA,R9,R8                                                      
         SPACE 1                                                                
***********************************************************************         
* ENTRY POINT FOR THE COMMON ROUTINES                                 *         
* UPON ENTRY, RF HOLDS A(COMROUT) IN ITS LOW ORDER THREE BYTES AND    *         
* THE ROUTINE NUMBER IN ITS HIGH ORDER BYTE.  COMROUT WILL USE        *         
* THE ROUTINE NUMBER TO BRANCH TO THE DESIRED ROUTINE.                *         
***********************************************************************         
         SPACE 1                                                                
         DS    0H                                                               
COMROUT  NMOD1 0,**COMR**,RA,R9,R8                                              
         LR    RC,R1               GET ADDRESS GLOBAL WORK STORE FROM           
         SH    RC,=H'4'              (PARAMETER LIST)-4                         
         L     RC,0(RC)                                                         
*                                                                               
         SRL   RF,24               BRANCH TO DESIRED ROUTINE                    
         SLL   RF,2                                                             
         B     VBRANCH(RF)                                                      
         SPACE 1                                                                
***********************************************************************         
* TABLE OF BRANCH ADDRESSES TO COMMON ROUTINES                                  
***********************************************************************         
VBRANCH  EQU   *                                                                
         B     VGOTOMON                                                         
         B     VLOADFLD                                                         
         B     VLOADTIA                                                         
         B     VGETTWA                                                          
         B     VLTWAFLD                                                         
         B     VLTWANUM                                                         
         B     VLTWAADR                                                         
         B     VLTWATXT                                                         
         B     VLTWADIC                                                         
         B     VTABUNP                                                          
         B     VTABPRO                                                          
         B     VNXTFLD                                                          
         B     VFRSTFLD                                                         
         B     VFRSTUNP                                                         
         B     VFRSTPRO                                                         
         B     VVALCHAR                                                         
         B     VVALBYTE                                                         
         B     VVALHINT                                                         
         B     VVALFINT                                                         
         B     VVALSLAB                                                         
         B     VVALFLAB                                                         
         B     VVALWLAB                                                         
         B     VVALHEX2                                                         
         B     VVALLEN2                                                         
         B     VLOADCHR                                                         
         B     VLOADBYT                                                         
         B     VLOADHIN                                                         
         B     VLOADFIN                                                         
         B     VLOADSLB                                                         
         B     VLOADHX2                                                         
         B     VLOADLN2                                                         
         B     VSETSLB                                                          
         B     VTSTOUT                                                          
         B     VTSTINP                                                          
         B     VPUTFPOT                                                         
         B     VGETFPOT                                                         
         B     VPUTFATT                                                         
         B     VGETFATT                                                         
         B     VLOGBR                                                           
         B     VLOGCMP                                                          
         B     VLOGMOV                                                          
         EJECT                                                                  
***********************************************************************         
* GOTO MONITOR - TBHAID VALUE IN BYTE                                 *         
***********************************************************************         
         SPACE 1                                                                
VGOTOMON DS    0H                                                               
         BAS   RE,SETTIA           SET UP REMAINING FIELDS IN TIA               
         L     R1,ATBUFF                                                        
         USING TBHDATA,R1                                                       
         MVC   TBHAID,BYTE         SAVE ENTER OR PFKEY VALUE                    
         MVC   TBHCURS,CURSOR      SAVE ABSOLUTE CURSOR ADDRESS                 
         DROP  R1                                                               
         L     R3,ATCB             SET FACPAK CONTROL BLOCK ADDRESSES           
         USING TCBD,R3                                                          
         L     R4,AUTL                                                          
         USING UTLD,R4                                                          
         CLC   TSVCREQ(2),=X'0110' TEST FOR CONNECT SERVICE REQUEST             
         BE    GMON010                                                          
         CLI   CONFLAG,CONFAFT     CHECK AFTER ATTEMPTED CONNECT                
         BNE   GMON012                                                          
         CLI   TSYS,0              CHECK CONNECTED TO SYSTEM OK                 
         BE    GMONER4             ELSE EXIT WITH ERROR CODE                    
         B     GMON012                                                          
*                                                                               
GMON010  MVI   CONFLAG,CONFBEF     SET CONNECTING TO SYSTEM                     
*                                                                               
GMON012  ICM   RF,15,=V(MONITOR)                                                
         BZ    GMON020                                                          
         LA    R2,TIOBVAL          SET TIOBAID FROM VALUE IN BYTE               
         USING TIOBD,R2                                                         
         MVC   TIOBAID,BYTE                                                     
         DROP  R2                                                               
         L     R1,ATCB                                                          
         GOTO1 =V(MONITOR)         CALL MONITOR                                 
         CLC   TSVCREQ,=XL2'01FF'  CHECK RETURNED WITH ABEND                    
         BE    GMONABN             IF SO EXIT                                   
         CLI   CONFLAG,CONFBEF     TEST IF WAS CONNECTING                       
         BNE   GMON020                                                          
         MVI   CONFLAG,CONFAFT     SET CONFLAG TO DONE CONNECT                  
*                                                                               
         L     RE,AFLPTAB          REINITIALISE FIELD POSITION                  
* ??     STCM  RE,15,AFLPTNXT      TABLE FOR FRESH SCREEN                       
         L     RF,AFLPTABX                                                      
         SR    RF,RE                                                            
* ??     XCEF                                                                   
         L     RE,AFATTAB          REINITIALISE FIELD ATTRIBUTE                 
* ??     STCM  RE,15,AFATTNXT      TABLE FOR FRESH SCREEN                       
* ??     STCM  RE,15,AFATLAST                                                   
         L     RF,AFATTABX                                                      
         SR    RF,RE                                                            
* ??     XCEF                                                                   
*                                                                               
         CLI   TSYS,0              CHECK CONNECTED TO SYSTEM OK                 
         BE    GMON020             DONT SWITCH IF NOT                           
         MVC   TCBPRG,TPRG         SAVE TCB PROGRAM CODE                        
         ICM   R0,15,=XL4'FFFFFFFF' SWITCH TO NEW CONNECT SYSTEM                
         GOTO1 =V(FASWITCH),DMCB,(TSYS,(R0)),0,RR=RELO                          
         CLI   4(R1),2             SYSTEM IS NO-OP                              
         BE    GMONER2             SWITCH ERROR EXITS                           
         CLI   4(R1),0                                                          
         BNE   GMONER3                                                          
         MVC   CTRY,TCTRY          SAVE COUNTRY/LANGUAGE/SYSTEM                 
         MVC   LANG,TLANG                                                       
         MVC   OVSYS,TOVSYS                                                     
*                                                                               
GMON020  EQU   *                                                                
         CLI   SVTWLFLG,C'Y'       CHECK FOR SAVE TWA LOCATION FLAG             
         BE    GMON030                                                          
         GOTO1 FRSTUNP,CRPARM      DEFAULT TO FIRST UNPROTECTED FIELD           
         BNE   GMONNO                                                           
*                                  INITIALISE TIA TWA FIELD BUFFER              
GMON030  EQU   *                                                                
         XC    CURSOR,CURSOR                                                    
*                                  INITIALISE TIA TWA FIELD BUFFER              
         ICM   R1,15,ATIA                                                       
         BZR   RE                                                               
         LA    RF,4                                                             
         STCM  RF,3,4(R1)                                                       
         LA    R1,64(R1)                                                        
         MVC   0(4,R1),=XL4'03FFFF00'                                           
         B     GMONOK                                                           
*                                                                               
GMONABN  MVI   ABNDFLAG,C'Y'       FLAG ABEND RETURNED                          
         B     GMONNO                                                           
*                                  ERROR EXITS                                  
GMONER1  MVC   ERRCODE,=Y(EQGMON1)                                              
         B     GMONNO                                                           
GMONER2  MVC   ERRCODE,=Y(EQGMON2)                                              
         B     GMONNO                                                           
GMONER3  MVC   ERRCODE,=Y(EQGMON3)                                              
         B     GMONNO                                                           
GMONER4  MVC   ERRCODE,=Y(EQGMON4)                                              
         B     GMONNO                                                           
*                                                                               
GMONNO   B     CRNO              ERROR EXIT                                     
GMONOK   B     CRYES             EXIT OK                                        
         DROP  R3,R4                                                            
         SPACE 1                                                                
***********************************************************************         
* SET TERMINATOR IN TIA BEFORE CALL TO MONITOR                        *         
***********************************************************************         
         SPACE 1                                                                
SETTIA   NTR1                                                                   
         L     R1,AUTL                                                          
         USING UTLD,R1                                                          
         CLI   TSVCREQ,X'01'                                                    
         BE    STIA100                                                          
         DROP  R1                                                               
         SR    R2,R2               FIND FIELD IN TWA                            
         L     R5,ATWA                                                          
         LA    R5,64(R5)                                                        
         USING FLDHDRD,R5                                                       
*                                                                               
STIA010  IC    R2,FLDLEN                                                        
         CH    R2,=H'9'                                                         
         BL    STIA100                                                          
         CLI   FLDATB,X'FF'                                                     
         BE    STIA020                                                          
         TM    FLDATB,FATBPROT                                                  
         BO    STIA020                                                          
         TM    FLDOIND,FOUTTRN                                                  
         BZ    STIA020                                                          
         TM    FLDOIND,FOUTMOD                                                  
         BO    STIA030                                                          
         TM    FLDATB,FATBMOD                                                   
         BO    STIA030                                                          
*                                                                               
STIA020  AR    R5,R2               BUMP TO NEXT FIELD                           
         B     STIA010                                                          
*                                                                               
STIA030  SR    R3,R3                                                            
         IC    R3,FLDOLEN                                                       
         MVI   LTIAFLAG,C'N'       FLAG NO LOAD INTO EXISTING FIELD             
         GOTO1 LOADTIA,CRPARM,FLDDATA,(R3),(R5)                                 
         B     STIA020                                                          
*                                                                               
STIA100  ICM   R1,15,ATIA                                                       
         BZ    STIAX                                                            
         SR    RF,RF                                                            
         ICM   RF,3,4(R1)                                                       
         LA    RE,60(RF,R1)                                                     
         XC    0(4,RE),0(RE)                                                    
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         STCM  RF,3,4(R1)                                                       
*                                                                               
STIAX    XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
* LOAD STRING OF DATA INTO FIELD BUFFER FOR CURRENT TWA LOCATION      *         
*                                                                     *         
*     PARAMETER 1 - A(DATA)                                           *         
*     PARAMETER 2 - LENGTH DATA                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLOADFLD DS    0H                                                               
         LM    R2,R3,0(R1)         R2=A(DATA), R3=LENGTH                        
*                                                                               
         ICM   R5,15,TWALOC        R5=A(CURRENT TWA LOCATION)                   
         BZ    LFLDER1                                                          
         USING FLDHDRD,R5                                                       
         CLI   FLDATB,X'FF'                                                     
         BE    LFLDER2                                                          
         TM    FLDATB,FATBPROT                                                  
         BO    LFLDER3                                                          
         SR    RF,RF                                                            
         IC    RF,FLDLEN                                                        
         CH    RF,=H'9'                                                         
         BL    LFLDER4                                                          
*                                                                               
         LR    R0,R3               CHECK FIELD DATA LENGTH OVERFLOW             
         LA    R1,L'FDATA                                                       
         SR    RF,RF                                                            
         IC    RF,TWAFOFF                                                       
         AR    R1,RF                                                            
         CR    R1,R0                                                            
         BL    LFLDER4                                                          
         LA    RF,FDATA            MOVE DATA INTO WORK AREA                     
         LTR   R3,R3               CHECK FIELD DATA LENGTH ZERO                 
         BZ    LFLD016                                                          
*                                                                               
LFLD010  CLI   0(R2),0             DROP CHARACTER IF NULL                       
         BE    LFLD012                                                          
         MVC   0(1,RF),0(R2)                                                    
         LA    RF,1(RF)                                                         
         LA    R2,1(R2)                                                         
         B     LFLD014                                                          
LFLD012  BCTR  R3,0                DECREMENT DATA LENGTH                        
         LA    R2,1(R2)                                                         
LFLD014  BCT   R0,LFLD010                                                       
LFLD016  LA    R2,FDATA            R2=A(NULL FREE DATA), R3=LENGTH              
*                                                                               
         SR    R6,R6               GET FIELD DATA LENGTH                        
         ICM   R6,1,FLDLEN                                                      
         SH    R6,=H'8'                                                         
         TM    FLDATB,FATBXHDR                                                  
         BZ    *+8                                                              
         SH    R6,=H'8'                                                         
         SR    RF,RF                                                            
         IC    RF,TWAFOFF                                                       
         CR    R6,RF                                                            
         BL    LFLDOK                                                           
         SR    R6,RF                                                            
         CR    R6,R3                                                            
         BNH   *+6                                                              
         LR    R6,R3               LOAD TIA WITH FIELD DATA                     
         MVI   LTIAFLAG,C'Y'       FLAG OK TO LOAD INTO EXISTING FIELD          
         GOTO1 LOADTIA,CRPARM,(R2),(R6),(R5)                                    
         ICM   R1,15,0(R1)                                                      
         BZ    LFLDOK                                                           
         STCM  R1,15,LASTTIA                                                    
         SR    RF,RF                                                            
         IC    RF,TWAFOFF                                                       
         AR    RF,R6                                                            
         STC   RF,TWAFOFF                                                       
         USING IFLDHDRD,R1                                                      
         SR    RE,RE                                                            
         ICM   RE,3,IFLDADR        UPDATE CURSOR ADDRESS                        
         LA    RE,1(R6,RE)                                                      
         STCM  RE,3,CURSOR                                                      
         GOTO1 PUTFPOT,CRPARM      PUT ENTRY IN FIELD POSITION TABLE            
         BNE   LFLDNO                                                           
         B     LFLDOK                                                           
         DROP  R1                                                               
*                                                                               
LFLDER1  MVC   ERRCODE,=Y(EQLFLD1)                                              
         B     LFLDNO                                                           
LFLDER2  MVC   ERRCODE,=Y(EQLFLD2)                                              
         B     LFLDNO                                                           
LFLDER3  MVC   ERRCODE,=Y(EQLFLD3)                                              
         B     LFLDNO                                                           
LFLDER4  MVC   ERRCODE,=Y(EQLFLD4)                                              
         B     LFLDNO                                                           
*                                                                               
LFLDNO   B     CRNO                                                             
LFLDOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* LOAD FIELD DATA INTO TIA BUFFER                                     *         
*                                                                     *         
*     PARAMETER 1 - A(DATA)                                           *         
*     PARAMETER 2 - LENGTH DATA                                       *         
*     PARAMETER 3 - A(TWA FIELD)                                      *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLOADTIA DS    0H                                                               
         LM    R2,R4,0(R1)         R2=A(DATA), R3=LENGTH, R4=A(TWA)             
         ST    R1,PARMSV                                                        
         XC    0(4,R1),0(R1)                                                    
         L     R5,ATIA                                                          
         LA    R5,64(R5)           R5=A(TIA FIELD DATA ENTRY)                   
         USING FLDHDRD,R4                                                       
         USING IFLDHDRD,R5                                                      
         SR    R6,R6                                                            
*                                  SEARCH THROUGH TIA FOR PLACE                 
LTIA020  ICM   R6,1,IFLDLEN          TO INSERT TIA FIELD DATA                   
         BZ    LTIAOK              EXIT IF NULL FIELD IN TIA                    
         CLC   IFLDADR,FLDADR                                                   
         BH    LTIA030             INSERT IF HIGHER TWA ADDRESS FOUND           
         CLC   IFLDADR,FLDADR                                                   
         BE    LTIA100             INSERT IF SAME TWA ADDRESS FOUND             
         CLC   IFLDADR,=XL2'FFFF'                                               
         BE    LTIAOK              EXIT AT END LIMIT OF TIA                     
         AR    R5,R6                                                            
         B     LTIA020             BUMP TO NEXT FIELD IN TIA                    
*                                                                               
LTIA030  SR    RF,RF               INSERT NEW FIELD POSITION FOUND              
         L     R1,ATIA                                                          
         ICM   RF,3,4(R1)          RF=A(END OF TIA FIELD BUFFER)                
         LA    RF,64(RF,R1)                                                     
         LA    R1,3(R3,RF)         R1=RF+LENGTH OF NEW TIA FIELD                
*                                  SHIFT TIA FIELD TO RIGHT TO MAKE             
LTIA040  CR    R1,R5                 ROOM TO INSERT NEW FIELD                   
         BNH   LTIA050                                                          
         MVC   0(1,R1),0(RF)       BYTE BY BYTE FROM END MOVING BACK            
         BCTR  RF,0                MOVING BACK TO NED FIELD INSERT              
         BCTR  R1,0                  POSITION                                   
         B     LTIA040                                                          
*                                  INSERT FIELD DATA OF GIVEN LENGTH            
LTIA050  SR    RF,RF                                                            
         L     R1,ATIA                                                          
         ICM   RF,3,4(R1)          ADD TO OVERALL TIA BUFFER LENGTH             
         LA    RF,3(R3,RF)                                                      
         STCM  RF,3,4(R1)                                                       
         LA    RF,64(RF,R1)                                                     
         MVI   0(RF),0                                                          
         LA    RF,3(R3)                                                         
         STC   RF,IFLDLEN          SET NEW TIA FIELD LENGTH                     
         MVC   IFLDADR,FLDADR      MOVE IN TWA ADDRESS                          
         LTR   R3,R3               TEST FOR NULL FIELD                          
         BZ    LTIA052                                                          
         BCTR  R3,0                MOVE IN TWA FIELD DATA                       
         EX    R3,*+8                                                           
         B     *+10                                                             
         MVC   IFLDDATA(0),0(R2)                                                
LTIA052  L     R1,PARMSV                                                        
         ST    R5,0(R1)            RETURN NEW FIELD POSITION IN TIA             
         B     LTIAOK                                                           
*                                                                               
LTIA100  CLI   LTIAFLAG,C'N'       TEST FLAG OK TO LOAD EXISTING FIELD          
         BE    LTIAOK                                                           
         SR    RF,RF               EXISTING FIELD POSITION FOUND                
         L     R1,ATIA                                                          
         ICM   RF,3,4(R1)          RF=A(END OF TIA FIELD BUFFER)                
         LA    RF,64(RF,R1)                                                     
         LA    R1,0(R3,RF)         R1=RF+LENGTH OF NEW TIA FIELD                
         AR    R5,R6               BUMP R5 TO NEXT FIELD IN TIA                 
*                                  SHIFT TIA FIELD TO RIGHT TO MAKE             
LTIA110  CR    R1,R5                 ROOM TO INSERT NEW FIELD                   
         BNH   LTIA120                                                          
         MVC   0(1,R1),0(RF)       BYTE BY BYTE FROM END MOVING BACK            
         BCTR  RF,0                MOVING BACK TO NED FIELD INSERT              
         BCTR  R1,0                  POSITION                                   
         B     LTIA110                                                          
*                                  INSERT FIELD DATA OF GIVEN LENGTH            
LTIA120  SR    RF,RF                                                            
         SR    R5,R6               RETURN TO PREVIOUS FIELD IN TIA              
         L     R1,ATIA                                                          
         ICM   RF,3,4(R1)          ADD TO OVERALL TIA BUFFER LENGTH             
         LA    RF,0(R3,RF)                                                      
         STCM  RF,3,4(R1)                                                       
         LA    RF,64(RF,R1)                                                     
         MVI   0(RF),0                                                          
         SR    RF,RF                                                            
         IC    RF,IFLDLEN                                                       
         LR    RE,RF                                                            
         AR    RE,R3                                                            
         STC   RE,IFLDLEN          SET NEW TIA FIELD LENGTH                     
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         BCTR  RF,0                                                             
         LA    RE,IFLDDATA                                                      
         AR    RE,RF                                                            
         LTR   R3,R3               TEST FOR ZERO LENGTH FIELD                   
         BZ    LTIA122                                                          
         BCTR  R3,0                MOVE IN TWA FIELD DATA                       
         EX    R3,*+8                                                           
         B     *+10                                                             
         MVC   0(0,RE),0(R2)                                                    
LTIA122  L     R1,PARMSV                                                        
         ST    R5,0(R1)            RETURN NEW FIELD POSITION IN TIA             
         B     LTIAOK                                                           
*                                                                               
LTIANO   B     CRNO                                                             
LTIAOK   B     CRYES                                                            
         DROP  R4,R5                                                            
         EJECT                                                                  
***********************************************************************         
* GET STRING OF DATA FROM TWA FIELD AT CURRENT TWALOC POSITION        *         
*                                                                     *         
*     PARAMETER 1 - A(DATA)                                           *         
*     PARAMETER 2 - LENGTH DATA                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VGETTWA  DS    0H                                                               
         LM    R2,R3,0(R1)         R2=A(DATA), R3=LENGTH                        
*                                                                               
         ST    R1,PARMSV                                                        
         XC    0(4,R1),0(R1)                                                    
         ICM   R5,15,TWALOC        R5=A(CURRENT TWA LOCATION)                   
         BZ    GTWAER1                                                          
         USING FLDHDRD,R5                                                       
         CLI   FLDATB,X'FF'                                                     
         BE    GTWAER2                                                          
*                                  SET UP FLD DATA IN FDATA                     
         SR    R6,R6                                                            
         IC    R6,FLDLEN                                                        
         CH    R6,=H'9'                                                         
         BL    GTWAER3                                                          
         SH    R6,=H'9'                                                         
         TM    FLDATB,FATBXHDR                                                  
         BZ    *+8                                                              
         SH    R6,=H'8'                                                         
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   FDATA(0),FLDDATA    SAVE FIELD DATA                              
*                                                                               
GTWA010  LTR   R3,R3                                                            
         BZ    GTWA100                                                          
         BCTR  R3,0                                                             
         EX    R3,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),CRSPACES    CLEAR RETURN DATA AREA                       
         TM    FLDATB,FATBPROT                                                  
         BO    GTWA020                                                          
         TM    FLDOIND,FOUTTRN                                                  
         BO    *+12                                                             
         IC    R6,FLDILEN                                                       
         B     *+8                                                              
         IC    R6,FLDOLEN                                                       
         LTR   R6,R6                                                            
         BZ    GTWA100                                                          
         BCTR  R6,0                                                             
*                                                                               
GTWA020  SR    RF,RF               ADJUST FOR CURRENT FIELD OFFSET              
         IC    RF,TWAFOFF                                                       
         LA    RE,FDATA                                                         
         AR    RE,RF                                                            
         CR    R6,RF                                                            
         BL    GTWA100                                                          
         SR    R6,RF                                                            
         CR    R6,R3                                                            
         BNH   *+6                                                              
         LR    R6,R3                                                            
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),0(RE)       GET DATA OUT OF FIELD AT OFFSET              
         LA    R6,1(R6)                                                         
         L     R1,PARMSV                                                        
         ST    R6,0(R1)                                                         
         B     GTWA100                                                          
*                                                                               
GTWA100  ST    R5,TWALOC                                                        
         MVI   TWAFOFF,0                                                        
         B     GTWAOK                                                           
*                                                                               
GTWAER1  MVC   ERRCODE,=Y(EQGTWA1)                                              
         B     GTWANO                                                           
GTWAER2  MVC   ERRCODE,=Y(EQGTWA2)                                              
         B     GTWANO                                                           
GTWAER3  MVC   ERRCODE,=Y(EQGTWA3)                                              
         B     GTWANO                                                           
*                                                                               
GTWANO   B     CRNO                                                             
GTWAOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* LOCATE NTH FIELD IN TWA                                             *         
*                                                                     *         
*     PARAMETER 1 - A(FIELD SEQUENCE NUMBER)                          *         
*     PARAMETER 2 - CONTROL BYTE - 'U' UNPROTECTED, 'P' PROTECTED,    *         
*                   ELSE EVERY FIELD                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLTWAFLD DS    0H                                                               
         LM    R2,R3,0(R1)         R2=(FLD#),R3=CONTROL CHARACTER               
         SR    R1,R1                                                            
         IC    R1,0(R2)                                                         
         OI    CONDCODE,CCEQUALQ                                                
*                                                                               
         SR    RF,RF               FIND UNPROTECTED FIELD                       
         L     R5,ATWA             IN TWA                                       
         LA    R5,64(R5)                                                        
         USING FLDHDRD,R5                                                       
*                                                                               
LTWF010  IC    RF,FLDLEN                                                        
         CH    RF,=H'9'                                                         
         BL    LTWFER1                                                          
         CLI   FLDATB,X'FF'                                                     
         BE    LTWF020                                                          
         CLM   R3,8,=CL1'P'                                                     
         BE    LTWF012                                                          
         CLM   R3,8,=CL1'U'                                                     
         BE    LTWF014                                                          
         B     LTWF030                                                          
LTWF012  TM    FLDATB,FATBPROT                                                  
         BO    LTWF030                                                          
         B     LTWF020                                                          
LTWF014  TM    FLDATB,FATBPROT                                                  
         BZ    LTWF030                                                          
         B     LTWF020                                                          
*                                                                               
LTWF020  AR    R5,RF               BUMP TO NEXT FIELD                           
         B     LTWF010                                                          
*                                                                               
LTWF030  BCT   R1,LTWF020          BUMP TO NEXT FIELD                           
*                                  SET FIELD HEADER STATUS                      
LTWF100  ST    R5,TWALOC                                                        
         MVI   TWAFOFF,0                                                        
         B     LTWFOK                                                           
*                                                                               
LTWFER1  EQU   *                                                                
* ??     MVC   ERRCODE,=Y(EQLTWF1)                                              
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     LTWFOK                                                           
*                                                                               
LTWFNO   B     CRNO                                                             
LTWFOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* LOCATE TWA FIELD WITH GIVEN NUMBER                                  *         
*                                                                     *         
*     PARAMETER 1 - A(BYTE FIELD NUMBER)                              *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLTWANUM DS    0H                                                               
         L     R2,0(R1)            R2=A(FIELD NUMBER)                           
         OI    CONDCODE,CCEQUALQ                                                
*                                                                               
         SR    RF,RF               FIND FIELD IN TWA                            
         L     R5,ATWA                                                          
         LA    R5,64(R5)                                                        
         USING FLDHDRD,R5                                                       
*                                                                               
LTWN010  IC    RF,FLDLEN                                                        
         CH    RF,=H'9'                                                         
         BL    LTWNER1                                                          
         CLI   FLDATB,X'FF'                                                     
         BE    LTWN020                                                          
         TM    FLDATB,FATBXHDR                                                  
         BZ    LTWN020                                                          
         SR    R1,R1                                                            
         IC    R1,FLDLEN                                                        
         SH    R1,=H'16'                                                        
         LA    R1,FLDXNUM(R1)                                                   
         CLC   0(L'FLDXNUM,R1),0(R2)                                            
         BE    LTWN100                                                          
*                                                                               
LTWN020  AR    R5,RF               BUMP TO NEXT FIELD                           
         B     LTWN010                                                          
*                                                                               
LTWN100  ST    R5,TWALOC                                                        
         MVI   TWAFOFF,0                                                        
         B     LTWNOK                                                           
*                                                                               
LTWNER1  EQU   *                                                                
* ??     MVC   ERRCODE,=Y(EQLTWN1)                                              
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     LTWNOK                                                           
*                                                                               
LTWNNO   B     CRNO                                                             
LTWNOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* LOCATE TWA FIELD WITH GIVEN SCREEN ADDRESS                          *         
*                                                                     *         
*     PARAMETER 1 - A(FIELD ADDRESS)                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLTWAADR DS    0H                                                               
         L     R2,0(R1)            R2=A(FIELD NUMBER)                           
         OI    CONDCODE,CCEQUALQ                                                
*                                                                               
         SR    RF,RF               FIND FIELD IN TWA                            
         L     R5,ATWA                                                          
         LA    R5,64(R5)                                                        
         USING FLDHDRD,R5                                                       
*                                                                               
LTAD010  IC    RF,FLDLEN                                                        
         CH    RF,=H'9'                                                         
         BL    LTADER1                                                          
         CLI   FLDATB,X'FF'                                                     
         BE    LTAD020                                                          
         CLC   FLDADR,0(R2)                                                     
         BE    LTAD100                                                          
*                                                                               
LTAD020  AR    R5,RF               BUMP TO NEXT FIELD                           
         B     LTAD010                                                          
*                                                                               
LTAD100  ST    R5,TWALOC                                                        
         MVI   TWAFOFF,0                                                        
         B     LTADOK                                                           
*                                                                               
LTADER1  EQU   *                                                                
* ??     MVC   ERRCODE,=Y(EQLTAD1)                                              
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     LTADOK                                                           
*                                                                               
LTADNO   B     CRNO                                                             
LTADOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* LOCATE TWA FIELD WITH TEXT COMPARE                                  *         
* STARTING FROM CURRENT TWA LOCATION                                  *         
*                                                                     *         
*     PARAMETER 1 - A(TEXT)                                           *         
*     PARAMETER 2 - LENGTH OF TEXT FOR COMPARE                        *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLTWATXT DS    0H                                                               
         LM    R2,R3,0(R1)         R2=A(TEXT),R3=LENGTH                         
         OI    CONDCODE,CCEQUALQ                                                
*                                                                               
         SR    RF,RF               FIND FIELD IN TWA                            
         SR    R6,R6                                                            
         ICM   R5,15,TWALOC                                                     
         BCTR  R3,0                                                             
         USING FLDHDRD,R5                                                       
*                                                                               
LTWT010  CLI   FLDATB,X'FF'                                                     
         BE    LTWT030                                                          
         SR    RF,RF                                                            
         IC    RF,FLDLEN                                                        
         CH    RF,=H'9'                                                         
         BL    LTWTER1                                                          
         SH    RF,=H'8'                                                         
         TM    FLDATB,FATBXHDR                                                  
         BZ    *+8                                                              
         SH    RF,=H'8'                                                         
         SR    R6,R6                                                            
         TM    FLDATB,FATBPROT     GET FIELD DATA LENGTH                        
         BZ    *+10                                                             
         LR    R6,RF                                                            
         B     *+8                                                              
         IC    R6,FLDOLEN                                                       
         LTR   R6,R6                                                            
         BZ    LTWT030                                                          
         XC    CTXTBUF2,CTXTBUF2                                                
         XC    CTXTBUF1,CTXTBUF1                                                
         LA    R4,CTXTBUF1         MARK END OF COMPARE TEXT BUFFER              
         AR    R4,R6                                                            
         BCTR  R6,0                                                             
         EX    R6,*+8              SAVE TWA FIELD TEXT FOR COMPARE              
         B     *+10                                                             
         MVC   CTXTBUF1(0),FLDDATA                                              
         OC    CTXTBUF1,CRSPACES   CONVERT TO UPPERCASE                         
         CR    R6,R3                                                            
         BNH   *+6                                                              
         LR    R6,R3                                                            
         LA    R7,CTXTBUF1                                                      
         EX    R6,*+8              SAVE INPUT DATA FOR TEXT COMPARE             
         B     *+10                                                             
         MVC   CTXTBUF2(0),0(R2)                                                
         OC    CTXTBUF2,CRSPACES   CONVERT TO UPPERCASE                         
*                                                                               
LTWT020  EX    R6,*+8              COMPARE DATA WITH ALL POSITIONS              
         B     *+10                  IN FIELD                                   
         CLC   CTXTBUF2(0),0(R7)                                                
         BE    LTWT100             EXIT DATA STRING MATCHED                     
         LA    R1,1(R6,R7)         BUMP ALONG TWA FIELD BUFFER                  
         CR    R1,R4                                                            
         BNL   LTWT030                                                          
         LA    R7,1(R7)                                                         
         B     LTWT020                                                          
*                                                                               
LTWT030  IC    RF,FLDLEN           BUMP TO NEXT TWA FIELD                       
         CH    RF,=H'9'                                                         
         BL    LTWTER1                                                          
         AR    R5,RF                                                            
         B     LTWT010                                                          
*                                                                               
LTWT100  ST    R5,TWALOC           SAVE POSITION OF FIELD FOUND                 
         MVI   TWAFOFF,0                                                        
         B     LTWTOK                                                           
*                                                                               
LTWTER1  EQU   *                                                                
* ??     MVC   ERRCODE,=Y(EQLTWT1)                                              
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     LTWTOK                                                           
*                                                                               
LTWTNO   B     CRNO                                                             
LTWTOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* LOCATE TWA FIELD WITH GIVEN DICTIONARY NUMBER                       *         
*                                                                     *         
*     PARAMETER 1 - A(BYTE FIELD NUMBER)                              *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLTWADIC DS    0H                                                               
         L     R2,0(R1)            R2=A(FIELD NUMBER)                           
         OI    CONDCODE,CCEQUALQ                                                
*                                                                               
         SR    RF,RF               FIND FIELD IN TWA                            
         L     R5,ATWA                                                          
         LA    R5,64(R5)                                                        
         USING FLDHDRD,R5                                                       
*                                                                               
LTWD010  IC    RF,FLDLEN                                                        
         CH    RF,=H'9'                                                         
         BL    LTWDER1                                                          
         CLI   FLDATB,X'FF'                                                     
         BE    LTWD020                                                          
         TM    FLDATB,FATBXHDR                                                  
         BZ    LTWD020                                                          
         CLC   FLDXNUM,0(R2)                                                    
         BE    LTWD100                                                          
*                                                                               
LTWD020  AR    R5,RF               BUMP TO NEXT FIELD                           
         B     LTWD010                                                          
*                                                                               
LTWD100  ST    R5,TWALOC                                                        
         MVI   TWAFOFF,0                                                        
         B     LTWDOK                                                           
*                                                                               
LTWDER1  EQU   *                                                                
* ??     MVC   ERRCODE,=Y(EQLTWD1)                                              
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     LTWDOK                                                           
*                                                                               
LTWDNO   B     CRNO                                                             
LTWDOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* TAB TO NEXT UNPROTECTED FIELD                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VTABUNP  DS    0H                                                               
         SR    RF,RF                                                            
         OI    CONDCODE,CCEQUALQ                                                
         ICM   R5,15,TWALOC        R5=A(CURRENT TWA LOCATION)                   
         BZ    TUNPER1                                                          
         USING FLDHDRD,R5                                                       
*                                                                               
TUNP010  IC    RF,FLDLEN           BUMP TO NEXT FIELD                           
         CH    RF,=H'9'                                                         
         BL    TUNPER2                                                          
         AR    R5,RF                                                            
         CLI   FLDATB,X'FF'                                                     
         BE    TUNP010                                                          
         TM    FLDATB,FATBPROT                                                  
         BO    TUNP010                                                          
*                                                                               
TUNP100  ST    R5,TWALOC                                                        
         MVI   TWAFOFF,0                                                        
         B     TUNPOK                                                           
*                                                                               
TUNPER1  MVC   ERRCODE,=Y(EQTUNP1)                                              
         B     TUNPNO                                                           
TUNPER2  EQU   *                                                                
* ??     MVC   ERRCODE,=Y(EQTUNP2)                                              
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     TUNPOK                                                           
*                                                                               
TUNPNO   B     CRNO                                                             
TUNPOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* TAB TO NEXT PROTECTED FIELD                                         *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VTABPRO  DS    0H                                                               
         OI    CONDCODE,CCEQUALQ                                                
         SR    RF,RF                                                            
         ICM   R5,15,TWALOC        R5=A(CURRENT TWA LOCATION)                   
         BZ    TPROER1                                                          
         USING FLDHDRD,R5                                                       
*                                                                               
TPRO010  IC    RF,FLDLEN           BUMP TO NEXT FIELD                           
         CH    RF,=H'9'                                                         
         BL    TPROER2                                                          
         AR    R5,RF                                                            
         CLI   FLDATB,X'FF'                                                     
         BE    TPRO010                                                          
         TM    FLDATB,FATBPROT                                                  
         BZ    TPRO010                                                          
*                                                                               
TPRO100  ST    R5,TWALOC                                                        
         MVI   TWAFOFF,0                                                        
         B     TPROOK                                                           
*                                                                               
TPROER1  MVC   ERRCODE,=Y(EQTPRO1)                                              
         B     TPRONO                                                           
TPROER2  EQU   *                                                                
* ??     MVC   ERRCODE,=Y(EQTPRO2)                                              
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     TPROOK                                                           
*                                                                               
TPRONO   B     CRNO                                                             
TPROOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* GOTO NEXT FIELD IN TWA                                              *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VNXTFLD  DS    0H                                                               
         OI    CONDCODE,CCEQUALQ                                                
         SR    RF,RF                                                            
         ICM   R5,15,TWALOC        R5=A(CURRENT TWA LOCATION)                   
         BZ    NFLDER1                                                          
         USING FLDHDRD,R5                                                       
*                                                                               
NFLD010  IC    RF,FLDLEN           BUMP TO NEXT FIELD                           
         CH    RF,=H'9'                                                         
         BL    NFLDER2                                                          
         AR    R5,RF                                                            
         CLI   FLDATB,X'FF'                                                     
         BE    NFLD010                                                          
*                                                                               
NFLD100  ST    R5,TWALOC                                                        
         MVI   TWAFOFF,0                                                        
         TM    FLDATB,FATBPROT                                                  
         BO    NFLDOK                                                           
         B     NFLDOK                                                           
*                                                                               
NFLDER1  MVC   ERRCODE,=Y(EQNFLD1)                                              
         B     NFLDNO                                                           
NFLDER2  EQU   *                                                                
* ??     MVC   ERRCODE,=Y(EQNFLD2)                                              
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     NFLDOK                                                           
*                                                                               
NFLDNO   B     CRNO                                                             
NFLDOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* POSITION TO FIRST FIELD IN TWA                                      *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VFRSTFLD DS    0H                                                               
         SR    RF,RF               FIND FIRST FIELD                             
         L     R5,ATWA             IN TWA                                       
         LA    R5,64(R5)                                                        
         ST    R5,TWALOC                                                        
         MVI   TWAFOFF,0                                                        
         USING FLDHDRD,R5                                                       
         TM    FLDATB,FATBPROT                                                  
         BO    FFLDOK                                                           
         B     FFLDOK                                                           
*                                                                               
FFLDNO   B     CRNO                                                             
FFLDOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* POSITION TO FIRST UNPROTECTED FIELD IN TWA                          *         
* SETTING TWALOC - TWA LOCATION POINTER                               *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VFRSTUNP DS    0H                                                               
         OI    CONDCODE,CCEQUALQ                                                
         SR    RF,RF               FIND UNPROTECTED FIELD                       
         L     R5,ATWA             IN TWA                                       
         LA    R5,64(R5)                                                        
         USING FLDHDRD,R5                                                       
*                                                                               
FUNP010  CLI   FLDATB,X'FF'                                                     
         BE    FUNP020                                                          
         TM    FLDATB,FATBPROT                                                  
         BZ    FUNP030                                                          
*                                                                               
FUNP020  IC    RF,FLDLEN           BUMP TO NEXT FIELD                           
         CH    RF,=H'9'                                                         
         BL    FUNPER1                                                          
         AR    R5,RF                                                            
         B     FUNP010                                                          
*                                                                               
FUNP030  ST    R5,TWALOC                                                        
         MVI   TWAFOFF,0                                                        
         B     FUNPOK                                                           
*                                                                               
FUNPER1  EQU   *                                                                
* ??     MVC   ERRCODE,=Y(EQFUNP1)                                              
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     FUNPOK                                                           
*                                                                               
FUNPNO   B     CRNO                                                             
FUNPOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* POSITION TO FIRST PROTECTED FIELD IN TWA                            *         
* SETTING TWALOC - TWA LOCATION POINTER                               *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VFRSTPRO DS    0H                                                               
         OI    CONDCODE,CCEQUALQ                                                
         SR    RF,RF               FIND UNPROTECTED FIELD                       
         L     R5,ATWA             IN TWA                                       
         LA    R5,64(R5)                                                        
         USING FLDHDRD,R5                                                       
*                                                                               
FPRO010  CLI   FLDATB,X'FF'                                                     
         BE    FPRO020                                                          
         TM    FLDATB,FATBPROT                                                  
         BO    FPRO030                                                          
*                                                                               
FPRO020  IC    RF,FLDLEN           BUMP TO NEXT FIELD                           
         CH    RF,=H'9'                                                         
         BL    FPROER1                                                          
         AR    R5,RF                                                            
         B     FPRO010                                                          
*                                                                               
FPRO030  ST    R5,TWALOC                                                        
         MVI   TWAFOFF,0                                                        
         B     FPROOK                                                           
*                                                                               
FPROER1  EQU   *                                                                
* ??     MVC   ERRCODE,=Y(EQFPRO1)                                              
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     FPROOK                                                           
*                                                                               
FPRONO   B     CRNO                                                             
FPROOK   B     CRYES                                                            
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE SCRIPT CONTROL INSTRUCTION CHARACTER DATA PARAMETER        *         
*                                                                     *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
*     PARAMETER 2 - MINIMUM LENGTH OF PARAMETER STRING                *         
*     PARAMETER 3 - MAXIMUM LENGTH OF PARAMETER STRING                *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VVALCHAR DS    0H                                                               
         LM    R2,R4,0(R1)                                                      
         MVC   DUB(2),ZEROS                                                     
         MVZ   DUB(2),0(R2)                                                     
         CLC   DUB(2),ZEROS                                                     
         BNE   VCHAER1                                                          
         PACK  DUB,0(2,R2)                                                      
         CVB   RF,DUB                                                           
         CR    RF,R3                                                            
         BL    VCHAER2                                                          
         CR    RF,R4                                                            
         BH    VCHAER3                                                          
         LA    RE,2(RF)                                                         
         STCM  RE,15,0(R1)                                                      
         B     VCHAOK                                                           
*                                                                               
VCHAER1  MVC   ERRCODE,=Y(EQVCHA1)                                              
         B     VCHANO                                                           
VCHAER2  MVC   ERRCODE,=Y(EQVCHA2)                                              
         B     VCHANO                                                           
VCHAER3  MVC   ERRCODE,=Y(EQVCHA3)                                              
         B     VCHANO                                                           
*                                                                               
VCHANO   B     CRNO                                                             
VCHAOK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE SCRIPT CONTROL INSTRUCTION BYTE LENGTH INTEGER PARAMETER   *         
*                                                                     *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
*     PARAMETER 2 - MINIMUM LENGTH OF PARAMETER STRING                *         
*     PARAMETER 3 - MAXIMUM LENGTH OF PARAMETER STRING                *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VVALBYTE DS    0H                                                               
         LM    R2,R4,0(R1)                                                      
         MVC   DUB(2),ZEROS                                                     
         MVZ   DUB(2),0(R2)                                                     
         CLC   DUB(2),ZEROS                                                     
         BNE   VBYTER1                                                          
         PACK  DUB,0(2,R2)                                                      
         CVB   RF,DUB                                                           
         CR    RF,R3                                                            
         BL    VBYTER2                                                          
         CR    RF,R4                                                            
         BH    VBYTER3                                                          
         LA    RE,2(RF)                                                         
         STCM  RE,15,0(R1)                                                      
         LTR   RF,RF                                                            
         BZ    VBYTOK                                                           
         MVC   DUB(8),ZEROS                                                     
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVZ   DUB(0),2(R2)                                                     
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   DUB(0),ZEROS                                                     
         BNE   VBYTER4                                                          
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,2(0,R2)                                                      
         CP    DUB,=PL8'255'                                                    
         BH    VBYTER5                                                          
         CP    DUB,=PL8'0'                                                      
         BL    VBYTER5                                                          
         B     VBYTOK                                                           
*                                                                               
VBYTER1  MVC   ERRCODE,=Y(EQVBYT1)                                              
         B     VBYTNO                                                           
VBYTER2  MVC   ERRCODE,=Y(EQVBYT2)                                              
         B     VBYTNO                                                           
VBYTER3  MVC   ERRCODE,=Y(EQVBYT3)                                              
         B     VBYTNO                                                           
VBYTER4  MVC   ERRCODE,=Y(EQVBYT4)                                              
         B     VBYTNO                                                           
VBYTER5  MVC   ERRCODE,=Y(EQVBYT5)                                              
         B     VBYTNO                                                           
*                                                                               
VBYTNO   B     CRNO                                                             
VBYTOK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE SCRIPT CONTROL INSTRUCTION HALF WORD INTEGER PARAMETER     *         
*                                                                     *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
*     PARAMETER 2 - MINIMUM LENGTH OF PARAMETER STRING                *         
*     PARAMETER 3 - MAXIMUM LENGTH OF PARAMETER STRING                *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VVALHINT DS    0H                                                               
         LM    R2,R4,0(R1)                                                      
         MVC   DUB(2),ZEROS                                                     
         MVZ   DUB(2),0(R2)                                                     
         CLC   DUB(2),ZEROS                                                     
         BNE   VHINER1                                                          
         PACK  DUB,0(2,R2)                                                      
         CVB   RF,DUB                                                           
         CR    RF,R3                                                            
         BL    VHINER2                                                          
         CR    RF,R4                                                            
         BH    VHINER3                                                          
         LA    RE,2(RF)                                                         
         STCM  RE,15,0(R1)                                                      
         LTR   RF,RF                                                            
         BZ    VHINOK                                                           
         MVC   DUB(8),ZEROS                                                     
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVZ   DUB(0),2(R2)                                                     
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   DUB(0),ZEROS                                                     
         BNE   VHINER4                                                          
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,2(0,R2)                                                      
         CP    DUB,=PL8'65535'                                                  
         BH    VHINER5                                                          
         CP    DUB,=PL8'0'                                                      
         BL    VHINER5                                                          
         B     VHINOK                                                           
*                                                                               
VHINER1  MVC   ERRCODE,=Y(EQVHIN1)                                              
         B     VHINNO                                                           
VHINER2  MVC   ERRCODE,=Y(EQVHIN2)                                              
         B     VHINNO                                                           
VHINER3  MVC   ERRCODE,=Y(EQVHIN3)                                              
         B     VHINNO                                                           
VHINER4  MVC   ERRCODE,=Y(EQVHIN4)                                              
         B     VHINNO                                                           
VHINER5  MVC   ERRCODE,=Y(EQVHIN5)                                              
         B     VHINNO                                                           
*                                                                               
VHINNO   B     CRNO                                                             
VHINOK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE SCRIPT CONTROL INSTRUCTION FULL WORD INTEGER PARAMETER     *         
*                                                                     *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
*     PARAMETER 2 - MINIMUM LENGTH OF PARAMETER STRING                *         
*     PARAMETER 3 - MAXIMUM LENGTH OF PARAMETER STRING                *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VVALFINT DS    0H                                                               
         LM    R2,R4,0(R1)                                                      
         MVC   DUB(2),ZEROS                                                     
         MVZ   DUB(2),0(R2)                                                     
         CLC   DUB(2),ZEROS                                                     
         BNE   VFINER1                                                          
         PACK  DUB,0(2,R2)                                                      
         CVB   RF,DUB                                                           
         CR    RF,R3                                                            
         BL    VFINER2                                                          
         CR    RF,R4                                                            
         BH    VFINER3                                                          
         LA    RE,2(RF)                                                         
         STCM  RE,15,0(R1)                                                      
         LTR   RF,RF                                                            
         BZ    VFINOK                                                           
         MVC   DUB(8),ZEROS                                                     
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVZ   DUB(0),2(R2)                                                     
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   DUB(0),ZEROS                                                     
         BNE   VFINER4                                                          
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,2(0,R2)                                                      
         CP    DUB,=PL8'4294967295'                                             
         BH    VFINER5                                                          
         CP    DUB,=PL8'0'                                                      
         BL    VFINER5                                                          
         B     VFINOK                                                           
*                                                                               
VFINER1  MVC   ERRCODE,=Y(EQVFIN1)                                              
         B     VFINNO                                                           
VFINER2  MVC   ERRCODE,=Y(EQVFIN2)                                              
         B     VFINNO                                                           
VFINER3  MVC   ERRCODE,=Y(EQVFIN3)                                              
         B     VFINNO                                                           
VFINER4  MVC   ERRCODE,=Y(EQVFIN4)                                              
         B     VFINNO                                                           
VFINER5  MVC   ERRCODE,=Y(EQVFIN5)                                              
         B     VFINNO                                                           
*                                                                               
VFINNO   B     CRNO                                                             
VFINOK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE SCRIPT LABEL                                               *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
***********************************************************************         
         SPACE 1                                                                
VVALSLAB DS    0H                                                               
         L     R2,0(R1)                                                         
         ST    R1,PARMSV                                                        
         USING SYMTABD,R6                                                       
         L     R6,ASYMTAB                                                       
         USING SCOTABD,R4                                                       
         L     R4,SCTPTR                                                        
*                                                                               
VSLA010  C     R6,ASYMTABX                                                      
         BNL   VSLAER1                                                          
         C     R6,ASYMTNXT                                                      
         BE    VSLA040                                                          
         TM    SYTTYPE,SYTTSLBQ                                                 
         BZ    VSLA030                                                          
         CLC   SCTCODE,=AL2(S_LBLS)                                             
         BNE   VSLA020                                                          
         CLC   SYTNAME,0(R2)                                                    
         BNE   VSLA030                                                          
         OC    SYTADDR,SYTADDR                                                  
         BNZ   VSLAER2                                                          
         LA    R2,2(R2)                                                         
         STCM  R2,15,SYTADDR                                                    
         B     VSLA100                                                          
*                                                                               
VSLA020  CLC   SYTNAME,0(R2)                                                    
         BE    VSLA100                                                          
         B     VSLA030                                                          
*                                                                               
VSLA030  LA    R6,SYMTABL(R6)                                                   
         B     VSLA010                                                          
*                                                                               
VSLA040  MVC   SYTNAME,0(R2)                                                    
         OI    SYTTYPE,SYTTSLBQ                                                 
         XC    SYTADDR,SYTADDR                                                  
         CLC   SCTCODE,=AL2(S_LBLS)                                             
         BNE   VSLA060                                                          
         LA    R2,2(R2)                                                         
         STCM  R2,15,SYTADDR                                                    
*                                                                               
VSLA060  L     RF,ASYMTNXT                                                      
         LA    RF,SYMTABL(RF)                                                   
         ST    RF,ASYMTNXT                                                      
*                                                                               
VSLA100  L     R1,PARMSV                                                        
         LA    RF,2                                                             
         STCM  RF,15,0(R1)                                                      
         B     VSLAOK                                                           
*                                                                               
VSLAER1  MVC   ERRCODE,=Y(EQVSLA1)                                              
         B     VSLANO                                                           
VSLAER2  MVC   ERRCODE,=Y(EQVSLA2)                                              
         B     VSLANO                                                           
*                                                                               
VSLANO   B     CRNO                                                             
VSLAOK   B     CRYES                                                            
         DROP  R4,R6                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE TWA FIELD LABEL                                            *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
***********************************************************************         
         SPACE 1                                                                
VVALFLAB DS    0H                                                               
         L     R2,0(R1)                                                         
         ST    R1,PARMSV                                                        
         USING SYMTABD,R6                                                       
         L     R6,ASYMTAB                                                       
         USING SCOTABD,R4                                                       
         L     R4,SCTPTR                                                        
*                                                                               
VFLA010  C     R6,ASYMTABX                                                      
         BNL   VFLAER1                                                          
         C     R6,ASYMTNXT                                                      
         BE    VFLA040                                                          
         TM    SYTTYPE,SYTTFLBQ                                                 
         BZ    VFLA030                                                          
         CLC   SCTCODE,=AL2(S_LBLT)                                             
         BNE   VFLA020                                                          
         CLC   SYTNAME,0(R2)                                                    
         BE    VFLAER2                                                          
         B     VFLA030                                                          
*                                                                               
VFLA020  CLC   SYTNAME,0(R2)                                                    
         BE    VFLA100                                                          
         B     VFLA030                                                          
*                                                                               
VFLA030  LA    R6,SYMTABL(R6)                                                   
         B     VFLA010                                                          
*                                                                               
VFLA040  CLC   SCTCODE,=AL2(S_LBLT)                                             
         BNE   VFLAER2                                                          
         MVC   SYTNAME,0(R2)                                                    
         OI    SYTTYPE,SYTTFLBQ                                                 
         L     RF,ASYMTNXT                                                      
         LA    RF,SYMTABL(RF)                                                   
         ST    RF,ASYMTNXT                                                      
*                                                                               
VFLA100  L     R1,PARMSV                                                        
         LA    RF,2                                                             
         STCM  RF,15,0(R1)                                                      
         B     VFLAOK                                                           
*                                                                               
VFLAER1  MVC   ERRCODE,=Y(EQVFLA1)                                              
         B     VFLANO                                                           
VFLAER2  MVC   ERRCODE,=Y(EQVFLA2)                                              
         B     VFLANO                                                           
*                                                                               
VFLANO   B     CRNO                                                             
VFLAOK   B     CRYES                                                            
         DROP  R4,R6                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE WORK AREA LABEL                                            *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
***********************************************************************         
         SPACE 1                                                                
VVALWLAB DS    0H                                                               
         L     R2,0(R1)                                                         
         ST    R1,PARMSV                                                        
         USING SYMTABD,R6                                                       
         L     R6,ASYMTAB                                                       
         USING SCOTABD,R4                                                       
         L     R4,SCTPTR                                                        
*                                                                               
VWLA010  C     R6,ASYMTABX                                                      
         BNL   VWLAER1                                                          
         C     R6,ASYMTNXT                                                      
         BE    VWLA040                                                          
         TM    SYTTYPE,SYTTWLBQ                                                 
         BZ    VWLA030                                                          
         CLC   SCTCODE,=AL2(S_LBLW)                                             
         BNE   VWLA020                                                          
         CLC   SYTNAME,0(R2)                                                    
         BE    VWLAER2                                                          
         B     VWLA030                                                          
*                                                                               
VWLA020  CLC   SYTNAME,0(R2)                                                    
         BE    VWLA100                                                          
         B     VWLA030                                                          
*                                                                               
VWLA030  LA    R6,SYMTABL(R6)                                                   
         B     VWLA010                                                          
*                                                                               
VWLA040  MVC   SYTNAME,0(R2)                                                    
         OI    SYTTYPE,SYTTWLBQ                                                 
         L     RF,ASYMTNXT                                                      
         LA    RF,SYMTABL(RF)                                                   
         ST    RF,ASYMTNXT                                                      
*                                                                               
VWLA100  L     R1,PARMSV                                                        
         LA    RF,2                                                             
         STCM  RF,15,0(R1)                                                      
         B     VWLAOK                                                           
*                                                                               
VWLAER1  MVC   ERRCODE,=Y(EQVWLA1)                                              
         B     VWLANO                                                           
VWLAER2  MVC   ERRCODE,=Y(EQVWLA2)                                              
         B     VWLANO                                                           
*                                                                               
VWLANO   B     CRNO                                                             
VWLAOK   B     CRYES                                                            
         DROP  R4,R6                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE SCRIPT CONTROL INSTRUCTION 2 BYTE HEX CODE                 *         
*                                                                     *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VVALHEX2 DS    0H                                                               
         L     R2,0(R1)                                                         
         ST    R1,PARMSV                                                        
         GOTO1 =V(HEXIN),DMCB,(R2),WORK,2,RR=RELO                               
         CLC   12(4,R1),=F'1'                                                   
         BNE   VHX2ER1                                                          
         LA    RE,2                                                             
         L     R1,PARMSV                                                        
         STCM  RE,15,0(R1)                                                      
         B     VHX2OK                                                           
*                                                                               
VHX2ER1  MVC   ERRCODE,=Y(EQVHX21)                                              
         B     VHX2NO                                                           
*                                                                               
VHX2NO   B     CRNO                                                             
VHX2OK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE SCRIPT CONTROL INSTRUCTION 2 BYTE LENGTH PARAMETER         *         
*                                                                     *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VVALLEN2 DS    0H                                                               
         L     R2,0(R1)                                                         
         MVC   DUB(2),ZEROS                                                     
         MVZ   DUB(2),0(R2)                                                     
         CLC   DUB(2),ZEROS                                                     
         BNE   VLN2ER1                                                          
         LA    RE,2                                                             
         STCM  RE,15,0(R1)                                                      
         B     VLN2OK                                                           
*                                                                               
VLN2ER1  MVC   ERRCODE,=Y(EQVLN21)                                              
         B     VLN2NO                                                           
*                                                                               
VLN2NO   B     CRNO                                                             
VLN2OK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* LOAD SCRIPT CONTROL INSTRUCTION CHARACTER DATA PARAMETER            *         
*                                                                     *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
*     PARAMETER 2 - A(LOAD WORK AREA)                                 *         
*     PARAMETER 3 - LENGTH OF LOAD WORK AREA                          *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLOADCHR DS    0H                                                               
         LM    R2,R4,0(R1)                                                      
         PACK  DUB,0(2,R2)                                                      
         CVB   RF,DUB                                                           
         LA    RE,2(RF)                                                         
         STCM  RE,15,0(R1)                                                      
         LTR   R1,R4                                                            
         BZ    LCHAOK                                                           
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),CRSPACES                                                 
         LTR   RF,RF                                                            
         BZ    LCHAOK                                                           
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),2(R2)                                                    
         B     LCHAOK                                                           
*                                                                               
LCHANO   B     CRNO                                                             
LCHAOK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* LOAD SCRIPT CONTROL INSTRUCTION BYTE INTEGER PARAMETER              *         
*                                                                     *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
*     PARAMETER 2 - A(LOAD WORK AREA)                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLOADBYT DS    0H                                                               
         LM    R2,R3,0(R1)                                                      
         PACK  DUB,0(2,R2)                                                      
         CVB   RF,DUB                                                           
         LA    RE,2(RF)                                                         
         STCM  RE,15,0(R1)                                                      
         XC    0(2,R3),0(R3)                                                    
         LTR   RF,RF                                                            
         BZ    LBYTOK                                                           
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,2(0,R2)                                                      
         CVB   RF,DUB                                                           
         STCM  RF,1,0(R3)                                                       
         B     LBYTOK                                                           
*                                                                               
LBYTNO   B     CRNO                                                             
LBYTOK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* LOAD SCRIPT CONTROL INSTRUCTION HALF WORD INTEGER PARAMTER          *         
*                                                                     *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
*     PARAMETER 2 - A(LOAD WORK AREA)                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLOADHIN DS    0H                                                               
         LM    R2,R3,0(R1)                                                      
         PACK  DUB,0(2,R2)                                                      
         CVB   RF,DUB                                                           
         LA    RE,2(RF)                                                         
         STCM  RE,15,0(R1)                                                      
         XC    0(2,R3),0(R3)                                                    
         LTR   RF,RF                                                            
         BZ    LHINOK                                                           
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,2(0,R2)                                                      
         CVB   RF,DUB                                                           
         STCM  RF,3,0(R3)                                                       
         B     LHINOK                                                           
*                                                                               
LHINNO   B     CRNO                                                             
LHINOK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* LOAD SCRIPT CONTROL INSTRUCTION FULL WORD INTEGER PARAMTER          *         
*                                                                     *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
*     PARAMETER 2 - A(LOAD WORK AREA)                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLOADFIN DS    0H                                                               
         LM    R2,R3,0(R1)                                                      
         PACK  DUB,0(2,R2)                                                      
         CVB   RF,DUB                                                           
         LA    RE,2(RF)                                                         
         STCM  RE,15,0(R1)                                                      
         XC    0(2,R3),0(R3)                                                    
         LTR   RF,RF                                                            
         BZ    LFINOK                                                           
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,2(0,R2)                                                      
         CVB   RF,DUB                                                           
         STCM  RF,15,0(R3)                                                      
         B     LFINOK                                                           
*                                                                               
LFINNO   B     CRNO                                                             
LFINOK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* LOAD SYMBOLIC LABEL ENTRY FROM SYMBOL TABLE                         *         
*                                                                     *         
*     PARAMETER 1 - A(WORK AREA CONTAINING SYMBOL NAME)               *         
*     PARAMETER 2 - A(SYMBOLIC LABEL TYPE)                            *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLOADSLB DS    0H                                                               
         LM    R2,R3,0(R1)                                                      
         ST    R1,PARMSV                                                        
         USING SYMTABD,R2                                                       
         L     R6,ASYMTAB                                                       
*                                                                               
LSLB010  C     R6,ASYMTNXT                                                      
         BE    LSLBER1                                                          
         C     R6,ASYMTABX                                                      
         BNL   LSLBER2                                                          
         OC    SYTTYPE,0(R3)                                                    
         BZ    LSLB020                                                          
         CLC   SYTNAME,0(R6)                                                    
         BE    LSLB030                                                          
*                                                                               
LSLB020  LA    R6,SYMTABL(R6)                                                   
         B     LSLB010                                                          
*                                                                               
LSLB030  MVC   SYTNAME(SYMTABL),0(R6)                                           
         TM    SYTINDS-SYMTABD(R6),SYTTSLBQ                                     
         BE    LSLB032                                                          
         TM    SYTINDS-SYMTABD(R6),SYTTFLBQ                                     
         BE    LSLB034                                                          
         TM    SYTINDS-SYMTABD(R6),SYTTWLBQ                                     
         BE    LSLB036                                                          
         B     LSLBOK                                                           
LSLB032  MVC   SLABLAST,SYTNAME                                                 
         B     LSLBOK                                                           
LSLB034  MVC   FLABLAST,SYTNAME                                                 
         B     LSLBOK                                                           
LSLB036  MVC   WLABLAST,SYTNAME                                                 
         B     LSLBOK                                                           
*                                                                               
LSLBER1  MVC   ERRCODE,=Y(EQLSLB1)                                              
         B     LSLBNO                                                           
LSLBER2  MVC   ERRCODE,=Y(EQLSLB2)                                              
         B     LSLBNO                                                           
*                                                                               
LSLBNO   B     CRNO                                                             
LSLBOK   B     CRYES                                                            
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* LOAD SCRIPT CONTROL INSTRUCTION 2 BYTE HEX CODE                     *         
*                                                                     *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
*     PARAMETER 2 - A(RETURN WORK AREA)                               *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLOADHX2 DS    0H                                                               
         LM    R2,R3,0(R1)                                                      
         ST    R1,PARMSV                                                        
         XC    0(2,R3),0(R3)                                                    
         GOTO1 =V(HEXIN),DMCB,(R2),(R3),2,RR=RELO                               
         CLC   12(4,R1),=F'1'                                                   
         BNE   LHX2ER1                                                          
         LA    RE,2                                                             
         L     R1,PARMSV                                                        
         STCM  RE,15,0(R1)                                                      
         B     LHX2OK                                                           
*                                                                               
LHX2ER1  MVC   ERRCODE,=Y(EQLHX21)                                              
         B     LHX2NO                                                           
*                                                                               
LHX2NO   B     CRNO                                                             
LHX2OK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* LOAD SCRIPT CONTROL INSTRUCTION 2 BYTE LENGTH PARAMETER             *         
*                                                                     *         
*     PARAMETER 1 - A(DATA PARAMETER)                                 *         
*     PARAMETER 2 - A(LOAD WORK AREA)                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLOADLN2 DS    0H                                                               
         LM    R2,R3,0(R1)                                                      
         XC    0(2,R3),0(R3)                                                    
         PACK  DUB,0(2,R2)                                                      
         CVB   RF,DUB                                                           
         STCM  RF,3,0(R3)                                                       
         LA    RE,2                                                             
         STCM  RE,15,0(R1)                                                      
         B     LLN2OK                                                           
*                                                                               
LLN2NO   B     CRNO                                                             
LLN2OK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* SET SYMBOLIC LABEL ENTRY IN SYMBOL TABLE                            *         
*                                                                     *         
*     PARAMETER 1 - A(WORK AREA CONTAINING SYMBOL NAME)               *         
*     PARAMETER 2 - A(SYMBOLIC LABEL TYPE)                            *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VSETSLB  DS    0H                                                               
         LM    R2,R3,0(R1)                                                      
         ST    R1,PARMSV                                                        
         USING SYMTABD,R2                                                       
         L     R6,ASYMTAB                                                       
*                                                                               
SSLB010  C     R6,ASYMTNXT                                                      
         BE    SSLBER1                                                          
         C     R6,ASYMTABX                                                      
         BNL   SSLBER2                                                          
         OC    SYTTYPE,0(R3)                                                    
         BZ    SSLB020                                                          
         CLC   SYTNAME,0(R6)                                                    
         BE    SSLB030                                                          
*                                                                               
SSLB020  LA    R6,SYMTABL(R6)                                                   
         B     SSLB010                                                          
*                                                                               
SSLB030  MVC   0(SYMTABL,R6),SYTNAME                                            
         B     SSLBOK                                                           
*                                                                               
SSLBER1  MVC   ERRCODE,=Y(EQSSLB1)                                              
         B     SSLBNO                                                           
SSLBER2  MVC   ERRCODE,=Y(EQSSLB2)                                              
         B     SSLBNO                                                           
*                                                                               
SSLBNO   B     CRNO                                                             
SSLBOK   B     CRYES                                                            
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* TEST FOR OUTPUT DATA AREA OVERFLOW                                  *         
*                                                                     *         
*     PARAMETER 1 - HALF WORD LENGTH OF DATA                          *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VTSTOUT  DS    0H                                                               
         SR    R2,R2                                                            
         L     R2,0(R1)            R2=A(LENGTH DATA)                            
*                                                                               
         L     R1,OUDATLOC                                                      
         AH    R1,0(R2)                                                         
         S     R1,ASCRIPOD                                                      
         CLM   R1,3,OUDATMAX                                                    
         BH    TOUTER1                                                          
         B     TOUTOK                                                           
*                                                                               
TOUTER1  MVC   ERRCODE,=Y(EQTOUT1)                                              
         B     TOUTNO                                                           
*                                                                               
TOUTNO   B     CRNO                                                             
TOUTOK   B     CRYES                                                            
         SPACE 2                                                                
***********************************************************************         
* TEST FOR INPUT DATA AREA OVERFLOW                                   *         
*                                                                     *         
*     PARAMETER 1 - HALF WORD LENGTH OF DATA                          *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VTSTINP  DS    0H                                                               
         SR    R2,R2                                                            
         L     R2,0(R1)            R2=A(LENGTH DATA)                            
*                                                                               
         L     R1,INDATWRL                                                      
         AH    R1,0(R2)                                                         
         S     R1,ASCRIPID                                                      
         CLM   R1,3,INDATMAX                                                    
         BH    TINPER1                                                          
         B     TINPOK                                                           
*                                                                               
TINPER1  MVC   ERRCODE,=Y(EQTINP1)                                              
         B     TINPNO                                                           
*                                                                               
TINPNO   B     CRNO                                                             
TINPOK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* PUT ENTRY INTO FIELD POSITION TABLE                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VPUTFPOT DS    0H                                                               
         L     R2,TWALOC                                                        
         S     R2,ATWA                                                          
         L     R6,AFLPTAB                                                       
         USING FLPTABD,R6                                                       
*                                                                               
PFPO010  C     R6,AFLPTABX                                                      
         BNL   PFPOER1                                                          
         C     R6,AFLPTNXT                                                      
         BE    PFPO030                                                          
         CLM   R2,3,FLPTWA                                                      
         BE    PFPO040                                                          
*                                                                               
PFPO020  LA    R6,FLPTABL(R6)                                                   
         B     PFPO010                                                          
*                                                                               
PFPO030  STCM  R2,3,FLPTWA                                                      
         ICM   RF,15,INDATRDL                                                   
         S     RF,ASCRIPID                                                      
         STCM  RF,3,FLPINP                                                      
*                                                                               
         L     RF,AFLPTNXT                                                      
         LA    RF,FLPTABL(RF)                                                   
         ST    RF,AFLPTNXT                                                      
         B     PFPOOK                                                           
*                                                                               
PFPO040  STCM  R2,3,FLPTWA                                                      
         ICM   RF,15,INDATRDL                                                   
         S     RF,ASCRIPID                                                      
         STCM  RF,3,FLPINP                                                      
         B     PFPOOK                                                           
*                                                                               
PFPOER1  MVC   ERRCODE,=Y(EQPFPO1)                                              
         B     PFPONO                                                           
*                                                                               
PFPONO   B     CRNO                                                             
PFPOOK   B     CRYES                                                            
         DROP  R6                                                               
         EJECT                                                                  
***********************************************************************         
* GET ENTRY FROM FIELD POSITION TABLE                                 *         
* P1 = A(WORK AREA CONTAINING FIELD ADDRESS                           *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VGETFPOT DS    0H                                                               
         L     R2,0(R1)                                                         
         USING FLPTABD,R2                                                       
         L     R6,AFLPTAB                                                       
*                                                                               
GFPO010  C     R6,AFLPTNXT                                                      
         BE    GFPONO                                                           
         C     R6,AFLPTABX                                                      
         BNL   GFPONO                                                           
         CLC   FLPTWA,0(R6)                                                     
         BE    GFPO030                                                          
*                                                                               
GFPO020  LA    R6,FLPTABL(R6)                                                   
         B     GFPO010                                                          
*                                                                               
GFPO030  MVC   FLPTWA(FLPTABL),0(R6)                                            
         B     GFPOOK                                                           
*                                                                               
GFPONO   B     CRNO                                                             
GFPOOK   B     CRYES                                                            
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* PUT ENTRY INTO FIELD ATTRIBUTE TABLE                                *         
* P1 = A(WORK AREA CONTAINING FIELD ATTRIBUTE)                        *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VPUTFATT DS    0H                                                               
         L     R2,0(R1)                                                         
         L     R6,AFATTAB                                                       
         USING FATTABD,R6                                                       
*                                                                               
PFAT010  C     R6,AFATTABX                                                      
         BNL   PFATER1                                                          
         C     R6,AFATTNXT                                                      
         BE    PFAT030                                                          
         CLC   FATTWA,TWALOC                                                    
         BE    PFAT040                                                          
*                                                                               
PFAT020  LA    R6,FATTABL(R6)                                                   
         B     PFAT010                                                          
*                                                                               
PFAT030  MVC   FATVAL,0(R2)                                                     
         MVC   FATTWA,TWALOC                                                    
         L     RF,AFATTNXT                                                      
         LA    RF,FATTABL(RF)                                                   
         ST    RF,AFATTNXT                                                      
         B     PFATOK                                                           
*                                                                               
PFAT040  MVC   FATVAL,0(R2)                                                     
         MVC   FATTWA,TWALOC                                                    
         B     PFATOK                                                           
*                                                                               
PFATER1  MVC   ERRCODE,=Y(EQPFAT1)                                              
         B     PFATNO                                                           
*                                                                               
PFATNO   B     CRNO                                                             
PFATOK   B     CRYES                                                            
         DROP  R6                                                               
         EJECT                                                                  
***********************************************************************         
* GET ENTRY FROM FIELD ATTRIBUTE TABLE                                *         
* P1 = A(WORK AREA CONTAINING FIELD ATTRIBUTE)                        *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VGETFATT DS    0H                                                               
         L     R2,0(R1)                                                         
         L     R6,AFATLAST                                                      
         USING FATTABD,R2                                                       
*                                                                               
GFAT010  C     R6,AFATTNXT                                                      
         BE    GFATER1                                                          
         C     R6,AFATTABX                                                      
         BNL   GFATER1                                                          
         CLC   FATVAL,FATVAL-FATTABD(R6)                                        
         BE    GFAT030                                                          
*                                                                               
GFAT020  LA    R6,FATTABL(R6)                                                   
         B     GFAT010                                                          
*                                                                               
GFAT030  MVC   FATTWA(FATTABL),0(R6)                                            
         ST    R6,AFATLAST                                                      
         B     GFATOK                                                           
*                                                                               
GFATER1  MVC   ERRCODE,=Y(EQGFAT1)                                              
         B     GFATNO                                                           
*                                                                               
GFATNO   B     CRNO                                                             
GFATOK   B     CRYES                                                            
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* LOG BRANCH COMMAND FOR TRACE                                        *         
* P1 = (BRANCH LABEL)                                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLOGBR   DS    0H                                                               
         L     R2,0(R1)                                                         
         MVC   LOGLINE,=CL40'BRANCHED TO:'                                      
         MVC   LOGLINE+13(2),0(R2)                                              
         B     LOBROK                                                           
*                                                                               
LOBRNO   B     CRNO                                                             
LOBROK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* LOG COMPARE COMMAND FOR TRACE                                       *         
* P1 = (LENGTH)                                                       *         
* P2 = A(DATA 1)                                                      *         
* P3 = A(DATA 2)                                                      *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLOGCMP  DS    0H                                                               
         LM    R2,R4,0(R1)                                                      
         MVC   LOGLINE,=CL40'COMPARE:'                                          
         EDIT  (R2),(5,LOGLINE+9),FILL=0,WRK=WORK80                             
         CLM   R2,15,=F'10'                                                     
         BNH   *+8                                                              
         ICM   R2,15,=F'10'                                                     
         BCTR  R2,0                                                             
         EX    R2,*+8                                                           
         B     *+10                                                             
         MVC   LOGLINE+16(0),0(R3)                                              
         EX    R2,*+8                                                           
         B     *+10                                                             
         MVC   LOGLINE+28(0),0(R4)                                              
         B     LOCMOK                                                           
*                                                                               
LOCMNO   B     CRNO                                                             
LOCMOK   B     CRYES                                                            
         EJECT                                                                  
***********************************************************************         
* LOG MOVE COMMAND FOR TRACE                                          *         
* P1 = (LENGTH)                                                       *         
* P2 = (DATA)                                                         *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
VLOGMOV  DS    0H                                                               
         LM    R2,R3,0(R1)                                                      
         MVC   LOGLINE,=CL40'MOVED:'                                            
         EDIT  (R2),(5,LOGLINE+9),FILL=0,WRK=WORK80                             
         CLM   R2,15,=F'20'                                                     
         BNH   *+8                                                              
         ICM   R2,15,=F'20'                                                     
         BCTR  R2,0                                                             
         EX    R2,*+8                                                           
         B     *+10                                                             
         MVC   LOGLINE+16(0),0(R3)                                              
         B     LOMOOK                                                           
*                                                                               
LOMONO   B     CRNO                                                             
LOMOOK   B     CRYES                                                            
*                                                                               
CRYES    SR    RC,RC               RETURN CC EQUAL                              
CRNO     LTR   RC,RC               RETURN CC NOT EQUAL                          
CRXIT    XIT1                                                                   
*                                                                               
XDIRECT  L     RD,SAVERD           EXIT MODULE                                  
         XMOD1 1                                                                
         EJECT                                                                  
         LTORG                                                                  
         SPACE 2                                                                
         DS    0D                                                               
ZEROS    DC    CL8'00000000'                                                    
CRSPACES DC    CL99' '                                                          
         EJECT                                                                  
         DROP  RB,RA,R9,R8                                                      
         DS    0H                                                               
         SPACE 2                                                                
***********************************************************************         
* INITIALISATION                                                      *         
***********************************************************************         
         SPACE 1                                                                
INITIAL  NTR1  BASE=*                                                           
*                                  SETUP ADDRESSES OF COMMON ROUTINES           
         L     R2,=A(COMROUT)      R2 = A(COMROUT)                              
         A     R2,RELO                                                          
         SR    R3,R3               R3 = ROUTINE NUMBER = 0                      
         LA    R4,COMRADRS         R4 = A(FIRST ROUTINE ADDRESS)                
         LA    R5,COMRADRN         R5 = NUMBER OF CONTROLLER ROUTINES           
         LTR   R5,R5               IF NO CONTROLLER ROUTINES THEN DONE          
         BZ    INIT020                                                          
*                                                                               
INIT010  ST    R2,0(R4)            SAVE A(COMROUT) IN LAST 3 BYTES              
         STC   R3,0(R4)            SAVE ROUTINE NUMBER IN FIRST BYTE            
         LA    R3,1(R3)            BUMP ROUTINE NUMBER                          
         LA    R4,4(R4)            BUMP TO NEXT ROUTINE ADDRESS                 
         BCT   R5,INIT010          LOOP BACK                                    
*                                                                               
INIT020  MVC   ERRCODE,=Y(EQNOERR) SET SCRIPT ERROR TO NO ERROR                 
         MVI   CONFLAG,CONFNO      SET CONNECTED FLAG TO                        
         MVI   EXITFLAG,C'N'       DO NOT EXIT                                  
         MVI   ABNDFLAG,C'N'       ABEND FLAG OFF                               
         MVI   SVTWLFLG,C'N'       SET SAVE TWA LOCATION FLAG TO NO             
         MVI   CTFLAGS,0           CLEAR =CT PARAMETER FLAGS                    
         MVI   SCTFLAG,C'N'        SET SCRIPT TRACE FLAG TO OFF                 
         MVI   FLDSEP,FLDSEPDQ     DEFAULT FIELD SEPARATOR CHARACTER            
         MVI   EOD,EODQ            DEFAULT END OF DATA VALUE                    
         MVC   SLABLAST,=CL2'  '                                                
         MVC   FLABLAST,=CL2'  '                                                
         MVC   WLABLAST,=CL2'  '                                                
         MVC   LOGLINE,=CL40' '                                                 
         L     RF,=F'999999'                                                    
         STCM  RF,15,LOOPCUNT      INITIALISE SCRIPT LOOP COUNT                 
         XC    COUNTER,COUNTER     INITIALISE SCRIPT COMMAND COUNTER            
         MVI   TIDLEN,0            DEFAULT IAM=TESTID TO BLANK                  
         MVC   TESTID,=CL10' '                                                  
         XC    TWALOC,TWALOC       INITIALISE TWA FIELD LOCATION                
         XC    TWAMEM,TWAMEM       INITIALISE TWA MEMORY OFFSET                 
         MVI   TWAFOFF,0           INITIALISE TWA FIELD OFFSET                  
         XC    TIOBVAL(TIOBL),TIOBVAL                                           
         L     R3,ATCB             SET VALUES FROM FACPAK CONTROL               
         USING TCBD,R3               BLOCKS                                     
         L     RE,TCBTIA                                                        
         ST    RE,ATIA                                                          
         L     RE,TCBTWA                                                        
         ST    RE,ATWA                                                          
*                                  CLEAR TWA FIRST TIME IN TO MAKE SURE         
*                                  CHECK POINT AREA CLEAR TO PREVENT            
*                                  TEMPEST ZAP BUG                              
         ICM   RF,15,=AL4(CHKPTTWL)                                             
         LA    R0,*                                                             
         L     R1,=F'0'                                                         
         MVCL  RE,R0                                                            
         L     R2,TCBUTL                                                        
         ST    R2,AUTL                                                          
         USING UTLD,R2                                                          
         L     R4,TBUFF                                                         
         ST    R4,ATBUFF                                                        
         USING TBHDATA,R4                                                       
         ICM   RF,15,TBHSCAS                                                    
         STCM  RF,15,ASCRIPT                                                    
         ICM   RF,15,TBHSCAID                                                   
         STCM  RF,15,ASCRIPID                                                   
         STCM  RF,15,INDATRDL                                                   
         STCM  RF,15,INDATWRL                                                   
         ICM   RF,15,TBHSCAOD                                                   
         STCM  RF,15,ASCRIPOD                                                   
         STCM  RF,15,OUDATLOC                                                   
         ICM   RF,15,TBHSCAIR                                                   
         STCM  RF,15,AINPROUT                                                   
         ICM   RF,15,TBHSCAIP                                                   
         STCM  RF,15,AINPPARM                                                   
         ICM   RF,15,TBHSCAOR                                                   
         STCM  RF,15,AOUTROUT                                                   
         ICM   RF,15,TBHSCAOP                                                   
         STCM  RF,15,AOUTPARM                                                   
         SR    RF,RF                                                            
         ICM   RF,3,TBHSCLOX                                                    
         STCM  RF,3,OUDATMAX                                                    
         SR    RF,RF                                                            
         ICM   RF,3,TBHSCLIX                                                    
         STCM  RF,3,INDATMAX                                                    
         XC    TBHSCLOD,TBHSCLOD                                                
         MVC   TBHSCERR,=Y(EQNOERR)                                             
         XC    TBHSCDSP,TBHSCDSP                                                
*                                                                               
         ICM   RF,15,TBHSCAEB      SAVE ERORR MSG BUFFER PARAMETERS             
         STCM  RF,15,AERRBUFF                                                   
         STCM  RF,15,AERRBNXT                                                   
         MVI   ERRSLOT,0                                                        
         SR    RE,RE                                                            
         ICM   RE,3,TBHSCLEB                                                    
         STCM  RE,3,ERRBMAX                                                     
         AR    RE,RF                                                            
         STCM  RE,15,AERRBEND                                                   
         LTR   RF,RF               CLEAR FIRST ENTRY IF BUFFER PASSED           
         BZ    *+10                                                             
         XC    0(ERRORLEN,RF),0(RF)                                             
*                                                                               
         ICM   RF,15,=A(SCOTAB)    SET ADDRESSES OF LOCAL TABLES                
         A     RF,RELO                                                          
         STCM  RF,15,ASCOTAB                                                    
         ICM   RF,15,=A(SCOTABX)                                                
         A     RF,RELO                                                          
         STCM  RF,15,ASCOTABX                                                   
         ICM   RF,15,=A(DCVTAB)                                                 
         A     RF,RELO                                                          
         STCM  RF,15,ADCVTAB                                                    
         ICM   RF,15,=A(DCVTABX)                                                
         A     RF,RELO                                                          
         STCM  RF,15,ADCVTABX                                                   
*                                                                               
         LH    RE,=Y(SCWORK-WORKD)                                              
         LA    RE,WORKD(RE)                                                     
         STCM  RE,15,ASCWORK                                                    
         STCM  RE,15,SCWORKL                                                    
         LH    RF,=Y(SCWORKX-WORKD)                                             
         LA    RF,WORKD(RF)                                                     
         STCM  RF,15,ASCWORKX                                                   
         SR    RF,RE                                                            
         XCEF                                                                   
*                                                                               
         LH    RE,=Y(SYMTAB-WORKD)                                              
         LA    RE,WORKD(RE)                                                     
         STCM  RE,15,ASYMTAB                                                    
         STCM  RE,15,ASYMTNXT                                                   
         LH    RF,=Y(SYMTABX-WORKD)                                             
         LA    RF,WORKD(RF)                                                     
         STCM  RF,15,ASYMTABX                                                   
         SR    RF,RE                                                            
         XCEF                                                                   
*                                                                               
         LH    RE,=Y(FLPTAB-WORKD)                                              
         LA    RE,WORKD(RE)                                                     
         STCM  RE,15,AFLPTAB                                                    
         STCM  RE,15,AFLPTNXT                                                   
         LH    RF,=Y(FLPTABX-WORKD)                                             
         LA    RF,WORKD(RF)                                                     
         STCM  RF,15,AFLPTABX                                                   
         SR    RF,RE                                                            
         XCEF                                                                   
*                                                                               
         LH    RE,=Y(FATTAB-WORKD)                                              
         LA    RE,WORKD(RE)                                                     
         STCM  RE,15,AFATTAB                                                    
         STCM  RE,15,AFATTNXT                                                   
         STCM  RE,15,AFATLAST                                                   
         LH    RF,=Y(FATTABX-WORKD)                                             
         LA    RF,WORKD(RF)                                                     
         STCM  RF,15,AFATTABX                                                   
         SR    RF,RE                                                            
         XCEF                                                                   
*                                  INITILIASE TIA FIELD BUFFER                  
         ICM   R1,15,ATIA                                                       
         BZR   RE                                                               
         LA    RF,4                                                             
         STCM  RF,3,4(R1)                                                       
         LA    R1,64(R1)                                                        
         MVC   0(4,R1),=XL4'03FFFF00'                                           
         XIT1                                                                   
         DROP  R2,R3,R4                                                         
         LTORG                                                                  
         SPACE 2                                                                
***********************************************************************         
* SCRIPT TRACE ROUTINE                                                *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
SCTRACE  NTR1  BASE=*                                                           
         ICM   RE,15,=V(SSB)                                                    
         BZ    STRAX                                                            
         ICM   RE,15,ATCB                                                       
         BZ    STRAX                                                            
         ICM   R3,15,AUTL                                                       
         USING UTLD,R3                                                          
         TM    TTEST,X'10'         TEST TRM IN TEST MODE                        
         BZ    STRAX                                                            
         CLI   TPRG,1              TEST PFM (THANK YOU DOODLE)                  
         BE    STRAX                                                            
         ICM   R4,15,TACCS         GET TSTTAB ENTRY ADDRESS                     
         BZ    STRAX                                                            
         USING TSTTABD,R4                                                       
         ICM   R6,15,TSTSCT        GET TRACE TABLE ADDRESS                      
         BZ    STRAX                                                            
         TM    TSTFLAGS,TSTFSCTQ   TEST SCRIPT TRACING ON                       
         BZ    STRAX                                                            
         USING SCTTABD,R6                                                       
         LA    RE,STRA010          NOTE TABLE IS IN 31-BIT STORAGE              
         O     RE,=X'80000000'                                                  
         BSM   0,RE                                                             
*                                                                               
STRA010  EQU   *                                                                
         OC    SCTNEXT,SCTNEXT                                                  
         BNZ   STRA020                                                          
         LR    RF,R6                                                            
         AH    RF,=YL2(SCTENTRY-SCTTABD)                                        
         STCM  RF,15,SCTNEXT                                                    
         AH    RF,=YL2(SCTENTL)                                                 
         BCTR  RF,0                BACK UP ONE BYTE                             
         CLM   RF,15,SCTEND        TEST PAST END OF TABLE                       
         BNL   STRA100                                                          
         XC    SCTCALL,SCTCALL     CLEAR TOTAL CALL COUNT                       
         XC    SCTCOUNT,SCTCOUNT                                                
         MVC   SCTSIN,TSIN         SAVE SIN                                     
         XC    SCTSTA1,SCTSTA1     CLEAR STATUS FLAGS                           
         XC    SCTRD,SCTRD         CLEAR RD LOCK                                
*                                                                               
STRA020  EQU   *                                                                
         ICM   RF,15,SCTCALL       BUMP CALL TOTAL COUNT                        
         LA    RF,1(RF)                                                         
         STCM  RF,15,SCTCALL                                                    
         OC    SCTRD,SCTRD         TEST LOCK ACTIVE                             
         BNZ   *+12                YES                                          
         STCM  RD,7,SCTRD          SET LOCK RD                                  
         B     STRA030                                                          
*                                                                               
         CLM   RD,7,SCTRD          MATCH LOCK ADDRESS                           
         BNE   STRA100             NO - IGNORE                                  
         XC    SCTRD,SCTRD         RELEASE LOCK                                 
*                                                                               
STRA030  EQU   *                                                                
         ICM   R7,15,SCTNEXT                                                    
         USING SCTENTRY,R7                                                      
         LR    RF,R7               POINT TO END OF ENTRY                        
         AH    RF,=YL2(SCTENTL)                                                 
         BCTR  RF,0                BACK UP ONE BYTE                             
         CLM   RF,15,SCTEND        TEST PAST END OF TABLE                       
         BNH   STRA040                                                          
         LR    R7,R6                                                            
         AH    R7,=YL2(SCTENTRY-SCTTABD)                                        
         STCM  R7,15,SCTNEXT                                                    
         XC    SCTCOUNT,SCTCOUNT                                                
*                                                                               
STRA040  EQU   *                                                                
         MVC   SCTELOGL,LOGLINE                                                 
         MVC   SCTENUM,SCTCALL     SAVE ENTRY NUMBER                            
         MVC   SCTECODE,SCPCODE    SAVE SCRIPT CODE                             
         L     RF,SCRIPLOC                                                      
         S     RF,ASCRIPT                                                       
         STCM  RF,3,SCTESOFF                                                    
         MVC   SCTECOND,CONDCODE                                                
         MVC   SCTESLAB,SLABLAST                                                
         MVC   SCTEFLAB,FLABLAST                                                
         MVC   SCTEWLAB,WLABLAST                                                
         MVC   SCTETIA,=CL40' '                                                 
         MVC   SCTEPROT,=CL20' '                                                
         ICM   RF,15,TWALOC                                                     
         BZ    STRA060                                                          
         USING FLDHDRD,RF                                                       
         S     RF,ATWA                                                          
         STCM  RF,3,SCTETOFF                                                    
         A     RF,ATWA                                                          
         IC    R1,FLDLEN                                                        
         CH    R1,=H'9'                                                         
         BL    STRA050                                                          
         CLI   FLDATB,X'FF'                                                     
         BE    STRA050                                                          
         MVC   SCTEFLDH,0(RF)                                                   
         MVC   SCTEFLD,FLDDATA                                                  
         TM    FLDATB,FATBXHDR                                                  
         BZ    STRA042                                                          
         SR    R1,R1                                                            
         IC    R1,FLDLEN                                                        
         SH    R1,=H'16'                                                        
         LA    R1,FLDXNUM(R1)                                                   
         MVC   SCTETFLN,0(R1)                                                   
         MVC   SCTETSTN,FLDXSFN-FLDXNUM(R1)                                     
         MVC   SCTETSCN,FLDXSCRN-FLDXNUM(R1)                                    
*                                                                               
STRA042  EQU   *                                                                
         L     RE,ATIA                                                          
         LA    RE,64(RE)           RE=A(TIA FIELD DATA ENTRY)                   
         USING IFLDHDRD,RE                                                      
         SR    R1,R1                                                            
*                                  SEARCH THROUGH TIA FOR CURRENT               
STRA044  ICM   R1,1,IFLDLEN          TWA FIELD INPUT VALUE                      
         BZ    STRA050             EXIT IF NULL FIELD IN TIA                    
         CLC   IFLDADR,FLDADR                                                   
         BE    STRA046             TWA ADDRESS FOUND                            
         CLC   IFLDADR,=XL2'FFFF'                                               
         BE    STRA050             EXIT AT END LIMIT OF TIA                     
         AR    RE,R1                                                            
         B     STRA044             BUMP TO NEXT FIELD IN TIA                    
*                                                                               
STRA046  EQU   *                                                                
         CH    R1,=H'4'                                                         
         BL    STRA050                                                          
         SH    R1,=H'4'                                                         
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   SCTETIA(0),IFLDDATA                                              
         DROP  RF,RE                                                            
*                                                                               
STRA050  EQU   *                                                                
         L     RE,ATWA                                                          
         LA    RE,64(RE)                                                        
         USING FLDHDRD,RE                                                       
         SR    R1,R1                                                            
         XC    FULL,FULL                                                        
*                                                                               
STRA052  EQU   *                                                                
         CR    RE,RF                                                            
         BNL   STRA058                                                          
         IC    R1,FLDLEN           BUMP TO NEXT FIELD                           
         CH    R1,=H'9'                                                         
         BL    STRA058                                                          
         CLI   FLDATB,X'FF'                                                     
         BE    STRA056                                                          
         TM    FLDATB,FATBPROT                                                  
         BZ    STRA056                                                          
         STCM  RE,15,FULL                                                       
*                                                                               
STRA056  EQU   *                                                                
         AR    RE,R1                                                            
         B     STRA052                                                          
*                                                                               
STRA058  EQU   *                                                                
         OC    FULL,FULL                                                        
         BZ    STRA060                                                          
         ICM   RE,15,FULL                                                       
         IC    R1,FLDLEN           BUMP TO NEXT FIELD                           
         SH    R1,=H'8'                                                         
         TM    FLDATB,FATBXHDR                                                  
         BZ    *+8                                                              
         SH    R1,=H'8'                                                         
         LTR   R1,R1                                                            
         BZ    STRA060                                                          
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   SCTEPROT(0),FLDDATA                                              
         DROP  RE                                                               
*                                                                               
STRA060  EQU   *                                                                
*                                                                               
STRA070  EQU   *                                                                
         L     RF,OUDATLOC                                                      
         S     RF,ASCRIPOD                                                      
         STCM  RF,15,SCTEOOUT                                                   
         L     RF,LASTOUP                                                       
         MVC   SCTEOUT,0(RF)                                                    
*                                                                               
         L     RF,SCWORKL                                                       
         S     RF,ASCWORK                                                       
         STCM  RF,15,SCTEOWRK                                                   
         L     RF,LASTWRP                                                       
         MVC   SCTEWRK,0(RF)                                                    
*                                                                               
         L     RF,INDATRDL                                                      
         S     RF,ASCRIPID                                                      
         STCM  RF,15,SCTEOINP                                                   
         L     RF,LASTINP                                                       
         MVC   SCTEINP,0(RF)                                                    
*                                                                               
         MVC   SCTERES,RESULTS                                                  
*                                                                               
         ICM   RF,15,AERRBNXT                                                   
         BZ    STRA080                                                          
         CLC   AERRBNXT,AERRBUFF                                                
         BE    *+8                                                              
         SH    RF,=H'4'                                                         
         MVC   SCTEERRM,0(RF)                                                   
*                                                                               
STRA080  EQU   *                                                                
         MVC   SCTESYS,TSYS                                                     
         MVC   SCTEPRG,TPRG                                                     
         MVC   SCTEUID,TUSER                                                    
         MVC   SCTEPWD,TPASSWD                                                  
         MVC   SCTEAGYS,TAGYSEC                                                 
*                                                                               
         ICM   RF,15,SCTCOUNT                                                   
         LA    RF,1(RF)                                                         
         STCM  RF,15,SCTCOUNT                                                   
         ICM   R7,15,SCTNEXT                                                    
         AH    R7,=YL2(SCTENTL)    BUMP NEXT ENTRY POINTER                      
         STCM  R7,15,SCTNEXT                                                    
         B     STRA100                                                          
*                                                                               
STRA100  LA    RE,*+6              BACK TO 24-BIT MODE                          
         BSM   0,RE                                                             
*                                                                               
STRAX    EQU   *                                                                
         XIT1                                                                   
         DROP  R3,R4,R6,R7                                                      
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CONNECT TO PROGRAM                                                  *         
***********************************************************************         
         SPACE 1                                                                
CONNECT  NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
         OI    CONDCODE,CCEQUALQ                                                
*                                  INITIALISE TIA TWA FIELD BUFFER              
         ICM   R1,15,ATIA                                                       
         BZ    CONNOK                                                           
         LA    RF,4                                                             
         STCM  RF,3,4(R1)                                                       
         LA    R1,64(R1)                                                        
         MVC   0(4,R1),=XL4'03FFFF00'                                           
*                                                                               
         L     R3,ATCB             SET FACPAK CONTROL BLOCK ADDRESSES           
         USING TCBD,R3                                                          
         L     R4,AUTL                                                          
         USING UTLD,R4                                                          
*                                                                               
         ICM   RF,15,TCBPAR1                                                    
         USING SYSFACD,RF                                                       
         L     RE,VSSB             EXTRACT TEMPSTR INFO FROM SSB                
         MVC   RECLEN,SSBTWAL-SSBD(RE)                                          
*                                                                               
         CLC   RECLEN,=H'18432'    18K TEMPSTR DISPLACEMENTS                    
         BNE   CONN002                                                          
         MVC   CHKDSP,=Y(CHKPTDSP)                                              
         MVC   GLODSP,=Y(CHKPTGLD)                                              
         B     CONN004                                                          
CONN002  CLC   RECLEN,=H'14336'    14K TEMPSTR DISPLACEMENTS                    
         BNE   CONNER5                                                          
         MVC   CHKDSP,=H'12800'    SET CHKPNT START AT 12.5K                    
         MVC   GLODSP,=H'12288'    SET GLOBAL START AT 12288                    
CONN004  EQU   *                                                                
         XC    DMCB+8(4),DMCB+8    SET TEMPSTR PAGE=0                           
         MVC   DMCB+10(2),TNUM     SET TERMINAL NUMBER                          
         MVC   DMCB+20(2),=C'L='   SPECIAL PARM FOR TWA0 READ/WRITES            
         MVC   DMCB+22(2),RECLEN                                                
         GOTO1 VDATAMGR,DMCB,=C'DMREAD',=C'TEMPSTR',,TCBTWA                     
         CLI   8(R1),0                                                          
         BNE   CONNER5                                                          
         DROP  RF                                                               
*                                                                               
CONN006  EQU   *                                                                
         L     R5,ATWA             LOAD CONNECT BASE SCREEN                     
         LA    R5,64(R5)                                                        
         ICM   RF,15,=V(SSB)       CHECK IF ONLINE                              
         BZ    CONN010                                                          
         ICM   RF,15,=V(CALLOV)                                                 
         BZ    CONNER1                                                          
         GOTO1 =V(CALLOV),DMCB,(R5),X'D90110FF',RR=RELO                         
         CLI   4(R1),X'FF'                                                      
         BE    CONNER2                                                          
         B     CONN020                                                          
*                                                                               
CONN010  LA    R6,=CL8'T110FF  '   SIMULATE OFFLINE                             
         LOAD  EPLOC=(6)                                                        
         LTR   R0,R0                                                            
         BZ    CONNER3                                                          
         STCM  R0,15,ASRVSCRN                                                   
         LH    R1,=H'1328'                                                      
         LR    RF,R1                                                            
         LR    RE,R5                                                            
         MVCL  RE,R0                                                            
*                                  MOVE DATA TO FIELDS AT RELATIVE              
*                                  LOGICAL POSITIONS IN TWA                     
*                                                                               
*                                  MOVE TEXT TO SERVICE REQUEST FIELD           
CONN020  MVI   BYTE,1                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   CONNNO                                                           
         GOTO1 LOADFLD,CRPARM,=C'=CT',3                                         
         BNE   CONNNO                                                           
*                                                                               
CONN040  MVI   BYTE,2                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   CONNNO                                                           
         SR    RF,RF                                                            
         IC    RF,USRLEN                                                        
         GOTO1 LOADFLD,CRPARM,USERID,(RF)                                       
         BNE   CONNNO                                                           
*                                  MOVE DATA TO SYSTEM TWA FIELD                
CONN050  MVI   BYTE,3                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   CONNNO                                                           
         SR    RF,RF                                                            
         IC    RF,SYSLEN                                                        
         GOTO1 LOADFLD,CRPARM,SYSTEM,(RF)                                       
         BNE   CONNNO                                                           
*                                  MOVE DATA TO PROGRAM TWA FIELD               
CONN060  MVI   BYTE,4                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   CONNNO                                                           
         XC    WORK,WORK                                                        
         SR    RF,RF                                                            
         IC    RF,PRGLEN                                                        
         LTR   RF,RF                                                            
         BZ    CONNER4                                                          
         LR    RE,RF                                                            
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   WORK(0),PROGRAM                                                  
         TM    CTFLAGS,CTFIAMQ                                                  
         BZ    CONN066                                                          
         CLI   TIDLEN,0                                                         
         BE    CONN066                                                          
         CLC   TESTID,=CL10' '                                                  
         BE    CONN066                                                          
         LA    R1,WORK                                                          
         AR    R1,RF                                                            
CONN062  BCTR  R1,0                                                             
         CLI   0(R1),C' '                                                       
         BNE   CONN064                                                          
         BCT   RF,CONN062                                                       
         B     CONNER4                                                          
CONN064  LA    R1,1(R1)                                                         
         MVC   0(5,R1),=CL5',IAM='                                              
         LA    R1,5(R1)                                                         
         LA    RF,5(RF)                                                         
         SR    RE,RE                                                            
         IC    RE,TIDLEN                                                        
         AR    RF,RE                                                            
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),TESTID                                                   
CONN066  EQU   *                                                                
         GOTO1 LOADFLD,CRPARM,WORK,(RF)                                         
         BNE   CONNNO                                                           
*                                  MOVE DATA TO PASSWORD TWA FIELD              
CONN080  MVI   BYTE,5                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   CONNNO                                                           
         SR    RF,RF                                                            
         IC    RF,PWDLEN                                                        
         GOTO1 LOADFLD,CRPARM,PASSWD,(RF)                                       
         BNE   CONNNO                                                           
*                                                                               
*                                  SET VALUES IN CONTROL BLOCKS                 
*                                    FOR MONITOR CALL                           
CONN090  MVI   TSYS,0                                                           
         MVI   TSVCREQ,X'01'                                                    
         MVI   TSVCREQ+1,X'10'                                                  
         MVC   TCBPRG(1),TSVCREQ+1                                              
         MVI   TCBSYS,1                                                         
         MVI   TCBOVSYS,1                                                       
         MVI   TCBPRTY,0                                                        
         MVI   TCBPRTYF,0                                                       
*                                                                               
         L     R1,=V(SELIST)                                                    
         LA    R1,6(R1)                                                         
         ST    R1,TCBSE                                                         
         MVC   TCBDTFS(8),SEFILES-SELISTD(R1)                                   
*                                                                               
         ICM   RF,15,=V(DTFIOA)                                                 
         BZ    CONN100                                                          
         GOTO1 =V(DTFIOA),DUB,(C'I',(R3))    INITIALISE DTF SAVE DATA           
*                                  CALL MONITOR TO RUN CONNECT PROCESS          
CONN100  MVI   BYTE,0                                                           
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   CONNNO                                                           
         CLI   TSYS,0              CHECK CONNECTED TO SYSTEM OK                 
         BNE   CONNOK                                                           
*                                  TEST SCREEN ERROR MESSAGE                    
         SR    RF,RF               IS SYSTEM NOT OPERATIONAL                    
         L     R5,ATWA                                                          
         LA    R5,64(R5)                                                        
         USING FLDHDRD,R5                                                       
         ICM   RF,15,=V(SSB)       CHECK ONLINE                                 
         BZ    CONNNO                                                           
         CLC   FLDDATA+2(1),SSBSYSCH-SSBD(RF)                                   
         BNE   CONNER6             TEST FOR SYSTEM ERROR MESSAGE CHAR.          
         CLI   FLDDATA,C'E'                                                     
         BNE   CONNER6             TEST FOR FIRST CHARACTER 'E' IN MSG.         
*                                  TEST FOR SYSTEM NOT OPERATIONAL              
         CLC   FLDDATA+3(4),=CL4'0102'  MESSAGE                                 
         BNE   CONN110                                                          
         CLI   CONNTEST,C'Y'                                                    
         BE    CONN200                                                          
         MVI   EXITFLAG,C'Y'                                                    
         MVC   ERRCODE,=Y(EQNOSYS)                                              
         BAS   RE,GETSEN           GET SE NUMBER                                
         SR    RF,RF               AND ADD TO BASE ERROR CODE                   
         ICM   RF,3,ERRCODE                                                     
         SR    RE,RE                                                            
         IC    RE,SENUMBER                                                      
         AR    RF,RE                                                            
         STCM  RF,3,ERRCODE                                                     
         B     CONNOK                                                           
*                                  ANY OTHER CONNECT ERROR                      
CONN110  EQU   *                                                                
         CLI   CONNTEST,C'Y'                                                    
         BE    CONN200                                                          
         MVI   EXITFLAG,C'Y'                                                    
         MVC   DUB(4),=CL4'0000'   ERROR MSG MUST HAVE 4 NUMERIC CHRS           
         MVZ   DUB(4),FLDDATA+3                                                 
         CLC   DUB(4),=CL4'0000'                                                
         BNE   CONNER6                                                          
         PACK  DUB,FLDDATA+3(4)                                                 
         CVB   RE,DUB                                                           
         SR    RF,RF                                                            
         ICM   RF,3,=Y(EQCONER)                                                 
         AR    RF,RE                                                            
         STCM  RF,3,ERRCODE                                                     
         B     CONNOK                                                           
         DROP  R5                                                               
*                                                                               
CONN200  EQU   *                   CONNTEST=Y RETURN CC .NE.                    
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     CONNOK                                                           
*                                                                               
CONNER1  MVC   ERRCODE,=Y(EQCONN1)                                              
         B     CONNNO                                                           
CONNER2  MVC   ERRCODE,=Y(EQCONN2)                                              
         B     CONNNO                                                           
CONNER3  MVC   ERRCODE,=Y(EQCONN3)                                              
         B     CONNNO                                                           
CONNER4  MVC   ERRCODE,=Y(EQCONN4)                                              
         B     CONNNO                                                           
CONNER5  MVC   ERRCODE,=Y(EQCONN5)                                              
         B     CONNNO                                                           
CONNER6  MVC   ERRCODE,=Y(EQCONN6)                                              
         B     CONNNO                                                           
*                                                                               
CONNOK   SR    RC,RC                                                            
CONNNO   LTR   RC,RC                                                            
         XIT1                                                                   
         DROP  R3,R4                                                            
         EJECT                                                                  
GETSEN   NTR1                                                                   
         MVI   SENUMBER,0                                                       
         SR    RF,RF                                                            
         L     R5,ATWA                                                          
         LA    R5,64(R5)                                                        
         USING FLDHDRD,R5                                                       
*                                  TEST FOR SYSTEM NOT OPERATIONAL              
         LA    RF,60                                                            
*                                                                               
GSEN010  CLC   0(3,R5),=CL3'SE#'                                                
         BE    GSEN020                                                          
         LA    R5,1(R5)                                                         
         BCT   RF,GSEN010                                                       
         B     GSENX                                                            
*                                                                               
GSEN020  EQU   *                                                                
         LA    R5,4(R5)                                                         
         GOTO1 =V(HEXIN),DMCB,(R5),SENUMBER,2,RR=RELO                           
         B     GSENX                                                            
*                                                                               
GSENX    XIT1                                                                   
         DROP  R5                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* LOAD CURRENT ERROR MESSAGE INTO SAVE ERROR BUFFER                   *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
LOADERR  NTR1  BASE=*                                                           
         MVI   ERRSLOT,0           INITIALISE ERROR BUFFER SLOT #               
         OC    AERRBUFF,AERRBUFF                                                
         BZ    LERROK                                                           
         L     RF,AERRBNXT         RF=A(NEXT ENTRY IN ERROR BUFFER)             
         C     RF,AERRBEND         EXIT WITH CC .NE. IF OVERFLOW                
         BNL   LERROK              CLEAR NEXT ENTRY IF NOT END                  
         L     R5,ATWA                                                          
         LA    R5,64(R5)           R5=A(ERROR MESAGE FIELD IN TWA)              
         USING FLDHDRD,R5                                                       
         L     RF,AERRBUFF         RF=A(FIRST ENTRY IN ERROR BUFFER)            
*                                  TEST ERROR MESSAGE ALREADY SAVED             
LERR010  C     RF,AERRBNXT                                                      
         BNL   LERR020                                                          
         CLC   0(ERRORLEN,RF),FLDDATA                                           
         BE    LERR030             EXIT IF ALREADY SAVED                        
         LA    RF,ERRORLEN(RF)     POINT TO NEXT ENTRY IN ERROR BUFFER          
         C     RF,AERRBEND                                                      
         BNL   LERROK                                                           
         B     LERR010                                                          
*                                                                               
LERR020  MVC   0(ERRORLEN,RF),FLDDATA  MOVE OUT ERROR MESSAGE                   
         LA    RE,ERRORLEN(RF)     POINT TO NEXT ENTRY IN ERROR BUFFER          
         ST    RE,AERRBNXT                                                      
         C     RE,AERRBEND                                                      
         BNL   LERR030             CLEAR NEXT ENTRY IF NOT END                  
         XC    0(ERRORLEN,RE),0(RE)                                             
         B     LERR030                                                          
*                                  HERE WITH RF=A(ERROR BUFFER SLOT)            
LERR030  ICM   RE,15,AERRBUFF      CALCULATE ERROR BUFFER SLOT #                
         SR    RF,RE                                                            
         SR    RE,RE                                                            
         D     RE,=AL4(ERRORLEN)                                                
         LA    RF,1(RF)                                                         
         STC   RF,ERRSLOT                                                       
         B     LERROK              EXIT OK                                      
*                                                                               
LERROK   SR    RC,RC                                                            
LERRNO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         DROP  R5                                                               
         EJECT                                                                  
***********************************************************************         
* S_FILLO - FILL OUTPUT AREA WITH HEX CODE FROM CURRENT POSITION      *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
FILLOUT  NTR1  BASE=*                                                           
*                                  GET 2 CHARACTER HEX CODE                     
         GOTO1 LOADHX2,CRPARM,SCRIPLOC,WORK                                     
         BNE   FILOER1                                                          
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
*                                                                               
         L     RE,OUDATLOC         GET OUTPUT DATA AREA LOCATION                
         SR    RF,RF                                                            
         ICM   RF,3,OUDATMAX                                                    
         LA    R0,*                                                             
         SR    R1,R1                                                            
         ICM   R1,8,WORK                                                        
         MVCL  RE,R0                                                            
*                                  MOVE SCRIPLOC PAST PARAMETER                 
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     FILOOK                                                           
*                                  ERROR EXITS                                  
FILOER1  MVC   ERRCODE,=Y(EQFLOE1)                                              
         B     FILONO                                                           
*                                                                               
FILOOK   SR    RC,RC                                                            
FILONO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_SEP - SET FIELD SEPARAOTR CHARACTER                               *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
SETSEP   NTR1  BASE=*                                                           
*                                  GET 2 CHARACTER HEX CODE                     
         GOTO1 LOADHX2,CRPARM,SCRIPLOC,WORK                                     
         BNE   SETSER1                                                          
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
*                                                                               
         MVC   FLDSEP,WORK                                                      
*                                  MOVE SCRIPLOC PAST PARAMETER                 
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     SETSOK                                                           
*                                  ERROR EXITS                                  
SETSER1  MVC   ERRCODE,=Y(EQSEPE1)                                              
         B     SETSNO                                                           
*                                                                               
SETSOK   SR    RC,RC                                                            
SETSNO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_SRV SET SERVICE REQUEST - EXECUTE ROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
SERVICE  NTR1  BASE=*                                                           
         L     R3,ATCB             POINT TO FACPAK CONTROL BLOCKS               
         USING TCBD,R3                                                          
         L     R2,AUTL                                                          
         USING UTLD,R2                                                          
*                                  GET 2 CHARACTER HEX PROGRAM CODE             
         GOTO1 LOADHX2,CRPARM,SCRIPLOC,WORK                                     
         BNE   SRVEER1                                                          
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
*                                                                               
         L     R4,ATWA             LOAD BASE SCREEN                             
         LA    R4,64(R4)                                                        
         ICM   RF,15,=V(SSB)       CHECK ONLINE                                 
         BZ    SRVE010                                                          
         ICM   RF,15,=V(CALLOV)                                                 
         BZ    SRVEER2                                                          
         XC    DMCB(20),DMCB                                                    
         ST    R4,DMCB                                                          
         MVC   DMCB+4(4),=XL4'D90100FF'                                         
         MVC   DMCB+6(1),WORK      OVERIDE WITH PROGRAM CODE ENTERED            
         A     RF,RELO                                                          
         LA    R1,DMCB                                                          
         BASR  RE,RF                                                            
         CLI   4(R1),X'FF'                                                      
         BE    SRVEER3                                                          
         B     SRVE020                                                          
*                                                                               
SRVE010  LA    R6,=CL8'T110FF  '   OFFLINE SIMULATION                           
         GOTO1 =V(HEXOUT),DMCB,WORK,2(R6),1,RR=RELO                             
         LOAD  EPLOC=(6)                                                        
         LTR   R0,R0                                                            
         BZ    SRVEER4                                                          
         STCM  R0,15,ASRVSCRN                                                   
         LH    R1,=H'1328'                                                      
         LR    RF,R1                                                            
         LR    RE,R4                                                            
         MVCL  RE,R0                                                            
*                                  SET VALUES IN CONTROL BLOCKS                 
*                                    FOR MONITOR CALL                           
SRVE020  MVI   TSYS,0                                                           
         MVI   TSVCREQ,X'01'                                                    
         MVC   TSVCREQ+1(1),WORK                                                
*                                                                               
         MVC   TCBPRG(1),TSVCREQ+1                                              
         MVI   TCBSYS,1                                                         
         MVI   TCBOVSYS,1                                                       
         MVI   TCBPRTY,0                                                        
         MVI   TCBPRTYF,0                                                       
*                                  MOVE SCRIPLOC PAST PARAMETER                 
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     SRVEOK                                                           
*                                  ERROR EXITS                                  
SRVEER1  MVC   ERRCODE,=Y(EQSRVE1)                                              
         B     SRVENO                                                           
SRVEER2  MVC   ERRCODE,=Y(EQSRVE2)                                              
         B     SRVENO                                                           
SRVEER3  MVC   ERRCODE,=Y(EQSRVE3)                                              
         B     SRVENO                                                           
SRVEER4  MVC   ERRCODE,=Y(EQSRVE4)                                              
         B     SRVENO                                                           
*                                                                               
SRVENO   SR    RC,RC                                                            
SRVEOK   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* PROCESS IAM=TESTID BEFORE CONNECT                                   *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
IAMTEST  NTR1  BASE=*                                                           
         CLC   TESTID,=CL10' '     CHECK TESTID ENTERED                         
         BE    IAMTOK                                                           
         L     R3,ATCB             POINT TO FACPAK CONTROL BLOCKS               
         USING TCBD,R3                                                          
         L     R2,AUTL                                                          
         USING UTLD,R2                                                          
*                                                                               
         L     R4,ATWA             LOAD BASE SCREEN                             
         LA    R4,64(R4)                                                        
         ICM   RF,15,=V(SSB)       CHECK ONLINE                                 
         BZ    IAMT010                                                          
         ICM   RF,15,=V(CALLOV)                                                 
         BZ    IAMTER1                                                          
         GOTO1 =V(CALLOV),DMCB,(R4),X'D90136FF',RR=RELO                         
         CLI   4(R1),X'FF'                                                      
         BE    IAMTER2                                                          
         B     IAMT020                                                          
*                                                                               
IAMT010  LA    R6,=CL8'T136FF  '   OFFLINE SIMULATION                           
         LOAD  EPLOC=(6)                                                        
         LTR   R0,R0                                                            
         BZ    IAMTER3                                                          
         STCM  R0,15,ASRVSCRN                                                   
         LH    R1,=H'1328'                                                      
         LR    RF,R1                                                            
         LR    RE,R4                                                            
         MVCL  RE,R0                                                            
*                                  MOVE DATA TO FIELDS AT RELATIVE              
*                                  LOGICAL POSITIONS IN TWA                     
*                                                                               
*                                  MOVE TEXT TO SERVICE REQUEST FIELD           
IAMT020  EQU   *                                                                
         MVI   BYTE,1                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   IAMTNO                                                           
         GOTO1 LOADFLD,CRPARM,=C'=TEST',5                                       
         BNE   IAMTNO                                                           
*                                                                               
IAMT040  MVI   BYTE,2                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   IAMTNO                                                           
         SR    RF,RF                                                            
         IC    RF,TIDLEN                                                        
         GOTO1 LOADFLD,CRPARM,TESTID,(RF)                                       
         BNE   IAMTNO                                                           
*                                                                               
IAMT050  MVI   BYTE,3                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   IAMTNO                                                           
         GOTO1 LOADFLD,CRPARM,=C'ADD',3                                         
         BNE   IAMTNO                                                           
*                                  SET VALUES IN CONTROL BLOCKS                 
*                                    FOR MONITOR CALL                           
IAMT100  EQU   *                                                                
         MVI   TSYS,0                                                           
         MVI   TSVCREQ,X'01'                                                    
         MVI   TSVCREQ+1,X'36'                                                  
*                                                                               
         MVC   TCBPRG(1),TSVCREQ+1                                              
         MVI   TCBSYS,1                                                         
         MVI   TCBOVSYS,1                                                       
         MVI   TCBPRTY,0                                                        
         MVI   TCBPRTYF,0                                                       
*                                  CALL MONITOR TO RUN =TEST                    
         MVI   BYTE,0                                                           
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   IAMTNO                                                           
*                                  RESET TESTID                                 
IAMT120  EQU   *                                                                
         MVI   BYTE,1                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   IAMTNO                                                           
         GOTO1 LOADFLD,CRPARM,=C'=TEST',5                                       
         BNE   IAMTNO                                                           
*                                                                               
IAMT140  MVI   BYTE,2                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   IAMTNO                                                           
         SR    RF,RF                                                            
         IC    RF,TIDLEN                                                        
         GOTO1 LOADFLD,CRPARM,TESTID,(RF)                                       
         BNE   IAMTNO                                                           
*                                                                               
IAMT150  MVI   BYTE,3                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   IAMTNO                                                           
         GOTO1 LOADFLD,CRPARM,=C'RESET',5                                       
         BNE   IAMTNO                                                           
*                                  SET VALUES IN CONTROL BLOCKS                 
*                                    FOR MONITOR CALL                           
IAMT200  EQU   *                                                                
*                                  CALL MONITOR TO RUN =TEST                    
         MVI   BYTE,0                                                           
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   IAMTNO                                                           
*                                  CHANGE TO SET TRACE SCREENS ON               
IAMT220  EQU   *                                                                
         MVI   BYTE,1                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   IAMTNO                                                           
         GOTO1 LOADFLD,CRPARM,=C'=TEST',5                                       
         BNE   IAMTNO                                                           
*                                                                               
IAMT240  MVI   BYTE,2                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   IAMTNO                                                           
         SR    RF,RF                                                            
         IC    RF,TIDLEN                                                        
         GOTO1 LOADFLD,CRPARM,TESTID,(RF)                                       
         BNE   IAMTNO                                                           
*                                                                               
IAMT250  MVI   BYTE,3                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   IAMTNO                                                           
         GOTO1 LOADFLD,CRPARM,=C'CHANGE',6                                      
         BNE   IAMTNO                                                           
*                                                                               
IAMT260  MVI   BYTE,9                                                           
         GOTO1 LTWAFLD,CRPARM,BYTE,C'U' LOCATE FIELD IN TWA                     
         BNE   IAMTNO                                                           
         GOTO1 LOADFLD,CRPARM,=C'YES',3                                         
         BNE   IAMTNO                                                           
*                                  SET VALUES IN CONTROL BLOCKS                 
*                                    FOR MONITOR CALL                           
IAMT300  EQU   *                                                                
*                                  CALL MONITOR TO RUN =TEST                    
         MVI   BYTE,0                                                           
         MVI   SVTWLFLG,C'N'                                                    
         GOTO1 GOTOMON,CRPARM                                                   
         BNE   IAMTNO                                                           
*                                                                               
         B     IAMTOK                                                           
*                                  ERROR EXITS                                  
IAMTER1  MVC   ERRCODE,=Y(EQIATE1)                                              
         B     IAMTNO                                                           
IAMTER2  MVC   ERRCODE,=Y(EQIATE2)                                              
         B     IAMTNO                                                           
IAMTER3  MVC   ERRCODE,=Y(EQIATE3)                                              
         B     IAMTNO                                                           
IAMTER4  MVC   ERRCODE,=Y(EQIATE4)                                              
         B     IAMTNO                                                           
*                                                                               
IAMTOK   SR    RC,RC                                                            
IAMTNO   LTR   RC,RC                                                            
         XIT1                                                                   
         DROP  R2,R3                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_BACKUP BACKUP OFFSET IN CURRENT TWA FIELD TO FIRST NON SPACE CHAR.*         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
BACKEXEC NTR1  BASE=*                                                           
         ICM   R4,15,TWALOC                                                     
         BZ    BACEOK                                                           
         L     R5,ATIA                                                          
         LA    R5,64(R5)           R5=A(TIA FIELD DATA ENTRY)                   
         USING FLDHDRD,R4                                                       
         USING IFLDHDRD,R5                                                      
         SR    R6,R6                                                            
*                                                                               
BACE010  ICM   R6,1,IFLDLEN                                                     
         BZ    BACEOK              EXIT IF NULL FIELD IN TIA                    
         CLC   IFLDADR,FLDADR                                                   
         BE    BACE020                                                          
         CLC   IFLDADR,=XL2'FFFF'                                               
         BE    BACEOK              EXIT AT END LIMIT OF TIA                     
         AR    R5,R6                                                            
         B     BACE010             BUMP TO NEXT FIELD IN TIA                    
*                                                                               
BACE020  SR    R6,R6               EXISTING FIELD POSITION FOUND                
         L     R1,ATIA                                                          
         ICM   R6,3,4(R1)          RF=A(END OF TIA FIELD BUFFER)                
         LA    R6,64(R6,R1)                                                     
         SR    R7,R7                                                            
*                                                                               
BACE030  SR    R1,R1                                                            
         IC    R1,IFLDLEN                                                       
         CLC   IFLDLEN,=AL3(3)                                                  
         BNH   BACE100                                                          
         LA    RE,0(R1,R5)                                                      
         BCTR  RE,0                                                             
         CLI   0(RE),C' '                                                       
         BNE   BACE100                                                          
         BCTR  R1,0                                                             
         STC   R1,IFLDLEN                                                       
         LA    R7,1(R7)                                                         
         LR    RF,RE                                                            
BACE040  CR    RF,R6                                                            
         BNL   BACE050                                                          
         MVC   0(1,RF),1(RF)                                                    
         LA    RF,1(RF)                                                         
         B     BACE040                                                          
BACE050  MVI   0(RF),0                                                          
         B     BACE030                                                          
*                                                                               
BACE100  LTR   R7,R7                                                            
         BZ    BACEOK                                                           
         L     R1,ATIA                                                          
         ICM   RF,3,4(R1)                                                       
         SR    RF,R7                                                            
         STCM  RF,3,4(R1)                                                       
         SR    RF,RF                                                            
         IC    RF,TWAFOFF                                                       
         SR    RF,R7                                                            
         STC   RF,TWAFOFF                                                       
         B     BACEOK                                                           
*                                                                               
BACEOK   SR    RC,RC                                                            
BACENO   LTR   RC,RC                                                            
         XIT1                                                                   
         DROP  R4,R5                                                            
         LTORG                                                                  
         SPACE 1                                                                
***********************************************************************         
* S_ADDTWA ADD VALUE TO CURRENT TWA FIELD OFFSET POINTER              *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
ADTWEXEC NTR1  BASE=*                                                           
*                                  GET VALUE TO ADD FROM SCRIPT                 
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R1,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         ICM   RF,1,TWAFOFF        GET CURRENT TWA FIELD OFFSET VALUE           
         SR    RE,RE                                                            
         ICM   RE,3,HALF                                                        
         BZ    ADTW010                                                          
         AR    RF,RE                                                            
         STC   RF,TWAFOFF                                                       
*                                                                               
ADTW010  EQU   *                                                                
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R1,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     ADTWOK                                                           
*                                                                               
ADTWOK   SR    RC,RC                                                            
ADTWNO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         SPACE 1                                                                
***********************************************************************         
* S_SUBTWA SUBTRACT VALUE FROM CURRENT TWA FIELD OFFSET POINTER       *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
SUTWEXEC NTR1  BASE=*                                                           
*                                  GET VALUE TO SUBTRACT FROM SCRIPT            
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R1,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R1,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         ICM   RE,3,HALF                                                        
         BZ    SUTW200                                                          
         ICM   R4,15,TWALOC                                                     
         BZ    SUTW200                                                          
         L     R5,ATIA                                                          
         LA    R5,64(R5)           R5=A(TIA FIELD DATA ENTRY)                   
         USING FLDHDRD,R4                                                       
         USING IFLDHDRD,R5                                                      
         SR    R6,R6                                                            
*                                                                               
SUTW010  ICM   R6,1,IFLDLEN                                                     
         BZ    SUTW200             EXIT IF NULL FIELD IN TIA                    
         CLC   IFLDADR,FLDADR                                                   
         BE    SUTW020                                                          
         CLC   IFLDADR,=XL2'FFFF'                                               
         BE    SUTW200             EXIT AT END LIMIT OF TIA                     
         AR    R5,R6                                                            
         B     SUTW010             BUMP TO NEXT FIELD IN TIA                    
*                                                                               
SUTW020  SR    R6,R6               EXISTING FIELD POSITION FOUND                
         L     R1,ATIA                                                          
         ICM   R6,3,4(R1)          RF=A(END OF TIA FIELD BUFFER)                
         LA    R6,64(R6,R1)                                                     
         SR    R7,R7                                                            
*                                                                               
SUTW030  SR    R1,R1                                                            
         IC    R1,IFLDLEN                                                       
         CLC   IFLDLEN,=AL3(3)                                                  
         BNH   SUTW100                                                          
         LA    RE,0(R1,R5)                                                      
         BCTR  RE,0                                                             
         BCTR  R1,0                                                             
         STC   R1,IFLDLEN                                                       
         LA    R7,1(R7)                                                         
         LR    RF,RE                                                            
SUTW040  CR    RF,R6                                                            
         BNL   SUTW050                                                          
         MVC   0(1,RF),1(RF)                                                    
         LA    RF,1(RF)                                                         
         B     SUTW040                                                          
SUTW050  MVI   0(RF),0                                                          
         ICM   R1,3,HALF                                                        
         BCT   R1,*+8                                                           
         B     SUTW100                                                          
         STCM  R1,3,HALF                                                        
         B     SUTW030                                                          
*                                                                               
SUTW100  LTR   R7,R7                                                            
         BZ    SUTW200                                                          
         L     R1,ATIA                                                          
         ICM   RF,3,4(R1)                                                       
         SR    RF,R7                                                            
         STCM  RF,3,4(R1)                                                       
         SR    RF,RF                                                            
         IC    RF,TWAFOFF                                                       
         SR    RF,R7                                                            
         STC   RF,TWAFOFF                                                       
         B     SUTW200                                                          
*                                                                               
SUTW200  EQU   *                                                                
         B     SUTWOK                                                           
*                                                                               
SUTWOK   SR    RC,RC                                                            
SUTWNO   LTR   RC,RC                                                            
         XIT1                                                                   
         DROP  R4,R5                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_TSTOFF TEST TO COMPARE CURRENT TWA FIELD OFFSET WITH VALUE        *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
TSOFEXEC NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET 2 BYTE VALUE FROM SCRIPT                 
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         MVC   BYTE,HALF+1                                                      
         CLC   BYTE,TWAFOFF        COMPARE VALUE TO OFFSET                      
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     TOFE010                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     TOFE010                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
TOFE010  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     TOFEOK                                                           
*                                                                               
TOFEOK   SR    RC,RC                                                            
TOFENO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_CMIW COMPARE INPUT AREA TO WORK AREA FOR GIVEN LENGTH             *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
CMIWEXEC NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         L     R1,SCWORKL                                                       
         L     RE,INDATRDL                                                      
         ICM   RF,3,HALF           COMPARE DATA                                 
         BZ    CMIW020                                                          
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,RE),0(R1)                                                    
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     CMIW010                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     CMIW010                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
CMIW010  EQU   *                                                                
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    CMIW020                                                          
*                                  LOG COMPARE EVENT FOR TRACE                  
         LA    RF,1(RF)                                                         
         GOTO1 LOGCMP,CRPARM,(RF),INDATRDL,SCWORKL                              
*                                                                               
CMIW020  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     CMIWOK                                                           
*                                                                               
CMIWOK   SR    RC,RC                                                            
CMIWNO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         SPACE 1                                                                
***********************************************************************         
* S_NXTFF POSITION TO NEXT FIELD WITHIN CURRENT TWA FIELD             *         
* ASSUME FIELD SEPAROTOR CHARACTER AS SET IN 'SEP'                    *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
NXFFEXEC NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET OFFSET VALUE FROM SCRIPT                 
         ICM   R3,15,TWALOC                                                     
         USING FLDHDRD,R3                                                       
         SR    RF,RF                                                            
         IC    RF,FLDLEN                                                        
         CH    RF,=H'9'                                                         
         BL    NXFF100                                                          
         CLI   FLDATB,X'FF'                                                     
         BE    NXFF100                                                          
         SH    RF,=H'8'                                                         
         TM    FLDATB,FATBXHDR                                                  
         BZ    *+8                                                              
         SH    RF,=H'8'                                                         
         LA    R1,FLDDATA                                                       
         AR    RF,R1                                                            
         SR    RE,RE                                                            
         IC    RE,TWAFOFF                                                       
         AR    RE,R1                                                            
NXFF010  CR    RE,RF                                                            
         BNL   NXFF100                                                          
         CLC   0(1,RE),FLDSEP      TEST FOR SEPARATOR CHARACTER                 
         BE    NXFF020                                                          
         LA    RE,1(RE)            LOOP TO NEXT CHARACTER IN INPUT              
         B     NXFF010                                                          
*                                                                               
NXFF020  EQU   *                                                                
         LA    RE,1(RE)                                                         
         CR    RE,RF                                                            
         BNL   NXFF100                                                          
         LA    R1,FLDDATA                                                       
         SR    RE,R1                                                            
         STC   RE,TWAFOFF                                                       
         OI    CONDCODE,CCEQUALQ                                                
         B     NXFFOK                                                           
*                                                                               
NXFF100  EQU   *                                                                
         B     NXFFOK                                                           
*                                                                               
NXFFOK   SR    RC,RC                                                            
NXFFNO   LTR   RC,RC                                                            
         XIT1                                                                   
         DROP  R3                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_CMIFF TEST TO COMPARE INPUT AREA WITH FIELD WITHIN TWA FIELD      *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
CIFFEXEC NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
*                                                                               
         ICM   R3,15,TWALOC                                                     
         USING FLDHDRD,R3                                                       
         SR    RF,RF                                                            
         IC    RF,FLDLEN                                                        
         CH    RF,=H'9'                                                         
         BL    CIFF110                                                          
         CLI   FLDATB,X'FF'                                                     
         BE    CIFF110                                                          
         SH    RF,=H'8'                                                         
         TM    FLDATB,FATBXHDR                                                  
         BZ    *+8                                                              
         SH    RF,=H'8'                                                         
         LA    R1,FLDDATA                                                       
         AR    RF,R1                                                            
         SR    RE,RE                                                            
         IC    RE,TWAFOFF                                                       
         AR    RE,R1                                                            
         LA    R1,WORK                                                          
         MVI   WORK,C' '                                                        
         MVC   WORK+1(L'WORK-1),WORK                                            
*                                                                               
CIFF010  CR    RE,RF                                                            
         BNL   CIFF020                                                          
         CLC   0(1,RE),FLDSEP      TEST FOR SEPARATOR CHARACTER                 
         BE    CIFF020                                                          
         MVC   0(1,R1),0(RE)                                                    
         LA    RE,1(RE)                                                         
         LA    R1,1(R1)                                                         
         B     CIFF010                                                          
*                                                                               
CIFF020  EQU   *                                                                
         L     R1,INDATRDL         GET CURRENT INPUT DATA LOCATION              
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         BZ    CIFF110                                                          
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R1),WORK                                                     
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     CIFF100                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     CIFF100                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
CIFF100  EQU   *                                                                
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    CIFF110                                                          
*                                  LOG COMPARE EVENT FOR TRACE                  
         LA    RF,1(RF)                                                         
         GOTO1 LOGCMP,CRPARM,(RF),INDATRDL,WORK                                 
*                                                                               
CIFF110  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     CIFFOK                                                           
*                                                                               
CIFFOK   SR    RC,RC                                                            
CIFFNO   LTR   RC,RC                                                            
         XIT1                                                                   
         DROP  R3                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_OUTFW MOVE DATA FROM FIELD WITHIN CURRENT TWA FIELD TO WORK AREA  *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
MTFWEXEC NTR1  BASE=*                                                           
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
*        GOTO1 TSTOUT,CRPARM,HALF  TEST WORK DATA AREA OVERFLOW                 
*        BNE   MFWENO              EXIT IF ERROR                                
*                                                                               
         ICM   R3,15,TWALOC                                                     
         USING FLDHDRD,R3                                                       
         SR    RF,RF                                                            
         IC    RF,FLDLEN                                                        
         CH    RF,=H'9'                                                         
         BL    MFWE100                                                          
         CLI   FLDATB,X'FF'                                                     
         BE    MFWE100                                                          
         SH    RF,=H'8'                                                         
         TM    FLDATB,FATBXHDR                                                  
         BZ    *+8                                                              
         SH    RF,=H'8'                                                         
         LA    R1,FLDDATA                                                       
         AR    RF,R1                                                            
         SR    RE,RE                                                            
         IC    RE,TWAFOFF                                                       
         AR    RE,R1                                                            
         LA    R1,WORK                                                          
         MVI   WORK,C' '                                                        
         MVC   WORK+1(L'WORK-1),WORK                                            
*                                                                               
MFWE010  CR    RE,RF                                                            
         BNL   MFWE020                                                          
         CLC   0(1,RE),FLDSEP      TEST FOR SEPARATOR CHARACTER                 
         BE    MFWE020                                                          
         MVC   0(1,R1),0(RE)                                                    
         LA    RE,1(RE)                                                         
         LA    R1,1(R1)                                                         
         B     MFWE010                                                          
*                                                                               
MFWE020  EQU   *                                                                
         L     R1,SCWORKL                                                       
         SR    RF,RF                                                            
         ICM   RF,3,HALF                                                        
         BZ    MFWE100                                                          
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),WORK                                                     
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    MFWE030                                                          
*                                  LOG MOVE EVENT FOR TRACE                     
         LA    RF,1(RF)                                                         
         GOTO1 LOGMOV,CRPARM,(RF),WORK                                          
*                                                                               
MFWE030  EQU   *                                                                
         SR    RF,RF                                                            
         ICM   RF,3,HALF           MOVE DATA TO WORK AREA                       
         L     RF,SCWORKL                                                       
         AH    RF,HALF                                                          
         ST    RF,SCWORKL                                                       
*                                                                               
MFWE100  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     MFWEOK                                                           
*                                                                               
MFWEOK   SR    RC,RC                                                            
MFWENO   LTR   RC,RC                                                            
         XIT1                                                                   
         DROP  R3                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_TSTI TEST TO COMPARE TWA FIELD WITH DATA IN INPUT AREA            *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
TSTIEXEC NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADLN2,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         SR    RF,RF                                                            
         ICM   RF,3,HALF           GET TEXT FROM CURRENT TWA FIELD              
         GOTO1 GETTWA,CRPARM,WORK,(RF)                                          
         BNE   TSIENO              ERROR EXIT                                   
         ICM   R3,15,0(R1)                                                      
         BZ    TSIE020                                                          
         LR    R1,R3                                                            
         L     RF,=A(CUPPER)       CONVERT TWA FIELD TO UPPER CASE              
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         L     R1,INDATRDL         GET CURRENT INPUT DATA LOCATION              
         BCTR  R3,0                                                             
         EX    R3,*+8                                                           
         B     *+10                COMPEARE WITH SCRIPT DATA                    
         CLC   WORK(0),0(R1)         AND SET CONDITION CODE                     
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     TSIE010                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     TSIE010                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
TSIE010  EQU   *                                                                
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    TSIE020                                                          
*                                  LOG COMPARE EVENT FOR TRACE                  
         LA    R3,1(R3)                                                         
         GOTO1 LOGCMP,CRPARM,(R3),WORK,INDATRDL                                 
*                                                                               
TSIE020  EQU   *                   BUMP PAST SCRIPT PARAMETER                   
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     TSIEOK                                                           
*                                                                               
TSIEOK   SR    RC,RC                                                            
TSIENO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_TSTIF TEST TO COMPARE TWA FIELD WITH INPUT AREA FIELD             *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
TSTFEXEC NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
         L     RF,INDATRDL         GET LOCATION OF NEXT FIELD                   
*                                  SEARCH FOR NEXT FIELD SEPARATOR              
TSFE010  CLC   0(1,RF),EOD         UNTIL END OF DATA FOUND                      
         BE    TSFEOK                                                           
         CLC   0(1,RF),FLDSEP      TEST FOR SEPARATOR CHARACTER                 
         BE    TSFE020                                                          
         LA    RF,1(RF)            LOOP TO NEXT CHARATER IN INPUT               
         B     TSFE010                                                          
*                                                                               
TSFE020  LA    R5,1(RF)            SAVE LOCATION OF NEXT INPUT FIELD            
         S     RF,INDATRDL         RF=LENGTH THIS INPUT FIELD                   
*                                  GET TEXT FROM CURRENT TWA FIELD              
         GOTO1 GETTWA,CRPARM,WORK,(RF)                                          
         BNE   TSFENO              ERROR EXIT                                   
         ICM   R3,15,0(R1)                                                      
         BZ    TSFEOK                                                           
         LR    R1,R3                                                            
         L     RF,=A(CUPPER)       CONVERT TWA FIELD TO UPPER CASE              
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         L     R1,INDATRDL         GET CURRENT INPUT DATA LOCATION              
         BCTR  R3,0                                                             
         EX    R3,*+8                                                           
         B     *+10                COMPARE WITH SCRIPT DATA                     
         CLC   WORK(0),0(R1)         AND SET CONDITION CODE                     
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     TSFE100                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     TSFE100                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
TSFE100  EQU   *                                                                
*                                                                               
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    TSFE110                                                          
*                                  LOG COMPARE EVENT FOR TRACE                  
         LA    R3,1(R3)                                                         
         GOTO1 LOGCMP,CRPARM,(R3),WORK,INDATRDL                                 
*                                                                               
TSFE110  ST    R5,INDATRDL         SET INPUT LOCATION TO NEXT FIELD             
         B     TSFEOK                                                           
*                                                                               
TSFEOK   SR    RC,RC                                                            
TSFENO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_TSTS TEST TO COMPARE TWA FIELD WITH DATA IN SCRIPT PARAMETER      *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
TSTSEXEC NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET DATA STRING FROM SCRIPT                  
         GOTO1 LOADCHR,CRPARM,SCRIPLOC,WORK,99                                  
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         LR    RF,R5                                                            
         BCTR  RF,0                                                             
         BCTR  RF,0                GET TEXT FROM CURRENT TWA FIELD              
         GOTO1 GETTWA,CRPARM,WORK,(RF)                                          
         BNE   TSSENO              ERROR EXIT                                   
         ICM   R3,15,0(R1)                                                      
         BZ    TSSE020                                                          
         LR    R1,R3                                                            
         L     RF,=A(CUPPER)       CONVERT TWA FIELD TO UPPER CASE              
         A     RF,RELO                                                          
         BASR  RE,RF                                                            
         L     R1,SCRIPLOC         GET SCRIPT PARAMETER LOCATION                
         LA    R1,2(R1)                                                         
         BCTR  R3,0                                                             
         EX    R3,*+8                                                           
         B     *+10                COMPARE WITH SCRIPT DATA                     
         CLC   WORK(0),0(R1)         AND SET CONDITION CODE                     
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     TSSE010                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     TSSE010                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
TSSE010  EQU   *                                                                
         CLI   SCTFLAG,C'N'        TEST SCRIPT TRACE FLAG OFF                   
         BE    TSSE020                                                          
*                                  LOG COMPARE EVENT FOR TRACE                  
         L     RF,SCRIPLOC                                                      
         LA    RF,2(RF)                                                         
         LA    R3,1(R3)                                                         
         GOTO1 LOGCMP,CRPARM,(R3),WORK,(RF)                                     
*                                                                               
TSSE020  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     TSSEOK                                                           
*                                                                               
TSSEOK   SR    RC,RC                                                            
TSSENO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_TSTHEX TEST TO COMPARE TWA WITH HEX BYTE IN SCRIPT PARAMETER      *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
TSTHEXEC NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET 2 CHARACTER HEX VALUE                    
         GOTO1 LOADHX2,CRPARM,SCRIPLOC,WORK                                     
         BNE   TSHEER2                                                          
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
         OC    TWAMEM,TWAMEM                                                    
         BZ    TSHE010                                                          
         ICM   RF,15,TWAMEM        USE TWA OFFSET IF SPECIFIED                  
         B     TSHE020                                                          
*                                                                               
TSHE010  ICM   RF,15,TWALOC        ELSE USE FIRST BYTE TWA FIELD                
         BZ    TSHEER1                                                          
         LA    RF,8(RF)                                                         
*                                                                               
TSHE020  CLC   0(1,RF),WORK                                                     
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     TSHE100                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     TSHE100                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
TSHE100  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     TSHEOK                                                           
*                                                                               
TSHEER1  MVC   ERRCODE,=Y(EQTSHE1)                                              
         B     TSHENO                                                           
*                                                                               
TSHEER2  MVC   ERRCODE,=Y(EQTSHE2)                                              
         B     TSHENO                                                           
*                                                                               
TSHEOK   SR    RC,RC                                                            
TSHENO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_TSTFX  TEST TO COMPARE TWA FIELD WITH HEX BYTE IN SCRIPT PARAMETER*         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
TSFXEXEC NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET 2 CHARACTER HEX VALUE                    
         GOTO1 LOADHX2,CRPARM,SCRIPLOC,WORK                                     
         BNE   TSFXER2                                                          
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
         ICM   RF,15,TWALOC        FIRST BYTE TWA FIELD                         
         BZ    TSFXER1                                                          
         LA    RF,8(RF)                                                         
*                                                                               
         CLC   0(1,RF),WORK                                                     
         BNE   *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     TSFX100                                                          
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     TSFX100                                                          
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
TSFX100  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     TSFXOK                                                           
*                                                                               
TSFXER1  MVC   ERRCODE,=Y(EQTSFX1)                                              
         B     TSFXNO                                                           
*                                                                               
TSFXER2  MVC   ERRCODE,=Y(EQTSFX2)                                              
         B     TSFXNO                                                           
*                                                                               
TSFXOK   SR    RC,RC                                                            
TSFXNO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_TSTBIT TEST TO COMPARE TWA WITH BITS IN SCRIPT PARAMETER BYTE     *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
TSTBEXEC NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET 2 CHARACTER HEX VALUE                    
         GOTO1 LOADHX2,CRPARM,SCRIPLOC,WORK                                     
         BNE   TSBEER2                                                          
         ICM   R5,15,0(R1)         SAVE SCRIPT PARAMETER LENGTH                 
         ICM   RF,15,TWAMEM                                                     
         CLC   0(1,RF),WORK                                                     
         BZ    *+12                                                             
         OI    CONDCODE,CCEQUALQ                                                
         B     TSBE010                                                          
*                                                                               
TSBE010  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     TSBEOK                                                           
*                                                                               
TSBEER1  MVC   ERRCODE,=Y(EQTSBE1)                                              
         B     TSBENO                                                           
*                                                                               
TSBEER2  MVC   ERRCODE,=Y(EQTSBE2)                                              
         B     TSBENO                                                           
*                                                                               
TSBEOK   SR    RC,RC                                                            
TSBENO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_TSTERR TEST TO COMPARE FOR ERROR IN TWA MESSAGE FIELD             *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
TSTEEXEC NTR1  BASE=*                                                           
         MVC   TWALOCSV,TWALOC                                                  
         GOTO1 FRSTPRO,CRPARM      GET STANDARD TWA MESSAGE FIELD               
*                                                                               
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                                                               
         LA    RF,L'WORK                                                        
         GOTO1 GETTWA,CRPARM,WORK,(RF)                                          
         BNE   TSEENO              ERROR EXIT                                   
         CLI   SVTWLFLG,C'N'       TEST TO RESTORE SAVED TWA LOCATION           
         BE    *+14                                                             
         MVC   TWALOC,TWALOCSV                                                  
         MVI   SVTWLFLG,C'N'                                                    
*                                  TEST FOR ERROR MESSAGE                       
         ICM   RF,15,=V(SSB)       CHECK ONLINE                                 
         BZ    TSEEOK                                                           
         CLC   WORK+2(1),SSBSYSCH-SSBD(RF)                                      
         BNE   TSEEOK              TEST FOR SYSTEM ERROR MESSAGE CHAR.          
         CLI   WORK,C'E'                                                        
         BNE   TSEEOK              TEST FOR FIRST CHARACTER 'E' IN MSG.         
         OI    CONDCODE,CCEQUALQ                                                
         B     TSEEOK              EXIT WITH CONDITION CODE SET                 
*                                                                               
TSEEOK   SR    RC,RC                                                            
TSEENO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_TSTERN TEST TO COMPARE FOR ERROR NUMBER IN TWA MESSAGE FIELD      *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
TSENEXEC NTR1  BASE=*                                                           
*                                  GET VALUE OF NUMBER FROM SCRIPT              
         GOTO1 LOADHIN,CRPARM,SCRIPLOC,HALF                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
*                                                                               
         GOTO1 FRSTPRO,CRPARM      GET STANDARD TWA MESSAGE FIELD               
*                                                                               
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                                                               
         LA    RF,L'WORK                                                        
         GOTO1 GETTWA,CRPARM,WORK,(RF)                                          
         BNE   TENENO              ERROR EXIT                                   
*                                  TEST FOR ERROR MESSAGE                       
         ICM   RF,15,=V(SSB)       CHECK ONLINE                                 
         BZ    TENE020                                                          
         CLC   WORK+2(1),SSBSYSCH-SSBD(RF)                                      
         BNE   TENE020             TEST FOR SYSTEM ERROR MESSAGE CHAR.          
         CLI   WORK,C'E'                                                        
         BNE   TENE020             TEST FOR FIRST CHARACTER 'E' IN MSG.         
*                                                                               
         LA    RE,4                                                             
         LA    RF,WORK+3                                                        
*                                                                               
TENE010  CLI   0(RF),C'0'                                                       
         BL    TENE020                                                          
         CLI   0(RF),C'9'                                                       
         BH    TENE020                                                          
         BCT   RE,TENE010                                                       
         PACK  DUB,WORK+3(4)                                                    
         CVB   R1,DUB                                                           
         CLM   R1,3,HALF                                                        
         BNE   TENE020                                                          
*                                                                               
         OI    CONDCODE,CCEQUALQ                                                
         B     TENE020             EXIT WITH CONDITION CODE SET                 
*                                                                               
TENE020  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     TENEOK                                                           
*                                                                               
TENEOK   SR    RC,RC                                                            
TENENO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_TSTOK TEST TO COMPARE FOR NO ERROR IN TWA MESSAGE FIELD           *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
TSTOEXEC NTR1  BASE=*                                                           
         GOTO1 FRSTPRO,CRPARM      GET STANDARD TWA MESSAGE FIELD               
*                                                                               
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
         OI    CONDCODE,CCEQUALQ                                                
*                                                                               
         LA    RF,L'WORK                                                        
         GOTO1 GETTWA,CRPARM,WORK,(RF)                                          
         BNE   TSOENO              ERROR EXIT                                   
*                                  TEST FOR ERROR MESSAGE                       
         ICM   RF,15,=V(SSB)       CHECK ONLINE                                 
         BZ    TSOEOK                                                           
         CLC   WORK+2(1),SSBSYSCH-SSBD(RF)                                      
         BNE   TSOEOK              TEST FOR SYSTEM ERROR MESSAGE CHAR.          
         CLI   WORK,C'E'                                                        
         BNE   TSOEOK              TEST FOR FIRST CHARACTER 'E' IN MSG.         
         NI    CONDCODE,X'FF'-CCEQUALQ                                          
         B     TSOEOK              EXIT WITH CONDITION CODE SET                 
*                                                                               
TSOEOK   SR    RC,RC                                                            
TSOENO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_TSTCUR TEST FOR CURSOR IN CURRENT TWA FIELD                       *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
TSTCEXEC NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
         L     R5,TWALOC                                                        
         USING FLDHDRD,R5                                                       
         SR    RF,RF                                                            
         IC    RF,FLDLEN                                                        
         CH    RF,=H'9'                                                         
         BL    TSCEOK                                                           
         CLI   FLDATB,X'FF'                                                     
         BE    TSCEOK                                                           
         L     R4,ATBUFF                                                        
         USING TBHDATA,R4                                                       
         OC    TBHCURD,TBHCURD                                                  
         BZ    TSCE010                                                          
         L     RF,ATWA                                                          
         LR    RE,R5                                                            
         SR    RE,RF                                                            
         CLM   RE,3,TBHCURD                                                     
         BNE   TSCEOK                AND SET CONDITION CODE                     
         OI    CONDCODE,CCEQUALQ                                                
         B     TSCEOK                                                           
*                                                                               
TSCE010  OC    TBHCURS,TBHCURS                                                  
         BZ    TSCEOK                                                           
         CLC   TBHCURS,FLDADR                                                   
         BL    TSCEOK                                                           
         SR    RF,RF                                                            
         IC    RF,FLDLEN                                                        
         SH    RF,=H'8'                                                         
         TM    FLDATB,FATBXHDR                                                  
         BZ    *+8                                                              
         SH    RF,=H'8'                                                         
         SR    R0,R0                                                            
         ICM   R0,3,FLDADR                                                      
         AR    RF,R0                                                            
         CLM   RF,3,TBHCURS                                                     
         BNH   TSCEOK                                                           
         OI    CONDCODE,CCEQUALQ                                                
         B     TSCEOK                                                           
*                                                                               
TSCEOK   SR    RC,RC                                                            
TSCENO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         DROP  R4,R5                                                            
         EJECT                                                                  
***********************************************************************         
* S_TSTLIN TEST TO COMPARE VALUE WITH CURRENT SCREEN LINE NUMBER      *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
TSTLEXEC NTR1  BASE=*                                                           
         NI    CONDCODE,X'FF'-CCEQUALQ-CCLOWQ-CCHIGHQ                           
*                                  GET 2 BYTE LENGTH FROM SCRIPT                
         GOTO1 LOADBYT,CRPARM,SCRIPLOC,BYTE                                     
         ICM   R5,15,0(R1)         SAVE LENGTH OF SCRIPT PARAMETER              
         ICM   RE,15,TWALOC                                                     
         USING FLDHDRD,RE                                                       
         SR    R3,R3                                                            
         SR    R2,R2                                                            
         ICM   R3,3,FLDADR                                                      
         D     R2,=F'80'                                                        
         LA    R3,1(R3)                                                         
         DROP  RE                                                               
         CLM   R3,1,BYTE           COMPARE LINE NUMBER TO PARAMETER             
         BNE   *+12                  AND SET CONDITION CODE                     
         OI    CONDCODE,CCEQUALQ     TO EQUAL IF SAME                           
         B     TSLE010                                                          
*                                                                               
TSLE010  EQU   *                   MOVE SCRIPLOC PAST PARAMETER                 
         BL    *+12                                                             
         OI    CONDCODE,CCHIGHQ                                                 
         B     *+8                                                              
         OI    CONDCODE,CCLOWQ                                                  
*                                                                               
         L     RF,SCRIPLOC                                                      
         LA    RF,0(R5,RF)                                                      
         ST    RF,SCRIPLOC                                                      
         B     TSLEOK                                                           
*                                                                               
TSLEOK   SR    RC,RC                                                            
TSLENO   LTR   RC,RC                                                            
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_SCTON TURN ON SCRIPT TRACING                                      *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
STONEXEC NTR1  BASE=*                                                           
         ICM   R3,15,AUTL                                                       
         USING UTLD,R3                                                          
         TM    TTEST,X'10'         TEST TRM IN TEST MODE                        
         BZ    STONOK                                                           
         ICM   R4,15,TACCS         GET TSTTAB ENTRY ADDRESS                     
         BZ    STONOK                                                           
         USING TSTTABD,R4                                                       
         TM    TSTFLAGS,TSTFSCTQ                                                
         BO    STONOK                                                           
         OI    TSTFLAGS,TSTFSCTQ   FLAG SCRIPT TRACING ON                       
         MVI   SCTFLAG,C'Y'        SET SCRIPT TRACE FLAG TO ON                  
         ICM   R6,15,TSTSCT        GET TRACE TABLE ADDRESS                      
         BZ    STONOK                                                           
         USING SCTTABD,R6                                                       
         B     STONOK                                                           
*                                                                               
STONOK   SR    RC,RC                                                            
STONNO   LTR   RC,RC                                                            
         XIT1                                                                   
         DROP  R3,R4,R6                                                         
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* S_SCTOFF TURN OFF SCRIPT TRACING                                    *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
STOFEXEC NTR1  BASE=*                                                           
         ICM   R3,15,AUTL                                                       
         USING UTLD,R3                                                          
         TM    TTEST,X'10'         TEST TRM IN TEST MODE                        
         BZ    STOFOK                                                           
         ICM   R4,15,TACCS         GET TSTTAB ENTRY ADDRESS                     
         BZ    STOFOK                                                           
         USING TSTTABD,R4                                                       
         TM    TSTFLAGS,TSTFSCTQ   FLAG SCRIPT TRACING ON                       
         BZ    STOFOK                                                           
         NI    TSTFLAGS,X'FF'-TSTFSCTQ   FLAG SCRIPT TRACING OFF                
         MVI   SCTFLAG,C'N'        SET SCRIPT TRACE FLAG TO OFF                 
         ICM   R6,15,TSTSCT        GET TRACE TABLE ADDRESS                      
         BZ    STOFOK                                                           
         USING SCTTABD,R6                                                       
         B     STOFOK                                                           
*                                                                               
STOFOK   SR    RC,RC                                                            
STOFNO   LTR   RC,RC                                                            
         XIT1                                                                   
         DROP  R3,R4,R6                                                         
         LTORG                                                                  
***********************************************************************         
* CLOSE DOWN SCRIPT TRACING                                           *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
CLOSSCT  NTR1  BASE=*                                                           
         ICM   R3,15,AUTL                                                       
         USING UTLD,R3                                                          
         TM    TTEST,X'10'         TEST TRM IN TEST MODE                        
         BZ    CSCTOK                                                           
         ICM   R4,15,TACCS         GET TSTTAB ENTRY ADDRESS                     
         BZ    CSCTOK                                                           
         USING TSTTABD,R4                                                       
         NI    TSTFLAGS,X'FF'-TSTFSCTQ   FLAG SCRIPT TRACING OFF                
         ICM   R6,15,TSTSCT        GET TRACE TABLE ADDRESS                      
         BZ    CSCTOK                                                           
         ICM   R1,15,ASCRIPID                                                   
         USING SCTTABD,R6                                                       
         LA    RE,CSCT010          NOTE TABLE IS IN 31-BIT STORAGE              
         O     RE,=X'80000000'                                                  
         BSM   0,RE                                                             
*                                                                               
CSCT010  EQU   *                                                                
         ICM   RF,15,ASCRIPID                                                   
         STCM  RF,15,SCTAINP                                                    
         ICM   RF,15,ASCRIPOD                                                   
         STCM  RF,15,SCTAOUT                                                    
         ICM   RF,15,ASCWORK                                                    
         STCM  RF,15,SCTAWRK                                                    
         MVC   SCTSERR,ERRCODE                                                  
         L     RF,SCRIPLOC                                                      
         S     RF,ASCRIPT                                                       
         STCM  RF,3,SCTSDSP                                                     
         L     RF,OUDATLOC                                                      
         S     RF,ASCRIPOD                                                      
         STCM  RF,3,SCTSOUTL                                                    
*                                                                               
CSCT020  LA    RE,*+6              BACK TO 24-BIT MODE                          
         BSM   0,RE                                                             
         B     CSCTOK                                                           
*                                                                               
CSCTOK   SR    RC,RC                                                            
CSCTNO   LTR   RC,RC                                                            
         XIT1                                                                   
         DROP  R3,R4,R6                                                         
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CONVERT STRING IN WORK FOR LENGTH (R1) TO UPPER CASE                *         
***********************************************************************         
         SPACE 1                                                                
         DS    0D                                                               
CUPPER   NTR1  BASE=*                                                           
         LA    RE,L'WORK                                                        
         LTR   R1,R1                                                            
         BZ    CUPPX                                                            
         LA    RF,WORK                                                          
CUPP010  CLI   0(RF),X'81'         TEST LOWER CASE LETTER                       
         BL    CUPP020                                                          
         CLI   0(RF),X'A9'                                                      
         BH    CUPP020                                                          
         OI    0(RF),X'40'                                                      
CUPP020  LA    RF,1(RF)                                                         
         BCT   R1,*+8                                                           
         B     CUPPX                                                            
         BCT   RE,CUPP010                                                       
         B     CUPPX                                                            
CUPPX    EQU   *                                                                
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* FASCRUNCH ABEND REENTRY POINT                                       *         
* FAABEND HAS RESTORED SCRUNCH'S REGISTERS FROM 1ST REQGISTER SAVE    *         
* AREA STORED WHEN SCRUNCH LAST CALLED IT'S FIRST SUBROUTINE.         *         
* ALL REGISTERS (INCLUDING RC) SHOULD STILL BE VALID.                 *         
***********************************************************************         
         SPACE 1                                                                
SCRASH   LR    RB,RF               FAABEND POINTS RF TO V(SCRASH)               
         USING SCRASH,RB                                                        
         L     R1,ATCB                                                          
         LA    R2,5                                                             
         GOTO1 =V(MONITOR)         CALL MONITOR - SCRUCH HAS DIED               
*                                                                               
SCRA010  L     R3,ATCB             EXIT SCRUNCH                                 
         USING TCBD,R3                                                          
         ICM   R3,15,TCBSCRPT      POINT R3 TO CALLING TASK ECB                 
         BZ    SCRASHX                                                          
         ICM   R1,15,TCBSVECB      POST ECB IN CALLING TASK                     
         BZ    SCRASHX                                                          
         OI    0(R1),X'40'                                                      
*                                                                               
SCRASHX  XMOD1 1                                                                
         LTORG                                                                  
         DROP  R3,RB                                                            
         EJECT                                                                  
*                                                                               
* LOCAL DSECTS                                                                  
*                                                                               
SCOTABD  DSECT                     SCRIPT CONTROL FUNCTION TABLE DSECT          
SCTCODE  DS    CL2                 CONTROL CODE                                 
SCTVAL   DS    AL4                 VALIDATION ROUTINE ADDRESS                   
SCTEXEC  DS    AL4                 EXECUTE ROUTINE ADDRESS                      
SCTDATA  DS    0X                  LIST OF DATA ITEM CONTROLS                   
SCTDNUM  DS    XL2                 DATA ITEM NUMBER                             
SCTDMIN  DS    XL2                 DATA ITEM MINIMUM LENGTH                     
SCTDMAX  DS    XL2                 DATA ITEM MAXIMUM LENGTH                     
SCTDIND  DS    XL2                 DATA ITEM INDICATORS                         
SCTDATAL EQU   *-SCTDATA                                                        
SCOTABL  EQU   *-SCOTABD                                                        
         SPACE 2                                                                
DCVTABD  DSECT                     DATA CONVERSION TABLE DSECT                  
DCTDNUM  DS    H                   DATA TYPE NUMBER                             
DCTVAL   DS    AL4                 INPUT VALIDATION ROUTINE ADDRESS             
DCTOUT   DS    AL4                 OUTPUT ROUTINE ADDRESS                       
DCTUP    DS    AL4                 UPDATE ROUTINE ADDRESS                       
DCTINDS  DS    XL2                 CONVERSION INDICATORS                        
DCTIIQ   EQU   X'01'               INPUT VALIDATION REQUIRED                    
DCTIOQ   EQU   X'02'               OUTPUT FORMATTING RQUIRED                    
DCVTABL  EQU   *-DCVTABD           ENTRY LENGTH                                 
DTI      EQU   X'01'                                                            
DTTYPE   EQU   1000                                                             
DTCHAR   EQU   1001                                                             
DTDATA   EQU   1002                                                             
DTBYTE   EQU   1003                                                             
DTHINT   EQU   1004                                                             
DTFINT   EQU   1005                                                             
DTHEX2   EQU   1006                                                             
DTLEN2   EQU   1007                                                             
DTSLAB   EQU   1008                                                             
DTFLAB   EQU   1009                                                             
DTWLAB   EQU   1010                                                             
         SPACE 2                                                                
SYMTABD  DSECT                     SYMBOL TABLE DSECT                           
SYTNAME  DS    CL2                 SYMBOL NAME                                  
SYTKEYL  EQU   *-SYMTABD                                                        
SYTADDR  DS    AL4                 SYMBOL ADDRESS                               
SYTTYPE  DS    XL1                 SYMBOL LABEL TYPE                            
SYTTSLBQ EQU   X'01'               SYMBOL IS SCRIPT LABEL                       
SYTTFLBQ EQU   X'02'               SYMBOL IS TWA FIELD LABEL                    
SYTTWLBQ EQU   X'04'               SYMBOL IS WORK AREA LABEL                    
SYTINDS  DS    XL1                 SYMBOL INDICATORS                            
SYMTABL  EQU   *-SYMTABD                                                        
         SPACE 2                                                                
IFLDHDRD DSECT                                                                  
IFLDLEN  DS    CL1       INPUT FLD LENGTH=(3+L'DATA)=X'00' IF TIA END           
IFLDADR  DS    CL2       INPUT FLD START SCREEN ADR =(ROW-1)*80+(COL-1)         
IFLDDATA DS    0C        INPUT FLD DATA                                         
         SPACE 2                                                                
FATTABD  DSECT                     FIELD ATRRIBUTE TABLE DSECT                  
FATTWA   DS    XL4                 ADDRESS FIELD IN TWA                         
FATVAL   DS    XL1                 ATRIBUTE VALUE                               
         DS    XL1                 N/D                                          
FATTABL  EQU   *-FATTABD                                                        
         SPACE 2                                                                
FLPTABD  DSECT                     FIELD POSITION TABLE DSECT                   
FLPTWA   DS    XL2                 OFFSET IN TWA TO FIELD                       
FLPINP   DS    XL2                 OFFSET IN INPUT BUFFER TO FIELD              
FLPTABL  EQU   *-FLPTABD                                                        
         EJECT                                                                  
WORKD    DSECT                     ** LOCAL W/S **                              
*                                                                               
DUB      DS    D                   DOUBLE WORD                                  
FULL     DS    F                   FULL WORD                                    
*                                                                               
DMCB     DS    6F                  6 FULL WORD PARAMETER LIST                   
*                                                                               
*                                  ***  WARNING !!  ***                         
*                                  DO NOT MOVE CRWORK AND CRPARM                
CRWORK   DS    F                   A(WORK) BEFORE CRPARM                        
CRPARM   DS    6F                  COMMON ROUTINE PARAMETER LIST                
PARMSV   DS    A                   A(PARAMETER LIST SAVED)                      
*                                                                               
HALF     DS    H                   HALF WORD                                    
BYTE     DS    B                   BYTE                                         
WORK     DS    XL64                WORK AREA FOR EDIT INSTRUCTION               
WORK80   DS    XL80                80 BYTE WORK AREA                            
CTXTBUF1 DS    XL99                TWA FIELD COMPARE TEXT BUFFER 1              
CTXTBUF2 DS    XL99                TWA FIELD COMPARE TEXT BUFFER 2              
BLOCK    DS    XL256               256 BYTE WORK AREA                           
FDATA    DS    XL255               TWA FIELD DATA WORK AREA                     
SAVERD   DS    F                   SAVE REGISTER D ON ENTRY                     
RELO     DS    A                   RELOCATION VALUE                             
COUNTER  DS    F                   SCRIPT COMMAND COUNTER                       
*                                                                               
TWALOC   DS    A                   LOCATION OF CURRENT TWA FIELD                
TWALOCSV DS    A                   SAVE LOCATION OF CURRENT TWA FIELD           
TWAMEM   DS    A                   A(OFFSET INTO TWA MEMORY)                    
SAVEFLD  DS    XL2                 SAVE TWA FIELD ADDRESS                       
TWAFOFF  DS    XL1                 TWA FIELD DATA ENTRY OFFSET                  
SVTWLFLG DS    CL1                 SAVE TWA LOCATION FLAG                       
RECLEN   DS    H                   LENGTH OF TWA RECORD                         
CHKDSP   DS    H                   LENGTH OF TWA TO START OF CHKPNT             
GLODSP   DS    H                   LENGTH OF TWA TO START OF GLOBASS            
TODAY    DS    XL2                 TODAYS DATE BINARY COMPRESSED                
TODAYC   DS    XL2                 AS ABOVE 2S COMPLEMENTED                     
DATETIME DS    XL4                 DATE/TIME VALUE FROM DATTIM                  
DATETIMC DS    XL4                 DATE/TIME VALUE 1'S COMPLEMENTED             
SYSDATEB DS    XL3                 SYSTEM DATE BINARY (YMD, GETFACTS)           
MVSTIME  DS    F                   IBM TIME BINARY 100THS SECS.                 
MVSDATE  DS    F                   IBM DATE JULIAN                              
TSRSAVE  DS    XL2                 UTL TSVCREQ VALUE SAVE                       
MSG      DS    CL80                                                             
EXT      DS    CL132               EXTRA TEXT FOR GETTXT CALLS                  
ASRVSCRN DS    A                   ADDRESS SERVICE PROGRAM SCREEN PHASE         
ADDATE   DS    CL8                 ADDAY DATE WORK SPACE YYMMDD EBCDIC          
IOCONT   DS    XL1                 IO CONTROL BYTE PARAM 1 DATAMGR              
IOERR    DS    XL1                 IO ERROR RETURN CODE DATAMGR                 
SCPCODE  DS    CL2                 SCRIPT CONTROL CODE SAVE                     
CONFLAG  DS    CL1                 CONNECTED FLAG                               
CONFNO   EQU   C'N'                NO CONNECT ATTEMPTED                         
CONFBEF  EQU   C'B'                BEFORE CONNECT ATTEMPT                       
CONFAFT  EQU   C'A'                AFTER CONNECT ATTEMPT                        
EXITFLAG DS    CL1                 EXIT SCRIPT FLAG                             
ABNDFLAG DS    CL1                 ABEND FLAG                                   
CONDCODE DS    XL1                 CONDITION CODE                               
CCEQUALQ EQU   X'01'               EQUAL                                        
CCLOWQ   EQU   X'02'               LOWER THAN                                   
CCHIGHQ  EQU   X'04'               HIGHER THAN                                  
CCEOD    EQU   X'08'               END OF DATA                                  
FLDSEP   DS    CL1                 FIELD SEPARATOR CHARACTER                    
FLDSEPDQ EQU   C';'                FIELD SEPARATOR DEFAULT CHARACTER            
EOD      DS    XL1                 END OF DATA VALUE                            
EODQ     EQU   0                   EOD DEFAULT VALUE                            
CTRY     DS    XL1                 CONNECT COUNTRY CODE                         
LANG     DS    XL1                 CONNECT LANGUAGE CODE                        
OVSYS    DS    XL1                 CONNECT OVERLAY SYSTEM CODE                  
ERRPOS   DS    CL2                 ERROR BUFFER SLOT # OUTPUT                   
CURPOS   DS    CL5                 CURSOR POSITION OUTPUT                       
FLDPOS   DS    CL5                 FIELD POSITION OUTPUT                        
CURSOR   DS    XL2                 ABSOLUTE SCREEN ADDRESS OF CURSOR            
RESULTS  DS    CL8                 SCREEN MESSAGE FIELD RESULTS                 
LABTYPE  DS    XL1                 SYMBOLIC LABEL TYPE                          
CUROFF   DS    XL2                 CURSOR FIELD OFFSET                          
CURFLD   DS    XL2                 CURSOR FIELD NUMBER                          
SENUMBER DS    XL1                 SYSTEM SE NUMBER                             
SLABLAST DS    CL2                 LAST SCRIPT LABEL NAME                       
FLABLAST DS    CL2                 LAST FIELD LABEL NAME                        
WLABLAST DS    CL2                 LAST WORK LABEL NAME                         
*                                                                               
TIOBVAL  DS    XL(TIOBL)           TIOB VALUES                                  
*                                                                               
SYSTEM   DS    CL7                 CONNECT SYSTEM                               
SYSLEN   DS    XL1                 CONNECT SYSTEM LENGTH                        
PROGRAM  DS    CL20                CONNECT PROGRAM,TEST PARAMETERS              
PRGLEN   DS    XL1                 CONNECT PROGRAM LENGTH                       
USERID   DS    CL10                USERID                                       
USRLEN   DS    XL1                 USERID LENGTH                                
PASSWD   DS    CL10                PASSWORD                                     
PWDLEN   DS    XL1                 PASSWORD LENGTH                              
PERID    DS    CL8                 PERSON ID                                    
TESTID   DS    CL10                IAM=TESTID                                   
TIDLEN   DS    XL1                 TESTID LENGTH                                
CTFLAGS  DS    XL1                 CONNECT PARAMETER FLAGS                      
CTFUSRQ  EQU   X'01'               EBCDIC USER-ID ENTERED                       
CTFSYSQ  EQU   X'02'               EBCDIC SYSTEM ENTERED                        
CTFPRGQ  EQU   X'04'               EBCDIC PROGRAM ENTERED                       
CTFPWDQ  EQU   X'08'               EBCDIC PASSWORD ENTERED                      
CTFIAMQ  EQU   X'10'               EBCDIC IAM=TESTID ENTERED                    
LTIAFLAG DS    CL1                 LOAD TIA FLAG                                
SCTFLAG  DS    CL1                 SCRIPT TRACE ON FLAG                         
CONNTEST DS    CL1                 CONNECT TEST RETURN FLAG                     
*                                                                               
LABNAME  DS    CL8                 LABEL NAME                                   
ERRCODE  DS    H                   ERROR CODE                                   
*                                                                               
LOOPCUNT DS    F                   SCRIPT LOOP COUNTER                          
LOGLINE  DS    CL40                LOG EVENT FOR SCRIPT TRACE                   
*                                                                               
*        SCRIPT CONTROL ADDRESSES                                               
*                                                                               
ASCRIPT  DS    A                   A(SCRIPT CONTROL BUFFER)                     
ASCRIPID DS    A                   A(SCRIPT INPUT DATA)                         
ASCRIPOD DS    A                   A(SCRIPT OUTPUT DATA)                        
ASCRERR  DS    A                   A(SCRIPT ERROR)                              
AINPROUT DS    A                   A(SCRIPT INPUT ROUTINE)                      
AINPPARM DS    A                   A(SCRIPT INPUT ROUTINE PARAMETERS)           
AOUTROUT DS    A                   A(SCRIPT OUTPUT ROUTINE)                     
AOUTPARM DS    A                   A(SCRIPT OUTPUT ROUTINE PARAMETERS)          
*                                                                               
*        SCRIPT DATA BUFFER PARAMETERS                                          
*                                                                               
INDATRDL DS    A                   INPUT DATA READ LOCATION                     
INDATWRL DS    A                   INPUT DATA WRITE LOCATION                    
OUDATLOC DS    A                   OUTPUT DATA LOCATION POINTER                 
INRECLEN DS    XL2                 INPUT DATA RECORD LENGTH                     
OURECLEN DS    XL2                 OUTPUT DATA RECORD LENGTH                    
INDATMAX DS    XL2                 INPUT DATA MAXIMUM LENGTH                    
OUDATMAX DS    XL2                 OUTPUT DATA MAXIMUM LENGTH                   
*                                                                               
*        SCRIPT ERROR BUFFER PARAMETERS                                         
*                                                                               
AERRBUFF DS    A                   A(ERROR MESSAGE BUFFER)                      
AERRBNXT DS    A                   A(NEXT ENTRY IN ERROR MSG BUFFER)            
AERRBEND DS    A                   A(END OF ERROR MSG BUFFER)                   
ERRBMAX  DS    XL2                 A(MAX # ENTRIES IN ERROR MSG BUFFER)         
ERRORLEN EQU   60                  LENGTH OF SCREEN ERROR MESSAGE               
ERRSLOT  DS    XL1                 ERROR BUFFER SLOT #                          
*                                                                               
*        SCRIPT INSTRUCTION BUFFER PARAMETERS                                   
*                                                                               
SCRIPEND DS    A                   A(END OF SCRIPT BUFFER)                      
SCRIPLOC DS    A                   SCRIPT LOCATION COUNTER                      
SCRIPLEN DS    XL4                 LENGTH OF SCRIPT BUFFER                      
*                                                                               
ASCOTAB  DS    A                   A(SCRIPT CONTROL TABLE)                      
ASCOTABX DS    A                   A(END OF SCRIPT CONTROL TABLE)               
SCTPTR   DS    A                   POINTER INTO SCRIPT CONTROL TABLE            
*                                                                               
ADCVTAB  DS    A                   A(DATA CONVERSION TABLE)                     
ADCVTABX DS    A                   A(END OF DATA CONVERSION TABLE)              
DCVPTR   DS    A                   POINTER INTO DCVTAB                          
*                                                                               
*        SCRIPT COMPILER SYMBOL TABLE PARAMETERS                                
*                                                                               
ASYMTAB  DS    A                   A(SYMBOL TABLE)                              
ASYMTABX DS    A                   A(END OF SYMBOL TABLE)                       
ASYMTNXT DS    A                   A(NEXT ENTRY IN SYMBOL TABLE)                
*                                                                               
*        FIELD INPUT POSITION TABLE PARAMETERS                                  
*                                                                               
AFLPTAB  DS    A                   A(FIELD POSITION TABLE)                      
AFLPTABX DS    A                   A(END OF FIELD POSITION TABLE)               
AFLPTNXT DS    A                   A(NEXT ENTRY IN FIELD POSN. TABLE)           
*                                                                               
*        FIELD ATTRIBUTE TABLE PARAMETERS                                       
*                                                                               
AFATTAB  DS    A                   A(FIELD ATTRIBUTE TABLE)                     
AFATTABX DS    A                   A(END OF FIELD ATTRIBUTE TABLE)              
AFATTNXT DS    A                   A(NEXT ENTRY IN FIELD ATTR. TABLE)           
AFATLAST DS    A                   A(LAST ENTRY FOUND IN FATTAB)                
*                                                                               
*        SCRIPT WORK AREA ADDRESSES                                             
*                                                                               
ASCWORK  DS    A                   A(SCRIPT WORK AREA START)                    
ASCWORKX DS    A                   A(SCRIPT WORK AREA END)                      
SCWORKL  DS    A                   A(CURRENT LOCATION IN SCWORK)                
*                                                                               
*        SAVED POINTERS FOR TRACING                                             
*                                                                               
LASTINP  DS    A                   LAST INPUT DATA AREA READ POINTER)           
LASTOUP  DS    A                   LAST OUTPUT DATA AREA POINTER                
LASTWRP  DS    A                   LAST WORK DATA AREA POINTER                  
LASTTIA  DS    A                   LAST FIELD LOADED INTO TIA                   
*                                                                               
*        ADDRESSES OF RESOURCES PASSED FROM FAKPAK TO THE CONTROLLER            
*        ON THE PARAMETER LIST                                                  
*                                                                               
APARMS   DS    A                   A(PARAMETER LIST)                            
ASYSFACS DS    A                   A(SYSFACS)                                   
ATIA     DS    A                   A(TIA)                                       
AUTL     DS    A                   A(UTL)                                       
ACOMFACS DS    A                   A(COMFACS)                                   
ATWA     DS    A                   A(TWA)                                       
ATBUFF   DS    A                   A(TBUFF)                                     
ATIOB    DS    A                   A(TIOB)                                      
ASSB     DS    A                   A(SSB)                                       
ATCB     DS    A                   A(TCB)                                       
ASYSLST  DS    A                   A(SYSLST)                                    
*                                                                               
*        ADDRESSES OF THE BASE REGISTERS AND SECTIONS OF MEMORY                 
*        ALLOCATED BY THE CONTROLLER'S NMOD INSTRUCTION                         
*                                                                               
ABASE1   DS    A                   A(BASE1)                                     
ABASE2   DS    A                   A(BASE2)                                     
ABASE3   DS    A                   A(BASE3)                                     
ASAVE    DS    A                   A(CONTROLLER SAVED MEMORY)                   
AOVER    DS    A                   A(OVERLAY SAVED MEMORY)                      
AIOS     DS    A                   A(DATAMGR IO AREAS)                          
AFREE    DS    A                   A(FREE MEMORY FOR OVERLAYS)                  
         DS    10A                 SPARE                                        
*                                                                               
*        ADDRESSES OF COMFACS ROUTINES                                          
*                                                                               
COMFADRS DS    0A                                                               
DATAMGR  DS    A                                     DCDATAMGR                  
SCANNER  DS    A                                     ETC.                       
TERMVAL  DS    A                                                                
DATCON   DS    A                                                                
ADDAY    DS    A                                                                
GETRET   DS    A                                                                
GETFACT  DS    A                                                                
GETTXT   DS    A                                                                
GETHELP  DS    A                                                                
SWITCH   DS    A                                                                
HEXOUT   DS    A                                                                
DICTATE  DS    A                                                                
HELLO    DS    A                                                                
         DS    20A                 SPARE                                        
*                                                                               
*        ADDRESSES OF ROUTINES LINKED WITH THE CONTROLLER                       
*                                                                               
EXTERNS  DS    0V                                                               
DUMMY    DS    V                   DUMMY 32000 BYTE AREA USED TO LOAD           
*                                      OVERLAYS                                 
         DS    20V                 SPARE                                        
*                                                                               
*        ADDRESSES OF CORE RESIDENT ROUTINES                                    
*                                                                               
COREADRS DS    0V                                                               
         DS    20V                 SPARE                                        
*                                                                               
*        ADDRESSES OF COMOON ROUTINES                                           
*                                                                               
*                                                                               
COMRADRS DS    0A                                                               
GOTOMON  DS    A                                                                
LOADFLD  DS    A                                                                
LOADTIA  DS    A                                                                
GETTWA   DS    A                                                                
LTWAFLD  DS    A                                                                
LTWANUM  DS    A                                                                
LTWAADR  DS    A                                                                
LTWATXT  DS    A                                                                
LTWADIC  DS    A                                                                
TABUNP   DS    A                                                                
TABPRO   DS    A                                                                
NXTFLD   DS    A                                                                
FRSTFLD  DS    A                                                                
FRSTUNP  DS    A                                                                
FRSTPRO  DS    A                                                                
VALCHAR  DS    A                                                                
VALBYTE  DS    A                                                                
VALHINT  DS    A                                                                
VALFINT  DS    A                                                                
VALSLAB  DS    A                                                                
VALFLAB  DS    A                                                                
VALWLAB  DS    A                                                                
VALHEX2  DS    A                                                                
VALLEN2  DS    A                                                                
LOADCHR  DS    A                                                                
LOADBYT  DS    A                                                                
LOADHIN  DS    A                                                                
LOADFIN  DS    A                                                                
LOADSLB  DS    A                                                                
LOADHX2  DS    A                                                                
LOADLN2  DS    A                                                                
SETSLB   DS    A                                                                
TSTOUT   DS    A                                                                
TSTINP   DS    A                                                                
PUTFPOT  DS    A                                                                
GETFPOT  DS    A                                                                
PUTFATT  DS    A                                                                
GETFATT  DS    A                                                                
LOGBR    DS    A                                                                
LOGCMP   DS    A                                                                
LOGMOV   DS    A                                                                
COMRADRN EQU   (*-COMRADRS)/4                                                   
         DS    7A                  SPARE                                        
*                                                                               
*        VARIABLES USED BY RECORD ELEMENT PROCESSING SUBROUTINES                
*                                                                               
ELEMENT  DS    XL256               ELEMENT DATA SAVE                            
AELEM    DS    A                   ADDRESS ELEMENT                              
ACTEL    DS    XL(SAACVLNQ)        ACTIVITY ELEMENT SAVE                        
*                                                                               
*        VARIABLES IN DATAMGR CALLS                                             
*                                                                               
KEY      DS    XL48                DATAMGR KEY                                  
KEYSAVE  DS    XL48                BACK UP OF KEY                               
*                                                                               
*                                                                               
AIO      DS    A                   A(CURRENT IO AREA)                           
AIO1     DS    A                   A(FIRST IO AREA)                             
AIO2     DS    A                   A(SECOND IO AREA)                            
AIO3     DS    A                   A(THIRD IO AREA)                             
*                                                                               
DDDSLST  DS    0C                                                               
         DSDDL                                                                  
*                                                                               
*        WORK AREA FOR SCRIPTS                                                  
*                                                                               
SCWORK   DS    0D                  SCRIPT WORK AREA                             
         DS    (SCWLEN)XL1                                                      
SCWORKX  DS    0D                                                               
SCWLEN   EQU   1000                                                             
         EJECT                                                                  
*                                                                               
*        SYMBOL TABLE FOR SCRIPT COMPILATION                                    
*        FIXED LENGTH ENTRIES FOR EACH SYMBOL FOUND                             
*        CL2   SYMBOL NAME                                                      
*        AL4   ADDRESS SYMBOL VALUE                                             
*        XL1   SYMBOL LABEL TYPE                                                
*        XL1   SYMBOL INDICATORS                                                
*                                                                               
SYMTAB   DS    0D                  SYMBOL TABLE                                 
         DS    (SYMTABM*(SYMTABL))XL1                                           
SYMTABX  DS    0D                                                               
SYMTABM  EQU   100                                                              
         SPACE 2                                                                
*        FIELD POSITION TABLE                                                   
*        FIXED LENGTH ENTRIES FOR EACH FIELD ENTERED IN TWA                     
*        XL2   OFFSET OF TWA FIELD HEADER FROM START OF TWA                     
*        XL2   OFFSET TO SOURCE OF FIELD DATA IN INPUT AREA                     
*                                                                               
FLPTAB   DS    0D                  FIELD POSITION  TABLE                        
         DS    (FLPTABM*(FLPTABL))XL1                                           
FLPTABX  DS    0D                                                               
FLPTABM  EQU   1000                                                             
         SPACE 2                                                                
*                                                                               
*        FIELD ATTRIBUTE TABLE                                                  
*        FIXED LENGTH ENTRIES FOR EACH FIELD ATTRIBUTE DEFINED                  
*        XL4   ADDRESS OF FIELD IN TWA                                          
*        XL1   FIELD ATTRIBUTE                                                  
*        XL1   N/D                                                              
*                                                                               
FATTAB   DS    0D                  FIELD ATTRIBUTE TABLE                        
         DS    (FATTABM*(FATTABL))XL1                                           
FATTABX  DS    0D                                                               
FATTABM  EQU   10                                                               
         SPACE 2                                                                
*                                                                               
WORKX    EQU   *                                                                
         EJECT                                                                  
*                                                                               
* INCLUDED DSECTS                                                               
*                                                                               
       ++INCLUDE FASCRIPTQ                                                      
       ++INCLUDE FADSECTS                                                       
       ++INCLUDE FATBHD                                                         
         PRINT OFF                                                              
       ++INCLUDE DDCOMFACS                                                      
       ++INCLUDE DDCOREQUS                                                      
       ++INCLUDE CTGENFILE                                                      
       ++INCLUDE SEACSFILE                                                      
       ++INCLUDE FAFACTS                                                        
       ++INCLUDE FASYSLSTD                                                      
       ++INCLUDE FACHKPT                                                        
       ++INCLUDE DDFLDHDR                                                       
       ++INCLUDE DDGETRETD                                                      
         PRINT ON                                                               
         EJECT                                                                  
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'005FASCRUNCHS05/01/02'                                      
         END                                                                    

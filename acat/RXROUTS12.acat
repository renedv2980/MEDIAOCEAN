*          DATA SET RXROUTS12  AT LEVEL 201 AS OF 02/20/13                      
*          DATA SET RXROUTS11S AT LEVEL 001 AS OF 09/27/07                      
*          DATA SET RXROUTS11  AT LEVEL 034 AS OF 09/27/07                      
*CATALP RXROUT12                                                                
         TITLE 'EXTRACT ROUTINES FOR REPXTRACT'                                 
***********************************************************************         
*  THIS VERSION WILL GENERATE 'FORECAST' CONTRACT DATA.  THE ACTUAL   *         
*        GENERATION OF THE DATA CAN BE CONTROLLED FROM THE RXTRACT    *         
*        MODULE ITSELF.                                               *         
*        BILL  --  MAY 12 /2006                                       *         
*                                                                     *         
***********************************************************************         
*  CHANGES:                                                           *         
*  APR04/02 (BU ) --- DON'T ADJUST MONFORC DATES TO MONDAY            *         
*  JUL23/03 (BU ) --- PEND/FC/BB -                                    *         
*  AUG21/03 (JRD) --- FIX DATE FIELDS                                 *         
*                     INCLUDE BOOKED DOLLAR CODE                      *         
*                     PUT IN ALL DELIMITERS                           *         
*  SEP25/03 (BU ) --- PEND/FORECAST: DON'T TEST FOR X'04' (INV) ELTS  *         
*                     TO KEEP IN LINE WITH RRG REPORTING              *         
*  OCT08/03 (BU ) --- PEND/FORECAST: SET 'PEND' WITH X'04' ELTS TO    *         
*                     X/4 PER JD.                                     *         
*  FEB07/04 (BU ) --- KATZ STRADA VERSION                             *         
*  FEB25/04 (BU ) --- KATZ STRADA: CHANGES ONLY VERSION               *         
*  JUN28/04 (BU ) --- INTEREP VERSION: EXTRA FIELDS (RXRECDIR)        *         
*  JUN30/04 (BU ) --- OPTIONAL AGGREGATE EST/INV $                    *         
*  JUL07/05 (BU ) --- NEW VERSION FOR FUTURE DEVELOPMENT              *         
*  JUL28/05 (BU ) --- MODIFY 'KILL' TO SINGLE OUTPUT RECORD           *         
*  AUG18/05 (BU ) --- DEFAULT TIMESTAMP TO 14-CHAR FIXED VALUE        *         
*  SEP01/05 (BU ) --- VARIABLE NUMBER OF YEARS IN REQUEST             *         
*  SEP07/05 (BU ) --- SWITCH RECORD INCLUSION                         *         
*  SEP30/05 (BU ) --- INITIAL VERSION 'I' FOR ESS CHANGES / MO        *         
*                      REQUESTED BY R.MARTINEZ / B. HANNAH            *         
*  OCT06/05 (BU ) --- BREAKOUT SWITCH/FILTERS, STATION PIDS           *         
*  OCT20/05 (BU ) --- ADD MEDIA OCEAN USER FLAG TO STATION DATA       *         
*  NOV09/05 (BU ) --- ADD 'LOSS' DATA RETRIEVAL                       *         
*  NOV17/05 (BU ) --- VARIETY OF CORRECTIONS: BOOKS ,ETC              *         
*  NOV22/05 (BU ) --- USE COMPETITIVE LIST IN STAXREC                 *         
*  NOV23/05 (BU ) --- REMOVE CONFIRM IO IN PLACE OF TABLE             *         
*  NOV30/05 (BU ) --- NEW CTR FIELDS IN BOOKS, LENGTHS RECORDS        *         
*  DEC13/05 (BU ) --- NEW RECORDS:  STA OFF FILTER, CONFIRM COMMENT   *         
*  JAN10/06 (BU ) --- SEND HIGHEST VERSION #                          *         
*  MAR27/06 (BU ) --- NEW VER:  ADDITIONAL DATA, RECORDS PER          *         
*                     ROBERT MARTINEZ                                 *         
*  MAY12/06 (BU ) --- NEW VER:  ADDITIONAL DATA, CHANGES TO OLD       *         
*  JUN12/06 (BU ) --- MODIFY DATE SETUP TO WORK OFF 'TODAY',          *         
*  JUN28/06 (BU ) --- ADD THREE ACTIVITY DATES                        *         
*  OCT12/06 (BU ) --- ADD 'ION' TO AFFILS                             *         
*  NOV16/06 (BU ) --- ADD BONUS / TRADE / ETC TO CON HEADER           *         
*  JAN02/07 (BU ) --- ADD 'NBW' TO AFFILS                             *         
*  FEB08/07 (BU ) --- NEW VERSION: RXROUT10 - THREE CHANGES:          *         
*                     1.  NEW RECORD:  BUYCODE                        *         
*                     2.  CONTRACT:  MON INDICATOR                    *         
*                     3.  OFFICE COMMENT:  DESCRIPTION                *         
*                                                                     *         
*  MAR28/07 (BU ) --- PROMOTED WITH CHANGE OF FEB08/07:               *         
*                     RECONPAD: PENDING ACTIVITY DATE FIELD IN 5600   *         
*  MAY08/07 (BU ) --- ADD 'LAT' TO AFFILS                             *         
*  MAY22/07 (BU ) --- FALSE LOSS TEST                                 *         
*  MAY24/07 (BU ) --- ACTIVATE ALTERNATE CALENDAR BUCKETS             *         
*                     NOT ACTIVE UNTIL BUCKTABL CHANGED !! SEE        *         
*                     INSTRUCTIONS AT 'BUCKTABL'  (BU: 5/24/07)       *         
*  JUL19/07 (BU ) --- ADD DUPLICATE CHECK FOR OFFICE/TEAM DATA        *         
*  AUG28/07 (SKU) --- NEW RECORDS: BUY                                *         
*                     PRODUCT CODE 2 SUPPORT                          *         
*  SEP18/08 (SKU) --- FIX BUYHEADER START DAY                         *         
*  APR11/09 (SKU) --- INCLUDE REAFFLIST                                         
*  JUN03/09 (SKU) --- PASS $0 ESTIMATE BUCKETS UNCONDITIONALLY                  
*  JUN10/09 (SKU) --- DON'T PASS INVOICE BUCKETS IF CONTRACT IS LOSS            
*  JUN18/09 (SKU) --- BUY: DEFAULT LAST UPDATE DATE WITH CREATION DATE          
*                     BUY: CREATE $0 BUCKET AGAINST LAST UPDATE DATE            
*  FEB15/11 (SKU) --- CHANGE ISLOSS DEFAULT TO Y IF MARKET CANCEL               
*  SEP30/11 (SKU) --- FIX Z BUCKETS REDOLADL INITIALIZATION                     
***********************************************************************         
         PRINT NOGEN                                                            
RXROUTS  CSECT                                                                  
         ENTRY REPDOLC           CONTRACT DOLLARS/HDR/COMPETITIVE/              
*                                     DAYPARTS/LENS/BOOKS                       
         ENTRY REPAGYC           AGENCY                                         
         ENTRY REPADVC           ADVERTISER                                     
         ENTRY REPSALC           SALESPERSON                                    
         ENTRY REPCTYC           CONTRACT TYPE                                  
         ENTRY REPDCTC           DEV CONTRACT TYPE                              
         ENTRY REPSTAC           STATION                                        
         ENTRY REPDSPC           DEV SALESPERSON                                
         ENTRY REPTEMC           TEAM                                           
         ENTRY REPPRDC           PRODUCT CODE                                   
         ENTRY REPCLSC           CLASS                                          
         ENTRY REPCATC           CATEGORY                                       
         ENTRY REPOFFC           OFFICE                                         
         ENTRY REPOWNC           OWNER                                          
         ENTRY REPMKTC           MARKET                                         
         ENTRY REPGRPC           GROUP/SUBGROUP                                 
         ENTRY REPRGNC           REGION                                         
         ENTRY REPTERC           TERRITORY                                      
         ENTRY REPMSTC           SUB/MASTER                                     
         ENTRY REPREPC           REP INFO                                       
         ENTRY REPBD1C           STATION BUDGET DATA: TYPE 13 RECORD            
         ENTRY REPBD2C           OFFICE  BUDGET DATA: TYPE 19 RECORD            
         ENTRY REPPTPC           POINT PERSON   DATA: TYPE 31 RECORD            
         ENTRY SETUPMON          SETUP DATE RRG STYLE DATE TABLES               
         ENTRY REPSETC           SET RECORDS                                    
         ENTRY REPSWIC           SWITCH RECORD                                  
         ENTRY REPCCOC           CONFIRM COMMENT RECORD                         
         ENTRY REPSCMC           STANDARD COMMENT RECORD                        
         ENTRY REPOFCC           OFFICE   COMMENT RECORD                        
         ENTRY REPEAGC           EOP      AGENCY  RECORD                        
         ENTRY REPEADC           EOP      ADVERT  RECORD                        
         ENTRY REPEOFC           EOP      OFFIVE  RECORD                        
         ENTRY REPESPC           EOP      S/P     RECORD                        
         ENTRY REPBCDC           BUY CODE RECORD                                
         ENTRY REPBUYC           BUY RECORD                                     
         ENTRY RXQWK             RRG/QWKD DATE TABLE                            
*                                                                               
EXIT     XIT1                                                                   
EXITR2   XIT1  REGS=(R2)                                                        
BANNER1  DC    C'BILLUHR: 05/08/07:LAT'                                         
BANNER2  DC    C'BILLUHR: 05/22/07:FALSE LOSS TEST'                             
BANNER3  DC    C'BILLUHR: 05/24/07:ALTERNATE CAL: NOT ACTIVE YET'               
         DS    0H                                                               
         EJECT                                                                  
***********************************************************************         
* REPDOLC - EXTRACT CONTRACT HEADER & DOLLAR RECORDS                            
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL1 REP PROFILE FLAGS, SEE REPPFLGS IN RXTRACT                      *         
* AL3 A(REPFILE RECORD)                                               *         
* AL1 0=BUILD 'K' RECORD, 1=BUILD ALL RECORDS, 2=PASS BACK NEXT       *         
*     X'FF' RETURNED IF NO MORE RECORDS TO PROCESS                    *         
* AL3 A(STATION RECORD)                                               *         
* AL4 A(SXDTABD)                                                      *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
REPDOLC  NMOD1 WORKL,*REPDOL*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RXDOLLIT                                                      
         USING LITERAL,RA                                                       
*                                                                               
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REDOLD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
*   CHECK TO SEE IF WEEK DATES ARE SET                                          
*                                                                               
         OC    WEEKSTRT,WEEKSTRT   ANY VALUE?                                   
         BNZ   RDOL0020            YES                                          
*                                                                               
         BAS   RE,SETWEEK                                                       
RDOL0020 EQU   *                                                                
         USING RCONREC,R3          R3=A(REPFILE RECORD)                         
*&&DO                                                                           
*   TEST                                                                        
         CLC   =X'00502443',RCONKCON                                            
         BNE   *+6                                                              
         DC    H'0'                                                             
*   TEST END                                                                    
*&&                                                                             
         SR    RE,RE                                                            
         ICM   RE,7,9(R1)                                                       
         ST    RE,ASTAREC                                                       
*                                                                               
         BRAS  RE,LOADER                                                        
*                                                                               
         CLI   8(R1),1                                                          
         JL    RXDOLKIL            BUILD KILL RECORD                            
         JE    RXDOLSER            BUILD SERIES OF RECORDS                      
         J     RXDOLNXT            OUTPUT NEXT RECORD                           
*                                                                               
RXDOLLIT DC    A(LITERAL)                                                       
         EJECT                                                                  
SETWEEK  NTR1                                                                   
TRAP0001 EQU   *                                                                
         CLC   ASATDATE,SPACES     ANY AS-AT DATE OVERRIDE?                     
         BNH   TRAP0002            NO                                           
         GOTO1 DATCON,DMCB,(0,ASATDATE),(2,WEEKEND)                             
*                                  SET AS-AT'S DATE: 7TH DAY                    
         MVC   WORK+12(6),ASATDATE                                              
*                                  USE AS-AT TO CALC SIX DAYS BACK              
         B     TRAP0003                                                         
TRAP0002 EQU   *                                                                
         GOTO1 DATCON,DMCB,(5,WORK),(2,WEEKEND)                                 
*                                  SET TODAY'S DATE: 7TH DAY                    
         GOTO1 DATCON,DMCB,(5,WORK),(0,WORK+12)                                 
*                                  USE TODAY TO CALC SIX DAYS BACK              
TRAP0003 EQU   *                                                                
         GOTO1 VADDAY,DMCB,WORK+12,WORK,-6                                      
         GOTO1 DATCON,DMCB,(0,WORK),(2,WEEKSTRT)                                
*                                                                               
         MVC   TRAP0001(2),=X'0000' CAUSE DUMP IF USED MORE THAN ONCE           
*                                                                               
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*---------------------------------------------------------------------*         
* GET NEXT CONTRACT DOLLAR RECORD IN SERIES AND RETURN IT                       
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXDOLNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK?                         
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         LA    R0,REDOLD           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1               LENGTH OF NEXT RECORD                        
         ICM   R1,3,REDOLLEN-REDOLD(RE)                                         
         LA    RF,0(R1,RE)         SAVE NEXT ADDRESS                            
         ST    RF,ANEXT                                                         
         LR    RF,R1               SET LENGTH                                   
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD 'K' RECORD FOR CONTRACT RECORD AND EXIT                                 
*                                                                               
*   SOME NOTES ON 'KILL':                                                       
*                                                                               
*        THE EXACT RECORDS GENERATED BY THE LAST CHANGE OR                      
*        ADD CAN BE GENERATED AS 'KILLS' BY BRANCHING TO 'RXDOLSER'             
*        IMMEDIATELY AFTER THE 'MVI   KILLMODE,C'Y'' STATEMENT                  
*        BELOW.  THIS REQUIRES THAT THE RECORD BEING POINTED TO IS              
*        'COPY' RECORD RATHER THAN 'CHANGE' RECORD.  RXTRACT MOD                
*        IS PASSING IN THE ADDRESS OF THE 'COPY' RATHER THAN THE                
*        'CHANGE' WHEN A 'KILL' IS REQUESTED.                                   
*        IF A SINGLE RECORD TO KILL A GROUP OF RECORDS IS NEEDED,               
*        THE CODE WILL CREATE A SINGLE RECORD OF TYPE, WITH SUFFICIENT          
*        INFORMATION TO KILL ALL ASSOCIATED RECORDS.  THE RECORD MUST           
*        HAVE SUFFICIENT KEY IDENTIFICATION TO MAKE IT UNIQUE, AND              
*        ALL KEYS THAT BEGIN WITH THAT PARTIAL KEY WILL BE DROPPED.             
*        THESE KEYS CAN BE GENERATED FROM THE 'CHANGE' KEY, IN WHICH            
*        CASE YOU DON'T REALLY KNOW WHAT HAD BEEN GENERATED PREV-               
*        IOUSLY BY THE 'COPY' KEY.                                              
*                                                                               
*        THE CODE IS CURRENTLY SET UP TO GENERATE A SINGLE KILL                 
*        RECORD WITH A PARTIAL KEY.                                             
*                                                                               
*                                                                               
*                                                                               
*        BILL  7/22/05                                                          
*                                                                               
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXDOLKIL DS    0H                                                               
         MVI   KILLMODE,C'Y'       SET TO 'KILL'                                
*                                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXDOLCC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXDOLCON         FIRST KILL HEADER                            
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REDOLLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*&&DO                                                                           
*   TEST                                                                        
         CLC   =X'00024381',RCONKCON                                            
         BNE   TCMP0020                                                         
         MVC   HALF,=X'FFFF'                                                    
TCMP0020 EQU   *                                                                
*   TEST END                                                                    
*&&                                                                             
         LA    R6,RCONREC          COMPETITIVE STATIONS:                        
         MVI   ELCODE,X'06'        SPL ELEMENT                                  
         BRAS  RE,GETEL                                                         
         JNE   RXDK0020            NOT FOUND                                    
         USING RCONSPEL,R6                                                      
*                                                                               
*   1ST STATION IS REPORTED WITHIN CONTRACT HEADER.  MUST BE AT LEAST           
*        TWO STATIONS TO PERFORM NEXT ROUTINE.                                  
*                                                                               
         CLI   RCONSPNU,1          MINI ELEMENTS?                               
         BNH   RXDK0020            NO  - NO COMPETITIVE                         
         BRAS  RE,RXDOLCPT         THEN  KILL COMPETITIVE STAS                  
         DROP  R6                                                               
RXDK0020 EQU   *                                                                
         LA    R6,RCONREC          COMPETITIVE COMMENT :                        
         MVI   ELCODE,X'07'        COMMENT ELEMENT                              
         BRAS  RE,GETEL                                                         
         JNE   RXDK0030            NOT FOUND                                    
         BRAS  RE,RXDOLCCM         THEN  KILL COMPETITIVE COMMENTS              
RXDK0030 EQU   *                                                                
*                                                                               
         LA    R6,RCONREC          DAYPART / CPP:                               
         MVI   ELCODE,X'41'        DYPRT/CPP ELEMENT                            
         BRAS  RE,GETEL                                                         
         JNE   RXDK0040            NOT FOUND                                    
         USING RCPRDPEL,R6                                                      
         CLI   1(R6),RCPRDPOQ      NO DAYPARTS/CPPS IN ELEMENT?                 
         BE    RXDK0040            NO  -                                        
         BRAS  RE,RXDOLDPT         THEN  KILL DAYPART/CPPS                      
         DROP  R6                                                               
RXDK0040 EQU   *                                                                
*                                                                               
         LA    R6,RCONREC          LENGTHS:                                     
         MVI   ELCODE,X'11'        PEND / FORECAST COMMENT ELEMENT?             
         BRAS  RE,GETEL                                                         
         JNE   RXDK0050            NOT FOUND                                    
         USING RCONBCEL,R6                                                      
         BRAS  RE,RXDOLPFC         THEN  KILL PEND/FORE COMMENTS                
         DROP  R6                                                               
RXDK0050 EQU   *                                                                
*                                                                               
         LA    R6,RCONREC          LENGTHS:                                     
         MVI   ELCODE,X'12'        SAR ELEMENT                                  
         BRAS  RE,GETEL                                                         
         JNE   RXDK0060            NOT FOUND                                    
         USING RSARXEL,R6                                                       
         OC    RSARXRFR,RSARXRFR   NO LENGTHS IN ELEMENT?                       
         BZ    RXDK0060            NO  -                                        
         BRAS  RE,RXDOLLEN         THEN  KILL LENGTHS                           
         DROP  R6                                                               
RXDK0060 EQU   *                                                                
*                                                                               
         LA    R6,RCONREC          BOOKS:                                       
         MVI   ELCODE,X'40'        BOOKS ELEMENT                                
         BRAS  RE,GETEL                                                         
         JNE   RXDK0080            NOT FOUND                                    
         USING RCPRBKEL,R6                                                      
         CLI   1(R6),RCPRBKOQ      NO BOOKS IN ELEMENT?                         
         BE    RXDK0080            NO  -                                        
         BRAS  RE,RXDOLBKS         THEN  KILL BOOKS                             
         DROP  R6                                                               
*                                                                               
RXDK0080 EQU   *                                                                
         L     R8,ANEWMON2         THEN KILL BUCKETS                            
         GOTO1 RXDOLDOL,DMCB,(R6),(1,0)                                         
*                                  FLAGGED TO GENERATE PARTIAL KEY              
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REDOLLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     EXIT                                                             
*                                                                               
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD SERIES OF RECORDS FOR THIS CONTRACT                           *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXDOLSER DS    0H                                                               
*                                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXDOLCC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         LA    RE,ASTAREC          TRICK RESETVAL TO SEE THIS RECORD            
         AHI   RE,-16                                                           
         ST    RE,VSPNDCTL                                                      
*                                                                               
         BRAS  RE,RXDOLCON         FIRST RECORD IS THE CONTRACT HEADER          
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REDOLLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         LA    R6,RCONREC          COMPETITIVE STATIONS:                        
         MVI   ELCODE,X'06'        SPL ELEMENT                                  
         BRAS  RE,GETEL                                                         
         JNE   RXDS0020            NOT FOUND                                    
         USING RCONSPEL,R6                                                      
*                                                                               
*   1ST STATION IS REPORTED WITHIN CONTRACT HEADER.  MUST BE AT LEAST           
*        TWO STATIONS TO PERFORM NEXT ROUTINE.                                  
*                                                                               
         CLI   RCONSPNU,1          MINI ELEMENTS?                               
         BNH   RXDS0020            NO  - NO COMPETITIVE                         
*&&DO                                                                           
X        USING RECPTD,R2                                                        
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,X.RECPTLEN                                                  
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         DROP  X                                                                
*&&                                                                             
         BRAS  RE,RXDOLCPT         THEN  ADD  COMPETITIVE STAS                  
         DROP  R6                                                               
RXDS0020 EQU   *                                                                
*                                                                               
         LA    R6,RCONREC          LENGTHS:                                     
         MVI   ELCODE,X'07'        COMPETITIVE COMMENT ELEMENT?                 
         BRAS  RE,GETEL                                                         
         JNE   RXDS0030            NOT FOUND                                    
         XC    FULL2,FULL2         CLEAR COUNTER                                
RXDS0025 EQU   *                                                                
         BRAS  RE,RXDOLCCM         THEN  ADD  PEND / FORE COMMENTS              
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REDOLLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         ZIC   RF,1(R6)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R6,RF                                                            
         CLI   0(R6),X'07'         COMPETITIVE COMMENT ELEMENT?                 
         JE    RXDS0025            GO BACK FOR NEXT  CMT                        
*                                                                               
RXDS0030 EQU   *                                                                
*                                                                               
         LA    R6,RCONREC          DAYPARTS / CPPS:                             
         MVI   ELCODE,X'41'        DYPRT/CPP ELEMENT                            
         BRAS  RE,GETEL                                                         
         JNE   RXDS0040            NOT FOUND                                    
         USING RCPRDPEL,R6                                                      
         CLI   1(R6),RCPRDPOQ      NO DAYPARTS/CPPS IN ELEMENT?                 
         BE    RXDS0040            NO  -                                        
         BRAS  RE,RXDOLDPT         THEN  ADD  DAYPART/CPPS                      
         DROP  R6                                                               
RXDS0040 EQU   *                                                                
*                                                                               
         LA    R6,RCONREC          LENGTHS:                                     
         MVI   ELCODE,X'11'        PEND / FORE COMMENT ELEMENT?                 
         BRAS  RE,GETEL                                                         
         JNE   RXDS0050            NOT FOUND                                    
         XC    FULL2,FULL2         CLEAR COUNTER                                
RXDS0045 EQU   *                                                                
         BRAS  RE,RXDOLPFC         THEN  ADD  PEND / FORE COMMENTS              
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REDOLLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         ZIC   RF,1(R6)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R6,RF                                                            
         CLI   0(R6),X'11'         PEND / FORE ELEMENT?                         
         JE    RXDS0045            GO BACK FOR NEXT PEND/FORE CMT               
*                                                                               
RXDS0050 EQU   *                                                                
*                                                                               
         LA    R6,RCONREC          LENGTHS:                                     
         MVI   ELCODE,X'12'        SAR ELEMENT                                  
         BRAS  RE,GETEL                                                         
         JNE   RXDS0060            NOT FOUND                                    
         USING RSARXEL,R6                                                       
         OC    RSARXRFR,RSARXRFR   NO LENGTHS IN ELEMENT?                       
         BZ    RXDS0060            NO  -                                        
         BRAS  RE,RXDOLLEN         THEN  ADD  LENGTHS                           
         DROP  R6                                                               
RXDS0060 EQU   *                                                                
*                                                                               
         LA    R6,RCONREC          BOOKS:                                       
         MVI   ELCODE,X'40'        BOOKS ELEMENT                                
         BRAS  RE,GETEL                                                         
         JNE   RXDS0080            NOT FOUND                                    
         USING RCPRBKEL,R6                                                      
         CLI   1(R6),RCPRBKOQ      NO BOOKS IN ELEMENT?                         
         BE    RXDS0080            NO  -                                        
         BRAS  RE,RXDOLBKS         THEN  ADD  BOOKS                             
         DROP  R6                                                               
*                                                                               
RXDS0080 EQU   *                                                                
*                                                                               
         TM    PARM+4,X'20'        INCLUDE BUSINESS REPORTING?                  
         JNZ   RXDS0100            YES                                          
*                                                                               
         CLI   PENDFORE,C'X'       IS THIS AN OLD STYLE RECORD?                 
         JNE   RXDS0340            NO - DON'T DO DOLLARS                        
*                                                                               
RXDS0100 DS    0H                                                               
         L     R9,=A(RXQWK)                                                     
         USING QWKD,R9                                                          
*                                                                               
         XC   BLOCK7,BLOCK7                                                     
*                                  CLEAR BLOCK FOR DATCON/ADDAY/GETDAY          
         MVC   BLOCK7(4),DATCON                                                 
         MVC   BLOCK7+4(4),VADDAY                                               
         MVC   BLOCK7+8(4),VGETDAY                                              
*                                                                               
         GOTO1 VALU5NEW,PLIST,RCONREC,ANEWMON2,QWMONINF,QWMONFOR,      +        
               (C'P',0),(0,QWCURND),BLOCK7                                      
         TM    PARM+4,X'80'        HANDLE ZERO DOLLAR BUCKETS?                  
         JZ    RXDS0120            NO                                           
*                                                                               
         GOTO1 =A(SETVALU2),PLIST,(RC),ANEWMON2,QWMONFOR,QWCURST3               
RXDS0120 EQU   *                                                                
         CLI   FULLFLAG,C'A'       ROLL UP EST/INV $$?                          
         BE    RXDS0260            YES - SEND ROLLUPS                           
*                                                                               
         LA    R6,RCONELEM                                                      
RXDS0140 EQU   *                                                                
         CLI   0(R6),0             END OF RECORD?                               
         BE    RXDS0340            YES - FINISHED WITH THIS CONTRACT            
         LA    R7,BUCKTABL         SET A(ELEMENT FINDER)                        
RXDS0160 EQU   *                                                                
         CLI   0(R7),0             END OF TABLE?                                
         BE    RXDS0240            YES - NOT A BUCKET ELEMENT                   
         CLC   0(1,R6),0(R7)       CONTRACT ELEMENT IN TABLE?                   
         BE    RXDS0180            YES - PROCESS IT FURTHER                     
RXDS0170 EQU   *                                                                
         LA    R7,LBUCKTBL(R7)     NO  - BUMP TO NEXT TABLE ENTRY               
         B     RXDS0160            CHECK NEXT TABLE SLOT                        
RXDS0180 EQU   *                                                                
         CLI   0(R6),4             INVOICE BUCKET?                              
         BNE   RXDS0190            NO                                           
         CLI   PENDFORE,C'F'       YES - FORECAST ORDER?                        
         JE    RXDS0170            YES - SKIP THE INVOICE BUCKET                
*                                     MUST BE A CLOSEOUT: FORECAST              
*                                     ORDERS WOULDN'T HAVE INVOICE              
*                                     BUCKETS IN ANY OTHER CASE.                
RXDS0190 EQU   *                                                                
         CLI   3(R7),C' '          ANY MUTUALLY EXCLUSIVE VALUE?                
         BE    RXDS0200            NO                                           
         CLC   3(1,R7),PENDFORE    YES - ORDER OF THIS TYPE?                    
         BNE   RXDS0170            NO  - CHECK NEXT TABLE TYPE                  
RXDS0200 EQU   *                                                                
         MVC   BUCKFLGS,1(R7)      SAVE BUCKET TYPE/SUBTYPE FLAGS               
*&&DO                                                                           
*   TEST                                                                        
         CLC   =X'13872051',RCONKCON                                            
         BNE   TESTX929                                                         
         LA    R0,3                                                             
         DC    H'0'                                                             
TESTX929 EQU   *                                                                
*   TEST END                                                                    
*&&                                                                             
*                                                                               
*   CHECK NEXT BUCKET FOR SAME DATES.  IF SAME, MERGE $$, SET                   
*       ELEMENT TYPE TO X'FF' TO SKIP IT IN LOOP.                               
*                                                                               
         BRAS  RE,CHEKBUCK                                                      
*                                                                               
*   CHECK THAT BUCKET IS IN CURRENT YEAR                                        
*                                                                               
*        ZICM  RE,QWCURST,3                                                     
*        ZICM  RF,QWCURND,3                                                     
*** TEST                                                                        
*        CLC   =X'00000567',RCONKCON                                            
*        CLC   =C'DI',BUCKFLGS                                                  
*        BNE   *+6                                                              
*        DC    H'0'                                                             
*** TEST                                                                        
         CLC   2(2,R6),QWCURST     MONTH OF SERV VS START DATE                  
         BL    RXDS0240            PRIOR: SKIP IT                               
         CLC   2(2,R6),QWCURND     MONTH OF SERV VS END   DATE                  
         BH    RXDS0240            PRIOR: SKIP IT                               
*                                                                               
*   A BUCKET FOR CURRENT YEAR HAS BEEN FOUND: OUTPUT A RECORD                   
*                                                                               
         CLI   FULLFLAG,C'Y'       SEND ALL BUCKETS?                            
         BE    RXDS0220            YES                                          
*                                  NO  - TEST ACTIV DATE THIS WEEK              
RXDS0210 EQU   *                                                                
         CLC   4(2,R6),WEEKSTRT    ACTIV DATE EARLIER THAN WEEK?                
         BL    RXDS0240            YES - SKIP IT                                
         CLC   4(2,R6),WEEKEND     ACTIVE DATE LATER  THAN WEEK?                
         BH    RXDS0240            YES - SKIP IT                                
*                                  R6 CONTAINS A(BUCKET TO SEND)                
RXDS0220 EQU   *                                                                
***********************************************************************         
* SKIP INVOICE BUCKET GENERATION IF CONTRACT IS A LOSS                          
***********************************************************************         
         CLI   BUCKFLGS+1,C'I'                                                  
         BNE   RXDS0230                                                         
         BRAS  RE,ISLOSS                                                        
         BZ    RXDS0240                                                         
*                                                                               
RXDS0230 EQU   *                                                                
         GOTO1 RXDOLDOL,DMCB,(R6),(0,0)                                         
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REDOLLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
RXDS0240 EQU   *                                                                
         ZIC   RF,1(R6)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R6,RF                                                            
         J     RXDS0140            GO BACK FOR NEXT CONTRACT ELT                
*                                                                               
***>>>                                                                          
RXDS0260 EQU   *                                                                
         L     R8,ANEWMON2                                                      
*                                                                               
*   TEST DUMP                                                                   
*        CLC   =X'00875953',RCONKCON                                            
*        BNE   TEST0220                                                         
*        ZICM  R0,RCONKCON,4                                                    
*        DC    H'0'                                                             
TEST0220 EQU   *                                                                
*   TEST DUMP END                                                               
*                                                                               
*                                                                               
*   FIND REQUEST START DATE IN TABLE.                                           
*                                                                               
RXDS0280 EQU   *                                                                
         CLI   0(R8),0             ANY TABLE ENTRY?                             
         JE    RXDS0320            NO  - EXIT                                   
*                                                                               
*  THE NEXT INSTRUCTION CONFUSES ME.  THIS LOOP IS BUMPING THRU                 
*        THE BUCKETS, AND THIS TEST IS COMPARING THE WHOLE AREA                 
*        FOR ZEROS.  AS THIS AREA IS CONSTANTLY SHIFTING DOWN,                  
*        THE COMPARISON FOR 128 BYTES IS STRANGE.  WHY????                      
*                                                                               
* IF THE WHOLE AREA IS ZERO THEN THERE IS NOTHING WORTH CHECKING                
*   BECAUSE THERE IS NO MONEY                                                   
*                                                                               
         OC    BUCKDISP(BUCKSIZE,R8),BUCKDISP(R8)                               
         JZ    RXDS0300            NO MONEY IN BUCKET, SKIP TO NEXT             
*                                                                               
         BRAS  RE,RXDOL$$2         GENERATE ESTIMATE DOLLAR ENTRY               
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REDOLLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXDOL$$3         GENERATE INVOICE  DOLLAR ENTRY               
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REDOLLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
RXDS0300 EQU   *                                                                
         LA    R8,NEXTBUCK(R8)     BUMP BUCKET ADDRESS                          
         L     RE,ANEWMON2                                                      
         AHI   RE,NEWMONL                                                       
         CR    R8,RE                                                            
         JL    RXDS0280            SWING BACK FOR NEXT BUCKET                   
*                                                                               
***>>>                                                                          
RXDS0320 EQU   *                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REDOLLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
RXDS0340 DS    0H                                                               
         J     EXIT                                                             
*                                                                               
RXDOLCC  DC    A(BUFFER1)          ADJUSTED RATE RECORD SAVE AREA               
ANEWMON2 DC    A(NEWMON)           NEWMON TABLE                                 
         LTORG                                                                  
*                                                                               
***********************************************************************         
* CHECK IF CONTRACT IS A LOSS CONTRACT                                          
***********************************************************************         
ISLOSS   NTR1  LABEL=*,BASE=*                                                   
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'06'        SPL ELEMENT                                  
         BRAS  RE,GETEL                                                         
         JNE   ISLOSSN             NOT FOUND                                    
         USING RCONSPEL,R6                                                      
         TM    RCONSPES,X'40'      REP'D STA $$ = ZERO??                        
         BNO   ISLOSSN             NO                                           
*                                                                               
*   CHECK FOR ALL SPL AMOUNTS AS ZERO: THIS IS A FALSE LOSS.                    
*                                                                               
         CLI   RCONSPNU,0          ANY MINI ELTS?                               
         BE    ISLOSSN             NO  - CAN'T BE A LOSS                        
         ZIC   RF,RCONSPNU                                                      
         LA    RE,RCONSPST         SET A(FIRST MINI ELT)                        
ISLOSS10 EQU   *                                                                
         OC    5(4,RE),5(RE)       ANY $$ IN MINI-ELEMENT?                      
         BNZ   ISLOSSY             YES - NOT A FALSE LOSS                       
         LA    RE,9(RE)            BUMP TO NEXT MINI ELT                        
         BCT   RF,ISLOSS10         GO BACK FOR NEXT                             
*        B     ISLOSSN             NO DOLLARS/PERCENT: FALSE LOSS               
*                                                                               
* IF MARKET CANCEL (ALL ZEROES), SET ISLOSS TO TRUE                             
*                                                                               
         DROP  R6                                                               
*                                                                               
ISLOSSY  SR    R0,R0               SET CC ZERO                                  
         B     ISLOSSX                                                          
ISLOSSN  EQU   *                                                                
         LTR   RB,RB               SET CC NOT ZERO                              
ISLOSSX  EQU   *                                                                
         XIT1                                                                   
         LTORG                                                                  
*********************************************************************           
*   TABLE DEFINES BUCKET TYPES THAT ARE EXTRACTED, AND THE                      
*        VALUES THAT ARE INSERTED INTO THE OUTPUT RECORDS                       
*        FOR EACH TYPE.                                                         
*        BYTE 1     =  BUCKET TYPE                                              
*        BYTE 2 - 3 =  OUTPUT RECORD TYPE FIELDS                                
*        BYTE 4     =  ORDER HEADER TYPE FOR THIS BUCKET                        
*                      ' '  =  ACCEPT IN ALL CASES                              
*                      'X'  =  REJECT UNLESS PENDFORE = 'X',                    
*                              WHERE 'X' IS ANY VALUE                           
*                              (THIS IS TO SEPARATE MUTUALLY                    
*                              EXCLUSIVE BUCKET TYPES, SUCH AS                  
*                              CASH / BOOKED VS PENDING                         
*********************************************************************           
*                                                                               
BUCKTABL DC    X'03',C'CB',C' '    BOOKED: CASH,BOOKED                          
LBUCKTBL EQU   *-BUCKTABL                                                       
         DC    X'04',C'CI',C' '    BILLED: CASH, INVOICED                       
         DC    X'23',C'FB',C'P'    FORECAST/PENDING?                            
         DC    X'23',C'FB',C'F'    FORECAST/PENDING?                            
*                                                                               
*   TO ACTIVE ALTERNATE CALENDAR BUCKETS, PER THE DISCUSSION OF                 
*        MAY24/07 WITH NEDIM ET AL:                                             
*        1.  UNCOMMENT FOLLOWING TWO LINES                                      
*        2.  CATALP THIS MODULE                                                 
*        3.  RELINK RXTRACT10 TO GENERATE A NEW "Q" VERSION                     
*                                                                               
         DC    X'53',C'DB',C' '    ALTCAL: CASH, BOOKED                         
         DC    X'54',C'DI',C' '    ALTCAL: CASH, INVOICED                       
         DC    X'63',C'TB',C' '    TRADE : BOOKED                               
         DC    X'64',C'TI',C' '    TRADE : INVOICED                             
**N/A    DC    X'83',C'UB',C' '    TRADE/ALT CAL: BOOKED                        
**N/A    DC    X'84',C'UI',C' '    TRADE/ALT CAL: INVOICED                      
         DC    X'0000'             DELIMITER                                    
         DS    0F                                                               
         EJECT                                                                  
*                                                                               
*   CHEKBUCK:  THERE ARE MULTIPLE BUCKETS THAT CONTAIN SAME                     
*        BUCKET TYPE                                                            
*        MONTH OF SERVICE                                                       
*        ACTIVITY DATE                                                          
*        WITHIN A SINGLE CONTRACT.  THIS ROUTINE WILL ROLL SECOND               
*        BUCKET $$ INTO FIRST, THEN SET SECOND BUCKET TYPE TO X'FF'             
*        TO CAUSE IT TO BE SKIPPED IN SUBSEQUENT PROCESSING.                    
*        ONLY THE BUCKET IMMEDIATELY FOLLOWING WILL BE CHECKED.                 
*        THIS SHOULD CATCH ALL DUPLICATES.                                      
*   R6 -> BUCKET TO BE PROCESSED.  BUCKETS ARE 10 CHARS LONG.                   
*                                                                               
CHEKBUCK NTR1  LABEL=*,BASE=*                                                   
         LR    RF,R6               SET A(THIS BUCKET)                           
CBUK0020 EQU   *                                                                
         LA    RF,10(RF)           SET A(NEXT ELEMENT)                          
         CLC   0(6,RF),0(R6)       NEXT BUCKET SAME AS THIS BUCKET?             
         BNE   CBUK0100            NO  - EXIT                                   
         ZICM  RE,6(RF),4          YES - STRIP $$ FROM NEXT BUCKET              
         MVI   0(RF),X'FF'         CHANGE NEXT BUCKET ELT CODE                  
         ZICM  R1,6(R6),4          STRIP $$ FROM THIS BUCKET                    
         AR    R1,RE               ADD BOTH BUCKET $$                           
         STCM  R1,15,6(R6)         REINSERT TOTAL DOLLARS                       
         B     CBUK0020            CHECK NEXT BUCKET                            
CBUK0100 EQU   *                                                                
         XIT1                                                                   
         LTORG                                                                  
*---------------------------------------------------------------------*         
* BUILD CONTRACT DOLLAR BUCKET RECORD                                           
*  R8 POINTS TO THE ENTRY IN NEWMON FOR THIS MONTH                              
*  P2 / BYTE1 = FULL KEY / PARTIAL KEY FLAG                                     
*           0 = GENERATE FULL KEY                                               
*           1 = GENERATE PARTIAL KEY THROUGH CONTRACT NUMBER                    
*               (STORED IN BYTE 1 OF 'HALF')                                    
*                                                                               
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXDOLDOL NTR1  BASE=*,LABEL=*                                                   
         L     R6,0(R1)            SET A(BUCKET IN PROGRESS)                    
         ST    R6,ABUCKET          SAVE A(BUCKET IN PROGRESS)                   
         MVC   HALF(1),4(R1)       SAVE PARTIAL FLAG                            
*                                                                               
         LA    R0,REDOLD           CLEAR THE RECORD                             
         LA    R1,REDOLDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
****>>>  LA    R7,BUCKDISP(R8)     SET R7 TO A(BUCKETS IN MONTH)                
*                                                                               
         CLI   PENDFORE,C'F'       FORECAST ORDER?                              
         JE    RXDOL020            YES                                          
         CLI   PENDFORE,C'P'       PENDING  ORDER?                              
         JE    RXDOL020            YES                                          
*                                                                               
         MVI   FULL,0              INITIALIZE RECORD SETTINGS                   
         MVC   FULL+1(1),BUCKFLGS                                               
         MVC   FULL+2(1),BUCKFLGS+1                                             
         J     RXDOL040                                                         
*                                                                               
RXDOL020 DS    0H                                                               
         MVI   FULL,0              INITIALIZE RECORD SETTINGS                   
         MVC   FULL+1(1),PENDFORE                                               
         MVC   FULL+2(1),PEND04                                                 
*                                                                               
RXDOL040 DS    0H                                                               
         ZICM  R7,6(R6),4          LOAD DOLLARS IN BUCKET                       
         LR    R6,R7               SET R6 TO $$ FOR CONTINUITY                  
*                                   (WAS $$ VALUE BEFORE THIS)                  
*                                  A(BUCKET) IS IN ABUCKET                      
         CLI   BUCKFLGS+1,C'B'     BOOKED DOLLARS?                              
         JNE   RXDOL060            NO  - INVOICED: GENERATE ENTRY               
*                                     FOR $0 INV BUCKETS                        
*                                                                               
*        LTR   R6,R6               NO MONEY IN BUCKET: SKIP IT                  
*        JZ    EXITR2                                                           
*                                                                               
RXDOL060 DS    0H                                                               
*                                                                               
         BRAS  RE,RXDOLSK          BUILD SKELETON                               
*                                                                               
         CLI   HALF,1              BUILD PARTIAL KEY?                           
         JE    EXITR2              YES - FINISHED                               
*&&DO                                                                           
         CLC   =X'00418660',RCONKCON                                            
         JNE   *+6                                                              
         DC    H'0'                                                             
*&&                                                                             
         CLI   BUCKFLGS+1,C'B'     BOOKED DOLLARS?                              
         JNE   RXDOL080            NO  - INVOICED                               
*                                                                               
         EDIT  (R6),(12,REDOLDOL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLDOL,MXTRT                                                   
         MVC   REDOLADL,FOXZERO    CLEAR OUT UNINITIALIZED FIELD                
         TR    REDOLADL,MXTRT                                                   
         J     EXITR2                                                           
*                                                                               
RXDOL080 EQU   *                                                                
         EDIT  (R6),(12,REDOLADL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLADL,MXTRT                                                   
         MVC   REDOLDOL,FOXZERO    CLEAR OUT UNINITIALIZED FIELD                
         TR    REDOLDOL,MXTRT                                                   
*                                                                               
         J     EXITR2                                                           
FOXZERO  DC    C'000000000000'                                                  
         LTORG                                                                  
*                                                                               
***--->>>                                                                       
*                                                                               
******************************************************************              
* RXDOL$$2 - GENERATE ROLLUP FIGURES FOR EACH MONTH OF SERVICE,  *              
*        RATHER THAN PUTTING OUT INDIVIDUAL BUCKETS.             *              
*        FULLFLAG = A SETS THIS ROUTINE.                         *              
*        THIS PRODUCES ESTIMATE (BOOKED) FIGURES                 *              
******************************************************************              
RXDOL$$2 NTR1  BASE=*,LABEL=*                                                   
         LA    R0,REDOLD           CLEAR THE RECORD                             
         LA    R1,REDOLDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LA    R7,BUCKDISP(R8)     SET R7 TO A(BUCKETS IN MONTH)                
*                                                                               
         CLI   PENDFORE,C'F'       FORECAST ORDER?                              
         JE    RX$20040            YES                                          
         CLI   PENDFORE,C'P'       PENDING  ORDER?                              
         JE    RX$20040            YES                                          
*                                                                               
         MVI   FULL,0              INITIALIZE RECORD SETTINGS                   
         MVI   FULL+1,C'C'                                                      
         CLI   PENDFORE,C'B'       BACK BILLING ORDER?                          
         JNE   RX$20020            NO                                           
         MVI   FULL+1,C'B'         YES - SET TO 'BACK BILLING'                  
RX$20020 EQU   *                                                                
         MVI   FULL+2,C'B'                                                      
*                                                                               
*                                                                               
         L     R4,CUASATIN(R7)                                                  
         TM    FLAG6(R8),X'01'                                                  
         JO    RX$20030            CURRENT INVOICED DOLLARS FOUND               
         L     R4,=F'-1'           NO INVOICED DOLLARS                          
*                                  SAVE FOR CURRENT FINAL                       
RX$20030 EQU   *                                                                
         ICM   R6,15,TOTORD(R7)                                                 
         JNZ   RX$20060            CURRENT BOOKED DOLLARS FOUND                 
*                                                                               
         SR    R6,R6                                                            
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         JE    RX$20060            YES - BUILD ZERO DOLLAR RECORD               
         J     RX$20080            NO CURRENT DOLLARS                           
*                                                                               
RX$20040 DS    0H                                                               
         MVI   FULL,0              INITIALIZE RECORD SETTINGS                   
         MVC   FULL+1(1),PENDFORE                                               
         MVC   FULL+2(1),PEND04                                                 
*                                                                               
         L     R6,CURRFORC(R7)                                                  
         LTR   R6,R6                                                            
         JNZ   RX$20060            CURRENT FC/PEND DOLLARS FOUND                
*                                                                               
         SR    R6,R6                                                            
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         JE    RX$20060            YES - BUILD ZERO DOLLAR RECORD               
         J     RX$20080            NO CURRENT DOLLARS                           
*                                                                               
RX$20060 DS    0H                                                               
         LTR   R6,R6                                                            
         BZ    RX$20080                                                         
*                                                                               
         BRAS  RE,RXDOLSK          BUILD SKELETON                               
*                                                                               
***JRD   CLC   =X'07055818',RCONKCON                                            
***JRD   JNE   *+6                                                              
***JRD   DC    H'0'                                                             
*                                                                               
         EDIT  (R6),(12,REDOLDOL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLDOL,MXTRT                                                   
*                                                                               
         C     R4,=F'-1'           ANY INVOICED?                                
         BE    RX$20070            NO  - LEAVE BLANK                            
*                                  YES - SEND ZEROS                             
         EDIT  (R4),(12,REDOLADL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLADL,MXTRT                                                   
RX$20070 DS    0H                                                               
*                                                                               
         AHI   R2,REDOLDL          BUMP PAST RECORD                             
*                                                                               
RX$20080 DS    0H                                                               
         CLI   PENDFORE,C'F'       FORECAST ORDER?                              
         JE    RX$20120            YES                                          
         CLI   PENDFORE,C'P'       PENDING  ORDER?                              
         JE    RX$20120            YES                                          
*                                                                               
         MVI   FULL,C'P'           INITIALIZE RECORD SETTINGS                   
         MVI   FULL+1,C'C'                                                      
         CLI   PENDFORE,C'B'       BACK BILLING ORDER?                          
         JNE   RX$20100            NO                                           
         MVI   FULL+1,C'B'         YES - SET TO 'BACK BILLING'                  
RX$20100 EQU   *                                                                
         MVI   FULL+2,C'B'                                                      
*                                                                               
         L     R4,PRTOTINV(R7)     SET PRIOR FINAL                              
         TM    FLAG6(R8),X'02'                                                  
         JO    *+8                                                              
         L     R4,PRTOTORD(R7)                                                  
*                                                                               
*&&DO                                                                           
         CLC   =X'00815446',RCONKCON                                            
         JNE   TDUM0020                                                         
         CLC   =X'FAF4F0F5',0(R8)  BUCKET DATE = MAY, 2004?                     
         JNE   TDUM0020            NO                                           
         DC    H'0'                                                             
*&&                                                                             
TDUM0020 EQU   *                                                                
*                                                                               
         ICM   R6,15,PRASATOR(R7)                                               
         JNZ   RX$20140            PRIOR BOOKED DOLLARS FOUND                   
*                                                                               
         LTR   R4,R4                                                            
         JNZ   RX$20140            PRIOR FINAL DOLLARS FOUND                    
*                                                                               
         SR    R6,R6                                                            
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         JE    RX$20140            YES - BUILD ZERO DOLLAR RECORD               
         J     RX$20180            NO PRIOR DOLLARS                             
*                                                                               
RX$20120 DS    0H                                                               
         MVI   FULL,C'P'           INITIALIZE RECORD                            
         MVC   FULL+1(1),PENDFORE                                               
         MVC   FULL+2(1),PEND04                                                 
*                                                                               
         SR    R4,R4                                                            
         ICM   R6,15,PRIOFORC(R7)                                               
         JNZ   RX$20140            CURRENT FC/PEND DOLLARS FOUND                
*                                                                               
         SR    R6,R6                                                            
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         JE    RX$20140            YES - BUILD ZERO DOLLAR RECORD               
         J     RX$20180            NO FC/PEND DOLLARS                           
*                                                                               
RX$20140 DS    0H                                                               
         LTR   R4,R4                                                            
         BNZ   RX$20160                                                         
*                                                                               
         LTR   R6,R6                                                            
         BZ    RX$20180                                                         
*                                                                               
RX$20160 DS    0H                                                               
         BRAS  RE,RXDOLSK          BUILD SKELETON                               
*                                                                               
         EDIT  (R6),(12,REDOLDOL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLDOL,MXTRT                                                   
*                                                                               
         EDIT  (R4),(12,REDOLADL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLADL,MXTRT                                                   
*                                                                               
         AHI   R2,REDOLDL          BUMP PAST RECORD                             
*                                                                               
RX$20180 DS    0H                                                               
         TM    PARM+4,X'20'        INCLUDE BUSINESS REPORTING?                  
         BZ    RX$20220            NO                                           
*                                                                               
         CLI   PENDFORE,C'X'       FOR X/4 BUCKETS LOOP AGAIN                   
         JNE   RX$20200             TO GET PENDING P/4 BUCKETS                  
*                                                                               
         CLI   PEND04,C'4'                                                      
         JNE   RX$20200                                                         
*                                                                               
         MVI   PENDFORE,C'P'                                                    
         J     RX$20040                                                         
*                                                                               
RX$20200 DS    0H                                                               
         CLI   PEND04,C'4'         REVERT TO X/4                                
         JNE   *+8                                                              
         MVI   PENDFORE,C'X'                                                    
*                                                                               
* INCLUDE BOOKED -- DISABLE TO KEEP DATA SMALLER                                
*                                                                               
****     BAS   RE,RXDOLBK                                                       
*                                                                               
* INCLUDE BOOKED THIS WEEK(CURRENT AND PRIOR)                                   
*                                                                               
***      BAS   RE,RXTWKDOL         CHECK FOR 'THIS WEEK' DOLLAR BUCKETS         
*                                                                               
RX$20220 DS    0H                                                               
*                                                                               
         J     EXITR2                                                           
         LTORG                                                                  
*                                                                               
***--->>>                                                                       
***--->>>                                                                       
*                                                                               
******************************************************************              
* RXDOL$$3 - GENERATE ROLLUP FIGURES FOR EACH MONTH OF SERVICE,  *              
*        RATHER THAN PUTTING OUT INDIVIDUAL BUCKETS.             *              
*        FULLFLAG = A SETS THIS ROUTINE.                         *              
*        THIS PRODUCES INVOICE  (BILLED) FIGURES                 *              
******************************************************************              
RXDOL$$3 NTR1  BASE=*,LABEL=*                                                   
         LA    R0,REDOLD           CLEAR THE RECORD                             
         LA    R1,REDOLDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LA    R7,BUCKDISP(R8)     SET R7 TO A(BUCKETS IN MONTH)                
*                                                                               
*   TEST                                                                        
**       CLC   =X'00815446',RCONKCON                                            
**       BNE   TEST$310                                                         
**       LA    RF,15                                                            
**       DC    H'0'                                                             
TEST$310 EQU   *                                                                
*   TEST END                                                                    
*                                                                               
         MVI   FULL,0              INITIALIZE RECORD SETTINGS                   
         MVI   FULL+1,C'C'                                                      
         CLI   PENDFORE,C'B'       BACK BILLING ORDER?                          
         JNE   RX$30020            NO                                           
         MVI   FULL+1,C'B'         YES - SET TO 'BACK BILLING'                  
RX$30020 EQU   *                                                                
         MVI   FULL+2,C'I'         SET TO 'INVOICE $$'                          
*                                                                               
         L     R6,CUASATIN(R7)                                                  
         TM    FLAG6(R8),X'01'                                                  
         JO    RX$30060            CURRENT INVOICED DOLLARS FOUND               
*                                                                               
         SR    R6,R6                                                            
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         JE    RX$30060            YES - BUILD ZERO DOLLAR RECORD               
         J     RX$30080            NO CURRENT DOLLARS                           
*                                                                               
RX$30040 DS    0H                                                               
         MVI   FULL,0              INITIALIZE RECORD SETTINGS                   
         MVC   FULL+1(1),PENDFORE                                               
         MVC   FULL+2(1),PEND04                                                 
*                                                                               
         L     R6,CURRFORC(R7)                                                  
         LTR   R6,R6                                                            
         JNZ   RX$30060            CURRENT FC/PEND DOLLARS FOUND                
*                                                                               
         SR    R6,R6                                                            
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         JE    RX$30060            YES - BUILD ZERO DOLLAR RECORD               
         J     RX$30080            NO CURRENT DOLLARS                           
*                                                                               
RX$30060 DS    0H                                                               
         LTR   R6,R6                                                            
         BZ    RX$30080                                                         
*                                                                               
         BRAS  RE,RXDOLSK          BUILD SKELETON                               
*                                                                               
***JRD   CLC   =X'07055818',RCONKCON                                            
***JRD   JNE   *+6                                                              
***JRD   DC    H'0'                                                             
*                                                                               
         EDIT  (R6),(12,REDOLDOL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLDOL,MXTRT                                                   
*                                                                               
         EDIT  (R6),(12,REDOLADL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLADL,MXTRT                                                   
*                                                                               
         AHI   R2,REDOLDL          BUMP PAST RECORD                             
*                                                                               
RX$30080 DS    0H                                                               
         CLI   PENDFORE,C'F'       FORECAST ORDER?                              
         JE    RX$30120            YES                                          
         CLI   PENDFORE,C'P'       PENDING  ORDER?                              
         JE    RX$30120            YES                                          
*                                                                               
         MVI   FULL,C'P'           INITIALIZE RECORD SETTINGS                   
         MVI   FULL+1,C'C'                                                      
         CLI   PENDFORE,C'B'       BACK BILLING ORDER?                          
         JNE   RX$30100            NO                                           
         MVI   FULL+1,C'B'         YES - SET TO 'BACK BILLING'                  
RX$30100 EQU   *                                                                
         MVI   FULL+2,C'I'                                                      
*                                                                               
         L     R4,PRTOTINV(R7)                                                  
         TM    FLAG6(R8),X'02'                                                  
         JO    RX$30110                                                         
         SR    R4,R4                                                            
RX$30110 EQU   *                                                                
*                                                                               
         L     R6,PRASATIN(R7)                                                  
         TM    FLAG6(R8),X'04'                                                  
         JO    RX$30140            PRIOR INVOICED DOLLARS FOUND                 
*                                                                               
*   NO RECORD IF NO PRIOR INVOICED FOUND                                        
*                                                                               
****>>>> LTR   R4,R4                                                            
****>>>> JNZ   RX$30140            PRIOR FINAL DOLLARS FOUND                    
*                                                                               
         SR    R6,R6                                                            
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         JE    RX$30140            YES - BUILD ZERO DOLLAR RECORD               
         J     RX$30180            NO PRIOR DOLLARS                             
*                                                                               
RX$30120 DS    0H                                                               
         MVI   FULL,C'P'           INITIALIZE RECORD                            
         MVC   FULL+1(1),PENDFORE                                               
         MVC   FULL+2(1),PEND04                                                 
*                                                                               
         SR    R4,R4                                                            
         ICM   R6,15,PRIOFORC(R7)                                               
         JNZ   RX$30140            CURRENT FC/PEND DOLLARS FOUND                
*                                                                               
         SR    R6,R6                                                            
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         JE    RX$30140            YES - BUILD ZERO DOLLAR RECORD               
         J     RX$30180            NO FC/PEND DOLLARS                           
*                                                                               
RX$30140 DS    0H                                                               
         LTR   R4,R4                                                            
         BNZ   RX$30160                                                         
*                                                                               
         LTR   R6,R6                                                            
         BZ    RX$30180                                                         
*                                                                               
RX$30160 DS    0H                                                               
         BRAS  RE,RXDOLSK          BUILD SKELETON                               
*                                                                               
         EDIT  (R6),(12,REDOLDOL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLDOL,MXTRT                                                   
*                                                                               
         EDIT  (R4),(12,REDOLADL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLADL,MXTRT                                                   
*                                                                               
         AHI   R2,REDOLDL          BUMP PAST RECORD                             
*                                                                               
RX$30180 DS    0H                                                               
         TM    PARM+4,X'20'        INCLUDE BUSINESS REPORTING?                  
         BZ    RX$30220            NO                                           
*                                                                               
         CLI   PENDFORE,C'X'       FOR X/4 BUCKETS LOOP AGAIN                   
         JNE   RX$30200             TO GET PENDING P/4 BUCKETS                  
*                                                                               
         CLI   PEND04,C'4'                                                      
         JNE   RX$30200                                                         
*                                                                               
         MVI   PENDFORE,C'P'                                                    
         J     RX$30040                                                         
*                                                                               
RX$30200 DS    0H                                                               
         CLI   PEND04,C'4'         REVERT TO X/4                                
         JNE   *+8                                                              
         MVI   PENDFORE,C'X'                                                    
*                                                                               
* INCLUDE BOOKED -- DISABLE TO KEEP DATA SMALLER                                
*                                                                               
***      BAS   RE,RXDOLBK                                                       
*                                                                               
* INCLUDE BOOKED THIS WEEK(CURRENT AND PRIOR)                                   
*                                                                               
***      BAS   RE,RXTWKDOL         CHECK FOR 'THIS WEEK' DOLLAR BUCKETS         
*                                                                               
RX$30220 DS    0H                                                               
*                                                                               
         J     EXITR2                                                           
         LTORG                                                                  
*                                                                               
***--->>>                                                                       
*---------------------------------------------------------------------*         
* BUILD DOL RECORD SKELETON                                                     
*  FULL BYTE-1 C'P' INDICATES BUILD FOR PRIOR YEAR                              
*            OTHERWISE BUILD FOR CURRENT YEAR                                   
*       BYTE-2 THE BUCKET TYPE FLAG                                             
*       BYTE-3 THE BUCKET SUBTYPE FLAG                                          
*  R8 POINTS TO THE ENTRY IN NEWMON FOR THIS MONTH                              
*                                                                               
*---------------------------------------------------------------------*         
RXDOLSK  NTR1  BASE=*,LABEL=*                                                   
         LA    R0,REDOLD           CLEAR THE RECORD                             
         LA    R1,REDOLDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REDOLLEN,REDOLLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REDOLLEN(2),=AL2(REDOLDL)                                        
         MVC   REDOLTYP,REPDOLQ                                                 
         MVI   REDOLACT-1,MXTRTQ                                                
         MVI   REDOLDAT-1,MXTRTQ                                                
         MVI   REDOLTME-1,MXTRTQ                                                
         MVI   REDOLDX,MXTRTQ                                                   
         MVI   REDOLDX+1,MXTRTQ                                                 
         MVI   REDOLREP-1,MXTRTQ                                                
         MVI   REDOLCON-1,MXTRTQ                                                
         MVI   REDOLFLG-1,MXTRTQ                                                
         MVI   REDOLMON-1,MXTRTQ                                                
         MVI   REDOLACD-1,MXTRTQ                                                
         MVI   REDOLDOL-1,MXTRTQ                                                
         MVI   REDOLADL-1,MXTRTQ                                                
         MVI   REDOLXRE-1,MXTRTQ                                                
         MVI   REDOLBTP-1,MXTRTQ                                                
         MVI   REDOLBTX-1,MXTRTQ                                                
         MVI   REDOLRTS-1,MXTRTQ                                                
         MVI   REDOLDEL-1,MXTRTQ                                                
*                                                                               
         MVI   REDOLFLG,C'A'       SET SPECIAL FLAG                             
         TR    REDOLFLG,MXTRT                                                   
*                                                                               
         MVC   REDOLBTP,FULL+1     SET BUCKET TYPE FLAG                         
         TR    REDOLBTP,MXTRT                                                   
*                                                                               
         MVC   REDOLBTX,FULL+2     SET BUCKET SUBTYPE                           
         TR    REDOLBTX,MXTRT                                                   
*                                                                               
***      MVC   REDOLRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REDOLRTS(14),=C'19000101000000'                                  
         TR    REDOLRTS,MXTRT                                                   
*                                                                               
         MVI   REDOLDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REDOLDEL,MXTRT                                                   
*                                                                               
X        USING RECOND,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REDOLACT,X.RECONACT                                              
         MVC   REDOLDAT,X.RECONDAT                                              
         MVC   REDOLTME,X.RECONTME                                              
         DROP  X                                                                
*                                                                               
         MVC   REDOLREP,RCONKREP   REPCODE                                      
         TR    REDOLREP,MXTRT                                                   
*                                                                               
         ZAP   WORK+200(5),=P'0'    CONTRACT NUMBER                             
         MVO   WORK+200(5),RCONKCON                                             
         EDIT  (P5,WORK+200),(8,REDOLCON),ALIGN=LEFT                            
         TR    REDOLCON,MXTRT                                                   
*                                                                               
*   IF THIS IS A PARTIAL KEY BUILD, THEN NO FURTHER FIELDS WILL                 
*        BE CONSTRUCTED FOR THIS RECORD                                         
*                                                                               
         CLI   HALF,1              PARTIAL BUILD FLAG SET?                      
         JE    EXIT                                                             
*                                                                               
         TM    RCONCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BNO   RXDSK008            NO                                           
         MVI   REDOLDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REDOLDEL,MXTRT                                                   
*                                                                               
*   TEST                                                                        
***>     LA    RF,1                                                             
***>     LNR   RF,RF                                                            
***>     DC    H'0'                                                             
*                                                                               
RXDSK008 DS    0H                                                               
*                                                                               
         MVI   REDOLXRE,C'N'                                                    
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'2F'        RER ELEMENT                                  
         BRAS  RE,GETEL                                                         
         JNE   RXDSK010                                                         
*                                                                               
         USING RCONRER,R6                                                       
         TM    RCONFRER,X'01'      EXCLUDE FROM RER?                            
         BZ    RXDSK010                                                         
         DROP  R6                                                               
*                                                                               
         MVI   REDOLXRE,C'Y'                                                    
*                                                                               
RXDSK010 DS    0H                                                               
         TR    REDOLXRE,MXTRT                                                   
*                                                                               
         MVC   REDOLDOL,FOXZERO2   CLEAR THE MONEY                              
         TR    REDOLDOL,MXTRT                                                   
*                                                                               
* BUCKET DATES                                                                  
*                                                                               
*&&DO                                                                           
         CLC   =X'00502443',RCONKCON                                            
         JNE   *+6                                                              
         DC    H'0'                                                             
*&&                                                                             
         CLI   FULLFLAG,C'A'       AGGREGATE EST/INV?                           
         BE    RXDSK020            YES                                          
         L     R8,ABUCKET          SET A(BUCKET IN PROGRESS)                    
         MVC   WORK(2),2(R8)       EXTRACT MONTH OF SERVICE                     
         MVI   WORK+2,1            SET DAY IN MONTH                             
*                                  SET ACTIVITY DATE                            
         GOTO1 DATCON,PLIST,(2,4(R8)),(10,REDOLACD)                             
*                                                                               
         GOTO1 DATCON,PLIST,(3,WORK),(10,REDOLMON)                              
         B     RXDSK040                                                         
*                                                                               
RXDSK020 EQU   *                                                                
*                                                                               
         MVC   WORK(6),0(R8)                                                    
*                                                                               
         GOTO1 DATCON,PLIST,(2,QWMONFOR+QWCASATF),(10,REDOLACD)                 
*                                                                               
         CLI   FULL,C'P'           BUILD FOR PRIOR YEAR?                        
         JNE   RXDSK030            NO                                           
*                                                                               
         GOTO1 VADDAY,PLIST,(C'Y',WORK),(0,WORK),-1                             
         GOTO1 DATCON,PLIST,(2,QWMONFOR+QWPASATF),(10,REDOLACD)                 
*                                                                               
RXDSK030 DS    0H                                                               
         GOTO1 DATCON,PLIST,(0,WORK),(10,REDOLMON)                              
RXDSK040 DS    0H                                                               
         TR    REDOLMON,MXTRT                                                   
         TR    REDOLACD,MXTRT                                                   
*                                                                               
         LR    RE,R2               CLEAR NEXT RECORD FOR SAFTEY                 
         AHI   RE,REDOLDL                                                       
         XC    0(8,RE),0(RE)                                                    
         J     EXIT                                                             
FOXZERO2 DC    C'000000000000'                                                  
*---------------------------------------------------------------------*         
* BUILD CONTRACT BOOKED BUCKET RECORD                                           
*  R8 POINTS TO THE ENTRY IN NEWMON FOR THIS MONTH                              
*---------------------------------------------------------------------*         
RXDOLBK  NTR1  BASE=*,LABEL=*                                                   
         LA    R7,BUCKDISP(R8)     SET R7 TO A(BUCKETS IN MONTH)                
*                                                                               
         ICM   R6,15,TOTORD(R7)                                                 
         JZ    RXDBK020            NO CURRENT BOOKED DOLLARS FOUND              
*                                                                               
         OC    0(8,R2),0(R2)       VALID RECORD?                                
         BZ    *+8                 NO                                           
         AHI   R2,REDOLDL                                                       
*                                                                               
         MVI   FULL,0              INITIALIZE RECORD                            
         MVI   FULL+1,C'C'                                                      
         CLI   PENDFORE,C'B'       BACK BILLING ORDER?                          
         BNE   RXDBK010                                                         
         MVI   FULL+1,C'B'         SET TO 'BACK BILLING'                        
RXDBK010 DS    0H                                                               
         MVI   FULL+2,C'B'                                                      
         BRAS  RE,RXDOLSK                                                       
*                                                                               
         EDIT  (R6),(12,REDOLDOL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLDOL,MXTRT                                                   
*                                                                               
         EDIT  (R6),(12,REDOLADL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLADL,MXTRT                                                   
*                                                                               
         AHI   R2,REDOLDL                                                       
*                                                                               
RXDBK020 DS    0H                                                               
         L     R4,PRTOTORD(R7)                                                  
         ICM   R6,15,PRASATOR(R7)                                               
         JNZ   RXDBK022            PRIOR BOOKED DOLLARS FOUND                   
*                                                                               
         LTR   R4,R4                                                            
         JZ    RXDBK030            NO PROIR TOTAL BOOKED FOUND                  
*                                                                               
RXDBK022 DS    0H                                                               
         OC    0(8,R2),0(R2)       VALID RECORD?                                
         BZ    *+8                 NO                                           
         AHI   R2,REDOLDL                                                       
*                                                                               
         MVI   FULL,C'P'           INITIALIZE RECORD                            
         MVI   FULL+1,C'C'                                                      
         CLI   PENDFORE,C'B'       BACK BILLING ORDER?                          
         BNE   RXDBK025                                                         
         MVI   FULL+1,C'B'         SET TO 'BACK BILLING'                        
RXDBK025 DS    0H                                                               
         MVI   FULL+2,C'B'                                                      
         BRAS  RE,RXDOLSK                                                       
*                                                                               
         EDIT  (R6),(12,REDOLDOL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLDOL,MXTRT                                                   
*                                                                               
         EDIT  (R4),(12,REDOLADL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLADL,MXTRT                                                   
*                                                                               
RXDBK030 DS    0H                                                               
         LTR   R6,R6               DOLLARS?                                     
         JNZ   RXDBK032            YES                                          
         LTR   R4,R4                                                            
         JNZ   RXDBK032            YES                                          
*                                                                               
         XC    0(8,R2),0(R2)       NO - CLEAR RECORD                            
*                                                                               
RXDBK032 DS    0H                                                               
         J     EXITR2                                                           
***>>>THISWEEKDOLS<<<***                                                        
*---------------------------------------------------------------------*         
* BUILD CONTRACT THIS WEEK DOLLAR BUCKET RECORD                                 
*  R8 POINTS TO THE ENTRY IN NEWMON FOR THIS MONTH                              
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXTWKDOL NTR1  BASE=*,LABEL=*                                                   
         CLI   PENDFORE,C'F'       FORECAST ORDER?                              
         JE    RXTWK200            YES - NO 'THIS WEEK'                         
         CLI   PENDFORE,C'P'       PENDING  ORDER?                              
         JE    RXTWK200            YES - NO 'THIS WEEK'                         
*                                                                               
         OC    0(8,R2),0(R2)       POINTING TO VALID RECORD?                    
         BZ    *+8                 NO                                           
         AHI   R2,REDOLDL                                                       
*                                                                               
         MVI   FULL,0              INITIALIZE RECORD                            
         MVI   FULL+1,C'Z'                                                      
         CLI   PENDFORE,C'B'       BACK BILLING ORDER?                          
         JNE   RXTWK000            NO  -                                        
         MVI   FULL+1,C'B'         SET TO 'BACK BILLING'                        
RXTWK000 DS    0H                                                               
         MVI   FULL+2,C'C'         SET TO 'CHANGED THIS WEEK'                   
         CLI   THWKNEW,C'P'        NEW PRIOR YEAR?                              
         JNE   RXTWK001            NO                                           
         MVI   FULL+2,C'N'         SET TO 'NEW     THIS WEEK'                   
         J     RXTWK002            SET - LEAVE IT                               
RXTWK001 DS    0H                                                               
         CLI   THWKNEW,C'N'        NEW THIS  YEAR?                              
         JNE   RXTWK002            NO                                           
         MVI   FULL+2,C'N'         SET TO 'NEW     THIS WEEK'                   
RXTWK002 DS    0H                                                               
         BRAS  RE,RXDOLSK                                                       
*                                                                               
         LA    R7,BUCKDISP(R8)     SET R7 TO A(BUCKETS IN MONTH)                
*&&DO                                                                           
         CLC   =X'07457586',RCONKCON                                            
         JNE   *+6                                                              
         DC    H'0'                                                             
*&&                                                                             
         ICM   R6,15,THISWKOR(R7)  LOAD THIS WEEK ORDERED $$                    
         JNZ   RXTWK005            THIS WEEK ORDERED DOLLARS FOUND              
*                                                                               
         SR    R6,R6                                                            
         J     RXTWK009            NO THIS WEEK ORDERED DOLLARS                 
*                                                                               
RXTWK005 DS    0H                                                               
         EDIT  (R6),(12,REDOLDOL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLDOL,MXTRT                                                   
*                                                                               
         EDIT  (R6),(12,REDOLADL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLADL,MXTRT                                                   
*                                                                               
RXTWK009 DS    0H                                                               
         LTR   R6,R6               DATA?                                        
         JZ    *+8                 NO                                           
         AHI   R2,REDOLDL                                                       
*                                                                               
         MVI   FULL,C'P'           INITIALIZE RECORD                            
         MVI   FULL+1,C'Z'                                                      
         CLI   PENDFORE,C'B'       BACK BILLING ORDER?                          
         JNE   RXTWK010            NO  -                                        
         MVI   FULL+1,C'B'         SET TO 'BACK BILLING'                        
RXTWK010 DS    0H                                                               
         MVI   FULL+2,C'C'         SET TO 'CHANGED THIS WEEK'                   
         CLI   THWKNEW,C'P'        NEW PRIOR YEAR?                              
         JNE   RXTWK011            NO                                           
         MVI   FULL+2,C'N'         SET TO 'NEW     THIS WEEK'                   
         J     RXTWK012            SET - LEAVE IT                               
RXTWK011 DS    0H                                                               
         CLI   THWKNEW,C'N'        NEW THIS  YEAR?                              
         JNE   RXTWK012            NO                                           
         MVI   FULL+2,C'N'         SET TO 'NEW     THIS WEEK'                   
RXTWK012 DS    0H                                                               
         BRAS  RE,RXDOLSK                                                       
*                                                                               
         ICM   R6,15,THPRWKOR(R7)                                               
         JNZ   RXTWK022            PRIOR THIS WEEK DOLLARS FOUND                
*                                                                               
         SR    R6,R6                                                            
         B     RXTWK022                                                         
*                                                                               
RXTWK022 DS    0H                                                               
         EDIT  (R6),(12,REDOLDOL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLDOL,MXTRT                                                   
*                                                                               
         EDIT  (R6),(12,REDOLADL),ZERO=NOBLANK,FILL=0,FLOAT=-                   
         TR    REDOLDOL,MXTRT                                                   
*                                                                               
         LTR   R6,R6               DATA?                                        
         BNZ   RXTWK100            YES                                          
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXTWK100            YES                                          
*                                                                               
         XC    0(8,R2),0(R2)                                                    
*                                                                               
RXTWK100 DS    0H                                                               
*                                                                               
RXTWK200 DS    0H                                                               
         J     EXITR2                                                           
         LTORG                                                                  
         DROP  R2,R9                                                            
*                                                                               
***>>>THISWEEKDOLS<<<***                                                        
*                                                                               
*---------------------------------------------------------------------*         
* BUILD CONTRACT HEADER RECORD                                        *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXDOLCON NTR1  BASE=*,LABEL=*                                                   
         USING RECOND,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,RECOND           CLEAR THE RECORD                             
         LA    R1,RECONDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RECONLEN,RECONLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RECONLEN(2),=AL2(RECONDL)                                        
         MVC   RECONTYP,REPCONQ                                                 
         MVI   RECONACT-1,MXTRTQ                                                
         MVI   RECONDAT-1,MXTRTQ                                                
         MVI   RECONTME-1,MXTRTQ                                                
         MVI   RECONDX,MXTRTQ                                                   
         MVI   RECONDX+1,MXTRTQ                                                 
         MVI   RECONREP-1,MXTRTQ                                                
         MVI   RECONCON-1,MXTRTQ                                                
         MVI   RECONSTA-1,MXTRTQ                                                
         MVI   RECONSAL-1,MXTRTQ                                                
         MVI   RECONOFF-1,MXTRTQ                                                
         MVI   RECONTEM-1,MXTRTQ                                                
         MVI   RECONADV-1,MXTRTQ                                                
         MVI   RECONAGY-1,MXTRTQ                                                
         MVI   RECONCTY-1,MXTRTQ                                                
         MVI   RECONDEV-1,MXTRTQ                                                
         MVI   RECONDSP-1,MXTRTQ                                                
         MVI   RECONPRC-1,MXTRTQ                                                
         MVI   RECONPRT-1,MXTRTQ                                                
         MVI   RECONDEM-1,MXTRTQ                                                
         MVI   RECONFLS-1,MXTRTQ                                                
         MVI   RECONFLE-1,MXTRTQ                                                
         MVI   RECONMAS-1,MXTRTQ                                                
         MVI   RECONXRE-1,MXTRTQ                                                
         MVI   RECONCTP-1,MXTRTQ                                                
         MVI   RECONCLI-1,MXTRTQ                                                
         MVI   RECONPRD-1,MXTRTQ                                                
         MVI   RECONEST-1,MXTRTQ                                                
         MVI   RECONCRE-1,MXTRTQ                                                
         MVI   RECONBLD-1,MXTRTQ                                                
         MVI   RECONMOD-1,MXTRTQ                                                
         MVI   RECONVER-1,MXTRTQ                                                
         MVI   RECONWIP-1,MXTRTQ                                                
         MVI   RECONLSB-1,MXTRTQ                                                
         MVI   RECONSTT-1,MXTRTQ                                                
         MVI   RECONDLS-1,MXTRTQ                                                
         MVI   RECONTRF-1,MXTRTQ                                                
         MVI   RECONOTP-1,MXTRTQ                                                
         MVI   RECONBYR-1,MXTRTQ                                                
         MVI   RECONSHR-1,MXTRTQ                                                
         MVI   RECONMBD-1,MXTRTQ                                                
         MVI   RECONSSG-1,MXTRTQ                                                
         MVI   RECONDLE-1,MXTRTQ                                                
         MVI   RECONPMG-1,MXTRTQ                                                
         MVI   RECONLSF-1,MXTRTQ                                                
         MVI   RECONLS$-1,MXTRTQ                                                
         MVI   RECONEDT-1,MXTRTQ                                                
         MVI   RECONETM-1,MXTRTQ                                                
         MVI   RECONTAD-1,MXTRTQ                                                
         MVI   RECONSAD-1,MXTRTQ                                                
         MVI   RECONSED-1,MXTRTQ                                                
         MVI   RECONTXT-1,MXTRTQ                                                
         MVI   RECONMON-1,MXTRTQ                                                
         MVI   RECONPAD-1,MXTRTQ                                                
         MVI   RECONPR2-1,MXTRTQ                                                
         MVI   RECONRTS-1,MXTRTQ                                                
         MVI   RECONDEL-1,MXTRTQ                                                
*                                                                               
B        USING RECOND,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RECONACT,B.RECONACT                                              
         MVC   RECONDAT,B.RECONDAT                                              
         MVC   RECONTME,B.RECONTME                                              
         DROP  B                                                                
*                                                                               
*   TRUE FORECAST ORDERS HAVE BEEN DROPPED IN RXTRACT MODULE.                   
*                                                                               
         BRAS  RE,SETPNDFC         CHECK FOR PEND/FC                            
*                                                                               
         MVC   RECONREP,RCONKREP   REPCODE                                      
         TR    RECONREP,MXTRT                                                   
         ZAP   WORK+20(5),=P'0'    CONTRACT NUMBER                              
         MVO   WORK+20(5),RCONKCON                                              
         EDIT  (P5,WORK+20),(8,RECONCON),ALIGN=LEFT                             
         TR    RECONCON,MXTRT                                                   
         MVC   RECONSTA,RCONKSTA   STATION                                      
         TR    RECONSTA,MXTRT                                                   
         MVC   RECONSAL,RCONSAL    SALESPERSON                                  
         TR    RECONSAL,MXTRT                                                   
         MVC   RECONOFF,RCONKOFF   OFFICE                                       
         TR    RECONOFF,MXTRT                                                   
         MVC   RECONTEM,RCONTEM    TEAM                                         
         TR    RECONTEM,MXTRT                                                   
         MVC   RECONADV,RCONKADV   ADVERTISER                                   
         TR    RECONADV,MXTRT                                                   
         MVC   RECONAGY,RCONKAGY   AGENCY/OFFICE                                
         TR    RECONAGY,MXTRT                                                   
         MVC   RECONCTY,RCONTYPE   CON TYPE                                     
         TR    RECONCTY,MXTRT                                                   
         MVC   RECONBYR,RCONBUYR   BUYER NAME                                   
         TR    RECONBYR,MXTRT                                                   
****     MVC   RECONBLD,SPACES                                                  
         OC    RECONBLD,RECONBLD   CLEAR TO BINARY ZERO                         
*                                                                               
*   TIMESTAMP FOR CONTRACT RECORD:                                              
*        R2 -> INITIALIZED EXTRACT RECORD                                       
*        R3 -> CONTRACT RECORD IN IO AREA                                       
*            > IF UPDATE, THIS RECORD IS PRECEDED BY RECOVERY                   
*              HEADER, FROM WHICH DATE/TIME MAY BE TAKEN                        
*                                                                               
         GOTO1 =A(CONSTAMP),DMCB,(R2),(R3)                                      
*                                                                               
         TM    RCONMODR,X'10'      BUYLINE ADDED TO THIS ORDER?                 
         BNO   RDCON002            NO  - NO DATE                                
         GOTO1 DATCON,DMCB,(3,RCONCREA),(10,RECONBLD)                           
RDCON002 EQU   *                                                                
         TR    RECONBLD,MXTRT                                                   
         MVI   RECONMON,C'N'       SET 'NOT MON ORDER'                          
         TM    RCONMODR+1,X'20'    MON ORDER INDICATOR SET?                     
         BNO   RDCON003            NO  - NO DATE                                
         MVI   RECONMON,C'Y'       SET 'MON ORDER'                              
RDCON003 EQU   *                                                                
         TR    RECONMON,MXTRT                                                   
*                                  INSERT DATA 1ST BUYLINE ADDED                
         GOTO1 DATCON,DMCB,(3,RCONHDRD),(10,RECONCRE)                           
         TR    RECONCRE,MXTRT                                                   
*                                  INSERT DATA 1ST BUYLINE ADDED                
*                                                                               
         MVC   RECONMOD,=C'00-1'                                                
         CLI   RCONMOD,X'FF'                                                    
         BE    RDCON005                                                         
         EDIT  RCONMOD,(4,RECONMOD),FILL=0                                      
*                                  INSERT MOD #                                 
RDCON005 EQU   *                                                                
         TR    RECONMOD,MXTRT                                                   
***      MVC   RECONRTS,SPACES     DEFAULT REFRESHTS                            
         MVC   RECONRTS(14),=C'19000101000000'                                  
         TR    RECONRTS,MXTRT                                                   
         MVI   RECONDEL,C' '       DELETE FLAG DEFAULT                          
*                                                                               
         TM    RCONCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BNO   RXCON008            NO                                           
         MVI   RECONDEL,C'D'       SET 'DELETED' INDICATOR                      
*                                                                               
*   TEST                                                                        
         LA    RF,2                                                             
         LNR   RF,RF                                                            
***>     DC    H'0'                                                             
*                                                                               
RXCON008 EQU   *                                                                
         TR    RECONDEL,MXTRT                                                   
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'18'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RDCON010                                                         
*                                                                               
         USING RCONDVEL,R6                                                      
         MVC   RECONDEV,RCONDVCT   DEV TYPE                                     
         MVC   RECONDSP,RCONDVSP   DEV SALESPERSON                              
         DROP  R6                                                               
*                                                                               
RDCON010 DS    0H                                                               
         TR    RECONDEV,MXTRT                                                   
         TR    RECONDSP,MXTRT                                                   
*                                                                               
         CLC   RCONPRD,SPACES                                                   
         JNH   RDCON012                                                         
*                                                                               
         MVC   RECONPRC,RCONPRD    PRODUCT CODE                                 
         J     RDCON020                                                         
*                                                                               
RDCON012 DS    0H                                                               
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'05'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RDCON020                                                         
*                                                                               
         USING RCONEXEL,R6                                                      
         MVC   RECONPRT,RCONEXPR   PRODUCT TEXT                                 
         DROP  R6                                                               
*                                                                               
RDCON020 DS    0H                                                               
         TR    RECONPRC,MXTRT                                                   
         TR    RECONPRT,MXTRT                                                   
*                                                                               
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'12'        SAR                                          
         BRAS  RE,GETEL                                                         
         JNE   RDCON022                                                         
*                                                                               
         USING RSARXEL,R6                                                       
         LA    RE,RSARXDEM                                                      
         LA    R0,8                                                             
         MVI   WORK+3,C'T'                                                      
         J     RDCON030                                                         
         DROP  R6                                                               
*                                                                               
RDCON022 DS    0H                                                               
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'10'        BOP                                          
         BRAS  RE,GETEL                                                         
         JNE   RDCON040                                                         
*                                                                               
         USING RCONBPEL,R6                                                      
         CLI   RCONBPDM,X'FF'                                                   
         JNE   RDCON040            SKIP OLD FORMAT DEMOS                        
*                                                                               
         LA    RE,RCONBPDM+1                                                    
         LA    R0,6                                                             
         MVI   WORK+3,C'R'                                                      
         DROP  R6                                                               
*                                                                               
RDCON030 DS    0H                                                               
         XC    WORK,WORK                                                        
         MVC   WORK(3),0(RE)                                                    
RDCON032 DS    0H                                                               
         CLI   0(RE),0     SET AS PRIMARY?                                      
         JE    *+14                                                             
         MVC   WORK(3),0(RE)                                                    
         J     *+12                                                             
         LA    RE,3(RE)                                                         
         BRCT  R0,RDCON032                                                      
*                                                                               
         OC    WORK(3),WORK                                                     
         BZ    RDCON040                                                         
*                                                                               
         MVI   WORK,0               FUDGE FOR DEMOCON                           
         CLI   WORK+1,C'T'                                                      
         JNE   *+8                                                              
         MVI   WORK+1,C'I'                                                      
*                                                                               
         LA    R6,WORK+10                                                       
         USING DBLOCK,R6                                                        
         XC    DBLOCK,DBLOCK                                                    
         MVC   DBFILE,=C'INV'                                                   
         MVC   DBCOMFCS,COMFACS                                                 
         MVC   DBSELMED,WORK+3                                                  
         DROP  R6                                                               
*                                                                               
         GOTO1 DEMOCON,PLIST,(1,WORK),(9,RECONDEM),(0,WORK+10)                  
*                                                                               
RDCON040 DS    0H                                                               
         TR    RECONDEM,MXTRT                                                   
*                                                                               
         GOTO1 DATCON,PLIST,(3,RCONDATE),(10,RECONFLS)                          
***      XC    RECONFLS(2),RECONFLS+3 SWAP MM AND DD ABOUT                      
***      XC    RECONFLS+3(2),RECONFLS                                           
***      XC    RECONFLS(2),RECONFLS+3                                           
         TR    RECONFLS,MXTRT                                                   
*                                                                               
         GOTO1 DATCON,PLIST,(3,RCONDATE+3),(10,RECONFLE)                        
***      XC    RECONFLE(2),RECONFLE+3 SWAP MM AND DD ABOUT                      
***      XC    RECONFLE+3(2),RECONFLE                                           
***      XC    RECONFLE(2),RECONFLE+3                                           
         TR    RECONFLE,MXTRT                                                   
*                                                                               
         MVI   RECONXRE,C'N'                                                    
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'2F'        RER ELEMENT                                  
         BRAS  RE,GETEL                                                         
         JNE   RDCON050                                                         
*                                                                               
         USING RCONRER,R6                                                       
         TM    RCONFRER,X'01'      EXCLUDE FROM RER?                            
         BZ    RDCON050                                                         
         DROP  R6                                                               
*                                                                               
         MVI   RECONXRE,C'Y'                                                    
*                                                                               
RDCON050 DS    0H                                                               
         TR    RECONXRE,MXTRT                                                   
*                                                                               
         XC    RECONCLI,RECONCLI   SET THREE FIELDS TO BIN ZERO                 
         XC    RECONPRD,RECONPRD                                                
         XC    RECONPR2,RECONPR2                                                
         XC    RECONEST,RECONEST                                                
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'A2'        EASI CODE ELEMENT                            
         BRAS  RE,GETEL                                                         
         JNE   RDCON120            NOT FOUND                                    
*                                                                               
         USING RCONIEL,R6                                                       
         MVC   RECONCLI,RCONIADV   SET EI ADVERTISER                            
         MVC   RECONPRD,RCONIPRD   SET EI PRODUCT                               
         MVC   RECONPR2,RCONIPR2   SET EI PRODUCT 2                             
         CLC   RCONIEST,SPACES     OLD EST # PRESENT?                           
         BNH   RDCON060            NO  - CHECK NEW NUMBER                       
         MVC   RECONEST(4),RCONIEST                                             
         B     RDCON070                                                         
RDCON060 EQU   *                                                                
         MVC   RECONEST(10),RCONXEST                                            
*                                  INSERT NEW FORMAT EST #                      
RDCON070 EQU   *                                                                
         OC    RECONCLI,SPACES     OR IN SPACES                                 
         CLC   RECONCLI,SPACES     ANY VALUE HERE?                              
         BH    RDCON080            YES - LEAVE AS IS                            
         XC    RECONCLI,RECONCLI   NO  - CLEAR TO BIN ZERO                      
RDCON080 EQU   *                                                                
         OC    RECONPRD,SPACES     OR IN SPACES                                 
         CLC   RECONPRD,SPACES     ANY VALUE HERE?                              
         BH    RDCON085            YES - LEAVE AS IS                            
         XC    RECONPRD,RECONPRD   NO  - CLEAR TO BIN ZERO                      
RDCON085 EQU   *                                                                
         OC    RECONPR2,SPACES     OR IN SPACES                                 
         CLC   RECONPR2,SPACES     ANY VALUE HERE?                              
         BH    RDCON090            YES - LEAVE AS IS                            
         XC    RECONPR2,RECONPR2   NO  - CLEAR TO BIN ZERO                      
RDCON090 EQU   *                                                                
         OC    RECONEST,SPACES     OR IN SPACES                                 
         CLC   RECONEST,SPACES     ANY VALUE HERE?                              
         BH    RDCON100            YES - LEAVE AS IS                            
         XC    RECONEST,RECONEST   NO  - CLEAR TO BIN ZERO                      
RDCON100 EQU   *                                                                
         DROP  R6                                                               
*                                                                               
RDCON120 DS    0H                                                               
         TR    RECONCLI,MXTRT                                                   
         TR    RECONPRD,MXTRT                                                   
         TR    RECONPR2,MXTRT                                                   
         TR    RECONEST,MXTRT                                                   
*                                                                               
         MVC   RECONCTP,PENDFORE   SET PENDING/FORECAST/BB FLAG                 
         TR    RECONCTP,MXTRT                                                   
*&&DO                                                                           
         LA    RF,15                                                            
         CLI   PENDFORE,C' '                                                    
         JNH   EXIT                                                             
         DC    H'0'                                                             
*&&                                                                             
         XC    RECONTRF,RECONTRF                                                
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'1F'        EXTENDED DESCRIPT ELT                        
         BRAS  RE,GETEL                                                         
         JNE   RDCON140                                                         
*                                                                               
         USING RCONXEL,R6                                                       
         MVC   RECONTRF,RCONTRF    SET ORDER TRAFFIC NUMBER                     
RDCON140 EQU   *                                                                
         OC    RECONTRF,SPACES                                                  
         TR    RECONTRF,MXTRT                                                   
*                                                                               
         DROP  R6                                                               
         MVC   RECONVER,FOXZERO3   INITIALIZE TO ZEROS                          
         MVI   RECONWIP,C'N'       SET 'NOT WIP'                                
         MVI   RECONLSB,C' '       SET LAST SENT BY TO 'NOT SENT'               
         MVI   RECONSTT,C'N'       SET STATUS TO UNCONFIRMED                    
         MVC   RECONDLS,SPACES     SET DATE LAST SENT                           
*                                                                               
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'1F'        EXTENDED DESCRIPTION ELEMENT                 
         BRAS  RE,GETEL                                                         
         JNE   RDCON148            NOT FOUND                                    
*                                                                               
XX       USING RCONXEL,R6                                                       
         TM    XX.RCONCONF,X'40'  CONFIRMED NOW?                                
         BNO   RDCON148            NO  -                                        
*                                                                               
         DROP  XX                                                               
*                                                                               
*   ORDER IS CONFIRMED.  A BINARY SEARCH FOR A CONFIRM COMMENT                  
*        RECORD WAS DONE IN RXTRACT BASE.  A VALUE WAS PASSED                   
*        IN THE P-LIST AS PART OF P6.  THAT VALUE IS INSERTED                   
*        AT THIS POINT.                                                         
*                                  CHECK 'CONFIRMED' OR 'PARTIAL'               
*                                                                               
         L     RF,PARM+PARM6       LOAD A(ARGBLOCK) FROM RXTRACT                
         USING ARGDSECT,RF                                                      
*                                                                               
         MVC   RECONSTT,CONFPART   SET RESULT FROM PASS-IN                      
         DROP  RF                                                               
*                                                                               
RDCON148 EQU   *                                                                
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'20'        SEND INFO ELEMENT                            
         BRAS  RE,GETEL                                                         
         JNE   RDCON170            NOT FOUND                                    
*                                                                               
         USING RCONSEND,R6                                                      
         EDIT  RCONSRV,(4,RECONVER),FILL=0                                      
*                                  SET VERSION TO 'REP VER #'                   
         CLC   RCONSRV,RCONSSV     REP VER# >= STA VER#?                        
         BNL   RDCON149            YES                                          
         EDIT  RCONSSV,(4,RECONVER),FILL=0                                      
*                                  NO - SET VERSION TO 'STA VER #'              
RDCON149 EQU   *                                                                
         TM    RCONSENF,X'80'      LAST SENT BY REP?                            
         BNO   RDCON150            NO  - CHECK LAST SENT BY STATION             
         GOTO1 DATCON,DMCB,(2,RCONSRDT),(10,RECONDLS)                           
*                                  YES - INSERT 'DATE REP SENT ORDER'           
         MVI   RECONLSB,C'R'       SET TO 'R'                                   
         J     RDCON160                                                         
RDCON150 EQU   *                                                                
         TM    RCONSENF,X'40'      LAST SENT BY STATION?                        
         BNO   RDCON160            NO  - NOT SENT BY EITHER                     
         GOTO1 DATCON,DMCB,(2,RCONSSDT),(10,RECONDLS)                           
*                                  YES - INSERT 'DATE STA SENT ORDER'           
         MVI   RECONLSB,C'S'       SET TO 'S'                                   
RDCON160 EQU   *                                                                
         TM    RCONSENF,X'10'+X'20'                                             
*                                  CONTRACT IN WIP STATUS?                      
         BO    RDCON170            NO                                           
         MVI   RECONWIP,C'Y'       SET 'WIP'                                    
         DROP  R6                                                               
RDCON170 EQU   *                                                                
         TR    RECONLSB,MXTRT                                                   
         TR    RECONSTT,MXTRT                                                   
         TR    RECONDLS,MXTRT                                                   
         TR    RECONVER,MXTRT                                                   
         TR    RECONWIP,MXTRT                                                   
*                                                                               
RDCON180 EQU   *                                                                
         MVI   RECONOTP,C'M'       SET ORDER TYPE TO 'MANUAL'                   
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'1D'        DARE ELEMENT                                 
         BRAS  RE,GETEL                                                         
         JNE   RDCON200            NOT FOUND                                    
*                                                                               
         MVI   RECONOTP,C'D'       SET ORDER TYPE TO 'DARE'                     
         USING RCONDREL,R6                                                      
         TM    RCONDRF2,X'01'      LINKED TO XML ORDER?                         
         BNO   RDCON200            NO  - LEAVE AS 'DARE'                        
         MVI   RECONOTP,C'X'       SET ORDER TYPE TO 'XML'                      
         DROP  R6                                                               
RDCON200 EQU   *                                                                
         TR    RECONOTP,MXTRT                                                   
*                                                                               
         MVC   RECONDLE,SPACES     CLEAR 'DATE LAST EC'D'                       
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'15'        EC CONTROL ELEMENT                           
         BRAS  RE,GETEL                                                         
         JNE   RDCON210            NOT FOUND                                    
         USING RCONECEL,R6                                                      
         GOTO1 DATCON,DMCB,(2,RCONECDT),(10,RECONDLE)                           
*                                  INSERT 'DATE LAST EC'D'                      
*                                                                               
         DROP  R6                                                               
*                                                                               
RDCON210 EQU   *                                                                
         TR    RECONDLE,MXTRT                                                   
*                                                                               
         MVI   RECONPMG,C'N'       SET 'NO MAKEGOODS OFFERED'                   
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'21'        EC CONTROL ELEMENT                           
         BRAS  RE,GETEL                                                         
         JNE   RDCON212            NOT FOUND                                    
         USING RCONMGEL,R6                                                      
         TM    RCONMGCT,X'80'      MAKEGOODS OFFERED?                           
         BNO   RDCON212            NO                                           
         MVI   RECONPMG,C'Y'       SET 'MAKEGOODS OFFERED'                      
*                                                                               
         DROP  R6                                                               
*                                                                               
RDCON212 EQU   *                                                                
         TR    RECONPMG,MXTRT                                                   
*                                                                               
*   COMPETITIVE STATION SHARE:                                                  
*                                                                               
         MVC   RECONSHR,SPACES     INITIALIZE TO SPACES: MUST BE                
*                                     NULL IF NOT FOUND                         
*                                                                               
*   CHECK FOR LOSS FLAG SETTING: INITIALIZE 'LOSS' SETTINGS TO NO               
*                                                                               
         MVI   RECONLSF,C'N'       SET LOSS = NO                                
         MVC   RECONLS$,FOXZERO3                                                
*                                                                               
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'06'        SPL ELEMENT                                  
         BRAS  RE,GETEL                                                         
         JNE   RDCON220            NOT FOUND                                    
         USING RCONSPEL,R6                                                      
         TM    RCONSPES,X'40'      REP'D STA $$ = ZERO??                        
         BNO   RDCON217            NO                                           
*                                                                               
*   CHECK FOR ALL SPL AMOUNTS AS ZERO: THIS IS A FALSE LOSS.                    
*                                                                               
         CLI   RCONSPNU,0          ANY MINI ELTS?                               
         BE    RDCON217            NO  - CAN'T BE A LOSS                        
         ZIC   RF,RCONSPNU                                                      
         LA    RE,RCONSPST         SET A(FIRST MINI ELT)                        
RDCON214 EQU   *                                                                
         OC    5(4,RE),5(RE)       ANY $$ IN MINI-ELEMENT?                      
         BNZ   RDCON216            YES - NOT A FALSE LOSS                       
         LA    RE,9(RE)            BUMP TO NEXT MINI ELT                        
         BCT   RF,RDCON214         GO BACK FOR NEXT                             
*        B     RDCON217            NO DOLLARS/PERCENT: FALSE LOSS               
*                                                                               
* IF MARKET CANCEL (ALL ZEROES), SET ISLOSS TO TRUE                             
*                                                                               
RDCON216 EQU   *                                                                
         MVI   RECONLSF,C'Y'       SET LOSS = YES                               
RDCON217 EQU   *                                                                
         OC    RCONSPYR,RCONSPYR   SPL ENTRY DATE?                              
         BZ    RDCON218            NO                                           
         GOTO1 DATCON,DMCB,(2,RCONSPYR),(10,RECONSED)                           
RDCON218 EQU   *                                                                
         OC    RCONSPDT,RCONSPDT   SPL ACTIVITY DATE?                           
         BZ    RDCON219            NO                                           
         GOTO1 DATCON,DMCB,(3,RCONSPDT),(10,RECONSAD)                           
*                                                                               
*                                                                               
RDCON219 EQU   *                                                                
         CLI   RCONSPNU,0          NO MINI ELEMENTS?                            
         BE    RDCON220            YES - NO ELEMENTS                            
         EDIT  RCONSPAM,(5,RECONSHR),FILL=0                                     
*                                                                               
         DROP  R6                                                               
*                                                                               
RDCON220 EQU   *                                                                
         TR    RECONSAD,MXTRT                                                   
         TR    RECONSED,MXTRT                                                   
                                                                                
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'08'        TRUE ACTIVITY ELEMENT                        
         BRAS  RE,GETEL                                                         
         JNE   RDCON225            NOT FOUND                                    
         USING RCONACEL,R6                                                      
*                                                                               
         CLI   RECONLSF,C'Y'       IS ORDER A 'LOSS'?                           
         BNE   RDCON222            NO  - NO LOSS DOLLARS                        
*                                                                               
         EDIT  RCONAC$$,(10,RECONLS$),FILL=0                                    
*                                  YES - EDIT IN LOSS DOLLARS                   
RDCON222 EQU   *                                                                
         OC    RCONACTA,RCONACTA   ANY TRUE ACTIVITY DATE?                      
         BZ    RDCON225            NO                                           
*                                                                               
*   THERE IS SCATTERED BAD DATA IN THE TRUE ACTIVITY DATE FIELD.                
*        THE DATE IS INSERTED INCORRECTLY 1 POSITION BEFORE ITS                 
*        ACTUAL LOCATION.                                                       
*        THIS AFFECTS LESS THAN 200 ORDERS.                                     
*        THE NEXT CODE IS INSERTED TO CORRECT THAT SITUATION FOR                
*        EXTRACT PROCESSING.                                                    
*                                                                               
         OC    RCONACAC,RCONACAC   ANY AUTO CLOSE DATE?                         
         BZ    RDCON224            NO  - USE RCONACTA AS IS                     
         OC    RCONACAC(2),RCONACAC                                             
*                                  YES - 1ST 2 POSITIONS BIN ZER0?              
         BNZ   RDCON224            NO  - ACTUAL DATE STORED                     
         MVC   WORK(3),RCONACAC+2                                               
*                                  YES - TRUE ACT DATE IN WRONG SPOT            
         MVC   RCONACTA,WORK       INSERT TRUE ACTIVITY DATE                    
         MVI   RCONACAC+2,0                                                     
RDCON224 EQU   *                                                                
         GOTO1 DATCON,DMCB,(3,RCONACTA),(10,RECONTAD)                           
         DROP  R6                                                               
*                                                                               
RDCON225 EQU   *                                                                
         TR    RECONSHR,MXTRT                                                   
         TR    RECONLSF,MXTRT                                                   
         TR    RECONLS$,MXTRT                                                   
         TR    RECONTAD,MXTRT                                                   
*                                                                               
         MVC   RECONMBD,SPACES     INITIALIZE TO SPACES                         
         MVC   RECONSSG,SPACES                                                  
         MVC   RECONPAD,SPACES                                                  
         MVC   RECONTXT,SPACES     CLEAR TEXT FIELD                             
*                                                                               
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'12'        SAR ELEMENT                                  
         BRAS  RE,GETEL                                                         
         JNE   RDCON400            NOT FOUND                                    
         USING RSARXEL,R6                                                       
*                                                                               
         OC    RSARXLAD,RSARXLAD   ANY PENDING LAST ACTIVITY DATE?              
         BZ    RDCON227            NO                                           
         GOTO1 DATCON,DMCB,(3,RSARXLAD),(10,RECONPAD)                           
RDCON227 EQU   *                                                                
         TM    RSARXFL2,X'80'      'BONUS' BUDGET?                              
         BO    RDCON300            YES - DON'T USE FIGURES                      
         TM    RSARXFL2,X'40'      'TRADE' BUDGET?                              
         BO    RDCON300            YES - DON'T USE FIGURES                      
         TM    RSARXFL2,X'20'      'DR' BUDGET?                                 
         BO    RDCON300            YES - DON'T USE FIGURES                      
         TM    RSARXFL2,X'10'      'ORDER' BUDGET?                              
         BO    RDCON300            YES - DON'T USE FIGURES                      
         TM    RSARXFL2,X'08'      'PP' BUDGET?                                 
         BO    RDCON300            YES - DON'T USE FIGURES                      
         TM    RSARXFL2,X'04'      'GEN AVAIL' BUDGET?                          
         BO    RDCON300            YES - DON'T USE FIGURES                      
*                                                                               
         MVC   FULL,RSARXBGT       DISPLAY BUDGET, IF ANY                       
         L     RF,FULL                                                          
         LTR   RF,RF               ANY VALUE HERE?                              
         BZ    RDCON230            NO  - SKIP IT                                
         EDIT  RSARXBGT,(10,RECONMBD),FILL=0                                    
*                                  YES - INSERT MARKET BUDGET                   
         B     RDCON240                                                         
RDCON230 EQU   *                                                                
         TM    RSARXFLG,X'40'      BUDGET ENTERED AS ZERO?                      
         BNO   RDCON240            NO                                           
         MVC   RECONMBD,FOXZERO3   YES - SEND BACK ALL ZERO                     
RDCON240 EQU   *                                                                
         CLI   RSARXLEN,120        OLD OR NEW ELEMENT?                          
         BNH   RDCON400            OLD - NEXT FIELD DOESN'T EXIST               
         ZIC   RF,RSARXSHG         DISPLAY SHARE GOAL, IF ANY                   
         LTR   RF,RF               ANY VALUE HERE?                              
         BZ    RDCON250            NO  - SKIP IT                                
         EDIT  RSARXSHG,(3,RECONSSG),FILL=0                                     
         B     RDCON400                                                         
*                                                                               
*&&DO                                                                           
* STATION BUDGET HAS BEEN REMOVED AS A FIELD.  CODE IS                          
*        COMMENTED OUT RATHER THAN REMOVED, ON THE OFF-CHANCE                   
*        THEY AGAIN CHANGE THEIR MINDS.                                         
*                                                                               
* STATION BUDGET = MARKET BUDGET * SHARE GOAL                                   
*                                                                               
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,15,FULL                                                       
         XC    WORK,WORK                                                        
         MVC   WORK+1(1),RSARXSHG                                               
         MH    RF,WORK                                                          
         XC    WORK,WORK                                                        
         MVI   WORK+3,100                                                       
         D     RE,WORK                                                          
         LR    R4,RF                                                            
         EDIT  (R4),(10,RECONSBD),FILL=0                                        
         B     RDCON400                                                         
*&&                                                                             
FOXZERO3 DC    C'000000000000'                                                  
         DS    0H                                                               
RDCON250 EQU   *                                                                
         TM    RSARXFLG,X'20'      SHARE GOAL ENTERED AS ZERO?                  
         BNO   RDCON400            NO                                           
         MVC   RECONSSG,FOXZERO3   YES - SEND BACK A ZERO                       
*                                                                               
*                                                                               
*   LEFT IN EVENT STATION BUDGET IS REINSTATED.                                 
*                                                                               
***>>    MVC   RECONSBD,FOXZERO3   STATION BUDGET MUST BE ZERO, TOO             
*                                                                               
         B     RDCON400                                                         
*                                                                               
RDCON300 EQU   *                                                                
         TM    RSARXFL2,X'80'      X'80'  - MARKET BUDGET = 'BONUS'             
         BNO   RDCON310                                                         
         MVC   RECONTXT,=C'BONUS   '                                            
         B     RDCON400                                                         
RDCON310 EQU   *                                                                
         TM    RSARXFL2,X'40'      X'40'  -   "      "    = 'TRADE'             
         BNO   RDCON320                                                         
         MVC   RECONTXT,=C'TRADE   '                                            
         B     RDCON400                                                         
RDCON320 EQU   *                                                                
         TM    RSARXFL2,X'20'      X'20'  -   "      "    = 'DR'                
         BNO   RDCON330                                                         
         MVC   RECONTXT,=C'DR      '                                            
         B     RDCON400                                                         
RDCON330 EQU   *                                                                
         TM    RSARXFL2,X'10'      X'10'  -   "      "    = 'ORDER'             
         BNO   RDCON340                                                         
         MVC   RECONTXT,=C'ORDER   '                                            
         B     RDCON400                                                         
RDCON340 EQU   *                                                                
         TM    RSARXFL2,X'08'      X'08'  -   "      "    = 'PP'                
         BNO   RDCON350                                                         
         MVC   RECONTXT,=C'PP      '                                            
         B     RDCON400                                                         
RDCON350 EQU   *                                                                
         TM    RSARXFL2,X'04'      X'04'  -   "      "    = 'GEN AVAIL'         
         BNO   RDCON360                                                         
         MVC   RECONTXT,=C'GEN AVL '                                            
         B     RDCON400                                                         
RDCON360 EQU   *                                                                
RDCON400 EQU   *                                                                
         TR    RECONMBD,MXTRT                                                   
         TR    RECONSSG,MXTRT                                                   
         TR    RECONTXT,MXTRT                                                   
         TR    RECONPAD,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
         DROP  R2,R6                                                            
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
       ++INCLUDE RESETVAL                                                       
*                                                                               
ANEWMON  DC    A(NEWMON)           NEWMON TABLE                                 
         LTORG                                                                  
         EJECT                                                                  
****                                                                            
CONSTAMP NTR1  BASE=*,LABEL=*                                                   
         L     R2,0(R1)            SET A(EXTRACT RECORD)                        
         USING RECOND,R2                                                        
         L     R3,4(R1)            SET A(RCONREC)                               
         CLI   PARM+PARM5,1        UPDATE PASS?                                 
         BNE   CSTA0100            NO  - PLUG DATE / TIME FOR LOAD              
         LA    RF,LRECVHDR         YES - BACK UP TO RECVRY HDR                  
         LNR   RF,RF                                                            
         AR    R3,RF                                                            
*                                                                               
         USING RECVHDR,R3          SET USING FOR RECVRY HDR                     
*                                                                               
         GOTO1 DATCON,DMCB,(3,RDATE),(X'20',WORK+100)                           
         MVC   RECONEDT+00(2),WORK+102    INSERT MONTH                          
         MVI   RECONEDT+02,C'/'           INSERT SEPARATOR                      
         MVC   RECONEDT+03(2),WORK+104    INSERT DAY                            
         MVI   RECONEDT+05,C'/'           INSERT SEPARATOR                      
         MVC   RECONEDT+06(2),WORK+100    INSERT YEAR                           
*                                                                               
         ICM   RF,15,RTIME          FORMAT DATE & TIME FROM RECOVERY            
         TM    RTIME,X'80'                                                      
         JNO   *+12                                                             
         SLL   RF,1                                                             
         SRL   RF,5                                                             
         XC    DUB,DUB                                                          
         STCM  RF,15,DUB+4                                                      
         OI    DUB+7,X'0C'                                                      
         UNPK  WORK+90(6),DUB+4(4)                                              
         OI    WORK+95,X'F0'                                                    
         MVC   RECONETM+00(2),WORK+90                                           
         MVI   RECONETM+02,C':'                                                 
         MVC   RECONETM+03(2),WORK+92                                           
         MVI   RECONETM+05,C':'                                                 
         MVC   RECONETM+06(2),WORK+94                                           
***      UNPK  RECONETM(6),DUB+4(4)                                             
***      OI    RECONETM+5,X'F0'                                                 
*                                                                               
         DROP  R3                                                               
*                                                                               
         B     CSTA0900            FINISHED                                     
*                                  HERE IF LOAD MODE                            
CSTA0100 EQU   *                                                                
         L     RF,PARM+PARM6       LOAD A(ARGBLOCK) FROM RXTRACT                
         L     R7,0(RF)            LOAD A(DXBLOCKD) PASSED IN                   
         USING DXBLOCKD,R7                                                      
*                                                                               
         MVC   RECONEDT+00(2),DXDATEN+4   INSERT MONTH                          
         MVI   RECONEDT+02,C'/'           INSERT SEPARATOR                      
         MVC   RECONEDT+03(2),DXDATEN+6   INSERT DAY                            
         MVI   RECONEDT+05,C'/'           INSERT SEPARATOR                      
         MVC   RECONEDT+06(2),DXDATEN+2   INSERT YEAR                           
         MVC   RECONETM+00(2),DXTIMEN+00                                        
         MVI   RECONETM+02,C':'                                                 
         MVC   RECONETM+03(2),DXTIMEN+02                                        
         MVI   RECONETM+05,C':'                                                 
         MVC   RECONETM+06(2),DXTIMEN+04                                        
*                                  SET TODAYS TIME                              
         DROP  R7                                                               
*                                                                               
CSTA0900 EQU   *                                                                
         TR    RECONEDT,MXTRT                                                   
         TR    RECONETM,MXTRT                                                   
         XIT1                                                                   
LRECVHDR EQU   24                  L(RECOVERY HEADER)                           
         LTORG                                                                  
         EJECT                                                                  
****                                                                            
SETPNDFC NTR1  BASE=*,LABEL=*                                                   
         USING RCONREC,R3                                                       
*                                                                               
*   CHECK FOR FORECAST CONTRACT FIRST.  IF TRUE FORECAST, CONTRACT              
*        CAN'T BE ANYTHING ELSE.                                                
*        ALSO SET 'NEW: ENTERED THIS WEEK' FLAG 'THWKNEW'                       
*                                                                               
         MVI   PENDFORE,C'X'       SET PENDING/FORECAST OFF                     
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'06'        SPL ELEMENT                                  
         BRAS  RE,GETEL                                                         
         JE    SPND0800            SPL ELEMENT: CAN'T BE FORE/PEND              
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'12'        SAR ELEMENT                                  
         BRAS  RE,GETEL                                                         
         JNE   SPND0020            NO SAR ELEMENT: CAN'T BE FORECAST            
         USING RSARXEL,R6                                                       
*&&DO                                                                           
         CLC   =X'13872051',RCONKCON                                            
         BNE   DUMP0020                                                         
         LA    RF,99                                                            
         DC    H'0'                                                             
DUMP0020 EQU   *                                                                
*&&                                                                             
         TM    RSARXFLG,X'10'      'FORECAST?' FLAG SET?                        
         JNO   SPND0020            NO  -                                        
         MVI   PENDFORE,C'F'       YES - SET FLAG TO 'FORECAST'                 
         B     SPND0800            EXIT ROUTINE                                 
         DROP  R6                                                               
*                                                                               
*   NOT FORECAST:  NOW CHECK FOR 'PENDING' STATUS.                              
*                                                                               
SPND0020 EQU   *                                                                
         CLC   =C'ACC-',RCONBUYR   ACCOUNTING CONTRACT?                         
         BE    SPND0800            ACCOUNTING CAN'T BE PENDING                  
         TM    RCONMODR,X'10'      BUYS ENTERED?                                
         BO    SPND0800            BUYS MOVE OUT OF PENDING STATUS              
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'03'        BOOKED ELEMENT?                              
         BRAS  RE,GETEL                                                         
         JE    SPND0800            BOOKED ELEMENT: CAN'T BE PENDING             
         LA    R6,RCONREC                                                       
         MVI   PEND04,C' '         CLEAR PEND W/04 ELTS FLAG                    
         MVI   ELCODE,X'04'        BILLED ELEMENT?                              
         BRAS  RE,GETEL                                                         
         JNE   SPND0040            NO BILLED ELEMENT                            
         MVI   PEND04,C'4'         SET PEND W/04 ELTS FLAG                      
         J     SPND0800            NO BILLED ELEMENT                            
*                                                                               
SPND0040 EQU   *                                                                
         MVI   PENDFORE,C'P'       NONE OF THE ABOVE PRESENT:                   
*                                     CONTRACT IS 'PENDING'                     
SPND0800 EQU   *                                                                
         CLC   =C'ACC-BB',RCONBUYR BACK BILLING CONTRACT?                       
         BNE   SPND0900            NO                                           
         MVI   PENDFORE,C'B'       YES - SET FLAG                               
SPND0900 EQU   *                                                                
         OC    THISWEEK,THISWEEK   SET THIS WEEK DATE, IF NOT DONE              
         BNZ   SPND0920            ALREADY SET                                  
*                                                                               
         L     R6,=A(RXQWK)                                                     
         USING QWKD,R6                                                          
*                                                                               
* SET THIS WEEKS MONDAY                                                         
*                                                                               
         GOTO1 DATCON,DMCB,(2,QWMONFOR+QWCASATF),(0,WORK+128)                   
         GOTO1 GETMDAY,DMCB,WORK+128,THISWEEK                                   
*                                                                               
* SET THIS WEEKS LAST YEARS MONDAY                                              
*                                                                               
         GOTO1 DATCON,DMCB,(2,QWMONFOR+QWPASATF),(0,WORK+128)                   
         GOTO1 GETMDAY,DMCB,WORK+128,LASTWEEK                                   
*                                                                               
         DROP  R6                                                               
*                                  SET MONDAY DATE                              
SPND0920 EQU   *                                                                
*                                  CONVERT DATE TO MONDAY COMPRESSED            
***>>>   GOTO1 DATCON,DMCB,(3,RCONHDRD),(0,WORK+130)                            
         GOTO1 DATCON,DMCB,(3,RCONCREA),(0,WORK+130)                            
         GOTO1 GETMDAY,DMCB,WORK+130,WORK+128                                   
*                                                                               
         MVI   THWKNEW,C'C'               SET NEW/CHANGED TO 'CHANGED'          
         CLC   WORK+128(2),THISWEEK       ORDER BOOKED THIS WEEK?               
         JNE   SPND0930                   NO                                    
*                                                                               
         MVI   THWKNEW,C'N'               SET NEW/CHANGED TO 'NEW'              
         J     SPND0932                   NO                                    
*                                                                               
SPND0930 EQU   *                                                                
         CLC   WORK+128(2),LASTWEEK       ORDER BOOKED THIS WEEK PRI?           
         JNE   SPND0932                   NO                                    
*                                                                               
         MVI   THWKNEW,C'P'               SET NEW/CHANGED TO 'PRI NEW'          
SPND0932 EQU   *                                                                
*                                                                               
SPND0990 EQU   *                                                                
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*---------------------------------------------------------------------*         
* BUILD COMPETITIVE STATION/SHARE RECORD                              *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXDOLCPT NTR1  BASE=*,LABEL=*                                                   
         USING RECPTD,R2           R2=A(EXTRACT RECORD)                         
         USING RCONSPEL,R6         R6=A(CONTRACT X'06' ELEMENT)                 
         USING RCONREC,R3          R3=A(CONTRACT RECORD)                        
         XC    EXWORK,EXWORK       CLEAR WORKSPACE                              
         LA    R8,EXWORK           SET A(WORK TABLE)                            
*                                                                               
*   1ST STATION HAS ALREADY BEEN REPORTED AS THE REP'D STATION                  
*                                                                               
         LA    R7,RCONSPST         SET A(1ST STATION, 1ST AMOUNT)               
         LA    R7,9(R7)            SKIP 1ST STATION: REP'D                      
         ZIC   R4,RCONSPNU         SET LOOP CONTROL                             
         BCTR  R4,0                MINUS 1 FOR REP'D STATION                    
RXCP0020 EQU   *                                                                
*                                                                               
*   CHECK IF STATION IN LIST HAS ALREADY BEEN SENT OUT                          
*        THERE IS APPARENTLY BAD DATA HERE, DUE TO A COMPETITIVE                
*        SWITCH POSSIBLY.  CAUSE IS UNKNOWN.  TREATING THE                      
*        SYMPTOM                                                                
*                                                                               
         LA    RF,EXWORK                                                        
RXCP0040 EQU   *                                                                
         CLI   0(RF),0             END OF TABLE?                                
         BE    RXCP0060            YES - NOT IN TABLE: PROCESS                  
         CLC   0(5,R7),0(RF)       CALL LETTERS IN TABLE?                       
         BNE   RXCP0050            NO  -                                        
         LA    R7,9(R7)            YES - SKIP THIS ENTRY                        
         B     RXCP0100                                                         
RXCP0050 EQU   *                                                                
         LA    RF,5(RF)            NO  - BUMP TO NEXT SLOT                      
         B     RXCP0040                                                         
RXCP0060 EQU   *                                                                
*                                                                               
         LA    R0,RECPTD           CLEAR THE RECORD                             
         LA    R1,RECPTDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RECPTLEN,RECPTLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RECPTLEN(2),=AL2(RECPTDL)                                        
         MVC   RECPTTYP,REPCPTQ                                                 
         MVI   RECPTACT-1,MXTRTQ                                                
         MVI   RECPTDAT-1,MXTRTQ                                                
         MVI   RECPTTME-1,MXTRTQ                                                
         MVI   RECPTDX,MXTRTQ                                                   
         MVI   RECPTDX+1,MXTRTQ                                                 
         MVI   RECPTREP-1,MXTRTQ                                                
         MVI   RECPTCON-1,MXTRTQ                                                
         MVI   RECPTSTA-1,MXTRTQ                                                
         MVI   RECPTPCT-1,MXTRTQ                                                
         MVI   RECPTRTS-1,MXTRTQ                                                
         MVI   RECPTDEL-1,MXTRTQ                                                
*                                                                               
B        USING RECPTD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RECPTACT,B.RECPTACT                                              
         MVC   RECPTDAT,B.RECPTDAT                                              
         MVC   RECPTTME,B.RECPTTME                                              
         DROP  B                                                                
*                                                                               
***      MVC   RECPTRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RECPTRTS(14),=C'19000101000000'                                  
         TR    RECPTRTS,MXTRT                                                   
*                                                                               
         MVI   RECPTDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RECPTDEL,MXTRT                                                   
*                                                                               
         MVC   RECPTREP,RCONKREP   REPCODE                                      
         TR    RECPTREP,MXTRT                                                   
         ZAP   WORK+20(5),=P'0'    CONTRACT NUMBER                              
         MVO   WORK+20(5),RCONKCON                                              
         EDIT  (P5,WORK+20),(8,RECPTCON),ALIGN=LEFT                             
         TR    RECPTCON,MXTRT                                                   
*                                                                               
         MVC   RECPTSTA,SPACES     STATION CALL LETTERS                         
         TR    RECPTSTA,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXCP0080            YES - ONLY PUT OUT ENOUGH TO KILL            
*                                                                               
         TM    RCONCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BNO   RXCP0070            NO                                           
         MVI   RECPTDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    RECPTDEL,MXTRT                                                   
RXCP0070 EQU   *                                                                
*                                                                               
         MVC   RECPTSTA,0(R7)      STATION CALL LETTERS                         
         MVC   0(5,R8),0(R7)       TABLE THE CALL LETTERS ALSO                  
         TR    RECPTSTA,MXTRT                                                   
         MVC   WORK+20(4),5(R7)    EXTRACT SPL AMOUNT                           
         EDIT  (4,WORK+20),(5,RECPTPCT),FILL=0                                  
*                                  INSERT SPL AMOUNT                            
*                                                                               
         TR    RECPTPCT,MXTRT                                                   
         LA    R7,9(R7)            BUMP TO NEXT STATION/SPL AMOUNT              
         LA    R8,5(R8)            BUMP TO NEXT STATION IN LIST                 
RXCP0080 EQU   *                                                                
         SR    RE,RE               CLEAR THE NEXT RECORD                        
         ICM   RE,3,RECPTLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXCP0200            YES - ONLY PUT OUT ONE RECORD                
*                                                                               
RXCP0100 EQU   *                                                                
         BCT   R4,RXCP0020         GO BACK FOR NEXT RECORD                      
RXCP0200 EQU   *                                                                
         J     EXITR2                                                           
         DROP  R2,R3                                                            
*                                                                               
*---------------------------------------------------------------------*         
* BUILD DAYPART / CPP RECORD                                          *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXDOLDPT NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING REDPTD,R2           R2=A(EXTRACT RECORD)                         
         USING RCPRDPEL,R6         R6=A(CONTRACT X'41' ELEMENT)                 
         USING RCONREC,R3          R3=A(CONTRACT RECORD)                        
*                                                                               
         ZIC   RF,1(R6)            CALCULATE NUMBER OF ENTRIES                  
         SH    RF,=H'3'            SUBTRACT EXTRANEOUS BYTES AT START           
         SR    RE,RE                                                            
         D     RE,=F'5'            DIVIDE BY 5                                  
         LTR   RF,RF               ANY DAYPARTS/CPPS ENTERED?                   
         BZ    RXDP0200            NO  - EXIT                                   
         LR    R4,RF               SET LOOP CONTROL                             
         LA    R7,RCPRDPDP         SET A(1ST DAYPART, 1ST CPP)                  
*                                                                               
RXDP0020 EQU   *                                                                
         LA    R0,REDPTD           CLEAR THE RECORD                             
         LA    R1,REDPTDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REDPTLEN,REDPTLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REDPTLEN(2),=AL2(REDPTDL)                                        
         MVC   REDPTTYP,REPDPTQ                                                 
         MVI   REDPTACT-1,MXTRTQ                                                
         MVI   REDPTDAT-1,MXTRTQ                                                
         MVI   REDPTTME-1,MXTRTQ                                                
         MVI   REDPTDX,MXTRTQ                                                   
         MVI   REDPTDX+1,MXTRTQ                                                 
         MVI   REDPTREP-1,MXTRTQ                                                
         MVI   REDPTCON-1,MXTRTQ                                                
         MVI   REDPTDPT-1,MXTRTQ                                                
         MVI   REDPTCPP-1,MXTRTQ                                                
         MVI   REDPTRTS-1,MXTRTQ                                                
         MVI   REDPTDEL-1,MXTRTQ                                                
*                                                                               
B        USING REDPTD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REDPTACT,B.REDPTACT                                              
         MVC   REDPTDAT,B.REDPTDAT                                              
         MVC   REDPTTME,B.REDPTTME                                              
         DROP  B                                                                
*                                                                               
***      MVC   REDPTRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REDPTRTS(14),=C'19000101000000'                                  
         TR    REDPTRTS,MXTRT                                                   
*                                                                               
         MVI   REDPTDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REDPTDEL,MXTRT                                                   
*                                                                               
         MVC   REDPTREP,RCONKREP   REPCODE                                      
         TR    REDPTREP,MXTRT                                                   
         ZAP   WORK+20(5),=P'0'    CONTRACT NUMBER                              
         MVO   WORK+20(5),RCONKCON                                              
         EDIT  (P5,WORK+20),(8,REDPTCON),ALIGN=LEFT                             
         TR    REDPTCON,MXTRT                                                   
*                                                                               
         MVI   REDPTDPT,C' '       DAYPART CODE INITIALIZED                     
         TR    REDPTDPT,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXDP0040            YES - ONLY PUT OUT ENOUGH TO KILL            
*                                                                               
         TM    RCONCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BNO   RXDP0030            NO                                           
         MVI   REDPTDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REDPTDEL,MXTRT                                                   
RXDP0030 EQU   *                                                                
*                                                                               
         MVC   REDPTDPT,0(R7)      DAYPART CODE                                 
         TR    REDPTDPT,MXTRT                                                   
         MVC   WORK+20(4),1(R7)    EXTRACT CPP AMOUNT                           
         EDIT  (4,WORK+20),(10,REDPTCPP),FILL=0                                 
*                                  INSERT CPP AMOUNT                            
*                                                                               
         TR    REDPTCPP,MXTRT                                                   
*                                                                               
         LA    R7,5(R7)            BUMP TO NEXT DAYPART/CPP AMOUNT              
*                                                                               
RXDP0040 EQU   *                                                                
         SR    RE,RE               CLEAR THE NEXT RECORD                        
         ICM   RE,3,REDPTLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXDP0200            YES - ONLY PUT OUT ONE RECORD                
*                                                                               
         BCT   R4,RXDP0020         GO BACK FOR NEXT RECORD                      
         DROP  R2                                                               
RXDP0200 EQU   *                                                                
         J     EXITR2                                                           
*---------------------------------------------------------------------*         
* BUILD LENGTH RECORD(S)                                              *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXDOLLEN NTR1  BASE=*,LABEL=*                                                   
         USING RELEND,R2           R2=A(EXTRACT RECORD)                         
         USING RSARXEL,R6          R6=A(CONTRACT X'12' ELEMENT)                 
         USING RCONREC,R3          R3=A(CONTRACT RECORD)                        
*                                                                               
         XC    FULL2,FULL2         CLEAR A COUNTER                              
*                                                                               
         LA    R7,RSARXRFR         SET A(1ST LENGTH FIELD)                      
         LA    R4,6                SET MAX LOOP CONTROL                         
*                                                                               
RXLE0020 EQU   *                                                                
*                                                                               
         LA    R0,RELEND           CLEAR THE RECORD                             
         LA    R1,RELENDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RELENLEN,RELENLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RELENLEN(2),=AL2(RELENDL)                                        
         MVC   RELENTYP,REPLENQ                                                 
         MVI   RELENACT-1,MXTRTQ                                                
         MVI   RELENDAT-1,MXTRTQ                                                
         MVI   RELENTME-1,MXTRTQ                                                
         MVI   RELENDX,MXTRTQ                                                   
         MVI   RELENDX+1,MXTRTQ                                                 
         MVI   RELENREP-1,MXTRTQ                                                
         MVI   RELENCON-1,MXTRTQ                                                
         MVI   RELENLTH-1,MXTRTQ                                                
         MVI   RELENCTR-2,MXTRTQ                                                
         MVI   RELENRTS-1,MXTRTQ                                                
         MVI   RELENDEL-1,MXTRTQ                                                
*                                                                               
B        USING RELEND,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RELENACT,B.RELENACT                                              
         MVC   RELENDAT,B.RELENDAT                                              
         MVC   RELENTME,B.RELENTME                                              
         DROP  B                                                                
*                                                                               
***      MVC   RELENRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RELENRTS(14),=C'19000101000000'                                  
         TR    RELENRTS,MXTRT                                                   
*                                                                               
         MVI   RELENDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RELENDEL,MXTRT                                                   
*                                                                               
         MVC   RELENREP,RCONKREP   REPCODE                                      
         TR    RELENREP,MXTRT                                                   
         ZAP   WORK+20(5),=P'0'    CONTRACT NUMBER                              
         MVO   WORK+20(5),RCONKCON                                              
         EDIT  (P5,WORK+20),(8,RELENCON),ALIGN=LEFT                             
         TR    RELENCON,MXTRT                                                   
*                                                                               
         MVC   RELENLTH,SPACES     LENGTH INITIALIZED                           
         TR    RELENLTH,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXLE0040            YES - ONLY PUT OUT ENOUGH TO KILL            
*                                                                               
         TM    RCONCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BNO   RXLE0025            NO                                           
         MVI   RELENDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    RELENDEL,MXTRT                                                   
RXLE0025 EQU   *                                                                
*                                                                               
         MVI   RELENLTH+3,C'S'     INSERT SECONDS INDICATOR                     
         TM    1(R7),X'80'         MINUTES INDICATOR TURNED ON?                 
         BNO   RXLE0030            NO                                           
         MVI   RELENLTH+3,C'M'     INSERT MINUTES INDICATOR                     
RXLE0030 EQU   *                                                                
         MVC   WORK+32(1),1(R7)                                                 
         NI    WORK+32,X'7F'       TURN OFF MINUTES FLAG                        
         EDIT  (1,WORK+32),(3,RELENLTH),FILL=0                                  
*                                                                               
         TR    RELENLTH,MXTRT                                                   
*                                                                               
         L     RF,FULL2            INCREMENT COUNTER                            
         LA    RF,1(RF)                                                         
         ST    RF,FULL2            SAVE NEW COUNTER                             
         EDIT (4,FULL2),(12,RELENCTR),FILL=0                                    
         TR    RELENCTR,MXTRT                                                   
*                                                                               
*                                                                               
RXLE0040 EQU   *                                                                
         SR    RE,RE               CLEAR THE NEXT RECORD                        
         ICM   RE,3,RELENLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXLE0200            YES - ONLY PUT OUT ONE RECORD                
*                                                                               
         LA    R7,2(R7)                                                         
         OC    0(2,R7),0(R7)       ANYTHING IN NEXT SLOT?                       
         BZ    RXLE0200            NO                                           
*                                                                               
         BCT   R4,RXLE0020         DO ALL SIX MAX                               
RXLE0200 EQU   *                                                                
         DROP  R2                                                               
*                                                                               
         J     EXITR2                                                           
*---------------------------------------------------------------------*         
* BUILD PEND / FORECAST RECORDS                                       *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXDOLPFC NTR1  BASE=*,LABEL=*                                                   
         USING REPFCD,R2           R2=A(EXTRACT RECORD)                         
         USING RCONBCEL,R6         R6=A(CONTRACT X'11' ELEMENT)                 
         USING RCONREC,R3          R3=A(CONTRACT RECORD)                        
*                                                                               
RXPF0020 EQU   *                                                                
*                                                                               
         LA    R0,REPFCD           CLEAR THE RECORD                             
         LA    R1,REPFCDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REPFCLEN,REPFCLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REPFCLEN(2),=AL2(REPFCDL)                                        
         MVC   REPFCTYP,REPPFCQ                                                 
         MVI   REPFCACT-1,MXTRTQ                                                
         MVI   REPFCDAT-1,MXTRTQ                                                
         MVI   REPFCTME-1,MXTRTQ                                                
         MVI   REPFCREP-1,MXTRTQ                                                
         MVI   REPFCCON-1,MXTRTQ                                                
         MVI   REPFCCO#-1,MXTRTQ                                                
         MVI   REPFCLIN-1,MXTRTQ                                                
         MVI   REPFCRTS-1,MXTRTQ                                                
         MVI   REPFCDEL-1,MXTRTQ                                                
*                                                                               
B        USING REPFCD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REPFCACT,B.REPFCACT                                              
         MVC   REPFCDAT,B.REPFCDAT                                              
         MVC   REPFCTME,B.REPFCTME                                              
         DROP  B                                                                
*                                                                               
***      MVC   REPFCRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REPFCRTS(14),=C'19000101000000'                                  
         TR    REPFCRTS,MXTRT                                                   
*                                                                               
         MVI   REPFCDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REPFCDEL,MXTRT                                                   
*                                                                               
         MVC   REPFCREP,RCONKREP   REPCODE                                      
         TR    REPFCREP,MXTRT                                                   
         ZAP   WORK+20(5),=P'0'    CONTRACT NUMBER                              
         MVO   WORK+20(5),RCONKCON                                              
         EDIT  (P5,WORK+20),(8,REPFCCON),ALIGN=LEFT                             
         TR    REPFCCON,MXTRT                                                   
*                                                                               
         MVC   REPFCLIN,SPACES     SET COMMENT LINE TO SPACE                    
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXPF0040            YES - ONLY PUT OUT ENOUGH TO KILL            
*                                                                               
         TM    RCONCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BNO   RXPF0025            NO                                           
         MVI   REPFCDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REPFCDEL,MXTRT                                                   
RXPF0025 EQU   *                                                                
*                                                                               
         L     RF,FULL2            INCREMENT COUNTER                            
         LA    RF,1(RF)                                                         
         ST    RF,FULL2            SAVE NEW COUNTER                             
         EDIT (4,FULL2),(2,REPFCCO#),FILL=0                                     
         TR    REPFCCO#,MXTRT                                                   
*                                                                               
         ZICM  RE,1(R6)            EXTRACT LENGTH OF COMMENT ELEMENT            
         SH    RE,=H'3'            SUBTRACT FOR EX                              
         EX    RE,RXPF0030         MOVE COMMENT BY LENGTH                       
         EX    RE,RXPF0032         OR IN SPACES BY LENGTH                       
         B     RXPF0040                                                         
RXPF0030 EQU   *                                                                
         MVC   REPFCLIN(0),2(R6)                                                
RXPF0032 EQU   *                                                                
         OC    REPFCLIN(0),SPACES                                               
*                                                                               
RXPF0040 EQU   *                                                                
         TR    REPFCLIN,MXTRT                                                   
         SR    RE,RE               CLEAR THE NEXT RECORD                        
         ICM   RE,3,REPFCLEN                                                    
*                                                                               
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXPF0200            YES - ONLY PUT OUT ONE RECORD                
*                                                                               
RXPF0200 EQU   *                                                                
         DROP  R2                                                               
*                                                                               
         J     EXITR2                                                           
*---------------------------------------------------------------------*         
* BUILD COMPETITIVE COMMENT RECORDS                                   *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXDOLCCM NTR1  BASE=*,LABEL=*                                                   
         USING RESPCD,R2           R2=A(EXTRACT RECORD)                         
         USING RCONSMEL,R6         R6=A(CONTRACT X'11' ELEMENT)                 
         USING RCONREC,R3          R3=A(CONTRACT RECORD)                        
*                                                                               
RXCC0020 EQU   *                                                                
*                                                                               
         LA    R0,RESPCD           CLEAR THE RECORD                             
         LA    R1,RESPCDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RESPCLEN,RESPCLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RESPCLEN(2),=AL2(RESPCDL)                                        
         MVC   RESPCTYP,REPSPCQ                                                 
         MVI   RESPCACT-1,MXTRTQ                                                
         MVI   RESPCDAT-1,MXTRTQ                                                
         MVI   RESPCTME-1,MXTRTQ                                                
         MVI   RESPCREP-1,MXTRTQ                                                
         MVI   RESPCCON-1,MXTRTQ                                                
         MVI   RESPCCO#-1,MXTRTQ                                                
         MVI   RESPCLIN-1,MXTRTQ                                                
         MVI   RESPCRTS-1,MXTRTQ                                                
         MVI   RESPCDEL-1,MXTRTQ                                                
*                                                                               
B        USING RESPCD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RESPCACT,B.RESPCACT                                              
         MVC   RESPCDAT,B.RESPCDAT                                              
         MVC   RESPCTME,B.RESPCTME                                              
         DROP  B                                                                
*                                                                               
***      MVC   RESPCRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RESPCRTS(14),=C'19000101000000'                                  
         TR    RESPCRTS,MXTRT                                                   
*                                                                               
         MVI   RESPCDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RESPCDEL,MXTRT                                                   
*                                                                               
         MVC   RESPCREP,RCONKREP   REPCODE                                      
         TR    RESPCREP,MXTRT                                                   
         ZAP   WORK+20(5),=P'0'    CONTRACT NUMBER                              
         MVO   WORK+20(5),RCONKCON                                              
         EDIT  (P5,WORK+20),(8,RESPCCON),ALIGN=LEFT                             
         TR    RESPCCON,MXTRT                                                   
*                                                                               
         MVC   RESPCLIN,SPACES     SET COMMENT LINE TO SPACE                    
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXCC0040            YES - ONLY PUT OUT ENOUGH TO KILL            
*                                                                               
         TM    RCONCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BNO   RXCC0025            NO                                           
         MVI   RESPCDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    RESPCDEL,MXTRT                                                   
RXCC0025 EQU   *                                                                
*                                                                               
         L     RF,FULL2            INCREMENT COUNTER                            
         LA    RF,1(RF)                                                         
         ST    RF,FULL2            SAVE NEW COUNTER                             
         EDIT (4,FULL2),(2,RESPCCO#),FILL=0                                     
         TR    RESPCCO#,MXTRT                                                   
*                                                                               
         ZICM  RE,1(R6)            EXTRACT LENGTH OF COMMENT ELEMENT            
         SH    RE,=H'3'            SUBTRACT FOR EX                              
         EX    RE,RXCC0030         MOVE COMMENT BY LENGTH                       
         EX    RE,RXCC0032         OR IN SPACES BY LENGTH                       
         B     RXCC0040                                                         
RXCC0030 EQU   *                                                                
         MVC   RESPCLIN(0),2(R6)                                                
RXCC0032 EQU   *                                                                
         OC    RESPCLIN(0),SPACES                                               
*                                                                               
RXCC0040 EQU   *                                                                
         TR    RESPCLIN,MXTRT                                                   
         SR    RE,RE               CLEAR THE NEXT RECORD                        
         ICM   RE,3,RESPCLEN                                                    
*                                                                               
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXCC0200            YES - ONLY PUT OUT ONE RECORD                
*                                                                               
RXCC0200 EQU   *                                                                
         DROP  R2                                                               
*                                                                               
         J     EXITR2                                                           
*---------------------------------------------------------------------*         
* BUILD BOOKS  RECORD(S)                                              *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXDOLBKS NTR1  BASE=*,LABEL=*                                                   
         USING REBKSD,R2           R2=A(EXTRACT RECORD)                         
         USING RCPRBKEL,R6         R6=A(CONTRACT X'40' ELEMENT)                 
         USING RCONREC,R3          R3=A(CONTRACT RECORD)                        
*                                                                               
         XC    FULL2,FULL2         CLEAR A COUNTER                              
*                                                                               
         ZIC   RF,1(R6)            CALCULATE NUMBER OF ENTRIES                  
         SH    RF,=H'2'            SUBTRACT EXTRANEOUS BYTES AT START           
         SR    RE,RE                                                            
         D     RE,=F'5'            DIVIDE BY 5                                  
         LTR   RF,RF               ANY BOOKS ENTERED?                           
         BZ    RXBK0260            NO  - EXIT                                   
         LR    R4,RF               SET LOOP CONTROL                             
         LA    R7,RCPRBKBK         SET A(1ST BOOK)                              
*                                                                               
*   ELIMINATING 'DROPBKS' ROUTINE IN VERSION 'K'                                
*        DUPLICATE COMPARISON IS REMOVED.  THE TEST FOR X'FFFFFFFFF'            
*        IS STILL IN PLACE BELOW                                                
*                                                                               
***>>>   BRAS  RE,DROPBKS          SCAN / DROP DUPES                            
*&&DO                                                                           
*   TEST                                                                        
         CLC   =X'05553134',RCONKCON                                            
         JNE   RXBK0020                                                         
         LA    R1,4                                                             
         LA    RF,EXWORK                                                        
         DC    H'0'                                                             
*   TEST END                                                                    
*&&                                                                             
RXBK0020 EQU   *                                                                
*                                                                               
         LA    R0,REBKSD           CLEAR THE RECORD                             
         LA    R1,REBKSDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
*   FIRST RECORD WILL NEVER BE A DUPE !!                                        
*                                                                               
         CLC   =X'FFFFFFFFFF',0(R7) 'ERASED' DUPLICATE BOOK?                    
         BNE   RXBK0030            NO                                           
         LA    R7,5(R7)            YES - BUMP TO NEXT BOOK DATE                 
         B     RXBK0250            SKIP THIS BOOK                               
*                                     AND DON'T SKELETONIZE THE REC             
RXBK0030 EQU   *                                                                
*                                                                               
         XC    REBKSLEN,REBKSLEN   RECORD BKSGTH/TYPE/ENDOFREC                  
         MVC   REBKSLEN(2),=AL2(REBKSDL)                                        
         MVC   REBKSTYP,REPBKSQ                                                 
         MVI   REBKSACT-1,MXTRTQ                                                
         MVI   REBKSDAT-1,MXTRTQ                                                
         MVI   REBKSTME-1,MXTRTQ                                                
         MVI   REBKSDX,MXTRTQ                                                   
         MVI   REBKSDX+1,MXTRTQ                                                 
         MVI   REBKSREP-1,MXTRTQ                                                
         MVI   REBKSCON-1,MXTRTQ                                                
         MVI   REBKSBOK-1,MXTRTQ                                                
         MVI   REBKSCTR-1,MXTRTQ                                                
         MVI   REBKSRTS-1,MXTRTQ                                                
         MVI   REBKSDEL-1,MXTRTQ                                                
*                                                                               
B        USING REBKSD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBKSACT,B.REBKSACT                                              
         MVC   REBKSDAT,B.REBKSDAT                                              
         MVC   REBKSTME,B.REBKSTME                                              
         DROP  B                                                                
*                                                                               
***      MVC   REBKSRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REBKSRTS(14),=C'19000101000000'                                  
         TR    REBKSRTS,MXTRT                                                   
*                                                                               
         MVI   REBKSDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REBKSDEL,MXTRT                                                   
*                                                                               
         MVC   REBKSREP,RCONKREP   REPCODE                                      
         TR    REBKSREP,MXTRT                                                   
         ZAP   WORK+20(5),=P'0'    CONTRACT NUMBER                              
         MVO   WORK+20(5),RCONKCON                                              
         EDIT  (P5,WORK+20),(8,REBKSCON),ALIGN=LEFT                             
         TR    REBKSCON,MXTRT                                                   
*                                                                               
         MVC   REBKSBOK,SPACES     BOOKS INITIALIZED                            
         TR    REBKSBOK,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXBK0240            YES - ONLY PUT OUT ENOUGH TO KILL            
*                                                                               
         TM    RCONCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BNO   RXBK0035            NO                                           
         MVI   REBKSDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REBKSDEL,MXTRT                                                   
RXBK0035 EQU   *                                                                
*                                                                               
         CLI   0(R7),0             DATE OR LABEL IN FIELD?                      
         BZ    RXBK0040            ZERO = DATE                                  
         MVC   REBKSBOK(5),0(R7)   USER-DEFINED LABEL                           
         OC    REBKSBOK,SPACES                                                  
*                                                                               
         B     RXBK0220                                                         
RXBK0040 EQU   *                                                                
         CLC   =C'PP',2(R7)        SPECIAL LABEL?                               
         BE    RXBK0060            YES                                          
         CLC   =C'DR',2(R7)        SPECIAL LABEL?                               
         BNE   RXBK0080            YES                                          
RXBK0060 EQU   *                                                                
         MVC   REBKSBOK(3),2(R7)   SPECIAL LABEL                                
         OC    REBKSBOK,SPACES                                                  
*                                                                               
         B     RXBK0220                                                         
RXBK0080 EQU   *                                                                
         XC    SAVLABLS,SAVLABLS                                                
         CLI   1(R7),0             SPECIAL BOOK TYPE USED FOR THIS BOOK         
         BE    RXBK0100                                                         
         MVI   SAVLABLS+0,C'('                                                  
         MVC   SAVLABLS+1(1),1(R7)  SAVE SPECIAL BOOK TYPE                      
         MVI   SAVLABLS+2,C')'                                                  
*                                                                               
RXBK0100 DS    0H                                                               
         XC    EXWORK,EXWORK                                                    
         MVC   EXWORK(8),=X'520200AC00008041'                                   
         LA    R1,WORK+64                                                       
         XC    0(80,R1),0(R1)                                                   
         MVC   0(2,R1),=X'0B07'    LABEL EL. + LENGTH                           
         MVC   2(5,R1),SAVLABLS    RENAME LABEL                                 
*                                                                               
         LR    R0,R1                                                            
*                                                                               
         GOTO1           ,DMCB,(1,2(R7)),EXWORK,(C'B',(R0)),           X        
               (C'+',=CL6' ')                                                   
         GOTO1 =V(UNBOOK)                                                       
*                                                                               
         ZIC   RE,EXWORK                                                        
         LA    RE,EXWORK(RE)                                                    
*                                                                               
         TM    EXWORK+1,X'02'       EXT FIELD HDR?                              
         BNE   *+8                                                              
         SH    RE,=H'8'                                                         
         CLI   0(RE),C' '                                                       
         BH    *+8                                                              
         BCT   RE,*-8                                                           
*                                                                               
         CLI   0(RE),C')'                                                       
         BE    RXBK0110                                                         
         LA    RE,1(RE)                                                         
         B     RXBK0120                                                         
RXBK0110 EQU   *                                                                
         BCTR  RE,0                                                             
         CLI   0(RE),C' '                                                       
         BH    *+8                                                              
         BCT   RE,*-8                                                           
         CLI   0(RE),C'('          POSITION CONTAINS (?                         
         BE    RXBK0120                                                         
         LA    RE,1(RE)                                                         
         MVI   0(RE),C')'                                                       
*                                                                               
RXBK0120 EQU   *                                                                
*                                                                               
         OC    SAVLABLS,SAVLABLS   ANY SPECIAL INDICATORS?                      
         BZ    RXBK0140            NO                                           
         MVC   0(3,RE),SAVLABLS    YES - ADD TO END OF BOOK                     
*                                                                               
         LA    RE,3(RE)                                                         
         XC    0(4,RE),0(RE)                                                    
*                                                                               
RXBK0140 EQU   *                                                                
         SR    R1,R1                                                            
         LA    RE,EXWORK+8         COUNT LENGTH OF FIELD                        
RXBK0160 EQU   *                                                                
         CLI   0(RE),C' '          BLANK FOUND?                                 
         BNH   RXBK0180            YES - COUNT FINISHED                         
         LA    R1,1(R1)            INCREMENT COUNT                              
         LA    RE,1(RE)            BUMP TO NEXT CHAR                            
         B     RXBK0160                                                         
RXBK0180 EQU   *                                                                
         BCTR  R1,0                SET FOR EX MOVE                              
         EX    R1,*+8                                                           
         B     RXBK0200                                                         
         MVC   REBKSBOK(0),EXWORK+8                                             
RXBK0200 EQU   *                                                                
         OC    REBKSBOK,SPACES                                                  
*                                                                               
                                                                                
RXBK0220 EQU   *                                                                
         TR    REBKSBOK,MXTRT                                                   
*                                                                               
         L     RF,FULL2            INCREMENT COUNTER                            
         LA    RF,1(RF)                                                         
         ST    RF,FULL2            SAVE NEW COUNTER                             
         EDIT (4,FULL2),(12,REBKSCTR),FILL=0                                    
         TR    REBKSCTR,MXTRT                                                   
*                                                                               
         LA    R7,5(R7)            BUMP TO NEXT BOOK DATE                       
*                                                                               
RXBK0240 EQU   *                                                                
         SR    RE,RE               CLEAR THE NEXT RECORD                        
         ICM   RE,3,REBKSLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXBK0260            YES - ONLY PUT OUT ONE RECORD                
*                                                                               
RXBK0250 EQU   *                                                                
         BCT   R4,RXBK0020         GO BACK FOR NEXT                             
RXBK0260 EQU   *                                                                
*                                                                               
         DROP  R2                                                               
*                                                                               
         J     EXITR2                                                           
         EJECT                                                                  
*                                                                               
*   DROP BOOKS IF DUPLICATED                                                    
*        R7 ->  BOOK LIST                                                       
*        R4 ->  LOOP CONTROL                                                    
*                                                                               
DROPBKS  NTR1  BASE=*,LABEL=*                                                   
         XC    EXWORK,EXWORK                                                    
         SR    RE,RE                                                            
DBKS0020 EQU   *                                                                
         LA    R1,EXWORK                                                        
DBKS0030 EQU   *                                                                
         OC    0(5,R1),0(R1)       END OF LIST?                                 
         BZ    DBKS0060            YES - ADD THIS BOOK                          
         CLC   0(5,R7),0(R1)       BOOK IN LIST?                                
         BE    DBKS0040            YES - 'ERASE' DUPE                           
         LA    R1,5(R1)            BUMP TO NEXT TABLE SLOT                      
         B     DBKS0030            GO BACK AND CHECK NEXT TABLE                 
DBKS0040 EQU   *                                                                
         MVC   0(5,R1),0(R7)       INSERT BOOK INTO TABLE                       
         MVC   0(5,R7),=X'FFFFFFFFFF'                                           
*                                  'ERASE' TABLE SLOT                           
         B     DBKS0080                                                         
DBKS0060 EQU   *                                                                
         MVC   0(5,R1),0(R7)       INSERT BOOK INTO TABLE                       
DBKS0080 EQU   *                                                                
         LA    R7,5(R7)            BUMP TO NEXT BOOK IN LIST                    
         BCT   R4,DBKS0020                                                      
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
*---------------------------------------------------------------------*         
*                                                                               
*---------------------------------------------------------------------*         
REPBUYC  NMOD1 WORKL,*REPBUY*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REBUYLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REBUYD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         BRAS  RE,LOADER                                                        
*                                                                               
         CLI   8(R1),1                                                          
         JL    RXBUYKIL            BUILD KILL RECORD                            
         JE    RBUY0010            BUILD SERIES OF RECORDS                      
         J     RXBUYNXT            OUTPUT NEXT RECORD                           
*                                                                               
RXBUYKIL DS    0H                                                               
         MVI   KILLMODE,C'Y'       SET TO 'KILL'                                
*                                                                               
RBUY0010 DS    0H                                                               
         LR    R5,R2                                                            
         L     R2,RXBUYCC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         BRAS  RE,RXBUYSER                                                      
*                                                                               
RBUYX    DS    0H                                                               
         J     EXIT                                                             
*                                                                               
RXBUYNXT L     RE,ANEXT                                                         
*                                                                               
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK?                         
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         LA    R0,REBUYD           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1               LENGTH OF NEXT RECORD                        
         ICM   R1,3,REBUYLEN-REBUYD(RE)                                         
         LA    RF,0(R1,RE)         SAVE NEXT ADDRESS                            
         ST    RF,ANEXT                                                         
         LR    RF,R1               SET LENGTH                                   
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
*        DROP  R2,R3,R5                                                         
         LTORG                                                                  
RXBUYCC  DC    A(BUFFER1)                                                       
REBUYLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
*---------------------------------------------------------------------*         
* BUILD SERIES OF RECORDS FOR THIS BUY                                *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXBUYSER NTR1  LABEL=*,BASE=*                                                   
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         USING REBUYD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         XC    EXWORK,EXWORK                                                    
*                                                                               
         BRAS  RE,RXBUYHDR                                                      
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBUYLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
RXBUY010 DS    0H                                                               
         BRAS  RE,RXGENZBK         CREATE BUY $0 BUCKETS                        
         DROP  R2                                                               
*                                                                               
RXBUY015 DS    0H                                                               
         LR    R6,R3                                                            
         MVI   ELCODE,X'02'        DAY/TIME ELEMENT                             
         BRAS  RE,GETEL                                                         
         JNE   RXBUY030                                                         
*                                                                               
RXBUY020 DS    0H                                                               
         USING REBDTD,R2           R2=A(EXTRACT RECORD)                         
*        BRAS  RE,RXBUYDT                                                       
                                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBDTLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         BRAS  RE,NEXTEL                                                        
         JE    RXBUY020                                                         
         DROP  R2                                                               
*                                                                               
RXBUY030 EQU   *                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'03'        EFFECTIVE DATE ELEMENT                       
         BRAS  RE,GETEL                                                         
         JNE   RXBUY050                                                         
*                                                                               
RXBUY040 DS    0H                                                               
         USING REBEDD,R2           R2=A(EXTRACT RECORD)                         
         BRAS  RE,RXBUYED                                                       
                                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBEDLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         BRAS  RE,NEXTEL                                                        
         JE    RXBUY040                                                         
         DROP  R2                                                               
*                                                                               
RXBUY050 EQU   *                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'04'        COMMENT ELEMENT                              
         BRAS  RE,GETEL                                                         
         JNE   RXBUY070                                                         
*                                                                               
RXBUY060 DS    0H                                                               
         USING REBCMD,R2           R2=A(EXTRACT RECORD)                         
*        BRAS  RE,RXBUYCM                                                       
                                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBCMLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         BRAS  RE,NEXTEL                                                        
         JE    RXBUY060                                                         
         DROP  R2                                                               
*                                                                               
RXBUY070 EQU   *                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'0D'        DARE DEMO ELEMENT                            
         BRAS  RE,GETEL                                                         
         JNE   RXBUY090                                                         
         CLI   1(R6),18            IGNORE OLD DEMOS                             
         JE    RXBUY090                                                         
         CLI   1(R6),34                                                         
         JE    RXBUY090                                                         
*                                                                               
RXBUY080 DS    0H                                                               
         USING REBDDD,R2           R2=A(EXTRACT RECORD)                         
*        BRAS  RE,RXBUYDD                                                       
                                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBDDLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         BRAS  RE,NEXTEL                                                        
         JE    RXBUY080                                                         
         DROP  R2                                                               
*                                                                               
RXBUY090 EQU   *                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'0E'        REP DEMO ELEMENT                             
         BRAS  RE,GETEL                                                         
         JNE   RXBUY110                                                         
*                                                                               
RXBUY100 DS    0H                                                               
         USING REBRDD,R2           R2=A(EXTRACT RECORD)                         
*        BRAS  RE,RXBUYRD                                                       
                                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBRDLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         BRAS  RE,NEXTEL                                                        
         JE    RXBUY100                                                         
         DROP  R2                                                               
*                                                                               
RXBUY110 EQU   *                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'20'        PATTERN ELEMENT                              
         BRAS  RE,GETEL                                                         
         JNE   RXBUY130                                                         
*                                                                               
RXBUY120 DS    0H                                                               
         USING REBPTD,R2           R2=A(EXTRACT RECORD)                         
*        BRAS  RE,RXBUYPT                                                       
                                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBPTLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         DROP  R2                                                               
*                                                                               
RXBUY130 EQU   *                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'21'        PROGRAM ELEMENT                              
         BRAS  RE,GETEL                                                         
         JNE   RXBUY150                                                         
*                                                                               
RXBUY140 DS    0H                                                               
         USING REBPGD,R2           R2=A(EXTRACT RECORD)                         
*        BRAS  RE,RXBUYPG                                                       
                                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBPGLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         DROP  R2                                                               
*                                                                               
RXBUY150 EQU   *                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'5F'        BUY CODE ELEMENT                             
         BRAS  RE,GETEL                                                         
         JNE   RXBUY170                                                         
*                                                                               
RXBUY160 DS    0H                                                               
         USING REBBCD,R2           R2=A(EXTRACT RECORD)                         
         BRAS  RE,RXBUYBC                                                       
                                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBBCLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         DROP  R2                                                               
*                                                                               
RXBUY170 EQU   *                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'81'        SPORTS BUY ELEMENT                           
         BRAS  RE,GETEL                                                         
         JNE   RXBUY190                                                         
         USING REBSBD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
*        BRAS  RE,RXBUYSB                                                       
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBSBLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         DROP  R2                                                               
*                                                                               
RXBUY190 EQU   *                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'82'        SPORTS BUY ELEMENT                           
         BRAS  RE,GETEL                                                         
         JNE   RXBUY200                                                         
         USING REBSBD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
*        BRAS  RE,RXBUYSB                                                       
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBSBLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         DROP  R2                                                               
*                                                                               
RXBUY200 EQU   *                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'84'        BUY ORDER COMMENT ELEMENT                    
         BRAS  RE,GETEL                                                         
         JNE   RXBUY220                                                         
*                                                                               
RXBUY210 DS    0H                                                               
         USING REBOCD,R2           R2=A(EXTRACT RECORD)                         
*        BRAS  RE,RXBUYOC                                                       
                                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBOCLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         BRAS  RE,NEXTEL                                                        
         JE    RXBUY210                                                         
         DROP  R2                                                               
*                                                                               
RXBUY220 EQU   *                                                                
*                                                                               
RXBUYX   EQU   *                                                                
         J     EXITR2              FINISHED                                     
         LTORG                                                                  
*                                                                               
RXBUYHDR NTR1  LABEL=*,BASE=*                                                   
*                                                                               
         USING REBUYD,R2           R2=A(EXTRACT RECORD)                         
         LR    R6,R3                                                            
         USING RBUYREC,R6                                                       
*                                                                               
         XC    REBUYLEN,REBUYLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBUYLEN(2),=AL2(REBUYDL)                                        
         MVI   REBUYACT-1,MXTRTQ                                                
         MVI   REBUYDAT-1,MXTRTQ                                                
         MVI   REBUYTIM-1,MXTRTQ                                                
         MVC   REBUYTYP,REPBYHQ                                                 
         MVI   REBUYDX,MXTRTQ                                                   
         MVI   REBUYDX+1,MXTRTQ                                                 
         MVI   REBUYREP-1,MXTRTQ                                                
         MVI   REBUYCON-1,MXTRTQ                                                
         MVI   REBUYPLN-1,MXTRTQ                                                
         MVI   REBUYMLN-1,MXTRTQ                                                
         MVI   REBUYLIN-1,MXTRTQ                                                
         MVI   REBUYNW-1,MXTRTQ                                                 
         MVI   REBUYCOS-1,MXTRTQ                                                
         MVI   REBUYCLS-1,MXTRTQ                                                
         MVI   REBUYSEC-1,MXTRTQ                                                
         MVI   REBUYCRE-1,MXTRTQ                                                
         MVI   REBUYCRD-1,MXTRTQ                                                
         MVI   REBUYLCD-1,MXTRTQ                                                
         MVI   REBUYKMD-1,MXTRTQ                                                
         MVI   REBUYCHI-1,MXTRTQ                                                
         MVI   REBUYTSP-1,MXTRTQ                                                
         MVI   REBUYTCS-1,MXTRTQ                                                
         MVI   REBUYWKD-1,MXTRTQ                                                
         MVI   REBUYSTD-1,MXTRTQ                                                
         MVI   REBUYEND-1,MXTRTQ                                                
         MVI   REBUYDUR-1,MXTRTQ                                                
         MVI   REBUYMFG-1,MXTRTQ                                                
         MVI   REBUYSPT-1,MXTRTQ                                                
         MVI   REBUYSTY-1,MXTRTQ                                                
         MVI   REBUYFLT-1,MXTRTQ                                                
         MVI   REBUYVER-1,MXTRTQ                                                
         MVI   REBUYPTP-1,MXTRTQ                                                
         MVI   REBUYDPT-1,MXTRTQ                                                
         MVI   REBUYSTT-1,MXTRTQ                                                
         MVI   REBUYAGN-1,MXTRTQ                                                
         MVI   REBUYST2-1,MXTRTQ                                                
         MVI   REBUYRTS-1,MXTRTQ                                                
         MVI   REBUYDEL-1,MXTRTQ                                                
*                                                                               
B        USING REBUYD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBUYACT,B.REBUYACT                                              
         MVC   REBUYDAT,B.REBUYDAT                                              
         MVC   REBUYTIM,B.REBUYTIM                                              
         DROP  B                                                                
*                                                                               
         MVC   REBUYRTS(14),=C'19000101000000'                                  
         TR    REBUYRTS,MXTRT      SET REFRESHTS DEFAULT                        
*                                                                               
         MVI   REBUYDEL,C' '       SET DELETE FLAG DEFAULT                      
         TM    RBUYCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BZ    *+8                 NO                                           
         MVI   REBUYDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REBUYDEL,MXTRT                                                   
*                                                                               
         MVC   REBUYREP,RBUYKREP   REP COMPANY                                  
         TR    REBUYREP,MXTRT                                                   
*                                                                               
         PACK  WORK(1),RBUYKCON+3(1)                                            
         PACK  WORK+1(1),RBUYKCON+2(1)                                          
         PACK  WORK+2(1),RBUYKCON+1(1)                                          
         PACK  WORK+3(1),RBUYKCON(1)                                            
         ZAP   WORK+10(5),=P'0'                                                 
         MVO   WORK+10(5),WORK(4)  CHANGE TO PACK WITH SIGN                     
         ZAP   WORK+20(5),=P'99999999'                                          
         SP    WORK+20(5),WORK+10(5) GET 9'S COMPLEMENT                         
         EDIT  (P5,WORK+20),(8,REBUYCON),ALIGN=LEFT                             
         TR    REBUYCON,MXTRT                                                   
*                                                                               
         MVC   REBUYPLN,SPACES                                                  
         CLC   RBUYKPLN,=3X'FF'                                                 
         JE    *+10                                                             
         MVC   REBUYPLN,RBUYKPLN                                                
         TR    REBUYPLN,MXTRT                                                   
*                                                                               
         EDIT  RBUYKMLN,(3,REBUYMLN),FILL=0                                     
         TR    REBUYMLN,MXTRT                                                   
*                                                                               
         EDIT  RBUYKLIN,(3,REBUYLIN),FILL=0                                     
         TR    REBUYLIN,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
*                                                                               
         EDIT  RBUYNW,(3,REBUYNW),FILL=0                                        
         TR    REBUYNW,MXTRT                                                    
*                                                                               
         ICM   R1,15,RBUYCOS                                                    
         LTR   R1,R1                                                            
         BM    RBUY0030                                                         
         EDIT  RBUYCOS,(10,REBUYCOS),ZERO=NOBLANK,FILL=0,FLOAT=-                
         B     RBUY0040                                                         
*                                                                               
RBUY0030 EQU   *                                                                
         EDIT  RBUYCOS,(10,REBUYCOS),FLOAT=-                                    
*                                                                               
RBUY0040 EQU   *                                                                
         TR    REBUYCOS,MXTRT                                                   
*                                                                               
         MVC   REBUYCLS,RBUYCLS                                                 
         TR    REBUYCLS,MXTRT                                                   
*                                                                               
         MVC   REBUYSEC,RBUYSEC                                                 
         TR    REBUYSEC,MXTRT                                                   
*                                                                               
         GOTO1 DATCON,PLIST,(3,RBUYCREA),(10,REBUYCRE)                          
         TR    REBUYCRE,MXTRT                                                   
*                                                                               
         MVC   REBUYCRD,RBUYCARD                                                
         TR    REBUYCRD,MXTRT                                                   
*                                                                               
         MVC   REBUYLCD,REBUYCRE   DEFAULT = CREATION DATE                      
         OC    RBUYCHGD,RBUYCHGD                                                
         BZ    RBUY0045                                                         
         GOTO1 DATCON,PLIST,(3,RBUYCHGD),(10,REBUYLCD)                          
         TR    REBUYLCD,MXTRT                                                   
*                                                                               
RBUY0045 EQU   *                                                                
         MVC   REBUYKMD,=C'0-1'                                                 
         CLI   RBUYKMOD,X'FF'                                                   
         JE    RBUY0050                                                         
         EDIT  RBUYKMOD,(3,REBUYKMD),FILL=0                                     
RBUY0050 EQU   *                                                                
         TR    REBUYKMD,MXTRT                                                   
*                                                                               
         MVC   REBUYCHI,RBUYCHGI                                                
         TR    REBUYCHI,MXTRT                                                   
*                                                                               
         MVC   HALF,RBUYTSPT                                                    
         LH    R1,HALF                                                          
         LTR   R1,R1                                                            
         BM    RBUY0060                                                         
         EDIT  RBUYTSPT,(5,REBUYTSP),ZERO=NOBLANK,FILL=0,FLOAT=-                
         B     RBUY0070                                                         
*                                                                               
RBUY0060 EQU   *                                                                
         EDIT  RBUYTSPT,(5,REBUYTSP),FLOAT=-                                    
*                                                                               
RBUY0070 EQU   *                                                                
         TR    REBUYTSP,MXTRT                                                   
*                                                                               
         ICM   R1,15,RBUYTCOS                                                   
         LTR   R1,R1                                                            
         BM    RBUY0080                                                         
         EDIT  RBUYTCOS,(10,REBUYTCS),ZERO=NOBLANK,FILL=0,FLOAT=-               
         B     RBUY0090                                                         
*                                                                               
RBUY0080 EQU   *                                                                
         EDIT  RBUYTCOS,(10,REBUYTCS),FLOAT=-                                   
*                                                                               
RBUY0090 EQU   *                                                                
         TR    REBUYTCS,MXTRT                                                   
*                                                                               
         EDIT  RBUYTWKS,(3,REBUYWKD),FILL=0                                     
         TR    REBUYWKD,MXTRT                                                   
*                                                                               
         ZIC   RF,RBUYSTED                                                      
         SRL   RF,4                                                             
         STC   RF,REBUYSTD                                                      
         OI    REBUYSTD,X'F0'                                                   
         TR    REBUYSTD,MXTRT                                                   
*                                                                               
         MVI   REBUYEND,X'F0'                                                   
         MVN   REBUYEND,RBUYSTED                                                
         TR    REBUYEND,MXTRT                                                   
*                                                                               
         MVI   REBUYMFG,C'N'                                                    
         TM    RBUYDUR,X'80'                                                    
         BZ    *+8                                                              
         MVI   REBUYMFG,C'Y'                                                    
         TR    REBUYMFG,MXTRT                                                   
*                                                                               
         MVI   REBUYSPT,C'N'                                                    
         MVI   REBUYSTY,C' '                                                    
         TM    RBUYDUR,X'40'                                                    
         BZ    RBUY0100                                                         
         MVI   REBUYSPT,C'Y'                                                    
         MVC   REBUYSTY,RBUYDUR+1                                               
         B     RBUY0110                                                         
*                                                                               
RBUY0100 EQU   *                                                                
         MVC   WORK+20(2),RBUYDUR                                               
         NI    WORK+20,X'FF'-X'80'-X'40'                                        
         EDIT  (2,WORK+20),(5,REBUYDUR),FILL=0                                  
*                                                                               
RBUY0110 EQU   *                                                                
         TR    REBUYSPT,MXTRT                                                   
         TR    REBUYSTY,MXTRT                                                   
         TR    REBUYDUR,MXTRT                                                   
*                                                                               
         EDIT  RBUYFLT,(3,REBUYFLT),FILL=0                                      
         TR    REBUYFLT,MXTRT                                                   
         EDIT  RBUYVER,(3,REBUYVER),FILL=0                                      
         TR    REBUYVER,MXTRT                                                   
         MVC   REBUYPTP,RBUYTYP                                                 
         TR    REBUYPTP,MXTRT                                                   
         MVC   REBUYDPT,RBUYDPT                                                 
         TR    REBUYDPT,MXTRT                                                   
*                                                                               
         MVC   REBUYSTT,=C'NNNNNNNN'                                            
         TM    RBUYRTS,X'80'                                                    
         BZ    *+8                                                              
         MVI   REBUYSTT,C'Y'                                                    
         TM    RBUYRTS,X'40'                                                    
         BZ    *+8                                                              
         MVI   REBUYSTT+1,C'Y'                                                  
         TM    RBUYRTS,X'20'                                                    
         BZ    *+8                                                              
         MVI   REBUYSTT+2,C'Y'                                                  
         TM    RBUYRTS,X'10'                                                    
         BZ    *+8                                                              
         MVI   REBUYSTT+3,C'Y'                                                  
         TM    RBUYRTS,X'08'                                                    
         BZ    *+8                                                              
         MVI   REBUYSTT+4,C'Y'                                                  
         TM    RBUYRTS,X'04'                                                    
         BZ    *+8                                                              
         MVI   REBUYSTT+5,C'Y'                                                  
         TM    RBUYRTS,X'02'                                                    
         BZ    *+8                                                              
         MVI   REBUYSTT+6,C'Y'                                                  
         TM    RBUYRTS,X'01'                                                    
         BZ    *+8                                                              
         MVI   REBUYSTT+7,C'Y'                                                  
         TR    REBUYSTT,MXTRT                                                   
*                                                                               
         EDIT  RBUYAGBL,(3,REBUYAGN),FILL=0                                     
         TR    REBUYAGN,MXTRT                                                   
*                                                                               
         MVC   REBUYST2,=C'NNNNNNNN'                                            
         TM    RBUYFLG2,X'80'                                                   
         BZ    *+8                                                              
         MVI   REBUYST2,C'Y'                                                    
         TM    RBUYFLG2,X'40'                                                   
         BZ    *+8                                                              
         MVI   REBUYST2+1,C'Y'                                                  
         TM    RBUYFLG2,X'20'                                                   
         BZ    *+8                                                              
         MVI   REBUYST2+2,C'Y'                                                  
         TM    RBUYFLG2,X'10'                                                   
         BZ    *+8                                                              
         MVI   REBUYST2+3,C'Y'                                                  
         TM    RBUYFLG2,X'08'                                                   
         BZ    *+8                                                              
         MVI   REBUYST2+4,C'Y'                                                  
         TM    RBUYFLG2,X'04'                                                   
         BZ    *+8                                                              
         MVI   REBUYST2+5,C'Y'                                                  
         TM    RBUYFLG2,X'02'                                                   
         BZ    *+8                                                              
         MVI   REBUYST2+6,C'Y'                                                  
         TM    RBUYFLG2,X'01'                                                   
         BZ    *+8                                                              
         MVI   REBUYST2+7,C'Y'                                                  
         TR    REBUYST2,MXTRT                                                   
*                                                                               
RBUY0360 EQU   *                                                                
         J     EXITR2                                                           
         DROP  R2,R6                                                            
         LTORG                                                                  
*---------------------------------------------------------------------*         
* GENERATE $0 BUCKETS WITH LAST CHANGED DATE FOR STANDARD BROADCAST             
* CALENDAR ONLY                                                                 
* MO REPORT APP NEEDS THIS REFERENCE TO LINK TO CONTRACT BUCKETS                
* R3 HAS BUY RECORD                                                             
*---------------------------------------------------------------------*         
RXGENZBK NTR1  BASE=*,LABEL=*                                                   
         XC    BUCKETS,BUCKETS                                                  
         XC    WORK,WORK                                                        
         MVC   WORK(4),GETBROAD                                                 
         MVC   WORK+4(4),VGETDAY                                                
         MVC   WORK+8(4),VADDAY                                                 
         MVC   WORK+12(4),DATCON                                                
*                                                                               
         LR    R6,R3               'FROM' ADDRESS                               
         LH    R7,27(R6)           'FROM' LENGTH                                
         LA    RE,MYIO             'TO' ADDRESS                                 
         LR    RF,R7               'TO' LENGTH = 'FROM' LENGTH                  
         MVCL  (RE),(R6)                                                        
         LA    R6,MYIO                                                          
         LH    R7,27(R6)                                                        
         AR    R6,R7                                                            
         MVI   0(R6),0                                                          
*                                                                               
*        LR    R6,R3                                                            
         LA    R6,MYIO                                                          
         USING RBUYREC,R6                                                       
         ICM   R7,15,RBUYCOS                                                    
         OC    RBUYCOS,RBUYCOS     BONUS SPOTS?                                 
         BNZ   *+10                STICK A PENNY IN SO WE GET BUCKETS           
         MVC   RBUYCOS,=X'00000001'                                             
         DROP  R6                                                               
*                                                                               
         MVI   ELCODE,X'03'                                                     
         BAS   RE,GETEL                                                         
         BNE   RXGENZ30                                                         
         USING RBUYDTEL,R6                                                      
RXGENZ10 CLI   RBUYDTNW,0          NEED TO PUT AT LEAST 1 SPOT IN SO            
         BNE   RXGENZ30            REGENBUC WILL CREATE BUCKETS FOR             
         MVI   RBUYDTNW,1          THOSE WEEKS                                  
         BAS   RE,NEXTEL                                                        
         BE    RXGENZ10                                                         
         DROP  R6                                                               
*                                                                               
RXGENZ30 DS    0H                                                               
         GOTO1 VREGENBC,DMCB,MYIO,BUCKETS,(X'80',WORK)                          
         LA    R4,BUCKETS+2                                                     
*                                                                               
RXGENZ40 DS    0H                                                               
         CLI   0(R4),0                                                          
         BE    RXGENZ60                                                         
         MVI   FRSTPASS,C'N'                                                    
         CLI   KILLMODE,C'Y'                                                    
         BE    RXGENZ45                                                         
         MVI   FRSTPASS,C'Y'                                                    
         BRAS  RE,RXBUYZBK                                                      
         MVI   FRSTPASS,C'N'                                                    
         BRAS  RE,RXBUYZBK                                                      
         B     RXGENZ50                                                         
*                                                                               
RXGENZ45 DS    0H                                                               
         BRAS  RE,RXBUYZBK                                                      
*                                                                               
RXGENZ50 DS    0H                                                               
         LA    R4,14(R4)                                                        
         B     RXGENZ40                                                         
*                                                                               
RXGENZ60 DS    0H                                                               
*&&DO                                                                           
         LTR   R7,R7                                                            
         BNZ   RXGENZX             ALL DONE, REMOVE PENNY                       
         XC    RBUYCOS,RBUYCOS                                                  
         DROP  R6                                                               
*&&                                                                             
*                                                                               
RXGENZX  DS    0H                                                               
         J     EXITR2                                                           
*                                                                               
*---------------------------------------------------------------------*         
* BUILD $0 DOL RECORD                                                           
* R3 POINTS TO BUY RECORD                                                       
* R4 POINTS TO BUCKETS                                                          
*---------------------------------------------------------------------*         
RXBUYZBK NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING REDOLD,R2           R2=A(EXTRACT RECORD)                         
         USING RBUYREC,R3                                                       
*                                                                               
         XC    REDOLLEN,REDOLLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REDOLLEN(2),=AL2(REDOLDL)                                        
         MVC   REDOLTYP,REPDOLQ                                                 
         MVI   REDOLACT-1,MXTRTQ                                                
         MVI   REDOLDAT-1,MXTRTQ                                                
         MVI   REDOLTME-1,MXTRTQ                                                
         MVI   REDOLDX,MXTRTQ                                                   
         MVI   REDOLDX+1,MXTRTQ                                                 
         MVI   REDOLREP-1,MXTRTQ                                                
         MVI   REDOLCON-1,MXTRTQ                                                
         MVI   REDOLFLG-1,MXTRTQ                                                
         MVI   REDOLMON-1,MXTRTQ                                                
         MVI   REDOLACD-1,MXTRTQ                                                
         MVI   REDOLDOL-1,MXTRTQ                                                
         MVI   REDOLADL-1,MXTRTQ                                                
         MVI   REDOLXRE-1,MXTRTQ                                                
         MVI   REDOLBTP-1,MXTRTQ                                                
         MVI   REDOLBTX-1,MXTRTQ                                                
         MVI   REDOLRTS-1,MXTRTQ                                                
         MVI   REDOLDEL-1,MXTRTQ                                                
*                                                                               
         MVI   REDOLFLG,C'Z'       SET SPECIAL FLAG                             
         CLI   KILLMODE,C'Y'                                                    
         BE    RXBUYZ10                                                         
         CLI   FRSTPASS,C'Y'                                                    
         BNE   RXBUYZ10                                                         
         MVI   REDOLFLG,C'X'       SET SPECIAL FLAG                             
*                                                                               
RXBUYZ10 DS    0H                                                               
         TR    REDOLFLG,MXTRT                                                   
*                                                                               
         MVI   REDOLBTP,C'C'       SET BUCKET TYPE FLAG                         
         TM    RBUYFLG2,X'02'      TRADE?                                       
         BZ    *+8                                                              
         MVI   REDOLBTP,C'T'       SET BUCKET TYPE FLAG                         
         TR    REDOLBTP,MXTRT                                                   
*                                                                               
         MVI   REDOLBTX,C'B'       SET BUCKET SUBTYPE                           
         TR    REDOLBTX,MXTRT                                                   
*                                                                               
         MVC   REDOLRTS(14),=C'19000101000000'                                  
         TR    REDOLRTS,MXTRT                                                   
*                                                                               
         MVI   REDOLDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REDOLDEL,MXTRT                                                   
*                                                                               
B        USING REBUYD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REDOLACT,B.REBUYACT                                              
         MVC   REDOLDAT,B.REBUYDAT                                              
         MVC   REDOLTME,B.REBUYTIM                                              
         DROP  B                                                                
*                                                                               
         MVC   REDOLREP,RBUYKREP   REPCODE                                      
         TR    REDOLREP,MXTRT                                                   
*                                                                               
         PACK  WORK(1),RBUYKCON+3(1)                                            
         PACK  WORK+1(1),RBUYKCON+2(1)                                          
         PACK  WORK+2(1),RBUYKCON+1(1)                                          
         PACK  WORK+3(1),RBUYKCON(1)                                            
         ZAP   WORK+10(5),=P'0'                                                 
         MVO   WORK+10(5),WORK(4)  CHANGE TO PACK WITH SIGN                     
         ZAP   WORK+20(5),=P'99999999'                                          
         SP    WORK+20(5),WORK+10(5) GET 9'S COMPLEMENT                         
         EDIT  (P5,WORK+20),(8,REDOLCON),ALIGN=LEFT                             
         TR    REDOLCON,MXTRT                                                   
*                                                                               
         MVI   REDOLXRE,C'N'                                                    
         TR    REDOLXRE,MXTRT                                                   
*                                                                               
         MVC   REDOLDOL,=CL12'0'   CLEAR THE MONEY                              
         TR    REDOLDOL,MXTRT                                                   
*                                                                               
         MVC   REDOLADL,=CL12'0'   CLEAR THE MONEY                              
         TR    REDOLADL,MXTRT                                                   
*                                                                               
* BUCKET DATES                                                                  
*                                                                               
         LA    R6,RBUYCREA                                                      
         OC    RBUYCHGD,RBUYCHGD                                                
         BZ    *+8                                                              
         LA    R6,RBUYCHGD                                                      
         GOTO1 DATCON,PLIST,(3,0(R6)),(10,REDOLACD)                             
*                                                                               
         MVC   WORK(2),2(R4)       EXTRACT MONTH OF SERVICE                     
         MVI   WORK+2,1            SET DAY IN MONTH                             
         GOTO1 DATCON,PLIST,(3,WORK),(10,REDOLMON)                              
*                                                                               
         TR    REDOLMON,MXTRT                                                   
         TR    REDOLACD,MXTRT                                                   
*                                                                               
         AHI   R2,REDOLDL          CLEAR NEXT RECORD FOR SAFTEY                 
         XC    0(8,R2),0(R2)                                                    
         J     EXITR2                                                           
         DROP  R2,R3                                                            
         LTORG                                                                  
*---------------------------------------------------------------------*         
* BUY DAY/TIME                                                                  
*---------------------------------------------------------------------*         
RXBUYDT  NTR1  LABEL=*,BASE=*                                                   
*                                                                               
         USING REBDTD,R2           R2=A(EXTRACT RECORD)                         
         LR    R4,R6                                                            
         LR    R6,R3                                                            
         USING RBUYREC,R6                                                       
*                                                                               
         LA    R0,REBDTD           CLEAR THE RECORD                             
         LA    R1,REBDTDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBDTLEN,REBDTLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBDTLEN(2),=AL2(REBDTDL)                                        
         MVI   REBDTACT-1,MXTRTQ                                                
         MVI   REBDTDAT-1,MXTRTQ                                                
         MVI   REBDTTIM-1,MXTRTQ                                                
         MVC   REBDTTYP,REPBDTQ                                                 
         MVI   REBDTDX,MXTRTQ                                                   
         MVI   REBDTDX+1,MXTRTQ                                                 
         MVI   REBDTREP-1,MXTRTQ                                                
         MVI   REBDTCON-1,MXTRTQ                                                
         MVI   REBDTSTR-1,MXTRTQ                                                
         MVI   REBDTEND-1,MXTRTQ                                                
         MVI   REBDTDYS-1,MXTRTQ                                                
         MVI   REBDTTM1-1,MXTRTQ                                                
         MVI   REBDTTM2-1,MXTRTQ                                                
         MVI   REBDTSSB-1,MXTRTQ                                                
         MVI   REBDTWTF-1,MXTRTQ                                                
         MVI   REBDTRTS-1,MXTRTQ                                                
         MVI   REBDTDEL-1,MXTRTQ                                                
*                                                                               
B        USING REBDTD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBDTACT,B.REBDTACT                                              
         MVC   REBDTDAT,B.REBDTDAT                                              
         MVC   REBDTTIM,B.REBDTTIM                                              
         DROP  B                                                                
*                                                                               
         MVC   REBDTRTS(14),=C'19000101000000'                                  
         TR    REBDTRTS,MXTRT      SET REFRESHTS DEFAULT                        
*                                                                               
         MVI   REBDTDEL,C' '       SET DELETE FLAG DEFAULT                      
         TM    RBUYCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BZ    *+8                 NO                                           
         MVI   REBDTDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REBDTDEL,MXTRT                                                   
*                                                                               
         MVC   REBDTREP,RBUYKREP   REP COMPANY                                  
         TR    REBDTREP,MXTRT                                                   
*                                                                               
         PACK  WORK(1),RBUYKCON+3(1)                                            
         PACK  WORK+1(1),RBUYKCON+2(1)                                          
         PACK  WORK+2(1),RBUYKCON+1(1)                                          
         PACK  WORK+3(1),RBUYKCON(1)                                            
         ZAP   WORK+10(5),=P'0'                                                 
         MVO   WORK+10(5),WORK(4)  CHANGE TO PACK WITH SIGN                     
         ZAP   WORK+20(5),=P'99999999'                                          
         SP    WORK+20(5),WORK+10(5) GET 9'S COMPLEMENT                         
         EDIT  (P5,WORK+20),(8,REBDTCON),ALIGN=LEFT                             
         TR    REBDTCON,MXTRT                                                   
*                                                                               
         EDIT  RBUYKLIN,(3,REBDTLIN),FILL=0                                     
         TR    REBDTLIN,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
*                                                                               
         LR    R6,R4                                                            
         USING RBUYDYEL,R6                                                      
         ZIC   RF,RBUYDYIN                                                      
         SRL   RF,4                                                             
         STC   RF,REBDTSTR                                                      
         OI    REBDTSTR,X'F0'                                                   
         TR    REBDTSTR,MXTRT                                                   
*                                                                               
         MVI   REBDTEND,X'F0'                                                   
         MVN   REBDTEND,RBUYDYIN                                                
         TR    REBDTEND,MXTRT                                                   
*                                                                               
         MVC   REBDTDYS,=C'NNNNNNNN'                                            
         TM    RBUYDAYS,X'80'                                                   
         BZ    *+8                                                              
         MVI   REBDTDYS,C'Y'                                                    
         TM    RBUYDAYS,X'40'                                                   
         BZ    *+8                                                              
         MVI   REBDTDYS+1,C'Y'                                                  
         TM    RBUYDAYS,X'20'                                                   
         BZ    *+8                                                              
         MVI   REBDTDYS+2,C'Y'                                                  
         TM    RBUYDAYS,X'10'                                                   
         BZ    *+8                                                              
         MVI   REBDTDYS+3,C'Y'                                                  
         TM    RBUYDAYS,X'08'                                                   
         BZ    *+8                                                              
         MVI   REBDTDYS+4,C'Y'                                                  
         TM    RBUYDAYS,X'04'                                                   
         BZ    *+8                                                              
         MVI   REBDTDYS+5,C'Y'                                                  
         TM    RBUYDAYS,X'02'                                                   
         BZ    *+8                                                              
         MVI   REBDTDYS+6,C'Y'                                                  
         TM    RBUYDAYS,X'01'                                                   
         BZ    *+8                                                              
         MVI   REBDTDYS+7,C'Y'                                                  
         TR    REBDTDYS,MXTRT                                                   
*                                                                               
         MVI   REBDTSSB,C'Y'                                                    
         CLC   RBUYDYT1(4),=4X'FF'                                              
         JE    RBDT0100                                                         
         MVI   REBDTSSB,C'N'                                                    
         EDIT  RBUYDYT1,(4,REBDTTM1),FILL=0                                     
         EDIT  RBUYDYT2,(4,REBDTTM2),FILL=0                                     
*                                                                               
RBDT0100 DS    0H                                                               
         TR    REBDTTM1,MXTRT                                                   
         TR    REBDTTM2,MXTRT                                                   
         TR    REBDTSSB,MXTRT                                                   
         EDIT  RBUYDYWT,(3,REBDTWTF),FILL=0                                     
         TR    REBDTWTF,MXTRT                                                   
RBDTX    EQU   *                                                                
         J     EXITR2                                                           
         DROP  R2,R6                                                            
         LTORG                                                                  
*                                                                               
RXBUYED  NTR1  LABEL=*,BASE=*                                                   
*                                                                               
         USING REBEDD,R2           R2=A(EXTRACT RECORD)                         
         LR    R4,R6                                                            
         LR    R6,R3                                                            
         USING RBUYREC,R6                                                       
*                                                                               
         LA    R0,REBEDD           CLEAR THE RECORD                             
         LA    R1,REBEDTDL                                                      
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBEDLEN,REBEDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBEDLEN(2),=AL2(REBEDTDL)                                       
         MVI   REBEDACT-1,MXTRTQ                                                
         MVI   REBEDDAT-1,MXTRTQ                                                
         MVI   REBEDTIM-1,MXTRTQ                                                
         MVC   REBEDTYP,REPBEDQ                                                 
         MVI   REBEDX,MXTRTQ                                                    
         MVI   REBEDX+1,MXTRTQ                                                  
         MVI   REBEDREP-1,MXTRTQ                                                
         MVI   REBEDCON-1,MXTRTQ                                                
         MVI   REBEDSTR-1,MXTRTQ                                                
         MVI   REBEDEND-1,MXTRTQ                                                
         MVI   REBEDALT-1,MXTRTQ                                                
         MVI   REBEDNPO-1,MXTRTQ                                                
         MVI   REBEDNPW-1,MXTRTQ                                                
         MVI   REBEDNOW-1,MXTRTQ                                                
         MVI   REBEDRTS-1,MXTRTQ                                                
         MVI   REBEDDEL-1,MXTRTQ                                                
*                                                                               
B        USING REBEDD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBEDACT,B.REBEDACT                                              
         MVC   REBEDDAT,B.REBEDDAT                                              
         MVC   REBEDTIM,B.REBEDTIM                                              
         DROP  B                                                                
*                                                                               
         MVC   REBEDRTS(14),=C'19000101000000'                                  
         TR    REBEDRTS,MXTRT      SET REFRESHTS DEFAULT                        
*                                                                               
         MVI   REBEDDEL,C' '       SET DELETE FLAG DEFAULT                      
         TM    RBUYCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BZ    *+8                 NO                                           
         MVI   REBEDDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REBEDDEL,MXTRT                                                   
*                                                                               
         MVC   REBEDREP,RBUYKREP   REP COMPANY                                  
         TR    REBEDREP,MXTRT                                                   
*                                                                               
         PACK  WORK(1),RBUYKCON+3(1)                                            
         PACK  WORK+1(1),RBUYKCON+2(1)                                          
         PACK  WORK+2(1),RBUYKCON+1(1)                                          
         PACK  WORK+3(1),RBUYKCON(1)                                            
         ZAP   WORK+10(5),=P'0'                                                 
         MVO   WORK+10(5),WORK(4)  CHANGE TO PACK WITH SIGN                     
         ZAP   WORK+20(5),=P'99999999'                                          
         SP    WORK+20(5),WORK+10(5) GET 9'S COMPLEMENT                         
         EDIT  (P5,WORK+20),(8,REBEDCON),ALIGN=LEFT                             
         TR    REBEDCON,MXTRT                                                   
*                                                                               
         EDIT  RBUYKLIN,(3,REBEDLIN),FILL=0                                     
         TR    REBEDLIN,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
*                                                                               
* SET DEFAULTS                                                                  
*                                                                               
         MVI   REBEDALT,C'N'                                                    
         MVI   REBEDNPO,C'N'                                                    
*                                                                               
         LR    R6,R4                                                            
         USING RBUYDTEL,R6                                                      
*                                                                               
         GOTO1 DATCON,PLIST,(3,RBUYDTST),(10,REBEDSTR)                          
         TR    REBEDSTR,MXTRT                                                   
*                                                                               
* PLAN RECORDS HAVE NO END DATE, SO USE START DATE                              
*                                                                               
BUYKEYD  USING RBUYREC,R3                                                       
         CLC   BUYKEYD.RBUYKPLN,=3X'FF'                                         
         JE    RBED10                                                           
         CLC   BUYKEYD.RBUYKMLN(2),=2X'FF'                                      
         BNE   RBED10                                                           
         MVC   REBEDEND,REBEDSTR                                                
         MVC   REBEDNPW,=3C'0'                                                  
         MVC   REBEDNOW,=3C'0'                                                  
         B     RBED30                                                           
         DROP  BUYKEYD                                                          
*                                                                               
RBED10   DS    0H                                                               
         GOTO1 DATCON,PLIST,(3,RBUYDTED),(10,REBEDEND)                          
*                                                                               
RBED20   DS    0H                                                               
         TM    RBUYDTIN,X'40'                                                   
         BZ    *+8                                                              
         MVI   REBEDALT,C'Y'                                                    
*                                                                               
         TM    RBUYDTIN,X'01'                                                   
         BZ    *+8                                                              
         MVI   REBEDNPO,C'Y'                                                    
*                                                                               
         EDIT  RBUYDTNW,(3,REBEDNPW),FILL=0                                     
         EDIT  RBUYDTWK,(3,REBEDNOW),FILL=0                                     
*                                                                               
RBED30   DS    0H                                                               
         TR    REBEDEND,MXTRT                                                   
         TR    REBEDALT,MXTRT                                                   
         TR    REBEDNPO,MXTRT                                                   
         TR    REBEDNPW,MXTRT                                                   
         TR    REBEDNOW,MXTRT                                                   
*                                                                               
RBEDX    DS    0H                                                               
         J     EXITR2                                                           
         LTORG                                                                  
RXBUYCM  NTR1  LABEL=*,BASE=*                                                   
*                                                                               
         USING REBCMD,R2           R2=A(EXTRACT RECORD)                         
         LR    R4,R6                                                            
         LR    R6,R3                                                            
         USING RBUYREC,R6                                                       
*                                                                               
         LA    R0,REBCMD           CLEAR THE RECORD                             
         LA    R1,REBCMDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBCMLEN,REBCMLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBCMLEN(2),=AL2(REBCMDL)                                        
         MVI   REBCMACT-1,MXTRTQ                                                
         MVI   REBCMDAT-1,MXTRTQ                                                
         MVI   REBCMTIM-1,MXTRTQ                                                
         MVC   REBCMTYP,REPBYCQ                                                 
         MVI   REBCMX,MXTRTQ                                                    
         MVI   REBCMX+1,MXTRTQ                                                  
         MVI   REBCMREP-1,MXTRTQ                                                
         MVI   REBCMCON-1,MXTRTQ                                                
         MVI   REBCMCMT-1,MXTRTQ                                                
         MVI   REBCMRTS-1,MXTRTQ                                                
         MVI   REBCMDEL-1,MXTRTQ                                                
*                                                                               
B        USING REBCMD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBCMACT,B.REBCMACT                                              
         MVC   REBCMDAT,B.REBCMDAT                                              
         MVC   REBCMTIM,B.REBCMTIM                                              
         DROP  B                                                                
*                                                                               
         MVC   REBCMRTS(14),=C'19000101000000'                                  
         TR    REBCMRTS,MXTRT      SET REFRESHTS DEFAULT                        
*                                                                               
         MVI   REBCMDEL,C' '       SET DELETE FLAG DEFAULT                      
         TM    RBUYCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BZ    *+8                 NO                                           
         MVI   REBCMDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REBCMDEL,MXTRT                                                   
*                                                                               
         MVC   REBCMREP,RBUYKREP   REP COMPANY                                  
         TR    REBCMREP,MXTRT                                                   
*                                                                               
         PACK  WORK(1),RBUYKCON+3(1)                                            
         PACK  WORK+1(1),RBUYKCON+2(1)                                          
         PACK  WORK+2(1),RBUYKCON+1(1)                                          
         PACK  WORK+3(1),RBUYKCON(1)                                            
         ZAP   WORK+10(5),=P'0'                                                 
         MVO   WORK+10(5),WORK(4)  CHANGE TO PACK WITH SIGN                     
         ZAP   WORK+20(5),=P'99999999'                                          
         SP    WORK+20(5),WORK+10(5) GET 9'S COMPLEMENT                         
         EDIT  (P5,WORK+20),(8,REBCMCON),ALIGN=LEFT                             
         TR    REBCMCON,MXTRT                                                   
*                                                                               
         EDIT  RBUYKLIN,(3,REBCMLIN),FILL=0                                     
         TR    REBCMLIN,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
*                                                                               
         LR    R6,R4                                                            
         USING RBUYCMEL,R6                                                      
*                                                                               
         MVC   REBCMCMT,SPACES                                                  
         ZIC   R1,RBUYCMLN                                                      
         CHI   R1,3                                                             
         JL    EXITR2                                                           
         SHI   R1,3                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   REBCMCMT(0),RBUYCMNT                                             
         TR    REBCMCMT,MXTRT                                                   
*                                                                               
RBCMX    DS    0H                                                               
         J     EXITR2                                                           
         DROP  R6                                                               
         LTORG                                                                  
RXBUYDD  NTR1  LABEL=*,BASE=*                                                   
*                                                                               
         USING REBDDD,R2           R2=A(EXTRACT RECORD)                         
         LR    R4,R6                                                            
         LR    R6,R3                                                            
         USING RBUYREC,R6                                                       
*                                                                               
         LA    R0,REBDDD           CLEAR THE RECORD                             
         LA    R1,REBDDDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBDDLEN,REBDDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBDDLEN(2),=AL2(REBDDDL)                                        
         MVI   REBDDACT-1,MXTRTQ                                                
         MVI   REBDDDAT-1,MXTRTQ                                                
         MVI   REBDDTIM-1,MXTRTQ                                                
         MVC   REBDDTYP,REPBADQ                                                 
         MVI   REBDDX,MXTRTQ                                                    
         MVI   REBDDX+1,MXTRTQ                                                  
         MVI   REBDDREP-1,MXTRTQ                                                
         MVI   REBDDCON-1,MXTRTQ                                                
         MVI   REBDDCAT-1,MXTRTQ                                                
         MVI   REBDDVAL-1,MXTRTQ                                                
         MVI   REBDDPVL-1,MXTRTQ                                                
         MVI   REBDDRTS-1,MXTRTQ                                                
         MVI   REBDDDEL-1,MXTRTQ                                                
*                                                                               
B        USING REBDDD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBDDACT,B.REBDDACT                                              
         MVC   REBDDDAT,B.REBDDDAT                                              
         MVC   REBDDTIM,B.REBDDTIM                                              
         DROP  B                                                                
*                                                                               
         MVC   REBDDRTS(14),=C'19000101000000'                                  
         TR    REBDDRTS,MXTRT      SET REFRESHTS DEFAULT                        
*                                                                               
         MVI   REBDDDEL,C' '       SET DELETE FLAG DEFAULT                      
         TM    RBUYCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BZ    *+8                 NO                                           
         MVI   REBDDDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REBDDDEL,MXTRT                                                   
*                                                                               
         MVC   REBDDREP,RBUYKREP   REP COMPANY                                  
         TR    REBDDREP,MXTRT                                                   
*                                                                               
         PACK  WORK(1),RBUYKCON+3(1)                                            
         PACK  WORK+1(1),RBUYKCON+2(1)                                          
         PACK  WORK+2(1),RBUYKCON+1(1)                                          
         PACK  WORK+3(1),RBUYKCON(1)                                            
         ZAP   WORK+10(5),=P'0'                                                 
         MVO   WORK+10(5),WORK(4)  CHANGE TO PACK WITH SIGN                     
         ZAP   WORK+20(5),=P'99999999'                                          
         SP    WORK+20(5),WORK+10(5) GET 9'S COMPLEMENT                         
         EDIT  (P5,WORK+20),(8,REBDDCON),ALIGN=LEFT                             
         TR    REBDDCON,MXTRT                                                   
*                                                                               
         EDIT  RBUYKLIN,(3,REBDDLIN),FILL=0                                     
         TR    REBDDLIN,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
*                                                                               
         LR    R6,R4                                                            
         USING RBUYDMEL,R6                                                      
         LA    R4,RBUYDMCT         CHECK FOR PRIMARY DEMO, IF ANY               
*                                  ELSE TAKE FIRST DEMO AS PRIMARY              
         CLC   3(4,R4),=AL4(-1)                                                 
         BE    RBDD50              SKIP DISPLAY FOR -1 (NO DEMO)                
         ZAP   WORK+20(5),=P'0'                                                 
         MVO   WORK+20(5),3(4,R4)                                               
         EDIT  (P5,WORK+20),(8,REBDDVAL),1,ALIGN=LEFT,ZERO=NOBLANK              
*                                                                               
RBDD50   DS    0H                                                               
         CLC   7(4,R4),=AL4(-1)                                                 
         BE    RBDD70              SKIP DISPLAY FOR -1 (NO DEMO)                
         ZAP   WORK+20(5),=P'0'                                                 
         MVO   WORK+20(5),7(4,R4)                                               
         EDIT  (P5,WORK+20),(8,REBDDPVL),1,ALIGN=LEFT,ZERO=NOBLANK              
*                                                                               
RBDD70   DS    0H                                                               
         TR    REBDDVAL,MXTRT                                                   
         TR    REBDDPVL,MXTRT                                                   
*                                                                               
         MVC   WORK(3),RBUYDMCT   AS DEFAULT                                    
*                                                                               
         CLI   WORK+1,C'T'         FUDGE FOR DEMOCON                            
         BNE   *+8                                                              
         MVI   WORK+1,C'I'                                                      
*                                                                               
         LA    R4,WORK+10                                                       
         USING DBLOCK,R4                                                        
         XC    DBLOCK,DBLOCK                                                    
         MVC   DBFILE,=C'INV'                                                   
         MVC   DBCOMFCS,COMFACS                                                 
         MVI   DBSELMED,C'T'                                                    
*                                                                               
         GOTO1 DEMOCON,DMCB,(1,WORK),(2,REBDDCAT),(0,WORK+10)                   
*                                                                               
         TR    REBDDCAT,MXTRT                                                   
         DROP  R4                                                               
*                                                                               
RBDDX    DS    0H                                                               
         J     EXITR2                                                           
         LTORG                                                                  
RXBUYRD  NTR1  LABEL=*,BASE=*                                                   
*                                                                               
         USING REBRDD,R2           R2=A(EXTRACT RECORD)                         
         LR    R4,R6                                                            
         LR    R6,R3                                                            
         USING RBUYREC,R6                                                       
*                                                                               
         LA    R0,REBRDD           CLEAR THE RECORD                             
         LA    R1,REBRDDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBRDLEN,REBRDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBRDLEN(2),=AL2(REBRDDL)                                        
         MVI   REBRDACT-1,MXTRTQ                                                
         MVI   REBRDDAT-1,MXTRTQ                                                
         MVI   REBRDTIM-1,MXTRTQ                                                
         MVC   REBRDTYP,REPBRDQ                                                 
         MVI   REBRDX,MXTRTQ                                                    
         MVI   REBRDX+1,MXTRTQ                                                  
         MVI   REBRDREP-1,MXTRTQ                                                
         MVI   REBRDCON-1,MXTRTQ                                                
         MVI   REBRDCAT-1,MXTRTQ                                                
         MVI   REBRDVAL-1,MXTRTQ                                                
         MVI   REBRDPVL-1,MXTRTQ                                                
         MVI   REBRDRTS-1,MXTRTQ                                                
         MVI   REBRDDEL-1,MXTRTQ                                                
*                                                                               
B        USING REBRDD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBRDACT,B.REBRDACT                                              
         MVC   REBRDDAT,B.REBRDDAT                                              
         MVC   REBRDTIM,B.REBRDTIM                                              
         DROP  B                                                                
*                                                                               
         MVC   REBRDRTS(14),=C'19000101000000'                                  
         TR    REBRDRTS,MXTRT      SET REFRESHTS DEFAULT                        
*                                                                               
         MVI   REBRDDEL,C' '       SET DELETE FLAG DEFAULT                      
         TM    RBUYCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BZ    *+8                 NO                                           
         MVI   REBRDDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REBRDDEL,MXTRT                                                   
*                                                                               
         MVC   REBRDREP,RBUYKREP   REP COMPANY                                  
         TR    REBRDREP,MXTRT                                                   
*                                                                               
         PACK  WORK(1),RBUYKCON+3(1)                                            
         PACK  WORK+1(1),RBUYKCON+2(1)                                          
         PACK  WORK+2(1),RBUYKCON+1(1)                                          
         PACK  WORK+3(1),RBUYKCON(1)                                            
         ZAP   WORK+10(5),=P'0'                                                 
         MVO   WORK+10(5),WORK(4)  CHANGE TO PACK WITH SIGN                     
         ZAP   WORK+20(5),=P'99999999'                                          
         SP    WORK+20(5),WORK+10(5) GET 9'S COMPLEMENT                         
         EDIT  (P5,WORK+20),(8,REBRDCON),ALIGN=LEFT                             
         TR    REBRDCON,MXTRT                                                   
*                                                                               
         EDIT  RBUYKLIN,(3,REBRDLIN),FILL=0                                     
         TR    REBRDLIN,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
*                                                                               
         LR    R6,R4                                                            
         USING RBUYRDEL,R6                                                      
         LA    R4,RBUYRDCT         CHECK FOR PRIMARY DEMO, IF ANY               
*                                  ELSE TAKE FIRST DEMO AS PRIMARY              
         CLC   3(4,R4),=AL4(-1)                                                 
         BE    RBRD50              SKIP DISPLAY FOR -1 (NO DEMO)                
         ZAP   WORK+20(5),=P'0'                                                 
         MVO   WORK+20(5),3(4,R4)                                               
         EDIT  (P5,WORK+20),(8,REBRDVAL),1,ALIGN=LEFT,ZERO=NOBLANK              
*                                                                               
RBRD50   DS    0H                                                               
         CLC   7(4,R4),=AL4(-1)                                                 
         BE    RBRD70              SKIP DISPLAY FOR -1 (NO DEMO)                
         ZAP   WORK+20(5),=P'0'                                                 
         MVO   WORK+20(5),7(4,R4)                                               
         EDIT  (P5,WORK+20),(8,REBRDPVL),1,ALIGN=LEFT,ZERO=NOBLANK              
*                                                                               
RBRD70   DS    0H                                                               
         TR    REBRDVAL,MXTRT                                                   
         TR    REBRDPVL,MXTRT                                                   
*                                                                               
         MVC   WORK(3),RBUYRDCT   AS DEFAULT                                    
*                                                                               
         CLI   WORK+1,C'T'         FUDGE FOR DEMOCON                            
         BNE   *+8                                                              
         MVI   WORK+1,C'I'                                                      
*                                                                               
         LA    R4,WORK+10                                                       
         USING DBLOCK,R4                                                        
         XC    DBLOCK,DBLOCK                                                    
         MVC   DBFILE,=C'INV'                                                   
         MVC   DBCOMFCS,COMFACS                                                 
         MVI   DBSELMED,C'T'                                                    
*                                                                               
         GOTO1 DEMOCON,DMCB,(1,WORK),(2,REBRDCAT),(0,WORK+10)                   
         DROP  R4                                                               
*                                                                               
         TR    REBRDCAT,MXTRT                                                   
*                                                                               
RBRDX    DS    0H                                                               
         J     EXITR2                                                           
         LTORG                                                                  
RXBUYPT  NTR1  LABEL=*,BASE=*                                                   
*                                                                               
         USING REBPTD,R2           R2=A(EXTRACT RECORD)                         
         LR    R4,R6                                                            
         LR    R6,R3                                                            
         USING RBUYREC,R6                                                       
*                                                                               
         LA    R0,REBPTD           CLEAR THE RECORD                             
         LA    R1,REBPTDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBPTLEN,REBPTLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBPTLEN(2),=AL2(REBPTDL)                                        
         MVI   REBPTACT-1,MXTRTQ                                                
         MVI   REBPTDAT-1,MXTRTQ                                                
         MVI   REBPTTIM-1,MXTRTQ                                                
         MVC   REBPTTYP,REPBPTQ                                                 
         MVI   REBPTX,MXTRTQ                                                    
         MVI   REBPTX+1,MXTRTQ                                                  
         MVI   REBPTREP-1,MXTRTQ                                                
         MVI   REBPTCON-1,MXTRTQ                                                
         MVI   REBPTPT-1,MXTRTQ                                                 
         MVI   REBPTNOT-1,MXTRTQ                                                
         MVI   REBPTFLG-1,MXTRTQ                                                
         MVI   REBPTRTS-1,MXTRTQ                                                
         MVI   REBPTDEL-1,MXTRTQ                                                
*                                                                               
B        USING REBPTD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBPTACT,B.REBPTACT                                              
         MVC   REBPTDAT,B.REBPTDAT                                              
         MVC   REBPTTIM,B.REBPTTIM                                              
         DROP  B                                                                
*                                                                               
         MVC   REBPTRTS(14),=C'19000101000000'                                  
         TR    REBPTRTS,MXTRT      SET REFRESHTS DEFAULT                        
*                                                                               
         MVI   REBPTDEL,C' '       SET DELETE FLAG DEFAULT                      
         TM    RBUYCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BZ    *+8                 NO                                           
         MVI   REBPTDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REBPTDEL,MXTRT                                                   
*                                                                               
         MVC   REBPTREP,RBUYKREP   REP COMPANY                                  
         TR    REBPTREP,MXTRT                                                   
*                                                                               
         PACK  WORK(1),RBUYKCON+3(1)                                            
         PACK  WORK+1(1),RBUYKCON+2(1)                                          
         PACK  WORK+2(1),RBUYKCON+1(1)                                          
         PACK  WORK+3(1),RBUYKCON(1)                                            
         ZAP   WORK+10(5),=P'0'                                                 
         MVO   WORK+10(5),WORK(4)  CHANGE TO PACK WITH SIGN                     
         ZAP   WORK+20(5),=P'99999999'                                          
         SP    WORK+20(5),WORK+10(5) GET 9'S COMPLEMENT                         
         EDIT  (P5,WORK+20),(8,REBPTCON),ALIGN=LEFT                             
         TR    REBPTCON,MXTRT                                                   
*                                                                               
         EDIT  RBUYKLIN,(3,REBPTLIN),FILL=0                                     
         TR    REBPTLIN,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
         LR    R6,R4                                                            
         USING RBUYPTEL,R6                                                      
         MVC   REBPTPT,RBUYPTPT                                                 
         TR    REBPTPT,MXTRT                                                    
*                                                                               
         MVC   REBPTNOT,RBUYPTNT                                                
         TR    REBPTNOT,MXTRT                                                   
*                                                                               
         MVI   REBPTFLG,C'N'                                                    
         TM    RBUYPTFL,X'80'                                                   
         BZ    *+8                                                              
         MVI   REBPTFLG,C'Y'                                                    
         TR    REBPTFLG,MXTRT                                                   
*                                                                               
RBPTX    DS    0H                                                               
         J     EXITR2                                                           
         DROP  R6                                                               
         LTORG                                                                  
RXBUYPG  NTR1  LABEL=*,BASE=*                                                   
*                                                                               
         USING REBPGD,R2           R2=A(EXTRACT RECORD)                         
         LR    R4,R6                                                            
         LR    R6,R3                                                            
         USING RBUYREC,R6                                                       
*                                                                               
         LA    R0,REBPGD           CLEAR THE RECORD                             
         LA    R1,REBPGDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBPGLEN,REBPGLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBPGLEN(2),=AL2(REBPGDL)                                        
         MVI   REBPGACT-1,MXTRTQ                                                
         MVI   REBPGDAT-1,MXTRTQ                                                
         MVI   REBPGTIM-1,MXTRTQ                                                
         MVC   REBPGTYP,REPBPGQ                                                 
         MVI   REBPGX,MXTRTQ                                                    
         MVI   REBPGX+1,MXTRTQ                                                  
         MVI   REBPGREP-1,MXTRTQ                                                
         MVI   REBPGCON-1,MXTRTQ                                                
         MVI   REBPGPGN-1,MXTRTQ                                                
         MVI   REBPGRTS-1,MXTRTQ                                                
         MVI   REBPGDEL-1,MXTRTQ                                                
*                                                                               
B        USING REBPGD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBPGACT,B.REBPGACT                                              
         MVC   REBPGDAT,B.REBPGDAT                                              
         MVC   REBPGTIM,B.REBPGTIM                                              
         DROP  B                                                                
*                                                                               
         MVC   REBPGRTS(14),=C'19000101000000'                                  
         TR    REBPGRTS,MXTRT      SET REFRESHTS DEFAULT                        
*                                                                               
         MVI   REBPGDEL,C' '       SET DELETE FLAG DEFAULT                      
         TM    RBUYCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BZ    *+8                 NO                                           
         MVI   REBPGDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REBPGDEL,MXTRT                                                   
*                                                                               
         MVC   REBPGREP,RBUYKREP   REP COMPANY                                  
         TR    REBPGREP,MXTRT                                                   
*                                                                               
         PACK  WORK(1),RBUYKCON+3(1)                                            
         PACK  WORK+1(1),RBUYKCON+2(1)                                          
         PACK  WORK+2(1),RBUYKCON+1(1)                                          
         PACK  WORK+3(1),RBUYKCON(1)                                            
         ZAP   WORK+10(5),=P'0'                                                 
         MVO   WORK+10(5),WORK(4)  CHANGE TO PACK WITH SIGN                     
         ZAP   WORK+20(5),=P'99999999'                                          
         SP    WORK+20(5),WORK+10(5) GET 9'S COMPLEMENT                         
         EDIT  (P5,WORK+20),(8,REBPGCON),ALIGN=LEFT                             
         TR    REBPGCON,MXTRT                                                   
*                                                                               
         EDIT  RBUYKLIN,(3,REBPGLIN),FILL=0                                     
         TR    REBPGLIN,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
*                                                                               
         LR    R6,R4                                                            
         USING RBUYPGEL,R6                                                      
         MVC   REBPGPGN,SPACES                                                  
         ZIC   R1,RBUYPGLN                                                      
         CHI   R1,3                                                             
         JL    EXITR2                                                           
         SHI   R1,3                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   REBPGPGN(0),RBUYPGM                                              
         TR    REBPGPGN,MXTRT                                                   
         DROP  R6                                                               
*                                                                               
RBPGX    DS    0H                                                               
         J     EXITR2                                                           
         LTORG                                                                  
RXBUYBC  NTR1  LABEL=*,BASE=*                                                   
*                                                                               
         USING REBBCD,R2           R2=A(EXTRACT RECORD)                         
         LR    R4,R6                                                            
         LR    R6,R3                                                            
         USING RBUYREC,R6                                                       
*                                                                               
         LA    R0,REBBCD           CLEAR THE RECORD                             
         LA    R1,REBBCDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBBCLEN,REBBCLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBBCLEN(2),=AL2(REBBCDL)                                        
         MVI   REBBCACT-1,MXTRTQ                                                
         MVI   REBBCDAT-1,MXTRTQ                                                
         MVI   REBBCTIM-1,MXTRTQ                                                
         MVC   REBBCTYP,REPBBCQ                                                 
         MVI   REBBCX,MXTRTQ                                                    
         MVI   REBBCX+1,MXTRTQ                                                  
         MVI   REBBCREP-1,MXTRTQ                                                
         MVI   REBBCCON-1,MXTRTQ                                                
         MVI   REBBCBCD-1,MXTRTQ                                                
         MVI   REBBCRTS-1,MXTRTQ                                                
         MVI   REBBCDEL-1,MXTRTQ                                                
*                                                                               
B        USING REBBCD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBBCACT,B.REBBCACT                                              
         MVC   REBBCDAT,B.REBBCDAT                                              
         MVC   REBBCTIM,B.REBBCTIM                                              
         DROP  B                                                                
*                                                                               
         MVC   REBBCRTS(14),=C'19000101000000'                                  
         TR    REBBCRTS,MXTRT      SET REFRESHTS DEFAULT                        
*                                                                               
         MVI   REBBCDEL,C' '       SET DELETE FLAG DEFAULT                      
         TM    RBUYCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BZ    *+8                 NO                                           
         MVI   REBBCDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REBBCDEL,MXTRT                                                   
*                                                                               
         MVC   REBBCREP,RBUYKREP   REP COMPANY                                  
         TR    REBBCREP,MXTRT                                                   
*                                                                               
         PACK  WORK(1),RBUYKCON+3(1)                                            
         PACK  WORK+1(1),RBUYKCON+2(1)                                          
         PACK  WORK+2(1),RBUYKCON+1(1)                                          
         PACK  WORK+3(1),RBUYKCON(1)                                            
         ZAP   WORK+10(5),=P'0'                                                 
         MVO   WORK+10(5),WORK(4)  CHANGE TO PACK WITH SIGN                     
         ZAP   WORK+20(5),=P'99999999'                                          
         SP    WORK+20(5),WORK+10(5) GET 9'S COMPLEMENT                         
         EDIT  (P5,WORK+20),(8,REBBCCON),ALIGN=LEFT                             
         TR    REBBCCON,MXTRT                                                   
*                                                                               
         EDIT  RBUYKLIN,(3,REBBCLIN),FILL=0                                     
         TR    REBBCLIN,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
*                                                                               
         LR    R6,R4                                                            
         USING RBYSCDEL,R6                                                      
         MVC   REBBCBCD,RBYSCDBC                                                
         TR    REBBCBCD,MXTRT                                                   
         DROP  R6                                                               
*                                                                               
RBBCX    DS    0H                                                               
         J     EXITR2                                                           
         LTORG                                                                  
RXBUYSB  NTR1  LABEL=*,BASE=*                                                   
*                                                                               
         USING REBSBD,R2           R2=A(EXTRACT RECORD)                         
         LR    R4,R6                                                            
         LR    R6,R3                                                            
         USING RBUYREC,R6                                                       
*                                                                               
         LA    R0,REBSBD           CLEAR THE RECORD                             
         LA    R1,REBSBDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBSBLEN,REBSBLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBSBLEN(2),=AL2(REBSBDL)                                        
         MVI   REBSBACT-1,MXTRTQ                                                
         MVI   REBSBDAT-1,MXTRTQ                                                
         MVI   REBSBTIM-1,MXTRTQ                                                
         MVC   REBSBTYP,REPBSBQ                                                 
         MVI   REBSBX,MXTRTQ                                                    
         MVI   REBSBX+1,MXTRTQ                                                  
         MVI   REBSBREP-1,MXTRTQ                                                
         MVI   REBSBCON-1,MXTRTQ                                                
         MVI   REBSBCMT-1,MXTRTQ                                                
         MVI   REBSBRTS-1,MXTRTQ                                                
         MVI   REBSBDEL-1,MXTRTQ                                                
*                                                                               
B        USING REBSBD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBSBACT,B.REBSBACT                                              
         MVC   REBSBDAT,B.REBSBDAT                                              
         MVC   REBSBTIM,B.REBSBTIM                                              
         DROP  B                                                                
*                                                                               
         MVC   REBSBRTS(14),=C'19000101000000'                                  
         TR    REBSBRTS,MXTRT      SET REFRESHTS DEFAULT                        
*                                                                               
         MVI   REBSBDEL,C' '       SET DELETE FLAG DEFAULT                      
         TM    RBUYCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BZ    *+8                 NO                                           
         MVI   REBSBDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REBSBDEL,MXTRT                                                   
*                                                                               
         MVC   REBSBREP,RBUYKREP   REP COMPANY                                  
         TR    REBSBREP,MXTRT                                                   
*                                                                               
         PACK  WORK(1),RBUYKCON+3(1)                                            
         PACK  WORK+1(1),RBUYKCON+2(1)                                          
         PACK  WORK+2(1),RBUYKCON+1(1)                                          
         PACK  WORK+3(1),RBUYKCON(1)                                            
         ZAP   WORK+10(5),=P'0'                                                 
         MVO   WORK+10(5),WORK(4)  CHANGE TO PACK WITH SIGN                     
         ZAP   WORK+20(5),=P'99999999'                                          
         SP    WORK+20(5),WORK+10(5) GET 9'S COMPLEMENT                         
         EDIT  (P5,WORK+20),(8,REBSBCON),ALIGN=LEFT                             
         TR    REBSBCON,MXTRT                                                   
*                                                                               
         EDIT  RBUYKLIN,(3,REBSBLIN),FILL=0                                     
         TR    REBSBLIN,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
*                                                                               
         LR    R6,R4                                                            
         USING RBUYSBEL,R6                                                      
         MVC   REBSBCMT,SPACES                                                  
         ZIC   R1,RBUYSBLN                                                      
         CHI   R1,3                                                             
         JL    EXITR2                                                           
         SHI   R1,3                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   REBSBCMT(0),RBUYSBDC                                             
         TR    REBSBCMT,MXTRT                                                   
         DROP  R6                                                               
*                                                                               
RBSBX    DS    0H                                                               
         J     EXITR2                                                           
         LTORG                                                                  
RXBUYOC  NTR1  LABEL=*,BASE=*                                                   
*                                                                               
         USING REBOCD,R2           R2=A(EXTRACT RECORD)                         
         LR    R4,R6                                                            
         LR    R6,R3                                                            
         USING RBUYREC,R6                                                       
*                                                                               
         LA    R0,REBOCD           CLEAR THE RECORD                             
         LA    R1,REBOCDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBOCLEN,REBOCLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBOCLEN(2),=AL2(REBOCDL)                                        
         MVI   REBOCACT-1,MXTRTQ                                                
         MVI   REBOCDAT-1,MXTRTQ                                                
         MVI   REBOCTIM-1,MXTRTQ                                                
         MVC   REBOCTYP,REPBOCQ                                                 
         MVI   REBOCX,MXTRTQ                                                    
         MVI   REBOCX+1,MXTRTQ                                                  
         MVI   REBOCREP-1,MXTRTQ                                                
         MVI   REBOCCON-1,MXTRTQ                                                
         MVI   REBOCROS-1,MXTRTQ                                                
         MVI   REBOCCMT-1,MXTRTQ                                                
         MVI   REBOCRTS-1,MXTRTQ                                                
         MVI   REBOCDEL-1,MXTRTQ                                                
*                                                                               
B        USING REBOCD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBOCACT,B.REBOCACT                                              
         MVC   REBOCDAT,B.REBOCDAT                                              
         MVC   REBOCTIM,B.REBOCTIM                                              
         DROP  B                                                                
*                                                                               
         MVC   REBOCRTS(14),=C'19000101000000'                                  
         TR    REBOCRTS,MXTRT      SET REFRESHTS DEFAULT                        
*                                                                               
         MVI   REBOCDEL,C' '       SET DELETE FLAG DEFAULT                      
         TM    RBUYCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BZ    *+8                 NO                                           
         MVI   REBOCDEL,C'D'       YES - SET 'DELETED' INDICATOR                
         TR    REBOCDEL,MXTRT                                                   
*                                                                               
         MVC   REBOCREP,RBUYKREP   REP COMPANY                                  
         TR    REBOCREP,MXTRT                                                   
*                                                                               
         PACK  WORK(1),RBUYKCON+3(1)                                            
         PACK  WORK+1(1),RBUYKCON+2(1)                                          
         PACK  WORK+2(1),RBUYKCON+1(1)                                          
         PACK  WORK+3(1),RBUYKCON(1)                                            
         ZAP   WORK+10(5),=P'0'                                                 
         MVO   WORK+10(5),WORK(4)  CHANGE TO PACK WITH SIGN                     
         ZAP   WORK+20(5),=P'99999999'                                          
         SP    WORK+20(5),WORK+10(5) GET 9'S COMPLEMENT                         
         EDIT  (P5,WORK+20),(8,REBOCCON),ALIGN=LEFT                             
         TR    REBOCCON,MXTRT                                                   
*                                                                               
         EDIT  RBUYKLIN,(3,REBOCLIN),FILL=0                                     
         TR    REBOCLIN,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
*                                                                               
         LR    R6,R4                                                            
         USING RBUYOCEL,R6                                                      
*                                                                               
         MVI   REBOCROS,C'R'                                                    
         TM    RBUYOCID,X'80'                                                   
         BO    *+8                                                              
         MVI   REBOCROS,C'S'                                                    
         TR    REBOCROS,MXTRT                                                   
*                                                                               
         MVC   REBOCCMT,SPACES                                                  
         ZIC   R1,RBUYOCLN                                                      
         CHI   R1,4                                                             
         JL    EXITR2                                                           
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   REBOCCMT(0),RBUYOCNT                                             
         TR    REBOCCMT,MXTRT                                                   
         DROP  R6                                                               
*                                                                               
RBOCX    DS    0H                                                               
         J     EXITR2                                                           
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* REPAGYC - EXTRACT AGENCY RECORD                                               
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)   (AGENCY 2 RECORD)                           *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPAGYC  NMOD1 WORKL,*REPAGY*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REAGYLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REAGYD,R2           R2=A(EXTRACT RECORD)                         
         USING RAGYREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
*****>>>NEW AGENCY CODE                                                         
         CLI   8(R1),1                                                          
         JL    RXAGYKIL            BUILD KILL RECORD                            
         JE    RXAGYSER            BUILD SERIES OF RECORDS                      
         J     RXAGYNXT            OUTPUT NEXT RECORD                           
         EJECT                                                                  
*                                                                               
*---------------------------------------------------------------------*         
* GET NEXT AGENCY RECORD IN SERIES AND RETURN IT                                
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXAGYNXT L     RE,ANEXT                                                         
*                                                                               
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK?                         
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         LA    R0,REAGYD           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1               LENGTH OF NEXT RECORD                        
         ICM   R1,3,REAGYLEN-REAGYD(RE)                                         
         LA    RF,0(R1,RE)         SAVE NEXT ADDRESS                            
         ST    RF,ANEXT                                                         
         LR    RF,R1               SET LENGTH                                   
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
*                                                                               
**ORIG CONTRACT ROUTINES                                                        
*---------------------------------------------------------------------*         
* BUILD 'K' RECORD FOR AGENCY RECORD AND EXIT                                   
*                                                                               
*   SOME NOTES ON 'KILL':                                                       
*                                                                               
*        THE EXACT RECORDS GENERATED BY THE LAST CHANGE OR                      
*        ADD CAN BE GENERATED AS 'KILLS' BY BRANCHING TO 'RXAGYSER'             
*        IMMEDIATELY AFTER THE 'MVI   KILLMODE,C'Y'' STATEMENT                  
*        BELOW.  THIS REQUIRES THAT THE RECORD BEING POINTED TO IS              
*        'COPY' RECORD RATHER THAN 'CHANGE' RECORD.  RXTRACT MOD                
*        IS PASSING IN THE ADDRESS OF THE 'COPY' RATHER THAN THE                
*        'CHANGE' WHEN A 'KILL' IS REQUESTED.                                   
*        IF A SINGLE RECORD TO KILL A GROUP OF RECORDS IS NEEDED,               
*        THE CODE WILL CREATE A SINGLE RECORD OF TYPE, WITH SUFFICIENT          
*        INFORMATION TO KILL ALL ASSOCIATED RECORDS.  THE RECORD MUST           
*        HAVE SUFFICIENT KEY IDENTIFICATION TO MAKE IT UNIQUE, AND              
*        ALL KEYS THAT BEGIN WITH THAT PARTIAL KEY WILL BE DROPPED.             
*        THESE KEYS CAN BE GENERATED FROM THE 'CHANGE' KEY, IN WHICH            
*        CASE YOU DON'T REALLY KNOW WHAT HAD BEEN GENERATED PREV-               
*        IOUSLY BY THE 'COPY' KEY.                                              
*                                                                               
*        THE CODE IS CURRENTLY SET UP TO GENERATE A SINGLE KILL                 
*        RECORD WITH A PARTIAL KEY.                                             
*                                                                               
*                                                                               
*                                                                               
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXAGYKIL DS    0H                                                               
         MVI   KILLMODE,C'Y'       SET TO 'KILL'                                
*                                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXAGYCC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXAGYAGY         FIRST KILL HEADER                            
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REAGYLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         MVI   CLEARFLG,0          SET CLEAR TO 'NO'                            
*                                                                               
         LA    R6,RAGYREC          DARE AGENCY OFFICE DATA                      
         MVI   ELCODE,X'10'        MAIN DATA ELEMENT                            
         BRAS  RE,GETEL                                                         
         JNE   RXAG0020            NOT FOUND                                    
DAR      USING RAGY2FXE,R6                                                      
         CLC   DAR.RAGY2DAR,SPACES ANY VALUE?                                   
         BNH   RXAG0020            NO                                           
         BRAS  RE,RXAGYDAR         YES - THEN  KILL AGENCY DAR                  
*                                     SINGLE KILL RECORD PRODUCED               
         DROP  DAR                                                              
*                                                                               
RXAG0020 EQU   *                                                                
*                                                                               
         LA    R6,RAGYREC          AGENCY COMMENT                               
         MVI   ELCODE,X'40'        AGENCY COMMENT?                              
         BRAS  RE,GETEL                                                         
*                                                                               
         JNE   RXAG0080            NOT FOUND                                    
         BRAS  RE,RXAGYCOM         THEN  KILL AGENCY COMMENT                    
*                                     SINGLE KILL RECORD PRODUCED               
*                                                                               
RXAG0080 EQU   *                                                                
*&&DO                                                                           
*   TEST                                                                        
         LA    R0,1                                                             
         LNR   R0,R0                                                            
         DC    H'0'                                                             
*   TEST END                                                                    
*&&                                                                             
         J     EXITR2                                                           
*                                                                               
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD SERIES OF RECORDS FOR THIS AGENCY                             *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXAGYSER DS    0H                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXAGYCC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXAGYAGY                                                      
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REAGYLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         MVI   CLEARFLG,0          SET CLEAR TO 'NO'                            
         LA    R6,RAGYREC          DARE AGENCY+OFFICE                           
         MVI   ELCODE,X'10'        MAIN ELEMENT                                 
         BRAS  RE,GETEL                                                         
         JNE   RXAC0060            NO MAIN ELEMENT                              
         USING RAGY2FXE,R6                                                      
         LA    R4,RAGY2DAR         SET A(FIRST DARE AGY+OFFICE)                 
*                                                                               
         XC    FULL2,FULL2         CLEAR COUNTER                                
RXAC0020 EQU   *                                                                
         CLC   0(3,R4),SPACES      ANY ENTRY?                                   
         BNH   RXAC0060            NO  - FINISHED                               
*                                                                               
         BRAS  RE,RXAGYDAR         YES - GEN DARE AGENCY+OFF                    
         MVI   CLEARFLG,1          SET CLEAR TO 'YES'                           
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REAGYLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         LA    R4,5(R4)            NO  - BUMP TO NEXT DAR AGY+OFFC              
         J     RXAC0020            GO BACK FOR NEXT ENTRY                       
RXAC0060 EQU   *                                                                
         XC    FULL2,FULL2                                                      
         LA    R6,RAGYREC          AGENCY COMMENT ELEMENT                       
         MVI   ELCODE,X'40'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RXAC0160            NO AGENCY COMMENT (MAX OF 2)                 
RXAC0120 EQU   *                                                                
         BAS   RE,COMTCHEK         VALIDATE COMMENT                             
         BNZ   RXAC0140            INVALID: DON'T OUTPUT                        
*                                                                               
         BRAS  RE,RXAGYCOM         THEN  GEN AGY COMMENT(S)                     
         MVI   CLEARFLG,1          SET CLEAR TO 'YES'                           
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REAGYLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
RXAC0140 EQU   *                                                                
         ZIC   RF,1(R6)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R6,RF                                                            
         CLI   0(R6),X'40'         AGENCY COMMT ELEMENT?                        
         JE    RXAC0120            YES - GO BACK FOR AGENCY COMMT ELT           
*                                                                               
RXAC0160 EQU   *                                                                
         J     EXIT                FINISHED                                     
*                                                                               
*                                                                               
RXAGYCC  DC    A(BUFFER1)          AGENCY RECORD SAVE AREA                      
*                                                                               
COMTCHEK NTR1                                                                   
         CLI   1(R6),62            OVERALL LENGTH > CTL + 60?                   
         BH    CCHK0900            YES - SKIP THIS ONE                          
         ZIC   RF,1(R6)            STRIP LENGTH                                 
         SH    RF,=H'3'            SUBTRACT FOR EX                              
         CLC   2(0,R6),SPACES      CHECK FOR SIGNIFICANT VALUE                  
         BNH   CCHK0900            NOTHING SIGNIFICANT                          
         SR    R0,R0               SET CC ZERO                                  
         B     CCHK0950                                                         
CCHK0900 EQU   *                                                                
         LTR   RB,RB               SET CC NOT ZERO                              
CCHK0950 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
**                                                                              
RXAGYAGY NTR1                                                                   
*                                                                               
         USING REAGYD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,REAGYD           CLEAR THE RECORD                             
         LA    R1,REAGYDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REAGYLEN,REAGYLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REAGYLEN(2),=AL2(REAGYDL)                                        
         MVC   REAGYTYP,REPAGYQ                                                 
         MVI   REAGYDX,MXTRTQ                                                   
         MVI   REAGYDX+1,MXTRTQ                                                 
         MVI   REAGYREP-1,MXTRTQ                                                
         MVI   REAGYAGY-1,MXTRTQ                                                
         MVI   REAGYNAM-1,MXTRTQ                                                
         MVI   REAGYAD1-1,MXTRTQ                                                
         MVI   REAGYAD2-1,MXTRTQ                                                
         MVI   REAGYCTY-1,MXTRTQ                                                
         MVI   REAGYSTA-1,MXTRTQ                                                
         MVI   REAGYZIP-1,MXTRTQ                                                
         MVI   REAGYPHO-1,MXTRTQ                                                
         MVI   REAGYRTS-1,MXTRTQ                                                
         MVI   REAGYDEL-1,MXTRTQ                                                
         MVI   REAGYCRR-1,MXTRTQ                                                
         MVI   REAGYLIA-1,MXTRTQ                                                
         MVI   REAGYFAX-1,MXTRTQ                                                
         MVI   REAGYTER-1,MXTRTQ                                                
         MVI   REAGYICO-1,MXTRTQ                                                
         MVI   REAGYDLU-1,MXTRTQ                                                
*                                                                               
B        USING REAGYD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REAGYACT,B.REAGYACT                                              
         MVC   REAGYDAT,B.REAGYDAT                                              
         MVC   REAGYTME,B.REAGYTME                                              
         DROP  B                                                                
*                                                                               
         MVC   REAGYREP,RAGYKREP   REP COMPANY                                  
         TR    REAGYREP,MXTRT                                                   
         MVC   REAGYAGY,RAGYKAGY   AGENCY + AGENCY OFFICE                       
         TR    REAGYAGY,MXTRT                                                   
*                                                                               
*                                                                               
***      MVC   REAGYRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REAGYRTS(14),=C'19000101000000'                                  
         TR    REAGYRTS,MXTRT                                                   
*                                                                               
         MVI   REAGYDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REAGYDEL,MXTRT                                                   
*                                                                               
         MVI   REAGYICO,C'N'       SET 'NOT IN CARE OF'                         
*                                                                               
         LA    R6,RAGYREC                                                       
         MVI   ELCODE,X'1F'        01 IS 1F IN AGY2 REC                         
         BRAS  RE,GETEL                                                         
         JNE   RAGY0010                                                         
*                                                                               
         USING RAG2ELEM,R6                                                      
         MVC   REAGYNAM,RAG2NAM2   AGENCY NAME                                  
         OC    RAG2LIAB,RAG2LIAB                                                
         BZ    RAGY0002                                                         
         EDIT  RAG2LIAB,(2,REAGYLIA),FILL=0                                     
*                                  LIABILITY                                    
RAGY0002 EQU   *                                                                
         OC    RAG2RISK,RAG2RISK                                                
         BZ    RAGY0004                                                         
         EDIT  RAG2RISK,(2,REAGYCRR),FILL=0                                     
*                                  CREDIT RISK                                  
RAGY0004 EQU   *                                                                
         TM    RAG2FLAG,X'20'      BUYING SVC / IN CARE OF?                     
         BNO   RAGY0010            NO                                           
         MVI   REAGYICO,C'Y'       SET 'IN CARE OF'                             
         DROP  R6                                                               
*                                                                               
RAGY0010 DS    0H                                                               
         TR    REAGYNAM,MXTRT                                                   
         TR    REAGYLIA,MXTRT                                                   
         TR    REAGYCRR,MXTRT                                                   
*                                                                               
         LA    R6,RAGYREC                                                       
         MVI   ELCODE,X'10'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RAGY0020                                                         
*                                                                               
         USING RAGY2FXE,R6                                                      
         MVC   REAGYFAX,RAGY2FAX   FAX #                                        
         MVC   REAGYPHO,RAGY2FON   PHONE #                                      
         GOTO1 DATCON,PLIST,(2,RAGY2LCD),(10,REAGYDLU)                          
         MVC   REAGYTER,RAGY2TER   TERRITORY CODE                               
         DROP  R6                                                               
*                                                                               
RAGY0020 DS    0H                                                               
         TR    REAGYFAX,MXTRT                                                   
         TR    REAGYPHO,MXTRT                                                   
         TR    REAGYDLU,MXTRT                                                   
         TR    REAGYTER,MXTRT                                                   
*                                                                               
         LA    R6,RAGYREC                                                       
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RAGY0030                                                         
*                                                                               
         USING RAGY2AE1,R6                                                      
         MVC   REAGYAD1,RAGY2AD1   ADDRESS 1                                    
         MVC   REAGYAD2,RAGY2AD2   ADDRESS 2                                    
         MVC   REAGYCTY,RAGY2CTY   CITY                                         
         MVC   REAGYSTA,RAGY2STE   STATE                                        
         MVC   REAGYZIP,RAGY2ZIP   ZIP CODE                                     
         DROP  R6                                                               
*                                                                               
RAGY0030 DS    0H                                                               
         TR    REAGYAD1,MXTRT                                                   
         TR    REAGYAD2,MXTRT                                                   
         TR    REAGYCTY,MXTRT                                                   
         TR    REAGYSTA,MXTRT                                                   
         TR    REAGYZIP,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
REAGYLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
**********************************************************************          
*   AGENCY DARE AGENCY+OFFICE GENERATION                             *          
*   R6  ->  AGENCY RECORD X'10' ELEMENT                              *          
*   R4  ->  AGY+OFF COMBO                                            *          
*                                                                    *          
**********************************************************************          
RXAGYDAR NTR1                                                                   
*                                                                               
         USING REDAOD,R2           R2=A(EXTRACT RECORD)                         
         USING RAGY2REC,R3                                                      
*                                                                               
         LA    R0,REDAOD           CLEAR THE RECORD                             
         LA    R1,REDAODL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REDAOLEN,REDAOLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REDAOLEN(2),=AL2(REDAODL)                                        
         MVI   REDAOACT-1,MXTRTQ                                                
         MVI   REDAODAT-1,MXTRTQ                                                
         MVI   REDAOTME-1,MXTRTQ                                                
         MVC   REDAOTYP,REPDAOQ                                                 
         MVI   REDAODX,MXTRTQ                                                   
         MVI   REDAODX+1,MXTRTQ                                                 
         MVI   REDAOREP-1,MXTRTQ                                                
         MVI   REDAOAGY-1,MXTRTQ                                                
         MVI   REDAOAGO-1,MXTRTQ                                                
         MVI   REDAOCTR-1,MXTRTQ                                                
         MVI   REDAORTS-1,MXTRTQ                                                
         MVI   REDAODEL-1,MXTRTQ                                                
*                                                                               
B        USING REDAOD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REDAOACT,B.REDAOACT                                              
         MVC   REDAODAT,B.REDAODAT                                              
         MVC   REDAOTME,B.REDAOTME                                              
         DROP  B                                                                
         MVC   REDAOREP,RAGK2REP   REP COMPANY                                  
         TR    REDAOREP,MXTRT                                                   
         MVC   REDAOAGY,RAGK2AGY                                                
         TR    REDAOAGY,MXTRT                                                   
*                                                                               
         MVC   REDAORTS(14),=C'19000101000000'                                  
         TR    REDAORTS,MXTRT                                                   
*                                                                               
         MVI   REDAODEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REDAODEL,MXTRT                                                   
*                                                                               
         MVC   REDAOCTR,=C'  '                                                  
         TR    REDAOCTR,MXTRT      SET DEFAULT                                  
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    RXDR0900                                                         
*                                                                               
         MVC   REDAOAGO(5),0(R4)  INSERT DARE AGY + OFFICE                      
         TR    REDAOAGO,MXTRT                                                   
*                                                                               
         L     RF,FULL2            INCREMENT COUNTER                            
         LA    RF,1(RF)                                                         
         ST    RF,FULL2            SAVE NEW COUNTER                             
         EDIT (4,FULL2),(1,REDAOCTR),FILL=0                                     
         TR    REDAOCTR,MXTRT                                                   
*                                                                               
RXDR0900 EQU   *                                                                
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REDAOLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         J     EXITR2                                                           
*                                                                               
         EJECT                                                                  
*                                                                               
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
*                                                                               
**********************************************************************          
*   AGENCY COMMENT GENERATION                                        *          
*   R6  ->  AGENCY RECORD X'40' AGENCY COMMENT ELEMENT               *          
*                                                                    *          
**********************************************************************          
RXAGYCOM NTR1                                                                   
*                                                                               
         USING REACOD,R2           R2=A(EXTRACT RECORD)                         
         USING RAGY2REC,R3                                                      
*                                                                               
         LA    R0,REACOD           CLEAR THE RECORD                             
         LA    R1,REACODL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REACOLEN,REACOLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REACOLEN(2),=AL2(REACODL)                                        
         MVI   REACOACT-1,MXTRTQ                                                
         MVI   REACODAT-1,MXTRTQ                                                
         MVI   REACOTME-1,MXTRTQ                                                
         MVC   REACOTYP,REPACOQ                                                 
         MVI   REACODX,MXTRTQ                                                   
         MVI   REACODX+1,MXTRTQ                                                 
         MVI   REACOREP-1,MXTRTQ                                                
         MVI   REACOAGY-1,MXTRTQ                                                
         MVI   REACOCOM-1,MXTRTQ                                                
         MVI   REACOCTR-1,MXTRTQ                                                
         MVI   REACORTS-1,MXTRTQ                                                
         MVI   REACODEL-1,MXTRTQ                                                
*                                                                               
B        USING REACOD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REACOACT,B.REACOACT                                              
         MVC   REACODAT,B.REACODAT                                              
         MVC   REACOTME,B.REACOTME                                              
         DROP  B                                                                
*                                                                               
         MVI   REACODEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REACODEL,MXTRT                                                   
*                                                                               
         MVC   REACOREP,RAGK2REP   REP COMPANY                                  
         TR    REACOREP,MXTRT                                                   
         MVC   REACOAGY,RAGK2AGY                                                
         TR    REACOAGY,MXTRT                                                   
*                                                                               
         MVC   REACORTS(14),=C'19000101000000'                                  
         TR    REACORTS,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    RXCM0900                                                         
*                                                                               
         ZIC   RF,1(R6)            STRIP ELEMENT LENGTH                         
         SH    RF,=H'3'            SUBTRACT FOR MOVE BY LEN / EX                
         EX    RF,RXCM0020         MOVE BY LENGTH                               
         B     RXCM0040                                                         
RXCM0020 EQU   *                                                                
         MVC   REACOCOM(0),2(R6)   MOVE COMMENT BY LENGTH                       
RXCM0040 EQU   *                                                                
         OC    REACOCOM,SPACES                                                  
         TR    REACOCOM,MXTRT                                                   
*                                                                               
         L     RF,FULL2            INCREMENT COUNTER                            
         LA    RF,1(RF)                                                         
         ST    RF,FULL2            SAVE NEW COUNTER                             
         EDIT (4,FULL2),(1,REACOCTR),FILL=0                                     
         TR    REACOCTR,MXTRT                                                   
*                                                                               
RXCM0900 EQU   *                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REACOLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         J     EXITR2                                                           
*                                                                               
         EJECT                                                                  
*                                                                               
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
*                                                                               
***********************************************************************         
* REPADVC - EXTRACT ADVERTISER RECORD                                           
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPADVC  NMOD1 WORKL,*REPADV*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,READVLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING READVD,R2           R2=A(EXTRACT RECORD)                         
         USING RADVREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    READVLEN,READVLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   READVLEN(2),=AL2(READVDL)                                        
         MVC   READVTYP,REPADVQ                                                 
         MVI   READVDX,MXTRTQ                                                   
         MVI   READVDX+1,MXTRTQ                                                 
         MVI   READVREP-1,MXTRTQ                                                
         MVI   READVADV-1,MXTRTQ                                                
         MVI   READVNAM-1,MXTRTQ                                                
         MVI   READVCAT-1,MXTRTQ                                                
         MVI   READVNET-1,MXTRTQ                                                
         MVI   READVCTY-1,MXTRTQ                                                
         MVI   READVAA1-1,MXTRTQ                                                
         MVI   READVAA2-1,MXTRTQ                                                
         MVI   READVAA3-1,MXTRTQ                                                
         MVI   READVCTA-1,MXTRTQ                                                
         MVI   READVAOF-1,MXTRTQ                                                
         MVI   READVA21-1,MXTRTQ                                                
         MVI   READVA22-1,MXTRTQ                                                
         MVI   READVA23-1,MXTRTQ                                                
         MVI   READVCTB-1,MXTRTQ                                                
         MVI   READVOFB-1,MXTRTQ                                                
         MVI   READVRTS-1,MXTRTQ                                                
         MVI   READVDEL-1,MXTRTQ                                                
*                                                                               
         MVC   READVREP,RADVKREP   REP COMPANY                                  
         TR    READVREP,MXTRT                                                   
         MVC   READVADV,RADVKADV   ADVERTISER CODE                              
         TR    READVADV,MXTRT                                                   
         MVC   READVNAM,RADVNAME   ADVERTISER NAME                              
         TR    READVNAM,MXTRT                                                   
         MVC   READVCAT,RADVCATG   ADVERTISER CATEGORY CODE                     
         TR    READVCAT,MXTRT                                                   
*                                                                               
****     MVC   READVRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   READVRTS(14),=C'19000101000000'                                  
         TR    READVRTS,MXTRT                                                   
*                                                                               
         MVI   READVDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    READVDEL,MXTRT                                                   
*                                                                               
         MVI   READVNET,C'N'       ADVERTISER INTERNET FLAG                     
         CLC   =C'INTERNET',RADVCITY                                            
         JNE   *+8                                                              
         MVI   READVNET,C'Y'                                                    
         TR    READVNET,MXTRT                                                   
*                                                                               
         MVC   READVCTY,RADVCITY      SET CITY NAME                             
         TR    READVCTY,MXTRT                                                   
*                                                                               
         LA    R6,RADVREC                                                       
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RADV0100                                                         
*                                                                               
         USING RADVAGEL,R6                                                      
         MVC   READVAA1,RADVAGA1      SET ALT ADDRESS 1                         
         TR    READVAA1,MXTRT                                                   
         MVC   READVAA2,RADVAGA2      SET ALT ADDRESS 2                         
         TR    READVAA2,MXTRT                                                   
         MVC   READVAA3,RADVAGA3      SET ALT ADDRESS 3                         
         TR    READVAA3,MXTRT                                                   
         MVC   READVCTA,RADVAGTY      SET ALT CON TYPE                          
         TR    READVCTA,MXTRT                                                   
         MVC   READVAOF,RADVAGOF      SET ALT OFFICE                            
         TR    READVAOF,MXTRT                                                   
*                                                                               
         BRAS  RE,NEXTEL                                                        
         JNE   RADV0100                                                         
*                                                                               
         MVC   READVA21,RADVAGA1      SET ALT ADDRESS 1                         
         TR    READVA21,MXTRT                                                   
         MVC   READVA22,RADVAGA2      SET ALT ADDRESS 2                         
         TR    READVA22,MXTRT                                                   
         MVC   READVA23,RADVAGA3      SET ALT ADDRESS 3                         
         TR    READVA23,MXTRT                                                   
         MVC   READVCTB,RADVAGTY      SET ALT CON TYPE                          
         TR    READVCTB,MXTRT                                                   
         MVC   READVOFB,RADVAGOF      SET ALT OFFICE                            
         TR    READVOFB,MXTRT                                                   
*                                                                               
         DROP  R6                                                               
RADV0100 EQU   *                                                                
         J     EXIT                                                             
*                                                                               
READVLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPSALC - EXTRACT SALESPERSON RECORD                                          
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(2ND RECORD)                                                   *         
***********************************************************************         
         SPACE 1                                                                
REPSALC  NMOD1 WORKL,*REPSAL*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RESALLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         L     R4,16(R1)           A(SAL2 REC)                                  
         USING RESALD,R2           R2=A(EXTRACT RECORD)                         
         USING RSALREC,R3          R3=A(REPFILE RECORD)                         
         XC    RESALLEN,RESALLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RESALLEN(2),=AL2(RESALDL)                                        
         MVC   RESALTYP,REPSALQ                                                 
         MVI   RESALDX,MXTRTQ                                                   
         MVI   RESALDX+1,MXTRTQ                                                 
         MVI   RESALREP-1,MXTRTQ                                                
         MVI   RESALSAL-1,MXTRTQ                                                
         MVI   RESALNAM-1,MXTRTQ                                                
         MVI   RESALTEM-1,MXTRTQ                                                
         MVI   RESALTEL-1,MXTRTQ                                                
         MVI   RESALFAX-1,MXTRTQ                                                
         MVI   RESALOFF-1,MXTRTQ                                                
         MVI   RESALEML-1,MXTRTQ                                                
         MVI   RESALLDT-1,MXTRTQ                                                
         MVI   RESALMGR-1,MXTRTQ                                                
         MVI   RESALRTS-1,MXTRTQ                                                
         MVI   RESALDEL-1,MXTRTQ                                                
*                                                                               
         MVC   RESALREP,RSALKREP   REP COMPANY                                  
         TR    RESALREP,MXTRT                                                   
         MVC   RESALSAL,RSALKSAL   SALESPERSON CODE                             
         TR    RESALSAL,MXTRT                                                   
         MVC   RESALNAM,RSALNAME   SALESPERSON NAME                             
         TR    RESALNAM,MXTRT                                                   
         MVC   RESALTEM,RSALTEAM   SALESPERSON TEAM                             
         TR    RESALTEM,MXTRT                                                   
         MVC   RESALTEL,RSALTEL    SALESPERSON TELEPHONE #                      
         TR    RESALTEL,MXTRT                                                   
         MVC   RESALFAX,RSALFAX    SALESPERSON FAX #                            
         TR    RESALFAX,MXTRT                                                   
         MVC   RESALOFF,RSALOFF    SALESPERSON OFF                              
         TR    RESALOFF,MXTRT                                                   
         OC    RSALLEAV,RSALLEAV   ANY LEAVE DATE?                              
         JZ    RSAL0020            NO                                           
*                                                                               
         GOTO1 DATCON,PLIST,(3,RSALLEAV),(10,RESALLDT)                          
RSAL0020 EQU   *                                                                
         TR    RESALLDT,MXTRT                                                   
         MVI   RESALMGR,C'N'       SET 'MANAGER = NO'                           
         CLI   RSALMGR,C'Y'        MANAGER SET TO YES?                          
         BNE   RSAL0040            NO                                           
         MVI   RESALMGR,C'Y'       SET 'MANAGER = YES'                          
RSAL0040 EQU   *                                                                
         TR    RESALMGR,MXTRT                                                   
*                                                                               
***      MVC   RESALRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RESALRTS(14),=C'19000101000000'                                  
         TR    RESALRTS,MXTRT                                                   
*                                                                               
         MVI   RESALDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RESALDEL,MXTRT                                                   
*                                                                               
         CLI   0(R4),X'46'         SAL2 RECORD?                                 
         JNE   RSAL0080            NO                                           
         CLC   1(26,R4),1(R3)      SAME RECORD?                                 
         JNE   RSAL0080            NO                                           
*                                                                               
         LR    R6,R4                                                            
         LA    R8,RESALEML         INITIAL EMAIL ADDRESS                        
*                                                                               
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RSAL0080                                                         
*                                                                               
RSAL0060 DS    0H                                                               
         USING RSALEMEM,R6                                                      
*                                                                               
         LA    RE,RESALEML         CHECK FOR IF COMMA NEEDED                    
         CR    RE,R8                                                            
         JE    *+12                NO                                           
         MVI   0(R8),C','                                                       
         AHI   R8,1                                                             
*                                                                               
         ZIC   RE,1(R6)                                                         
         AHI   RE,-1                                                            
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   0(0,R8),RSALEMAL    EMAIL                                        
         LA    R8,1(RE,R8)                                                      
         DROP  R6                                                               
*                                                                               
         BRAS  RE,NEXTEL                                                        
         JE    RSAL0060                                                         
*                                                                               
RSAL0080 DS    0H                                                               
         TR    RESALEML,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
RESALLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPCTYC - EXTRACT CONTRACT TYPE                                               
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPCTYC  NMOD1 WORKL,*REPCTY*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RECTYLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING RECTYD,R2           R2=A(EXTRACT RECORD)                         
         USING RCTYREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    RECTYLEN,RECTYLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RECTYLEN(2),=AL2(RECTYDL)                                        
         MVC   RECTYTYP,REPCTYQ                                                 
         MVI   RECTYDX,MXTRTQ                                                   
         MVI   RECTYDX+1,MXTRTQ                                                 
         MVI   RECTYREP-1,MXTRTQ                                                
         MVI   RECTYCTY-1,MXTRTQ                                                
         MVI   RECTYNAM-1,MXTRTQ                                                
         MVI   RECTYCCM-1,MXTRTQ                                                
         MVI   RECTYRTS-1,MXTRTQ                                                
         MVI   RECTYDEL-1,MXTRTQ                                                
*                                                                               
         MVC   RECTYREP,RCTYKREP   REP COMPANY                                  
         TR    RECTYREP,MXTRT                                                   
         MVC   RECTYCTY,RCTYKCTY   DEV CON TYPE                                 
         TR    RECTYCTY,MXTRT                                                   
         MVC   RECTYNAM,RCTYDESC   DEV CON TYPE NAME                            
         TR    RECTYNAM,MXTRT                                                   
         CLI   RCTY1LEN,30         NEW LENGTH?                                  
         BL    RECTY020            NO  - NO CON TYPE COMMENT                    
         MVC   RECTYCCM,RCTYCMMT   DEV CON TYPE COMMENT                         
RECTY020 EQU   *                                                                
         TR    RECTYCCM,MXTRT                                                   
*                                                                               
*                                                                               
***      MVC   RECTYRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RECTYRTS(14),=C'19000101000000'                                  
         TR    RECTYRTS,MXTRT                                                   
*                                                                               
         MVI   RECTYDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RECTYDEL,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
RECTYLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPDCTC - EXTRACT DEVELOPMENT CONTRACT TYPE                                   
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPDCTC  NMOD1 WORKL,*REPDCT*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REDCTLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REDCTD,R2           R2=A(EXTRACT RECORD)                         
         USING RDCTREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REDCTLEN,REDCTLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REDCTLEN(2),=AL2(REDCTDL)                                        
         MVC   REDCTTYP,REPDCTQ                                                 
         MVI   REDCTDX,MXTRTQ                                                   
         MVI   REDCTDX+1,MXTRTQ                                                 
         MVI   REDCTREP-1,MXTRTQ                                                
         MVI   REDCTDCT-1,MXTRTQ                                                
         MVI   REDCTNAM-1,MXTRTQ                                                
         MVI   REDCTRTS-1,MXTRTQ                                                
         MVI   REDCTDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REDCTREP,RDCTKREP   REP COMPANY                                  
         TR    REDCTREP,MXTRT                                                   
         MVC   REDCTDCT,RDCTKCTY   DEV CON TYPE                                 
         TR    REDCTDCT,MXTRT                                                   
         MVC   REDCTNAM,RDCTDESC   DEV CON TYPE NAME                            
         TR    REDCTNAM,MXTRT                                                   
*                                                                               
*                                                                               
***      MVC   REDCTRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REDCTRTS(14),=C'19000101000000'                                  
         TR    REDCTRTS,MXTRT                                                   
*                                                                               
         MVI   REDCTDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REDCTDEL,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
REDCTLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPSTAC - EXTRACT STATION                                                     
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPSTAC  NMOD1 WORKL,*REPSTA*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RESTALIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING RESTAD,R2           R2=A(EXTRACT RECORD)                         
         USING RSTAREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
*****>>>NEW STATION CODE                                                        
         CLI   8(R1),1                                                          
         JL    RXSTAKIL            BUILD KILL RECORD                            
         JE    RXSTASER            BUILD SERIES OF RECORDS                      
         J     RXSTANXT            OUTPUT NEXT RECORD                           
         EJECT                                                                  
*                                                                               
*---------------------------------------------------------------------*         
* GET NEXT STATION RECORD IN SERIES AND RETURN IT                               
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSTANXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK?                         
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         LA    R0,RESTAD           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1               LENGTH OF NEXT RECORD                        
         ICM   R1,3,RESTALEN-RESTAD(RE)                                         
         LA    RF,0(R1,RE)         SAVE NEXT ADDRESS                            
         ST    RF,ANEXT                                                         
         LR    RF,R1               SET LENGTH                                   
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
*                                                                               
**ORIG CONTRACT ROUTINES                                                        
*---------------------------------------------------------------------*         
* BUILD 'K' RECORD FOR STATION RECORD AND EXIT                                  
*                                                                               
*   SOME NOTES ON 'KILL':                                                       
*                                                                               
*        THE EXACT RECORDS GENERATED BY THE LAST CHANGE OR                      
*        ADD CAN BE GENERATED AS 'KILLS' BY BRANCHING TO 'RXSTASER'             
*        IMMEDIATELY AFTER THE 'MVI   KILLMODE,C'Y'' STATEMENT                  
*        BELOW.  THIS REQUIRES THAT THE RECORD BEING POINTED TO IS              
*        'COPY' RECORD RATHER THAN 'CHANGE' RECORD.  RXTRACT MOD                
*        IS PASSING IN THE ADDRESS OF THE 'COPY' RATHER THAN THE                
*        'CHANGE' WHEN A 'KILL' IS REQUESTED.                                   
*        IF A SINGLE RECORD TO KILL A GROUP OF RECORDS IS NEEDED,               
*        THE CODE WILL CREATE A SINGLE RECORD OF TYPE, WITH SUFFICIENT          
*        INFORMATION TO KILL ALL ASSOCIATED RECORDS.  THE RECORD MUST           
*        HAVE SUFFICIENT KEY IDENTIFICATION TO MAKE IT UNIQUE, AND              
*        ALL KEYS THAT BEGIN WITH THAT PARTIAL KEY WILL BE DROPPED.             
*        THESE KEYS CAN BE GENERATED FROM THE 'CHANGE' KEY, IN WHICH            
*        CASE YOU DON'T REALLY KNOW WHAT HAD BEEN GENERATED PREV-               
*        IOUSLY BY THE 'COPY' KEY.                                              
*                                                                               
*        THE CODE IS CURRENTLY SET UP TO GENERATE A SINGLE KILL                 
*        RECORD WITH A PARTIAL KEY.                                             
*                                                                               
*                                                                               
*                                                                               
*        BILL  7/22/05 - STATION CODE ENTERED 10/07/05                          
*                                                                               
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSTAKIL DS    0H                                                               
         MVI   KILLMODE,C'Y'       SET TO 'KILL'                                
*                                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXSTACC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXSTASTA         FIRST KILL HEADER                            
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESTALEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         MVI   CLEARFLG,0          SET CLEAR TO 'NO'                            
*                                                                               
         LA    R6,RSTAREC          PERSONAL ID:                                 
         MVI   ELCODE,X'13'        PID ELEMENT?                                 
         BRAS  RE,GETEL                                                         
*                                                                               
*   FORCE NO-FIND FOR PIDS  !!  WE'RE SKIPPING THEM FOR NOW.                    
*                                                                               
         J     RXSK0020                                                         
***********************                                                         
         JNE   RXSK0020            NOT FOUND                                    
         BRAS  RE,RXSTAPID         THEN  KILL STATION PIDS                      
*                                     SINGLE KILL RECORD PRODUCED               
         MVI   CLEARFLG,1          SET CLEAR TO 'YES'                           
RXSK0020 EQU   *                                                                
*                                                                               
         LA    R6,RSTAREC          STATION BY OFFICE                            
         MVI   ELCODE,X'2D'        STATION BY OFFICE ELEMENT?                   
         BRAS  RE,GETEL                                                         
*                                                                               
         JNE   RXSK0040            NOT FOUND                                    
         BRAS  RE,RXSTASOF         THEN  KILL STATION BY OFFICE                 
*                                     SINGLE KILL RECORD PRODUCED               
         MVI   CLEARFLG,1          SET CLEAR TO 'YES'                           
*                                                                               
RXSK0040 EQU   *                                                                
*                                                                               
         LA    R6,RSTAREC          OTHER STATIONS IN MARKET                     
         MVI   ELCODE,X'02'        OTHER STATIONS IN MARKET?                    
         BRAS  RE,GETEL                                                         
         JNE   RXSK0060            NOT FOUND                                    
*                                                                               
         GOTO1 RXSTACOM,DMCB,(R6)  THEN  KILL OTHER STATIONS                    
*                                     SINGLE KILL RECORD PRODUCED               
         MVI   CLEARFLG,1          SET CLEAR TO 'YES'                           
*                                                                               
RXSK0060 EQU   *                                                                
*                                                                               
         LA    R6,RSTAREC          OFFICE TEAM                                  
         MVI   ELCODE,X'04'        OFFICE TEAM ELEMENT?                         
         BRAS  RE,GETEL                                                         
*                                                                               
         JNE   RXSK0080            NOT FOUND                                    
         BRAS  RE,RXSTAOTM         THEN  KILL OTHER STATIONS                    
*                                     SINGLE KILL RECORD PRODUCED               
         MVI   CLEARFLG,1          SET CLEAR TO 'YES'                           
*                                                                               
RXSK0080 EQU   *                                                                
*                                                                               
         LA    R6,RSTAREC          OFFICE TEAM                                  
         MVI   ELCODE,X'25'        STATION EMAIL ELEMENT?                       
         BRAS  RE,GETEL                                                         
*                                                                               
         JNE   RXSK0100            NOT FOUND                                    
         BRAS  RE,RXSTASEM         THEN  KILL OTHER STATIONS                    
*                                     SINGLE KILL RECORD PRODUCED               
         MVI   CLEARFLG,1          SET CLEAR TO 'YES'                           
*                                                                               
RXSK0100 EQU   *                                                                
*                                                                               
         CLI   CLEARFLG,1          CLEAR NEXT RECORD?                           
         JNE   EXIT                NO OTHER RECORDS FOUND / GENERATED           
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESTALEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     EXITR2                                                           
*                                                                               
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD SERIES OF RECORDS FOR THIS STATION                            *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSTASER DS    0H                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXSTACC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXSTASTA                                                      
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESTALEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         MVI   CLEARFLG,0          SET CLEAR TO 'NO'                            
         LA    R6,RSTAREC          PERSONAL ID:                                 
         MVI   ELCODE,X'13'        PID ELEMENT                                  
         BRAS  RE,GETEL                                                         
*                                                                               
*   FORCE NO-FIND FOR PIDS  !!  WE'RE SKIPPING THEM FOR NOW.                    
*                                                                               
         J     RXPD0060                                                         
***********************                                                         
         JNE   RXPD0060            NO PIDS                                      
*                                                                               
RXPD0020 EQU   *                                                                
         BRAS  RE,RXSTAPID         THEN  GEN PIDS                               
         MVI   CLEARFLG,1          SET CLEAR TO 'YES'                           
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESTALEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         ZIC   RF,1(R6)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R6,RF                                                            
         CLI   0(R6),X'13'         STATION PID ELEMENT?                         
         JE    RXPD0020            YES - GO BACK FOR PID ELEMENT                
RXPD0060 EQU   *                                                                
         LA    R6,RSTAREC          STATION BY OFFICE ELEMENT                    
         MVI   ELCODE,X'2D'                                                     
         BRAS  RE,GETEL                                                         
*&&DO                                                                           
*   TEST                                                                        
         CLC   =C'BILB',RSTAKSTA                                                
         BNE   TESTX020                                                         
         LA    RF,R6                                                            
         LA    RE,1                                                             
         DC    H'0'                                                             
TESTX020 EQU   *                                                                
*   TEST END                                                                    
*&&                                                                             
         JNE   RXPD0110            NO STATION BY OFFICE                         
         ZIC   R7,1(R6)            STRIP ELEMENT LENGTH                         
         SH    R7,=H'13'           DEDUCT 'CONTROL LEN'                         
         SRL   R7,1                DIVIDE REMAINING LEN BY 2 FOR                
*                                     OFFICE COUNT                              
         LA    R6,13(R6)           POINT TO FIRST OFFICE                        
*                                                                               
RXPD0080 EQU   *                                                                
         BRAS  RE,RXSTASOF         THEN  GEN STA BY OFFICE                      
         MVI   CLEARFLG,1          SET CLEAR TO 'YES'                           
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESTALEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
RXPD0100 EQU   *                                                                
         LA    R6,2(R6)            BUMP TO NEXT OFFICE                          
         BCT   R7,RXPD0080         GO BACK FOR NEXT                             
*                                                                               
RXPD0110 EQU   *                                                                
         LA    R6,RSTAREC          OTHER STATIONS IN MARKET                     
         XC    STATABL,STATABL                                                  
         MVI   ELCODE,X'02'        OTHER STATIONS ELEMENT                       
         BRAS  RE,GETEL                                                         
         JNE   RXPD0160            NO OTHER STATIONS                            
         J     RXPD0120                                                         
STATABL  DS    CL100                                                            
         DS    0F                                                               
RXPD0120 EQU   *                                                                
         GOTO1 RXDUPCHK,DMCB,(R6),STATABL                                       
*                                  CHECK FOR DUPLICATE STATION                  
         BNZ   RXPD0140            ALREADY IN TABLE: SKIP IT                    
*                                                                               
         GOTO1 RXSTACOM,DMCB,(R6)  OKAY: GEN OTHER STATION                      
         MVI   CLEARFLG,1          SET CLEAR TO 'YES'                           
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESTALEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
RXPD0140 EQU   *                                                                
         ZIC   RF,1(R6)            BUMP TO NEXT ELEMENT                         
         AR    R6,RF                                                            
         CLI   0(R6),X'02'         OTHER STATION ELEMENT?                       
         JE    RXPD0120            YES - GO BACK FOR OTHER STATION ELT          
*                                                                               
RXPD0160 EQU   *                                                                
         LA    R6,RSTAREC          OFFICE TEAM DATA                             
         XC    OTMTABL,OTMTABL     CLEAR DUPE TABLE                             
         MVI   ELCODE,X'04'        OFFICE TEAM ELEMENT                          
         BRAS  RE,GETEL                                                         
         JNE   RXPD0200            NO OTHER STATIONS                            
         J     RXPD0180                                                         
OTMTABL  DS    CL100                                                            
RXPD0180 EQU   *                                                                
         GOTO1 RXOTMDUP,DMCB,(R6),OTMTABL                                       
*                                  CHECK FOR DUPLICATE OFFICE/TEAM              
         BNZ   RXPD0190            ALREADY IN TABLE: SKIP IT                    
*                                                                               
         BRAS  RE,RXSTAOTM         THEN  GEN OFFICE TEAM                        
         MVI   CLEARFLG,1          SET CLEAR TO 'YES'                           
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESTALEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
RXPD0190 EQU   *                                                                
         ZIC   RF,1(R6)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R6,RF                                                            
         CLI   0(R6),X'04'         OFFICE TEAM ELEMENT?                         
         JE    RXPD0180            YES - GO BACK FOR OFFICE TEAM ELT            
RXPD0200 EQU   *                                                                
         LA    R6,RSTAREC          STA EMAIL DATA                               
         MVI   ELCODE,X'25'        STA EMAIL ELEMENT                            
         BRAS  RE,GETEL                                                         
         JNE   RXPD0240            NO OTHER EMAIL                               
         XC    FULL2,FULL2         CLEAR COUNTER                                
RXPD0220 EQU   *                                                                
         BRAS  RE,RXSTASEM         THEN  GEN STA EMAIL                          
         MVI   CLEARFLG,1          SET CLEAR TO 'YES'                           
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESTALEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         ZIC   RF,1(R6)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R6,RF                                                            
         CLI   0(R6),X'25'         STA EMAIL ELEMENT?                           
         JE    RXPD0220            YES - GO BACK FOR STA EMAIL ELT              
RXPD0240 EQU   *                                                                
         J     EXIT                FINISHED                                     
*                                                                               
*                                                                               
RXSTACC  DC    A(BUFFER1)          STATION RECORD SAVE AREA                     
*                                                                               
**                                                                              
RXSTASTA NTR1                                                                   
*                                                                               
         USING RESTAD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,RESTAD           CLEAR THE RECORD                             
         LA    R1,RESTADL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RESTALEN,RESTALEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RESTALEN(2),=AL2(RESTADL)                                        
         MVI   RESTAACT-1,MXTRTQ                                                
         MVI   RESTADAT-1,MXTRTQ                                                
         MVI   RESTATME-1,MXTRTQ                                                
         MVC   RESTATYP,REPSTAQ                                                 
         MVI   RESTADX,MXTRTQ                                                   
         MVI   RESTADX+1,MXTRTQ                                                 
         MVI   RESTAREP-1,MXTRTQ                                                
         MVI   RESTASTA-1,MXTRTQ                                                
         MVI   RESTAGRP-1,MXTRTQ                                                
         MVI   RESTAJDT-1,MXTRTQ                                                
         MVI   RESTALDT-1,MXTRTQ                                                
         MVI   RESTACDT-1,MXTRTQ                                                
         MVI   RESTAMKT-1,MXTRTQ                                                
         MVI   RESTAAFF-1,MXTRTQ                                                
         MVI   RESTAOWN-1,MXTRTQ                                                
         MVI   RESTACHN-1,MXTRTQ                                                
         MVI   RESTAINF-1,MXTRTQ                                                
         MVI   RESTAIDN-1,MXTRTQ                                                
         MVI   RESTANEW-1,MXTRTQ                                                
         MVI   RESTAFRM-1,MXTRTQ                                                
         MVI   RESTATVB-1,MXTRTQ                                                
         MVI   RESTARNK-1,MXTRTQ                                                
         MVI   RESTAMOU-1,MXTRTQ                                                
         MVI   RESTAURL-1,MXTRTQ                                                
         MVI   RESTATZ-1,MXTRTQ                                                 
         MVI   RESTAFAX-1,MXTRTQ                                                
         MVI   RESTALIA-1,MXTRTQ                                                
         MVI   RESTAINV-1,MXTRTQ                                                
         MVI   RESTAEC-1,MXTRTQ                                                 
         MVI   RESTATRF-1,MXTRTQ                                                
         MVI   RESTASTT-1,MXTRTQ                                                
         MVI   RESTADLU-1,MXTRTQ                                                
         MVI   RESTACBY-1,MXTRTQ                                                
         MVI   RESTACLU-1,MXTRTQ                                                
         MVI   RESTADCL-1,MXTRTQ                                                
         MVI   RESTACCM-1,MXTRTQ                                                
         MVI   RESTASC1-1,MXTRTQ                                                
         MVI   RESTASC2-1,MXTRTQ                                                
         MVI   RESTARTS-1,MXTRTQ                                                
         MVI   RESTADEL-1,MXTRTQ                                                
*                                                                               
B        USING RESTAD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RESTAACT,B.RESTAACT                                              
         MVC   RESTADAT,B.RESTADAT                                              
         MVC   RESTATME,B.RESTATME                                              
         DROP  B                                                                
*                                                                               
         MVC   RESTAREP,RSTAKREP   REP COMPANY                                  
         TR    RESTAREP,MXTRT                                                   
         MVC   RESTASTA,RSTAKSTA   STATION CODE                                 
         TR    RESTASTA,MXTRT                                                   
*                                  JOIN/LEAVE DATES                             
*                                                                               
***      MVC   RESTARTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RESTARTS(14),=C'19000101000000'                                  
         TR    RESTARTS,MXTRT                                                   
*                                                                               
         MVI   RESTADEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RESTADEL,MXTRT                                                   
*                                                                               
         GOTO1 DATCON,PLIST,(3,RSTASTRT),(10,RESTAJDT)                          
***      XC    RESTAJDT(2),RESTAJDT+3 SWAP MM AND DD ABOUT                      
***      XC    RESTAJDT+3(2),RESTAJDT                                           
***      XC    RESTAJDT(2),RESTAJDT+3                                           
         TR    RESTAJDT,MXTRT                                                   
*                                                                               
         OC    RSTAEND,RSTAEND                                                  
         JZ    RSTA0020                                                         
*                                                                               
         GOTO1 DATCON,PLIST,(3,RSTAEND),(10,RESTALDT)                           
***      XC    RESTALDT(2),RESTALDT+3 SWAP MM AND DD ABOUT                      
***      XC    RESTALDT+3(2),RESTALDT                                           
***      XC    RESTALDT(2),RESTALDT+3                                           
RSTA0020 DS    0H                                                               
         TR    RESTALDT,MXTRT                                                   
*                                                                               
         OC    RSTACLDT,RSTACLDT                                                
         JZ    RSTA0040                                                         
*                                  LAST INVOICED CLOSE DATE                     
         MVC   WORK(2),RSTACLDT                                                 
         MVI   WORK+2,X'01'        FUDGE USING 1ST OF MONTH                     
         GOTO1 DATCON,PLIST,(3,WORK),(10,RESTACDT)                              
***      XC    RESTACDT(2),RESTACDT+3 SWAP MM AND DD ABOUT                      
***      XC    RESTACDT+3(2),RESTACDT                                           
***      XC    RESTACDT(2),RESTACDT+3                                           
*                                                                               
RSTA0040 DS    0H                                                               
         TR    RESTACDT,MXTRT                                                   
*                                                                               
         MVC   RESTAGRP,RSTAGRUP   STATION GROUP CODE                           
         TR    RESTAGRP,MXTRT                                                   
         MVC   RESTAOWN,RSTAOWN    STATION OWNER CODE                           
         TR    RESTAOWN,MXTRT                                                   
         MVC   RESTAAFF,RSTAAFFL   STATION AFFILIATION                          
         TR    RESTAAFF,MXTRT                                                   
         EDIT  (B2,RSTACHAN),(4,RESTACHN),ALIGN=LEFT                            
         TR    RESTACHN,MXTRT                                                   
         MVC   RESTATVB,RSTATVB    TVB REGION CODE                              
         TR    RESTATVB,MXTRT                                                   
         MVC   RESTARNK,RSTARANK   STATION MARKET RANK                          
         TR    RESTARNK,MXTRT                                                   
*                                                                               
         MVI   RESTAMOU,C'N'       SET 'MEDIA OCEAN USER = NO'                  
         MVI   RESTAURL,C'N'       SET 'MEDIA OCEAN URL  = NO'                  
         MVI   RESTAINV,C'N'       SET INVOICE  = NO                            
         MVI   RESTAEC,C'N'        SET ELECTRONIC CONTACT = NO                  
         MVC   RESTASTT,=C'YYYYYYYY'                                            
*                                  SET ALL STATUSES 'YES'                       
                                                                                
         OC    RSTALIAB,RSTALIAB   ANY LIABILITY VALUE?                         
         BZ    RSTA0050            NO                                           
         EDIT  RSTALIAB,(2,RESTALIA),FILL=0                                     
RSTA0050 EQU   *                                                                
*&&DO                                                                           
*   TEST RSTALIAB                                                               
         LA    R0,1                                                             
         LA    RF,RSTALIAB                                                      
         LA    RE,RESTALIA                                                      
         DC    H'0'                                                             
*   TEST END                                                                    
*&&                                                                             
         MVC   RESTATRF,RSTATRAF   SET TRAFFIC FORMAT                           
         OC    RESTATRF,SPACES     OR IN SPACES                                 
*                                                                               
         LA    R1,RESTASTT         SET A(FIRST STATUS BYTE)                     
         ZIC   RF,RSTASTAT         STRIP OUT STATUS BYTE                        
         SLL   RF,24               MOVE BYTE TO HIGH ORDER                      
*                                                                               
         LA    R0,8                SET LOOP CONTROL                             
RSTA0060 EQU   *                                                                
         LTR   RF,RF               TEST HIGH-ORDER BIT                          
         BM    RSTA0080            NEGATIVE:  BIT ON                            
         MVI   0(R1),C'N'          NOT NEGATIVE: BIT OFF                        
*                                     TURN STATUS TO NO                         
RSTA0080 EQU   *                                                                
         LA    R1,1(R1)            BUMP TO NEXT STATUS POSITION                 
         SLL   RF,1                                                             
         BCT   R0,RSTA0060         GO BACK FOR NEXT                             
*                                                                               
         LA    R6,RSTAREC                                                       
         MVI   ELCODE,X'08'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RSTA0220                                                         
*                                                                               
         USING RSTAXXEL,R6                                                      
         MVC   RESTAMKT,RSTAMKTC   STATION MARKET CODE                          
         MVC   RESTAINF,RSTAOSI    STATION INTERFACE CODE                       
         MVC   RESTATZ,RSTATZ      STATION TIME ZONE                            
         TM    RSTAOPTC,X'04'      TEST FOR MO USER                             
         BNO   RSTA0100            NOT MO USER                                  
         MVI   RESTAMOU,C'Y'       SET 'MEDIA OCEAN USER = YES'                 
*                                                                               
RSTA0100 DS    0H                                                               
         TM    RSTAXOPT,X'40'      INVOICE ?                                    
         BNO   RSTA0120            NO                                           
         MVI   RESTAINV,C'Y'       SET 'INVOICE = YES'                          
*                                                                               
RSTA0120 DS    0H                                                               
         TM    RSTAXOPT,X'80'      EC STATION?                                  
         BNO   RSTA0140            NO                                           
         MVI   RESTAEC,C'Y'        SET 'EC = YES'                               
*                                                                               
RSTA0140 DS    0H                                                               
         TM    RSTAOPTC,X'02'      TEST FOR URL = YES                           
         BNO   RSTA0160            NOT MO USER                                  
         MVI   RESTAURL,C'Y'       SET 'MEDIA OCEAN USER = YES'                 
*                                                                               
RSTA0160 DS    0H                                                               
         CLI   RSTAOFAX,X'00'      FIRST BYTE EMPTY?                            
         BNE   RSTA0200            NO  - JUST PUT OUT WHAT'S THERE              
         CLI   RSTAOFAX+1,X'00'    ANYTHING IN SECOND BYTE?                     
         BE    RSTA0200            NO  - JUST PUT OUT WHAT'S THERE              
         ZIC   R3,RSTAOFAX+1       INTERNATIONAL CODE                           
         EDIT  (R3),(3,RESTAFAX),FILL=0                                         
         UNPK  WORK(16),RSTAOFAX+3(8)                                           
         ZIC   RF,RSTAOFAX+2       LENGTH OF SIGNIFICANT DIGITS                 
         LA    RE,16               MAXIMUM LENGTH OF FIELD                      
         SR    RE,RF               GET SIGNIFICANT OFFSET                       
         LA    RF,WORK             A(UNPACKED NUMBER)                           
         AR    RF,RE               ADD OFFSET                                   
         ZIC   RE,RSTAOFAX+2       GET LENGTH OF FAX# FIELD AGAIN               
         BCTR  RE,0                DECREMENT FOR EX                             
         EX    RE,RSTA0180         MOVE BY LENGTH                               
         B     RSTA0220                                                         
RSTA0180 MVC   RESTAFAX+3(0),0(RF)                                              
*                                                                               
RSTA0200 EQU   *                                                                
         MVC   RESTAFAX(L'RSTAOFAX),RSTAOFAX   FAX NUMBER                       
         DROP  R6                                                               
RSTA0220 EQU   *                                                                
         TR    RESTAMKT,MXTRT                                                   
         TR    RESTAINF,MXTRT                                                   
         TR    RESTAMOU,MXTRT                                                   
         TR    RESTAURL,MXTRT                                                   
         TR    RESTATZ,MXTRT                                                    
         TR    RESTAFAX,MXTRT                                                   
         TR    RESTAINV,MXTRT                                                   
         TR    RESTAEC,MXTRT                                                    
         TR    RESTATRF,MXTRT                                                   
         TR    RESTASTT,MXTRT                                                   
*                                                                               
         LA    R6,RSTAREC                                                       
         MVI   ELCODE,X'0C'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RSTA0240                                                         
*                                                                               
         USING RSTAFNEL,R6                                                      
         MVC   RESTANEW,RSTAFNNE   NEW REP                                      
         MVC   RESTAFRM,RSTAFNFO   FORMER REP                                   
         DROP  R6                                                               
*                                                                               
RSTA0240 DS    0H                                                               
         TR    RESTANEW,MXTRT                                                   
         TR    RESTAFRM,MXTRT                                                   
*                                                                               
         LA    R6,RSTAREC                                                       
         MVI   ELCODE,X'0F'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RSTA0260                                                         
*                                                                               
         USING RSTAINEL,R6                                                      
         EDIT  (B4,RSTAINID),(10,RESTAIDN),ALIGN=LEFT                           
         DROP  R6                                                               
*                                                                               
RSTA0260 DS    0H                                                               
         TR    RESTAIDN,MXTRT                                                   
*                                                                               
         LA    R6,RSTAREC                                                       
         MVI   ELCODE,X'23'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RSTA0280                                                         
*                                                                               
         USING RSTACOEL,R6                                                      
         CLC   =X'FFFFFF',RSTACODT DEFAULT DATE?                                
         BE    RSTA0261            YES - DON'T OUTPUT                           
         GOTO1 DATCON,PLIST,(3,RSTACODT),(10,RESTADCL)                          
*                                  SET DATE CLOSED                              
RSTA0261 EQU   *                                                                
         TM    RSTACOFL,X'80'      SET CLOSED BY INDICATOR                      
         BNO   RSTA0262                                                         
         MVC   RESTACBY,=C'TAPE'                                                
         B     RSTA0280                                                         
RSTA0262 EQU   *                                                                
         TM    RSTACOFL,X'40'      SET CLOSED BY INDICATOR                      
         BNO   RSTA0264                                                         
         MVC   RESTACBY,=C'INVC'                                                
         B     RSTA0280                                                         
RSTA0264 EQU   *                                                                
         TM    RSTACOFL,X'20'      SET CLOSED BY INDICATOR                      
         BNO   RSTA0266                                                         
         MVC   RESTACBY,=C'RE16'                                                
         B     RSTA0280                                                         
RSTA0266 EQU   *                                                                
         TM    RSTACOFL,X'10'      SET CLOSED BY INDICATOR                      
         BNO   RSTA0268                                                         
         MVC   RESTACBY,=C'FILE'                                                
         B     RSTA0280                                                         
RSTA0268 EQU   *                                                                
         DROP  R6                                                               
*                                                                               
RSTA0280 DS    0H                                                               
         TR    RESTACBY,MXTRT                                                   
         TR    RESTADCL,MXTRT                                                   
*                                                                               
         LA    R6,RSTAREC                                                       
         MVI   ELCODE,X'F1'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RSTA0300                                                         
*                                                                               
         USING RSTACTEL,R6                                                      
         GOTO1 DATCON,PLIST,(3,RSTACTCD),(10,RESTADLU)                          
*                                  SET DATE CLOSED                              
         MVC   RESTACLU,RSTACTCI   SET LUID OF LAST CHANGE                      
*                                                                               
         DROP  R6                                                               
RSTA0300 EQU   *                                                                
         TR    RESTADLU,MXTRT                                                   
         TR    RESTACLU,MXTRT                                                   
*                                                                               
         LA    R6,RSTAREC                                                       
         MVI   ELCODE,X'03'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RSTA0320                                                         
*                                                                               
         USING RSTACEL,R6                                                       
         ZIC   RF,1(R6)            GET ELEMENT LENGTH                           
         SH    RF,=H'5'            SUBTRACT MISCELLANEOUS                       
         LTR   RF,RF               STILL A VALUE?                               
         BM    RSTA0320            WENT NEGATIVE: NO DATA                       
         BZ    RSTA0320            ZERO - NO REAL DATA                          
         EX    RF,RSTA0310                                                      
         OC    RESTACCM,SPACES     OR IN SPACES                                 
         B     RSTA0320                                                         
RSTA0310 MVC   RESTACCM(0),4(R6)   MOVE COMMENT BY LENGTH                       
         DROP  R6                                                               
RSTA0320 EQU   *                                                                
         TR    RESTACCM,MXTRT                                                   
*                                                                               
         LA    R0,2                SET LOOP CONTROL                             
         LA    R5,RESTASC1         SET A(1ST STATION COMMENT)                   
*                                                                               
         LA    R6,RSTAREC                                                       
         MVI   ELCODE,X'0B'        GET STATION COMMENTS, IF ANY                 
         BRAS  RE,GETEL                                                         
         JNE   RSTA0360                                                         
*                                                                               
RSTA0325 EQU   *                                                                
         USING RSTACMEC,R6                                                      
         ZIC   RF,1(R6)            GET ELEMENT LENGTH                           
         SH    RF,=H'3'            SUBTRACT MISCELLANEOUS                       
         LTR   RF,RF               STILL A VALUE?                               
         BM    RSTA0340            WENT NEGATIVE: NO DATA                       
         BZ    RSTA0340            ZERO - NO REAL DATA                          
         EX    RF,RSTA0330                                                      
         OC    0(65,R5),SPACES     OR IN SPACES                                 
         B     RSTA0340                                                         
RSTA0330 MVC   0(0,R5),2(R6)       MOVE COMMENT BY LENGTH                       
         DROP  R6                                                               
RSTA0340 EQU   *                                                                
         LA    R5,RESTASC2         SET TO SECOND COMMENT                        
         BRAS  RE,NEXTEL                                                        
         JNE   RSTA0360            NO SECOND COMMENT                            
         BCT   R0,RSTA0325         SECOND COMMENT: PROCESS IT                   
RSTA0360 EQU   *                                                                
         TR    RESTASC1,MXTRT                                                   
         TR    RESTASC2,MXTRT                                                   
         J     EXITR2                                                           
*                                                                               
         DROP  R2                                                               
RESTALIT DC    A(LITERAL)                                                       
*                                                                               
*                                                                               
**********************************************************************          
*   STATION PID   GENERATION                                         *          
*   R6  ->  STATION RECORD X'13' ELEMENT                             *          
*                                                                    *          
**********************************************************************          
RXSTAPID NTR1                                                                   
*                                                                               
         USING REPIDD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,REPIDD           CLEAR THE RECORD                             
         LA    R1,REPIDDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REPIDLEN,REPIDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REPIDLEN(2),=AL2(REPIDDL)                                        
         MVI   REPIDACT-1,MXTRTQ                                                
         MVI   REPIDDAT-1,MXTRTQ                                                
         MVI   REPIDTME-1,MXTRTQ                                                
         MVC   REPIDTYP,REPPIDQ                                                 
         MVI   REPIDDX,MXTRTQ                                                   
         MVI   REPIDDX+1,MXTRTQ                                                 
         MVI   REPIDREP-1,MXTRTQ                                                
         MVI   REPIDSTA-1,MXTRTQ                                                
         MVI   REPIDPID-1,MXTRTQ                                                
         MVI   REPIDRTS-1,MXTRTQ                                                
         MVI   REPIDDEL-1,MXTRTQ                                                
*                                                                               
B        USING REPIDD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REPIDACT,B.REPIDACT                                              
         MVC   REPIDDAT,B.REPIDDAT                                              
         MVC   REPIDTME,B.REPIDTME                                              
         DROP  B                                                                
*                                                                               
         MVC   REPIDREP,RSTAKREP   REP COMPANY                                  
         TR    REPIDREP,MXTRT                                                   
         MVC   REPIDSTA,RSTAKSTA                                                
         TR    REPIDSTA,MXTRT                                                   
*                                                                               
         MVC   REPIDRTS(14),=C'19000101000000'                                  
         TR    REPIDRTS,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
*                                                                               
         USING RSTPDTEL,R6                                                      
         MVC   REPIDPID,RSTADTPI   INSERT PID                                   
         TR    REPIDPID,MXTRT                                                   
*                                                                               
         J     EXITR2                                                           
*                                                                               
         EJECT                                                                  
*                                                                               
         LTORG                                                                  
         DROP  R2,R6                                                            
         EJECT                                                                  
*                                                                               
**********************************************************************          
*   STATION OFFICE GENERATION                                        *          
*   R6  ->  STATION RECORD X'2D' OFFICE IN LIST                      *          
*                                                                    *          
**********************************************************************          
RXSTASOF NTR1                                                                   
*                                                                               
         USING RESOFD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,RESOFD           CLEAR THE RECORD                             
         LA    R1,RESOFDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RESOFLEN,RESOFLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RESOFLEN(2),=AL2(RESOFDL)                                        
         MVI   RESOFACT-1,MXTRTQ                                                
         MVI   RESOFDAT-1,MXTRTQ                                                
         MVI   RESOFTME-1,MXTRTQ                                                
         MVC   RESOFTYP,REPSOFQ                                                 
         MVI   RESOFDX,MXTRTQ                                                   
         MVI   RESOFDX+1,MXTRTQ                                                 
         MVI   RESOFREP-1,MXTRTQ                                                
         MVI   RESOFSTA-1,MXTRTQ                                                
         MVI   RESOFOFF-1,MXTRTQ                                                
         MVI   RESOFRTS-1,MXTRTQ                                                
         MVI   RESOFDEL-1,MXTRTQ                                                
*                                                                               
B        USING RESOFD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RESOFACT,B.RESOFACT                                              
         MVC   RESOFDAT,B.RESOFDAT                                              
         MVC   RESOFTME,B.RESOFTME                                              
         DROP  B                                                                
*                                                                               
         MVI   RESOFDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RESOFDEL,MXTRT                                                   
*                                                                               
         MVC   RESOFREP,RSTAKREP   REP COMPANY                                  
         TR    RESOFREP,MXTRT                                                   
         MVC   RESOFSTA,RSTAKSTA                                                
         TR    RESOFSTA,MXTRT                                                   
*                                                                               
         MVC   RESOFRTS(14),=C'19000101000000'                                  
         TR    RESOFRTS,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    RSOF0020                                                         
*                                                                               
         MVC   RESOFOFF,0(R6)      INSERT STATION OFFICE                        
         TR    RESOFOFF,MXTRT                                                   
*                                                                               
RSOF0020 EQU   *                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESOFLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     EXITR2                                                           
*                                                                               
         EJECT                                                                  
*                                                                               
         LTORG                                                                  
         DROP  R2                                                               
         EJECT                                                                  
****>>>> REP OTHER STATION                                                      
**********************************************************************          
*   OTHER STATION  DUPLICATE CHECK                                   *          
*   R6  ->  STATION RECORD X'02' OTHER STATION ELEMENT               *          
*           STATABL:  WORK SPACE FOR STATIONS IN X'02' ELEMENTS      *          
**********************************************************************          
RXDUPCHK NTR1                                                                   
*                                                                               
         L     R6,0(R1)            RESET A(ELEMENT IN PROGRESS)                 
         USING RSTAMKEL,R6                                                      
*                                                                               
         L     R5,4(R1)            SET A(STATABL)                               
RXDU0020 EQU   *                                                                
         OC    0(5,R5),0(R5)       ENTRY IN SLOT?                               
         BZ    RXDU0040            NO  - INSERT STATION IN SLOT                 
         CLC   RSTAMKST,0(R5)      YES - IS STATION ALREADY IN TABLE?           
         BE    RXDU0060            YES - EXIT CC NOT ZERO                       
         LA    R5,5(R5)            NO  - BUMP TO NEXT TABLE SLOT                
         B     RXDU0020            CHECK NEXT SLOT                              
RXDU0040 EQU   *                                                                
         MVC   0(5,R5),RSTAMKST    INSERT STATION CALL LETTERS                  
         SR    R0,R0               SET CC ZERO                                  
         B     RXDU0900            EXIT                                         
         DROP  R6                                                               
RXDU0060 EQU   *                                                                
         LTR   RB,RB               SET CC NOT ZERO                              
         B     RXDU0900            EXIT                                         
RXDU0900 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
**********************************************************************          
*   OTHER STATION  GENERATION                                        *          
*   R6  ->  STATION RECORD X'02' OTHER STATION ELEMENT               *          
*                                                                    *          
**********************************************************************          
RXSTACOM NTR1                                                                   
*                                                                               
         USING RECMSD,R2           R2=A(EXTRACT RECORD)                         
         L     R6,0(R1)            RESET A(ELEMENT IN PROGRESS)                 
*                                                                               
         LA    R0,RECMSD           CLEAR THE RECORD                             
         LA    R1,RECMSDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RECMSLEN,RECMSLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RECMSLEN(2),=AL2(RECMSDL)                                        
         MVI   RECMSACT-1,MXTRTQ                                                
         MVI   RECMSDAT-1,MXTRTQ                                                
         MVI   RECMSTME-1,MXTRTQ                                                
         MVC   RECMSTYP,REPCMSQ                                                 
         MVI   RECMSDX,MXTRTQ                                                   
         MVI   RECMSDX+1,MXTRTQ                                                 
         MVI   RECMSREP-1,MXTRTQ                                                
         MVI   RECMSRST-1,MXTRTQ                                                
         MVI   RECMSCST-1,MXTRTQ                                                
         MVI   RECMSAFF-1,MXTRTQ                                                
         MVI   RECMSRTS-1,MXTRTQ                                                
         MVI   RECMSDEL-1,MXTRTQ                                                
*                                                                               
B        USING RECMSD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RECMSACT,B.RECMSACT                                              
         MVC   RECMSDAT,B.RECMSDAT                                              
         MVC   RECMSTME,B.RECMSTME                                              
         DROP  B                                                                
*                                                                               
         MVI   RECMSDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RECMSDEL,MXTRT                                                   
*                                                                               
         MVC   RECMSREP,RSTAKREP   REP COMPANY                                  
         TR    RECMSREP,MXTRT                                                   
         MVC   RECMSRST,RSTAKSTA                                                
         TR    RECMSRST,MXTRT                                                   
*                                                                               
         MVC   RECMSRTS(14),=C'19000101000000'                                  
         TR    RECMSRTS,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    RCMS0020                                                         
*                                                                               
         MVC   RECMSCST,2(R6)      INSERT OTHER STATION                         
         TR    RECMSCST,MXTRT                                                   
         MVC   RECMSAFF,7(R6)      INSERT OTHER STATION AFFILIATE               
         TR    RECMSAFF,MXTRT                                                   
*                                                                               
RCMS0020 EQU   *                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RECMSLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     EXITR2                                                           
*                                                                               
         EJECT                                                                  
*                                                                               
         LTORG                                                                  
         DROP  R2                                                               
         EJECT                                                                  
****>>>>                                                                        
****>>>> OFFICE TEAM DUPLICATE CHECK                                            
**********************************************************************          
*   OFFICE TEAM    DUPLICATE CHECK                                   *          
*   R6  ->  STATION RECORD X'04' OTHER STATION ELEMENT               *          
*           OTMTABL:  WORK SPACE FOR DATA     IN X'04' ELEMENTS      *          
**********************************************************************          
RXOTMDUP NTR1                                                                   
*                                                                               
         L     R6,0(R1)            RESET A(ELEMENT IN PROGRESS)                 
         USING RSTAOTEL,R6                                                      
*                                                                               
         L     R5,4(R1)            SET A(OTMTABL)                               
RXOT0020 EQU   *                                                                
         OC    0(4,R5),0(R5)       ENTRY IN SLOT?                               
         BZ    RXOT0040            NO  - INSERT OFF/TEAM IN SLOT                
         CLC   RSTAOTOF(4),0(R5)   YES - IS OFF/TEAM ALREADY IN TABLE?          
         BE    RXOT0060            YES - EXIT CC NOT ZERO                       
         LA    R5,4(R5)            NO  - BUMP TO NEXT TABLE SLOT                
         B     RXOT0020            CHECK NEXT SLOT                              
RXOT0040 EQU   *                                                                
         MVC   0(4,R5),RSTAOTOF    INSERT OFF/TEAM                              
         SR    R0,R0               SET CC ZERO                                  
         B     RXOT0900            EXIT                                         
         DROP  R6                                                               
RXOT0060 EQU   *                                                                
         LTR   RB,RB               SET CC NOT ZERO                              
         B     RXOT0900            EXIT                                         
RXOT0900 EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
****>>>> OFFICE TEAM DUPLICATE CHECK                                            
****>>>> REP OFFICE TEAM                                                        
**********************************************************************          
*   OFFICE TEAM    GENERATION                                        *          
*   R6  ->  STATION RECORD X'04' OFFICE IN LIST                      *          
*                                                                    *          
**********************************************************************          
RXSTAOTM NTR1                                                                   
*                                                                               
         USING REOTMD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,REOTMD           CLEAR THE RECORD                             
         LA    R1,REOTMDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REOTMLEN,REOTMLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REOTMLEN(2),=AL2(REOTMDL)                                        
         MVI   REOTMACT-1,MXTRTQ                                                
         MVI   REOTMDAT-1,MXTRTQ                                                
         MVI   REOTMTME-1,MXTRTQ                                                
         MVC   REOTMTYP,REPOTMQ                                                 
         MVI   REOTMDX,MXTRTQ                                                   
         MVI   REOTMDX+1,MXTRTQ                                                 
         MVI   REOTMREP-1,MXTRTQ                                                
         MVI   REOTMRST-1,MXTRTQ                                                
         MVI   REOTMCOF-1,MXTRTQ                                                
         MVI   REOTMATM-1,MXTRTQ                                                
         MVI   REOTMRTS-1,MXTRTQ                                                
         MVI   REOTMDEL-1,MXTRTQ                                                
*                                                                               
B        USING REOTMD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REOTMACT,B.REOTMACT                                              
         MVC   REOTMDAT,B.REOTMDAT                                              
         MVC   REOTMTME,B.REOTMTME                                              
         DROP  B                                                                
*                                                                               
         MVI   REOTMDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REOTMDEL,MXTRT                                                   
*                                                                               
         MVC   REOTMREP,RSTAKREP   REP COMPANY                                  
         TR    REOTMREP,MXTRT                                                   
         MVC   REOTMRST,RSTAKSTA                                                
         TR    REOTMRST,MXTRT                                                   
*                                                                               
         MVC   REOTMRTS(14),=C'19000101000000'                                  
         TR    REOTMRTS,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    ROTM0020                                                         
*                                                                               
         MVC   REOTMCOF,2(R6)      INSERT OFFICE CODE                           
         TR    REOTMCOF,MXTRT                                                   
         MVC   REOTMATM,4(R6)      INSERT TEAM   CODE                           
         TR    REOTMATM,MXTRT                                                   
*                                                                               
ROTM0020 EQU   *                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REOTMLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     EXITR2                                                           
*                                                                               
         EJECT                                                                  
*                                                                               
         LTORG                                                                  
         DROP  R2                                                               
         EJECT                                                                  
****>>>>                                                                        
*  STA EMAIL                                                                    
**********************************************************************          
*   STA EMAIL      GENERATION                                        *          
*   R6  ->  STATION RECORD X'25' OFFICE IN LIST                      *          
*                                                                    *          
**********************************************************************          
RXSTASEM NTR1                                                                   
*                                                                               
         USING RESEMD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,RESEMD           CLEAR THE RECORD                             
         LA    R1,RESEMDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RESEMLEN,RESEMLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RESEMLEN(2),=AL2(RESEMDL)                                        
         MVI   RESEMACT-1,MXTRTQ                                                
         MVI   RESEMDAT-1,MXTRTQ                                                
         MVI   RESEMTME-1,MXTRTQ                                                
         MVC   RESEMTYP,REPSEMQ                                                 
         MVI   RESEMDX,MXTRTQ                                                   
         MVI   RESEMDX+1,MXTRTQ                                                 
         MVI   RESEMREP-1,MXTRTQ                                                
         MVI   RESEMSTA-1,MXTRTQ                                                
         MVI   RESEMEM#-1,MXTRTQ                                                
         MVI   RESEMEML-1,MXTRTQ                                                
         MVI   RESEMRTS-1,MXTRTQ                                                
         MVI   RESEMDEL-1,MXTRTQ                                                
*                                                                               
B        USING RESEMD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RESEMACT,B.RESEMACT                                              
         MVC   RESEMDAT,B.RESEMDAT                                              
         MVC   RESEMTME,B.RESEMTME                                              
         DROP  B                                                                
*                                                                               
         MVI   RESEMDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RESEMDEL,MXTRT                                                   
*                                                                               
         MVC   RESEMREP,RSTAKREP   REP COMPANY                                  
         TR    RESEMREP,MXTRT                                                   
         MVC   RESEMSTA,RSTAKSTA                                                
         TR    RESEMSTA,MXTRT                                                   
*                                                                               
         MVC   RESEMRTS(14),=C'19000101000000'                                  
         TR    RESEMRTS,MXTRT                                                   
*                                                                               
         MVC   RESEMEML,SPACES     SET EMAIL ADDR TO SPACE                      
         MVC   RESEMEM#,SPACES     SET COUNT      TO SPACE                      
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXITR2                                                           
*                                                                               
         L     RF,FULL2            INCREMENT COUNTER                            
         LA    RF,1(RF)                                                         
         ST    RF,FULL2            SAVE NEW COUNTER                             
         EDIT (4,FULL2),(2,RESEMEM#),FILL=0                                     
*                                                                               
*   EMAIL ELEMENT HAS A FLAG BYTE IMMEDIATELY FOLLOWING CONTROL.                
*        EX IS ADJUSTED TO ACCOUNT FOR THAT BYTE                                
*                                                                               
         ZICM  RE,1(R6)            EXTRACT LENGTH OF COMMENT ELEMENT            
         SH    RE,=H'4'            SUBTRACT FOR EX                              
         EX    RE,RXSM0030         MOVE EMAIL BY LENGTH                         
         EX    RE,RXSM0032         OR IN SPACES BY LENGTH                       
         TR    RESEMEML,MXTRT                                                   
         B     RXSM0040                                                         
RXSM0030 EQU   *                                                                
         MVC   RESEMEML(0),3(R6)                                                
RXSM0032 EQU   *                                                                
         OC    RESEMEML(0),SPACES                                               
*                                                                               
RXSM0040 EQU   *                                                                
         TR    RESEMEML,MXTRT                                                   
         TR    RESEMEM#,MXTRT                                                   
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESEMLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     EXITR2                                                           
*                                                                               
         EJECT                                                                  
*                                                                               
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
*  STA EMAIL                                                                    
***********************************************************************         
* REPGRPC - EXTRACT GROUP/SUB GROUP                                             
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPGRPC  NMOD1 WORKL,*REPGRP*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REGRPLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REGRPD,R2           R2=A(EXTRACT RECORD)                         
         USING RGRPREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REGRPLEN,REGRPLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REGRPLEN(2),=AL2(REGRPDL)                                        
         MVC   REGRPTYP,REPGRPQ                                                 
         MVI   REGRPDX,MXTRTQ                                                   
         MVI   REGRPDX+1,MXTRTQ                                                 
         MVI   REGRPREP-1,MXTRTQ                                                
         MVI   REGRPGRP-1,MXTRTQ                                                
         MVI   REGRPNAM-1,MXTRTQ                                                
         MVI   REGRPSNM-1,MXTRTQ                                                
         MVI   REGRPRTS-1,MXTRTQ                                                
         MVI   REGRPDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REGRPREP,RGRPKREP   REP COMPANY                                  
         TR    REGRPREP,MXTRT                                                   
         MVC   REGRPGRP,RGRPKGRP   GROUP CODE                                   
         TR    REGRPGRP,MXTRT                                                   
         MVC   REGRPNAM,RGRPNAME   GROUP NAME                                   
         TR    REGRPNAM,MXTRT                                                   
         MVC   REGRPSNM,RGRPSBNM   SUB GROUP NAME                               
         TR    REGRPSNM,MXTRT                                                   
*                                                                               
***      MVC   REGRPRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REGRPRTS(14),=C'19000101000000'                                  
         TR    REGRPRTS,MXTRT                                                   
*                                                                               
         MVI   REGRPDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REGRPDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
REGRPLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
*********>>>>>>>>   REGION                                                      
***********************************************************************         
* REPRGNC - EXTRACT REGION                                                      
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPRGNC  NMOD1 WORKL,*REPRGN*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RERGNLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING RERGND,R2           R2=A(EXTRACT RECORD)                         
         USING RREGREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    RERGNLEN,RERGNLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RERGNLEN(2),=AL2(RERGNDL)                                        
         MVC   RERGNTYP,REPRGNQ                                                 
         MVI   RERGNDX,MXTRTQ                                                   
         MVI   RERGNDX+1,MXTRTQ                                                 
         MVI   RERGNREP-1,MXTRTQ                                                
         MVI   RERGNREG-1,MXTRTQ                                                
         MVI   RERGNNAM-1,MXTRTQ                                                
         MVI   RERGNRTS-1,MXTRTQ                                                
         MVI   RERGNDEL-1,MXTRTQ                                                
*                                                                               
         MVC   RERGNREP,RREGKREP   REP COMPANY                                  
         TR    RERGNREP,MXTRT                                                   
         MVC   RERGNREG,RREGKREG   REGION CODE                                  
         TR    RERGNREG,MXTRT                                                   
         MVC   RERGNNAM,RREGNAME   REGION NAME                                  
         TR    RERGNNAM,MXTRT                                                   
*                                                                               
***      MVC   RERGNRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RERGNRTS(14),=C'19000101000000'                                  
         TR    RERGNRTS,MXTRT                                                   
*                                                                               
         MVI   RERGNDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RERGNDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
RERGNLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
*********>>>>>>>>   REGION                                                      
         EJECT                                                                  
*********>>>>>>>>   TERRITORY                                                   
***********************************************************************         
* REPTERC - EXTRACT TERRITORY                                                   
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPTERC  NMOD1 WORKL,*REPTER*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RETERLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING RETERD,R2           R2=A(EXTRACT RECORD)                         
         USING RTERREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    RETERLEN,RETERLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RETERLEN(2),=AL2(RETERDL)                                        
         MVC   RETERTYP,REPTERQ                                                 
         MVI   RETERDX,MXTRTQ                                                   
         MVI   RETERDX+1,MXTRTQ                                                 
         MVI   RETERREP-1,MXTRTQ                                                
         MVI   RETERTER-1,MXTRTQ                                                
         MVI   RETERNAM-1,MXTRTQ                                                
         MVI   RETERRTS-1,MXTRTQ                                                
         MVI   RETERDEL-1,MXTRTQ                                                
*                                                                               
         MVC   RETERREP,RTERKREP   REP COMPANY                                  
         TR    RETERREP,MXTRT                                                   
         MVC   RETERTER,RTERKTER   TERRITORY CODE                               
         TR    RETERTER,MXTRT                                                   
         MVC   RETERNAM,RTERNAME   TERRITORY NAME                               
         TR    RETERNAM,MXTRT                                                   
*                                                                               
***      MVC   RETERRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RETERRTS(14),=C'19000101000000'                                  
         TR    RETERRTS,MXTRT                                                   
*                                                                               
         MVI   RETERDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RETERDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
RETERLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
*********>>>>>>>>   TERRITORY                                                   
         EJECT                                                                  
***********************************************************************         
* REPDSPC - EXTRACT DEVELOPMENT SALESPERSON                                     
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPDSPC  NMOD1 WORKL,*REPDSP*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REDSPLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REDSPD,R2           R2=A(EXTRACT RECORD)                         
         USING RDSPREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REDSPLEN,REDSPLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REDSPLEN(2),=AL2(REDSPDL)                                        
         MVC   REDSPTYP,REPDSPQ                                                 
         MVI   REDSPDX,MXTRTQ                                                   
         MVI   REDSPDX+1,MXTRTQ                                                 
         MVI   REDSPREP-1,MXTRTQ                                                
         MVI   REDSPSAL-1,MXTRTQ                                                
         MVI   REDSPNAM-1,MXTRTQ                                                
         MVI   REDSPTEL-1,MXTRTQ                                                
         MVI   REDSPFAX-1,MXTRTQ                                                
         MVI   REDSPLDT-1,MXTRTQ                                                
         MVI   REDSPRTS-1,MXTRTQ                                                
         MVI   REDSPDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REDSPREP,RDSPKREP   REP COMPANY                                  
         TR    REDSPREP,MXTRT                                                   
         MVC   REDSPSAL,RDSPKSAL   DEV SALESPERSON CODE                         
         TR    REDSPSAL,MXTRT                                                   
         MVC   REDSPNAM,RDSPNAME   DEV SALESPERSON NAME                         
         TR    REDSPNAM,MXTRT                                                   
         MVC   REDSPTEL,RDSPTEL    DEV SALESPERSON TELEPHONE #                  
         TR    REDSPTEL,MXTRT                                                   
         MVC   REDSPFAX,RDSPFAX    DEV SALESPERSON FAX       #                  
         TR    REDSPFAX,MXTRT                                                   
         GOTO1 DATCON,PLIST,(2,RDSPLEAV),(10,REDSPLDT)                          
         TR    REDSPLDT,MXTRT                                                   
*                                                                               
***      MVC   REDSPRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REDSPRTS(14),=C'19000101000000'                                  
         TR    REDSPRTS,MXTRT                                                   
*                                                                               
         MVI   REDSPDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REDSPDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
REDSPLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPTEMC - EXTRACT TEAM                                                        
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPTEMC  NMOD1 WORKL,*REPTEM*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RETEMLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING RETEMD,R2           R2=A(EXTRACT RECORD)                         
         USING RTEMREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    RETEMLEN,RETEMLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RETEMLEN(2),=AL2(RETEMDL)                                        
         MVC   RETEMTYP,REPTEMQ                                                 
         MVI   RETEMDX,MXTRTQ                                                   
         MVI   RETEMDX+1,MXTRTQ                                                 
         MVI   RETEMREP-1,MXTRTQ                                                
         MVI   RETEMTEM-1,MXTRTQ                                                
         MVI   RETEMNAM-1,MXTRTQ                                                
         MVI   RETEMDIV-1,MXTRTQ                                                
         MVI   RETEMRTS-1,MXTRTQ                                                
         MVI   RETEMDEL-1,MXTRTQ                                                
*                                                                               
         MVC   RETEMREP,RTEMKREP   REP COMPANY                                  
         TR    RETEMREP,MXTRT                                                   
         MVC   RETEMTEM,RTEMKTEM   TEAM CODE                                    
         TR    RETEMTEM,MXTRT                                                   
         MVC   RETEMNAM,RTEMNAME   TEAM NAME                                    
         TR    RETEMNAM,MXTRT                                                   
         MVC   RETEMDIV,RTEMDVNM   TEAM DIVISION NAME                           
         TR    RETEMDIV,MXTRT                                                   
*                                                                               
***      MVC   RETEMRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RETEMRTS(14),=C'19000101000000'                                  
         TR    RETEMRTS,MXTRT                                                   
*                                                                               
         MVI   RETEMDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RETEMDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
RETEMLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPPRDC - EXTRACT PRODUCT                                                     
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPPRDC  NMOD1 WORKL,*REPPRD*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REPRDLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REPRDD,R2           R2=A(EXTRACT RECORD)                         
         USING RPRDREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REPRDLEN,REPRDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REPRDLEN(2),=AL2(REPRDDL)                                        
         MVC   REPRDTYP,REPPRDQ                                                 
         MVI   REPRDDX,MXTRTQ                                                   
         MVI   REPRDDX+1,MXTRTQ                                                 
         MVI   REPRDREP-1,MXTRTQ                                                
         MVI   REPRDADV-1,MXTRTQ                                                
         MVI   REPRDPRD-1,MXTRTQ                                                
         MVI   REPRDNAM-1,MXTRTQ                                                
         MVI   REPRDCAT-1,MXTRTQ                                                
         MVI   REPRDPTP-1,MXTRTQ                                                
         MVI   REPRDRTS-1,MXTRTQ                                                
         MVI   REPRDDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REPRDREP,RPRDKREP   REP COMPANY                                  
         TR    REPRDREP,MXTRT                                                   
         MVC   REPRDADV,RPRDKADV   ADVERTISER                                   
         TR    REPRDADV,MXTRT                                                   
         MVC   REPRDPRD,RPRDKPRD   PRODUCT CODE                                 
         TR    REPRDPRD,MXTRT                                                   
         MVC   REPRDNAM,RPRDNAME   PRODUCT NAME                                 
         TR    REPRDNAM,MXTRT                                                   
         MVC   REPRDCAT,RPRDCATG   PRODUCT CATEGORY CODE                        
         TR    REPRDCAT,MXTRT                                                   
*                                                                               
***      MVC   REPRDRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REPRDRTS(14),=C'19000101000000'                                  
         TR    REPRDRTS,MXTRT                                                   
*                                                                               
         MVI   REPRDDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REPRDDEL,MXTRT                                                   
*                                                                               
*                                                                               
         LA    R6,RPRDREC                                                       
         MVI   ELCODE,X'02'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RPRD0020                                                         
*                                                                               
         USING RPRDNELM,R6                                                      
*                                                                               
         MVC   REPRDPTP,RPRDNPNT   POINT PERSON CODE                            
         DROP  R6                                                               
RPRD0020 DS    0H                                                               
         TR    REPRDPTP,MXTRT                                                   
         J     EXIT                                                             
*                                                                               
REPRDLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPCLSC - EXTRACT CLASS                                                       
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPCLSC  NMOD1 WORKL,*REPCLS*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RECLSLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING RECLSD,R2           R2=A(EXTRACT RECORD)                         
         USING RCLSREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    RECLSLEN,RECLSLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RECLSLEN(2),=AL2(RECLSDL)                                        
         MVC   RECLSTYP,REPCLSQ                                                 
         MVI   RECLSDX,MXTRTQ                                                   
         MVI   RECLSDX+1,MXTRTQ                                                 
         MVI   RECLSREP-1,MXTRTQ                                                
         MVI   RECLSCOD-1,MXTRTQ                                                
         MVI   RECLSNAM-1,MXTRTQ                                                
         MVI   RECLSRTS-1,MXTRTQ                                                
         MVI   RECLSDEL-1,MXTRTQ                                                
*                                                                               
         MVC   RECLSREP,RCLSKREP   REP COMPANY                                  
         TR    RECLSREP,MXTRT                                                   
         MVC   RECLSCOD,RCLSKCLS   CLASS CODE                                   
         TR    RECLSCOD,MXTRT                                                   
         MVC   RECLSNAM,RCLSNAME   CLASS NAME                                   
         TR    RECLSNAM,MXTRT                                                   
*                                                                               
***      MVC   RECLSRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RECLSRTS(14),=C'19000101000000'                                  
         TR    RECLSRTS,MXTRT                                                   
*                                                                               
         MVI   RECLSDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RECLSDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
RECLSLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPCATC - EXTRACT CATEGORY CODE                                               
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPCATC  NMOD1 WORKL,*REPCAT*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RECATLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING RECATD,R2           R2=A(EXTRACT RECORD)                         
         USING RCTGREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    RECATLEN,RECATLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RECATLEN(2),=AL2(RECATDL)                                        
         MVC   RECATTYP,REPCATQ                                                 
         MVI   RECATDX,MXTRTQ                                                   
         MVI   RECATDX+1,MXTRTQ                                                 
         MVI   RECATREP-1,MXTRTQ                                                
         MVI   RECATCOD-1,MXTRTQ                                                
         MVI   RECATNAM-1,MXTRTQ                                                
         MVI   RECATCLS-1,MXTRTQ                                                
         MVI   RECATRTS-1,MXTRTQ                                                
         MVI   RECATDEL-1,MXTRTQ                                                
*                                                                               
         MVC   RECATREP,RCTGKREP   REP COMPANY                                  
         TR    RECATREP,MXTRT                                                   
         MVC   RECATCOD,RCTGKCTG   CODE                                         
         TR    RECATCOD,MXTRT                                                   
         MVC   RECATNAM,RCTGNAME   NAME                                         
         TR    RECATNAM,MXTRT                                                   
         MVC   RECATCLS,RCTGCLSS   CLASS CODE                                   
         TR    RECATCLS,MXTRT                                                   
*                                                                               
***      MVC   RECATRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RECATRTS(14),=C'19000101000000'                                  
         TR    RECATRTS,MXTRT                                                   
*                                                                               
         MVI   RECATDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    RECATDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
RECATLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPOFFC - EXTRACT OFFICE                                                      
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPOFFC  NMOD1 WORKL,*REPOFF*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REOFFLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         L     R4,16(R1)           A(OFF2 REC)                                  
         USING REOFFD,R2           R2=A(EXTRACT RECORD)                         
         USING ROFFREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REOFFLEN,REOFFLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REOFFLEN(2),=AL2(REOFFDL)                                        
         MVC   REOFFTYP,REPOFFQ                                                 
         MVI   REOFFDX,MXTRTQ                                                   
         MVI   REOFFDX+1,MXTRTQ                                                 
         MVI   REOFFREP-1,MXTRTQ                                                
         MVI   REOFFCOD-1,MXTRTQ                                                
         MVI   REOFFNAM-1,MXTRTQ                                                
         MVI   REOFFREG-1,MXTRTQ                                                
         MVI   REOFFAD1-1,MXTRTQ                                                
         MVI   REOFFAD2-1,MXTRTQ                                                
         MVI   REOFFSTT-1,MXTRTQ                                                
         MVI   REOFFZIP-1,MXTRTQ                                                
         MVI   REOFFFAX-1,MXTRTQ                                                
         MVI   REOFFNL-1,MXTRTQ                                                 
         MVI   REOFFRTS-1,MXTRTQ                                                
         MVI   REOFFDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REOFFREP,ROFFKREP   REP COMPANY                                  
         TR    REOFFREP,MXTRT                                                   
         MVC   REOFFCOD,ROFFKOFF   OFFICE CODE                                  
         TR    REOFFCOD,MXTRT                                                   
         MVC   REOFFNAM,ROFFNAME   OFFICE NAME                                  
         TR    REOFFNAM,MXTRT                                                   
         MVC   REOFFREG,ROFFREG    OFFICE REGION                                
         TR    REOFFREG,MXTRT                                                   
         MVC   REOFFREG,ROFFREG    OFFICE REGION                                
         TR    REOFFREG,MXTRT                                                   
         MVC   REOFFAD1,ROFFADD1   OFFICE ADDRESS LINE 1                        
         TR    REOFFAD1,MXTRT                                                   
         MVC   REOFFAD2,ROFFADD2   OFFICE ADDRESS LINE 2                        
         TR    REOFFAD2,MXTRT                                                   
         MVC   REOFFSTT,ROFFSTT    OFFICE STATE                                 
         TR    REOFFSTT,MXTRT                                                   
         MVC   REOFFZIP,ROFFZIP    OFFICE ZIPCODE                               
         TR    REOFFZIP,MXTRT                                                   
*                                                                               
***      MVC   REOFFRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REOFFRTS(14),=C'19000101000000'                                  
         TR    REOFFRTS,MXTRT                                                   
*                                                                               
         MVI   REOFFDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REOFFDEL,MXTRT                                                   
*                                                                               
         MVI   REOFFNL,C'N'        SET ALL OFFICES TO 'NATIONAL'                
*                                                                               
         CLI   0(R4),X'44'         OFF2 RECORD?                                 
         JNE   ROFF0080            NO                                           
         CLC   1(26,R4),1(R3)      SAME RECORD : AFTER REC TYPE                 
         JNE   ROFF0080            NO                                           
*                                                                               
         LR    R6,R4               SET A(OFF2 RECORD)                           
*                                                                               
         MVI   ELCODE,X'10'                                                     
         BRAS  RE,GETEL                                                         
         JNE   ROFF0080                                                         
*                                                                               
ROFF0060 DS    0H                                                               
         USING ROFF2FXE,R6                                                      
         MVC   REOFFFAX,ROFF2FAX                                                
         OC    REOFFFAX,SPACES                                                  
         TM    ROFF2PRF+1,X'80'    LOCAL SET?                                   
         BNO   ROFF0080            NO                                           
         MVI   REOFFNL,C'L'        SET TO 'LOCAL'                               
*                                                                               
ROFF0080 DS    0H                                                               
         TR    REOFFFAX,MXTRT                                                   
         TR    REOFFNL,MXTRT                                                    
*                                                                               
         J     EXIT                                                             
*                                                                               
REOFFLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPOWNC - EXTRACT OWNER                                                       
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPOWNC  NMOD1 WORKL,*REPOWN*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REOWNLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REOWND,R2           R2=A(EXTRACT RECORD)                         
         USING ROWNREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REOWNLEN,REOWNLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REOWNLEN(2),=AL2(REOWNDL)                                        
         MVC   REOWNTYP,REPOWNQ                                                 
         MVI   REOWNDX,MXTRTQ                                                   
         MVI   REOWNDX+1,MXTRTQ                                                 
         MVI   REOWNREP-1,MXTRTQ                                                
         MVI   REOWNCOD-1,MXTRTQ                                                
         MVI   REOWNNAM-1,MXTRTQ                                                
         MVI   REOWNRTS-1,MXTRTQ                                                
         MVI   REOWNDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REOWNREP,ROWNKREP   REP COMPANY                                  
         TR    REOWNREP,MXTRT                                                   
         MVC   REOWNCOD,ROWNKOWN   OWNER CODE                                   
         TR    REOWNCOD,MXTRT                                                   
         MVC   REOWNNAM,ROWNNAME   OWNER NAME                                   
         TR    REOWNNAM,MXTRT                                                   
*                                                                               
***      MVC   REOWNRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REOWNRTS(14),=C'19000101000000'                                  
         TR    REOWNRTS,MXTRT                                                   
*                                                                               
         MVI   REOWNDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REOWNDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
REOWNLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPMKTC - EXTRACT MARKET                                                      
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPMKTC  NMOD1 WORKL,*REPMKT*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REMKTLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REMKTD,R2           R2=A(EXTRACT RECORD)                         
         USING RMKTREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REMKTLEN,REMKTLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REMKTLEN(2),=AL2(REMKTDL)                                        
         MVC   REMKTTYP,REPMKTQ                                                 
         MVI   REMKTDX,MXTRTQ                                                   
         MVI   REMKTDX+1,MXTRTQ                                                 
         MVI   REMKTREP-1,MXTRTQ                                                
         MVI   REMKTCOD-1,MXTRTQ                                                
         MVI   REMKTNAM-1,MXTRTQ                                                
         MVI   REMKTRTS-1,MXTRTQ                                                
         MVI   REMKTDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REMKTREP,RMKTKREP   REP COMPANY                                  
         TR    REMKTREP,MXTRT                                                   
         MVC   REMKTCOD,RMKTKMKT   MARKET CODE                                  
         TR    REMKTCOD,MXTRT                                                   
         MVC   REMKTNAM,RMKTNAME   MARKET NAME                                  
         TR    REMKTNAM,MXTRT                                                   
*                                                                               
***      MVC   REMKTRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REMKTRTS(14),=C'19000101000000'                                  
         TR    REMKTRTS,MXTRT                                                   
*                                                                               
         MVI   REMKTDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REMKTDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
REMKTLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPMSTC - EXTRACT SEE-ME/READ-ME MASTER/SUB INFORMATION                       
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPMSTC  NMOD1 WORKL,*REPMST*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REMSTLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REMSTD,R2           R2=A(EXTRACT RECORD)                         
         USING RREPREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REMSTLEN,REMSTLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REMSTLEN(2),=AL2(REMSTDL)                                        
         MVC   REMSTTYP,REPMSTQ                                                 
         MVI   REMSTDX,MXTRTQ                                                   
         MVI   REMSTDX+1,MXTRTQ                                                 
         MVI   REMSTSUB-1,MXTRTQ                                                
         MVI   REMSTMST-1,MXTRTQ                                                
         MVI   REMSTRTS-1,MXTRTQ                                                
         MVI   REMSTDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REMSTSUB,RREPKREP   REP COMPANY                                  
         TR    REMSTSUB,MXTRT                                                   
*                                                                               
***      MVC   REMSTRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REMSTRTS(14),=C'19000101000000'                                  
         TR    REMSTRTS,MXTRT                                                   
*                                                                               
         MVI   REMSTDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REMSTDEL,MXTRT                                                   
*                                                                               
         MVC   REMSTMST,RREPKREP   REP COMPANY                                  
         CLC   RREPMAST,=C'  '      NO MASTER CONTROL                           
         JNH   RMST0010                                                         
         CLC   RREPMAST,=X'FFFF'    THIS IS THE MASTER                          
         JE    RMST0010                                                         
*                                                                               
         MVC   REMSTMST,RREPMAST   SET THE MASTER                               
*                                                                               
RMST0010 DS    0H                                                               
         TR    REMSTMST,MXTRT                                                   
         J     EXIT                                                             
*                                                                               
REMSTLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* REPREPC - EXTRACT REP COMPANY                                                 
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPREPC  NMOD1 WORKL,*REPREP*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REREPLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REREPD,R2           R2=A(EXTRACT RECORD)                         
         USING RREPREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REREPLEN,REREPLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REREPLEN(2),=AL2(REREPDL)                                        
         MVC   REREPTYP,REPREPQ                                                 
         MVI   REREPDX,MXTRTQ                                                   
         MVI   REREPDX+1,MXTRTQ                                                 
         MVI   REREPSUB-1,MXTRTQ                                                
         MVI   REREPMAS-1,MXTRTQ                                                
         MVI   REREPNAM-1,MXTRTQ                                                
         MVI   REREPRTS-1,MXTRTQ                                                
         MVI   REREPDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REREPSUB,RREPKREP   REP COMPANY                                  
         TR    REREPSUB,MXTRT                                                   
         MVC   REREPMAS,RREPKREP   REP COMPANY AS MASTER CODE                   
         TR    REREPMAS,MXTRT                                                   
         MVC   REREPNAM,RREPNAME                                                
         TR    REREPNAM,MXTRT                                                   
*                                                                               
***      MVC   REREPRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REREPRTS(14),=C'19000101000000'                                  
         TR    REREPRTS,MXTRT                                                   
*                                                                               
         MVI   REREPDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REREPDEL,MXTRT                                                   
*                                                                               
         CLC   RREPMAST,=C'  '     ANY MASTER?                                  
         JNH   EXIT                NO  - USE REP COMPANY AS MASTER              
         CLC   RREPMAST,=X'FFFF'   YES - IS THIS THE MASTER?                    
         JE    EXIT                YES                                          
         MVC   REREPMAS,RREPMAST   NO  - THIS IS THE MASTER                     
         TR    REREPMAS,MXTRT                                                   
         J     EXIT                                                             
*                                                                               
REREPLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***>>>                                                                          
**BD1**>>>>                                                                     
***********************************************************************         
* REPBD1C - EXTRACT STATION/OFFICE BUDGET DOLLARS                               
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL1 REP PROFILE FLAGS, SEE REPPFLGS IN RXTRACT                      *         
* AL3 A(REPFILE RECORD)                                               *         
* AL1 0=BUILD 'K' RECORD, 1=BUILD ALL RECORDS, 2=PASS BACK NEXT       *         
*     X'FF' RETURNED IF NO MORE RECORDS TO PROCESS                    *         
* AL3 0                                                               *         
* AL4 A(SXDTABD)                                                      *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
REPBD1C  NMOD1 WORKL,*REPBD1*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RXBD1LIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REBD1D,R2           R2=A(EXTRACT RECORD)                         
         USING RBUDREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
***>>>   BRAS  RE,LOADER           WHAT IS LOADER DOING HERE?                   
*                                                                               
         CLI   8(R1),1                                                          
         JL    RXBD1KIL            KILL                                         
         JE    RXBD1SER            BUILD SERIES OF RECORDS                      
         J     RXBD1NXT            OUTPUT NEXT RECORD                           
*                                                                               
RXBD1LIT DC    A(LITERAL)                                                       
         EJECT                                                                  
*---------------------------------------------------------------------*         
* GET NEXT BUDGET AMOUNT RECORD IN SERIES AND RETURN IT                         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXBD1NXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK?                         
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         LA    R0,REBD1D           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1               LENGTH OF NEXT RECORD                        
         ICM   R1,3,REBD1LEN-REBD1D(RE)                                         
         LA    RF,0(R1,RE)         SAVE NEXT ADDRESS                            
         ST    RF,ANEXT                                                         
         LR    RF,R1               SET LENGTH                                   
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD 'K' RECORD FOR STATION/OFFICE BUDGET RECORD AND EXIT                    
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXBD1KIL DS    0H                                                               
         MVI   KILLMODE,C'Y'                                                    
*                                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXBD1CC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
*   THERE IS NO BUDGET HEADER, SO THE 'KILL HEADER CODE ISN'T NEEDED.           
*                                                                               
**:>>>>  BRAS  RE,RXBD1BUD         FIRST KILL HEADER                            
*                                                                               
**:>>>>  SR    RE,RE               CLEAR THE LAST RECORD                        
**:>>>>  ICM   RE,3,REBD1LEN                                                    
**:>>>>  AR    R2,RE                                                            
**:>>>>  XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXBD1BD$                                                      
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBD1LEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     EXIT                                                             
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXBD1SER DS    0H                                                               
         MVI   KILLMODE,C'N'       TURN OFF 'KILLMODE'                          
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXBD1CC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         LA    R8,RBUDSTA          SET A(1ST MONTH OF BUDGET)                   
*                                                                               
*   TEST                                                                        
****     DC    H'0'                                                             
*   TEST END                                                                    
*                                                                               
         XC    MONCTR,MONCTR       CLEAR COUNTER                                
         XC    BUDYEAR,BUDYEAR                                                  
*                                                                               
*   THERE ARE NO USERS THAT SET THE FISCAL START MONTH TO OTHER THAN            
*        JANUARY.  AS SUCH, ALL BUDGETS REPRESENT A CALENDAR 12 MONTH           
*        PERIOD.  BUDGETS WILL BE TREATED AS SUCH, RATHER THAN                  
*        CODING FOR A FLEXIBLE START MONTH.  THE FIRST 12 MONTHS WILL           
*        BE USED TO GENERATE THE BUDGET RECORDS.  BILL UHR. 3/19/03             
*                                                                               
         LA    R0,12               SET LOOP TO 12 BUCKETS                       
*                                                                               
PXST0030 EQU   *                                                                
         L     RF,MONCTR           BUMP UP MONTH COUNTER                        
         LA    RF,1(RF)                                                         
         ST    RF,MONCTR                                                        
*                                                                               
         OC    0(4,R8),0(R8)       ANY BUDGET AMOUNT?                           
         JZ    PXST0032            NO  - CHECK NEXT BUCKET                      
*                                                                               
         BRAS  RE,RXBD1BD$         BUILD RECORD                                 
*                                                                               
         SR    RE,RE               BUMP TO AND CLEAR NEXT RECORD                
         ICM   RE,3,REBD1LEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
PXST0032 EQU   *                                                                
         LA    R8,4(R8)            BUMP TO NEXT BUCKET                          
         BCT   R0,PXST0030         GO BACK FOR NEXT                             
PXST0100 EQU   *                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBD1LEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
*   TEST                                                                        
*        L     R2,RXBD1CC          WHERE RECORDS TO BE BUILT                    
*        DC    H'0'                                                             
*   TEST END                                                                    
*                                                                               
*                                                                               
         J     EXIT                                                             
MONCTR   DS    F                                                                
BUDYEAR  DS    F                                                                
         EJECT                                                                  
*---------------------------------------------------------------------*         
* BUILD BUDGET DOLLAR BUCKET RECORD                                             
*        ??    ->  BUDGET MONTH DATA                                            
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXBD1BD$ NTR1                                                                   
*                                                                               
         LA    R0,REBD1D           CLEAR THE RECORD                             
         LA    R1,REBD1DL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBD1LEN,REBD1LEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBD1LEN(2),=AL2(REBD1DL)                                        
         MVC   REBD1TYP,REPBD1Q                                                 
         MVI   REBD1ACT-1,MXTRTQ                                                
         MVI   REBD1DAT-1,MXTRTQ                                                
         MVI   REBD1TME-1,MXTRTQ                                                
         MVI   REBD1DX,MXTRTQ                                                   
         MVI   REBD1DX+1,MXTRTQ                                                 
         MVI   REBD1RTP-1,MXTRTQ                                                
         MVI   REBD1REP-1,MXTRTQ                                                
         MVI   REBD1STA-1,MXTRTQ                                                
         MVI   REBD1OFF-1,MXTRTQ                                                
         MVI   REBD1BYR-1,MXTRTQ                                                
         MVI   REBD1MOS-1,MXTRTQ                                                
         MVI   REBD1BUD-1,MXTRTQ                                                
         MVI   REBD1RTS-1,MXTRTQ                                                
         MVI   REBD1DEL-1,MXTRTQ                                                
*                                                                               
B        USING REBD1D,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBD1ACT,B.REBD1ACT                                              
         MVC   REBD1DAT,B.REBD1DAT                                              
         MVC   REBD1TME,B.REBD1TME                                              
         DROP  B                                                                
*                                                                               
         MVC   REBD1REP,RBUDKREP   REPCODE                                      
         TR    REBD1REP,MXTRT                                                   
         MVC   REBD1STA,RBUDKSTA   STATION                                      
         TR    REBD1STA,MXTRT                                                   
         MVC   REBD1OFF,RBUDKTEM   OFFICE (OPTIONAL)                            
         OC    REBD1OFF,SPACES     SET FIELD TO SPACES IF NULL                  
         TR    REBD1OFF,MXTRT                                                   
*                                                                               
***      MVC   REBD1RTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REBD1RTS(14),=C'19000101000000'                                  
         TR    REBD1RTS,MXTRT                                                   
*                                                                               
         MVI   REBD1DEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REBD1DEL,MXTRT                                                   
*                                                                               
         CLC   =C'C*MP',RBUDKSTA   COMPANY BUDGET?                              
         BNE   RXBD1004            NO                                           
         MVI   REBD1RTP,C'C'       YES - SET TYPE TO COMPANY                    
         CLC   RBUDKTEM,SPACES     OFFICE IN KEY?                               
         BNH   RXBD1010            NO                                           
         MVI   REBD1RTP,C'D'       YES - SET TYPE TO COMPANY/OFFICE             
         B     RXBD1010                                                         
RXBD1004 EQU   *                                                                
         MVI   REBD1RTP,C'S'       SET TYPE TO STATION                          
         CLC   RBUDKTEM,SPACES     OFFICE IN KEY?                               
         BNH   RXBD1010            NO                                           
         MVI   REBD1RTP,C'0'       YES - SET TYPE TO COMPANY/OFFICE             
RXBD1010 EQU   *                                                                
         TR    REBD1RTP,MXTRT                                                   
         MVC   REBD1BYR+2(2),RBUDKYR                                            
*                                  LOAD YEAR                                    
         CLI   RBUDKYR,X'F9'       SPECIAL DECADE YEAR VALUE?                   
         BNH   RXBD1012            NO                                           
         ZIC   RF,RBUDKYR          YES - SET TO PROPER DECADE                   
         SH    RF,=H'10'           MAKE DECADE BYTE ZERO RELATIVE               
         STC   RF,REBD1BYR+2       INSERT MODIFIED DECADE BYTE                  
RXBD1012 EQU   *                                                                
         MVC   REBD1BYR(2),=C'20'  INSERT 21ST CENTURY                          
         CLC   REBD1BYR+2(2),=C'50' SPLIT THE CENTURY                           
         BL    RXBD1014            LOW = 21ST CENTURY                           
         MVC   REBD1BYR(2),=C'19'  HIGH = INSERT 20TH CENTURY                   
RXBD1014 EQU   *                                                                
         TR    REBD1BYR,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXBD1140            YES - NO MORE DATA IN RECORD                 
*                                                                               
         MVC   REBD1MOS(4),REBD1BYR                                             
*                                  INSERT YEAR INTO MONTH OF SERVICE            
         L     R5,MONCTR                                                        
         CLC   MONCTR,=F'12'       MONTH COUNT AFTER DECEMBER?                  
         BNH   RXBD1020            NO  - LEAVE AS IS                            
*                                                                               
*   THIS IS REALLY DEAD CODE.  THE LOOP IS CODED FROM JAN THRU                  
*        DECEMBER:  1 THRU 12.  ADDITIONALLY, THE BUDYEAR IS                    
*        WRONG.  THE BUDGET YEAR OF 2003 ACTUALLY WOULD BEGIN IN                
*        2002, IF A FISCAL MONTH OTHER THAN JANUARY WERE SELECTED.              
*        SO BUDYEAR WOULD HAVE TO START A FROM 2002, THEN BE IN-                
*        CREMENTED TO 2003.                                                     
*                                                                               
         SH    R5,=H'12'           YES - ADJUST MONTH                           
         OC    BUDYEAR,BUDYEAR     YEAR ALREADY INCREMENTED?                    
         BNZ   RXBD1018            YES                                          
         PACK  DUB(8),REBD1MOS(4)  PACK DATE                                    
         CVB   RF,DUB              CONVERT DATE TO BINARY                       
         LA    RF,1(RF)            INCREMENT YEAR BY 1                          
         ST    RF,BUDYEAR          SAVE CONVERTED DATE                          
RXBD1018 EQU   *                                                                
         EDIT  BUDYEAR,(4,REBD1MOS)                                             
*                                  RESET DATE INTO RECORD                       
RXBD1020 EQU   *                                                                
         EDIT  (R5),(2,REBD1MOS+4),FILL=0     EDIT MONTH INTO DATA              
         MVC   REBD1MOS+6(2),=C'01'                                             
*                                  SET DAY TO 01                                
         MVC   WORK(L'REBD1MOS),REBD1MOS                                        
         GOTO1 DATCON,PLIST,(9,WORK),(10,REBD1MOS)                              
*                                                                               
         TR    REBD1MOS,MXTRT                                                   
         MVC   BUDDOLS,0(R8)       UNLOAD BUDGET AMOUNT                         
         EDIT  BUDDOLS,(12,REBD1BUD),FILL=0                                     
*                                  INSERT BUDGET AMOUNT                         
         TR    REBD1BUD,MXTRT                                                   
RXBD1140 DS    0H                                                               
         J     EXITR2                                                           
BUDDOLS  DS    F                                                                
         DROP  R2                                                               
*                                                                               
*---------------------------------------------------------------------*         
* BUILD BUDGET SKELETON RECORD                                        *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
*&&DO                                                                           
RXBD1BUD NTR1  BASE=*,LABEL=*                                                   
         USING REBD1D,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,REBD1D           CLEAR THE RECORD                             
         LA    R1,REBD1DL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBD1LEN,REBD1LEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBD1LEN(2),=AL2(REBD1DL)                                        
         MVC   REBD1TYP,REPBD1Q                                                 
         MVI   REBD1DX,MXTRTQ                                                   
         MVI   REBD1DX+1,MXTRTQ                                                 
         MVI   REBD1RTP-1,MXTRTQ                                                
         MVI   REBD1REP-1,MXTRTQ                                                
         MVI   REBD1STA-1,MXTRTQ                                                
         MVI   REBD1OFF-1,MXTRTQ                                                
         MVI   REBD1MOS-1,MXTRTQ                                                
         MVI   REBD1BYR-1,MXTRTQ                                                
         MVI   REBD1BUD-1,MXTRTQ                                                
*                                                                               
B        USING REBD1D,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBD1ACT,B.REBD1ACT                                              
         MVC   REBD1DAT,B.REBD1DAT                                              
         MVC   REBD1TME,B.REBD1TME                                              
         DROP  B                                                                
*                                                                               
         MVC   REBD1REP,RBUDKREP   REPCODE                                      
         TR    REBD1REP,MXTRT                                                   
         MVC   REBD1STA,RBUDKSTA   STATION                                      
         TR    REBD1STA,MXTRT                                                   
         MVC   REBD1OFF,RBUDKTEM   OFFICE (OPTIONAL)                            
         OC    REBD10FF,SPACES     SET FIELD TO SPACES IF NULL                  
         TR    REBD1OFF,MXTRT                                                   
*                                                                               
***      MVC   REBD1RTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REBD1RTS(14),=C'19000101000000'                                  
         TR    REBD1RTS,MXTRT                                                   
*                                                                               
         MVI   REBD1DEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REBD1DEL,MXTRT                                                   
*                                                                               
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*&&                                                                             
*                                                                               
RXBD1CC  DC    A(BUFFER1)          ADJUSTED RATE RECORD SAVE AREA               
         LTORG                                                                  
****      ROP  R2                                                               
*                                                                               
         EJECT                                                                  
***>>>                                                                          
*+++++>>>>>                                                                     
**BD2**>>>>                                                                     
***********************************************************************         
* REPBD2C - EXTRACT OFFICE BUDGET DOLLARS                             *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL1 REP PROFILE FLAGS, SEE REPPFLGS IN RXTRACT                      *         
* AL3 A(REPFILE RECORD)                                               *         
* AL1 0=BUILD 'K' RECORD, 1=BUILD ALL RECORDS, 2=PASS BACK NEXT       *         
*     X'FF' RETURNED IF NO MORE RECORDS TO PROCESS                    *         
* AL3 0                                                               *         
* AL4 A(SXDTABD)                                                      *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
REPBD2C  NMOD1 WORKL,*REPBD2*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RXBD2LIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REBD2D,R2           R2=A(EXTRACT RECORD)                         
         USING ROBDREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
***>>>   BRAS  RE,LOADER           WHAT IS LOADER DOING HERE?                   
*                                                                               
         CLI   8(R1),1                                                          
         JL    RXBD2KIL            KILL                                         
         JE    RXBD2SER            BUILD SERIES OF RECORDS                      
         J     RXBD2NXT            OUTPUT NEXT RECORD                           
*                                                                               
RXBD2LIT DC    A(LITERAL)                                                       
         EJECT                                                                  
*---------------------------------------------------------------------*         
* GET NEXT BUDGET AMOUNT RECORD IN SERIES AND RETURN IT                         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXBD2NXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK?                         
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         LA    R0,REBD2D           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1               LENGTH OF NEXT RECORD                        
         ICM   R1,3,REBD2LEN-REBD2D(RE)                                         
         LA    RF,0(R1,RE)         SAVE NEXT ADDRESS                            
         ST    RF,ANEXT                                                         
         LR    RF,R1               SET LENGTH                                   
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD 'K' RECORD FOR OFFICE BUDGET RECORD AND EXIT                            
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXBD2KIL DS    0H                                                               
         MVI   KILLMODE,C'Y'                                                    
*                                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXBD2CC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
*   THERE IS NO BUDGET HEADER, SO THE 'KILL HEADER CODE ISN'T NEEDED.           
*                                                                               
**:>>>>  BRAS  RE,RXBD2BUD         FIRST KILL HEADER                            
*                                                                               
**:>>>>  SR    RE,RE               CLEAR THE LAST RECORD                        
**:>>>>  ICM   RE,3,REBD2LEN                                                    
**:>>>>  AR    R2,RE                                                            
**:>>>>  XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXBD2BD$                                                      
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBD2LEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     EXIT                                                             
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXBD2SER DS    0H                                                               
         MVI   KILLMODE,C'N'       TURN OFF 'KILLMODE'                          
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXBD2CC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         LA    R8,ROBDSTA          SET A(1ST MONTH OF BUDGET)                   
*                                                                               
*   TEST                                                                        
****     DC    H'0'                                                             
*   TEST END                                                                    
*                                                                               
         XC    MONCTR2,MONCTR2     CLEAR COUNTER                                
         XC    BUDYEAR2,BUDYEAR2                                                
*                                                                               
*   THERE ARE NO USERS THAT SET THE FISCAL START MONTH TO OTHER THAN            
*        JANUARY.  AS SUCH, ALL BUDGETS REPRESENT A CALENDAR 12 MONTH           
*        PERIOD.  BUDGETS WILL BE TREATED AS SUCH, RATHER THAN                  
*        CODING FOR A FLEXIBLE START MONTH.  THE FIRST 12 MONTHS WILL           
*        BE USED TO GENERATE THE BUDGET RECORDS.  BILL UHR. 3/19/03             
*                                                                               
         LA    R0,12               SET LOOP TO 12 BUCKETS                       
*                                                                               
PSTR0030 EQU   *                                                                
         L     RF,MONCTR2          BUMP UP MONTH COUNTER                        
         LA    RF,1(RF)                                                         
         ST    RF,MONCTR2                                                       
*                                                                               
         OC    0(4,R8),0(R8)       ANY BUDGET AMOUNT?                           
         JZ    PSTR0032            NO  - CHECK NEXT BUCKET                      
*                                                                               
         BRAS  RE,RXBD2BD$         BUILD RECORD                                 
*                                                                               
         SR    RE,RE               BUMP TO AND CLEAR NEXT RECORD                
         ICM   RE,3,REBD2LEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
PSTR0032 EQU   *                                                                
         LA    R8,4(R8)            BUMP TO NEXT BUCKET                          
         BCT   R0,PSTR0030         GO BACK FOR NEXT                             
PSTR0100 EQU   *                                                                
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REBD2LEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
*   TEST                                                                        
*        L     R2,RXBD2CC          WHERE RECORDS TO BE BUILT                    
*        DC    H'0'                                                             
*   TEST END                                                                    
*                                                                               
*                                                                               
         J     EXIT                                                             
MONCTR2  DS    F                                                                
BUDYEAR2 DS    F                                                                
         EJECT                                                                  
*---------------------------------------------------------------------*         
* BUILD BUDGET DOLLAR BUCKET RECORD                                             
*        ??    ->  BUDGET MONTH DATA                                            
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXBD2BD$ NTR1                                                                   
*                                                                               
         LA    R0,REBD2D           CLEAR THE RECORD                             
         LA    R1,REBD2DL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBD2LEN,REBD2LEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBD2LEN(2),=AL2(REBD2DL)                                        
         MVC   REBD2TYP,REPBD2Q                                                 
         MVI   REBD2ACT-1,MXTRTQ                                                
         MVI   REBD2DAT-1,MXTRTQ                                                
         MVI   REBD2TME-1,MXTRTQ                                                
         MVI   REBD2DX,MXTRTQ                                                   
         MVI   REBD2DX+1,MXTRTQ                                                 
         MVI   REBD2REP-1,MXTRTQ                                                
         MVI   REBD2OFF-1,MXTRTQ                                                
         MVI   REBD2TEM-1,MXTRTQ                                                
         MVI   REBD2GSG-1,MXTRTQ                                                
         MVI   REBD2BYR-1,MXTRTQ                                                
         MVI   REBD2MOS-1,MXTRTQ                                                
         MVI   REBD2BUD-1,MXTRTQ                                                
         MVI   REBD2RTS-1,MXTRTQ                                                
         MVI   REBD2DEL-1,MXTRTQ                                                
*                                                                               
B        USING REBD2D,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBD2ACT,B.REBD2ACT                                              
         MVC   REBD2DAT,B.REBD2DAT                                              
         MVC   REBD2TME,B.REBD2TME                                              
         DROP  B                                                                
*                                                                               
         MVC   REBD2REP,ROBDKREP   REPCODE                                      
         TR    REBD2REP,MXTRT                                                   
         MVC   REBD2OFF,ROBDKOFF   OFFICE (OPTIONAL)                            
         OC    REBD2OFF,SPACES     SET FIELD TO SPACES IF NULL                  
         TR    REBD2OFF,MXTRT                                                   
         MVC   REBD2TEM,ROBDKTM    TEAM   (OPTIONAL)                            
         OC    REBD2TEM,SPACES     SET FIELD TO SPACES IF NULL                  
         TR    REBD2TEM,MXTRT                                                   
         MVC   REBD2GSG,ROBDKSUB   G/SGRP (OPTIONAL)                            
         OC    REBD2GSG,SPACES     SET FIELD TO SPACES IF NULL                  
         TR    REBD2GSG,MXTRT                                                   
*                                                                               
***      MVC   REBD2RTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REBD2RTS(14),=C'19000101000000'                                  
         TR    REBD2RTS,MXTRT                                                   
*                                                                               
         MVI   REBD2DEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REBD2DEL,MXTRT                                                   
*                                                                               
         MVC   REBD2BYR+2(2),ROBDKYR                                            
*                                  LOAD YEAR                                    
         CLI   ROBDKYR,X'F9'       SPECIAL DECADE YEAR VALUE?                   
         BNH   RXBD2012            NO                                           
         ZIC   RF,ROBDKYR          YES - SET TO PROPER DECADE                   
         SH    RF,=H'10'           MAKE DECADE BYTE ZERO RELATIVE               
         STC   RF,REBD2BYR+2       INSERT MODIFIED DECADE BYTE                  
RXBD2012 EQU   *                                                                
         MVC   REBD2BYR(2),=C'20'  INSERT 21ST CENTURY                          
         CLC   REBD2BYR+2(2),=C'50' SPLIT THE CENTURY                           
         BL    RXBD2014            LOW = 21ST CENTURY                           
         MVC   REBD2BYR(2),=C'19'  HIGH = INSERT 20TH CENTURY                   
RXBD2014 EQU   *                                                                
         TR    REBD2BYR,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXBD2140            YES - NO MORE DATA IN RECORD                 
*                                                                               
         MVC   REBD2MOS(4),REBD2BYR                                             
*                                  INSERT YEAR INTO MONTH OF SERVICE            
         L     R5,MONCTR2                                                       
         CLC   MONCTR2,=F'12'      MONTH COUNT AFTER DECEMBER?                  
         BNH   RXBD2020            NO  - LEAVE AS IS                            
*                                                                               
*   THIS IS REALLY DEAD CODE.  THE LOOP IS CODED FROM JAN THRU                  
*        DECEMBER:  1 THRU 12.  ADDITIONALLY, THE BUDYEAR2 IS                   
*        WRONG.  THE BUDGET YEAR OF 2003 ACTUALLY WOULD BEGIN IN                
*        2002, IF A FISCAL MONTH OTHER THAN JANUARY WERE SELECTED.              
*        SO BUDYEAR2 WOULD HAVE TO START A FROM 2002, THEN BE IN-               
*        CREMENTED TO 2003.                                                     
*                                                                               
         SH    R5,=H'12'           YES - ADJUST MONTH                           
         OC    BUDYEAR2,BUDYEAR2   YEAR ALREADY INCREMENTED?                    
         BNZ   RXBD2018            YES                                          
         PACK  DUB(8),REBD2MOS(4)  PACK DATE                                    
         CVB   RF,DUB              CONVERT DATE TO BINARY                       
         LA    RF,1(RF)            INCREMENT YEAR BY 1                          
         ST    RF,BUDYEAR2         SAVE CONVERTED DATE                          
RXBD2018 EQU   *                                                                
         EDIT  BUDYEAR2,(4,REBD2MOS)                                            
*                                  RESET DATE INTO RECORD                       
RXBD2020 EQU   *                                                                
         EDIT  (R5),(2,REBD2MOS+4),FILL=0     EDIT MONTH INTO DATA              
         MVC   REBD2MOS+6(2),=C'01'                                             
*                                  SET DAY TO 01                                
         MVC   WORK(L'REBD2MOS),REBD2MOS                                        
         GOTO1 DATCON,PLIST,(9,WORK),(10,REBD2MOS)                              
*                                                                               
         TR    REBD2MOS,MXTRT                                                   
         MVC   BUDDOLS2,0(R8)      UNLOAD BUDGET AMOUNT                         
         EDIT  BUDDOLS2,(12,REBD2BUD),FILL=0                                    
*                                  INSERT BUDGET AMOUNT                         
         TR    REBD2BUD,MXTRT                                                   
RXBD2140 DS    0H                                                               
         J     EXITR2                                                           
BUDDOLS2 DS    F                                                                
         DROP  R2                                                               
*                                                                               
*---------------------------------------------------------------------*         
* BUILD BUDGET SKELETON RECORD                                        *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
*&&DO                                                                           
RXBD2BUD NTR1  BASE=*,LABEL=*                                                   
         USING REBD2D,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,REBD2D           CLEAR THE RECORD                             
         LA    R1,REBD2DL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REBD2LEN,REBD2LEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBD2LEN(2),=AL2(REBD2DL)                                        
         MVC   REBD2TYP,REPBD2Q                                                 
         MVI   REBD2DX,MXTRTQ                                                   
         MVI   REBD2DX+1,MXTRTQ                                                 
         MVI   REBD2REP-1,MXTRTQ                                                
         MVI   REBD2OFF-1,MXTRTQ                                                
         MVI   REBD2TEM-1,MXTRTQ                                                
         MVI   REBD2GSG-1,MXTRTQ                                                
         MVI   REBD2MOS-1,MXTRTQ                                                
         MVI   REBD2BYR-1,MXTRTQ                                                
         MVI   REBD2BUD-1,MXTRTQ                                                
*                                                                               
B        USING REBD2D,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REBD2ACT,B.REBD2ACT                                              
         MVC   REBD2DAT,B.REBD2DAT                                              
         MVC   REBD2TME,B.REBD2TME                                              
         DROP  B                                                                
*                                                                               
         MVC   REBD2REP,ROBDKREP   REPCODE                                      
         TR    REBD2REP,MXTRT                                                   
         MVC   REBD2OFF,ROBDKOFF   OFFICE (OPTIONAL)                            
         OC    REBD2OFF,SPACES     SET FIELD TO SPACES IF NULL                  
         TR    REBD2OFF,MXTRT                                                   
         MVC   REBD2TEM,ROBDKTM    TEAM   (OPTIONAL)                            
         OC    REBD2TEM,SPACES     SET FIELD TO SPACES IF NULL                  
         TR    REBD2TEM,MXTRT                                                   
         MVC   REBD2GSG,ROBDKSUB   G/SGRP (OPTIONAL)                            
         OC    REBD2GSG,SPACES     SET FIELD TO SPACES IF NULL                  
         TR    REBD2GSG,MXTRT                                                   
*                                                                               
***      MVC   REBD2RTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REBD2RTS(14),=C'19000101000000'                                  
         TR    REBD2RTS,MXTRT                                                   
*                                                                               
         MVI   REBD2DEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REBD2DEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*&&                                                                             
*                                                                               
RXBD2CC  DC    A(BUFFER1)          ADJUSTED RATE RECORD SAVE AREA               
         LTORG                                                                  
****      ROP  R2                                                               
*                                                                               
         EJECT                                                                  
**BD2**>>>>                                                                     
***PTP***>>>                                                                    
***********************************************************************         
* REPPTPC - EXTRACT POINTPERSON RECORD                                          
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(2ND RECORD)                                                   *         
***********************************************************************         
         SPACE 1                                                                
REPPTPC  NMOD1 WORKL,*REPPTPC*,CLEAR=Y                                          
         USING WORKD,RC                                                         
         L     RA,REPTPLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REPTPD,R2           R2=A(EXTRACT RECORD)                         
         USING RPTPREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REPTPLEN,REPTPLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REPTPLEN(2),=AL2(REPTPDL)                                        
         MVC   REPTPTYP,REPPTPQ                                                 
         MVI   REPTPDX,MXTRTQ                                                   
         MVI   REPTPDX+1,MXTRTQ                                                 
         MVI   REPTPREP-1,MXTRTQ                                                
         MVI   REPTPPTP-1,MXTRTQ                                                
         MVI   REPTPNAM-1,MXTRTQ                                                
         MVI   REPTPOFF-1,MXTRTQ                                                
         MVI   REPTPTEL-1,MXTRTQ                                                
         MVI   REPTPFAX-1,MXTRTQ                                                
***      MVI   REPTPSRP-1,MXTRTQ                                                
         MVI   REPTPSPR-1,MXTRTQ                                                
***      MVI   REPTPPRF-1,MXTRTQ                                                
         MVI   REPTPEML-1,MXTRTQ                                                
         MVI   REPTPLDT-1,MXTRTQ                                                
         MVI   REPTPRTS-1,MXTRTQ                                                
         MVI   REPTPDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REPTPREP,RPTPKREP   REP COMPANY                                  
         TR    REPTPREP,MXTRT                                                   
         MVC   REPTPPTP,RPTPKREC   POINTPERSON CODE                             
         TR    REPTPPTP,MXTRT                                                   
         MVC   REPTPNAM,RPTPNAME   POINTPERSON NAME                             
         TR    REPTPNAM,MXTRT                                                   
         MVC   REPTPOFF,RPTPOFF    POINTPERSON OFFICE                           
         TR    REPTPOFF,MXTRT                                                   
         MVC   REPTPTEL,RPTPFONE   POINTPERSON TELEPHONE #                      
         TR    REPTPTEL,MXTRT                                                   
***      MVC   REPTPSRP,RPTPREP    SUBSIDIARY REP                               
***      TR    REPTPSRP,MXTRT                                                   
         MVC   REPTPSPR,RPTPSPER   SALESPERSON                                  
         TR    REPTPSPR,MXTRT                                                   
         OC    RPTPLDAT,RPTPLDAT   ANY LEAVE DATE?                              
         BZ    RPTP0010            NO                                           
         GOTO1 DATCON,PLIST,(2,RPTPLDAT),(10,REPTPLDT)                          
RPTP0010 EQU   *                                                                
         TR    REPTPLDT,MXTRT                                                   
*                                                                               
***      MVC   REPTPRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REPTPRTS(14),=C'19000101000000'                                  
         TR    REPTPRTS,MXTRT                                                   
*                                                                               
         MVI   REPTPDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REPTPDEL,MXTRT                                                   
*                                                                               
*                                                                               
         LA    R8,REPTPEML         INITIAL EMAIL ADDRESS                        
*                                                                               
         LA    R6,RPTPREC                                                       
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RPTP0020                                                         
*                                                                               
RPTP0018 DS    0H                                                               
         USING RPTPEMEM,R6                                                      
*                                                                               
         LA    RE,REPTPEML         CHECK FOR IF COMMA NEEDED                    
         CR    RE,R8                                                            
         JE    *+12                NO                                           
         MVI   0(R8),C','                                                       
         AHI   R8,1                                                             
*                                                                               
         ZIC   RE,1(R6)                                                         
         AHI   RE,-1                                                            
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   0(0,R8),RPTPEMAL    EMAIL                                        
         LA    R8,1(RE,R8)                                                      
         DROP  R6                                                               
*                                                                               
         BRAS  RE,NEXTEL                                                        
         JE    RPTP0018                                                         
*                                                                               
RPTP0020 DS    0H                                                               
*                                                                               
         TR    REPTPEML,MXTRT                                                   
*                                                                               
         LA    R6,RPTPREC                                                       
         MVI   ELCODE,X'21'                                                     
         BRAS  RE,GETEL                                                         
         JNE   RPTP0032                                                         
*                                                                               
         USING RPTPFXEM,R6                                                      
*                                                                               
         MVC   REPTPFAX,RPTPFXFX   POINTPERSON FAX #                            
         TR    REPTPFAX,MXTRT                                                   
*                                                                               
*&&DO                                                                           
         TM    RPTPFXFG,X'40'      EMAIL PREFERENCE SET?                        
         BNO   RPTP0024            NO                                           
         MVI   REPTPPRF,C'E'       SET E-MAIL PREFERENCE                        
         B     RPTP0032                                                         
RPTP0024 DS    0H                                                               
         TM    RPTPFXFG,X'20'      FAX   PREFERENCE SET?                        
         BNO   RPTP0032            NO                                           
         MVI   REPTPPRF,C'F'       SET FAX PREFERENCE                           
*&&                                                                             
RPTP0032 DS    0H                                                               
         DROP  R6                                                               
***      TR    REPTPPRF,MXTRT                                                   
         J     EXIT                                                             
*                                                                               
REPTPLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***PTP***>>>                                                                    
***SET**????                                                                    
***********************************************************************         
* REPSETC - EXTRACT SET HEADER AND DETAIL RECORDS                     *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL1 REP PROFILE FLAGS, SEE REPPFLGS IN RXTRACT                      *         
* AL3 A(REPFILE RECORD)                                               *         
* AL1 0=BUILD 'SET' RECORD, 1=BUILD ALL RECORDS, 2=PASS BACK NEXT     *         
*     X'FF' RETURNED IF NO MORE RECORDS TO PROCESS                    *         
* AL3 A(STATION RECORD)                                               *         
* AL1 0=SETFLAG VALUE:  N = NOT SET OF SETS  H = HEADER  D = DETAIL   *         
* AL4 A(SETCTR) - COUNTER TO DIFFERENTIATE DUPLICATE SET MEMBERS.     *         
*     FOUR BYTES FURTHER ON AT THIS ADDRESS IS REPALPHA FOR RUN.      *         
*                                                                     *         
*                                                                     *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
REPSETC  NMOD1 WORKL,*REPSET*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RXSETLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING RESTND,R2           R2=A(EXTRACT RECORD)                         
         USING RSETREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,7,9(R1)                                                       
         ST    RE,ASTAREC                                                       
*                                                                               
         CLI   8(R1),1                                                          
         JL    RXSETKIL            BUILD KILL RECORD                            
         JE    RXSETSER            BUILD SERIES OF RECORDS                      
         J     RXSETNXT            OUTPUT NEXT RECORD                           
*                                                                               
RXSETLIT DC    A(LITERAL)                                                       
         EJECT                                                                  
*---------------------------------------------------------------------*         
* GET NEXT SET RECORD IN SERIES AND RETURN IT                                   
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSETNXT L     RE,ANEXT                                                         
         LTR   RE,RE                                                            
         BZ    RXSETN10                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK?                         
         JNZ   *+12                                                             
RXSETN10 MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         LA    R0,RESTND           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1               LENGTH OF NEXT RECORD                        
         ICM   R1,3,RESTNLEN-RESTND(RE)                                         
         LA    RF,0(R1,RE)         SAVE NEXT ADDRESS                            
         ST    RF,ANEXT                                                         
         LR    RF,R1               SET LENGTH                                   
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD 'K' RECORD FOR CONTRACT RECORD AND EXIT                                 
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSETKIL DS    0H                                                               
         MVI   KILLMODE,C'Y'                                                    
*                                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXSETCC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXSETHDR         FIRST KILL SET HEADER                        
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESTNLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         DROP  R2                                                               
*                                                                               
         USING RESTCD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         BRAS  RE,RXSETDET                                                      
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESTCLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     EXIT                                                             
         DROP  R2                                                               
*                                                                               
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSETSER DS    0H                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXSETCC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         CLI   PARM+12,C'N'        SETFLAG = NOT SET OF SETS?                   
         BE    RXSS0020            YES - PROCESS HEADER                         
         CLI   PARM+12,C'D'        NO  - SETFLAG = DETAIL?                      
         BE    RXSS0040            YES - DON'T PROCESS HEADER                   
*                                  NO  - SETFLAG = HEADER                       
RXSS0020 EQU   *                                                                
         BRAS  RE,RXSETHDR         FIRST RECORD IS THE SET HEADER               
*                                                                               
         USING RESTND,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESTNLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         DROP  R2                                                               
*                                                                               
RXSS0040 EQU   *                                                                
         USING RESTCD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         CLI   PARM+12,C'N'        SETFLAG = NOT SET OF SETS?                   
         BE    RXSS0060            YES - PROCESS DETAIL                         
         CLI   PARM+12,C'H'        NO  - SETFLAG = HEADER?                      
         BE    RXSS0080            YES - DON'T PROCESS DETAIL                   
*                                  NO  - SETFLAG = HEADER                       
RXSS0060 EQU   *                                                                
         BRAS  RE,RXSETDET                                                      
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESTCLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
RXSS0080 EQU   *                                                                
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
*---------------------------------------------------------------------*         
* BUILD SET DETAIL RECORD                                                       
*                                                                               
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSETDET NTR1  BASE=*,LABEL=*                                                   
                                                                                
         LA    R0,RESTCD           CLEAR THE RECORD                             
         LA    R1,RESTCDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
***      CLI   KILLMODE,C'Y'       KILLMODE?                                    
***      JNE   RXSET004                                                         
*                                                                               
RXSET004 DS    0H                                                               
         LA    R4,RSETELEM         A(FIRST ELEMENT)                             
RXSET010 DS    0H                                                               
         CLI   0(R4),0             END OF RECORD?                               
         BE    RXSET100            YES - FINISHED                               
         CLI   0(R4),X'20'         SET MEMBER ELEMENT?                          
         BE    RXSET030            YES                                          
RXSET020 EQU   *                                                                
         ZIC   RF,1(R4)            BUMP TO NEXT ELEMENT                         
         AR    R4,RF                                                            
         B     RXSET010            GO BACK FOR NEXT ELEMENT                     
RXSET030 EQU   *                                                                
         ZIC   R7,1(R4)            GET L(ELEMENT)                               
         AR    R7,R4               SET A(1 PAST END OF ELEMENT)                 
*                                                                               
         USING RSETMEMD,R4                                                      
         LA    R6,RSETMEMB         SET A(1ST MEMBER OF SET)                     
RXSET035 EQU   *                                                                
*                                                                               
         BAS   RE,RXSETSK          BUILD SKELETON                               
*                                                                               
         ZIC   RE,RSETMLEN         GET MEMBER CODE LENGTH                       
         BCTR  RE,0                MINUS 1 FOR EX                               
         EX    RE,RXSET040                                                      
         B     RXSET050                                                         
RXSET040 MVC   RESTCSCD(0),0(R6)   INSERT SET MEMBER CODE                       
RXSET050 EQU   *                                                                
         OC    RESTCSCD,SPACES     CLEAR REMAINDER TO SPACES                    
         TR    RESTCSCD,MXTRT                                                   
*                                                                               
         L     RF,PARM+16          A(SETCTR)                                    
         L     R1,0(RF)            LOAD SETCTR FROM RXTRACT                     
         LA    R1,1(R1)            BUMP CTR BY 1                                
         ST    R1,0(RF)            PUT IT BACK                                  
         EDIT  (4,0(RF)),(12,RESTCCTR),FILL=0                                   
*                                                                               
         SR    RE,RE               CLEAR THE NEXT RECORD                        
         ICM   RE,3,RESTCLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         ZIC   RE,RSETMLEN         GET MEMBER CODE LENGTH                       
         AR    R6,RE               BUMP TO NEXT CODE                            
         CR    R6,R7                                                            
         BL    RXSET035            END OF ELEMENT NOT REACHED                   
*                                                                               
RXSET100 EQU   *                                                                
*                                                                               
         J     EXITR2                                                           
         DROP  R4                                                               
*                                                                               
*---------------------------------------------------------------------*         
* BUILD SET RECORD SKELETON                                                     
*                                                                               
*---------------------------------------------------------------------*         
RXSETSK  NTR1                                                                   
         LA    R0,RESTCD           CLEAR THE RECORD                             
         LA    R1,RESTCDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RESTCLEN,RESTCLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RESTCLEN(2),=AL2(RESTCDL)                                        
         MVC   RESTCTYP,REPSTCQ                                                 
         MVI   RESTCACT-1,MXTRTQ                                                
         MVI   RESTCDAT-1,MXTRTQ                                                
         MVI   RESTCTME-1,MXTRTQ                                                
         MVI   RESTCDX,MXTRTQ                                                   
         MVI   RESTCDX+1,MXTRTQ                                                 
         MVI   RESTCREP-1,MXTRTQ                                                
         MVI   RESTCSTY-1,MXTRTQ                                                
         MVI   RESTCSNM-1,MXTRTQ                                                
         MVI   RESTCSCD-1,MXTRTQ                                                
         MVI   RESTCCTR-1,MXTRTQ                                                
         MVI   RESTCRTS-1,MXTRTQ                                                
         MVI   RESTCDEL-1,MXTRTQ                                                
*                                                                               
X        USING RESTCD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RESTCACT,X.RESTCACT                                              
         MVC   RESTCDAT,X.RESTCDAT                                              
         MVC   RESTCTME,X.RESTCTME                                              
         DROP  X                                                                
*                                                                               
*  TEST                                                                         
***      LA    RF,RSETREC                                                       
***      DC    H'0'                                                             
*  TEST END                                                                     
*                                                                               
*   REP CODE IN RECORD MAY NOT BE PROPER REP CODE IN OUTPUT.                    
*        SIGNON REP CODE IN REPALPHA IS USED IN ALL CASES.                      
*                                                                               
****>>>  MVC   RESTCREP,RSETKREP   REPCODE                                      
         L     RF,PARM+16          A(SETCTR FROM RXTRACT)                       
         MVC   RESTCREP,4(RF)      REPCODE IS FOUR BYTES FURTHER ON             
         TR    RESTCREP,MXTRT                                                   
         MVC   RESTCSTY,RSETKSET   SET TYPE                                     
         TR    RESTCSTY,MXTRT                                                   
         MVC   RESTCSNM,RSETKID    SET IDENTIFIER                               
         TR    RESTCSNM,MXTRT                                                   
*                                                                               
***      MVC   RESTCRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RESTCRTS(14),=C'19000101000000'                                  
         TR    RESTCRTS,MXTRT                                                   
*                                                                               
         MVI   RESTCDEL,C' '          SET DELETE FLAG DEFAULT                   
*                                                                               
         TM    RSETCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BNO   RSSK0010            NO                                           
         MVI   RESTCDEL,C'D'       YES - SET 'DELETED' INDICATOR                
*                                                                               
RSSK0010 DS    0H                                                               
         TR    RESTCDEL,MXTRT                                                   
*                                                                               
*                                                                               
         LR    RE,R2               CLEAR NEXT RECORD FOR SAFETY                 
         AHI   RE,RESTCDL                                                       
         XC    0(8,RE),0(RE)                                                    
         J     EXIT                                                             
         DROP  R2                                                               
*                                                                               
*---------------------------------------------------------------------*         
* BUILD SET HEADER RECORD                                             *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSETHDR NTR1  BASE=*,LABEL=*                                                   
         USING RESTND,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,RESTND           CLEAR THE RECORD                             
         LA    R1,RESTNDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RESTNLEN,RESTNLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RESTNLEN(2),=AL2(RESTNDL)                                        
         MVC   RESTNTYP,REPSTNQ                                                 
         MVI   RESTNACT-1,MXTRTQ                                                
         MVI   RESTNDAT-1,MXTRTQ                                                
         MVI   RESTNTME-1,MXTRTQ                                                
         MVI   RESTNDX,MXTRTQ                                                   
         MVI   RESTNDX+1,MXTRTQ                                                 
         MVI   RESTNREP-1,MXTRTQ                                                
         MVI   RESTNSTY-1,MXTRTQ                                                
         MVI   RESTNSNM-1,MXTRTQ                                                
         MVI   RESTNSFL-1,MXTRTQ                                                
         MVI   RESTNSDS-1,MXTRTQ                                                
         MVI   RESTNRTS-1,MXTRTQ                                                
         MVI   RESTNDEL-1,MXTRTQ                                                
*                                                                               
B        USING RESTND,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RESTNACT,B.RESTNACT                                              
         MVC   RESTNDAT,B.RESTNDAT                                              
         MVC   RESTNTME,B.RESTNTME                                              
         DROP  B                                                                
*                                                                               
*                                                                               
*   REP CODE IN RECORD MAY NOT BE PROPER REP CODE IN OUTPUT.                    
*        SIGNON REP CODE IN REPALPHA IS USED IN ALL CASES.                      
*                                                                               
****<<<  MVC   RESTNREP,RSETKREP   REPCODE                                      
         L     RF,PARM+16          A(SETCTR)                                    
         MVC   RESTNREP,4(RF)      REPCODE IS FOUR BYTES FURTHER ON             
         TR    RESTNREP,MXTRT                                                   
         MVC   RESTNSTY,RSETKSET   SET TYPE                                     
         TR    RESTNSTY,MXTRT                                                   
         MVC   RESTNSNM,RSETKID    SET ID                                       
         TR    RESTNSNM,MXTRT                                                   
*                                                                               
***      MVC   RESTNRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RESTNRTS(14),=C'19000101000000'                                  
         TR    RESTNRTS,MXTRT                                                   
*                                                                               
         MVI   RESTNDEL,C' '          SET DELETE FLAG DEFAULT                   
*                                                                               
         TM    RSETCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BNO   RSHD0010            NO                                           
         MVI   RESTNDEL,C'D'       YES - SET 'DELETED' INDICATOR                
*                                                                               
RSHD0010 DS    0H                                                               
         TR    RESTNDEL,MXTRT                                                   
*                                                                               
         MVI   RESTNSFL,C'N'       NO  - NOT EXCLUSION                          
         LA    RF,RSETELEM         A(1ST ELEMENT)                               
         CLI   0(RF),X'01'         01 ELEMENT?                                  
         BNE   RSHD0020            NO  - CONSIDER 'NOT EXCLUSION'               
         USING RSET1DES,RF                                                      
*                                                                               
*   SET OF SET PROCESSING STILL TO BE DETERMINED.                               
*                                                                               
         TM    RSET1FLG,X'08'      EXCLUSION SET?                               
         BNO   RSHD0020            NO                                           
         MVI   RESTNSFL,C'Y'       YES - EXCLUSION                              
RSHD0020 EQU   *                                                                
         TR    RESTNSFL,MXTRT                                                   
         DROP  RF                                                               
         LA    RF,RSETELEM         A(1ST ELEMENT)                               
RSHD0030 EQU   *                                                                
         CLI   0(RF),0             END OF RECORD?                               
         BE    RSHD0060            YES - NO DESCRIPTOR ELEMENT                  
         CLI   0(RF),X'10'         10 ELEMENT?                                  
         BE    RSHD0040            YES -                                        
         ZIC   RE,1(RF)            BUMP TO NEXT ELEMENT                         
         AR    RF,RE                                                            
         B     RSHD0030            GO BACK FOR NEXT ELEMENT                     
RSHD0040 EQU   *                                                                
         USING RSETDESD,RF                                                      
         ZIC   RE,1(RF)                                                         
         SH    RE,=H'3'            STRIP CONTROL, 1 FOR EX                      
         EX    RE,RSHD004A         MOVE BY LENGTH                               
         B     RSHD0080                                                         
RSHD004A MVC   RESTNSDS(0),2(RF)                                                
RSHD0060 EQU   *                                                                
         MVC   RESTNSDS,=C'NO SET DESCRIPTION '                                 
RSHD0080 EQU   *                                                                
         OC    RESTNSDS,SPACES                                                  
         TR    RESTNSDS,MXTRT                                                   
         XIT1                                                                   
*                                                                               
         DROP  R2                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*                                                                               
RXSETCC  DC    A(BUFFER1)          ADJUSTED RATE RECORD SAVE AREA               
         LTORG                                                                  
         EJECT                                                                  
***SET**????                                                                    
***SWITCH***<<<                                                                 
***********************************************************************         
* REPSWIC - EXTRACT SWITCH RECORDS                                    *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPSWIC  NMOD1 WORKL,*REPSWI*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RESWILIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING RESWID,R2           R2=A(EXTRACT RECORD)                         
         USING RSWIREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
*                                                                               
         CLI   8(R1),1                                                          
         JL    RXSWIKIL            BUILD KILL RECORD                            
         JE    RXSWISER            BUILD SERIES OF RECORDS                      
         J     RXSWINXT            OUTPUT NEXT RECORD                           
         EJECT                                                                  
*                                                                               
*---------------------------------------------------------------------*         
* GET NEXT SWITCH RECORD IN SERIES AND RETURN IT                                
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSWINXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK?                         
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         LA    R0,RESWID           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1               LENGTH OF NEXT RECORD                        
         ICM   R1,3,RESWILEN-RESWID(RE)                                         
         LA    RF,0(R1,RE)         SAVE NEXT ADDRESS                            
         ST    RF,ANEXT                                                         
         LR    RF,R1               SET LENGTH                                   
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
*                                                                               
**ORIG CONTRACT ROUTINES                                                        
*---------------------------------------------------------------------*         
* BUILD 'K' RECORD FOR SWITCH RECORD AND EXIT                                   
*                                                                               
*   SOME NOTES ON 'KILL':                                                       
*                                                                               
*        THE EXACT RECORDS GENERATED BY THE LAST CHANGE OR                      
*        ADD CAN BE GENERATED AS 'KILLS' BY BRANCHING TO 'RXSWISER'             
*        IMMEDIATELY AFTER THE 'MVI   KILLMODE,C'Y'' STATEMENT                  
*        BELOW.  THIS REQUIRES THAT THE RECORD BEING POINTED TO IS              
*        'COPY' RECORD RATHER THAN 'CHANGE' RECORD.  RXTRACT MOD                
*        IS PASSING IN THE ADDRESS OF THE 'COPY' RATHER THAN THE                
*        'CHANGE' WHEN A 'KILL' IS REQUESTED.                                   
*        IF A SINGLE RECORD TO KILL A GROUP OF RECORDS IS NEEDED,               
*        THE CODE WILL CREATE A SINGLE RECORD OF TYPE, WITH SUFFICIENT          
*        INFORMATION TO KILL ALL ASSOCIATED RECORDS.  THE RECORD MUST           
*        HAVE SUFFICIENT KEY IDENTIFICATION TO MAKE IT UNIQUE, AND              
*        ALL KEYS THAT BEGIN WITH THAT PARTIAL KEY WILL BE DROPPED.             
*        THESE KEYS CAN BE GENERATED FROM THE 'CHANGE' KEY, IN WHICH            
*        CASE YOU DON'T REALLY KNOW WHAT HAD BEEN GENERATED PREV-               
*        IOUSLY BY THE 'COPY' KEY.                                              
*                                                                               
*        THE CODE IS CURRENTLY SET UP TO GENERATE A SINGLE KILL                 
*        RECORD WITH A PARTIAL KEY.                                             
*                                                                               
*                                                                               
*                                                                               
*        BILL  7/22/05 - SWITCH CODE ENTERED 10/06/05                           
*                                                                               
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSWIKIL DS    0H                                                               
         MVI   KILLMODE,C'Y'       SET TO 'KILL'                                
*                                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXSWICC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXSWISWI         FIRST KILL HEADER                            
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESWILEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         LA    R6,RSWIREC          COMPETITIVE STATIONS:                        
         MVI   ELCODE,X'02'        FILTER ELEMENT?                              
         BRAS  RE,GETEL                                                         
         JNE   EXIT                NOT FOUND                                    
         BRAS  RE,RXSWIFIL         THEN  KILL SWITCH FILTERS                    
*                                     SINGLE KILL RECORD PRODUCED               
RXSW0020 EQU   *                                                                
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESWILEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     EXIT                                                             
*                                                                               
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD SERIES OF RECORDS FOR THIS SWITCH                             *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSWISER DS    0H                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXSWICC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXSWISWI                                                      
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESWILEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         LA    R6,RSWIREC          SWITCH FILTERS:                              
         MVI   ELCODE,X'02'        FILTER ELEMENT                               
         BRAS  RE,GETEL                                                         
         JNE   EXIT                NO FILTERS                                   
*                                                                               
RXSF0020 EQU   *                                                                
         BRAS  RE,RXSWIFIL         THEN  GEN FILTERS                            
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESWILEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
RXSF0240 EQU   *                                                                
         ZIC   RF,1(R6)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R6,RF                                                            
         CLI   0(R6),X'02'         SWITCH FILTER ELEMENT?                       
         JNE   EXIT                NO  - FINISHED                               
         J     RXSF0020            GO BACK FOR FILTER ELEMENT                   
*                                                                               
*                                                                               
RXSWICC  DC    A(BUFFER1)          ADJUSTED RATE RECORD SAVE AREA               
*                                                                               
**                                                                              
RXSWISWI NTR1                                                                   
*                                                                               
         USING RESWID,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,RESWID           CLEAR THE RECORD                             
         LA    R1,RESWIDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RESWILEN,RESWILEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RESWILEN(2),=AL2(RESWIDL)                                        
         MVI   RESWIACT-1,MXTRTQ                                                
         MVI   RESWIDAT-1,MXTRTQ                                                
         MVI   RESWITME-1,MXTRTQ                                                
         MVC   RESWITYP,REPSWIQ                                                 
         MVI   RESWIDX,MXTRTQ                                                   
         MVI   RESWIDX+1,MXTRTQ                                                 
         MVI   RESWIREP-1,MXTRTQ                                                
         MVI   RESWISDT-1,MXTRTQ                                                
         MVI   RESWISTY-1,MXTRTQ                                                
         MVI   RESWIOLD-1,MXTRTQ                                                
         MVI   RESWISEQ-1,MXTRTQ                                                
         MVI   RESWINEW-1,MXTRTQ                                                
         MVI   RESWIIT1-1,MXTRTQ                                                
         MVI   RESWIIC1-1,MXTRTQ                                                
         MVI   RESWIIT2-1,MXTRTQ                                                
         MVI   RESWIIC2-1,MXTRTQ                                                
         MVI   RESWIDDS-1,MXTRTQ                                                
         MVI   RESWIDTS-1,MXTRTQ                                                
         MVI   RESWIDTW-1,MXTRTQ                                                
         MVI   RESWIRTS-1,MXTRTQ                                                
         MVI   RESWIDEL-1,MXTRTQ                                                
*                                                                               
B        USING RESWID,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RESWIACT,B.RESWIACT                                              
         MVC   RESWIDAT,B.RESWIDAT                                              
         MVC   RESWITME,B.RESWITME                                              
         DROP  B                                                                
*                                                                               
         MVC   RESWIREP,RSWIKREP   REP COMPANY                                  
         TR    RESWIREP,MXTRT                                                   
         GOTO1 DATCON,PLIST,(3,RSWIKYMD),(10,RESWISDT)                          
         TR    RESWISDT,MXTRT                                                   
         EDIT  RSWIKSEQ,(3,RESWISEQ),FILL=0                                     
         TR    RESWISEQ,MXTRT                                                   
         GOTO1 SETSWTYP,DMCB,RSWIKCHA,RESWISTY                                  
         TR    RESWISTY,MXTRT                                                   
         CLC   RESWISTY,=C'TM'     TEAM SWITCH?                                 
         BE    RESW0002            YES                                          
         CLC   RESWISTY,=C'OF'     OFFC SWITCH?                                 
         BE    RESW0002            YES                                          
         CLC   RESWISTY,=C'SP'     S/P  SWITCH?                                 
         BE    RESW0002            YES                                          
         CLC   RESWISTY,=C'CS'     COMPETITIVE STATION SWITCH?                  
         BE    RESW0004            YES                                          
         MVC   RESWIOLD,RSWIKOLD   NO  - ORIGINAL RECORD CODE                   
         B     RESW0010                                                         
RESW0002 EQU   *                                                                
         MVC   RESWIOLD(3),RSWIKOLD+2                                           
*                                  INSERT S/P CODE ONLY                         
         B     RESW0010                                                         
RESW0004 EQU   *                                                                
         MVC   RESWIOLD(5),RSWIKOLD                                             
*                                  INSERT STATION CODE ONLY                     
         B     RESW0010                                                         
RESW0010 EQU   *                                                                
         OC    RESWIOLD,SPACES     OR IN SPACES                                 
         TR    RESWIOLD,MXTRT                                                   
         CLC   RESWISTY,=C'TM'     TEAM SWITCH?                                 
         BE    RESW0012            YES                                          
         CLC   RESWISTY,=C'OF'     OFFC SWITCH?                                 
         BE    RESW0012            YES                                          
         CLC   RESWISTY,=C'SP'     S/P  SWITCH?                                 
         BE    RESW0012            YES                                          
         CLC   RESWISTY,=C'CS'     COMPETITIVE STATION SWITCH?                  
         BE    RESW0014            YES                                          
         MVC   RESWINEW,RSWINEW    NO  - NEW RECORD CODE                        
         B     RESW0018                                                         
RESW0012 EQU   *                                                                
         MVC   RESWIIT1,=C'OF'     TM / OF / SP: SET INHERIT OFFICE             
         MVC   RESWINEW(3),RSWINEW+2                                            
*                                  INSERT S/P AS NEW CODE                       
         MVC   RESWIIC1(2),RSWINEW INSERT OFFICE CODE AS 1ST INHERIT            
         OC    RESWIIC1,SPACES     OR IN SPACES                                 
         CLC   RSWINEW+5(2),SPACES ANY 'TEAM' IN NEW CODE?                      
         BNH   RESW0018            NO  - FINISHED HERE                          
         MVC   RESWIIT2,=C'TM'     YES - TM / OF / SP: SET INHERIT TEAM         
         MVC   RESWIIC2(2),RSWINEW+5                                            
*                                  INSERT TEAM CODE AS 2ND INHERIT              
         OC    RESWIIC2,SPACES     OR IN SPACES                                 
         B     RESW0018                                                         
RESW0014 EQU   *                                                                
         MVC   RESWIIT1,=C'AF'     COMP STATION: SET INHERIT AFFILIATE          
         MVC   RESWINEW(5),RSWINEW                                              
*                                  INSERT COMP STATION AS NEW CODE              
         LA    RF,AFFLIST          SET A(AFFILIATE TABLE)                       
RESW0015 EQU   *                                                                
         CLI   0(RF),X'FF'         END OF TABLE?                                
         BNE   *+6                                                              
         DC    H'0'                YES - SHOULDN'T HAPPEN                       
         CLC   RSWINEW+5(2),0(RF)  NO  - 1ST 2 CHARS IN TABLE?                  
         BE    RESW0017            YES                                          
*                                                                               
* SPECIAL CODE TO CHECK C* WHICH IS CBL. WE NEED THIS AS SWITCH                 
* USES ONLY 2 CHARS FOR AFFILATES AND CB(S) IS ALREADY TAKEN                    
*                                                                               
         CLC   =C'C*',RSWINEW+5                                                 
         BNE   RESW0016                                                         
         MVC   RESWIIC1(3),=C'CBL'                                              
         B     RESW0018                                                         
*                                                                               
RESW0016 EQU   *                                                                
         LA    RF,3(RF)            NO  - BUMP TO NEXT SLOT                      
         B     RESW0015            GO BACK FOR NEXT                             
*                                                                               
RESW0017 EQU   *                                                                
         MVC   RESWIIC1(3),0(RF)   INSERT AFFIL CODE AS 1ST INHERIT             
RESW0018 EQU   *                                                                
         OC    RESWINEW,SPACES     OR IN SPACES                                 
         TR    RESWINEW,MXTRT                                                   
         TR    RESWIIT1,MXTRT                                                   
         TR    RESWIIC1,MXTRT                                                   
         TR    RESWIIT2,MXTRT                                                   
         TR    RESWIIC2,MXTRT                                                   
         MVI   RESWIDDS,C'N'       DDS STATION SWITCH = NO                      
         TM    RSWIDDS,X'80'       DDS STATION SWITCH?                          
         BNO   RESW0020            NO                                           
         MVI   RESWIDDS,C'Y'       DDS STATION SWITCH = YES                     
RESW0020 EQU   *                                                                
         TR    RESWIDDS,MXTRT                                                   
         OC    RSWISTA,RSWISTA     ANY START DATE?                              
         BZ    RESW0030            NO                                           
         GOTO1 DATCON,PLIST,(3,RSWISTA),(10,RESWIDTS)                           
*                                  CONVERT START DATE                           
RESW0030 EQU   *                                                                
         TR    RESWIDTS,MXTRT                                                   
         MVI   RESWIDTW,C'N'       START DATE W/IN FLIGHT = NO                  
         TM    RSWIDDS,X'40'       START DATE W/IN FLIGHT?                      
         BNO   RESW0040            NO                                           
         MVI   RESWIDTW,C'Y'       START DATE W/IN FLIGHT = YES                 
RESW0040 EQU   *                                                                
         TR    RESWIDTW,MXTRT                                                   
*                                                                               
****     MVC   RESWIRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RESWIRTS(14),=C'19000101000000'                                  
         TR    RESWIRTS,MXTRT                                                   
         MVI   RESWIDEL,C' '                                                    
         TR    RESWIDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
         DROP  R2                                                               
RESWILIT DC    A(LITERAL)                                                       
*                                                                               
       ++INCLUDE REAFFLIST                                                      
*                                                                               
**********************************************************************          
*   SWITCH FILTER GENERATION                                         *          
*   R6  ->  SWITCH RECORD X'02' ELEMENT                              *          
*                                                                    *          
**********************************************************************          
RXSWIFIL NTR1                                                                   
*                                                                               
         USING RESWFD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,RESWFD           CLEAR THE RECORD                             
         LA    R1,RESWFDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RESWFLEN,RESWFLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RESWFLEN(2),=AL2(RESWFDL)                                        
         MVI   RESWFACT-1,MXTRTQ                                                
         MVI   RESWFDAT-1,MXTRTQ                                                
         MVI   RESWFTME-1,MXTRTQ                                                
         MVC   RESWFTYP,REPSWFQ                                                 
         MVI   RESWFDX,MXTRTQ                                                   
         MVI   RESWFDX+1,MXTRTQ                                                 
         MVI   RESWFREP-1,MXTRTQ                                                
         MVI   RESWFSDT-1,MXTRTQ                                                
         MVI   RESWFSTY-1,MXTRTQ                                                
         MVI   RESWFOLD-1,MXTRTQ                                                
         MVI   RESWFSEQ-1,MXTRTQ                                                
         MVI   RESWFF1T-1,MXTRTQ                                                
         MVI   RESWFF1C-1,MXTRTQ                                                
         MVI   RESWFRTS-1,MXTRTQ                                                
         MVI   RESWFDEL-1,MXTRTQ                                                
*                                                                               
B        USING RESWFD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RESWFACT,B.RESWFACT                                              
         MVC   RESWFDAT,B.RESWFDAT                                              
         MVC   RESWFTME,B.RESWFTME                                              
         DROP  B                                                                
*                                                                               
         MVC   RESWFREP,RSWIKREP   REP COMPANY                                  
         TR    RESWFREP,MXTRT                                                   
         MVC   RESWFRTS(14),=C'19000101000000'                                  
         TR    RESWFRTS,MXTRT                                                   
         MVI   RESWFDEL,C' '                                                    
         TR    RESWFDEL,MXTRT                                                   
         GOTO1 DATCON,PLIST,(3,RSWIKYMD),(10,RESWFSDT)                          
         TR    RESWFSDT,MXTRT                                                   
         EDIT  RSWIKSEQ,(3,RESWFSEQ),FILL=0                                     
         TR    RESWFSEQ,MXTRT                                                   
         GOTO1 SETSWTYP,DMCB,RSWIKCHA,RESWFSTY                                  
         TR    RESWFSTY,MXTRT                                                   
         CLC   RESWFSTY,=C'TM'     TEAM SWITCH?                                 
         BE    RXFI0020            YES                                          
         CLC   RESWFSTY,=C'OF'     OFFC SWITCH?                                 
         BE    RXFI0020            YES                                          
         CLC   RESWFSTY,=C'SP'     S/P  SWITCH?                                 
         BE    RXFI0020            YES                                          
         CLC   RESWFSTY,=C'CS'     COMPETITIVE STATION SWITCH?                  
         BE    RXFI0040            YES                                          
         MVC   RESWFOLD,RSWIKOLD   NO  - ORIGINAL RECORD CODE                   
         B     RXFI0060                                                         
RXFI0020 EQU   *                                                                
         MVC   RESWFOLD(3),RSWIKOLD+2                                           
*                                  INSERT S/P CODE ONLY                         
         B     RXFI0060                                                         
RXFI0040 EQU   *                                                                
         MVC   RESWFOLD(5),RSWIKOLD                                             
*                                  INSERT STATION CODE ONLY                     
         B     RXFI0060                                                         
RXFI0060 EQU   *                                                                
         OC    RESWFOLD,SPACES     OR IN SPACES                                 
         TR    RESWFOLD,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       ONLY KEY INFO FOR KILL MODE                  
         JE    EXIT                                                             
*                                                                               
         USING RSWIFIEL,R6                                                      
         GOTO1 SETSWTYP,DMCB,RSWIFTYP,RESWFF1T                                  
         MVC   RESWFF1C,RSWIFFTR   INSERT FILTER CODE                           
*                                                                               
         TR    RESWFF1T,MXTRT                                                   
         TR    RESWFF1C,MXTRT                                                   
         J     EXIT                                                             
*                                                                               
         DROP  R2                                                               
         EJECT                                                                  
*                                                                               
**********************************************************************          
* SETSWTYP:  TRANSLATES A SINGLE BINARY VALUE INTO A TWO-CHARACTER   *          
*        REPRESENTATION OF THE RECORD TYPE BEING PROCESSED.          *          
*                                                                    *          
*        P1  ->  FIELD BEING TRANSLATED                              *          
*        P2  =>  RECEIVING FIELD FOR TRANSLATION RESULT              *          
*                                                                    *          
*                                                                    *          
**********************************************************************          
SETSWTYP NTR1                                                                   
         LA    R5,RESWITAB                                                      
         L     R2,0(R1)            SET A(FIELD BEING TRANSLATED)                
         L     R3,4(R1)            SET A(RECEIVING FIELD)                       
SSWT0020 EQU   *                                                                
         CLI   0(R5),0             END OF TABLE REACHED?                        
         BNE   *+6                                                              
         DC    H'0'                SHOULDN'T HAPPEN                             
         CLC   0(1,R2),0(R5)       ENTRY FOUND IN TABLE?                        
         BE    SSWT0040            YES                                          
         LA    R5,LRESWITB(R5)     NO  - BUMP TO NEXT TABLE ENTRY               
         B     SSWT0020            GO BACK FOR NEXT ENTRY                       
SSWT0040 EQU   *                                                                
         MVC   0(2,R3),1(R5)       MOVE CHARS FROM TABLE TO OUTPUT              
         XIT1                                                                   
*                                                                               
RESWITAB DC    XL1'01',C'TM'       TEAM                                         
LRESWITB EQU   *-RESWITAB                                                       
         DC    XL1'02',C'ST'       STATION                                      
         DC    XL1'04',C'OF'       OFFICE                                       
         DC    XL1'08',C'AD'       ADVERTISER                                   
         DC    XL1'10',C'SP'       SALESPERSON                                  
         DC    XL1'20',C'GR'       GROUP                                        
         DC    XL1'40',C'AG'       AGENCY                                       
         DC    XL1'80',C'CS'       COMPETITIVE STATION                          
         DC    XL1'03',C'DP'       DEVELOPMENTAL S/P                            
         DC    XL1'05',C'PP'       POINT PERSON                                 
         DC    X'0000'                                                          
         DS    0F                                                               
*                                                                               
         DROP  R3                                                               
         LTORG                                                                  
***SWITCH***<<<                                                                 
         EJECT                                                                  
********************CONFIRM COMMENTS                                            
***********************************************************************         
* REPCCOC - EXTRACT CONFIRM COMMENT RECORD                                      
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)   (AGENCY 2 RECORD)                           *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPCCOC  NMOD1 WORKL,*REPCCO*,CLEAR=Y                                           
         USING WORKD,RC                                                         
*                                                                               
         L     RA,RECCOLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING RECCOD,R2           R2=A(EXTRACT RECORD)                         
         USING RCFCREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    RECCOLEN,RECCOLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RECCOLEN(2),=AL2(RECCODL)                                        
         MVC   RECCOTYP,REPCCOQ                                                 
         MVI   RECCODX,MXTRTQ                                                   
         MVI   RECCODX+1,MXTRTQ                                                 
         MVI   RECCOREP-1,MXTRTQ                                                
         MVI   RECCOCON-1,MXTRTQ                                                
         MVI   RECCORTS-1,MXTRTQ                                                
         MVI   RECCODEL-1,MXTRTQ                                                
*                                                                               
         MVC   RECCOREP,RCFCKREP   REP COMPANY                                  
         TR    RECCOREP,MXTRT                                                   
*                                                                               
         ZAP   WORK+200(5),=P'0'    CONTRACT NUMBER                             
         MVO   WORK+200(5),RCFCKCON                                             
         EDIT  (P5,WORK+200),(8,RECCOCON),ALIGN=LEFT                            
         TR    RECCOCON,MXTRT                                                   
*                                                                               
*                                                                               
***      MVC   RECCORTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   RECCORTS(14),=C'19000101000000'                                  
         TR    RECCORTS,MXTRT                                                   
*                                                                               
         MVI   RECCODEL,C' '          SET DELETE FLAG DEFAULT                   
         TM    RCFCCNTL,X'80'      RECORD MARKED FOR DELETION?                  
         BNO   RCCO0100            NO                                           
         MVI   RECCODEL,C'D'          YES - SET DELETE FLAG ON                  
RCCO0100 EQU   *                                                                
         TR    RECCODEL,MXTRT                                                   
         J     EXIT                                                             
*                                                                               
RECCOLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
********************CONFIRM COMMENTS                                            
*********>>>>>>>>>>>STANDARD COMMENTS                                           
***********************************************************************         
* REPSCMC - STANDARD COMMENT RECORDS                                  *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPSCMC  NMOD1 WORKL,*REPSCM*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,RESCMLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING RESCMD,R2           R2=A(EXTRACT RECORD)                         
         USING RCMTREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
*                                                                               
         CLI   8(R1),1                                                          
         JL    RXSCMKIL            BUILD KILL RECORD                            
         JE    RXSCMSER            BUILD SERIES OF RECORDS                      
         J     RXSCMNXT            OUTPUT NEXT RECORD                           
         EJECT                                                                  
*                                                                               
*---------------------------------------------------------------------*         
* GET NEXT STD CMT RECORD IN SERIES AND RETURN IT                               
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSCMNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK?                         
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         LA    R0,RESCMD           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1               LENGTH OF NEXT RECORD                        
         ICM   R1,3,RESCMLEN-RESCMD(RE)                                         
         LA    RF,0(R1,RE)         SAVE NEXT ADDRESS                            
         ST    RF,ANEXT                                                         
         LR    RF,R1               SET LENGTH                                   
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
*                                                                               
*                                                                               
*---------------------------------------------------------------------*         
* BUILD 'K' RECORD FOR SWITCH RECORD AND EXIT                                   
*                                                                               
*   SOME NOTES ON 'KILL':                                                       
*                                                                               
*        THE EXACT RECORDS GENERATED BY THE LAST CHANGE OR                      
*        ADD CAN BE GENERATED AS 'KILLS' BY BRANCHING TO 'RXSCMSER'             
*        IMMEDIATELY AFTER THE 'MVI   KILLMODE,C'Y'' STATEMENT                  
*        BELOW.  THIS REQUIRES THAT THE RECORD BEING POINTED TO IS              
*        'COPY' RECORD RATHER THAN 'CHANGE' RECORD.  RXTRACT MOD                
*        IS PASSING IN THE ADDRESS OF THE 'COPY' RATHER THAN THE                
*        'CHANGE' WHEN A 'KILL' IS REQUESTED.                                   
*        IF A SINGLE RECORD TO KILL A GROUP OF RECORDS IS NEEDED,               
*        THE CODE WILL CREATE A SINGLE RECORD OF TYPE, WITH SUFFICIENT          
*        INFORMATION TO KILL ALL ASSOCIATED RECORDS.  THE RECORD MUST           
*        HAVE SUFFICIENT KEY IDENTIFICATION TO MAKE IT UNIQUE, AND              
*        ALL KEYS THAT BEGIN WITH THAT PARTIAL KEY WILL BE DROPPED.             
*        THESE KEYS CAN BE GENERATED FROM THE 'CHANGE' KEY, IN WHICH            
*        CASE YOU DON'T REALLY KNOW WHAT HAD BEEN GENERATED PREV-               
*        IOUSLY BY THE 'COPY' KEY.                                              
*                                                                               
*        THE CODE IS CURRENTLY SET UP TO GENERATE A SINGLE KILL                 
*        RECORD WITH A PARTIAL KEY.                                             
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSCMKIL DS    0H                                                               
         MVI   KILLMODE,C'Y'       SET TO 'KILL'                                
*                                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXSCMCC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXSCMSCM         FIRST KILL HEADER                            
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESCMLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     EXIT                                                             
*                                                                               
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD SERIES OF RECORDS FOR THIS STANDARD COMMENT                   *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXSCMSER DS    0H                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXSCMCC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*&&DO                                                                           
         BRAS  RE,RXSCMSCM                                                      
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESCMLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*&&                                                                             
         XC    SEQCTR,SEQCTR       CLEAR COUNTER                                
*                                                                               
         LA    R6,RCMTREC          GET FIRST LINE OF COMMENT                    
         MVI   ELCODE,X'02'        FILTER ELEMENT                               
         BRAS  RE,GETEL                                                         
         JNE   EXIT                NO FILTERS                                   
*                                                                               
RSCM0020 EQU   *                                                                
         L     RF,SEQCTR                                                        
         LA    RF,1(RF)                                                         
         ST    RF,SEQCTR                                                        
*                                                                               
         BRAS  RE,RXSCMSCM         THEN  GEN COMMENT LINE RECORD                
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,RESCMLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
RSCM0240 EQU   *                                                                
         ZIC   RF,1(R6)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R6,RF                                                            
         CLI   0(R6),X'02'         ANOTHER LINE  ELEMENT?                       
         JNE   EXIT                NO  - FINISHED                               
         J     RSCM0020            GO BACK FOR FILTER ELEMENT                   
*                                                                               
*                                                                               
RXSCMCC  DC    A(BUFFER1)          ADJUSTED RATE RECORD SAVE AREA               
*                                                                               
**                                                                              
RXSCMSCM NTR1                                                                   
*                                                                               
         USING RESCMD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,RESCMD           CLEAR THE RECORD                             
         LA    R1,RESCMDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    RESCMLEN,RESCMLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   RESCMLEN(2),=AL2(RESCMDL)                                        
         MVI   RESCMACT-1,MXTRTQ                                                
         MVI   RESCMDAT-1,MXTRTQ                                                
         MVI   RESCMTME-1,MXTRTQ                                                
         MVC   RESCMTYP,REPSCMQ                                                 
         MVI   RESCMDX,MXTRTQ                                                   
         MVI   RESCMDX+1,MXTRTQ                                                 
         MVI   RESCMREP-1,MXTRTQ                                                
         MVI   RESCMCO#-1,MXTRTQ                                                
         MVI   RESCMCOD-1,MXTRTQ                                                
         MVI   RESCMLIN-1,MXTRTQ                                                
         MVI   RESCMRTS-1,MXTRTQ                                                
         MVI   RESCMDEL-1,MXTRTQ                                                
*                                                                               
B        USING RESCMD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   RESCMACT,B.RESCMACT                                              
         MVC   RESCMDAT,B.RESCMDAT                                              
         MVC   RESCMTME,B.RESCMTME                                              
         DROP  B                                                                
*                                                                               
         MVC   RESCMREP,RCMTKREP   REP COMPANY                                  
         TR    RESCMREP,MXTRT                                                   
         MVC   RESCMCOD,RCMTKCDE   INSERT STD COMMENT CODE                      
         TR    RESCMCOD,MXTRT                                                   
*                                                                               
         MVC   RESCMRTS(14),=C'19000101000000'                                  
         TR    RESCMRTS,MXTRT                                                   
         MVI   RESCMDEL,C' '                                                    
         TR    RESCMDEL,MXTRT                                                   
         MVC   RESCMLIN,SPACES     SET DEFAULT                                  
         TR    RESCMLIN,MXTRT                                                   
*                                                                               
         CLI   KILLMODE,C'Y'       SET TO 'KILL' ?                              
         BNE   RXSC0040            NO                                           
         SR    RE,RE               YES - CLEAR THE NEXT RECORD                  
         ICM   RE,3,RESCMLEN       PUT OUT SHORT RECORD                         
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXSC0200            YES - ONLY PUT OUT ONE RECORD                
*                                                                               
RXSC0040 EQU   *                                                                
         EDIT  SEQCTR,(2,RESCMCO#),FILL=0                                       
         TR    RESCMCO#,MXTRT      INSERT SEQ # TO DIFFERENTIATE                
         ZIC   RF,1(R6)            MOVE DATA BY LENGTH                          
         SH    RF,=H'3'            SET FOR MOVE BY EX                           
         EX    RF,RXSC0060                                                      
         B     RXSC0080                                                         
RXSC0060 EQU   *                                                                
         MVC   RESCMLIN(0),2(R6)   MOVE DATA BY LENGTH                          
RXSC0080 EQU   *                                                                
         OC    RESCMLIN,SPACES     OR IN SPACES                                 
         TR    RESCMLIN,MXTRT                                                   
*                                                                               
RXSC0200 EQU   *                                                                
         J     EXIT                                                             
*                                                                               
         DROP  R2                                                               
RESCMLIT DC    A(LITERAL)                                                       
*********>>>>>>>>>>>STANDARD COMMENTS                                           
*********<<<<<<<>>>>OFFICE   COMMENTS                                           
***********************************************************************         
* REPOFCC - OFFICE COMMENT RECORDS                                    *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPOFCC  NMOD1 WORKL,*REPOFC*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REOFCLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REOFCD,R2           R2=A(EXTRACT RECORD)                         
         USING ROCMREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
*                                                                               
         CLI   8(R1),1                                                          
         JL    RXOFCKIL            BUILD KILL RECORD                            
         JE    RXOFCSER            BUILD SERIES OF RECORDS                      
         J     RXOFCNXT            OUTPUT NEXT RECORD                           
         EJECT                                                                  
*                                                                               
*---------------------------------------------------------------------*         
* GET NEXT OFC CMT RECORD IN SERIES AND RETURN IT                               
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXOFCNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK?                         
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         LA    R0,REOFCD           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1               LENGTH OF NEXT RECORD                        
         ICM   R1,3,REOFCLEN-REOFCD(RE)                                         
         LA    RF,0(R1,RE)         SAVE NEXT ADDRESS                            
         ST    RF,ANEXT                                                         
         LR    RF,R1               SET LENGTH                                   
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
*                                                                               
*                                                                               
*---------------------------------------------------------------------*         
* BUILD 'K' RECORD FOR OFC CMT RECORD AND EXIT                                  
*                                                                               
*   SOME NOTES ON 'KILL':                                                       
*                                                                               
*        THE EXACT RECORDS GENERATED BY THE LAST CHANGE OR                      
*        ADD CAN BE GENERATED AS 'KILLS' BY BRANCHING TO 'RXOFCSER'             
*        IMMEDIATELY AFTER THE 'MVI   KILLMODE,C'Y'' STATEMENT                  
*        BELOW.  THIS REQUIRES THAT THE RECORD BEING POINTED TO IS              
*        'COPY' RECORD RATHER THAN 'CHANGE' RECORD.  RXTRACT MOD                
*        IS PASSING IN THE ADDRESS OF THE 'COPY' RATHER THAN THE                
*        'CHANGE' WHEN A 'KILL' IS REQUESTED.                                   
*        IF A SINGLE RECORD TO KILL A GROUP OF RECORDS IS NEEDED,               
*        THE CODE WILL CREATE A SINGLE RECORD OF TYPE, WITH SUFFICIENT          
*        INFORMATION TO KILL ALL ASSOCIATED RECORDS.  THE RECORD MUST           
*        HAVE SUFFICIENT KEY IDENTIFICATION TO MAKE IT UNIQUE, AND              
*        ALL KEYS THAT BEGIN WITH THAT PARTIAL KEY WILL BE DROPPED.             
*        THESE KEYS CAN BE GENERATED FROM THE 'CHANGE' KEY, IN WHICH            
*        CASE YOU DON'T REALLY KNOW WHAT HAD BEEN GENERATED PREV-               
*        IOUSLY BY THE 'COPY' KEY.                                              
*                                                                               
*        THE CODE IS CURRENTLY SET UP TO GENERATE A SINGLE KILL                 
*        RECORD WITH A PARTIAL KEY.                                             
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXOFCKIL DS    0H                                                               
         MVI   KILLMODE,C'Y'       SET TO 'KILL'                                
*                                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXOFCCC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         BRAS  RE,RXOFCOFC         FIRST KILL HEADER                            
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REOFCLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     EXIT                                                             
*                                                                               
         SPACE 1                                                                
*---------------------------------------------------------------------*         
* BUILD SERIES OF RECORDS FOR THIS OFFICE COMMENT                     *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
RXOFCSER DS    0H                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,RXOFCCC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*&&DO                                                                           
         BRAS  RE,RXOFCOFC                                                      
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REOFCLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*&&                                                                             
         XC    SEQCTR,SEQCTR       CLEAR COUNTER                                
*                                                                               
         LA    R6,ROCMDSEL         SET A(COMMENT DESCRIPTIVE ELEMENT)           
         ST    R6,SAVCMDES         SAVE IT OFF                                  
*                                                                               
         LA    R6,ROCMREC          GET FIRST LINE OF COMMENT                    
         MVI   ELCODE,X'02'        FILTER ELEMENT                               
         BRAS  RE,GETEL                                                         
         JNE   EXIT                NO FILTERS                                   
*                                                                               
ROCF0020 EQU   *                                                                
         L     RF,SEQCTR                                                        
         LA    RF,1(RF)                                                         
         ST    RF,SEQCTR                                                        
*                                                                               
         BRAS  RE,RXOFCOFC         THEN  GEN COMMENT LINE RECORD                
*                                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,REOFCLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
ROCF0240 EQU   *                                                                
         ZIC   RF,1(R6)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R6,RF                                                            
         CLI   0(R6),X'02'         ANOTHER LINE  ELEMENT?                       
         JNE   EXIT                NO  - FINISHED                               
         J     ROCF0020            GO BACK FOR FILTER ELEMENT                   
*                                                                               
*                                                                               
RXOFCCC  DC    A(BUFFER1)          ADJUSTED RATE RECORD SAVE AREA               
*                                                                               
**                                                                              
RXOFCOFC NTR1                                                                   
*                                                                               
         USING REOFCD,R2           R2=A(EXTRACT RECORD)                         
*                                                                               
         LA    R0,REOFCD           CLEAR THE RECORD                             
         LA    R1,REOFCDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    REOFCLEN,REOFCLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REOFCLEN(2),=AL2(REOFCDL)                                        
         MVI   REOFCACT-1,MXTRTQ                                                
         MVI   REOFCDAT-1,MXTRTQ                                                
         MVI   REOFCTME-1,MXTRTQ                                                
         MVC   REOFCTYP,REPOFCQ                                                 
         MVI   REOFCDX,MXTRTQ                                                   
         MVI   REOFCDX+1,MXTRTQ                                                 
         MVI   REOFCREP-1,MXTRTQ                                                
         MVI   REOFCCO#-1,MXTRTQ                                                
         MVI   REOFCCOO-1,MXTRTQ                                                
         MVI   REOFCCOD-1,MXTRTQ                                                
         MVI   REOFCLIN-1,MXTRTQ                                                
         MVI   REOFCDES-1,MXTRTQ                                                
         MVI   REOFCRTS-1,MXTRTQ                                                
         MVI   REOFCDEL-1,MXTRTQ                                                
*                                                                               
B        USING REOFCD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   REOFCACT,B.REOFCACT                                              
         MVC   REOFCDAT,B.REOFCDAT                                              
         MVC   REOFCTME,B.REOFCTME                                              
         DROP  B                                                                
*                                                                               
         MVC   REOFCREP,ROCMKREP   REP COMPANY                                  
         TR    REOFCREP,MXTRT                                                   
         MVC   REOFCCOO,ROCMKOFC   INSERT OFC COMMENT OFFICE                    
         TR    REOFCCOO,MXTRT                                                   
         MVC   REOFCCOD,ROCMKNUM   INSERT OFC COMMENT CODE                      
         TR    REOFCCOD,MXTRT                                                   
*                                                                               
         MVC   REOFCRTS(14),=C'19000101000000'                                  
         TR    REOFCRTS,MXTRT                                                   
         MVI   REOFCDEL,C' '                                                    
         TR    REOFCDEL,MXTRT                                                   
*                                                                               
         MVC   REOFCCO#,=C'  '                                                  
         TR    REOFCCO#,MXTRT      SET DEFAULT                                  
*                                                                               
         MVC   REOFCLIN,SPACES                                                  
         TR    REOFCLIN,MXTRT      SET DEFAULT                                  
*                                                                               
         MVC   REOFCDES,SPACES                                                  
         TR    REOFCLIN,MXTRT      SET DEFAULT                                  
*                                                                               
         CLI   KILLMODE,C'Y'       SET TO 'KILL' ?                              
         BNE   RXOC0040            NO                                           
*                                                                               
         SR    RE,RE               YES - CLEAR THE NEXT RECORD                  
         ICM   RE,3,REOFCLEN       PUT OUT SHORT RECORD                         
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         CLI   KILLMODE,C'Y'       KILLMODE?                                    
         BE    RXOC0200            YES - ONLY PUT OUT ONE RECORD                
*                                                                               
RXOC0040 EQU   *                                                                
         EDIT  SEQCTR,(2,REOFCCO#),FILL=0                                       
         TR    REOFCCO#,MXTRT      INSERT SEQ # TO DIFFERENTIATE                
         CLC   =F'1',SEQCTR        FIRST LINE?                                  
         BNE   RXOC0055            NO                                           
         L     R1,SAVCMDES         YES - NEED DESCRIPTION IN RECORD             
*                                     SET A(RECORD DESCRIPTIVE ELEMENT)         
         ZIC   RF,1(R1)            MOVE DATA BY LENGTH                          
         SH    RF,=H'3'            SET FOR MOVE BY EX                           
         EX    RF,RXOC0044                                                      
         B     RXOC0055                                                         
RXOC0044 EQU   *                                                                
         MVC   REOFCDES(0),2(R1)   MOVE DATA BY LENGTH                          
RXOC0055 EQU   *                                                                
         ZIC   RF,1(R6)            MOVE DATA BY LENGTH                          
         SH    RF,=H'3'            SET FOR MOVE BY EX                           
         EX    RF,RXOC0060                                                      
         B     RXOC0080                                                         
RXOC0060 EQU   *                                                                
         MVC   REOFCLIN(0),2(R6)   MOVE DATA BY LENGTH                          
RXOC0080 EQU   *                                                                
         OC    REOFCLIN,SPACES     OR IN SPACES                                 
         TR    REOFCLIN,MXTRT                                                   
         OC    REOFCDES,SPACES     OR IN SPACES                                 
         TR    REOFCDES,MXTRT                                                   
*                                                                               
RXOC0200 EQU   *                                                                
         J     EXIT                                                             
*                                                                               
         DROP  R2                                                               
REOFCLIT DC    A(LITERAL)                                                       
*********<<<<<<<>>>>OFFICE   COMMENTS                                           
****>>>>>  EOP AGENCY                                                           
***********************************************************************         
* REPEAGC - EXTRACT GROUP/SUB GROUP                                             
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPEAGC  NMOD1 WORKL,*REPEAG*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REEPALIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REEPAD,R2           R2=A(EXTRACT RECORD)                         
         USING REO2REC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REEPALEN,REEPALEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REEPALEN(2),=AL2(REEPADL)                                        
         MVC   REEPATYP,REPEPAQ                                                 
         MVI   REEPADX,MXTRTQ                                                   
         MVI   REEPADX+1,MXTRTQ                                                 
         MVI   REEPAREP-1,MXTRTQ                                                
         MVI   REEPATRF-1,MXTRTQ                                                
         MVI   REEPASTA-1,MXTRTQ                                                
         MVI   REEPAAGY-1,MXTRTQ                                                
         MVI   REEPAEAG-1,MXTRTQ                                                
         MVI   REEPASTT-1,MXTRTQ                                                
         MVI   REEPAADT-1,MXTRTQ                                                
         MVI   REEPATOF-1,MXTRTQ                                                
         MVI   REEPARTS-1,MXTRTQ                                                
         MVI   REEPADEL-1,MXTRTQ                                                
*                                                                               
         MVC   REEPAREP,REO2KREP   REP COMPANY                                  
         TR    REEPAREP,MXTRT                                                   
*                                                                               
         LA    RF,REOPEQUV                                                      
*                                                                               
         MVI   REEPATRF,C'B'                                                    
         LA    RE,0                SET D(EQV ALIGN): BIAS/JDS/ENT/VCI           
         CLI   REO2KSYS,1          BIAS SYSTEM?                                 
         BE    REEPA010            YES                                          
         MVI   REEPATRF,C'J'                                                    
         CLI   REO2KSYS,2          JDS  SYSTEM?                                 
         BE    REEPA010            YES                                          
         MVI   REEPATRF,C'E'                                                    
         CLI   REO2KSYS,3          ESG  SYSTEM?                                 
         BE    REEPA010            YES                                          
         MVI   REEPATRF,C'V'                                                    
         CLI   REO2KSYS,5          VCI  SYSTEM?                                 
         BE    REEPA010            YES                                          
         MVI   REEPATRF,C'C'                                                    
         LA    RE,1                SET D(EQV ALIGN): COLUMBINE                  
         CLI   REO2KSYS,4          COLUMBINE  ?                                 
         BE    REEPA010            YES                                          
         DC    H'0'                UNKNOWN TRAFFIC SYSTEM                       
REEPA010 EQU   *                                                                
         AR    RF,RE               CALC 1ST CHAR TO MOVE                        
         LNR   RE,RE               NEGATE DISPLACEMENT                          
         LA    RE,6(RE)            CALC L(MOVE)                                 
*                                                                               
         TR    REEPATRF,MXTRT                                                   
         MVC   REEPASTA,REO2KSTA   STATION                                      
         TR    REEPASTA,MXTRT                                                   
         MVC   REEPAAGY,REO2KCOD   DDS AGENCY CODE                              
         TR    REEPAAGY,MXTRT                                                   
         EX    RE,REEPA012                                                      
         B     REEPA014                                                         
REEPA012 EQU   *                                                                
         MVC   REEPAEAG(0),0(RF)   MOVE CODE BY LENGTH                          
REEPA014 EQU   *                                                                
         TR    REEPAEAG,MXTRT                                                   
         MVI   REEPASTT,C'N'       SET STATUS = NOT ACTIVE                      
         TM    REOPFLAG,X'80'      ACTIVE?                                      
         BNO   REEPA040            NO                                           
         MVI   REEPASTT,C'Y'       SET STATUS = ACTIVE                          
REEPA040 EQU   *                                                                
*                                                                               
*   SEND NULLS FOR ACTIVITY DATE                                                
*                                                                               
****>>>  GOTO1 DATCON,PLIST,(3,REOPDATE),(10,REEPAADT)                          
         TR    REEPAADT,MXTRT                                                   
         MVC   REEPATOF,REOPTROF   TRADE OFFICE                                 
         TR    REEPATOF,MXTRT                                                   
*                                                                               
***      MVC   REEPARTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REEPARTS(14),=C'19000101000000'                                  
         TR    REEPARTS,MXTRT                                                   
*                                                                               
         MVI   REEPADEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REEPADEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
REEPALIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
****>>>>>  EOP AGENCY                                                           
****>>>::  EOP ADVERT                                                           
***********************************************************************         
* REPEADC - EXTRACT ADVERTISER                                                  
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPEADC  NMOD1 WORKL,*REPEAD*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REEPDLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REEPDD,R2           R2=A(EXTRACT RECORD)                         
         USING REOPREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REEPDLEN,REEPDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REEPDLEN(2),=AL2(REEPDDL)                                        
         MVC   REEPDTYP,REPEPDQ                                                 
         MVI   REEPDDX,MXTRTQ                                                   
         MVI   REEPDDX+1,MXTRTQ                                                 
         MVI   REEPDREP-1,MXTRTQ                                                
         MVI   REEPDTRF-1,MXTRTQ                                                
         MVI   REEPDSTA-1,MXTRTQ                                                
         MVI   REEPDADV-1,MXTRTQ                                                
         MVI   REEPDEAD-1,MXTRTQ                                                
         MVI   REEPDSTT-1,MXTRTQ                                                
         MVI   REEPDADT-1,MXTRTQ                                                
         MVI   REEPDRTS-1,MXTRTQ                                                
         MVI   REEPDDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REEPDREP,REOPKREP   REP COMPANY                                  
         TR    REEPDREP,MXTRT                                                   
*                                                                               
         LA    RF,REOPEQUV                                                      
*                                                                               
         MVI   REEPDTRF,C'B'                                                    
         LA    RE,0                SET D(EQV ALIGN): BIAS/ENT/VCI               
         CLI   REOPKSYS,1          BIAS SYSTEM?                                 
         BE    REEPD010            YES                                          
         MVI   REEPDTRF,C'E'                                                    
         CLI   REOPKSYS,3          ESG  SYSTEM?                                 
         BE    REEPD010            YES                                          
         MVI   REEPDTRF,C'V'                                                    
         CLI   REOPKSYS,5          VCI  SYSTEM?                                 
         BE    REEPD010            YES                                          
         LA    RE,1                SET D(EQV ALIGN): COLUMBINE                  
         MVI   REEPDTRF,C'C'                                                    
         CLI   REOPKSYS,4          COLUMBINE  ?                                 
         BE    REEPD010            YES                                          
         LA    RE,2                SET D(EQV ALIGN): JDS                        
         MVI   REEPDTRF,C'J'                                                    
         CLI   REOPKSYS,2          JDS  SYSTEM?                                 
         BE    REEPD010            YES                                          
         DC    H'0'                UNKNOWN TRAFFIC SYSTEM                       
REEPD010 EQU   *                                                                
         AR    RF,RE               CALC 1ST CHAR TO MOVE                        
         LNR   RE,RE               NEGATE DISPLACEMENT                          
         LA    RE,6(RE)            CALC L(MOVE)                                 
*                                                                               
         TR    REEPDTRF,MXTRT                                                   
         MVC   REEPDSTA,REOPKSTA   STATION                                      
         TR    REEPDSTA,MXTRT                                                   
         MVC   REEPDADV,REOPKCOD   DDS AGENCY CODE                              
         TR    REEPDADV,MXTRT                                                   
         EX    RE,REEPD012                                                      
         B     REEPD014                                                         
REEPD012 EQU   *                                                                
         MVC   REEPDEAD(0),0(RF)   MOVE CODE BY LENGTH                          
REEPD014 EQU   *                                                                
         TR    REEPDEAD,MXTRT                                                   
         MVI   REEPDSTT,C'N'       SET STATUS = NOT ACTIVE                      
         TM    REOPFLAG,X'80'      ACTIVE?                                      
         BNO   REEPD020            NO                                           
         MVI   REEPDSTT,C'Y'       SET STATUS = ACTIVE                          
REEPD020 EQU   *                                                                
*                                                                               
*   SEND NULLS FOR ACTIVITY DATE                                                
*                                                                               
****>>>  GOTO1 DATCON,PLIST,(3,REOPDATE),(10,REEPDADT)                          
         TR    REEPDADT,MXTRT                                                   
***      MVC   REEPDRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REEPDRTS(14),=C'19000101000000'                                  
         TR    REEPDRTS,MXTRT                                                   
*                                                                               
         MVI   REEPDDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REEPDDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
REEPDLIT DC    A(LITERAL)                                                       
REEPDEQV DS    A                                                                
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
****>>>::  EOP ADVERT                                                           
****>>>::  EOP OFFICE                                                           
***********************************************************************         
* REPEOFC - EXTRACT EOP OFFICE                                                  
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPEOFC  NMOD1 WORKL,*REPEOF*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REEPOLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REEPOD,R2           R2=A(EXTRACT RECORD)                         
         USING REO3REC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REEPOLEN,REEPOLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REEPOLEN(2),=AL2(REEPODL)                                        
         MVC   REEPOTYP,REPEPOQ                                                 
         MVI   REEPODX,MXTRTQ                                                   
         MVI   REEPODX+1,MXTRTQ                                                 
         MVI   REEPOREP-1,MXTRTQ                                                
         MVI   REEPOTRF-1,MXTRTQ                                                
         MVI   REEPOSTA-1,MXTRTQ                                                
         MVI   REEPOOFF-1,MXTRTQ                                                
         MVI   REEPOEOF-1,MXTRTQ                                                
         MVI   REEPOSTT-1,MXTRTQ                                                
         MVI   REEPOADT-1,MXTRTQ                                                
         MVI   REEPORTS-1,MXTRTQ                                                
         MVI   REEPODEL-1,MXTRTQ                                                
*                                                                               
         MVC   REEPOREP,REO3KREP   REP COMPANY                                  
         TR    REEPOREP,MXTRT                                                   
*                                                                               
         LA    RF,REOPEQUV                                                      
*                                                                               
         MVI   REEPOTRF,C'B'                                                    
         LA    RE,0                SET D(EQV ALIGN): BIAS/ENT/VCI               
         CLI   REO3KSYS,1          BIAS SYSTEM?                                 
         BE    REEPO010            YES                                          
         MVI   REEPOTRF,C'E'                                                    
         CLI   REO3KSYS,3          ESG  SYSTEM?                                 
         BE    REEPO010            YES                                          
         MVI   REEPOTRF,C'V'                                                    
         CLI   REO3KSYS,5          VCI  SYSTEM?                                 
         BE    REEPO010            YES                                          
         LA    RE,3                SET D(EQV ALIGN): JDS                        
         MVI   REEPOTRF,C'J'                                                    
         CLI   REO3KSYS,2          JDS  SYSTEM?                                 
         BE    REEPO010            YES                                          
         LA    RE,1                SET D(EQV ALIGN): COLUMBINE                  
         MVI   REEPOTRF,C'C'                                                    
         CLI   REO3KSYS,4          COLUMBINE  ?                                 
         BE    REEPO010            YES                                          
         DC    H'0'                UNKNOWN TRAFFIC SYSTEM                       
REEPO010 EQU   *                                                                
         AR    RF,RE               CALC 1ST CHAR TO MOVE                        
         LNR   RE,RE               NEGATE DISPLACEMENT                          
         LA    RE,6(RE)            CALC L(MOVE)                                 
*                                                                               
         TR    REEPOTRF,MXTRT                                                   
         MVC   REEPOSTA,REO3KSTA   STATION                                      
         TR    REEPOSTA,MXTRT                                                   
         MVC   REEPOOFF,REO3KCOD   DDS OFFICE CODE                              
         TR    REEPOOFF,MXTRT                                                   
         EX    RE,REEPO012                                                      
         B     REEPO014                                                         
REEPO012 EQU   *                                                                
         MVC   REEPOEOF(0),0(RF)   MOVE CODE BY LENGTH                          
REEPO014 EQU   *                                                                
         TR    REEPOEOF,MXTRT                                                   
         MVI   REEPOSTT,C'N'       SET STATUS = NOT ACTIVE                      
         TM    REOPFLAG,X'80'      ACTIVE?                                      
         BNO   REEPS020            NO                                           
         MVI   REEPOSTT,C'Y'       SET STATUS = ACTIVE                          
REEPO020 EQU   *                                                                
*                                                                               
*   SEND NULLS FOR ACTIVITY DATE                                                
*                                                                               
****>>>  GOTO1 DATCON,PLIST,(3,REOPDATE),(10,REEPOADT)                          
         TR    REEPOADT,MXTRT                                                   
***      MVC   REEPORTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REEPORTS(14),=C'19000101000000'                                  
         TR    REEPORTS,MXTRT                                                   
*                                                                               
         MVI   REEPODEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REEPODEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
REEPOLIT DC    A(LITERAL)                                                       
REEPOEQV DS    A                                                                
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
****>>>::  EOP OFFICE                                                           
****>>>::  EOP SALESPERSON                                                      
***********************************************************************         
* REPESPC - EXTRACT S/P                                                         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPESPC  NMOD1 WORKL,*REPESP*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REEPSLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REEPSD,R2           R2=A(EXTRACT RECORD)                         
         USING REO4REC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REEPSLEN,REEPSLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REEPSLEN(2),=AL2(REEPSDL)                                        
         MVC   REEPSTYP,REPEPSQ                                                 
         MVI   REEPSDX,MXTRTQ                                                   
         MVI   REEPSDX+1,MXTRTQ                                                 
         MVI   REEPSREP-1,MXTRTQ                                                
         MVI   REEPSTRF-1,MXTRTQ                                                
         MVI   REEPSSTA-1,MXTRTQ                                                
         MVI   REEPSSP-1,MXTRTQ                                                 
         MVI   REEPSESP-1,MXTRTQ                                                
         MVI   REEPSSTT-1,MXTRTQ                                                
         MVI   REEPSADT-1,MXTRTQ                                                
         MVI   REEPSRTS-1,MXTRTQ                                                
         MVI   REEPSDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REEPSREP,REO4KREP   REP COMPANY                                  
         TR    REEPSREP,MXTRT                                                   
*                                                                               
         LA    RF,REOPEQUV                                                      
*                                                                               
         MVI   REEPSTRF,C'B'                                                    
         LA    RE,0                SET D(EQV ALIGN): BIAS/ENT/VCI               
         CLI   REO4KSYS,1          BIAS SYSTEM?                                 
         BE    REEPS010            YES                                          
         MVI   REEPSTRF,C'E'                                                    
         CLI   REO4KSYS,3          ESG  SYSTEM?                                 
         BE    REEPS010            YES                                          
         MVI   REEPSTRF,C'V'                                                    
         CLI   REO4KSYS,5          VCI  SYSTEM?                                 
         BE    REEPS010            YES                                          
         LA    RE,3                SET D(EQV ALIGN): COLUMBINE                  
         MVI   REEPSTRF,C'C'                                                    
         CLI   REO4KSYS,4          COLUMBINE  ?                                 
         BE    REEPS010            YES                                          
         LA    RE,2                SET D(EQV ALIGN): COLUMBINE                  
         MVI   REEPSTRF,C'J'                                                    
         CLI   REO4KSYS,2          JDS  SYSTEM?                                 
         BE    REEPS010            YES                                          
         DC    H'0'                UNKNOWN TRAFFIC SYSTEM                       
REEPS010 EQU   *                                                                
         AR    RF,RE               CALC 1ST CHAR TO MOVE                        
         LNR   RE,RE               NEGATE DISPLACEMENT                          
         LA    RE,6(RE)            CALC L(MOVE)                                 
*                                                                               
         TR    REEPSTRF,MXTRT                                                   
         MVC   REEPSSTA,REO4KSTA   STATION                                      
         TR    REEPSSTA,MXTRT                                                   
         MVC   REEPSSP,REO4KCOD    DDS S/P CODE                                 
         TR    REEPSSP,MXTRT                                                    
         EX    RE,REEPS012                                                      
         B     REEPS014                                                         
REEPS012 EQU   *                                                                
         MVC   REEPSESP(0),0(RF)   MOVE CODE BY LENGTH                          
REEPS014 EQU   *                                                                
         TR    REEPSESP,MXTRT                                                   
         MVI   REEPSSTT,C'N'       SET STATUS = NOT ACTIVE                      
         TM    REOPFLAG,X'80'      ACTIVE?                                      
         BNO   REEPS020            NO                                           
         MVI   REEPSSTT,C'Y'       SET STATUS = ACTIVE                          
REEPS020 EQU   *                                                                
*                                                                               
*   SEND NULLS FOR ACTIVITY DATE                                                
*                                                                               
****>>>  GOTO1 DATCON,PLIST,(3,REOPDATE),(10,REEPSADT)                          
         TR    REEPSADT,MXTRT                                                   
***      MVC   REEPSRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REEPSRTS(14),=C'19000101000000'                                  
         TR    REEPSRTS,MXTRT                                                   
*                                                                               
         MVI   REEPSDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REEPSDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
REEPSLIT DC    A(LITERAL)                                                       
REEPSEQV DS    A                                                                
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
****>>>::  EOP SALESPERSON                                                      
****++++   BUY CODE DATA                                                        
***********************************************************************         
* REPBCDC - EXTRACT BUY CODE DATA                                               
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ACCFILE RECORD)                                               *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
REPBCDC  NMOD1 WORKL,*REPBCD*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,REBCDLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING REBCDD,R2           R2=A(EXTRACT RECORD)                         
         USING RSPBREC,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    REBCDLEN,REBCDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   REBCDLEN(2),=AL2(REBCDDL)                                        
         MVC   REBCDTYP,REPBCDQ                                                 
         MVI   REBCDDX,MXTRTQ                                                   
         MVI   REBCDDX+1,MXTRTQ                                                 
         MVI   REBCDREP-1,MXTRTQ                                                
         MVI   REBCDRTY-1,MXTRTQ                                                
         MVI   REBCDCOD-1,MXTRTQ                                                
         MVI   REBCDDES-1,MXTRTQ                                                
         MVI   REBCDTY1-1,MXTRTQ                                                
         MVI   REBCDTY2-1,MXTRTQ                                                
         MVI   REBCDTY3-1,MXTRTQ                                                
         MVI   REBCDDTE-1,MXTRTQ                                                
         MVI   REBCDDTC-1,MXTRTQ                                                
         MVI   REBCDLUI-1,MXTRTQ                                                
         MVI   REBCDRTS-1,MXTRTQ                                                
         MVI   REBCDDEL-1,MXTRTQ                                                
*                                                                               
         MVC   REBCDREP,RSPBKREP   REP COMPANY                                  
         TR    REBCDREP,MXTRT                                                   
         MVI   REBCDRTY,C'T'       SET RECORD TYPE CODE TO 'T'                  
         CLI   RSPBKTCD,0          'TYPE' RECORD?                               
         BE    RBCD0020            YES - LEAVE 'T'                              
         MVI   REBCDRTY,C'C'       NO  - SET RECORD TYPE CODE TO 'C'            
RBCD0020 EQU   *                                                                
         MVC   REBCDCOD,RSPBKCOD   TERRITORY CODE                               
         OC    REBCDCOD,SPACES     OR IN SPACES                                 
         TR    REBCDCOD,MXTRT                                                   
         MVC   REBCDDES,RSPBDESC   DESCRIPTION                                  
         OC    REBCDDES,SPACES     OR IN SPACES                                 
         TR    REBCDDES,MXTRT                                                   
         MVC   REBCDTY1,RSPCTYPS   SET FIRST ATTRIBUTE TYPE                     
         OC    REBCDTY1,SPACES     OR IN SPACES                                 
         TR    REBCDTY1,MXTRT                                                   
         MVC   REBCDTY2,RSPCTYPS+2 SET SECOND ATTRIBUTE TYPE                    
         OC    REBCDTY2,SPACES     OR IN SPACES                                 
         TR    REBCDTY2,MXTRT                                                   
         MVC   REBCDTY3,RSPCTYPS+4 SET THIRD  ATTRIBUTE TYPE                    
         OC    REBCDTY3,SPACES     OR IN SPACES                                 
         TR    REBCDTY3,MXTRT                                                   
         MVC   REBCDLUI,RSPBLUID   SET LUID                                     
         OC    REBCDLUI,SPACES     OR IN SPACES                                 
         TR    REBCDTY3,MXTRT                                                   
         GOTO1 DATCON,PLIST,(3,RSPBODAT),(10,REBCDDTE)                          
         TR    REBCDDTE,MXTRT                                                   
         GOTO1 DATCON,PLIST,(3,RSPBCDAT),(10,REBCDDTC)                          
         TR    REBCDDTC,MXTRT                                                   
*                                                                               
***      MVC   REBCDRTS,SPACES        SET REFRESHTS DEFAULT                     
         MVC   REBCDRTS(14),=C'19000101000000'                                  
         TR    REBCDRTS,MXTRT                                                   
*                                                                               
         MVI   REBCDDEL,C' '          SET DELETE FLAG DEFAULT                   
         TR    REBCDDEL,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
REBCDLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
****++++   BUY CODE DATA                                                        
*+++++>>>>>                                                                     
***********************************************************************         
* SETUPMON - SETUP RRG STYLE DATE TABLES FOR CONTRACT BUCKETING       *         
*                                                                     *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
SETUPMON NMOD1 WORKL,*SMON*,CLEAR=Y                                             
         USING WORKD,RC                                                         
         L     RA,SMONLIT                                                       
         USING LITERAL,RA                                                       
         L     R9,SMONQWK                                                       
         USING QWKD,R9                                                          
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         L     R8,0(R1)            A(DXUSER)                                    
         USING RXUSERD,R8                                                       
         MVC   FULLFLAG,RXFULLYR   SAVE FULL-YEAR DATA FLAG                     
*                                  ALSO INDICATES AGGREGATE DATA                
*                                     REQUESTED FOR RUN                         
         CLI   FULLFLAG,C'1'       CHECK FOR YEAR ADJUSTMENT 1 - 7              
         BL    SMON0020            NOT A YEAR ADJUSTMENT                        
         MVC   YRADJUST,RXFULLYR   SAVE YEAR ADJUSTMENT                         
         NI    YRADJUST,X'0F'      TURN OFF ZONE BITS                           
         MVI   FULLFLAG,C'Y'       ADJUSTMENT: SET TO FULL DATA                 
SMON0020 EQU   *                                                                
*                                                                               
         MVC   ASATDATE,RXTODAY    SAVE AS-AT DATE OVERRIDE                     
*                                                                               
*   USE EITHER AS-AT DATE OVERRIDE OR 'TODAY'S DATE' TO SET RXUCUR***           
*        VALUES TO NEXT YEAR                                                    
*                                                                               
         CLC   RXTODAY,SPACES      ANY AS-AT OVERRIDE?                          
         BNH   SMON0022            NO                                           
         GOTO1 DATCON,PLIST,(0,RXTODAY),(3,WORK+24)                             
*                                  YES  - CONVERT TO 3-CHAR BINARY              
         B     SMON0024                                                         
SMON0022 EQU   *                                                                
         GOTO1 DATCON,PLIST,(5,WORK),(3,WORK+24)                                
*                                  GET TODAY'S DATE IN 3-CHAR BINARY            
SMON0024 EQU   *                                                                
         ZIC   RF,WORK+24          GET YEAR BYTE                                
         LA    RF,1(RF)            BUMP TO NEXT YEAR                            
         STC   RF,WORK+24                                                       
         MVC   WORK+25(2),=X'0101' SET TO JANUARY 01 / NEXT YEAR                
         GOTO1 DATCON,PLIST,(3,WORK+24),(20,WORK)                               
         MVC   RXUCURST(8),WORK    LOAD JANUARY START DATE                      
         MVI   WORK+25,12          SET MONTH TO DECEMBER                        
         GOTO1 DATCON,PLIST,(3,WORK+24),(20,WORK)                               
         MVC   RXUCURND(8),WORK    LOAD DECEMBER START DATE                     
*                                                                               
*   THIS OVERRIDES WHATEVER IS ON THE INPUT CARDS                               
*                                                                               
         GOTO1 DATCON,PLIST,(9,RXUCURST),(3,WORK)                               
         MVC   QWCURST,WORK        NO DAY IN REQUEST DATE                       
*                                                                               
         GOTO1 DATCON,PLIST,(9,RXUCURND),(3,WORK)                               
         MVC   QWCURND,WORK        NO DAY IN REQUEST DATE                       
*                                                                               
         GOTO1 DATCON,PLIST,(9,RXUCURST),(0,WORK+3)                             
         GOTO1 VADDAY,PLIST,(C'Y',WORK+3),(0,WORK+3),-1                         
         GOTO1 DATCON,PLIST,(0,WORK+3),(3,WORK)                                 
         MVC   QWPRIST,WORK        NO DAY IN REQUEST DATE                       
*                                                                               
         GOTO1 DATCON,PLIST,(9,RXUCURND),(0,WORK+3)                             
         GOTO1 VADDAY,PLIST,(C'Y',WORK+3),(0,WORK+3),-1                         
         GOTO1 DATCON,PLIST,(0,WORK+3),(3,WORK)                                 
         MVC   QWPRIND,WORK        NO DAY IN REQUEST DATE                       
*&&DO                                                                           
*   TEST DUMP                                                                   
         LA    R0,1                                                             
         LA    RF,RXUCURST                                                      
         DC    H'0'                                                             
*&&                                                                             
*                                                                               
         BRAS  RE,ASATPROC         SET UP AS-AT DATES                           
*                                                                               
*   MAKE A SPECIAL CALL TO CALCULATE LAST WEEK DATE FROM FIRST                  
*        DATE IN THE QWMONFOR TABLE                                             
*                                                                               
         GOTO1 DATCON,DMCB,(2,QWMONFOR),(0,WORK+48)                             
         LA    R3,7                BACK UP ONE WEEK                             
         LNR   R3,R3                                                            
         GOTO1 VADDAY,DMCB,WORK+48,WORK+54,(R3)                                 
*                                                                               
         GOTO1 DATCON,DMCB,(0,WORK+54),(2,QWLASTWK)                             
*                                                                               
*   TEST DUMP                                                                   
***      LA    RF,QWMONFOR                                                      
***      LA    R0,1                                                             
***      DC    H'0'                                                             
*   TEST DUMP                                                                   
*                                                                               
         LA    R4,QWMONINF         BUILD MONTHLY INFO LIST                      
         SR    R5,R5                                                            
         XC    QWMONINF,QWMONINF                                                
         MVC   WORK(2),QWCURST                                                  
         MVC   WORK+2(2),QWPRIST                                                
         MVI   WORK+1,1            ALWAYS START FROM JAN                        
         MVI   WORK+3,1                                                         
*                                                                               
         MVC   WORK+4(2),QWPRIST   CALCULATE 2 YEARS PRIOR                      
         IC    R5,WORK+4                                                        
         BCTR  R5,0                DECREMENT PRIOR YEAR BY 1                    
         STC   R5,WORK+4                                                        
         MVC   WORK+6(2),QWCURST   CALCULATE NEXT YEAR                          
         IC    R5,WORK+6                                                        
         LA    R5,1(R5)            ADD 1 YEAR TO CURRENT YEAR                   
         STC   R5,WORK+6                                                        
*                                                                               
SMON0100 MVC   0(2,R4),WORK        CURRENT YEAR/MO                              
         MVC   2(2,R4),WORK+2      PRIOR YEAR/NO                                
         MVC   4(2,R4),WORK+4      2 YEAR PRIOR YEAR/MO                         
         MVC   6(2,R4),WORK+6      NEXT YEAR                                    
         CLI   WORK+1,12           IS IT DECEMBER?                              
         JL    SMON0110            NO                                           
         MVI   WORK+3,1            SET PRIOR YEAR MONTH = JAN                   
         MVC   WORK+4(2),WORK+2    SET 2 YEAR PRIOR= PRIOR JAN                  
         MVI   WORK+1,1            SET CURRENT YEAR MONTH = JAN                 
         MVC   WORK+2(2),WORK      SET PRIOR YEAR = CURRENT JAN                 
         IC    R5,WORK             ADD 1 TO CURRENT YEAR                        
         LA    R5,1(R5)                                                         
         STC   R5,WORK                                                          
         MVI   WORK+7,1            SET NEXT YEAR MONTH = JAN                    
         IC    R5,WORK+6           ADD 1 TO NEXT YEAR                           
         LA    R5,1(R5)                                                         
         STC   R5,WORK+6                                                        
         J     SMON0120                                                         
*                                                                               
SMON0110 IC    R5,WORK+1           NO - INCREMENT THE MONTH                     
         LA    R5,1(R5)                                                         
         STC   R5,WORK+1                                                        
         STC   R5,WORK+3                                                        
         STC   R5,WORK+5                                                        
         STC   R5,WORK+5                                                        
*                                                                               
SMON0120 CLC   QWCURND,WORK        HAVE WE PASSED PERIOD END                    
         JL    SMON0130                                                         
         LA    R4,8(R4)                                                         
         J     SMON0100                                                         
*                                                                               
SMON0130 EQU   *                                                                
         BRAS  RE,SETMONTB                                                      
*                                                                               
         CLI   FULLFLAG,C'Y'       GENERATING ALL DATA?                         
         BNE   SMON0200            NO                                           
         CLI   YRADJUST,1          YES - ADJUST BY 1 YR OR LESS?                
         BNH   SMON0200            YES - NO ADJUSTMENT                          
         ZIC   RF,QWCURST          NO  - ADJUST START DATE                      
         ZIC   RE,YRADJUST         SET ADJUSTMENT FACTOR                        
*                                                                               
*                                                                               
****>>   BCTR  RE,0                MAKE ZERO RELATIVE                           
         SR    RF,RE               SUBTRACT ADJUSTMENT FACTOR                   
         STC   RF,QWCURST                                                       
*&&DO                                                                           
*   TEST                                                                        
         LA    R0,8                                                             
         LA    RF,QWCURST                                                       
         DC    H'0'                                                             
*   TEST END                                                                    
*&&                                                                             
SMON0200 EQU   *                                                                
         J     EXIT                                                             
         LTORG                                                                  
         SPACE 3                                                                
SMONLIT  DC    A(LITERAL)                                                       
SMONQWK  DC    V(RXQWK)                                                         
         EJECT                                                                  
***********************************************************************         
*  THIS ROUTINE SETS 'FORECAST' DATE BUCKETS USING AS AT DATES.  IF             
*     AN AS-AT TO-DATE HAS BEEN ENTERED, INDICATING A REQUEST FOR               
*     AS-AT RANGE TESTING, FOUR ADDITIONAL DATES ARE GENERATED.                 
*----------------------------------------------------------------------         
ASATPROC NTR1  BASE=*,LABEL=*                                                   
         XC    QWMONFOR(16),QWMONFOR INITIALIZE MONTH FCST TABLE                
         GOTO1 DATCON,PLIST,(5,0),(0,WORK)                                      
*                                                                               
         CLI   ASATDATE,C' '       DATE OVERRIDE?                               
         BNH   *+10                NO                                           
         MVC   WORK(6),ASATDATE                                                 
*                                                                               
         MVC   WORK+36(6),WORK     USE WORK+36 TO SET DR CUTOFF                 
         BRAS  RE,DRCUTOFF         SET DR CUTOFF                                
*                                                                               
*   SET 'CURRENT AS-AT DATE' (FROM), AND THREE DATES BASED ON IT                
*                                                                               
         GOTO1 SET4DATS,PLIST,QWMONFOR,0                                        
         J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*  THIS ROUTINE SETS THE DIRECT RESPONSE CUTOFF DATE:                           
*        DATE OF RUN IS ADJUSTED:                                               
*              IF DATE OF RUN IS WEDNESDAY, DATE IS USED AS IS                  
*              IF DATE OF RUN IS NOT WEDNESDAY, FOLLOWING                       
*                 WEDNESDAY IS CALCULATED, AND ITS DATE USED.                   
*        IF AS-AT DATE, AS CALCULATED ABOVE, IF AFTER 14TH OF MONTH,            
*              CURRENT YEAR/MONTH IS SET, ELSE PREVIOUS IS SET                  
*----------------------------------------------------------------------         
DRCUTOFF NTR1  BASE=*,LABEL=*                                                   
         MVC   WORK+42(6),WORK+36                                               
         GOTO1 VGETDAY,PLIST,WORK+42,FULL                                       
*                                  GET DAY OF WEEK                              
         CLI   PLIST,3             IS RUNDATE WEDNESDAY?                        
         JE    DRCU0060            YES - USE IT FOR CUTOFF TEST                 
         L     RF,=A(WEDADJST)                                                  
DRCU0010 EQU   *                                                                
         CLI   0(RF),0             END OF TABLE?                                
         JNE   *+6                                                              
         DC    H'0'                DAY NOT FOUND                                
         CLC   PLIST(1),0(RF)      DAY OF WEEK VS TABLE                         
         JE    DRCU0020            FOUND                                        
         LA    RF,5(RF)            BUMP TO NEXT ENTRY                           
         J     DRCU0010            GO BACK FOR NEXT                             
DRCU0020 EQU   *                                                                
         ZICM  R3,1(RF),4          GET DAY ADJUSTMENT TO WED                    
         GOTO1 VADDAY,PLIST,WORK+42,WORK+36,(R3)                                
DRCU0060 EQU   *                                                                
         GOTO1 DATCON,PLIST,(0,WORK+36),(3,WORK+42)                             
*                                  CONVERT DATE TO BINARY YMD                   
         CLI   WORK+44,X'0F'       DAY 15TH OR AFTER?                           
         JL    DRCU0080            NO  - SET PREVIOUS MONTH                     
         MVC   QWDRCOFF,WORK+42    YES - SAVE YM OF AS-AT DATE                  
         J     DRCU0160            EXIT                                         
DRCU0080 EQU   *                   SET PREVIOUS MONTH                           
         CLI   WORK+43,1           IS MONTH JANUARY?                            
         JE    DRCU0100            YES                                          
         ZIC   RF,WORK+43          NO  - DECREMENT 1 MONTH                      
         BCTR  RF,0                                                             
         STC   RF,WORK+43          REINSERT MONTH                               
         MVC   QWDRCOFF,WORK+42    SAVE YM OF AS-AT DATE                        
         J     DRCU0160            EXIT                                         
DRCU0100 EQU   *                                                                
         MVI   WORK+43,12          JANUARY: OVERLAY WITH DECEMBER               
         ZIC   RF,WORK+42          DECREMENT YEAR BY 1                          
         BCTR  RF,0                                                             
         STC   RF,WORK+42                                                       
         MVC   QWDRCOFF,WORK+42    SAVE YM OF AS-AT DATE                        
         J     DRCU0160            EXIT                                         
DRCU0160 EQU   *                                                                
         MVC   QWDRCOFP,QWDRCOFF   SET PRIOR YEAR CUTOFF                        
         ZIC   RF,QWDRCOFP         BACK UP 1 YEAR                               
         BCTR  RF,0                                                             
         STC   RF,QWDRCOFP         RESTORE YEAR                                 
         CLI   QWDRCOFP,96         LEAP YEAR?  1996                             
         JE    DRCU0180            YES - ANY DATE OKAY                          
         CLI   QWDRCOFP,100        LEAP YEAR?  2000                             
         JE    DRCU0180            YES - ANY DATE OKAY                          
         CLI   QWDRCOFP,104        LEAP YEAR?  2004                             
         JE    DRCU0180            YES - ANY DATE OKAY                          
         CLI   QWDRCOFP,108        LEAP YEAR?  2008                             
         JE    DRCU0180            YES - ANY DATE OKAY                          
         CLI   QWDRCOFP,112        LEAP YEAR? 2112                              
         JE    DRCU0180            YES - ANY DATE OKAY                          
         CLC   QWDRCOFP+1(2),=X'021D'                                           
*                                  NO  - FEB 29?                                
         JNE   DRCU0180            NO  - OKAY                                   
         MVC   QWDRCOFP+1(2),=X'021C'                                           
*                                  YES - SET TO FEB 28                          
DRCU0180 EQU   *                                                                
         XC    WORK+36(20),WORK+36 CLEAR THE WORK AREA                          
         J     EXIT                                                             
         LTORG                                                                  
*---------------------------------------------------------------------          
*                                                                               
*   WEDNESDAY ADJUSTMENT TABLE:  EACH ENTRY IS TWO CHARACTERS                   
*        CHAR 1:  DAY OF WEEK                                                   
*        CHAR 2:  ADJUSTMENT VALUE  - SUN THRU TUESDAY ADJUST                   
*                                     THU THRU SATURDAY DON'T                   
*---------------------------------------------------------------------          
WEDADJST DC    X'01',X'00000002'         MONDAY                                 
         DC    X'02',X'00000001'         TUESDAY                                
         DC    X'04',X'FFFFFFFF'         THURSDAY - BACK UP 1 DAY               
         DC    X'05',X'FFFFFFFE'         FRIDAY   - BACK UP 2 DAYS              
         DC    X'06',X'00000004'         SATURDAY                               
         DC    X'07',X'00000003'         SUNDAY                                 
         DC    X'0000'                                                          
         EJECT                                                                  
**********************************************************************          
*  THIS ROUTINE SETS THE SET OF FOUR DATES FOR AS-AT PROCESSING.                
*---------------------------------------------------------------------          
SET4DATS NTR1  BASE=*,LABEL=*                                                   
         L     R6,0(R1)            RESET A(TABLE ENTRIES)                       
         GOTO1 DATCON,PLIST,(0,WORK),(2,(R6))                                   
         LA    R6,2(R6)            A(PRIOR AS-AT DATE)                          
*                                                                               
* GET BROADCAST YEAR OF AS-AT DATE:  MAY NOT BE SAME - IE:                      
*    DEC30/91 IS BROADCAST YEAR 02.  (CHECK THE CALENDAR).                      
*    TAKE THE YEAR FROM THE TO-DATE PORTION, FOR SAME REASON.                   
*                                                                               
         GOTO1 GETBROAD,PLIST,WORK,WORK+12                                      
         MVC   WORK+6(2),WORK+18   CALCULATE START BDCST YEAR                   
         MVC   WORK+8(4),=C'0115'  SET JAN15 OF YEAR                            
         GOTO1 GETBROAD,PLIST,WORK+6,WORK+12                                    
*                                                                               
*  CALCULATE WEEK # FROM BDCAST YEAR START THRU CURR AS AT DATE                 
*                                                                               
         GOTO1 =V(PERVERT),PLIST,WORK+12,WORK                                   
         ZICM  RF,PLIST+12,2       SAVE WEEK# OF CURR AS AT DATE                
         OC    PLIST+10(2),PLIST+10 ANY PERVERT DAYS REMAINING?                 
         JNZ   SETD0040            YES - DON'T ADJUST WEEK #                    
         BCTR  RF,0                NO  - DECREMENT WEEK #                       
SETD0040 EQU   *                                                                
         CLI   RXASATWK,C'B'       DECREMENT WEEK                               
         JNE   SETD0042                                                         
         BCTR  RF,0                                                             
SETD0042 EQU   *                                                                
         CLI   RXASATWK,C'F'       INCREMENT WEEK                               
         JNE   SETD0044                                                         
         LA    RF,1(RF)                                                         
SETD0044 EQU   *                                                                
         STCM  RF,3,WORK+32        SAVE WEEK# OF CURR AS AT DATE                
         GOTO1 DATCON,PLIST,(0,WORK+6),(3,DOUBLE)                               
         ZIC   RF,DOUBLE           EXTRACT YEAR FROM DATE                       
         BCTR  RF,0                SUBTRACT 1 FROM YEAR                         
         STC   RF,DOUBLE           PUT YEAR BACK                                
         GOTO1 DATCON,PLIST,(3,DOUBLE),(0,WORK+6)                               
         GOTO1 SETASAT,PLIST,(R6),0                                             
*                                                                               
         LA    R6,2(R6)            A(2YR PRIOR AS AT DATE)                      
         GOTO1 DATCON,PLIST,(0,WORK+6),(3,DOUBLE)                               
         ZIC   RF,DOUBLE           EXTRACT YEAR FROM DATE                       
         BCTR  RF,0                SUBTRACT 1 FROM YEAR                         
         STC   RF,DOUBLE           PUT YEAR BACK                                
         GOTO1 DATCON,PLIST,(3,DOUBLE),(0,WORK+6)                               
*                                                                               
         GOTO1 SETASAT,PLIST,(R6),0                                             
         GOTO1 DATCON,PLIST,(0,WORK+6),(3,DOUBLE)                               
         ZIC   RF,DOUBLE           EXTRACT YEAR FROM DATE                       
         LA    RF,3(RF)            ADD 3:  CALCULATE NEXT YEAR                  
*                                                                               
         STC   RF,DOUBLE           PUT YEAR BACK                                
         GOTO1 DATCON,PLIST,(3,DOUBLE),(0,WORK+6)                               
         LA    R6,2(R6)            A(NEXT YEAR AS AT DATE)                      
         GOTO1 SETASAT,PLIST,(R6),0                                             
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
*  THIS ROUTINE CALCULATES THE MONDAY DATE OF THE NTH WEEK OF THE               
*     BROADCAST YEAR                                                            
*---------------------------------------------------------------------          
SETASAT  NTR1                                                                   
         L     R6,0(R1)            RESET A(MONFORC TABLE ENTRY)                 
         GOTO1 GETBROAD,PLIST,WORK+6,WORK+12                                    
         ZICM  R2,WORK+32,2        INSERT WEEK# OF CURRENT DATE                 
*                                                                               
*   WEEK # IS UNDERSTATED BY 1.  DAYS 1-7 ARE WEEK 1, BUT PERVERT               
*    CALCULATION RETURNS 0.                                                     
*                                                                               
         CHI   R2,52               IS CURRENT WEEK # 53?                        
         JNE   SASA0004            NO                                           
         BCTR  R2,0                YES - SET IT TO 52 FOR OTHER YEARS           
SASA0004 EQU   *                                                                
         MHI   R2,7                MULT BY 7 = # OF DAYS                        
         GOTO1 VADDAY,PLIST,WORK+12,WORK+18,(R2)                                
*                                                                               
* GET THE DAY NUMBER FOR THE CURRENT AS-AT DATE                                 
*                                                                               
         GOTO1 VGETDAY,PLIST,WORK,FULL                                          
         CLC   FULL(3),SPACES                                                   
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         SR    R2,R2               ADD BACK DAY NUMBER                          
         IC    R2,PLIST            SO ITS THE CORRECT DAY OF WK                 
         BCTR  R2,0                                                             
         GOTO1 VADDAY,PLIST,WORK+18,WORK+18,(R2)                                
*                                                                               
*   FINAL CALL INSERTS MONDAY DATE OF WEEK# INTO MONFOR TABLE                   
*                                                                               
         GOTO1 DATCON,PLIST,(0,WORK+18),(2,(R6))                                
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
**********************************************************************          
*   ROUTINE TO USE OVERALL REQUEST DATES TO ESTABLISH A SINGLE                  
*     MONTH TABLE FOR ALL REPORTS.                                              
* !!!   NOTE    !!!                                                             
*       IF START AND END DATES ARE MORE THAN 6 YEARS APART (72 MOS)             
*       THERE IS A PROBLEM:  TABLE WON'T HANDLE THIS RANGE.  72 MOS,            
*       BEGINNING WITH JANUARY OF THE EARLIEST YEAR REQUESTED, WILL             
*       BE LOADED, AND THE REMAINDER WILL FALL INTO NEVER-NEVER LAND.           
*                                                                               
SETMONTB NTR1  BASE=*,LABEL=*                                                   
         LHI   RF,NEWMONL          L(NEW MONTH TABLE)                           
         L     RE,XNEWMON          A(NEW MONTH TABLE)                           
         XCEFL                                                                  
*                                                                               
*  SET THE ADDRESS OF CONTRACT SPECIFIC INFORMATION INTO THE MIS-               
*    CELLANEOUS STORAGE AREA JUST PRECEDING THE NEW MONTH TABLE.                
*    THIS SERVES AS A FLAG TO VALUENEW TO EXTRACT DATA.                         
*                                                                               
         L     R4,XNEWMON          A(NEW MONTH TABLE)                           
         AHI   R4,-CONSPINF        SET A(CONTRACT SPECIFIC INFO )               
         XC    0(4,R4),0(R4)       LOAD A(CONTRACT SPEC INFO)                   
         ST    RE,0(R4)                                                         
*                                                                               
         L     R4,XNEWMON          RESET A(NEW MONTH TABLE)                     
*        MVC   0(6,R4),SVQSTART    LOAD EARLIEST DATE                           
         GOTO1 DATCON,PLIST,(9,RXUCURST),(0,0(R4))                              
         MVC   2(4,R4),=C'0101'    SET EARLIEST DATE TO JAN/1                   
         LHI   R5,(NEWMONL/NEXTBUCK)-1     # BUCKETS, 1ST LOADED                
SETM0004 EQU   *                                                                
**       CLC   0(4,R4),SVQEND      ALL DATES LOADED?                            
**       BE    SETM0008            YES - NOW SEED OTHER DATES                   
         LA    R6,NEXTBUCK(R4)     SET A(NEXT DATE ENTRY)                       
         GOTO1 VADDAY,DMCB,(R4),(R6),45    CALC MIDDLE OF NEXT MONTH            
         MVC   4(2,R6),=C'01'      SET DAY OF NEXT MONTH                        
         LR    R4,R6                                                            
         BCT   R5,SETM0004         DO NEXT DATE                                 
SETM0008 EQU   *                                                                
         L     R4,XNEWMON          RESET START OF TABLE                         
         MVC   WORK(2),QWCURST     CURRENT START DATE (2-BYTE)                  
         MVC   WORK+1(1),=X'01'    SET MONTH TO 'JAN'                           
SETM0012 EQU   *                                                                
         MVC   CURDATE(2,R4),WORK  SET CURRENT START DATE                       
         ZIC   RF,WORK                                                          
         BCTR  RF,0                DECREMENT YEAR BY 1                          
         STC   RF,WORK             TO CALCULATE PRIOR YEAR                      
         MVC   PRIDATE(2,R4),WORK  SET PRIOR DATE                               
         BCTR  RF,0                SUBTRACT ANOTHER TO CALCULATE                
         STC   RF,WORK             2 YEARS PRIOR                                
         MVC   PRI2DATE(2,R4),WORK       SET 2 YEARS PRIOR                      
         LA    RF,3(RF)            CALCULATE NEXT YEARS DATE                    
         STC   RF,WORK                                                          
         MVC   NEXTDATE(2,R4),WORK SET NEXT YEARS DATE                          
         CLI   WORK+1,12           IS IT DECEMBER?                              
         BL    SETM0016            NO                                           
**       MVI   WORK+1,1            YES - SET MONTH TO JAN                       
*                                  YEAR IS ALREADY SET TO NEXT YEAR             
SETM0016 EQU   *                                                                
         BCTR  RF,0                DECREMENT NEXT YEAR TO THIS YEAR             
         STC   RF,WORK             RESET YEAR TO CURRENT                        
         ZIC   RF,WORK+1           INCREMENT MONTH                              
         LA    RF,1(RF)                                                         
         STC   RF,WORK+1           RESTORE NEW MONTH                            
*                                                                               
         CLC   QWCURND,WORK        END REACHED?                                 
         BL    SETM0024            YES                                          
         LA    R4,NEXTBUCK(R4)     NO  - NEXT TABLE ENTRY                       
         B     SETM0012            GO BACK AND DO NEXT                          
SETM0024 EQU   *                                                                
         J     EXIT                                                             
XNEWMON  DC    A(NEWMON)           NEWMON TABLE                                 
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* LITERALS AND CONSTANTS REQUIRED FOR ALL ROUTINES                    *         
***********************************************************************         
         SPACE 1                                                                
LITERAL  DS    0D                                                               
GETBROAD DC    V(GETBROAD)                                                      
DATCON   DC    V(DATCON)                                                        
VGETDAY  DC    V(GETDAY)                                                        
VADDAY   DC    V(ADDAY)                                                         
VLOADER  DC    V(LOADER)                                                        
COMFACS  DC    V(COMFACS)                                                       
VREGENBC DC    V(REGENBUC)                                                      
VALU5NEW DC    V(VALU5NEW)                                                      
DEMOCON  DC    A(0)                                                             
ANEXT    DC    F'0'                                                             
SEQCTR   DS    F                   SEQUENCE COUNTER                             
SAVCMDES DS    A                   A(OFFICE CMMT DESCRIPTIVE ELEMENT)           
WEEKSTRT DC    XL2'00'             COMPRESSED WEEK START DATE                   
WEEKEND  DC    XL2'00'             COMPRESSED WEEK END   DATE                   
ASATDATE DC    CL6'      '         AS-AT DATE OVERRIDE                          
FULLFLAG DC    C'N'                FULLYEAR DATA FLAG: DEF = N                  
*                                  C'Y' = FULLYEAR DATA WANTED                  
*                                  C'A' = AGGREGATED EST /INV WANTED            
*                                  ANY OTHER: CHANGES ONLY                      
*                                                                               
YRADJUST DC    XL1'01'             DEFAULT YEAR ADJUSTMENT                      
*                                                                               
CLEARFLG DS    XL1                                                              
SPACES   DC    CL80' '                                                          
*                                                                               
*RXRECID                                                                        
       ++INCLUDE RXRECID12                                                      
*                                                                               
LOADER   ICM   RF,15,DEMOCON                                                    
         BNZR  RE                                                               
         NTR1  ,                                                                
         MVC   WORK,=CL8'T00AE0'                                                
         XC    PLIST(7*4),PLIST                                                 
         GOTO1 VLOADER,PLIST,WORK,0                                             
         MVC   DEMOCON,4(R1)                                                    
         J     EXIT                                                             
*                                                                               
*GETEL                                                                          
         GETEL R6,=Y(RCONELEM-RCONREC),ELCODE                                   
         SPACE 2                                                                
*MXTRT                                                                          
       ++INCLUDE MXTRT                                                          
*                                                                               
***********************************************************************         
*        GETMDAY ROUTINE RETURNS MONDAY DATE FOR WEEK GIVEN                     
*                INPUT = YYMMDD                                                 
*                OUTPUT= 2-BYTE BINARY                                          
*----------------------------------------------------------------------         
         SPACE                                                                  
GETMDAY  NTR1  BASE=*,LABEL=*                                                   
         LM    R5,R6,0(R1)         R5=A(INPUT), R6=A(OUTPUT)                    
*                                                                               
         CLC   0(6,R5),=C'980229' ****2YR PRIOR OF LEAP YR 00 ****              
         BE    GETM10                                                           
         CLC   0(6,R5),=C'990229' ****PRIOR YEAR FOR LEAP YR 00 ****            
         BE    GETM10                                                           
         CLC   0(6,R5),=C'010229' ****NEXT YEAR FOR LEAP YR 00 ****             
         BE    GETM10                                                           
         CLC   0(6,R5),=C'020229' ****2YR PRIOR OF LEAP YR 04 ****              
         BE    GETM10                                                           
         CLC   0(6,R5),=C'030229' ****PRIOR YEAR FOR LEAP YR 04 ****            
         BE    GETM10                                                           
         CLC   0(6,R5),=C'050229' ****NEXT YEAR FOR LEAP YR 04 ****             
         BE    GETM10                                                           
***NEW YEAR                                                                     
         CLC   0(6,R5),=C'060229' ****2YR PRIOR OF LEAP YR 08 ****              
         BE    GETM10                                                           
         CLC   0(6,R5),=C'070229' ****PRIOR YEAR FOR LEAP YR 08 ****            
         BE    GETM10                                                           
         CLC   0(6,R5),=C'090229' ****NEXT YEAR FOR LEAP YR 08 ****             
         BE    GETM10                                                           
         CLC   0(6,R5),=C'100229' ****2YR PRIOR OF LEAP YR 12 ****              
         BE    GETM10                                                           
         CLC   0(6,R5),=C'110229' ****PRIOR YEAR FOR LEAP YR 12 ****            
         BE    GETM10                                                           
         CLC   0(6,R5),=C'130229' ****NEXT YEAR FOR LEAP YR 12 ****             
         BNE   GETM12                                                           
***NEW YEAR                                                                     
GETM10   EQU   *                                                                
         MVC   3(3,R5),=C'301'     ***PREVIOUS YEAR MUST BE MARCH 01***         
GETM12   EQU   *                                                                
         GOTO1 VGETDAY,PLIST,(R5),FULL                                          
         CLC   FULL(3),SPACES                                                   
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         SR    RE,RE                                                            
         IC    RE,PLIST            DAY NUMBER                                   
         BCTR  RE,R0                                                            
         LNR   RE,RE                                                            
         ST    RE,PLIST+8          PUT IN NUMBER OF DAYS TO SUBTRACT            
*                                                                               
*   SET A PROFILE TEST HERE:  ONLY 'DAILY PACING' USERS SHOULD DO THE           
*        FOLLOWING RESET.  RIGHT NOW, EVERYONE WILL DO IT.                      
*                                                                               
         GOTO1 VADDAY,PLIST,(R5),DUB                                            
*                                                                               
         GOTO1 DATCON,(R1),DUB,(2,(R6))                                         
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         SPACE 3                                                                
         DC    CL8'BUFFER01'                                                    
BUFFER1  DC    25000XL8'00'        HOLDS RECORDS FOR WRITING TO FILE            
BUFFER1L EQU   *-BUFFER1                                                        
         DC    8X'FF'                                                           
         DC    CL8'*NEWMON*'                                                    
CONSPEC  DC    (64)X'00'                                                        
CONSPECX DC    (CONSPINF)X'00'                                                  
NEWMON   DC    (13*NEXTBUCK)X'00'  13 MONTH TABLE FOR VALU5NEW                  
NEWMONL  EQU   *-NEWMON                                                         
         DC    (NEXTBUCK)X'00'                                                  
*                                                                               
***********************************************************************         
* RRG/QWKD DATE AREA CSECT                                                      
***********************************************************************         
         DS    0L                                                               
         DC    CL16'**QWK*QWK**QWK**'                                           
RXQWK    CSECT                                                                  
         DC    (QWEND-QWKD)X'00'                                                
         EJECT                                                                  
***********************************************************************         
* WORKING STORAGE REQUIREMENTS                                        *         
***********************************************************************         
         SPACE 1                                                                
WORKD    DSECT                                                                  
BLOCK7   DS    3F                  BLOCK FOR VALU5 CALL                         
DUB      DS    D                                                                
DOUBLE   DS    D                                                                
APARM    DS    A                   A(PARAMETER LIST)                            
*                                                                               
PARM     DS    0XL24               PARAMETER LIST                               
PARM1    EQU   0                                                                
PARM2    EQU   4                                                                
PARM3    EQU   8                                                                
PARM4    EQU   12                                                               
PARM5    EQU   16                                                               
PARM6    EQU   20                                                               
*                                                                               
AXREC    DS    A                   A(EXTRACT RECORD)                            
RFREC    DS    A                   A(REPFILE RECORD)                            
         DS    A                                                                
         DS    A                                                                
         DS    A                                                                
         DS    A                                                                
*                                                                               
DMCB     DS    0F                                                               
PLIST    DS    7F                                                               
ADCONLST DS    0A                  FORCE RESETVAL TO ASSEMBLE                   
VSPNDCTL DS    A                   USED BY RESETVAL TO FIND STATION REC         
ASTAREC  DS    A                                                                
ABUCKET  DS    A                                                                
FULL2    DS    F                                                                
FULL     DS    F                                                                
HALF     DS    H                                                                
ELCODE   DS    X                                                                
BYTE     DS    CL1                                                              
KILLMODE DS    C                                                                
FRSTPASS DS    C                                                                
*                                                                               
IOKEY    DS    CL64                                                             
IOKEYSAV DS    CL42                                                             
IOKEYSV2 DS    CL42                                                             
*                                                                               
WORK     DS    XL256                                                            
         DS    XL064               DBLOCK IS BUILT AT WORK+10 FOR 280           
EXWORK   DS    CL128                                                            
BUCKETS  DS    XL200                                                            
SAVLABLS DS    CL5                                                              
*                                                                               
ADCONSD  DS    0A                                                               
*                                                                               
PENDFORE DS    CL1                 P  = PENDING CONTRACT                        
*                                  F  = FORECAST CONTRACT                       
PEND04   DS    CL1                 4  =  INVOICE ELTS EXIST FOR ORDER           
THWKNEW  DS    CL1                 N  = ORDER ENTERED THIS WEEK                 
*                                  C  = ORDER ENTERED EARLIER                   
THISWEEK DS    CL2                 THIS WEEK'S MONDAY DATE                      
LASTWEEK DS    CL2                 THIS WEEK'S MONDAY DATE                      
BUCKFLGS DS    CL2                                                              
DMWORK   DS    12D                                                              
MYIO     DS    CL4096                                                           
WORKL    EQU   *-WORKD                                                          
         EJECT                                                                  
***********************************************************************         
* OTHER INCLUDED DSECTS                                               *         
***********************************************************************         
         SPACE 1                                                                
*RXUSERD                                                                        
       ++INCLUDE RXUSERD1                                                       
*RXRECD                                                                         
       ++INCLUDE RXRECD12                                                       
*DXDSECTS                                                                       
       ++INCLUDE DXDSECTS                                                       
*REGENALL1A                                                                     
*REGENDCT                                                                       
*REGENDSP                                                                       
*REGENAGY2                                                                      
*REGENSAL2                                                                      
*REGENOBUD                                                                      
*DEDBLOCK                                                                       
*FASYSFAC                                                                       
*REREPQWKDD                                                                     
*REREPRGEQB                                                                     
       ++INCLUDE REGENALL1A                                                     
       ++INCLUDE REGENDCT                                                       
       ++INCLUDE REGENDSP                                                       
       ++INCLUDE REGENAGY2                                                      
       ++INCLUDE REGENSAL2                                                      
       ++INCLUDE REGENOBUD                                                      
       ++INCLUDE REGENSET                                                       
       ++INCLUDE REGENSWI                                                       
       ++INCLUDE REGENCFC                                                       
       ++INCLUDE REGENOFF2                                                      
       ++INCLUDE REGENTER                                                       
       ++INCLUDE REGENCMT                                                       
       ++INCLUDE REGENOCM                                                       
       ++INCLUDE REGENEOP                                                       
       ++INCLUDE REGENSPEC                                                      
       ++INCLUDE DEDBLOCK                                                       
       ++INCLUDE FASYSFAC                                                       
       ++INCLUDE DMRCVRHDR                                                      
       ++INCLUDE REREPQWKDD                                                     
       ++INCLUDE REREPRGEQC                                                     
ARGDSECT DSECT                                                                  
ARGBLOCK DS    6F                  ARGUMENT BLOCK FOR VREPDOLC CALLS            
         ORG   ARGBLOCK                                                         
ARGDXBLK DS    A                                                                
ARGIOKEY DS    A                                                                
ARGRSTRT DS    A                                                                
         DS    2F                  SPARE                                        
ARGBYTES DS    F                                                                
         ORG   ARGBYTES                                                         
CONFPART DS    CL1                 CONFIRM / PARTIAL FLAG                       
         DS    CL3                 SPARE                                        
*&&DO                                                                           
**ADDRESSD BASED IN RXTRACT5 START                                              
*          DATA SET RXTRACT5   AT LEVEL 181 AS OF 11/14/05                      
***********************************************************************         
* DSECT TO COVER COMMON ADDRESSES - ALL ARGUMENTS HAVE BEEN SET UP    *         
*        IN RXTRACT.  THE ADDRESS OF THAT ARGUMENT STRING IS          *         
*        PASSED IN TO RXROUTS, AND THEN RESOLVED WITH THIS DSECT      *         
*                                                                     *         
*                                                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
ADDRESSD DSECT                                                                  
COMMON   DS    CL8                                                              
VDATAMG2 DS    V                                                                
VDMOD002 DS    V                                                                
VDADDS2  DS    V                                                                
VLOGIO   DS    V                                                                
VDATCON  DS    V                                                                
VREPCNVX DS    V                                                                
***PDACC DS    V                                                                
***PDTRC DS    V                                                                
VREPCONC DS    V          CONTRACT HEADER                                       
VREPDOLC DS    V          CONTRACT DOLLARS                                      
VREPAGYC DS    V          AGENCY                                                
VREPADVC DS    V          ADVERTISER                                            
VREPSALC DS    V          SALESPERSON                                           
VREPCTYC DS    V          CONTRACT TYPE                                         
VREPDCTC DS    V          DEV CONTRACT TYPE                                     
VREPSTAC DS    V          STATION                                               
VREPDSPC DS    V          DEV SALESPERSON                                       
VREPTEMC DS    V          TEAM                                                  
VREPPRDC DS    V          PRODUCT CODE                                          
VREPCLSC DS    V          CLASS                                                 
VREPCATC DS    V          CATEGORY                                              
VREPOFFC DS    V          OFFICE                                                
VREPOWNC DS    V          OWNER                                                 
VREPMKTC DS    V          MARKET                                                
VREPGRPC DS    V          GROUP/SUBGROUP                                        
VREPMSTC DS    V          SEE ME/READ ME SUB/MASTER RECORD                      
VREPREPC DS    V          REP INFO                                              
VREPBD1C DS    V          STATION BUDGET INFO                                   
VREPBD2C DS    V          OFFICE  BUDGET INFO                                   
VREPPTPC DS    V          POINT PERSON                                          
VREPSETC DS    V          SET CODES                                             
VREPSWIC DS    V          SWITCH CODES                                          
VREPCPTC DS    V          COMPETITIVE STATIONS                                  
VREPDPTC DS    V          DAYPART/CPP                                           
VREPLENC DS    V          LENGTH CODES                                          
VREPBKSC DS    V          BOOKS                                                 
VREPCCOC DS    V          CONFIRM COMMENT                                       
VREPSCMC DS    V          STANDARD COMMENT                                      
VREPOFCC DS    V          OFFICE   COMMENT                                      
VREPEAGC DS    V          EOP AGENCY                                            
VREPEADC DS    V          EOP ADVERT                                            
VREPEOFC DS    V          EOP OFFICE                                            
VREPESPC DS    V          EOP SALESPERSON                                       
VREPBCDC DS    V          BUYCODE                                               
VREPBUYC DS    V          BUY RECORD                                            
         SPACE 1                                                                
         DS    CL8                 COMMON INTERNAL ROUTINES                     
AACCLOAD DS    A                                                                
AACCUPDT DS    A                                                                
ADECIOC  DS    A                                                                
         DS    A                                                                
         DS    A                   SPARE                                        
AGETTYP  DS    A                                                                
AGETIT   DS    A                                                                
AREADHI  DS    A                                                                
ARECCMP  DS    A                                                                
         SPACE 1                                                                
         DS    CL8                 LOAD ROUTINES                                
ALOADCON DS    A          CONTRACT HEADER                                       
ALOADDOL DS    A          CONTRACT DOLLARS                                      
ALOADAGY DS    A          AGENCY                                                
ALOADADV DS    A          ADVERTISER                                            
ALOADSAL DS    A          SALESPERSON                                           
ALOADCTY DS    A          CONTRACT TYPE                                         
ALOADDCT DS    A          DEV CONTRACT TYPE                                     
ALOADSTA DS    A          STATION                                               
ALOADDSP DS    A          DEV SALESPERSON                                       
ALOADTEM DS    A          TEAM                                                  
ALOADPRD DS    A          PRODUCT CODE                                          
ALOADCLS DS    A          CLASS                                                 
ALOADCAT DS    A          CATEGORY                                              
ALOADOFF DS    A          OFFICE                                                
ALOADOWN DS    A          OWNER                                                 
ALOADMKT DS    A          MARKET                                                
ALOADGRP DS    A          GROUP/SUBGROUP                                        
ALOADMST DS    A          SEE ME/READ ME SUB/MASTER RECORD                      
ALOADREP DS    A          REP INFO                                              
ALOADBD1 DS    A          STATION BUDGET INFO                                   
ALOADBD2 DS    A          OFFICE  BUDGET INFO                                   
ALOADPTP DS    A          POINT PERSON                                          
ALOADSET DS    A          SET RECORD                                            
ALOADSWI DS    A          SWITCH RECORD                                         
ALOADCPT DS    A          COMPETITIVE STATIONS                                  
ALOADDPT DS    A          DAYPART/CPP                                           
ALOADLEN DS    A          LENGTH CODES                                          
ALOADBKS DS    A          BOOKS                                                 
ALOADCCO DS    A          CONFIRM COMMENTS                                      
ALOADSCM DS    A          STANDARD COMMENT                                      
ALOADOFC DS    A          OFFICE   COMMENT                                      
ALOADEAG DS    A          EOP AGENCY                                            
ALOADEAD DS    A          EOP ADVERT                                            
ALOADEOF DS    A          EOP OFFICE                                            
ALOADESP DS    A          EOP SALESPERSON                                       
ALOADBCD DS    A          BUYCODE                                               
ALOADBUY DS    A          BUY                                                   
         SPACE 1                                                                
         DS    CL8                 UPDATE ROUTINES                              
AUPDTCON DS    A          CONTRACT HEADER                                       
AUPDTDOL DS    A          CONTRACT DOLLARS                                      
AUPDTAGY DS    A          AGENCY                                                
AUPDTADV DS    A          ADVERTISER                                            
AUPDTSAL DS    A          SALESPERSON                                           
AUPDTCTY DS    A          CONTRACT TYPE                                         
AUPDTDCT DS    A          DEV CONTRACT TYPE                                     
AUPDTSTA DS    A          STATION                                               
AUPDTDSP DS    A          DEV SALESPERSON                                       
AUPDTTEM DS    A          TEAM                                                  
AUPDTPRD DS    A          PRODUCT CODE                                          
AUPDTCLS DS    A          CLASS                                                 
AUPDTCAT DS    A          CATEGORY                                              
AUPDTOFF DS    A          OFFICE                                                
AUPDTOWN DS    A          OWNER                                                 
AUPDTMKT DS    A          MARKET                                                
AUPDTGRP DS    A          GROUP/SUBGROUP                                        
AUPDTMST DS    A          SEE ME/READ ME SUB/MASTER RECORD                      
AUPDTREP DS    A          REP INFO                                              
AUPDTBD1 DS    A          STATION BUDGET INFO                                   
AUPDTBD2 DS    A          OFFICE  BUDGET INFO                                   
AUPDTPTP DS    A          POINT PERSON                                          
AUPDTSET DS    A          SET RECORD                                            
AUPDTSWI DS    A          SWITCH RECORD                                         
AUPDTCPT DS    A          COMPETITIVE STATIONS                                  
AUPDTDPT DS    A          DAYPART/CPP                                           
AUPDTLEN DS    A          LENGTH CODES                                          
AUPDTBKS DS    A          BOOKS                                                 
AUPDTCCO DS    A          CONFIRM COMMENTS                                      
AUPDTSCM DS    A          STANDARD COMMENT                                      
AUPDTOFC DS    A          OFFICE   COMMENT                                      
AUPDTEAG DS    A          EOP AGENCY                                            
AUPDTEAD DS    A          EOP ADVERT                                            
AUPDTEOF DS    A          EOP OFFICE                                            
AUPDTESP DS    A          EOP SALESPERSON                                       
AUPDTBCD DS    A          BUYCODE                                               
AUPDTBUY DS    A          BUY RECORD                                            
         SPACE 1                                                                
         DS    CL8                 FILTER ROUTINES                              
AFILTCON DS    A          CONTRACT HEADER                                       
AFILTDOL DS    A          CONTRACT DOLLARS                                      
AFILTAGY DS    A          AGENCY                                                
AFILTADV DS    A          ADVERTISER                                            
AFILTSAL DS    A          SALESPERSON                                           
AFILTCTY DS    A          CONTRACT TYPE                                         
AFILTDCT DS    A          DEV CONTRACT TYPE                                     
AFILTSTA DS    A          STATION                                               
AFILTDSP DS    A          DEV SALESPERSON                                       
AFILTTEM DS    A          TEAM                                                  
AFILTPRD DS    A          PRODUCT CODE                                          
AFILTCLS DS    A          CLASS                                                 
AFILTCAT DS    A          CATEGORY                                              
AFILTOFF DS    A          OFFICE                                                
AFILTOWN DS    A          OWNER                                                 
AFILTMKT DS    A          MARKET                                                
AFILTGRP DS    A          GROUP/SUBGROUP                                        
AFILTMST DS    A          SEE ME/READ ME SUB/MASTER RECORD                      
AFILTREP DS    A          REP INFO                                              
AFILTBD1 DS    A          STATION BUDGET INFO                                   
AFILTBD2 DS    A          OFFICE  BUDGET INFO                                   
AFILTPTP DS    A          POINT PERSON                                          
AFILTSET DS    A          SET RECORD                                            
AFILTSWI DS    A          SWITCH RECORD                                         
AFILTCPT DS    A          COMPETITIVE STATIONS                                  
AFILTDPT DS    A          DAYPART/CPP                                           
AFILTLEN DS    A          LENGTH CODES                                          
AFILTBKS DS    A          BOOKS                                                 
AFILTCCO DS    A          CONFIRM COMMENTS                                      
AFILTSCM DS    A          STANDARD COMMENT                                      
AFILTOFC DS    A          OFFICE   COMMENT                                      
AFILTEAG DS    A          EOP AGENCY                                            
AFILTEAD DS    A          EOP ADVERT                                            
AFILTEOF DS    A          EOP OFFICE                                            
AFILTESP DS    A          EOP SALESPERSON                                       
AFILTBCD DS    A          BUYCODE                                               
AFILTBUY DS    A          BUY RECORD                                            
         SPACE 1                                                                
         DS    CL8                 INITIALISATION ROUTINES                      
AINITALL DS    A                   GENERAL INITIALISATION                       
AINITCON DS    A          CONTRACT HEADER                                       
AINITDOL DS    A          CONTRACT DOLLARS                                      
AINITAGY DS    A          AGENCY                                                
AINITADV DS    A          ADVERTISER                                            
AINITSAL DS    A          SALESPERSON                                           
AINITCTY DS    A          CONTRACT TYPE                                         
AINITDCT DS    A          DEV CONTRACT TYPE                                     
AINITSTA DS    A          STATION                                               
AINITDSP DS    A          DEV SALESPERSON                                       
AINITTEM DS    A          TEAM                                                  
AINITPRD DS    A          PRODUCT CODE                                          
AINITCLS DS    A          CLASS                                                 
AINITCAT DS    A          CATEGORY                                              
AINITOFF DS    A          OFFICE                                                
AINITOWN DS    A          OWNER                                                 
AINITMKT DS    A          MARKET                                                
AINITGRP DS    A          GROUP/SUBGROUP                                        
AINITMST DS    A          SEE ME/READ ME SUB/MASTER RECORD                      
AINITREP DS    A          REP INFO                                              
AINITBD1 DS    A          STATION BUDGET INFO                                   
AINITBD2 DS    A          OFFICE  BUDGET INFO                                   
AINITPTP DS    A          POINT PERSON                                          
AINITSET DS    A          SET RECORD                                            
AINITSWI DS    A          SWITCH RECORD                                         
AINITCPT DS    A          COMPETITIVE STATIONS                                  
AINITDPT DS    A          DAYPART/CPP                                           
AINITLEN DS    A          LENGTH CODES                                          
AINITBKS DS    A          BOOKS                                                 
AINITCCO DS    A          CONFIRM COMMENTS                                      
AINITSCM DS    A          STANDARD COMMENT                                      
AINITOFC DS    A          OFFICE   COMMENT                                      
AINITEAG DS    A          EOP AGENCY                                            
AINITEAD DS    A          EOP ADVERT                                            
AINITEOF DS    A          EOP OFFICE                                            
AINITESP DS    A          EOP SALESPERSON                                       
AINITBCD DS    A          BUYCODE                                               
AINITBUY DS    A          BUY RECORD                                            
         SPACE 1                                                                
DMOPEN   DS    CL7                                                              
DMREAD   DS    CL7                                                              
DMRSEQ   DS    CL7                                                              
DMRDHI   DS    CL7                                                              
DMCLSE   DS    CL7                                                              
DMFAST   DS    CL7                                                              
GETREC   DS    CL7                                                              
DMRFIL   DS    CL7                                                              
CONTROL  DS    CL7                                                              
CTFILE   DS    CL7                                                              
REPDIR   DS    CL7                                                              
REPFIL   DS    CL7                                                              
DMDA     DS    F                                                                
DTFADDR  DS    F                                                                
ACOPYBUF DS    A                                                                
ACTIVITY DS    CL1                                                              
SPACES2  DS    CL80                                                             
         EJECT                                                                  
**ADDRESSD BASED IN RXTRACT5 END                                                
*&&                                                                             
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'201RXROUTS12 02/20/13'                                      
         END                                                                    

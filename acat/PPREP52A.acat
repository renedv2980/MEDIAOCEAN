*          DATA SET PPREP52A   AT LEVEL 040 AS OF 02/25/20                      
*CATALP PP52A                                                                   
*                                                                               
         TITLE 'PP5202 - CHANGE LOG        '                                    
*                                                                               
*  JSAY 09/19  SPEC-37978  PRINT SECOND ALLOCATION LINE.                        
*                                                                               
*  SMUR 04/18  SPEC-17729  NEW MEDIA (D)IGITAL AUDIO (18.3)                     
*                                                                               
*  BPLA 07/15       CHANGES FOR MEDIA B, V, AND W                               
*                                                                               
*  BPLA 03/14       CHANGES FOR MEDIA L                                         
*                                                                               
*  SMYE 03/06       STEWARDSHIP CHANGES                                         
*                                                                               
*  SMYE 03/05       SUPPRESS COMMENTS STARTING WITH SPECIAL CHARACTER           
*                     OBTAINED FROM PROFILE 52A (BUY47 LABEL)                   
*                                                                               
*  SMYE 04/24/01    CHANGES IN ESCLR.. FOR MORE BRAND ACCUMMULATORS             
*                     INCREASED FROM 175 TO 600 PRODUCTS                        
*                                                                               
*  SMYE 03/01       PRINT ADDITIONAL CHARGES (DOADCG CSECT)                     
*                                                                               
*  KWAN 09/00       FIX UP CATALP NAMES AND SOURCE BOOK NAMES                   
*                                                                               
*  KWAN 06/00       PRINT ESTIMATED AND ACTUAL IMPRESSION TOTALS                
*                   FOR EVERY VENDOR (END OF ONE PUB)                           
*                                                                               
*  KWAN 05/00       PRINT ACTUAL IMPRESSION DATA                                
*                                                                               
*  BPLA 11/99       MOVE COST2/OPEN OPTION TO QOPT9                             
*                   (WAS QOPT6- ERROR)                                          
*                                                                               
*  KWAN 08/99       FIX BUG FOR INCHES TO LINES CONVERSION                      
*                                                                               
*  KWAN 04/99       PRINT IMPRESSION DATA                                       
*                                                                               
*  KWAN 02/99       QOPT6 FOR "OPEN" (UPDATE GETINS CALLS)                      
*                                                                               
*  BPLA 10/98       FOR MULTI-MEDIA REQUESTS SAVE FIRST MEDIA                   
*                   ENCOUNTERED IN FMULTMED                                     
*                                                                               
*  SMYE 03/98       ALWAYS SHOW UNITS RATE AT NET BASED ON A NEW                
*                   PROFILE OPTION                                              
*                                                                               
*  SMYE 11/97       SFH (SPECIAL FINANCIAL HANDLING) DISPLAY AND                
*                   QOPT8=H TO BYPASS SFH "HELD" SFH BUYS                       
*                                                                               
*  SMYE 11/1/96     PV AND CT DISPLAY                                           
*                                                                               
*  BPLA 6/96        BYPASS DUPLICATE P53'S (SAME EXCEPT FOR                     
*                   CONTROL DATE                                                
*                                                                               
*  BPLA 6/96        FOR TURNAROUNDS CHECK FOR PRESENCE OF                       
*                   CONTROL DATE IN QCNTLDT AND USE IT                          
*                                                                               
*  BPLA 12/95       CHANGE CALLS FOR DTCNV TO DATCON                            
*                   ALSO NEW PPBUYCHG (USING DATCON INSTEAD OF DTCNV)           
*                                                                               
*  BPLA 8/95        CHANGE TO ALLOW FOR BIGGER CHANGE ELEMENTS                  
*                   NON-$ CHANGE ELEMENTS MAY BE 8 OR 11 BYTES                  
*  BPLA 5/95        USE TAXOPT INSTEAD OF B2PROF                                
*                                                                               
*  BPLA 4/17/95     NEW GOTO GETCOST IF B2PROF+12 =Y (TAX OUT OF BASE)          
*                   3 PLACES CHANGED                                            
*                                                                               
*  BPLA 6/14/94     RPT DISPLAY                                                 
*                                                                               
*  BPLA 10/6/93     NO PESTNAM2 IF EST IS BLANK                                 
*                                                                               
*  BPLA 6/30/93     ECT MAKE LIVE CHANGES                                       
*                                                                               
*  BPLA 4/7/93      CHANGES FOR USER FIELDS                                     
*                                                                               
*  BPLA 2/11/93     CHANGES IN BUYACC - IF ESSUM1 = "N" NO                      
*                   SUMMARIES FOR EST AND HIGHER ACCUMS                         
*                   STILL ACCUMULATE DST/REG SINCE I NEED                       
*                   TOTALS FOR REG/DST RECAPS                                   
*                                                                               
*  LWEI 02/02/93    REF DISPLAY                                                 
*                                                                               
*  BPLA 12/22/92    FSI DISPLAY                                                 
*                                                                               
*  BPLA  10/22/92   AT FBUYCLI STORE AOR DATA                                   
*                   AND OPEN THE AOR FILE IF I NEED TO                          
*                                                                               
*  BPLA  6/8/92   CHANGE DEC TO DLC                                             
*                                                                               
*  BPLA  5/13/92  DEC DISPLAY                                                   
*                                                                               
*  BPLA  4/2/91   MANY FRENCH FIXES                                             
*                                                                               
*  BPLA  9/28/90  DISPLAY BOTH REQ CARDS IF NO DATA GERERATED                   
*                                                                               
*  BPLA  7/17/90  CONTROL DATE MOVED FROM QPUBCLAS+1(3) TO                      
*                 QCNTLDT(3) TO FREE COL 61 FOR 2 REQ CARDS                     
*                                                                               
*  ROSA/ 7/13/88  LAURENCE CHARLS SPECIAL HANDLING OF BILL DATE     L01         
*               SEE SUBROUTINE ' BUYBLDT'                           L01         
*                                                                   L01         
         TITLE 'PP5202 - PRINTPAK ESTIMATES'                                    
*                                                                               
*                                                                               
* REQUEST OPTIONS                                                               
*                                                                               
* QOPT1                                                                         
* QOPT2  OVERRIDE FOR 2ND SUMMARY                                               
* QOPT3  S=PRINT ONLY SUMMARIES                                                 
*        R=SUPPRESS REG/DST SUMMARIES                                           
*        P=SEPARATE PAGINATION FOR SUMMARIES                                    
* QOPT4  D=FULL BILL DATE OPTION                                                
* QOPT5  C=PRINT ONLY 'CHANGES'                                                 
*        T=TOTAL ONLY CHANGES                                                   
*                                                                               
*              PCLTPROF+18=$ MEANS TOTALS ON DST AND HIGHER IN                  
*                            $ AMOUNTS                                          
*                                                                               
* QOPT6   DETAIL OVERRIDE                                                       
* QOPT7   SUMMARY OVERRIDE                                                      
*                                                                               
* QOPT8  H=BYPASS HELD SFH BUYS                                                 
*                                                                               
* QOPT9  O=REPORT COST2/OPEN $                                                  
*                                                                               
* QCNTLDT(3) IF = X'000000' MEANS REPORT DATA ONLY IF BILLED TODAY              
*                                                                               
* QUESTOR+11 IF X'40' BIT IS OFF INCLUDE TEST BUYS                              
*                                                                               
*                                                                               
***********************************************************************         
*                                                                               
PP5202   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,PP5202                                                         
         SPACE 2                                                                
         LA    R6,1(RB)                                                         
         LA    R6,4095(R6)                                                      
         USING PP5202+4096,R6     2ND BASE REG                                  
         L     RA,0(R1)                                                         
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         LR    R9,RC                                                            
         AHI   R9,4096                                                          
         USING PPFILED,RC,R9                                                    
         LA    R8,SPACEND                                                       
         USING PP52WRKD,R8                                                      
*                                                                               
         XC    PROF,PROF                                                        
*                                                                               
         EJECT                                                                  
ES1      DS    0H                                                               
         CLI   MODE,RUNFRST                                                     
         BNE   ES2                                                              
         XC    SVQCARD,SVQCARD     CLEAR SAVED REQUEST CARD                     
         L     R5,PPWORK2C                                                      
         USING PPWORK2D,R5                                                      
         MVC   ADICTATE,DICTATE                                                 
         MVC   ACUREDIT,CUREDIT                                                 
         DROP  R5                                                               
         CLC   RCRQFILT,=C'53'                                                  
         BNE   ES1C                                                             
         MVI   RCREQREP,C'N'       SUPPRESS REQUEST PRINTOUT FOR TA'S           
*                                                                               
ES1C     DS    0H                                                               
*                                                                               
         MVI   ESCTL,C'0'                                                       
         MVC   ESCTL+1(L'ESCTL-1),ESCTL                                         
         MVC   SAVEMAX,MAXLINES                                                 
         MVC   P,SPACES                                                         
         MVC   PSECOND,SPACES                                                   
         MVI   MYDASH,C'-'                                                      
         MVC   MYDASH+1(L'MYDASH-1),MYDASH                                      
         MVC   WORK(2),RCDATE+6                                                 
         MVC   WORK+2(2),RCDATE                                                 
         MVC   WORK+4(2),RCDATE+3                                               
         GOTO1 DATCON,DMCB,(0,WORK),(3,BTODAY)                                  
*                                                                               
* RELOCATE BRAND ACCUM ADDRESSES                                                
*                                                                               
         LA    R0,(ACONX-ACONS)/4       NUMBER TO RELOCATE                      
         RELOC RELO                                                             
         L     R1,=A(ACONS)                                                     
         A     R1,RELO                                                          
         LA    R2,APUBTOT                                                       
ESRELO2  L     R3,0(R1)                                                         
         A     R3,RELO                                                          
         ST    R3,0(R2)                                                         
         LA    R1,4(R1)                                                         
         LA    R2,4(R2)                                                         
         BCT   R0,ESRELO2                                                       
*                                                                               
         XC    LASTCKEY,LASTCKEY   ASSURE NO MATCH                              
*                                                                               
         L     RE,APUBTOT          SET EVERYTHING TO BINARY ZEROS               
         L     RF,=V(PP52ALLX)                                                  
         A     RF,RELO                                                          
         SR    RF,RE                                                            
         XCEF                                                                   
*                                                                               
         LA    RE,APUBTOT                                                       
         LA    RF,(ATOTSX-APUBTOT)/4                                            
ESCLR1   LA    R1,191                                                           
         L     R2,0(RE)            TOTAL TABLES ARE IN PL8                      
         ZAP   0(8,R2),=P'0'                                                    
         LA    R2,8(R2)                                                         
         BCT   R1,*-10                                                          
         LA    RE,4(RE)                                                         
         BCT   RF,ESCLR1                                                        
*                                                                               
         L     RE,ABRDT                                                         
*NOP*    LA    RF,600                                                           
         LA    RF,1000                                                          
ESCLR2   LA    R1,191                                                           
         ZAP   0(8,RE),=P'0'                                                    
         LA    RE,8(RE)                                                         
         BCT   R1,*-10                                                          
         BCT   RF,ESCLR2                                                        
*                                                                               
         L     RE,ABRDTB                                                        
*NOP*    LA    RF,600                                                           
         LA    RF,1000                                                          
ESCLR3   LA    R1,191                                                           
         ZAP   0(8,RE),=P'0'                                                    
         LA    RE,8(RE)                                                         
         BCT   R1,*-10                                                          
         BCT   RF,ESCLR3                                                        
*                                                                               
         L     RE,ASPCTAB                                                       
         LA    RF,60                                                            
ESCLR4   LA    R1,6                                                             
         LA    RE,20(RE)           FIRST 20 BYTES ARE NOT PACK NUMBERS          
         ZAP   0(8,RE),=P'0'                                                    
         LA    RE,8(RE)                                                         
         BCT   R1,*-10                                                          
         BCT   RF,ESCLR4                                                        
*                                                                               
         MVC   ACURKLN,AKLINES                                                  
         SPACE 1                                                                
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
ES2      DS    0H                                                               
         CLI   LASTMODE,LBUYPUB                                                 
         BNE   *+8                                                              
         BAS   RE,ENDPUB           FINISH PUB                                   
         CLI   MODE,PROCBUY                                                     
         BE    BUY                                                              
         CLI   MODE,FBUYREQ                                                     
         BE    NEWREQ                                                           
         CLI   MODE,FBUYCLI                                                     
         BE    NEWCLT                                                           
         CLI   MODE,LBUYREQ                                                     
         BE    ENDREQ                                                           
         CLI   MODE,FBUYEST                                                     
         BE    NEWEST                                                           
         CLI   MODE,FBUYREG                                                     
         BE    NEWREG                                                           
         CLI   MODE,FBUYDST                                                     
         BE    NEWDST                                                           
         CLI   MODE,FBUYPUB                                                     
         BE    NEWPUB                                                           
         CLI   MODE,LBUYCNT                                                     
         BE    ENDCNT                                                           
         CLI   MODE,LBUYMKT                                                     
         BE    ENDMKT                                                           
         CLI   MODE,DISKERR                                                     
         BNE   *+12                                                             
         MVI   MODE,0                                                           
         B     EXIT                                                             
         L     R3,RELO                                                          
         GOTO1 =V(ENDBRKS),RR=R3                                                
*                                                                               
EXIT     DS    0H                                                               
         MVC   LASTMODE,MODE                                                    
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
***********************************************************************         
*                                                                               
NEWREQ   DS    0H                                                               
*                                                                               
         ZAP   EIMPSTOT,=P'0'      INITIALIZE EIMPS TOTALS                      
         ZAP   AIMPSTOT,=P'0'      INITIALIZE AIMPS TOTALS                      
*                                                                               
         CLC   QPROG,=C'53'        SEE IF TURNAROUND                            
         BNE   NEWRQ2                                                           
         CLC   SVQCARD(57),QPROG   SAME THROUGH CONTROL DATE?                   
         BNE   NEWRQ1                                                           
         MVI   MODE,LBUYREQ        SKIP TO NEXT REQUEST                         
         B     EXIT                                                             
*                                                                               
NEWRQ1   DS    0H                                                               
         MVC   SVQCARD,QPROG       SAVE THIS REQUEST CARD                       
*                                                                               
NEWRQ2   DS    0H                                                               
         L     RF,PPWORK2C                                                      
         USING PPWORK2D,RF                                                      
         MVC   MYCTAB,CURTAB       MUST SET MY OWN CURTAB                       
*                                  USE CURTAB NOW BEING SET IN PPFILCON         
         DROP  RF                                                               
*                                                                               
         BRAS  RE,NEWRQBRA         03/05 - NEW FOR ADDRESSABILITY               
*                                                                               
         B     EXIT                                                             
*                                                                               
***********************************************************************         
*                                                                               
NEWCLT   DS    0H                                                               
         XC    SADVDATA,SADVDATA                                                
         LA    R2,PCLTREC+33                                                    
         MVI   ELCOD,X'15'                                                      
NEWCLT5  BAS   RE,NEXTEL                                                        
         BNE   NEWCLT10                                                         
         MVC   SADVDATA(18),2(R2)                                               
         CLC   SADVDATA(2),QAGENCY    SEE IF I AM THE AOR                       
         BE    NEWCLT10                                                         
         TM    SADVDATA+15,X'20'     SEE IF I HAVE MY OWN CONTRACTS             
         BNO   NEWCLT10                                                         
*                                                                               
*        SEE IF I NEED TO OPEN THE AOR'S FILE                                   
*                                                                               
         L     RF,UTL                                                           
         MVC   SAVSYS,4(RF)       SAVE MY SYSTEM                                
         CLC   SADVDATA+14(1),SAVSYS    SEE IF ON THE SAME SYSTEM               
         BE    NEWCLT10                                                         
         MVC   4(1,RF),SADVDATA+14                                              
*                                                                               
         GOTO1 DATAMGR,DMCB,=CL8'OPEN',=C'PRINT',PRTFILES,DMWORK                
         L     RF,UTL                                                           
         MVC   4(1,RF),SAVSYS      RESET TO MY SYSTEM                           
*                                                                               
NEWCLT10 B     EXIT                                                             
*                                                                               
*                                                                               
SAVSYS   DS    CL1                                                              
*                                                                               
PRTFILES DS    0D                                                               
         DC    CL8' PRTDIR'                                                     
         DC    CL8' PRTFILE'                                                    
         DC    CL8' PUBDIR'                                                     
         DC    CL8' PUBFILE'                                                    
         DC    C'X'                                                             
         EJECT                                                                  
         SPACE 2                                                                
NEWEST   L     R3,RELO                                                          
         GOTO1 =V(ESMONTHS),RR=R3                                               
         B     EXIT                                                             
         SPACE 2                                                                
NEWREG   DS    0H                                                               
         NI    RDPACT,X'7F'         SET NO REG ACTIVITY                         
         CLC   QREGION,=C'ALL'                                                  
         BNE   EXIT                                                             
         MVI   WFREGSW,C'R'                                                     
         B     EXIT                                                             
*                                                                               
NEWDST   DS    0H                                                               
         NI    RDPACT,X'BF'         SET NO DST ACTIVITY                         
         CLC   QDIST,=C'ALL'                                                    
         BNE   EXIT                                                             
         MVI   WFDSTSW,C'D'                                                     
         B     EXIT                                                             
         SPACE 2                                                                
ENDREQ   DS    0H                                                               
         CLI   ESTACTIV,0          TEST ANY ACTIVITY FOR REQUEST                
         BNE    EXIT                                                            
         CLI   RCMULTIQ,C'Y'                                                    
         BE    EXIT                                                             
         MVI   SKIPSPEC,C'Y'                                                    
         MVI   PRNTSW,C'S'                                                      
         MVC   P,SPACES                                                         
         MVC   PSECOND,SPACES                                                   
         MVC   P(80),QRECORD                                                    
         L     RF,PPWORK2C                                                      
         USING PPWORK2D,RF                                                      
         MVC   PSECOND(80),QAREA2                                               
         DROP  RF                                                               
         GOTO1 REPORT                                                           
         MVI   SKIPSPEC,C'Y'                                                    
         MVI   PRNTSW,C'S'                                                      
         MVC   P(L'PP@NODGN),PP@NODGN                                           
         GOTO1 REPORT                                                           
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
NEWPUB   DS    0H                                                               
*                                                                               
         NI    RDPACT,X'D0'        CLEAR PUB ACTIVITY                           
         MVC   SVPNAME(40),PUBNAME SAVE NAME,ZONE,CITY,STATE                    
         MVC   SVPCITY(18),PUBCITY                                              
         MVC   SVPKPUB,PUBKPUB     AND PUB NO.                                  
         MVC   P,SPACES                                                         
         MVC   PSECOND,SPACES                                                   
         MVC   PUBKPUB(6),PBUYKPUB                                              
         IC    R2,PAGYPROF+12                                                   
         GOTO1 PUBOUT,DMCB,PUBREC,ALTLREC,(3,P+1),PCLTKCLT,            X        
               ((R2),PUBEDIT)                                                   
*                                                                               
NEWPUBZ  DS    0H                                                               
         SPACE 2                                                                
*                                  REG/DST SHARE                                
         MVI   RDSHRLNC,0          NO LINES TO PRINT                            
         MVI   RDSHRFST,1          PRIMARY REG/DST                              
         CLC   QREGION(6),SPACES                                                
         BE    NEWPUBZ2                                                         
         XC    WORK(12),WORK                                                    
         MVC   WORK(3),PCLTKCLT                                                 
         MVC   WORK+3(3),PDIVKDIV                                               
         CLI   QDIV,C' '                                                        
         BNE   *+10                                                             
         MVC   WORK+3(3),PPRDDIV                                                
         CLC   QPUB+1(3),=C'RD='   REG/DST CLT OVERRIDE                         
         BNE   *+16                                                             
         MVC   WORK(3),QPUB+4                                                   
         MVC   WORK+3(3),=C'000'                                                
         CLI   QREGION,C' '                                                     
         BE    *+10                                                             
         MVC   WORK+6(3),PREGKREG                                               
         CLI   QDIST,C' '                                                       
         BE    *+10                                                             
         MVC   WORK+9(3),PDSTKDST                                               
*                                                                               
         L     R3,RELO                                                          
         GOTO1 =V(PPRDSHR),DMCB,ALTLREC,(1,WORK),RDSHROUT,RR=R3                 
*                                                                               
NEWPUBZ2 DS    0H                                                               
         MVI   SPACING,2                                                        
         CLI   ESCCONC,C'N'                                                     
         BNE   NEWPUBZ4                                                         
         CLI   ESCPBAD,C'0'                                                     
         BNE   NEWPUBZ4                                                         
         CLI   RDSHRLNC,0                                                       
         BNE   NEWPUBZ4                                                         
         MVI   SPACING,1                                                        
*                                                                               
NEWPUBZ4 DS    0H                                                               
         MVC   SAVPUBN3,SPACES                                                  
         LA    R7,SAVPUBN3+2                                                    
*                                                                               
         XC    CIRC,CIRC                                                        
         CLI   ESCCIRC,C'S'        SUPPRESS CIRC                                
         BE    NP4                                                              
         LA    R2,PUBREC+33                                                     
         MVI   ELCOD,X'30'                                                      
         XC    FULL,FULL                                                        
NP2      DS    0H                                                               
         BAS   RE,NEXTEL                                                        
         BNE   NP2F                                                             
         USING PUBCIREL,R2                                                      
         CLC   PUBCDAT,BEND                                                     
         BH    NP2G                IGNORE IG AGATER END                         
         CLC   PUBCDAT,BSTART      DATE VS START                                
         BH    NP2D                                                             
         BE    NP2E                                                             
         ST    R2,FULL             SAVE LATEST                                  
         B     NP2                                                              
NP2D     DS    0H                                                               
         LR    R5,R2                                                            
         L     R2,FULL             DO LATEST BEFORE START                       
         LTR   R2,R2                                                            
         BNP   *+8                                                              
         BAS   RE,NP3                                                           
         LR    R2,R5               RESTORE THIS ELEM ADDR                       
NP2E     DS    0H                                                               
         XC    FULL,FULL           CLEAR LATEST                                 
         BAS   RE,NP3                                                           
         B     NP2                                                              
*                                                                               
NP2F     DS    0H                                                               
         L     R2,FULL             TRY FOR LATEST                               
         LTR   R2,R2                                                            
         BZ    NP4                                                              
         BAS   RE,NP3                                                           
         B     NP4                                                              
NP2G     DS    0H                  CIRD DATE AFTER END                          
         OC    CIRC,CIRC           IF NO TOHER CIRC                             
         BNZ   *+8                                                              
         BAS   RE,NP3              USE THIS ONE                                 
         B     NP4                                                              
         SPACE 2                                                                
NP3      DS    0H                                                               
         CLI   SAVPUBN3+2,C' '                                                  
         BNE   NP3B                                                             
         MVC   0(L'PP@CIRCS,R7),PP@CIRCS                                        
         LA    R7,5(R7)                                                         
NP3B     DS    0H                                                               
         ZAP   DUB,PUBCIR1                                                      
         CVB   R1,DUB                                                           
         CLI   RDSHRLNC,0          TEST MULTIPLE REG/DST                        
         BE    NP3B2               NO                                           
         CLI   ESCCIRCR,C'Y'       TEST DOING SHARES                            
         BNE   NP3B2                                                            
*NOP*    ICM   RF,15,RDSHRPCT      GET SHARE OF CIRC                            
*** REPLACE ABOVE AS FOLLOWS - RDSHRPCT NOT ADDRESSABLE A/O 3/27/01 ***         
         LA    R3,RDSHRLNS                                                      
         LA    R3,RDSHRPCT-RDSHRLNS(R3)      BUMP TO RDSHRPCT                   
         L     RF,0(R3)                                                         
*** ABOVE IS REPLACEMENT FOR *NOP* ICM INSTRUCTION                              
         MR    R0,RF                                                            
         SLDA  R0,1                                                             
         L     RF,=F'10000'                                                     
         DR    R0,RF                                                            
         A     R1,=F'1'                                                         
         SRA   R1,1                                                             
*                                                                               
NP3B2    DS    0H                                                               
         OC    CIRC,CIRC                                                        
         BNZ   NP3C                                                             
*                                  USE FIRST CIRC FOR TOTALS                    
         ST    R1,CIRC                                                          
*                                                                               
NP3C     DS    0H                                                               
         ST    RE,SAVERE1                                                       
         ST    RF,SAVERF                                                        
         ST    R1,SAVER1                                                        
         MVI   MYCTAB+3,0                                                       
         CURED (B4,CIRC),(17,0(R7)),MYCTAB,COMMAS=YES,ALIGN=LEFT,MODADDX        
               R=ACUREDIT                                                       
         L     R1,SAVER1                                                        
         L     RF,SAVERF                                                        
         L     RE,SAVERE1                                                       
         AR    R7,R0                                                            
         CLI   ESCCIRCD,C'Y'       PRONT DATE AND SOURCE                        
         BNE   NP3P                NO                                           
         OC    PUBCDAT,PUBCDAT                                                  
         BNZ   NP3D                                                             
         CLI   PUBCSRC,C' '                                                     
         BNH   NP3P                                                             
*                                                                               
NP3D     DS    0H                                                               
         MVI   1(R7),C'('                                                       
         LA    R4,2(R7)                                                         
         OC    PUBCDAT,PUBCDAT                                                  
         BZ    NP3H                                                             
         LA    R3,5                MMMDD/YY                                     
         LA    R4,11(R7)                                                        
         CLI   PUBCDAT+2,0                                                      
         BNE   *+12                                                             
         LA    R3,9                MMM/YY                                       
         LA    R4,9(R7)                                                         
         LR    R0,RE                                                            
         GOTO1 DATCON,DMCB,(3,PUBCDAT),((R3),2(R7))                             
         LR    RE,R0                                                            
NP3H     DS    0H                                                               
         MVC   0(4,R4),PUBCSRC                                                  
         LA    R7,16(R7)                                                        
         CLI   0(R7),C' '                                                       
         BH    *+8                                                              
         BCT   R7,*-8                                                           
         MVI   1(R7),C')'                                                       
*                                                                               
NP3P     DS    0H                                                               
         LA    R7,4(R7)                                                         
         BR    RE                                                               
         SPACE 3                                                                
*                                                                               
NP4      DS    0H                                                               
         DROP  R2                                                               
*                                                                               
NEWPUB4  DS    0H                                                               
*                                                                               
         CLI   QMEDIA,C'N'                                                      
         BE    NEWPUBY                                                          
         CLI   QMEDIA,C'O'                                                      
         BE    NEWPUBY                                                          
*                                                                               
         LA    R2,PUBREC+33        DISPLAY FREQ                                 
         MVI   ELCOD,X'20'                                                      
         CLC   ELCOD,0(R2)                                                      
         BE    *+8                                                              
         BAS   RE,NEXTEL                                                        
         BNE   NEWPUBY                                                          
         USING PPDUMD05,R2                                                      
         CLI   PUBMFREQ,C' '                                                    
         BNH   NEWPUBY                                                          
         MVC   0(L'PP@PUBL,R7),PP@PUBL                                          
         MVC   5(2,R7),PUBMFREQ                                                 
         DROP  R2                                                               
*                                                                               
NEWPUBY  DS    0H                                                               
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
* POINT R7 TO LAST NONBLANK POSITION IN FIELD                                   
* THAT ENDS AT 0(R7)                                                            
*                                                                               
ESFLOAT  CLI   0(R7),C' '                                                       
         BHR   RE                                                               
         BCT   R7,ESFLOAT                                                       
         SPACE 2                                                                
         EJECT                                                                  
*                                                                               
***********************************************************************         
*                                                                               
BUY      DS    0H                                                               
*                                                                               
         L     RF,PPWORK2C                                                      
         USING PPWORK2D,RF                                                      
         CLI   QOPT9,C'O'      COST2/OPEN?                                      
         BNE   BUY1B                                                            
*                                                                               
         DROP  RF                                                               
*                                                                               
         GOTO1 GETINS,DMCB,PBUYREC,(C'O',GROSS),PPRDKPRD                        
*                                                                               
BUY1B    CLI   BTDOPT,C'Y'                                                      
         BNE   BUY1C                                                            
         CLI   CNTLSET,C'Y'                                                     
         BE    BUY1C                                                            
         CLI   QCNTLDT,C' '         WILL BE C' ' IF NO PRIOR BILLING            
*                                   FLAG ALL BUYS AS NEW                        
         BNE   *+10                                                             
         MVC   QCNTLDT(3),=X'010101'                                            
         GOTO1 DATCON,DMCB,(3,QCNTLDT),(2,PCONTROL)                             
*                                                                               
         MVI   PRDESTSW,C'F'        SET TO FLAG CHANGES                         
         MVI   CNTLSET,C'Y'                                                     
*                                                                               
*                                  GET SPACE DESC NOW                           
*                                  BECAUSE MIGHT NEED IT EVEN IF                
*                                  NOT PRINTING BUY                             
BUY1C    L     R5,APBYOD                                                        
         USING PPBYOUTD,R5                                                      
*                                                                               
         LA    RF,PBUYREC                                                       
         ST    RF,PBYOINPT                                                      
         MVC   PBYODTCN,DATCON                                                  
         LA    RF,GROSS                                                         
         ST    RF,PBYOVALS                                                      
*                                                                               
         MVI   PBYOCTL,X'68'                                                    
         CLI   ESCUNET,C'Y'        PROFILE SHOW UNITS RATE AT NET?              
         BNE   BUY1F               NO                                           
         OI    PBYOCTL,X'01'       CALCULATE UNITS RATE AT NET                  
         MVI   PBDCTYP,C'N'        FOR PPBYOUT CALCULATION                      
BUY1F    CLI   PAGYPROF+1,C'L'                                                  
         BE    BUY1K                                                            
         CLC   QPROG,=P'53'                                                     
         BE    BUY1K                                                            
         OI    PBYOCTL,X'02'       NO LINE NO.                                  
*                                                                               
BUY1K    DS    0H                                                               
         GOTO1 PPBYOUT,DMCB,PPBYOUTD                                            
         MVC   HOLDSPAC,PBYOSPC1                                                
         CLC   HOLDSPAC,SPACES                                                  
         BH    *+10                                                             
         MVC   HOLDSPAC(7),PBYOUNTS          USE UNITS                          
         MVC   SAVUIND,PBDUIND     SAVE LINES/INCHES                            
         OI    SAVUIND,C' '        WILL MAKE LOWER CASE I UPPER CASE            
*                                                                               
         L     RF,PPWORK2C                                                      
         USING PPWORK2D,RF                                                      
         CLI   QOPT8,C'H'          BYPASS HELD SFH BUYS ?                       
         BNE   BUY1L               NO                                           
*                                                                               
         TM    PBDSTAT,X'08'       HELD SFH BUY ?                               
         BO    EXIT                YES - SKIP                                   
*                                                                               
BUY1L    DS    0H                                                               
**************************  STEWARD LOGIC BELOW ************                    
         CLI   QOPTA,C' '          STEWARD REQUEST ?                            
         BH    BUY1L20             YES                                          
         TM    PBDSTAT2,X'40'      NOT STEWARD REQUEST - STEWARD BUY ?          
         BO    EXIT                YES - SKIP                                   
         B     BUY1LA              "REGULAR" BUY - CONTINUE                     
BUY1L20  DS    0H                                                               
         CLI   QOPTA,C'O'          ONLY STEWARD BUYS REQUESTED ?                
         BNE   BUY1L40             NO - WANT ALL BUYS - CONTINUE                
         TM    PBDSTAT2,X'40'      STEWARD BUY ?                                
         BNO   EXIT                NO - SKIP                                    
         DROP  RF                                                               
BUY1L40  DS    0H                                                               
         TM    PBDSTAT2,X'40'      STEWARD BUY ?                                
         BO    BUY1LA              YES - CONTINUE                               
         CLI   PBDBFD,C'T'         NON-STEWARD TEST BUY ?                       
         BE    EXIT                YES - SKIP                                   
**************************  STEWARD LOGIC ABOVE  ***********                    
BUY1LA   DS    0H                                                               
         CLI   QBPDATE,C'1'        TEST PAID DATE FILTER                        
         BNE   BUY1LF                                                           
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'25'                                                      
         XC    GROSS(12),GROSS                                                  
         MVI   BYTE,0                                                           
BUY1LB   DS    0H                                                               
         BAS   RE,NEXTEL                                                        
         BNE   BUY1LD                                                           
         USING PPAYELEM,R2                                                      
         CLC   PPDDATE,BQSTART                                                  
         BL    BUY1LB                                                           
         CLC   PPDDATE,BQEND                                                    
         BH    BUY1LB                                                           
*                                                                               
         MVI   BYTE,1              SET HAVE PAYMENT                             
         MVC   WORK(12),PPGROSS                                                 
         L     R0,WORK                                                          
         A     R0,GROSS                                                         
         ST    R0,GROSS                                                         
         L     R0,WORK+4                                                        
         A     R0,AGYCOM                                                        
         ST    R0,AGYCOM                                                        
         L     R0,WORK+8                                                        
         A     R0,CSHDSC                                                        
         ST    R0,CSHDSC                                                        
         B     BUY1LB                                                           
*                                                                               
BUY1LD   DS    0H                                                               
         CLI   BYTE,0                                                           
         BE    EXIT                NO PAYMENTS                                  
         B     BUY1P                                                            
         DROP  R2                                                               
BUY1LF   DS    0H                                                               
*                                                                               
         MVI   CHGTYP,C' '                                                      
         MVI   APCHGWK,0           SET CHG LINES TO ZERO                        
         TM    PBUYCNTL,X'80'      TEST DELETED                                 
         BZ    BUY1N               NO                                           
         CLC   QPROG,=C'EC'        SEE IF DOING CHANGE REPORT                   
         BNE   BUY1LH                                                           
*                                  CAN CHK LAST ACTIVITY DATE                   
         CLC   PBDDATE,QCNTLDT                                                  
         BL    EXIT                SKIP IF DELETED BEFORE CONTROL DATE          
*                                  CAN SKIP 'OLD DELETES'                       
         CLC   PBDBUYDT,QCNTLDT    SEE IF ADDED AFTER CONTROL DATE              
         BH    EXIT                SKIP ADD/DELETES                             
         L     R1,GROSS                                                         
         ST    R1,OLDGRS                                                        
         LCR   R1,R1               SET GROSS CHG TO NEGATIVE                    
         ST    R1,CHGGRS                                                        
         L     R1,AGYCOM                                                        
         ST    R1,OLDAC                                                         
         LCR   R1,R1                                                            
         ST    R1,CHGAC                                                         
         L     R1,CSHDSC                                                        
         ST    R1,OLDCD                                                         
         LCR   R1,R1                                                            
         ST    R1,CHGCD                                                         
         XC    GROSS(12),GROSS                                                  
         B     BUY1P                                                            
*                                                                               
BUY1LH   XC    GROSS(12),GROSS                                                  
         CLI   QCNTLDT,C' '        TEST CHANGES TO BE FLAGGED                   
         BE    EXIT                NO                                           
*                                                                               
BUY1N    DS    0H                                                               
         CLI   QCNTLDT,C' '                                                     
         BE    BUY1P                                                            
         XC    OLDGRS(12),OLDGRS   CLEAR OLD GROSS,AC,CD                        
         XC    CHGGRS(12),CHGGRS   CLEAR CHG GROSS,AC,CD                        
*                                  IF QPROG='EC' EST CHG REPORT                 
         MVC   WORK(3),QCNTLDT                                                  
         SR    R3,R3               ALL CHANGES                                  
         CLC   QPROG,=C'53'                                                     
         BE    BUY1N1A                                                          
         CLC   QPROG,=C'EC'         SEE IF ESTIMATE CHG REPORT                  
         BE    BUY1N1A                                                          
         ZIC   R3,=C'E'            'EFFECTIVE' CHANGES ONLY                     
*                                                                               
         CLI   ESCJOB,C'0'          SEE IF SHOWING AD INFO                      
         BE    BUY1N1A                                                          
         ZIC   R3,=C'A'             INCLUDE AD CHANGES                          
*                                                                               
BUY1N1A  DS    0H                                                               
         CLC   QPROG,=C'EC'        SEE IF ESTIMATE CHANGE REPORT                
         BNE   BUY1N1G                                                          
         CLI   FCRDTEST,C'Y'      AND REPORTING TEST BUYS                       
         BNE   BUY1N1G                                                          
         ZIC   R3,=C'L'            TO INCLUDE MAKE LIVES                        
*                                                                               
         CLC   PBDBUYDT,QCNTLDT    SEE IF BOUGHT OR MADE LIVE                   
         BL    BUY1N1G             BEFORE CONTROL DATE                          
         LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'24'                                                      
BUY1N1C  BAS   RE,NEXTEL                                                        
         BNE   BUY1N1G                                                          
         USING PCHGELED,R2                                                      
         TM    PCHGIND3,X'04'      SEE IF MADE LIVE                             
         BZ    BUY1N1C                                                          
         MVC   PBDBUYDT,=X'000000'  SO PBUYCHG WILL NOT RETURN AS               
*                                   A "NEW" BUY                                 
         DROP  R2                                                               
*                                                                               
BUY1N1G  ZIC   R2,ESCCHGS                                                       
         GOTO1 APBUYCHG,DMCB,((R2),PBUYREC),((R3),WORK),APCHGWK,DATCON          
         MVC   CHGTYP,4(R1)        SAVE TYPE OF CHANGE                          
         MVC   APCHGWK(1),8(R1)    NO. OF LINES                                 
         OC    WORK(3),WORK                                                     
         BZ    BUY1N9                                                           
*                                                                               
BUY1N2   DS    0H                                                               
         CLC   QPROG,=C'EC'        SEE IF DOING ESTIMATE CHG REPORT             
         BNE   BUY1P                                                            
         CLI   CHGTYP,C'B'         SEE IF NEW BUY                               
         BE    BUY1N5C             YES - DON'T LOOK FOR CHG ELEMS               
         MVI   BYTE,0                                                           
         LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'24'                                                      
BUY1N3   BAS   RE,NEXTEL                                                        
         BNE   BUY1N5                                                           
         USING PCHGELED,R2                                                      
         CLI   PCHGLEN,11          CHANGED FROM 8 TO HANDLE                     
*                                  BOTH 8 AND 11 BYTE NO $ CHG ELEMS            
         BNH   BUY1N3              SEE IF $ CHANGED                             
         CLC   PCHGDAT,PCONTROL    SEE IF CHG BEFORE CONTROL DATE               
         BL    BUY1N3                                                           
         CLI   BYTE,1                                                           
         BE    BUY1N3                                                           
         MVC   OLDGRS(12),PCHGGRS                                               
         MVI   BYTE,1                                                           
         B     BUY1N3                                                           
*                                                                               
         DROP  R2                                                               
BUY1N5   CLI   BYTE,1                                                           
         BE    BUY1N5C             CHG                                          
         MVC   OLDGRS(12),GROSS    NO CHANGE SET OLDGRS TO GROSS                
         B     BUY1N6              NO CHG SO LEAVE CHGGRS ZERO                  
*                                                                               
**NEW 3/23/89                                                                   
BUY1N5C  CLC   PBUYKPRD(3),=C'ZZZ' SEE IF ZZZ BUY                               
         BNE   BUY1N5X                                                          
         CLC   QPRODUCT,=C'ZZZ'    ZZZ REQUEST                                  
         BE    BUY1N5X                                                          
         CLI   QPRODUCT,C' '                                                    
         BE    BUY1N5X                                                          
         LA    R2,PPRDKPRD                                                      
         GOTO1 APRDSHR,DMCB,(R2)                                                
BUY1N5X  DS    0H                                                               
**NEW 3/23/89                                                                   
         L     R1,GROSS                                                         
         S     R1,OLDGRS                                                        
         ST    R1,CHGGRS                                                        
         L     R1,AGYCOM                                                        
         S     R1,OLDAC                                                         
         ST    R1,CHGAC                                                         
         L     R1,CSHDSC                                                        
         S     R1,OLDCD                                                         
         ST    R1,CHGCD                                                         
*                                                                               
BUY1N6   DS    0H                                                               
         CLI   ESCCCON,C'$'        SEE IF SHOWING ONLY $ CHANGES                
         BNE   BUY1P               NO - NORMAL PROCESSING                       
         CLI   CHGTYP,C'B'         SEE IF NEW BUY                               
         BE    BUY1P               PROCESS                                      
         CLI   BYTE,1              SEE IF $ CHANGED                             
         BE    BUY1P                                                            
         CLI   PBDBUYDT,0          WILL BE ZERO IF MADE LIVE (ECT)              
         BE    BUY1P               PROCESS                                      
         B     BUY1N9              NO $ CHANGE PROCESS LIKE NO CHANGE           
**NOTE**                                                                        
*        OLDGRS,AC,CD NOW HAVE CHANGE IN GROSS,AC,CD                            
*                                                                               
BUY1N9   CLI   QOPT5,C'T'          SEE IF TOTALING ONLY CHANGES                 
         BE    EXIT                YES - BYPASS THIS BUY                        
         CLI   QOPT5,C'C'          IF SHOWING ONLY CHANGES                      
         BE    BUY62               SKIP PRINT                                   
         TM    PBUYCNTL,X'80'      SKIP OLD DELETS                              
         BNZ   EXIT                                                             
BUY1NX   DS    0H                                                               
*                                                                               
BUY1P    DS    0H                                                               
         CLI   JOBFILT,C' '                                                     
         BE    *+14                                                             
         CLC   PBDJOB,JOBFILT                                                   
         BNE   EXIT                                                             
         MVI   RDPACT,X'E0'        SET REG/DST/PUB ACTIVE                       
         MVC   SAVBKEY,PBUYKEY                                                  
*                                                                               
BUY2     DS    0H                                                               
         CLI   ESCCONC,C'N'                                                     
         BE    BUY2X                                                            
*                                                                               
         L     R3,RELO                                                          
         GOTO1 =V(BUYCON),RR=R3                                                 
         EJECT                                                                  
*                                                                               
BUY2X    DS    0H                                                               
         SR    RE,RE                                                            
         IC    RE,LINE             GET LINE COUNTER                             
         CLI   P+1,C' '            TEST PUB NAME PRINTED YET                    
         BE    BUY2Y               YES                                          
*                                                                               
* NO - NEED 4 LINES FOR PUB + CONTRACT LINES REQUIRED                           
*                                                                               
         LA    RE,4(RE)                                                         
         CLI   ESCPBAD,C'0'        TEST PUB ADDR TO PRINT                       
         BE    *+8                 NO                                           
         LA    RE,3(RE)            3 LINES FOR PUB ADDR                         
         SR    R0,R0                                                            
         CLI   RDSHRLNC,0                                                       
         BE    *+14                                                             
         IC    R0,RDSHRLNC                                                      
         AR    RE,R0               LINES FOR RD SHARE                           
         LA    RE,1(RE)                                                         
         IC    R0,ACURKLN          SET BY BUYCON                                
         AR    RE,R0                                                            
         LTR   R0,R0               IF NO CON LINES, USE BUY DATA                
         BNZ   BUY2Z                                                            
*                                                                               
* PUB NAME PRINTED. BUY MUST FIT THIS PAGE.                                     
*                                                                               
BUY2Y    DS    0H                                                               
         A     RE,PBYOLNS                                                       
         CLI   ESCDETS,0           TEST 3 $ TO PRINT                            
         BE    BUY2Z               NO                                           
         CLI   QMEDIA,C'N'                                                      
         BE    BUY2Z                                                            
         LA    RE,1(RE)            1 MORE LINE                                  
*                                                                               
BUY2Z    DS    0H                                                               
         CLI   ESCJOB,C'0'                                                      
         BE    BUY2Z1                                                           
         LA    RE,1(RE)            1 FOR COPY NUMBER                            
         CLI   ESCJOB,C'2'                                                      
         BNE   *+8                                                              
         LA    RE,3(RE)            3 MORE FOR CAPTIONS + SPACE                  
*                                                                               
BUY2Z1   DS    0H                                                               
         ZIC   R0,APCHGWK          FOR CHANGE LINES                             
         AR    RE,R0                                                            
         STC   RE,BYTE                                                          
         CLC   BYTE,MAXLINES                                                    
         BNH   *+8                                                              
         MVI   LINE,99                                                          
*                                                                               
         CLI   P+1,C' '            TEST PUB NAME PRINTED YET                    
         BE    BUY3F               YES                                          
*                                                                               
         MVC   SAVPUBN1,P          SAVE PUB LINES                               
         MVC   SAVPUBN2,PSECOND                                                 
         LA    R7,SAVPUBN2+70                                                   
         BAS   RE,ESFLOAT                                                       
         MVC   3(L'PP@CONTP,R7),PP@CONTP                                        
         IC    R3,SPACING                                                       
         CLC   SAVPUBN3,SPACES                                                  
         BE    BUY2Z2                                                           
*                                  SEE IF SAVPUBN3 CAN PRINT                    
*                                  ON PSECOND                                   
         LA    R7,SAVPUBN3+131                                                  
         BAS   RE,ESFLOAT                                                       
         LA    R0,SAVPUBN3-4                                                    
         SR    R7,R0               R7=LEN+3                                     
         EX    R7,*+8                                                           
         B     *+10                                                             
         CLC   PSECOND(0),SPACES                                                
         BNE   BUY2Z1B             WILL NOT FIT                                 
         AHI   R7,-4                                                            
         EX    R7,*+8                                                           
         B     BUY2Z2                                                           
         MVC   PSECOND(0),SAVPUBN3                                              
BUY2Z1B  DS    0H                                                               
         MVI   SPACING,1                                                        
         BAS   RE,ESPRT                                                         
         STC   R3,SPACING                                                       
         MVC   P,SAVPUBN3                                                       
BUY2Z2   DS    0H                                                               
         BAS   RE,ESPRT                                                         
*                                                                               
         CLI   ESCPBAD,C'0'        TEST PUB ADDR OPTION                         
         BE    BUY3B               NO                                           
         CLI   CONSW,0             TEST CONT TO PRINT                           
         BNE   BUY3                YES                                          
         L     RF,AKLINES          NO - PUT ADDR THERE                          
         MVI   0(RF),C' '                                                       
         MVC   30(30,RF),PUBLINE1                                               
         MVC   60(30,RF),PUBLINE2                                               
         B     BUY3B                                                            
*                                                                               
BUY3     DS    0H                                                               
         MVC   P+1(30),PUBLINE1                                                 
         MVC   PSECOND+1(30),PUBLINE2                                           
         CLI   RDSHRLNC,0                                                       
         BNE   BUY3B                                                            
         MVI   SPACING,2                                                        
         BAS   RE,ESPRT                                                         
*                                                                               
BUY3B    DS    0H                                                               
         CLI   RDSHRLNC,0          NO REG/DIST LINES                            
         BE    BUY4                                                             
         LA    R4,P+41             LINE UP OVER DATE                            
         CLI   QMEDIA,C'N'                                                      
         BE    *+8                                                              
         LA    R4,P+39                                                          
*                                                                               
         MVC   0(45,R4),RDSHRLNS                                                
         BAS   RE,ESPRT                                                         
*                                                                               
         BAS   RE,ESPRT                                                         
         B     BUY4                                                             
*                                                                               
BUY3F    DS    0H                                                               
         CLI   CONSW,0                                                          
         BE    BUY4                                                             
         CLC   ACURKLN+1(3),AKLINES+1                                           
         BNE   BUY4                                                             
         MVI   P,0                                                              
         BAS   RE,ESPRT            SKIP BETWEEN CONTRACTS                       
*                                                                               
         SPACE 2                                                                
*                                                                               
BUY4     DS    0H                  SET PRD-EST OR FLAGS                         
         CLI   PRDESTSW,C'T'       T/A                                          
         BNE   BUY4C                                                            
         MVC   P+36(1),CHGTYP                                                   
         B     BUY6                                                             
*                                                                               
BUY4C    DS    0H                                                               
         CLI   PRDESTSW,C'F'       CHANGE FLAGS                                 
         BNE   BUY4F                                                            
         TM    PBUYCNTL,X'80'                                                   
         BZ    BUY4C2                                                           
         MVC   P+33(L'PP@DEL),PP@DEL                                            
         B     BUY6                                                             
BUY4C2   DS    0H                                                               
         CLI   CHGTYP,C'C'                                                      
         BNE   *+10                                                             
         MVC   P+33(L'PP@CHA),PP@CHA                                            
         CLI   CHGTYP,C'B'                                                      
         BNE   *+10                                                             
         MVC   P+33(L'PP@NEW),PP@NEW                                            
         B     BUY6                                                             
*                                                                               
BUY4F    DS    0H                                                               
         CLI   PRDESTSW,C'E'            EST                                     
         BNE   BUY4J                                                            
         MVC   HALF,PBUYKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+33(3),DUB                                                      
         B     BUY4P                                                            
*                                                                               
BUY4J    DS    0H                                                               
         CLI   PRDESTSW,C'P'       PRD                                          
         BNE   BUY4M                                                            
         MVC   P+33(3),PBUYKPRD                                                 
         B     BUY6                                                             
*                                                                               
BUY4M    DS    0H                                                               
         CLI   PRDESTSW,C'B'       BOTH, PRD-EST                                
         BNE   BUY4P                                                            
         MVC   P+31(3),PBUYKPRD                                                 
         MVI   P+34,C'-'                                                        
         MVC   HALF,PBUYKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+35(3),DUB                                                      
         B     BUY6                                                             
*                                                                               
BUY4P    DS    0H                                                               
         EJECT                                                                  
*                                                                               
BUY6     CLI   QMEDIA,C'N'                                                      
         BNE   BUY9                                                             
*                                  NEWSPAPER FORMAT                             
         LA    R1,P+41                                                          
         CLI   PAGYPROF+1,C'L'     TEST PRINT LINE NO.                          
         BE    BUY6A                                                            
         CLC   QPROG,=C'53'                                                     
         BE    *+8                                                              
         LA    R1,2(R1)            NO                                           
BUY6A    DS    0H                                                               
         ST    R1,AIDATE           SAVE ADDR OF INSDATE PRINT                   
         MVC   0(8,R1),PBYOINS                                                  
*                                                                               
***TESTBUY***                                                                   
         CLI   PBDBFD,C'T'         SEE IF A TEST BUY                            
         BNE   BUY6A2                                                           
         BCTR  R1,0                                                             
         MVI   0(R1),C'T'                                                       
         TM    PBDSTAT2,X'40'      STEWARDSHIP BUY ?                            
         BZ    BUY6A2              NO                                           
         MVI   0(R1),C'S'                                                       
***TESTBUY***                                                                   
*                                                                               
BUY6A2   DS    0H                                                               
         MVC   P+52(7),PBYOUNTS    UNITS                                        
         CLI   PBYOSPC,C' '        OR SPACE                                     
         BNH   *+10                                                             
         MVC   P+52(13),PBYOSPC                                                 
         MVC   P+64(8),PBYOUR                                                   
         CLC   PBYOUR,SPACES                                                    
         BNH   BUY6D               UNIT RATE BLANK                              
         CLI   ESCUNET,C'Y'        PROFILE = SHOW UNIT RATE AT NET ?            
         BNE   BUY6D               NO                                           
         LA    R4,P+68             POINT TO "END" OF UNIT RATE OUTPUT           
BUY6B    CLI   0(R4),C' '                                                       
         BNH   BUY6B4                                                           
         BCT   R4,BUY6B                                                         
BUY6B4   MVI   0(R4),C'N'                                                       
BUY6D    LA    R4,P+74                                                          
         MVC   0(11,R4),PBYOPRM                                                 
         LA    R4,P+72                                                          
         LA    R2,ESCDETS                                                       
         LA    R0,3                                                             
BUY7     CLI   0(R2),0                                                          
         BE    BUY8                                                             
         SR    R3,R3                                                            
         IC    R3,0(R2)                                                         
         SLL   R3,2                X4                                           
         BAS   RE,BUYBRTAB-4(R3)                                                
BUY8     LA    R4,12(R4)                                                        
         LA    R2,1(R2)                                                         
         BCT   R0,BUY7                                                          
         B     BUY40                                                            
*                                  MAG FORMAT                                   
BUY9     DS    0H                                                               
         LA    R1,P+39                                                          
         CLI   PAGYPROF+1,C'L'     TEST PRINT LINE NO.                          
         BE    BUY9A0                                                           
         CLC   QPROG,=C'53'                                                     
         BE    *+8                                                              
         LA    R1,2(R1)            NO                                           
BUY9A0   DS    0H                                                               
         ST    R1,AIDATE           SAVE ADDR OF INSDATE PRINT                   
         MVC   0(8,R1),PBYOINS                                                  
*                                                                               
***TESTBUY***                                                                   
         CLI   PBDBFD,C'T'         SEE IF A TEST BUY                            
         BNE   BUY9A                                                            
         BCTR  R1,0                                                             
         MVI   0(R1),C'T'                                                       
         TM    PBDSTAT2,X'40'      STEWARDSHIP BUY ?                            
         BZ    BUY9A               NO                                           
         MVI   0(R1),C'S'                                                       
***TESTBUY***                                                                   
*                                                                               
BUY9A    DS    0H                                                               
*                                                                               
         CLI   ESCDETS,0           TEST 3RD $                                   
         BNE   BUY20               YES                                          
*                                  NO                                           
         MVC   P+48(17),HOLDSPAC                                                
*                                                                               
         CLC   ESCDATS,=X'FFFF'     NO DATES AND NO BILL MONTH                  
         BE    BUY12C                                                           
*                                                                               
         LA    R4,P+66                                                          
         LA    R2,ESCDATS                                                       
         LA    R0,2                                                             
BUY11    CLI   0(R2),0                                                          
         BE    BUY12                                                            
         SR    R3,R3                                                            
         IC    R3,0(R2)                                                         
         SLL   R3,2                X4                                           
         BAS   RE,BUYBRTAB-4(R3)                                                
BUY12    LA    R4,6(R4)                                                         
         LA    R2,1(R2)                                                         
         BCT   R0,BUY11                                                         
*                                                                               
         LA    R4,P+78                                                          
         BAS   RE,BUYBLDT                                                       
*                                                                               
BUY12C   DS    0H                                                               
         LA    R4,P+84                                                          
         LA    R2,ESCDETS+1                                                     
         LA    R0,2                                                             
BUY13    CLI   0(R2),0                                                          
         BE    BUY14                                                            
         SR    R3,R3                                                            
         IC    R3,0(R2)                                                         
         SLL   R3,2                X4                                           
         BAS   RE,BUYBRTAB-4(R3)                                                
BUY14    LA    R4,12(R4)                                                        
         LA    R2,1(R2)                                                         
         BCT   R0,BUY13                                                         
         B     BUY40                                                            
*                                  3 $ FORMAT                                   
BUY20    DS    0H                                                               
*                                                                               
         CLC   ESCDATS,=X'FFFF'     NO DATES AND NO BILL MONTH                  
         BE    BUY22C                                                           
*                                                                               
         LA    R4,P+55                                                          
         LA    R2,ESCDATS                                                       
         LA    R0,2                                                             
BUY21    CLI   0(R2),0                                                          
         BE    BUY22                                                            
         SR    R3,R3                                                            
         IC    R3,0(R2)                                                         
         SLL   R3,2                X4                                           
         BAS   RE,BUYBRTAB-4(R3)                                                
BUY22    LA    R4,6(R4)                                                         
         LA    R2,1(R2)                                                         
         BCT   R0,BUY21                                                         
*                                                                               
         LA    R4,P+67                                                          
         BAS   RE,BUYBLDT                                                       
*                                                                               
BUY22C   DS    0H                                                               
         LA    R4,P+72                                                          
         LA    R2,ESCDETS                                                       
         LA    R0,3                                                             
BUY23    CLI   0(R2),0                                                          
         BE    BUY24                                                            
         SR    R3,R3                                                            
         IC    R3,0(R2)                                                         
         SLL   R3,2                X4                                           
         BAS   RE,BUYBRTAB-4(R3)                                                
BUY24    LA    R4,12(R4)                                                        
         LA    R2,1(R2)                                                         
         BCT   R0,BUY23                                                         
*                                                                               
         CLC   P+55(11),SPACES     TEST ANY DATES                               
         BE    BUY24B                                                           
         CLC   HOLDSPAC+6(11),SPACES         SEE IF IT CAN FIT                  
         BH    BUY40                                                            
         MVC   P+48(6),HOLDSPAC                                                 
         MVI   BYTE,C'S'                                                        
         B     BUY40                                                            
*                                                                               
BUY24B   DS    0H                                                               
         MVC   P+48(17),HOLDSPAC                                                
         MVI   BYTE,C'S'                                                        
         B     BUY40                                                            
         SPACE 3                                                                
BUYBRTAB B     BUYGRS                                                           
         B     BUYNET                                                           
         B     BUYCD                                                            
         B     BUYGLCD                                                          
         B     BUYNLCD                                                          
         B     BUYCLDT                                                          
         B     BUYSLDT                                                          
         B     BUYPYDT                                                          
         DC    32X'00'                                                          
         B     BUYACT                                                           
         DC    12X'00'                                                          
         B     BCHGGRS          GROSS CHANGE                                    
         B     BCHGNET          NET CHANGE                                      
         B     BCHGCD           CD CHANGE                                       
         B     BCHGGLCD         GROSS-CD CHANGE                                 
         B     BCHGNLCD         NET-CD CHANGE                                   
*                                                                               
         DC    4X'00'           FOR FUTURE COST CHG ?                           
*                                                                               
         B     BOLDGRS          GROSS OLD                                       
         B     BOLDNET          NET OLD                                         
         B     BOLDCD           CD OLD                                          
         B     BOLDGLCD         GROSS-CD OLD                                    
         B     BOLDNLCD         NET-CD OLD                                      
*                                                                               
BUYGRS   L     RF,GROSS                                                         
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BUYNET   L     RF,GROSS                                                         
         S     RF,AGYCOM                                                        
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BUYCD    L     RF,CSHDSC                                                        
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BUYGLCD  L     RF,GROSS                                                         
         S     RF,CSHDSC                                                        
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BUYNLCD  L     RF,GROSS                                                         
         S     RF,AGYCOM                                                        
         S     RF,CSHDSC                                                        
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BCHGGRS  L     RF,CHGGRS                                                        
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BCHGNET  L     RF,CHGGRS                                                        
         S     RF,CHGAC                                                         
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BCHGCD   L     RF,CHGCD                                                         
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BCHGGLCD L     RF,CHGGRS                                                        
         S     RF,CHGCD                                                         
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BCHGNLCD L     RF,CHGGRS                                                        
         S     RF,CHGAC                                                         
         S     RF,CHGCD                                                         
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BOLDGRS  L     RF,OLDGRS                                                        
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BOLDNET  L     RF,OLDGRS                                                        
         S     RF,OLDAC                                                         
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BOLDCD   L     RF,OLDCD                                                         
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BOLDGLCD L     RF,OLDGRS                                                        
         S     RF,OLDCD                                                         
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BOLDNLCD L     RF,OLDGRS                                                        
         S     RF,OLDAC                                                         
         S     RF,OLDCD                                                         
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
BUYCLDT  LA    RF,PBDCDATE                                                      
         B     BUYDAT                                                           
*                                                                               
BUYSLDT  LA    RF,PBDSDATE                                                      
         B     BUYDAT                                                           
*                                                                               
BUYPYDT  LA    RF,PBDPDATE                                                      
         B     BUYDAT                                                           
*                                                                               
BUYDAT   ST    RE,SAVERE                                                        
         OC    0(3,RF),0(RF)       TEST ANY DATE                                
         BZR   RE                                                               
         ST    RF,DMCB                                                          
         MVI   DMCB,3                                                           
         GOTO1 DATCON,DMCB,,(4,(R4))                                            
         SPACE 1                                                                
         L     RE,SAVERE                                                        
         BR    RE                                                               
*                                                                               
BUYBLDT  SR    R1,R1                                                            
         CLI   LCHAR,C'L'      ON SALE DATE                         L01         
         BE    LONSLDT                                              L01         
*                                                                   L01         
         IC    R1,PBDBDATE+1                                                    
         MH    R1,=H'3'                                                         
         LA    R1,MONTHS-3(R1)                                                  
         MVC   1(3,R4),0(R1)                                                    
         CLI   QOPT4,C'D'          FULL BILL DATE OPTION                        
         BNER  RE                  NO                                           
         ST    RE,SAVERE                                                        
         GOTO1 DATCON,DMCB,(3,PBDBDATE),(4,(R4))                                
         L     RE,SAVERE                                                        
         BR    RE                                                               
*                                                                               
LONSLDT  OC    PBDSDATE,PBDSDATE    ON-STAND DATE PRESENT         L01           
         BZ    0(RE)                                              L01           
         IC    R1,PBDSDATE+1        ON-STAND DATE                 L01           
         MH    R1,=H'3'                                           L01           
         LA    R1,MONTHS-3(R1)                                    L01           
         MVC   0(3,R4),0(R1)                                      L01           
         SR    R1,R1                                              L01           
         IC    R1,PBDSDATE+2                                      L01           
         CVD   R1,DUB                                             L01           
         OI    DUB+7,X'0F'                                         L01          
         UNPK  3(2,R4),DUB                                         L01          
         BR    RE                                                  L01          
*                                                                  L01          
BUYACT   DS    0H                  ACTUAL COST                                  
         LR    R7,RE                                                            
         MVC   WORK(4),GROSS                                                    
         MVC   WORK+4(4),CSHDSC                                                 
         MVC   WORK+8(4),AGYCOM                                                 
         CLC   PBDBDATE(2),BILADAT     CHK BILLABLE DATE VS EFF DATE            
         BL    BUYACT5                 OF BILLING FORMULA                       
*                                      IF LOW USE DEFAULT FORMULA               
*                                      OF G-CD                                  
         CLI   TAXOPT,C'N'                                                      
         BE    BUYACT3                                                          
         GOTO1 AGETCOST,DMCB,(C'T',BILBASA),WORK,PBUYREC                        
         B     BUYACTX                                                          
*                                                                               
BUYACT3  GOTO1 AGETCOST,DMCB,BILBASA,WORK,PBUYREC                               
         B     BUYACTX                                                          
*                                                                               
BUYACT5  DS    0H                                                               
*                                                                               
         GOTO1 AGETCOST,DMCB,DFLTFORM,WORK,PBUYREC                              
*                                                                               
BUYACTX  L     RF,DMCB+4                                                        
         LR    RE,R7                                                            
         BAS   R7,EDTAMT                                                        
         BR    RE                                                               
*                                                                               
         EJECT                                                                  
BUY40    BAS   RE,ESPRT                                                         
         MVI   PLINSW,0                                                         
*                                                                               
         CLI   PBYOINS2,C' '       TEST 2ND ISN DATE TO PRINT                   
         BNH   BUY40A                                                           
         L     R1,AIDATE                                                        
         MVC   0(8,R1),PBYOINS2                                                 
         BCTR  R1,R0                                                            
         MVI   0(R1),C'+'                                                       
         B     BUY40A5                                                          
*                                                                               
BUY40A   DS    0H                                                               
         CLC   PBYOISNM,SPACES     TEST ISSUE NAME TO PRINT                     
         BE    BUY40A3                                                          
*                                                                               
         L     R1,AIDATE                                                        
         CLI   PAGYPROF+1,C'L'     TEST PRINT LINE NO.                          
         BE    BUY40A1                                                          
         CLC   QPROG,=C'53'                                                     
         BE    BUY40A1                                                          
         AHI   R1,-2                                                            
BUY40A1  DS    0H                                                               
         CLC   PBYOISNM+8(3),SPACES                                             
         BNE   BUY40A2                                                          
*                                                                               
         MVC   0(11,R1),PBYOISNM                                                
         B     BUY40A5                                                          
*                                                                               
BUY40A2  DS    0H                                                               
         AHI   R1,-3                                                            
         MVC   0(11,R1),PBYOISNM                                                
         B     BUY40A5                                                          
*                                                                               
BUY40A3  DS    0H                                                               
         CLI   QMEDIA,C'N'         NEWSPAPERS ONLY                              
         BNE   BUY40A5                                                          
         CLI   ESCDAY,C'Y'         SEE IF SHOWING DAY OF WEEK                   
         BNE   BUY40A5             NO                                           
         CLI   PBUYKDAT+2,0                                                     
         BE    BUY40A5             NO DAY                                       
         CLC   PBYOBFD,SPACES                                                   
         BNE   BUY40A5             BEST FOOD DAY OR WEEK OF                     
*                                  DON'T SHOW DAY                               
*                                                                               
         GOTO1 DATCON,DMCB,(3,PBUYKDAT),(0,WORK)                                
         GOTO1 GETDAY,DMCB,WORK,WORK+6                                          
         L     R1,AIDATE                                                        
         MVC   0(3,R1),WORK+6                                                   
BUY40A5  DS    0H                                                               
         CLI   QMEDIA,C'N'                                                      
         BNE   BUY42                                                            
*                                                                               
         LA    RF,P+52                                                          
         MVC   0(10,RF),PBYOSPC2    MAY HAVE 2ND SPACE LINE                     
         CLI   ESCDETS,0           TEST 3RD $                                   
         BE    BUY40C              NO                                           
*                                  YES -  SEE IF PREM                           
         CLI   0(RF),C' '                                                       
         BNH   BUY40B                                                           
*                                                                               
         LA    RF,P+52+18                                                       
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         LA    RF,3(RF)                                                         
BUY40B   DS    0H                                                               
         MVC   0(11,RF),PBYOPRM                                                 
BUY40C   DS    0H                                                               
         CLC   P,SPACES                                                         
         BNE   BUY44                                                            
         B     BUY46                                                            
*                                                                               
BUY42    DS    0H                                                               
         CLI   ESCDETS,0           TEST 3RD $                                   
         BE    BUY40C               NO                                          
         CLI   BYTE,C'S'           TEST ALREADY PRINTED DESC                    
         BE    BUY46               YES                                          
         MVC   P+48(17),HOLDSPAC                                                
*                                                                               
BUY44    BAS   RE,ESPRT                                                         
         MVI   PLINSW,1                                                         
BUY46    DS    0H                                                               
*                                                                               
* BFD OR W/O COMMENT                                                            
         LA    R4,P+52                                                          
         CLI   QMEDIA,C'N'                                                      
         BE    BUY46D                                                           
         LA    R4,P+48                                                          
*                                                                               
         CLC   PBYOSPC2,SPACES                                                  
         BNH   BUY46D                                                           
         MVC   0(17,R4),PBYOSPC2                                                
         BAS   RE,ESPRT                                                         
*                                                                               
BUY46D   DS    0H                                                               
*                                                                               
         CLC   PBYOBFD,SPACES                                                   
         BE    BUY46H                                                           
         MVC   0(L'PBYOBFD,R4),PBYOBFD                                          
         BAS   RE,ESPRT                                                         
         MVI   PLINSW,1                                                         
*                                                                               
BUY46H   DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'81'        CHECK FOR DLC ELEM                            
         BAS   RE,NEXTEL                                                        
         BNE   BUY46J                                                           
         MVC   0(10,R4),=C'DLC (000)='                                          
         EDIT  (P6,2(R2)),(7,10(R4)),0,COMMAS=YES,ALIGN=LEFT                    
         MVI   PLINSW,1                                                         
         BAS   RE,ESPRT                                                         
*                                                                               
BUY46J   DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'85'        CHECK FOR RPT ELEM                            
         BAS   RE,NEXTEL                                                        
         BNE   BUY46L                                                           
         MVC   0(4,R4),=C'RPT='                                                 
         EDIT  (P3,2(R2)),(3,4(R4)),0,ALIGN=LEFT,ZERO=NOBLANK                   
         MVI   PLINSW,1                                                         
         BAS   RE,ESPRT                                                         
*                                                                               
BUY46L   DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'83'        CHECK FOR REF ELEM                            
         BAS   RE,NEXTEL                                                        
         BNE   BUY46M                                                           
         ZIC   R1,1(R2)                                                         
         AHI   R1,-3               ELCODE + LEN + 1 FOR EX                      
         EX    R1,*+8                                                           
         B     *+10                                                             
         CLC   2(0,R2),SPACES                                                   
         BNH   BUY46M                                                           
         MVC   0(4,R4),=C'REF='                                                 
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   4(0,R4),2(R2)                                                    
         MVI   PLINSW,1                                                         
         BAS   RE,ESPRT                                                         
*                                                                               
BUY46M   LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'82'        CHECK FOR FSI ELEM                            
         BAS   RE,NEXTEL                                                        
         BNE   BUY46N                                                           
         USING PBFSIELD,R2                                                      
         CP    PBFSI,=P'0'                                                      
         BE    BUY46N                                                           
         MVC   0(4,R4),=C'FSI='                                                 
         EDIT  PBFSI,(10,4(R4)),0,COMMAS=YES,ALIGN=LEFT                         
         MVI   PLINSW,1                                                         
         BAS   RE,ESPRT                                                         
         DROP  R2                                                               
*                                                                               
BUY46N   LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'87'        CHECK FOR PV ELEM                             
         BAS   RE,NEXTEL                                                        
         BNE   BUY46P                                                           
         CP    2(5,R2),=P'0'                                                    
         BE    BUY46P                                                           
         MVC   0(3,R4),=C'PV='                                                  
         EDIT  (P5,2(R2)),(10,3(R4)),0,COMMAS=YES,ALIGN=LEFT                    
         MVI   PLINSW,1                                                         
         BAS   RE,ESPRT                                                         
*                                                                               
BUY46P   LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'88'        CHECK FOR CT ELEM                             
         BAS   RE,NEXTEL                                                        
         BNE   BUY46Q                                                           
         CP    2(5,R2),=P'0'                                                    
         BE    BUY46Q                                                           
         MVC   0(3,R4),=C'CT='                                                  
         EDIT  (P5,2(R2)),(10,3(R4)),0,COMMAS=YES,ALIGN=LEFT                    
         MVI   PLINSW,1                                                         
         BAS   RE,ESPRT                                                         
*                                                                               
BUY46Q   DS    0H                 ESTIMATED AND ACTUAL IMPRESSIONS              
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'92'        IMPRESSION ELEM (IMPS OR EIMPS)               
         BAS   RE,NEXTEL                                                        
         BNE   BUY46Q30                                                         
         MVC   0(15,R4),=C'ESTIMATED IMPS='                                     
*                                                                               
         OC    EIMPSTOT,EIMPSTOT   POSSIBLE THAT TOTAL IS CLEARED               
         BNZ   *+10                                                             
         ZAP   EIMPSTOT,=P'0'                                                   
*                                                                               
         AP    EIMPSTOT,2(5,R2)                                                 
         EDIT  (P5,2(R2)),(11,15(R4)),0,COMMAS=YES,ALIGN=LEFT,         +        
               ZERO=NOBLANK                                                     
         MVI   PLINSW,1                                                         
         BAS   RE,ESPRT                                                         
*                                                                               
BUY46Q30 LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'93'        ACTUAL IMPRESSION (AIMPS)                     
         BAS   RE,NEXTEL                                                        
         BNE   BUY46R                                                           
         MVC   0(12,R4),=C'ACTUAL IMPS='                                        
*                                                                               
         OC    AIMPSTOT,AIMPSTOT   POSSIBLE THAT TOTAL IS CLEARED               
         BNZ   *+10                                                             
         ZAP   AIMPSTOT,=P'0'                                                   
*                                                                               
         AP    AIMPSTOT,2(5,R2)                                                 
         EDIT  (P5,2(R2)),(11,12(R4)),0,COMMAS=YES,ALIGN=LEFT,         +        
               ZERO=NOBLANK                                                     
         MVI   PLINSW,1                                                         
         BAS   RE,ESPRT                                                         
*                                                                               
BUY46R   DS    0H          FOR FUTURE USES                                      
*                                                                               
BUY46U   DS    0H          CHECK FOR (SFH) SPECIAL FINANCIAL HANDLING           
*                                                                               
         TM    PBDSTAT,X'04'       SFH BUY ?                                    
         BNO   BUY47               NO                                           
         MVC   0(8,R4),=C'SFH=HOLD'                                             
         TM    PBDSTAT,X'08'       BUY HELD ?                                   
         BO    *+10                YES                                          
         MVC   4(7,R4),=C'RELEASE' REPLACE "HOLD"                               
         MVI   PLINSW,1                                                         
         BAS   RE,ESPRT                                                         
*                                                                               
BUY47    DS    0H                                                               
* REGULAR COMMENT                                                               
         LA    R2,PBYOCOMS                                                      
         LA    R3,5                                                             
BUY47D   DS    0H                                                               
         CLC   0(47,R2),SPACES                                                  
         BNH   BUY48                                                            
*                                                                               
         CLI   ESCSKIP,0           SKIP COMMENT IF 1ST CHAR =                   
         BNH   BUY47J              NO                                           
         CLI   ESCSKIP,C'N'        SKIP COMMENT IF 1ST CHAR =                   
         BE    BUY47J              NO                                           
         CLC   ESCSKIP,0(R2)       SKIP COMMENT IF 1ST CHAR =                   
         BE    BUY47S              YES                                          
*                                                                               
BUY47J   MVC   0(47,R4),0(R2)                                                   
         MVI   PLINSW,1                                                         
         BAS   RE,ESPRT                                                         
BUY47S   DS    0H                                                               
         LA    R2,47(R2)                                                        
         BCT   R3,BUY47D                                                        
*                                                                               
BUY48    DS    0H                                                               
*                                  PRINT REASONS FOR CHANGE                     
         CLI   ESCCHGS,C'Y'                                                     
         BNE   BUY49                                                            
*                                                                               
         CLI   CHGTYP,C'C'                                                      
         BNE   BUY49                                                            
         ZIC   R2,APCHGWK          NO. OF LINES                                 
         LTR   R2,R2                                                            
         BNP   BUY49                                                            
         L     R3,APCHGWK                                                       
BUY48B   DS    0H                                                               
         MVC   0(40,R4),0(R3)                                                   
         MVI   PLINSW,1                                                         
         BAS   RE,ESPRT                                                         
         LA    R3,40(R3)                                                        
         BCT   R2,BUY48B                                                        
*                                                                               
BUY49    DS    0H                                                               
         EJECT                                                                  
* FORMAT POOL ALLOCATIONS                                                       
*                                                                               
BUY50    CLC   PBUYKPRD,=C'ZZZ'                                                 
         BNE   BUY60                                                            
         CLC   PPRDKPRD,=C'ZZZ'    ALWAYS SHOW ALLOCATIONS FOR POL              
         BE    BUY51                                                            
* FIRST CHECK FOR 2 PRDS OR MORE                                                
         MVI   ELCOD,X'21'                                                      
         LA    R2,PBUYREC+33                                                    
         BAS   RE,NEXTEL                                                        
         BAS   RE,NEXTEL           MUST GET HERE SINCE AT LEAST 1 PRD           
         BNE   BUY60               BUT IF NO MORE GET OUT                       
* ELSE FORMAT ALLOCATIONS                                                       
BUY51    DS    0H                                                               
         CLI   QEST,C' '                                                        
         BE    BUY51A                                                           
         CLI   QESTEND,C' '                                                     
         BNE   BUY51A                                                           
         CLC   PESTZZZ,PBYOZZZ                                                  
         BE    BUY60                                                            
BUY51A   DS    0H                                                               
         MVC   0(50,R4),PBYOZZZ                                                 
                                                                                
         LA    R2,PESTREC+33                                                    
         MVI   ELCOD,X'66'                                                      
         BAS   RE,NEXTEL                                                        
         BNE   BUY51B                                                           
*                                                                               
         USING PESTALLX,R2                                                      
         CLC   PEALLZZZ,SPACES                                                  
         JNH   BUY51B                                                           
         MVC   0(160,R4),PBYOZZZ                                                
         DROP  R2                                                               
*                                                                               
BUY51B   BAS   RE,ESPRT                                                         
         MVI   PLINSW,1                                                         
         SPACE 3                                                                
*                                  COPY NO. AND CAPTION                         
BUY60    DS    0H                                                               
         CLI   JOBFILT,C' '        IF HAVE JOB FILTER                           
         BNE   BUY61               - NO JOB INFO AT BUY LEVEL                   
         CLC   PBDJOB,PESTJOB      OR IF SAME AS PESTJOB                        
         BE    BUY61                                                            
         OC    PBDJOB,PBDJOB                                                    
         BZ    BUY61                                                            
         CLI   ESCJOB,C'0'                                                      
         BE    BUY61                                                            
         CLI   ESCJOB,C'A'         AD NO. ONLY                                  
         BE    BUY60B                                                           
         GOTO1 AFNDJOB                                                          
*                                                                               
         L     R3,DMCB             A(JOB INFO)                                  
         LTR   R3,R3                                                            
         BZ    BUY61                                                            
*                                                                               
BUY60B   DS    0H                                                               
         TM    ESCJOB,X'30'                                                     
         BNZ   BUY60C                                                           
         MVC   0(L'PP@ADNO,R4),PP@ADNO                                          
         MVC   9(6,R4),PBDJOB                                                   
         B     BUY60D                                                           
*                                                                               
BUY60C   DS    0H                                                               
         MVC   0(L'PP@COPY,R4),PP@COPY                                          
         MVC   7(17,R4),9(R3)                                                   
BUY60D   DS    0H                                                               
         BAS   RE,ESPRT                                                         
         MVI   PLINSW,1                                                         
*                                                                               
         TM    ESCJOB,X'02'                                                     
         BZ    BUY61                                                            
*                                                                               
         MVC   000(25,R4),26(R3)   CAP1                                         
         BAS   RE,ESPRT                                                         
         CLC   51(25,R3),SPACES                                                 
         BE    *+14                                                             
         MVC   000(25,R4),51(R3)   CAP 2                                        
*                                                                               
         BAS   RE,ESPRT                                                         
         MVI   PLINSW,1                                                         
*                                                                               
BUY61    DS    0H                                                               
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'98'        CHECK FOR SITE LOC ELEM                       
         BAS   RE,NEXTEL                                                        
         BNE   BUY61A                                                           
         MVC   0(5,R4),=C'SITE='                                                
         MVC   5(20,R4),2(R2)                                                   
         MVI   PLINSW,1                                                         
         BAS   RE,ESPRT                                                         
*                                                                               
BUY61A   DS    0H                  FIRST SEE IF BUY HAS ADD'L CHARGES           
         LA    R2,PBUYREC+33                                                    
*                                                                               
BUY61B   CLI   0(R2),0             EOR ?                                        
         BE    BUY61X              YES - DONE - NO ADD'L CHARGES FOUND          
         CLI   0(R2),X'44'         ADD'L. CHG. ELEMENT ?                        
         BE    BUY61D              YES - CONTINUE                               
         ZIC   R0,1(R2)            BUMP TO NEXT ELEMENT                         
         AR    R2,R0                                                            
         B     BUY61B                                                           
*                                                                               
BUY61D   DS    0H                  PRINT ADDITIONAL CHARGES (IF FOUND)          
         GOTO1 =A(DOADCG)                                                       
*                                                                               
BUY61X   DS    0H                                                               
         CLI   PLINSW,0                                                         
         BE    BUY62                                                            
         BAS   RE,ESPRT            SKIP A LINE IF MULT LINES FOR BUY            
*                                                                               
* POST TO ACCUMULATORS                                                          
*                                                                               
BUY62    DS    0H                                                               
         MVI   ESTACTIV,C'A'       SET ACTIVITY FOR REQ                         
*                                  HERE FOR BUYS THAT DONT PRINT                
         CLC   QPROG,=C'EC'        MUST PASS DELETES FOR EST CHANGE             
         BE    BUY65                                                            
         TM    PBUYCNTL,X'80'      BYPASS DELETES                               
         BNZ   EXIT                                                             
BUY65    GOTO1 ABUYACC                                                          
*                                                                               
         B     EXIT                                                             
*                                                                               
***********************************************************************         
*                                                                               
         EJECT                                                                  
* LAST BUY FOR CONTRACT                                                         
*                                                                               
ENDCNT   DS    0H                                                               
         B     EXIT                                                             
         SPACE 2                                                                
* LAST BUY FOR PUB                                                              
*                                                                               
*                                                                               
*                                                                               
ENDPUB   NTR1                                                                   
         SPACE 2                                                                
         MVC   P,SPACES                                                         
         MVC   PSECOND,SPACES                                                   
         MVI   MAXLINES,99                                                      
         MVI   CONSW,0                                                          
         TM    RDPACT,X'20'        TEST PUB ACTIVITY                            
         BZ    ENDP2               NO                                           
ENDP1    DS    0H                                                               
         L     RE,ACURKLN          PRINT ANY REMAINING K LINES                  
         CLI   0(RE),0                                                          
         BE    ENDP1B                                                           
         BAS   RE,ESPRT                                                         
         B     ENDP1                                                            
ENDP1B   DS    0H                                                               
         CLI   QOPT5,C'C'          IF PRINTING ONLY CHANGES                     
         BE    ENDP1D                                                           
         CLI   QOPT5,C'T'          OR TOTALING CHANGES ONLY                     
         BNE   *+8                                                              
ENDP1D   BAS   RE,ESPRT            SKIP A LINE                                  
         LH    RF,PBRCNT           BUMP PUB COUNT                               
         LA    RF,1(RF)                                                         
         STH   RF,PBRCNT                                                        
         LH    RF,EDITCNT          BUMP EDITION COUNT                           
         LA    RF,1(RF)                                                         
         STH   RF,EDITCNT                                                       
*                                  ASSURE THAT PUB TOTALS PRINT                 
         L     RF,APUBTOT                                                       
         MVI   ACCL-1(RF),X'1C'                                                 
         L     RF,AVENTOT                                                       
         MVI   ACCL-1(RF),X'1C'                                                 
*                                                                               
ENDP2    DS    0H                                                               
         L     RE,AKLINES          CLEAR K LINES                                
         LA    RF,120*30                                                        
         XCEF                                                                   
         MVC   ACURKLN,AKLINES                                                  
         XC    CONWRK,CONWRK                                                    
         TM    ESCPBTOT,X'04'       TEST ED/VEN TOTALS                          
         BZ    ENDP4               ONLY VENDOR                                  
         CLI   MODE,LBUYVEN                                                     
         BNE   ENDP6                                                            
         CLI   EDITCNT+1,1         YES- TEST MULTIPLE EDITS                     
         BE    ENDP4               NO                                           
         MVI   EDVENSW,C'E'        YES                                          
         GOTO1 AENDPUB                                                          
*                                                                               
         TM    RDPACT,X'20'                                                     
         BZ    ENDP4                                                            
         BAS   RE,ENDPPRT            SKIP A LINE                                
ENDP4    DS    0H                                                               
         MVI   EDVENSW,C'V'                                                     
         GOTO1 AENDPUB                                                          
*                                                                               
         XC    EDITCNT,EDITCNT                                                  
         B     ENDP8                                                            
ENDP6    DS    0H                                                               
         MVI   EDVENSW,C'E'                                                     
         GOTO1 AENDPUB                                                          
*                                                                               
ENDP8    DS    0H                                                               
         NI    RDPACT,X'D0'        CLEAR PUB ACTIVITY                           
         B     EXIT                                                             
*                                                                               
ENDPPRT  DS    0H                                                               
         CLI   QOPT5,C'C'          IF PRINTING ONLY CHANGES                     
         BER   RE                  NO PUB TOTS                                  
         CLI   QOPT5,C'T'          OR TOTALING CHANGES ONLY                     
         BER   RE                                                               
         B     ESPRT                                                            
*                                                                               
         SPACE 2                                                                
ENDMKT   DS    0H                                                               
         CLI   PBRCNT+1,1          TEST MULTIPLE PUBS                           
         MVI   PBRCNT+1,0                                                       
         BNH   ENDMKT2             NO                                           
         MVI   EDVENSW,C'M'                                                     
         MVI   FORCEHED,C'N'       NO AUTO NEW PAGE                             
         BAS   RE,ENDPPRT          SKIP A LINE                                  
         GOTO1 AENDPUB                                                          
ENDMKT2  DS    0H                                                               
         L     R2,AMKTTOT                                                       
         BAS   RE,CLRTOT                                                        
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
***********************************************************************         
*                                                                               
NEXTEL   DS    0H                                                               
         SR    R0,R0                                                            
         IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTELX                                                          
         CLC   0(1,R2),ELCOD                                                    
         BCR   8,RE                                                             
         B     NEXTEL                                                           
NEXTELX  LTR   R2,R2                                                            
         BR    RE                                                               
*                                                                               
***********************************************************************         
*                                                                               
         SPACE 2                                                                
EDTAMT   DS    0H                                                               
         CVD   RF,DUB              SO EDIT WILL NOT CLOBBER R0                  
         MVI   MYCTAB+3,2                                                       
         ST    RE,SAVERE1                                                       
         ST    RF,SAVERF                                                        
         ST    R1,SAVER1                                                        
         CURED (P8,DUB),(12,(R4)),MYCTAB,FLOAT=-,MODADDR=ACUREDIT               
         L     R1,SAVER1                                                        
         L     RF,SAVERF                                                        
         L     RE,SAVERE1                                                       
         BR    R7                                                               
*                                                                               
         SPACE 2                                                                
***********************************************************************         
*                                                                               
* LINK TO REPORT WITH HEADLINES ALWAYS SET                                      
*                                                                               
ESPRT    DS    0H                                                               
         CLC   P(3),SPACES         CAN CON DATA GO ON THIS LINE                 
         BNE   ESPRT1              NO                                           
*                                                                               
* SEE IF MORE CONTRACT DATA TO PRINT                                            
*                                                                               
         L     RF,ACURKLN                                                       
         CLI   0(RF),0             IS DATA THERE                                
         BE    ESPRT1              NO                                           
         MVC   P+1(30),0(RF)                                                    
         LA    RF,30(RF)                                                        
         ST    RF,ACURKLN                                                       
*                                                                               
ESPRT1   DS    0H                                                               
*                                                                               
         CLC   QPROG,=C'EC'        SEE IF DOING EST CHANGE SUMMARY              
         BNE   ESPRT3                                                           
         LA    R1,HEAD7+36                                                      
         CLI   QREGION,C' '        SEE IF DOING REGION/DISTRICT                 
         BNE   ESPRT2                                                           
         LA    R1,HEAD6+45                                                      
*                                                                               
ESPRT2   MVC   0(L'PP@CHASM,R1),PP@CHASM                                        
*                                                                               
ESPRT3   MVC   HEAD8,MYHEAD8                                                    
         MVC   HEAD9,MYHEAD9                                                    
         MVC   HEAD10,MYHEAD10                                                  
*                                                                               
ESPRT4   LR    R0,RE                                                            
         CLI   COMSW,0                                                          
         BNE   ESPRT6                                                           
         MVI   COMSW,C'E'                                                       
         GOTO1 ACOMPRT                                                          
         SPACE 1                                                                
ESPRT6   DS    0H                                                               
         CLC   P(6),SAVPUBN1                                                    
         BE    *+16                                                             
         MVC   MID1,SAVPUBN1                                                    
         MVC   MID2,SAVPUBN2                                                    
         GOTO1 APRNT                                                            
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
***********************************************************************         
*                                                                               
CLRTOT   DS    0X                                                               
         ST    R2,FULL                                                          
         LA    RF,191                                                           
         ZAP   0(8,R2),=P'0'                                                    
         LA    R2,8(R2)                                                         
         BCT   RF,*-10                                                          
         L     R2,FULL                                                          
         BR    RE                                                               
*                                                                               
***********************************************************************         
*                                                                               
         SPACE 3                                                                
*                                                                               
DFLTFORM DC    X'0505000000'          DEFAULT BILLING FORMULA                   
*                                                                               
         LTORG                                                                  
SVQCARD  DS    CL80                SAVED REQUEST CARD                           
         EJECT                                                                  
*                                                                               
PRNT     DS    0H                                                               
         USING PRNT,RF                                                          
         STM   RE,RF,REPRESV                                                    
         MVI   ESTACTIV,C'A'       SET ACTIVITY FOR REQUEST                     
         CLI   PRNTSW,C'N'                                                      
         BE    PRNT1                                                            
         LA    RE,SPAGE                                                         
         CLI   PRNTSW,C'S'                                                      
         BE    PRNT2                                                            
         CLI   QOPT3,C'S'          TEST PRINT ONLY SUMMARIES                    
         BE    PRNT1                                                            
         LA    RE,RPAGE                                                         
         B     PRNT2B                                                           
PRNT1    DS    0H                                                               
         MVC   P,SPACES                                                         
         B     PRNT5                                                            
PRNT2    DS    0H                                                               
         CLI   QOPT3,C'P'          PAGING OPT                                   
         BE    *+8                                                              
         LA    RE,RPAGE                                                         
PRNT2B   DS    0H                                                               
         MVC   PAGE,0(RE)                                                       
         MVC   HEAD1+42(25),MEDIANM                                             
         MVC   HEAD2+42(25),MEDIAUL                                             
         MVC   HEAD4+42(25),PERHD                                               
*                                                                               
         CLI   QPRODUCT,C' '                                                    
         BNE   *+8                                                              
         MVI   PPRDKEY+1,0         NO PRD IN HEADLINE                           
         CLI   PESTKEY,0                                                        
         BE    PRNT2D                                                           
         CLC   QEST(6),SPACES      SEE IF ESTIMATES TOGETHER                    
         BE    PRNT2D                                                           
         CLC   QEST,SPACES                                                      
         BNE   PRNT2C                                                           
         CLC   QESTEND,SPACES      SEE IF DOING FILTERS                         
*                                  WITH NO ESTIMATE                             
         BNE   PRNT2D              YES - THEN NO PESTNAM2                       
PRNT2C   LA    RE,HEAD6+1                                                       
         CLI   PESTNAM2,C' '                                                    
         BNH   *+14                                                             
         MVC   13(20,RE),PESTNAM2                                               
         LA    RE,132(RE)                                                       
         CLI   PESTREVN,C' '                                                    
         BNH   PRNT2D                                                           
         MVC   0(L'PP@REVIS,RE),PP@REVIS                                        
         MVC   9(3,RE),PESTREVN                                                 
PRNT2D   DS    0H                                                               
***TESTBUY***                                                                   
         CLI   FCRDTEST,C'Y'                                                    
         BNE   PRNT2D5                                                          
         MVC   HEAD6+75(L'PP@INCPI),PP@INCPI                                    
         CLI   QMEDIA,C'O'                                                      
         BNE   PRNT2D5                                                          
         MVC   HEAD6+98(L'PP11POST),PP11POST                                    
*                                                                               
PRNT2D5  CLC   QPROG,=C'53'         SEE IF T/A                                  
         BE    PRNT2E                                                           
         CLI   FCRDTEST,C'Y'        SEE IF READING TEST BUYS                    
         BNE   *+8                                                              
         MVI   HEAD5+94,C'T'        MAKE REPORT 52T                             
***TESTBUY***                                                                   
PRNT2E   GOTO1 REPORT                                                           
         L     RF,REPRFSV                                                       
*                                                                               
         LA    RE,RPAGE                                                         
         CLI   PRNTSW,C'S'                                                      
         BNE   PRNT4                                                            
         CLI   QOPT3,C'P'                                                       
         BNE   PRNT4                                                            
         LA    RE,SPAGE                                                         
PRNT4    DS    0H                                                               
         MVC   0(2,RE),PAGE                                                     
*                                                                               
PRNT5    DS    0H                                                               
         L     RE,REPRESV                                                       
         BR    RE                                                               
*                                                                               
         SPACE 3                                                                
         LTORG                                                                  
         DROP  RF                                                               
         SPACE 3                                                                
DCLIST   DS    0C                                                               
         DCDDL PP#NODGN,17                                                      
         DCDDL PP#CIRCS,5                                                       
         DCDDL PP#PUBL,5                                                        
         DCDDL PP#CONTP,11                                                      
         DCDDL PP#DEL,5                                                         
         DCDDL PP#CHA,5                                                         
         DCDDL PP#NEW,7                                                         
         DCDDL PP#ADNO,8                                                        
         DCDDL PP#COPY,6                                                        
         DCDDL PP#CHASM,16                                                      
         DCDDL PP#REVIS,8                                                       
         DCDDL PP#INCPI,34                                                      
         DCDDL PP#POST,12,LABEL=PP11POST                                        
         DCDDL PP#MONTI,36                                                      
         DCDDL PP#DAYTI,21                                                      
DCLISTX  DC    X'00'                                                            
DSLIST   DS    0C                                                               
         DSDDL PRINT=YES                                                        
         PRINT GEN                                                              
DSLISTX  EQU   *                                                                
         PRINT NOGEN                                                            
         SPACE 4                                                                
ACONS    DS    0F                                                               
         DC    V(PUBTOT)                                                        
         DC    V(VENTOT)                                                        
         DC    V(MKTTOT)                                                        
         DC    V(DSTTOT)                                                        
         DC    V(REGTOT)                                                        
         DC    V(ESTTOT)                                                        
         DC    V(PRDTOT)                                                        
         DC    V(DIVTOT)                                                        
         DC    V(CLTTOT)                                                        
         DC    V(XMDTOT)                                                        
         DC    V(DSTTOTB)                                                       
         DC    V(REGTOTB)                                                       
         DC    V(ESTTOTB)                                                       
         DC    V(PRDTOTB)                                                       
         DC    V(DIVTOTB)                                                       
         DC    V(CLTTOTB)                                                       
         DC    V(XMDTOTB)                                                       
         DC    V(BRDTOT)                                                        
         DC    V(BRDTOTX)                                                       
         DC    V(BRDTOTB)                                                       
         DC    V(BRDTOTBX)                                                      
         DC    V(PRDTAB)                                                        
         DC    V(PRDTABX)                                                       
         DC    V(KLINES)                                                        
         DC    V(SPCTAB)                                                        
         DC    V(SPCTABX)                                                       
         DC    V(JOBLST)                                                        
         DC    V(ESSUM)                                                         
         DC    V(BRDSUM)                                                        
         DC    V(RATELOOK)                                                      
         DC    V(PPBUYCHG)                                                      
         DC    V(SUMFMT)                                                        
         DC    V(COMPRT)                                                        
         DC    V(WFMOD)                                                         
         DC    A(PRDSHR)                                                        
         DC    V(GETUSER)                                                       
         DC    A(ENDPUBC)                                                       
         DC    V(ENDPTOT)                                                       
         DC    V(GETBUD)                                                        
         DC    V(BUYACC)                                                        
         DC    A(PRNT)                                                          
         DC    V(PBYOWK)                                                        
         DC    V(PPCHGWK)                                                       
         DC    V(GETCOST)                                                       
         DC    V(FNDJOB)                                                        
         DC    V(RTLKELS)                                                       
         DC    V(PPGETCG)                                                       
ACONX    EQU   *                                                                
         LTORG                                                                  
         EJECT                                                                  
**********************************************************************          
*        03/05 - WAS PART OF NEWREQ AT TOP OF PROGRAM                *          
**********************************************************************          
NEWRQBRA NTR1  BASE=*,LABEL=*                                                   
         XC    DMCB,DMCB                                                        
         LA    R1,DMCB                                                          
         USING DICTATED,R1                                                      
         MVI   DDACTN,DDACTNL                                                   
         MVI   DDRETN,DDCASEU                                                   
         MVI   DDSYS,4                                                          
         MVC   DDLANG,RCLANG                                                    
         LA    RF,DCLIST                                                        
         STCM  RF,7,DDIADR                                                      
         LA    RF,DSLIST                                                        
         STCM  RF,7,DDOADR                                                      
         GOTO1 ADICTATE                                                         
         DROP  R1                                                               
*                                                                               
         MVC   MONTHS,PP@MONTI                                                  
***TESTBUY***                                                                   
*                                                                               
         CLI   RCMULTIQ,C'Y'       SEE IF MEDIA * REQUEST                       
         BNE   NEWR1                                                            
         CLI   FMULTMED,C' '       SEE IF A MEDIA ALREADY FOUND                 
         BH    NEWR1C                                                           
         MVC   FMULTMED,QMEDIA     SAVE FIRST MEDIA                             
*                                                                               
NEWR1    MVI   FCRDTEST,C'N'                                                    
         TM    QUESTOR,X'40'       SEE IF INCLUDING TEST BUYS                   
         BNZ   *+8                                                              
         MVI   FCRDTEST,C'Y'                                                    
         OI    QUESTOR,X'40'       FOR PRINTING                                 
         MVC   SVQOPT5,QOPT5       SAVE 'REAL' QOPT5 - FOR EC                   
*                                  QOPT5 GETS RESET IN ESMONTHS                 
NEWR1C   DS    0H                                                               
*                                                                               
         L     RF,PPWORK2C                                                      
         USING PPWORK2D,RF                                                      
*                                                                               
         CLI   QOPTA,C' '          STEWARDSHIP BUYS REQUESTED ?                 
         BNH   *+8                 NO - LEAVE FCRDTEST AS IS                    
         MVI   FCRDTEST,C'Y'       MAKE SURE TO INCLUDE "TEST" BUYS             
*                                                                               
         DROP  RF                                                               
***TESTBUY***                                                                   
         MVI   BTDOPT,C'N'                                                      
         MVI   CNTLSET,C'N'                                                     
         CLC   QCNTLDT(3),=X'000000'         BILLED TODAY FEATURE               
         BNE   NEWR2                                                            
         MVC   RQBILLDT(2),RCDATE+6                                             
         MVC   RQBILLDT+2(2),RCDATE                                             
         MVC   RQBILLDT+4(2),RCDATE+3                                           
*                                     MUST GET INTO DDS FORMAT                  
         GOTO1 DATCON,DMCB,RQBILLDT,RQBILLDT                                    
         MVC   QCNTLDT(3),=C'   '            RESET CONTROL DATE                 
         MVI   BTDOPT,C'Y'         SET DOING BILLED TODAY REQUEST               
*                                                                               
*  NOTE PPG WILL SET QCNTLDT TO DATE OF LAST BILLING OR SPACES                  
*  IF THERE WAS NO BILLING                                                      
*                                                                               
NEWR2    DS    0H                                                               
*                                                                               
NEWR5    MVI   CONSW,0                                                          
         MVI   BUDSW,0                                                          
         MVI   LINE,200            FORCE NEW PAGE                               
         MVC   SPAGE,=H'1'                                                      
         MVC   RPAGE,=H'1'                                                      
         L     RF,ALISREC          CLEAR COMMENT REC (PLISREC)                  
         MVI   0(RF),0                                                          
         MVI   ESTACTIV,0          SET NO ACTIVITY FOR REQUEST                  
         MVI   PRNTSW,0                                                         
         MVI   FCRDACTV,C'N'                                                    
         CLC   QPRODUCT,SPACES                                                  
         BNE   *+8                                                              
         MVI   FCRDACTV,C'Y'       NO PASSIVE POINTERS                          
         MVI   WFREGSW,0                                                        
         MVI   WFDSTSW,0                                                        
         MVI   RDPACT,0                                                         
         XC    EDITCNT,EDITCNT                                                  
         XC    PBRCNT,PBRCNT                                                    
*                                                                               
         LA    R2,9                9 SETS                                       
         LA    R3,DRDTOTS                                                       
         ZAP   0(8,R3),=P'0'                                                    
         LA    R3,8(R3)                                                         
         BCT   R2,*-10                                                          
*                                                                               
         MVC   SAVPUBN1,SPACES                                                  
         MVC   SAVPUBN2,SPACES                                                  
         MVC   SAVPUBN3,SPACES                                                  
         MVI   COMSW,0                                                          
*                                                                               
         CLC   QPROG,=C'53'        SEE IF TURNAROUND                            
         BE    NEWREQ0                                                          
*                                                                               
         CLI   QCNTLDT,C' '                                                     
         BE    NEWREQ0                                                          
         GOTO1 DATCON,DMCB,(3,QCNTLDT),(2,PCONTROL)                             
*                                                                               
NEWREQ0  CLC   QPROG,=C'53'        SEE IF TURNAROUND                            
         BNE   NEWREQ1                                                          
         MVC   QREGION,=C'GET'     FORCE FETCH OF REG/DST FOR TA'S              
         CLI   PAGYPROF+6,C'0'                                                  
         BE    *+10                                                             
         MVC   QOPT5,PAGYPROF+6       SHOW CHANGES ONLY ON TA'S                 
*                                                                               
         CLC   QCNTLDT,SPACES      SEE IF I HAVE A CONTROL DATE                 
         BNE   *+10                                                             
         MVC   QCNTLDT(3),BTODAY                                                
*                                                                               
         ZIC   R1,QCNTLDT+2        SUBTRACT 1 FROM DAY                          
         BCTR  R1,0                                                             
         STC   R1,QCNTLDT+2                                                     
NEWREQ1  DS    0H                                                               
         NI    DMINBTS,X'F7'       DO NOT PASS DELETES                          
         MVI   DMOUTBTS,X'FF'                                                   
         CLC   QPROG,=C'53'                                                     
         BE    NEWREQ2                                                          
         CLI   BTDOPT,C'Y'         SEE IF DOING BILLED TODAY ESTS               
         BE    NEWREQ2             YES - PASS DELETES                           
         CLI   QCNTLDT,C' '        TEST FLAGGING CHANGES                        
         BNE   NEWREQ2                                                          
         B     NEWREQ4                                                          
NEWREQ2  DS    0H                                                               
         OI    DMINBTS,X'08'       SET TO PASS DELETES                          
         MVI   DMOUTBTS,X'FD'                                                   
*                                  SET WHICH TOTALS NEEDED                      
NEWREQ4  DS    0H                                                               
         LA    R0,(ATOTSX-APUBTOT)/4         17 SETS                            
         LA    RF,APUBTOT                                                       
         MVI   0(RF),0                       CLEAR FIRST BYTE                   
         LA    RF,4(RF)                                                         
         BCT   R0,*-8                                                           
*                                                                               
         MVI   APUBTOT,1                                                        
         MVI   AVENTOT,1                                                        
         MVI   AMKTTOT,1                                                        
         CLC   QREGION,=C'ALL'                                                  
         BNE   *+12                                                             
         MVI   AREGTOT,1                                                        
         MVI   AREGTOTB,1                                                       
*                                                                               
         CLC   QDIST,=C'ALL'                                                    
         BNE   *+12                                                             
         MVI   ADSTTOT,1                                                        
         MVI   ADSTTOTB,1                                                       
*                                                                               
         MVI   AESTTOT,1                                                        
         MVI   AESTTOTB,1                                                       
*                                                                               
**NEW 2/18/88                                                                   
         CLI   RCALLALL,C'Y'      SEE IF DOING SPECIAL EC/52                    
         BE    NEWREQ7            FROM EST=ALL BILLING REQUEST                  
*                      YES THEN NO BRAND,DIV,CLT SUMMARIES                      
*                                 SINCE START AND END ARE RESET                 
**NEW 2/18/88                     FOR EACH ESTIMATE                             
         CLI   QPRODUCT,C' '                                                    
         BE    NEWREQ5                                                          
         CLC   QEST,=C'ALL'                                                     
         BNE   NEWREQ5                                                          
         MVI   APRDTOT,1                                                        
         MVI   APRDTOTB,1                                                       
*                                                                               
NEWREQ5  DS    0H                                                               
         CLI   QDIV,C' '                                                        
         BE    NEWREQ6                                                          
         CLI   QPRODUCT,C' '                                                    
         BE    NEWREQ5B                                                         
         CLC   QPRODUCT,=C'ALL'                                                 
         BNE   NEWREQ6                                                          
*                                                                               
NEWREQ5B DS    0H                                                               
         MVI   ADIVTOT,1                                                        
         MVI   ADIVTOTB,1                                                       
*                                                                               
NEWREQ6  DS    0H                                                               
         CLI   QPRODUCT,C' '                                                    
         BE    NEWREQ6B                                                         
         CLC   QPRODUCT,=C'ALL'                                                 
         BNE   NEWREQ7                                                          
*                                                                               
NEWREQ6B DS    0H                                                               
         MVI   ACLTTOT,1                                                        
         MVI   ACLTTOTB,1                                                       
*                                                                               
NEWREQ7  DS    0H                                                               
         CLI   RCMULTIQ,C'Y'                                                    
         BNE   *+12                                                             
         MVI   AXMDTOT,1                                                        
         MVI   AXMDTOTB,1                                                       
*                                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
*                                                                               
         TITLE 'PP5202 - POST TO ACCUMULATORS'                                  
BUYACC   CSECT                                                                  
         NMOD1 0,BUYACC                                                         
         SPACE 2                                                                
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP52WRKD,R8                                                      
         SPACE 2                                                                
*                                                                               
* POST TO ACCUMULATORS                                                          
*                                                                               
*        SET PYABLE TO COST                                                     
*                                                                               
         XC    DMCB,DMCB                                                        
         LA    R1,DMCB                                                          
         USING DICTATED,R1                                                      
         MVI   DDACTN,DDACTNL                                                   
         MVI   DDRETN,DDCASEU                                                   
         MVI   DDSYS,4                                                          
         MVC   DDLANG,RCLANG                                                    
         LA    RF,DC1LIST                                                       
         STCM  RF,7,DDIADR                                                      
         LA    RF,DS1LIST                                                       
         STCM  RF,7,DDOADR                                                      
         GOTO1 ADICTATE                                                         
         DROP  R1                                                               
*                                                                               
         MVC   WORK(4),GROSS                                                    
         MVC   WORK+4(4),CSHDSC                                                 
         MVC   WORK+8(4),AGYCOM                                                 
         CLC   PBDBDATE(2),BILADAT       CHK BILLABLE DATE VS EFF DATE          
         BL    BUYAC5                    OF BILLING FORMULA                     
*                                        IF LOW USE DEFAULT FORMULA             
*                                        OF G-CD                                
         CLI   TAXOPT,C'N'                                                      
         BE    BUYAC3                                                           
         GOTO1 AGETCOST,DMCB,(C'T',BILBASA),WORK,PBUYREC                        
         B     BUYACX                                                           
*                                                                               
BUYAC3   GOTO1 AGETCOST,DMCB,BILBASA,WORK,PBUYREC                               
         B     BUYACX                                                           
*                                                                               
BUYAC5   GOTO1 AGETCOST,DMCB,BFLTFORM,WORK,PBUYREC                              
BUYACX   MVC   PYABLE,DMCB+4            STORE COST AS PYABLE                    
*                                                                               
BUYX     LA    R2,RMTAB                                                         
         LA    R4,PBUYKDAT                                                      
         MVI   IMDSPL,X'FF'                                                     
         MVI   BMDSPL,X'FF'                                                     
BUYX1    CLC   0(2,R4),0(R2)       MATCH MONTH                                  
         BE    BUYX2                                                            
         LA    R2,2(R2)                                                         
         OC    0(2,R2),0(R2)                                                    
         BNZ   BUYX1                                                            
BUYX2    LA    R0,RMTAB                                                         
         SR    R2,R0               GET DSPL X 2                                 
         MH    R2,=Y(ROWL/2)                                                    
         ST    R2,IMDSPL                                                        
*                                                                               
         MVC   WORK2(16),GROSS     SAVE ORIG VALUES (BINARY VALUES)             
*                                  GROSS,AGY COM,CD,COST                        
* POST TO INSERTION MONTH ACCUMS                                                
*                                                                               
         LA    R0,10               BCT FOR ACCUMS                               
         LA    R6,APUBTOT                                                       
*                                                                               
BUYX4    DS    0H                                                               
         CH    R0,=H'7'            TEST DST TOTALS                              
         BNE   BUYX4A                                                           
         CLI   ESCCENTS,C'$'    NO CENTS IN DST + HIGHER ACCUMS                 
         BNE   *+8                                                              
         BAS   RE,BCONDOL          CONVERTS GROSS,CD,AGYCOM TO $                
BUYX4A   DS    0H                                                               
         CLI   0(R6),0             TEST NEED TOTALS AT THIS LEVEL               
         BE    BUYX5               NO                                           
*                                                                               
         ICM   R5,15,GROSS                                                      
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    0(8,R5),DUB                                                      
*                                                                               
         ICM   R5,15,CSHDSC                                                     
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    8(8,R5),DUB                                                      
*                                                                               
         ICM   R5,15,AGYCOM                                                     
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    16(8,R5),DUB                                                     
*                                                                               
         ICM   R5,15,PYABLE        REALLY COST                                  
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    40(8,R5),DUB                                                     
*                                                                               
         ICM   R5,15,CHGGRS        GROSS CHANGE                                 
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    48(8,R5),DUB                                                     
*                                                                               
         ICM   R5,15,CHGCD         CD CHANGE                                    
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    56(8,R5),DUB                                                     
*                                                                               
         ICM   R5,15,CHGAC         AC CHANGE                                    
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    64(8,R5),DUB                                                     
*                                                                               
         CLI   PBDSPACE,C'*'                                                    
         BE    BUYX5                                                            
         CLI   QMEDIA,C'N'                                                      
         BNE   BUYX4D                                                           
         L     R5,CIRC                                                          
         CLI   ESCCIRC,C'T'                                                     
         BE    BUYX4C                                                           
         L     R5,UNITS                                                         
         CLI   PBDUIND,C'I'                                                     
         BE    BUYX4B                                                           
         CLI   PBDUIND,X'89'       LOWER CASE I                                 
         BNE   BUYX4C                                                           
BUYX4B   MH    R5,=H'14'           14 LINES/INCH                                
         CLI   PBDUIND,X'89'       INCHES TO 2 DECIMALS                         
         BNE   BUYX4C                                                           
         CVD   R5,DUB                                                           
         AP    DUB,=P'50'                                                       
         DP    DUB,=P'100'         ROUND TO NEAREST LINE                        
         ZAP   DUB,DUB(6)                                                       
         B     BUYX4CV                                                          
BUYX4C   DS    0H                                                               
         CVD   R5,DUB                                                           
BUYX4CV  L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    24(8,R5),DUB                                                     
         B     BUYX5                                                            
*                                                                               
BUYX4D   DS    0H                                                               
         CLI   ESCCIRCR,C'Y'       IF REGIONAL CIRC                             
         BE    BUYX4F              IT DOESNT MATTER IF                          
         CLI   RDSHRFST,1                                                       
         BNE   BUYX5               NOT PRIMARY REG/DST                          
         LA    R5,1                                                             
         CLI   ESCCIRC,C'T'                                                     
         BNE   *+8                                                              
*                                                                               
BUYX4F   DS    0H                                                               
         ICM   R5,15,CIRC                                                       
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    24(8,R5),DUB                                                     
*                                                                               
BUYX5    DS    0H                                                               
         CH    R0,=H'8'            SEE IF NEXT IS DISTRICT                      
         BE    BUYX5A1             YES - MAYBE SWITCH DATES                     
         CH    R0,=H'6'            SEE IF NEXT IS ESTIMATE                      
         BE    BUYX5A1                                                          
*                                                                               
BUYX5A   DS    0H                                                               
         CLI   IMDSPL,X'FF'                                                     
         BE    BUYX5E                                                           
         LA    R6,4(R6)            NEXT ACCUM ADDRESS                           
         BCT   R0,BUYX4                                                         
         B     BUYX5E                                                           
*                                                                               
BUYX5A1  DS    0H                                                               
         CLI   ESCSUM1,C'I'                                                     
         BE    BUYX5A              ALREADY HAVE INS DATE                        
         LA    RF,PBDSDATE                                                      
         CLI   ESCSUM1,C'S'        SALE                                         
         BE    BUYX5A2                                                          
         LA    RF,PBDCDATE                                                      
         CLI   ESCSUM1,C'C'        CLOSING                                      
         BE    BUYX5A2                                                          
         LA    RF,PBDBDATE                                                      
         CLI   ESCSUM1,C'B'        BILLABLE                                     
         BE    BUYX5A2                                                          
         LA    RF,PBDPDATE                                                      
         CLI   ESCSUM1,C'P'        PAYABLE                                      
         BE    BUYX5A2                                                          
         CH    R0,=H'8'            SEE IF NEXT IS DISTRICT                      
         BE    BUYX5A              YES - MUST STILL ACCUMULATE                  
*                                  SINCE I NEED TOTALS FOR                      
*                                  REG/DST RECAPS                               
*        ESTIMATE TOTALS                                                        
         B     BUYX10              NO SUMMARY                                   
BUYX5A2  DS    0H                                                               
         LA    R2,RMTAB                                                         
BUYX5B   CLC   0(2,RF),0(R2)                                                    
         BE    BUYX5C                                                           
         LA    R2,2(R2)                                                         
         CLI   0(R2),0                                                          
         BNE   BUYX5B                                                           
         L     R2,IMDSPL                                                        
         B     BUYX5A                                                           
BUYX5C   LA    RF,RMTAB                                                         
         SR    R2,RF                                                            
         MH    R2,=Y(ROWL/2)                                                    
         ST    R2,IMDSPL                                                        
         B     BUYX5A                                                           
*                                  2ND DATE ACCUMS                              
*                                                                               
BUYX5E   DS    0H                                                               
*                                  SELECT DATE FOR 2ND SUMMARY                  
         LA    RF,PBUYKDAT                                                      
         CLI   ESCSUM2,C'I'        INS                                          
         BE    BUYX5H                                                           
         LA    RF,PBDSDATE                                                      
         CLI   ESCSUM2,C'S'        SALE                                         
         BE    BUYX5H                                                           
         LA    RF,PBDCDATE                                                      
         CLI   ESCSUM2,C'C'        CLOSING                                      
         BE    BUYX5H                                                           
         LA    RF,PBDPDATE                                                      
         CLI   ESCSUM2,C'P'        PAYABLE                                      
         BE    BUYX5H                                                           
         LA    RF,PBDBDATE                                                      
         CLI   ESCSUM2,C'B'        BILLABLE                                     
         BE    BUYX5H                                                           
         B     BUYX10              NONE                                         
*                                                                               
BUYX5H   LA    R2,RMTAB                                                         
BUYX6    CLC   0(2,RF),0(R2)                                                    
         BE    BUYX7                                                            
         LA    R2,2(R2)                                                         
         OC    0(2,R2),0(R2)                                                    
         BNZ   BUYX6                                                            
         B     BUYX10                                                           
*                                                                               
BUYX7    LA    R0,RMTAB                                                         
         SR    R2,R0               GET DSPL X 2                                 
         MH    R2,=Y(ROWL/2)                                                    
         ST    R2,BMDSPL                                                        
*                                                                               
         LA    R0,7                BCT FOR ACCUMS                               
         LA    R6,ADSTTOTB                                                      
*                                                                               
BUYX8    DS    0H                                                               
         CLI   0(R6),0             TEST NEED TOTAL AT THIS LEVEL                
         BE    BUYX9               NO                                           
*                                                                               
         ICM   R5,15,GROSS                                                      
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    0(8,R5),DUB                                                      
*                                                                               
         ICM   R5,15,CSHDSC                                                     
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    8(8,R5),DUB                                                      
*                                                                               
         ICM   R5,15,AGYCOM                                                     
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    16(8,R5),DUB                                                     
*                                                                               
         ICM   R5,15,PYABLE        NOW COST                                     
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    40(8,R5),DUB                                                     
*                                                                               
         ICM   R5,15,CHGGRS        GROSS CHANGE                                 
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    48(8,R5),DUB                                                     
*                                                                               
         ICM   R5,15,CHGCD         CD CHANGE                                    
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    56(8,R5),DUB                                                     
*                                                                               
         ICM   R5,15,CHGAC         AC CHANGE                                    
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    64(8,R5),DUB                                                     
*                                                                               
         CLI   PBDSPACE,C'*'                                                    
         BE    BUYX9                                                            
         CLI   QMEDIA,C'N'                                                      
         BNE   BUYX8A                                                           
         L     R5,CIRC                                                          
         CLI   ESCCIRC,C'T'                                                     
         BE    BUYX85                                                           
         L     R5,UNITS                                                         
         CLI   PBDUIND,C'I'                                                     
         BE    BUYX83                                                           
         CLI   PBDUIND,X'89'                                                    
         BNE   BUYX85                                                           
BUYX83   MH    R5,=H'14'           14 LINES TO INCH                             
         CLI   PBDUIND,X'89'       LOWER CASE I - INCHES 2 DECIMALS             
         BNE   BUYX85                                                           
         CVD   R5,DUB                                                           
         AP    DUB,=P'50'                                                       
         DP    DUB,=P'100'         ROUND TO NEAREST LINE                        
         ZAP   DUB,DUB(6)                                                       
         B     BUYX85V                                                          
BUYX85   DS    0H                                                               
         CVD   R5,DUB                                                           
BUYX85V  L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    24(8,R5),DUB                                                     
         B     BUYX9                                                            
*                                                                               
BUYX8A   DS    0H                                                               
         CLI   ESCCIRCR,C'Y'       IF REGIONAL CIRC                             
         BE    BUYX8F              IT DOESNT MATTER IF                          
         CLI   RDSHRFST,1                                                       
         BNE   BUYX9               NOT PRIMARY REG/DST                          
         LA    R5,1                                                             
         CLI   ESCCIRC,C'T'                                                     
         BNE   *+8                                                              
*                                                                               
BUYX8F   DS    0H                                                               
         ICM   R5,15,CIRC                                                       
         CVD   R5,DUB                                                           
         L     R5,0(R6)                                                         
         AR    R5,R2               POINT TO INDEXED POSITION                    
         AP    24(8,R5),DUB                                                     
*                                                                               
BUYX9    DS    0H                                                               
*                                                                               
         LA    R6,4(R6)            NEXT ACCUM                                   
         BCT   R0,BUYX8                                                         
*                                                                               
BUYX10   DS    0H                                                               
**NEW 2/18/88                                                                   
         CLI   RCALLALL,C'Y'       SEE IF DOING SPECIAL EC/52                   
         BE    BS                  FROM BILLING REQUEST                         
*                                  THEN NO BRAND SUMMARIES                      
**NEW 2/18/88                                                                   
         CLC   PPRDKPRD,=C'ZZZ'    TEST ZZZ REQUEST                             
         BE    BZ                                                               
         CLC   QPRODUCT,=C'ALL'                                                 
         BE    BZ                                                               
         CLC   QPRODUCT,SPACES                                                  
         BE    BZ                                                               
         B     BS                                                               
         EJECT                                                                  
* BUCKET INSERTION DATA FOR EACH BRAND                                          
BZ       DS    0H                                                               
         LA    R2,PBUYKPRD-2       SET TO A(PRD CODE - 2)                       
         CLC   PBUYKPRD,=C'ZZZ'                                                 
         BNE   BZ3                                                              
         CLI   QPRODUCT,C' '                                                    
         BE    BZ1                                                              
         LA    R2,PPRDKPRD-2                                                    
         CLC   QPRODUCT,=C'ZZZ'                                                 
         BNE   BZ3                                                              
BZ1      DS    0H                                                               
         CLI   RDSHRFST,1          BRND ACCS ONLY IF PRIMARY REG/DST            
         BNE   BS                                                               
         MVC   SAVPVALS,GROSS      SAVE ORIGINAL PVALUES                        
**NEW 3/22/89                                                                   
         MVC   SOLDGRS(24),OLDGRS    SAVE ORIGINAL VALUES                       
*                                                                               
**NEW 3/22/89                                                                   
         LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'21'                                                      
BZ2      BAS   RE,BNXTEL                                                        
         BE    BZ2M                                                             
         MVC   GROSS(L'SAVPVALS),SAVPVALS    RESTORE ORIGINAL PVALUES           
**NEW 3/22/89                                                                   
         MVC   OLDGRS(24),SOLDGRS          RESTORE ORIG VALUES                  
**NEW 3/22/89                                                                   
         B     BS                                                               
*                                                                               
BZ2M     DS    0H                                                               
         L     RF,PPWORK2C                                                      
         USING PPWORK2D,RF                                                      
         CLI   QOPT9,C'O'          COST2/OPEN?                                  
         BNE   BZ2V                                                             
*                                                                               
         DROP  RF                                                               
*                                                                               
         GOTO1 GETINS,DMCB,PBUYREC,(C'O',GROSS),2(R2)                           
         B     BZ2Y                                                             
BZ2V     GOTO1 GETINS,DMCB,PBUYREC,GROSS,2(R2)                                  
*                                                                               
BZ2Y     TM    PBUYCNTL,X'80'            SEE IF DELETED                         
         BNO   *+10                                                             
         XC    GROSS(12),GROSS                                                  
*        SET PYABLE TO COST                                                     
*                                                                               
         MVC   WORK(4),GROSS                                                    
         MVC   WORK+4(4),CSHDSC                                                 
         MVC   WORK+8(4),AGYCOM                                                 
         CLC   PBDBDATE(2),BILADAT     CHK BILLABLE DATE VS EFF DATE            
         BL    BZAC5                 OF BILLING FORMULA                         
*                                      IF LOW USE DEFAULT FORMULA               
*                                      OF G-CD                                  
         CLI   TAXOPT,C'N'                                                      
         BE    BZAC3                                                            
         GOTO1 AGETCOST,DMCB,(C'T',BILBASA),WORK,PBUYREC                        
         B     BZACX                                                            
*                                                                               
BZAC3    GOTO1 AGETCOST,DMCB,BILBASA,WORK,PBUYREC                               
         B     BZACX                                                            
*                                                                               
BZAC5    GOTO1 AGETCOST,DMCB,BFLTFORM,WORK,PBUYREC                              
BZACX    MVC   PYABLE,DMCB+4            STORE COST AS PYABLE                    
*                                                                               
**NEW 3/22/89                                                                   
         MVC   OLDGRS(24),SOLDGRS                                               
         LA    R3,2(R2)                                                         
         GOTO1 APRDSHR,DMCB,(R3)  GET PRODUCT SHARE OF OLDGRS,AC,CD             
         L     R1,GROSS                                                         
         S     R1,OLDGRS                                                        
         ST    R1,CHGGRS                                                        
         L     R1,AGYCOM                                                        
         S     R1,OLDAC                                                         
         ST    R1,CHGAC                                                         
         L     R1,CSHDSC                                                        
         S     R1,OLDCD                                                         
         ST    R1,CHGCD                                                         
**NEW 3/22/89                                                                   
         CLI   ESCCENTS,C'$'    NO CENTS IN BRAND SUMMARIES                     
         BNE   *+8                                                              
         BAS   RE,BCONDOL     CONVERTS GROSS,CD,AGYCOM,COST TO $                
*                                                                               
* FIND PRD INS/BILL MONTH ACCUMS FOR PRD OR ADD PRD TO TABLE                    
BZ3      L     R3,ABRDT                                                         
         LA    R4,ACCL                                                          
         L     R5,ABRDTX                                                        
BZ4      OC    ACCL-8(3,R3),ACCL-8(R3)       TEST ACCUM USED                    
         BZ    BZ6                           NO.                                
         CLC   ACCL-8(3,R3),2(R2)            PRD MATCH                          
         BE    BZ6                                                              
         BXLE  R3,R4,BZ4                                                        
         DC    H'0'                NEED MORE ACCUMS                             
*                                                                               
BZ6      L     R4,ABRDT                                                         
         SR    R4,R3               GIVES BRAND DISPLACEMNT                      
         LPR   R4,R4                                                            
         A     R4,ABRDTB           GIVES BILL MNTH ACCUM ADDRESS                
*                                                                               
         MVC   ACCL-8(3,R3),2(R2)       MOVE PRD CODES                          
         MVC   ACCL-8(3,R4),2(R2)                                               
*                                                                               
         A     R3,IMDSPL           POINT TO MONTH BUCKETS                       
         A     R4,BMDSPL                                                        
*                                                                               
         CLI   IMDSPL,X'FF'                                                     
         BE    BZ7B                                                             
*                                                                               
         ICM   R5,15,GROSS                                                      
         CVD   R5,DUB                                                           
         AP    0(8,R3),DUB                                                      
*                                                                               
         ICM   R5,15,CSHDSC                                                     
         CVD   R5,DUB                                                           
         AP    8(8,R3),DUB                                                      
*                                                                               
         ICM   R5,15,AGYCOM                                                     
         CVD   R5,DUB                                                           
         AP    16(8,R3),DUB                                                     
*                                                                               
         ICM   R5,15,PYABLE        NOW COST                                     
         CVD   R5,DUB                                                           
         AP    40(8,R3),DUB                                                     
*                                                                               
         ICM   R5,15,CHGGRS        GROSS CHANGE                                 
         CVD   R5,DUB                                                           
         AP    48(8,R3),DUB                                                     
*                                                                               
         ICM   R5,15,CHGCD         CD CHANGE                                    
         CVD   R5,DUB                                                           
         AP    56(8,R3),DUB                                                     
*                                                                               
         ICM   R5,15,CHGAC         AC CHANGE                                    
         CVD   R5,DUB                                                           
         AP    64(8,R3),DUB                                                     
*                                                                               
*                                                                               
         CLI   PBDSPACE,C'*'                                                    
         BE    BZ7B                                                             
         CLI   QMEDIA,C'N'                                                      
         BNE   BZ7                                                              
*****                                                                           
         L     R5,CIRC                                                          
         CLI   ESCCIRC,C'T'         SEE IF TOTALING CIRC                        
         BE    BZ6F                                                             
*****                                                                           
         L     R5,UNITS                                                         
         CLI   PBDUIND,C'I'                                                     
         BE    BZ6B                                                             
         CLI   PBDUIND,X'89'       LOWER CASE I - INCHES 2 DECIMALS             
         BNE   BZ6F                                                             
BZ6B     MH    R5,=H'14'           14 LINES/INCH                                
         CLI   PBDUIND,X'89'       LOWER CASE I - INCHES 2 DECIMALS             
         BNE   BZ6F                                                             
         CVD   R5,DUB                                                           
         AP    DUB,=P'50'                                                       
         DP    DUB,=P'100'         ROUND TO NEAREST LINE                        
         ZAP   DUB,DUB(6)                                                       
         B     BZ6FV                                                            
BZ6F     DS    0X                                                               
         CVD   R5,DUB                                                           
BZ6FV    AP    24(8,R3),DUB                                                     
         B     BZ7B                                                             
*                                                                               
BZ7      DS    0H                                                               
         CLI   ESCCIRCR,C'Y'        SEE IF REGIONAL CIRC                        
         BE    BZ7A                                                             
         CLI   RDSHRFST,1                                                       
         BNE   BZ7B                  NOT PRIMARY REG/DST                        
         LA    R5,1                                                             
         CLI   ESCCIRC,C'T'                                                     
         BNE   *+8                                                              
*                                                                               
BZ7A     DS    0H                                                               
         ICM   R5,15,CIRC                                                       
         CVD   R5,DUB                                                           
         AP    24(8,R3),DUB                                                     
*                                                                               
*                                                                               
BZ7B     DS    0H                                                               
         CLI   ESCSUM2,C'N'                                                     
         BE    BZ8                                                              
BZ7C     CLI   BMDSPL,X'FF'                                                     
         BE    BZ8                                                              
*                                                                               
         ICM   R5,15,GROSS                                                      
         CVD   R5,DUB                                                           
         AP    0(8,R4),DUB                                                      
*                                                                               
         ICM   R5,15,CSHDSC                                                     
         CVD   R5,DUB                                                           
         AP    8(8,R4),DUB                                                      
*                                                                               
         ICM   R5,15,AGYCOM                                                     
         CVD   R5,DUB                                                           
         AP    16(8,R4),DUB                                                     
*                                                                               
         ICM   R5,15,PYABLE        NOW COST                                     
         CVD   R5,DUB                                                           
         AP    40(8,R4),DUB                                                     
*                                                                               
         ICM   R5,15,CHGGRS        GROSS CHANGE                                 
         CVD   R5,DUB                                                           
         AP    48(8,R4),DUB                                                     
*                                                                               
         ICM   R5,15,CHGCD         CD CHANGE                                    
         CVD   R5,DUB                                                           
         AP    56(8,R4),DUB                                                     
*                                                                               
         ICM   R5,15,CHGAC         AC CHANGE                                    
         CVD   R5,DUB                                                           
         AP    64(8,R4),DUB                                                     
*                                                                               
         CLI   PBDSPACE,C'*'                                                    
         BE    BZ8                                                              
         CLI   QMEDIA,C'N'                                                      
         BNE   BZ7D                                                             
***                                                                             
         L     R5,CIRC                                                          
         CLI   ESCCIRC,C'T'        SEE IF TOTALING CIRC                         
         BE    BZ7C5                                                            
***                                                                             
         L     R5,UNITS                                                         
         CLI   PBDUIND,C'I'                                                     
         BE    BZ7C3                                                            
         CLI   PBDUIND,X'89'       LOWER CASE I - INCHES 2 DECIMALS             
         BNE   BZ7C5                                                            
BZ7C3    MH    R5,=H'14'           14 LINES/INCH                                
         CLI   PBDUIND,X'89'       LOWER CASE I - INCHES 2 DECIMALS             
         BNE   BZ7C5                                                            
         CVD   R5,DUB                                                           
         AP    DUB,=P'50'                                                       
         DP    DUB,=P'100'         ROUND TO NEAREST LINE                        
         ZAP   DUB,DUB(6)                                                       
         B     BZ7C5V                                                           
BZ7C5    DS    0X                                                               
         CVD   R5,DUB                                                           
BZ7C5V   AP    24(8,R4),DUB                                                     
         B     BZ8                                                              
*                                                                               
BZ7D     DS    0H                                                               
         CLI   ESCCIRCR,C'Y'         IF REGIONAL CIRC                           
         BE    BZ7G                                                             
         CLI   RDSHRFST,1            SEE IF PRIMARY REG/DST                     
         BNE   BZ8                                                              
         LA    R5,1                                                             
         CLI   ESCCIRC,C'T'          SEE IF TOTALLING CIRC                      
         BNE   *+8                                                              
*                                                                               
BZ7G     DS    0H                                                               
         ICM   R5,15,CIRC                                                       
         CVD   R5,DUB                                                           
         AP    24(8,R4),DUB                                                     
*                                                                               
BZ8      DS    0H                                                               
         LA    R0,PBUYREC+33       TEST DOING POOL ELEMS                        
         CR    R2,R0                                                            
         BNL   BZ2                 YES                                          
         EJECT                                                                  
* BUCKET FOR SPACE DESCRIPTION                                                  
*                                                                               
BS       DS    0H                                                               
         CLI   ESCPBREC,C'0'                                                    
         BE    BSX                 NO RECAP                                     
         MVC   GROSS(16),WORK2     RESTORE ORIG VALUES (BINARY VALUES)          
*                                  SAVED AT BUYX2                               
         L     R3,ASPCTAB                                                       
         LA    R4,68                                                            
         L     R5,ASPCTABX                                                      
*                                                                               
         MVC   WORK(17),HOLDSPAC                                                
         OC    WORK(17),SPACES                                                  
         CLC   PBDSPACE(2),=C'* '                                               
         BH    *+14                                                             
         MVI   WORK,X'FF'          NON-SPACE BUY                                
         MVC   WORK+1(17),HOLDSPAC                                              
*                                                                               
BS2      CLC   0(17,R3),WORK                                                    
         BE    BS4                                                              
         CLI   0(R3),0                                                          
         BE    BS4                                                              
         BXLE  R3,R4,BS2                                                        
         AHI   R3,-68                                                           
         MVC   0(L'PP@ALOTH,R3),PP@ALOTH                                        
         B     *+10                                                             
BS4      DS    0H                                                               
         MVC   0(17,R3),WORK                                                    
*                                                                               
         ICM   R6,15,GROSS                                                      
         CVD   R6,DUB                                                           
         AP    20(8,R3),DUB                                                     
*                                                                               
         ICM   R6,15,CSHDSC                                                     
         CVD   R6,DUB                                                           
         AP    28(8,R3),DUB                                                     
*                                                                               
         ICM   R6,15,AGYCOM                                                     
         CVD   R6,DUB                                                           
         AP    36(8,R3),DUB                                                     
*                                                                               
         ICM   R6,15,PYABLE                                                     
         CVD   R6,DUB                                                           
         AP    60(8,R3),DUB        NOW COST                                     
*                                                                               
         CLI   PBDSPACE,C'*'                                                    
         BE    BSX                                                              
         CLI   QMEDIA,C'N'                                                      
         BNE   BS4D                                                             
         L     R6,CIRC                                                          
         CLI   ESCCIRC,C'T'                                                     
         BE    BS5                                                              
         L     R6,UNITS                                                         
         CLI   PBDUIND,C'I'                                                     
         BE    BS4B                                                             
         CLI   PBDUIND,X'89'       LOWER CASE I                                 
         BNE   BS4C                                                             
BS4B     MH    R6,=H'14'           14 LINES/INCH                                
         CLI   PBDUIND,X'89'       LOWER CASE I - INCHES 2 DECIMALS             
         BNE   BS4C                                                             
         CVD   R6,DUB                                                           
         AP    DUB,=P'50'                                                       
         DP    DUB,=P'100'         ROUND TO NEAREST LINE                        
         ZAP   DUB,DUB(6)                                                       
         B     BS5V                                                             
BS4C     B     BS5                                                              
*                                                                               
BS4D     DS    0H                                                               
         L     R6,CIRC                                                          
         CLI   ESCCIRCR,C'Y'       IF REGIONAL CIRC                             
         BE    BS5                 IT DOESNT MATTER IF                          
         CLI   RDSHRFST,1                                                       
         BNE   BSX                 NOT PRIMARY REG/DST                          
         CLI   ESCCIRC,C'T'                                                     
         BE    BS5                                                              
         LA    R6,1                                                             
*                                                                               
BS5      DS    0H                                                               
         CVD   R6,DUB                                                           
BS5V     AP    44(8,R3),DUB                                                     
*                                                                               
BSX      DS    0H                                                               
BUYACCX  XMOD1 1                                                                
         SPACE 2                                                                
BNXTEL   DS    0H                                                               
         SR    R0,R0                                                            
         IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    BNXTELX                                                          
         CLC   0(1,R2),ELCOD                                                    
         BCR   8,RE                                                             
         B     BNXTEL                                                           
BNXTELX  LTR   R2,R2                                                            
         BR    RE                                                               
         SPACE 2                                                                
BCONDOL  NTR1                      CONVER TO $ AMTS                             
         LA    R6,4                GROSS AGYCOM/CSHDSC/COST                     
         LA    R7,GROSS                                                         
*                                                                               
BCOND5   L     R2,0(R7)                                                         
         SR    R3,R3                                                            
         SRDA  R2,31                                                            
         D     R2,=F'100'                                                       
         LTR   R3,R3                                                            
         BM    *+8                                                              
         AHI   R3,1                                                             
         SRA   R3,1                                                             
         ST    R3,0(R7)                                                         
         LA    R7,4(R7)                                                         
         BCT   R6,BCOND5                                                        
*                                                                               
         LA    R6,3            ALSO DO CHG GROSS,AC,CD                          
         LA    R7,CHGGRS                                                        
*                                                                               
BCOND8   L     R2,0(R7)                                                         
         SR    R3,R3                                                            
         SRDA  R2,31                                                            
         D     R2,=F'100'                                                       
         LTR   R3,R3                                                            
         BM    *+8                                                              
         AHI   R3,1                                                             
         SRA   R3,1                                                             
         ST    R3,0(R7)                                                         
         LA    R7,4(R7)                                                         
         BCT   R6,BCOND8                                                        
*                                                                               
BCONDX   XIT1                                                                   
*                                                                               
         SPACE 3                                                                
         LTORG                                                                  
         SPACE 3                                                                
DC1LIST  DS    0C                                                               
         DCDDL PP#ALOTH,17,C                                                    
DC1LISTX DC    X'00'                                                            
DS1LIST  DS    0C                                                               
         DSDDL PRINT=YES                                                        
         PRINT GEN                                                              
DS1LISTX EQU   *                                                                
         PRINT NOGEN                                                            
         SPACE 4                                                                
BFLTFORM DC    X'0505000000'                                                    
*                                                                               
         EJECT                                                                  
         TITLE 'GET PRODUCT SHARE OF CHANGED $'                                 
PRDSHR   CSECT                                                                  
         NMOD1 0,PRDSHR                                                         
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC                                                       
         USING PP52WRKD,R8                                                      
         XC    PSWORK,PSWORK                                                    
         IC    R3,PBDWTSUM                                                      
         N     R3,=F'127'                                                       
         BAS   RE,REMCOMP                                                       
*                                                                               
         L     R5,DMCB           ADDRESS OF PRD                                 
         LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'21'                                                      
PRDS2    BAS   RE,PNXTEL                                                        
         BE    *+6                                                              
         DC    H'0'                       MISSSING 21 ELEM                      
         IC    R4,5(R2)                                                         
         N     R4,=F'127'                                                       
         IC    R3,PBDWTSUM                                                      
         N     R3,=F'127'                                                       
         BAS   R9,LEFTCOMP                                                      
         CLC   2(3,R2),0(R5)              SEE IF PRODUCT I'M DOING              
         BNE   PRDS2                                                            
         BAS   RE,PNXTEL                  SEE IF LAST PRODUCT                   
         BE    *+10                                                             
         MVC   PSWORK+1(6),PSWORK+13                                            
         BAS   R9,GETSHR                                                        
         XIT1                                                                   
*          DATA SET GETINS     AT LEVEL 061 AS OF 07/27/88                      
GETSHR   EQU   *                                                                
         LA    R7,OLDGRS                                                        
         LA    R6,6                                                             
GETSHR2  EQU   *                                                                
         L     RF,0(R7)            AMT                                          
         SR    R0,R0                                                            
         IC    R0,PSWORK(R6)                                                    
         SR    RE,RE                                                            
         LTR   RF,RF                                                            
         BZ    GETSHR6                                                          
         BP    *+10                                                             
         LCR   R0,R0                                                            
         L     RE,=F'-1'                                                        
         DR    RE,R3               / WTSUM (NO ROUND)                           
         MR    RE,R4               X THIS SHARE                                 
         AR    RF,R0               ADD SHARE OF PENNIES                         
         ST    RF,0(R7)                                                         
GETSHR6  EQU   *                                                                
         LA    R7,4(R7)                                                         
         BCT   R6,GETSHR2                                                       
         BR    R9                                                               
         SPACE 2                                                                
*          DATA SET GETINS     AT LEVEL 061 AS OF 07/27/88                      
*                                  DETERMINE PART OF REMAINDER FOR              
*                                  THIS SHARE                                   
*                                                                               
LEFTCOMP EQU   *                                                                
         MVC   PSWORK+13(6),PSWORK+1   SAVE CURRENT LEFTOVERS                   
         LA    R6,6                                                             
LEFT2    SR    R1,R1                                                            
         IC    R1,PSWORK+06(R6)    ORIG. REM                                    
         LTR   R1,R1                                                            
         BZ    LEFT4               NONE                                         
         SR    RF,RF                                                            
         IC    RF,PSWORK(R6)       LEFT OVER                                    
         LTR   RF,RF                                                            
         BZ    LEFT4               NONE LEFT                                    
         MR    R0,R4               X THIS SHARE                                 
         SLDL  R0,1                                                             
         DR    R0,R3               / WTSUM                                      
         AHI   R1,1                                                             
         SRA   R1,1                                                             
         LTR   R1,R1                                                            
         BNZ   *+8                                                              
         LA    R1,1                AT LEAST 1                                   
         LR    R0,RF                                                            
         SR    RF,R1                                                            
         BNM   *+8                                                              
         SR    RF,RF                                                            
         LR    R1,R0                                                            
         STC   RF,PSWORK(R6)       SAVE LEFT                                    
         CLC   2(3,R2),0(R5)       UNLESS THIS IS OUR PRODUCT                   
         BNE   LEFT4                                                            
         STC   R1,PSWORK(R6)       THEN SAVE THIS SHARE                         
LEFT4    EQU   *                                                                
         BCT   R6,LEFT2                                                         
         BR    R9                                                               
         SPACE 3                                                                
PNXTEL   DS    0H                                                               
         SR    R0,R0                                                            
         IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    PNXTELX                                                          
         CLC   0(1,R2),ELCOD                                                    
         BCR   8,RE                                                             
         B     PNXTEL                                                           
PNXTELX  LTR   R2,R2                                                            
         BR    RE                                                               
**NEW 3/22/89                                                                   
*                                                                               
*          DATA SET GETINS     AT LEVEL 061 AS OF 07/27/88                      
*                                  CALCULATE REMAINDER (AMT/WTSUM)              
*                                  STC REMAINDER IN PSWORK(R6) AND              
*                                  PSWORK+06(R6)                                
REMCOMP  NTR1                                                                   
         LA    R6,6                                                             
         LA    R7,OLDGRS                                                        
REM2     EQU   *                                                                
         L     RF,0(R7)                                                         
         M     RE,=F'1'                                                         
         DR    RE,R3                                                            
         LPR   RE,RE                                                            
         STC   RE,PSWORK(R6)                                                    
         STC   RE,PSWORK+06(R6)                                                 
         LA    R7,4(R7)                                                         
         BCT   R6,REM2                                                          
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
         TITLE 'PP5202 - ADDITIONAL CHARGES'                                    
DOADCG   CSECT                                                                  
         NMOD1 0,DOADCG                                                         
         SPACE 2                                                                
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP52WRKD,R8                                                      
         SPACE 2                                                                
         MVC   MYSVKEY(L'KEY),KEY     SAVE PPGKEY                               
*                                  GET ADDITIONAL CHARGE DATA                   
         MVI   C2F,X'00'           CLEAR COST2 INDICATOR                        
         L     RF,PPWORK2C                                                      
         USING PPWORK2D,RF                                                      
         CLI   QOPT9,C'O'          COST2/OPEN?                                  
         BNE   DADPRDCK                                                         
         MVI   C2F,C'O'            SET FOR COST2 FACTOR                         
DADPRDCK DS    0H                                                               
         CLI   QPRODUCT,C' '       REQ CARD PRODUCT BLANK ?                     
         BH    DOADGET             NO                                           
         MVC   PPRDKPRD,PBUYKPRD   YES - REPLACE WITH BUY PRODUCT               
*                                                                               
         DROP  RF                                                               
*                                                                               
         PRINT GEN                                                              
DOADGET  DS    0H                                                               
*                                                                               
         GOTO1 APPGETCG,DMCB,(C'T',PBUYREC),DATAMGR,(C2F,GETINS),      X        
               PPRDKPRD                                                         
         PRINT NOGEN                                                            
*                                                                               
         CLI   0(R1),X'FF'         ERROR IN CALL ?                              
         BNE   *+6                 NO                                           
         DC    H'0'                                                             
*                                                                               
         CLI   0(R1),X'00'         ANY ADD'L. CHARGES FOUND ?                   
         BE    DADLUPX             NO                                           
*                                                                               
         ZIC   R3,0(R1)         FOR LUP COUNTER - NO OF LINES IN BLOCK          
*                                                                               
         ICM   RE,15,0(R1)         RE POINTING TO DATA BLOCK                    
         BNZ   *+6                                                              
         DC    H'0'                ADDRESS IS NULLS                             
*                                                                               
         LA    RF,ADCGWRK          ADDRESS OF AREA FOR ADD'L. CHGS.             
         LA    R1,ADCDLNTH         LENGTH OF BLOCK                              
         MOVE  ((RF),(R1)),(RE)    MOVE BLOCK TO ADCGWRK AREA IN W/S            
*                                                                               
         LA    R4,ADCGWRK          WORK AREA FOR ADD'L. CHGS.                   
         USING ADDCHGD,R4                                                       
*                                                                               
         MVC   P+48(24),=C'** ADDITIONAL CHARGES **'                            
         BAS   RE,DAPRT                                                         
*                                                                               
DADLUP   MVC   P+48(ADCLNLEN),ADCCOD1                                           
         BAS   RE,DAPRT                                                         
         LA    R4,ADCLNLEN(R4)     BUMP TO NEXT BLOCK "LINE"                    
         BCT   R3,DADLUP                                                        
*                                                                               
         DROP  R4                                                               
*                                                                               
         MVC   KEY,MYSVKEY         RESTORE PPG SEQ                              
         MVC   KEYSAVE,KEY                                                      
         LA    R2,DMRDHI                                                        
*                                                                               
         GOTO1 DATAMGR,DMCB,(DMINBTS,(R2)),PRTDIR,KEY,KEY                       
*                                                                               
         CLC   KEY(25),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
DADLUPX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
DAPRT    DS    0H                                                               
         CLC   P(3),SPACES         CAN DATA GO HERE                             
         BNE   DAPRT1              NO                                           
*                                                                               
         L     RF,ACURKLN                                                       
         CLI   0(RF),0                                                          
         BE    DAPRT1                                                           
         MVC   P+1(30),0(RF)                                                    
         LA    RF,30(RF)                                                        
         ST    RF,ACURKLN                                                       
*                                                                               
DAPRT1   DS    0H                                                               
         MVC   HEAD8,MYHEAD8                                                    
         MVC   HEAD9,MYHEAD9                                                    
         MVC   HEAD10,MYHEAD10                                                  
*                                                                               
         LR    R0,RE                                                            
         GOTO1 APRNT                                                            
*                                                                               
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
C2F      DS    CL1                 COST2 FACTOR INDICATOR                       
MYSVKEY  DS    CL(L'KEY)                                                        
ADCGWRK  DS    CL(ADCDLNTH)                                                     
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
         TITLE 'PP5202 - PUB TOTALS'                                            
ENDPUBC  CSECT                                                                  
         NMOD1 0,ENDPUBC                                                        
         SPACE 2                                                                
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP52WRKD,R8                                                      
         SPACE 2                                                                
*                                  SUM MONTHLY ACCUMS                           
         XC    DMCB,DMCB                                                        
         LA    R1,DMCB                                                          
         USING DICTATED,R1                                                      
         MVI   DDACTN,DDACTNL                                                   
         MVI   DDRETN,DDCASEU                                                   
         MVI   DDSYS,4                                                          
         MVC   DDLANG,RCLANG                                                    
         LA    RF,DC2LIST                                                       
         STCM  RF,7,DDIADR                                                      
         LA    RF,DS2LIST                                                       
         STCM  RF,7,DDOADR                                                      
         GOTO1 ADICTATE                                                         
         DROP  R1                                                               
*                                                                               
         L     R2,APUBTOT                                                       
         CLI   EDVENSW,C'V'                                                     
         BNE   *+8                                                              
         L     R2,AVENTOT                                                       
         CLI   EDVENSW,C'M'                                                     
         BNE   *+8                                                              
         L     R2,AMKTTOT                                                       
*                                                                               
         LR    RF,R2               TEST ANYTHING IN TOT                         
         LA    RE,ACCL/8                                                        
         CP    0(8,R2),=P'0'       ANY DOLLARS?                                 
         BNE   ENDPUB0                                                          
         LA    R2,8(R2)                                                         
         BCT   RE,*-14             191 SETS                                     
         LR    R2,RF                                                            
         B     ENDPUBX                                                          
*                                                                               
ENDPUB0  DS    0H                                                               
         LR    R2,RF                                                            
*                                                                               
ENDPUB1  DS    0H                                                               
         LA    R0,21                                                            
*                                                                               
         LA    RF,WORK2            PACK VALUES                                  
         LA    RE,ROWL/8                                                        
         ZAP   0(8,RF),=P'0'       CLEAR STORAGE AREA                           
         LA    RF,8(RF)                                                         
         BCT   RE,*-10                                                          
*                                                                               
ENDPUB1A LA    R1,ROWL/8           9 SETS                                       
         LA    R4,WORK2                                                         
*                                                                               
ENDPUB1B DS    0X                                                               
         AP    0(8,R4),0(8,R2)                                                  
         LA    R2,8(R2)                                                         
         LA    R4,8(R4)                                                         
         BCT   R1,ENDPUB1B                                                      
         BCT   R0,ENDPUB1A                                                      
*                                                                               
         CLI   ESCLINS,C'0'        TEST LINE TOTS TO PRINT                      
         BZ    ENDPUB3                                                          
*                                                                               
         MVC   DUB,WORK2+24                                                     
         CLI   ESCCIRC,C'T'        CIRCULATION                                  
         BE    ENDPUB1C                                                         
         TM    ESCLINS,X'20'       LINES OR INCHES                              
         BO    ENDPUB1C                                                         
         SR    R6,R6                                                            
         AP    DUB,=P'7'                                                        
         DP    DUB,=P'14'          INCH = 14 LINES                              
         ZAP   DUB,DUB(6)          GET QUOTIENT                                 
ENDPUB1C DS    0H                                                               
         LA    R6,P+45                                                          
         CP    DUB,=P'0'                                                        
         BE    ENDPUB3                                                          
         ST    RE,SAVERE1                                                       
         ST    RF,SAVERF                                                        
         ST    R1,SAVER1                                                        
         MVI   MYCTAB+3,0                                                       
         CURED (P8,DUB),(11,(R6)),MYCTAB,COMMAS=YES,MODADDR=ACUREDIT            
         L     R1,SAVER1                                                        
         L     RF,SAVERF                                                        
         L     RE,SAVERE1                                                       
         CLI   ESCCIRC,C'T'                                                     
         BNE   *+14                                                             
         MVC   12(L'PP@CIRC,R6),PP@CIRC                                         
         B     ENDPUB2A                                                         
         CLI   QMEDIA,C'N'                                                      
         BNE   ENDPUB2                                                          
         MVC   11(L'PP@LSTAR,R6),PP@LSTAR                                       
         TM    ESCLINS,X'20'       LINES VS. INSERTIONS                         
         BO    *+16                                                             
         MVC   11(L'PP@LSTAR,R6),SPACES                                         
         MVC   11(L'PP@IN,R6),PP@IN                                             
         B     ENDPUB2A                                                         
ENDPUB2  DS    0H                                                               
         MVC   12(L'PP@INSER,R6),PP@INSER                                       
         CLI   QMEDIA,C'O'                                                      
         BNE   *+16                                                             
         MVC   12(L'PP@INSER,R6),SPACES                                         
         MVC   12(L'PP5POST,R6),PP5POST                                         
*                                                                               
ENDPUB2A DS    0H                                                               
         CLI   EDVENSW,C'M'                                                     
         BE    ENDPUB3                                                          
         CLI   ESCDETS,0                                                        
         BE    *+8                                                              
         BAS   RE,EPPRT            IF 3 $ - PRINT INS TOTAL NOW                 
*                                                                               
ENDPUB3  DS    0H                                                               
         LA    R4,P+57                                                          
         CLI   ESCDETS,0                                                        
         BNE   *+8                                                              
         LA    R4,12(R4)                                                        
         MVC   0(L'PP@VNTOT,R4),PP@VNTOT                                        
         CLI   EDVENSW,C'V'                                                     
         BE    ENDPUB3A                                                         
         MVC   0(L'PP@VNTOT,R4),SPACES                                          
         MVC   0(L'PP@MKTST,R4),PP@MKTST                                        
         CLI   EDVENSW,C'M'                                                     
         BE    EPMKT                                                            
         MVC   0(L'PP@MKTST,R4),SPACES                                          
         MVC   8(L'PP@TOTAL,R4),PP@TOTAL                                        
         CLI   QMEDIA,C'O'                                                      
         BE    ENDPUB3A                                                         
         MVC   0(L'PP@EDTOT,R4),PP@EDTOT                                        
         LA    R4,1(R4)                                                         
ENDPUB3A DS    0H                                                               
         CLI   ESCDETS+2,X'3'           TEST SEP CD TOTAL NEEDED                
         BNE   *+10                                                             
         MVC   132(L'PP@LESCD,R4),PP@LESCD                                      
         LA    R4,P+72                                                          
         LA    R5,ESCDETS                                                       
         LA    R6,3                                                             
ENDPUB4  CLI   0(R5),0                                                          
         BE    ENDPUB5                                                          
         CLI   0(R5),X'11'         ACTUAL COST                                  
         BNE   ENDPUB4B                                                         
         MVC   DUB,WORK2+40                                                     
         B     ENDPUB4D                                                         
*                                                                               
ENDPUB4B DS    0H                                                               
         MVC   DUB,WORK2           GROSS                                        
         CLI   0(R5),1                                                          
         BE    ENDPUB4D                                                         
         SP    DUB,WORK2+16(8)     NET                                          
         CLI   0(R5),2                                                          
         BE    ENDPUB4D                                                         
         MVC   DUB,WORK2+8         C.D.                                         
         CLI   0(R5),3                                                          
         BE    ENDPUB4D                                                         
         MVC   DUB,WORK2                                                        
         CLI   0(R5),4                                                          
         BE    *+10                                                             
         SP    DUB,WORK2+16(8)     LESS AGYCOM                                  
         SP    DUB,WORK2+8(8)      LESS CD                                      
*                                                                               
ENDPUB4D BAS   R7,EPEDT                                                         
         CLI   0(R5),3                                                          
         BE    ENDPUB5                                                          
         CLI   ESCDETS+2,3                                                      
         BNE   ENDPUB5                                                          
         SP    DUB,WORK2+8(8)      LESS C.D.                                    
         LA    R4,132(R4)                                                       
         BAS   R7,EPEDT                                                         
         AHI   R4,-132                                                          
*                                                                               
ENDPUB5  LA    R4,12(R4)                                                        
         LA    R5,1(R5)                                                         
         BCT   R6,ENDPUB4                                                       
         LA    R4,P+72                                                          
         LA    R0,3                                                             
ENDPUB6  CLI   11(R4),C' '                                                      
         BE    ENDPUB7                                                          
         CLC   12(2,R4),SPACES                                                  
         BNE   ENDPUB7                                                          
         MVI   12(R4),C'*'                                                      
ENDPUB7  LA    R4,12(R4)                                                        
         BCT   R0,ENDPUB6                                                       
         LA    R4,PSECOND+72                                                    
         LA    R0,2                                                             
ENDPUB7A DS    0H                                                               
         CLI   11(R4),C' '                                                      
         BE    ENDPUB8                                                          
         CLC   12(2,R4),SPACES                                                  
         BNE   ENDPUB8                                                          
         MVI   12(R4),C'*'                                                      
ENDPUB8  DS    0H                                                               
         LA    R4,12(R4)                                                        
         BCT   R0,ENDPUB7A                                                      
*                                                                               
         BAS   RE,EPPRT                                                         
*                                                                               
ENDPUB9  DS    0H                                                               
         MVC   MAXLINES,SAVEMAX                                                 
         TM    ESCPBTOT,X'01'       TEST PUB TOTAL OPBTION                      
         BZ    ENDPUB10            NO                                           
         CLI   QOPT5,C'C'          IF PRINTING ONLY CHANGES                     
         BE    ENDPUB9B            NO PUB TOTS-BUT STILL NEW PAGE               
         CLI   QOPT5,C'T'          OR TOTALING CHANGES ONLY                     
         BE    ENDPUB9B                                                         
         GOTO1 AENDPTOT                                                         
         B     ENDPUB10                                                         
*                                                                               
ENDPUB9B DS    0H                                                               
         MVI   FORCEHED,C'Y'                                                    
*                                                                               
ENDPUB10 CLI   ESCPBREC,C'0'       TEST PUB RECAP OPTION                        
         BNE   ENDPUB11                                                         
         CLC   QREGION,=C'ALL'                                                  
         BE    ENDPUB11                                                         
         CLC   QDIST,=C'ALL'                                                    
         BNE   ENDPUBX                                                          
ENDPUB11 DS    0H                                                               
         MVC   WRITTOTS(72),WORK2                                               
         GOTO1 AWFMOD                                                           
*                                                                               
ENDPUBX  DS    0H                                                               
         CLI   EDVENSW,C'M'                                                     
         BE    ENDPUBXX                                                         
ENDPUBX2 DS    0H                                                               
         L     R2,APUBTOT                                                       
******** BAS   RE,CLRTOT                                                        
*                                                                               
         ST    R2,FULL                                                          
         LA    RF,191                                                           
         ZAP   0(8,R2),=P'0'                                                    
         LA    R2,8(R2)                                                         
         BCT   RF,*-10                                                          
         L     R2,FULL                                                          
*                                                                               
         CLI   EDVENSW,C'V'                                                     
         BNE   ENDPUBXX                                                         
         L     R2,AVENTOT                                                       
******** BAS   RE,CLRTOT                                                        
*                                                                               
         ST    R2,FULL                                                          
         LA    RF,191                                                           
         ZAP   0(8,R2),=P'0'                                                    
         LA    R2,8(R2)                                                         
         BCT   RF,*-10                                                          
         L     R2,FULL                                                          
*                                                                               
ENDPUBXX DS    0H                                                               
*                                                                               
         CLI   QMEDIA,C'B'       MEDIA B NEEDS TO PRINT IMPS TOTS               
         BE    EPIMPST1                                                         
         CLI   QMEDIA,C'D'       MEDIA D NEEDS TO PRINT IMPS TOTS               
         BE    EPIMPST1                                                         
         CLI   QMEDIA,C'V'       MEDIA V NEEDS TO PRINT IMPS TOTS               
         BE    EPIMPST1                                                         
         CLI   QMEDIA,C'W'       MEDIA V NEEDS TO PRINT IMPS TOTS               
         BE    EPIMPST1                                                         
         CLI   QMEDIA,C'I'       ONLY MEDIA I NEEDS TO PRINT IMPS TOTS          
         BE    EPIMPST1                                                         
         CLI   QMEDIA,C'L'       OR MEDIA L NEEDS TO PRINT IMPS TOTS            
         BNE   EPX                                                              
EPIMPST1 OC    EIMPSTOT,EIMPSTOT   JUST IN CASE FOR CP INSTRUCTION              
         BZ    EPIMPST2                                                         
         CP    EIMPSTOT,=P'0'                                                   
         BE    EPIMPST5                                                         
         MVC   P+49(21),=C'ESTIMATED IMPS TOTALS'                               
         EDIT  (P5,EIMPSTOT),(11,P+073),0,ZERO=NOBLANK,COMMAS=YES               
         BAS   RE,EPPRT                                                         
EPIMPST2 ZAP   EIMPSTOT,=P'0'                                                   
*                                                                               
EPIMPST5 OC    AIMPSTOT,AIMPSTOT   JUST IN CASE FOR CP INSTRUCTION              
         BZ    EPIMPST7                                                         
         CP    AIMPSTOT,=P'0'                                                   
         BE    EPX                                                              
         MVC   P+52(18),=C'ACTUAL IMPS TOTALS'                                  
         EDIT  (P5,AIMPSTOT),(11,P+073),0,ZERO=NOBLANK,COMMAS=YES               
         BAS   RE,EPPRT                                                         
EPIMPST7 ZAP   AIMPSTOT,=P'0'                                                   
*                                                                               
EPX      MVC   MAXLINES,SAVEMAX                                                 
         XIT1                                                                   
         SPACE 2                                                                
EPMKT    DS    0H                  END OF MARKET                                
         MVC   P+3(2),=C'**'                                                    
         MVC   P+6(20),PUBZNAME                                                 
         CLI   QMEDIA,C'O'                                                      
         BE    EPMKT2                                                           
         MVC   P+6(2),PUBSTATE                                                  
         MVI   P+8,C','                                                         
         MVI   P+9,C' '                                                         
         MVC   P+10(16),PUBCITY                                                 
EPMKT2   DS    0H                                                               
         MVC   PSECOND+3(L'PP@MKTOT),PP@MKTOT                                   
         LA    R7,P+28                                                          
EPMKT3   CLI   0(R7),C' '                                                       
         BH    EPMKT4                                                           
         CLI   132(R7),C' '                                                     
         BH    *+8                                                              
         BCT   R7,EPMKT3                                                        
EPMKT4   DS    0H                                                               
         MVC   2(2,R7),=C'**'                                                   
         MVC   132+2(2,R7),=C'**'                                               
         MVI   SPACING,2                                                        
         B     ENDPUB3A                                                         
         SPACE 2                                                                
EPEDT    DS    0H                                                               
         ST    RE,SAVERE1                                                       
         ST    RF,SAVERF                                                        
         ST    R1,SAVER1                                                        
         MVI   MYCTAB+3,2                                                       
         CURED (P8,DUB),(12,(R4)),MYCTAB,FLOAT=-,MODADDR=ACUREDIT               
         L     R1,SAVER1                                                        
         L     RF,SAVERF                                                        
         L     RE,SAVERE1                                                       
         BR    R7                                                               
         SPACE 3                                                                
EPPRT    DS    0H                                                               
         CLC   P(3),SPACES         CAN CON DATA GO HERE                         
         BNE   EPPRT1              NO                                           
*                                                                               
         L     RF,ACURKLN                                                       
         CLI   0(RF),0                                                          
         BE    EPPRT1                                                           
         MVC   P+1(30),0(RF)                                                    
         LA    RF,30(RF)                                                        
         ST    RF,ACURKLN                                                       
*                                                                               
EPPRT1   DS    0H                                                               
         CLI   QOPT5,C'C'          IF PRINTING ONLY CHANGES                     
         BZR   RE                  NO PUB TOTS                                  
         CLI   QOPT5,C'T'          OR TOTALING CHANGES ONLY                     
         BZR   RE                                                               
         MVC   HEAD8,MYHEAD8                                                    
         MVC   HEAD9,MYHEAD9                                                    
         MVC   HEAD10,MYHEAD10                                                  
*                                                                               
         LR    R0,RE                                                            
         GOTO1 APRNT                                                            
*                                                                               
         LR    RE,R0                                                            
         BR    RE                                                               
         SPACE 2                                                                
         LTORG                                                                  
         SPACE 3                                                                
DC2LIST  DS    0C                                                               
         DCDDL PP#CIRC,4                                                        
         DCDDL PP#LSTAR,2                                                       
         DCDDL PP#IN,3                                                          
         DCDDL PP#INSER,10                                                      
         DCDDL PP#POST,8,LABEL=PP5POST                                          
         DCDDL PP#VNTOT,14                                                      
         DCDDL PP#MKTST,13                                                      
         DCDDL PP#EDTOT,14                                                      
*                                            TOTAL                              
         DCDDL PP#TOTAL,5                                                       
         DCDDL PP#LESCD,10                                                      
         DCDDL PP#MKTOT,16                                                      
DC2LISTX DC    X'00'                                                            
DS2LIST  DS    0C                                                               
         DSDDL PRINT=YES                                                        
         PRINT GEN                                                              
DS2LISTX EQU   *                                                                
         PRINT NOGEN                                                            
         EJECT                                                                  
*                                                                               
       ++INCLUDE PP52WRK                                                        
*                                                                               
*                                                                               
         EJECT                                                                  
*                                                                               
PCHGELED DSECT                                                                  
       ++INCLUDE PCHGELEM                                                       
*                                                                               
PBFSIELD DSECT                                                                  
       ++INCLUDE PBFSIEL                                                        
*                                                                               
         PRINT OFF                                                              
       ++INCLUDE PPREPWORK                                                      
       ++INCLUDE PPREPWORK2                                                     
       ++INCLUDE PPNEWFILE                                                      
       ++INCLUDE PPMODEQU                                                       
       ++INCLUDE PPDDEQUS                                                       
       ++INCLUDE DDDICTATED                                                     
*                                                                               
         PRINT ON                                                               
       ++INCLUDE PPGETCGD                                                       
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'040PPREP52A  02/25/20'                                      
         END                                                                    

*          DATA SET SPSYSDRV4  AT LEVEL 108 AS OF 10/20/20                      
*CATALP SPSYSD4                                                                 
         TITLE 'SPSYSDRV4 - SYSTEM DRIVER FOR SPOTPAK WRITER PART 4'            
*                                                                               
***********************************************************************         
*                                                                     *         
*          SPSYSDRV4 - SYSTEM DRIVER FOR SPOT WRITER (PART 4)         *         
*                                                                     *         
* USER     JIRA        DATE                 CHANGE LOG                *         
* ---- ------------- -------- ----------------------------------------*         
* AKAT SPEC-43482    10/20/20 SUPPORT NEW UNIVERSE KEYWORDS           *         
* AKAT SPEC-33500    11/08/19 SUPPORT FOR 2 DECIMAL IMPRESSIONS       *         
* AKAT SPEC-23936    06/17/19 NEW DARE MAKEGOODS KEYWORDS SUPPORT     *         
* AKAT SPEC-16250    05/30/18 NEW COST2 KEYWORDS SUPPORT              *         
* AKAT SPEC-12852    02/16/18 REPORT NEW MEDIA FRAMEWORKS DATA        *         
* AKAT SPEC-13400    02/16/18 NEW OMRESEND KEYWORD SUPPORT            *         
* AKAT SPSUG-95      06/15/16 SUPPORT NEW AD-IDCD2 KEYWORD            *         
* AKAT DSCUSTREQ-111 02/23/16 SUPPORT NEW INVCLICK/RTG/IMP KEYWORDS   *         
* 06OCT14 101AKT -- REPORT COMMERCIAL NAME2/3 FOR INVOICES          *           
* 13MAY14 100AKT -- SUPPORT NEW INVCMAT KEYWORD                     *           
* 01MAY13 99 AKT -- SUPPORT NEW INVAGYID KEYWORD                    *           
* 10JAN13 98 AKT -- SUPPORT BOOK AVERAGES FOR BUYBOOK               *           
* 26JAN12 96 AKT -- NEW BUYBOOK AND OMEMADD KEYWORD SUPPORT         *           
*                -- COMMERCIAL NAME2/3 NOW 20 CHARS LONG            *           
* 21NOV11 95 AKT -- NEW RATETYPE KEYWORD SUPPORT                    *           
* 05MAY11 94 AKT -- NEW CLINV CLPRD AND CLEST KEYWORDS              *           
* 06APR11 93 AKT -- SUPPORT NEW MFID# KEYWORD                       *           
* 01SEP10 92 AKT -- LOOK FOR FAX SENT WHEN PROCESSING OM AGENCY ID  *           
* 12JUL10 91 AKT -- USE DOSPIMTH TO REPORT A REP-ID OF EMAIL OR FAX *           
*                -- USE DOSPIDST TO REPORT THE OM DESTINATION       *           
* 12APR10 90 AKT -- CML STORAGE NOW IN SPWRIWORKD                   *           
* 01APR10 89 AKT -- FIX MSTREET ADDRESS PRINTING BUG                *           
* 12FEB10 88 AKT -- ALWAYS RESTORE UTL AFTER READING GENDIR/GENFIL! *           
* 21JAN10 87 AKT -- REPORT PIGGY'S AD-ID                            *           
* 02SEP09 86 AKT -- CHANGE DATE ON OMFRTSNT KEYWORD TO MM/DD/YY     *           
* 03AUG09 85 AKT -- INCLUDE FAXSENT STATUS IN OMFRTSNT KEYWORD      *           
* 12JUN09 84 AKT -- NEW OMFRTSNT KEYWORD SUPPORT                    *           
* 05MAY09 83 AKT -- NEW BUY RECORD BOOKTYPE KEYWORD                 *           
* 06NOV08 82 AKT -- NEW PACKED GOAL KEYWORDS SUPPORT OVER 21 MILLION*           
* 28JUL08 81 AKT -- SUPPORT NEW HDEF & CNTR KEYWORDS                *           
* 16JUN08 80 AKT -- SUPPORT NEW ORIGINAL INV DETAIL COST            *           
* 26FEB08 79 AKT -- FIX CML ROUTINE FOR AD-ID                       *           
* 27JAN08 78 AKT -- SUPPORT NEW ESTBKTYP KEYWORD                    *           
* 01DEC07 77 AKT -- MERGE BUY AND OM DATA SUPPORT                   *           
* 24SEP07 76 AKT -- FIX SALESPERSON BUFFER BUG                      *           
* 25JUL07 75 AKT -- SUPPORT NEW STATION BUFFER FORMAT AND SEVERAL   *           
*                -- NEW MSTREET KEYWORDS.                           *           
* 19JUL07 74 AKT -- FIX OM ROUTE/REP ID KEYWORDS FOR RADIO ORDERS   *           
* 26JUN07 73 AKT -- READ GENDIR FOR SALES/POINTPERSON FOR OM RECS   *           
* 02MAY07 72 AKT -- REPORT COMMERCIAL CODES/NAMES FOR PIGGIES       *           
* 27FEB07 71 AKT -- BILLGST NOW FULLWORD, RATHER THAN XL3           *           
* 01FEB07 70 AKT -- NEW OMLSTSNT KEYWORD SUPPORT                    *           
* 22JAN06 69 AKT -- READ PERSONAL AUTH RECORDS BY SECURITY AGENCY   *           
* 30NOV06 68 AKT -- PRINT LABELS WHEN OM KEYWORDS USED AS HEADINGS  *           
* 13DEC06 67 AKT -- NEW INVFLAGS KEYWORD SUPPORT                    *           
* 20NOV06 66 AKT -- CLEAR INPUT FOR INVDAYS IF DAYS DONT APPLY      *           
* 03NOV06 65 AKT -- CALCULATE INVDAYS FROM THE FIRST MATCH ATTEMPT  *           
*                -- IF IT WAS 100% MATCHED ON THE FIRST ATTEMPT AND *           
*                -- THE LAST MATCH ATTEMPT DATE AND PERCENT IS NULLS*           
* 13SEP06 64 AKT -- REPORT LAST GOAL/BUY DATA LOCKIN FROM GOAL REC  *           
* 05OCT06 63 AKT -- SUPPORT FOR NEW ERATE KEYWORD                   *           
* 16AUG06 62 AKT -- FIX OMDEST BUG                                  *           
* 18MAY06 61 AKT -- SUPPORT FOR NEW ORBIT KEYWORD                   *           
* 14APR06 60 AKT -- HONOR YYMMDD OPTION FOR INVOICE DATE KEYWORDS   *           
* 06APR06 59 AKT -- SUPPORT ADDED VALUE BUYS FOR BONUS KEYWORD      *           
* 31JAN06 58 AKT -- SUPPORT FOR 5 CHARACTER FM STATIONS             *           
* 27DEC05 57 AKT -- SUPPORT FOR NEW DEMO SOURCE KEYWORD AND CHECK   *           
*                -- IF OMDOLLARS IS SET BEFORE DOING A ZAP          *           
* 06DEC05 56 AKT -- DON'T PRINT MSTREET TOTAL LINES ON OUTPUT       *           
* 23AUG05 55 AKT -- SUPPORT FOR INVOICE KEYWORDS (I2 INFO ELEMENT)  *           
* 26JUL05 54 AKT -- SPACE PAD MSTREET KEYWORDS FOR DOWNLOADS        *           
* 13JUL05 53 AKT -- SUPPORT UNDER DELIVERY BUYS FOR BONUS KEYWORD   *           
* 23FEB05 52 AKT -- MAKE SURE OMDATE DOES NOT PRINT IF NULLS        *           
* 26OCT04 51 AKT -- HONOR NEGATIVE INVOICE COST                     *           
* 28SEP04 50 AKT -- OMSPOTS IS NOW RIGHT ALIGNED                    *           
*                -- OMOFFER IS NOW RIGHT ALIGNED                    *           
*                -- HONOR ROUND OPTION FOR OMDOL                    *           
*                -- SPACE PAD OM DATA ON OUTPUT                     *           
*                -- DO NOT READ CTFILE IF DOSTIDNM=X'FFFF'          *           
*                -- TAKE OUT OMDOL OUTPUT ROUTINE                   *           
* 22SEP04 49 AKT -- SPACE PAD MSTREET DATA ON INPUT                 *           
* 23AUG04 48 AKT -- ALLOW COMMERCIAL TABLE (I/OCML) ACROSS CLIENTS  *           
*                -- AND SUPPORT NEW AD-ID KEYWORDS                  *           
* 08JUL04 47 AKT -- OM KEYWORDS                                     *           
* 28JUN04 46 EFJ -- FIX INVSRCE KWD                                 *           
* 20MAY04 45 AKT -- SUPPORT ETYPE=UNWIRED                           *           
* 16APR04 44 AKT -- ETYPE I/O ROUTINES                              *           
* 29JAN04 43 PWE -- SHOW K/W (SHOWCODE - NETWORK CANADA)            *           
* 21JAN04 42 AKT -- LCOUNT OUTPUT ROUTINE (OPRINT)                  *           
* 15DEC03 41 EFJ -- FIX ODEMNAME OUTPUT                             *           
* 12DEC03 40 PWE -- FIX CPS FOR MEDIA N REPORTING AT NETWORK LEVEL  *           
* 18NOV03 39 AKT -- MSTREET KEYWORDS                                *           
* 24SEP03 38 PWE -- PST                                             *           
* 18SEP03 37 EFJ -- OINVDATE RTN FOR INCRDATE                       *           
* 10JUL03?36 AKT?-- INVSRCE                                         *           
* 18MAR03 35 AKT -- NO MO SBBILGRS/SBBILNET/BILLCOST                *           
* 10FEB03 34 AKT -- PACKED KEYWORD ROUTINES                         *           
* 05FEB03 33 EFJ -- FIX INVNO BUG FOR COLUMN DL                     *           
* 21OCT02 32 EFJ -- MAKE INVSTAT KEYWORDS NICER                     *           
* 15JUL02 31 EFJ -- SUPPORT INVSTAT KWD (MM STATUS)                 *           
* 10JUN02 30 EFJ -- ADD 'REG' TO BONUS KYWD                         *           
* 29MAY02 29 EFJ -- FIX PDREP KEYWORD FOR ALPHA-NUMERIC             *           
*                -- SUPPORT BONUS KEYWORD                           *           
* 14MAR02 28 EFJ -- SKIP UDEFS FOR DETAIL TOTALS                    *           
* 09OCT01 27 EFJ -- CHANGE *+4 TO *+8 FOR IDF                       *           
* 27AUG01 26 EFJ -- NEW MARKET LEVEL USER COMMENT (UCOM)            *           
* 24APR01 25 EFJ -- NEW CML KEYWORD FOR BASIC CODE                  *           
*                -- CONVERT TIME TO BINARY BEFORE UNTIME CALL       *           
* 12APR01 24 EFJ -- BUY COPY DATE/TIME STAMP                        *           
* 03OCT00 23 EFJ -- SUPPORT USER COMMENTS                           *           
* 17NOV99 22 EFJ -- SUPPORT PDREP ROW                               *           
* 19MAY99 21 EFJ -- ADATE SUPPORTS CCYYMMDD FORMAT                  *           
* 20APR99 20 EFJ -- FIX CMML CODE                                   *           
* 09MAR99 19 EFJ -- FIX CPS CODE                                    *           
* 17FEB99 18 EFJ -- SUPPORT INVADATE                                *           
* 11FEB99 17 EFJ -- MAKE INVNO WORK A LITTLE BETTER AS A COLUMN     *           
* 04DEC98 16 EFJ -- SUPPORT DBOOK KEYWORD                           *           
* 29OCT98 15 EFJ -- SUPPORT NAME KEYWORD                            *           
* 29SEP98 14 EFJ -- SUPPORT GRAND TOTALS                            *           
* 25AUG98 13 EFJ -- MOVE IN ROUTINES FROM DRV3                      *           
* 23JUN98 12 NRK -- ALPHA MARKET CODE KEYWORD ROUTINE               *           
* 06MAY98 11 EFJ -- MOVE IN SOME ROUTINES FROM DRV2 (INCL Y2K)      *           
* 22SEP97 10 EFJ -- MOVE IN SOME ROUTINES FROM DRV3                 *           
* 02SEP97 09 EFJ -- CONVERT DIFFNET TO PACKED                       *           
* 19JUN97 08 EFJ -- L 07 ALMOST WORKED...                           *           
* 21MAY97 07 EFJ -- NEW KEYWORD - DIFFNET                           *           
* 30JAN97 06 EFJ -- FIX BUG IN CPS                                  *           
* 06DEC96 05 EFJ -- ADD COST PER SPOT KEYWORD                       *           
* 07NOV96 04 EFJ -- WHO/WHAT ADDED/CHANGED ROUTINES                 *           
* 29OCT96 03 EFJ -- NWS KEYWRDS                                     *           
* 08AUG96 02 EFJ -- AGYCODE KEYWORD                                 *           
* 26JUN96 01 EFJ -- INITIAL ENTRY                                   *           
*                                                                   *           
*********************************************************************           
SPSYSD4  CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,**SPD4**,R7,R8                                                 
         USING GLOBALD,RA                                                       
         L     RC,GLAWORKD                                                      
         USING GEND,RC                                                          
         L     R9,ASYSD                                                         
         USING SYSD,R9                                                          
*                                                                               
         CLI   SBMODE,SBPROCBH     BILL HEADER?                                 
         BNE   *+12                                                             
         ST    R4,ABILLREC         SAVE A(BILLREC)                              
         ST    R5,AMAORLKD         SAVE A(MAAORLKD)                             
*                                                                               
         CLI   SBMODE,SBPROCCS     CLEARANCE STATUS?                            
         BNE   *+8                                                              
         ST    R5,ACLSTEL1         SAVE A(CLSTEL01)                             
*                                                                               
         CLI   GLHOOK,GLRESOLV     RESOLVE ADDRESSES                            
         BE    RESOLVE                                                          
*                                                                               
         CLI   GLHOOK,GLROUT       EXECUTE ROUTINES                             
         BE    EXEC                                                             
*                                                                               
         CLI   GLHOOK,GLINCOMP     INTERNAL COMPUTES                            
         BE    EXEC                                                             
*                                                                               
XIT      XIT1  ,                                                                
         EJECT                                                                  
* RESOLVE ROUTINE ADDRESSES                                                     
* ON INPUT, R2 = A(ROUTINE TABLE ENTRY)                                         
*                                                                               
         SPACE 1                                                                
         USING WRIRTBD,R2                                                       
RESOLVE  SR    R1,R1                                                            
         ICM   R1,3,WRRNUM                                                      
         SLL   R1,2                                                             
         LAY   R1,ROUTTAB-4(R1)                                                 
         ST    R1,GLAROUT                                                       
         B     XIT                                                              
         DROP  R2                                                               
         EJECT                                                                  
* EXECUTING ROUTINES                                                            
* ON EXIT,  CC EQ - EXECUTE GENOUT ROUTINE IN THE ROOT                          
*           CC NE - JUST EXIT WITHOUT FURTHER PROCESSING                        
*                                                                               
         SPACE 1                                                                
EXEC     MVC   WORK,BLANKS         PRESET WORK AREAS                            
         ST    R1,ALVLSWS          SAVE A(PUT TO SORT SWITCHES)                 
         L     RF,GLAROUT          RF=A(ROUTINE)                                
         CLI   GLMODE,GLINPUT      TEST INPUT ROUTINE                           
         BNE   EXEC2                                                            
         L     R4,SBACURCH         YES-ADDRESS THE CHUNKS                       
         USING SCHUNKD,R4                                                       
         LR    R5,R4                                                            
         USING SGLCHNKD,R5                                                      
         L     R1,GLADTENT                                                      
         USING DRIND,R1                                                         
         MVC   INLEVEL,DRINLEV     SAVE LEVEL                                   
         DROP  R1                                                               
*                                                                               
EXEC2    BR    RF                  EXECUTE THE ROUTINES                         
*                                                                               
GENOUT   CR    RB,RB               CC EQ                                        
         J     XIT                                                              
*                                                                               
EXIT     LTR   RB,RB               CC NE                                        
         J     XIT                                                              
         EJECT                                                                  
*                                                                               
IAGYCODE DS    0H                                                               
         MVC   0(2,R2),SBAGYREC+1                                               
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
* NWS ROUTINES                                                                  
         USING BWSELEM,R6                                                       
INWSCAMP DS    0H                                                               
         BAS   RE,GETNWS                                                        
         BNE   EXIT                                                             
         MVC   0(2,R2),BWSCAM                                                   
         B     EXIT                                                             
*                                                                               
INWSBUY  DS    0H                                                               
         BAS   RE,GETNWS                                                        
         BNE   EXIT                                                             
         MVC   0(3,R2),BWSBYR                                                   
         B     EXIT                                                             
*                                                                               
INWSDATE DS    0H                                                               
         BAS   RE,GETNWS                                                        
         BNE   EXIT                                                             
         MVC   0(3,R2),BWSDATE                                                  
         B     EXIT                                                             
         DROP  R6                                                               
*                                                                               
GETNWS   DS    0H                                                               
         LR    R0,RE                                                            
         L     R6,SBAIO1                                                        
         MVI   ELCODE,X'97'                                                     
         BAS   RE,GETEL                                                         
         LR    RE,R0                                                            
         BR    RE                                                               
         EJECT                                                                  
*                                                                               
IWHO     DS    0H                                                               
         L     R6,SBAIO1                                                        
         MVI   ELCODE,X'99'                                                     
         BAS   RE,GETEL                                                         
         BNE   EXIT                                                             
         USING ACTVELEM,R6                                                      
         CLI   GLARGS+2,C'C'       CHANGED ID?                                  
         BNE   *+14                                                             
         MVC   0(2,R2),ACTVCHG                                                  
         B     IWHOX                                                            
         CLI   GLARGS+2,C'A'                                                    
         BNE   IWHOX                                                            
         MVC   0(2,R2),ACTVADD                                                  
IWHOX    SR    R6,R6                                                            
         B     INX                                                              
         DROP  R6                                                               
*                                                                               
OWHO     DS    0H                                                               
         XC    WORK2,WORK2                                                      
         LA    R1,WORK2                                                         
         MVI   WORK2,C'C'          C TYPE GENERALIZED ELEM                      
         MVC   WORK2+1(2),0(R2)    SEQ NUM = AUTH NUM                           
         GOTO1 GETGENEL                                                         
         BE    OWHO20                                                           
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING CT0REC,R6                                                        
         MVI   CT0KTYP,CT0KTEQU                                                 
*                                                                               
         L     R1,SYSPARMS                                                      
         L     R1,4(R1)                                                         
         L     R1,TWAMASTC-T204FFD(R1)                                          
         USING MASTD,R1                                                         
         MVC   CT0KAGY,MCAGYSEC    SECURITY AGENCY                              
         DROP  R1                                                               
*                                                                               
         CLC   CT0KAGY,BLANKS      SECURITY AGENCY SET?                         
         BH    *+10                YES                                          
         MVC   CT0KAGY,AGENCY                                                   
         MVC   CT0KNUM,0(R2)                                                    
         L     R6,SBAIO2                                                        
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'CTFILE',KEY,(R6)                      
         CLC   CT0KEY,KEY                                                       
         BNE   OWHO30                                                           
*                                                                               
         LA    RE,28(R6)                                                        
         SR    R0,R0                                                            
OWHO10   CLI   0(RE),0                                                          
         BE    OWHO30                                                           
         CLI   0(RE),X'C3'                                                      
         BE    *+14                                                             
         IC    R0,1(RE)                                                         
         AR    RE,R0                                                            
         B     OWHO10                                                           
*                                                                               
         MVI   WORK2+3,8                                                        
         MVC   WORK2+4(8),2(RE)                                                 
         LA    R1,WORK2                                                         
         GOTO1 PUTGENEL                                                         
*                                                                               
OWHO20   MVC   0(8,R3),WORK2+4                                                  
         B     EXIT                                                             
OWHO30   MVI   0(R3),C'?'                                                       
         MVC   1(7,R3),0(R3)                                                    
         B     EXIT                                                             
         DROP  R6                                                               
*                                                                               
IWHAT    DS    0H                                                               
         L     R6,SBAIO1                                                        
         USING BUYRECD,R6                                                       
         MVC   0(1,R2),BDWHY                                                    
         MVC   1(1,R2),BDWHY2                                                   
         MVC   2(1,R2),BDWHY3                                                   
         SR    R6,R6                                                            
         B     INX                                                              
         DROP  R6                                                               
*                                                                               
OWHAT    DS    0H                                                               
         L     R6,AIO3             BUILD MESSAGES HERE                          
         MVI   0(R6),C' '                                                       
         MVC   1(200,R6),0(R6)                                                  
         CLI   0(R2),0                                                          
         BE    OWHAT10                                                          
         TM    0(R2),X'80'                                                      
         BZ    *+14                                                             
         MVC   0(8,R6),=C'NEW BUY/'                                             
         LA    R6,8(R6)                                                         
*                                                                               
         TM    0(R2),X'40'                                                      
         BZ    *+14                                                             
         MVC   0(11,R6),=C'BUY CHANGE/'                                         
         LA    R6,11(R6)                                                        
*                                                                               
         TM    0(R2),X'20'                                                      
         BZ    *+14                                                             
         MVC   0(11,R6),=C'POOL ALLOC/'                                         
         LA    R6,11(R6)                                                        
*                                                                               
         TM    0(R2),X'10'                                                      
         BZ    *+14                                                             
         MVC   0(4,R6),=C'OTO/'                                                 
         LA    R6,4(R6)                                                         
*                                                                               
         TM    0(R2),X'08'                                                      
         BZ    *+14                                                             
         MVC   0(15,R6),=C'COMMENT CHANGE/'                                     
         LA    R6,15(R6)                                                        
*                                                                               
         TM    0(R2),X'04'                                                      
         BZ    *+14                                                             
         MVC   0(9,R6),=C'BUY COPY/'                                            
         LA    R6,9(R6)                                                         
*                                                                               
         TM    0(R2),X'02'                                                      
         BZ    *+14                                                             
         MVC   0(12,R6),=C'DEMO LOOKUP/'                                        
         LA    R6,12(R6)                                                        
*                                                                               
         TM    0(R2),X'01'                                                      
         BZ    *+14                                                             
         MVC   0(11,R6),=C'PKG CHANGE/'                                         
         LA    R6,11(R6)                                                        
*                                                                               
OWHAT10  CLI   1(R2),0                                                          
         BE    OWHAT20                                                          
         TM    1(R2),X'80'                                                      
         BZ    *+14                                                             
         MVC   0(11,R6),=C'AFFIDAVITS/'                                         
         LA    R6,11(R6)                                                        
*                                                                               
         TM    1(R2),X'40'                                                      
         BZ    *+14                                                             
         MVC   0(8,R6),=C'DAYPART/'                                             
         LA    R6,8(R6)                                                         
*                                                                               
         TM    1(R2),X'20'                                                      
         BZ    *+14                                                             
         MVC   0(10,R6),=C'INTG COST/'                                          
         LA    R6,10(R6)                                                        
*                                                                               
         TM    1(R2),X'10'                                                      
         BZ    *+14                                                             
         MVC   0(12,R6),=C'PCD LOOK-UP/'                                        
         LA    R6,12(R6)                                                        
*                                                                               
         TM    1(R2),X'08'                                                      
         BZ    *+14                                                             
         MVC   0(9,R6),=C'DEMO CHG/'                                            
         LA    R6,9(R6)                                                         
*                                                                               
         TM    1(R2),X'04'                                                      
         BZ    *+14                                                             
         MVC   0(8,R6),=C'HUT CHG/'                                             
         LA    R6,8(R6)                                                         
*                                                                               
         TM    1(R2),X'02'                                                      
         BZ    *+14                                                             
         MVC   0(10,R6),=C'ORBIT CHG/'                                          
         LA    R6,10(R6)                                                        
*                                                                               
         TM    1(R2),X'01'                                                      
         BZ    *+14                                                             
         MVC   0(9,R6),=C'FILM CHG/'                                            
         LA    R6,9(R6)                                                         
*                                                                               
OWHAT20  CLI   2(R2),0                                                          
         BE    OWHAT30                                                          
         TM    2(R2),X'80'                                                      
         BZ    *+14                                                             
         MVC   0(12,R6),=C'SKED CHANGE/'                                        
         LA    R6,12(R6)                                                        
*                                                                               
         TM    2(R2),X'40'                                                      
         BZ    *+14                                                             
         MVC   0(9,R6),=C'BUY MOVE/'                                            
         LA    R6,9(R6)                                                         
*                                                                               
         TM    2(R2),X'20'                                                      
         BZ    *+14                                                             
         MVC   0(15,R6),=C'-OTO''S BY $MAT/'                                    
         LA    R6,15(R6)                                                        
*                                                                               
         TM    2(R2),X'1F'                                                      
         BZ    *+14                                                             
         MVC   0(6,R6),=C'?????/'                                               
         LA    R6,6(R6)                                                         
*                                                                               
OWHAT30  BCTR  R6,0                                                             
         MVI   0(R6),C' '                                                       
         L     R6,AIO3                                                          
         ST    R6,DMCB                                                          
         MVI   DMCB,200                                                         
         ST    R3,DMCB+4                                                        
         MVC   DMCB+4(1),MYOLEN                                                 
         LA    R1,8                                                             
         ST    R1,DMCB+8                                                        
         MVI   DMCB+8,198          WHEN PRINT LINES ARE 198 APART               
         GOTO1 CHOPPER,DMCB                                                     
         B     EXIT                                                             
*                                                                               
         EJECT                                                                  
IBYCPS   LA    R6,BIN4             COST PER SPOT                                
         MVC   0(4,R2),SCGROSS                                                  
         L     R1,SCGSTI                                                        
         BAS   RE,GSTI                                                          
         L     R1,SCPSTI                                                        
         BAS   RE,PSTI                                                          
         L     R1,SCGSTO                                                        
         BAS   RE,GSTO                                                          
         L     R1,SCPSTO                                                        
         BAS   RE,PSTO                                                          
         BAS   RE,ROUND                                                         
         MVC   4(4,R2),SCSPOTS                                                  
*                                                                               
         LA    RE,SBAGYREC                                                      
         CLI   AGYPROF+7-AGYRECD(RE),C'C'      CANADIAN?                        
         BNE   INX                                                              
         CLI   SBQMED,C'N'         TEST MEDIA = CANADIAN NETWORK                
         BNE   INX                                                              
         CLI   SBQNETWK,C'N'       IF REPORTING NETWORK BUYS ONLY               
         BNE   INX                                                              
         L     RE,SBAIO1           AND THIS IS MARKET ZERO BUY                  
         OC    BUYMSTA-BUYRECD(2,RE),BUYMSTA-BUYRECD(RE)                        
         BZ    INX                     THE SPOTS ARE OK                         
         XC    4(4,R2),4(R2)       ELSE OMIT LOCAL SPOTS FOR CPS CALC           
         B     INX                                                              
*                                                                               
OBYCPS   DS    0H                                                               
         MVI   GLHOOK,GLEDIT       LET DRIVER EDIT                              
         ICM   R0,15,0(R2)         BUY GROSS $                                  
         BZ    EXIT                                                             
         OC    4(4,R2),4(R2)                                                    
         BNZ   *+14                                                             
         XC    0(4,R2),0(R2)                                                    
         B     EXIT                                                             
*                                                                               
         SRDA  R0,31               2X GROSS IN R1                               
         D     R0,4(R2)            / # SPOTS                                    
         LTR   R1,R1               NEGATIVE?                                    
         BM    *+8                  YES - DON'T ADD 1                           
         AHI   R1,1                                                             
         SRA   R1,1                DIVIDE BY 2                                  
         ST    R1,0(R2)                                                         
         B     EXIT                                                             
         SPACE 2                                                                
IDIFFNET LA    R6,PAK8             BILLNET - BYNETPD                            
         CLI   SBMODE,SBPROCBL                                                  
         BNE   IDIFF2                                                           
         LA    R1,SBLOCK                                                        
         LA    R1,SBILNETP-SBLOCK(R1)                                           
         ZAP   0(8,R2),0(L'SBILNETP,R1)                                         
         B     IDIFF3                                                           
*                                                                               
IDIFF2   L     RF,SCPAYN           SBMODE = SBPROCSP                            
         LCR   RF,RF                                                            
         CVD   RF,DUB                                                           
         ZAP   0(8,R2),DUB                                                      
*                                                                               
IDIFF3   TM    COLIND,COLIRND      TEST ROUNING                                 
         BZ    INX                 NO                                           
         SRP   0(8,R2),64-2,5      DIVIDE BY 100 TO GET ROUNDED $               
         B     INX                                                              
         EJECT                                                                  
IIDR     DS    0H                                                               
         MVC   0(6,R2),BLANKS                                                   
         CLI   SBCEXTRA+2,C'A'                                                  
         BL    EXIT                                                             
         CLI   SBCEXTRA+2,C'Z'                                                  
         BH    EXIT                                                             
         L     RE,SBAIO1           BUY REC                                      
         LA    RE,BDELEM-BUYREC(RE)                                             
         SR    R0,R0                                                            
*                                                                               
IDR10    CLI   0(RE),0                                                          
         BE    EXIT                                                             
         CLI   0(RE),X'70'                                                      
         BE    *+14                                                             
         IC    R0,1(RE)                                                         
         AR    RE,R0                                                            
         B     IDR10                                                            
*                                                                               
         MVC   0(6,R2),9(RE)                                                    
         OC    0(6,R2),BLANKS                                                   
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
* INVOICE ROUTINES                                                              
IINVCST  DS    0H                                                               
         LA    R6,BIN4                                                          
         L     R1,SBACURCH                                                      
         CLI   0(R4),X'B1'         OLD STYLE INVOICE ELEM?                      
         USING INVELEM,R1                                                       
         BNE   *+14                                                             
         MVC   1(3,R2),INVCOST                                                  
         B     IINVX                                                            
*                                                                               
         USING SNVIDELD,R1                                                      
         ICM   R3,15,SNVIDCST                                                   
         TM    SNVIDCTL,SNVIDNGQ   NEGATIVE COST?                               
         BZ    *+6                 NO                                           
         LNR   R3,R3                                                            
         STCM  R3,15,0(R2)                                                      
*                                                                               
         CLI   GLARGS+2,X'01'      WANT ORIGINAL COST?                          
         BNE   IINVX               NO                                           
         CLI   SNVIDLEN,SNVIDL3Q   HAVE ORIGINAL COST?                          
         BL    IINVX               NO                                           
         OC    SNVIDOR$,SNVIDOR$   ORIG COST NULLS?                             
         BZ    IINVX               YES - REPORT THE REG INV COST                
         XC    0(4,R2),0(R2)       SET TO ZERO                                  
         CLC   SNVIDOR$,XFFS       ORIG COST =X'FFFFFFFF'?                      
         BE    IINVX               YES                                          
         MVC   0(4,R2),SNVIDOR$                                                 
         DROP  R1                                                               
*                                                                               
IINVX    BAS   RE,ROUND                                                         
         B     INX                                                              
*                                                                               
IINVSPT  DS    0H                                                               
         MVI   3(R2),1             EACH INV ELEM IS FOR 1 SPOT                  
         B     INX                                                              
*                                                                               
IINVDATE DS    0H                                                               
         CLI   ELEM,0                                                           
         BE    EXIT                                                             
         CLI   ELEM,X'0B'                                                       
         BE    INVDT10                                                          
         MVC   0(2,R2),ELEM+11                                                  
*                                                                               
         CLI   GLARGS+2,C'D'       DUE DATE OR INV DATE?                        
         BNE   *+14                 INV                                         
         MVC   0(2,R2),ELEM+13      DUE                                         
         B     EXIT                                                             
*                                                                               
         CLI   GLARGS+2,C'A'       ACTIVITY DATE?                               
         BNE   *+14                 NO                                          
         MVC   0(2,R2),ELEM+27                                                  
         B     EXIT                                                             
*                                                                               
         CLI   GLARGS+2,C'F'       DATE OF FIRST MATCH ATTEMPT?                 
         BNE   INVDT05              NO                                          
         GOTO1 DATCON,DMCB,(3,ELEM+45),(2,0(R2))                                
         B     EXIT                                                             
*                                                                               
INVDT05  CLI   GLARGS+2,C'L'       DATE OF LAST MATCH ATTEMPT?                  
         BNE   INVDT06              NO                                          
         GOTO1 DATCON,DMCB,(3,ELEM+49),(2,0(R2))                                
         B     EXIT                                                             
*                                                                               
INVDT06  CLI   GLARGS+2,C'S'       DATE ADDED - DATE MATCHED?                   
         BNE   EXIT                 NO                                          
*                                                                               
         XC    0(2,R2),0(R2)       CLEAR INPUT!                                 
         OC    ELEM+49(2),ELEM+49  IS THERE A LAST MATCHED DATE?                
         BNZ   INVDT07             YES                                          
         CLI   ELEM+48,100         FIRST MATCH 100% SUCCESSFUL?                 
         BNE   EXIT                NO                                           
         GOTO1 DATCON,DMCB,(3,ELEM+45),(0,WORK+6)                               
         B     INVDT08                                                          
*                                                                               
INVDT07  CLI   ELEM+52,100         SUCCESSFULLY MATCHED?                        
         BNE   EXIT                 NO                                          
         GOTO1 DATCON,DMCB,(3,ELEM+49),(0,WORK+6)                               
*                                                                               
INVDT08  GOTO1 DATCON,DMCB,(2,ELEM+27),(0,WORK)                                 
         GOTO1 PERVERT,DMCB,WORK,WORK+6                                         
         MVC   0(2,R2),8(R1)                                                    
         B     EXIT                                                             
*                                                                               
INVDT10  OC    ELEM+11(3),ELEM+11                                               
         BZ    EXIT                                                             
         GOTO1 DATCON,DMCB,(3,ELEM+11),(2,0(R2))                                
         B     EXIT                                                             
*                                                                               
OINVDATE DS    0H                                                               
         CLI   GLARGS+2,C'S'       DATE ADDED - DATE MATCHED?                   
         BNE   OINVD05              NO                                          
         EDIT  (B2,0(R2)),(3,0(R3))                                             
         B     EXIT                                                             
*                                                                               
OINVD05  TM    GLINDS,GLTOTLIN     IS THIS A TOTAL LINE?                        
         BNZ   EXIT                 YES                                         
         OC    0(2,R2),0(R2)                                                    
         BZ    EXIT                                                             
*                                                                               
         LA    R1,0(R3)                                                         
         STCM  R1,15,DMCB+4                                                     
         MVI   DMCB+4,11                                                        
         TM    OPTIND2,OPTIYMD     YYMMDD?                                      
         BZ    *+8                 NO                                           
         MVI   DMCB+4,X'20'                                                     
         GOTO1 DATCON,DMCB,(2,(R2))                                             
         B     EXIT                                                             
*                                                                               
IINVNO   DS    0H                                                               
         MVC   0(10,R2),BLANKS                                                  
         LA    R0,L'LEVELS         SEE IF INVNO IS A ROW OR COL                 
         LA    R1,LEVELS           (FUCKED IF IT'S BOTH)                        
*                                                                               
         CLI   0(R1),QINVNO                                                     
         BE    *+16                                                             
         LA    R1,1(R1)                                                         
         BCT   R0,*-12                                                          
         B     *+8                                                              
         MVI   0(R2),X'FF'         FORCE SORT LAST                              
*                                                                               
         CLI   SBMODE,SBPROCNV     PROCESSING INVOICES?                         
         BNE   EXIT                 NO                                          
         CLI   ELEM,0                                                           
         BE    EXIT                                                             
         MVC   0(10,R2),ELEM+1     INVOICE DATA PASSED IN ELEM                  
         OC    0(10,R2),BLANKS                                                  
         B     EXIT                                                             
*                                                                               
OINVNO   DS    0H                                                               
         TM    GLINDS,GLTOTLIN     IS THIS A TOTAL LINE?                        
         BNZ   OINVNOX              YES                                         
         MVC   0(10,R3),0(R2)                                                   
         CLI   0(R2),X'FF'                                                      
         BNE   EXIT                                                             
         MVC   0(10,R3),BLANKS                                                  
OINVNOX  B     EXIT                                                             
         EJECT                                                                  
*                                                                               
IINVHCST DS    0H                                                               
         LA    R6,PAK8                                                          
         CLI   ELEM,X'0E'          NEW INVOICE REC?                             
         BNE   INX                  NO                                          
         ZAP   0(8,R2),ELEM+17(8)                                               
         ZAP   ELEM+17(8),=P'0'    CLEAR AFTER 1ST USE!!!                       
         TM    COLIND,COLIRND      TEST ROUNING                                 
         BZ    INX                 NO                                           
         SRP   0(8,R2),64-2,5      DIVIDE BY 100 TO GET ROUNDED $               
         B     INX                                                              
*                                                                               
IINVHSPT DS    0H                                                               
         LA    R6,BIN2                                                          
         CLI   ELEM,X'0E'          NEW INVOICE REC?                             
         BNE   INX                  NO                                          
         MVC   0(2,R2),ELEM+15                                                  
         XC    ELEM+15(2),ELEM+15  CLEAR AFTER 1ST USE!!!                       
         B     INX                                                              
*                                                                               
         USING SNVKEYD,R6                                                       
IINVSTAT DS    0H                                                               
         L     R6,SBAIO1           A(INVOICE REC)                               
         MVC   0(1,R2),SNVRSTAT+1                                               
         CLI   GLARGS+2,C'M'       WANT MM FLAGS?                               
         BNE   INX                 NO                                           
         MVC   0(1,R2),SNVRSTAT    YES                                          
         B     INX                                                              
         DROP  R6                                                               
*                                                                               
OINVSTAT DS    0H                                                               
         TM    GLINDS,GLTOTLIN     IS THIS A TOTAL LINE?                        
         BNZ   EXIT                 YES                                         
         CLI   GLARGS+2,C'M'       WANT MM FLAGS?                               
         BNE   OINVS10             NO                                           
*                                                                               
         TM    0(R2),X'20'                                                      
         BZ    *+14                                                             
         MVC   0(8,R3),=C'FILM ERR'                                             
         AHI   R3,198                                                           
*                                                                               
         TM    0(R2),X'10'                                                      
         BZ    *+14                                                             
         MVC   0(7,R3),=C'H/V ERR'                                              
         AHI   R3,198                                                           
*                                                                               
         TM    0(R2),X'08'                                                      
         BZ    *+10                                                             
         MVC   0(7,R3),=C'SEC-SEP'                                              
         B     EXIT                                                             
*                                                                               
OINVS10  TM    0(R2),X'40'         WIP?                                         
         BZ    *+10                 NO                                          
         MVC   0(8,R3),=CL8'IN PROG'   (REPLACED BY MATCHED/APPROVED)           
*                                                                               
         TM    0(R2),X'80'         MATCHED?                                     
         BZ    *+14                 NO                                          
         MVC   0(8,R3),=CL8'MATCHED'                                            
         AHI   R3,198                                                           
*                                                                               
         TM    0(R2),X'02'         APPROVED?                                    
         BZ    EXIT                 NO                                          
         MVC   0(8,R3),=CL8'APPROVED'                                           
         B     EXIT                                                             
*                                                                               
         EJECT                                                                  
*                                                                               
ODEMNAME DS    0H                                                               
         LLC   R1,GLARGS                                                        
         BCTR  R1,0                                                             
         MHI   R1,7                                                             
         LA    R1,DEMNAMES(R1)                                                  
         MVC   0(7,R3),0(R1)                                                    
         OC    0(7,R3),BLANKS                                                   
         B     EXIT                                                             
         EJECT                                                                  
* DOWNLOAD INPUT ROUTINES                                                       
*                                                                               
         SPACE 1                                                                
IDLMED   MVI   0(R2),C'S'          MEDIA                                        
         CLI   SBQMED,C'T'                                                      
         BE    INX                                                              
         MVI   0(R2),C'?'                                                       
         B     INX                                                              
*                                                                               
IDLMKT   MVC   0(24,R2),SBMKTNM    MARKET                                       
         B     INX                                                              
*                                                                               
IDLTYPE  MVC   0(1,R2),GLARGS      TYPE                                         
         B     INX                                                              
*                                                                               
         USING BUYRECD,R3                                                       
IDLDATE  MVC   0(3,R2),BDSTART     BUY START DATE                               
         B     INX                                                              
*                                                                               
IDLDPT   MVC   0(1,R2),BDDAYPT     BUY DAYPART                                  
         B     INX                                                              
*                                                                               
IDLWKS   MVC   0(1,R2),BDWKS       NUMBER OF BUY WEEKS                          
         B     INX                                                              
*                                                                               
IDLSPW   MVC   0(1,R2),BDNOWK      NUMBER OF SPOTS PER WEEK                     
         B     INX                                                              
*                                                                               
IDLSTDAY DS    0H                  BUY START DAY OF WEEK                        
         GOTO1 DATCON,DMCB,(3,BDSTART),DUB                                      
         GOTO1 GETDAY,(R1),DUB,FULL                                             
         CLC   FULL(3),BLANKS                                                   
         BNE   *+6                                                              
         DC    H'0'                                                             
         MVC   0(1,R2),0(R1)                                                    
         OI    0(R2),X'F0'                                                      
         B     INX                                                              
*                                                                               
IDLDAYS  ICM   R1,8,BDDAY          DAYS ROTATION                                
         LA    R0,7                                                             
IDLDAYS2 SLL   R1,1                                                             
         MVI   0(R2),C' '                                                       
         LTR   R1,R1                                                            
         BNM   *+8                                                              
         MVI   0(R2),C'X'                                                       
         LA    R2,1(R2)                                                         
         BCT   R0,IDLDAYS2                                                      
         B     INX                                                              
*                                                                               
IDLGRP   CLC   SBEDEMTY,GLARGS+2   GROSS RATING POINTS                          
         BNE   INX                                                              
         MVC   0(4,R2),SCDEMOS                                                  
         B     INX                                                              
         DROP  R3                                                               
*                                                                               
* DOWNLOAD OUTPUT ROUTINES                                                      
*                                                                               
         SPACE 1                                                                
ODLEST   MVC   SBBEST,1(R2)        ESTIMATE                                     
         CLI   SBBEST,0            TEST ESTIMATE=0                              
         BNE   *+10                                                             
         MVC   SBBEST,SBQEST       ESTIMATE MUST BE REQUEST START EST           
         EDIT  SBBEST,(3,(R3)),ALIGN=LEFT                                       
         B     EXIT                                                             
*                                                                               
ODLSTA   MVC   0(5,R3),0(R2)       STATION                                      
         CLI   4(R3),C' '                                                       
         BNE   *+8                                                              
         MVI   4(R3),C'T'                                                       
         B     EXIT                                                             
*                                                                               
ODLADATE CLC   0(2,R2),XFFS        AFFID DATE                                   
         BNE   *+12                                                             
         MVI   PRTSW,C'N'                                                       
         B     EXIT                                                             
         GOTO1 DATCON,DMCB,(2,0(R2)),(X'20',R3)                                 
         B     EXIT                                                             
*                                                                               
ODLDATE  DS    0H                  START DATE                                   
         GOTO1 DATCON,DMCB,(3,0(R2)),(X'20',R3)                                 
         B     EXIT                                                             
*                                                                               
ODLDAY   CLI   0(R2),8             AFFID DAY OF WEEK                            
         BNE   *+12                                                             
         MVI   PRTSW,C'N'                                                       
         B     EXIT                                                             
         MVC   0(1,R3),0(R2)                                                    
         OI    0(R3),X'F0'                                                      
         B     EXIT                                                             
*                                                                               
ODLTIMES LA    R0,2                BUYLINE TIMES                                
         B     ODLTIME                                                          
*                                                                               
ODLATIME CLC   0(2,R2),XFFS        AFFID TIME                                   
         BNE   *+12                                                             
         MVI   PRTSW,C'N'                                                       
         B     EXIT                                                             
         LA    R0,1                                                             
         B     ODLTIME                                                          
*                                                                               
ODLTIME  SR    RE,RE                                                            
ODLTIME2 ICM   RE,3,0(R2)                                                       
         CHI   RE,600              0600 ---> 3000                               
         BNL   *+8                                                              
         AHI   RE,2400                                                          
         CVD   RE,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(4,R3),DUB                                                      
         LA    R2,2(R2)                                                         
         LA    R3,4(R3)                                                         
         BCT   R0,ODLTIME2                                                      
         B     EXIT                                                             
*                                                                               
ODLLEN   LLC   RE,0(R2)            SPOT LENGTH                                  
         CVD   RE,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(3,R3),DUB                                                      
         B     EXIT                                                             
*                                                                               
ODLWKS   DS    0H                  NUMBER OF BUY WEEKS, AND                     
ODLSPW   LLC   RE,0(R2)            SPOTS PER WEEK                               
         CVD   RE,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(2,R3),DUB                                                      
         B     EXIT                                                             
*                                                                               
ODLCOST  DS    0H                  COST                                         
         EDIT  (B4,0(R2)),(10,(R3)),2,FILL=0,ZERO=NOBLANK                       
         B     EXIT                                                             
*                                                                               
ODLGRP   DS    0H                  GRPS                                         
         EDIT  (B4,0(R2)),(4,(R3)),1,FILL=0,ZERO=NOBLANK                        
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
* OTHER ROUTINES                                                                
*                                                                               
IMKTA    EQU   *                   ALPHA MARKET NAME                            
*        LA    R1,SBMKTREC         A(MKT REC IN STORAGE)                        
         LA    RE,SBLOCK                                                        
         USING SBLOCK,RE                                                        
         LA    R1,SBMKTREC                                                      
         USING MKTRECD,R1                                                       
         MVC   0(3,R2),MKTALST     ALPHA MARKET CODE                            
         DROP  R1,RE                                                            
         B     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
*                COMMERCIAL INPUT AND OUTPUT ROUTINES                 *         
*                ------------------------------------                 *         
*                                                                     *         
*          THE FOLLOWING FILM KEYWORDS SHARE THIS ROUTINE             *         
*                                                                     *         
* KEYWORD  GLARGS  INPUT LEN  KEYWORD REPORT CMML FOR PIGGIES?        *         
* -------  ------  ---------  --------------------------------        *         
* AD-ID    B 00 05     27     NO                                      *         
* AD-IDCD  C 00 05     12     NO                                      *         
* CML      B V  00     46     CODE(8) NAME(15) CODE2(8) NAME2(15)     *         
* CMLCD    C 00 00     16     CODE(8) CODE2(8)                        *         
* CMLNM    N 00 00     30     NAME(15) NAME2(15)                      *         
* CMLNM2   N 00 03     15     NO                                      *         
* CMLNM3   N 00 04     15     NO                                      *         
***********************************************************************         
ICML     DS    0H                                                               
         BRAS  RE,ICMML                                                         
         B     EXIT                                                             
*                                                                               
ICMLCLS  GOTO1 GETCML,0            COMMERCIAL CLASS                             
         MVC   0(4,R2),CMLCLAS                                                  
         B     EXIT                                                             
*                                                                               
ICMLCLNM GOTO1 GETCML,1            COMMERCIAL CLASS NAME                        
         CLI   GLARGS+1,C'B'       TEST BOTH CODE AND NAME                      
         BNE   *+14                                                             
         MVC   0(4,R2),CMLCLAS     YES                                          
         LA    R2,4(R2)                                                         
         MVC   0(24,R2),CMLCLSNM   CLASS NAME                                   
         B     EXIT                                                             
*                                                                               
IHDCML   DS    0H                  SPCL HD CML NAME TO PRINT CLS SPLITS         
         GOTO1 GETCML,2                                                         
         MVC   0(24,R2),CMLCLSNM   CLASS NAME                                   
         MVC   24(1,R2),CMLCNUM    NUMBER OF CLASSES                            
         B     EXIT                                                             
*                                                                               
OHDCML   DS    0H                                                               
         MVC   LABLAREA(5),=C'CLASS'    COMMERCIAL CLASS                        
         ZICM  R0,24(R2),1         GET # SPLITS                                 
         BZ    EXIT                                                             
         LA    RF,24               DIVIDE 24 PRINT POSNS BY # OF SPLITS         
         SR    RE,RE                (GENOUT WILL SQUASH)                        
         DR    RE,R0                                                            
         BCTR  RF,0                                                             
         LA    RE,NAMEAREA         OUTPUT AREA                                  
         LR    R1,R2               INPUT                                        
*                                                                               
OHD10    EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,RE),0(R1)                                                    
         LA    RE,1(RE,RF)                                                      
         LA    R1,1(R1,RF)                                                      
         MVI   0(RE),C'*'                                                       
         LA    RE,1(RE)                                                         
         BCT   R0,OHD10                                                         
         BCTR  RE,0                                                             
         MVI   0(RE),C' '                                                       
         GOTO1 SQUASHER,DMCB,NAMEAREA,36                                        
         B     GENOUT                                                           
*                                                                               
OCML     BRAS  RE,OCMML                 COMMERCIAL ROUTINE                      
         B     OCMLX                                                            
*                                                                               
OCMLCLS  MVC   LABLAREA(5),=C'CLASS'    COMMERCIAL CLASS                        
         MVC   CODEAREA(4),0(R2)                                                
         TM    OPTIND3,OPTIMTOT         TEST FOR MATCHTOT OPTION                
         BZ    OCMLX                                                            
         TM    GLINDS,GLTOTLIN          YES-TEST DETAIL LINE                    
         BZ    OCMLCLS6                 YES-ELIGIBLE FOR SUPPRESSION            
         CLI   CMCLSLEV,0               NO-TEST COMMERCIAL CLASS LEVEL          
         BNE   OCMLCLS4                    IS SET YET                           
         LA    R1,LEVELS                NO-GET IT NOW                           
         LA    RE,1                                                             
*                                                                               
OCMLCLS2 CLI   0(R1),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLI   0(R1),QCMLCLS                                                    
         BE    *+16                                                             
         LA    R1,1(R1)                                                         
         LA    RE,1(RE)                                                         
         B     OCMLCLS2                                                         
         STC   RE,CMCLSLEV                                                      
*                                                                               
OCMLCLS4 CLC   GLLEVEL,CMCLSLEV    TEST COMMERCIAL CLASS TOTAL                  
         BE    OCMLX               YES-ALWAYS PRINT                             
*                                                                               
OCMLCLS6 OC    CODEAREA(4),BLANKS                                               
         CLC   SVUDEF,CODEAREA     TEST UDEF MATCHES CLASS                      
         BNE   OCMLX                                                            
         MVI   PRTSW,C'N'          YES-SUPPRESS THE PRINT LINE                  
         B     OCMLX                                                            
*                                                                               
OCMLCLNM MVC   LABLAREA(5),=C'CLASS'    COMMERCIAL CLASS NAME                   
         CLI   GLARGS,C'B'                                                      
         BNE   *+14                                                             
         MVC   CODEAREA(4),0(R2)                                                
         LA    R2,4(R2)                                                         
         MVC   NAMEAREA(24),0(R2)                                               
         B     OCMLX                                                            
*                                                                               
OCMLX    DS    0H                                                               
         TM    OPTIND4,OPTCMLBK    LEAVE UNKNOWN & ZZZZ BLANK?                  
         BZ    GENOUT                                                           
*                                                                               
         CLC   NAMEAREA(7),=C'UNKNOWN'                                          
         BE    *+14                                                             
         CLC   NAMEAREA(4),=C'ZZZZ'                                             
         BNE   *+10                                                             
         MVC   NAMEAREA(8),BLANKS                                               
*                                                                               
         CLC   CODEAREA(7),=C'UNKNOWN'                                          
         BE    *+14                                                             
         CLC   CODEAREA(4),=C'ZZZZ'                                             
         BNE   *+10                                                             
         MVC   CODEAREA(8),BLANKS                                               
         B     GENOUT                                                           
*                                                                               
ICMLNUM  DS    0H                  CLIENT COMMERCIAL NUMBER                     
         GOTO1 GETCML,0                                                         
         MVC   0(20,R2),CMLNUM                                                  
         B     EXIT                                                             
*                                                                               
ICMLBCOD DS    0H                  CLIENT COMMERCIAL BASIC CODE                 
         GOTO1 GETCML,0                                                         
         MVC   0(16,R2),CMLBCODE                                                
         B     EXIT                                                             
         EJECT                                                                  
* I/O ROUTINES FOR USER DEFINITION FIELDS                                       
*                                                                               
         SPACE 1                                                                
IUDEF    LA    R3,GLARGS           LOOP THROUGH ARGS                            
         LA    R0,4                MAX 4 UDEF EXPRESSIONS                       
*                                                                               
IUDEF2   CLI   0(R3),0             TEST END OF ARGS LIST                        
         BE    IUDEF10                                                          
         CLI   1(R3),0             NO-TEST FIELD IS DEFINED FOR CLIENT          
         BE    IUDEF8                                                           
         LA    R6,UDEFTAB          YES-DETERMINE UDEF EXPRESSION                
*                                                                               
IUDEF4   CLI   0(R6),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   0(1,R3),0(R6)                                                    
         BE    *+12                                                             
         LA    R6,L'UDEFTAB(R6)                                                 
         B     IUDEF4                                                           
         SR    R4,R4               R4=A(USER FIELD)                             
         ICM   R4,3,1(R6)                                                       
         LA    R4,SBLOCK(R4)                                                    
         CLI   2(R3),C'D'          TEST DATA TYPE = DATE                        
         BNE   IUDEF6                                                           
         CLC   0(6,R4),BLANKS      AND FIELD IS SET                             
         BNH   IUDEF6                                                           
         GOTO1 DATVAL,DMCB,(0,(R4)),DUB   YES-GET THE DATE                      
         OC    0(4,R1),0(R1)                                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
         GOTO1 DATCON,DMCB,DUB,(2,(R2))                                         
         LA    R2,2(R2)            SORT ON DATE                                 
*                                                                               
IUDEF6   LLC   RE,1(R3)            LENGTH OF FIELD                              
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),0(R4)       MOVE INTO DRIVER INPUT FIELD                 
         LA    R2,1(RE,R2)                                                      
*                                                                               
IUDEF8   LA    R3,3(R3)            NEXT UDEF EXPRESSION                         
         BCT   R0,IUDEF2                                                        
*                                                                               
IUDEF10  B     EXIT                                                             
         SPACE 2                                                                
OUDEF    CLC   0(10,R2),XFFS       TEST DETAIL TOTAL (LEN S.B. 32...)           
         BE    OUDEFX                                                           
         LR    R5,R3               R5=A(OUTPUT AREA)                            
         CLI   GLARGS+3,0          TEST MORE THAN 1 UDEF EXPRESSION             
         BNE   *+8                                                              
         LA    R5,NAMEAREA         NO-FORMAT TO NAMEAREA                        
         LA    R4,GLARGS           LOOP THROUGH ARGS                            
         LA    R0,4                MAX 4 UDEF EXPRESSIONS                       
*                                                                               
OUDEF2   CLI   0(R4),0             TEST END OF ARGS LIST                        
         BE    OUDEFX                                                           
         MVI   0(R5),0             NON-PRINTABLE CHAR                           
         CLI   1(R4),0             TEST FIELD IS DEFINED FOR CLIENT             
         BE    OUDEF6                                                           
         LA    R6,UDEFTAB          YES-DETERMINE UDEF EXPRESSION                
*                                                                               
OUDEF4   CLI   0(R6),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   0(1,R4),0(R6)                                                    
         BE    *+12                                                             
         LA    R6,L'UDEFTAB(R6)                                                 
         B     OUDEF4                                                           
         CLI   2(R4),C'D'          TEST DATA TYPE = DATE                        
         BNE   *+8                                                              
         LA    R2,2(R2)            YES-SKIP PAST COMPRESSED DATE                
         LLC   R1,1(R4)            R1=L'DATA                                    
         LR    RE,R1                                                            
         CLC   MYOLEN,1(R4)        TEST OUTPUT LENGTH IS LESS                   
         BNL   OUDEF4A                                                          
*                                                                               
         TM    GLINDS,GLTOTLIN     IS THIS A TOTAL LINE                         
         BZ    *+12                 NO                                          
         LA    RE,15                                                            
         B     *+12                                                             
*                                                                               
         ICM   RE,1,MYOLEN                                                      
         BZ    OUDEF5                                                           
*                                                                               
OUDEF4A  BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R5),0(R2)       MOVE DATA TO PRINT LINE                      
*                                                                               
OUDEF5   DS    0H                                                               
         XC    SVUDEF,SVUDEF                                                    
         CHI   RE,3                                                             
         BNH   *+8                                                              
         LH    RE,=H'3'                                                         
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   SVUDEF(0),0(R2)     SAVE THE FIRST 4 BYTES OF UDEF VALUE         
         OC    SVUDEF,BLANKS                                                    
         LA    R2,0(R1,R2)         ADVANCE TO NEXT UDEF EXPRESSION              
         CLI   GLARGS+3,0          TEST ONLY ONE UDEF EXPRESSION                
         BNE   OUDEF6                                                           
         SR    R1,R1               YES-MOVE DESCRIPTION TO LABLAREA             
         ICM   R1,3,3(R6)                                                       
         LA    R1,SBLOCK(R1)                                                    
         MVC   LABLAREA,0(R1)                                                   
*                                                                               
OUDEF6   CLI   GLARGS+3,0          TEST ONLY ONE UDEF EXPRESSION                
         BNE   OUDEF7                                                           
         B     GENOUT                                                           
*                                                                               
OUDEF7   LA    R4,3(R4)            NEXT UDEF EXPRESSION                         
         LA    R5,198(R5)          NEXT PRINT LINE                              
         BCT   R0,OUDEF2                                                        
*                                                                               
OUDEFX   B     EXIT                                                             
         SPACE 2                                                                
HUDEF    L     R1,GLADTENT                                                      
         LLC   RF,DRHDWDTH-DRHDD(R1)    RF=COLUMN WIDTH                         
         LA    RE,L'SBUP1DES       SET RE FOR EXEXUTED MOVE                     
         CR    RE,RF                                                            
         BNH   *+6                                                              
         LR    RE,RF                                                            
         BCTR  RE,0                                                             
         SR    R0,R0               R0=N'UDEF EXPRESSIONS                        
         ICM   R0,1,GLARGS                                                      
         BZ    HUDEF8                                                           
         LA    R4,GLARGS+1                                                      
*                                                                               
HUDEF2   MVI   0(R3),0             INIT HEADING WITH NON-PRINTABLE CHAR         
         CLI   0(R4),0             TEST UDEF AT THIS PRINT POSITION             
         BE    HUDEF6                                                           
         LA    R6,UDEFTAB          YES-DETERMINE UDEF EXPRESSION                
*                                                                               
HUDEF4   CLI   0(R6),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   0(1,R4),0(R6)                                                    
         BE    *+12                                                             
         LA    R6,L'UDEFTAB(R6)                                                 
         B     HUDEF4                                                           
         SR    R1,R1                                                            
         ICM   R1,3,3(R6)                                                       
         LA    R1,SBLOCK(R1)       R1=A(UDEF DESCRIPTION)                       
         EX    RE,*+8              MOVE DESCRIPTION TO HEADING                  
         B     *+10                                                             
         MVC   0(0,R3),0(R1)                                                    
*                                                                               
HUDEF6   LA    R3,198(R3)          NEXT PRINT LINE                              
         LA    R4,1(R4)            NEXT UDEF EXPRESSION                         
         BCT   R0,HUDEF2                                                        
*                                                                               
HUDEF8   B     EXIT                                                             
         SPACE 2                                                                
UDEFTAB  DS    0CL5                                                             
         DC    X'01',AL2(SBUP1FLD-SBLOCK),AL2(SBUP1DES-SBLOCK)                  
         DC    X'02',AL2(SBUP2FLD-SBLOCK),AL2(SBUP2DES-SBLOCK)                  
         DC    X'03',AL2(SBUE1FLD-SBLOCK),AL2(SBUE1DES-SBLOCK)                  
         DC    X'04',AL2(SBUE2FLD-SBLOCK),AL2(SBUE2DES-SBLOCK)                  
         DC    X'00'                                                            
*                                                                               
         EJECT                                                                  
* I/O ROUTINES FOR USER COMMENT FIELDS                                          
*                                                                               
         SPACE 1                                                                
IUCOM    LA    R3,GLARGS           LOOP THROUGH ARGS                            
         LA    R0,4                MAX 4 UCOM EXPRESSIONS                       
*                                                                               
IUCOM2   CLI   0(R3),0             TEST END OF ARGS LIST                        
         BE    IUCOM10                                                          
         CLI   1(R3),0             NO-TEST FIELD IS DEFINED FOR CLIENT          
         BE    IUCOM8                                                           
         LA    R6,UCOMTAB          YES-DETERMINE UCOM EXPRESSION                
*                                                                               
IUCOM4   CLI   0(R6),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   0(1,R3),0(R6)                                                    
         BE    *+12                                                             
         LA    R6,L'UCOMTAB(R6)                                                 
         B     IUCOM4                                                           
*                                                                               
         SR    R4,R4               R4=A(USER FIELD)                             
         ICM   R4,3,1(R6)                                                       
         L     RE,AUCOMTAB                                                      
         AR    R4,RE                                                            
         CLI   2(R3),C'D'          TEST DATA TYPE = DATE                        
         BNE   IUCOM6                                                           
         CLC   0(6,R4),BLANKS      AND FIELD IS SET                             
         BNH   IUCOM6                                                           
         GOTO1 DATVAL,DMCB,(0,(R4)),DUB   YES-GET THE DATE                      
         OC    0(4,R1),0(R1)                                                    
         BNZ   *+6                                                              
         DCHO                                                                   
         GOTO1 DATCON,DMCB,DUB,(2,(R2))                                         
         LA    R2,2(R2)            SORT ON DATE                                 
*                                                                               
IUCOM6   LLC   RE,1(R3)            LENGTH OF FIELD                              
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),0(R4)       MOVE INTO DRIVER INPUT FIELD                 
         EX    RE,*+8                                                           
         B     *+10                                                             
         OC    0(0,R2),BLANKS                                                   
         LA    R2,1(RE,R2)                                                      
*                                                                               
IUCOM8   LA    R3,3(R3)            NEXT UCOM EXPRESSION                         
         BCT   R0,IUCOM2                                                        
*                                                                               
IUCOM10  B     EXIT                                                             
         SPACE 2                                                                
*                                                                               
OUCOM    LR    R5,R3               R5=A(OUTPUT AREA)                            
         CLI   GLARGS+3,0          TEST MORE THAN 1 UCOM EXPRESSION             
         BNE   *+8                                                              
         LA    R5,NAMEAREA         NO-FORMAT TO NAMEAREA                        
         LA    R4,GLARGS           LOOP THROUGH ARGS                            
         LA    R0,4                MAX 4 UCOM EXPRESSIONS                       
*                                                                               
OUCOM2   CLI   0(R4),0             TEST END OF ARGS LIST                        
         BE    OUCOM8                                                           
         MVI   0(R5),0             NON-PRINTABLE CHAR                           
         CLI   1(R4),0             TEST FIELD IS DEFINED FOR CLIENT             
         BE    OUCOM6                                                           
         LA    R6,UCOMTAB          YES-DETERMINE UCOM EXPRESSION                
*                                                                               
OUCOM4   CLI   0(R6),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   0(1,R4),0(R6)                                                    
         BE    *+12                                                             
         LA    R6,L'UCOMTAB(R6)                                                 
         B     OUCOM4                                                           
*                                                                               
         CLI   2(R4),C'D'          TEST DATA TYPE = DATE                        
         BNE   *+8                                                              
         LA    R2,2(R2)            YES-SKIP PAST COMPRESSED DATE                
         LLC   R1,1(R4)            R1=L'DATA                                    
         LR    RE,R1                                                            
         CLC   MYOLEN,1(R4)        TEST OUTPUT LENGTH IS LESS                   
         BNL   OUCOM4A                                                          
*                                                                               
         TM    GLINDS,GLTOTLIN     IS THIS A TOTAL LINE                         
         BZ    *+12                 NO                                          
         LA    RE,15                                                            
         B     *+12                                                             
*                                                                               
         ICM   RE,1,MYOLEN                                                      
         BZ    OUCOM5                                                           
*                                                                               
OUCOM4A  BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R5),0(R2)       MOVE DATA TO PRINT LINE                      
*                                                                               
OUCOM5   LA    R2,0(R1,R2)         ADVANCE TO NEXT UCOM EXPRESSION              
         CLI   GLARGS+3,0          TEST ONLY ONE UCOM EXPRESSION                
         BNE   OUCOM6                                                           
         SR    R1,R1               YES-MOVE DESCRIPTION TO LABLAREA             
         ICM   R1,3,3(R6)                                                       
         L     RF,AUCOMTAB                                                      
         AR    R1,RF                                                            
         MVC   LABLAREA,0(R1)                                                   
*                                                                               
OUCOM6   CLI   GLARGS+3,0          TEST ONLY ONE UCOM EXPRESSION                
         BNE   OUCOM7                                                           
         B     GENOUT                                                           
*                                                                               
OUCOM7   LA    R4,3(R4)            NEXT UCOM EXPRESSION                         
         LA    R5,198(R5)          NEXT PRINT LINE                              
         BCT   R0,OUCOM2                                                        
*                                                                               
OUCOM8   B     EXIT                                                             
         SPACE 2                                                                
*                                                                               
HUCOM    L     R1,GLADTENT                                                      
         LLC   RF,DRHDWDTH-DRHDD(R1)    RF=COLUMN WIDTH                         
         LA    RE,L'UCDP1DES       SET RE FOR EXECUTED MOVE                     
         CR    RE,RF                                                            
         BNH   *+6                                                              
         LR    RE,RF                                                            
         BCTR  RE,0                                                             
         SR    R0,R0               R0=N'UCOM EXPRESSIONS                        
         ICM   R0,1,GLARGS                                                      
         BZ    HUCOM8                                                           
         LA    R4,GLARGS+1                                                      
*                                                                               
HUCOM2   MVI   0(R3),0             INIT HEADING WITH NON-PRINTABLE CHAR         
         CLI   0(R4),0             TEST UCOM AT THIS PRINT POSITION             
         BE    HUCOM6                                                           
         LA    R6,UCOMTAB          YES-DETERMINE UCOM EXPRESSION                
*                                                                               
HUCOM4   CLI   0(R6),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   0(1,R4),0(R6)                                                    
         BE    *+12                                                             
         LA    R6,L'UCOMTAB(R6)                                                 
         B     HUCOM4                                                           
*                                                                               
         SR    R1,R1                                                            
         ICM   R1,3,3(R6)                                                       
         L     RF,AUCOMTAB                                                      
         AR    R1,RF               R1=A(UCOM DESCRIPTION)                       
         EX    RE,*+8              MOVE DESCRIPTION TO HEADING                  
         B     *+10                                                             
         MVC   0(0,R3),0(R1)                                                    
*                                                                               
HUCOM6   LA    R3,198(R3)          NEXT PRINT LINE                              
         LA    R4,1(R4)            NEXT UCOM EXPRESSION                         
         BCT   R0,HUCOM2                                                        
*                                                                               
HUCOM8   B     EXIT                                                             
         SPACE 2                                                                
UCOMTAB  DS    0CL5                                                             
         DC    X'01',AL2(UCDP1FLD-UCOMD),AL2(UCDP1DES-UCOMD)                    
         DC    X'02',AL2(UCDP2FLD-UCOMD),AL2(UCDP2DES-UCOMD)                    
         DC    X'03',AL2(UCDP3FLD-UCOMD),AL2(UCDP3DES-UCOMD)                    
         DC    X'04',AL2(UCDP4FLD-UCOMD),AL2(UCDP4DES-UCOMD)                    
         DC    X'05',AL2(UCDE1FLD-UCOMD),AL2(UCDE1DES-UCOMD)                    
         DC    X'06',AL2(UCDE2FLD-UCOMD),AL2(UCDE2DES-UCOMD)                    
         DC    X'07',AL2(UCDE3FLD-UCOMD),AL2(UCDE3DES-UCOMD)                    
         DC    X'08',AL2(UCDE4FLD-UCOMD),AL2(UCDE4DES-UCOMD)                    
         DC    X'09',AL2(UCDM1FLD-UCOMD),AL2(UCDM1DES-UCOMD)                    
         DC    X'0A',AL2(UCDM2FLD-UCOMD),AL2(UCDM2DES-UCOMD)                    
         DC    X'0B',AL2(UCDM3FLD-UCOMD),AL2(UCDM3DES-UCOMD)                    
         DC    X'0C',AL2(UCDM4FLD-UCOMD),AL2(UCDM4DES-UCOMD)                    
         DC    X'00'                                                            
*                                                                               
         EJECT                                                                  
IATTCODE MVC   0(1,R2),SBQMED      MEDIA                                        
         CLI   SBQMED,C'*'                                                      
         BNE   *+10                                                             
         MVC   0(1,R2),SBMED                                                    
*                                                                               
         CLI   0(R2),C'R'                                                       
         BNE   *+14                                                             
         MVC   0(2,R2),=C'SR'      SPOT RADIO                                   
         B     *+18                                                             
*                                                                               
         CLI   0(R2),C'X'                                                       
         BNE   *+18                                                             
         MVC   0(2,R2),=C'NR'      NET RADIO                                    
         LA    R2,2(R2)            A(EST NUMBER POSN)                           
         B     IATT10                                                           
*                                                                               
         CLI   0(R2),C'T'                                                       
         BE    *+12                                                             
         MVI   0(R2),C'?'          HUH?                                         
         B     *+8                                                              
         MVI   0(R2),C'S'          SPOT TV                                      
         LA    R2,1(R2)            A(EST NUMBER POSN)                           
*                                                                               
IATT10   EDIT  SBBEST,(3,0(R2)),FILL=0                                          
         B     EXIT                                                             
         SPACE                                                                  
*                                                                               
OATTCODE DS    0H                                                               
         MVC   LABLAREA(05),=C'MEDIA'                                           
         MVC   CODEAREA(5),0(R2)                                                
         B     GENOUT                                                           
         EJECT                                                                  
*                                                                               
OADATE   MVC   LABLAREA(4),=C'DATE'     AFFIDAVIT DATE                          
         MVC   NAMEAREA(7),=C'UNKNOWN'                                          
         CLC   0(2,R2),XFFS                                                     
         BE    GENOUT                                                           
         CLI   GLARGS,X'01'        REVERSE DATE OUTPUT?                         
         BNE   OADATE10             NO                                          
         GOTO1 DATCON,DMCB,(2,(R2)),(X'20',NAMEAREA)                            
         MVI   NAMEAREA+6,C' '     CLEAR 'N' FROM UNKNOWN                       
         B     GENOUT                                                           
*                                                                               
OADATE10 DS    0H                                                               
         CLI   GLARGS,X'02'        MM/DD/YY DATE OUTPUT?                        
         BNE   OADATE20             NO                                          
         GOTO1 DATCON,DMCB,(2,(R2)),(10,NAMEAREA)                               
         B     GENOUT                                                           
*                                                                               
OADATE20 DS    0H                                                               
         LA    R1,NAMEAREA                                                      
         ST    R1,DMCB+4                                                        
         MVI   DMCB+4,8                                                         
         TM    OPTIND3,OPTICYMD    CCYYMMDD?                                    
         BZ    *+8                                                              
         MVI   DMCB+4,20                                                        
*                                                                               
         GOTO1 DATCON,DMCB,(2,(R2))                                             
         B     GENOUT                                                           
*                                                                               
OADAY    MVC   LABLAREA(3),=C'DAY'      AFFIDAVIT DAY                           
         MVC   NAMEAREA(3),1(R2)                                                
         B     GENOUT                                                           
         SPACE 2                                                                
*                                                                               
OATIME   MVC   LABLAREA(4),=C'TIME'     AFFIDAVIT TIME                          
         CLC   0(2,R2),=X'FFFF'                                                 
         BNE   *+14                                                             
         MVC   NAMEAREA(7),=C'UNKNOWN'                                          
         B     GENOUT                                                           
         XC    FULL,FULL                                                        
         MVC   FULL(2),0(R2)                                                    
         CLI   GLARGS,X'01'        OUTPUT IN MIL TIME?                          
         BNE   OATIME10             NO                                          
         EDIT  (2,FULL),(4,NAMEAREA),ZERO=NOBLANK,ALIGN=LEFT                    
         B     GENOUT                                                           
*                                                                               
OATIME10 GOTO1 UNTIME,DMCB,FULL,NAMEAREA                                        
         B     GENOUT                                                           
         SPACE 2                                                                
*                                                                               
OAPROG   MVC   LABLAREA(7),=C'PROGRAM'  AFFIDAVIT PROGRAM                       
         MVC   NAMEAREA(16),0(R2)                                               
         B     GENOUT                                                           
         EJECT                                                                  
IBYCDATE DS    0H                                                               
         L     R6,SBAIO1           ADDRESS BUY REC                              
         MVI   ELCODE,X'99'        GET ACTIVITY ELEM                            
         BAS   RE,GETEL                                                         
         BNE   EXIT                                                             
         USING ACTVELEM,R6                                                      
         CLI   GLARGS+2,C'C'       CHANGE OR CREATION DATE?                     
         BE    *+14                 CHANGE                                      
         MVC   0(3,R2),ACTVADD+2   CREATION DATE                                
         B     *+10                                                             
         MVC   0(3,R2),ACTVCHG+2   CHANGE DATE                                  
         DROP  R6                                                               
         B     EXIT                                                             
*                                                                               
IBYCOPY  L     R6,SBAIO1           ADDRESS BUY RECORD                           
         MVI   ELCODE,BCELCODQ     X'91' BUY COPY ELEM                          
         BAS   RE,GETEL                                                         
         BNE   EXIT                                                             
         USING BCELEM,R6                                                        
         MVC   0(4,R2),BCDATE      DATE & TIME OF SBY RUN                       
         B     EXIT                                                             
         DROP  R6                                                               
*                                                                               
OBYCOPY  MVC   NAMEAREA(7),=C'UNKNOWN'                                          
         OC    0(4,R2),0(R2)                                                    
         BZ    GENOUT                                                           
         MVC   LABLAREA(14),=C'COPY DATE/TIME'                                  
         GOTO1 DATCON,DMCB,(2,0(R2)),(5,NAMEAREA)                               
*                                                                               
         XC    FULL,FULL           ANNIE GIVES TIME AS PWOS                     
         ZAP   DUB,=P'0'                                                        
         MVO   DUB,2(2,R2)                                                      
         CVB   RE,DUB                                                           
         STCM  RE,3,FULL                                                        
         GOTO1 UNTIME,DMCB,FULL,NAMEAREA+9                                      
         B     GENOUT                                                           
*                                                                               
IGLCDATE DS    0H                                                               
         L     R6,SBAIO1           ADDRESS GOAL REC                             
         USING GOALRECD,R6                                                      
         MVC   0(2,R2),GREDATE     CREATION DATE                                
         CLI   GLARGS+1,X'01'      WANT LAST GOAL DATA LOCKIN?                  
         BNE   *+10                NO                                           
         MVC   0(2,R2),GDLKGOAL                                                 
         CLI   GLARGS+1,X'02'      WANT LAST BUY DATA LOCKIN?                   
         BNE   *+10                NO                                           
         MVC   0(2,R2),GDLKBUY                                                  
         DROP  R6                                                               
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
ICOST2PS DS    0H                                                               
         ICM   RF,15,SCGROSS2                                                   
         BZ    EXIT                                                             
         STCM  RF,15,0(R2)                                                      
         MVC   4(4,R2),SCSPOTS                                                  
         B     EXIT                                                             
*                                                                               
OCOST2PS DS    0H                                                               
         TM    GLINDS,GLTOTLIN                                                  
         BZ    OC210                                                            
         ICM   RF,15,0(R2)                                                      
         B     OC220                                                            
*                                                                               
OC210    MVC   FULL,4(R2)                                                       
         ICM   RE,15,0(R2)                                                      
         BZ    EXIT                                                             
         SR    RF,RF                                                            
         SRDA  RE,31               2*RE IN RERF                                 
         D     RE,FULL                                                          
         LTR   RF,RF               NEG?                                         
         BM    *+8                 DON'T NEED TO ADD 1                          
         AHI   RF,1                NOT AN LA!!!                                 
         SRA   RF,1                DIVIDE RESULT BY 2                           
*                                                                               
OC220    EDIT  (RF),(14,(R3)),2,MINUS=YES                                       
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
ISTAFFCH DS    0H                                                               
         MVC   0(5,R2),SBSTA       STATION                                      
         CLI   SBMED,C'N'                                                       
         BNE   *+8                                                              
         MVI   4(R2),C'N'                                                       
         MVC   5(3,R2),SBAFFIL     AFFILIATE                                    
         MVC   8(4,R2),SBCHAN      CHANNEL                                      
         MVI   12(R2),C' '                                                      
         CLI   SBMED,C'R'          RADIO?                                       
         BNE   EXIT                NO                                           
         CLI   SBSTA+4,C'F'        FM?                                          
         BNE   EXIT                NO                                           
         CLI   SBCHAN+3,C'.'       HAVE DECIMAL PLACE?                          
         BE    EXIT                YES, HAVE CORRECT FORMAT                     
         MVI   11(R2),C'.'                                                      
         MVC   12(1,R2),SBCHAN+3                                                
         B     EXIT                                                             
*                                                                               
OSTAFFCH DS    0H                                                               
         MVC   LABLAREA(12),=C'STA/AFFIL/CH'                                    
         MVC   NAMEAREA(4),0(R2)                                                
         CLI   4(R2),C'N'          TEST NETWORK                                 
         BE    OSTAFF20                                                         
         MVI   NAMEAREA+4,C'-'                                                  
         MVC   NAMEAREA+5(1),4(R2)                                              
         MVI   NAMEAREA+6,C'M'                                                  
         CLI   4(R2),C'T'                                                       
         BE    *+12                                                             
         CLI   4(R2),C' '                                                       
         BH    OSTAFF20                                                         
         MVC   NAMEAREA+5(2),=C'TV'                                             
*                                                                               
OSTAFF20 DS    0H                                                               
         MVC   NAMEAREA+8(3),5(R2) AFFIL                                        
         MVC   NAMEAREA+12(5),8(R2) CHAN                                        
         B     GENOUT                                                           
         EJECT                                                                  
*                                                                               
NOREPORT DS    0H                                                               
         MVC   LABLAREA(6),=C'REPORT'                                           
         B     GENOUT                                                           
*                                                                               
ONAME    DS    0H                                                               
         L     RF,ATWA                                                          
         USING CONHEADH-64,RF                                                   
         MVC   LABLAREA(6),=C'FORMAT'                                           
         MVC   CODEAREA(08),WRINAM                                              
         LA    RF,WRINAMH          NEXT UNPROTECTED FIELD AFTER NAME            
         XR    R0,R0                IS DESCRIPTION                              
         IC    R0,0(RF)                                                         
         AR    RF,R0                                                            
         TM    1(RF),X'20'                                                      
         BO    *-10                                                             
         MVC   NAMEAREA(27),8(RF)                                               
         B     GENOUT                                                           
         DROP  RF                                                               
         EJECT                                                                  
IDBOOK   DS    0H                                                               
         MVC   0(2,R2),SCACTBK                                                  
         MVC   2(1,R2),SCBKTYP                                                  
         B     EXIT                                                             
*                                                                               
ODBOOK   DS    0H                                                               
         TM    GLINDS,GLTOTLIN     IS THIS A TOTAL LINE?                        
         BNZ   ODBOOKX              YES                                         
         GOTO1 DATCON,DMCB,(3,0(R2)),(6,0(R3))                                  
         CLI   2(R2),C' '                                                       
         BNH   ODBOOKX                                                          
         MVC   6(3,R3),=C'( )'                                                  
         MVC   7(1,R3),2(R2)                                                    
ODBOOKX  B     EXIT                                                             
         EJECT                                                                  
*                                                                               
IPDREP   DS    0H                                                               
         MVC   0(4,R2),SCPDREP     CLEARANCE REP                                
         OC    SCPDREP+1(3),SCPDREP+1                                           
         BZ    *+14                                                             
         CLC   SCPDREP+1(3),=C'000'   TEST PAYEE=0                              
         BNE   EXIT                                                             
         MVC   0(4,R2),=C'DIR '    YES-DIRECT PAYMENT                           
         B     EXIT                                                             
         SPACE 2                                                                
*                                                                               
         USING BUYRECD,R3                                                       
IBONUS   MVC   0(3,R2),=C'REG'                                                  
         CLC   =C'*B',BDPROGRM     BONUS                                        
         BNE   *+10                                                             
         MVC   0(3,R2),=C'BON'                                                  
         CLC   =C'*U',BDPROGRM     UNDER DELIVERY                               
         BNE   *+10                                                             
         MVC   0(3,R2),=C'UND'                                                  
         CLC   =C'*V',BDPROGRM     ADDED VALUE                                  
         BNE   EXIT                                                             
         MVC   0(3,R2),=C'VAL'                                                  
         B     EXIT                                                             
         DROP  R3                                                               
         EJECT                                                                  
*                                                                               
* ROUTINES WHICH USE PACKED ACCUMULATORS INSTEAD OF BINARY                      
IXINVCST DS    0H                                                               
         LA    R6,PAK8                                                          
         L     R1,SBACURCH                                                      
         SR    R3,R3                                                            
         CLI   0(R4),X'B1'         OLD STYLE INVOICE ELEM?                      
         USING INVELEM,R1                                                       
         BNE   INVP10                                                           
         ICM   R3,7,INVCOST                                                     
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         B     INVP20                                                           
         USING SNVIDELD,R1                                                      
INVP10   ICM   R3,15,SNVIDCST                                                   
         TM    SNVIDCTL,SNVIDNGQ   NEGATIVE COST?                               
         BZ    *+6                 NO                                           
         LNR   R3,R3                                                            
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
*                                                                               
         CLI   GLARGS+2,X'01'      WANT ORIGINAL COST?                          
         BNE   INVP20              NO                                           
         CLI   SNVIDLEN,SNVIDL3Q   HAVE ORIGINAL COST?                          
         BL    INVP20              NO                                           
         OC    SNVIDOR$,SNVIDOR$   ORIG COST NULLS?                             
         BZ    INVP20              YES - REPORT REG INV COST                    
         ZAP   0(8,R2),=P'0'       SET TO ZEROS                                 
         CLC   SNVIDOR$,XFFS       ORIG COST =X'FFFFFFFF'?                      
         BE    INVP20              YES                                          
         ICM   R3,15,SNVIDOR$                                                   
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         DROP  R1                                                               
*                                                                               
INVP20   BAS   RE,ROUNDP           ROUND FOR PACKED IF REQUIRED                 
         B     INX                                                              
*                                                                               
IXBILCST LA    R6,PAK8             BILLED COST PACKED                           
         ZAP   0(8,R2),BILCOSTP                                                 
*                                                                               
         L     R1,BILLGST          GST TAX (CANADIAN)                           
         BAS   RE,GSTOP            ADD GST TAX IF NEEDED                        
         L     R1,BILLPST          PST TAX (CANADIAN)                           
         BAS   RE,PSTOP            ADD PST TAX IF NEEDED                        
         BAS   RE,ROUNDP           ROUND FOR PACKED IF REQUIRED                 
         B     INX                                                              
*                                                                               
IXBILL   LA    R6,PAK8             GROSS BILLED                                 
         CLI   GLARGS+2,X'01'      IF CLT$BILL, ONLY PICK UP CUR=X'01'          
         BNE   *+12                                                             
         CLI   SBMODE,SBPROCB1                                                  
         BNE   INX                                                              
*                                                                               
         LA    R1,SBLOCK                                                        
         LA    R1,SBILGRSP-SBLOCK(R1)                                           
         ZAP   0(8,R2),0(L'SBILGRSP,R1)                                         
*                                                                               
         L     R1,BILLGST          GST TAX (CANADIAN)                           
         BAS   RE,GSTOP            ADD GST TAX IF NEEDED                        
         L     R1,BILLPST          PST TAX (CANADIAN)                           
         BAS   RE,PSTOP            ADD PST TAX IF NEEDED                        
         BAS   RE,ROUNDP           ROUND FOR PACKED IF REQUIRED                 
         B     INX                                                              
*                                                                               
IXBILLNT LA    R6,PAK8             NET BILLED                                   
         LA    R1,SBLOCK                                                        
         LA    R1,SBILNETP-SBLOCK(R1)                                           
         ZAP   0(8,R2),0(L'SBILNETP,R1)                                         
*                                                                               
         L     R1,BILLGST          GST TAX (CANADIAN)                           
         BAS   RE,GSTOP            ADD GST TAX IF NEEDED                        
         L     R1,BILLPST          PST TAX (CANADIAN)                           
         BAS   RE,PSTOP            ADD PST TAX IF NEEDED                        
         BAS   RE,ROUNDP           ROUND FOR PACKED IF REQUIRED                 
         B     INX                                                              
*                                                                               
IXBYNTPD LA    R6,PAK8             NET PAID DOLLARS                             
         ICM   R3,15,SCPAYN                                                     
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
*                                                                               
         L     R1,SCGSTP                                                        
         BAS   RE,GSTIP            ADD GST TAX IF NEEDED                        
         L     R1,SCPSTP                                                        
         BAS   RE,PSTIP            ADD PST TAX IF NEEDED                        
         BAS   RE,ROUNDP           ROUND FOR PACKED IF REQUIRED                 
         B     INX                                                              
*                                                                               
IXBHCACT L     R1,ABILLREC                                                      
         USING BILLRECD,R1                                                      
         LA    R6,PAK8                                                          
         ZAP   0(8,R2),BACT2P      BACT2P IS PL6 R2 POINTING TO PL8             
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
         DROP  R1                                                               
*                                                                               
IXBHCGRS L     R1,ABILLREC                                                      
         USING BILLRECD,R1                                                      
         LA    R6,PAK8             GROSS                                        
         ZAP   0(8,R2),BGRS2P      BGRS2P IS PL6 R2 POINTING TO PL8             
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
         DROP  R1                                                               
*                                                                               
IXBHCNET L     R1,ABILLREC                                                      
         USING BILLRECD,R1                                                      
         LA    R6,PAK8             NET AMOUNT                                   
         ZAP   0(8,R2),BNET2P      BNET2P IS PL6 R2 POINTING TO PL8             
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
         DROP  R1                                                               
*                                                                               
IXBHACT  LA    R6,PAK8                                                          
         ZAP   0(8,R2),BILCOSTP    ACTUAL AMOUNT                                
         ICM   R3,15,BILLGST                                                    
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         AP    0(8,R2),DUB         ADD GST IF ANY                               
*                                                                               
         TM    SBEFLAG,SBEPST                                                   
         BZ    IXBH10                                                           
         ICM   R3,15,BILLPST                                                    
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         AP    0(8,R2),DUB                                                      
*                                                                               
IXBH10   BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBHGRS  LA    R6,PAK8                                                          
         LA    R1,SBLOCK                                                        
         LA    R1,SBILGRSP-SBLOCK(R1)                                           
         ZAP   0(8,R2),0(L'SBILGRSP,R1)                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBHNET  LA    R6,PAK8                                                          
         LA    R1,SBLOCK                                                        
         LA    R1,SBILNETP-SBLOCK(R1)                                           
         ZAP   0(8,R2),0(L'SBILNETP,R1)                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBHAGY  L     R1,ABILLREC                                                      
         USING BILLRECD,R1                                                      
         LA    R6,PAK8                                                          
         ZAP   0(8,R2),BILCOSTP                                                 
         TM    BILSTAT,BSTTAORQ   IF TRUE AOR BILL                              
         BO    IXBHAG5            AGY COM = ACTUAL AMOUNT                       
         LA    R1,SBLOCK                                                        
         LA    R1,SBILNETP-SBLOCK(R1)                                           
         SP    0(8,R2),0(L'SBILNETP,R1)                                         
*                                                                               
IXBHAG5  BAS   RE,ROUNDP                                                        
         B     INX                                                              
         DROP  R1                                                               
*                                                                               
IXAORAMT L     R3,AMAORLKD                                                      
         USING MAAORLKD,R3                                                      
         L     R1,ABILLREC                                                      
         USING BILLRECD,R1                                                      
         TM    BILSTAT,BSTCAORQ   DON'T SHOW FOR CLIENT BILL                    
         BO    INX                                                              
         ICM   RE,15,MAAORAMT      AOR AMOUNT                                   
         CVD   RE,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
         DROP  R1,R3                                                            
*                                                                               
IXBILLM  LA    R6,PAK8             BILLED MINUS TAX                             
         LA    R1,SBLOCK                                                        
         LA    R1,SBILGRSP-SBLOCK(R1)                                           
         ZAP   0(8,R2),0(L'SBILGRSP,R1)                                         
         L     R3,SBBILTAX                                                      
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         SP    0(8,R2),DUB                                                      
*                                                                               
         L     R1,BILLGST                                                       
         BAS   RE,GSTOP            ADD GST TAX IF NEEDED                        
         L     R1,BILLPST                                                       
         BAS   RE,PSTOP            ADD PST TAX IF NEEDED                        
         BAS   RE,ROUNDP           ROUND FOR PACKED IF REQUIRED                 
         B     INX                                                              
*                                                                               
IXBILBL  LA    R6,PAK8             GROSS BILLABLE                               
*                                                                               
         ZAP   0(8,R2),=P'0'       CLEAR 2 CONSECUTIVE PACKED                   
         ZAP   8(8,R2),=P'0'                                                    
*                                                                               
         CLI   SBMODE,SBPROCSP     PROCESS A BUY RECORD?                        
         BNE   IBILBL2             NO                                           
         ICM   R3,15,SCGROSS       GROSS DOLLARS                                
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTO                                                        
         BAS   RE,GSTOP            ADD GST TAX IF NEEDED                        
         L     R1,SCPSTO                                                        
         BAS   RE,PSTOP            ADD PST TAX IF NEEDED                        
         BAS   RE,ROUNDP           ROUND FOR PACKED IF REQUIRED                 
         B     INX                                                              
*                                                                               
IBILBL2  CLI   SBMODE,SBPROCBL     PROCESS STATION BILL RECORD?                 
         BE    *+6                 YES                                          
         DC    H'0'                                                             
         LA    R2,8(R2)            NEXT PACKED NUMBER                           
         LA    R1,SBLOCK                                                        
         LA    R1,SBILGRSP-SBLOCK(R1)                                           
         ZAP   0(8,R2),0(L'SBILGRSP,R1)                                         
         L     R1,BILLGST                                                       
         BAS   RE,GSTOP            ADD GST TAX IF NEEDED                        
         L     R1,BILLPST                                                       
         BAS   RE,PSTOP            ADD PST TAX IF NEEDED                        
         BAS   RE,ROUNDP           ROUND FOR PACKED IF REQUIRED                 
         B     INX                                                              
*                                                                               
IXBILBLM LA    R6,PAK8             BILLABLE MINUS TAX                           
*                                                                               
         ZAP   0(8,R2),=P'0'       CLEAR 2 CONSECUTIVE PACKED                   
         ZAP   8(8,R2),=P'0'                                                    
*                                                                               
         CLI   SBMODE,SBPROCSP     PROCESS A BUY RECORD?                        
         BNE   IBILBLM2            NO                                           
         L     R3,SCGROSS                                                       
         S     R3,SCTAX                                                         
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
*                                                                               
         L     R1,SCGSTO                                                        
         BAS   RE,GSTOP                                                         
         L     R1,SCPSTO                                                        
         BAS   RE,PSTOP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IBILBLM2 CLI   SBMODE,SBPROCBL     PROCESS STATION BILL RECORD?                 
         BE    *+6                 YES                                          
         DC    H'0'                                                             
         LA    R2,8(R2)            NEXT PACKED NUMBER                           
         LA    R1,SBLOCK                                                        
         LA    R1,SBILGRSP-SBLOCK(R1)                                           
         ZAP   0(8,R2),0(L'SBILGRSP,R1)                                         
         L     R3,SBBILTAX                                                      
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         SP    0(8,R2),DUB                                                      
*                                                                               
         L     R1,BILLGST                                                       
         BAS   RE,GSTOP                                                         
         L     R1,BILLPST                                                       
         BAS   RE,PSTOP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBILBLC LA    R6,PAK8             BILLABLE COST                                
*                                                                               
         ZAP   0(8,R2),=P'0'       CLEAR 2 CONSECUTIVE PACKED                   
         ZAP   8(8,R2),=P'0'                                                    
*                                                                               
         CLI   SBMODE,SBPROCSP     PROCESS A BUY RECORD?                        
         BNE   IBILBLC2            NO                                           
         ICM   R3,15,SCEFFCST      EFFECTIVE COST                               
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTO                                                        
         BAS   RE,GSTOP                                                         
         L     R1,SCPSTO                                                        
         BAS   RE,PSTOP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IBILBLC2 CLI   SBMODE,SBPROCBL     PROCESS STATION BILL RECORD?                 
         BE    *+6                 YES                                          
         DC    H'0'                                                             
         LA    R2,8(R2)            NEXT PACKED NUMBER                           
         ZAP   0(8,R2),BILCOSTP                                                 
         L     R1,BILLGST                                                       
         BAS   RE,GSTOP                                                         
         L     R1,BILLPST                                                       
         BAS   RE,PSTOP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBILBNT LA    R6,PAK8             NET BILLABLE                                 
*                                                                               
         ZAP   0(8,R2),=P'0'       CLEAR 2 CONSECUTIVE PACKED                   
         ZAP   8(8,R2),=P'0'                                                    
*                                                                               
         CLI   SBMODE,SBPROCSP     PROCESS A BUY RECORD?                        
         BNE   IBILBLN2            NO                                           
         ICM   R3,15,SCNET                                                      
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTO                                                        
         BAS   RE,GSTOP                                                         
         L     R1,SCPSTO                                                        
         BAS   RE,PSTOP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
IBILBLN2 CLI   SBMODE,SBPROCBL     PROCESS STATION BILL RECORD?                 
         BE    *+6                 YES                                          
         DC    H'0'                                                             
         LA    R2,8(R2)            NEXT PACKED NUMBER                           
         LA    R1,SBLOCK                                                        
         LA    R1,SBILNETP-SBLOCK(R1)                                           
         ZAP   0(8,R2),0(L'SBILNETP,R1)                                         
         L     R1,BILLGST                                                       
         BAS   RE,GSTOP                                                         
         L     R1,BILLPST                                                       
         BAS   RE,PSTOP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBYDOL  LA    R6,PAK8             GROSS DOLLARS                                
         ICM   R3,15,SCGROSS                                                    
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTI                                                        
         BAS   RE,GSTIP                                                         
         L     R1,SCPSTI                                                        
         BAS   RE,PSTIP                                                         
         L     R1,SCGSTO                                                        
         BAS   RE,GSTOP                                                         
         L     R1,SCPSTO                                                        
         BAS   RE,PSTOP                                                         
         CLI   GLARGS+2,C'C'       COST KEYWORD?                                
         BE    INX                 YES                                          
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBYNET  LA    R6,PAK8             NET DOLLARS                                  
         ICM   R3,15,SCNET                                                      
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTI                                                        
         BAS   RE,GSTIP                                                         
         L     R1,SCPSTI                                                        
         BAS   RE,PSTIP                                                         
         L     R1,SCGSTO                                                        
         BAS   RE,GSTOP                                                         
         L     R1,SCPSTO                                                        
         BAS   RE,PSTOP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBYCST  LA    R6,PAK8             EFFECTIVE COST                               
         ICM   R3,15,SCEFFCST                                                   
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTI                                                        
         BAS   RE,GSTIP                                                         
         L     R1,SCPSTI                                                        
         BAS   RE,PSTIP                                                         
         L     R1,SCGSTO                                                        
         BAS   RE,GSTOP                                                         
         L     R1,SCPSTO                                                        
         BAS   RE,PSTOP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXASSDOL DS    0H                                                               
         LA    R6,BIN4             ASSIGNED GROSS DOLLARS                       
         ICM   R3,15,SCGROSS2                                                   
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTI                                                        
         BAS   RE,GSTIP                                                         
         L     R1,SCPSTI                                                        
         BAS   RE,PSTIP                                                         
         L     R1,SCGSTO                                                        
         BAS   RE,GSTOP                                                         
         L     R1,SCPSTO                                                        
         BAS   RE,PSTOP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBYDOLM LA    R6,PAK8             GROSS DOLLARS MINUS TAX                      
         L     R3,SCGROSS                                                       
         S     R3,SCTAX                                                         
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTI                                                        
         BAS   RE,GSTIP                                                         
         L     R1,SCPSTI                                                        
         BAS   RE,PSTIP                                                         
         L     R1,SCGSTO                                                        
         BAS   RE,GSTOP                                                         
         L     R1,SCPSTO                                                        
         BAS   RE,PSTOP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBYNETM LA    R6,PAK8             GROSS DOLLARS MINUS TAX                      
         L     R3,SCNET                                                         
         S     R3,SCTAX                                                         
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTI                                                        
         BAS   RE,GSTIP                                                         
         L     R1,SCPSTI                                                        
         BAS   RE,PSTIP                                                         
         L     R1,SCGSTO                                                        
         BAS   RE,GSTOP                                                         
         L     R1,SCPSTO                                                        
         BAS   RE,PSTOP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXASSNET LA    R6,PAK8             ASSIGNED NET DOLLARS                         
         ICM   R3,15,SCNET2                                                     
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
*                                                                               
         L     R1,SCGSTI                                                        
         BAS   RE,GSTIP                                                         
         L     R1,SCPSTI                                                        
         BAS   RE,PSTIP                                                         
         L     R1,SCGSTO                                                        
         BAS   RE,GSTOP                                                         
         L     R1,SCPSTO                                                        
         BAS   RE,PSTOP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IINVHCSP DS    0H                  STEVE, YOUR KILLIN ME!                       
         B     EXIT                                                             
*                                                                               
IXBYPAID LA    R6,PAK8             PAID DOLLARS                                 
         ICM   R3,15,SCPAY                                                      
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTP                                                        
         BAS   RE,GSTIP                                                         
         L     R1,SCPSTP                                                        
         BAS   RE,PSTIP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBYPDM  LA    R6,PAK8             PAID DOLLARS MINUS TAX                       
         L     R3,SCPAY                                                         
         S     R3,SCPAYTX                                                       
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
*                                                                               
         L     R1,SCGSTP                                                        
         BAS   RE,GSTIP                                                         
         L     R1,SCPSTP                                                        
         BAS   RE,PSTIP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBYNTUN LA    R6,PAK8             NET UNPAID DOLLARS                           
         ICM   R3,15,SCUNPN                                                     
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTU                                                        
         BAS   RE,GSTIP                                                         
         L     R1,SCPSTU                                                        
         BAS   RE,PSTIP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBYUNPD LA    R6,PAK8             UNPAID DOLLARS                               
         ICM   R3,15,SCUNP                                                      
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTU                                                        
         BAS   RE,GSTIP                                                         
         L     R1,SCPSTU                                                        
         BAS   RE,PSTIP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXBYUNPM LA    R6,PAK8             UNPAID DOLLARS MINUS TAX                     
         L     R3,SCUNP                                                         
         S     R3,SCUNPTX                                                       
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         L     R1,SCGSTU                                                        
         BAS   RE,GSTIP                                                         
         L     R1,SCPSTU                                                        
         BAS   RE,PSTIP                                                         
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXCLAMT  DS    0H                                                               
         L     R3,ACLSTEL1                                                      
         USING CLSTEL01,R3                                                      
ICLAMT   LA    R6,PAK8             CLEARANCE AMOUNT                             
         ICM   RE,15,CLSTNET                                                    
         CVD   RE,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
         DROP  R3                                                               
*                                                                               
OXBILBL  DS    0H                                                               
         CLI   GLHOOK,GLINCOMP     ** BILLABLE DOLLARS **                       
         BE    *+12                                                             
         MVI   GLHOOK,GLEDIT                                                    
         B     EXIT                                                             
*                                                                               
         SP    0(8,R2),8(8,R2)                                                  
         BZ    *+8                                                              
         NI    COLIND2,255-COLIBLB0   NON-ZERO BILLABLE COLUMN                  
         B     EXIT                                                             
*                                                                               
IINVSRCE DS    0H                                                               
         MVC   0(4,R2),BLANKS                                                   
         CLI   SBMODE,SBPROCNV     PROCESSING INVOICES?                         
         BNE   EXIT                 NO                                          
         MVC   0(4,R2),ELEM+41                                                  
         OC    0(4,R2),BLANKS      MAKE SURE IT'S NOT BIN ZEROS                 
         B     EXIT                                                             
*                                                                               
OINVSRCE DS    0H                                                               
         TM    GLINDS,GLTOTLIN     IS THIS A TOTAL LINE?                        
         BNZ   EXIT                 YES                                         
         MVC   0(4,R3),0(R2)                                                    
         B     EXIT                                                             
*                                                                               
IPSTI    LA    R6,BIN4             INPUT PST ON GROSS DOLLARS                   
         MVC   0(4,R2),SCPSTI                                                   
         B     IPSTX                                                            
*                                                                               
IPST     LA    R6,BIN4             OUTPUT PST ON GROSS DOLLARS                  
         MVC   0(4,R2),SCPSTO                                                   
         CLI   GLARGS+2,X'01'      WANT COST2 PST?                              
         BNE   *+10                NO                                           
         MVC   0(4,R2),SCPSTOC2    YES - USE COST2 GST                          
         B     IPSTX                                                            
*                                                                               
IPSTP    LA    R6,BIN4             PAID PST                                     
         MVC   0(4,R2),SCPSTP                                                   
         B     IPSTX                                                            
*                                                                               
IPSTU    LA    R6,BIN4             UNPAID PST                                   
         MVC   0(4,R2),SCPSTU                                                   
         B     IPSTX                                                            
*                                                                               
IPSTB    LA    R6,BIN4             BILLED PST                                   
         MVC   0(4,R2),BILLPST                                                  
         B     IPSTX                                                            
*                                                                               
IPSTL    LA    R6,BIN4             BILLABLE PST                                 
         XC    0(8,R2),0(R2)                                                    
         CLI   SBMODE,SBPROCSP                                                  
         BNE   IPSTL2                                                           
         MVC   0(4,R2),SCPSTO                                                   
         B     IPSTX                                                            
IPSTL2   CLI   SBMODE,SBPROCBL                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         L     RF,BILLPST                                                       
         ST    RF,4(R2)                                                         
         LA    R2,4(R2)                                                         
IPSTX    BAS   RE,ROUND                                                         
         B     INX                                                              
         EJECT                                                                  
*                                                                               
IMSFORM  DS    0H                                                               
         OC    0(S4-2,R2),BLANKS                                                
         LA    R6,SYSD                                                          
         AHI   R6,(SBASTANT-SYSD)                                               
         ZICM  R5,0(R6),3           HAVE A(STATION BUFFER)?                     
         BZ    EXIT                 NO                                          
         MVI   BYTE,SFRMAT          GET THE MSTREET FORMAT                      
         BAS   RE,GETELEM                                                       
         B     EXIT                                                             
*                                                                               
OMSFORM  DS    0H                                                               
         TM    GLINDS,GLTOTLIN     IS THIS A TOTAL LINE?                        
         BNZ   EXIT                YES, DO NOT PRINT                            
         MVC   0(S4-2,R3),0(R2)                                                 
         B     EXIT                                                             
*                                                                               
IMSPARNT DS    0H                                                               
         OC    0(S5-2,R2),BLANKS                                                
         LA    R6,SYSD                                                          
         AHI   R6,(SBASTANT-SYSD)                                               
         ZICM  R5,0(R6),3           HAVE A(STATION BUFFER)?                     
         BZ    EXIT                 NO                                          
         MVI   BYTE,SPRENT          GET THE MSTREET PARENT                      
         BAS   RE,GETELEM                                                       
         B     EXIT                                                             
*                                                                               
OMSPARNT DS    0H                                                               
         TM    GLINDS,GLTOTLIN     IS THIS A TOTAL LINE?                        
         BNZ   EXIT                YES, DO NOT PRINT                            
         MVC   0(S5-2,R3),0(R2)                                                 
         B     EXIT                                                             
*                                                                               
IMSOWNER DS    0H                                                               
         OC    0(S6-2,R2),BLANKS                                                
         LA    R6,SYSD                                                          
         AHI   R6,(SBASTANT-SYSD)                                               
         ZICM  R5,0(R6),3           HAVE A(STATION BUFFER)?                     
         BZ    EXIT                 NO                                          
         MVI   BYTE,SOWNR           GET THE MSTREET OWNER                       
         BAS   RE,GETELEM                                                       
         B     EXIT                                                             
*                                                                               
OMSOWNER DS    0H                                                               
         TM    GLINDS,GLTOTLIN     IS THIS A TOTAL LINE?                        
         BNZ   EXIT                YES, DO NOT PRINT                            
         MVC   0(S6-2,R3),0(R2)                                                 
         B     EXIT                                                             
*                                                                               
IMSFREQ  DS    0H                                                               
         OC    0(L'STBFREQ,R2),BLANKS                                           
         LA    R6,SYSD                                                          
         AHI   R6,(SBASTANT-SYSD)                                               
         ZICM  R5,0(R6),3           HAVE A(STATION BUFFER)?                     
         BZ    EXIT                 NO                                          
         MVI   BYTE,S07ELEM         GET THE X'07' ELEMENT                       
         BAS   RE,GETELEM           HAVE THE ELEMENT?                           
         BNE   EXIT                 NO, EXIT                                    
*                                                                               
         USING STBELEM,R1                                                       
         MVC   0(L'STBFREQ,R2),STBFREQ                                          
         OC    0(L'STBFREQ,R2),BLANKS                                           
         B     EXIT                                                             
         DROP  R1                                                               
*                                                                               
OMSFREQ  DS    0H                                                               
         TM    GLINDS,GLTOTLIN     IS THIS A TOTAL LINE?                        
         BNZ   EXIT                YES, DO NOT PRINT                            
         MVC   0(L'STBFREQ,R3),0(R2)                                            
         B     EXIT                                                             
*                                                                               
IMSSTATE DS    0H                                                               
         OC    0(L'STBMSTA,R2),BLANKS                                           
         LA    R6,SYSD                                                          
         AHI   R6,(SBASTANT-SYSD)                                               
         ZICM  R5,0(R6),3           HAVE A(STATION BUFFER)?                     
         BZ    EXIT                 NO                                          
         MVI   BYTE,S07ELEM         GET THE X'07' ELEMENT                       
         BAS   RE,GETELEM           HAVE THE ELEMENT?                           
         BNE   EXIT                 NO, EXIT                                    
*                                                                               
         USING STBELEM,R1                                                       
         MVC   0(L'STBMSTA,R2),STBMSTA                                          
         OC    0(L'STBMSTA,R2),BLANKS                                           
         B     EXIT                                                             
         DROP  R1                                                               
*                                                                               
OMSSTATE DS    0H                                                               
         TM    GLINDS,GLTOTLIN     IS THIS A TOTAL LINE?                        
         BNZ   EXIT                YES, DO NOT PRINT                            
         MVC   0(L'STBMSTA,R3),0(R2)                                            
         B     EXIT                                                             
*                                                                               
IEBKTYP  DS    0H                                                               
         BRAS  RE,IBOOK                                                         
         B     EXIT                        AND EXIT                             
*                                                                               
OEBKTYP  DS    0H                                                               
*                                                                               
         BRAS  RE,OBOOK                                                         
         B     GENOUT                                                           
*                                                                               
IFLMTYPE DS    0H                                                               
*                                                                               
         XR    R3,R3                                                            
         ICM   R3,1,SNVIDCML-SNVIDELD(R4)                                       
         BZ    EXIT                                                             
*                                                                               
         BCTR  R3,0                -1 TO INDEX INTO TABLE                       
         MHI   R3,15               TABLE ENTRY IS 14 BYTES LONG                 
         L     RF,AIO3             FILMCODE/AD-ID TABLE                         
         AR    R3,RF               INDEX INTO TABLE                             
         OC    12(2,R3),12(R3)     HAVE A COMMERCIAL SEQUENCE NUMBER?           
         BZ    EXIT                NO - EXIT                                    
         MVC   SBCMLSQ,12(R3)      PASS THE COMMERCIAL SEQUENCE NUMBER          
         GOTO1 GETCML,0            GET THE NAME                                 
         CLC   =C'UNKNOWN',CMLNAME COMMERCIAL EXISTS IN TRAFFIC?                
         BE    EXIT                NO, EXIT                                     
*                                                                               
         MVC   0(4,R2),=C'ISCI'    SET TO ISCI                                  
         CLC   8(4,R3),BLANKS      HAVE MORE THAN 8 CHARS?                      
         BNH   EXIT                NO - HAS TO BE ISCI                          
         MVC   0(4,R2),=C'ADID'    SET TO AD-ID                                 
         TM    14(R3),SNVCMHDQ     AD-ID IS HDEF?                               
         BZ    EXIT                NO - EXIT                                    
         MVC   0(4,R2),=C'HDEF'    YES - SET TO HDEF                            
         B     EXIT                        AND EXIT                             
*                                                                               
IXGLDOL  DS    0H                                                               
*                                                                               
         LA    R6,PAK8             GOAL DOLLARS                                 
         ICM   R3,15,SGDOL                                                      
         CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
IXGLNET  DS    0H                                                               
*                                                                               
         LA    R6,PAK8             GOAL DOLLARS                                 
         SR    R0,R0                                                            
         L     R1,SGDOL                                                         
         M     R0,=F'85'           SGDOL * .85                                  
         SLDA  R0,1                TWICE RESULT IN R0R1                         
         D     R0,=F'100'                                                       
         LTR   R1,R1               SEE IF THE ANSWER IS NEGATIVE                
         BM    *+8                 IF IT IS, WE DON'T NEED TO ADD 1             
         AHI   R1,1                (NOT A LA INSTRUCTION)                       
         SRA   R1,1                DIVIDE BY 2                                  
         CVD   R1,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB                                                      
         BAS   RE,ROUNDP                                                        
         B     INX                                                              
*                                                                               
OPRINT   DS    0H                                                               
         CLI   GLLEVEL,0           GRAND TOTAL?                                 
         BE    OPRT5                                                            
         L     R1,PRTLINES                                                      
         LA    R1,1(R1)                                                         
         ST    R1,PRTLINES                                                      
         B     EXIT                                                             
OPRT5    EDIT  (B4,PRTLINES),(5,0(R3))                                          
         B     EXIT                                                             
*                                                                               
ISHOW    L     R6,SBAIO1           SHOW CODE (CANADA)                           
         USING BUYRECD,R6                                                       
         MVC   0(4,R2),BLANKS                                                   
         CLI   SBMODE,SBPROCSP                                                  
         BNE   EXIT                                                             
         LA    RE,SBAGYREC                                                      
         CLI   AGYPROF+7-AGYRECD(RE),C'C'                                       
         BNE   EXIT                CANADA ONLY                                  
         TM    BUYKAM,X'03'        TEST NWK BUY (MED 'N'/'C' REQUEST)           
         BZ    EXIT                ONLY NETWORK BUY HAS ANY SHOW CODE           
         OC    BUYKMSTA(2),BUYKMSTA                                             
         BZ    ISHOW50             AND THEN ONLY ON NETWORK LEVEL REC!          
*                                                                               
         B     EXIT                CODE BELOW IS TOO MUCH OVERHEAD              
*        MVI   ELCODE,NTWKCODQ     GET NWK BUY FOR EXPLODED LOCAL BUY           
*        BAS   RE,GETEL                                                         
*        BNE   EXIT                                                             
*        MVC   FULL,=C'0000'                                                    
*        GOTO1 MSPACK,DMCB,FULL,2(R6),DUB   MKT 0 + NWK FROM NETWORK EL         
*        L     R6,SBAIO1         USE REC KEY NOT SBIOKEY INCASE MED 'C'         
*        XC    KEY,KEY                                                          
*        MVC   KEY(10),0(R6)       PRIME NWK KEY                                
*        MVC   KEY+4(4),DUB                                                     
*        MVI   KEY+8,X'03'         ENSURE GETTING NWK (IF MED 'C')              
*        MVC   KEY+11(2),10(R6)    STUPID BUY DIR/FIL KEY OUT BY 1 BYTE         
*        GOTO1 HIGH                                                             
*        CLC   KEY(13),KEYSAVE                                                  
*        BNE   EXIT                UNABLE TO FIND NETWORK BUY                   
*        L     R6,AIO2                                                          
*        ST    R6,AIO                                                           
*        GOTO1 GETREC              (EXTRACT ANY SHOW FROM NETWORK BUY)          
ISHOW50  CLI   BDPROGRM+4,C'-'     TEST SHOW(SHOW-) / LIVE SHOW(=SHW-)          
         BNE   EXIT                ...PREFIX TO PROGRAM NAME                    
         MVC   0(4,R2),BDPROGRM    THAT'S A SHOW CODE!                          
         B     EXIT                                                             
         DROP  R6                                                               
*                                                                               
OSHOW    MVC   LABLAREA(4),=C'SHOW'  SHOW CODE                                  
         MVC   NAMEAREA(4),0(R2)                                                
         B     GENOUT                                                           
*                                                                               
IETYPE   DS    0H                    ESTIMATE ETYPE                             
         GOTO1 GETESTNM                                                         
         BNE   EXIT                                                             
         CLI   GLARGS+1,1            WANT ESTIMATE RATE?                        
         BNE   *+14                  NO                                         
         MVC   0(L'ESTRATE,R2),ESTRATE   YES - MOVE IN EST RATE                 
         B     EXIT                        AND EXIT                             
         MVC   0(L'ESTETYPE,R2),ESTETYPE                                        
         CLI   0(R2),0                                                          
         BNE   *+8                                                              
         MVI   0(R2),C'R'                                                       
         B     EXIT                                                             
*                                                                               
OETYPE   DS    0H                                                               
         CLI   0(R2),C'R'            REGULAR ETYPE?                             
         BNE   OTYP00                NO                                         
         MVC   0(3,R3),=C'REG'                                                  
         B     EXIT                                                             
*                                                                               
OTYP00   CLI   0(R2),C'S'            STEWARDSHIP?                               
         BNE   OTYP05                NO                                         
         MVC   0(3,R3),=C'STW'                                                  
         B     EXIT                                                             
*                                                                               
OTYP05   CLI   0(R2),C'B'            BARTER?                                    
         BNE   OTYP10                NO                                         
         MVC   0(3,R3),=C'BAR'                                                  
         B     EXIT                                                             
*                                                                               
OTYP10   CLI   0(R2),C'U'            UNWIRED?                                   
         BNE   OTYP15                NO                                         
         MVC   0(3,R3),=C'UNW'                                                  
         B     EXIT                                                             
*                                                                               
OTYP15   MVC   0(1,R3),0(R2)         OUTPUT CHAR                                
         B     EXIT                                                             
*                                                                               
IOMFLT   ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         MVI   ELCODE,DOIDELQ        X'01' PRIMARY ID ELEMENT                   
         BAS   RE,GETEL                                                         
         BNE   EXIT                                                             
         USING DOIDELD,R6                                                       
         MVC   0(1,R2),DOIDFLTN                                                 
         DROP  R6                                                               
         B     EXIT                                                             
*                                                                               
OOMFLT   MVC   LABLAREA(6),=C'FLIGHT'                                           
         EDIT  (B1,0(R2)),(2,CODEAREA),FILL=0                                   
         B     GENOUT                                                           
*                                                                               
IOMID    MVI   HALF,DSENT            SENT                                       
         MVI   HALF+1,DFXSENT        FAX SENT                                   
         CLI   GLARGS+2,C'A'         DOING AGENCY ID?                           
         BE    ID00                  YES                                        
         MVI   HALF,DDLVRD           NO - LOOK FOR DELIVERED                    
         MVI   HALF+1,0              ONLY LOOK FOR DELIVERED                    
         ICM   R6,15,OMREC           HAVE OM REC?                               
         BZ    EXIT                  NO - EXIT                                  
         USING DOSPELD,R6            SUPPLEMENTARY ID ELEMENT DSECT             
         MVI   ELCODE,DOSPELQ        X'03' ELEMENT                              
         BAS   RE,GETEL              HAVE A X'03' ELEMENT?                      
         BNE   ID00                  NO - LOOK FOR REP ID THE OLD WAY           
         MVC   0(3,R2),=C'FAX'       FAX                                        
         CLI   DOSPIMTH,C'F'         FAX?                                       
         BE    EXIT                  YES - DONE                                 
         MVC   0(5,R2),=C'EMAIL'     EMAIL                                      
         CLI   DOSPIMTH,C'E'         EMAIL?                                     
         BE    EXIT                  YES - DONE                                 
         MVC   0(8,R2),BLANKS        CLEAR INPUT                                
         DROP  R6                                                               
*                                                                               
ID00     ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         USING DOSTELD,R6                                                       
         MVI   ELCODE,DOSTELQ                                                   
         BAS   RE,GETEL                                                         
         B     *+8                                                              
*                                                                               
ID05     BAS   RE,NEXTEL                                                        
         BNE   EXIT                                                             
         CLC   DOSTSTAT,HALF                                                    
         BE    *+14                                                             
         CLC   DOSTSTAT,HALF+1                                                  
         BNE   ID05                                                             
*                                                                               
         BRAS  RE,GETREP                                                        
         B     EXIT                                                             
         DROP  R6                                                               
*                                                                               
OOMID    MVC   LABLAREA(6),=C'REP ID'                                           
         CLI   GLARGS+2,C'A'                                                    
         BNE   *+10                                                             
         MVC   LABLAREA(9),=C'AGENCY ID'                                        
*                                                                               
         MVC   CODEAREA(10),0(R2)                                               
         OC    CODEAREA(10),BLANKS                                              
         B     GENOUT                                                           
*                                                                               
IOMBYR   ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         MVI   ELCODE,DOIDELQ        X'01' PRIMARY ID ELEMENT                   
         BAS   RE,GETEL                                                         
         BNE   EXIT                                                             
         USING DOIDELD,R6                                                       
         MVC   0(3,R2),DOIDBYR                                                  
         DROP  R6                                                               
         B     EXIT                                                             
*                                                                               
OOMBYR   MVC   CODEAREA(3),0(R2)                                                
         MVC   LABLAREA(5),=C'BUYER'                                            
         B     GENOUT                                                           
*                                                                               
IOMORDN  ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         USING DOKEY,R6                                                         
         MVC   FULL,DOKORDER                                                    
         XC    FULL,XFFS                                                        
*                                                                               
         TM    FULL,X'80'                 NEW STYLE?                            
         BNZ   IORD10                     YES                                   
*                                                                               
         SR    R1,R1                                                            
         ICM   R1,3,FULL                  DATE PORTION                          
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(4,R2),DUB                                                      
         ICM   R1,3,FULL+2                SEQUENCE PORTION                      
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  4(4,R2),DUB                                                      
         B     EXIT                                                             
*                                                                               
IORD10   NI    FULL,X'FF'-X'80'                                                 
         ICM   R1,15,FULL                                                       
         CVD   R1,DUB                                                           
         AP    DUB,=P'04000000'                                                 
         OI    DUB+7,X'0F'                                                      
         UNPK  0(8,R2),DUB                                                      
         B     EXIT                                                             
*                                                                               
OOMORDN  MVC   CODEAREA(8),0(R2)                                                
         OC    CODEAREA(8),BLANKS                                               
         MVC   LABLAREA(12),=C'ORDER NUMBER'                                    
         B     GENOUT                                                           
*                                                                               
IOMSTAT  ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         MVC   0(6,R2),THISSTAT                                                 
         MVI   ELCODE,DOSTELQ        X'12' ELEMENT                              
         BAS   RE,GETEL                                                         
         BNE   EXIT                                                             
         USING DOSTELD,R6                                                       
         CLI   GLARGS+2,C'D'         WANT THE DATE AS WELL?                     
         BNE   *+10                  NO                                         
         MVC   6(3,R2),DOSTDATE      YES - GET THE JULIAN DATE                  
         B     EXIT                                                             
*                                                                               
OOMSTAT  MVC   LABLAREA(6),=C'STATUS'                                           
         MVC   CODEAREA(6),0(R2)                                                
         OC    CODEAREA(6),BLANKS                                               
         CLI   GLARGS+2,C'D'         WANT THE DATE AS WELL?                     
         BNE   GENOUT                NO                                         
         MVC   LABLAREA(11),=C'STATUS DATE'                                     
         OC    6(3,R2),6(R2)         HAVE A DATE?                               
         BZ    GENOUT                NO                                         
         GOTO1 DATCON,DMCB,(8,6(R2)),(8,CODEAREA+7)                             
         B     GENOUT                                                           
*                                                                               
IOMREPC  ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         MVI   ELCODE,DOIDELQ        X'01' PRIMARY ID ELEMENT                   
         BAS   RE,GETEL                                                         
         BNE   EXIT                                                             
         USING DOIDELD,R6                                                       
         MVC   0(8,R2),DOIDCON                                                  
         B     EXIT                                                             
         DROP  R6                                                               
*                                                                               
OOMREPC  MVC   LABLAREA(8),=C'CONTRACT'                                         
         MVC   CODEAREA(8),0(R2)                                                
         OC    CODEAREA(8),BLANKS                                               
         B     GENOUT                                                           
*                                                                               
IOMSPER  ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         BNE   SPERX                                                            
         USING DOSPELD,R6                                                       
         MVI   BYTE,C'S'                                                        
         TM    DOSPFLG1,DOSPPPER     POINTPERSON?                               
         BZ    *+8                   NO                                         
         MVI   BYTE,C'P'                                                        
         CLC   BYTE,GLARGS+2         MATCH ON SALES/POINTPERSON?                
         BNE   SPERX                 NO                                         
*                                                                               
SPER10   L     R6,OMREC                                                         
         MVI   ELCODE,DOIDELQ        X'01' PRIMARY ID ELEMENT                   
         BAS   RE,GETEL                                                         
         BNE   EXIT                                                             
         USING DOIDELD,R6                                                       
         MVC   0(25,R2),DOIDSPER     SALESPERSON/POINTPERSON                    
         CLC   DOIDFFS,XFFS          NEED TO READ GENDIR ON OUTPUT?             
         BNE   EXIT                  NO, HAVE SALESPERSON/POINTPERSON           
         MVC   7(1,R2),BYTE          PASS C'S' OR C'P'                          
*                                                                               
SPERX    B     EXIT                                                             
         DROP  R6                                                               
*                                                                               
OOMSPER  BRAS  RE,OUTOMSLP                                                      
         B     GENOUT                                                           
*                                                                               
IOMCITY  GOTO1 GETOMBYR              GET BUYER CITY OR NAME                     
         B     EXIT                                                             
*                                                                               
OOMCITY  MVC   CODEAREA(2),0(R2)                                                
         OC    CODEAREA(2),BLANKS                                               
         MVC   LABLAREA(4),=C'CITY'                                             
         CLI   GLARGS+2,C'N'         WANT THE NAME?                             
         BNE   GENOUT                NO                                         
         MVC   CODEAREA(24),0(R2)    YES                                        
         OC    CODEAREA(24),BLANKS                                              
         MVC   LABLAREA(10),=C'BUYER NAME'                                      
         B     GENOUT                                                           
*                                                                               
IOMROUT  ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         MVI   ELCODE,DOSTELQ                                                   
         USING DOSTELD,R6                                                       
         BAS   RE,GETEL                                                         
         B     *+8                                                              
*                                                                               
IRT00    BAS   RE,NEXTEL                                                        
         BNE   EXIT                                                             
*                                                                               
         CLI   DOSTSTAT,DDLVRD       DELIVERED?                                 
         BE    IRT05                 YES                                        
         CLI   DOSTSTAT,DFXDLVD      FAX DELIVERED?                             
         BE    IRT05                 YES                                        
         CLI   DOSTSTAT,DEMDLVD      E-MAIL DELIVERED?                          
         BNE   IRT00                 NO                                         
*                                                                               
IRT05    CLI   DOSTLEN,DOSTLNQ       STANDARD LENGTH?                           
         BE    IRT00                 YES, NO ID NUMBER AVAILIBLE                
         CLC   DOSTIDNM,XFFS         FAX SENT?                                  
         BE    IRT00                 YES, DO NOT READ CTFILE WITH THIS!         
*                                                                               
         BRAS  RE,GETREP                                                        
         B     EXIT                                                             
*                                                                               
OOMROUT  MVC   LABLAREA(8),=C'OM ROUTE'                                         
         MVC   CODEAREA(20),0(R2)                                               
         OC    CODEAREA(20),BLANKS                                              
         B     GENOUT                                                           
*                                                                               
IOMDEST  BRAS  RE,IIOMDEST           NEED ADDRESSABILITY                        
         B     EXIT                  DONE                                       
*                                                                               
OOMDEST  BRAS  RE,OOMDESTN           NEED ADDRESSABILITY                        
         B     GENOUT                EXIT                                       
*                                                                               
IOMSPTS  ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         MVI   ELCODE,DOSPELQ        X'03' SUPPLEMENTARY ID ELEMENT             
         BAS   RE,GETEL                                                         
         BNE   EXIT                                                             
         USING DOSPELD,R6                                                       
         MVC   0(4,R2),DOSPSPTS                                                 
         B     EXIT                                                             
         DROP  R6                                                               
*                                                                               
OOMSPTS  EDIT  (B4,0(R2)),(6,0(R3))                                             
         B     EXIT                                                             
*                                                                               
IOMBUYS  ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         MVI   0(R2),1                                                          
         B     EXIT                                                             
*                                                                               
OOMBUYS  CLI   GLLEVEL,0           GRAND TOTAL?                                 
         BE    OMBY5                                                            
         L     R1,OMBUYTOT                                                      
         LA    R1,1(R1)                                                         
         ST    R1,OMBUYTOT                                                      
         B     EXIT                                                             
OMBY5    EDIT  (B4,OMBUYTOT),(5,0(R3))                                          
         B     EXIT                                                             
*                                                                               
IOMREVN  ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         BNE   EXIT                                                             
         USING DOSPELD,R6                                                       
         MVC   0(1,R2),DOSPREVN                                                 
         B     EXIT                                                             
         DROP  R6                                                               
*                                                                               
OOMREVN  EDIT  (B1,0(R2)),(3,0(R3)),FILL=0                                      
         B     EXIT                                                             
*                                                                               
IOMDOL   ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         MVI   ELCODE,DOSPELQ        X'03' SUPPLEMENTARY ID ELEMENT             
         BAS   RE,GETEL                                                         
         BNE   EXIT                                                             
         USING DOSPELD,R6                                                       
         OC    DOSPTOTL,DOSPTOTL   TOTAL DOLLARS SET?                           
         BZ    EXIT                NO, EXIT                                     
         ZAP   0(6,R2),DOSPTOTL                                                 
         TM    COLIND,COLIRND      ROUNDING REQUIRED?                           
         BZ    EXIT                NO                                           
         SRP   0(6,R2),64-2,5      DIVIDE BY 100 TO GET ROUNDED $               
         B     EXIT                                                             
         DROP  R6                                                               
*                                                                               
IOMOFR   ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         XR    R1,R1                                                            
         MVI   ELCODE,MGCOLELQ       X'12' MAKEGOOD GROUP COLOR ELEM            
         BAS   RE,GETEL                                                         
         B     *+8                                                              
*                                                                               
OFR10    BAS   RE,NEXTEL                                                        
         BNE   OFR20                                                            
         AHI   R1,1                                                             
         B     OFR10                                                            
*                                                                               
OFR20    STC   R1,0(R2)                                                         
         B     EXIT                                                             
*                                                                               
OOMOFR   EDIT  (B1,0(R2)),(2,3(R3)),FILL=0                                      
         B     EXIT                                                             
*                                                                               
IINVMAT  MVC   0(1,R2),ELEM+48     FIRST MATCHED %                              
         CLI   GLARGS+2,C'F'       WANT FIRST MATCHED %?                        
         BE    EXIT                YES                                          
         MVC   0(1,R2),ELEM+52     SECOND MATCHED %                             
         B     EXIT                                                             
*                                                                               
IBYSRCE  LA    R1,SBLOCK                                                        
         MVC   0(1,R2),SBBYORTG-SBLOCK(R1)    RTG SVC OVERRIDE                  
         MVC   1(3,R2),SBBYOALF-SBLOCK(R1)    ALPHA MKT OVERRIDE                
         MVC   4(4,R2),SBBYOSTA-SBLOCK(R1)    STA OVERRIDE                      
         B     XIT                                                              
*                                                                               
OBYSRCE  MVC   LABLAREA(15),=C'BUY DEMO SOURCE'                                 
         MVC   NAMEAREA(3),=C'BBM'                                              
         CLI   0(R2),C'1'                                                       
         BE    OBYSRC10                                                         
         MVC   NAMEAREA(3),=C'NSI'                                              
         CLI   0(R2),C'0'                                                       
         BE    OBYSRC10                                                         
         MVC   NAMEAREA(3),BLANKS                                               
*                                                                               
OBYSRC10 OC    1(7,R2),1(R2)           HAVE A ALPHA OR STA OVERRIDE?            
         BZ    GENOUT                  NO                                       
         MVI   NAMEAREA+3,C'/'                                                  
         MVC   NAMEAREA+4(3),1(R2)     ALPHA OVERRIDE                           
         MVI   NAMEAREA+7,C'/'                                                  
         MVC   NAMEAREA+8(4),4(R2)     STATION OVERRIDE                         
         OC    NAMEAREA(12),BLANKS                                              
         B     GENOUT                                                           
*                                                                               
IORBIT   XC    0(4,R2),0(R2)                                                    
         CLI   SBMODE,SBPROCSP         PROCESS A BUY RECORD?                    
         BNE   EXIT                    NO, GET OUT                              
         L     R6,SBAIO1                                                        
         MVI   ELCODE,X'67'                                                     
         BAS   RE,GETEL                HAVE AN ORBIT ELEMENT?                   
         BNE   EXIT                    NO                                       
         MVC   0(4,R2),SBIOKEY+14      YES - SAVE THE D/A                       
         B     EXIT                                                             
*                                                                               
OORBIT   TM    GLINDS,GLTOTLIN         IS THIS A TOTAL LINE?                    
         BNZ   EXIT                    YES - EXIT                               
*                                                                               
         OC    0(4,R2),0(R2)           HAVE A BUY RECORD D/A                    
         BZ    EXIT                    NO                                       
*                                                                               
         XC    KEY,KEY                 CLEAR THE KEY                            
         MVC   KEY+14(4),0(R2)         SET THE D/A                              
         GOTO1 GETREC                  GET THE RECORD                           
         L     R6,AIO                                                           
         MVI   ELCODE,X'67'                                                     
         BAS   RE,GETEL                HAVE ORBIT ELEMENT?                      
         BNE   EXIT                    NO, EXIT                                 
*                                                                               
         USING ORBELEM,R6                                                       
         LLC   R4,ORBLEN               ELEMENT LENGTH                           
         SHI   R4,4                    CODE + LENGTH + 2 BYTES SPARE            
         SRL   R4,4                    DIVIDE BY 16 TO GET # OF SHOWS           
*                                                                               
         LA    R6,ORBDAY                                                        
         USING ORBDAY,R6                                                        
*                                                                               
OORB05   L     RE,AIO                                                           
         MVC   BYTE,BDSEDAY-BUYRECD(RE)                                         
         GOTO1 DAYUNPK,DMCB,(BYTE,ORBDAY),(0,0(R3))     DAY                     
         GOTO1 UNTIME,DMCB,ORBTIME,9(R3)                TIME                    
         MVC   21(7,R3),ORBDESC    DESCRIPTION                                  
*                                                                               
         XC    FULL,FULL                                                        
         MVC   FULL+2(2),ORBDEM    DEMO VALUE                                   
         NI    FULL+2,X'3F'        DROP THE X'40' AND X'80'                     
*                                                                               
         LR    RF,R9                                                            
         AHI   RF,SBEFLAG4-SYSD                                                 
*                                                                               
         TM    ORBDEM,X'40'        DEMO IS IN 2 DECIMAL?                        
         BO    OORB10              YES                                          
*                                                                               
         TM    0(RF),SBE42DEC      TEST 2 DECIMAL PLACES                        
         BZ    OORB15              NO - PRINT AS 1 DECIMAL                      
*                                                                               
         L     R1,FULL             ADJUST 1 DECIMAL PRECISION TO 2              
         MHI   R1,10                                                            
         ST    R1,FULL                                                          
         B     OORB20              PRINT AS 2 DECIMAL                           
*                                                                               
OORB10   TM    0(RF),SBE42DEC      TEST 2 DECIMAL PLACES                        
         BNZ   OORB20              YES - PRINT AS 2 DECIMAL                     
*                                                                               
         L     R0,FULL             ADJUST 2 DECIMAL PRECISION TO 1              
         SRDA  R0,31                                                            
         D     R0,=F'10'                                                        
         AHI   R1,1                                                             
         SRA   R1,1                                                             
         ST    R1,FULL                                                          
*                                                                               
OORB15   EDIT  FULL,(6,29(R3)),1   PRINT 1 DECIMAL DEMO                         
         B     OORB25                                                           
*                                                                               
OORB20   EDIT  FULL,(7,29(R3)),2   PRINT 2 DECIMAL DEMO                         
*                                                                               
OORB25   LA    R6,16(R6)           NEXT ORBIT LINE                              
         LA    R3,198(R3)          NEXT PRINT LINE                              
         BCT   R4,OORB05                                                        
         B     EXIT                                                             
         DROP  R6                                                               
*                                                                               
HORB     MVC   0(36,R3),=C'  DAY       TIME      DESCRPT   DEMO'                
         B     EXIT                                                             
*                                                                               
IOMLSENT ICM   R6,15,OMREC                                                      
         BZ    EXIT                                                             
         MVI   ELCODE,DOSPELQ        X'03' SUPPLEMENTARY ID ELEMENT             
         BAS   RE,GETEL                                                         
         BNE   EXIT                                                             
         USING DOSPELD,R6                                                       
         CLI   DOSPLEN,DOSPLNQ2      HAVE SECOND STATUS FLAG?                   
         BL    EXIT                  NO                                         
         MVC   0(10,R2),=C'PC SPOTPAK'                                          
         TM    DOSPFLG2,DOSPOMDT     DESKTOP ORDER?                             
         BZ    EXIT                  NO, EXIT                                   
         MVC   0(10,R2),=C'DESKTOP OM'                                          
         B     EXIT                                                             
         DROP  R6                                                               
*                                                                               
OOMLSENT MVC   LABLAREA(9),=C'LAST SENT'                                        
         MVC   CODEAREA(10),0(R2)                                               
         OC    CODEAREA(10),BLANKS                                              
         B     GENOUT                                                           
*                                                                               
ICLINV   ICM   RE,15,ACLRST03      HAVE X'03'/X'05' PAIR?                       
         BZ    EXIT                NOPE                                         
         USING CLSTEL03,RE                                                      
         MVC   0(12,R2),CLS3INV    INVOICE NUMBER                               
         B     EXIT                                                             
         DROP  RE                                                               
*                                                                               
ICLPRD   ICM   R1,15,ACLRST01      POINT TO CORRECT X'01' ELEMENT               
         BZ    EXIT                                                             
         USING CLSTEL01,R1                                                      
         L     RE,SBAPRDBF         A(PRD BUFFER)                                
         USING PRDBUFFD,RE                                                      
         LHI   RF,PRDBUFFL         L'PRD BUFFER ENTRY                           
         LA    R0,256              MAX 256 PRODUCTS                             
         CLC   PBBCODE,CLSTPRD     MATCH ON BINARY PRD?                         
         BE    ICLPRD10            YES                                          
         LA    RE,0(RE,RF)         NO - BUMP TO NEXT ENTRY                      
         BCT   R0,*-14                                                          
         B     EXIT                                                             
*                                                                               
ICLPRD10 MVC   0(3,R2),PBALPH                                                   
         B     EXIT                                                             
         DROP  R1,RE                                                            
*                                                                               
ICLEST   ICM   R1,15,ACLRST01      POINT TO CORRECT X'01' ELEMENT               
         BZ    EXIT                                                             
         USING CLSTEL01,R1                                                      
         MVC   0(1,R2),CLSTEST     ESTIMATE                                     
         B     EXIT                                                             
         DROP  R1                                                               
*                                                                               
IMSMAIL  MVC   0(3,R2),SBBSTA                                                   
         B     EXIT                                                             
*                                                                               
OMSMAIL  BRAS  RE,OMAIL                                                         
         BNE   EXIT                                                             
         B     GENOUT                                                           
*                                                                               
IMSMOWN  DS    0H                                                               
         OC    0(L'STBMOWN,R2),BLANKS                                           
         LA    R6,SYSD                                                          
         AHI   R6,(SBASTANT-SYSD)                                               
         ZICM  R5,0(R6),3           HAVE A(STATION BUFFER)?                     
         BZ    EXIT                 NO                                          
         MVI   BYTE,S07ELEM         GET THE X'07' ELEMENT                       
         BAS   RE,GETELEM           HAVE THE ELEMENT?                           
         BNE   EXIT                 NO, EXIT                                    
*                                                                               
         USING STBELEM,R1                                                       
         CLI   GLARGS+2,C'1'        MSMINFEM KEYWORD?                           
         BNE   *+14                 NO                                          
         MVC   0(1,R2),STBMOWNF     MINORITY OWNERSHIP IS FEMALE FIELD          
         B     EXIT                 DONE                                        
*                                                                               
         CLI   GLARGS+2,C'2'        MSFCCMIN KEYWORD?                           
         BNE   *+14                 NO                                          
         MVC   0(1,R2),STBFCCM      QUALIFIED FCC MINORITY FIELD                
         B     EXIT                 DONE                                        
*                                                                               
         CLI   GLARGS+2,C'3'        MSFCCFEM KEYWORD?                           
         BNE   *+14                 NO                                          
         MVC   0(1,R2),STBFCCMF     FCC MINORITY OWNERSHIP FEMALE FIELD         
         B     EXIT                 DONE                                        
*                                                                               
         MVC   0(L'STBMOWN,R2),STBMOWN                                          
         OC    0(L'STBMOWN,R2),BLANKS                                           
         B     EXIT                                                             
         DROP  R1                                                               
*                                                                               
OMSMOWN  BRAS  RE,OOMSMOWN          NEED ADDRESSABILITY                         
         B     GENOUT                                                           
*                                                                               
IOMFSENT BRAS  RE,IOMFSNT            OM FIRST SENT ROUTINE                      
         B     EXIT                  EXIT                                       
*                                                                               
OOMFSENT OC    0(3,R2),0(R2)                                                    
         BZ    GENOUT                                                           
         MVC   LABLAREA(10),=C'FIRST SENT'                                      
         GOTO1 DATCON,DMCB,(8,0(R2)),(10,CODEAREA)                              
         OC    CODEAREA(10),BLANKS                                              
         B     GENOUT                                                           
*                                                                               
IMSMFID  DS    0H                                                               
         OC    0(L'STBUID,R2),BLANKS                                            
         LA    R6,SYSD                                                          
         AHI   R6,(SBASTANT-SYSD)                                               
         ZICM  R5,0(R6),3           HAVE A(STATION BUFFER)?                     
         BZ    EXIT                 NO                                          
         MVI   BYTE,S07ELEM         GET THE X'07' ELEMENT                       
         BAS   RE,GETELEM           HAVE THE ELEMENT?                           
         BNE   EXIT                 NO, EXIT                                    
*                                                                               
         USING STBELEM,R1                                                       
         MVC   0(L'STBUID,R2),STBUID                                            
         OC    0(L'STBUID,R2),BLANKS                                            
         B     EXIT                                                             
         DROP  R1                                                               
*                                                                               
OMSMFID  DS    0H                                                               
         TM    GLINDS,GLTOTLIN      IS THIS A TOTAL LINE?                       
         BNZ   EXIT                 YES, DO NOT PRINT                           
         MVC   CODEAREA(L'STBUID),0(R2)                                         
         B     GENOUT                                                           
*                                                                               
IRATE    BRAS  RE,INRATE           GO GET BUY RATE                              
         B     EXIT                                                             
*                                                                               
IBYBOOK  BRAS  RE,IBYBK            GO GET BUY BOOK                              
         B     EXIT                                                             
*                                                                               
OBYBOOK  BRAS  RE,OBYBK            GO GET BUY BOOK                              
***      B     EXIT                                                             
         B     GENOUT                                                           
*                                                                               
IOMEMAIL BRAS  RE,IOMEML           GO GET OM EMAIL                              
         B     EXIT                                                             
*                                                                               
OOMEMAIL BRAS  RE,OOMEML           GO GET OM EMAIL                              
         B     GENOUT                                                           
*                                                                               
IINVAID  MVC   0(8,R2),BLANKS      INIT TO BLANKS                               
         CLI   SBMODE,SBPROCNV     PROCESSING INVOICES?                         
         BNE   EXIT                NO                                           
         MVC   0(8,R2),ELEM+53     INVOICE AGENCY ID                            
         OC    0(8,R2),BLANKS      MAKE SURE IT'S NOT BIN ZEROS                 
         B     EXIT                EXIT                                         
*                                                                               
IINVCMAT MVI   0(R2),C' '          INIT TO " "                                  
         CLI   SBMODE,SBPROCNV     PROCESSING INVOICES?                         
         BNE   EXIT                NO                                           
         MVI   0(R2),C'N'          INIT TO "N"                                  
         CLI   ELEM+61,C'Y'        ASSIGNED CMML MATCH = Y?                     
         BE    *+12                YES                                          
         CLI   ELEM+61,C'B'        ASSIGNED CMML MATCH = B?                     
         BNE   *+10                NO                                           
         MVC   0(1,R2),ELEM+61     ASSIGNED CMML MATCH (Y/B)                    
         B     EXIT                EXIT                                         
*                                                                               
IINVDET  LA    R6,PAK8             PL8 CONTANT INIT TO PACKED ZERO              
         ZAP   0(8,R2),=P'0'       CLEAR PACKED                                 
         CLI   SBMODE,SBPROCNV     PROCESSING INVOICES?                         
         BNE   INX                 NO                                           
         CLI   0(R4),X'40'         INVOICE DETAIL?                              
         BNE   INX                 NO                                           
*                                                                               
         BRAS  RE,INVDET05         PROCESS IMPS/RTGS/CLICKS                     
*                                                                               
         B     INX                 EXIT                                         
*                                                                               
IBLBLC2C BRAS  RE,IBLC2C           BILLABLE COST2 COMMISSION                    
         BNE   *+8                 CC NEQ MEANS SKIP ROUNDING                   
         BAS   RE,ROUND            ROUND                                        
         B     INX                 DONE WITH BUY COST2 COMMISSION               
*                                                                               
IOMMKGD  BRAS  RE,IOMKGD           DARE ORDER MAKEGOOD                          
         B     EXIT                DONE                                         
*                                                                               
OOMMKGD  BRAS  RE,OOMKGD           DARE ORDER MAKEGOOD                          
         B     GENOUT              DONE                                         
*                                                                               
IBYVDEM  BRAS  RE,IUNVDEM          REPORT UNIVERSE FOR MARKET                   
         B     EXIT                DONE                                         
*                                                                               
OBYVDEM  BRAS  RE,OUNVDEM          REPORT UNIVERSE FOR MARKET                   
         B     EXIT                DONE                                         
*                                                                               
*                                                                               
* COMMON ROUTINES                                                               
*                                                                               
*                                  ** ROUTINES TO ADD IN CANADIAN               
GSTI     LA    RF,GLARGS                                 GST **                 
         TM    GLIIND-GLARGSD(RF),GLIIGSTI                                      
         BZR   RE                                                               
         B     GSTADD                                                           
GSTO     LA    RF,GLARGS                                                        
         TM    GLIIND-GLARGSD(RF),GLIIGSTO                                      
         BZR   RE                                                               
GSTADD   L     RF,0(R2)                                                         
         AR    RF,R1                                                            
         ST    RF,0(R2)                                                         
         BR    RE                                                               
         SPACE 1                                                                
*                                  ** ROUTINES TO ADD IN CANADIAN               
PSTI     LA    RF,GLARGS                                 PST **                 
         TM    GLIIND-GLARGSD(RF),GLIIGSTI                                      
         BZR   RE                                                               
         B     PSTADD                                                           
PSTO     LA    RF,GLARGS                                                        
         TM    GLIIND-GLARGSD(RF),GLIIGSTO                                      
         BZR   RE                                                               
PSTADD   TM    GLIIND-GLARGSD(RF),GLIIPST                                       
         BZR   RE                  NOT WANT PST ADDED                           
         L     RF,0(R2)                                                         
         AR    RF,R1                                                            
         ST    RF,0(R2)                                                         
         BR    RE                                                               
         SPACE 1                                                                
*                                 ** PACKED ROUTINES TO ADD IN CANADIAN         
GSTIP    LA    RF,GLARGS                                 GST **                 
         TM    GLIIND-GLARGSD(RF),GLIIGSTI                                      
         BZR   RE                                                               
         B     GSTADDP                                                          
GSTOP    LA    RF,GLARGS                                                        
         TM    GLIIND-GLARGSD(RF),GLIIGSTO                                      
         BZR   RE                                                               
GSTADDP  CVD   R1,DUB              PACK GST IN DUB                              
         AP    0(8,R2),DUB                                                      
         BR    RE                                                               
*                                 ** PACKED ROUTINES TO ADD IN CANADIAN         
PSTIP    LA    RF,GLARGS                                 PST **                 
         TM    GLIIND-GLARGSD(RF),GLIIGSTI                                      
         BZR   RE                                                               
         B     PSTADDP                                                          
PSTOP    LA    RF,GLARGS                                                        
         TM    GLIIND-GLARGSD(RF),GLIIGSTO                                      
         BZR   RE                                                               
PSTADDP  TM    GLIIND-GLARGSD(RF),GLIIPST                                       
         BZR   RE                  NOT WANT PST ADDED                           
         CVD   R1,DUB              PACK PST IN DUB                              
         AP    0(8,R2),DUB                                                      
         BR    RE                                                               
         SPACE 1                                                                
*                                  ** ROUNDING ROUTINE **                       
ROUND    TM    COLIND,COLIRND      TEST ROUNDING REQUIRED                       
         BZR   RE                                                               
         L     R0,0(R2)            YES                                          
         SRDA  R0,31                                                            
         D     R0,=F'100'                                                       
         LTR   R1,R1                                                            
         BM    *+8                                                              
         AHI   R1,1                                                             
         SRA   R1,1                                                             
         ST    R1,0(R2)                                                         
         BR    RE                                                               
         SPACE 1                                                                
*                                  ** PACKED ROUNDING ROUTINE **                
ROUNDP   TM    COLIND,COLIRND      TEST ROUNDING REQUIRED                       
         BZR   RE                                                               
         SRP   0(8,R2),64-2,5      DIVIDE BY 100 TO GET ROUNDED $               
         BR    RE                                                               
         SPACE 1                                                                
*                                                                               
* INPUT ROUTINE EXIT FOR COLUMNS                                                
INX      LTR   R6,R6              TEST THIS IS A COLUMN                         
         BZ    EXIT                                                             
         CLI   INDATA,0           YES-IF THERE'S NO COLUMN DATA YET,            
         BNE   EXIT                                                             
         TM    DRINDS,GLPALDET    TEST PRINT ALL DETAILS                        
         BO    INX2                                                             
         LLC   RE,0(R6)           OR, TEST ANY DATA IN THIS COL                 
         EX    RE,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R2),1(R6)                                                    
         BE    *+8                                                              
INX2     MVI   INDATA,1           YES-MAKE SURE SORT RECORD'S PASSED            
         B     EXIT                   TO DRIVER'S SORT                          
         EJECT                                                                  
*                                                                               
GETELEM  NTR1                                                                   
         USING STABUFFD,R5                                                      
         LA    R1,STBELEM           START OF ELEMENTS                           
         USING STBELEM,R1                                                       
         XR    RF,RF                                                            
*                                                                               
GELEM10  CLI   STBELEM,0            END OF RECORD?                              
         BE    GELEMNEQ             YES, SET CC NEQ                             
         CLC   STBELEM,BYTE         HAVE ELEMENT WE ARE LOOKING FOR?            
         BE    GELEM20              YES                                         
         IC    RF,STBELMLN          LENGTH OF ELEMENT                           
         AR    R1,RF                BUMP TO NEXT ELEM/END OF ENTRY              
         B     GELEM10                                                          
*                                                                               
GELEM20  IC    RF,STBELMLN          LENGTH OF ELEMENT                           
         SHI   RF,3                 MINUS OVERHEAD AND 1 FOR EX                 
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),STBDATA      ** EXECUTED **                              
*                                                                               
         CR    RB,RB                SET CC=EQ                                   
         B     *+6                                                              
GELEMNEQ LTR   RB,RB                SET CC=NEQ                                  
         XIT1  REGS=(R1)                                                        
         DROP  R1,R5                                                            
*                                                                               
         GETEL R6,DATADISP,ELCODE                                               
         EJECT                                                                  
*                                                                               
INLEVEL  DS    XL1                                                              
ALVLSWS  DS    A                                                                
CMCLSLEV DS    XL1                                                              
SVUDEF   DS    CL4                                                              
ABILLREC DS    A                                                                
AMAORLKD DS    A                                                                
ACLSTEL1 DS    A                                                                
PRTLINES DS    F                                                                
OMBUYTOT DS    F                                                                
SVUTL    DS    XL1                                                              
*                                                                               
BLANKS   DC    CL132' '                                                         
XFFS     DC    XL10'FFFFFFFFFFFFFFFFFFFF'                                       
BIN2     DC    X'01',XL2'0000'                                                  
BIN4     DC    X'03',XL4'00000000'                                              
PAK8     DC    X'07',PL8'0'                                                     
*                                                                               
WORK2    DS    CL100                                                            
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
* ROUTINE TABLE                                                                 
*                                                                               
ROUTTAB  J     IAGYCODE          001                                            
         J     INWSCAMP                                                         
         J     INWSBUY                                                          
         J     INWSDATE                                                         
         J     IWHO              005                                            
         J     OWHO                                                             
         J     IWHAT                                                            
         J     OWHAT                                                            
         J     IBYCPS                                                           
         J     OBYCPS            010                                            
         J     IDIFFNET                                                         
         J     IIDR                                                             
         J     IINVCST                                                          
         J     IINVSPT                                                          
         J     IINVNO            015                                            
         J     IINVDATE                                                         
         J     IINVHCST                                                         
         J     IINVHSPT                                                         
         J     OINVNO                                                           
         J     ODEMNAME          020                                            
         SPACE 1                                                                
* DOWNLOAD ROUTINES                                                             
         J     IDLMKT                                                           
         J     ODLEST                                                           
         J     ODLSTA                                                           
         J     ODLTIMES                                                         
         J     ODLATIME          025                                            
         J     ODLDAY                                                           
         J     ODLLEN                                                           
         J     IDLGRP                                                           
         J     IDLMED                                                           
         J     IDLDATE           030                                            
         J     ODLDATE                                                          
         J     IDLSTDAY                                                         
         J     ODLADATE                                                         
         J     IDLWKS                                                           
         J     ODLWKS            035                                            
         J     IDLSPW                                                           
         J     ODLSPW                                                           
         J     IDLDPT                                                           
         J     IDLDAYS                                                          
         J     ODLCOST           040                                            
         J     ODLGRP                                                           
         J     IDLTYPE                                                          
         J     IMKTA                                                            
*                                                                               
* ROUTINES FROM DRV3                                                            
*                                                                               
         J     ICML                                                             
         J     OCML              045                                            
         J     ICMLCLS                                                          
         J     OCMLCLS                                                          
         J     ICMLCLNM                                                         
         J     OCMLCLNM                                                         
         J     ICMLNUM           050                                            
         J     OADATE                                                           
         J     OADAY                                                            
         J     OATIME                                                           
         J     OAPROG                                                           
         J     IUDEF             055                                            
         J     OUDEF                                                            
         J     HUDEF                                                            
         J     IBYCDATE                                                         
         J     IGLCDATE                                                         
         J     IATTCODE          060                                            
         J     OATTCODE                                                         
         J     ICOST2PS                                                         
         J     OCOST2PS                                                         
         J     ISTAFFCH                                                         
         J     OSTAFFCH          065                                            
         J     IHDCML                                                           
         J     OHDCML                                                           
         J     NOREPORT                                                         
         J     ONAME                                                            
         J     IDBOOK            070                                            
         J     ODBOOK                                                           
         J     IPDREP                                                           
         J     IUCOM                                                            
         J     OUCOM                                                            
         J     HUCOM             075                                            
         J     IBYCOPY                                                          
         J     OBYCOPY                                                          
         J     ICMLBCOD                                                         
         J     IBONUS                                                           
         J     IINVSTAT          080                                            
         J     OINVSTAT                                                         
*                                                                               
* ROUTINES THAT USE PACKED ACCUMULATORS                                         
*                                                                               
         J     IXINVCST                                                         
         J     IXBILCST                                                         
         J     IXBILL                                                           
         J     IXBILLNT          085                                            
         J     IXBYNTPD                                                         
         J     IXBHCACT                                                         
         J     IXBHCGRS                                                         
         J     IXBHCNET                                                         
         J     IXBHACT           090                                            
         J     IXBHGRS                                                          
         J     IXBHNET                                                          
         J     IXBHAGY                                                          
         J     IXAORAMT                                                         
         J     IXBILLM           095                                            
         J     IXBILBL                                                          
         J     IXBILBLM                                                         
         J     IXBILBLC                                                         
         J     IXBILBNT                                                         
         J     IXBYDOL           100                                            
         J     IXBYNET                                                          
         J     IXBYCST                                                          
         J     IXASSDOL                                                         
         J     IXBYDOLM                                                         
         J     IXBYNETM          105                                            
         J     IXASSNET                                                         
         J     IINVHCSP                                                         
         J     IXBYPAID                                                         
         J     IXBYPDM                                                          
         J     IXBYNTUN          110                                            
         J     IXBYUNPD                                                         
         J     IXBYUNPM                                                         
         J     IXCLAMT                                                          
         J     OXBILBL                                                          
         J     IINVSRCE          115                                            
         J     OINVSRCE                                                         
         J     OINVDATE                                                         
         J     IPSTI                                                            
         J     IPSTP                                                            
         J     IPSTU             120                                            
         J     IPST                                                             
         J     IPSTB                                                            
         J     IPSTL                                                            
         J     IMSFORM                                                          
         J     OMSFORM           125                                            
         J     IMSPARNT                                                         
         J     OMSPARNT                                                         
         J     IMSOWNER                                                         
         J     OMSOWNER                                                         
         J     IMSFREQ           130                                            
         J     OMSFREQ                                                          
         J     IMSSTATE                                                         
         J     OMSSTATE                                                         
         J     OPRINT                                                           
         J     ISHOW             135                                            
         J     OSHOW                                                            
         J     IETYPE                                                           
         J     OETYPE                                                           
         J     IOMFLT                                                           
         J     OOMFLT            140                                            
         J     IOMID                                                            
         J     OOMID                                                            
         J     IOMBYR                                                           
         J     OOMBYR                                                           
         J     IOMORDN           145                                            
         J     OOMORDN                                                          
         J     IOMSTAT                                                          
         J     OOMSTAT                                                          
         J     IOMREPC                                                          
         J     OOMREPC           150                                            
         J     IOMSPER                                                          
         J     OOMSPER                                                          
         J     IOMCITY                                                          
         J     OOMCITY                                                          
         J     IOMROUT           155                                            
         J     OOMROUT                                                          
         J     IOMDEST                                                          
         J     OOMDEST                                                          
         J     IOMSPTS                                                          
         J     OOMSPTS           160                                            
         J     IOMBUYS                                                          
         J     OOMBUYS                                                          
         J     IOMREVN                                                          
         J     OOMREVN                                                          
         J     IOMDOL            165                                            
         J     IOMOFR                                                           
         J     OOMOFR                                                           
         J     IINVMAT                                                          
         J     IBYSRCE                                                          
         J     OBYSRCE           170                                            
         J     IORBIT                                                           
         J     OORBIT                                                           
         J     HORB                                                             
         J     IOMLSENT                                                         
         J     OOMLSENT          175                                            
         J     IMSMAIL                                                          
         J     OMSMAIL                                                          
         J     IMSMOWN                                                          
         J     OMSMOWN                                                          
         J     IEBKTYP           180                                            
         J     OEBKTYP                                                          
         J     IFLMTYPE                                                         
         J     IXGLDOL                                                          
         J     IXGLNET                                                          
         J     IOMFSENT          185                                            
         J     OOMFSENT                                                         
         J     IMSMFID                                                          
         J     OMSMFID                                                          
         J     ICLINV                                                           
         J     ICLPRD            190                                            
         J     ICLEST                                                           
         J     IRATE                                                            
         J     IBYBOOK                                                          
         J     OBYBOOK                                                          
         J     IOMEMAIL          195                                            
         J     OOMEMAIL                                                         
         J     IINVAID                                                          
         J     IINVCMAT                                                         
         J     IINVDET                                                          
         J     IBLBLC2C          200                                            
         J     IOMMKGD                                                          
         J     OOMMKGD                                                          
         J     IBYVDEM                                                          
         J     OBYVDEM                                                          
*                                                                               
IIOMDEST NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         ICM   R6,15,OMREC                                                      
         JZ    EXIT                                                             
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         JNE   EXIT                                                             
         USING DOSPELD,R6                                                       
         CLI   GLARGS+2,C'R'         OMRESEND KEYWORD?                          
         BNE   IOMDEST5              NO                                         
         MVI   0(R2),C'N'            INIT TO NO                                 
         CLI   DOSPLEN,DOSPLNQ2      HAVE DOSPFLG2 IN ELEMENT?                  
         JL    EXIT                  NO - DONE                                  
         TM    DOSPFLG2,DOSPRSND     ORDER MIGHT NEED TO BE RESENT?             
         BZ    *+8                   NO                                         
         MVI   0(R2),C'Y'            YES                                        
         J     EXIT                  DONE                                       
*                                                                               
IOMDEST5 MVC   0(1,R2),DOSPIDST      DESTINATION                                
         J     EXIT                                                             
         DROP  R6                                                               
*                                                                               
         LTORG                                                                  
*                                                                               
OOMSMOWN NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         TM    GLINDS,GLTOTLIN      IS THIS A TOTAL LINE?                       
         JNZ   EXIT                 YES, DO NOT PRINT                           
*                                                                               
         CLI   GLARGS+2,C'1'        MSMINFEM KEYWORD?                           
         BE    *+12                 YES                                         
         CLI   GLARGS+2,C'3'        MSFCCFEM KEYWORD?                           
         BNE   OMSMOWN1             NO                                          
         MVI   CODEAREA,C' '        INIT TO A SPACE                             
         CLI   0(R2),C'N'           SET TO NO?                                  
         BE    *+12                 YES                                         
         CLI   0(R2),C'Y'           SET TO YES?                                 
         BNE   *+10                 NO                                          
         MVC   CODEAREA(1),0(R2)    SET OUTPUT                                  
         J     EXIT                 DONE                                        
*                                                                               
OMSMOWN1 CLI   GLARGS+2,C'2'        MSFCCMIN KEYWORD?                           
         BNE   OMSMOWN2             NO                                          
         MVC   CODEAREA(15),BLANKS  INIT TO SPACES                              
         CLI   0(R2),C'A'           A?                                          
         BNE   *+10                 NO                                          
         MVC   CODEAREA(5),=C'ASIAN'                                            
         CLI   0(R2),C'B'           B?                                          
         BNE   *+10                 NO                                          
         MVC   CODEAREA(5),=C'BLACK'                                            
         CLI   0(R2),C'H'           H?                                          
         BNE   *+10                 NO                                          
         MVC   CODEAREA(8),=C'HISPANIC'                                         
         CLI   0(R2),C'N'           N?                                          
         BNE   *+10                 NO                                          
         MVC   CODEAREA(15),=C'NATIVE AMERICAN'                                 
         CLI   0(R2),C'P'           P?                                          
         BNE   *+10                 NO                                          
         MVC   CODEAREA(16),=C'PACIFIC ISLANDER'                                
         J     EXIT                                                             
*                                                                               
OMSMOWN2 MVC   LABLAREA(7),=C'MIN OWN'                                          
         MVC   CODEAREA(L'STBMOWN),0(R2)                                        
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
*                                                                               
OOMDESTN NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         CLI   GLARGS+2,C'R'         OMRESEND KEYWORD?                          
         BNE   OOMDEST5              NO                                         
         MVC   LABLAREA(12),=C'NEED TO SEND'                                    
         MVC   CODEAREA(1),0(R2)     Y/N                                        
         J     EXIT                  DONE                                       
*                                                                               
OOMDEST5 MVC   LABLAREA(11),=C'DESTINATION'                                     
         CLI   0(R2),C'R'            REP?                                       
         BNE   *+10                  NO                                         
         MVC   CODEAREA(3),=C'REP'   YES                                        
         CLI   0(R2),C'S'            STA?                                       
         JNE   EXIT                  NO                                         
         MVC   CODEAREA(3),=C'STA'   YES                                        
         J     EXIT                  DONE                                       
*                                                                               
         LTORG                                                                  
*                                                                               
GETREP   NTR1  BASE=*,LABEL=*                                                   
         USING DOSTELD,R6                                                       
         CLI   DOSTLEN,DOSTLNQ6     HAVE REP ID IN REC (REDI ONLY)?             
         BNE   GETR10               NO - WE NEED TO READ CTFILE                 
*                                                                               
         MVC   0(8,R2),DOSTDRPP     REP PREFIX                                  
         LA    R4,7(R2)                                                         
         CLI   0(R4),X'40'                                                      
         BH    *+10                                                             
         BCTR  R4,0                                                             
         B     *-10                                                             
         MVC   2(2,R4),DOSTDRPO     REP OFFICE                                  
         J     EXIT                                                             
***                                                                             
* READ THE C'I' RECORD ON THE CONTROL FILE                                      
***                                                                             
GETR10   LA    R4,KEY                                                           
         USING CTIKEY,R4                                                        
         XC    KEY,KEY                                                          
         MVI   KEY,C'I'                                                         
         MVC   CTIKNUM,DOSTIDNM                                                 
         DROP  R4,R6                                                            
*                                                                               
         GOTO1 DATAMGR,DMCB,(0,=C'DMRDHI'),(0,=C'CTFILE'),KEY,SBAIO2            
         L     R6,SBAIO2                                                        
         USING CTIKEY,R6                                                        
         LA    R6,CTIDATA                                                       
         MVI   ELCODE,X'02'                                                     
         BAS   RE,NEXTEL                                                        
         JNE   EXIT                                                             
*                                                                               
         USING CTDSCD,R6           COPY USER ID TO SCREEN                       
         L     R1,GLADTENT                                                      
         LLC   R4,DRINLEN-DRIND(R1)                                             
         BCTR  R4,0                                                             
         CHI   R4,9                OMREPID KEYWORD IS 10 BYTES                  
         BE    GETR20                                                           
*                                                                               
         LLC   R1,CTDSCLEN                                                      
         SHI   R1,CTDSC-CTDSCD+1                                                
         CHI   R1,19               MOVING MORE THAN 20 BYTES?                   
         BNH   *+8                 NO                                           
         LA    R1,19               YES - ONLY HAVE 20 BYTES OF OUTPUT           
         LR    R4,R1                                                            
*                                                                               
GETR20   EX    R4,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),CTDSC                                                    
         J     EXIT                                                             
         DROP  R6                                                               
*                                                                               
         LTORG                                                                  
*                                                                               
OUTOMSLP NTR1  BASE=*,LABEL=*                                                   
         CLC   0(2,R2),XFFS          NEED TO READ GENDIR FOR NAME?              
         BE    OMSP00                YES                                        
         MVC   CODEAREA(25),0(R2)                                               
         B     OMSP60                                                           
*                                                                               
OMSP00   GOTO1 GETSLP,DMCB,2(R2),CODEAREA   HAVE BUFFERED SALESPERSON?          
         BE    OMSP60                       YES                                 
*                                                                               
         LA    R4,KEY                                                           
         USING GSPLRECD,R4         READ SALESPERSON RECORD                      
         XC    GSPLKEY,GSPLKEY                                                  
         MVI   GSPLKTYP,GSPLRECQ   X'000071' RECORDS                            
                                                                                
         MVI   GSPLKSTP,1          SALESPERSON TYPE                             
         CLI   7(R2),C'P'          POINTEPERSON?                                
         BNE   *+8                 NO                                           
         MVI   GSPLKSTP,2          POINTPERSON TYPE                             
         MVC   GSPLKSRP,2(R2)      REP ALPHA                                    
         MVC   GSPLKSAL,4(R2)      SALESPERSON CODE                             
         MVC   KEYSAVE,KEY                                                      
         LA    R1,SBLOCK                                                        
         ICM   RE,15,SBAUTL-SBLOCK(R1)  A(UTL)                                  
         MVC   SVUTL,4(RE)                                                      
         MVI   4(RE),X'0A'         READ THE CONTROL FILE                        
*                                                                               
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'GENDIR',KEYSAVE,KEY                   
         CLC   KEY(L'GSPLKEY),KEYSAVE                                           
         BNE   OMSP35                                                           
*                                                                               
         GOTO1 DATAMGR,DMCB,=C'GETREC',=C'GENFIL',KEY+36,AIO,DMWORK             
*                                                                               
         L     R6,AIO                                                           
         AHI   R6,GSPLFRST                                                      
*                                                                               
OMSP10   CLI   0(R6),0             END OF RECORD?                               
         BE    OMSP35              YES - RESTORE UTL!                           
         CLI   0(R6),X'02'         NEW INFORMATION ELEMENT?                     
         BE    OMSP20              YES - GET NAME                               
         LLC   R0,1(R6)            NO  - BUMP TO NEXT ELEMENT                   
         AR    R6,R0                                                            
         B     OMSP10                                                           
*                                                                               
         USING GSPLNFCD,R6                                                      
OMSP20   LA    RF,CODEAREA                                                      
         CLC   GSPLNFFR,BLANKS     FIRST NAME > SPACES?                         
         BNH   OMSP25              NO - DON'T HAVE A FIRST NAME                 
*                                                                               
         MVC   0(L'GSPLNFFR,RF),GSPLNFFR                                        
         LA    RF,L'GSPLNFFR-1(RF)                                              
         CLI   0(RF),C' '          SQUASH FIRST NAME DOWN                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         AHI   RF,2                                                             
*                                                                               
OMSP25   CLC   GSPLNFLS,BLANKS     LAST NAME > SPACES?                          
         BNH   OMSP30              NO - DONE                                    
         MVC   0(L'GSPLNFFR,RF),GSPLNFLS                                        
         DROP  R6                                                               
*                                                                               
OMSP30   CLC   CODEAREA,BLANKS                                                  
         BNH   OMSP35                                                           
         GOTO1 PUTSLP,DMCB,2(R2),CODEAREA   BUFFER THE SALESPERSON              
*                                                                               
OMSP35   LA    R1,SBLOCK                                                        
         ICM   RE,15,SBAUTL-SBLOCK(R1)  A(UTL)                                  
         MVC   4(1,RE),SVUTL       RESTORE UTL                                  
*                                                                               
OMSP60   OC    CODEAREA(25),BLANKS                                              
         MVC   LABLAREA(11),=C'SALESPERSON'                                     
         CLI   GLARGS+2,C'P'                                                    
         JNE   XIT                                                              
         MVC   LABLAREA(5),=C'POINT'                                            
         J     XIT                                                              
*                                                                               
         LTORG                                                                  
*                                                                               
ICMML    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         CLI   SBMODE,SBPROCSP     PROCBUY?                                     
         BE    ICML10                                                           
*                                                                               
         MVC   BYTE,SNVIDCML-SNVIDELD(R4)  CMML SEQ NUMBER                      
         CLI   GLARGS+3,X'01'      WANT PIGGIES CMML CODE?                      
         BNE   *+10                NO                                           
         MVC   BYTE,SNVIDCM2-SNVIDELD(R4)  CMML SEQ NUMBER                      
         LR    R5,R2               PUT COMMERCIAL CODE HERE                     
         BRAS  RE,GETCMLCD         HAVE COMMERCIAL CODE?                        
         JNE   XIT                 NO, EXIT                                     
*                                                                               
         CLI   GLARGS,C'C'         WANT CODE ONLY?                              
         BE    ICML00              YES - DON'T GET THE NAME                     
         MVC   SBCMLSQ,HALF        PASS THE COMMERCIAL SEQUENCE NUMBER          
         GOTO1 GETCML,0            GET THE NAME                                 
         LR    R5,R2               PUT HERE FOR CMLNM KEYWORD                   
         CLC   =C'BV',GLARGS       CML KEYWORD?                                 
         BNE   *+8                 NO                                           
         LA    R5,8(R2)            YES - PUT HERE FOR CML KEYWORD               
         CLI   GLARGS+2,X'05'      AD-ID KEYWORD?                               
         BE    *+8                 NO                                           
         CLI   GLARGS+2,X'06'      HDEF KEYWORD?                                
         BE    *+8                 NO                                           
         CLI   GLARGS+2,X'07'      CNTR KEYWORD?                                
         BNE   *+8                 NO                                           
         LA    R5,12(R2)           YES - PUT HERE FOR AD-ID KEYWORD             
         MVC   0(15,R5),CMLNAME    COMMERCIAL NAME                              
         CLI   GLARGS+2,3          CML NAME 2?                                  
         BNE   *+10                NO                                           
         MVC   0(20,R5),CMLNAME2   YES - MOVE IN CML NAME 2                     
         CLI   GLARGS+2,4          CML NAME 3?                                  
         BNE   *+10                NO                                           
         MVC   0(20,R5),CMLNAME3   YES - MOVE IN CML NAME 3                     
*                                                                               
ICML00   CLI   GLARGS+2,X'05'      AD-ID KEYWORD?                               
         JE    XIT                 YES - PIGGIES NOT SUPPORTED - EXIT           
         CLI   GLARGS+2,X'06'      HDEF KEYWORD?                                
         JE    XIT                 YES - PIGGIES NOT SUPPORTED - EXIT           
         CLI   GLARGS+2,X'07'      CNTR KEYWORD?                                
         JE    XIT                 YES - PIGGIES NOT SUPPORTED - EXIT           
         MVC   BYTE,SNVIDCM2-SNVIDELD(R4)  CMML SEQ NUMBER                      
         LA    R5,8(R2)            PUT COMMERCIAL CODE HERE                     
         CLI   GLARGS,C'C'         WANT ONLY CODE?                              
         BE    *+8                 YES                                          
         LA    R5,23(R2)           NO - PUT CMML CODE HERE                      
         BRAS  RE,GETCMLCD         HAVE COMMERCIAL CODE?                        
         JNE   XIT                 NO, EXIT                                     
*                                                                               
         CLI   GLARGS,C'C'         WANT CODE ONLY?                              
         JE    XIT                 YES - DON'T GET THE NAME                     
         MVC   SBCMLSQ,HALF        PASS THE COMMERCIAL SEQUENCE NUMBER          
         GOTO1 GETCML,0            GET THE NAME                                 
         LA    R5,15(R2)           PUT HERE FOR CMLNM KEYWORD                   
         CLI   GLARGS,C'N'         CMLNM KEYWORD?                               
         BE    *+8                 YES                                          
         LA    R5,31(R2)           NO - PUT HERE FOR CML KEYWORD                
         MVC   0(15,R5),CMLNAME    COMMERCIAL NAME                              
         J     XIT                                                              
*                                                                               
ICML10   LLC   R1,GLARGS+2         SET PARM FOR GETCML                          
         TM    GLARGS+3,X'01'      AD-IDCD2 KEYWORD?                            
         BZ    *+8                 NO                                           
         OI    DTAIND11,DIADID2    YES - SET FLAG TO USE SBCMLSQ2               
         GOTO1 GETCML              COMMERCIAL                                   
         NI    DTAIND11,X'FF'-DIADID2    TURN OFF FLAG                          
*                                                                               
         LA    R6,7                L'COMMERCIAL CODE                            
         CLI   GLARGS+2,5          AD-ID?                                       
         BE    *+8                 YES                                          
         CLI   GLARGS+2,6          HDEF?                                        
         BE    *+8                 YES                                          
         CLI   GLARGS+2,7          CNTR?                                        
         BNE   *+8                 NO                                           
         LA    R6,11               L'AD-ID                                      
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),CMLCODE                                                  
         CLI   GLARGS,C'C'         WANT JUST COMMERCIAL CODE?                   
         JE    XIT                 YES, ALREADY GOT IT                          
*                                                                               
         LA    R6,1(R2,R6)                                                      
         CLI   GLARGS,C'N'         WANT JUST THE COMMERCIAL NAME?               
         BNE   *+6                 NO                                           
         LR    R6,R2                                                            
         MVC   0(15,R6),CMLNAME    COMMERCIAL NAME                              
         CLI   GLARGS+2,3          CML NAME 2?                                  
         BNE   *+10                NO                                           
         MVC   0(20,R6),CMLNAME2   YES - MOVE IN CML NAME 2                     
         CLI   GLARGS+2,4          CML NAME 3?                                  
         BNE   *+10                NO                                           
         MVC   0(20,R6),CMLNAME3   YES - MOVE IN CML NAME 3                     
         J     XIT                                                              
*                                                                               
         LTORG                                                                  
*                                                                               
GETCMLCD NTR1  BASE=*,LABEL=*                                                   
         XR    RE,RE                                                            
         ICM   RE,1,BYTE           HAVE CMML SEQ NUMBER?                        
         JZ    NEQEXIT             NOPE - NO CMML CODE OR NAME!                 
         BCTR  RE,0                -1 TO INDEX INTO TABLE                       
         MHI   RE,15               TABLE ENTRY IS 14 BYTES LONG                 
         L     RF,AIO3             FILMCODE/AD-ID TABLE                         
         AR    RE,RF               INDEX INTO TABLE                             
         MVC   HALF,12(RE)         SAVE OFF SEQ NUMBER                          
         CLI   GLARGS,C'N'         WANT ONLY NAME?                              
         JE    EQEXIT              YES                                          
         LA    R6,7                L'COMMERCIAL CODE                            
         CLI   GLARGS+2,5          AD-ID?                                       
         BE    *+8                 YES                                          
         CLI   GLARGS+2,6          HDEF?                                        
         BE    *+8                 YES                                          
         CLI   GLARGS+2,7          CENTERCUT?                                   
         BNE   *+8                 NO                                           
         LA    R6,11               L'AD-ID                                      
         EX    R6,*+8              EXECUTE THE MVC                              
         B     *+10                                                             
         MVC   0(0,R5),0(RE)       MOVE IN FILMCODE/AD-ID                       
*                                                                               
EQEXIT   CR    RB,RB                                                            
         J     XIT                                                              
*                                                                               
NEQEXIT  LTR   RB,RB                                                            
         J     XIT                                                              
*                                                                               
         LTORG                                                                  
*                                                                               
OCMML    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   LABLAREA(4),=C'FILM'                                             
         CLI   GLARGS,C'N'               WANT JUST THE NAME?                    
         BNE   OCML2                     NO                                     
         LA    R1,L'CMLNAME-1            L'COMMERCIAL NAME - 1                  
         CLI   GLARGS+2,X'00'            CMLNM2/3 KEYWORD?                      
         BE    *+8                       NO                                     
         LA    R1,L'CMLNAME2-1           L'COMMERCIAL NAME2/3 - 1               
         EX    R1,*+8                    EXECUTE                                
         B     *+10                      BRANCH FOR IDF                         
         MVC   NAMEAREA(0),0(R2)         YES, MOVE IT INTO NAME AREA            
         EX    R1,*+8                    EXECUTE                                
         B     *+10                      BRANCH FOR IDF                         
         MVC   0(0,R3),0(R2)             YES, MOVE IT INTO NAME AREA            
         CLC   GLARGS(3),=X'D50000'      CMLNM KEYWORD?                         
         JNE   XIT                       NO                                     
         MVC   NAMEAREA+15(L'CMLNAME),15(R2)                                    
         OC    NAMEAREA+15(L'CMLNAME),BLANKS                                    
         J     XIT                                                              
*                                                                               
OCML2    MVC   CODEAREA(8),0(R2)         MOVE THE CODE IN                       
         CLI   GLARGS+2,5                WANT AD-ID?                            
         BE    OCML2A                    YES                                    
         CLI   GLARGS+2,6                WANT HDEF?                             
         BE    OCML2A                    YES                                    
         CLI   GLARGS+2,7                WANT CENTERCUT?                        
         BNE   OCML3                     NO                                     
*                                                                               
OCML2A   MVC   CODEAREA(12),0(R2)        YES - AD-ID IS 12 CHARACTERS           
         CLI   GLARGS,C'C'               WANT JUST THE CODE?                    
         JE    XIT                                                              
         MVC   NAMEAREA(L'CMLNAME),12(R2)                                       
         J     XIT                                                              
*                                                                               
OCML3    CLC   GLARGS(2),=C'BV'          CML KEYWORD?                           
         BE    OCML4                     YES                                    
         CLC   GLARGS(3),=X'C30000'      CMLCD KEYWORD?                         
         JNE   XIT                       NO                                     
         MVC   CODEAREA+9(8),8(R2)                                              
         OC    CODEAREA+9(8),BLANKS                                             
         J     XIT                                                              
*                                                                               
OCML4    MVC   NAMEAREA(15),8(R2)                                               
         MVC   NAMEAREA+16(8),23(R2)                                            
         OC    NAMEAREA+16(8),BLANKS                                            
         MVC   NAMEAREA+25(15),31(R2)                                           
         OC    NAMEAREA+25(15),BLANKS                                           
         J     XIT                                                              
*                                                                               
         LTORG                                                                  
*                                                                               
OMAIL    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING GLOBALD,RA                                                       
         USING GEND,RC                                                          
         USING SYSD,R9                                                          
*                                                                               
         LLC   RE,MYOLEN            FOR SOME REASON THE MIDLINE                 
         BCTR  RE,0                 WILL HAVE THE LAST ENTRY                    
         EX    RE,*+8               AT 0(R3) SO WE HAVE TO BLANK                
         B     *+10                 IT OUT                                      
         MVC   0(0,R3),BLANKS                                                   
*                                                                               
         TM    GLINDS,GLTOTLIN      IS THIS A TOTAL LINE?                       
         JNZ   GENOUT               YES, DO NOT PRINT                           
         GOTO1 GETSTABF,0(R2)       GET STATION BUFFER ENTRY                    
         LA    R6,SYSD                                                          
         AHI   R6,(SBASTANT-SYSD)                                               
         ZICM  R5,0(R6),3           HAVE A(STATION BUFFER)?                     
         JZ    GENOUT               NO                                          
         LA    R4,ADDRTABS          MSTREET KEYWORD TRANSLATION TABLE           
*                                                                               
OMAIL00  CLI   0(R4),X'FF'          END OF TABLE?                               
         JE    GENOUT               YES                                         
         CLC   0(1,R4),GLARGS+2     MATCH TABLE ENTRY?                          
         BE    OMAIL01              YES                                         
         LLC   RF,1(R4)             NO - GET TABLE ENTRY LENGTH                 
         AR    R4,RF                BUMP TO NEXT TABLE ENTRY                    
         B     OMAIL00                                                          
*                                                                               
OMAIL01  MVC   BYTE,2(R4)           SAVE OUTPUT LENGTH                          
         MVC   HALF(1),1(R4)        SAVE TABLE ENTRY LENGTH                     
         AHI   R4,3                 BUMP PAST LENGTH                            
*                                                                               
         USING STABUFFD,R5                                                      
*                                                                               
OMAIL05  MVI   ELEM,X'40'           INIT TO SPACES                              
         MVC   ELEM+1(L'ELEM-1),ELEM                                            
         LA    R6,ELEM              BUILD WHOLE ADDRESS HERE                    
         CLI   GLARGS+2,C'M'        WANT WHOLE MAILING/TAPE ADDRESS?            
         BNL   OMAIL10              YES                                         
*                                                                               
         LA    R6,CODEAREA          NO - PUT PARTIAL ADDRESS HERE               
         LLC   RF,HALF              ENTRY LENGTH                                
         SHI   RF,5                 MINUS OVERHEAD AND 1 FOR EX                 
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   LABLAREA(0),1(R4)    FOR HEADLINES                               
*                                                                               
OMAIL10  CLI   0(R4),X'FF'          END OF TABLE?                               
         BE    OMAIL30              YES                                         
         LA    R1,STBELEM           START OF ELEMENTS                           
         USING STBELEM,R1                                                       
*                                                                               
OMAIL15  CLI   STBELEM,0            END OF RECORD?                              
         BE    OMAIL25              YES                                         
         CLC   STBELEM,0(R4)        HAVE ELEMENT WE ARE LOOKING FOR?            
         BE    OMAIL20              YES                                         
         LLC   RF,STBELMLN          LENGTH OF ELEMENT                           
         AR    R1,RF                BUMP TO NEXT ELEM/END OF ENTRY              
         B     OMAIL15                                                          
*                                                                               
OMAIL20  CLI   STBELEM,SMCITY       HAVE STATE/ZIP/COUNTRY ELEM?                
         BNH   OMAIL21              NO                                          
         CLI   GLARGS+2,C'M'        WANT WHOLE MAILING/TAPE ADDRESS?            
         BNL   OMAIL20A             YES                                         
*                                                                               
         CLI   GLARGS+2,X'04'       WANT STATE?                                 
         BE    *+12                 YES                                         
         CLI   GLARGS+2,X'0A'       WANT STATE?                                 
         BNE   *+14                 NO                                          
         MVC   0(2,R6),SMSTATE      STATE                                       
         J     GENOUT                                                           
*                                                                               
         CLI   GLARGS+2,X'05'       WANT ZIP?                                   
         BE    *+12                 YES                                         
         CLI   GLARGS+2,X'0B'       WANT ZIP?                                   
         BNE   *+14                 NO                                          
         MVC   0(10,R6),SMZIP       ZIP                                         
         J     GENOUT                                                           
*                                                                               
         CLI   GLARGS+2,X'06'       WANT COUNTRY?                               
         BE    *+12                 YES                                         
         CLI   GLARGS+2,X'0C'       WANT COUNTRY?                               
         BNE   *+14                 NO                                          
         MVC   0(3,R6),SMCTRY       COUNTRY                                     
         J     GENOUT                                                           
*                                                                               
OMAIL20A MVC   0(2,R6),SMSTATE      STATE                                       
         MVI   2(R6),C','                                                       
         MVC   4(10,R6),SMZIP       ZIP                                         
         LA    R6,13(R6)            POINT TO LAST CHAR OF ZIP                   
         CLI   0(R6),C' '           IS THIS THE LAST CHAR OF THE ZIP?           
         BH    *+10                 YES                                         
         BCTR  R6,0                 NO - BACK UP ONE AND TRY AGAIN              
         B     *-10                                                             
         MVC   2(3,R6),SMCTRY       COUNTRY                                     
         B     OMAIL25                                                          
*                                                                               
OMAIL21  LLC   RE,BYTE              MAX LENGTH OF OUTPUT                        
         LLC   RF,STBELMLN          LENGTH OF ELEMENT                           
         SHI   RF,2                 MINUS ELEM CODE AND ELEM LENGTH             
         LTR   RE,RE                MAX LENGTH=0?                               
         BZ    *+12                 YES, DON'T USE THAT LENGTH!                 
         CR    RE,RF                USE SMALLEST LENGTH                         
         BH    *+6                                                              
         LR    RF,RE                                                            
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R6),STBDATA      ** EXECUTED **                              
         LA    R6,2(RF,R6)          PUT THE REST OF THE ADDRESS HERE            
*                                                                               
OMAIL25  CLI   GLARGS+2,C'M'        WANT WHOLE MAILING/TAPE ADDRESS?            
         JL    GENOUT               NO, WE GOT WHAT WE NEEDED                   
         AHI   R4,1                 BUMP THE TABLE                              
         B     OMAIL10                                                          
*                                                                               
OMAIL30  CLI   ELEM,X'40'           HAVE ANY DATA TO PRINT?                     
         JNH   GENOUT               NO                                          
*                                                                               
         LA    R4,ELEM+L'ELEM-1     LAST BYTE OF ELEM                           
         LA    R5,L'ELEM            LENGTH OF ELEM                              
*                                                                               
         CLI   0(R4),X'40'          HAVE ANY DATA?                              
         BH    *+10                 YES                                         
         BCTR  R4,0                 NO, DECREMENT ELEM POINTER                  
         BCT   R5,*-10              KEEP LOOKING FOR LAST CHAR OF DATA          
*                                                                               
         GOTO1 CHOPPER,DMCB,((R5),ELEM),(30,0(R3)),(198,6)                      
         J     EXIT                 EXIT WITH CC NEQ!                           
*                                                                               
         LTORG                                                                  
*                                                                               
IBOOK    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         CLI   GLARGS,C'B'         GET BUY BOOKTYPE?                            
         BNE   IBOOK20             NO                                           
         L     RE,SBAIO1           POINT TO BUY RECORD                          
         USING BUYRECD,RE                                                       
         LA    R1,BDELEM           FIRST ELEMENT                                
*                                                                               
IBOOK05  CLI   0(R1),0             END OF RECORD?                               
         JE    XIT                 YES - EXIT                                   
         CLI   0(R1),X'24'         X'02' ELEMENT?                               
         JE    IBOOK10             YES                                          
         LLC   R0,1(R1)            L'ELEMENT                                    
         AR    R1,R0               BUMP TO NEXT ELEMENT                         
         J     IBOOK05                                                          
         DROP  RE                                                               
*                                                                               
         USING DLUELEM,R1                                                       
IBOOK10  MVC   0(1,R2),DLUBKTYP    BOOKTYPE                                     
         J     XIT                                                              
         DROP  R1                                                               
*                                                                               
IBOOK20  GOTO1 GETESTNM                                                         
         JNE   XIT                                                              
         MVC   0(L'ESTBKTYP,R2),ESTBKTYP   MOVE IN EST BOOK TYPE                
         J     XIT                         AND EXIT                             
*                                                                               
         LTORG                                                                  
*                                                                               
OBOOK    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   LABLAREA(13),=C'BUY BOOK TYPE'                                   
         CLI   GLARGS,C'B'                 BUY BOOK TYPE?                       
         JE    *+10                        YES                                  
         MVC   LABLAREA(13),=C'EST BOOK TYPE'                                   
         CLI   0(R2),0                     HAVE BOOK TYPE?                      
         JE    XIT                         NO, EXIT                             
*                                                                               
         L     RF,ACOMFACS                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,11        GET A(BOOK TABLE)                            
         ICM   RF,15,0(R1)         A(TABLE)RETURNED IN P1                       
         JNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            L'TABLE ENTRY RETURNED IN P2                 
         USING SPBKTYPD,RF                                                      
*                                                                               
OEBK10   CLI   0(RF),X'FF'                                                      
         JNE   *+6                                                              
         DC    H'0'                                                             
         CLC   0(1,R2),SPBKTYPN                                                 
         JE    *+10                                                             
         AR    RF,R0                                                            
         J     OEBK10                                                           
*                                                                               
         MVC   CODEAREA(2),SPBKTYPA    BOOK TYPE                                
         J     XIT                                                              
         DROP  RF                                                               
*                                                                               
         LTORG                                                                  
*                                                                               
INRATE   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         CLI   SBMODE,SBPROCSP     PROCESS A BUY RECORD?                        
         JNE   EXIT                NO, GET OUT                                  
         L     R6,SBAIO1           R6 = BUY RECORD                              
         USING BUYRECD,R6          BUY RECORD DSECT                             
*                                                                               
         TM    BDCIND2,BDCCONVQ    IS BDCIND ALREADY CHAR (CONVERTED)?          
         JZ    *+14                NO - NEED TO INTERPRET                       
         MVC   0(1,R2),BDCIND      YES - JUST PASS IT AS IS                     
         J     EXIT                DONE                                         
*                                                                               
         MVI   0(R2),BDCC          COMISSION ONLY                               
         TM    BDCIND2,X'80'       IS THIS A COMMISION?                         
         JNZ   EXIT                YES - DONE                                   
*                                                                               
         MVI   0(R2),BDCNTP        P RATE                                       
         CLI   BDCIND,X'00'        IS THIS A P RATE?                            
         JE    EXIT                YES - DONE                                   
*                                                                               
         MVI   0(R2),BDCF          FEE RATE                                     
         TM    BDCIND,X'80'        IS THIS A FEE RATE?                          
         JNZ   EXIT                YES - DONE                                   
         MVI   0(R2),BDCQ          Q RATE                                       
         TM    BDCIND,X'40'        IS THIS A Q RATE?                            
         JNZ   EXIT                YES - DONE                                   
         MVI   0(R2),BDCGRS        GROSS                                        
         TM    BDCIND,X'20'        IS THIS GROSS?                               
         JNZ   EXIT                YES - DONE                                   
         MVI   0(R2),BDCN          NET                                          
         TM    BDCIND,X'10'        IS THIS NET?                                 
         JNZ   EXIT                YES - DONE                                   
         MVI   0(R2),BDCV          V RATE                                       
         TM    BDCIND,X'08'        IS THIS A V RATE?                            
         JNZ   EXIT                YES - DONE                                   
         MVI   0(R2),BDCS          SPECIAL                                      
         TM    BDCIND,X'04'        IS THIS A SPECIAL RATE?                      
         JNZ   EXIT                YES - DONE                                   
         MVI   0(R2),BDCX          X RATE                                       
         TM    BDCIND,X'02'        IS THIS AN X RATE?                           
         JNZ   EXIT                YES - DONE                                   
         CLC   SBAGY,=C'DF'        PROGRAM EXCHANGE?                            
         JNE   *+16                NO                                           
         MVI   0(R2),BDCNTP        NTP RATE                                     
         TM    BDCIND,X'FE'        X'FE' IS SAME IN GETRATE                     
         JZ    EXIT                CAREFUL HERE - NTP HAS NO BITS!              
*                                                                               
         MVI   0(R2),C'?'          I HAVE NO IDEA WHAT IT IS                    
         J     EXIT                DONE                                         
         DROP  R6                  DROP BUY RECORD USING                        
*                                                                               
         LTORG                                                                  
*                                                                               
IBYBK    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         CLI   SBMODE,SBPROCSP     PROCESS A BUY RECORD?                        
         JNE   EXIT                NO, GET OUT                                  
         L     R6,SBAIO1           R6 = BUY RECORD                              
         MVI   ELCODE,X'62'        FIND X'62' UPGRADE ELEMENT                   
         BRAS  RE,GETEL            HAVE THE ELEMENT?                            
         JNE   IBYBK10             NO - CHECK FOR BOOK AVERAGE ELEMENT          
         USING UPELEM,R6           UPGRADE ELEMENT DSECT                        
         MVC   0(4,R2),=C'UPX='    UPGRADE FILE =                               
         MVC   2(1,R2),UPFILE      DEMO FILE                                    
         MVC   4(8,R2),UPTYPE      TYPE + UP TO THREE 2-BYTE BOOKS              
         MVC   12(2,R2),UPFBK      SHARE SOURCE BOOK                            
*                                                                               
         L     R6,SBAIO1           R6 = BUY RECORD                              
         MVI   ELCODE,X'24'        FIND X'24' BOOKTYPE OVERRIDE                 
         BRAS  RE,GETEL            HAVE THE ELEMENT?                            
         JNE   EXIT                NO - DONE WITH UPGRADE                       
         USING DLUELEM,R6          DEMO LOOK-UP OVERRIDE ELEMENT                
         MVC   14(1,R2),DLUBKTYP   BOOK TYPE                                    
         J     EXIT                EXIT                                         
         DROP  R6                  DROP DLUELEM USING                           
*                                                                               
IBYBK10  L     R6,SBAIO1           R6 = BUY RECORD                              
         MVI   ELCODE,X'64'        FIND X'64' BOOK AVERAGE ELEMENT              
         BRAS  RE,GETEL            HAVE THE ELEMENT?                            
         JNE   IBYBK20             NO - REPORT THE REGULAR BOOK                 
         USING AVGBKLEM,R6         UPGRADE ELEMENT DSECT                        
         LLC   RE,AVGBKLN          ELEMENT LENGTH                               
         SHI   RE,8                MINUS OVERHEAD + 1 FOR EX                    
         CHI   RE,21               > 22 BYTES?                                  
         BNH   *+8                 NO                                           
         LA    RE,21               YES - ONLY MOVE 22 BYTES                     
         EX    RE,*+8              EXECUTED                                     
         B     *+10                SO IDF DOESN'T COMPLAIN                      
         MVC   0(0,R2),AVGBOOK     AVERAGE BOOK TEXT                            
         J     EXIT                EXIT                                         
         DROP  R6                  DROP AVGBKLEM USING                          
*                                                                               
IBYBK20  L     R6,SBAIO1           R6 = BUY RECORD                              
         MVI   ELCODE,X'02'        FIND X'02' ELEMENT                           
         BRAS  RE,GETEL            HAVE THE ELEMENT?                            
         JNE   EXIT                NO - LOOK FOR UPGRADE                        
         USING NDELEM,R6           X'02' ELEMENT DSECT                          
         MVC   0(2,R2),NDBOOK      BOOK                                         
         J     EXIT                DONE                                         
         DROP  R6                  DROP BUY RECORD USING                        
*                                                                               
         LTORG                                                                  
*                                                                               
OBYBK    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         OC    0(2,R2),0(R2)       HAVE A BOOK?                                 
         JZ    EXIT                NO - DONE                                    
         LA    R4,CODEAREA         PUT OUTPUT HERE                              
         CLC   =C'UP',0(R2)        HAVE UPGRADE FORMULA?                        
         JNE   OBYBK30             NO                                           
         MVC   0(4,R4),0(R2)       UPGRADE                                      
*                                                                               
         LA    R1,UPTAB            UPGRADE TABLE                                
*                                                                               
OBYBK00  CLI   0(R1),0             E-O-T?                                       
         BE    OBYBK05             YES                                          
         CLC   0(2,R1),4(R2)       MATCH ON SPUPTYPE/SPUPSTYP?                  
         BE    *+12                YES - MOVE IN UPGRADE                        
         LA    R1,L'UPTAB(R1)      BUMP TO NEXT UPGRADE IN TABLE                
         B     OBYBK00             LOOP BACK AND TEST NEXT UPGRADE              
         MVC   4(6,R4),2(R1)       MOVE UPGRADE TYPE NAME                       
*                                                                               
OBYBK05  LA    R4,10(R4)           FIND END OF UPGRADE NAME                     
         CLI   0(R4),C' '          > SPACE?                                     
         BH    *+8                 YES - LAST CHAR OF UPGRADE NAME              
         BCT   R4,*-8              NO - DECREMENT AND LOOP BACK                 
         MVI   1(R4),C'/'          ATTACH DELIMITER                             
         LA    R4,2(R4)            BUMP PAST DELIMITER                          
*                                                                               
         LA    R5,6(R2)            POINT TO FIRST UPGRADE VALUE                 
         LA    R6,3                SET MAX NUMBER OF VALUES                     
*                                                                               
OBYBK10  OC    0(2,R5),0(R5)       BOOK VALUE PRESENT?                          
         BZ    OBYBK25             NO - DONE                                    
         CLC   0(2,R5),=H'500'     BOOK OR VALUE?                               
         BNH   OBYBK20             YES                                          
         CLC   0(2,R5),=X'C100'    SOME VALUES START WITH LETTERS               
         BL    OBYBK15                                                          
         MVI   0(R5),0             REMOVE THE LETTER                            
         B     OBYBK20                                                          
*                                                                               
OBYBK15  BAS   RE,EDITBK           EDIT THE BOOK                                
         BCTR  R4,0                BACK UP TO INSERT DELIMITER                  
         MVI   0(R4),C'/'          INSERT DELIMITER                             
         LA    R4,1(R4)            BUMP PAST DELIMITER                          
         B     OBYBK25             GO PROCESS NEXT BOOK                         
*                                                                               
OBYBK20  BCTR  R4,0                BACK UP TO INSERT DELIMITER                  
         MVI   0(R4),C'/'          INSERT DELIMITER                             
         SR    R0,R0               CLEAR R0                                     
         ICM   R0,3,0(R5)          NUMERIC BOOK VALUE                           
         EDIT  (R0),(4,1(R4)),ALIGN=LEFT                                        
         LA    R4,6(R4)            BUMP PAST BOOK                               
*                                                                               
OBYBK25  LA    R5,2(R5)            BUMP TO NEXT VALUE                           
         BCT   R6,OBYBK10          DO FOR MAX VALUES                            
         BCTR  R4,0                POINT TO LAST DELIMITER                      
         MVI   0(R4),C' '          OVERWRITE LAST DELIMITER                     
*                                                                               
         OC    12(2,R2),12(R2)     HAVE A SHARE SOURCE BOOK?                    
         JZ    EXIT                NO - DONE                                    
         MVI   0(R4),C','          YES - MOVE IN A COMMA                        
         MVC   1(3,R4),=C'BK='     BK=                                          
         LA    R4,4(R4)            BUMP TO WHERE WE PRINT THE BOOK              
         LA    R5,12(R2)           POINT TO THE SHARE SOURCE BOOK               
         BAS   RE,EDITBK           FORMAT THE BOOK                              
*                                                                               
         CLI   14(R2),C'A'         HAVE AN OVERRIDE BOOK TYPE?                  
         JL    EXIT                NO - DONE                                    
         BCTR  R4,0                PUT OVERRIDE HERE                            
         MVI   0(R4),C'('          "("                                          
         MVC   1(1,R4),14(R2)      OVERRIDE BOOK TYPE                           
         MVI   2(R4),C')'          ")"                                          
         J     EXIT                DONE                                         
*                                                                               
OBYBK30  CLC   =C'AVG',0(R2)       HAVE BOOK AVERAGE?                           
         JNE   OBYBK40             NO                                           
         MVC   0(22,R4),0(R2)      BOOK AVERAGE                                 
         J     EXIT                DONE                                         
*                                                                               
OBYBK40  LR    R5,R2               RATING BOOK                                  
         BAS   RE,EDITBK           FORMAT THE BOOK                              
         J     EXIT                DONE                                         
*                                                                               
EDITBK   NTR1                                                                   
         MVC   DUB(2),0(R5)        BOOK                                         
         MVI   DUB+2,1             MOVE IN DAY                                  
         NI    DUB+1,X'7F'         TURN OFF OLYMPIC EXCLUSION                   
         GOTO1 DATCON,DMCB,(3,DUB),(6,WORK)                                     
         MVC   WORK+3(2),WORK+4    MOVE YEAR LEFT                               
         MVC   WORK+5(5),BLANKS    MOVE SPACES IN THE LAST 5 CHARS              
         TM    1(R5),X'80'         OLYMPIC EXCLUSION?                           
         BZ    *+10                NO                                           
         MVC   WORK+5(3),=C'(O)'   YES                                          
*                                                                               
         MVC   0(10,R4),WORK       MOVE BOOK IN                                 
         LA    R4,10(R4)           FIND END OF BOOK                             
*                                                                               
         CLI   0(R4),C' '          > SPACE?                                     
         BH    *+8                 YES - THIS IS THE LAST CHAR                  
         BCT   R4,*-8              NO - DECREMENT POINTER & CHECK AGAIN         
         MVI   1(R4),C' '                                                       
         LA    R4,2(R4)                                                         
         XIT1 REGS=(R4)                                                         
*                                                                               
         LTORG                                                                  
*                                                                               
IOMEML   NTR1  BASE=*,LABEL=*                                                   
         ICM   R6,15,OMREC         HAVE OM REC?                                 
         JZ    EXIT                NO - EXIT                                    
*                                                                               
         MVI   BYTE,C'T'           FIRST EMAIL                                  
         CLI   GLARGS+2,X'01'      WANT SECOND EMAIL(CC)?                       
         JNE   *+8                 NO                                           
         MVI   BYTE,C'C'           YES - LOOK FOR CC                            
         MVI   ELCODE,DOEMXELQ     X'53' ELEMENT                                
         BRAS  RE,GETEL            HAVE A X'03' ELEMENT?                        
         JNE   EXIT                NO - DONE                                    
*                                                                               
         USING DOEMXD,R6           EMAIL EXPORT ELEMENT DSECT                   
         LLC   R1,DOEMXLEN         ELEMENT LENGTH                               
         SHI   R1,8                MINUS OVERHEAD                               
         JNP   EXIT                EXIT IF NO EMAIL TOKEN INFO                  
         LA    R6,DOEMXD2          BUMP TO EMAIL TOKENS                         
*                                                                               
         USING DOEMXD2,R6          EMAIL TOKEN DSECT                            
IOMEML10 CLC   DOEMXFLG,BYTE       HAVE EMAIL ADDRESS WE WANT?                  
         JE    IOMEML20            YES                                          
         SHI   R1,5                MINUS EMAIL ADDRESS                          
         JNP   EXIT                EXIT IF NO EMAIL TOKENS LEFT                 
         LA    R6,5(R6)            POINT TO NEXT EMAIL TOKEN                    
         B     IOMEML10            CHECK NEXT TOKEN                             
*                                                                               
IOMEML20 MVC   0(4,R2),DOEMXTOK    EMAIL TOKEN                                  
         J     EXIT                DONE                                         
*                                                                               
         LTORG                                                                  
*                                                                               
OOMEML   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         LA    R6,KEY              R6 = KEY                                     
         USING EMLRECD,R6          EMAIL RECORD DSECT                           
         XC    KEY,KEY             CLEAR THE KEY                                
         MVI   EMLKTYP,EMLKTYPQ    X'0E'                                        
         MVI   EMLKSUB,EMLKSUBQ    X'15'                                        
         MVC   EMLKAGY,SBAGY       AGENCY                                       
         MVC   EMLKTOK,0(R2)       EMAIL TOKEN                                  
         MVC   KEYSAVE,KEY         SAVE OFF THE KEY                             
*                                                                               
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'XSPDIR',KEYSAVE,KEY                   
         CLC   KEY(32),KEYSAVE     FOUND THE EMAIL KEY?                         
         JNE   EXIT                NO - DONE                                    
*                                                                               
         GOTO1 DATAMGR,DMCB,=C'GETREC',=C'XSPFIL',KEY+36,AIO,DMWORK             
*                                                                               
         L     R6,AIO              R6 = EMAIL RECORD                            
         LLC   R1,43(R6)           L'(X'10' ELEMENT)                            
         BCTR  R1,0                -1 FOR EX                                    
         EX    R1,*+8              EXECUTE                                      
         B     *+10                BANCH FOR IDF                                
         MVC   CODEAREA(0),44(R6)  MOVE EMAIL ADDRESS TO OUTPUT                 
*                                                                               
         J     EXIT                DONE                                         
*                                                                               
         LTORG                                                                  
*                                                                               
IOMFSNT  NTR1  BASE=*,LABEL=*                                                   
         ICM   R6,15,OMREC           HAVE A(OM RECORD)                          
         JZ    EXIT                  NO - EXIT                                  
         MVI   ELCODE,DOSTELQ        X'12' NEW STATUS LAYOUT ELEMENT            
         BRAS  RE,GETEL              HAVE ONE?                                  
         J     *+8                                                              
*                                                                               
IOMF10   BRAS  RE,NEXTEL             ANY MORE?                                  
         JNE   EXIT                  NO - DONE                                  
*                                                                               
         USING DOSTELD,R6                                                       
         CLI   DOSTSTAT,DSENT        FIRST SENT?                                
         JE    IOMF20                YES                                        
         CLI   DOSTSTAT,DFXSENT      FAX SENT?                                  
         JE    IOMF20                YES                                        
         CLI   DOSTSTAT,DEMSENT      EMAIL SENT?                                
         JNE   IOMF10                NO                                         
IOMF20   MVC   0(3,R2),DOSTDATE      FIRST SENT DATE (PWOS JULIAN)              
         J     IOMF10                GET LAST X'12' ELEMENT!                    
         DROP  R6                                                               
*                                                                               
         LTORG                                                                  
*                                                                               
IOMKGD   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         OC    DMGKEY,DMGKEY         HAVE DARE MAKEGOOD ENTRY?                  
         JZ    EXIT                  NO - EXIT                                  
*                                                                               
         CLI   GLARGS+2,X'01'        MAKEGOOD GROUP CODE?                       
         BNE   *+14                  NO                                         
         MVC   0(3,R2),DMGKEY        SET MAKEGOOD GROUP CODE                    
         J     EXIT                  DONE                                       
*                                                                               
         LA    R6,DMGENTRY           DARE MAKEGOOD ENTRY                        
         USING DAREMKGD,R6           DARE MAKEGOOD ENTRY DSECT                  
*                                                                               
         CLI   GLARGS+2,X'02'        RECEIVED DATE/TIME?                        
         BNE   *+14                  NO                                         
         MVC   0(5,R2),DMKGDRDT      RECEIVED DATE/TIME                         
         J     EXIT                  DONE                                       
*                                                                               
         CLI   GLARGS+2,X'03'        LAST STATUS DATE/TIME?                     
         BNE   *+14                  NO                                         
         MVC   0(5,R2),DMKGDLDT      LAST STATUS DATE/TIME                      
         J     EXIT                  DONE                                       
*                                                                               
         CLI   GLARGS+2,X'04'        TOTAL MAKEGOOD AMENDMENTS?                 
         BNE   *+14                  NO                                         
         MVC   0(1,R2),DMKGDRVS      TOTAL MAKEGOOD AMENDMENTS                  
         J     EXIT                  DONE                                       
*                                                                               
         CLI   GLARGS+2,X'05'        LAST STATUS?                               
         JNE   EXIT                  NO                                         
         MVC   0(1,R2),DMKGDLST      LAST STATUS                                
         J     EXIT                  DONE                                       
*                                                                               
OOMKGD   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         CLI   GLARGS+2,X'01'        MAKEGOOD GROUP CODE?                       
         BNE   *+14                  NO                                         
         MVC   CODEAREA(3),0(R2)     MAKEGOOD GROUP CODE                        
         J     EXIT                  DONE                                       
*                                                                               
         CLI   GLARGS+2,X'02'        RECEIVED DATE/TIME?                        
         BE    *+12                  YES                                        
         CLI   GLARGS+2,X'03'        LAST STATUS DATE/TIME?                     
         BNE   OOMKGD20              NO                                         
         GOTO1 DATCON,DMCB,(8,0(R2)),(11,CODEAREA)                              
*                                                                               
         MVC   CODEAREA+15(2),=C'AM' INIT TO AM                                 
         LLC   RF,3(R2)              HOURS                                      
         CHI   RF,X'12'              >= NOON?                                   
         BL    OOMKGD10              NO - LEAVE AS IS                           
         BE    *+12                  EQUAL TO NOON?                             
         SHI   RF,X'12'              NO - SUBTRACT 12 HOURS                     
         STC   RF,3(R2)              REPLACE HOURS                              
         MVI   CODEAREA+15,C'P'      PM                                         
*                                                                               
OOMKGD10 GOTO1 HEXOUT,DMCB,3(R2),WORK,2                                         
*                                                                               
         MVC   CODEAREA+9(2),WORK    HOURS                                      
         CLC   =C'00',CODEAREA+9     HOUR OF 12AM?                              
         BNE   *+10                  NO                                         
         MVC   CODEAREA+9(2),=C'12'  YES - REPLACE WITH 12                      
         MVI   CODEAREA+11,C':'      :                                          
         MVC   CODEAREA+12(2),WORK+2 MINUTES                                    
         J     EXIT                  DONE                                       
*                                                                               
OOMKGD20 CLI   GLARGS+2,X'04'        TOTAL MAKEGOOD AMENDMENTS?                 
         BNE   OOMKGD30              NO                                         
         EDIT  (B1,0(R2)),(3,CODEAREA)                                          
         J     EXIT                  DONE                                       
*                                                                               
OOMKGD30 CLI   GLARGS+2,X'05'        LAST STATUS?                               
         JNE   EXIT                  NO                                         
         LA    R6,CODEAREA           OUTPUT GOES HERE                           
         CLI   0(R2),MNSTAPP         C'A' / APPROVED?                           
         BNE   *+10                  NO                                         
         MVC   0(8,R6),=C'APPROVED'  APPROVED                                   
         CLI   0(R2),MNSTCANM        C'B' / SELLER RECALL?                      
         BNE   *+10                  NO                                         
         MVC   0(13,R6),=C'SELLER RECALL'                                       
         CLI   0(R2),MNSTCAN         C'C' / CANCELLED?                          
         BNE   *+10                  NO                                         
         MVC   0(9,R6),=C'CANCELLED' CANCELLED                                  
         CLI   0(R2),MNSTDELV        C'D' / DELIVERED?                          
         BNE   *+10                  NO                                         
         MVC   0(9,R6),=C'DELIVERED' DELIVERED                                  
         CLI   0(R2),MNSTERR         C'E' / ERROR?                              
         BNE   *+10                  NO                                         
         MVC   0(5,R6),=C'ERROR'     ERROR                                      
         CLI   0(R2),MNSTGOIN        C'G' / GOING TO BE OKAYED?                 
         BNE   *+10                  NO                                         
         MVC   0(18,R6),=C'GOING TO BE OKAYED'                                  
         CLI   0(R2),MNSTHOLD        C'H' / ON HOLD FOR MANUAL OKAY?            
         BNE   *+10                  NO                                         
         MVC   0(23,R6),=C'ON HOLD FOR MANUAL OKAY'                             
         CLI   0(R2),MNSTAMND        C'M' / AMENDED?                            
         BNE   *+10                  NO                                         
         MVC   0(7,R6),=C'AMENDED'   AMENDED                                    
         CLI   0(R2),MNSTNEW         C'N' / NEW?                                
         BNE   *+10                  NO                                         
         MVC   0(3,R6),=C'NEW'       NEW                                        
         CLI   0(R2),MNSTOKAY        C'O' / OKAYED?                             
         BNE   *+10                  NO                                         
         MVC   0(6,R6),=C'OKAYED'    OKAYED                                     
         CLI   0(R2),MNSTREJ         C'R' / REJECTED?                           
         BNE   *+10                  NO                                         
         MVC   0(8,R6),=C'REJECTED'  REJECTED                                   
         CLI   0(R2),MNSTSAPP        C'S' / SELF APPLIED?                       
         BNE   *+10                  NO                                         
         MVC   0(12,R6),=C'SELF APPLIED'                                        
         J     EXIT                  DONE                                       
*                                                                               
         LTORG                                                                  
*                                                                               
IUNVDEM  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         XC    0(4,R2),0(R2)         CLEAR INPUT                                
         CLI   SBMODE,SBPROCSP       PROCESSING BUYS?                           
         BE    *+12                  YES                                        
         CLI   SBMODE,SBPROCGL       PROCESSING GOALS?                          
         JNE   EXIT                  NO - DON'T REPORT UNIVERSE                 
         LLC   R1,GLARGS+2           WILL HAVE DEMO NUM (1-8)                   
         BCTR  R1,0                  - 1 FOR INDEX                              
         SLL   R1,2                  MULTIPLY BY 4                              
         LA    RE,UNIVALS            UNIVERSE VALUES                            
         AR    RE,R1                 INDEX INTO UNIVERSE VALUES                 
         MVC   0(4,R2),0(RE)         MARKET UNIVERSE                            
         J     EXIT                  DONE                                       
*                                                                               
         LTORG                                                                  
*                                                                               
OUNVDEM  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         EDIT  (4,0(R2)),(7,0(R3))                                              
*                                                                               
         J     EXIT                  DONE                                       
*                                                                               
         LTORG                                                                  
*                                                                               
IBLC2C   NTR1  BASE=*,LABEL=*      BILLABLE COST2 COMMISSION                    
*                                                                               
         L     R4,SBACURCH         A(CHUNK)                                     
         USING SCHUNKD,R4          SCHUNKD USING                                
*                                                                               
         LA    R6,BIN4             R6 = BIN4                                    
         XC    0(8,R2),0(R2)       CLEAR INPUT FIELD                            
         CLI   SBMODE,SBPROCSP     PROCESSING BUYS?                             
         BNE   IBLC2C10            NO                                           
         L     RE,SCGROSS2         COST2 GROSS                                  
         S     RE,SCNET2           SUBTRACT COST2 NET                           
         ST    RE,0(R2)            COMMISSION = GROSS - NET                     
         CLI   GLARGS+2,X'01'      BILBLC2 KEYWORD?                             
         BNE   *+10                NO                                           
         MVC   0(4,R2),SCGROSS2    YES - USE SCGROSS2                           
         CLI   GLARGS+2,X'02'      BILBLNC2 KEYWORD?                            
         BNE   *+10                NO                                           
         MVC   0(4,R2),SCNET2      YES - USE SCNET2                             
         B     IBLC2CEQ            EXIT WITH CC EQU                             
*                                                                               
IBLC2C10 CLI   SBMODE,SBPROCBL     PROCESSING STATION BUCKET ELEMENT?           
         BE    *+6                 YES                                          
         DC    H'0'                NO - HOW DID WE GET HERE?                    
*                                                                               
         TM    SBEFLAG7,SBE7COS2   YES - IS THIS COST2?                         
         BZ    IBLC2CNE            NO - EXIT WITH CC NEQ                        
*                                                                               
         LA    R2,4(R2)            BUMP TO BILL PORTION OF INPUT                
         L     RE,SBBILGRS         COST2 GROSS                                  
         S     RE,SBBILNET         SUBTRACT COST2 NET                           
         ST    RE,0(R2)            COMMISSION = GROSS - NET                     
         CLI   GLARGS+2,X'01'      BILBLC2 KEYWORD?                             
         BNE   *+10                NO                                           
         MVC   0(4,R2),SBBILGRS    YES - USE SBBILGRS                           
         CLI   GLARGS+2,X'02'      BILBLNC2 KEYWORD?                            
         BNE   *+10                NO                                           
         MVC   0(4,R2),SBBILNET    YES - USE SBBILNET                           
*                                                                               
IBLC2CEQ CR    RB,RB               SET CC EQU                                   
         J     XIT                 EXIT                                         
*                                                                               
IBLC2CNE LTR   RB,RB               SET CC NEQ                                   
         J     XIT                 EXIT                                         
*                                                                               
         LTORG                                                                  
*                                                                               
INVDET05 NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING SNVIDELD,R4         INVOICE DETAIL DSECT                         
         CLI   SNVIDLEN,SNVIDL4Q   HAVE DIGITAL DATA?                           
         BL    INVDETX             NO - EXIT                                    
         ICM   R3,7,SNVIDIMP+1     IMPRESSIONS (MAX VAL IS X'0F423F')           
         CLI   GLARGS+2,C'I'       WANT IMPRESSIONS?                            
         BE    INVDET10            YES                                          
         ICM   R3,15,SNVIDRAT      RATINGS                                      
         CLI   GLARGS+2,C'R'       WANT RATINGS?                                
         BE    INVDET10            YES                                          
         ICM   R3,15,SNVIDCLK      MUST BE CLICKS                               
*                                                                               
INVDET10 C     R3,=X'FFFFFFFF'     IS THIS SET TO "NO DATA"?                    
         BNE   *+6                 NO                                           
         XR    R3,R3               YES - IN OUR CASE NO DATA = 0                
*                                                                               
         CLI   GLARGS+2,C'I'       WANT IMPRESSIONS?                            
         BNE   INVDET20            YES                                          
         TM    SNVIDIMP,X'40'      2 DECIMAL FLAG SET?                          
         BZ    INVDET15            NO                                           
         TM    SBEFLAG9,SBE92DEC   YES - WANT 2-DECIMAL IMPRESSIONS?            
         BNZ   INVDET20            YES - LEAVE NUMBER AS IS                     
         LR    R0,R3               ADJUST 2 DECIMAL PRECISION TO 1              
         SRDA  R0,31               R1 = IMP*2                                   
         D     R0,=F'10'           DIVIDE BY 10                                 
         AHI   R1,1                +1                                           
         SRA   R1,1                /2                                           
         LR    R3,R1               R3 = IMP/10                                  
*                                                                               
INVDET15 TM    SBEFLAG9,SBE92DEC   WANT 2-DECIMAL IMPRESSIONS?                  
         BZ    INVDET20            NO - LEAVE NUMBER AS IS                      
         MHI   R3,10               MULTIPLY 1 DECIMAL IMP*10                    
*                                                                               
INVDET20 CVD   R3,DUB              CONVERT R3 TO A PACKED DECIMAL               
         ZAP   0(8,R2),DUB         R2 = PACKED VALUE                            
INVDETX  J     XIT                 EXIT                                         
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
***********************************************************************         
* ADDRESS TABLE TO TRANSLATE GLARGS+2 TO AN MSTREET ELEMENT IN STABUFF*         
* BYTE 1 - GLARGS+2 ON ENTRY RECORD                                   *         
* BYTE 2 - TABLE ENTRY LENGTH                                         *         
* BYTE 3 - MAX KEYWORD LENGTH                                         *         
* BYTE 4+- ELEMENT ID IN STABUFF FOLLOWED BY X'FF' TO INDICATE EOT    *         
***********************************************************************         
ADDRTABS DC    X'E30800080A0C0EFF'    TAPE ADDRESS                              
         DC    X'D40800090B0D0FFF'    MAIL ADDRESS                              
         DC    X'01111909'            MSMALST1                                  
         DC    C'MS MAIL ADDR1'                                                 
         DC    X'0211190B'            MSMALST2                                  
         DC    C'MS MAIL ADDR2'                                                 
         DC    X'03130F0D'            MSMALCTY                                  
         DC    C'MS MAILING CITY'                                               
         DC    X'040E050F'            MSMALSTA                                  
         DC    C'MAIL STATE'                                                    
         DC    X'050C050F'            MSMALZIP                                  
         DC    C'MAIL ZIP'                                                      
         DC    X'060D040F'            MSMALCRY                                  
         DC    C'MAIL CTRY'                                                     
         DC    X'07121908'            MSTRAST1                                  
         DC    C'MS TRAFF ADDR1'                                                
         DC    X'0812190A'            MSTRAST2                                  
         DC    C'MS TRAFF ADDR2'                                                
         DC    X'09130F0C'            MSTRACTY                                  
         DC    C'MS TRAFFIC CITY'                                               
         DC    X'0A0F050E'            MSTRASTA                                  
         DC    C'TRAFF STATE'                                                   
         DC    X'0B0F050E'            MSTRAZIP                                  
         DC    C'TRAFFIC ZIP'                                                   
         DC    X'0C0D040E'            MSTRACRY                                  
         DC    C'TRFF CTRY'                                                     
         DC    X'FF'                                                            
         EJECT                                                                  
*                                                                               
UPTAB    DS    0XL8                SPUPTYPE/SPUTSTYP/UPGRADE NAME               
         DC    AL1(SPUPTRTG),X'0',C'RATING'                                     
         DC    AL1(SPUPTHUT),X'0',C'HUT   '                                     
         DC    AL1(SPUPTPUT),C'P',C'PUT   '                                     
         DC    AL1(SPUPTNDX),X'0',C'INDEX '                                     
         DC    AL1(SPUPTHPT),X'0',C'HPT   '                                     
         DC    AL1(SPUPTPIN),C'N',C'PIN   '                                     
         DC    AL1(SPUPTPIM),C'M',C'PIM   '                                     
         DC    AL1(SPUPTPIY),C'Y',C'PIY   '                                     
         DC    AL1(SPUPTPIQ),C'Q',C'PIQ   '                                     
         DC    AL1(SPUPTPIB),C'B',C'PIB   '                                     
         DC    AL1(SPUPTSIN),C'N',C'SIN   '                                     
         DC    AL1(SPUPTSIM),C'M',C'SIM   '                                     
         DC    AL1(SPUPTSIY),C'Y',C'SIY   '                                     
         DC    AL1(SPUPTSIQ),C'Q',C'SIQ   '                                     
         DC    AL1(SPUPTSIB),C'B',C'SIB   '                                     
         DC    AL1(SPUPTPAV),C'N',C'PAVG  '                                     
         DC    AL1(SPUPTPAY),C'Y',C'PAY   '                                     
         DC    AL1(SPUPTPAQ),C'Q',C'PAQ   '                                     
         DC    AL1(SPUPTPAB),C'B',C'PAB   '                                     
         DC    AL1(SPUPTSAV),C'N',C'SAVG  '                                     
         DC    AL1(SPUPTSAY),C'Y',C'SAY   '                                     
         DC    AL1(SPUPTSAQ),C'Q',C'SAQ   '                                     
         DC    AL1(SPUPTSAB),C'B',C'SAB   '                                     
         DC    X'00'                                                            
         DROP                                                                   
*                                                                               
*        INCLUDE DRGLOBAL                                                       
*        INCLUDE DRIVETABLE                                                     
*        INCLUDE DRINTRECD                                                      
*        INCLUDE DDSPOOLD                                                       
*        INCLUDE DDSPLWORKD                                                     
*        INCLUDE CTGENFILE                                                      
*        INCLUDE SPWRIFFD                                                       
*        INCLUDE SPWRIF1D                                                       
*        INCLUDE DDGENTWA                                                       
         PRINT OFF                                                              
       ++INCLUDE DRGLOBAL                                                       
       ++INCLUDE DRIVETABLE                                                     
       ++INCLUDE DRINTRECD2                                                     
       ++INCLUDE DDSPOOLD                                                       
       ++INCLUDE DDSPLWORKD                                                     
       ++INCLUDE CTGENFILE                                                      
       ++INCLUDE SPWRIFFD                                                       
         ORG   CONTAGH                                                          
       ++INCLUDE SPWRIF1D                                                       
       ++INCLUDE DDGENTWA                                                       
         PRINT ON                                                               
         EJECT                                                                  
       ++INCLUDE SPWRIWORKD                                                     
         EJECT                                                                  
* SPGENBUY                                                                      
         PRINT OFF                                                              
BUYRECD  DSECT                                                                  
       ++INCLUDE SPGENBUY                                                       
         EJECT                                                                  
         PRINT ON                                                               
         SPACE 1                                                                
* SPGENGOAL                                                                     
         PRINT OFF                                                              
GOALRECD DSECT                                                                  
       ++INCLUDE SPGENGOAL                                                      
         EJECT                                                                  
         PRINT ON                                                               
* SPGENAGY                                                                      
         PRINT OFF                                                              
AGYRECD  DSECT                                                                  
       ++INCLUDE SPGENAGY                                                       
         EJECT                                                                  
         PRINT ON                                                               
* SPGENSNV                                                                      
         PRINT OFF                                                              
SNVRECD  DSECT                                                                  
       ++INCLUDE SPGENSNV                                                       
         EJECT                                                                  
         PRINT ON                                                               
* SPGENINV                                                                      
         PRINT OFF                                                              
INVRECD  DSECT                                                                  
       ++INCLUDE SPGENINV                                                       
         EJECT                                                                  
         PRINT ON                                                               
* SPGENMKT                                                                      
         PRINT OFF                                                              
MKTRECD  DSECT                                                                  
       ++INCLUDE SPGENMKT                                                       
         EJECT                                                                  
         PRINT ON                                                               
* DDUCOMD                                                                       
         PRINT OFF                                                              
       ++INCLUDE DDUCOMD                                                        
         EJECT                                                                  
         PRINT ON                                                               
* SPGENBILL                                                                     
         PRINT OFF                                                              
BILLRECD DSECT                                                                  
       ++INCLUDE SPGENBILL                                                      
         EJECT                                                                  
       ++INCLUDE MAAORLKD                                                       
         PRINT ON                                                               
       ++INCLUDE SPGENCLRST                                                     
         EJECT                                                                  
       ++INCLUDE SPGENDRORD                                                     
         EJECT                                                                  
       ++INCLUDE SPGENDRMKN                                                     
         EJECT                                                                  
       ++INCLUDE GEGENSPSAL                                                     
         EJECT                                                                  
       ++INCLUDE DEDEMTABD                                                      
         EJECT                                                                  
       ++INCLUDE SPDEMUPD                                                       
         EJECT                                                                  
       ++INCLUDE SPGENEMAIL                                                     
         EJECT                                                                  
       ++INCLUDE DDCOMFACS                                                      
         EJECT                                                                  
       ++INCLUDE DDMASTD                                                        
         EJECT                                                                  
       ++INCLUDE FAFACTS                                                        
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'108SPSYSDRV4 10/20/20'                                      
         END                                                                    

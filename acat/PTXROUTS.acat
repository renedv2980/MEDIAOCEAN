*          DATA SET PTXROUTS   AT LEVEL 110 AS OF 02/19/21                      
*CATALP PTXROUTS                                                                
         TITLE 'EXTRACT ROUTINES FOR PRINTXTRACT'                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* SMYE   01/06  ADDED FIELDS TO CLIENT, JOB, BUY AND BUY SUMMARY RECS           
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
         PRINT NOGEN                                                            
PTXROUTS CSECT                                                                  
*                                                                               
         ENTRY PRIAGY            MEDIA                                          
         ENTRY PRICNT            CLIENT                                         
         ENTRY PRIDIV            DIVISION                                       
         ENTRY PRIPRD            PRODUCT                                        
         ENTRY PRIEST            ESTIMATE                                       
         ENTRY PRIPUB            PUB                                            
         ENTRY PRICON            CONTRACT                                       
         ENTRY PRIREP            REP                                            
         ENTRY PRIJOB            JOB                                            
         ENTRY PRIBUY            BUY                                            
         ENTRY PRIPGD            PUB GROUP DEFINITION                           
         ENTRY PRIPBG            PUB GROUP                                      
         ENTRY PRIPGP            PUB GROUP PUB                                  
         ENTRY PRICCC            CUSTOM COLUMN                                  
         ENTRY PRICGD            CLIENT GROUP DEFINITION                        
         ENTRY PRICLG            CLIENT GROUP                                   
         ENTRY PRICLC            CLIENT GROUP CLIENT                            
         ENTRY PRIGDP            PRODUCT GROUP DEFINITION                       
         ENTRY PRIGGP            PRODUCT GROUP                                  
         ENTRY PRIGPP            PRODUCT GROUP PRODUCT                          
         ENTRY PRIREG            REGION                                         
         ENTRY PRIDST            DISTRICT                                       
         ENTRY PRIPDA            PUB DISTRICT ASSIGNMENT                        
         ENTRY PRIACG            ADDITIONAL CHARGE                              
         ENTRY PRIUCM            UCOMM (USER COMMENT)                           
         ENTRY PRIBUD            BUDGET RECORD                                  
         ENTRY PRISTC            STANDARD COLUMNS                               
         ENTRY PRIBFM            BILL FORMULA                                   
*                                                                               
         ENTRY DISBFM            DISBFM (BILL FORMULA DISPLAY)                  
*****                                                                           
*                                                                               
YES      SR    RC,RC               RETURN CC EQUAL                              
NO       LTR   RC,RC               RETURN CC NOT EQUAL                          
EXIT     XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
* PRIAGY - EXTRACT AGENCY RECORD                                                
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=PRINT-TO-EXTRACT                                              *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIAGY   NMOD1 WORKL,*PRIMED*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRIMDLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIMDD,R2           R2=A(EXTRACT RECORD)                         
         USING PAGYREC,R3          R3=A(PRIFILE RECORD)                         
*                                                                               
         XC    PRIMDLEN,PRIMDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIMDLEN(2),=AL2(PRIMDDL)                                        
         MVC   PRIMDTYP,PRMDQ                                                   
         MVI   PRIMDDX,MXTRTQ                                                   
         MVI   PRIMDDX+1,MXTRTQ                                                 
         MVI   PRIMDAGY-1,MXTRTQ                                                
         MVI   PRIMDMED-1,MXTRTQ                                                
         MVI   PRIMDAGN-1,MXTRTQ                                                
         MVI   PRIMDMDN-1,MXTRTQ                                                
         MVI   PRIMDISC-1,MXTRTQ                                                
*                                                                               
         MVC   PRIMDAGY,PAGYKAGY   AGENCY                                       
         TR    PRIMDAGY,MXTRT                                                   
         MVC   PRIMDMED,PAGYKMED   MEDIA                                        
         TR    PRIMDAGY,MXTRT                                                   
*                                                                               
         LA    R6,PAGYREC                                                       
         MVI   ELCODE,X'01'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PAGY0010                                                         
*                                                                               
         USING PAGYELEM,R6                                                      
         MVC   PRIMDAGN,PAGYNAME   AGENCY NAME                                  
*                                                                               
*  SPECIAL CASE WHEN MEDIA INTERACTIVE WE NEED TO EXPAND ABBREVIATION           
*                                                                               
         MVC   PRIMDMDN(11),2(R8)       **HARD CODING 11**                      
*                                                                               
         MVC   PRIMDPUB,PAGYPROF+12                                             
*                                                                               
         MVI   PRIMDISC,C'N'                                                    
         CLI   PAGYNAT,C'C'                                                     
         BNE   PAGY0010                                                         
         MVI   PRIMDISC,C'Y'                                                    
         DROP  R6                                                               
*                                                                               
PAGY0010 DS    0H                                                               
         TR    PRIMDAGN,MXTRT                                                   
         TR    PRIMDMDN,MXTRT                                                   
         TR    PRIMDISC,MXTRT                                                   
*                                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIMDLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRICNT - EXTRACT CLIENT RECORD                                                
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRICNT   NMOD1 WORKL,*PRICNT*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRICNLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRICND,R2           R2=A(EXTRACT RECORD)                         
         USING PCLTRECD,R3         R3=A(PRINT RECORD)                           
*                                                                               
         BRAS  RE,LOADER2          GET OFFICER ADDRESS                          
*                                                                               
         XC    PRICNLEN,PRICNLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRICNLEN(2),=AL2(PRICNDL)                                        
         MVC   PRICNTYP,PRCNQ                                                   
         MVI   PRICNDX,MXTRTQ                                                   
         MVI   PRICNDX+1,MXTRTQ                                                 
         MVI   PRICNAGY-1,MXTRTQ                                                
         MVI   PRICNMED-1,MXTRTQ                                                
         MVI   PRICNCNT-1,MXTRTQ                                                
         MVI   PRICNNME-1,MXTRTQ                                                
         MVI   PRICNOFF-1,MXTRTQ                                                
         MVI   PRICNTAX-1,MXTRTQ                                                
         MVI   PRICNBLL-1,MXTRTQ                                                
         MVI   PRICNISF-1,MXTRTQ                                                
         MVI   PRICNPU1-1,MXTRTQ                                                
         MVI   PRICNPU2-1,MXTRTQ                                                
         MVI   PRICNEU1-1,MXTRTQ                                                
         MVI   PRICNEU2-1,MXTRTQ                                                
         MVI   PRICNMN-1,MXTRTQ                                                 
         MVI   PRICNCOD-1,MXTRTQ                                                
         MVI   PRICNOF2-1,MXTRTQ                                                
         MVI   PRICNDRD-1,MXTRTQ                                                
         MVI   PRICNAOF-1,MXTRTQ                                                
         MVI   PRICNAAG-1,MXTRTQ                                                
         MVI   PRICNPRO-1,MXTRTQ                                                
         MVI   PRICPU1R-1,MXTRTQ                                                
         MVI   PRICPU1T-1,MXTRTQ                                                
         MVI   PRICPU1L-1,MXTRTQ                                                
         MVI   PRICPU2R-1,MXTRTQ                                                
         MVI   PRICPU2T-1,MXTRTQ                                                
         MVI   PRICPU2L-1,MXTRTQ                                                
         MVI   PRICEU1R-1,MXTRTQ                                                
         MVI   PRICEU1T-1,MXTRTQ                                                
         MVI   PRICEU1L-1,MXTRTQ                                                
         MVI   PRICEU2R-1,MXTRTQ                                                
         MVI   PRICEU2T-1,MXTRTQ                                                
         MVI   PRICEU2L-1,MXTRTQ                                                
         MVI   PRICCEXN-1,MXTRTQ                                                
         MVI   PRICDIVI-1,MXTRTQ                                                
         MVI   PRICBDCO-1,MXTRTQ                                                
         MVI   PRICBDBD-1,MXTRTQ                                                
         MVI   PRICBDDA-1,MXTRTQ                                                
         MVI   PRICNNAD-1,MXTRTQ                                                
         MVI   PRICCLTY-1,MXTRTQ                                                
         MVI   PRICMASC-1,MXTRTQ                                                
         MVI   PRICPEBF-1,MXTRTQ                                                
         MVI   PRICSREP-1,MXTRTQ                                                
         MVI   PRICFROP-1,MXTRTQ                                                
         MVI   PRICCOS2-1,MXTRTQ                                                
         MVI   PRICUCBC-1,MXTRTQ                                                
*                                                                               
         MVC   PRICNAGY,PCLTKAGY   AGENCY                                       
         TR    PRICNAGY,MXTRT                                                   
         MVC   PRICNMED,PCLTKMED   MEDIA                                        
         TR    PRICNMED,MXTRT                                                   
         MVC   PRICNCNT,PCLTKCLT   CLIENT                                       
         TR    PRICNCNT,MXTRT                                                   
*                                                                               
         LA    R6,PCLTRECD                                                      
         MVI   ELCODE,X'02'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PCLT0010                                                         
*                                                                               
         USING PCLTELEM,R6                                                      
         MVC   PRICNAOF,PCLTAOFC   ACC OFFICE CODE                              
         TR    PRICNAOF,MXTRT                                                   
         MVC   PRICNAAG,PCLTACCA   ACC OFFICE AGENCY                            
         TR    PRICNAAG,MXTRT                                                   
         MVC   PRICNPRO,PCLTPROF   CLIENT PROFILE                               
         TR    PRICNPRO,MXTRT                                                   
*                                                                               
         MVC   PRICDIVI,PCLTPROF+00                                             
         TR    PRICDIVI,MXTRT                                                   
         MVC   PRICBDCO,PCLTPROF+01                                             
         TR    PRICBDCO,MXTRT                                                   
         MVC   PRICBDBD,PCLTPROF+02                                             
         TR    PRICBDBD,MXTRT                                                   
         MVC   PRICBDDA,PCLTPROF+03                                             
         TR    PRICBDDA,MXTRT                                                   
         MVC   PRICNNAD,PCLTPROF+04                                             
         TR    PRICNNAD,MXTRT                                                   
         MVC   PRICCLTY,PCLTPROF+05                                             
         CLC   =C'000',PCLTPROF+06                                              
         JE    *+10                                                             
         MVC   PRICMASC,PCLTPROF+06                                             
         TR    PRICMASC,MXTRT                                                   
         MVC   PRICPEBF,PCLTPROF+10                                             
         TR    PRICPEBF,MXTRT                                                   
*                                                                               
         MVI   PRICUCBC,C'N'                                                    
         TM    PCLTSTAT,X'80'      HAVE EST UCOMM BILLING CONTROL?              
         JZ    *+8                                                              
         MVI   PRICUCBC,C'Y'                                                    
         TR    PRICUCBC,MXTRT                                                   
*                                                                               
         TM    PCLTSTAT,X'02'      FROZEN?                                      
         JZ    *+10                                                             
         MVC   PRICFROP,=C'FRZ'                                                 
*                                                                               
         TM    PCLTSTAT,X'04'      COS2 $?                                      
         JZ    *+8                                                              
         MVI   PRICCOS2,C'Y'                                                    
*                                                                               
         MVC   PRICNNME,PCLTNAME   NAME                                         
*                                                                               
         XC    WORK,WORK                                                        
OFFD     USING OFFICED,WORK        2-CHR OFFICE LOGIC                           
         MVI   OFFD.OFCSYS,C'P'                                                 
         MVC   OFFD.OFCAGY,PCLTKAGY                                             
         MVC   OFFD.OFCPMED,PCLTKMED                                            
         MVC   OFFD.OFCOFC,PCLTOFF                                              
*                                                                               
         GOTOR OFFICER,DMCB,(C'2',WORK),(0,COMFACS)                             
         CLI   0(R1),0                                                          
         BNE   PCLT0001                                                         
*                                                                               
         MVC   PRICNOFF,OFFD.OFCOFC2 POPULATE 1-CHAR OFFICE FIELD               
         MVC   PRICNOF2,OFFD.OFCOFC2 POPULATE 2-CHAR OFFICE FIELD               
*                                                                               
         TM    OFFD.OFCINDS,OFCINOLA                                            
         BO    PCLT0001            2-CHAR OFFICES *NOT* USED                    
*                                                                               
* AGENCY USES 2-CHAR OFFICES HERE                                               
*                                                                               
         CLI   PRICNOF2+1,C' '       ONLY 1 CHAR OUT OF 2 IS USED?              
         BE    *+8                   YES, LEAVE THE VALUE IN PRICNOFF           
         MVI   PRICNOFF,C' ' NO = TRUE 2-BYTE OFFICE, CLEAR PRICNOFF            
*                                                                               
         DROP  OFFD                                                             
*                                                                               
PCLT0001 DS    0H                                                               
         MVC   PRICNTAX,PCLTGST    TAX                                          
         MVC   PRICNBLL,PCLTBLGP   BILL GROUP                                   
         MVC   PRICNISF,PCLTFIN    FINANCIAL CLIENT                             
*                                                                               
         CLI   PCLTNUM,X'FF'       CHECK IF FIRST BYTE IS 'FF'                  
         JNE   PCLT0002            IF YES THEN NEXT TWO BYTES                   
*                                  ARE PACKED DEC WITHOUT SIGN                  
         UNPK  WORK(5),PCLTNUM+1(3)                                             
         MVC   PRICNCOD(4),WORK                                                 
         J     PCLT0010                                                         
*                                                                               
PCLT0002 DS    0H                                                               
         MVC   BYTE,PCLTNUM                                                     
         NI    BYTE,X'F0'          SET OFF LOWER HALF BYTE BITS                 
         CLI   BYTE,X'80'          ONLY X'80' WILL BE LEFT ON                   
         JNE   PCLT0004            IN THIS FORMAT                               
         XC    FULL,FULL                                                        
         MVC   FULL+1(3),PCLTNUM                                                
         NI    FULL+1,X'7F'        SET OFF X'80' IN FULL                        
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PRICNCOD(5),DUB                                                  
         J     PCLT0010                                                         
*                                                                               
PCLT0004 DS    0H                                                               
         MVC   PRICNCOD(3),PCLTNUM                                              
         DROP  R6                                                               
*                                                                               
PCLT0010 DS    0H                                                               
         TR    PRICNNME,MXTRT                                                   
         TR    PRICNOFF,MXTRT                                                   
         TR    PRICNTAX,MXTRT                                                   
         TR    PRICNBLL,MXTRT                                                   
         TR    PRICNISF,MXTRT                                                   
         TR    PRICNCOD,MXTRT                                                   
         TR    PRICNOF2,MXTRT                                                   
*                                                                               
         LA    R6,PCLTRECD                                                      
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PCLT0020                                                         
*                                                                               
         USING PCLTUDEF,R6                                                      
         MVC   PRICNPU1,PCLTPU1    PRD USER FIELD 1 - NAME                      
         MVC   PRICPU1T,PCLTP1TY   PRD USER FIELD 1 - DATA TYPE                 
         TM    PCLTP1F1,X'80'      REQUIRED?                                    
         JZ    *+8                                                              
         MVI   PRICPU1R,C'Y'       PRD USER FIELD 1 - REQUIRED                  
         EDIT  PCLTP1LN,PRICPU1L,FILL=0                                         
         MVC   PRICNPU2,PCLTPU2    PRD USER FIELD 2 - NAME                      
         MVC   PRICPU2T,PCLTP2TY   PRD USER FIELD 2 - DATA TYPE                 
         TM    PCLTP2F1,X'80'      REQUIRED?                                    
         JZ    *+8                                                              
         MVI   PRICPU2R,C'Y'       PRD USER FIELD 2 - REQUIRED                  
         EDIT  PCLTP2LN,PRICPU2L,FILL=0                                         
         MVC   PRICNEU1,PCLTEU1    EST USER FIELD 1 - NAME                      
         MVC   PRICEU1T,PCLTE1TY   PRD USER FIELD 1 - DATA TYPE                 
         TM    PCLTE1F1,X'80'      REQUIRED?                                    
         JZ    *+8                                                              
         MVI   PRICEU1R,C'Y'       PRD USER FIELD 1 - REQUIRED                  
         EDIT  PCLTE1LN,PRICEU1L,FILL=0                                         
         MVC   PRICNEU2,PCLTEU2    EST USER FIELD 2 - NAME                      
         MVC   PRICEU2T,PCLTE2TY   PRD USER FIELD 2 - DATA TYPE                 
         TM    PCLTE2F1,X'80'      REQUIRED?                                    
         JZ    *+8                                                              
         MVI   PRICEU2R,C'Y'       PRD USER FIELD 2 - REQUIRED                  
         EDIT  PCLTE2LN,PRICEU2L,FILL=0                                         
         DROP  R6                                                               
*                                                                               
PCLT0020 DS    0H                                                               
         TR    PRICNPU1,MXTRT                                                   
         TR    PRICPU1R,MXTRT                                                   
         TR    PRICPU1T,MXTRT                                                   
         TR    PRICPU1L,MXTRT                                                   
         TR    PRICNPU2,MXTRT                                                   
         TR    PRICPU2R,MXTRT                                                   
         TR    PRICPU2T,MXTRT                                                   
         TR    PRICPU2L,MXTRT                                                   
         TR    PRICNEU1,MXTRT                                                   
         TR    PRICEU1R,MXTRT                                                   
         TR    PRICEU1T,MXTRT                                                   
         TR    PRICEU1L,MXTRT                                                   
         TR    PRICNEU2,MXTRT                                                   
         TR    PRICEU2R,MXTRT                                                   
         TR    PRICEU2T,MXTRT                                                   
         TR    PRICEU2L,MXTRT                                                   
*                                                                               
         LA    R6,PCLTRECD                                                      
         USING PCLTXEL,R6                                                       
         MVI   ELCODE,PCLTXLQ      EXTENDED CLIENT NAME ELEMENT CODE            
         BRAS  RE,GETEL                                                         
         JNE   *+10                                                             
         MVC   PRICCEXN,PCLTXNME                                                
         TR    PRICCEXN,MXTRT                                                   
         DROP  R6                                                               
*                                                                               
         LA    R6,PCLTRECD                                                      
         USING PCLREPEL,R6                                                      
         MVI   ELCODE,PCLREPEQ     SPECIAL REP ELEMENT CODE                     
         BRAS  RE,GETEL                                                         
         JNE   *+10                                                             
         MVC   PRICSREP,PCLREPCD                                                
         TR    PRICSREP,MXTRT                                                   
         DROP  R6                                                               
*                                                                               
         LA    R6,PCLTRECD                                                      
         USING PCLTFEL,R6                                                       
         MVI   ELCODE,X'47'        FREEZE STATUS ELEMENT CODE                   
         BRAS  RE,GETEL                                                         
         JNE   PCLT0022                                                         
         MVI   BYTE,C' '                                                        
         MVC   WORK(L'PCLTFDTE),PCLTFDTE                                        
         MVI   WORK+2,X'01'        DAY                                          
         TM    PCLTFIND,X'08'      + INDICATED?                                 
         JZ    *+8                 NO                                           
         MVI   BYTE,C'+'                                                        
         TM    PCLTFIND,X'04'      - INDICATED?                                 
         JZ    *+8                 NO                                           
         MVI   BYTE,C'-'                                                        
         GOTO1 DATCON,PLIST,(3,WORK),(6,PRICFROP)                               
         CLI   BYTE,C' '           ANYTHING IN BYTE?                            
         JNH   *+10                NO                                           
         MVC   PRICFROP+6(1),BYTE                                               
         DROP  R6                                                               
*                                                                               
PCLT0022 DS    0H                                                               
         TR    PRICFROP,MXTRT                                                   
*                                                                               
         LA    R6,PCLTRECD                                                      
         USING PCLTCFEL,R6                                                      
         MVI   ELCODE,X'45'        COST2 FACTOR ELEMENT CODE                    
         BRAS  RE,GETEL                                                         
         JNE   PCLT0024                                                         
         CP    PCLTCF,=P'0'        ZERO?                                        
         JNE   *+14                                                             
         MVC   PRICCOS2(03),=C'0.0'                                             
         J     PCLT0024                                                         
         EDIT  (P5,PCLTCF),(8,PRICCOS2),6,ALIGN=LEFT,FILL=0                     
         DROP  R6                                                               
*                                                                               
PCLT0024 DS    0H                                                               
         TR    PRICCOS2,MXTRT                                                   
*                                                                               
         LA    R6,PCLTRECD                                                      
         MVI   ELCODE,X'41'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PCLT0030                                                         
*                                                                               
         USING PCLTMEL,R6                                                       
*                                                                               
         MVC   PRICNMN(L'PCLTMNAM),PCLTMNAM    NAME                             
         J     PCLT0040                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
PCLT0030 DS    0H                                                               
         MVC   PRICNMN(11),2(R8)                                                
*                                                                               
PCLT0040 DS    0H                                                               
         TR    PRICNMN,MXTRT                                                    
*                                                                               
         LA    R6,PCLTRECD                                                      
         MVI   ELCODE,X'30'        DRD CLIENT ELEMENT                           
         BRAS  RE,GETEL                                                         
         JNE   PCLT0050                                                         
*                                                                               
         MVC   PRICNDRD,2(R6)      DRD CLIENT CODE                              
*                                                                               
PCLT0050 DS    0H                                                               
         TR    PRICNDRD,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRICNLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIDIV - EXTRACT DIVISION RECORD                                              
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIDIV   NMOD1 WORKL,*PRIDIV*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIDVLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIDVD,R2           R2=A(EXTRACT RECORD)                         
         USING PDIVRECD,R3         R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRIDVLEN,PRIDVLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIDVLEN(2),=AL2(PRIDVDL)                                        
         MVC   PRIDVTYP,PRDVQ                                                   
         MVI   PRIDVDX,MXTRTQ                                                   
         MVI   PRIDVDX+1,MXTRTQ                                                 
         MVI   PRIDVAGY-1,MXTRTQ                                                
         MVI   PRIDVMED-1,MXTRTQ                                                
         MVI   PRIDVCNT-1,MXTRTQ                                                
         MVI   PRIDVDIV-1,MXTRTQ                                                
         MVI   PRIDVNME-1,MXTRTQ                                                
*                                                                               
         MVC   PRIDVAGY,PDIVKAGY   AGENCY                                       
         TR    PRIDVAGY,MXTRT                                                   
         MVC   PRIDVMED,PDIVKMED   MEDIA                                        
         TR    PRIDVMED,MXTRT                                                   
         MVC   PRIDVCNT,PDIVKCLT   CLIENT                                       
         TR    PRIDVCNT,MXTRT                                                   
         MVC   PRIDVDIV,PDIVKDIV   DIVISION                                     
         TR    PRIDVDIV,MXTRT                                                   
*                                                                               
         LA    R6,PDIVRECD                                                      
         MVI   ELCODE,X'03'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PDIV0010                                                         
*                                                                               
         USING PDIVELEM,R6                                                      
         MVC   PRIDVNME,PDIVNAME   NAME                                         
         DROP  R6                                                               
*                                                                               
PDIV0010 DS    0H                                                               
         TR    PRIDVNME,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIDVLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIPRD - EXTRACT PRODUCT RECORD                                               
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIPRD   NMOD1 WORKL,*PRIPRD*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIPDLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIPDD,R2           R2=A(EXTRACT RECORD)                         
         USING PPRDRECD,R3         R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRIPDLEN,PRIPDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIPDLEN(2),=AL2(PRIPDDL)                                        
         MVC   PRIPDTYP,PRPDQ                                                   
         MVI   PRIPDDX,MXTRTQ                                                   
         MVI   PRIPDDX+1,MXTRTQ                                                 
         MVI   PRIPDAGY-1,MXTRTQ                                                
         MVI   PRIPDMED-1,MXTRTQ                                                
         MVI   PRIPDCNT-1,MXTRTQ                                                
         MVI   PRIPDPRD-1,MXTRTQ                                                
         MVI   PRIPDNME-1,MXTRTQ                                                
         MVI   PRIPDDIV-1,MXTRTQ                                                
*        MVI   PRIPDINF-1,MXTRTQ                                                
         MVI   PRIPDOFF-1,MXTRTQ      NEW ONE                                   
         MVI   PRIPDACN-1,MXTRTQ                                                
         MVI   PRIPDTAX-1,MXTRTQ                                                
         MVI   PRIPDUV1-1,MXTRTQ                                                
         MVI   PRIPDUV2-1,MXTRTQ                                                
         MVI   PRIPDBFM-1,MXTRTQ                                                
         MVI   PRIPBRN1-1,MXTRTQ                                                
         MVI   PRIPBRN2-1,MXTRTQ                                                
         MVI   PRIPLIN1-1,MXTRTQ                                                
         MVI   PRIPLIN2-1,MXTRTQ                                                
*                                                                               
         MVC   PRIPDAGY,PPRDKAGY   AGENCY                                       
         TR    PRIPDAGY,MXTRT                                                   
         MVC   PRIPDMED,PPRDKMED   MEDIA                                        
         TR    PRIPDMED,MXTRT                                                   
         MVC   PRIPDCNT,PPRDKCLT   CLIENT                                       
         TR    PRIPDCNT,MXTRT                                                   
         MVC   PRIPDPRD,PPRDKPRD   PRODUCT                                      
         TR    PRIPDPRD,MXTRT                                                   
*                                                                               
         LA    R6,PPRDRECD                                                      
         MVI   ELCODE,X'06'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PPRD0010                                                         
*                                                                               
         USING PPRDELEM,R6                                                      
         OC    PPRDOFFC,PPRDOFFC          OFFICE CODE ONE BYTE                  
         JZ    PPRD0005                                                         
         CLI   PPRDOFFC+1,X'00'           CHECK IF SPARE BYTE IS USED           
         JE    PPRD0004                                                         
         MVC   PRIPDOFF+1(1),PPRDOFFC+1   IF USED OUTPUT IT IN SECOND           
PPRD0004 DS    0H                         BYTE OF PRIPDOFF                      
         MVC   PRIPDOFF(1),PPRDOFFC                                             
PPRD0005 DS    0H                                                               
         MVC   PRIPDNME,PPRDNAME   NAME                                         
         MVC   PRIPDDIV,PPRDDIV    DIVISION                                     
         MVC   PRIPDTAX,PPRDGST    TAX                                          
         MVC   PRIPBRN1,PPRDBILL   BILL RECEIPT NAME 1                          
         MVC   PRIPBRN2,PPRDBIL2   BILL RECEIPT NAME 2                          
         MVC   PRIPLIN1,PPRDLIN1   ADDRESS - LINE 1                             
         MVC   PRIPLIN2,PPRDLIN2   ADDRESS - LINE 2                             
*                                                                               
         OC    PPRDACCT,PPRDACCT                                                
         JZ    PPRD0008                                                         
         CLI   PPRDACCT,X'FF'               ACCOUNT # CAN BE CHAR(4)            
         JNE   PPRD0001                     OR IF FIRST BYTE IS 'FF'            
         SR    R5,R5                        NEXT THREE BYTE IS A BINARY         
         ICM   R5,7,PPRDACCT+1                                                  
         EDIT  (R5),PRIPDACN,FILL=0                                             
         J     PPRD0008                                                         
PPRD0001 DS    0H                                                               
         MVC   PRIPDACN+4(4),PPRDACCT                                           
*                                                                               
PPRD0008 DS    0H                                                               
         GOTO1 =A(DISBFM),DMCB,PPRDBILP,PRIPDBFM                                
         CLC   PRIPDBFM,SPACES     NO BILL FORMULA?                             
         BH    *+14                                                             
         L     RF,APTXPARM                                                      
         MVC   PRIPDBFM,SVAAABFM-PTXPARM(RF)                                    
*                                                                               
         TR    PRIPDBFM,MXTRT                                                   
*                                                                               
         DROP  R6                                                               
*                                                                               
PPRD0010 DS    0H                                                               
         TR    PRIPDNME,MXTRT                                                   
         TR    PRIPDDIV,MXTRT                                                   
         TR    PRIPDOFF,MXTRT                                                   
         TR    PRIPDACN,MXTRT                                                   
         TR    PRIPDTAX,MXTRT                                                   
         TR    PRIPBRN1,MXTRT                                                   
         TR    PRIPBRN2,MXTRT                                                   
         TR    PRIPLIN1,MXTRT                                                   
         TR    PRIPLIN2,MXTRT                                                   
*                                                                               
         LA    R6,PPRDRECD                                                      
         MVI   ELCODE,X'30'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PPRD0015                                                         
*                                                                               
         USING PPRDICEL,R6                                                      
         MVC   PRIPDINF(L'PPRDINFC),PPRDINFC   INTERFACE CODE                   
         DROP  R6                                                               
*                                                                               
PPRD0015 DS    0H                                                               
         TR    PRIPDINF,MXTRT                                                   
*                                                                               
         LA    R6,PPRDRECD                                                      
         MVI   ELCODE,X'08'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PPRD0020                                                         
*                                                                               
         USING PPRDUDEF,R6                                                      
         MVC   PRIPDUV1,PUSER1     USER1                                        
         MVC   PRIPDUV2,PUSER2     USER2                                        
         DROP  R6                                                               
*                                                                               
PPRD0020 DS    0H                                                               
         TR    PRIPDUV1,MXTRT                                                   
         TR    PRIPDUV2,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIPDLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
*                                                                               
*                                                                               
*                                                                               
***********************************************************************         
* PRIJOB - EXTRACT JOB RECORD                                                   
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIJOB   NMOD1 WORKL,*PRIJOB*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIJBLIT                                                      
         USING LITERAL,RA                                                       
         L     R8,16(R1)                                                        
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIJBD,R2           R2=A(EXTRACT RECORD)                         
         USING PJOBRECD,R3         R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRIJBLEN,PRIJBLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIJBLEN(2),=AL2(PRIJBDL)                                        
         MVC   PRIJBTYP,PRJBQ                                                   
         MVI   PRIJBDX,MXTRTQ                                                   
         MVI   PRIJBDX+1,MXTRTQ                                                 
         MVI   PRIJBAGY-1,MXTRTQ                                                
         MVI   PRIJBMED-1,MXTRTQ                                                
         MVI   PRIJBCNT-1,MXTRTQ                                                
         MVI   PRIJBPRD-1,MXTRTQ                                                
         MVI   PRIJBJOB-1,MXTRTQ                                                
         MVI   PRIJBCP1-1,MXTRTQ                                                
         MVI   PRIJBCP2-1,MXTRTQ                                                
         MVI   PRIJBCPN-1,MXTRTQ                                                
         MVI   PRIJBSPC-1,MXTRTQ                                                
         MVI   PRIJBCOD-1,MXTRTQ                                                
         MVI   PRIJBFLT-1,MXTRTQ                                                
         MVI   PRIJBSTR-1,MXTRTQ                                                
         MVI   PRIJBEND-1,MXTRTQ                                                
         MVI   PRIJBAID-1,MXTRTQ                                                
*                                                                               
         MVC   PRIJBAGY,PJOBKAGY   AGENCY                                       
         TR    PRIJBAGY,MXTRT                                                   
         MVC   PRIJBMED,PJOBKMED   MEDIA                                        
         TR    PRIJBMED,MXTRT                                                   
         MVC   PRIJBCNT,PJOBKCLT   CLIENT                                       
         TR    PRIJBCNT,MXTRT                                                   
         MVC   PRIJBPRD,PJOBKPRD   PRODUCT                                      
         TR    PRIJBPRD,MXTRT                                                   
         MVC   PRIJBJOB,PJOBKJOB   JOB                                          
*                                                                               
         CLI   PJOBKJOB,X'FF'      "AD-ID ALONE" ?                              
         BNE   *+10                NO                                           
         MVC   PRIJBJOB,SPACES     BLANK JOB CODE. AD-ID WILL                   
*                                    BE SET BELOW                               
         TR    PRIJBJOB,MXTRT                                                   
*                                                                               
         LA    R6,PJOBRECD                                                      
         MVI   ELCODE,X'15'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PJOB0090                                                         
*                                                                               
         USING PJOBELEM,R6                                                      
         MVC   PRIJBCP1,PJOBCAP1   CAPTION1                                     
         MVC   PRIJBCP2,PJOBCAP2   CAPTION2                                     
         MVC   PRIJBCPN,PJOBCPY    COPY NUMBER                                  
         MVC   PRIJBSPC,PJOBSPC    SPACE DESCRIPTION                            
         MVC   PRIJBCOD,PJOBPRM    PREMIUM CODE                                 
         MVC   PRIJBFLT,PJOBFILT   FILTER                                       
         MVC   PRIJBAID,SPACES                                                  
         CLI   PJOBADID,X'40'      ANYTHING IN AD-ID ?                          
         BNH   *+10                NO                                           
         MVC   PRIJBAID,PJOBADID   AD-ID                                        
         CLI   PJOBSTA,X'40'                                                    
         BNH   PJOB0040                                                         
         GOTO1 DATCON,PLIST,(3,PJOBSTA),(10,PRIJBSTR)                           
PJOB0040 CLI   PJOBEND,X'40'                                                    
         BNH   PJOB0090                                                         
         GOTO1 DATCON,PLIST,(3,PJOBEND),(10,PRIJBEND)                           
*                                                                               
*                                                                               
         DROP  R6                                                               
*                                                                               
PJOB0090 DS    0H                                                               
         TR    PRIJBCP1,MXTRT                                                   
         TR    PRIJBCP2,MXTRT                                                   
         TR    PRIJBCPN,MXTRT                                                   
         TR    PRIJBSPC,MXTRT                                                   
         TR    PRIJBCOD,MXTRT                                                   
         TR    PRIJBFLT,MXTRT                                                   
         TR    PRIJBAID,MXTRT                                                   
         TR    PRIJBSTR,MXTRT                                                   
         TR    PRIJBEND,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIJBLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
*                                                                               
***********************************************************************         
* PRIEST - EXTRACT ESTIMATE                                                     
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIEST   NMOD1 WORKL,*PRIEST*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIESLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIESD,R2           R2=A(EXTRACT RECORD)                         
         USING PESTRECD,R3         R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRIESLEN,PRIESLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIESLEN(2),=AL2(PRIESDL)                                        
         MVC   PRIESTYP,PRESQ                                                   
         MVI   PRIESDX,MXTRTQ                                                   
         MVI   PRIESDX+1,MXTRTQ                                                 
         MVI   PRIESAGY-1,MXTRTQ                                                
         MVI   PRIESMED-1,MXTRTQ                                                
         MVI   PRIESCNT-1,MXTRTQ                                                
         MVI   PRIESPRD-1,MXTRTQ                                                
         MVI   PRIESEST-1,MXTRTQ                                                
         MVI   PRIESNM1-1,MXTRTQ                                                
         MVI   PRIESNM2-1,MXTRTQ                                                
         MVI   PRIESSRT-1,MXTRTQ                                                
         MVI   PRIESEND-1,MXTRTQ                                                
         MVI   PRIESREV-1,MXTRTQ                                                
         MVI   PRIESIST-1,MXTRTQ                                                
         MVI   PRIESUV1-1,MXTRTQ                                                
         MVI   PRIESUV2-1,MXTRTQ                                                
         MVI   PRIESFLT-1,MXTRTQ                                                
         MVI   PRIESAZD-1,MXTRTQ                                                
         MVI   PRIESBFM-1,MXTRTQ                                                
         MVI   PRIEBDCO-1,MXTRTQ                                                
         MVI   PRIEBDBD-1,MXTRTQ                                                
         MVI   PRIEBDDA-1,MXTRTQ                                                
         MVI   PRIENNAD-1,MXTRTQ                                                
         MVI   PRIEZZZX-1,MXTRTQ                                                
         MVI   PRIECOS2-1,MXTRTQ                                                
*                                                                               
         MVC   PRIESAGY,PESTKAGY   AGENCY                                       
         TR    PRIESAGY,MXTRT                                                   
         MVC   PRIESMED,PESTKMED   MEDIA                                        
         TR    PRIESMED,MXTRT                                                   
         MVC   PRIESCNT,PESTKCLT   CLIENT                                       
         TR    PRIESCNT,MXTRT                                                   
         MVC   PRIESPRD,PESTKPRD   PRODUCT                                      
         TR    PRIESPRD,MXTRT                                                   
         EDIT  PESTKEST,PRIESEST,FILL=0     ESTIMATE                            
         TR    PRIESEST,MXTRT                                                   
*                                                                               
         LA    R6,PESTRECD                                                      
         MVI   ELCODE,X'07'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PEST0010                                                         
*                                                                               
         USING PESTELEM,R6                                                      
         MVC   PRIESNM1,PESTNAME   NAME 1                                       
         MVC   PRIESNM2,PESTNAM2   NAME 2                                       
         GOTO1 DATCON,PLIST,(0,PESTST),(10,PRIESSRT)                            
         GOTO1 DATCON,PLIST,(0,PESTEND),(10,PRIESEND)                           
         MVC   PRIESREV,PESTREVN   REVISION                                     
         MVC   PRIESFLT,PESTGRPS   FILTERS                                      
*                                                                               
         MVC   PRIEBDCO,PESTPROF+1 BILLABLE DATE CALCULATION OVERRIDE           
         MVC   PRIEBDBD,PESTPROF+2 BILL DATE/BASE DATE                          
         MVC   PRIEBDDA,PESTPROF+3 BILL DATE/DATE ADJUSTMENT                    
         MVC   PRIENNAD,PESTPROF+4 NON NEWSPAPER ADJUSTMENT                     
*                                                                               
         OC    PESTCF,PESTCF       HAVE COS2 FACTOR?                            
         JZ    PEST0003                                                         
         CP    PESTCF,=P'0'        ZERO?                                        
         JNE   *+14                                                             
         MVC   PRIECOS2(03),=C'0.0'                                             
         J     PEST0003                                                         
         EDIT  (P5,PESTCF),(8,PRIECOS2),6,ALIGN=LEFT,FILL=0                     
*                                                                               
PEST0003 MVI   PRIESIST,C'S'                                                    
         TM    PESTTEST,X'40'      STEWARDSHIP ?                                
         JO    PEST0005            YES                                          
         MVI   PRIESIST,C'Y'                                                    
         TM    PESTTEST,X'80'      TEST ?                                       
         JO    PEST0005            YES                                          
         MVI   PRIESIST,C'N'       LIVE ESTIMATE                                
         DROP  R6                                                               
*                                                                               
PEST0005 DS    0H                                                               
         GOTO1 =A(DISBFM),DMCB,PESTBILP,PRIESBFM                                
         CLC   PRIESBFM,SPACES     NO BILL FORMULA?                             
         BH    *+14                                                             
         L     RF,APTXPARM                                                      
         MVC   PRIESBFM,SVPRDBFM-PTXPARM(RF)                                    
         TR    PRIESBFM,MXTRT                                                   
*                                                                               
PEST0010 DS    0H                                                               
         TR    PRIESNM1,MXTRT                                                   
         TR    PRIESNM2,MXTRT                                                   
         TR    PRIESSRT,MXTRT                                                   
         TR    PRIESEND,MXTRT                                                   
         TR    PRIESREV,MXTRT                                                   
         TR    PRIESIST,MXTRT                                                   
         TR    PRIESFLT,MXTRT                                                   
         TR    PRIEBDCO,MXTRT                                                   
         TR    PRIEBDBD,MXTRT                                                   
         TR    PRIEBDDA,MXTRT                                                   
         TR    PRIENNAD,MXTRT                                                   
         TR    PRIECOS2,MXTRT                                                   
*                                                                               
         LA    R6,PESTRECD                                                      
         MVI   ELCODE,X'08'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PEST0020                                                         
*                                                                               
         USING PESTUDEF,R6                                                      
         MVC   PRIESUV1,PEUSER1   USER 1                                        
         MVC   PRIESUV2,PEUSER2   USER 2                                        
         DROP  R6                                                               
*                                                                               
PEST0020 DS    0H                                                               
         TR    PRIESUV1,MXTRT                                                   
         TR    PRIESUV2,MXTRT                                                   
*                                                                               
         LA    R6,PESTRECD                                                      
         MVI   ELCODE,PEACTECQ     X'46' ELEM CODE                              
         BRAS  RE,GETEL                                                         
         JNE   PEST0030                                                         
*                                                                               
         USING PESTACTD,R6         ESTIMATE ACTUALIZATION ELEMENT               
         OC    PEACTDAT,PEACTDAT   HAVE DATE ?                                  
         JZ    PEST0030            NO                                           
         MVC   WORK(2),PEACTDAT    DATE IS YM ONLY                              
         MVI   WORK+2,1                                                         
         GOTOR DATCON,PLIST,(3,WORK),(10,PRIESAZD)                              
         DROP  R6                                                               
*                                                                               
PEST0030 DS    0H                                                               
         TR    PRIESAZD,MXTRT                                                   
*                                                                               
         LA    R6,PESTRECD                                                      
         USING PESTALLX,R6                                                      
         MVI   ELCODE,PEALLECQ     ALLOCATION EXTENSION ELEMENT CODE            
         BRAS  RE,GETEL                                                         
         JNE   *+10                                                             
         MVC   PRIEZZZX,PEALLZZZ                                                
         TR    PRIEZZZX,MXTRT                                                   
         DROP  R6                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIESLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIPUB - PUB                                                                  
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIPUB   NMOD1 WORKL,*PRIPUB*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIPBLIT                                                      
         USING LITERAL,RA                                                       
         L     R8,16(R1)                                                        
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIPBD,R2           R2=A(EXTRACT RECORD)                         
         USING PUBRECD,R3          R3=A(REPFILE RECORD)                         
*                                                                               
         XC    PRIPBLEN,PRIPBLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIPBLEN(2),=AL2(PRIPBDL)                                        
         MVC   PRIPBTYP,PRPBQ                                                   
         MVI   PRIPBDX,MXTRTQ                                                   
         MVI   PRIPBDX+1,MXTRTQ                                                 
         MVI   PRIPBAGY-1,MXTRTQ                                                
         MVI   PRIPBMED-1,MXTRTQ                                                
         MVI   PRIPBPUN-1,MXTRTQ                                                
         MVI   PRIPBPUZ-1,MXTRTQ                                                
         MVI   PRIPBPUE-1,MXTRTQ                                                
         MVI   PRIPBPUD-1,MXTRTQ                                                
         MVI   PRIPBNME-1,MXTRTQ                                                
         MVI   PRIPBZNM-1,MXTRTQ                                                
         MVI   PRIPBCTY-1,MXTRTQ                                                
         MVI   PRIPBSTT-1,MXTRTQ                                                
         MVI   PRIPBPSH-1,MXTRTQ                                                
         MVI   PRIPBLNG-1,MXTRTQ                                                
         MVI   PRIPBFRE-1,MXTRTQ                                                
         MVI   PRIPBCED-1,MXTRTQ                                                
         MVI   PRIPBSOU-1,MXTRTQ                                                
         MVI   PRIPBCIR-1,MXTRTQ                                                
         MVI   PRIPBAD1-1,MXTRTQ                                                
         MVI   PRIPBAD2-1,MXTRTQ                                                
         MVI   PRIPBZIP-1,MXTRTQ                                                
         MVI   PRIPBKDT-1,MXTRTQ                                                
         MVI   PRIPBLOK-1,MXTRTQ                                                
         MVI   PRIPBZLK-1,MXTRTQ                                                
         MVI   PRIPBPRP-1,MXTRTQ                                                
         MVI   PRIPBNSC-1,MXTRTQ                                                
*                                                                               
         MVC   PRIPBAGY,PUBKAGY    AGENCY                                       
         TR    PRIPBAGY,MXTRT                                                   
         MVC   PRIPBMED,PUBKMED    MEDIA                                        
         TR    PRIPBMED,MXTRT                                                   
*                                                                               
         XC    CHAR15,CHAR15                                                    
         MVC   CHAR6,PUBKPUB                                                    
         MVI   PRIMDPUB,X'08'                                                   
         GOTO1 =V(PUBEDIT),DMCB,(PRIMDPUB,CHAR6),(C'S',CHAR15)                  
*                                                                               
         MVC   PRIPBPUN,CHAR8      PUB NUMBER                                   
         TR    PRIPBPUN,MXTRT                                                   
*                                                                               
         CLI   CHAR6+4,0           ANY ZONE ?                                   
         BNH   PUBNUME             NO                                           
         MVC   PRIPBPUZ,CHAR2      ZONE                                         
         MVC   PRIPBPUE,CHAR3      EDITION - MAY BE NULLS                       
         B     PUBNUMX             FINISH PUB NUMBER WORK                       
PUBNUME  DS    0H                                                               
         MVC   PRIPBPUE,CHAR2      EDITION - MAY BE NULLS                       
PUBNUMX  DS    0H                                                               
         MVC   PRIPBPUD,CHAR15     PUB DISPLAY                                  
         TR    PRIPBPUD,MXTRT                                                   
         TR    PRIPBPUZ,MXTRT                                                   
         TR    PRIPBPUE,MXTRT                                                   
*                                                                               
         LA    R6,PUBRECD                                                       
         MVI   ELCODE,PUBNAMQ      X'10' PUB NAME AND ADDRESS ELEMENT           
         BRAS  RE,GETEL                                                         
         JNE   PUB00010                                                         
*                                                                               
         USING PUBNAMD,R6                                                       
         MVC   PRIPBNME,PUBNAME    NAME                                         
         MVC   PRIPBZNM,PUBZNAME   ZONE NAME                                    
         MVC   PRIPBAD1,PUBLINE1   ADDRESS (ADDRESS LINE 1)                     
         MVC   PRIPBAD2,PUBLINE2   ADDR LINE 2                                  
         MVC   PRIPBCTY,PUBCITY    CITY                                         
         MVC   PRIPBSTT,PUBSTATE   STATE                                        
         MVC   PRIPBZIP,PUBNWZIP   ZIP                                          
         MVC   PRIPBPSH,PUBPLSH    PUBLISHER                                    
         MVC   PRIPBLNG,PUBLANG    LANGUAGE                                     
         MVC   PRIPBNSC,PUBSTACD   NUMERIC STATE CODE                           
*                                                                               
         MVI   PRIPBLOK,C'Y'       PUB LOCKED                                   
         TM    PUBLOCSW,PUBLCKDQ   IS PUB LOCKED (X'80') ?                      
         BO    *+8                 YES                                          
         MVI   PRIPBLOK,C'N'       PUB NOT LOCKED                               
*                                                                               
         MVI   PRIPBZLK,C'N'                                                    
         TM    PUBLOCSW,PUBZLCKQ   IS PUB ZONE LOCKED (X'40') ?                 
         BZ    *+8                                                              
         MVI   PRIPBZLK,C'Y'                                                    
*                                                                               
         CLI   PUBKILL,0           TEST FOR KILL DATE                           
         BE    PUB00010            NONE                                         
*                                                                               
         GOTO1 DATCON,PLIST,(3,PUBKILL),(10,PRIPBKDT)                           
         DROP  R6                                                               
*                                                                               
PUB00010 DS    0H                                                               
         TR    PRIPBNME,MXTRT                                                   
         TR    PRIPBZNM,MXTRT                                                   
         TR    PRIPBAD1,MXTRT                                                   
         TR    PRIPBAD2,MXTRT                                                   
         TR    PRIPBCTY,MXTRT                                                   
         TR    PRIPBSTT,MXTRT                                                   
         TR    PRIPBZIP,MXTRT                                                   
         TR    PRIPBPSH,MXTRT                                                   
         TR    PRIPBLNG,MXTRT                                                   
         TR    PRIPBKDT,MXTRT                                                   
         TR    PRIPBLOK,MXTRT                                                   
         TR    PRIPBZLK,MXTRT                                                   
         TR    PRIPBNSC,MXTRT                                                   
*                                                                               
         LA    R6,PUBRECD                                                       
         MVI   ELCODE,PUBREPQ      X'14', PUB REP ELEMENT                       
         BRAS  RE,GETEL                                                         
         JNE   PUB00015                                                         
*                                                                               
         USING PUBREPEL,R6                                                      
PUB00012 DS    0H                                                               
         CLI   0(R6),PUBREPQ                                                    
         BNE   PUB00015                                                         
         CLC   PUBRPOFF,=X'FFFFFF'                                              
         BE    PUB00013                                                         
*                                                                               
         BRAS  RE,NEXTEL                                                        
         BE    PUB00012                                                         
         B     PUB00015                                                         
*                                                                               
PUB00013 DS    0H                                                               
         MVC   PRIPBPRP,PUBPAREP                                                
         TR    PRIPBPRP,MXTRT                                                   
         DROP  R6                                                               
*                                                                               
PUB00015 DS    0H                                                               
         LA    R6,PUBRECD                                                       
         MVI   ELCODE,X'30'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PUB00020                                                         
*                                                                               
         USING PUBCIRD,R6                                                       
         EDIT  (P5,PUBCIR1),PRIPBCIR,FILL=0                                     
*        UNPK  PRIPBCIR,PUBCIR1                                                 
         MVC   PRIPBSOU,PUBCSRC                                                 
         CLI   PUBCDAT,X'00'       TEST FOR CIRCULATION EFF DATE                
         BE    PUB00020            NONE                                         
*                                                                               
         CLI   PUBCDAT+2,0         TEST FOR DAY VALUE                           
         BNE   *+8                                                              
         MVI   PUBCDAT+2,1         NONE-SET IT TO ONE                           
*                                                                               
         GOTO1 DATCON,PLIST,(3,PUBCDAT),(10,PRIPBCED)                           
         DROP  R6                                                               
*                                                                               
PUB00020 DS    0H                                                               
         TR    PRIPBCIR,MXTRT                                                   
         TR    PRIPBSOU,MXTRT                                                   
         TR    PRIPBCED,MXTRT                                                   
*                                                                               
         CLI   PRIPBMED,C'N'                                                    
         JE    PUB00030                                                         
*                                                                               
         LA    R6,PUBRECD                                                       
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PUB00030                                                         
*                                                                               
         USING PUBGEND,R6                                                       
         MVC   PRIPBFRE,PUBMFREQ                                                
         DROP  R6                                                               
*                                                                               
PUB00030 DS    0H                                                               
         TR    PRIPBFRE,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIPBLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRICON - EXTRACT CONTRACT RECORD                                              
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRICON   NMOD1 WORKL,*PRICON*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRICTLIT                                                      
         USING LITERAL,RA                                                       
         L     R8,16(R1)                                                        
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRICTD,R2           R2=A(EXTRACT RECORD)                         
         USING PCONRECD,R3         R3=A(PRINT   RECORD)                         
*                                                                               
         XC    PRICTLEN,PRICTLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRICTLEN(2),=AL2(PRICTDL)                                        
         MVC   PRICTTYP,PRCTQ                                                   
         MVI   PRICTDX,MXTRTQ                                                   
         MVI   PRICTDX+1,MXTRTQ                                                 
         MVI   PRICTAGY-1,MXTRTQ                                                
         MVI   PRICTMED-1,MXTRTQ                                                
         MVI   PRICTCNT-1,MXTRTQ                                                
         MVI   PRICTPRD-1,MXTRTQ                                                
         MVI   PRICTPUN-1,MXTRTQ                                                
         MVI   PRICTPUZ-1,MXTRTQ                                                
         MVI   PRICTPUE-1,MXTRTQ                                                
         MVI   PRICTCRT-1,MXTRTQ                                                
         MVI   PRICTSRT-1,MXTRTQ                                                
         MVI   PRICTEND-1,MXTRTQ                                                
         MVI   PRICTREV-1,MXTRTQ                                                
         MVI   PRICTTPE-1,MXTRTQ                                                
         MVI   PRICTLDS-1,MXTRTQ                                                
*                                                                               
         MVC   PRICTAGY,PCONKAGY   AGENCY                                       
         TR    PRICTAGY,MXTRT                                                   
         MVC   PRICTMED,PCONKMED   MEDIA                                        
         TR    PRICTMED,MXTRT                                                   
         MVC   PRICTCNT,PCONKCLT   CLIENT                                       
         TR    PRICTCNT,MXTRT                                                   
*                                                                               
         MVC   CHAR6,PCONKPUB                                                   
         MVI   PRIMDPUB,X'08'                                                   
         GOTO1 =V(PUBEDIT),DMCB,(PRIMDPUB,CHAR6),(C'S',CHAR15)                  
*                                                                               
         MVC   PRICTPUN,CHAR8      PUB NUMBER                                   
         TR    PRICTPUN,MXTRT                                                   
*                                                                               
         CLI   CHAR6+4,0           ANY ZONE ?                                   
         BNH   PUBCONE             NO                                           
         MVC   PRICTPUZ,CHAR2      ZONE                                         
         MVC   PRICTPUE,CHAR3      EDITION - MAY BE NULLS                       
         B     PUBCONX             FINISH PUB NUMBER WORK                       
PUBCONE  DS    0H                                                               
         MVC   PRICTPUE,CHAR2      EDITION - MAY BE NULLS                       
PUBCONX  DS    0H                                                               
         TR    PRICTPUZ,MXTRT                                                   
         TR    PRICTPUE,MXTRT                                                   
*                                                                               
CONEND   EDIT  PCONNUM,PRICTCRT,FILL=0         CONTRACT                         
         TR    PRICTCRT,MXTRT                                                   
*                                                                               
         LA    R6,PCONRECD                                                      
         MVI   ELCODE,X'10'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PCON0010                                                         
*                                                                               
         USING PCONDESC,R6                                                      
         GOTO1 DATCON,PLIST,(3,PCONSDT),(10,PRICTSRT)                           
         GOTO1 DATCON,PLIST,(3,PCONEDT),(10,PRICTEND)                           
         MVC   PRICTPRD,PCONPRD                                                 
         MVC   PRICTTPE,PCONTYP                                                 
         CLI   PCONREV,X'00'                                                    
         JE    PCON0010                                                         
         GOTO1 DATCON,PLIST,(3,PCONREV),(10,PRICTREV)                           
         DROP  R6                                                               
*                                                                               
PCON0010 DS    0H                                                               
         TR    PRICTSRT,MXTRT                                                   
         TR    PRICTEND,MXTRT                                                   
         TR    PRICTREV,MXTRT                                                   
         TR    PRICTPRD,MXTRT                                                   
         TR    PRICTTPE,MXTRT                                                   
*                                                                               
         LA    R6,PCONRECD                                                      
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PCON0020                                                         
*                                                                               
         USING PRBELEM,R6                                                       
         OC    PRBLIND,PRBLIND                                                  
         JZ    PCON0020                                                         
         LA    R7,LEVELIND                                                      
*                                                                               
PCON0011 CLI   0(R7),X'FF'                                                      
         JE    PCON0020                                                         
         CLC   0(1,R7),PRBLIND                                                  
         JNE   PCON0015                                                         
         MVC   PRICTLDS,1(R7)                                                   
         J     PCON0020                                                         
PCON0015 DS    0H                                                               
         AHI   R7,LEVELQ                                                        
         J     PCON0011                                                         
PCON0020 DS    0H                                                               
         TR    PRICTLDS,MXTRT                                                   
         J     EXIT                                                             
*                                                                               
***                                                                             
***                                                                             
LEVELIND DS    0H                                                               
FIRST    DC    C'$',CL8'$ VOLUME'                                               
SECOND   DC    C'N',CL8'NET $VOL'                                               
LEVELQ   EQU   SECOND-FIRST                                                     
         DC    C'X',CL8'TIMES'                                                  
         DC    C'L',CL8'LINES'                                                  
         DC    C'I',CL8'INCHES'                                                 
         DC    C'P',CL8'PAGES'                                                  
         DC    C'S',CL8'SPECIAL'                                                
         DC    X'FF'                                                            
***                                                                             
***                                                                             
***                                                                             
PRICTLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIREP - REP                                                                  
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIREP   NMOD1 WORKL,*PRIREP*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIRPLIT                                                      
         USING LITERAL,RA                                                       
         L     R8,16(R1)                                                        
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIRPD,R2           R2=A(EXTRACT RECORD)                         
         USING PREPRECD,R3         R3=A(PRINT   RECORD)                         
*                                                                               
         XC    PRIRPLEN,PRIRPLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIRPLEN(2),=AL2(PRIRPDL)                                        
         MVC   PRIRPTYP,PRRPQ                                                   
         MVI   PRIRPDX,MXTRTQ                                                   
         MVI   PRIRPDX+1,MXTRTQ                                                 
         MVI   PRIRPAGY-1,MXTRTQ                                                
         MVI   PRIRPMED-1,MXTRTQ                                                
         MVI   PRIRPREP-1,MXTRTQ                                                
         MVI   PRIRPNME-1,MXTRTQ                                                
         MVI   PRIRPISP-1,MXTRTQ                                                
         MVI   PRIRPAD1-1,MXTRTQ                                                
         MVI   PRIRPAD2-1,MXTRTQ                                                
         MVI   PRIRPATT-1,MXTRTQ                                                
         MVI   PRIRPTEL-1,MXTRTQ                                                
         MVI   PRIRPFAX-1,MXTRTQ                                                
         MVI   PRIRPSTA-1,MXTRTQ                                                
*                                                                               
*        CLC   GENSWICH,0(R8)                                                   
*        JNE   DUMMYSUB                                                         
*                                                                               
         MVC   PRIRPAGY,PREPKAGY   AGENCY                                       
         TR    PRIRPAGY,MXTRT                                                   
         MVC   PRIRPMED,PREPKMED   MEDIA                                        
         TR    PRIRPMED,MXTRT                                                   
         MVC   PRIRPREP,PREPKREP   REP                                          
         TR    PRIRPREP,MXTRT                                                   
*                                                                               
         LA    R6,PREPRECD                                                      
         MVI   ELCODE,X'11'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PREP0010                                                         
*                                                                               
         USING PREPELEM,R6                                                      
         MVC   PRIRPNME,PREPNAME   REP NAME                                     
         MVC   PRIRPAD1,PREPLIN1   ADDRESS LINE 1                               
         MVC   PRIRPAD2,PREPLIN2   ADDRESS LINE 2                               
         MVC   PRIRPATT,PREPATTN   ATTENTION                                    
         MVC   PRIRPTEL,PREPTEL    TELEPHONE NUMBER                             
         MVC   PRIRPFAX,PREPFAX    FAX NUMBER                                   
         MVC   PRIRPSTA,PREPSTAC   STATE CODE - 90 IF CANADA ELSE BLANK         
*                                                                               
         MVI   PRIRPISP,C'N'       IS PUBLISHER                                 
         CLI   PREPSTAT,X'01'      CODE X'01' = PUPLISHER                       
         JNE   PREP0010                                                         
         MVI   PRIRPISP,C'Y'                                                    
         DROP  R6                                                               
*                                                                               
PREP0010 DS    0H                                                               
         TR    PRIRPNME,MXTRT                                                   
         TR    PRIRPISP,MXTRT                                                   
         TR    PRIRPAD1,MXTRT                                                   
         TR    PRIRPAD2,MXTRT                                                   
         TR    PRIRPATT,MXTRT                                                   
         TR    PRIRPTEL,MXTRT                                                   
         TR    PRIRPFAX,MXTRT                                                   
         TR    PRIRPSTA,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
DUMMYSUB DS    0H                                                               
*        MVC   PRIRPAGY,PREPKAGY   AGENCY                                       
*        TR    PRIRPAGY,MXTRT                                                   
*        MVC   PRIRPMED,PREPKMED   MEDIA                                        
*        TR    PRIRPMED,MXTRT                                                   
*        MVC   PRIRPREP,13(R8)     REP                                          
*        TR    PRIRPREP,MXTRT                                                   
*        MVC   PRIRPNME(16),17(R8) NAME                                         
*        TR    PRIRPNME,MXTRT                                                   
*        MVC   PRIRPISP,33(R8)     IS PUBLISHER                                 
*        TR    PRIRPISP,MXTRT                                                   
*                                                                               
*        MVC   GENSWICH,0(R8)                                                   
*        J     EXIT                                                             
*                                                                               
PRIRPLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIBUY - BUY                                                                  
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIBUY   NMOD1 WORKL,*PRIBUY*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIBYLIT                                                      
         USING LITERAL,RA                                                       
         L     R8,16(R1)                                                        
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIBYD,R2           R2=A(EXTRACT RECORD)                         
         USING PBUYRECD,R3         R3=A(PRINT   RECORD)                         
*                                                                               
         MVC   MODETYP,0(R1)       MODE                                         
*                                                                               
         BRAS  RE,LOADER           GET GETINS ADDRESS                           
*                                                                               
         BRAS  RE,LOADER3          GET EDITOR ADDRESS                           
*                                                                               
         MVC   GENSWICH,12(R1)     "X" MEANS EXCLUDE BUY CUST COL DATA          
*                                                                               
         MVC   VERSIONA,16(R1)     VERSION NUMBER PASSED FROM PTXTRACT          
*                                                                               
         CLI   8(R1),1                                                          
         JE    BUYBUILD            BUILD SERIES OF RECORDS                      
         J     BUYNEXTR            OUTPUT NEXT RECORD                           
*                                                                               
PRIBYLIT DC    A(LITERAL)                                                       
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
**********************************************************************          
**  BUYNEXTR                                                        **          
**********************************************************************          
         SPACE 1                                                                
BUYNEXTR L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK?                         
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         LA    R0,PRIBYD           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1               LENGHT OF NEXT RECORD                        
         ICM   R1,3,PRIBYLEN-PRIBYD(RE)                                         
         LA    RF,0(R1,RE)         SAVE NEXT ADDRESS                            
         ST    RF,ANEXT                                                         
         LR    RF,R1               SET LENGTH                                   
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
         SPACE 1                                                                
**********************************************************************          
**  BUYBUILD                                                        **          
**********************************************************************          
BUYBUILD DS    0H                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,PTXBUYC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
*                                                                               
BUILD001 DS    0H                                                               
         BRAS  RE,BUYTABLE         BUY TABLE                                    
**                                                                              
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,PRIBYLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
*                                                                               
BUILD002 DS    0H                                                               
*                                                                               
         LA    R7,POOLTAB          POINT R7 TO THE TABLE WITH PRD               
*                                                                               
BUILD003 DS    0H                                                               
         CLI   0(R7),X'FF'         CHECK IF END OF TABLE                        
         BE    BUILD004            YES --                                       
         BRAS  RE,BUYSMMRY         BUY SUMMARY TABLE                            
**                                                                              
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,PRIBYLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
**                                                                              
         CLC   7(3,R3),=C'ZZZ'     CHECK IF PRODUCT ZZZ                         
*****    JNE   BUILD005                                                         
         JNE   BACG01                                                           
         MVI   ZZZFLAG,X'01'       IF YES SET FLAG                              
         J     BUILD003                                                         
*                                                                               
BUILD004 DS    0H                                                               
         MVI   ZZZFLAG,X'00'       WHEN DONE WITH POOL PRD SET FLAG 00          
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*     NOW OUTPUT BUY ADDITIONAL CHARGE RECORD IF VERSION ALLOWS       *         
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
BACG01   DS    0H                  BUILD UNDUPLICATED CHARGE CODE TABLE         
*                                                                               
         CLI   VERSIONA,05                                                      
         BL    BACG99              DO NOT OUTPUT ADD'L CHARGE RECORD            
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'44'        ADD'L CHG ELEM                               
         BRAS  RE,GETEL                                                         
         JNE   BUILD005            NONE - DONE                                  
*                                                                               
         USING PACELD,R6                                                        
         XC    ACGTAB,ACGTAB       CLEAR ADD'L CHG TABLE                        
         LA    R4,ACGTAB                                                        
         MVC   0(2,R4),PACCODE     PUT ADD'L CHG CODE IN TABLE                  
         MVI   2(R4),X'FF'         END MARKER                                   
*                                                                               
BACGLUP1 DS    0H                                                               
         BRAS  RE,NEXTEL                                                        
         JNE   BACGNXT             DONE WITH ELEMENTS                           
         LA    R4,ACGTAB                                                        
         CLC   0(2,R4),PACCODE     ALREADY IN TABLE ?                           
         JE    BACGLUP1            YES - NEXT ELEM                              
         CLI   0(R4),X'FF'         END OF TABLE ?                               
         JE    BACGADD             YES - CHG CODE NOT THERE - ADD IT            
BACGLUP5 DS    0H                                                               
         LA    R4,2(R4)            NEXT TABLE ENTRY                             
         CLC   0(2,R4),PACCODE     ALREADY IN TABLE ?                           
         JE    BACGLUP1            YES - NEXT ELEM                              
         CLI   0(R4),X'FF'         END OF TABLE ?                               
         JNE   BACGLUP5            NO - TEST NEXT                               
BACGADD  DS    0H                  ADD IT                                       
         MVC   0(2,R4),PACCODE     PUT ADD'L CHG CODE IN TABLE                  
         MVI   2(R4),X'FF'         END MARKER                                   
         J     BACGLUP1            NEXT ELEMENT                                 
*                                                                               
         DROP  R6                                                               
*                                                                               
BACGNXT  DS    0H                                                               
         LA    R4,ACGTAB           POINT R4 TO THE TABLE WITH CHG CODES         
*                                                                               
BACGTST  DS    0H                                                               
         CLI   0(R4),X'FF'         CHECK IF END OF CHG CODE TABLE               
         JE    BACG99              YES - DONE WITH RECORD                       
*                                                                               
         CLC   0(2,R4),=C'FX'      FOREIGN EXCHANGE ?                           
         JE    BACG05              YES - SKIP                                   
*                                                                               
BACG02   DS    0H                                                               
*                                                                               
         LA    R7,POOLTAB          POINT R7 TO THE TABLE WITH PRD               
*                                                                               
BACG03   DS    0H                                                               
         CLI   0(R7),X'FF'         CHECK IF END OF TABLE                        
         JE    BACG04              YES --                                       
         BRAS  RE,BUYACG           BUY ADDITIONAL CHARGE TABLE                  
**                                                                              
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,PRIBYLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
**                                                                              
         CLC   7(3,R3),=C'ZZZ'     CHECK IF PRODUCT ZZZ                         
         JNE   BACG05                                                           
         MVI   ZZZFLAG,X'01'       IF YES SET FLAG                              
         J     BACG03                                                           
*                                                                               
BACG04   DS    0H                                                               
         MVI   ZZZFLAG,X'00'       WHEN DONE WITH POOL PRD SET FLAG 00          
*                                                                               
BACG05   DS    0H                                                               
         LA    R4,2(R4)            BUMP TO NEXT CHG CODE ENTRY                  
         J     BACGTST                                                          
*                                                                               
BACG99   DS    0H                                                               
*                                                                               
BUILD005 DS    0H                                                               
*                                                                               
         LA    R4,5                                                             
BUILD006 DS    0H                                                               
         BRAS  RE,BUYCMMNT         BUY COMMENT TABLE                            
*                                                                               
         BCT   R4,BUILD006                                                      
*                                                                               
*                              EXCLUDE CUST COL DATA BY VERSION CONTROL         
*                              PASSED FROM PTXTRACT (IN GENSWICH HERE)          
         CLI   GENSWICH,C'X'       OUTPUT CUSTOM COLUMN DATA RECORD ?           
         JE    EXIT                NO - SKIP                                    
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'CC'                                                     
         BRAS  RE,GETEL                                                         
         JNE   EXIT                NO CUSTOM COLUMN DATA                        
*                                                                               
BUILD010 DS    0H                                                               
*                                                                               
         ST    R6,SVELADR          SAVE FOR USE IN PRICBC                       
         BRAS  RE,PRICBC           OUTPUT CUSTOM COLUMN DATA RECORD             
         L     R6,SVELADR                                                       
*                                                                               
         MVI   ELCODE,X'CC'                                                     
         BRAS  RE,NEXTEL           NEXT CUSTOM COLUMN REC                       
         JE    BUILD010                                                         
*                                                                               
         J     EXIT                DONE                                         
*                                                                               
PTXBUYC  DC    A(BUFFER1)          OUTPUT RECORD SAVE AREA                      
*                                                                               
         LTORG                                                                  
*                                                                               
         EJECT                                                                  
**********************************************************************          
**********************************************************************          
**********************************************************************          
**********************************************************************          
**********************************************************************          
**********************************************************************          
         SPACE 1                                                                
BUYTABLE NTR1  BASE=*,LABEL=*                                                   
         LA    R0,PRIBYD           CLEAR THE RECORD                             
         LA    R1,PRIBYDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    PRIBYLEN,PRIBYLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIBYLEN(2),=AL2(PRIBYDL)                                        
         MVC   PRIBYTYP,PRBYQ                                                   
         MVI   PRIBYDX,MXTRTQ                                                   
         MVI   PRIBYDX+1,MXTRTQ                                                 
         MVI   PRIBYAGY-1,MXTRTQ                                                
         MVI   PRIBYMED-1,MXTRTQ                                                
         MVI   PRIBYCNT-1,MXTRTQ                                                
         MVI   PRIBYPRD-1,MXTRTQ                                                
         MVI   PRIBYPUN-1,MXTRTQ                                                
         MVI   PRIBYPUZ-1,MXTRTQ                                                
         MVI   PRIBYPUE-1,MXTRTQ                                                
         MVI   PRIBYIND-1,MXTRTQ                                                
         MVI   PRIBYEST-1,MXTRTQ                                                
         MVI   PRIBYLIN-1,MXTRTQ                                                
         MVI   PRIBYISD-1,MXTRTQ                                                
         MVI   PRIBYIST-1,MXTRTQ      NEW ONE                                   
         MVI   PRIBYSER-1,MXTRTQ                                                
         MVI   PRIBYSPD-1,MXTRTQ                                                
         MVI   PRIBYLAS-1,MXTRTQ      NEW ONE                                   
         MVI   PRIBYCP1-1,MXTRTQ      NEW ONE                                   
         MVI   PRIBYCP2-1,MXTRTQ      NEW ONE                                   
         MVI   PRIBYCOP-1,MXTRTQ      NEW ONE                                   
         MVI   PRIBYRED-1,MXTRTQ                                                
         MVI   PRIBYILL-1,MXTRTQ                                                
         MVI   PRIBYSHO-1,MXTRTQ                                                
         MVI   PRIBYLNN-1,MXTRTQ                                                
         MVI   PRIBYCIN-1,MXTRTQ                                                
         MVI   PRIBYCOL-1,MXTRTQ                                                
         MVI   PRIBYPRC-1,MXTRTQ                                                
         MVI   PRIBYPLC-1,MXTRTQ                                                
         MVI   PRIBYCUN-1,MXTRTQ                                                
         MVI   PRIBYJOB-1,MXTRTQ                                                
         MVI   PRIBYAID-1,MXTRTQ                                                
         MVI   PRIBYCLD-1,MXTRTQ                                                
         MVI   PRIBYOSD-1,MXTRTQ                                                
         MVI   PRIBYPAD-1,MXTRTQ                                                
         MVI   PRIBYBLD-1,MXTRTQ                                                
         MVI   PRIBYMCL-1,MXTRTQ                                                
         MVI   PRIBYTPG-1,MXTRTQ                                                
         MVI   PRIBYEXT-1,MXTRTQ                                                
         MVI   PRIBYSP2-1,MXTRTQ                                                
         MVI   PRIBYSPR-1,MXTRTQ                                                
         MVI   PRIBYREF-1,MXTRTQ                                                
         MVI   PRIBYDEC-1,MXTRTQ                                                
         MVI   PRIBYUID-1,MXTRTQ                                                
         MVI   PRIBYORG-1,MXTRTQ                                                
         MVI   PRIBYETP-1,MXTRTQ                                                
         MVI   PRIBYRTP-1,MXTRTQ                                                
         MVI   PRIBYREP-1,MXTRTQ                                                
         MVI   PRIBYCLR-1,MXTRTQ                                                
         MVI   PRIBCRDT-1,MXTRTQ                                                
         MVI   PRIBFXC-1,MXTRTQ                                                 
         MVI   PRIBFXR-1,MXTRTQ                                                 
         MVI   PRIBCHDT-1,MXTRTQ                                                
         MVI   PRIBCHPD-1,MXTRTQ                                                
*                                                                               
X        USING PRIBYD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   PRIBYACT,X.PRIBYACT                                              
         MVC   PRIBYDAT,X.PRIBYDAT                                              
         MVC   PRIBYTME,X.PRIBYTME                                              
         DROP  X                                                                
*                                                                               
         MVC   PRIBYAGY,PBUYKAGY   AGENCY                                       
         TR    PRIBYAGY,MXTRT                                                   
         MVC   PRIBYMED,PBUYKMED   MEDIA                                        
         TR    PRIBYMED,MXTRT                                                   
         MVC   PRIBYCNT,PBUYKCLT   CLIENT                                       
         TR    PRIBYCNT,MXTRT                                                   
         MVC   PRIBYPRD,PBUYKPRD   PRODUCT                                      
         TR    PRIBYPRD,MXTRT                                                   
*                                                                               
         XC    CHAR15,CHAR15                                                    
         MVC   CHAR6,PBUYKPUB                                                   
         MVI   PRIMDPUB,X'08'                                                   
         GOTO1 =V(PUBEDIT),DMCB,(PRIMDPUB,CHAR6),(C'S',CHAR15)                  
*                                                                               
         MVC   PRIBYPUN,CHAR8      PUB NUMBER                                   
         TR    PRIBYPUN,MXTRT                                                   
*                                                                               
         CLI   CHAR6+4,0           ANY ZONE ?                                   
         BNH   PUBBUYE             NO                                           
         MVC   PRIBYPUZ,CHAR2      ZONE                                         
         MVC   PRIBYPUE,CHAR3      EDITION - MAY BE NULLS                       
         B     PUBBUYX             FINISH PUB NUMBER WORK                       
PUBBUYE  DS    0H                                                               
         MVC   PRIBYPUE,CHAR2      EDITION - MAY BE NULLS                       
PUBBUYX  DS    0H                                                               
         TR    PRIBYPUZ,MXTRT                                                   
         TR    PRIBYPUE,MXTRT                                                   
*                                                                               
         GOTO1 DATCON,PLIST,(3,PBUYKDAT),(10,PRIBYIND)                          
         TR    PRIBYIND,MXTRT                                                   
         EDIT  PBUYKEST,PRIBYEST,FILL=0                                         
         TR    PRIBYEST,MXTRT                                                   
         EDIT  PBUYKLIN,PRIBYLIN,FILL=0                                         
         TR    PRIBYLIN,MXTRT                                                   
*                                                                               
         MVI   PRIBYISD,C'N'        IS DELETED                                  
         TM    27(R3),X'80'                                                     
         JZ    PBUY0000                                                         
         MVI   PRIBYISD,C'Y'                                                    
*                                                                               
PBUY0000 DS    0H                                                               
         TR    PRIBYISD,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD          SERIAL NUMBER                               
         MVI   ELCODE,X'99'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBUY0001                                                         
*                                                                               
         USING PSERELD,R6                                                       
         EDIT  (P5,PSERNUM),PRIBYSER,FILL=0                                     
         DROP  R6                                                               
*                                                                               
PBUY0001 DS    0H                                                               
         TR    PRIBYSER,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,BYPCIDQ      PLANNED COST ELEMENT                         
         BRAS  RE,GETEL                                                         
         JNE   PBUY0001A                                                        
*                                                                               
         USING BYPCELD,R6                                                       
         ZAP   WORK(16),BYPCCST                                                 
         CLI   BYPCNIND,C'N'                                                    
         BNE   *+16                                                             
         MP    WORK(16),=P'85'                                                  
         SRP   WORK(16),62,5                                                    
         EDIT  (P16,WORK),PRIBYPLC,FILL=0,WRK=WORK+16                           
         DROP  R6                                                               
*                                                                               
PBUY0001A DS    0H                                                              
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBUY0014                                                         
*                                                                               
         USING PBDELEM,R6                                                       
*                                                                               
         GOTO1 DATCON,PLIST,(3,PBDBUYDT),(10,PRIBCRDT)                          
         TR    PRIBCRDT,MXTRT                                                   
*                                                                               
         CLC   PRIBYPLC,SPACES                                                  
         BH    PBUY0001B                                                        
*                                                                               
         EDIT  PBDPLCOS,PRIBYPLC,FILL=0          PLANNED COST                   
*                                                                               
PBUY0001B DS    0H                                                              
         EDIT  PBDCL,PRIBYCOL                      COLOR                        
*                                                                               
         EDIT  (P5,PBDPRCOS),PRIBYPRC,FILL=0     PREMIUM CHARGE                 
*                                                                               
         MVI   PRIBYIST,C'N'            IF T = TEST BUY                         
         CLI   PBDBFD,C'T'                                                      
         JNE   PBUY0002                                                         
         MVI   PRIBYIST,C'Y'                                                    
*                                                                               
PBUY0002 DS    0H                                                               
*****    CLI   0(R8),C'O'               CHECK IF MEDIA=OUTDOOR                  
*****    JNE   PBUY0004                                                         
*                                                                               
         CLI   PBDSPACE,X'FF'           IF FIRST BYTE IS 'FF'                   
         JNE   PBUY0003                 NEXT THREE FLDS ARE THERE               
*                                                                               
         EDIT  (P3,PBDREG),PRIBYRED,FILL=0     REGULAR DISPLAY                  
         EDIT  (P3,PBDILLUM),PRIBYILL,FILL=0   ILLUM DISPLAY                    
*                                                                               
         CP    PBDSHOW,=P'99999'         "SPC" DISPLAY COUNT ?                  
         JE    PBUY0003                  YES - SKIP                             
*                                                                               
         EDIT  (P3,PBDSHOW),PRIBYSHO,FILL=0    SHOWING DISPLAY                  
*                                                                               
PBUY0003 DS    0H                                                               
******   OC    PRIBYSPD,SPACES                                                  
******   OC    PBDSPACE,PBDSPACE           SKIP IF EMPTY                        
******   JNZ   PBUY0004                                                         
Y        USING PPBYOUTD,BUYOUT                                                  
         ST    R3,Y.PBYOINPT            ADDRESS OF REC                          
         L     R7,DATCON                                                        
         ST    R7,Y.PBYODTCN                                                    
         XC    PVALUES(PVALUESX-PVALUES),PVALUES                                
         ZAP   DUB,PBDUNITS                                                     
         CVB   R0,DUB              LOAD TO 0                                    
         ST    R0,UNITS            SAVE BIN UNITS                               
         LA    R7,PVALUES                                                       
         ST    R7,Y.PBYOVALS                                                    
*                                                                               
         MVI   Y.PBYOCTL,X'00'                                                  
         GOTO1 =V(PPBYOUT),DMCB,BUYOUT       CALL TO PPBYOUT                    
         MVC   PRIBYSPD,Y.PBYOSPC1           OUTPUT SPACE DES                   
         MVC   PRIBYSP2,Y.PBYOSPC2           SECOND LINE                        
         CLI   PBUYKMED,C'N'                 IF MED N                           
         JNE   PBUY0005                                                         
         CLI   Y.PBYOSPC1,C' '               AND SPACE DES HAVE 40              
         JH    PBUY0005                                                         
         MVC   PRIBYSPD(L'Y.PBYOUNTS),Y.PBYOUNTS     SPECIAL OUTPUT             
         DROP  Y                                                                
         J     PBUY0005                                                         
*                                                                               
*PBUY0004 DS    0H                                                              
******   MVC   PRIBYSPD(L'PBDSPACE),PBDSPACE                                    
*                                                                               
PBUY0005 DS    0H                                                               
*                                                                               
*        OC    PRIBYSPD,SPACES                                                  
*                                                                               
         CLI   PBDUIND,C'L'           CHECK UNITS INDICATOR                     
         JNE   PBUY0006               IF ITS 'L' OR '00'---LINES                
PBUY005# ZAP   DUB,PBDUNITS                                                     
         ZAP   DUB1,=P'0'                                                       
         J     PBUY0009                                                         
*                                                                               
PBUY0006 CLI   PBDUIND,X'00'                                                    
         JNE   PBUY0007                                                         
         J     PBUY005#                                                         
*                                                                               
PBUY0007 CLI   PBDUIND,X'89'          '89'----- DEC (2)                         
         JNE   PBUY0008                                                         
         ZAP   DUB,=P'0'                                                        
         ZAP   DUB1,PBDUNITS                                                    
         J     PBUY0009                                                         
*                                                                               
PBUY0008 CLI   PBDUIND,C'I'           'I' ----- DEC (0)                         
         JNE   PBUY0009                                                         
         ZAP   DUB,=P'0'                                                        
         ZAP   DUB1,=P'100'                                                     
         MP    DUB1,PBDUNITS                                                    
*                                                                               
PBUY0009 DS    0H                                                               
         EDIT  (P8,DUB),PRIBYLNN,FILL=0                                         
         EDIT  (P8,DUB1),PRIBYCIN,FILL=0                                        
*                                                                               
*                                                                               
         GOTOR CHKFEB29,PLIST,PBDPDATE  CHECK ON FEB29 NON-LEAP YR              
*                                                                               
         GOTO1 DATCON,PLIST,(3,PBDPDATE),(10,PRIBYPAD)                          
*                                                                               
         GOTOR CHKFEB29,PLIST,PBDBDATE  CHECK ON FEB29 NON-LEAP YR              
*                                                                               
         GOTO1 DATCON,PLIST,(3,PBDBDATE),(10,PRIBYBLD)                          
*                                                                               
         CLI   PBDCDATE,0          SKIP IF NO DATE                              
         JNH   PBUY0010                                                         
*                                                                               
         GOTOR CHKFEB29,PLIST,PBDCDATE  CHECK ON FEB29 NON-LEAP YR              
*                                                                               
         GOTO1 DATCON,PLIST,(3,PBDCDATE),(10,PRIBYCLD)                          
*                                                                               
PBUY0010 DS    0H                                                               
         CLI   PBDSDATE,0          SKIP IF NO DATE                              
         JNH   PBUY0011                                                         
*                                                                               
         GOTOR CHKFEB29,PLIST,PBDSDATE  CHECK ON FEB29 NON-LEAP YR              
*                                                                               
         GOTO1 DATCON,PLIST,(3,PBDSDATE),(10,PRIBYOSD)                          
*                                                                               
PBUY0011 DS    0H                                                               
         CLI   PBDMDATE,0          SKIP IF NO DATE                              
         JNH   PBUY0012                                                         
*                                                                               
         GOTOR CHKFEB29,PLIST,PBDMDATE  CHECK ON FEB29 NON-LEAP YR              
*                                                                               
         GOTO1 DATCON,PLIST,(3,PBDMDATE),(10,PRIBYMCL)                          
*                                                                               
PBUY0012 DS    0H                                                               
         OC    PBDJOB,PBDJOB                                                    
         JNZ   PBUY0013                                                         
         MVC   PRIBYJOB,=C'*NONE*'                                              
         J     PBUY0014                                                         
*                                                                               
PBUY0013 DS    0H                                                               
         MVC   PRIBYJOB,PBDJOB                                                  
         CLI   PBDJOB,X'FF'        "AD-ID ALONE"                                
         BNE   *+10                NO                                           
         MVC   PRIBYJOB,SPACES                                                  
         DROP  R6                                                               
*                                  GET THE AD-ID CODE                           
         LA    R6,KEYJOB                                                        
         USING PJOBRECD,R6                                                      
         XC    KEYJOB,KEYJOB                                                    
         MVC   KEYJOB(PBUYKPUB-PBUYKEY),PBUYKEY                                 
         MVI   PJOBKRCD,X'15'      JOB RECORD CODE                              
         MVC   PJOBKJOB,PBDJOB                                                  
         DROP  R6                                                               
*                                                                               
         LA    R6,COMREC                                                        
         CLC   KEYJOB(L'PJOBKEY),0(R6)   DO WE HAVE THE JOB RECORD              
         BE    PBUYCC13                                                         
*                                                                               
         MVC   KEYJOBSV,KEYJOB                                                  
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,KEYJOB,KEYJOB,0                      
*                                                                               
         CLC   KEYJOB(PJOBKPUB-PJOBKEY),KEYJOBSV                                
         BE    *+6                                                              
         DC    H'0'                JOB RECORD NOT FOUND                         
*                                  READ JOB RECORD INTO COMREC                  
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,GETREC,PRTFIL,KEYJOB+27,COMREC,WJOB                    
*                                                                               
*                                  RESTORE SEQUENCE                             
         XC    KEYJOB,KEYJOB                                                    
         MVC   KEYJOB(L'PBUYKEY),PBUYKEY                                        
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,KEYJOB,KEYJOB,0                      
*                                                                               
PBUYCC13 DS    0H                                                               
         LA    R6,COMREC                                                        
         USING PJOBRECD,R6                                                      
         MVC   PRIBYAID,SPACES                                                  
         CLI   PJOBADID,C' '                                                    
         BNH   PBUY0014                                                         
         MVC   PRIBYAID,PJOBADID   AD-ID CODE TO BUY                            
         DROP  R6                                                               
*                                                                               
PBUY0014 DS    0H                                                               
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'             MUST BE FOUND                                   
         USING PBDELEM,R6                                                       
*                                                                               
*                                                                               
         MVI   PRIBYSPR,C'N'                                                    
         TM    PBDSTAT,X'02'                                                    
         JZ    PBUY0015                                                         
         MVI   PRIBYSPR,C'Y'                                                    
*                                                                               
PBUY0015 DS    0H                                                               
*                                                                               
         ZAP   DOUBLE,=P'0'            IF DELETED OUTPUT 0                      
         CLI   PRIBYISD,C'Y'                                                    
         JE    PBUY0018                                                         
         CLC   =X'000001',PBDCU                                                 
         JE    PBUY0018                                                         
*                                                                               
         CLI   PBDSPACE,C'*'                                                    
         JNE   PBUYCU00                                                         
         OC    PBDCU,PBDCU                                                      
         JZ    PBUY0018                                                         
         J     PBUY0016                                                         
*                                                                               
PBUYCU00 DS    0H                                                               
         OC    PBDCU,PBDCU                                                      
         JZ    PBUY0017                                                         
*                                                                               
PBUY0016 DS    0H                                                               
         EDIT  PBDCU,PRIBYCUN,FILL=0             CONTRACT UNITS                 
         J     PBUY0019                                                         
*                                                                               
*  SPECIAL ROUTIN FOR CONTRACT UNITS                                            
*                                                                               
PBUY0017 DS    0H                                                               
         BRAS  RE,GETCU                                                         
*                                                                               
*        CLI   DOUBLE,X'FF'                                                     
*        JE    PBUYMEDN                                                         
*                                                                               
PBUY0018 DS    0H                                                               
         EDIT  (P8,DOUBLE),PRIBYCUN,FILL=0             CONTRACT UNITS           
         J     PBUY0019                                                         
*                                                                               
PBUYMEDN DS    0H                                                               
*                                                                               
         CLI   PBDUIND,X'89'          '89'----- DEC (2)                         
         JE    PBUYM001                                                         
         CLI   PBDUIND,C'I'                                                     
         JNE   PBUYM002                                                         
*                                                                               
PBUYM001 DS    0H                                                               
         MVC   PRIBYCUN(6),PRIBYCIN+1                                           
         MVC   PRIBYCUN+6(2),=C'00'                                             
         J     PBUY0019                                                         
*                                                                               
*                                                                               
PBUYM002 DS    0H                                                               
         MVC   PRIBYCUN(4),PRIBYLNN+1                                           
         MVC   PRIBYCUN+4(4),=C'0000'                                           
         J     PBUY0019                                                         
*                                                                               
         DROP  R6                                                               
***                                                                             
***                                                                             
PBUY0019 DS    0H                                                               
         TR    PRIBYRED,MXTRT                                                   
         TR    PRIBYILL,MXTRT                                                   
         TR    PRIBYSHO,MXTRT                                                   
         TR    PRIBYLNN,MXTRT                                                   
         TR    PRIBYCIN,MXTRT                                                   
         TR    PRIBYCOL,MXTRT                                                   
         TR    PRIBYPRC,MXTRT                                                   
         TR    PRIBYPLC,MXTRT                                                   
         TR    PRIBYCUN,MXTRT                                                   
         TR    PRIBYJOB,MXTRT                                                   
         TR    PRIBYCLD,MXTRT                                                   
         TR    PRIBYOSD,MXTRT                                                   
         TR    PRIBYPAD,MXTRT                                                   
         TR    PRIBYBLD,MXTRT                                                   
         TR    PRIBYMCL,MXTRT                                                   
         TR    PRIBYSPD,MXTRT                                                   
         TR    PRIBYSP2,MXTRT                                                   
         TR    PRIBYSPR,MXTRT                                                   
         TR    PRIBYAID,MXTRT                                                   
*                                                                               
PBUY0020 DS    0H                                                               
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'66'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBUY0051                                                         
*                                                                               
         USING PCOMELEM,R6                                                      
*                                                                               
PBUY0021 DS    0H                                                               
*                                                                               
         CLC   PCOMDATA(5),=C'COPY='                                            
         JNE   PBUY0025                                                         
*                                                                               
         ZIC   R1,PCOMELEM+1                                                    
         AHI   R1,-8                                                            
         JM    PBUY0050            NO COPY INSTRUCTIONS                         
*                                                                               
         CHI   R1,L'PRIBYCOP-1                                                  
         JNH   PBUY0022                                                         
*                                                                               
         MVC   PRIBYCOP,PCOMDATA+5                                              
         J     PBUY0050                                                         
*                                                                               
PBUY0022 DS    0H                                                               
         EX    R1,PBUY0023                                                      
         J     PBUY0050                                                         
PBUY0023 MVC   PRIBYCOP(0),PCOMDATA+5                                           
*                                                                               
PBUY0025 DS    0H                                                               
         CLC   PCOMDATA(4),=C'CAP='                                             
         JNE   PBUY0050                                                         
*                                                                               
         SR    R1,R1                                                            
         IC    R1,PCOMELEM+1                                                    
         AHI   R1,-7                                                            
         JM    PBUY0050            NO COMMENT LEFT                              
*                                                                               
         CHI   R1,24         CHECK IF LENGTH IS BIGGER THEN CAP FIELD           
         JNH   PBUY0027                                                         
*                                                                               
         CLI   CAPSWICH,X'01'   CHECK IF FIRST CAP                              
         JNE   PBUY0026                                                         
         MVC   PRIBYCP1,PCOMDATA+4                                              
         MVI   CAPSWICH,X'02'                                                   
         J     PBUY0050                                                         
PBUY0026 DS    0H                                                               
         MVC   PRIBYCP2,PCOMDATA+4                                              
         J     PBUY0050                                                         
*                                                                               
PBUY0027 DS    0H                                                               
         CLI   CAPSWICH,X'01'                                                   
         JNE   PBUY0030                                                         
*                                                                               
         EX    R1,PBUY0028                                                      
         J     PBUY0029                                                         
PBUY0028 MVC   PRIBYCP1(0),PCOMDATA+4                                           
PBUY0029 MVI   CAPSWICH,X'02'                                                   
         J     PBUY0050                                                         
*                                                                               
PBUY0030 DS    0H                                                               
         EX    R1,PBUY0032                                                      
         J     PBUY0050                                                         
PBUY0032 MVC   PRIBYCP2(0),PCOMDATA+4                                           
*                                                                               
PBUY0050 DS    0H                                                               
         BRAS  RE,NEXTEL                                                        
         JNE   PBUY0051                                                         
         J     PBUY0021                                                         
         DROP  R6                                                               
*                                                                               
PBUY0051 DS    0H                                                               
         MVI   CAPSWICH,X'01'                                                   
         TR    PRIBYCP1,MXTRT                                                   
         TR    PRIBYCP2,MXTRT                                                   
         TR    PRIBYCOP,MXTRT                                                   
*                                                                               
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'70'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBUY0090                                                         
*                                                                               
         USING PIOELEM,R6                                                       
*                                                                               
PBUY0071 DS    0H                                                               
*                                                                               
         OC    2(3,R6),2(R6)                                                    
         JZ    PBUY0079                                                         
         CLC   SV70ELM(3),2(R6)                                                 
         JH    PBUY0079                                                         
         MVC   SV70ELM(9),2(R6)                                                 
         J     PBUY0079                                                         
*                                                                               
PBUY0079 DS    0H                                                               
         BRAS  RE,NEXTEL                                                        
         JNE   PBUY0080                                                         
         J     PBUY0071                                                         
*                                                                               
PBUY0080 DS    0H                                                               
         CLI   SV70ELM,X'40'                                                    
         JL    PBUY0090                                                         
*                                                                               
         GOTO1 DATCON,PLIST,(3,SV70ELM),(10,PRIBYLAS)                           
PBUY0082 DS    0H                                                               
         MVI   PRIBYLAS+8,C'-'                                                  
*                                                                               
         MVC   HALF,SV70ELM+3                                                   
         EDIT  HALF,(4,PRIBYLAS+9),FILL=0                                       
*                                                                               
         MVI   PRIBYLAS+13,C'-'                                                 
*                                                                               
         CLI   SV70ELM+8,C'N'                                                   
         JNE   PBUY0085                                                         
         MVC   PRIBYLAS+14(3),=C'NEW'                                           
         J     PBUY0090                                                         
*                                                                               
PBUY0085 CLI   SV70ELM+8,C'C'                                                   
         JNE   PBUY0086                                                         
         MVC   PRIBYLAS+14(3),=C'CHA'                                           
         J     PBUY0090                                                         
*                                                                               
PBUY0086 CLI   SV70ELM+8,C'D'                                                   
         JNE   PBUY0090                                                         
         MVC   PRIBYLAS+14(3),=C'CAN'                                           
         DROP  R6                                                               
*                                                                               
PBUY0090 DS    0H                                                               
         TR    PRIBYLAS,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'95'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBUY0091                                                         
*                                                                               
         USING PTSHTEL,R6                                                       
*                                                                               
         MVC   PRIBYTPG,PTSHPAGE                                                
         DROP  R6                                                               
*                                                                               
PBUY0091 DS    0H                                                               
         TR    PRIBYTPG,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'96'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBUY0092                                                         
*                                                                               
         USING PEXDATEL,R6                                                      
*                                                                               
         OC    PEXDATE,PEXDATE                                                  
         BZ    PBUY0092                                                         
         GOTO1 DATCON,PLIST,(3,PEXDATE),(10,PRIBYEXT)                           
         DROP  R6                                                               
*                                                                               
PBUY0092 DS    0H                                                               
         TR    PRIBYEXT,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'83'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBUY0093                                                         
*                                                                               
         USING PBREFEL,R6                                                       
*                                                                               
         MVC   PRIBYREF,PBREFNO                                                 
         DROP  R6                                                               
*                                                                               
PBUY0093 DS    0H                                                               
         TR    PRIBYREF,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'81'        DAILY EFFECTIVE CIRCULATION ELEMENT          
         BRAS  RE,GETEL                                                         
         JNE   PBUY0094                                                         
*                                                                               
         USING PBDECEL,R6                                                       
*                                                                               
         EDIT  (P6,PBDEC),PRIBYDEC,FILL=0                                       
         DROP  R6                                                               
*                                                                               
PBUY0094 DS    0H                                                               
         TR    PRIBYDEC,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'90'        UPLOAD ELEMENT                               
         BRAS  RE,GETEL                                                         
         JNE   PBUY10                                                           
*                                                                               
         USING PIUPEL,R6                                                        
*                                                                               
         MVC   PRIBYUID,PIUPUSEQ   UPLOAD ID                                    
         DROP  R6                                                               
*                                                                               
PBUY10   DS    0H                                                               
         TR    PRIBYUID,MXTRT                                                   
*                                                                               
         XC    PRIBYORG,PRIBYORG                                                
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                SHOULD NEVER HAPPEN                          
*                                                                               
         USING PBDELEM,R6                                                       
*                                                                               
         TM    PBDSTAT2,X'80'      INSERTION ADDED BY ADBUYER?                  
         BZ    *+10                                                             
         MVC   PRIBYORG(07),=C'ADBUYER'                                         
         TM    PBDSTAT2,X'20'      INSERTION ADDED BY IDESK?                    
         BZ    *+10                                                             
         MVC   PRIBYORG(07),=C'IDESK  '                                         
         DROP  R6                                                               
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'90'        UPLOAD ELEM                                  
         BRAS  RE,GETEL            INSERTION ADDED BY PBU?                      
         JNE   *+10                NO                                           
         MVC   PRIBYORG(07),=C'PBU    '                                         
*                                                                               
* 02/07/19 SPEC-32312                                                           
* COMMENTING OUT, PPIDELL(X'A7') TAKES PRIORITY                                 
*        CLI   PRIBYORG,0          ALREADY SET?                                 
*        BNE   PBUY20              YES - DONE                                   
                                                                                
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,PPIDELQ      PID ELEMENT                                  
         BRAS  RE,GETEL                                                         
         BNE   PBUY20              DONE                                         
*                                                                               
         USING PPIDELM,R6                                                       
*                                                                               
         CLI   PPIDELL,PPIDLEQ     NEW STYLE PID ELEM?                          
         BL    PBUY20              NO - DONE                                    
*                                                                               
         XC    PRIBYORG,PRIBYORG                                                
*                                                                               
         CLI   PPIDPRG,PPIDPPKQ    PRINTPAK (001)?                              
         BNE   *+14                                                             
         MVC   PRIBYORG(8),=CL8'PRINTPAK'                                       
         B     PBUY20                                                           
*                                                                               
         CLI   PPIDPRG,PPIDCPYQ    SFM BUY COPY(002)?                           
         BNE   *+14                                                             
         MVC   PRIBYORG(12),=CL12'SFM BUY COPY'                                 
         B     PBUY20                                                           
*                                                                               
         CLI   PPIDPRG,PPIDMOVQ    SFM BUY MOVE(003)?                           
         BNE   *+14                                                             
         MVC   PRIBYORG(12),=CL12'SFM BUY MOVE'                                 
         B     PBUY20                                                           
*                                                                               
         CLI   PPIDPRG,PPIDADBQ    ADBUYER(004)?                                
         BNE   *+14                                                             
         MVC   PRIBYORG(17),=CL17'PRINT BUY TOOLKIT'                            
         B     PBUY20                                                           
*                                                                               
         CLI   PPIDPRG,PPIDIDKQ    IDESK(005)?                                  
         BNE   *+14                                                             
         MVC   PRIBYORG(5),=CL5'IDESK'                                          
         B     PBUY20                                                           
*                                                                               
         CLI   PPIDPRG,PPIDPBUQ    PBU(006)?                                    
         BNE   *+14                                                             
         MVC   PRIBYORG(16),=CL16'PRINT BUY UPLOAD'                             
         B     PBUY20                                                           
*                                                                               
         CLI   PPIDPRG,PPIDIMPQ    ADBUYER IMPORTS(007)?                        
         BNE   *+14                                                             
         MVC   PRIBYORG(15),=CL15'PBT IMPORTS'                                  
         B     PBUY20                                                           
*                                                                               
         CLI   PPIDPRG,PPIDPRMQ    PRISMA(008)?                                 
         BNE   *+14                                                             
         MVC   PRIBYORG(6),=CL6'PRISMA'                                         
         B     PBUY20                                                           
*                                                                               
         CLI   PPIDPRG,PPIDRADQ    RADIA(009)?                                  
         BNE   *+14                                                             
         MVC   PRIBYORG(5),=CL5'RADIA'                                          
         B     PBUY20                                                           
*                                                                               
         DROP  R6                                                               
*                                                                               
PBUY20   DS    0H                                                               
         TR    PRIBYORG,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                SHOULD NEVER HAPPEN                          
*                                                                               
         USING PBDELEM,R6                                                       
*                                                                               
         MVC   PRIBYETP,PBDCTYP    N=NET, BLANK=GROSS $ I/P TO BUY              
         MVC   PRIBYRTP,PBDCOSIN   COST INDICATOR (RATE TYPE)                   
*                                                                               
         DROP  R6                                                               
*                                                                               
         TR    PRIBYETP,MXTRT                                                   
         TR    PRIBYRTP,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'80'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBUY20X             NO SPECIAL REP ELEMENT                       
*                                                                               
         USING PBSREPEL,R6                                                      
*                                                                               
         MVC   PRIBYREP,PBSREP     "SPECIAL REP" CODE                           
*                                                                               
         DROP  R6                                                               
*                                                                               
PBUY20X  DS    0H                                                               
         TR    PRIBYREP,MXTRT                                                   
*                                                                               
         MVC   PRIBYCLR,SPACES     NOT PAID                                     
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'25'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBUY30X             NO PAY ELEMENT                               
*                                                                               
         USING PPAYELEM,R6                                                      
         OC    PPDDATE,PPDDATE     HAVE PAY DATE ?                              
         JZ    PBUY30X             NO - NOT PAID                                
*                                                                               
         NI    PPREP,X'FF'-X'C0'   STRIP PAYEE HOBS                             
         XC    WORK,WORK                                                        
         MVC   WORK(2),PPREP       SAVE                                         
*                                                                               
PBUY30   DS    0H                                                               
         BRAS  RE,NEXTEL                                                        
         JNE   PBUY30T             NO MORE PAY ELEMENTS                         
         NI    PPREP,X'FF'-X'C0'   STRIP PAYEE HOBS                             
         CLC   PPREP,WORK                                                       
         JE    PBUY30              SAME PAY REP - TEST NEXT                     
         MVC   PRIBYCLR,=C'****'   DIFFERENT PAY REPS                           
         J     PBUY30X             DONE                                         
*                                                                               
PBUY30T  DS    0H                                                               
         MVC   PRIBYCLR,=C'0000'   FOR DIRECT PAYMENT                           
         OC    WORK(2),WORK        PAYEE=0(DIRECT) ?                            
         JZ    PBUY30X             YES - DONE                                   
*                                                                               
         MVC   DUB,WORK            OUTPUT REP NUMBER                            
         LH    R0,DUB                                                           
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PRIBYCLR,DUB                                                     
*                                                                               
         DROP  R6                                                               
*                                                                               
PBUY30X  DS    0H                                                               
         TR    PRIBYCLR,MXTRT                                                   
*                                                                               
         XR    R0,R0                                                            
         EDIT  (R0),(11,PRIBFXR),5,FLOAT=0                                      
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,BYCCIDQ      CUSTOM COLUMN ELEMENT                        
         BRAS  RE,GETEL                                                         
         JNE   PBUY50              NO CUSTOM COLUMN ELEMENT                     
         J     PBUY41                                                           
*                                                                               
PBUY40   DS    0H                                                               
         BRAS  RE,NEXTEL                                                        
         JNE   PBUY50              NO CUSTOM COLUMN ELEMENT                     
*                                                                               
PBUY41   DS    0H                                                               
         CLI   0(R6),BYCCIDQ                                                    
         JNE   PBUY50                                                           
*                                                                               
         CLC   2(2,R6),=X'200F'    FOREIGN EXCHANGE?                            
         BNE   PBUY40                                                           
*                                                                               
         MVC   PRIBFXC,=C'FX'                                                   
         USING BYCCELD,R6                                                       
         EDIT (P8,BYCCDATA),(11,PRIBFXR),5                                      
         DROP  R6                                                               
*                                                                               
PBUY50   DS    0H                                                               
         TR    PRIBFXC,MXTRT                                                    
         TR    PRIBFXR,MXTRT                                                    
*                                                                               
* EXTRACT BUY CHANGE DATE AND PID                                               
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBUY60                                                           
*                                                                               
         USING PBDELEM,R6                                                       
         GOTO1 DATCON,PLIST,(3,PBDDATE),(2,HALF) SAVE BUY CHG DATE              
         GOTO1 DATCON,PLIST,(3,PBDDATE),(10,PRIBCHDT) EXTRACT IT                
         DROP  R6                                                               
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,PCHGELEQ     X'24', BUY CHANGE ELEMENT                    
         BRAS  RE,GETEL                                                         
         JNE   PBUY60         NO CHANGE ELEMENT - DON'T BOTHER WITH PID         
         J     PBUY56                                                           
*                                                                               
* LOOP TO GET THE LAST BUY CHANGE ELEMENT                                       
PBUY55   DS    0H                                                               
         BRAS  RE,NEXTEL                                                        
         JNE   PBUY58                                                           
*                                                                               
PBUY56   DS    0H                                                               
         USING PCHGELEM,R6                                                      
*                                                                               
         CLI   PCHGELCD,PCHGELEQ                                                
         JNE   PBUY58                                                           
         ST    R6,FULL             SAVE ELEMENT'S ADDRESS                       
         J     PBUY55                                                           
*                                                                               
PBUY58   DS    0H                                                               
         L     R6,FULL             LAST BUY CHANGE ELEMENT ADDRESS              
*                                                                               
         CLC   PCHGDAT,HALF    COMPARE CHG DATES FROM DESC., CHG. ELEMS         
         JL    PBUY60        BUY DESC DATE IS HIGHER, DON'T EXTRACT PID         
*                                                                               
         GOTO1 DATCON,PLIST,(2,PCHGDAT),(10,PRIBCHDT)                           
*                                                                               
         CLI   PCHGLEN,PCHGNEWS                                                 
         JNE   *+8                                                              
         LA    R1,PCHG_XSS                                                      
*                                                                               
         CLI   PCHGLEN,PCHGNEWL                                                 
         JNE   *+8                                                              
         LA    R1,PCHG_XLS                                                      
*                                                                               
         DROP  R6                                                               
*                                                                               
         BRAS  RE,TRNPID                                                        
         JNE   PBUY60                                                           
         MVC   PRIBCHPD,WORK                                                    
*                                                                               
PBUY60   DS    0H                                                               
         TR    PRIBCHDT,MXTRT                                                   
         TR    PRIBCHPD,MXTRT                                                   
*                                                                               
         MVI   PRIBMSTA,C'N'                                                    
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,PBMATELQ     X'52', MATCH STATUS ELEMENT                  
         BRAS  RE,GETEL                                                         
         JNE   PBUY70                                                           
*                                                                               
         USING PBMATELD,R6                                                      
         CLI   PBMTSTAT,X'00'                                                   
         JE    PBUY70                                                           
         MVC   PRIBMSTA,PBMTSTAT                                                
         DROP  R6                                                               
*                                                                               
PBUY70   DS    0H                                                               
         TR    PRIBMSTA,MXTRT                                                   
*                                                                               
PBUYEND  DS    0H                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
KEYJOB   DS    CL33                                                             
KEYJOBSV DS    CL33                                                             
WJOB     DS    12D                                                              
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************                                             
*                                                                               
* GETCU                                                                         
***********************************                                             
GETCU    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         XC    STRELEM,STRELEM                                                  
         XC    GETCONC(GETCONLQ),GETCONC                                        
*                                                                               
         LA    R8,GETCONC          ESTABLISH PPGETCON CONTROL BLOCK             
         USING GETCOND,R8                                                       
*                                                                               
         ST    R3,GCNBUYA          PASS A(BUYREC)                               
         MVC   GCNVUTL,=V(UTL)     SET UTIL ADDRESS                             
         MVC   GCNCOMFA,COMFACS    SET A COMFACS                                
         MVI   GCNGETCU,C'Y'       ASK FOR CU VALUES                            
         MVC   GCNCONA,=A(0)       A(CONTRACT RECORD)                           
*                                                                               
         GOTO1 =V(PPGETCON),DMCB,GETCOND                                        
*                                                                               
         CLI   GCNERR,0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         CLI   MODETYP,X'04'       UPDATE MODE ?                                
         BE    GETCUD              YES - NO RESTORE                             
*                                                                               
*                                  RESTORE DIR SEQ                              
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(X'08',DMRDHI),PRTDIR,PBUYKEY,GCKEY,0                  
*                                                                               
         CLC   PBUYKEY,GCKEY                                                    
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
GETCUD   DS    0H                                                               
         ZAP   DOUBLE,=P'0'       DEFAULT TO ZERO                               
*                                                                               
         CLC   =X'00000001',GCNCU   DONE IF FORCED ZERO                         
         JE    GETCUX                                                           
*                                                                               
         ZAP   DOUBLE,=P'10000'    DEFAULT TO 1.0000                            
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,15,GCNCU         GET CU VALUE TO 4 DECS                       
         JZ    GETCU000                                                         
*                                                                               
         CVD   RF,DUB              CVD                                          
*                                                                               
         ZAP   DOUBLE,DUB         RETURN VALUE                                  
         J     GETCUX                                                           
*                                                                               
GETCU000 DS    0H                                                               
         CLI   PBUYKMED,C'N'                                                    
         JNE   GETCUX                                                           
*                                                                               
         ICM   R7,15,GCNCONA                                                    
         JZ    GETCUX                                                           
*                                                                               
*                                                                               
         LR    R6,R7                                                            
         MVI   ELCODE,X'20'                                                     
*                                                                               
         BRAS  RE,GETEL                                                         
         JNE   GETCUX                                                           
*                                                                               
**       CLC   PBUYKCLT(11),=X'C4C140D9D5E80000922006'                          
***      JNE   *+6                                                              
**       DC    H'0'                                                             
*                                                                               
         ST    R6,STRELEM          SAVE FIRST X'20' ELEM                        
*                                                                               
         USING PRBELEM,R6                                                       
*                                                                               
GETCU002 DS    0H                                                               
*                                                                               
         CLC   PRBDESC,PRIBYSPD                                                 
         JNE   GETCU003                                                         
         CLC   PRBDATE,PBUYKDAT                                                 
         JH    GETCU005                                                         
         JE    GETCU010                                                         
         ST    R6,STRELEM         CANDIDATE                                     
         J     GETCU003                                                         
*                                                                               
GETCU003 DS    0H                                                               
*                                                                               
         BRAS  RE,NEXTEL                                                        
         JNE   GETCU005                                                         
         J     GETCU002                                                         
         DROP  R6                                                               
*                                                                               
GETCU005 DS    0H                                                               
         L     R6,STRELEM         CANDIDATE                                     
*                                                                               
         USING PRBELEM,R6                                                       
*                                                                               
GETCU010 DS    0H                                                               
         CLI   PRBLIND,C'I'               IF RATE FOR INCHES                    
         JE    *+12                                                             
         CLI   PRBLIND,C'L'               OR LINES                              
         JNE   GETCUX                                                           
*                                                                               
         ZAP   DOUBLE,PBDUNITS    ELSE RETURN BUY UNITS                         
*                                                                               
         SRP   DOUBLE,2,0         ADD DECIMAL PLACE                             
         CLI   PBDUIND,X'89'       ALREADY AT TWO DECIMALS                      
         JE    *+10                                                             
         SRP   DOUBLE,2,0         ELSE ADD 2 MORE DECIMAL PLACES                
*                                                                               
*                                                                               
         CLI   PRBLIND,C'I'       INCH CONTRACT                                 
         JNE   GETCU020                                                         
*                                                                               
         CLI   PBDUIND,C'L'       IS BUY IN LINES                               
         JNE   GETCU030            NO - OK                                      
*                                                                               
*                                                                               
         ZAP   WORK(8),DOUBLE      CONVERT LINES TO INCHES                      
         DP    WORK(8),=P'14'                                                   
         ZAP   DOUBLE,WORK(6)                                                   
         J     GETCU030                                                         
*                                                                               
GETCU020 DS    0H                  LINE CONTRACT                                
*                                                                               
         CLI   PBDUIND,X'00'                                                    
         JE    GETCU030                                                         
         CLI   PBDUIND,C'L'        AND LINE BUY                                 
         JE    *+10                OKAY                                         
         MP    DOUBLE,=P'14'      ELSE CONVERT INCHES TO LINES                  
*                                                                               
         J     GETCU030                                                         
*                                                                               
GETCU030 DS    0H                                                               
*                                                                               
*        CP    DOUBLE,=P'0'                                                     
*        BNE   GETCU040                                                         
*        ZAP   DOUBLE,=P'10000'                                                 
*                                                                               
GETCU040 DS    0H                                                               
*                                                                               
         DROP  R6                                                               
         DROP  R8                                                               
GETCUX   DS    0H                                                               
         XIT1                                                                   
STRELEM  DS    A                                                                
GCKEY    DS    CL33                                                             
*                                                                               
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*                                                                     *         
*        IF DATE IS FEB29 AND IT IS NOT A LEAP YEAR                   *         
*              MAKE DATE FEB28                                        *         
*                                                                     *         
*NTRY    P1    A(3 BYTE BINARY DATE TO BE CHECKED)                    *         
*                                                                     *         
*EXIT          ANY FEB29 DATE IN NON-LEAP YEAR IS CONVERTED TO        *         
*                 FEB28                                               *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
CHKFEB29 NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     R2,0(R1)            POINT TO DATE TO BE CHECKED                  
*                                    YMD BINARY                                 
         CLC   =X'021D',1(R2)      DONE IF NOT FEB 29                           
         BNE   CHKFEB2X                                                         
*                                                                               
         TM    0(R2),X'03'         LEAP YEARS ARE DIVISIBLE BY 4                
         BZ    *+8                 SKIP IF A  LEAP YEAR                         
         MVI   2(R2),28            ELSE CONVERT DAY TO 28TH                     
*                                                                               
CHKFEB2X DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         EJECT                                                                  
**********************************************************************          
* R4 IS A COUNTER FOR DIFFERENT COMMENTS ELEM                                   
*                                                                               
**********************************************************************          
         SPACE 1                                                                
BUYCMMNT NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING PRIBCD,R2                                                        
*                                                                               
         LA    R0,PRIBCD           CLEAR THE RECORD                             
         LA    R1,PRIBCDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    PRIBCLEN,PRIBCLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIBCLEN(2),=AL2(PRIBCDL)                                        
         MVC   PRIBCTYP,PRBCQ                                                   
         MVI   PRIBCDX,MXTRTQ                                                   
         MVI   PRIBCDX+1,MXTRTQ                                                 
         MVI   PRIBCAGY-1,MXTRTQ                                                
         MVI   PRIBCMED-1,MXTRTQ                                                
         MVI   PRIBCCNT-1,MXTRTQ                                                
         MVI   PRIBCSER-1,MXTRTQ                                                
         MVI   PRIBCTPE-1,MXTRTQ                                                
         MVI   PRIBCCML-1,MXTRTQ                                                
*                                                                               
X2       USING PRIBYD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   PRIBCACT,X2.PRIBYACT                                             
         MVC   PRIBCDAT,X2.PRIBYDAT                                             
         MVC   PRIBCTME,X2.PRIBYTME                                             
*        CLI   PRIBCACT,C'C'                                                    
*        BNE   *+8                                                              
         MVI   PRIBCACT,C'A'                                                    
         DROP  X2                                                               
*                                                                               
*                                                                               
         MVC   PRIBCAGY,PBUYKAGY   AGENCY                                       
         TR    PRIBCAGY,MXTRT                                                   
         MVC   PRIBCMED,PBUYKMED   MEDIA                                        
         TR    PRIBCMED,MXTRT                                                   
         MVC   PRIBCCNT,PBUYKCLT   CLIENT                                       
         TR    PRIBCCNT,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'99'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PCOM0010                                                         
*                                                                               
         USING PSERELD,R6                                                       
         EDIT  (P5,PSERNUM),PRIBCSER,FILL=0                                     
         DROP  R6                                                               
*                                                                               
PCOM0010 DS    0H                                                               
         TR    PRIBCSER,MXTRT                                                   
*                                                                               
*                                                                               
         CHI   R4,5                                                             
         JNE   PCOM0020                                                         
         MVI   ELCODE,X'67'                                                     
         MVI   PRIBCTPE,C'I'                                                    
*                                                                               
         GOTO1 =A(PP12468),DMCB,(X'67',PBUYKEY),=C'NOSQ'                        
*                                                                               
         J     PCOM0035                                                         
*                                                                               
PCOM0020 CHI   R4,4                                                             
         JNE   PCOM0021                                                         
         MVI   ELCODE,X'68'                                                     
         MVI   PRIBCTPE,C'P'                                                    
*                                                                               
         GOTO1 =A(PP12468),DMCB,(X'68',PBUYKEY),=C'NOSQ'                        
*                                                                               
         J     PCOM0035                                                         
*                                                                               
PCOM0021 CHI   R4,3                                                             
         BNE   PCOM0022                                                         
         MVI   ELCODE,X'66'                                                     
         MVI   PRIBCTPE,C'C'                                                    
*                                                                               
         GOTO1 =A(PP12468),DMCB,(X'66',PBUYKEY),=C'NOSQ'                        
*                                                                               
         J     PCOM0035                                                         
*                                                                               
PCOM0022 CHI   R4,2                                                             
         BNE   PCOM0023                                                         
         MVI   ELCODE,X'69'                                                     
         MVI   PRIBCTPE,C'T'                                                    
*                                                                               
         GOTO1 =A(PP12468),DMCB,(X'69',PBUYKEY),=C'NOSQ'                        
*                                                                               
         J     PCOM0035                                                         
*                                                                               
PCOM0023 CHI   R4,1                                                             
         BNE   PCOM0024                                                         
         MVI   ELCODE,X'66'                                                     
         MVI   PRIBCTPE,C'R'                                                    
*                                                                               
         GOTO1 =A(PP12468),DMCB,(X'66',PBUYKEY),(C'R',=C'NOSQ')                 
*                                                                               
         J     PCOM0035                                                         
PCOM0024 DC    H'0'                                                             
*                                                                               
*                                                                               
PCOM0035 DS    0H                                                               
         CLI   DMCB,X'00'                                                       
         JE    PCOM0110                                                         
         MVI   PRIBCCML,X'00'                                                   
         SR    R7,R7                                                            
         ICM   R7,7,DMCB+1                                                      
         ZIC   R1,DMCB                                                          
*                                                                               
         CHI   R1,95                CHECK NOT TO OUTPUT SEMICOL                 
         JE    *+8                                                              
         AHI   R1,-1                                                            
         STC   R1,PRIBCCML+1                                                    
         AHI   R1,-1                                                            
         JM    *+8                 NEGATIVE LENGTH                              
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   PRIBCCOM(0),0(R7)                                                
         J     PCOM0065                                                         
*                                                                               
PCOM0065 DS    0H                                                               
         TR    PRIBCTPE,MXTRT                                                   
         TR    PRIBCCOM,MXTRT                                                   
*                                                                               
PCOM0070 DS    0H                                                               
         SR    RE,RE                                                            
         ICM   RE,3,PRIBCLEN                                                    
         AR    R2,RE                                                            
*        XC    0(8,R2),0(R2)                                                    
*                                                                               
*        XIT1  REGS=(R2)                                                        
*                                                                               
PCOM0110 DS    0H                                                               
         XC    0(8,R2),0(R2)                                                    
         XIT1  REGS=(R2)                                                        
         DROP  R2                                                               
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
* PRICBC - BUY STANDARD, CUSTOM COLUMN DATA RECORD                              
*                                                                     *         
*   SVELADR HAS ADDRESS OF CUSTOM COLUMN ELEMENT IN BUY               *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRICBC   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING PRICBD,R2                                                        
*                                                                               
         LA    R0,PRICBD           CLEAR THE RECORD                             
         LA    R1,PRICBDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         MVI   CCRECSW,0           CUST COL REC NOT FOUND INDICATOR             
*                                                                               
         XC    PRICBLEN,PRICBLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRICBLEN(2),=AL2(PRICBDL)                                        
         MVC   PRICBTYP,PRCBQ                                                   
         MVI   PRICBDX,MXTRTQ                                                   
         MVI   PRICBDX+1,MXTRTQ                                                 
         MVI   PRICBAGY-1,MXTRTQ                                                
         MVI   PRICBMED-1,MXTRTQ                                                
         MVI   PRICBCLT-1,MXTRTQ                                                
         MVI   PRICBSER-1,MXTRTQ                                                
         MVI   PRICBSEQ-1,MXTRTQ                                                
         MVI   PRICBDTL-1,MXTRTQ                                                
         MVI   PRICBDTA-1,MXTRTQ                                                
*                                                                               
         USING PRIBYD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   PRICBACT,PRIBYACT                                                
         MVC   PRICBDAT,PRIBYDAT                                                
         MVC   PRICBTME,PRIBYTME                                                
         MVI   PRICBACT,C'A'                                                    
*                                                                               
         DROP  R5                                                               
*                                                                               
         MVC   PRICBAGY,PBUYKAGY   AGENCY                                       
         TR    PRICBAGY,MXTRT                                                   
         MVC   PRICBMED,PBUYKMED   MEDIA                                        
         TR    PRICBMED,MXTRT                                                   
         MVC   PRICBCLT,PBUYKCLT   CLIENT                                       
         TR    PRICBCLT,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'99'        BUY SERIAL NUMBER ELEMENT                    
         BRAS  RE,GETEL                                                         
         JNE   PRICB40                                                          
*                                                                               
         USING PSERELD,R6                                                       
         EDIT  (P5,PSERNUM),PRICBSER,FILL=0                                     
         DROP  R6                                                               
*                                                                               
PRICB40  DS    0H                                                               
         TR    PRICBSER,MXTRT                                                   
*                                                                               
         L     R6,SVELADR          POINT R6 TO CUSTOM COLUMN ELEMENT            
         USING BYCCELD,R6                                                       
         EDIT  BYCCSQN,PRICBSEQ,FILL=0    CUST COL SEQUENCE NUMBER              
         TR    PRICBSEQ,MXTRT                                                   
*                                                                               
         CLC   BYCCSQN,=X'2000'    STANDARD COLUMN HERE?                        
         BNL   PRICB60             YES                                          
*                                                                               
         GOTO1 =A(READCCC),DMCB,BYCCSQN,PBUYRECD                                
         BE    PRICB70                                                          
*                                                                               
         MVC   PRICBDTA(L'CCRECNF),CCRECNF                                      
         MVI   PRICBDTL+1,L'CCRECNF  LENGTH OF MESSAGE                          
         B     CCDISX              DONE WITH THIS MISSING COLUMN                
*                                                                               
PRICB60  DS    0H                  STANDARD COLUMN HERE                         
         MVC   PRICBTYP,PRBTQ      FILL IN STANDARD COLUMN REC ID               
*                                                                               
         GOTO1 =A(READSTC),DMCB,BYCCSQN,PBUYRECD                                
         BE    PRICB70                                                          
*                                                                               
         MVC   PRICBDTA(L'SCRECNF),SCRECNF                                      
         MVI   PRICBDTL+1,L'SCRECNF  LENGTH OF MESSAGE                          
         B     CCDISX              DONE WITH THIS MISSING COLUMN                
*                                                                               
PRICB70  DS    0H                                                               
         LA    R4,COMREC+PCOLFRST-PCOLREC                                       
         CLC   BYCCSQN,=X'2000'    STANDARD COLUMN HERE?                        
         BL    *+8                 YES                                          
         LA    R4,COMREC+GCOLFRST-GCOLRECD                                      
*                                                                               
         USING PCOLELEM,R4                                                      
*                                                                               
         CLI   PCOLTYP,C'D'        DATE ?                                       
         BE    CCDIS30             YES                                          
         CLI   PCOLTYP,C'P'        PERIOD ?                                     
         BE    CCDIS40             YES                                          
         CLI   PCOLTYP,C'T'        TEXT ?                                       
         BNE   CCDIS50             NO - MUST BE 1 OF 3 NUMERIC "TYPES"          
*                                                                               
*    EXECUTED MOVE OF BYCCDATA TO PRICBDTA EXTRACT FIELD FOR TEXT DATA          
         ZICM  R1,BYCCLEN          TOTAL ELEMENT LENGTH                         
         LA    RF,BYCCHDRL         HEADER LENGTH (OVERHEAD)                     
         SR    R1,RF               R1 HAS LENGTH OF CUST COL DATA               
         STC   R1,PRICBDTL+1                                                    
         BCTR  R1,0                PREP FOR EXECUTED MOVE                       
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   PRICBDTA(0),BYCCDATA                                             
         B     CCDISX              DONE WITH THIS ELEMENT                       
*                                                                               
CCDIS30  DS    0H                  OUTPUT A SINGLE DATE                         
         GOTOR DATCON,DMCB,(X'03',BYCCDATA),(5,PRICBDTA)                        
         MVI   PRICBDTL+1,8        LENGTH OF DATA                               
         B     CCDISX              DONE WITH THIS ELEMENT                       
*                                                                               
CCDIS40  DS    0H                  OUTPUT A DATE RANGE (PERIOD)                 
         GOTOR DATCON,DMCB,(X'13',BYCCDATA),(5,PRICBDTA)                        
         MVI   PRICBDTL+1,17       LENGTH OF DATA                               
         B     CCDISX              DONE WITH THIS ELEMENT                       
*                                                                               
CCDIS50  DS    0H                  OUTPUT A NUMERIC FIELD (N, $, OR %)          
         XC    WORK,WORK           PREP FOR EDITOR USE                          
         LA    R7,WORK                                                          
         USING EBLOCKD,R7                                                       
         LA    RF,BYCCDATA         SET UP EDITOR INPUT BLOCK                    
         ST    RF,EBAIN            INPUT ADDRESS                                
         MVI   EBLIN,8             INPUT LENGTH (ALWAYS PL8)                    
         MVI   EBTIN,C'P'          INPUT TYPE (PACKED)                          
         LA    RF,PRICBDTA         SET UP EDITOR OUTPUT BLOCK                   
         ST    RF,EBAOUT           OUTPUT ADDRESS                               
         MVC   EBDECS,PCOLDECS     NO OF DECIMAL PLACES                         
         MVI   EBALIGN,C'L'        LEFT ALIGN                                   
         MVC   EBLOUT,PCOLMLEN     OUTPUT LENGTH                                
*                                                                               
         CLI   PCOLMLEN,13         DEFAULT NUMERIC OUTPUT LENGTH ?              
         BL    *+8                 NO - LESS - USE IT                           
         MVI   EBLOUT,20           MAKE OUTPUT LENGTH MAX OF 20                 
*                                                                               
         OI    EBOPT,EBOQCEY       COMMAS=YES                                   
         MVI   EBFLOAT,C'-'        MINUS =YES                                   
*                                                                               
         MVC   PRICBDTL+1(1),EBLOUT     OUTPUT LENGTH FROM EDIT BLOCK           
*                                                                               
         GOTOR EDITOR,DMCB,EBLOCK                                               
*                                                                               
         DROP  R4,R6,R7                                                         
*                                  DONE WITH THIS ELEMENT                       
CCDISX   DS    0H                                                               
         TR    PRICBDTA,MXTRT                                                   
*                                                                               
PRICBXT  DS    0H                                                               
         SR    RE,RE               CLEAR THE LAST RECORD                        
         ICM   RE,3,PRICBLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
         XIT1  REGS=(R2)                                                        
*                                                                               
CCRECNF  DC    C'CUSTOM COLUMN RECORD NOT FOUND'                                
SCRECNF  DC    C'STANDARD COLUMN RECORD NOT FOUND'                              
*                                                                               
         LTORG                                                                  
         DROP  R2                                                               
         EJECT                                                                  
*                                                                               
*                                                                               
*                                                                               
***********************************************************************         
* READCCC - READ CUSTOM COLUMN RECORD                                           
* R3 - A(BUY)                                                                   
*                                                                               
* ON EXIT - CUSTOM COLUMN RECORD IN COMREC, CC EQUAL                            
*           CC UNEQUAL, IF RECORD NOT FOUND                                     
***********************************************************************         
READCCC  NTR1  BASE=*,LABEL=*                                                   
         XC    WKKEY,WKKEY                                                      
C        USING PCOLRECD,WKKEY                                                   
         MVC   C.PCOLPAGY,PBUYKAGY-PBUYKEY(R3)                                  
         MVI   C.PCOLPMED,C'A'     MEDIA ALWAYS A FOR CUST COL'S                
         MVI   C.PCOLPRCD,X'D1'    RECORD CODE FOR PASSIVE KEY                  
         L     RF,SVELADR          POINT R6 TO CUSTOM COLUMN ELEMENT            
         MVC   C.PCOLPSQN,BYCCSQN-BYCCELD(RF)  SEQUENCE NUMBER                  
         XC    C.PCOLPSQN,=X'FFFF'    COMPLEMENT SEQUENCE NUMBER                
         DROP  C                                                                
*                                                                               
         LA    RF,COMREC                                                        
         CLC   WKKEY(L'PCOLPKEY),0(RF)   DO WE HAVE THE CUST COL REC ?          
         JE    YES                       YES, ALL DONE                          
*                                                                               
         MVC   WKKEYSAV,WKKEY                                                   
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
         CLC   WKKEY(L'PCOLPKEY),WKKEYSAV                                       
         BE    READCC50            GET THE RECORD                               
*                                                                               
         MVI   CCRECSW,C'X'        CUSTOM COLUMN REC NOT FOUND                  
         B     READCC55            RESORE READ SEQ AND EXIT                     
*                                                                               
READCC50 DS    0H                  READ RECORD INTO COMREC                      
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,GETREC,PRTFIL,WKKEY+27,COMREC,WORK12D                  
*                                                                               
READCC55 DS    0H                  RESTORE KEY AND SEQUENCE                     
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(L'PBUYKEY),PBUYREC                                         
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
READCC60 DS    0H                  OUTPUT THE BUY CUST COL DATA                 
         CLI   CCRECSW,C'X'        CUSTOM COLUMN REC NOT FOUND ??               
         JE    NO                                                               
         J     YES                                                              
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
***********************************************************************         
* READSTC - READ STANDARD COLUMN RECORD                                         
*                                                                               
* ON EXIT - CUSTOM COLUMN RECORD IN COMREC, CC EQUAL                            
*           CC UNEQUAL, IF RECORD NOT FOUND                                     
***********************************************************************         
READSTC  NTR1  BASE=*,LABEL=*                                                   
         L     RF,=V(UTL)                                                       
         MVC   SVTSYS,4(RF)                                                     
         MVI   4(RF),X'0A'                                                      
*                                                                               
         XC    WKKEY,WKKEY                                                      
S        USING GCOLRECD,WKKEY                                                   
         MVC   S.GCOLPRID,=AL3(GCOLPRIQ)                                        
         MVI   S.GCOLPMED,C'A'     MEDIA ALWAYS A FOR CUST COL'S                
         MVI   S.GCOLPRCD,GCOLPRCQ RECORD CODE FOR PASSIVE KEY                  
         L     RF,SVELADR          POINT R6 TO CUSTOM COLUMN ELEMENT            
         MVC   S.GCOLPSQN,BYCCSQN-BYCCELD(RF)  SEQUENCE NUMBER                  
         XC    S.GCOLPSQN,=X'FFFF'    COMPLEMENT SEQUENCE NUMBER                
         DROP  S                                                                
*                                                                               
         LA    RF,COMREC                                                        
         CLC   WKKEY(L'GCOLPKEY),0(RF)   DO WE HAVE THE CUST COL REC ?          
         JE    READSTYES                 YES, ALL DONE                          
*                                                                               
         MVC   WKKEYSAV,WKKEY                                                   
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),GENDIR,WKKEY,WKKEY,0                        
*                                                                               
         CLC   WKKEY(L'GCOLPKEY),WKKEYSAV                                       
         JNE   READSTNO                                                         
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,GETREC,GENFIL,WKKEY+36,COMREC,WORK12D                  
*                                                                               
READSTYES DS   0H                                                               
READSTNO IPM   RE                                                               
         L     RF,=V(UTL)                                                       
         MVC   4(1,RF),SVTSYS                                                   
         SPM   RE                                                               
         J     EXIT                                                             
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
***********************************************************************         
* BUYSUMMARY                                                                    
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
BUYSMMRY NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING PRIBSD,R2                                                        
*                                                                               
         LA    R0,PRIBSD           CLEAR THE RECORD                             
         LA    R1,PRIBSDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
*                                                                               
         XC    PRIBSLEN,PRIBSLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIBSLEN(2),=AL2(PRIBSDL)                                        
         MVC   PRIBSTYP,PRBSQ                                                   
         MVI   PRIBSDX,MXTRTQ                                                   
         MVI   PRIBSDX+1,MXTRTQ                                                 
         MVI   PRIBSAGY-1,MXTRTQ                                                
         MVI   PRIBSMED-1,MXTRTQ                                                
         MVI   PRIBSCNT-1,MXTRTQ                                                
         MVI   PRIBSSER-1,MXTRTQ                                                
         MVI   PRIBSBLT-1,MXTRTQ                                                
         MVI   PRIBSPRD-1,MXTRTQ                                                
         MVI   PRIBSGRS-1,MXTRTQ                                                
         MVI   PRIBSCOM-1,MXTRTQ                                                
         MVI   PRIBSCDS-1,MXTRTQ                                                
         MVI   PRIBSPGR-1,MXTRTQ                                                
         MVI   PRIBSPCM-1,MXTRTQ                                                
         MVI   PRIBSPCD-1,MXTRTQ                                                
         MVI   PRIBSBGR-1,MXTRTQ                                                
         MVI   PRIBSBCM-1,MXTRTQ                                                
         MVI   PRIBSBCD-1,MXTRTQ                                                
         MVI   PRIBSTAX-1,MXTRTQ                                                
         MVI   PRIBSGST-1,MXTRTQ                                                
         MVI   PRIBSPGS-1,MXTRTQ                                                
         MVI   PRIBSBGS-1,MXTRTQ                                                
         MVI   PRIBSPST-1,MXTRTQ                                                
         MVI   PRIBSPPS-1,MXTRTQ                                                
         MVI   PRIBSBPS-1,MXTRTQ                                                
         MVI   PRIBSC2D-1,MXTRTQ                                                
*                                                                               
         MVI   PRISSGRS-1,MXTRTQ                                                
         MVI   PRISSCOM-1,MXTRTQ                                                
         MVI   PRISSCDS-1,MXTRTQ                                                
         MVI   PRISSPGR-1,MXTRTQ                                                
         MVI   PRISSPCM-1,MXTRTQ                                                
         MVI   PRISSPCD-1,MXTRTQ                                                
         MVI   PRISSBGR-1,MXTRTQ                                                
         MVI   PRISSBCM-1,MXTRTQ                                                
         MVI   PRISSBCD-1,MXTRTQ                                                
         MVI   PRISSTAX-1,MXTRTQ                                                
         MVI   PRISSGST-1,MXTRTQ                                                
         MVI   PRISSPGS-1,MXTRTQ                                                
         MVI   PRISSBGS-1,MXTRTQ                                                
         MVI   PRISSPST-1,MXTRTQ                                                
         MVI   PRISSPPS-1,MXTRTQ                                                
         MVI   PRISSBPS-1,MXTRTQ                                                
         MVI   PRISSC2D-1,MXTRTQ                                                
*                                  PLANNED COST DOLLARS FOLLOW                  
         MVI   PRIPCGRS-1,MXTRTQ                                                
         MVI   PRIPCCOM-1,MXTRTQ                                                
*****    MVI   PRIPCBGR-1,MXTRTQ                                                
*****    MVI   PRIPCBCM-1,MXTRTQ                                                
*****    MVI   PRIPCTAX-1,MXTRTQ                                                
*****    MVI   PRIPCGST-1,MXTRTQ                                                
*****    MVI   PRIPCBGS-1,MXTRTQ                                                
*****    MVI   PRIPCPST-1,MXTRTQ                                                
*****    MVI   PRIPCBPS-1,MXTRTQ                                                
         MVI   PRIBSFXO-1,MXTRTQ                                                
         MVI   PRIBSFXP-1,MXTRTQ                                                
         MVI   PRIBSFXA-1,MXTRTQ                                                
*                                                                               
         MVI   PRIBBC2G-1,MXTRTQ                                                
         MVI   PRIBBC2N-1,MXTRTQ                                                
         MVI   PRIBBFXG-1,MXTRTQ                                                
         MVI   PRIBBFXN-1,MXTRTQ                                                
*                                                                               
X3       USING PRIBYD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   PRIBSACT,X3.PRIBYACT                                             
         MVC   PRIBSDAT,X3.PRIBYDAT                                             
         MVC   PRIBSTME,X3.PRIBYTME                                             
*        CLI   X3.PRIBYACT,C'C'                                                 
*        BNE   *+8                                                              
         MVI   PRIBSACT,C'A'                                                    
         DROP  X3                                                               
*                                                                               
         MVC   PRIBSAGY,PBUYKAGY   AGENCY                                       
         TR    PRIBSAGY,MXTRT                                                   
         MVC   PRIBSMED,PBUYKMED   MEDIA                                        
         TR    PRIBSMED,MXTRT                                                   
         MVC   PRIBSCNT,PBUYKCLT   CLIENT                                       
         TR    PRIBSCNT,MXTRT                                                   
         MVC   PRIBSPRD,PBUYKPRD   PRODUCT                                      
         MVI   PRIBSBLT,C'Y'       BUY LINE TOTAL                               
*                                                                               
         CLI   ZZZFLAG,X'01'       CHECK IF WE IN POOL                          
         BNE   PBUS0009                                                         
*                                                                               
         MVI   PRIBSBLT,C'N'       FOR EACH INDIVDUAL PRD BUYTOTAL 'N'          
         MVC   PRIBSPRD,0(R7)                                                   
         AHI   R7,3                BUMP TO THE NEXT ENTRY IN POOLTAB            
*                                                                               
PBUS0009 DS    0H                                                               
         TR    PRIBSPRD,MXTRT                                                   
         TR    PRIBSBLT,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'99'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBUS0010                                                         
*                                                                               
         USING PSERELD,R6                                                       
         EDIT  (P5,PSERNUM),PRIBSSER,FILL=0                                     
         DROP  R6                                                               
*                                                                               
PBUS0010 DS    0H                                                               
         TR    PRIBSSER,MXTRT                                                   
*                                                                               
         CLC   PRIBSPRD,=C'ZZZ'       IF NOT IN POOL DON'T LOOK                 
         JNE   PBUS0030               FOR 21 ELEMENT                            
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'21'                                                     
         BRAS  RE,GETEL                                                         
*BUG**   JNE   PBUY0030            BUG FOUND 9/17/07                            
         JNE   PBUS0030                                                         
*                                                                               
         USING ZZZPOOLD,R6                                                      
         LA    R7,POOLTAB                                                       
PBUS0015 MVC   0(3,R7),PPRCODE                                                  
         AHI   R7,3                                                             
*                                                                               
         BRAS  RE,NEXTEL                                                        
         JNE   PBUS0029                                                         
         J     PBUS0015                                                         
*                                                                               
*                                                                               
PBUS0029 DS    0H                                                               
         MVI   0(R7),X'FF'                                                      
         LA    R7,POOLTAB                                                       
*                                                                               
PBUS0030 DS    0H                                                               
*                                                                               
*BBBB     DC    H'0'                                                            
*****    GOTO1 GETINS,DMCB,PBUYREC,PVALUES,PRIBSPRD,C'X'                        
*                                                                               
         GOTO1 GETINS,DMCB,PBUYREC,PVALUES,PRIBSPRD,(C'X',0),=C'PST',0          
*                                                                               
         L     R1,DMCB+16          POINT TO RETURNED GST/PST DATA               
         ST    R1,REG1SV                                                        
*                                                                               
         EDIT  GROSS,PRIBSGRS,FILL=0                                            
         TM    GROSS,X'80'                                                      
         BZ    *+8                                                              
         MVI   PRIBSGRS,C'-'                                                    
         EDIT  AGYCOM,PRIBSCOM,FILL=0                                           
         TM    AGYCOM,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBSCOM,C'-'                                                    
         EDIT  CSHDSC,PRIBSCDS,FILL=0                                           
         TM    CSHDSC,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBSCDS,C'-'                                                    
         EDIT  PGROSS,PRIBSPGR,FILL=0                                           
         TM    PGROSS,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBSPGR,C'-'                                                    
         EDIT  PAGYCOM,PRIBSPCM,FILL=0                                          
         TM    PAGYCOM,X'80'                                                    
         BZ    *+8                                                              
         MVI   PRIBSPCM,C'-'                                                    
         EDIT  PCSHDSC,PRIBSPCD,FILL=0                                          
         TM    PCSHDSC,X'80'                                                    
         BZ    *+8                                                              
         MVI   PRIBSPCD,C'-'                                                    
         EDIT  BGROSS,PRIBSBGR,FILL=0                                           
         TM    BGROSS,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBSBGR,C'-'                                                    
         EDIT  BAGYCOM,PRIBSBCM,FILL=0                                          
         TM    BAGYCOM,X'80'                                                    
         BZ    *+8                                                              
         MVI   PRIBSBCM,C'-'                                                    
         EDIT  BCSCHDSC,PRIBSBCD,FILL=0                                         
         TM    BCSCHDSC,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRIBSBCD,C'-'                                                    
         EDIT  TAX,PRIBSTAX,FILL=0                                              
         TM    TAX,X'80'                                                        
         BZ    *+8                                                              
         MVI   PRIBSTAX,C'-'                                                    
*                                                                               
         TM    PBDCNDA,X'80'       CANADIAN AGENCY ?                            
         BZ    PBUS0040            NO                                           
*                                                                               
******   B     PBUS0040            ***** TESTING ****                           
*                                                                               
         L     R5,REG1SV           POINT TO RETURNED GST/PST DATA               
         USING GVALUES,R5                                                       
*                                                                               
******   MVC   MGSTTAX(8),GSTTAX  SAVE RETURNED GST ORDERED AND PAID            
*                                                                               
*        ACCUMULATE PST DATA                                                    
*                                                                               
         XC    MPSTTAX(12),MPSTTAX     INIT PST ACCUMULATORS AREA               
*                                                                               
         LA    RE,PSTAREA                                                       
*                                                                               
SVPSTLP  CLI   0(RE),C' '          SKIP IF NO PST DATA                          
         BNH   SVPSTDN                                                          
*                                                                               
         L     R0,MPSTTAX          ACCUMULATE ORDER PST TAX                     
         A     R0,PSTTAX-PSTAREA(RE)     PAYABLE                                
*****    A     R0,PSTTAXPD-PSTAREA(RE)   PAID                                   
         ST    R0,MPSTTAX                                                       
*                                                                               
         L     R0,MPSTTAXP         ACCUMULATE PAID PST TAX                      
         A     R0,PSTTAXPD-PSTAREA(RE)   PAID                                   
         ST    R0,MPSTTAXP                                                      
*                                                                               
         L     R0,MPSTTAXB         ACCUMULATE BILLED PST TAX                    
         A     R0,PSTTAXBL-PSTAREA(RE)   BILLED                                 
         ST    R0,MPSTTAXB                                                      
*                                                                               
         LA    RE,PSTAREAL(RE)                                                  
         B     SVPSTLP              GO DO NEXT PROVINCE                         
*                                                                               
SVPSTDN  DS    0H                                                               
*                                                                               
*****    L     R0,GSTTAX           GET PAYABLE GST TAX                          
*****    A     R0,GSTTAXPD         ADD PAID    GST TAX                          
*****    ST    R0,GSTTAX             = ORDERED GST TAX                          
*                                                                               
         EDIT  GSTTAX,PRIBSGST,FILL=0      ORDERED GST TAX                      
         TM    GSTTAX,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBSGST,C'-'                                                    
         EDIT  GSTTAXPD,PRIBSPGS,FILL=0    PAID    GST TAX                      
         TM    GSTTAXPD,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRIBSPGS,C'-'                                                    
         EDIT  GSTTAXBL,PRIBSBGS,FILL=0    BILLED  GST TAX                      
         TM    GSTTAXBL,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRIBSBGS,C'-'                                                    
*                                                                               
         DROP  R5                                                               
*                                                                               
         EDIT  MPSTTAX,PRIBSPST,FILL=0     ORDERED PST TAX                      
         TM    MPSTTAX,X'80'                                                    
         BZ    *+8                                                              
         MVI   PRIBSPST,C'-'                                                    
         EDIT  MPSTTAXP,PRIBSPPS,FILL=0    PAID    PST TAX                      
         TM    MPSTTAXP,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRIBSPPS,C'-'                                                    
         EDIT  MPSTTAXB,PRIBSBPS,FILL=0    BILLED  PST TAX                      
         TM    MPSTTAXB,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRIBSBPS,C'-'                                                    
PBUS0040 DS    0H                                                               
*                                     NOW DO COS2 DOLLARS                       
         GOTO1 GETINS,DMCB,PBUYREC,(C'O',PVALUES),PRIBSPRD,(C'X',0)             
         EDIT  GROSS,PRIBSC2D,FILL=0                                            
         TM    GROSS,X'80'                                                      
         BZ    *+8                                                              
         MVI   PRIBSC2D,C'-'                                                    
*                                                                               
* SPEC-45902                                                                    
* BILLED COST 2                                                                 
*                                                                               
         EDIT  BGROSS,PRIBBC2G,FILL=0                                           
         TM    BGROSS,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBBC2G,C'-'                                                    
*                                                                               
         L     R1,BCSCHDSC         CASH DISCOUNT BILLED                         
         A     R1,BILLED           ACTUAL BILLED AMOUNT (G-COMM-CD)             
         ST    R1,FULL                                                          
*                                                                               
         EDIT  (R1),PRIBBC2N,FILL=0                                             
         TM    FULL,X'80'                                                       
         BZ    *+8                                                              
         MVI   PRIBBC2N,C'-'                                                    
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*        ADDITIONAL CHARGE SUMMARIES FOLLOW                                     
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         GOTO1 GETINS,DMCB,PBUYREC,PVALUES,PRIBSPRD,(C'F',0),=C'PST',  X        
               =C'ALL'                                                          
*                                                                               
         L     R1,DMCB+16          POINT TO RETURNED GST/PST DATA               
         ST    R1,REG1SV                                                        
*                                                                               
         EDIT  GROSS,PRISSGRS,FILL=0                                            
         TM    GROSS,X'80'                                                      
         BZ    *+8                                                              
         MVI   PRISSGRS,C'-'                                                    
         EDIT  AGYCOM,PRISSCOM,FILL=0                                           
         TM    AGYCOM,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRISSCOM,C'-'                                                    
         EDIT  CSHDSC,PRISSCDS,FILL=0                                           
         TM    CSHDSC,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRISSCDS,C'-'                                                    
         EDIT  PGROSS,PRISSPGR,FILL=0                                           
         TM    PGROSS,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRISSPGR,C'-'                                                    
         EDIT  PAGYCOM,PRISSPCM,FILL=0                                          
         TM    PAGYCOM,X'80'                                                    
         BZ    *+8                                                              
         MVI   PRISSPCM,C'-'                                                    
         EDIT  PCSHDSC,PRISSPCD,FILL=0                                          
         TM    PCSHDSC,X'80'                                                    
         BZ    *+8                                                              
         MVI   PRISSPCD,C'-'                                                    
         EDIT  BGROSS,PRISSBGR,FILL=0                                           
         TM    BGROSS,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRISSBGR,C'-'                                                    
         EDIT  BAGYCOM,PRISSBCM,FILL=0                                          
         TM    BAGYCOM,X'80'                                                    
         BZ    *+8                                                              
         MVI   PRISSBCM,C'-'                                                    
         EDIT  BCSCHDSC,PRISSBCD,FILL=0                                         
         TM    BCSCHDSC,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRISSBCD,C'-'                                                    
         EDIT  TAX,PRISSTAX,FILL=0                                              
         TM    TAX,X'80'                                                        
         BZ    *+8                                                              
         MVI   PRISSTAX,C'-'                                                    
*                                                                               
         TM    PBDCNDA,X'80'       CANADIAN AGENCY ?                            
         BZ    PBUS0050            NO                                           
*                                                                               
******   B     PBUS0050            ***** TESTING ****                           
*                                                                               
         L     R5,REG1SV           POINT TO RETURNED GST/PST DATA               
         USING GVALUES,R5                                                       
*                                                                               
******   MVC   MGSTTAX(8),GSTTAX  SAVE RETURNED GST ORDERED AND PAID            
*                                                                               
*        ACCUMULATE PST DATA                                                    
*                                                                               
         XC    MPSTTAX(12),MPSTTAX     INIT PST ACCUMULATORS AREA               
*                                                                               
         LA    RE,PSTAREA                                                       
*                                                                               
SVPSTLPA CLI   0(RE),C' '          SKIP IF NO PST DATA                          
         BNH   SVPSTDNA                                                         
*                                                                               
         L     R0,MPSTTAX          ACCUMULATE ORDER PST TAX                     
         A     R0,PSTTAX-PSTAREA(RE)     PAYABLE                                
******   A     R0,PSTTAXPD-PSTAREA(RE)   PAID                                   
         ST    R0,MPSTTAX                                                       
*                                                                               
         L     R0,MPSTTAXP         ACCUMULATE PAID PST TAX                      
         A     R0,PSTTAXPD-PSTAREA(RE)   PAID                                   
         ST    R0,MPSTTAXP                                                      
*                                                                               
         L     R0,MPSTTAXB         ACCUMULATE BILLED PST TAX                    
         A     R0,PSTTAXBL-PSTAREA(RE)   BILLED                                 
         ST    R0,MPSTTAXB                                                      
*                                                                               
         LA    RE,PSTAREAL(RE)                                                  
         B     SVPSTLPA             GO DO NEXT PROVINCE                         
*                                                                               
SVPSTDNA DS    0H                                                               
*                                                                               
******   L     R0,GSTTAX           GET PAYABLE GST TAX                          
******   A     R0,GSTTAXPD         ADD PAID    GST TAX                          
******   ST    R0,GSTTAX             = ORDERED GST TAX                          
*                                                                               
         EDIT  GSTTAX,PRISSGST,FILL=0       ORDERED GST TAX                     
         TM    GSTTAX,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRISSGST,C'-'                                                    
         EDIT  GSTTAXPD,PRISSPGS,FILL=0     PAID    GST TAX                     
         TM    GSTTAXPD,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRISSPGS,C'-'                                                    
         EDIT  GSTTAXBL,PRISSBGS,FILL=0     BILLED  GST TAX                     
         TM    GSTTAXBL,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRISSBGS,C'-'                                                    
*                                                                               
         DROP  R5                                                               
*                                                                               
         EDIT  MPSTTAX,PRISSPST,FILL=0      ORDERED PST TAX                     
         TM    MPSTTAX,X'80'                                                    
         BZ    *+8                                                              
         MVI   PRISSPST,C'-'                                                    
         EDIT  MPSTTAXP,PRISSPPS,FILL=0     PAID    PST TAX                     
         TM    MPSTTAXP,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRISSPPS,C'-'                                                    
         EDIT  MPSTTAXB,PRISSBPS,FILL=0     BILLED  PST TAX                     
         TM    MPSTTAXB,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRISSBPS,C'-'                                                    
PBUS0050 DS    0H                                                               
*                                     NOW DO COS2 DOLLARS                       
         GOTO1 GETINS,DMCB,PBUYREC,(C'O',PVALUES),PRIBSPRD,            X        
               (C'F',0),,=C'ALL'                                                
*                                                                               
         EDIT  GROSS,PRISSC2D,FILL=0                                            
         TM    GROSS,X'80'                                                      
         BZ    *+8                                                              
         MVI   PRISSC2D,C'-'                                                    
*                                     PLANNED COST DOLLARS FOLLOW               
*                                                                               
         GOTO1 GETINS,DMCB,PBUYREC,(C'P',PVALUES),PRIBSPRD,(C'X',0),   X        
               =C'BOTH',0                                                       
*                                                                               
         CLI   4(R1),C'X'             NO PLANNED COST DATA ?                    
         BE    PBUS0060               YES                                       
*                                                                               
         EDIT  GROSS,PRIPCGRS,FILL=0     GROSS                                  
         TM    GROSS,X'80'                                                      
         BZ    *+8                                                              
         MVI   PRIPCGRS,C'-'                                                    
         EDIT  AGYCOM,PRIPCCOM,FILL=0    COMMISSION                             
         TM    AGYCOM,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIPCCOM,C'-'                                                    
*****    EDIT  BGROSS,PRIPCBGR,FILL=0    BILLED GROSS                           
*****    TM    BGROSS,X'80'                                                     
*****    BZ    *+8                                                              
*****    MVI   PRIPCBGR,C'-'                                                    
*****    EDIT  BAGYCOM,PRIPCBCM,FILL=0   BILLED COMMISSION                      
*****    TM    BAGYCOM,X'80'                                                    
*****    BZ    *+8                                                              
*****    MVI   PRIPCBCM,C'-'                                                    
*****    EDIT  TAX,PRIPCTAX,FILL=0       SALES TAX                              
*****    TM    TAX,X'80'                                                        
*****    BZ    *+8                                                              
*****    MVI   PRIPCTAX,C'-'                                                    
*****    EDIT  GSTTAX,PRIPCGST,FILL=0    GST                                    
*****    TM    GSTTAX,X'80'                                                     
*****    BZ    *+8                                                              
*****    MVI   PRIPCGST,C'-'                                                    
*****    EDIT  GSTTAXBL,PRIPCBGS,FILL=0  BILLED GST                             
*****    TM    GSTTAXBL,X'80'                                                   
*****    BZ    *+8                                                              
*****    MVI   PRIPCBGS,C'-'                                                    
*****    EDIT  PSTTAX,PRIPCPST,FILL=0    PST                                    
*****    TM    PSTTAX,X'80'                                                     
*****    BZ    *+8                                                              
*****    MVI   PRIPCPST,C'-'                                                    
*****    EDIT  PSTTAXBL,PRIPCBPS,FILL=0  BILLED PST                             
*****    TM    PSTTAXBL,X'80'                                                   
*****    BZ    *+8                                                              
*****    MVI   PRIPCBPS,C'-'                                                    
*                                                                               
PBUS0060 DS    0H                                                               
         XR    R0,R0                                                            
         EDIT  (R0),PRIBSFXO,FILL=0                                             
         EDIT  (R0),PRIBSFXP,FILL=0                                             
         EDIT  (R0),PRIBSFXA,FILL=0                                             
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,BYCCIDQ      CUSTOM COLUMN ELEMENT                        
         BRAS  RE,GETEL                                                         
         JNE   PBUS0070            NO CUSTOM COLUMN ELEMENT                     
         J     PBUS0062                                                         
*                                                                               
PBUS0061 DS    0H                                                               
         BRAS  RE,NEXTEL                                                        
         JNE   PBUS0070            NO CUSTOM COLUMN ELEMENT                     
*                                                                               
PBUS0062 DS    0H                                                               
         CLI   0(R6),BYCCIDQ                                                    
         JNE   PBUS0070                                                         
*                                                                               
         CLC   2(2,R6),=X'200F'    FOREIGN EXCHANGE?                            
         BNE   PBUS0061                                                         
*                                                                               
         GOTO1 GETINS,DMCB,PBUYREC,PVALUES,(C'Y',PBUYKPRD),(C'A',0),0, X        
               =C'FX'                                                           
*                                                                               
         EDIT  GROSS,PRIBSFXO,FILL=0                                            
         TM    GROSS,X'80'                                                      
         BZ    *+8                                                              
         MVI   PRIBSFXO,C'-'                                                    
         EDIT  PGROSS,PRIBSFXP,FILL=0                                           
         TM    PGROSS,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBSFXP,C'-'                                                    
         EDIT  PYABLE,PRIBSFXA,FILL=0                                           
         TM    PYABLE,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBSFXA,C'-'                                                    
*                                                                               
PBUS0070 DS    0H                                                               
         TR    PRIBSFXO,MXTRT                                                   
         TR    PRIBSFXP,MXTRT                                                   
         TR    PRIBSFXA,MXTRT                                                   
*                                                                               
* SPEC-45902                                                                    
* BILLED FX                                                                     
*                                                                               
         MVC   GROSS,=C'CRATE'                                                  
         GOTO1 GETINS,DMCB,PBUYREC,PVALUES,PRIBSPRD,                   X        
               (C'A',=X'000000000000'),=C'BOTH',=C'FX'                          
*                                                                               
         EDIT  BGROSS,PRIBBFXG,FILL=0                                           
         TM    BGROSS,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBBFXG,C'-'                                                    
*                                                                               
         L     R1,BCSCHDSC         CASH DISCOUNT BILLED                         
         A     R1,BILLED           ACTUAL BILLED AMOUNT (G-COMM-CD)             
         ST    R1,FULL                                                          
*                                                                               
         EDIT  (R1),PRIBBFXN,FILL=0                                             
         TM    FULL,X'80'                                                       
         BZ    *+8                                                              
         MVI   PRIBBFXN,C'-'                                                    
*                                                                               
PBUSEND  DS    0H                                                               
*                                                                               
         TR    PRIBSGRS,MXTRT                                                   
         TR    PRIBSCOM,MXTRT                                                   
         TR    PRIBSCDS,MXTRT                                                   
         TR    PRIBSPGR,MXTRT                                                   
         TR    PRIBSPCM,MXTRT                                                   
         TR    PRIBSPCD,MXTRT                                                   
         TR    PRIBSBGR,MXTRT                                                   
         TR    PRIBSBCM,MXTRT                                                   
         TR    PRIBSBCD,MXTRT                                                   
         TR    PRIBSTAX,MXTRT                                                   
         TR    PRIBSGST,MXTRT                                                   
         TR    PRIBSPGS,MXTRT                                                   
         TR    PRIBSBGS,MXTRT                                                   
         TR    PRIBSPST,MXTRT                                                   
         TR    PRIBSPPS,MXTRT                                                   
         TR    PRIBSBPS,MXTRT                                                   
         TR    PRIBSC2D,MXTRT                                                   
*                                                                               
         TR    PRISSGRS,MXTRT                                                   
         TR    PRISSCOM,MXTRT                                                   
         TR    PRISSCDS,MXTRT                                                   
         TR    PRISSPGR,MXTRT                                                   
         TR    PRISSPCM,MXTRT                                                   
         TR    PRISSPCD,MXTRT                                                   
         TR    PRISSBGR,MXTRT                                                   
         TR    PRISSBCM,MXTRT                                                   
         TR    PRISSBCD,MXTRT                                                   
         TR    PRISSTAX,MXTRT                                                   
         TR    PRISSGST,MXTRT                                                   
         TR    PRISSPGS,MXTRT                                                   
         TR    PRISSBGS,MXTRT                                                   
         TR    PRISSPST,MXTRT                                                   
         TR    PRISSPPS,MXTRT                                                   
         TR    PRISSBPS,MXTRT                                                   
         TR    PRISSC2D,MXTRT                                                   
*                                  PLANNED COST DOLLARS FOLLOW                  
         TR    PRIPCGRS,MXTRT                                                   
         TR    PRIPCCOM,MXTRT                                                   
*****    TR    PRIPCBGR,MXTRT                                                   
*****    TR    PRIPCBCM,MXTRT                                                   
*****    TR    PRIPCTAX,MXTRT                                                   
*****    TR    PRIPCGST,MXTRT                                                   
*****    TR    PRIPCBGS,MXTRT                                                   
*****    TR    PRIPCPST,MXTRT                                                   
*****    TR    PRIPCBPS,MXTRT                                                   
         TR    PRIBBC2G,MXTRT                                                   
         TR    PRIBBC2N,MXTRT                                                   
         TR    PRIBBFXG,MXTRT                                                   
         TR    PRIBBFXN,MXTRT                                                   
*                                                                               
         XIT1  REGS=(R7)                                                        
         DROP  R2                                                               
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
* BUYACG                                                              *         
*                                                                     *         
******* NOTE: DO NOT USE R4 OR R7 IN BELOW ROUTINE                    *         
*             R4 POINTING TO AGCTAB                                   *         
*             R7 POINTING TO POOLTAB                                  *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
BUYACG   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING PRIBAD,R2                                                        
*                                                                               
         LA    R0,PRIBAD           CLEAR THE RECORD                             
         LA    R1,PRIBADL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
*                                                                               
         XC    PRIBALEN,PRIBALEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIBALEN(2),=AL2(PRIBADL)                                        
         MVC   PRIBATYP,PRBAQ                                                   
         MVI   PRIBADX,MXTRTQ                                                   
         MVI   PRIBADX+1,MXTRTQ                                                 
         MVI   PRIBAAGY-1,MXTRTQ                                                
         MVI   PRIBAMED-1,MXTRTQ                                                
         MVI   PRIBACNT-1,MXTRTQ                                                
         MVI   PRIBASER-1,MXTRTQ                                                
         MVI   PRIBABLT-1,MXTRTQ                                                
         MVI   PRIBAPRD-1,MXTRTQ                                                
         MVI   PRIBACHG-1,MXTRTQ                                                
         MVI   PRIBAGRS-1,MXTRTQ                                                
         MVI   PRIBACOM-1,MXTRTQ                                                
         MVI   PRIBACDS-1,MXTRTQ                                                
         MVI   PRIBAPGR-1,MXTRTQ                                                
         MVI   PRIBAPCM-1,MXTRTQ                                                
         MVI   PRIBAPCD-1,MXTRTQ                                                
         MVI   PRIBABGR-1,MXTRTQ                                                
         MVI   PRIBABCM-1,MXTRTQ                                                
         MVI   PRIBABCD-1,MXTRTQ                                                
         MVI   PRIBATAX-1,MXTRTQ                                                
         MVI   PRIBAGST-1,MXTRTQ                                                
         MVI   PRIBAPGS-1,MXTRTQ                                                
         MVI   PRIBABGS-1,MXTRTQ                                                
         MVI   PRIBAPST-1,MXTRTQ                                                
         MVI   PRIBAPPS-1,MXTRTQ                                                
         MVI   PRIBABPS-1,MXTRTQ                                                
*                                                                               
X3       USING PRIBYD,R5           R5=A(INITIALIZED EXTRACT RECORD)             
         MVC   PRIBAACT,X3.PRIBYACT                                             
         MVC   PRIBADAT,X3.PRIBYDAT                                             
         MVC   PRIBATME,X3.PRIBYTME                                             
*        CLI   X3.PRIBYACT,C'C'                                                 
*        BNE   *+8                                                              
         MVI   PRIBAACT,C'A'                                                    
         DROP  X3                                                               
*                                                                               
         MVC   PRIBAAGY,PBUYKAGY   AGENCY                                       
         TR    PRIBAAGY,MXTRT                                                   
         MVC   PRIBAMED,PBUYKMED   MEDIA                                        
         TR    PRIBAMED,MXTRT                                                   
         MVC   PRIBACNT,PBUYKCLT   CLIENT                                       
         TR    PRIBACNT,MXTRT                                                   
*                              NEED CHARGE CODE FROM CALLING ROUTINE            
         MVC   PRIBACHG,0(R4)                                                   
         TR    PRIBACHG,MXTRT                                                   
*                                                                               
         MVC   PRIBAPRD,PBUYKPRD   PRODUCT                                      
         MVI   PRIBABLT,C'Y'       BUY LINE TOTAL                               
*                                                                               
         CLI   ZZZFLAG,X'01'       CHECK IF WE IN POOL                          
         JNE   PBAC009                                                          
*                                                                               
         MVI   PRIBABLT,C'N'       FOR EACH INDIVDUAL PRD BUYTOTAL 'N'          
         MVC   PRIBAPRD,0(R7)                                                   
         AHI   R7,3                BUMP TO THE NEXT ENTRY IN POOLTAB            
*                                                                               
PBAC009  DS    0H                                                               
         TR    PRIBAPRD,MXTRT                                                   
         TR    PRIBABLT,MXTRT                                                   
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'99'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBAC010                                                          
*                                                                               
         USING PSERELD,R6                                                       
         EDIT  (P5,PSERNUM),PRIBASER,FILL=0                                     
         DROP  R6                                                               
*                                                                               
PBAC010  DS    0H                                                               
         TR    PRIBASER,MXTRT                                                   
*                                                                               
         CLC   PRIBAPRD,=C'ZZZ'       IF NOT IN POOL DON'T LOOK                 
         JNE   PBAC030                FOR 21 ELEMENT                            
*                                                                               
         LA    R6,PBUYRECD                                                      
         MVI   ELCODE,X'21'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PBAC030                                                          
*                                                                               
         USING ZZZPOOLD,R6                                                      
         LA    R7,POOLTAB                                                       
PBAC015  MVC   0(3,R7),PPRCODE                                                  
         AHI   R7,3                                                             
*                                                                               
         BRAS  RE,NEXTEL                                                        
         JNE   PBAC029                                                          
         J     PBAC015                                                          
**************************************************************                  
**************************************************************                  
         DS    F                                                                
**************************************************************                  
**************************************************************                  
*                                                                               
*                                                                               
PBAC029  DS    0H                                                               
         MVI   0(R7),X'FF'                                                      
         LA    R7,POOLTAB                                                       
*                                                                               
PBAC030  DS    0H                                                               
         GOTO1 GETINS,DMCB,PBUYREC,PVALUES,PRIBAPRD,(C'A',0),=C'PST',  X        
               PRIBACHG                                                         
*                                                                               
         L     R1,DMCB+16          POINT TO RETURNED GST/PST DATA               
         ST    R1,REG1SV                                                        
*                                                                               
         EDIT  GROSS,PRIBAGRS,FILL=0                                            
         TM    GROSS,X'80'                                                      
         BZ    *+8                                                              
         MVI   PRIBAGRS,C'-'                                                    
         EDIT  AGYCOM,PRIBACOM,FILL=0                                           
         TM    AGYCOM,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBACOM,C'-'                                                    
         EDIT  CSHDSC,PRIBACDS,FILL=0                                           
         TM    CSHDSC,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBACDS,C'-'                                                    
         EDIT  PGROSS,PRIBAPGR,FILL=0                                           
         TM    PGROSS,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBAPGR,C'-'                                                    
         EDIT  PAGYCOM,PRIBAPCM,FILL=0                                          
         TM    PAGYCOM,X'80'                                                    
         BZ    *+8                                                              
         MVI   PRIBAPCM,C'-'                                                    
         EDIT  PCSHDSC,PRIBAPCD,FILL=0                                          
         TM    PCSHDSC,X'80'                                                    
         BZ    *+8                                                              
         MVI   PRIBAPCD,C'-'                                                    
         EDIT  BGROSS,PRIBABGR,FILL=0                                           
         TM    BGROSS,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBABGR,C'-'                                                    
         EDIT  BAGYCOM,PRIBABCM,FILL=0                                          
         TM    BAGYCOM,X'80'                                                    
         BZ    *+8                                                              
         MVI   PRIBABCM,C'-'                                                    
         EDIT  BCSCHDSC,PRIBABCD,FILL=0                                         
         TM    BCSCHDSC,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRIBABCD,C'-'                                                    
         EDIT  TAX,PRIBATAX,FILL=0                                              
         TM    TAX,X'80'                                                        
         BZ    *+8                                                              
         MVI   PRIBATAX,C'-'                                                    
*                                                                               
         TM    PBDCNDA,X'80'       CANADIAN AGENCY ?                            
         BZ    PBAC050             NO                                           
*                                                                               
******   B     PBAC050             ***** TESTING ****                           
*                                                                               
         L     R5,REG1SV           POINT TO RETURNED GST/PST DATA               
         USING GVALUES,R5                                                       
*                                                                               
******   MVC   MGSTTAX(8),GSTTAX  SAVE RETURNED GST ORDERED AND PAID            
*                                                                               
*        ACCUMULATE PST DATA                                                    
*                                                                               
         XC    MPSTTAX(12),MPSTTAX     INIT PST ACCUMULATORS AREA               
*                                                                               
         LA    RE,PSTAREA                                                       
*                                                                               
SVPSTLPC CLI   0(RE),C' '          SKIP IF NO PST DATA                          
         BNH   SVPSTDNC                                                         
*                                                                               
         L     R0,MPSTTAX          ACCUMULATE ORDER PST TAX                     
         A     R0,PSTTAX-PSTAREA(RE)     PAYABLE                                
******   A     R0,PSTTAXPD-PSTAREA(RE)   PAID                                   
         ST    R0,MPSTTAX                                                       
*                                                                               
         L     R0,MPSTTAXP         ACCUMULATE PAID PST TAX                      
         A     R0,PSTTAXPD-PSTAREA(RE)   PAID                                   
         ST    R0,MPSTTAXP                                                      
*                                                                               
         L     R0,MPSTTAXB         ACCUMULATE BILLED PST TAX                    
         A     R0,PSTTAXBL-PSTAREA(RE)   BILLED                                 
         ST    R0,MPSTTAXB                                                      
*                                                                               
         LA    RE,PSTAREAL(RE)                                                  
         B     SVPSTLPC             GO DO NEXT PROVINCE                         
*                                                                               
SVPSTDNC DS    0H                                                               
*                                                                               
******   L     R0,GSTTAX           GET PAYABLE GST TAX                          
******   A     R0,GSTTAXPD         ADD PAID    GST TAX                          
******   ST    R0,GSTTAX             = ORDERED GST TAX                          
*                                                                               
         EDIT  GSTTAX,PRIBAGST,FILL=0         ORDERED GST TAX                   
         TM    GSTTAX,X'80'                                                     
         BZ    *+8                                                              
         MVI   PRIBAGST,C'-'                                                    
         EDIT  GSTTAXPD,PRIBAPGS,FILL=0       PAID    GST TAX                   
         TM    GSTTAXPD,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRIBAPGS,C'-'                                                    
         EDIT  GSTTAXBL,PRIBABGS,FILL=0       BILLED  GST TAX                   
         TM    GSTTAXBL,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRIBABGS,C'-'                                                    
*                                                                               
         DROP  R5                                                               
*                                                                               
         EDIT  MPSTTAX,PRIBAPST,FILL=0        ORDERED PST TAX                   
         TM    MPSTTAX,X'80'                                                    
         BZ    *+8                                                              
         MVI   PRIBAPST,C'-'                                                    
         EDIT  MPSTTAXP,PRIBAPPS,FILL=0       PAID    PST TAX                   
         TM    MPSTTAXP,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRIBAPPS,C'-'                                                    
         EDIT  MPSTTAXB,PRIBABPS,FILL=0       BILLED  PST TAX                   
         TM    MPSTTAXB,X'80'                                                   
         BZ    *+8                                                              
         MVI   PRIBABPS,C'-'                                                    
PBAC050  DS    0H                                                               
*                                     NOW DO GROSS COS2 DOLLARS                 
         GOTO1 GETINS,DMCB,PBUYREC,(C'O',PVALUES),PRIBAPRD,            X        
               (C'A',0),,PRIBACHG                                               
         EDIT  GROSS,PRIBAC2D,FILL=0                                            
         TM    GROSS,X'80'                                                      
         BZ    *+8                                                              
         MVI   PRIBAC2D,C'-'                                                    
*                                                                               
PBAC110  DS    0H                                                               
         TR    PRIBAGRS,MXTRT                                                   
         TR    PRIBACOM,MXTRT                                                   
         TR    PRIBACDS,MXTRT                                                   
         TR    PRIBAPGR,MXTRT                                                   
         TR    PRIBAPCM,MXTRT                                                   
         TR    PRIBAPCD,MXTRT                                                   
         TR    PRIBABGR,MXTRT                                                   
         TR    PRIBABCM,MXTRT                                                   
         TR    PRIBABCD,MXTRT                                                   
         TR    PRIBATAX,MXTRT                                                   
         TR    PRIBAGST,MXTRT                                                   
         TR    PRIBAPGS,MXTRT                                                   
         TR    PRIBABGS,MXTRT                                                   
         TR    PRIBAPST,MXTRT                                                   
         TR    PRIBAPPS,MXTRT                                                   
         TR    PRIBABPS,MXTRT                                                   
         TR    PRIBAC2D,MXTRT                                                   
*                                                                               
         XIT1  REGS=(R7)                                                        
         DROP  R2                                                               
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
**************************                                                      
*********************  INSERT DATA BEFORE  ****************************         
**************************                                                      
**************************                                                      
**************************                                                      
**************************                                                      
         DS    0D                                                               
PP12468  NTR1  BASE=*,LABEL=*                                                   
         SPACE 2                                                                
****** ************************** **************************                    
* ON INPUT WORD 1   BYTE 0 = ELEMENT CODE                                       
*                        1-3 ADDRESS OF KEY                                     
*               2   OPTION - ADDRESS OF 'NOSQ' FOR NO SQUASH OPTION             
************************** **************************                           
*                                                                               
** ON RETURN         WORD 1   BYTE 0                                            
*                                1-3  ADDRESS OF TABLE OF COMMENT               
******                                                                          
*========              ========*                                                
*========              ========*                                                
         SPACE 2                                                                
*                                                                               
         XC    SAVER6(156),SAVER6                                               
*                                                                               
         ST    R1,SAVER1        SAVE POINTER                                    
         MVC   SAVPARMS,0(R1)      SAVE PARAMETERS                              
         MVC   ELCODE,0(R1)     ELEMENT CODE                                    
         MVC   REGCOMTP,4(R1)                                                   
         L     R4,BIGTABLE                                                      
         ST    R4,ANXTCOM       ADDRESS OF NEXT COMMENT                         
*                                                                               
         XCEFL (R4),5000         CLEAR                                          
*                                                                               
BC2      DS    0H                                                               
*                                                                               
*        CHECK IF A SPECIFIC LINE CALLED FOR                                    
*                                                                               
*                                                                               
         LA    R6,PBUYRECD                                                      
         LA    R6,33(R6)                                                        
*                                                                               
BC4      BAS   RE,NXTEL                                                         
         BNE   BCX       NO SOUGHT ELEMENTS                                     
*                                                                               
         CLI   1(R6),2             NO DATA?                                     
         BE    BC4                                                              
*                                                                               
         CLI   REGCOMTP,C'R'       IF LOOKING ONLY FOR REGION COMMENTS          
         BNE   *+14                                                             
         CLC   =C'REG=',2(R6)         MUST START WITH REG=                      
         BNE   BC4                                                              
*                                                                               
*                                                                               
*                                                                               
BC4A     DS    0H                                                               
*                                                                               
*        CLI   ELCODE,X'68'                                                     
*        BNE   *+14                                                             
BC5      CLC   2(4,R6),=C'COM='                                                 
         BE    BC8                 STANDARD COMMENT                             
*                                                                               
         L     R4,ANXTCOM                                                       
         ZIC   R5,1(R6)                                                         
         AHI   R5,-3                                                            
*                                                                               
         LA    R1,2(R6)            START OF COMMENT                             
         LR    RF,R5               COPY EXECUTE LENGTH                          
*                                                                               
         CLC   =C'REG=',0(R1)      STRIP OFF 'REG='                             
         BNE   *+12                                                             
         LA    R1,4(R1)                                                         
         AHI   RF,-4                                                            
*                                                                               
         LTR   RF,RF               CHECK FOR NEGATIVE LENGTH                    
         BM    *+8                                                              
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R4),0(R1)                                                    
*                                                                               
         LA    R4,2(R5,R4)         POINT TO NEXT COMMENT SAVEAREA               
         ST    R4,ANXTCOM                                                       
         B     BC4                                                              
*                                                                               
*                                                                               
BC8      DS    0H                                                               
         MVI   BYTE,0              CLEAR                                        
         MVC   SVELCOD,ELCODE      SAVE ELCODE                                  
         ST    R6,SAVER6           SAVE BUYREC'S R6                             
*                                                                               
         XC    KEY,KEY                                                          
*                                                                               
         LA    RF,PBUYREC          ADDRESS OF BUY                               
*                                                                               
         MVC   KEY(3),0(RF)        AGENCY MEDIA                                 
         MVI   KEY+3,X'40'                                                      
*                                                                               
         ZIC   R5,1(R6)            ELEMENT LENGTH                               
         SH    R5,=H'6'            REDUCE BY CODE,LEN,COM=                      
         LTR   R5,R5                                                            
         BZ    BC8X                NO NUMBER                                    
*                                                                               
         MVC   WORK(10),SPACES                                                  
         LA    R7,WORK+6                                                        
         SR    R7,R5                                                            
*                                                                               
         BCTR  R5,0                RIGHT JUSTIFY                                
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R7),6(R6)                                                    
*                                                                               
         MVC   KEY+4(6),WORK                                                    
*                                                                               
         CLC   KEY(12),COMREC                                                   
         BE    BC8B                                                             
         MVC   KEYSAVE,KEY              SAVE KEY BEFORE DO READHI               
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,KEY,KEY,0                            
*                                                                               
         CLC   KEY(12),KEYSAVE                                                  
         BE    BC8A                GET COMMENT RECORD                           
*NOP*    DC    H'0'                STND COMMENT NOT FOUND                       
         MVI   BYTE,C'X'           STND COMMENT NOT FOUND                       
         BE    BC8ARST                                                          
*                                                                               
BC8A     DS    0H                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,GETREC,PRTFIL,KEY+27,COMREC,WWWW                       
*                                                                               
BC8ARST  DS    0H                  RESTORE KEY AND SEQUENCE                     
         MVC   KEY,KEYSAVE                                                      
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,KEY,KEY,0                            
*                                                                               
         CLI   BYTE,C'X'           STND COMMENT NOT FOUND ?                     
         BE    BC8X                YES - NEXT ELEMENT                           
*                                                                               
BC8B     DS    0H                                                               
         LA    R6,COMREC                                                        
         LA    R6,33(R6)                                                        
*                                                                               
         MVI   ELCODE,X'40'                                                     
*                                                                               
         CLI   0(R6),X'40'                                                      
         BE    BC8D                                                             
*                                                                               
BC8C     BAS   RE,NXTEL                                                         
         BNE   BC8X                                                             
*                                                                               
BC8D     DS    0H                                                               
         CLC   2(5,R6),=C'SHIP='                                                
         BE    BC8C                                                             
         CLC   2(6,R6),=C'LABEL='                                               
         BE    BC8C                                                             
         CLC   2(4,R6),=C'MAT='                                                 
         BE    BC8C                                                             
         CLC   2(3,R6),=C'RC='                                                  
         BE    BC8C                                                             
*                                                                               
         ZIC   R5,1(R6)            ELEMENT LENGTH                               
         LR    R1,R6                 SAVE R6                                    
         LA    R4,2(R6)                                                         
         LR    R6,R4                                                            
*                                                                               
         SH    R5,=H'3'                                                         
         BM    BC8C                                                             
*                                                                               
         CLI   0(R4),C'+'                                                       
         BNE   *+8                                                              
         LA    R6,2(R6)                                                         
*                                                                               
         CLC   0(3,R6),=C'DC='     ONLY DC= COMMNTS                             
         BE    BC8E                                                             
*                                                                               
         L     R9,ANXTCOM                                                       
         LTR   R5,R5                                                            
         BM    BC8E                                                             
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R9),0(R4)                                                    
*                                                                               
         LA    R9,2(R5,R9)                                                      
         ST    R9,ANXTCOM                                                       
*                                                                               
BC8E     LR    R6,R1                                                            
         B     BC8C                                                             
*                                                                               
BC8X     MVC   ELCODE,SVELCOD      RESTORE ELCODE                               
         MVC   KEY,SVBUYKEY                                                     
         L     R6,SAVER6           RESTORE BUYREC'S R6                          
         B     BC4                                                              
*                                                                               
BCX      DS    0H                                                               
*                                                                               
         L     R0,ANXTCOM          CALCULATE COMMENT LENGTH                     
         L     RF,BIGTABLE         AS END MINUS START                           
         SR    R0,RF                                                            
         L     R1,SAVER1                                                        
*                                                                               
         CHI   R0,249                                                           
         BNH   BCX00                                                            
         LHI   R0,249              MAX CURRENT COMMENT (01/2007) IS 250         
*                                                                               
BCX00    DS    0H                                                               
         STC   R0,0(R1)                                                         
*                                                                               
         LR    R5,R0               SAVE LENGTH FOR SQUASHER                     
         BNP   BCX1                NOTHING FOUND                                
*                                                                               
         L     R9,BIGTABLE         START OF COMMENT                             
*                                                                               
BCXLP    DS    0H                                                               
*                                                                               
         LA    RF,L'SPACES         LENGTH OF SPACES                             
*                                                                               
         CR    RF,R0               MAKE COMMENT UPPERCASE                       
         BNH   *+6                                                              
         LR    RF,R0                                                            
*                                                                               
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         OC    0(0,R9),SPACES                                                   
*                                                                               
         LA    R9,1(RF,R9)         NEXT PORTION OF COMMENT                      
         SR    R0,RF                                                            
         BCT   R0,BCXLP                                                         
*                                                                               
BCX1     DS    0H                                                               
*                                                                               
*                                                                               
         L     R9,BIGTABLE                                                      
         L     RF,SAVER1                                                        
         STCM  R9,7,1(RF)            INITIALIZE ANXTCOM TO FIRST                
*                                                                               
         ICM   RE,15,SAVPARMS+4    GET PARAMETER                                
         CLC   =C'NOSQ',0(RE)      NO SQUASH OPTION                             
         BE    BCXIT                                                            
*                                                                               
*                                                                               
BCXIT    DS    0H                                                               
         XC    REGCOMTP,REGCOMTP                                                
         XIT1                                                                   
*                                                                               
*                                                                               
NXTEL    DS    0H                                                               
         SR    R0,R0                                                            
NXTELLP  DS    0H                                                               
         IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
*                                                                               
         CLI   0(R6),0                                                          
         BE    NXTELX1                                                          
*                                                                               
         CLC   ELCODE,0(R6)                                                     
         BER   RE                                                               
*                                                                               
         B     NXTELLP                                                          
*                                                                               
NXTELX1  LTR   R6,R6                                                            
         BR    RE                                                               
*                                                                               
         SPACE 3                                                                
         DS    0F                                                               
SAVER6   DS    F                                                                
SAVER1   DS    F                                                                
SAVPARMS DS    XL8                                                              
ANXTCOM  DS    A                                                                
WWWW     DS    CL36                                                             
KEY      DS    CL33                                                             
KEYSAVE  DS    CL33                                                             
SVBUYKEY DS    CL33                                                             
SVELCOD  DS    CL1                                                              
REGCOMTP DS    CL1                                                              
*                                                                               
BIGTABLE DC    A(BIGTABD)          5000 BYTE RECORD AREA                        
         SPACE 3                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* PRIPGD - EXTRACT PUB GROUP DEFINITION RECORD                        *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIPGD   NMOD1 WORKL,*PRIPGD*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRIPFLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIPFD,R2           R2=A(EXTRACT RECORD)                         
         USING GRPRECD,R3          R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRIPFLEN,PRIPFLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIPFLEN(2),=AL2(PRIPFDL)                                        
         MVC   PRIPFTYP,PRPFQ                                                   
         MVI   PRIPFDX,MXTRTQ                                                   
         MVI   PRIPFDX+1,MXTRTQ                                                 
         MVI   PRIPFAGY-1,MXTRTQ                                                
         MVI   PRIPFMED-1,MXTRTQ                                                
         MVI   PRIPFID-1,MXTRTQ                                                 
         MVI   PRIPFB1N-1,MXTRTQ                                                
         MVI   PRIPFB1L-1,MXTRTQ                                                
         MVI   PRIPFB2N-1,MXTRTQ                                                
         MVI   PRIPFB2L-1,MXTRTQ                                                
*                                                                               
         MVC   PRIPFAGY,GRPKAGY    AGENCY                                       
         TR    PRIPFAGY,MXTRT                                                   
         MVC   PRIPFMED,GRPKMED    MEDIA                                        
         TR    PRIPFMED,MXTRT                                                   
         MVC   PRIPFID(1),GRPKID   ID CODE                                      
         TR    PRIPFID,MXTRT                                                    
*                                                                               
         LA    R6,GRPRECD                                                       
         MVI   ELCODE,X'10'        GROUP ID DEFINITION RECORDS ELEM             
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING GRPBRKD,R6                                                       
         MVC   PRIPFB1N,GRPBK1     BREAK 1 TITLE                                
         MVC   PRIPFB2N,GRPBK2     BREAK 2 TITLE                                
         TR    PRIPFB1N,MXTRT                                                   
         TR    PRIPFB2N,MXTRT                                                   
*                                                                               
         EDIT  GRPBK1LN,PRIPFB1L,FILL=0                                         
         EDIT  GRPBK2LN,PRIPFB2L,FILL=0                                         
         TR    PRIPFB1L,MXTRT                                                   
         TR    PRIPFB2L,MXTRT                                                   
*                                                                               
         DROP  R6                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIPFLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIPBG - EXTRACT PUB GROUP RECORD                                             
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIPBG   NMOD1 WORKL,*PRIPBG*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRIPGLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIPGRD,R2           R2=A(EXTRACT RECORD)                        
         USING GRPRECD,R3          R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRIPGLEN,PRIPGLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIPGLEN(2),=AL2(PRIPGDL)                                        
         MVC   PRIPGTYP,PRPGQ                                                   
         MVI   PRIPGDX,MXTRTQ                                                   
         MVI   PRIPGDX+1,MXTRTQ                                                 
         MVI   PRIPGAGY-1,MXTRTQ                                                
         MVI   PRIPGMED-1,MXTRTQ                                                
         MVI   PRIPGID-1,MXTRTQ                                                 
         MVI   PRIPGGRP-1,MXTRTQ                                                
         MVI   PRIPGPGP-1,MXTRTQ                                                
         MVI   PRIPGB1C-1,MXTRTQ                                                
         MVI   PRIPGB2C-1,MXTRTQ                                                
         MVI   PRIPGB1N-1,MXTRTQ                                                
         MVI   PRIPGB2N-1,MXTRTQ                                                
*                                                                               
         MVC   PRIPGAGY,GRPKAGY    AGENCY                                       
         TR    PRIPGAGY,MXTRT                                                   
         MVC   PRIPGMED,GRPKMED    MEDIA                                        
         TR    PRIPGMED,MXTRT                                                   
         MVC   PRIPGID(1),GRPKID   GROUP ID                                     
         TR    PRIPGID,MXTRT                                                    
*                                                                               
         LA    R6,GRPRECD                                                       
         MVI   ELCODE,X'20'        GROUP CODE RECORDS ONLY                      
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING GRPGRPD,R6                                                       
         MVC   PRIPGB1N,GRPGNAM1   BREAK 1 NAME                                 
         MVC   PRIPGB2N,GRPGNAM2   BREAK 2 NAME                                 
         TR    PRIPGB1N,MXTRT                                                   
         TR    PRIPGB2N,MXTRT                                                   
*                                                                               
         DROP  R6                                                               
*                                                                               
*                                  GET THE DEFINITION RECORD                    
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(GRPKCODE-GRPKEY),GRPKEY                                    
*                                                                               
         LA    R6,COMREC                                                        
         CLC   WKKEY(L'GRPKEY),0(R6)   DO WE HAVE THE DEF RECORD                
         BE    PRIPG10                 YES                                      
*                                                                               
         MVC   WKKEYSAV,WKKEY                                                   
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
         CLC   WKKEY(L'GRPKEY),WKKEYSAV                                         
         BE    *+6                                                              
         DC    H'0'                DEF RECORD NOT FOUND                         
*                                  READ DEF RECORD INTO COMREC                  
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,GETREC,PRTFIL,WKKEY+27,COMREC,WORK12D                  
*                                                                               
*                                  RESTORE KEY AND SEQUENCE                     
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(L'GRPKEY),GRPKEY                                           
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
PRIPG10  DS    0H                  GET THE BREAK LENGTHS                        
         LA    R6,COMREC                                                        
         MVI   ELCODE,X'10'        IN DEFINITION RECORDS ONLY                   
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING GRPBRKD,R6                                                       
         MVC   SVBK1LN,GRPBK1LN    BREAK 1 LENGTH                               
         MVC   SVBK2LN,GRPBK2LN    BREAK 2 LENGTH                               
*                                                                               
         DROP  R6                                                               
*                                                                               
         MVC   SVGRPID,GRPKID             GROUP ID                              
         MVC   SVGRPCOD,GRPKCODE          XL2 PWOS                              
         ICM   RE,B'1100',GRPKCODE        GROUP CODE                            
         SRL   RE,12                   DD DD ?? ??  =>  00 0D DD D?             
         ST    RE,FULL                                                          
         OI    FULL+3,X'0F'                                                     
         UNPK  CODECHAR(5),FULL+1(3)   00 0D DD DS  =>  Z0 ZD ZD ZD ZD          
*                                                                               
         ZIC   R6,SVBK1LN          L'BREAK CODES                                
         ZIC   R0,SVBK2LN                                                       
         AR    R6,R0               L'WHOLE GROUP CODE                           
         BCTR  R6,0                                                             
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   PRIPGGRP(0),CODECHAR+1    CODE TO FIELD BLANK PADDED             
*                                                                               
         MVC   PRIPGPGP(2),PRIPGID       ID TO START OF FIELD                   
         MVC   PRIPGPGP+2(4),PRIPGGRP    CODE TO FINISH FIELD                   
*                                                                               
         TR    PRIPGGRP,MXTRT                                                   
         TR    PRIPGPGP,MXTRT                                                   
*                                  OUTPUT BREAK1 AND BREAK2 CODES               
         ZIC   R6,SVBK1LN          BREAK1 CODE LENGTH                           
         BCTR  R6,0                                                             
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   PRIPGB1C(0),PRIPGGRP      BREAK1 CODE                            
         CLI   SVBK2LN,0           ANYTHING IN BREAK2 ?                         
         BNH   PRIPG80             NO - DONE                                    
         LA    R6,PRIPGGRP         POINT TO GROUP CODE                          
         ZIC   R0,SVBK1LN          BREAK1 CODE LENGTH                           
         AR    R6,R0               BUMP PAST BREAK1 CODE TO BREAK2 CODE         
         ZIC   R1,SVBK2LN          BREAK2 CODE LENGTH                           
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   PRIPGB2C(0),0(R6)   BREAK2 CODE                                  
*                                                                               
PRIPG80  DS    0H                                                               
         TR    PRIPGB1C,MXTRT                                                   
         TR    PRIPGB2C,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIPGLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIPGP - EXTRACT PUB GROUP PUB RECORD                                         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIPGP   NMOD1 WORKL,*PRIPGP*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRIPPLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIPPD,R2           R2=A(EXTRACT RECORD)                         
         USING GRPRECD,R3          R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRIPPLEN,PRIPPLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIPPLEN(2),=AL2(PRIPPDL)                                        
         MVC   PRIPPTYP,PRPPQ                                                   
         MVI   PRIPPDX,MXTRTQ                                                   
         MVI   PRIPPDX+1,MXTRTQ                                                 
         MVI   PRIPPAGY-1,MXTRTQ                                                
         MVI   PRIPPMED-1,MXTRTQ                                                
         MVI   PRIPPPGP-1,MXTRTQ                                                
         MVI   PRIPPNUM-1,MXTRTQ                                                
         MVI   PRIPPZON-1,MXTRTQ                                                
         MVI   PRIPPED-1,MXTRTQ                                                 
*                                                                               
         MVC   PRIPPAGY,GRPGAGY    AGENCY                                       
         TR    PRIPPAGY,MXTRT                                                   
         MVC   PRIPPMED,GRPGMED    MEDIA                                        
         TR    PRIPPMED,MXTRT                                                   
*                                                                               
*                                  GET THE DEFINITION RECORD                    
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(GRPKCODE-GRPKEY),GRPKEY                                    
         MVI   WKKEY+3,GRPKBTYQ    X'36' PUB GROUP RECORD                       
*                                                                               
         LA    R6,COMREC                                                        
         CLC   WKKEY(L'GRPKEY),0(R6)   DO WE HAVE THE DEF RECORD                
         BE    PRIPP10                 YES                                      
*                                                                               
         MVC   WKKEYSAV,WKKEY                                                   
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
         CLC   WKKEY(L'GRPKEY),WKKEYSAV                                         
         BE    *+6                                                              
         DC    H'0'                DEF RECORD NOT FOUND                         
*                                  READ DEF RECORD INTO COMREC                  
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,GETREC,PRTFIL,WKKEY+27,COMREC,WORK12D                  
*                                                                               
*                                  RESTORE KEY AND SEQUENCE                     
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(L'GRPKEY),GRPKEY                                           
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
PRIPP10  DS    0H                  GET THE BREAK LENGTHS                        
         LA    R6,COMREC                                                        
         MVI   ELCODE,X'10'        IN DEFINITION RECORDS ONLY                   
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING GRPBRKD,R6                                                       
         MVC   SVBK1LN,GRPBK1LN    BREAK 1 LENGTH                               
         MVC   SVBK2LN,GRPBK2LN    BREAK 2 LENGTH                               
*                                                                               
         DROP  R6                                                               
*                                                                               
         MVC   SVGRPID,GRPGID             GROUP ID                              
         MVC   SVGRPCOD,GRPGCODE          XL2 PWOS                              
         ICM   RE,B'1100',GRPGCODE        GROUP CODE                            
         SRL   RE,12                   DD DD ?? ??  =>  00 0D DD D?             
         ST    RE,FULL                                                          
         OI    FULL+3,X'0F'                                                     
         UNPK  CODECHAR(5),FULL+1(3)   00 0D DD DS  =>  Z0 ZD ZD ZD ZD          
*                                                                               
         ZIC   R6,SVBK1LN          L'BREAK CODES                                
         ZIC   R0,SVBK2LN                                                       
         AR    R6,R0               L'WHOLE GROUP CODE                           
         BCTR  R6,0                                                             
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   PRIPPPGP+2(0),CODECHAR+1    CODE TO FIELD BLANK PADDED           
*                                                                               
         MVC   PRIPPPGP(1),GRPGID        ID TO START OF FIELD                   
*                                                                               
         TR    PRIPPPGP,MXTRT                                                   
*                                  OUTPUT PUB NUMBER, ZONE & EDITION            
         XC    CHAR15,CHAR15                                                    
         MVC   CHAR6,GRPGVAL                                                    
         GOTO1 =V(PUBEDIT),DMCB,(08,CHAR6),(C'S',CHAR15)                        
*                                                                               
         MVC   PRIPPNUM,CHAR8      PUB NUMBER                                   
         TR    PRIPPNUM,MXTRT                                                   
*                                                                               
         CLI   CHAR6+4,0           ANY ZONE ?                                   
         BNH   PRIPP70             NO                                           
         MVC   PRIPPZON,CHAR2      ZONE                                         
         MVC   PRIPPED,CHAR3       EDITION - MAY BE NULLS                       
         B     PRIPP80             FINISH PUB NUMBER WORK                       
PRIPP70  DS    0H                                                               
         MVC   PRIPPED,CHAR2       EDITION - MAY BE NULLS                       
PRIPP80  DS    0H                                                               
         TR    PRIPPZON,MXTRT                                                   
         TR    PRIPPED,MXTRT                                                    
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIPPLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRICCC - EXTRACT CUSTOM COLUMN RECORD                                         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRICCC   NMOD1 WORKL,*PRICCC*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRICCLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRICCD,R2           R2=A(EXTRACT RECORD)                         
         USING PCOLRECD,R3         R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRICCLEN,PRICCLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRICCLEN(2),=AL2(PRICCDL)                                        
         MVC   PRICCTYP,PRCCQ                                                   
         MVI   PRICCDX,MXTRTQ                                                   
         MVI   PRICCDX+1,MXTRTQ                                                 
         MVI   PRICCAGY-1,MXTRTQ                                                
         MVI   PRICCCOL-1,MXTRTQ                                                
         MVI   PRICCSEQ-1,MXTRTQ                                                
         MVI   PRICCDES-1,MXTRTQ                                                
         MVI   PRICCHD1-1,MXTRTQ                                                
         MVI   PRICCHD2-1,MXTRTQ                                                
         MVI   PRICCDEF-1,MXTRTQ                                                
*                                                                               
         MVC   PRICCAGY,PCOLKAGY   AGENCY                                       
         TR    PRICCAGY,MXTRT                                                   
         MVC   PRICCCOL,PCOLKCOD   CUSTOM COLUMN "CODE"                         
         TR    PRICCCOL,MXTRT                                                   
*                                                                               
         LA    R6,PCOLREC                                                       
         MVI   ELCODE,X'61'        CUST COL REC DEFINITION ELEM                 
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING PCOLELEM,R6                                                      
         MVC   PRICCDES,PCOLDESC   COLUMN DESCRIPTION                           
         MVC   PRICCHD1,PCOLHDR1   COLUMN HEADER 1                              
         CLI   PCOLHDR2,C' '       ANYTHING THERE ?                             
         BNH   *+10                NO                                           
         MVC   PRICCHD2,PCOLHDR2   COLUMN HEADER 2                              
*                                                                               
         TR    PRICCDES,MXTRT                                                   
         TR    PRICCHD1,MXTRT                                                   
         TR    PRICCHD2,MXTRT                                                   
*                                                                               
         EDIT  PCOLSQN,PRICCSEQ,FILL=0                                          
         TR    PRICCSEQ,MXTRT                                                   
*                                                                               
         CLI   PCOLTYP,C'T'        TEXT ?                                       
         BNE   *+8                 NO                                           
         MVI   BYTE,1                                                           
         CLI   PCOLTYP,C'N'        NUMERIC ?                                    
         BNE   *+8                 NO                                           
         MVI   BYTE,2                                                           
         CLI   PCOLTYP,C'$'        DOLLARS ?                                    
         BNE   *+8                 NO                                           
         MVI   BYTE,3                                                           
         CLI   PCOLTYP,C'D'        DATE ?                                       
         BNE   *+8                 NO                                           
         MVI   BYTE,4                                                           
         CLI   PCOLTYP,C'P'        DATE RANGE ?                                 
         BNE   *+8                 NO                                           
         MVI   BYTE,5                                                           
         CLI   PCOLTYP,C'%'        PERCENT ?                                    
         BNE   *+8                 NO                                           
         MVI   BYTE,6                                                           
*                                                                               
         EDIT  BYTE,PRICCDEF,FILL=0                                             
         TR    PRICCDEF,MXTRT                                                   
*                                                                               
         DROP  R6                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
PRICCLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRISTC - EXTRACT STANDARD COLUMN RECORD                                       
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
PRISTC   NMOD1 WORKL,*PRISTC*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRISTLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRISCD,R2           R2=A(EXTRACT RECORD)                         
         USING GCOLRECD,R3         R3=A(PRINT RECORD)                           
*                                                                               
         MVC   SVDDISP,DATADISP                                                 
*                                                                               
         XC    PRISCLEN,PRISCLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRISCLEN(2),=AL2(PRISCDL)                                        
         MVC   PRISCTYP,PRSCQ                                                   
         MVI   PRISCDX,MXTRTQ                                                   
         MVI   PRISCDX+1,MXTRTQ                                                 
         MVI   PRISCAGY-1,MXTRTQ                                                
         MVI   PRISCCOL-1,MXTRTQ                                                
         MVI   PRISCSEQ-1,MXTRTQ                                                
         MVI   PRISCDES-1,MXTRTQ                                                
         MVI   PRISCHD1-1,MXTRTQ                                                
         MVI   PRISCHD2-1,MXTRTQ                                                
         MVI   PRISCDEF-1,MXTRTQ                                                
         L     RF,APARM                                                         
         L     RF,12(RF)                                                        
         MVC   PRISCAGY,SXDTSAGY-SXDTABD(RF)                                    
         TR    PRISCAGY,MXTRT                                                   
         MVC   PRISCCOL,GCOLKCOD   COLUMN "CODE"                                
         TR    PRISCCOL,MXTRT                                                   
*                                                                               
         LR    R6,R3               STD COL RECORD                               
         MVI   ELCODE,X'61'        COL REC DEFINITION ELEM                      
         MVC   DATADISP,=X'002A'   42 FOR GENFIL                                
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING PCOLELEM,R6                                                      
         MVC   PRISCDES,PCOLDESC   COLUMN DESCRIPTION                           
         MVC   PRISCHD1,PCOLHDR1   COLUMN HEADER 1                              
         CLI   PCOLHDR2,C' '       ANYTHING THERE ?                             
         BNH   *+10                NO                                           
         MVC   PRISCHD2,PCOLHDR2   COLUMN HEADER 2                              
*                                                                               
         TR    PRISCDES,MXTRT                                                   
         TR    PRISCHD1,MXTRT                                                   
         TR    PRISCHD2,MXTRT                                                   
*                                                                               
         EDIT  PCOLSQN,PRISCSEQ,FILL=0                                          
         TR    PRISCSEQ,MXTRT                                                   
*                                                                               
         CLI   PCOLTYP,C'T'        TEXT ?                                       
         BNE   *+8                 NO                                           
         MVI   BYTE,1                                                           
         CLI   PCOLTYP,C'N'        NUMERIC ?                                    
         BNE   *+8                 NO                                           
         MVI   BYTE,2                                                           
         CLI   PCOLTYP,C'$'        DOLLARS ?                                    
         BNE   *+8                 NO                                           
         MVI   BYTE,3                                                           
         CLI   PCOLTYP,C'D'        DATE ?                                       
         BNE   *+8                 NO                                           
         MVI   BYTE,4                                                           
         CLI   PCOLTYP,C'P'        DATE RANGE ?                                 
         BNE   *+8                 NO                                           
         MVI   BYTE,5                                                           
         CLI   PCOLTYP,C'%'        PERCENT ?                                    
         BNE   *+8                 NO                                           
         MVI   BYTE,6                                                           
*                                                                               
         EDIT  BYTE,PRISCDEF,FILL=0                                             
         TR    PRISCDEF,MXTRT                                                   
*                                                                               
         DROP  R6                                                               
*                                                                               
         MVC   DATADISP,SVDDISP                                                 
*                                                                               
         J     EXIT                                                             
*                                                                               
PRISTLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
*                                                                               
         EJECT                                                                  
***********************************************************************         
* PRIBFM - EXTRACT BILL FORMULA RECORD                                *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
PRIBFM   NMOD1 WORKL,*PRIBFM*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRIBFLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIBFD,R2           R2=A(EXTRACT RECORD)                         
         USING PBFREC,R3           R3=A(PRINT RECORD)                           
*                                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         OI    PTXPFLG1,NORDSEQ                                                 
         DROP  RF                                                               
*                                                                               
         XC    PRIBFLEN,PRIBFLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIBFLEN(2),=AL2(PRIBFDL)                                        
         MVC   PRIBFTYP,PRBFQ                                                   
         MVI   PRIBFDX,MXTRTQ                                                   
         MVI   PRIBFDX+1,MXTRTQ                                                 
         MVI   PRIBFAGY-1,MXTRTQ                                                
         MVI   PRIBFMED-1,MXTRTQ                                                
         MVI   PRIBFCLT-1,MXTRTQ                                                
         MVI   PRIBFPRD-1,MXTRTQ                                                
         MVI   PRIBFEST-1,MXTRTQ                                                
         MVI   PRIBFMOS-1,MXTRTQ                                                
         MVI   PRIBFORM-1,MXTRTQ                                                
         MVI   PRIBFSAC-1,MXTRTQ                                                
         MVI   PRIBFPCT-1,MXTRTQ                                                
*                                                                               
         MVC   PRIBFAGY,PBFKAGY                                                 
         TR    PRIBFAGY,MXTRT                                                   
         MVC   PRIBFMED,PBFKMED                                                 
         TR    PRIBFMED,MXTRT                                                   
         MVC   PRIBFCLT,PBFKCLT                                                 
         TR    PRIBFCLT,MXTRT                                                   
*                                                                               
         MVC   PRIBFPRD,=C'ALL'    DEFAULT TO ALL PRODUCT                       
         CLC   PBFKPRD,=C'AAA'     ALL PRODUCT? NOTE: AAA = ALL                 
         JE    *+10                                                             
         MVC   PRIBFPRD,PBFKPRD                                                 
         TR    PRIBFPRD,MXTRT                                                   
*                                                                               
         EDIT  PBFKEST,PRIBFEST,FILL=0,ZERO=NOBLANK                             
         TR    PRIBFEST,MXTRT                                                   
*                                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         TM    PTXPFLG1,KILLQ                                                   
         JZ    PBFM030                                                          
*                                                                               
         MVI   PRIBFACT,C'K'                                                    
         NI    PTXPFLG1,X'FF'-KILLQ-NORDSEQ                                     
         MVI   ELCOUNT,0           RE-SET ELEMENT COUNT                         
         J     EXIT                                                             
         DROP  RF                                                               
*                                                                               
PBFM030  L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         MVC   BYTE,ELCOUNT        SAVE ELEMENT COUNTER                         
         TM    PTXPFLG1,MULTIQ                                                  
         JZ    *+8                                                              
         MVI   PRIBFACT,C'A'                                                    
         CLI   ELCOUNT,12          PROCESSED 12 MONTHS?                         
         JL    PBFM032                                                          
         DROP  RF                                                               
*                                                                               
PBFM030X L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         OI    PTXPFLG1,NOWRITEQ                                                
         NI    PTXPFLG1,X'FF'-KILLQ-NORDSEQ-MULTIQ                              
         MVI   ELCOUNT,0           RE-SET ELEMENT COUNT                         
         J     EXIT                                                             
         DROP  RF                                                               
*                                                                               
PBFM032  SR    R5,R5               INIT BILL FORMULA ELEMENT COUNTER            
         LA    R6,PBFRDATA                                                      
         USING PBFRCEL,R6                                                       
*                                                                               
PBFM032E CLI   PBFRCEL,0           END OF RECORD?                               
         JE    PBFM030X                                                         
         CLI   PBFRCEL,PBFRCELQ    BILLING FORMULA ELEMENT?                     
         JNE   PBFM032N                                                         
         LLC   RE,BYTE                                                          
         CR    R5,RE               PROCESSING THIS BILL FORMULA ELEM?           
         JE    PBFM036                                                          
         AHI   R5,1                BUMP TO NEXT BILL FORMULA ELEMENT            
PBFM032N LLC   RE,PBFRCLEN                                                      
         AR    R6,RE               POINT TO NEXT FORMULA ELEMENT                
         J     PBFM032E                                                         
*                                                                               
PBFM036  MVI   PRIBFMOS,C'*'       MARKER FOR NO DATE                           
         CLC   PBFRCDTE,=2X'FF'                                                 
         JE    PBFM036E                                                         
         MVC   FULL,PBFRCDTE                                                    
         XC    FULL(2),=2X'FF'                                                  
         MVI   FULL+2,X'01'                                                     
         GOTO1 DATCON,PLIST,(3,FULL),(9,PRIBFMOS)                               
*                                                                               
PBFM036E LA    R7,PRIBFORM                                                      
         TM    PBFRCFML,X'41'      FIGURE OUT WHICH BILL BASIS WE HAVE          
         JNO   *+18                                                             
         MVC   0(6,R7),=C'CGROSS'                                               
         LA    R7,6(R7)                                                         
         J     PBFM038                                                          
*                                                                               
         TM    PBFRCFML,X'42'                                                   
         JNO   *+18                                                             
         MVC   0(4,R7),=C'CNET'                                                 
         LA    R7,4(R7)                                                         
         J     PBFM038                                                          
*                                                                               
         TM    PBFRCFML,X'45'                                                   
         JNO   *+18                                                             
         MVC   0(9,R7),=C'CGROSS-CD'                                            
         LA    R7,9(R7)                                                         
         J     PBFM038                                                          
*                                                                               
         TM    PBFRCFML,X'46'                                                   
         JNO   *+18                                                             
         MVC   0(7,R7),=C'CNET-CD'                                              
         LA    R7,7(R7)                                                         
         J     PBFM038                                                          
*                                                                               
         TM    PBFRCFML,X'48'                                                   
         JNO   *+18                                                             
         MVC   0(7,R7),=C'CAGYCOM'                                              
         LA    R7,7(R7)                                                         
         J     PBFM038                                                          
*                                                                               
         TM    PBFRCFML,X'05'                                                   
         JNO   *+18                                                             
         MVC   0(8,R7),=C'GROSS-CD'                                             
         LA    R7,8(R7)                                                         
         J     PBFM038                                                          
*                                                                               
         TM    PBFRCFML,X'06'                                                   
         JNO   *+18                                                             
         MVC   0(6,R7),=C'NET-CD'                                               
         LA    R7,6(R7)                                                         
         J     PBFM038                                                          
*                                                                               
         TM    PBFRCFML,X'01'                                                   
         JNO   *+18                                                             
         MVC   0(5,R7),=C'GROSS'                                                
         LA    R7,5(R7)                                                         
         J     PBFM038                                                          
*                                                                               
         TM    PBFRCFML,X'02'                                                   
         JNO   *+18                                                             
         MVC   0(3,R7),=C'NET'                                                  
         LA    R7,3(R7)                                                         
         J     PBFM038                                                          
*                                                                               
PBFM038  OC    PBFRCFML+2(3),PBFRCFML+2                                         
         JZ    PBFM040                                                          
*                                                                               
         MVI   0(R7),C','                                                       
         LA    R7,1(R7)                                                         
*                                                                               
         EDIT  (B3,PBFRCFML+2),(8,1(R7)),4,ALIGN=LEFT                           
         MVI   0(R7),C'+'                                                       
         TM    PBFRCFML+2,X'80'                                                 
         JZ    *+8                                                              
         MVI   0(R7),C'-'                                                       
*                                                                               
         LA    R1,8(R7)                                                         
PBFM038E CLI   0(R1),C' '                                                       
         JNE   *+10                                                             
         BCTR  R1,0                                                             
         J     PBFM038E                                                         
*                                                                               
         LA    R7,1(R1)                                                         
         MVI   0(R7),C','                                                       
         LA    R7,1(R7)                                                         
*                                                                               
         TM    PBFRCFML+1,X'08'                                                 
         JNO   *+18                                                             
         MVC   0(6,R7),=C'AGYCOM'                                               
         LA    R7,6(R7)                                                         
         J     PBFM040                                                          
*                                                                               
         TM    PBFRCFML+1,X'05'                                                 
         JNO   *+18                                                             
         MVC   0(8,R7),=C'GROSS-CD'                                             
         LA    R7,8(R7)                                                         
         J     PBFM040                                                          
*                                                                               
         TM    PBFRCFML+1,X'06'                                                 
         JNO   *+18                                                             
         MVC   0(6,R7),=C'NET-CD'                                               
         LA    R7,6(R7)                                                         
         J     PBFM040                                                          
*                                                                               
         TM    PBFRCFML+1,X'01'                                                 
         JNO   *+18                                                             
         MVC   0(5,R7),=C'GROSS'                                                
         LA    R7,5(R7)                                                         
         J     PBFM040                                                          
*                                                                               
         TM    PBFRCFML+1,X'02'                                                 
         JNO   *+18                                                             
         MVC   0(3,R7),=C'NET'                                                  
         LA    R7,3(R7)                                                         
         J     PBFM040                                                          
*                                                                               
PBFM040  CLI   PBFRCACO,X'01'    GROSS?                                         
         JE    PBFM042                                                          
         CLI   PBFRCACO,X'02'    NET?                                           
         JE    PBFM042                                                          
         CLI   PBFRCACO,X'05'    GROSS-CD                                       
         JE    PBFM042                                                          
         CLI   PBFRCACO,X'06'    NET-CD                                         
         JE    PBFM042                                                          
         XC    PBFRCACP,PBFRCACP                                                
         XC    PBFRCACO,PBFRCACO                                                
*                                                                               
PBFM042  OC    PBFRCACP,PBFRCACP                                                
         JZ    PBFM046                                                          
         EDIT  (B3,PBFRCACP),(8,PRIBFSAC+1),4,ALIGN=LEFT                        
         MVI   PRIBFSAC,C'+'                                                    
         TM    PBFRCACP,X'80'                                                   
         JZ    *+8                                                              
         MVI   PRIBFSAC,C'-'                                                    
*                                                                               
PBFM046  OC    PBFRCACO,PBFRCACO                                                
         JZ    PBFM050                                                          
*                                                                               
         TM    PBFRCACO,X'08'                                                   
         JNO   *+14                                                             
         MVC   PRIBFPCT(6),=C'AGYCOM'                                           
         J     PBFM050                                                          
*                                                                               
         TM    PBFRCACO,X'05'                                                   
         JNO   *+14                                                             
         MVC   PRIBFPCT(8),=C'GROSS-CD'                                         
         J     PBFM050                                                          
*                                                                               
         TM    PBFRCACO,X'06'                                                   
         JNO   *+14                                                             
         MVC   PRIBFPCT(6),=C'NET-CD'                                           
         J     PBFM050                                                          
*                                                                               
         TM    PBFRCACO,X'01'                                                   
         JNO   *+14                                                             
         MVC   PRIBFPCT(5),=C'GROSS'                                            
         J     PBFM050                                                          
*                                                                               
         TM    PBFRCACO,X'02'                                                   
         JNO   *+14                                                             
         MVC   PRIBFPCT(3),=C'NET'                                              
         J     PBFM050                                                          
*                                                                               
PBFM050  DS    0H                                                               
*                                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         LLC   R0,ELCOUNT                                                       
         AHI   R0,1                                                             
         STC   R0,ELCOUNT                                                       
         DROP  RF                                                               
*                                                                               
         TR    PRIBFMOS,MXTRT                                                   
         TR    PRIBFORM,MXTRT                                                   
         TR    PRIBFSAC,MXTRT                                                   
         TR    PRIBFPCT,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIBFLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3,R6                                                         
*                                                                               
***********************************************************************         
* PRICGD - EXTRACT CLIENT GROUP DEFINITION RECORD                     *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRICGD   NMOD1 WORKL,*PRICGD*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRICDLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRICDD,R2           R2=A(EXTRACT RECORD)                         
         USING GRPRECD,R3          R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRICDLEN,PRICDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRICDLEN(2),=AL2(PRICDDL)                                        
         MVC   PRICDTYP,PRCDQ                                                   
         MVI   PRICDDX,MXTRTQ                                                   
         MVI   PRICDDX+1,MXTRTQ                                                 
         MVI   PRICDAGY-1,MXTRTQ                                                
         MVI   PRICDMED-1,MXTRTQ                                                
         MVI   PRICDID-1,MXTRTQ                                                 
         MVI   PRICDB1N-1,MXTRTQ                                                
         MVI   PRICDB1L-1,MXTRTQ                                                
         MVI   PRICDB2N-1,MXTRTQ                                                
         MVI   PRICDB2L-1,MXTRTQ                                                
*                                                                               
         MVC   PRICDAGY,GRPKAGY    AGENCY                                       
         TR    PRICDAGY,MXTRT                                                   
         MVC   PRICDMED,GRPKMED    MEDIA                                        
         TR    PRICDMED,MXTRT                                                   
*                                                                               
* TRANSLATE 1 CHAR CODE TO DISPLAYABLE 2 CHARS                                  
*                                                                               
         LA    RE,SPCGRTAB                                                      
         LHI   RF,SPCGRTBX-SPCGRTAB                                             
*                                                                               
PRICD20  CLC   GRPKID,2(RE)                                                     
         BE    PRICD30                                                          
         LA    RE,3(RE)                                                         
         BCT   RF,PRICD20                                                       
         MVC   PRICDID(1),GRPKID   2-CHAR NOT FOUND - USE 1-CHAR                
         B     PRICD40                                                          
*                                                                               
PRICD30  MVC   PRICDID,0(RE)       ID CODE FROM SPCGRTAB                        
*                                                                               
PRICD40  TR    PRICDID,MXTRT                                                    
*                                                                               
         LA    R6,GRPRECD                                                       
         MVI   ELCODE,X'10'        GROUP ID DEFINITION RECORDS ELEM             
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING GRPBRKD,R6                                                       
         MVC   PRICDB1N,GRPBK1     BREAK 1 TITLE                                
         MVC   PRICDB2N,GRPBK2     BREAK 2 TITLE                                
         TR    PRICDB1N,MXTRT                                                   
         TR    PRICDB2N,MXTRT                                                   
*                                                                               
         EDIT  GRPBK1LN,PRICDB1L,FILL=0                                         
         EDIT  GRPBK2LN,PRICDB2L,FILL=0                                         
         TR    PRICDB1L,MXTRT                                                   
         TR    PRICDB2L,MXTRT                                                   
*                                                                               
         DROP  R6                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
PRICDLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRICLG - EXTRACT CLIENT GROUP RECORD                                *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRICLG   NMOD1 WORKL,*PRICLG*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRICGLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRICGRD,R2          R2=A(EXTRACT RECORD)                         
         USING GRPRECD,R3          R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRICGLEN,PRICGLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRICGLEN(2),=AL2(PRICGDL)                                        
         MVC   PRICGTYP,PRCGQ                                                   
         MVI   PRICGDX,MXTRTQ                                                   
         MVI   PRICGDX+1,MXTRTQ                                                 
         MVI   PRICGAGY-1,MXTRTQ                                                
         MVI   PRICGMED-1,MXTRTQ                                                
         MVI   PRICGID-1,MXTRTQ                                                 
         MVI   PRICGGRP-1,MXTRTQ                                                
         MVI   PRICGPGP-1,MXTRTQ                                                
         MVI   PRICGB1C-1,MXTRTQ                                                
         MVI   PRICGB2C-1,MXTRTQ                                                
         MVI   PRICGB1N-1,MXTRTQ                                                
         MVI   PRICGB2N-1,MXTRTQ                                                
*                                                                               
         MVC   PRICGAGY,GRPKAGY    AGENCY                                       
         TR    PRICGAGY,MXTRT                                                   
         MVC   PRICGMED,GRPKMED    MEDIA                                        
         TR    PRICGMED,MXTRT                                                   
*                                                                               
* TRANSLATE 1 CHAR GROUP ID CODE TO DISPLAYABLE 2 CHARS                         
*                                                                               
         LA    RE,SPCGRTAB                                                      
         LHI   RF,SPCGRTBX-SPCGRTAB                                             
*                                                                               
PRICG20  CLC   GRPKID,2(RE)                                                     
         BE    PRICG30                                                          
         LA    RE,3(RE)                                                         
         BCT   RF,PRICG20                                                       
         MVC   PRICGID(1),GRPKID   2-CHAR NOT FOUND - USE 1-CHAR                
         B     PRICG40                                                          
*                                                                               
PRICG30  MVC   PRICGID,0(RE)       ID CODE FROM SPCGRTAB                        
*                                                                               
PRICG40  TR    PRICGID,MXTRT                                                    
*                                                                               
         LA    R6,GRPRECD                                                       
         MVI   ELCODE,X'20'        GROUP CODE RECORDS ONLY                      
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING GRPGRPD,R6                                                       
         MVC   PRICGB1N,GRPGNAM1   BREAK 1 NAME                                 
         MVC   PRICGB2N,GRPGNAM2   BREAK 2 NAME                                 
         TR    PRICGB1N,MXTRT                                                   
         TR    PRICGB2N,MXTRT                                                   
*                                                                               
         DROP  R6                                                               
*                                                                               
*                                  GET THE DEFINITION RECORD                    
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(GRPKCODE-GRPKEY),GRPKEY                                    
*                                                                               
         LA    R6,COMREC                                                        
         CLC   WKKEY(L'GRPKEY),0(R6)   DO WE HAVE THE DEF RECORD                
         BE    PRICG90                 YES                                      
*                                                                               
         MVC   WKKEYSAV,WKKEY                                                   
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
         CLC   WKKEY(L'GRPKEY),WKKEYSAV                                         
         BE    *+6                                                              
         DC    H'0'                DEF RECORD NOT FOUND                         
*                                  READ DEF RECORD INTO COMREC                  
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,GETREC,PRTFIL,WKKEY+27,COMREC,WORK12D                  
*                                                                               
*                                  RESTORE KEY AND SEQUENCE                     
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(L'GRPKEY),GRPKEY                                           
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
PRICG90  DS    0H                  GET THE BREAK LENGTHS                        
         LA    R6,COMREC                                                        
         MVI   ELCODE,X'10'        IN DEFINITION RECORDS ONLY                   
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING GRPBRKD,R6                                                       
         MVC   SVBK1LN,GRPBK1LN    BREAK 1 LENGTH                               
         MVC   SVBK2LN,GRPBK2LN    BREAK 2 LENGTH                               
*                                                                               
         DROP  R6                                                               
*                                                                               
         MVC   SVGRPID,GRPKID             GROUP ID                              
         MVC   SVGRPCOD,GRPKCODE          XL2 PWOS                              
         ICM   RE,B'1100',GRPKCODE        GROUP CODE                            
         SRL   RE,12                   DD DD ?? ??  =>  00 0D DD D?             
         ST    RE,FULL                                                          
         OI    FULL+3,X'0F'                                                     
         UNPK  CODECHAR(5),FULL+1(3)   00 0D DD DS  =>  Z0 ZD ZD ZD ZD          
*                                                                               
         ZIC   R6,SVBK1LN          L'BREAK CODES                                
         ZIC   R0,SVBK2LN                                                       
         AR    R6,R0               L'WHOLE GROUP CODE                           
         BCTR  R6,0                                                             
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   PRICGGRP(0),CODECHAR+1    CODE TO FIELD BLANK PADDED             
*                                                                               
         MVC   PRICGPGP(2),PRICGID       ID TO START OF FIELD                   
         MVC   PRICGPGP+2(4),PRICGGRP    CODE TO FINISH FIELD                   
*                                                                               
         TR    PRICGGRP,MXTRT                                                   
         TR    PRICGPGP,MXTRT                                                   
*                                  OUTPUT BREAK1 AND BREAK2 CODES               
         ZIC   R6,SVBK1LN          BREAK1 CODE LENGTH                           
         BCTR  R6,0                                                             
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   PRICGB1C(0),PRICGGRP      BREAK1 CODE                            
         CLI   SVBK2LN,0           ANYTHING IN BREAK2 ?                         
         BNH   PRICG100            NO - DONE                                    
         LA    R6,PRICGGRP         POINT TO GROUP CODE                          
         ZIC   R0,SVBK1LN          BREAK1 CODE LENGTH                           
         AR    R6,R0               BUMP PAST BREAK1 CODE TO BREAK2 CODE         
         ZIC   R1,SVBK2LN          BREAK2 CODE LENGTH                           
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   PRICGB2C(0),0(R6)   BREAK2 CODE                                  
*                                                                               
PRICG100 DS    0H                                                               
         TR    PRICGB1C,MXTRT                                                   
         TR    PRICGB2C,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRICGLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRICLC - EXTRACT CLIENT GROUP CLIENT RECORD                         *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRICLC   NMOD1 WORKL,*PRICLC*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRICLLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRICLD,R2           R2=A(EXTRACT RECORD)                         
         USING GRPRECD,R3          R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRICLLEN,PRICLLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRICLLEN(2),=AL2(PRICLDL)                                        
         MVC   PRICLTYP,PRCLQ                                                   
         MVI   PRICLDX,MXTRTQ                                                   
         MVI   PRICLDX+1,MXTRTQ                                                 
         MVI   PRICLAGY-1,MXTRTQ                                                
         MVI   PRICLMED-1,MXTRTQ                                                
         MVI   PRICLPGP-1,MXTRTQ                                                
         MVI   PRICLCLT-1,MXTRTQ                                                
*                                                                               
         MVC   PRICLAGY,GRPGAGY    AGENCY                                       
         TR    PRICLAGY,MXTRT                                                   
         MVC   PRICLMED,GRPGMED    MEDIA                                        
         TR    PRICLMED,MXTRT                                                   
*                                                                               
*                                  GET THE DEFINITION RECORD                    
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(GRPKCODE-GRPKEY),GRPKEY                                    
         MVI   WKKEY+3,GRPKCTYQ    X'34' CLIENT GROUP RECORD                    
*                                                                               
         LA    R6,COMREC                                                        
         CLC   WKKEY(L'GRPKEY),0(R6)   DO WE HAVE THE DEF RECORD                
         BE    PRICL10                 YES                                      
*                                                                               
         MVC   WKKEYSAV,WKKEY                                                   
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
         CLC   WKKEY(L'GRPKEY),WKKEYSAV                                         
         BE    *+6                                                              
         DC    H'0'                DEF RECORD NOT FOUND                         
*                                  READ DEF RECORD INTO COMREC                  
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,GETREC,PRTFIL,WKKEY+27,COMREC,WORK12D                  
*                                                                               
*                                  RESTORE KEY AND SEQUENCE                     
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(L'GRPKEY),GRPKEY                                           
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
PRICL10  DS    0H                  GET THE BREAK LENGTHS                        
         LA    R6,COMREC                                                        
         MVI   ELCODE,X'10'        IN DEFINITION RECORDS ONLY                   
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING GRPBRKD,R6                                                       
         MVC   SVBK1LN,GRPBK1LN    BREAK 1 LENGTH                               
         MVC   SVBK2LN,GRPBK2LN    BREAK 2 LENGTH                               
*                                                                               
         DROP  R6                                                               
*                                                                               
         MVC   SVGRPID,GRPGID             GROUP ID                              
         MVC   SVGRPCOD,GRPGCODE          XL2 PWOS                              
         ICM   RE,B'1100',GRPGCODE        GROUP CODE                            
         SRL   RE,12                   DD DD ?? ??  =>  00 0D DD D?             
         ST    RE,FULL                                                          
         OI    FULL+3,X'0F'                                                     
         UNPK  CODECHAR(5),FULL+1(3)   00 0D DD DS  =>  Z0 ZD ZD ZD ZD          
*                                                                               
         ZIC   R6,SVBK1LN          L'BREAK CODES                                
         ZIC   R0,SVBK2LN                                                       
         AR    R6,R0               L'WHOLE GROUP CODE                           
         BCTR  R6,0                                                             
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   PRICLPGP+2(0),CODECHAR+1    CODE TO FIELD BLANK PADDED           
*                                                                               
* TRANSLATE 1 CHAR GROUP ID CODE TO DISPLAYABLE 2 CHARS                         
*                                                                               
         LA    RE,SPCGRTAB                                                      
         LHI   RF,SPCGRTBX-SPCGRTAB                                             
*                                                                               
PRICL20  CLC   GRPGID,2(RE)                                                     
         BE    PRICL30                                                          
         LA    RE,3(RE)                                                         
         BCT   RF,PRICL20                                                       
         MVC   PRICLPGP(1),GRPGID   2-CHAR NOT FOUND - USE 1-CHAR               
         B     PRICL40                                                          
*                                                                               
PRICL30  MVC   PRICLPGP(2),0(RE)       ID CODE FROM SPCGRTAB                    
*                                                                               
PRICL40  TR    PRICLPGP,MXTRT                                                   
*                                                                               
         MVC   PRICLCLT,GRPGVAL                                                 
         TR    PRICLCLT,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRICLLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIGDP - EXTRACT PRODUCT GROUP DEFINITION RECORD                    *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIGDP   NMOD1 WORKL,*PRIGDP*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRIGDLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIGDRD,R2          R2=A(EXTRACT RECORD)                         
         USING GRPRECD,R3          R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRIGDLEN,PRIGDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIGDLEN(2),=AL2(PRIGDDL)                                        
         MVC   PRIGDTYP,PRGDQ                                                   
         MVI   PRIGDDX,MXTRTQ                                                   
         MVI   PRIGDDX+1,MXTRTQ                                                 
         MVI   PRIGDAGY-1,MXTRTQ                                                
         MVI   PRIGDMED-1,MXTRTQ                                                
         MVI   PRIGDCLT-1,MXTRTQ                                                
         MVI   PRIGDID-1,MXTRTQ                                                 
         MVI   PRIGDB1N-1,MXTRTQ                                                
         MVI   PRIGDB1L-1,MXTRTQ                                                
         MVI   PRIGDB2N-1,MXTRTQ                                                
         MVI   PRIGDB2L-1,MXTRTQ                                                
*                                                                               
         MVC   PRIGDAGY,GRPKAGY    AGENCY                                       
         TR    PRIGDAGY,MXTRT                                                   
         MVC   PRIGDMED,GRPKMED    MEDIA                                        
         TR    PRIGDMED,MXTRT                                                   
         MVC   PRIGDCLT,GRPKCLT    CLIENT CODE                                  
         TR    PRIGDCLT,MXTRT                                                   
         MVC   PRIGDID(1),GRPKID   ID CODE                                      
         TR    PRIGDID,MXTRT                                                    
*                                                                               
         LA    R6,GRPRECD                                                       
         MVI   ELCODE,X'10'        GROUP ID DEFINITION RECORDS ELEM             
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING GRPBRKD,R6                                                       
         MVC   PRIGDB1N,GRPBK1     BREAK 1 TITLE                                
         MVC   PRIGDB2N,GRPBK2     BREAK 2 TITLE                                
         TR    PRIGDB1N,MXTRT                                                   
         TR    PRIGDB2N,MXTRT                                                   
*                                                                               
         EDIT  GRPBK1LN,PRIGDB1L,FILL=0                                         
         EDIT  GRPBK2LN,PRIGDB2L,FILL=0                                         
         TR    PRIGDB1L,MXTRT                                                   
         TR    PRIGDB2L,MXTRT                                                   
*                                                                               
         DROP  R6                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIGDLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIGGP - EXTRACT PRODUCT GROUP RECORD                               *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIGGP   NMOD1 WORKL,*PRIGGP*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRIGGLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIGGRD,R2           R2=A(EXTRACT RECORD)                        
         USING GRPRECD,R3          R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRIGGLEN,PRIGGLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIGGLEN(2),=AL2(PRIGGDL)                                        
         MVC   PRIGGTYP,PRGGQ                                                   
         MVI   PRIGGDX,MXTRTQ                                                   
         MVI   PRIGGDX+1,MXTRTQ                                                 
         MVI   PRIGGAGY-1,MXTRTQ                                                
         MVI   PRIGGMED-1,MXTRTQ                                                
         MVI   PRIGGCLT-1,MXTRTQ                                                
         MVI   PRIGGID-1,MXTRTQ                                                 
         MVI   PRIGGGRP-1,MXTRTQ                                                
         MVI   PRIGGPGP-1,MXTRTQ                                                
         MVI   PRIGGB1C-1,MXTRTQ                                                
         MVI   PRIGGB2C-1,MXTRTQ                                                
         MVI   PRIGGB1N-1,MXTRTQ                                                
         MVI   PRIGGB2N-1,MXTRTQ                                                
*                                                                               
         MVC   PRIGGAGY,GRPKAGY    AGENCY                                       
         TR    PRIGGAGY,MXTRT                                                   
         MVC   PRIGGMED,GRPKMED    MEDIA                                        
         TR    PRIGGMED,MXTRT                                                   
         MVC   PRIGGCLT,GRPKCLT    CLIENT CODE                                  
         TR    PRIGGCLT,MXTRT                                                   
         MVC   PRIGGID(1),GRPKID   GROUP ID                                     
         TR    PRIGGID,MXTRT                                                    
*                                                                               
         LA    R6,GRPRECD                                                       
         MVI   ELCODE,X'20'        GROUP CODE RECORDS ONLY                      
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING GRPGRPD,R6                                                       
         MVC   PRIGGB1N,GRPGNAM1   BREAK 1 NAME                                 
         MVC   PRIGGB2N,GRPGNAM2   BREAK 2 NAME                                 
         TR    PRIGGB1N,MXTRT                                                   
         TR    PRIGGB2N,MXTRT                                                   
*                                                                               
         DROP  R6                                                               
*                                  GET THE DEFINITION RECORD                    
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(GRPKCODE-GRPKEY),GRPKEY                                    
*                                                                               
         LA    R6,COMREC                                                        
         CLC   WKKEY(L'GRPKEY),0(R6)   DO WE HAVE THE DEF RECORD                
         BE    PRIGG10                 YES                                      
*                                                                               
         MVC   WKKEYSAV,WKKEY                                                   
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
         CLC   WKKEY(L'GRPKEY),WKKEYSAV                                         
         BE    *+6                                                              
         DC    H'0'                DEF RECORD NOT FOUND                         
*                                  READ DEF RECORD INTO COMREC                  
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,GETREC,PRTFIL,WKKEY+27,COMREC,WORK12D                  
*                                                                               
*                                  RESTORE KEY AND SEQUENCE                     
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(L'GRPKEY),GRPKEY                                           
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
PRIGG10  DS    0H                  GET THE BREAK LENGTHS                        
         LA    R6,COMREC                                                        
         MVI   ELCODE,X'10'        IN DEFINITION RECORDS ONLY                   
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING GRPBRKD,R6                                                       
         MVC   SVBK1LN,GRPBK1LN    BREAK 1 LENGTH                               
         MVC   SVBK2LN,GRPBK2LN    BREAK 2 LENGTH                               
*                                                                               
         DROP  R6                                                               
*                                                                               
         MVC   SVGRPID,GRPKID             GROUP ID                              
         MVC   SVGRPCOD,GRPKCODE          XL2 PWOS                              
         ICM   RE,B'1100',GRPKCODE        GROUP CODE                            
         SRL   RE,12                   DD DD ?? ??  =>  00 0D DD D?             
         ST    RE,FULL                                                          
         OI    FULL+3,X'0F'                                                     
         UNPK  CODECHAR(5),FULL+1(3)   00 0D DD DS  =>  Z0 ZD ZD ZD ZD          
*                                                                               
         ZIC   R6,SVBK1LN          L'BREAK CODES                                
         ZIC   R0,SVBK2LN                                                       
         AR    R6,R0               L'WHOLE GROUP CODE                           
         BCTR  R6,0                                                             
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   PRIGGGRP(0),CODECHAR+1    CODE TO FIELD BLANK PADDED             
*                                                                               
         MVC   PRIGGPGP(2),PRIGGID       ID TO START OF FIELD                   
         MVC   PRIGGPGP+2(4),PRIGGGRP    CODE TO FINISH FIELD                   
*                                                                               
         TR    PRIGGGRP,MXTRT                                                   
         TR    PRIGGPGP,MXTRT                                                   
*                                  OUTPUT BREAK1 AND BREAK2 CODES               
         ZIC   R6,SVBK1LN          BREAK1 CODE LENGTH                           
         BCTR  R6,0                                                             
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   PRIGGB1C(0),PRIGGGRP      BREAK1 CODE                            
         CLI   SVBK2LN,0           ANYTHING IN BREAK2 ?                         
         BNH   PRIGG80             NO - DONE                                    
         LA    R6,PRIGGGRP         POINT TO GROUP CODE                          
         ZIC   R0,SVBK1LN          BREAK1 CODE LENGTH                           
         AR    R6,R0               BUMP PAST BREAK1 CODE TO BREAK2 CODE         
         ZIC   R1,SVBK2LN          BREAK2 CODE LENGTH                           
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   PRIGGB2C(0),0(R6)   BREAK2 CODE                                  
*                                                                               
PRIGG80  DS    0H                                                               
         TR    PRIGGB1C,MXTRT                                                   
         TR    PRIGGB2C,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIGGLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIGPP - EXTRACT PRODUCT GROUP PRODUCT RECORD                       *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIGPP   NMOD1 WORKL,*PRIGPP*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,PRIGPLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIGPRD,R2           R2=A(EXTRACT RECORD)                        
         USING GRPRECD,R3          R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRIGPLEN,PRIGPLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIGPLEN(2),=AL2(PRIGPDL)                                        
         MVC   PRIGPTYP,PRGPQ                                                   
         MVI   PRIGPDX,MXTRTQ                                                   
         MVI   PRIGPDX+1,MXTRTQ                                                 
         MVI   PRIGPAGY-1,MXTRTQ                                                
         MVI   PRIGPMED-1,MXTRTQ                                                
         MVI   PRIGPCLT-1,MXTRTQ                                                
         MVI   PRIGPPGP-1,MXTRTQ                                                
         MVI   PRIGPPRD-1,MXTRTQ                                                
*                                                                               
         MVC   PRIGPAGY,GRPGAGY    AGENCY                                       
         TR    PRIGPAGY,MXTRT                                                   
         MVC   PRIGPMED,GRPGMED    MEDIA                                        
         TR    PRIGPMED,MXTRT                                                   
         MVC   PRIGPCLT,GRPGCLT    CLIENT CODE                                  
         TR    PRIGPCLT,MXTRT                                                   
*                                                                               
*                                  GET THE DEFINITION RECORD                    
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(GRPKCODE-GRPKEY),GRPKEY                                    
         MVI   WKKEY+3,GRPKPTYQ    X'35' PRODUCT GROUP RECORD                   
*                                                                               
         LA    R6,COMREC                                                        
         CLC   WKKEY(L'GRPKEY),0(R6)   DO WE HAVE THE DEF RECORD                
         BE    PRIGP10                 YES                                      
*                                                                               
         MVC   WKKEYSAV,WKKEY                                                   
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
         CLC   WKKEY(L'GRPKEY),WKKEYSAV                                         
         BE    *+6                                                              
         DC    H'0'                DEF RECORD NOT FOUND                         
*                                  READ DEF RECORD INTO COMREC                  
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,GETREC,PRTFIL,WKKEY+27,COMREC,WORK12D                  
*                                                                               
*                                  RESTORE KEY AND SEQUENCE                     
         XC    WKKEY,WKKEY                                                      
         MVC   WKKEY(L'GRPKEY),GRPKEY                                           
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),PRTDIR,WKKEY,WKKEY,0                        
*                                                                               
PRIGP10  DS    0H                  GET THE BREAK LENGTHS                        
         LA    R6,COMREC                                                        
         MVI   ELCODE,X'10'        IN DEFINITION RECORDS ONLY                   
         BRAS  RE,GETEL                                                         
         JE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         USING GRPBRKD,R6                                                       
         MVC   SVBK1LN,GRPBK1LN    BREAK 1 LENGTH                               
         MVC   SVBK2LN,GRPBK2LN    BREAK 2 LENGTH                               
*                                                                               
         DROP  R6                                                               
*                                                                               
         MVC   SVGRPID,GRPGID             GROUP ID                              
         MVC   SVGRPCOD,GRPGCODE          XL2 PWOS                              
         ICM   RE,B'1100',GRPGCODE        GROUP CODE                            
         SRL   RE,12                   DD DD ?? ??  =>  00 0D DD D?             
         ST    RE,FULL                                                          
         OI    FULL+3,X'0F'                                                     
         UNPK  CODECHAR(5),FULL+1(3)   00 0D DD DS  =>  Z0 ZD ZD ZD ZD          
*                                                                               
         ZIC   R6,SVBK1LN          L'BREAK CODES                                
         ZIC   R0,SVBK2LN                                                       
         AR    R6,R0               L'WHOLE GROUP CODE                           
         BCTR  R6,0                                                             
         EX    R6,*+8                                                           
         B     *+10                                                             
         MVC   PRIGPPGP+2(0),CODECHAR+1    CODE TO FIELD BLANK PADDED           
*                                                                               
         MVC   PRIGPPGP(1),GRPGID        ID TO START OF FIELD                   
*                                                                               
         TR    PRIGPPGP,MXTRT                                                   
*                                                                               
         MVC   PRIGPPRD,GRPGVAL                                                 
         TR    PRIGPPRD,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIGPLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIREG - EXTRACT REGION RECORD                                                
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIREG   NMOD1 WORKL,*PRIREG*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIRGLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIRGD,R2           R2=A(EXTRACT RECORD)                         
         USING PREGRECD,R3         R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRIRGLEN,PRIRGLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIRGLEN(2),=AL2(PRIRGDL)                                        
         MVC   PRIRGTYP,PRRGQ                                                   
         MVI   PRIRGDX,MXTRTQ                                                   
         MVI   PRIRGDX+1,MXTRTQ                                                 
         MVI   PRIRGAGY-1,MXTRTQ                                                
         MVI   PRIRGMED-1,MXTRTQ                                                
         MVI   PRIRGCLT-1,MXTRTQ                                                
         MVI   PRIRGDIV-1,MXTRTQ                                                
         MVI   PRIRGREG-1,MXTRTQ                                                
         MVI   PRIRGNME-1,MXTRTQ                                                
*                                                                               
         MVC   PRIRGAGY,PREGKAGY   AGENCY                                       
         TR    PRIRGAGY,MXTRT                                                   
         MVC   PRIRGMED,PREGKMED   MEDIA                                        
         TR    PRIRGMED,MXTRT                                                   
         MVC   PRIRGCLT,PREGKCLT   CLIENT                                       
         TR    PRIRGCLT,MXTRT                                                   
         MVC   PRIRGDIV,PREGKDIV   DIVISION                                     
         TR    PRIRGDIV,MXTRT                                                   
         MVC   PRIRGREG,PREGKREG   REGION                                       
         TR    PRIRGREG,MXTRT                                                   
*                                                                               
         LA    R6,PREGRECD                                                      
         MVI   ELCODE,X'04'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PREG0010                                                         
*                                                                               
         USING PREGELEM,R6                                                      
         MVC   PRIRGNME,PREGNAME   NAME                                         
         DROP  R6                                                               
*                                                                               
PREG0010 DS    0H                                                               
         TR    PRIRGNME,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIRGLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIDST - EXTRACT DISTRICT RECORD                                              
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIDST   NMOD1 WORKL,*PRIDST*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIDSLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIDSD,R2           R2=A(EXTRACT RECORD)                         
         USING PDSTRECD,R3         R3=A(PRINT RECORD)                           
*                                                                               
         XC    PRIDSLEN,PRIDSLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIDSLEN(2),=AL2(PRIDSDL)                                        
         MVC   PRIDSTYP,PRDSQ                                                   
         MVI   PRIDSDX,MXTRTQ                                                   
         MVI   PRIDSDX+1,MXTRTQ                                                 
         MVI   PRIDSAGY-1,MXTRTQ                                                
         MVI   PRIDSMED-1,MXTRTQ                                                
         MVI   PRIDSCLT-1,MXTRTQ                                                
         MVI   PRIDSDIV-1,MXTRTQ                                                
         MVI   PRIDSREG-1,MXTRTQ                                                
         MVI   PRIDSDST-1,MXTRTQ                                                
         MVI   PRIDSNME-1,MXTRTQ                                                
*                                                                               
         MVC   PRIDSAGY,PDSTKAGY   AGENCY                                       
         TR    PRIDSAGY,MXTRT                                                   
         MVC   PRIDSMED,PDSTKMED   MEDIA                                        
         TR    PRIDSMED,MXTRT                                                   
         MVC   PRIDSCLT,PDSTKCLT   CLIENT                                       
         TR    PRIDSCLT,MXTRT                                                   
         MVC   PRIDSDIV,PDSTKDIV   DIVISION                                     
         TR    PRIDSDIV,MXTRT                                                   
         MVC   PRIDSREG,PDSTKREG   REGION                                       
         TR    PRIDSREG,MXTRT                                                   
         MVC   PRIDSDST,PDSTKDST   DISTRICT                                     
         TR    PRIDSDST,MXTRT                                                   
*                                                                               
         LA    R6,PDSTRECD                                                      
         MVI   ELCODE,X'05'                                                     
         BRAS  RE,GETEL                                                         
         JNE   PDST0010                                                         
*                                                                               
         USING PDSTELEM,R6                                                      
         MVC   PRIDSNME,PDSTNAME   NAME                                         
         DROP  R6                                                               
*                                                                               
PDST0010 DS    0H                                                               
         TR    PRIDSNME,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIDSLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIPDA - EXTRACT PUB DISTRICT ASSIGNMENTS                                     
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIPDA   NMOD1 WORKL,*PRIPDA*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIDPLIT                                                      
         USING LITERAL,RA                                                       
         L     R8,16(R1)                                                        
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIDPD,R2           R2=A(EXTRACT RECORD)                         
         USING LTLRECD,R3          R3=A(PUBFILE RECORD)                         
*                                                                               
         MVC   GENSWICH,8(R1)      SAVE                                         
         MVC   LOADSW,12(R1)       SAVE                                         
*                                                                               
         CLI   GENSWICH,1          FIRST CALL FROM PTXTRACT LOAD ?              
         JE    PDABUILD            YES- BUILD RECORD(S)                         
*                                                                               
         CLI   GENSWICH,3          FIRST CALL FROM PTXTRACT UPDATE ?            
         JE    PDABUILD            YES- BUILD RECORD(S)                         
*                                                                               
         J     PDANEXTR            OUTPUT RECORD(S)                             
*                                                                               
PRIDPLIT DC    A(LITERAL)                                                       
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
**   PDANEXTR                                                                   
***********************************************************************         
         SPACE 1                                                                
PDANEXTR DS    0H                                                               
         L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASSBACK ?                         
         JNZ   PDANXTD             YES                                          
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
PDANXTD  DS    0H                                                               
         LA    R0,PRIDPD           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1                                                            
         ICM   R1,3,PRIDPLEN-PRIDPD(RE)    LENGTH OF NEXT RECORD                
         LA    RF,0(R1,RE)                                                      
         ST    RF,ANEXT            SAVE NEXT ADDRESS                            
         LR    RF,R1                                                            
         MVCL  R0,RE               RECORD TO BUFFER                             
*                                                                               
         J     EXIT                                                             
*                                                                               
***********************************************************************         
**   PDABUILD      (RECORDS ARE BUILT IN A BUFFER AREA NAMED PTXPDAC) *         
***********************************************************************         
*       ****  NOTE  ****  NOTE  ****  NOTE  ****  NOTE ****           *         
*      DO NOT USE R6 IN BELOW ROUTINE OTHER THAN AS A POINTER         *         
*  (VIA GETEL/NEXTEL) TO THE CLT/DIV/REG/DST ELEMENT IN THE LTLREC    *         
***********************************************************************         
         SPACE 1                                                                
PDABUILD DS    0H                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,PTXPDAC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         LA    R6,LTLRECD                                                       
         MVI   ELCODE,X'71'                                                     
         BRAS  RE,GETEL                                                         
         JE    PRIPDGO                                                          
         DC    H'0'                SHOULD NEVER HAPPEN                          
*                                                                               
PRIPDLUP DS    0H                                                               
*                                                                               
         BRAS  RE,NEXTEL           ANY MORE PUB DIST ELEM'S ?                   
*                                                                               
         JNE   EXIT                NO - DONE                                    
*                                                                               
PRIPDGO  DS    0H                  BUILD A RECORD FOR OUTPUT                    
*                                                                               
         LA    R0,PRIDPD           CLEAR THE RECORD                             
         LA    R1,PRIDPDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    PRIDPLEN,PRIDPLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIDPLEN(2),=AL2(PRIDPDL)                                        
         MVC   PRIDPTYP,PRDPQ                                                   
         MVI   PRIDPDX,MXTRTQ                                                   
         MVI   PRIDPDX+1,MXTRTQ                                                 
         MVI   PRIDPAGY-1,MXTRTQ                                                
         MVI   PRIDPMED-1,MXTRTQ                                                
         MVI   PRIDPPUN-1,MXTRTQ                                                
         MVI   PRIDPPUZ-1,MXTRTQ                                                
         MVI   PRIDPPUE-1,MXTRTQ                                                
         MVI   PRIDPCLT-1,MXTRTQ                                                
         MVI   PRIDPDIV-1,MXTRTQ                                                
         MVI   PRIDPREG-1,MXTRTQ                                                
         MVI   PRIDPDST-1,MXTRTQ                                                
         MVI   PRIDPSHR-1,MXTRTQ                                                
*                                                                               
DPX      USING PRIDPD,R5     R5=A(INITIALIZED EXTRACT RECORD)                   
         MVC   PRIDPACT,DPX.PRIDPACT                                            
         MVC   PRIDPDAT,DPX.PRIDPDAT                                            
         MVC   PRIDPTME,DPX.PRIDPTME                                            
*SMY*    CLI   DPX.PRIDPACT,C'C'                                                
*SMY*    BNE   *+8                                                              
         MVI   PRIDPACT,C'A'                                                    
         CLI   LOADSW,1            FROM LOADPDA IN PTXTRACT ?                   
         BNE   *+8                                                              
         MVI   PRIDPACT,C'L'                                                    
         DROP  DPX                                                              
*                                                                               
         MVC   PRIDPAGY,LTLKAGY    AGENCY                                       
         TR    PRIDPAGY,MXTRT                                                   
         MVC   PRIDPMED,LTLKMED    MEDIA                                        
         TR    PRIDPMED,MXTRT                                                   
*                                                                               
         XC    CHAR15,CHAR15                                                    
         MVC   CHAR6,LTLKPUB                                                    
         MVI   PRIMDPUB,X'08'                                                   
         GOTO1 =V(PUBEDIT),DMCB,(PRIMDPUB,CHAR6),(C'S',CHAR15)                  
*                                                                               
         MVC   PRIDPPUN,CHAR8      PUB NUMBER                                   
         TR    PRIDPPUN,MXTRT                                                   
*                                                                               
         CLI   CHAR6+4,0           ANY ZONE ?                                   
         BNH   LTLNUME             NO                                           
         MVC   PRIDPPUZ,CHAR2      ZONE                                         
         MVC   PRIDPPUE,CHAR3      EDITION - MAY BE NULLS                       
         B     LTLNUMX             FINISH PUB NUMBER WORK                       
LTLNUME  DS    0H                                                               
         MVC   PRIDPPUE,CHAR2      EDITION - MAY BE NULLS                       
LTLNUMX  DS    0H                                                               
         TR    PRIDPPUZ,MXTRT                                                   
         TR    PRIDPPUE,MXTRT                                                   
*                                                                               
         CLI   GENSWICH,3          FIRST CALL FROM PTXTRACT UPDATE ?            
         BNE   PRIPDMOR            NO                                           
         MVI   PRIDPACT,C'K'       DELETE ALL DIST ASSIGNS FOR PUB              
         J     PRIPDEND            DO NOT NEED BELOW FOR THIS TRAN              
*                                                                               
         USING PUBDSTD,R6                                                       
*                                                                               
PRIPDMOR DS    0H                                                               
         MVC   PRIDPCLT,PUBDCLT    CLIENT CODE                                  
         MVC   PRIDPDIV,PUBDDIV    DIVISION                                     
         MVC   PRIDPREG,PUBDREG    REGION                                       
         MVC   PRIDPDST,PUBDDST    DISTRICT                                     
*                                  REG/DST SHARE PCT                            
         EDIT  (B2,PUBDSHR),(L'PRIDPSHR,PRIDPSHR),2,FILL=0                      
*                                                                               
         DROP  R6                                                               
*                                                                               
         TR    PRIDPCLT,MXTRT                                                   
         TR    PRIDPDIV,MXTRT                                                   
         TR    PRIDPREG,MXTRT                                                   
         TR    PRIDPDST,MXTRT                                                   
         TR    PRIDPSHR,MXTRT                                                   
*                                                                               
PRIPDEND DS    0H                                                               
         SR    RE,RE               CLEAR FOR NEXT RECORD                        
         ICM   RE,3,PRIDPLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         CLI   GENSWICH,3          FIRST CALL FROM PTXTRACT UPDATE ?            
         JNE   PRIPDLUP            NO - NEXT ELEM                               
         MVI   GENSWICH,1          ONLY DO ONE "K" TRAN                         
         J     PRIPDGO             CREATE AN "ADD" RECORD                       
*                                                                               
*                                                                               
PTXPDAC  DC    A(BUFFER1)          RECORD SAVE AREA                             
*                                                                               
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* PRIACG - EXTRACT ADDITIONAL CHARGE RECORDS                                    
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIACG   NMOD1 WORKL,*PRIACG*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIACLIT                                                      
         USING LITERAL,RA                                                       
         L     R8,16(R1)                                                        
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIACD,R2           R2=A(EXTRACT RECORD)                         
         USING PSPLRECD,R3         R3=A(ADDITIONAL CHARGE RECORD)               
*                                                                               
         MVC   GENSWICH,8(R1)      SAVE                                         
         MVC   LOADSW,12(R1)       SAVE                                         
*                                                                               
         CLI   GENSWICH,1          FIRST CALL FROM PTXTRACT LOAD ?              
         JE    PACBUILD            YES- BUILD RECORD(S)                         
*                                                                               
         CLI   GENSWICH,3          FIRST CALL FROM PTXTRACT UPDATE ?            
         JE    PACBUILD            YES- BUILD RECORD(S)                         
*                                                                               
         J     PACNEXTR            OUTPUT RECORD(S)                             
*                                                                               
PRIACLIT DC    A(LITERAL)                                                       
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
**   PACNEXTR                                                                   
***********************************************************************         
         SPACE 1                                                                
PACNEXTR DS    0H                                                               
         L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASS BACK ?                        
         JNZ   PACNXTD             YES                                          
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
PACNXTD  DS    0H                                                               
         LA    R0,PRIACD           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1                                                            
         ICM   R1,3,PRIACLEN-PRIACD(RE)    LENGTH OF NEXT RECORD                
         LA    RF,0(R1,RE)                                                      
         ST    RF,ANEXT            SAVE NEXT ADDRESS                            
         LR    RF,R1                                                            
         MVCL  R0,RE               RECORD TO BUFFER                             
*                                                                               
         J     EXIT                                                             
*                                                                               
***********************************************************************         
**   PACBUILD      (RECORDS ARE BUILT IN A BUFFER AREA NAMED PTXPACC) *         
***********************************************************************         
*       ****  NOTE  ****  NOTE  ****  NOTE  ****  NOTE ****           *         
*      DO NOT USE R6 IN BELOW ROUTINE OTHER THAN AS A POINTER         *         
* (VIA GETEL/NEXTEL) TO THE PSPLELEM ELEMENTS IN THE ADD'L CHARGE REC *         
***********************************************************************         
         SPACE 1                                                                
PACBUILD DS    0H                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,PTXPACC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         LA    R6,PSPLRECD                                                      
         MVI   ELCODE,X'10'                                                     
         BRAS  RE,GETEL                                                         
         JE    PRACGGO                                                          
         DC    H'0'                SHOULD NEVER HAPPEN                          
*                                                                               
PRACGLUP DS    0H                                                               
*                                                                               
         BRAS  RE,NEXTEL           ANY MORE ADD'L CHG ELEM'S ?                  
*                                                                               
         JNE   EXIT                NO - DONE                                    
*                                                                               
PRACGGO  DS    0H                  BUILD A RECORD FOR OUTPUT                    
*                                                                               
         LA    R0,PRIACD           CLEAR THE RECORD                             
         LA    R1,PRIACDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    PRIACLEN,PRIACLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIACLEN(2),=AL2(PRIACDL)                                        
         MVC   PRIACTYP,PRACQ                                                   
         MVI   PRIACDX,MXTRTQ                                                   
         MVI   PRIACDX+1,MXTRTQ                                                 
         MVI   PRIACAGY-1,MXTRTQ                                                
         MVI   PRIACMED-1,MXTRTQ                                                
         MVI   PRIACCHG-1,MXTRTQ                                                
         MVI   PRIACTPE-1,MXTRTQ                                                
         MVI   PRIACDSC-1,MXTRTQ                                                
*                                                                               
ACG      USING PRIACD,R5     R5=A(INITIALIZED EXTRACT RECORD)                   
         MVC   PRIACACT,ACG.PRIACACT                                            
         MVC   PRIACDAT,ACG.PRIACDAT                                            
         MVC   PRIACTME,ACG.PRIACTME                                            
*SMY*    CLI   ACG.PRIACACT,C'C'                                                
*SMY*    BNE   *+8                                                              
         MVI   PRIACACT,C'A'                                                    
         CLI   LOADSW,1            FROM LOADPAC IN PTXTRACT ?                   
         BNE   *+8                                                              
         MVI   PRIACACT,C'L'                                                    
         DROP  ACG                                                              
*                                                                               
         MVC   PRIACAGY,PSPLKAGY   AGENCY                                       
         TR    PRIACAGY,MXTRT                                                   
         MVC   PRIACMED,PSPLKMED   MEDIA                                        
         TR    PRIACMED,MXTRT                                                   
*                                                                               
         CLI   GENSWICH,3          FIRST CALL FROM PTXTRACT UPDATE ?            
         BNE   PRACGMOR            NO                                           
         MVI   PRIACACT,C'K'       DELETE ALL AD CHG RECS FOR AGY/MED           
         J     PRACGEND            DO NOT NEED BELOW FOR THIS TRAN              
*                                                                               
         USING PSPLELEM,R6                                                      
*                                                                               
PRACGMOR DS    0H                                                               
         MVC   PRIACCHG,PSPLCODE   ADDITIONAL CHARGE CODE                       
         MVC   PRIACTPE,PSPLTYPE   ADDITIONAL CHARGE TYPE (M OR P)              
         MVC   PRIACDSC,PSPLDESC   ADDITIONAL CHARGE DESCRIPTION                
*                                                                               
         DROP  R6                                                               
*                                                                               
         TR    PRIACCHG,MXTRT                                                   
         TR    PRIACTPE,MXTRT                                                   
         TR    PRIACDSC,MXTRT                                                   
*                                                                               
PRACGEND DS    0H                                                               
         SR    RE,RE               CLEAR FOR NEXT RECORD                        
         ICM   RE,3,PRIACLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         CLI   GENSWICH,3          FIRST CALL FROM PTXTRACT UPDATE ?            
         JNE   PRACGLUP            NO - NEXT ELEM                               
         MVI   GENSWICH,1          ONLY DO ONE "K" TRAN                         
         J     PRACGGO             CREATE AN "ADD" RECORD                       
*                                                                               
*                                                                               
PTXPACC  DC    A(BUFFER1)          RECORD SAVE AREA                             
*                                                                               
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
*                                                                               
***********************************************************************         
* PRIUCM - EXTRACT PRINTPAK UCOMM RECORD                                        
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
         SPACE 1                                                                
PRIUCM   NMOD1 WORKL,*PRIUCM*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIUCLIT                                                      
         USING LITERAL,RA                                                       
         L     R8,16(R1)                                                        
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIUCD,R2           R2=A(EXTRACT RECORD)                         
         USING PUCMREC,R3          R3=A(PRINT UCOMM RECORD)                     
*                                                                               
         MVC   GENSWICH,8(R1)      SAVE                                         
         MVC   LOADSW,12(R1)       SAVE                                         
*                                                                               
         L     R9,20(R1)           R9=A(SAVED UCOMM CLIENT RECORD)              
         ST    R9,UCR9SAV                                                       
*                                                                               
         MVI   UCMDEL,0            CLEAR                                        
         CLI   LOADSW,1            IS THIS A LOAD ?                             
         BE    *+8                 YES - DO NOT SET BELOW SWITCH                
         MVI   UCMDEL,1            "FIRST" PASS INDICATOR - WILL PASS           
*                                    "KILL" TRN FOR EACH "ADD" TRN              
         CLI   GENSWICH,1          FIRST CALL FROM PTXTRACT LOAD ?              
         JE    UCMBUILD            YES- BUILD RECORD(S)                         
*                                                                               
         CLI   GENSWICH,3          FIRST CALL FROM PTXTRACT UPDATE ?            
         JE    UCMBUILD            YES- BUILD RECORD(S)                         
*                                                                               
         J     UCMNEXTR            OUTPUT RECORD(S)                             
*                                                                               
PRIUCLIT DC    A(LITERAL)                                                       
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
**   UCMNEXTR                                                                   
***********************************************************************         
         SPACE 1                                                                
UCMNEXTR DS    0H                                                               
         L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       RECORD TO PASSBACK ?                         
         JNZ   UCMNXTD             YES                                          
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
UCMNXTD  DS    0H                                                               
         LA    R0,PRIUCD           RETURN BUFFER                                
         L     RE,ANEXT            A(NEXT RECORD IN SERIES)                     
         SR    R1,R1                                                            
         ICM   R1,3,PRIUCLEN-PRIUCD(RE)    LENGTH OF NEXT RECORD                
         LA    RF,0(R1,RE)                                                      
         ST    RF,ANEXT            SAVE NEXT ADDRESS                            
         LR    RF,R1                                                            
         MVCL  R0,RE               RECORD TO BUFFER                             
*                                                                               
         J     EXIT                                                             
*                                                                               
***********************************************************************         
**   UCMBUILD      (RECORDS ARE BUILT IN A BUFFER AREA NAMED PTXUCMC) *         
***********************************************************************         
*       ****  NOTE  ****  NOTE  ****  NOTE  ****  NOTE ****           *         
*      DO NOT USE R6 IN BELOW ROUTINE OTHER THAN AS A POINTER         *         
*             TO THE VARIOUS ELEMENTS IN THE PUCOMREC                 *         
***********************************************************************         
         SPACE 1                                                                
UCMBUILD DS    0H                                                               
         LR    R5,R2               KEEP POINTER TO BLANK RECORD                 
         L     R2,PTXUCMC          WHERE RECORDS TO BE BUILT                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         XC    0(8,R2),0(R2)                                                    
*                                                                               
UCMBTOP  DS    0H                                                               
         MVI   ELUCM,X'41'         "41" TO "44" ARE PRODUCT ELEMENTS            
         OC    PUCMKEST,PUCMKEST   PRODUCT UCOMM ?                              
         BZ    PRIUCCK             YES                                          
         MVI   ELUCM,X'51'         "51" TO "54" ARE ESTIMATE ELEMENTS           
         OC    PUCMKDIV,PUCMKDIV   ESTIMATE UCOMM ?                             
         BZ    PRIUCCK             YES                                          
         MVI   ELUCM,X'61'         "61" TO "62" ARE REGION ELEMENTS             
         OC    PUCMKDST,PUCMKDST   REGION   UCOMM ?                             
         BZ    PRIUCCK             YES                                          
         MVI   ELUCM,X'71'         "71" TO "72" ARE DISTRICT ELEMENTS           
*                                                                               
PRIUCCK  DS    0H                  "TOP" OF OUTPUT PROCESSING                   
         L     R9,UCR9SAV                                                       
         LA    R9,33(R9)           FIRST ELEM IN SAVED CLIENT UCOMM REC         
PRIUCCKD DS    0H                                                               
         CLI   0(R9),0             END OF CLIENT ?                              
         JNE   PRIUCCKJ            NO                                           
         CLI   UCMDEL,1            WERE WE DOING A DELETE ?                     
         JNE   EXIT                NO - DONE                                    
         MVI   UCMDEL,0            DELETES ((K)ILLS) ARE DONE                   
         J     UCMBTOP             START "OVER" AND BUILD ADD(S)                
PRIUCCKJ DS    0H                                                               
         CLC   0(1,R9),ELUCM       MATCH ?                                      
         JE    PRIUCGO             YES                                          
         ZIC   RE,1(R9)                                                         
         AR    R9,RE               BUMP TO NEXT CLIENT ELEMENT                  
         J     PRIUCCKD                                                         
*                                  R9 -> CLIENT UCOMM ELEMENT                   
PRIUCGO  DS    0H                  BUILD A RECORD FOR OUTPUT                    
         LA    R0,PRIUCD           CLEAR THE RECORD                             
         LA    R1,PRIUCDL                                                       
         SR    RF,RF                                                            
         SR    RE,RE                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    PRIUCLEN,PRIUCLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIUCLEN(2),=AL2(PRIUCDL)                                        
         MVC   PRIUCTYP,PRUCQ                                                   
*                                                                               
* INSERT DELIMITERS EVERYWHERE                                                  
         MVI   PRIUCAGY-1,MXTRTQ                                                
         MVI   PRIUCMED-1,MXTRTQ                                                
         MVI   PRIUCCLT-1,MXTRTQ                                                
         MVI   PRIUCTYP-1,MXTRTQ                                                
         MVI   PRIUCSEQ-1,MXTRTQ                                                
         MVI   PRIUCPRD-1,MXTRTQ                                                
         MVI   PRIUCEST-1,MXTRTQ                                                
         MVI   PRIUCDIV-1,MXTRTQ                                                
         MVI   PRIUCREG-1,MXTRTQ                                                
         MVI   PRIUCDST-1,MXTRTQ                                                
         MVI   PRIUCNAM-1,MXTRTQ                                                
         MVI   PRIUCTXT-1,MXTRTQ                                                
         MVI   PRIUCLN-1,MXTRTQ                                                 
         MVI   PRIUCEDT-1,MXTRTQ                                                
         MVI   PRIUCMBI-1,MXTRTQ                                                
         MVI   PRIUCDX,MXTRTQ                                                   
         MVI   PRIUCDX+1,MXTRTQ                                                 
*                                                                               
UCX      USING PRIUCD,R5     R5=A(INITIALIZED EXTRACT RECORD)                   
         MVC   PRIUCACT,UCX.PRIUCACT                                            
         MVC   PRIUCDAT,UCX.PRIUCDAT                                            
         MVC   PRIUCTME,UCX.PRIUCTME                                            
*SMY*    CLI   UCX.PRIUCACT,C'C'                                                
*SMY*    BNE   *+8                                                              
         MVI   PRIUCACT,C'A'                                                    
         CLI   LOADSW,1            FROM LOADUCM IN PTXTRACT ?                   
         BNE   *+8                                                              
         MVI   PRIUCACT,C'L'       YES                                          
         DROP  UCX                                                              
*                                                                               
* DATA EXTRACT PART                                                             
*                                                                               
         MVC   PRIUCAGY,PUCMKAGY                                                
*                                                                               
         MVC   PRIUCMED,PUCMKMED                                                
*                                                                               
         MVC   PRIUCCLT,PUCMKCLT                                                
*                                                                               
         MVC   PRIUCPRD,=C'N/A'                                                 
         OC    PUCMKPRD,PUCMKPRD                                                
         BZ    *+10                                                             
         MVC   PRIUCPRD,PUCMKPRD                                                
*                                                                               
         MVC   PRIUCEST,=C'000'                                                 
         OC    PUCMKEST,PUCMKEST                                                
         BZ    PRIUC20                                                          
         EDIT  PUCMKEST,PRIUCEST,FILL=0                                         
*                                                                               
PRIUC20  DS    0H                                                               
         MVC   PRIUCDIV,=C'N/A '                                                
         OC    PUCMKDIV,PUCMKDIV                                                
         BZ    *+10                                                             
         MVC   PRIUCDIV,PUCMKDIV                                                
*                                                                               
         MVC   PRIUCREG,=C'N/A '                                                
         OC    PUCMKREG,PUCMKREG                                                
         BZ    *+10                                                             
         MVC   PRIUCREG,PUCMKREG                                                
*                                                                               
         MVC   PRIUCDST,=C'N/A '                                                
         OC    PUCMKDST,PUCMKDST                                                
         BZ    *+10                                                             
         MVC   PRIUCDST,PUCMKDST                                                
*                                                                               
         TR    PRIUCAGY,MXTRT                                                   
         TR    PRIUCMED,MXTRT                                                   
         TR    PRIUCCLT,MXTRT                                                   
         TR    PRIUCPRD,MXTRT                                                   
         TR    PRIUCEST,MXTRT                                                   
         TR    PRIUCDIV,MXTRT                                                   
         TR    PRIUCREG,MXTRT                                                   
         TR    PRIUCDST,MXTRT                                                   
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
* R3=> PRINT UCOMM RECORD                                                       
* R9=> ELEMENT IN SAVED UCOMM CLIENT RECORD                                     
*                                                                               
*   OUTPUT EXTRACT RECORD DATA FROM "MATCHED"                                   
*   CLIENT UCOMM RECORD ELEMENT POINTED TO BY R9                                
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
*                                                                               
PRIUCOUT DS    0H                                                               
         MVC   BYTE,0(R9)          ELEMENT CODE                                 
         NI    BYTE,X'0F'          TURN OFF HOB                                 
         EDIT  (B1,BYTE),PRIUCSEQ       FIELD SEQUENCE NUMBER                   
*                                                                               
         CLI   UCMDEL,1            FIRST PASS THROUGH PRIUCM ?                  
         JNE   PRIUCMOR            NO                                           
         MVI   PRIUCACT,C'K'       DELETE ALL RECORDS FOR THIS KEY              
         J     PRIUCNXT            CHECK FOR MORE CLIENT UCOMM ELEMS            
*                                      (ONLY NEED KEY FOR (K)ILLS)              
PRIUCMOR DS    0H                                                               
         ZIC   RE,1(R9)            ELEMENT LENGTH                               
         SHI   RE,7                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   PRIUCNAM(0),PUCMDT-PUCMELEM(R9) FIELD NAME                       
         OC    PRIUCNAM,SPACES                                                  
*                                                                               
         MVC   PRIUCEDT,PUCMEDIT-PUCMELEM(R9) EDITABLE                          
*                                                                               
         MVC   BYTE,PUCMLEN-PUCMELEM(R9)                                        
         EDIT  BYTE,PRIUCLN        FIELD LENGTH                                 
*                                                                               
         MVI   PRIUCMBI,C'N'                                                    
         TM    PUCMUSE1-PUCMELEM(R9),X'08'                                      
         BZ    *+8                                                              
         MVI   PRIUCMBI,C'Y'                                                    
*                                                                               
         TR    PRIUCSEQ,MXTRT                                                   
         TR    PRIUCNAM,MXTRT                                                   
         TR    PRIUCLN,MXTRT                                                    
         TR    PRIUCEDT,MXTRT                                                   
         TR    PRIUCMBI,MXTRT                                                   
*                                                                               
         LA    R6,PUCMREC+33                                                    
PRIUCLUP DS    0H                  NOW OUTPUT FIELD DATA IF PRESENT             
         CLI   0(R6),0             ANY MORE ELEMENTS ?                          
         JE    PRIUCNXT            NO - DONE                                    
         CLC   0(1,R6),ELUCM         ELEMENT WANTED ?                           
         JE    PRIUCTXO            YES                                          
         ZIC   RE,1(R6)                                                         
         AR    R6,RE                                                            
         J     PRIUCLUP                                                         
*                                                                               
PRIUCTXO DS    0H                                                               
         ZIC   RE,1(R6)            ELEMENT LENGTH OF "COMMENT" ELEMENT          
         SHI   RE,7                ELEM OVERHEAD PLUS 1 FOR EX                  
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   PRIUCTXT(0),PUCMDT-PUCMELEM(R6)                                  
         OC    PRIUCTXT,SPACES     FIELD DATA FROM "COMMENT" ELEMENT            
         TR    PRIUCTXT,MXTRT                                                   
*                                                                               
PRIUCNXT DS    0H                                                               
         ZIC   RE,ELUCM                                                         
         LA    RE,1(RE)                                                         
         STC   RE,ELUCM            "NEXT" ELEMENT TO CHECK FOR                  
*                                                                               
PRIUCEND DS    0H                                                               
         SR    RE,RE               CLEAR FOR NEXT RECORD                        
         ICM   RE,3,PRIUCLEN                                                    
         AR    R2,RE                                                            
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         J     PRIUCCK             CHECK FOR MORE                               
*                                                                               
UCR9SAV  DS    F                                                                
ELUCM    DS    X                                                                
UCMDEL   DS    X                                                                
*                                                                               
PTXUCMC  DC    A(BUFFER1)          RECORD SAVE AREA                             
*                                                                               
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
*                                                                               
***********************************************************************         
* PRIBUD - EXTRACT BUDGET RECORD                                                
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINTPAK RECORD)                                              *         
* AL4 0=REPFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
*                                                                               
PRIBUD   NMOD1 WORKL,*PRIBUD*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,PRIBDLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         USING PRIBDD,R2           R2=A(EXTRACT RECORD)                         
         USING PBUDREC,R3          R3=A(PRINT RECORD)                           
*                                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         OI    PTXPFLG1,NORDSEQ                                                 
         DROP  RF                                                               
*                                                                               
         XC    PRIBDLEN,PRIBDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   PRIBDLEN(2),=AL2(PRIBDDL)                                        
         MVC   PRIBDTYP,PRBDQ                                                   
         MVI   PRIBDDX,MXTRTQ                                                   
         MVI   PRIBDDX+1,MXTRTQ                                                 
         MVI   PRIBDAGY-1,MXTRTQ                                                
         MVI   PRIBDMED-1,MXTRTQ                                                
         MVI   PRIBDCNT-1,MXTRTQ                                                
         MVI   PRIBDPRD-1,MXTRTQ                                                
         MVI   PRIBDEST-1,MXTRTQ                                                
         MVI   PRIBDREG-1,MXTRTQ                                                
         MVI   PRIBDDIS-1,MXTRTQ                                                
         MVI   PRIBDMY-1,MXTRTQ                                                 
         MVI   PRIBDTP-1,MXTRTQ                                                 
         MVI   PRIBDAMT-1,MXTRTQ                                                
*                                                                               
         MVC   PRIBDAGY,PBUDKAGY   AGENCY                                       
         TR    PRIBDAGY,MXTRT                                                   
         MVC   PRIBDMED,PBUDKMED   MEDIA                                        
         TR    PRIBDMED,MXTRT                                                   
         MVC   PRIBDCNT,PBUDKCLT   CLIENT                                       
         TR    PRIBDCNT,MXTRT                                                   
         MVC   PRIBDPRD,PBUDKPRD   PRODUCT                                      
         TR    PRIBDPRD,MXTRT                                                   
         MVC   PRIBDEST,PBUDKEST   ESTIMATE                                     
         TR    PRIBDEST,MXTRT                                                   
         MVC   PRIBDREG,PBUDKREG   REGION                                       
         TR    PRIBDREG,MXTRT                                                   
         MVC   PRIBDDIS,PBUDKDST   DISTRICT                                     
         TR    PRIBDDIS,MXTRT                                                   
*                                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         TM    PTXPFLG1,KILLQ                                                   
         BZ    PRIBUD10                                                         
*                                                                               
         MVI   PRIBDACT,C'K'                                                    
         NI    PTXPFLG1,X'FF'-KILLQ-NORDSEQ                                     
         MVI   ELCOUNT,0           RE-SET ELEMENT COUNT                         
         J     EXIT                                                             
         DROP  RF                                                               
*                                                                               
PRIBUD10 DS    0H                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         TM    PTXPFLG1,MULTIQ                                                  
         BZ    *+8                                                              
         MVI   PRIBDACT,C'A'                                                    
         DROP  RF                                                               
*                                                                               
         LA    R6,PBUDRECD                                                      
         MVI   ELCODE,X'01'        PBUDELEM                                     
         BRAS  RE,GETEL                                                         
         JE    PRIBUD20                                                         
*                                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         OI    PTXPFLG1,NOWRITEQ                                                
         NI    PTXPFLG1,X'FF'-KILLQ-NORDSEQ-MULTIQ                              
         MVI   ELCOUNT,0           RE-SET ELEMENT COUNT                         
         J     YES                                                              
         DROP  RF                                                               
*                                                                               
         USING PBUDELEM,R6                                                      
*                                                                               
PRIBUD20 DS    0H                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         TM    PTXPFLG1,BLDMOSTQ   NEED TO BUILD MOS TABLE?                     
         BZ    *+12                                                             
         NI    PTXPFLG1,X'FF'-BLDMOSTQ                                          
         BRAS  RE,BLDMOS                                                        
         DROP  RF                                                               
*                                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         LLC   R0,ELCOUNT                                                       
         DROP  RF                                                               
         MHI   R0,2                                                             
         LARL  RF,MOSTAB                                                        
         AR    RF,R0                                                            
*                                                                               
         GOTO1 DATCON,DMCB,(3,0(RF)),(6,PRIBDMY)                                
*                                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         MVC   PRIBDTP,BUDTYPE    BUDGET TYPE                                   
         TR    PRIBDTP,MXTRT                                                    
         DROP  RF                                                               
*                                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         LLC   RF,ELCOUNT                                                       
         DROP  RF                                                               
         MHI   RF,4                                                             
         LA    RF,PBUDAMTS(RF)                                                  
         ICM   RF,15,0(RF)                                                      
*        BNZ   PRIBUD30                                                         
*                                                                               
*        L     RF,APTXPARM                                                      
*        USING PTXPARM,RF                                                       
*        OI    PTXPFLG1,NOWRITEQ                                                
*        DROP  RF                                                               
*        B     PRIBUD40                                                         
*                                                                               
PRIBUD30 DS    0H                                                               
         EDIT  (RF),(12,PRIBDAMT),2                                             
*                                                                               
PRIBUD40 DS    0H                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         CLI   ELCOUNT,11          PROCESSED 12 MONTHS?                         
         BL    PRIBUD50            NO - BUMP ELCOUNT                            
*                                                                               
PRIBUD45 DS    0H                                                               
         NI    PTXPFLG1,X'FF'-KILLQ-NORDSEQ-MULTIQ                              
         MVI   ELCOUNT,0           RE-SET ELEMENT COUNT                         
         J     EXIT                                                             
         DROP  RF                                                               
*                                                                               
PRIBUD50 DS    0H                                                               
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         LLC   R0,ELCOUNT                                                       
         AHI   R0,1                                                             
         STC   R0,ELCOUNT                                                       
*                                                                               
         MHI   R0,2                                                             
         LARL  RF,MOSTAB                                                        
         AR    RF,R0                                                            
         OC    0(2,RF),0(RF)                                                    
         JNZ   EXIT                                                             
         L     RF,APTXPARM                                                      
         USING PTXPARM,RF                                                       
         NI    PTXPFLG1,X'FF'-KILLQ-NORDSEQ-MULTIQ                              
         MVI   ELCOUNT,0           RE-SET ELEMENT COUNT                         
         J     EXIT                                                             
*                                                                               
         DROP  RF                                                               
*                                                                               
         J     EXIT                                                             
*                                                                               
PRIBDLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R2,R3                                                            
         EJECT                                                                  
*                                                                               
***********************************************************************         
* LITERALS AND CONSTANTS REQUIRED FOR ALL ROUTINES                    *         
***********************************************************************         
         SPACE 1                                                                
LITERAL  DS    0D                                                               
GETBROAD DC    V(GETBROAD)                                                      
DATCON   DC    V(DATCON)                                                        
VGETDAY  DC    V(GETDAY)                                                        
VADDAY   DC    V(ADDAY)                                                         
VLOADER  DC    V(LOADER)                                                        
COMFACS  DC    V(COMFACS)                                                       
GETINS   DC    A(0)                                                             
OFFICER  DC    A(0)                                                             
EDITOR   DC    A(0)                                                             
ANEXT    DC    F'0'                                                             
VERSIONA DC    X'00'               VERSION NUMBER PASSED FROM PTXTRACT          
GENSWICH DC    C' '                                                             
LOADSW   DC    C' '                                                             
CAPSWICH DC    X'01'             SWICH FOR CAP1= X'01' CAP2= X'02'              
DATADISP DC    X'0021'                                                          
DMRDHI   DC    CL7'DMRDHI'                                                      
GETREC   DC    CL7'GETREC'                                                      
PRTDIR   DC    CL7'PRTDIR'                                                      
PRTFIL   DC    CL7'PRTFIL'                                                      
GENDIR   DC    CL7'GENDIR'                                                      
GENFIL   DC    CL7'GENFIL'                                                      
*                                                                               
SPACES   DC    CL60' '                                                          
*                                                                               
**********************************************************************          
*                                                                               
LOADER   ICM   RF,15,GETINS                                                     
         BNZR  RE                                                               
         NTR1  ,                                                                
         MVC   WORK,=CL8'T00AAB'                                                
         XC    PLIST(6*4),PLIST                                                 
         GOTO1 VLOADER,PLIST,WORK,0                                             
         MVC   GETINS,4(R1)                                                     
         J     EXIT                                                             
         LTORG                                                                  
*                                                                               
**********************************************************************          
*                                                                               
LOADER2  ICM   RF,15,OFFICER                                                    
         BNZR  RE                                                               
         NTR1  ,                                                                
         MVC   WORK,=CL8'T00A38'                                                
         XC    PLIST(6*4),PLIST                                                 
         GOTO1 VLOADER,PLIST,WORK,0                                             
         MVC   OFFICER,4(R1)                                                    
         J     EXIT                                                             
         LTORG                                                                  
*                                                                               
*                                                                               
LOADER3  ICM   RF,15,EDITOR                                                     
         BNZR  RE                                                               
         NTR1  ,                                                                
         MVC   WORK,=CL8'T00A71'                                                
         XC    PLIST(6*4),PLIST                                                 
         GOTO1 VLOADER,PLIST,WORK,0                                             
         MVC   EDITOR,4(R1)                                                     
         J     EXIT                                                             
         LTORG                                                                  
*                                                                               
**********************************************************************          
*                                                                               
*                                                                               
*MXTRT                                                                          
       ++INCLUDE MXTRT                                                          
*                                                                               
*PTXRECID                                                                       
       ++INCLUDE PTXRECID                                                       
*                                                                               
*SPCGRTAB                                                                       
       ++INCLUDE SPCGRTAB                                                       
*GETEL                                                                          
         GETEL R6,DATADISP,ELCODE                                               
*                                                                               
GETCONC  DC    XL(GETCONLQ)'00'    PPGETCON CONTROL BLOCK                       
COMREC   DS    CL3000                                                           
BIGTABD  DS    CL5000                                                           
*                                                                               
         DC    CL8'BUFFER01'                                                    
BUFFER1  DC    3000XL8'00'         HOLDS RECORDS FOR WRITING TO FILE            
BUFFER1L EQU   *-BUFFER1                                                        
*                                                                               
*                                                                               
***********************************************************************         
*        TRANSLATE PID TO A NAME                                      *         
*        ON ENTRY:                                                    *         
*        R1 A(PID)                                                    *         
*        8-CHARACTER PID RETURNED IN WORK                             *         
***********************************************************************         
TRNPID   NTR1  BASE=*,LABEL=*                                                   
         MVC   WORK,SPACES        INIT OUTPUT                                   
*                                                                               
         LAY   RA,LITERAL                                                       
         USING LITERAL,RA                                                       
*                                                                               
         LA    R6,COMREC                                                        
         USING SA0REC,R6           ESTABLISH KEY AS PERSON AUTH REC             
         XC    SA0KEY,SA0KEY       INIT KEY                                     
*                                                                               
         MVI   SA0KTYP,SA0KTYPQ    SET RECORD TYPE                              
         L     RF,APARM                                                         
         L     RF,12(RF)                                                        
         MVC   SA0KAGY,SXDTSAGY-SXDTABD(RF)                                     
         MVC   SA0KNUM,0(R1)       SET PID                                      
*                                                                               
         MVC   WKKEY(L'SA0KEY),0(R6)                                            
*                                                                               
         L     RF,=V(UTL)                                                       
         MVC   BYTE,4(RF)                                                       
         MVI   4(RF),X'0A'         CONTROL                                      
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,DMRDHI),=CL7'CTFILE',SA0KEY,SA0REC,0                
*                                                                               
         L     RF,=V(UTL)                                                       
         MVC   4(1,RF),BYTE                                                     
*                                                                               
         CLC   SA0KEY,WKKEY        SKIP IF RECORD NOT FOUND                     
         JNE   NO                                                               
*                                                                               
*        FIND PERSON'S ID ELEMENT                                               
*                                                                               
         LA    R6,SA0DATA          POINT TO FIRST ELEMENT                       
*                                                                               
TRNPID10 CLI   0(R6),0             CHECK FOR END OF RECORD                      
         JE    NO                                                               
*                                                                               
         CLI   0(R6),SAPALELQ      X'C3' PERSONAL ID ELEMENT                    
         JNE   *+14                                                             
         MVC   WORK(L'SAPALPID),SAPALPID-SAPALD(R6)                             
         J     YES                                                              
*                                                                               
         LLC   R0,1(R6)            GET ELEMENT LENGTH                           
         LTR   R0,R0                                                            
         JE    NO                                                               
         AR    R6,R0               BUMP TO NEXT ELEMENT                         
         J     TRNPID10            GO FIND NEXT ELEMENT                         
*                                                                               
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
***********************************************************************         
* DISPLAYS BILLING FORMULA                                                      
* P1 EXPECTED TO POINT TO PRD OR ESTIMATE RECORD BILLING PROFILE                
* P2 EXPECTED TO POINT TO OUTPUT AREA                                           
***********************************************************************         
DISBFM   NTR1  BASE=*,LABEL=*                                                   
         LARL  RA,LITERAL                                                       
         USING LITERAL,RA                                                       
*                                                                               
         USING BILPROF,R6          PRD/EST BILLING PROFILE DSECT                
         L     R6,0(R1)            A(BILL PROFILE                               
         MVC   FULL,4(R1)          A(OUTPUT)                                    
*                                                                               
         MVC   WKKEY,SPACES                                                     
         MVI   WKKEY,X'FF'         TO ENSURE BACKUP LOOP TERMINATION            
         LA    R4,WKKEY+1          BILL FORMULA WORK AREA                       
*                                                                               
         CLI   0(R6),X'00'                                                      
         BE    DISBFM20                                                         
*                                                                               
         MVC   BYTE,BILBASA                                                     
         CLI   BILCMSW,C'C'        COMMISSION ONLY                              
         BNE   *+8                                                              
         OI    BYTE,X'10'                                                       
         CLI   BILNBSW,C'Y'        NOT FOR BILLING                              
         BNE   *+8                                                              
         OI    BYTE,X'20'                                                       
         LR    R2,R4                                                            
         LA    R3,BYTE                                                          
         BRAS  RE,DR_FBCOD                                                      
*                                                                               
         LA    R4,4(R4)                                                         
* BACK UP TO FIRST NON-SPACE CHARACTER                                          
         CLI   0(R4),C' '                                                       
         BH    *+8                                                              
         BCT   R4,*-8                                                           
         LA    R4,1(R4)                                                         
*                                                                               
         XR    R5,R5                                                            
         ICM   R5,15,BILADJ                                                     
         SRA   R5,8                                                             
         BZ    DISBFM20                                                         
*                                                                               
         MVI   0(R4),C'+'                                                       
         LTR   R5,R5                                                            
         BNM   *+8                                                              
         MVI   0(R4),C'-'                                                       
         AHI   R4,1                SKIP A SPACE                                 
*                                                                               
         LPR   R5,R5                                                            
*                                                                               
         CHI   R5,9999                                                          
         BH    *+12                                                             
         MVI   0(R4),C'0'                                                       
         AHI   R4,1                                                             
*                                                                               
         EDIT  (R5),(8,0(R4)),4,ALIGN=LEFT                                      
         AHI   R4,8                                                             
         CLI   0(R4),C' '                                                       
         BH    *+8                                                              
         BCT   R4,*-8                                                           
         AHI   R4,1                                                             
*                                                                               
         MVC   0(1,R4),=C'%'                                                    
         AHI   R4,1                SKIP A SPACE                                 
*                                                                               
         LR    R2,R4               BASE B                                       
         LA    R3,BILBASB                                                       
         BRAS  RE,DR_FBCOD                                                      
*                                                                               
DISBFM20 DS    0H                                                               
         L     R4,FULL                                                          
         MVC   0(L'PRIPDBFM,R4),WKKEY+1                                         
*                                                                               
         CLC   0(L'PRIPDBFM,R4),SPACES                                          
         JNH   NO                                                               
*                                                                               
         J     YES                                                              
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
*                                                                               
* R2=OUTPUT, R3=BASE CODE, MUST BE SET BEFORE CALLING THIS ROUTINE              
*                                                                               
DR_FBCOD NTR1  BASE=*,LABEL=*      EXPAND BASE CODE                             
         LARL  RE,BASLST           POINT TO BEGINNING OF TABLE                  
         LHI   RF,BASLSTN          NUMBER OF ENTRY IN TABLE                     
*                                                                               
DR_FB20  CLC   0(1,R3),0(RE)                                                    
         BE    DR_FB30                                                          
         LA    RE,6(RE)            NEXT ENTRY IN TABLE                          
         BCT   RF,DR_FB20                                                       
         J     YES                                                              
*                                                                               
DR_FB30  MVC   0(5,R2),1(RE)                                                    
         J     YES                                                              
         LTORG                                                                  
*                                                                               
BASLST   DS    0C                                                               
         DC    X'01',C'G    '                                                   
         DC    X'02',C'N    '                                                   
         DC    X'05',C'G-CD '                                                   
         DC    X'06',C'N-CD '                                                   
         DC    X'08',C'AC   '                                                   
         DC    X'11',C'CG   '      PRECEED BASE WITH 'C' FOR COMM               
         DC    X'12',C'CN   '                                                   
         DC    X'15',C'CG-CD'                                                   
         DC    X'16',C'CN-CD'                                                   
         DC    X'18',C'CAC  '                                                   
         DC    X'21',C'EG   '      PRECEED WITH E IF NOT FOR BILLING            
         DC    X'22',C'EN   '      ('EST' ONLY)                                 
         DC    X'25',C'EG-CD'                                                   
         DC    X'26',C'EN-CD'                                                   
         DC    X'28',C'EAC  '                                                   
BASLSTN  EQU   (*-BASLST)/6        NUMBER IN LIST                               
*                                                                               
*                                                                               
*                                                                               
* BUILD MOS TABLE FOR BUDGET RECORDS                                            
* R6 EXPECTED TO POINT TO PBUDELEM (X'01')                                      
BLDMOS   NTR1  BASE=*,LABEL=*                                                   
         USING PBUDELEM,R6                                                      
*                                                                               
         GOTO1 DATCON,DMCB,(0,PBUDST),(3,WORK)                                  
         GOTO1 DATCON,(R1),(0,PBUDEND),(3,WORK+3)                               
*                                                                               
         XC    MOSTAB,MOSTAB                                                    
*                                                                               
         LA    R4,MOSTAB                                                        
         MVC   24(2,R4),=2X'FF'    EOT                                          
         MVC   0(2,R4),WORK        INITIALIZE TABLE WITH START MONTH            
         ICM   RF,3,0(R4)          2 LOW ORDER BYTES = BINARY YM                
*                                                                               
BLDMOS2  CLC   0(2,R4),WORK+3                                                   
         JNL   YES                                                              
*                                                                               
         AHI   RF,1                BUMP MONTH                                   
         CLI   1(R4),12            LAST MONTH = DECEMBER?                       
         BL    *+8  NO, NO NEED TO RESET MONTH AND BUMP YEAR                    
* REGISTER WENT PAST DECEMBER HERE, LOB = X'0D'                                 
* ADDING X'F4' WILL SET LOB TO 1 AND BUMP THE 2ND BYTE BY 1                     
         AHI   RF,X'F4'                                                         
*                                                                               
         STCM  RF,3,2(R4)                                                       
         LA    R4,2(R4)                                                         
         B     BLDMOS2                                                          
*                                                                               
MOSTAB   DS    XL26                12X2(BINARY YM) + EOT(2X'FF')                
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
*                                                                               
***********************************************************************         
* WORKING STORAGE REQUIREMENTS                                        *         
***********************************************************************         
         SPACE 1                                                                
WORKD    DSECT                                                                  
DUB      DS    D                                                                
DUB1     DS    D                                                                
DOUBLE   DS    D                                                                
APARM    DS    A                   A(PARAMETER LIST)                            
*                                                                               
PARM     DS    0XL24               PARAMETER LIST                               
AXREC    DS    A                   A(EXTRACT RECORD)                            
         DS    A                                                                
         DS    A                                                                
         DS    A                                                                
         DS    A                                                                
APTXPARM DS    A                                                                
*                                                                               
DMCB     DS    0F                                                               
PLIST    DS    6F                                                               
ADCONLST DS    0A                  FORCE RESETVAL TO ASSEMBLE                   
VSPNDCTL DS    A                   USED BY RESETVAL TO FIND STATION REC         
ASTAREC  DS    A                                                                
REG1SV   DS    F                                                                
MPSTTAX  DS    F                   ORDERED PST TAX                              
MPSTTAXP DS    F                   PAID    PST TAX                              
MPSTTAXB DS    F                   BILLED  PST TAX                              
FULL     DS    F                                                                
HALF     DS    H                                                                
SVDDISP  DS    H                                                                
BYTE     DS    X                                                                
ELCODE   DS    X                                                                
CCRECSW  DS    X                                                                
KILLMODE DS    C                                                                
PRIMDPUB DS    X                                                                
ZZZFLAG  DS    X                 01---- FLAG IS ON                              
SV70ELM  DS    CL9                                                              
CHAR6    DS    CL6                                                              
CHAR15   DS    0CL15                                                            
CHAR8    DS    CL8                                                              
         DS    C                                                                
CHAR2    DS    CL2                                                              
         DS    C                                                                
CHAR3    DS    CL3                                                              
SVTSYS   DS    X                                                                
*                                                                               
*                                                                               
*                                                                               
       ++INCLUDE PVALUES                                                        
       ++INCLUDE GVALUES                                                        
FULL666  DS    F                                                                
***                                                                             
POOLTAB  DS    30CL3                                                            
ACGTAB   DS    CL22                ADDITIONAL CHARGE CODES (10 MAX.)            
BUYOUT   DS    600C                                                             
         DS    10C                                                              
***                                                                             
*                                                                               
*                                                                               
         DS    D                                                                
WORK     DS    XL256                                                            
         DS    XL024               DBLOCK IS BUILT AT WORK+10 FOR 280           
*                                                                               
*WKKEY    DS    CL32                                                            
*WKKEYSAV DS    CL32                                                            
WKKEY    DS    CL40                                                             
WKKEYSAV DS    CL40                                                             
SVGRPID  DS    C                                                                
SVGRPCOD DS    XL2                                                              
CODECHAR DS    CL5                                                              
SVBK1LN  DS    X                                                                
SVBK2LN  DS    X                                                                
SVELADR  DS    F                                                                
WORK12D  DS    12D                                                              
*                                                                               
ADCONSD  DS    0A                                                               
*                                                                               
MODETYP  DS    X                                                                
*                                                                               
WORKL    EQU   *-WORKD                                                          
         EJECT                                                                  
                                                                                
***********************************************************************         
* OTHER INCLUDED DSECTS                                               *         
***********************************************************************         
         SPACE 1                                                                
*PPBYOUT                                                                        
       ++INCLUDE PPBYOUTD                                                       
*PTXUSERD                                                                       
       ++INCLUDE RXUSERD                                                        
*PTXRECD                                                                        
       ++INCLUDE PTXRECD                                                        
*DXDSECTS                                                                       
       ++INCLUDE DXDSECTS                                                       
*PPGETCOND                                                                      
       ++INCLUDE PPGETCOND                                                      
         PRINT ON                                                               
       ++INCLUDE PRGENFILE                                                      
*      ++INCLUDE PUCOMREC     SPEC-45902 PUCOMREC INCLUDED IN PRGENFILE         
PCOS2FD  DSECT                                                                  
       ++INCLUDE PCOS2FACEL                                                     
         PRINT OFF                                                              
       ++INCLUDE DEDBLOCK                                                       
       ++INCLUDE FASYSFAC                                                       
CMMNT    DSECT                                                                  
       ++INCLUDE PCOMELEM                                                       
ZZZPOOLD DSECT                                                                  
       ++INCLUDE PPRELEM                                                        
*OFFICED                                                                        
       ++INCLUDE DDOFFICED                                                      
EBLOCKD  DSECT                                                                  
       ++INCLUDE DDEBLOCK                                                       
                                                                                
       ++INCLUDE SEACSFILE                                                      
                                                                                
       ++INCLUDE PTXPARM                                                        
                                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'110PTXROUTS  02/19/21'                                      
         END                                                                    

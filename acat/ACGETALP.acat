*          DATA SET ACGETALP   AT LEVEL 012 AS OF 06/05/13                      
*CATALP ACGETALP                                                                
*                                                                               
***********************************************************************         
* ACGETALP - GENERATE LIST OF ARTICLES (FILTERED/PRICED)              *         
* ------------------------------------------------------              *         
* ON ENTRY, P1  BYTES 0   = NOT USED                                  *         
*               BYTES 1-3 = A(INFO BLOCK) - INFOD                     *         
*           P2  BYTES 0   = NOT USED                                  *         
*               BYTES 1-3 = A(OUTPUT TABLE) - LISTTABD - 150 MAX      *         
*           P3  BYTES 0   = (X'80' TO PASS BACK W/C)                  *         
*                         = (X'08' TO USE MAXNTR2Q)                   *         
*               BYTES 1-3 = A(COMFACS)                                *         
* ON EXIT,  P1  BYTES 0   = ERROR CODE OR BINARY ZERO                 *         
*               BYTES 1-3 = AS ON ENTRY                               *         
*           P2  BYTES 0   = AS ON ENTRY                               *         
*               BYTES 1-3 = AS ON ENTRY                               *         
*           P3  BYTES 0   = AS ON ENTRY                               *         
*               BYTES 1-3 = AS ON ENTRY                               *         
***********************************************************************         
* LEVEL CHANGE COMMENTS                                               *         
* ---------------------                                               *         
* TKLU 03FEB03 001 NEW VERSION FOR PRESTO/FALINK USE                  *         
* TKLU 23OCT03 001 FINALLY MADE LIVE                                  *         
* TKLU 27OCT03 002 SOME CHANGES AND FIXES                             *         
* TKLU 18NOV03 003 IF NO RATE FOUND SET ERROR AND QUIT INSTEAD OF     *         
*                  CAUSING A DUMP, ADD EUREKA INVERT CALLS            *         
* TKLU 24NOV03 004 BUG FIX WHEN READING FOR SUPPLIER NAME             *         
* TKLU 19FEB04 005 ALLOW FOR ALL SUPPLIERS IF ESTIMATE/EXTERNAL       *         
* TKLU 17MAY04 006 BUG FIX IN EXECUTE INSTRUCTION                     *         
* TKLU 28AUG05 007 <ACCQ 1004851> LIMIT TO MAX AND RESSUME CODE       *         
* TKLU 19DEC05 008 <DU01-5029> - MCS ARTICLE ENHANCEMENTS             *         
* TKLU 18AUG06 009 BUG FIX ON SINGEL ARTICLE/EXTERNAL ESTIMATE CALL   *         
* TKLU 13JUN07 010 <DU01-6236> - BRANDOCEAN EXPENSE ORDER CHANGES     *         
* TKLU 06AUG07 011 <DU01-6519> - ITEMS ON ORDERS ADDITIONS (W/C)      *         
* TKLU 30SEP07 012 <UKCR00014403> - 'ALL ORDER ITEMS' CALL FOR =BRA   *         
* TKLU 11MAR08 013 <DU01-7410> - ORDER COPY VALIDATION BUG FIX        *         
* TKLU 04JUL08 014 <DU01-7767> FOREIGN NAME SUPPORT IN BRANDOCEAN     *         
* TKLU 24SEP08 015 <UKCR00019348> GETAOI/SINGLE ARTICLE CALL BUG FIX  *         
* TKLU 04JUN10 016 <PR000250> SUPPORT HIGHER LEVEL SV ACCOUNTS        *         
* MPEN 27MAR13 017 <BRO-133> ENSURE MOVE IS DONE FOR CORRECT LENGTH   *         
* NSHE 04JUN13 019 <BRO-481> ENSURE KEY IS REFRESHED CORRECTLY        *         
***********************************************************************         
* INFORMATION                                                         *         
* -----------                                                         *         
* THIS PROGRAM WILL PASS BACK A LIST OF ARTICLES IN ANY CURRENCY AS   *         
* DEFINED IN INFOD/LISTTABD, AND CAN BE USED FOR ALL OR ONE ARTICLE.  *         
* NOTE: THE I/O ROUTINES CURRENTLY MISS SOME OPTIMISATION AS BY LASTS *         
*       CLI/OFF READ ONE MAY SKIP I/OS IN BETWEEN.                    *         
***********************************************************************         
         SPACE 1                                                                
         TITLE 'ACGETALP - GET ARTICLE LIST (FILTERED/PRICED)'                  
         SPACE 1                                                                
ACGETALP CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 WORKX-WORKD,**GETALP,RA,RR=RE,CLEAR=YES                          
         USING WORKD,RC                                                         
         ST    RE,RELO                                                          
         ST    R1,APARM            SAVE PARAMETER BLOCK AND PARAMETERS          
         USING INFOD,RF                                                         
         L     RF,0(R1)                                                         
         MVC   PAREA,INFOD                                                      
         MVC   RESCODE,INFOMAX     SAVE RESSUME CODE (OR SPACES)                
         MVC   INFOMAX,SPACES      AND RESET                                    
         XC    LASTPAF,LASTPAF                                                  
         DROP  RF                                                               
         USING INFOD,PAREA                                                      
         ICM   RF,15,4(R1)                                                      
         ST    RF,PAOUT                                                         
         ICM   RF,15,8(R1)                                                      
         ST    RF,PACOMF                                                        
         MVC   MODBYTE,8(R1)                                                    
         SPACE 1                                                                
         USING COMFACSD,RF                                                      
         MVC   VBLDCUR,CBLDCUR                                                  
         MVC   VEUREKA,CEUREKA                                                  
         MVC   VDATCON,CDATCON                                                  
         MVC   DATAMGR,CDATAMGR                                                 
         DROP  RF                                                               
         SPACE 1                                                                
         MVI   ERRBYTE,PARAMQ                                                   
         OC    INFODAT,INFODAT     ENSURE PARAMETERS ARE OK                     
         BZ    LABEL90                                                          
         CLC   INFODAT,SPACES                                                   
         BE    LABEL90                                                          
         GOTO1 VDATCON,DMCB,(1,INFODAT),(2,IDT2)                                
         OC    INFOART,INFOART                                                  
         BNZ   *+10                                                             
         MVC   INFOART,SPACES                                                   
         CLI   INFOALP,C' '                                                     
         BNH   LABEL90                                                          
         CLI   INFOCPY,C' '                                                     
         BNH   LABEL90                                                          
         CLI   INFOCUA,C' '                                                     
         BNH   LABEL90                                                          
         OC    INFOOFF,INFOOFF                                                  
         BNZ   *+10                                                             
         MVC   INFOOFF,SPACES                                                   
         OC    INFOSUP,INFOSUP                                                  
         BNZ   *+10                                                             
         MVC   INFOSUP,SPACES                                                   
         OC    INFOCUR,INFOCUR                                                  
         BZ    *+14                                                             
         CLC   INFOCUR,SPACES                                                   
         BNE   *+10                                                             
         MVC   INFOCUR,INFOCUA                                                  
         SPACE 1                                                                
         OC    PACOMF,PACOMF                                                    
         BZ    LABEL90                                                          
         OC    PAOUT,PAOUT                                                      
         BZ    LABEL90                                                          
         SPACE 1                                                                
         CLI   INFOIOE,INFOINQ                                                  
         BE    LABEL02                                                          
         CLI   INFOIOE,INFOEXQ                                                  
         BNE   LABEL90                                                          
         SPACE 1                                                                
LABEL02  DS    0H                                                               
         CLI   INFOTYP,INFOORD                                                  
         BE    LABEL04                                                          
         CLI   INFOTYP,INFOAOI                                                  
         BE    LABEL04                                                          
         CLI   INFOTYP,INFOEST                                                  
         BNE   LABEL90                                                          
         CLC   INFOCLI,SPACES                                                   
         BNH   LABEL90                                                          
         CLC   INFOWRK,SPACES                                                   
         BNH   LABEL90                                                          
*        CLC   INFOOFF,SPACES      OFFICE NOT NECCESSARILY REQUIRED             
*        BE    LABEL90                                                          
         B     LABEL08                                                          
         SPACE 1                                                                
LABEL04  OC    INFOWRK,SPACES      (CLIENT AND W/C CAN BE BLANK)                
         OC    INFOCLI,SPACES                                                   
         CLC   INFOSUP,SPACES      ENSURE SUPPLIER SET                          
         BNH   LABEL90                                                          
         SPACE 1                                                                
LABEL08  DS    0H                                                               
         MVI   ERRBYTE,NOERRQ      SET ERROR TO OK                              
         MVI   MYSTATUS,0                                                       
         CLC   INFOCUA,INFOCUR     EQUAL TO AGY CURR?                           
         BNE   LABEL10                                                          
         MVC   INFORAT,ONE2ONEQ                                                 
         B     LABEL12                                                          
         SPACE 1                                                                
LABEL10  OC    INFORAT,INFORAT                                                  
         BNZ   LABEL12                                                          
         MVI   ERRBYTE,PARAMQ                                                   
         B     LABEL90                                                          
         SPACE 1                                                                
LABEL12  XC    AGYTENT,AGYTENT                                                  
         GOTO1 VBLDCUR,DMCB,INFOCUA,(X'80',AGYTENT),PACOMF                      
         CLI   0(R1),0                                                          
         BE    LABEL14                                                          
         MVI   ERRBYTE,FATALQ                                                   
         B     LABEL90                                                          
         SPACE 1                                                                
LABEL14  CLC   INFOCUR,INFOCUA                                                  
         BNE   LABEL16                                                          
         MVC   PRETENT,AGYTENT                                                  
         B     LABEL18                                                          
         SPACE 1                                                                
LABEL16  XC    PRETENT,PRETENT                                                  
         GOTO1 VBLDCUR,DMCB,INFOCUR,(X'80',PRETENT),PACOMF                      
         CLI   0(R1),0                                                          
         BE    LABEL18                                                          
         MVI   ERRBYTE,FATALQ                                                   
         B     LABEL90                                                          
         SPACE 1                                                                
LABEL18  LHI   R0,1                SET LEVEL DATA TO DEFAULT                    
         ST    R0,LVLNUMS                                                       
         XC    LVLLENS,LVLLENS                                                  
         MVI   LVLLENS,L'ACTKACT+1                                              
         OC    INFOSLL,INFOSLL                                                  
         BZ    LABEL24                                                          
         CLI   INFOSLL,L'ACTKACT   (SKIP FOR SINGLE LEVEL)                      
         BE    LABEL24                                                          
         XR    R0,R0                                                            
         LA    R1,LVLLENS                                                       
         LA    RF,INFOSLL+3                                                     
         LHI   R2,L'INFOSLL                                                     
         SPACE 1                                                                
LABEL20  CLI   0(RF),0             SET EX LENGTH IN REVERSE ORDER               
         BE    LABEL22                                                          
         LLC   RE,0(RF)                                                         
         AHI   RE,1                (+2 FOR U/L, -1 FOR EX)                      
         STC   RE,0(R1)                                                         
         AHI   R0,1                                                             
         AHI   R1,1                                                             
         SPACE 1                                                                
LABEL22  SHI   RF,1                                                             
         BCT   R2,LABEL20                                                       
         ST    R0,LVLNUMS                                                       
         SPACE 1                                                                
LABEL24  DS    0H                  CHECK TABLE                                  
         SPACE 1                                                                
         USING LISTTABD,R3                                                      
         L     R3,PAOUT            POINT TO OUTPUT TABLE                        
         MVI   CNTITMS,0                                                        
         SPACE 1                                                                
LABEL26  CLI   INFOTYP,INFOORD     ARE WE DOING ORDERS?                         
         BNE   LABEL28                                                          
         BAS   RE,GETORD                                                        
         B     LABEL40                                                          
         SPACE 1                                                                
LABEL28  CLI   INFOTYP,INFOAOI     ARE WE DOING 'ALL ORDER ITEMS'?              
         BNE   LABEL30                                                          
         BAS   RE,GETAOI                                                        
         B     LABEL40                                                          
         SPACE 1                                                                
LABEL30  BAS   RE,GETEST           THEN WE DO ESTIMATES                         
         SPACE 1                                                                
LABEL40  TM    MYSTATUS,EOFQ                                                    
         BZ    LABEL50                                                          
         XC    LISTSEQ,LISTSEQ     SET EOT                                      
         L     R3,PAOUT                                                         
         OC    LISTSEQ,LISTSEQ     CHECK ANY INPUT                              
         BNZ   LABEL42                                                          
         MVI   ERRBYTE,EMPTYQ                                                   
         B     LABEL90                                                          
         SPACE 1                                                                
LABEL42  MVI   ERRBYTE,NOERRQ                                                   
         B     LABEL90                                                          
         SPACE 1                                                                
LABEL50  MVI   ERRBYTE,NOERRQ      SET ERROR TO NONE                            
         BAS   RE,PUTOUT           PASS DATA INTO TABLE                         
         CLI   ERRBYTE,0           ANY ERROR?                                   
         BNE   LABEL90             THEN EXIT WITH ERROR                         
         LA    RE,LISTLNQ                                                       
         TM    MODBYTE,X'80'                                                    
         BZ    *+8                                                              
         LA    RE,LISTLXQ                                                       
         AR    R3,RE                                                            
         LLC   RF,CNTITMS          INCREMENT COUNTER                            
         AHI   RF,1                                                             
         STC   RF,CNTITMS                                                       
         LHI   RE,MAXNTRYQ                                                      
         TM    MODBYTE,X'08'                                                    
         BZ    *+8                                                              
         LHI   RE,MAXNTR2Q                                                      
         CR    RF,RE               MAX ITEMS REACHED?                           
         BL    LABEL26                                                          
         LA    RE,MYIO             THEN SAVE LATEST                             
         L     RF,APARM                                                         
         L     R1,0(RF)                                                         
         MVC   INFOMAX-INFOD(L'INFOMAX,R1),ARTKART-ARTRECD(RE)                  
         MVI   ERRBYTE,INFMXQ                                                   
         B     LABEL90             AND EXIT WITH INFO                           
         DROP  R3                                                               
         SPACE 1                                                                
LABEL90  DS    0H                  PASS ERROR BYTE ON EXIT                      
         L     R1,APARM                                                         
         MVC   0(1,R1),ERRBYTE                                                  
         SPACE 1                                                                
EXIT     XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
* PUT ARTICLE DATA TO OUTPUT TABLE                                    *         
* - ON ENTRY R3 POINTS TO AVAILABLE ENTRY AND MYIO CONTAINS ARTICLE   *         
***********************************************************************         
         SPACE 1                                                                
         USING ARTRECD,R4                                                       
         USING LISTTABD,R3                                                      
PUTOUT   NTR1  ,                                                                
         LA    R4,MYIO             POINT TO ACCMST ARTICLE RECORD               
         CLI   ARTKTYP,ARTKTYPQ                                                 
         BE    PUTOUT02                                                         
         DC    H'0'                ENSURE IT'S AN ARTICLE                       
         SPACE 1                                                                
         USING AFDELD,R2                                                        
PUTOUT02 LA    R2,ARTRFST          POINT TO 1ST ELEMENT                         
         NI    MYSTATUS,INIQ       SET NO ELEMENT FOUND                         
         XC    ADXNMEL,ADXNMEL                                                  
         MVI   LISTPTY,LISTPXQ     PASS PRICE TYPE                              
         TM    ARTRSTA,ARTKFLXQ                                                 
         BZ    *+8                                                              
         MVI   LISTPTY,LISTPFQ                                                  
         TM    ARTRSTA,ARTKNOPQ                                                 
         BZ    *+8                                                              
         MVI   LISTPTY,LISTPNQ                                                  
         MVI   LISTDOR,C' '        PASS DESCRIPTION OVERRIDE                    
         TM    ARTRSTA,ARTKDAMQ                                                 
         BZ    *+8                                                              
         MVI   LISTDOR,LISTDYQ                                                  
         MVI   LISTNIC,C' '        PASS NIC'ABLE                                
         TM    ARTRSTA,ARTKNICQ                                                 
         BZ    *+8                                                              
         MVI   LISTNIC,LISTNYQ                                                  
         MVI   LISTART,C' '        PASS ARTIST                                  
         TM    ARTRSTA+ARTKSTA2-ARTKSTA,ARTKSART                                
         BZ    *+8                                                              
         MVI   LISTART,LISTAYQ                                                  
         MVI   LISTWFS,C' '        PASS W/C SETTING                             
         CLI   ARTRSTA+ARTKSWC-ARTKSTA,C' '                                     
         BNH   *+8                                                              
         MVI   LISTWFS,LISTWYQ                                                  
         SPACE 1                                                                
PUTOUT04 CLI   AFDEL,AFDELQ                                                     
         BE    PUTOUT10                                                         
         CLI   AFDEL,PRIELQ                                                     
         BE    PUTOUT20                                                         
         CLI   AFDEL,NAMELQ                                                     
         BE    PUTOUT30                                                         
         CLI   AFDEL,XNMELQ                                                     
         BE    PUTOUT40                                                         
         CLI   AFDEL,0                                                          
         BE    PUTOUT70                                                         
         SPACE 1                                                                
PUTOUT06 LLC   R0,AFDLN                                                         
         AR    R2,R0                                                            
         B     PUTOUT04                                                         
         SPACE 1                                                                
PUTOUT10 DS    0H                                                               
         MVC   LISTSEQ,AFDSEQ      *** PASS ARTICLE SEQUENCE NUMBER             
         OI    MYSTATUS,AFDQ                                                    
         B     PUTOUT06                                                         
         SPACE 1                                                                
         USING PRIELD,R2                                                        
PUTOUT20 DS    0H                                                               
         MVC   CURCURR,PRICURR     SAVE PRICE INFORMATION                       
         CLC   CURCURR,SPACES      ANY CODE SET?                                
         BNE   *+10                                                             
         MVC   CURCURR,INFOCUA                                                  
         OI    MYSTATUS,PRIQ                                                    
         LLC   RE,PRICNTR          SET COUNTER                                  
         LA    RF,PRINTRY          AND SEE SORT NOTE ON ELEMENT DSECT           
         USING PRINTRY,RF                                                       
         SPACE 1                                                                
PUTOUT22 CLC   PRIDAT,INFODAT      COMPARE EFF. DATE                            
         BNH   PUTOUT24                                                         
         AHI   RF,PRINTRQ                                                       
         BCT   RE,PUTOUT22                                                      
         DC    H'0'                NO PRICE FOUND - I/O DATE FILTER BUG         
         SPACE 1                                                                
PUTOUT24 ZAP   CURAMNT,PRIAMT                                                   
         B     PUTOUT06                                                         
         SPACE 1                                                                
         USING NAMELD,R2                                                        
PUTOUT30 DS    0H                                                               
         MVC   CURNAME,SPACES                                                   
         OI    MYSTATUS,NAMQ                                                    
         LLC   RE,NAMLN                                                         
         SHI   RE,3                                                             
         MVC   CURNAME(0),NAMEREC                                               
         EX    RE,*-6                                                           
         B     PUTOUT06                                                         
         SPACE 1                                                                
PUTOUT40 DS    0H                                                               
         ST    R2,ADXNMEL                                                       
         B     PUTOUT06                                                         
         SPACE 1                                                                
PUTOUT70 DS    0H                                                               
         TM    MYSTATUS,ALLELQ                                                  
         BO    PUTOUT72                                                         
         DC    H'0'                BAD ARTICLE RECORD                           
         SPACE 1                                                                
PUTOUT72 MVC   LISTARC,ARTKART     *** PASS ARTICLE CODE                        
         MVC   LISTOFF,ARTKOFF     *** PASS OFFICE CODE                         
         MVC   LISTCLI,ARTKCLI     *** PASS CLIENT CODE                         
         TM    MODBYTE,X'80'       *** PASS W/C IF REQUESTED                    
         BZ    *+10                                                             
         MVC   LISTAWC,ARTRSTA+ARTKSWC-ARTKSTA                                  
         MVC   LISTSUC,ARTKSUP     *** PASS SUPPLIER CODE                       
         CLI   INFOLAN,INFOLAB     SPECIAL BOTH LANGUAGES CALL?                 
         BE    PUTOUT74                                                         
         MVC   GETACT(1),INFOCPY                                                
         MVC   GETACT+1(14),ARTKSUP                                             
         BAS   RE,GETNAM                                                        
         MVC   LISTSUN,GETANM      *** PASS SUPPLIER'S NAME                     
         SPACE 1                                                                
         CLI   INFOLAN,INFOLAQ     LANGUAGE REQUIRED?                           
         BNE   PUTOUT76                                                         
         OC    ADXNMEL,ADXNMEL                                                  
         BZ    PUTOUT76                                                         
         USING XNMELD,R2                                                        
         L     R2,ADXNMEL                                                       
         MVC   CURNAME,SPACES                                                   
         LLC   RE,XNMLN                                                         
         SHI   RE,5                                                             
         MVC   CURNAME(0),XNMSUBN                                               
         EX    RE,*-6                                                           
         B     PUTOUT76                                                         
         SPACE 1                                                                
PUTOUT74 MVC   LISTADA,MYDA        *** PASS ARTICLE'S D/A                       
         SPACE 1                                                                
PUTOUT76 MVC   LISTARN,CURNAME     *** PASS ARTICLE NAME                        
         SPACE 1                                                                
         CLC   CURCURR,SPACES      CURRENCY ON ARTICLE?                         
         BNE   *+10                                                             
         MVC   CURCURR,INFOCUA     SET TO AGENCY                                
         CLC   CURCURR,INFOCUR     CURRENCIES MATCHING?                         
         BNE   PUTOUT78                                                         
         ZAP   LISTPRI,CURAMNT     *** PASS CURRENT PRICE                       
         MVI   LISTPIND,C' '       *** PASS ORIGINAL VALUE                      
         B     PUTOUTX                                                          
         SPACE 1                                                                
PUTOUT78 MVI   LISTPIND,LISTPIDQ   *** PASS CALCULATED VALUE                    
         BAS   RE,GETAMT                                                        
         BE    PUTOUT80            ERROR?                                       
         LA    RE,LISTLNQ-1                                                     
         TM    MODBYTE,X'80'                                                    
         BZ    *+8                                                              
         LA    RE,LISTLXQ-1                                                     
         XC    LISTSEQ(0),LISTSEQ                                               
         EX    RE,*-6                                                           
         MVI   ERRBYTE,CURRTQ                                                   
         B     PUTOUTX                                                          
         SPACE 1                                                                
PUTOUT80 ZAP   LISTPRI,CURAMNT                                                  
         SPACE 1                                                                
PUTOUTX  B     EXIT                                                             
         DROP  R2,R3,R4                                                         
         EJECT                                                                  
***********************************************************************         
* GET NAME FOR ANY ACCOUNT RECORD IN GETACT INTO GETANM               *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R4                                                       
GETNAM   NTR1  ,                                                                
         MVC   GETANM,ASTERS                                                    
         LA    R4,GETIO                                                         
         MVC   ACTKEY,SPACES                                                    
         MVC   ACTKCULA,GETACT                                                  
         GOTO1 DATAMGR,DMCB,DMREAD,ACCFIL,ACTRECD,ACTRECD                       
         BNE   GETNAMX                                                          
         MVC   GETANM,SPACES                                                    
         MVC   GETSAVE,SPACES                                                   
         LA    R3,GETIO                                                         
         AHI   R3,ACCORFST                                                      
         USING NAMELD,R3                                                        
GETNAM1  CLI   NAMEL,NAMELQ                                                     
         BE    GETNAM5                                                          
         CLI   NAMEL,XNMELQ                                                     
         BE    GETNAM7                                                          
         CLI   NAMEL,0                                                          
         BE    GETNAM9                                                          
         SPACE 1                                                                
GETNAM3  LLC   R0,NAMLN                                                         
         AR    R3,R0                                                            
         B     GETNAM1                                                          
         SPACE 1                                                                
GETNAM5  LLC   RE,NAMLN                                                         
         SHI   RE,3                                                             
         MVC   GETANM(0),NAMEREC                                                
         EX    RE,*-6                                                           
         B     GETNAM3                                                          
         SPACE 1                                                                
         USING XNMELD,R3                                                        
GETNAM7  CLI   INFOLAN,INFOLAQ     LANGUAGE REQUIRED?                           
         BNE   GETNAM3                                                          
         LLC   RE,XNMLN                                                         
         SHI   RE,5                                                             
         MVC   GETSAVE(0),XNMSUBN                                               
         EX    RE,*-6                                                           
         B     GETNAM3                                                          
         SPACE 1                                                                
GETNAM9  CLC   GETSAVE,SPACES                                                   
         BE    GETNAMX                                                          
         MVC   GETANM,GETSAVE                                                   
         SPACE 1                                                                
GETNAMX  B     EXIT                                                             
         DROP  R3,R4                                                            
         EJECT                                                                  
***********************************************************************         
* GET AMOUNT IN CURRENCY VIA EUREKA                                   *         
* - ON ENTRY CURCURR=CURENCY OF CURRAMNT (PRIELD)                     *         
* - ON ENTRY INFOCUR=CURRENCY TO CONVERT INTO (INFORAT=RATE TO AGY)   *         
* - ON ENTRY INFOCUA=AGENCY'S CURRENCY                                *         
* - ON EXIT  CURAMNT HOLDS NEW AMOUNT IN CURRENCY (INFODAT'S RATE)    *         
***********************************************************************         
         SPACE 1                                                                
         USING EURKBLKD,R2                                                      
GETAMT   NTR1  ,                                                                
         DS    0H                  *** CONVERT FROM PRICE TO AGENCY             
         CLC   CURCURR,INFOCUA     DOES ARTICLE MATCH AGENCY?                   
         BE    GETAMT20            THEN SKIP THIS                               
         LA    R2,AREA             GET RATE FROM EUREKA                         
         XC    0(EURKBLKL,R2),0(R2)                                             
         MVC   EURKCUFR,CURCURR                                                 
         MVC   EURKCUTO,INFOCUA                                                 
         MVC   EURKALPH,INFOALP                                                 
         MVC   EURKDATE,IDT2                                                    
         MVC   EURKAFAC,PACOMF                                                  
         MVI   EURKTYPE,ACCQ                                                    
         TM    INFOFLG,ALLOWFTQ    ARE FT RATES PERMITTED?                      
         BZ    GETAMT02                                                         
         OI    EURKTYPE,ALLOWFTQ+SWAPQ                                          
         SPACE 1                                                                
GETAMT02 GOTO1 VEUREKA,DMCB,('GETQ',EURKBLKD)                                   
         CLI   0(R1),0                                                          
         BE    GETAMT04            ERROR AS NO RATE RETRIEVED                   
         SPACE 1                                                                
         LA    R2,AREA             GET RATE FROM EUREKA THE OTEHR WAY           
         NI    EURKTYPE,X'FF'-SWAPQ                                             
         GOTO1 VEUREKA,DMCB,('GETQ',EURKBLKD)                                   
         CLI   0(R1),0                                                          
         BNE   GETAMTN             ERROR AS NO RATE RETRIEVED                   
         SPACE 1                                                                
GETAMT04 ZAP   DUB,CURAMNT                                                      
         GOTO1 VEUREKA,DMCB,('APPLYQ',EURKBLKD),DUB,CURAMNT                     
         CLI   0(R1),0                                                          
         BNE   GETAMTN             DUMP AS RATE NOT APPLIED                     
         SPACE 1                                                                
         DS    0H                  *** CONVERT AGENCY TO PRESTO                 
GETAMT20 LA    R2,AREA             GET RATE FROM EUREKA (DUMMY)                 
         XC    0(EURKBLKL,R2),0(R2)                                             
         MVC   EURKCUFR,INFOCUA                                                 
         MVC   EURKCUTO,INFOCUR                                                 
         MVC   EURKALPH,INFOALP                                                 
         MVC   EURKDATE,IDT2                                                    
         MVC   EURKAFAC,PACOMF                                                  
         MVI   EURKTYPE,ACCQ                                                    
         TM    INFOFLG,ALLOWFTQ    ARE FT RATES PERMITTED?                      
         BZ    GETAMT22                                                         
         OI    EURKTYPE,ALLOWFTQ+SWAPQ                                          
         SPACE 1                                                                
GETAMT22 GOTO1 VEUREKA,DMCB,('GETQ',EURKBLKD)                                   
         CLI   0(R1),0                                                          
         BE    GETAMT24            DUMP AS NO RATE RETRIEVED                    
         SPACE 1                                                                
         LA    R2,AREA             GET RATE FROM EUREKA THE OTEHR WAY           
         NI    EURKTYPE,X'FF'-SWAPQ                                             
         GOTO1 VEUREKA,DMCB,('GETQ',EURKBLKD)                                   
         CLI   0(R1),0                                                          
         BNE   GETAMTN                                                          
         SPACE 1                                                                
GETAMT24 ZAP   DUB,CURAMNT                                                      
         MVC   EURKRLRT,INFORAT    SET RATE PASSED NOW                          
         GOTO1 VEUREKA,DMCB,('APPLYQ',EURKBLKD),DUB,CURAMNT                     
         CLI   0(R1),0                                                          
         BNE   GETAMTN             DUMP AS RATE NOT APPLIED                     
         SPACE 1                                                                
GETAMTY  CR    RB,RB               NOW CURAMNT IS IN CURRENCY                   
         B     EXIT                                                             
         SPACE 1                                                                
GETAMTN  LTR   RB,RB                                                            
         B     EXIT                                                             
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* GET FILTERED ARTICLES IN SEQUENCE FOR ESTIMATES (INTERNAL/EXTERNAL) *         
* - FIRST THERE ARE TWO SCENARIOS: INTERNAL OR EXTERNAL               *         
*   IF INTERNAL: EQUALLY TO GETORD (ORDERTS/EXTERNAL)                 *         
*   IF EXTERNAL: READ PAFRECD AND TAKE FIRST ONE MATCHING PER SUPPL./ *         
*                ARTICLE (WITHIN THIS EQUAL LOGIC TO ABOVE)           *         
*                (ALL SUPPLIERS POSSIBLE, TOO)                        *         
***********************************************************************         
         SPACE 1                                                                
         USING ARTRECD,R4                                                       
GETEST   NTR1  ,                                                                
         CLI   INFOIOE,INFOEXQ                                                  
         BE    GEXTEST             GO TO EXTERNALS                              
         SPACE 5                                                                
GINTEST  DS    0H                  DEAL WITH INTERNALS                          
         SPACE 1                                                                
         TM    MYSTATUS,INITQ      ARTICLE READ INITIALISED?                    
         BNZ   GETEST02                                                         
         OI    MYSTATUS,INITQ                                                   
         MVC   LASTART,RESCODE     SET START ARTICLE NUMBER                     
         B     GETEST04                                                         
         SPACE 1                                                                
GETEST02 CLC   INFOART,SPACES      BUT IF ONE SPECIFIED THEN EXIT               
         BE    GETEST04                                                         
         B     GETEST90                                                         
         SPACE 1                                                                
GETEST04 LA    R4,MYIO             BUILD START KEY FOR NEXT ARTICLE             
         XC    ARTKEY,ARTKEY                                                    
         MVI   ARTKTYP,ARTKTYPQ                                                 
         MVI   ARTKSUB,ARTKAQ                                                   
         MVC   ARTKCPY,INFOCPY                                                  
         MVC   ARTKART,LASTART     SET TO LAST ARTICLE NUMBER                   
         MVI   ARTKARTF,1          AND ENSURE NEXT ONE IS READ                  
         CLC   INFOART,SPACES                                                   
         BE    GETEST06                                                         
         MVI   ARTKARTF,0                                                       
         MVC   ARTKART,INFOART     (READ FOR A SPECIFIC ARTICLE)                
         SPACE 1                                                                
GETEST06 MVC   SAVEKEY1,ARTKEY                                                  
         GOTO1 DATAMGR,DMCB,DMRDHI,ACCDIR,ARTRECD,ARTRECD,0                     
         BE    GETEST08                                                         
         DC    H'0'                I/O ERROR - DUMP HERE|                       
         SPACE 1                                                                
GETEST08 CLC   ARTKEY(3),SAVEKEY1  STILL ARTICLES?                              
         BNE   GETEST90                                                         
         CLC   INFOART,SPACES                                                   
         BE    GETEST10                                                         
         CLC   INFOART,ARTKART     MATCH ON SPECIFIC ARTICLE CODE?              
         BNE   GETEST90                                                         
         SPACE 1                                                                
GETEST10 MVC   LASTART,ARTKART     SAVE CURRENT ARTICLE                         
         MVC   ARTKOFF,INFOOFF     NOW SET OFFICE AND CLIENT                    
         MVC   ARTKCLI,INFOCLI                                                  
         MVC   ARTKSUP,SPACES                                                   
         MVC   SAVEKEY2,ARTKEY     SAVE ARTICLE'S KEY                           
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,ARTRECD,ARTRECD,0                     
         BNE   GETEST12            IF MATCH TEST WHETHER GOOD                   
         TM    ARTKSTAT,ARTKLOCK                                                
         BNZ   GETEST12            NO LOCKED ARTICLES                           
         CLC   INFODAT,ARTKSDAT                                                 
         BL    GETEST12            MUST BE EFFECTIVE AT INFODAT                 
         TM    ARTKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETEST11                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETEST12                                                         
GETEST11 CLC   ARTKSWC,SPACES                                                   
         BE    GETEST98                                                         
         CLC   ARTKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETEST98                                                         
         SPACE 1                                                                
GETEST12 MVC   ARTKEY,SAVEKEY2     REESTABLISH KEY                              
         MVC   ARTKOFF,SPACES      AND SET OFFICE TO NAUGHT                     
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,ARTRECD,ARTRECD,0                     
         BNE   GETEST14            IF MATCH TEST WHETHER GOOD                   
         TM    ARTKSTAT,ARTKLOCK                                                
         BNZ   GETEST14            NO LOCKED ARTICLES                           
         CLC   INFODAT,ARTKSDAT                                                 
         BL    GETEST14            MUST BE EFFECTIVE AT INFODAT                 
         TM    ARTKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETEST13                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETEST14                                                         
GETEST13 CLC   ARTKSWC,SPACES                                                   
         BE    GETEST98                                                         
         CLC   ARTKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETEST98                                                         
         SPACE 1                                                                
GETEST14 MVC   ARTKEY,SAVEKEY2     REESTABLISH KEY                              
         MVC   ARTKCLI,SPACES      AND SET CLIENT TO NAUGHT                     
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,ARTRECD,ARTRECD,0                     
         BNE   GETEST16            IF MATCH TEST WHETHER GOOD                   
         TM    ARTKSTAT,ARTKLOCK                                                
         BNZ   GETEST16            NO LOCKED ARTICLES                           
         CLC   INFODAT,ARTKSDAT                                                 
         BL    GETEST16            MUST BE EFFECTIVE AT INFODAT                 
         TM    ARTKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETEST15                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETEST16                                                         
GETEST15 CLC   ARTKSWC,SPACES                                                   
         BE    GETEST98                                                         
         CLC   ARTKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETEST98                                                         
         SPACE 1                                                                
GETEST16 MVC   ARTKEY,SAVEKEY2     REESTABLISH KEY                              
         MVC   ARTKOFF,SPACES      AND SET OFFICE AND CLIENT TO NAUGHT          
         MVC   ARTKCLI,SPACES                                                   
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,ARTRECD,ARTRECD,0                     
         BNE   GETEST20            IF MATCH TEST WHETHER GOOD                   
         TM    ARTKSTAT,ARTKLOCK                                                
         BNZ   GETEST20            NO LOCKED ARTICLES                           
         CLC   INFODAT,ARTKSDAT                                                 
         BL    GETEST20            MUST BE EFFECTIVE AT INFODAT                 
         TM    ARTKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETEST17                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETEST20                                                         
GETEST17 CLC   ARTKSWC,SPACES                                                   
         BE    GETEST98                                                         
         CLC   ARTKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETEST98                                                         
         SPACE 1                                                                
GETEST20 CLC   INFOART,SPACES      NOTHING FOUND FOR THIS ARTICLE               
         BNE   GETEST90                                                         
         B     GETEST04            READ FOR NEXT ARTICLE AND TRY AGAIN          
         SPACE 5                                                                
GEXTEST  DS    0H                  DEAL WITH EXTERNALS                          
         SPACE 1                                                                
         CLC   INFOART,SPACES      ONLY A SPECIFIC ARTICLE REQUIRED?            
         BE    GETEST50                                                         
         USING PAFRECD,R4                                                       
GETEST30 OC    LASTPAF,LASTPAF     FIRST TIME? (THIS ONLY PROHIBITS             
         BNZ   GETEST90            FROM A LOOP  BUT NEEDS A REWRITE)            
         SPACE 1                                                                
         L     R5,LVLNUMS          LEVEL PROCESSING LOOP                        
         LA    R6,LVLLENS                                                       
         SPACE 1                                                                
GETEST32 LA    R4,MYIO             BUILD KEY                                    
         XC    PAFKEY,PAFKEY                                                    
         MVI   PAFKTYP,PAFKTYPQ                                                 
         MVI   PAFKSUB,PAFKSQ                                                   
         MVC   PAFKCPY,INFOCPY                                                  
         MVC   PAFKART,INFOART                                                  
         LLC   R1,0(R6)                                                         
         BCTR  R1,0                                                             
         MVC   PAFKSUP,SPACES                                                   
         MVC   PAFKSUP(0),INFOSUP                                               
         EX    R1,*-6                                                           
         MVC   PAFKCLI,INFOCLI                                                  
         MVC   PAFKOFF,INFOOFF                                                  
         MVC   SAVEKEY1,PAFKEY     SAVE KEY AND READ                            
         MVC   LASTPAF,PAFKEY                                                   
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETEST42                                                         
         TM    PAFKSTAT,ARTKLOCK+ARTKTINT                                       
         BNZ   GETEST42            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETEST42            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETEST41                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETEST42                                                         
GETEST41 CLC   PAFKSWC,SPACES                                                   
         BE    GETEST98                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETEST98                                                         
         SPACE 1                                                                
GETEST42 MVC   PAFKEY,SAVEKEY1                                                  
         MVC   PAFKOFF,SPACES      SET OFFICE TO NAUGHT AND READ                
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETEST44                                                         
         TM    PAFKSTAT,ARTKLOCK+ARTKTINT                                       
         BNZ   GETEST44            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETEST44            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETEST43                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETEST44                                                         
GETEST43 CLC   PAFKSWC,SPACES                                                   
         BE    GETEST98                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETEST98                                                         
         SPACE 1                                                                
GETEST44 MVC   PAFKEY,SAVEKEY1                                                  
         MVC   PAFKCLI,SPACES      SET CLIENT TO NAUGHT AND READ                
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETEST46                                                         
         TM    PAFKSTAT,ARTKLOCK+ARTKTINT                                       
         BNZ   GETEST46            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETEST46            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETEST45                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETEST46                                                         
GETEST45 CLC   PAFKSWC,SPACES                                                   
         BE    GETEST98                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETEST98                                                         
         SPACE 1                                                                
GETEST46 MVC   PAFKEY,SAVEKEY1                                                  
         MVC   PAFKCLI,SPACES      SET CLIENT TO NAUGHT AND                     
         MVC   PAFKOFF,SPACES      SET OFFICE TO NAUGHT AND READ                
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETEST48                                                         
         TM    PAFKSTAT,ARTKLOCK+ARTKTINT                                       
         BNZ   GETEST48            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETEST48            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETEST47                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETEST48                                                         
GETEST47 CLC   PAFKSWC,SPACES                                                   
         BE    GETEST98                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETEST98                                                         
         SPACE 1                                                                
GETEST48 AHI   R6,1                PROCESS NEXT LEVEL                           
         BCT   R5,GETEST32                                                      
         B     GETEST90                                                         
         SPACE 5                                                                
GETEST50 DS    0H                  ALL ARTICLE REQUIRED                         
         LA    R4,MYIO             AND BUILD START KEY                          
         MVC   PAFKEY,SPACES                                                    
         MVI   PAFKTYP,PAFKTYPQ                                                 
         MVI   PAFKSUB,PAFKSQ                                                   
         MVC   PAFKCPY,INFOCPY                                                  
         MVC   SAVELN3,PAFKEY      AND SAVE NEW KEY                             
         TM    MYSTATUS,INITQ      ARTICLE READ INITIALISED?                    
         BZ    GETEST52                                                         
         MVC   PAFKART(L'PAFKART+1+L'PAFKSUP),LASTART                           
         MVI   PAFKSUPF,1          AND FLAG TO NEXT                             
         B     GETEST53                                                         
         SPACE 1                                                                
GETEST52 OI    MYSTATUS,INITQ                                                   
         MVC   LASTART,RESCODE                                                  
         MVC   LASTART+L'LASTART(1+L'LASTSUP),SPACES                            
         SPACE 1                                                                
GETEST53 GOTO1 DATAMGR,DMCB,DMRDHI,ACCDIR,PAFRECD,PAFRECD,0                     
         BE    GETEST54                                                         
         DC    H'0'                I/O ERROR - DUMP HERE|                       
         SPACE 1                                                                
GETEST54 CLC   SAVELN3,PAFKEY      STILL ARTICLES?                              
         BNE   GETEST90                                                         
         TM    PAFKSTAT,ARTKTINT   EXTERNAL?                                    
         BZ    GETEST56                                                         
         MVI   PAFRREM,1           SET TO NEXT HIGH KEY                         
         GOTO1 DATAMGR,DMCB,DMRDHI,ACCDIR,PAFRECD,PAFRECD,0                     
         BE    GETEST54                                                         
         DC    H'0'                I/O ERROR - DUMP HERE|                       
         SPACE 1                                                                
GETEST56 MVC   SAVEKEY1,PAFKEY     SAVE CURRENT KEY, ALSO ART/SUPPL             
         MVC   LASTART(L'LASTART+1+L'LASTSUP),PAFKART                           
         B     GETEST60                                                         
         SPACE 1                                                                
GETEST58 DS    0H                  SUPPLIER LOOP                                
         MVC   PAFKEY(PAFKSUPF-PAFKEY),SAVEKEY1                                 
         MVI   PAFKSUPF,1          AND FLAG TO NEXT                             
         GOTO1 DATAMGR,DMCB,DMRDHI,ACCDIR,PAFRECD,PAFRECD,0                     
         BE    GETEST54                                                         
         DC    H'0'                I/O ERROR - DUMP HERE|                       
         SPACE 1                                                                
GETEST60 DS    0H                  CHECK AND SAVE CURRENT ART/SUP               
         MVC   PAFKEY,SAVEKEY1                                                  
         MVC   PAFKCLI,INFOCLI     READ FOR OFF/CLI                             
         MVC   PAFKOFF,INFOOFF                                                  
         LA    R4,MYIO                                                          
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETEST62                                                         
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETEST62            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETEST62            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETEST61                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETEST62                                                         
GETEST61 CLC   PAFKSWC,SPACES                                                   
         BE    GETEST98                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETEST98                                                         
         SPACE 1                                                                
GETEST62 DS    0H                                                               
         MVC   PAFKEY,SAVEKEY1                                                  
         MVC   PAFKCLI,INFOCLI     READ FOR CLI                                 
         MVC   PAFKOFF,SPACES                                                   
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETEST64                                                         
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETEST64            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETEST64            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETEST63                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETEST64                                                         
GETEST63 CLC   PAFKSWC,SPACES                                                   
         BE    GETEST98                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETEST98                                                         
         SPACE 1                                                                
GETEST64 MVC   PAFKEY,SAVEKEY1                                                  
         MVC   PAFKCLI,SPACES                                                   
         MVC   PAFKOFF,INFOOFF     READ FOR OFF                                 
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETEST66                                                         
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETEST66            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETEST66            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETEST65                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETEST66                                                         
GETEST65 CLC   PAFKSWC,SPACES                                                   
         BE    GETEST98                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETEST98                                                         
         SPACE 1                                                                
GETEST66 MVC   PAFKEY,SAVEKEY1                                                  
         MVC   PAFKCLI,SPACES                                                   
         MVC   PAFKOFF,SPACES                                                   
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETEST58                                                         
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETEST58            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETEST58            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETEST67                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETEST58                                                         
GETEST67 CLC   PAFKSWC,SPACES                                                   
         BE    GETEST98                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETEST98                                                         
         B     GETEST58                                                         
         SPACE 1                                                                
GETEST90 OI    MYSTATUS,EOFQ       SET END OF FILE                              
         B     GETESTX                                                          
         SPACE 1                                                                
         USING ARTRECD,R4                                                       
GETEST98 MVC   MYDA,ARTKDA         READ FULL RECORD                             
         GOTO1 DATAMGR,DMCB,GETREC,ACCMST,MYDA,ARTRECD,MYWORK                   
         BE    GETESTX             OK AND EXIT                                  
         DC    H'0'                I/O ERROR                                    
         SPACE 1                                                                
GETESTX  B     EXIT                                                             
         DROP  R4                                                               
         EJECT                                                                  
***********************************************************************         
* GET FILTERED ARTICLES IN SEQUENCE FOR ORDERS (EXTERNAL)             *         
* - READ ARTICLE NUMBERS SEQUENTIALLY AND FOR EACH ARTICLE NUMBER     *         
*   READ FOR THE BEST MATCH AS FOLLOWS (VIA PASSIVES):                *         
*                    1.: READ HIGH FOR NEXT ARTICLE NUMBER            *         
*                    2.: READ SUPL/CLI/OF - IF EXISTS THEN TAKE, ELSE *         
*                    3.: READ SUPL/CLI/.. - IF EXISTS THEN TAKE, ELSE *         
*                    4.: READ SUPL/.../OF - IF EXISTS THEN TAKE, ELSE *         
*                    5.: READ SUPL/.../.. - IF EXISTS THEN TAKE, ELSE *         
*                    6.: NO VALID ENTRY FOR THIS ARTICLE NUMBER       *         
***********************************************************************         
         SPACE 1                                                                
GETORD   NTR1  ,                                                                
         TM    MYSTATUS,INITQ      ARTICLE READ INITIALISED?                    
         BNZ   GETORD00                                                         
         OI    MYSTATUS,INITQ                                                   
         MVC   LASTART,RESCODE     SET START ARTICLE NUMBER                     
         B     GETORD01                                                         
         SPACE 1                                                                
GETORD00 CLC   INFOART,SPACES      EXIT EOF 2ND TIME AROUND                     
         BNE   GETORD90                                                         
         SPACE 1                                                                
         USING PAFRECD,R4                                                       
GETORD01 LA    R4,MYIO             BUILD START KEY FOR NEXT ARTICLE             
         XC    PAFKEY,PAFKEY                                                    
         MVI   PAFKTYP,PAFKTYPQ                                                 
         MVI   PAFKSUB,PAFKSQ                                                   
         MVC   PAFKCPY,INFOCPY                                                  
         MVC   PAFKART,LASTART     SET TO LAST ARTICLE NUMBER                   
         MVI   PAFKARTF,1          AND ENSURE NEXT ONE IS READ                  
         CLC   INFOART,SPACES                                                   
         BE    *+14                                                             
         MVC   PAFKART,INFOART     (READ FOR A SPECIFIC ARTICLE)                
         MVI   PAFKARTF,0                                                       
         SPACE 1                                                                
         MVC   SAVEKEY1,PAFKEY                                                  
         GOTO1 DATAMGR,DMCB,DMRDHI,ACCDIR,PAFRECD,PAFRECD,0                     
         BE    GETORD02                                                         
         DC    H'0'                I/O ERROR - DUMP HERE|                       
         SPACE 1                                                                
GETORD02 CLC   PAFKEY(3),SAVEKEY1  STILL ARTICLES?                              
         BNE   GETORD90                                                         
         CLC   INFOART,SPACES                                                   
         BE    GETORD03                                                         
         CLC   INFOART,PAFKART     MATCH ON SPECIFIC ARTICLE CODE?              
         BNE   GETORD90                                                         
         SPACE 1                                                                
GETORD03 MVC   LASTART,PAFKART     SAVE CURRENT ARTICLE                         
         SPACE 1                                                                
         L     R5,LVLNUMS          LEVEL PROCESSING LOOP                        
         LA    R6,LVLLENS                                                       
         SPACE 1                                                                
GETORD04 LLC   R1,0(R6)            NOW SET SUPPLIER, CLIENT AND OFFICE          
         MVC   PAFKSUP,SPACES                                                   
         MVC   PAFKSUP(0),INFOSUP                                               
         EX    R1,*-6                                                           
         MVC   PAFKCLI,INFOCLI                                                  
         MVC   PAFKOFF,INFOOFF                                                  
         MVC   SAVEKEY2,PAFKEY     SAVE ARTICLE'S KEY                           
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETORD06            IF MATCH TEST WHETHER GOOD                   
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETORD06            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETORD06            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETORD05                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETORD06                                                         
GETORD05 CLC   PAFKSWC,SPACES                                                   
         BE    GETORD50                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETORD50                                                         
         SPACE 1                                                                
GETORD06 MVC   PAFKEY,SAVEKEY2     REESTABLISH KEY                              
         MVC   PAFKOFF,SPACES      AND SET OFFICE TO NAUGHT                     
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETORD08            IF MATCH TEST WHETHER GOOD                   
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETORD08            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETORD08            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETORD07                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETORD08                                                         
GETORD07 CLC   PAFKSWC,SPACES                                                   
         BE    GETORD50                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETORD50                                                         
         SPACE 1                                                                
GETORD08 MVC   PAFKEY,SAVEKEY2     REESTABLISH KEY                              
         MVC   PAFKCLI,SPACES      AND SET CLIENT TO NAUGHT                     
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETORD10            IF MATCH TEST WHETHER GOOD                   
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETORD10            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETORD10            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETORD09                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETORD10                                                         
GETORD09 CLC   PAFKSWC,SPACES                                                   
         BE    GETORD50                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETORD50                                                         
         SPACE 1                                                                
GETORD10 MVC   PAFKEY,SAVEKEY2     REESTABLISH KEY                              
         MVC   PAFKOFF,SPACES      AND SET OFFICE AND CLIENT TO NAUGHT          
         MVC   PAFKCLI,SPACES                                                   
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETORD12            IF MATCH TEST WHETHER GOOD                   
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETORD12            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETORD12            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETORD11                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETORD12                                                         
GETORD11 CLC   PAFKSWC,SPACES                                                   
         BE    GETORD50                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETORD50                                                         
         SPACE 1                                                                
GETORD12 MVC   PAFKEY,SAVEKEY2     REESTABLISH KEY                              
         AHI   R6,1                PROCESS NEXT LEVEL                           
         BCT   R5,GETORD04                                                      
         SPACE 1                                                                
GETORD20 CLC   INFOART,SPACES      NOTHING FOUND FOR THIS ARTICLE               
         BNE   GETORD90                                                         
         B     GETORD00            READ FOR NEXT ARTICLE AND TRY AGAIN          
         SPACE 1                                                                
GETORD50 MVC   MYDA,PAFKDA         READ FULL RECORD                             
         GOTO1 DATAMGR,DMCB,GETREC,ACCMST,MYDA,PAFRECD,MYWORK                   
         BE    GETORDX             OK AND EXIT                                  
         DC    H'0'                I/O ERROR                                    
         SPACE 1                                                                
GETORD90 OI    MYSTATUS,EOFQ       SET END OF FILE                              
         B     GETORDX                                                          
         SPACE 1                                                                
GETORDX  B     EXIT                                                             
         DROP  R4                                                               
         EJECT                                                                  
***********************************************************************         
* GET FILTERED ARTICLES IN SEQUENCE FOR ORDERS ('ALL')                *         
* - READ ARTICLE NUMBERS SEQUENTIALLY AND FOR EACH ARTICLE NUMBER     *         
*   READ FOR THE BEST MATCH AS FOLLOWS (VIA PASSIVES):                *         
*                    1.: READ HIGH FOR NEXT ARTICLE NUMBER            *         
*                    2.: READ SUPL/CLI/OF - IF EXISTS THEN TAKE, ELSE *         
*                    3.: READ SUPL/CLI/.. - IF EXISTS THEN TAKE, ELSE *         
*                    4.: READ SUPL/.../OF - IF EXISTS THEN TAKE, ELSE *         
*                    5.: READ SUPL/.../.. - IF EXISTS THEN TAKE, ELSE *         
*                    6.: READ ----/CLI/OF - IF EXISTS THEN TAKE, ELSE *         
*                    7.: READ ----/CLI/.. - IF EXISTS THEN TAKE, ELSE *         
*                    8.: READ ----/.../OF - IF EXISTS THEN TAKE, ELSE *         
*                    9.: READ ----/.../.. - IF EXISTS THEN TAKE, ELSE *         
*                   10.: NO VALID ENTRY FOR THIS ARTICLE NUMBER       *         
***********************************************************************         
         SPACE 1                                                                
GETAOI   NTR1  ,                                                                
         TM    MYSTATUS,INITQ      ARTICLE READ INITIALISED?                    
         BNZ   GETAOI02                                                         
         OI    MYSTATUS,INITQ                                                   
         MVC   LASTART,RESCODE     SET START ARTICLE NUMBER                     
         B     GETAOI04                                                         
         SPACE 1                                                                
GETAOI02 CLC   INFOART,SPACES      BUT IF ONE SPECIFIED THEN EXIT               
         BNE   GETAOI90                                                         
         SPACE 1                                                                
         USING PAFRECD,R4                                                       
GETAOI04 LA    R4,MYIO             BUILD START KEY FOR NEXT ARTICLE             
         XC    PAFKEY,PAFKEY                                                    
         MVI   PAFKTYP,PAFKTYPQ                                                 
         MVI   PAFKSUB,PAFKSQ                                                   
         MVC   PAFKCPY,INFOCPY                                                  
         MVC   PAFKART,LASTART     SET TO LAST ARTICLE NUMBER                   
         MVI   PAFKARTF,1          AND ENSURE NEXT ONE IS READ                  
         CLC   INFOART,SPACES                                                   
         BE    *+14                                                             
         MVC   PAFKART,INFOART     (READ FOR A SPECIFIC ARTICLE)                
         MVI   PAFKARTF,0                                                       
         SPACE 1                                                                
         MVC   SAVEKEY1,PAFKEY                                                  
         GOTO1 DATAMGR,DMCB,DMRDHI,ACCDIR,PAFRECD,PAFRECD,0                     
         BE    GETAOI05                                                         
         DC    H'0'                I/O ERROR - DUMP HERE|                       
         SPACE 1                                                                
GETAOI05 CLC   PAFKEY(3),SAVEKEY1  STILL ARTICLES?                              
         BNE   GETAOI90                                                         
         CLC   INFOART,SPACES                                                   
         BE    GETAOI06                                                         
         CLC   INFOART,PAFKART     MATCH ON SPECIFIC ARTICLE CODE?              
         BNE   GETAOI90                                                         
         SPACE 1                                                                
GETAOI06 MVI   BYTE,0              READ HIGH -> SUPPLIER FOUND?                 
         CLC   PAFKSUP,SPACES                                                   
         BNH   GETAOI07                                                         
         MVI   BYTE,1                                                           
         SPACE 1                                                                
GETAOI07 MVC   LASTART,PAFKART     SAVE CURRENT ARTICLE                         
         SPACE 1                                                                
         L     R5,LVLNUMS          LEVEL PROCESSING LOOP                        
         LA    R6,LVLLENS                                                       
         SPACE 1                                                                
GETAOI08 LLC   R1,0(R6)            NOW SET SUPPLIER, CLIENT AND OFFICE          
         MVC   PAFKSUP,SPACES                                                   
         MVC   PAFKSUP(0),INFOSUP                                               
         EX    R1,*-6                                                           
         MVC   PAFKCLI,INFOCLI                                                  
         MVC   PAFKOFF,INFOOFF                                                  
         MVC   SAVEKEY2,PAFKEY     SAVE ARTICLE'S KEY                           
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETAOI11            IF MATCH TEST WHETHER GOOD                   
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETAOI11            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETAOI11            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETAOI10                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETAOI11                                                         
GETAOI10 CLC   PAFKSWC,SPACES                                                   
         BE    GETAOI50                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETAOI50                                                         
         SPACE 1                                                                
GETAOI11 MVC   PAFKEY,SAVEKEY2     REESTABLISH KEY                              
         MVC   PAFKOFF,SPACES      AND SET OFFICE TO NAUGHT                     
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETAOI13            IF MATCH TEST WHETHER GOOD                   
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETAOI13            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETAOI13            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETAOI12                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETAOI13                                                         
GETAOI12 CLC   PAFKSWC,SPACES                                                   
         BE    GETAOI50                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETAOI50                                                         
         SPACE 1                                                                
GETAOI13 MVC   PAFKEY,SAVEKEY2     REESTABLISH KEY                              
         MVC   PAFKCLI,SPACES      AND SET CLIENT TO NAUGHT                     
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETAOI15            IF MATCH TEST WHETHER GOOD                   
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETAOI15            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETAOI15            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETAOI14                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETAOI15                                                         
GETAOI14 CLC   PAFKSWC,SPACES                                                   
         BE    GETAOI50                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETAOI50                                                         
         SPACE 1                                                                
GETAOI15 MVC   PAFKEY,SAVEKEY2     REESTABLISH KEY                              
         MVC   PAFKOFF,SPACES      AND SET OFFICE AND CLIENT TO NAUGHT          
         MVC   PAFKCLI,SPACES                                                   
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETAOI18            IF MATCH TEST WHETHER GOOD                   
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETAOI18            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETAOI18            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETAOI16                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETAOI18                                                         
GETAOI16 CLC   PAFKSWC,SPACES                                                   
         BE    GETAOI50                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETAOI50                                                         
         SPACE 1                                                                
GETAOI18 MVC   PAFKEY,SAVEKEY2     REESTABLISH KEY                              
         AHI   R6,1                PROCESS NEXT LEVEL                           
         BCT   R5,GETAOI08                                                      
         SPACE 1                                                                
GETAOI20 CLI   BYTE,1              NOW READ FOR ITEMS WITH NO SUPPLIER          
         BE    GETAOI36            (IF NONE EXISTS EXIT)                        
*        MVC   PAFKEY,SAVEKEY2                                                  
         MVC   PAFKSUP,SPACES                                                   
         MVC   PAFKCLI,INFOCLI                                                  
         MVC   PAFKOFF,INFOOFF                                                  
         MVC   SAVEKEY2,PAFKEY     SAVE ARTICLE'S KEY                           
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETAOI24            IF MATCH TEST WHETHER GOOD                   
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETAOI24            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETAOI24            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETAOI22                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETAOI24                                                         
GETAOI22 CLC   PAFKSWC,SPACES                                                   
         BE    GETAOI50                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETAOI50                                                         
         SPACE 1                                                                
GETAOI24 MVC   PAFKEY,SAVEKEY2     REESTABLISH KEY                              
         MVC   PAFKOFF,SPACES      AND SET OFFICE TO NAUGHT                     
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETAOI28            IF MATCH TEST WHETHER GOOD                   
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETAOI28            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETAOI28            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETAOI26                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETAOI28                                                         
GETAOI26 CLC   PAFKSWC,SPACES                                                   
         BE    GETAOI50                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETAOI50                                                         
         SPACE 1                                                                
GETAOI28 MVC   PAFKEY,SAVEKEY2     REESTABLISH KEY                              
         MVC   PAFKCLI,SPACES      AND SET CLIENT TO NAUGHT                     
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETAOI32            IF MATCH TEST WHETHER GOOD                   
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETAOI32            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETAOI32            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETAOI30                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETAOI32                                                         
GETAOI30 CLC   PAFKSWC,SPACES                                                   
         BE    GETAOI50                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETAOI50                                                         
         SPACE 1                                                                
GETAOI32 MVC   PAFKEY,SAVEKEY2     REESTABLISH KEY                              
         MVC   PAFKOFF,SPACES      AND SET OFFICE AND CLIENT TO NAUGHT          
         MVC   PAFKCLI,SPACES                                                   
         GOTO1 DATAMGR,DMCB,DMREAD,ACCDIR,PAFRECD,PAFRECD,0                     
         BNE   GETAOI36            IF MATCH TEST WHETHER GOOD                   
         TM    PAFKSTAT,ARTKLOCK                                                
         BNZ   GETAOI36            NO LOCKED ARTICLES                           
         CLC   INFODAT,PAFKSDAT                                                 
         BL    GETAOI36            MUST BE EFFECTIVE AT INFODAT                 
         TM    PAFKSTAT,ARTKFLXQ+ARTKNOPQ                                       
         BZ    GETAOI34                                                         
         CLI   INFOSTT,INFOALQ     ALL PRICES?                                  
         BNE   GETAOI36                                                         
GETAOI34 CLC   PAFKSWC,SPACES                                                   
         BE    GETAOI50                                                         
         CLC   PAFKSWC,INFOWRK     IF SET W/C MUST MATCH                        
         BE    GETAOI50                                                         
         SPACE 1                                                                
GETAOI36 CLC   INFOART,SPACES      NOTHING FOUND FOR THIS ARTICLE               
         BNE   GETAOI90                                                         
         B     GETAOI02            READ FOR NEXT ARTICLE AND TRY AGAIN          
         SPACE 1                                                                
GETAOI50 MVC   MYDA,PAFKDA         READ FULL RECORD                             
         GOTO1 DATAMGR,DMCB,GETREC,ACCMST,MYDA,PAFRECD,MYWORK                   
         BE    GETAOIX             OK AND EXIT                                  
         SPACE 1                                                                
GETAOI90 OI    MYSTATUS,EOFQ       SET END OF FILE                              
         B     GETAOIX                                                          
         SPACE 1                                                                
GETAOIX  B     EXIT                                                             
         DROP  R4                                                               
         EJECT                                                                  
***********************************************************************         
* CONSTANTS, EQUATES AND LTORG                                        *         
***********************************************************************         
         SPACE 1                                                                
SPACES   DC    42C' '                                                           
ASTERS   DC    24C' '                                                           
*EXFFS   DC    14X'FF'                                                          
ONE2ONEQ DC    X'0000100000'                                                    
         SPACE 1                                                                
GETREC   DC    CL8'GETREC'                                                      
DMREAD   DC    CL8'DMREAD'                                                      
DMRDHI   DC    CL8'DMRDHI'                                                      
ACCDIR   DC    CL8'ACCDIR'                                                      
ACCMST   DC    CL8'ACCMST'                                                      
ACCFIL   DC    CL8'ACCOUNT'                                                     
         SPACE 1                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* LOCAL WORKING STORAGE AND OTHER DSECTS                              *         
***********************************************************************         
         SPACE 1                                                                
WORKD    DSECT                                                                  
PAREA    DS    XL(INFOLNQ)                                                      
         SPACE 1                                                                
CNTITMS  DS    XL1                                                              
RESCODE  DS    CL4                                                              
LVLNUMS  DS    F                                                                
LVLLENS  DS    XL4                                                              
         SPACE 1                                                                
RELO     DS    A                                                                
APARM    DS    A                                                                
PAOUT    DS    A                                                                
PACOMF   DS    A                                                                
         SPACE 1                                                                
VBLDCUR  DS    V                                                                
VEUREKA  DS    V                                                                
VDATCON  DS    V                                                                
DATAMGR  DS    V                                                                
         SPACE 1                                                                
ADXNMEL  DS    A                                                                
ERRBYTE  DS    XL1                                                              
MODBYTE  DS    XL1                                                              
         SPACE 1                                                                
CURCURR  DS    CL3                                                              
CURNAME  DS    CL36                                                             
CURAMNT  DS    PL8                                                              
         SPACE 1                                                                
GETACT   DS    XL15                                                             
GETANM   DS    CL36                                                             
GETSAVE  DS    CL36                                                             
         SPACE 1                                                                
MYSTATUS DS    XL1                 * GENERAL STATUS                             
EOFQ     EQU   X'08'                                                            
INITQ    EQU   X'80'                                                            
PRIQ     EQU   X'01'                                                            
AFDQ     EQU   X'10'                                                            
NAMQ     EQU   X'02'                                                            
ALLELQ   EQU   PRIQ+AFDQ+NAMQ                                                   
INIQ     EQU   X'FF'-ALLELQ                                                     
         SPACE 1                                                                
DUB      DS    D                                                                
DMCB     DS    6F                                                               
LASTPAF  DS    XL42                                                             
LASTART  DS    CL4                                                              
         DS    XL1                 KEEP                                         
LASTSUP  DS    CL14                                                             
IDT2     DS    XL2                                                              
BYTE     DS    XL1                                                              
         SPACE 1                                                                
AGYTENT  DS    CL(CURTABL+L'CURTSHRT+L'CURTLONG)                                
PRETENT  DS    CL(CURTABL+L'CURTSHRT+L'CURTLONG)                                
         SPACE 1                                                                
AREA     DS    XL(EURKBLKL)        EUREKA AREA                                  
SAVEKEY1 DS    XL42                                                             
SAVEKEY2 DS    XL42                                                             
SAVELN3  DS    XL3                                                              
MYDA     DS    XL4                 D/A                                          
MYWORK   DS    XL64                                                             
MYIO     DS    XL2000              I/O AREA                                     
GETIO    DS    XL2000              GETACT I/O AREA                              
         SPACE 1                                                                
WORKX    EQU   *                                                                
         EJECT                                                                  
***********************************************************************         
* INCLUDED BOOKS                                                      *         
***********************************************************************         
         SPACE 1                                                                
* ACGETALPD                                                                     
       ++INCLUDE ACGETALPD                                                      
         SPACE 1                                                                
* ACGENFILE                                                                     
         PRINT OFF                                                              
       ++INCLUDE ACGENFILE                                                      
         PRINT ON                                                               
         SPACE 1                                                                
* DDCOMFACSD                                                                    
         PRINT OFF                                                              
       ++INCLUDE DDCOMFACSD                                                     
         PRINT ON                                                               
         SPACE 1                                                                
* DDCURTABD                                                                     
         PRINT OFF                                                              
       ++INCLUDE DDCURTABD                                                      
         PRINT ON                                                               
         SPACE 1                                                                
* DDEUREKAD                                                                     
         PRINT OFF                                                              
       ++INCLUDE DDEUREKAD                                                      
         PRINT ON                                                               
         SPACE 1                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'012ACGETALP  06/05/13'                                      
         END                                                                    

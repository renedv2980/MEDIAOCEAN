*          DATA SET REFILCON   AT LEVEL 002 AS OF 01/07/14                      
*CATALP REFILCON                                                                
         TITLE 'REREPFILC - REFILC - MAIN FILE CONTROLLER'                      
*                                                                               
*********************************************************************           
*                                                                   *           
*- REREPFILC -- REP REPORTER MAIN FILE CONTROLLER                   *           
*                                                                   *           
*  CATALOG DATASET REFILC(A)                                        *           
*                                                                   *           
* ----------------------------------------------------------------- *           
*                                                                   *           
*  MOD LOG:                                                         *           
*  --------                                                         *           
*  08/28/89  PJS  NEW DATAMANAGER CHANGES: PASS REP CODE ON HI/SEQ  *           
*                 DIRECTORY CALLS FOR REP CODE LOW RECORDS          *           
*                 (ADVERTISER, PRODUCT, AGENCY)                     *           
*                                                                   *           
*  10/13/89  PJS  TWEAK DMGR CHANGES FOR SKIPPER                    *           
*                                                                   *           
*  10/26/89  PJS  ADDED EBCDIC OUTPUT FOR KEY TRACE                 *           
*                                                                   *           
*  02/08/90  PJS  FILTERS: BYPASS ACTIVITY FILTERING FOR 16 REPORT  *           
*                 (STATION CLOSEOUT NEEDS ALL THE CONTRACTS)        *           
*                                                                   *           
*  02/09/90  PJS  MULTIPLE REQUEST CARD SUPPORT.                    *           
*                 TWO ENTRY POINTS:                                 *           
*                     RQSTNUM - XL1'NUMBER OF RQST CARDS'           *           
*                     RQSTCARD- XL1000'N 80 BYTE RQST CARDS'        *           
*                                                                   *           
*                 REPORTS USING MORE THAN 1 CARD MAY FIND THESE     *           
*                  DATA ITEMS VIA THE LINKER.                       *           
*                                                                   *           
*  APR25/90 (MRR) --- MERGE MULTI-REP (INTEREP) SUPPORT INTO THIS   *           
*                      VERSION                                      *           
*                                                                   *           
*  MAY15/90 (MRR) --- ADD DOWNLOADING AREAS AND TRAP PRINTER CALL   *           
*                                                                   *           
*  MAY22/90 (MRR) --- BY-PASS ACTIVTY FILTER FOR 21 AS WE DO FOR 20 *           
*                                                                   *           
*  MAY29/90 (MRR) --- ADD 19 REPORT TO RCLIST                       *           
*                                                                   *           
*  JUL27/90 (MRR) --- PASS CONTRACTS TO THE 37 AND 47 BASED ONLY ON *           
*                      ACTIVITY (NOT PERIOD START/END)              *           
*                                                                   *           
*  JUL30/90 (MRR) --- FIX BUG  IN '9C' KEY READING ORDER            *           
*                                                                   *           
*  AUG07/90 (MRR) --- FIX JUL27/90 FIX                              *           
*                                                                   *           
*  SEP19/90 (MRR) --- ADD 1B REPORT TO RCLIST + SPRPTTBL            *           
*                     EXPAND DOWNLOAD TABLE TO 200 ENTRIES          *           
*                                                                   *           
*  DEC20/90 (BU ) --- ADD A(SUBSIDIARY REP CODES) FOR CONSOLIDATED  *           
*                     REPORTING                                     *           
*                                                                   *           
*  JAN31/91 (MRR) --- ADD 1D REPORT TO RCLIST + SPRPTTBL            *           
*                                                                   *           
*  FEB21/91 (BU ) --- EXCLUDE, VIA HARD CODE, NONREP (I2) SUBREP    *           
*                     CODE FOR INTEREP WHEN RUN IS FOR R6           *           
*                                                                   *           
*  MAR04/91 (BU ) --- EXCLUDE, VIA HARD CODE, CABALLERO (I8) SUBREP *           
*                     CODE FOR INTEREP WHEN RUN IS FOR R6           *           
*                                                                   *           
*  JUN26/91 (MRR) --- >DO FOR 8H AS FOR THE 8A - NOT TOO GOOD       *           
*                                                                   *           
*  JUN28/91 (BU ) --- FIX 'DC' (BOP) READ SEQUENCE TO SKIP DATE     *           
*                     CHECK FOR 8H REPORT                           *           
*                                                                   *           
*  AUG21/91 (BU ) --- IMPLEMENT OPTIONAL SPACING MECHANISM          *           
*                                                                   *           
*  SEP20/91 (BU ) --- IMPLEMENT ADDITIONAL FILTERING                *           
*                                                                   *           
*  OCT08/91 (BU ) --- USE 'COVAIL' TO ALLOCATE SPACEND.  ALSO USE   *           
*                     STORED SPACEND TABLE.                         *           
*                                                                   *           
*  OCT31/91 (BU ) --- USE 'COVAIL' TO ALLOCATE NEWMONTB.  ALSO USE  *           
*                     'VALUENEW' IN PLACE OF 'VALUEMON'.            *           
*                                                                   *           
*  NOV07/91 (BU ) --- SKIP ADDITIONAL FILTERING FOR 1C REPORT       *           
*                                                                   *           
*  DEC17/91 (BU ) --- BYPASS 'SETMONTB' WHEN THERE ARE NO DATES     *           
*                                                                   *           
*  DEC26/91 (BU ) --- INCORPORATE EOM OVERRIDE DATE IF REQUESTOR    *           
*                     NAME BEGINS WITH 'EOM=':  NEXT SIX CHARACTERS *           
*                     ARE EOM OVERRIDE DATE DESIRED, FOLLOWED BY    *           
*                     '/#', WHERE # IS THE NUMBER OF WEEKS USED TO  *           
*                     CALCULATE THE PERIOD                          *           
*                                                                   *           
*  JAN02/92 (BU ) --- INCORPORATE MASTER/SUBSIDIARY REP PROCESSING  *           
*                     FOR 'REPORTER' JOBS                           *           
*                                                                   *           
*  JAN20/92 (MRR) --- MAKE SURE TO CALL COVAIL EVEN IF DOWNLOAD     *           
*                                                                   *           
*  MAR03/92 (BU ) --- ADD 20/21 SUPPORT FOR ACCOUNT OPT ('T')       *           
*                                                                   *           
*  MAR03/92 (BU ) --- CHANGE LEAP YEAR DAY ADJUSTMENT TABLE TO      *           
*                     HANDLE 2 YEAR PRIOR AND NEXT YEAR (AND        *           
*                     NOTICE THAT IT DIED ON LEAP DAY!!)            *           
*                                                                   *           
*  MAR11/92 (BU ) --- CHANGES TO ACTIVATE AS-AT RANGE TESTING IN    *           
*                     CONJUNCTION WITH MODIFIED 'VALUENEW'.         *           
*                     REREPRGEQU --> REREPRGEQA                     *           
*                                                                   *           
*  APR28/92 (BU ) --- CHANGE CONTRACT TYPE FILTER FOR TYPE=R        *           
*                                                                   *           
*  MAY11/92 (BU ) --- NEW 'AS-AT' DATE CALCULATIONS                 *           
*                                                                   *           
*  MAY21/92 (BU ) --- FIX APR28 CHANGE:  1 LINE TOO MANY REMOVED    *           
*                                                                   *           
*  OCT14/92 (BU ) --- CHECK ALTERNATE DATE FORMAT IN TSTSPL RTN.    *           
*                                                                   *           
*  DEC07/92 (BU ) --- FLUSH REQUEST IF NO EOM RECORD, RATHER THAN   *           
*                     ABORT RUN                                     *           
*                                                                   *           
*  DEC29/92 (BU ) --- SET DOWNLOAD REQUESTED FLAG FOR RRG USE       *           
*                                                                   *           
*  FEB23/93 (BU ) --- TSTSPL:  PASS CONTRACT WITH NO SPL ELEMENT,   *           
*                     BUT X'08' ELEMENT WITH 'CLOSE AFTER' DATE     *           
*                     NOT EARLIER THAN RUN DATE                     *           
*                                                                   *           
*  OCT05/93 (BU ) --- EXPAND WORKSPACE TO PERMIT TABLING OF AGG     *           
*                     DATA, IF NEEDED.                              *           
*                                                                   *           
*  NOV02/93 (BU ) --- TSAROFF INSTALLATION FOR AGGREGATE AND SPL    *           
*                     TABLE USE                                     *           
*                                                                   *           
*  NOV30/93 (BU ) --- EXCLUDE DI/HN FROM SUBSIDIARY REP TABLES      *           
*                                                                   *           
*  JAN31/94 (BU ) --- INCREASE SPACE AVAILABLE FOR SPACEND TABLE    *           
*                                                                   *           
*  APR01/94 (BU ) --- FIX PROCESSING TIME ERROR BY CORRECTING       *           
*                     'GETINFO' PROCESSING                          *           
*                                                                   *           
*  APR05/94 (BU ) --- FIX 'OFFICE NOT IN A REGION' BUG IN GETINFO   *           
*                                                                   *           
*  APR09/94 (BU ) --- BYPASS 'NO S/P ABORT' IN GETINFO...           *           
*                                                                   *           
*  OCT14/94 (BU ) --- FORCE 'NO ZZ FILE'                            *           
*                                                                   *           
*  MAR14/95 (BU ) --- PASS 'FCST' ORDERS WITH NO ACTIVITY (NO 3/4   *           
*                     EST/INV BUCKETS).                             *           
*                                                                   *           
*  MAR15/95 (BU ) --- SET A(REQUEST CARDS) FOR NON-RRG REPORT       *           
*                     USAGE.                                        *           
*                                                                   *           
*  APR06/95 (BU ) --- EXPAND RCONREC IO BUFFER TO 2K - CHANGE       *           
*                     REGENALLA-->REGENALLB                         *           
*                                                                   *           
*  NOV15/95 (BU ) --- MAKE KATZ FILE DIFFERENCE ADJUSTMENTS TO      *           
*                     GETINFO ROUTINES.                             *           
*                                                                   *           
*  APR29/96 (BU ) --- MAKE KATZ FILE DIFFERENCE ADJUSTMENTS TO      *           
*                     GETINFO ROUTINES.                             *           
*                                                                   *           
*  JUN12/96 (BU ) --- FIX TEAM SPACEND TABLE DISPLACEMENTS IN S/P   *           
*                     READ ROUTINE                                  *           
*                                                                   *           
*  JUN22/96 (BU ) --- INCREASE SIZE OF SPACEND TABLE FOR AQ USE     *           
*                                                                   *           
*  SEP05/96 (BU ) --- ESTABLISH KATZ EQUIV OF NON-REP (I2) AS NON   *           
*                     (K6) IN CHKDROP ROUTINE                       *           
*                                                                   *           
*  OCT25/96 (BU ) --- SET 'SUBREPIN = Y' IF REQUEST IS FOR A SUB-   *           
*                     SIDIARY REP.                                  *           
*                                                                   *           
*  JAN23/97 (BU ) --- FILTERING (PP/NETCON#) LOOP WHEN LAST PART    *           
*                     OF PRODUCT RECORD OVERLAID BY AGENCY RECORD   *           
*                                                                   *           
*  JAN24/97 (BU ) --- EXPAND FEB29 DATE TABLE IN SETUPMON           *           
*                                                                   *           
*  FEB19/97 (BU ) --- NEW MONTABLE SCAN FOR CLOSED STATION BUCKETS  *           
*                                                                   *           
*  APR16/97 (BU ) --- GET ADDITIONAL SPACE FOR OPTION STATION       *           
*                     TABLE                                         *           
*                                                                   *           
*  MAY13/97 (BU ) --- DELETE EXISTING R15 REFERENCES, SKIP SETUPMON *           
*                     FOR NEW R15.                                  *           
*                                                                   *           
*  JUL15/97 (BU ) --- RESET REP RECORD ON SECOND REQUEST OF A       *           
*                     MASTER/SUB RUN                                *           
*                                                                   *           
*  JAN16/98 (BU ) --- EXPAND RCONREC IO BUFFER TO 4K - CHANGE       *           
*                     REGENALLB-->REGENALLB1                        *           
*                                                                   *           
*  APR30/98 (BU ) --- TREAT '1S' REPORT AS MASTER, NO SUBS          *           
*                                                                   *           
*  JUL07/98 (BU ) --- CROSS-COMPANY VERSION                         *           
*                                                                   *           
*  MAR17/00 (BU ) --- TREAT 'XA' REPORT AS MASTER, NO SUBS          *           
*                                                                   *           
*  JUL31/01 (BU ) --- REARRANGE FOR DYNALLOC                        *           
*                                                                   *           
*                                                                   *           
*                                                                   *           
*                                                                   *           
*                     **  END TOMBSTONE  **                         *           
*********************************************************************           
*                                                                               
REFILCON CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 400,**FILC**,R9,R8,RR=R2                                         
         L     RA,=V(REWORKC)                                                   
         USING WORKD,RA                                                         
         USING MONARCHD,RC                                                      
         ST    RC,AMONARCH                                                      
         L     R7,FILEC                                                         
         USING FILED,R7                                                         
         ST    R2,RELO                                                          
         STM   R2,RC,SAVEREGS                                                   
         EJECT                                                                  
*                                                                               
*        SUBSTITUTE THE ADDRESS OF DOWNRPT FOR REPORT IF FLAG ON                
*                                                                               
         MVI   RCDNLOAD,C'N'       SET 'DOWNLOAD' = NO                          
         L     RE,=V(RCDOWNLD)                                                  
         ZICM  RF,0(RE),1                                                       
         BZ    NODOWN                                                           
         MVI   RCDNLOAD,C'Y'       SET 'DOWNLOAD' = YES                         
         L     R2,0(R1)                                                         
         L     RE,=V(DOWNDONE)                                                  
         MVI   0(RE),0                      SAY NO DATA YET                     
         MVC   REPORT,=V(RERDWN)                                                
         GOTO1 REPORT,DMCB,WORKC,=C'START'  START THE DOWNLOAD                  
         ST    R2,0(R1)                                                         
         CLI   RCSPFLG,1           COVAIL BEEN CALLED?                          
         BE    DOWNOVER            YES - DON'T DO AGAIN                         
*                                                                               
         MVI   RCSPFLG,1           SET ONE-TIME SWITCH                          
         BAS   RE,DOCOVAIL         GET ADDL SPACE VIA COVAIL                    
         ST    R2,0(R1)                                                         
         B     DOWNOVER                                                         
NODOWN   EQU   *                                                                
*                                                                               
*  IN ORDER TO TEST WHETHER OPTIONAL SPACING IS TO BE APPLIED, THE              
*     A(ORIGINAL REPORT) IS SAVED, AND A LOCAL ROUTINE WHICH TESTS              
*     SPACING IS INSERTED.  THIS LOCAL ROUTINE THEN CALLS THE                   
*     ORIGINAL REPORT ROUTINE.                                                  
*                                                                               
         CLI   RCSPFLG,1           A(REPORT)/A(LOCALREP) SWAPPED?               
         BE    DOWNOVER            YES - DON'T DO AGAIN                         
         MVI   RCSPFLG,1           SET ONE-TIME SWITCH                          
         LA    RE,LOCALREP         SET A(REPORT RTN W/OPT'L SPACING)            
         MVC   REALREPT,REPORT     SAVE A(ORIGINAL REPORT ROUTINE)              
         ST    RE,REPORT           OVERRIDE ORIGINAL WITH SPACE VER             
         BAS   RE,DOCOVAIL         GET ADDL SPACE VIA COVAIL                    
         B     DOWNOVER                                                         
         EJECT                                                                  
*                                                                               
*   THIS ROUTINE TESTS OPTIONAL SPACING, AND THEN CALLS THE ORIGINAL            
*     REPORT ROUTINE FOR PRINTING.                                              
*                                                                               
LOCALREP NTR1  LABEL=N                                                          
*                                                                               
         USING LOCALREP,RF                                                      
         LA    R1,SAVEREGS-LOCALREP                                             
         AR    R1,RF                                                            
         LM    R2,RC,0(R1)                                                      
         DROP  RF                                                               
*                                                                               
         L     R4,REPORT           RESET ORIGINAL A(REPORT)                     
         MVC   REPORT,REALREPT                                                  
         MVI   LCREPFLG,C'Y'                                                    
*                                                                               
         CLI   RCSPACE,0           USE ORIGINAL SPACING                         
         BE    LREP0002            WHEN OPTIONAL = 0                            
         CLI   RCSPACE,3           USE ORIGINAL SPACING                         
         BH    LREP0002            WHEN OPTIONAL > TOO MUCH                     
*                                                                               
         CLC   P,SPACES            ANYTHING IN PRINT LINE?                      
         BNE   LREP0004            YES - CHECK OPTIONAL SPACING                 
LREP0002 EQU   *                                                                
         GOTO1 REPORT              GOTO REPORT WITH ORIG SPACING                
         B     LREP0099            END ROUTINE                                  
LREP0004 EQU   *                                                                
         ZIC   RF,RCSPACE          FACTOR IN OPTIONAL SPACING                   
         ZIC   R2,SPACING                                                       
         BCTR  RF,0                SUBTRACT 1 FROM OPTIONAL SPACING             
         AR    R2,RF               ADD OPTL SPACING TO REGULAR SPACING          
         STC   R2,SPACING          REGULAR + OPTL SPACING                       
         GOTO1 REPORT              GOTO REPORT WITH OPTL SPACING                
LREP0099 EQU   *                                                                
         MVI   LCREPFLG,X'00'                                                   
         ST    R4,REPORT           RESET A(LOCALREP)                            
         B     XIT                 END ROUTINE                                  
SAVEREGS DS    11A                                                              
REALREPT DS    A                                                                
RCSPFLG  DS    CL1                                                              
         DS    0H                                                               
         EJECT                                                                  
*   PRESERVE R1 AND CONTENTS OF 0(R1) = ORIGINAL CALLING MODULE'S               
*     P1 CONTENTS                                                               
*                                                                               
DOCOVAIL NTR1                                                                   
*                                                                               
         XC    DUB,DUB             INITIALIZE STORAGE                           
         ST    R1,DUB              SAVE R1 FROM CALLING PROG                    
         MVC   DUB+4(4),0(R1)      SAVE VALUE AT R1 FROM CALLING PROG           
         L     RF,ADCONLST         RETRIEVE WORK AREA FOR SPACEND               
         USING ADCONSD,RF                                                       
         L     R6,COVAIL                                                        
         DROP  RF                                                               
         GOTO1 (R6),DMCB,C'GET',1755000,1755000                                 
***>>>   GOTO1 (R6),DMCB,C'GET',1555000,1555000                                 
***>>>   GOTO1 (R6),DMCB,C'GET',1355000,1355000                                 
         OC    P2(4),P2            WORK AREA RETRIEVED?                         
         BNZ   DOCV0020            YES                                          
         DC    H'0'                NO  - CAN'T GO ON                            
DOCV0020 EQU   *                                                                
         L     RF,P2               INITIALIZE THE WORK AREA                     
         XCEFL 0(RF),1755000                                                    
***>>>   XCEFL 0(RF),1555000                                                    
***>>>   XCEFL 0(RF),1355000                                                    
         L     RF,P2               ESTABLISH ADDRESSES OF W/A                   
         MVC   0(11,RF),=C'**SPACEND**'                                         
         LA    RF,16(RF)           PASS 'NAME FLAG' AREA                        
         L     RE,=F'1450000'      SET L(REMAINING SPACE IN SPACEND)            
***>>>   L     RE,=F'1250000'      SET L(REMAINING SPACE IN SPACEND)            
***>>>   L     RE,=F'1050000'      SET L(REMAINING SPACE IN SPACEND)            
         ST    RE,0(RF)            SAVE L(REM SPACE) IN 1ST WORD                
         ST    RE,SVREMSPC         SAVE L(REM SPACE) FOR RELOADING              
         ST    RF,ASPACEND         A(WORK AREA FOR SPACEND)                     
         LA    RF,64(RF)           A(1ST TABLE ENTRY IN SPACEND)                
         ST    RF,ASPACND4                                                      
         MVC   LSPACEND,P3         L(WORK AREA FOR SPACEND)                     
         L     RF,ASPACEND                                                      
         A     RF,=F'1455000'      DISPLACE PAST SPACEND                        
***>>>   A     RF,=F'1255000'      DISPLACE PAST SPACEND                        
***>>>   A     RF,=F'1055000'      DISPLACE PAST SPACEND                        
         MVC   0(11,RF),=C'**MKTSTAT**'                                         
         LA    RF,16(RF)           BUMP PAST BANNER                             
         ST    RF,AMKTSTA          SAVE A(MARKET STATION TABLE)                 
*                                                                               
*   RETRIEVE SPACE FOR OPTION STATION TABLE                                     
*                                                                               
         GOTO1 (R6),DMCB,C'GET',200000,200000                                   
*                                                                               
*    ASK FOR A FIXED AMOUNT OF 200K FOR THIS TABLE.                             
*                                                                               
         OC    P2(4),P2            WORK AREA RETRIEVED?                         
         BNZ   DOCV0040            YES                                          
         DC    H'0'                NO  - CAN'T GO ON                            
SVREMSPC DS    F                                                                
DOCV0040 EQU   *                                                                
         L     RF,P2               INITIALIZE THE WORK AREA                     
         XCEFL 0(RF),P3                                                         
         L     RF,P2               ESTABLISH ADDRESSES OF W/A                   
         MVC   0(12,RF),=C'**OPTSTATB**'                                        
*                                                                               
*        FIRST 12 BYTES OF SPACE ARE DUMP LABEL                                 
*                                                                               
         LA    RF,12(RF)           SET ADDR AFTER LABEL                         
         ST    RF,AOPTSTAS         A(OPTION STATION TABLE)                      
*                                                                               
*                                                                               
         GOTO1 (R6),DMCB,C'GET',35000,35000                                     
*                                                                               
*        ASK FOR A FIXED AMOUNT OF 35K FOR THIS TABLE.                          
*                                                                               
         OC    P2(4),P2            WORK AREA RETRIEVED?                         
         BNZ   DOCV0060            YES                                          
         DC    H'0'                NO  - CAN'T GO ON                            
DOCV0060 EQU   *                                                                
         L     RF,P2               INITIALIZE THE WORK AREA                     
         XCEFL 0(RF),P3                                                         
         L     RF,P2               ESTABLISH ADDRESSES OF W/A                   
         MVC   0(12,RF),=C'**NEWMONTB**'                                        
*                                                                               
* FIRST 64 BYTES OF SPACE ARE DUMP LABEL AND MISCELLANEOUS                      
*    STORAGE, WHICH IS ACCESSED VIA A(NEWMON) - EQUATES                         
*                                                                               
         LA    RF,64(RF)           LEAVE SOME ROOM AFTER LABEL                  
*                                                                               
* NEXT 64 BYTES ARE FOR AN EXTRA INFO BLOCK FOR COMFACS                         
*                                                                               
         LA    RE,WORKD                                                         
         AH    RE,=Y(AXTRINFO-WORKD)                                            
         ST    RF,0(RE)            A(XTRAINFO BLOCK FOR COMFACS)                
         A     RF,=F'64'           ESTABLISH A(XTRA INFO BLOCK)                 
*                                                                               
         ST    RF,ANEWMON          A(NEWMONTB)                                  
         A     RF,=F'15000'        ESTABLISH A(MONTH INFO TABLE)                
*                                                                               
*  AT THIS TIME, MONTH INFO TABLE REQUIRES APPROX 10,400 BYTES                  
*        DATE = APR/98 (BU)  -  UPGRADED                                        
*                                                                               
*  AT THIS TIME, MONTH INFO TABLE REQUIRES APPROX 13,000 BYTES                  
*        DATE = MAR/00 (BU)  -  UPGRADED MARCH 27/00                            
*                                                                               
         ST    RF,AMONINFO                                                      
         A     RF,=F'300'          ESTABLISH A(MON FRCST DATE TABLE)            
         ST    RF,AMONFORC                                                      
         A     RF,=F'100'          ESTABLISH A(CONTRACT SPECIFIC INFO)          
         ST    RF,ACONSPEC                                                      
         A     RF,=F'100'          ESTABLISH A(TSAR DSECT WORK AREA)            
         ST    RF,ATSARDWA                                                      
         A     RF,=F'200'          ESTABLISH A(COMFACS BLOCK)                   
         ST    RF,ACOMFACT                                                      
         USING COMFACSD,RF                                                      
*                                  INITIALIZE LOCAL COMFACS BLOCK               
         MVC   CDATAMGR,DATAMGR    LOAD A(DATAMANAGER)                          
         L     RE,=V(CALLOFF)      LOAD A(CALL OVERLAY)                         
         ST    RE,FULL                                                          
         MVC   CCALLOV,FULL                                                     
         L     RE,=V(LOCKSPC)                                                   
         STCM  RE,15,CLOCKSPC                                                   
         L     RE,=V(DYNALLOC)     SAVE A(DYNALLOC ENTRY POINT)                 
         STCM  RE,15,ADYNALOC                                                   
         L     RE,=V(MASTC)                                                     
         STCM  RE,15,CMASTC                                                     
*                                                                               
*   CODE TO ASSIGN USERID                                                       
*                                                                               
         LA    RE,WORKD                                                         
         AH    RE,=Y(AXTRINFO-WORKD)                                            
         L     R1,0(RE)            LOAD A(XTRAINFO BLOCK)                       
         USING XTRAINFO,R1                                                      
*                                                                               
         XC    XTRAINFO,XTRAINFO   BUILD EXTRA INFO (CTRY, LANG ETC.)           
*&&DO                                                                           
         MVC   XIAGCOPT,MCAGCOPT   DON'T NEED ALL THESE FIELDS                  
         MVC   XIAGCTRY,MCAGCTRY                                                
         MVC   XICTRY,MCCTRY                                                    
         MVC   XILANG,MCLANG                                                    
         MVC   XIAGCURR,MCAGCURR                                                
*&&                                                                             
         L     RE,=V(MASTC)                                                     
         USING MASTD,RE                                                         
*                                                                               
         MVC   XIUSER,MCORIGID      NEED USER ID                                
*                                                                               
         DROP  R1,RE                                                            
*                                                                               
                                                                                
         LA    RE,CXTRAINF-COMFACSD(RF)                                         
*                                  A(XTRAINFO BLOCK IN COMFACS)                 
         ST    R1,0(RE)            SAVE A(XTRAINFO BLOCK) IN COMFACS            
*                                                                               
*   TEST                                                                        
***      L     RF,ACOMFACT         SET A(COMFACS)                               
***      DC    H'0'                                                             
*   TEST END                                                                    
*                                                                               
*                                                                               
         LA    RE,CCFACLEN-CDATAMGR SET LENGTH OF COMFACS BLOCK                 
         AR    RF,RE               ESTABLISH A(BUYER NAME STORAGE)              
         ST    RF,ABUYNAMS                                                      
*                                  REMAINDER OF SPACE IS FOR BUYNAMS            
         L     R0,=A(LENBUFF)      INSERT SIZE OF BUFFER WANTED                 
         GETMAIN RU,LV=(0),LOC=(ANY,ANY)                                        
*                                  ACQUIRE AOVE THE LINE BUFFER                 
         LTR   RF,RF               STORAGE ACQUIRED?                            
         BZ    *+6                 YES                                          
         DC    H'0'                NO  - ABORT                                  
         ST    R1,AAGGREG          YES - SAVE A(BUFFER) FOR AGGREG              
         L     R0,=A(LENAGG)       TOTAL SPACE FOR AGGREG TABLE                 
         AR    R1,R0                                                            
         ST    R1,AAGGSPL          SAVE A(BUFFER) FOR SPL                       
*                                                                               
         MVI   BYTE,QTSAROFF                                                    
         BAS   RE,LOADIT                                                        
         MVC   ATSAROFF,DMCB+4     SAVE A(TSAROFF)                              
*                                                                               
         MVI   BYTE,QDEMOCON                                                    
         BAS   RE,LOADIT                                                        
         MVC   ADEMOCON,DMCB+4     SAVE A(DEMOCON)                              
*                                                                               
         USING COMFACSD,RF                                                      
         L     RF,ACOMFACT                                                      
         L     R1,ADCONLST                                                      
         L     R1,VCOMFACS-ADCONSD(,R1)                                         
VCOMFAC  USING COMFACSD,R1                                                      
*                                                                               
         MVI   BYTE,QDEMADDR                                                    
         BAS   RE,LOADIT                                                        
         MVC   CDEMADDR,DMCB+4                                                  
         MVC   VCOMFAC.CDEMADDR,DMCB+4                                          
*                                                                               
         MVI   BYTE,QDEMAINT                                                    
         BAS   RE,LOADIT                                                        
         MVC   CDEMAINT,DMCB+4                                                  
         MVC   VCOMFAC.CDEMAINT,DMCB+4                                          
*                                                                               
         MVI   BYTE,QDEMOVAL                                                    
         BAS   RE,LOADIT                                                        
         MVC   CDEMOVAL,DMCB+4                                                  
         MVC   VCOMFAC.CDEMOVAL,DMCB+4                                          
*                                                                               
         MVI   BYTE,QDEMEL                                                      
         BAS   RE,LOADIT                                                        
         MVC   CDEMEL,DMCB+4                                                    
         MVC   VCOMFAC.CDEMEL,DMCB+4                                            
*                                                                               
         MVI   BYTE,QDEMOMTH                                                    
         BAS   RE,LOADIT                                                        
         MVC   CDEMOMTH,DMCB+4                                                  
         MVC   VCOMFAC.CDEMOMTH,DMCB+4                                          
*                                                                               
         MVI   BYTE,QDEMOUT                                                     
         BAS   RE,LOADIT                                                        
         MVC   CDEMOUT,DMCB+4                                                   
         MVC   VCOMFAC.CDEMOUT,DMCB+4                                           
*                                                                               
         MVI   BYTE,QDEMTABS                                                    
         BAS   RE,LOADIT                                                        
         MVC   CDEMTABS,DMCB+4                                                  
         MVC   VCOMFAC.CDEMTABS,DMCB+4                                          
*                                                                               
         MVI   BYTE,QDEMTBOF                                                    
         BAS   RE,LOADIT                                                        
         MVC   CDEMTBOF,DMCB+4                                                  
         MVC   VCOMFAC.CDEMTBOF,DMCB+4                                          
         DROP  VCOMFAC                                                          
*                                                                               
         DROP  RF                                                               
*                                                                               
         L     R1,ATSARDWA         LOAD A(TSAR DSECT WORK AREAS)                
         USING TSARD,R1                                                         
         LA    R3,2                SET LOOP CONTROL                             
DOCV0080 EQU   *                                                                
         XC    TSARD(TSARDL),TSARD CLEAR TSAR BLOCK                             
         L     RF,ADCONLST                                                      
         USING ADCONSD,RF                                                       
         MVC   TSACOM,ACOMFACT     A(COMFACS SET UP FOR TSAR)                   
         DROP  RF                                                               
*                                                                               
         MVC   TSABUF,AAGGSPL      SET A(SPL BUFFER)                            
         MVC   TSAREC,=A(LENSPL)   SET L(SPL BUFFER)                            
         CH    R3,=H'2'            FIRST PASS?                                  
         BE    DOCV0100            YES - LEAVE A(SPL BUFFER)                    
         MVC   TSABUF,AAGGREG      NO  - SET A(AGGREG BUFFER)                   
         MVC   TSAREC,=A(LENAGG)   SET L(AGG BUFFER)                            
DOCV0100 EQU   *                                                                
         LA    R0,RRGKYLEN         SET KEY LENGTH                               
         STC   R0,TSKEYL                                                        
         LA    R0,RRGRECSZ         SET RECORD SIZE                              
         STH   R0,TSRECL                                                        
         MVI   TSOFFACT,TSAINI     INITIALIZE BUFFER                            
         GOTO1 ATSAROFF                                                         
         LA    R1,TSARDL+2(R1)     BUMP TO NEXT BUFFER AREA                     
*                                     KEEP ADDR ON FULL-WORD                    
         BCT   R3,DOCV0080         GO BACK FOR NEXT BUFFER                      
*                                                                               
         L     R1,DUB              RESET R1 AFTER ADDRESS SETUP                 
         MVC   0(4,R1),DUB+4       RESET VALUE AT R1                            
*                                                                               
         XIT1                                                                   
         DROP  R1                                                               
         SPACE 2                                                                
LOADIT   NTR1                                                                   
*                                                                               
         L     R2,=V(MASTC)                                                     
         USING MASTD,R2                                                         
         MVC   MCDUB,SPACES                                                     
         MVC   MCDUB(4),=C'T00A'                                                
         GOTO1 HEXOUT,DMCB,BYTE,MCDUB+4,1,0                                     
         GOTO1 MCVLOADM,DMCB,0                                                  
         DROP  R2                                                               
*                                                                               
         B     XIT                                                              
         SPACE 2                                                                
*  INCLUDE REREPTSAR:  EQUATES FOR USE OF TSAR                                  
*                                                                               
       ++INCLUDE REREPTSAR                                                      
         EJECT                                                                  
*                                                                               
DOWNOVER EQU   *                                                                
*                                                                               
*                                                                               
         OC    0(4,R1),0(R1)       P1 = 0 FOR INITIALIZATION/                   
         BNZ   CTRLSTEP            RETURN OF REP RECORD                         
*                                                                               
*   FOLLOWING ROUTINE IS THE INITIALIZATION FOR MASTER/SUBSIDIARY               
*     REP TABLE, AND ESTABLISHES REP RECORD FOR MASTER REP.                     
*                                                                               
         L     R1,=V(MASTC)                                                     
         USING MASTD,R1                                                         
         LA    RE,ENDREQ                                                        
         STM   R0,RF,MCREQLST                                                   
         LA    RE,FINAL                                                         
         STM   R0,RF,MCRUNLST                                                   
         DROP  R1                                                               
*                                                                               
         GOTO1 =A(SETMASTR),DMCB,(RC),RR=RELO                                   
*                                  SET UP MASTER/SUBSIDIARY                     
         BNZ   ENDREQ              NZ = END OF REQUEST                          
         B     XIT                 =Z = EXIT                                    
         EJECT                                                                  
* INITIALIZATION, REQUEST READ AND FINALIZATION                                 
         SPACE 3                                                                
CTRLSTEP EQU   *                                                                
         MVI   MODE,RUNFRST        FIRST TIME HOOK                              
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
READREQ  CP    RCRQTOT,RCENNUM                                                  
         BNL   EOF                                                              
         SPACE 2                                                                
READCARD GOTO1 =V(REQSTART)                                                     
         L     R2,=V(MASTC)                                                     
         USING MASTD,R2                                                         
         MVC   QPROG(80),MCREQREC                                               
         L     R3,=V(REPSREP)                                                   
         USING RSREPD,R3                                                        
*                                                                               
***      MVC   P+1(14),=C'REQUEST CARDS:'                                       
***      GOTO1 REPORT                                                           
***      LA    RF,MCIO             A(REQUEST CARD AT THIS TIME)                 
****     MVC   P+1(80),0(RF)                                                    
***      GOTO1 REPORT                                                           
***      LA    RF,MCIO             A(REQUEST CARD)                              
***      MVC   P+1(80),80(RF)                                                   
***      GOTO1 REPORT                                                           
*                                                                               
         CLI   MASTREP,0          ARE WE MASTER REP?                            
         BE    RDCD0012           NO                                            
*                                                                               
         LA    RF,MCIO             A(REQUEST CARD)                              
         CLI   RRGFLAG(RF),C'Y'    RRG REQUEST?                                 
         BE    RDCD0002            YES - DON'T RESET LOOP CONTROL               
*                                                                               
*                                  NO  - SET FIRST ENTRY IN TABLE AS            
*                                     NEXT REP IN PROGRESS                      
*                                                                               
         LA    RF,SUBREPTB         RESET A(BEGINNING OF TABLE)                  
         MVC   RCREPFL,0(RF)       MOVE IN FIRST REP                            
         MVI   MASTREP,1           SET MASTER REP                               
         LA    RF,LSUBREP(RF)                                                   
         ST    RF,ASUBREPT         ADDRESS OF NEXT REP IN TABLE                 
*                                  RETRIEVE REP RECORD OF 1ST REP               
         XC    RREPKEY,RREPKEY                                                  
         MVI   RREPKTYP,X'01'                                                   
         MVC   RREPKREP,RCREPFL                                                 
         MVC   KEY,RREPKEY                                                      
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,REPEQU                                          
         BNZ   ENDREQ                                                           
*                                                                               
*                                                                               
RDCD0002 EQU   *                                                                
*                                                                               
*  72, 73, 74, 76, 78 90 REPS RESET THE 'MASTER' FLAG EVEN IF THEY ARE          
*      FOR A 'MASTER' REP.  ALSO, THE STORED REP RECORD MUST BE                 
*      SET FROM THE 1ST SUBSIDIARY REP BACK TO THE ORIGINAL MASTER              
*      REP.                                                                     
*                                                                               
         CLC   QPROG(2),=C'1S'     STATION/BILLING DATE REPORT?                 
         BE    RDCD0004            YES - RESET REP TO ORIG MASTER               
         CLC   QPROG(2),=C'72'     AGENCY LISTING REPORT?                       
         BE    RDCD0004            YES - RESET REP TO ORIG MASTER               
         CLC   QPROG(2),=C'73'     STATION LISTING REPORT?                      
         BE    RDCD0004            YES - RESET REP TO ORIG MASTER               
         CLC   QPROG(2),=C'74'     ADVERTISER LISTING REPORT?                   
         BE    RDCD0004            YES - RESET REP TO ORIG MASTER               
         CLC   QPROG(2),=C'78'     SALESPERSON LISTING REPORT?                  
         BE    RDCD0004            YES - RESET REP TO ORIG MASTER               
         CLC   QPROG(2),=C'90'     ADVERTISER/STATION REPORT?                   
         BE    RDCD0004            YES - RESET REP TO ORIG MASTER               
         CLC   QPROG(2),=C'TS'     REP TO SPOT ERROR SCAN REPORT?               
         BE    RDCD0004            YES - RESET REP TO ORIG MASTER               
         CLC   QPROG(2),=C'XA'     REP TO SPOT AUDIT REPORT?                    
         BE    RDCD0004            YES - RESET REP TO ORIG MASTER               
         CLC   QPROG(2),=C'DP'     DARE PURGE REPORT?                           
         BE    RDCD0004            YES - RESET REP TO ORIG MASTER               
         CLC   QPROG(2),=C'76'     PRODUCT LISTING REPORT?                      
         BNE   RDCD0008            NO  - PROCESS MASTER/SUBSIDIARY              
RDCD0004 EQU   *                                                                
         MVI   MASTREP,0           TURN OFF MASTER REP FLAG                     
         MVC   RCREPFL,MASTRREP    RESTORE REQUEST REP ID                       
         XC    RREPKEY,RREPKEY                                                  
         MVI   RREPKTYP,X'01'                                                   
         MVC   RREPKREP,RCREPFL                                                 
         MVC   KEY,RREPKEY                                                      
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,REPEQU                                          
         BNZ   ENDREQ                                                           
*                                                                               
*   TEST DUMP                                                                   
*        DC    H'0'                                                             
*   TEST DUMP END                                                               
*                                                                               
RDCD0008 EQU   *                                                                
*                                                                               
         MVC   QREP,RCREPFL       MOVE IN CURRENT REP SLAVE                     
RDCD0012 EQU   *                                                                
         CLC   QPROG(2),=C'/*'                                                  
         BE    FINAL                                                            
*                                                                               
*- FILL IN NUMBER OF REQUEST CARDS AND ACTUAL CARD VALUES.                      
         L     RF,=V(RQSTNUM)                                                   
         MVC   0(1,RF),MCRQNUM     # OF CARDS                                   
*                                                                               
         L     RE,=V(RQSTCARD)                                                  
         LA    RF,1000             LENGTH OF AREA TO CLEAR                      
         LA    R4,FULL             DUMMY ADDRESS FOR FORM SAKE                  
         L     R5,=X'40000000'     SET PAD CHARACTER = ' ' (SPACE)              
         MVCL  RE,R4               SPACE-FILL REQUEST CARD AREA                 
         L     RE,=V(RQSTCARD)                                                  
         LA    RF,MCIO             CARDS HERE FROM DDMASTER                     
         ZIC   R0,MCRQNUM                                                       
RDCD0016 MVC   0(80,RE),0(RF)      CARD TO SAVE AREA                            
         LA    RE,80(RE)                                                        
         LA    RF,80(RF)                                                        
         BCT   R0,RDCD0016                                                      
*                                                                               
*                                                                               
*   FOLLOWING TEST, BASED ON A SPECIAL REQUESTOR NAME, WILL OVERRIDE            
*    THE NUMBER OF REPS PLACED IN THE FINAL SUBSIDIARY REP TABLE.               
*    THIS WILL LIMIT THE AMOUNT OF PROCESSING REQUIRED DURING TESTING.          
*    THE COUNT IS A SINGLE EBCDIC CHARACTER PLACED AFTER THE NAME.              
*    WHETHER THIS IS A MASTER/SUBSIDIARY OR NOT IS UP TO THE TESTOR.            
*                                                                               
RDCD0018 EQU   *                                                                
         CLC   QUESTOR(7),=C'$#REPS='   REP COUNT OVERRIDE FOR TEST?            
         BNE   RDCD0020            NO  - IGNORE                                 
         ZIC   R5,QUESTOR+7        TAKE COUNT FROM REQUEST FIELD                
         SLL   R5,28               DROP ZONE BITS                               
         SRL   R5,28                                                            
         LA    RE,LSUBREP          USE EQUATE VALUE FOR OFFSET CALC             
         STH   RE,HALF                                                          
         MH    R5,HALF             OFFSET TO COUNT+1 (NOT 0-RELATIVE)           
         LA    R1,SUBREPTB         A(SUBSIDIARY REP TABLE)                      
         AR    R1,R5               ADD OFFSET                                   
         MVC   0(2,R1),=X'FFFF'    SET 'TEST' TERMINATOR                        
RDCD0020 EQU   *                                                                
         CLI   SPACFLG2,C'N'       FIRST-TIME THROUGH?                          
         BE    RDCD0024            NO                                           
         BAS   RE,CHECKRRG         YES -                                        
         MVI   SPACFLG2,C'N'       TURN OFF 'FIRST-TIME THROUGH'                
RDCD0024 EQU   *                                                                
*                                                                               
*   TEST RDCD0024                                                               
***      MVC   P+1(08),=C'RDCD0024'                                             
***      MVC   P+10(1),MASTREP                                                  
***      MVC   P+12(2),RCREPFL                                                  
***      GOTO1 REPORT                                                           
*   TEST RDCD0024 END                                                           
*                                                                               
         CLI   MASTREP,0           MASTER REP?                                  
         BE    RDCD0040            NO  - NO SUBSID DROPS NEEDED                 
         CLC   =C'IR',RCREPFL      INTEREP?                                     
         BNE   RDCD0028            NO  - CHECK KATZ                             
         MVC   DMCB(2),=C'R6'      SET RUN ID:  ALLOW R6 JOBS                   
         MVC   DMCB+2(2),=C'I2'    SET 'NONREP (I2)'                            
         BAS   RE,CHKDROP          DELETE NONREP/I2/INTEREP                     
         MVC   DMCB(2),=C'R6'      SET RUN ID:  ALLOW R6 JOBS                   
         MVC   DMCB+2(2),=C'RM'    SET 'RADIO MARKETING (RM)'                   
****>>>  MVC   DMCB+2(2),=C'I8'    SET 'CABALLERO (I8)'                         
         BAS   RE,CHKDROP          DELETE CABALLERO/I8/INTEREP                  
         MVC   DMCB(2),=C'  '      SET RUN ID:  REMOVE FOR ALL REPS             
         MVC   DMCB+2(2),=C'DI'    SET 'DURPETTI  (DI)'                         
         BAS   RE,CHKDROP          DELETE DURPETTI/DI/INTEREP                   
         MVC   DMCB(2),=C'  '      SET RUN ID:  REMOVE FOR ALL REPS             
         MVC   DMCB+2(2),=C'HN'    SET 'D&R RADIO (HN)'                         
         BAS   RE,CHKDROP          DELETE D&R RADIO/HN/INTEREP                  
         B     RDCD0040                                                         
RDCD0028 EQU   *                                                                
         CLC   =C'K3',RCREPFL      KATZ RADIO GROUP?                            
         BNE   RDCD0040            NO  -                                        
         MVC   DMCB(2),=C'R6'      SET RUN ID:  ALLOW R6 JOBS                   
         MVC   DMCB+2(2),=C'K6'    SET 'NON (K6)'                               
         BAS   RE,CHKDROP          DELETE NON/K6/KATZ                           
*                                                                               
*   SET SPACEND AFTER FIRST REQUEST CARDS ARE READ TO DETERMINE                 
*        WHETHER RUN IS RRG OR NON-RRG                                          
*                                                                               
RDCD0040 EQU   *                                                                
         L     RF,ASPACND4         A(1ST ENTRY IN SPACEND)                      
         OC    0(4,RF),0(RF)       ANYTHING THERE?                              
         BNZ   REQCON              YES - DON'T RESET                            
         CLC   QPROG(2),=C'7C'      7C DOES NOT NEED SPACEND                    
         BE    REQCON                ** HOOK FOR BY-PASSING BUILD **            
         GOTO1 =V(REPFINT),DMCB,0   INITIALIZE SPACEND FOR REP                  
         BNZ   ENDREQ                                                           
*                                                                               
*                                                                               
*   TEST SPACND4                                                                
*        L     R1,ASPACND4                                                      
*        MVC   P+1(08),=C'SPCND1: '                                             
*        MVC   P+10(64),0(R1)                                                   
*        GOTO1 REPORT                                                           
*        MVC   P+1(08),=C'SPCND2: '                                             
*        MVC   P+10(64),64(R1)                                                  
*        GOTO1 REPORT                                                           
*        MVC   P+1(08),=C'SPCND3: '                                             
*        MVC   P+10(64),128(R1)                                                 
*        GOTO1 REPORT                                                           
*        MVC   P+1(08),=C'SPCND4: '                                             
*        MVC   P+10(64),192(R1)                                                 
*        GOTO1 REPORT                                                           
*        MVC   P+1(08),=C'SPCND5: '                                             
*        MVC   P+10(64),256(R1)                                                 
*        GOTO1 REPORT                                                           
*   TEST SPACND4 END                                                            
*                                                                               
         L     RF,ASPACEND         RESET REM SPACE VALUE                        
         MVC   0(4,RF),SVREMSPC    INSERT TOTAL AMOUNT FOR                      
*                                     POSSIBLE RELOAD OF TABLE                  
         CLI   SAVEMODE,X'FC'      MULTIFILE LOOP - PRE-REPORT?                 
         BE    RQCN0240            YES - SKIP REQUEST SETUP                     
         CLI   SAVEMODE,X'FD'      MULTIFILE LOOP?                              
         BE    RQCN0240            YES - SKIP REQUEST SETUP                     
         B     REQCON                                                           
*                                                                               
EOF      DS    0H                                                               
*                                                                               
FINAL    DS    0H                                                               
         MVI   MODE,RUNLAST        LAST TIME HOOK                               
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         BRAS  RE,MDETACH          DETACH FROM PRTQ SHARED MEMORY               
*                                                                               
         PRINT GEN                                                              
FCEXT    XMOD1 1                                                                
         PRINT NOGEN                                                            
         EJECT                                                                  
*                                                                               
*   CHKDROP  PERFORMS THIS FUNCTION:                                            
*       REP = MASTER                                                            
*          REP = IR OR K3 (INTEREP OR KATZ RADIO GROUP)                         
*             IF RRG REQUEST NOT = DMCB (2 POS)                                 
*                DROP REP IN DMCB+2 (2 POS) FROM SUBSIDIARY REPS                
*                                                                               
*   R3 IS SET TO COVER RSREPD FOR THIS ROUTINE                                  
*                                                                               
*   THIS IS A HARD-CODED ROUTINE TO SOLVE A SITUATIONAL PROBLEM                 
*   PRESENTED BY INTEREP.   BUHR/FEB21,91                                       
*                                                                               
CHKDROP  NTR1                                                                   
*                                                                               
         L     RE,=V(RQSTCARD)     CHECK REQUEST FOR R6                         
         CLC   DMCB(2),0(RE)       RUN IDS MATCH?                               
         BE    CNR099              YES - FINISHED - NO DROPS                    
*                                                                               
         LA    R1,SUBREPTB         A(SUB REP TABLE)                             
CNR010   EQU   *                                                                
         CLC   =X'FFFF',0(R1)      END OF TABLE?                                
         BE    CNR099              YES - NOTHING FOUND                          
         CLC   DMCB+2(2),0(R1)     REP TO BE DROPPED?                           
         BE    CNR015              YES                                          
         LA    R1,LSUBREP(R1)      NO  - BUMP TO NEXT                           
         B     CNR010              GO BACK                                      
CNR015   EQU   *                                                                
         LA    R2,LSUBREP(R1)      SET A(FOLLOWING ENTRY)                       
CNR020   EQU   *                                                                
         MVC   0(LSUBREP,R1),0(R2) MOVE 2ND ENTRY TO 1ST                        
         CLC   =X'FFFF',0(R1)      1ST NOW END OF TABLE?                        
         BE    CNR099              YES - FINISHED                               
         LA    R1,LSUBREP(R1)      INCREMENT A(1ST ENTRY)                       
         LA    R2,LSUBREP(R2)      INCREMENT A(2ND ENTRY)                       
         B     CNR020                                                           
*                                                                               
CNR099   EQU   *                                                                
         B     XIT                                                              
*                                                                               
         EJECT                                                                  
*                                                                               
*   THIS ROUTINE EXITS IF NOT A MASTER REP, OR IF RUN IS AN RRG JOB.            
*      IF MASTER REP, AND NOT RRG, THE REP RECORD FOR THE FIRST                 
*      ENTRY IN THE MASTER/SUBSIDIARY LIST IS RETURNED.                         
*                                                                               
CHECKRRG NTR1                                                                   
         CLI   MASTREP,0           MASTER REP?                                  
         BE    XIT                 NO  - LEAVE SETUP AS IS                      
*                                                                               
         L     RF,=V(RQSTCARD)     A(REQUEST CARD)                              
         CLI   RRGFLAG(RF),C'Y'    RRG REQUEST?                                 
         BE    XIT                 YES - LEAVE SETUP AS IS                      
*                                                                               
         LA    R2,SUBREPTB         POINT TO BEGINNING OF TABLE                  
         MVC   RCREPFL,0(R2)       SET FIRST REP TO BE PROCESSED                
         MVC   QREP,0(R2)                                                       
*                                                                               
*    READ REP RECORD FOR NEW 1ST REP                                            
*                                                                               
         XC    RREPKEY,RREPKEY                                                  
         MVI   RREPKTYP,X'01'                                                   
         MVC   RREPKREP,RCREPFL                                                 
         MVC   KEY,RREPKEY                                                      
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   CRRGDUMP                                                         
         GOTO1 =V(REPFINT),DMCB,REPEQU                                          
         BNZ   CRRGDUMP                                                         
         B     XIT                                                              
CRRGDUMP DC    H'0'                                                             
         EJECT                                                                  
*                   FILTERING AND EDITING REQUESTS                              
         SPACE 3                                                                
REQCON   EQU   *                                                                
         CLC   =C'PATCH=',QRECORD                                               
         BNE   RQCN0020                                                         
         GOTO1 =V(REPFINT),DMCB,PATCHEQU                                        
         CLI   DMCB,0                                                           
         BE    READREQ                                                          
         B     FINAL                                                            
         SPACE 2                                                                
RQCN0020 CLC   QPROG,RCRQFILT      FILTER ON PROGRAM            HK 7507         
         BNE   READREQ                                                          
         CLI   RCFILTER,C'Y'       SPEC OPTION NOT TO FILTER                    
         BNE   RQCN0040                                                         
         CLC   QREP,RCREPFL                                                     
         BNE   READREQ                                                          
         SPACE 2                                                                
RQCN0040 AP    RCRQTOT,=P'1'                                                    
         CLC   QPROG,=C'86'                                                     
         BNE   *+8                                                              
         MVI   RCREQREP,C'N'       NO EDIT REQUEST REPORT FOR REQ 86            
         CLI   QPROG,C'R'          TEST FOR RRG                                 
         BNE   RQCN0060                                                         
         CLI   MCRUNMOD,C'S'       YES - TEST FOR SINGLE RUN MODE               
         BNE   RQCN0060                                                         
         MVI   RCREQREP,C'Y'       YES - PRINT EDIT REQUEST REPORT              
         SPACE                                                                  
RQCN0060 EQU   *                                                                
         CLI   MODE,X'FC'          MULTI-FILE LOOP - PRE-REPORT?                
         BE    RQCN0080            YES - SKIP REQREP OUTPUT                     
*                                                                               
         CLI   MODE,X'FD'          MULTI-FILE LOOP?                             
         BE    RQCN0080            YES - SKIP REQREP OUTPUT                     
*                                                                               
         CLI   FRSTMREP,1          SUBSIDIARY REP IN PROCESS?                   
         BE    RQCN0080            YES - SKIP REQREP OUTPUT                     
*                                                                               
         GOTO1 REQREP,DMCB                                                      
         OC    DMCB(4),DMCB                                                     
         BZ    RQCN0080                                                         
         AP    RCRQERR,=P'1'                                                    
         B     READREQ                                                          
*                                                                               
         DROP  R2                                                               
*                                                                               
RQCN0080 AP    RCRQVAL,=P'1'                                                    
*                                                                               
*&&DO*&& GETIME TU                                                              
*&&OS                                                                           
*                                                                               
         TIME                                                                   
         SRL   R0,4                                                             
         LR    R1,R0                                                            
*&&                                                                             
*                                                                               
         ST    R1,REQSTART                                                      
RQCN0100 EQU   *                                                                
         CLI   SAVEMODE,X'FC'      MULTIFILE LOOP - PRE-REPORT?                 
         BE    RQCN0240            YES - SKIP TO PROCESS RRG RUN                
         CLI   SAVEMODE,X'FD'      MULTIFILE LOOP?                              
         BE    RQCN0240            YES - SKIP TO PROCESS RRG RUN                
         LA    RE,RCLIST                                                        
RQCN0120 EQU   *                                                                
         CLI   0(RE),0                                                          
         BE    RQCN0140                                                         
         CLC   QPROG(2),0(RE)                                                   
         BE    RQCN0160                                                         
         LA    RE,2(RE)                                                         
         B     RQCN0120                                                         
RQCN0140 EQU   *                                                                
         CLI   FRSTMREP,0         CALL APPL WITH REQFRST ONLY ONCE              
         BNE   RQCN0320           FOR EACH CARD (MASTER OR NOT)                 
*                                                                               
*   FOLLOWING SETUP FOR SPECIAL 15/38 NON-RRG/RRG REPORT IS SKIPPED.            
*                                                                               
*        CLC   QPROG,=C'15'       15 REPORT?                                    
*        BNE   RQCN0160           NO                                            
*        CLC   QRGPROG,=C'38'     YES - 38 REPORT JOBSTEP?                      
*        BE    RQCN0160           YES - NO SETUPMON FOR RRG PORTION             
*        GOTO1 =A(SETUPMON),DMCB,(RC),RR=RELO  BEFORE REQ 1ST CALL              
*        CLC   =C'NO EOM',QUESTOR  'SKIP REPORT' RETURN?                        
*        BE    ENDREQ              YES - SKIP THE REQUEST                       
*        CLC   =C'DUMPMONFOR',QUESTOR          SPECIAL REQUEST?                 
*        BE    ENDREQ              YES - END JOB                                
RQCN0160 EQU   *                                                                
         L     RF,=V(RQSTCARD)     A(CARD INPUT)                                
         ST    RF,AREQCRDS         SAVE A(REQUEST CARDS)                        
         MVI   RCSPACE,1           SET THIS FOR 1 CARD REQ'S                    
         L     RF,=V(RQSTNUM)      CHECK NUMBER OF CARDS IN REQUEST             
         CLI   0(RF),1             SINGLE CARD?                                 
         BE    RQCN0240                                                         
*                                                                               
RRGFLAG  EQU   80+Q2XSPCE-QREC2    DISPLACE TO RRG FLAG                         
DISPSPAC EQU   80+Q2SPACE-QREC2    DISPLACE TO OPTL SPACING FIELD               
ALLSPACE EQU   79                  CARD 2: COLS 2-80                            
*                                                                               
*   IF REQUEST IS FOR RRG, DON'T PROCESS SECOND CARD HERE!                      
*                                                                               
*   IN A TWO-CARD REQUEST, CARD 2 MAY HAVE ONLY THE OPTIONAL SPACING            
*      VALUE ON IT.  IF SO, THE 2 CARD SETUP IS TO BE REDUCED TO A              
*      SINGLE CARD, BY OVERRIDING THE '+' IN COL 80 OF CARD 1 WITH              
*      THE VALUE IN COL 1 OF CARD 2.                                            
         L     RF,=V(RQSTCARD)     A(CARD INPUT)                                
         CLI   RRGFLAG(RF),C'Y'          RRG REQUEST?                           
         BE    RQCN0240                  YES - DON'T PROCESS HERE               
         NI    DISPSPAC(RF),X'0F'        TURN OFF ZONE BITS                     
         OC    DISPSPAC(1,RF),DISPSPAC(RF)     WAS SPACING ENTERED?             
         BNZ   RQCN0180                  YES                                    
         MVI   DISPSPAC(RF),1            NO  - SET SPACING TO 1                 
RQCN0180 EQU   *                                                                
         MVC   RCSPACE,DISPSPAC(RF)      MOVE BINARY VALUE TO STORE             
         CLI   RCSPACE,1                                                        
         BL    RQCN0200                                                         
         CLI   RCSPACE,3                                                        
         BNH   RQCN0220                                                         
RQCN0200 EQU   *                                                                
         MVI   RCSPACE,1                                                        
RQCN0220 EQU   *                                                                
         MVI   DISPSPAC(RF),C' '         SPACE OUT FIELD                        
         CLC   81(ALLSPACE,RF),SPACES    CARD 2 NOW ALL SPACES?                 
         BNE   RQCN0240                  NO                                     
         MVC   79(1,RF),80(RF)           YES - MOVE 1ST POS/CARD2               
         XC    80(1,RF),80(RF)           TO LAST POS/CARD 1                     
RQCN0240 EQU   *                                                                
         MVI   MODE,REQFRST                                                     
         CLI   SAVEMODE,X'FC'      MULTIFILE LOOP - PRE-REPORT?                 
         BE    RQCN0260            NO                                           
         CLI   SAVEMODE,X'FD'      MULTIFILE LOOP?                              
         BNE   RQCN0280            NO                                           
RQCN0260 EQU   *                                                                
         MVC   MODE,SAVEMODE       YES - SET TO MULTILOOP                       
RQCN0280 EQU   *                                                                
*                                                                               
*   TEST                                                                        
***      MVC   P+1(14),=C'QUESTOR CARDS1'                                       
***      MVC   P+18(1),DAILYFLG                                                 
***      MVC   P+20(80),QPROG                                                   
***      GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         MVC   SAVASAT,QASAT                                                    
         CLC   QASAT,SPACES                                                     
         BH    RQCN0290                                                         
         CLI   DAILYFLG,C'Y'       DAILY PACING?                                
         BNE   RQCN0290            NO                                           
         GOTO1 DATCON,DMCB,(5,WORK),(0,SAVASAT)                                 
*                                  YES - DON'T REVERT TODAY TO MONDAY           
*   TEST                                                                        
***      MVC   P+1(14),=C'SAVASAT       '                                       
***      MVC   P+20(06),SAVASAT                                                 
***      GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         B     RQCN0290                                                         
SAVASAT  DS    CL6                                                              
RQCN0290 EQU   *                                                                
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLI   DAILYFLG,C'Y'       DAILY PACING?                                
         BNE   RQCN0295            NO                                           
         GOTO1 DATCON,DMCB,(0,SAVASAT),(0,QASAT)                                
*                                  YES - REINSERT ORIGINAL AS AT DATE           
RQCN0295 EQU   *                                                                
*                                                                               
*   TEST                                                                        
***      MVC   P+1(14),=C'QUESTOR CARDS2'                                       
***      MVC   P+20(80),QPROG                                                   
***      GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         CLI   MODE,X'FF'          RRG RETURN                                   
         BE    FINAL                                                            
         CLI   MODE,X'FC'          RRG RETURN - NEXT MULTIFILE -                
*                                     PRE-REPORT?                               
         BE    RQCN0300            YES                                          
         CLI   MODE,X'FD'          RRG RETURN - NEXT MULTIFILE?                 
         BNE   RQCN0320            NO                                           
*                                                                               
RQCN0300 EQU   *                                                                
         MVC   SAVEMODE,MODE       SAVE MODE TO SERVE AS FLAG                   
         GOTO1 =A(SETMASTR),DMCB,(RC),RR=RELO                                   
*                                  SET UP MASTER/SUBSIDIARY                     
         BNZ   ENDREQ              NZ = END OF REQUEST                          
*                                                                               
         L     RF,ASPACND4         A(1ST ENTRY IN SPACEND)                      
         XC    0(4,RF),0(RF)       SET TO CLEAR SPACEND                         
**       MVC   P+1(09),=C'SETMASTER'                                            
**       GOTO1 REPORT                                                           
         B     RDCD0018            =Z = GO BACK/RESET SPACEND                   
*                                                                               
SAVEMODE DS    CL1                                                              
         DS    0H                  RESET ALIGNMENT                              
*                                                                               
RQCN0320 EQU   *                                                                
         MVI   MODE,REPFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLI   FRSTMREP,0                                                       
         BNE   RQCN0340            SET UP FOR 15 -WASN'T DONE                   
*                                                                               
*   SPECIAL CODING FOR OLD BLAIR 15 REPORT IS SKIPPED.  NEW 15                  
*        HAS NO SETUPMON REQUIREMENT, SO REPORT IS ADDED TO TABLE.              
*                                                                               
*        CLC   QPROG,=C'15'        ALREADY SET UP                               
*        BE    RQCN0400                                                         
RQCN0340 EQU   *                                                                
         LA    RE,RCLIST                                                        
RQCN0360 EQU   *                                                                
         CLI   0(RE),0                                                          
         BE    RQCN0380                                                         
         CLC   QPROG(2),0(RE)                                                   
         BE    RQCN0400                                                         
         LA    RE,2(RE)                                                         
         B     RQCN0360                                                         
RQCN0380 EQU   *                                                                
*                                                                               
         GOTO1 =A(SETUPMON),DMCB,(RC),RR=RELO                                   
         CLC   =C'NO EOM',QUESTOR  'SKIP REPORT' RETURN?                        
         BE    ENDREQ              YES - SKIP THE REQUEST                       
         CLC   =C'DUMPMONFOR',QUESTOR        SPECIAL REQUEST?                   
         BE    ENDREQ              YES - END JOB                                
         B     RQCN0400                                                         
RCLIST   DC    C'151718191D70727476787B838586898A8H90TK'                        
         DC    X'00'                                                            
         DS    0H                                                               
RQCN0400 EQU   *                                                                
         EJECT                                                                  
*              ROUTINES TO HANDLE SORTED RECORD READING                         
         SPACE 3                                                                
         CLI   INFILE,C'Y'                                                      
         BNE   READCONT                                                         
         L     R2,ADIN                                                          
         L     R3,ADIO                                                          
         GET   (R2),(R3)                                                        
         SPACE 2                                                                
SORTLOOP CLC   4(3,R3),RCRQTOT     CHECK REQUEST NO IN RECORD                   
         BH    ENDREQ              AGAINST PRESENT REQUEST NO                   
         BL    SORTGET                                                          
         MVI   MODE,PROCSORT                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
SORTGET  GET   (R2),(R3)                                                        
         B     SORTLOOP                                                         
         EJECT                                                                  
*              CONTROL OF ROUTINE NEEDED                                        
         SPACE 3                                                                
READCONT DS    0H                                                               
         CLI   FCRDADV,C'Y'                                                     
         BNE   REAC0004                                                         
         CLI   QSEQ,C'A'                                                        
         BE    ALPHADV                                                          
         B     CODEADV                                                          
         SPACE 2                                                                
REAC0004 CLI   FCRDPROD,C'Y'                                                    
         BE    READPROD                                                         
         CLI   FCRDAGY,C'Y'                                                     
         BNE   REAC0008                                                         
         CLI   QSEQ,C'A'                                                        
         BE    ALPHAGY                                                          
         B     CODEAGY                                                          
         SPACE 2                                                                
REAC0008 EQU   *                                                                
         CLI   FCRDMAN,C'Y'                                                     
         BE    READMAN                                                          
         CLI   FCRDSTAT,C'Y'                                                    
         BE    READSTAT                                                         
         CLI   FCRDCONT,C'Y'                                                    
         BNE   ENDREQ                                                           
         CLI   QSEQ,C'S'                                                        
         BE    STATCONT                                                         
         CLI   QSEQ,C'M'                                                        
         BE    SALECONT                                                         
         CLI   QSEQ,C'1'                                                        
         BE    ONECONT                                                          
         CLI   QSEQ,C'L'                                                        
         BE    CCCONT                                                           
         CLI   QSEQ,C'B'                                                        
         BE    DCCONT                                                           
         CLI   QSEQ,C'E'                                                        
         BE    ECCONT                                                           
         B     OFFCONT                                                          
         EJECT                                                                  
*              READ ADVERTISERS IN ALPHA SEQUENCE                               
         SPACE 3                                                                
ALPHADV  XC    KEY,KEY                                                          
         MVI   KEY,X'88'                                                        
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
AADV0004 CLI   KEY,X'88'                                                        
         BNE   ENDREQ                                                           
         CLC   KEY+25(2),=C'ZZ'    FILTER ON REP                 MH7507         
         BNE   AADV0008                                                         
         CLI   QOPTION2,C'R'       TEST NO ZZ'S WANTED                          
         B     AADV0016            **FORCE NO ZZ'S**                            
         BE    AADV0016                                                         
         B     AADV0012                                                         
*                                                                               
AADV0008 CLC   KEY+25(2),QREP                                                   
         BNE   AADV0016                                                         
         CLI   QOPTION2,C'S'       TEST NO REP'S REC WANTED                     
         BE    AADV0016                                                         
*                                                                               
AADV0012 GOTO1 =V(REPFINT),DMCB,ADVEQU                                          
         BNZ   ENDREQ                                                           
         TM    RADVCNTL,X'80'                                                   
         BO    AADV0016                                                         
         MVI   MODE,PROCADV                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
AADV0016 EQU   *                                                                
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
         B     AADV0004                                                         
         EJECT                                                                  
*              READ ADVERTISERS IN NUMERIC SEQUENCE                             
         SPACE 3                                                                
CODEADV  XC    KEY,KEY                                                          
         MVI   KEY,X'08'                                                        
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
CADV0004 CLI   KEY,X'08'                                                        
         BNE   ENDREQ                                                           
         CLC   KEY+25(2),=C'ZZ'                                  MH7507         
         BNE   CADV0008                                                         
         CLI   QOPTION2,C'R'       ONLY WANT REP'S RECS                         
         B     CADV0016            **FORCE NO ZZ'S**                            
         BE    CADV0016                                                         
         B     CADV0012                                                         
*                                                                               
CADV0008 CLC   KEY+25(2),QREP                                                   
         BNE   CADV0016                                                         
         CLI   QOPTION2,C'S'       ONLY WANT STND RECS                          
         BE    CADV0016                                                         
*                                                                               
CADV0012 GOTO1 =V(REPFINT),DMCB,ADVEQU                                          
         BNZ   ENDREQ                                                           
         TM    RADVCNTL,X'80'                                                   
         BO    CADV0016                                                         
         MVI   MODE,PROCADV                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
CADV0016 EQU   *                                                                
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
         B     CADV0004                                                         
         EJECT                                                                  
*              READ PRODUCTS FOR ADVERTISER                                     
         SPACE 3                                                                
READPROD CLC   QADV,SPACES                                                      
         BE    ALLPRODS                                                         
         XC    KEY,KEY                                                          
         MVI   KEY,X'08'                                                        
         MVC   KEY+21(4),QADV                                    MH7507         
         MVC   KEY+25(2),QREP                                    MH7507         
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         CLC   KEYSAVE(27),KEY                                   MH7507         
         BE    REPR0004                                          MH7507         
         MVC   KEYSAVE+25(2),=C'ZZ'                              MH7507         
         CLC   KEYSAVE(27),KEY                                   MH7507         
         BE    REPR0004                                          MH7507         
         MVC   KEY,KEYSAVE                                       MH7507         
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   ENDREQ                                                           
REPR0004 GOTO1 =V(REPFINT),DMCB,ADVEQU                                          
         BNZ   ENDREQ                                                           
         XC    KEY,KEY                                                          
         MVI   KEY,X'09'                                                        
         MVC   KEY+18(4),QADV                                    MH7507         
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         MVI   MODE,ADVFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
REPR0008 CLC   KEY(22),KEYSAVE     SAVE ADV                      MH7507         
         BNE   REPR0012                                          MH7507         
         CLC   KEY+25(2),=C'ZZ'    PRINT PRD IF ZZ               MH7507         
         BE    REPR0016                                          MH7507         
         CLC   KEY+25(2),QREP       OR REQUESTING REP            MH7507         
         BNE   REPR0020            ELSE SKIP                     MH7507         
         B     REPR0016                                                         
REPR0012 DS    0H                                                MH7507         
         MVI   MODE,ADVLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         B     ENDREQ                                                           
         SPACE 2                                                                
REPR0016 GOTO1 =V(REPFINT),DMCB,PRODEQU                                         
         BNZ   ENDREQ                                                           
         TM    RPRDCNTL,X'80'                                                   
         BO    REPR0020                                                         
         MVI   MODE,PROCPROD                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
REPR0020 EQU   *                                                                
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
         B     REPR0008                                                         
         EJECT                                                                  
*              READ ALL PRODUCTS ON FILE                                        
         SPACE 3                                                                
ALLPRODS XC    KEY,KEY                                                          
         MVI   KEY,X'09'                                                        
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
ALPR0004 CLI   KEY,X'09'                                                        
         BNE   ENDREQ                                                           
         CLC   KEY+25(2),QREP       OR REQUESTING REP            MH7507         
         BE    ALPR0008                                          MH7507         
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
         B     ALPR0004                                          MH7507         
         SPACE 2                                                                
ALPR0008 CLI   FCGTADV,C'Y'        GET ADVERTISER ON CHANGE                     
         BNE   ALPR0016                                                         
         MVC   KEYWORK,KEY                                                      
         XC    KEY,KEY                                                          
         MVI   KEY,X'08'                                                        
         MVC   KEY+21(4),KEYWORK+18  ADVTSR                      MH7507         
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   ENDREQ                                                           
ALPR0012 GOTO1 =V(REPFINT),DMCB,ADVEQU                                          
         BNZ   ENDREQ                                                           
         MVC   KEY,KEYWORK         KEY FOR PRODUCT RECORD                       
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
ALPR0016 MVI   MODE,ADVFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
ALPR0020 GOTO1 =V(REPFINT),DMCB,PRODEQU                                         
         BNZ   ENDREQ                                                           
         TM    RPRDCNTL,X'80'                                                   
         BO    ALPR0024                                                         
         MVI   MODE,PROCPROD                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
ALPR0024 EQU   *                                                                
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
         CLI   KEY,X'09'           TEST EOF                                     
         BNE   ALPR0028                                                         
         CLC   KEY+25(2),QREP      TEST REQUESTING REP                          
         BNE   ALPR0024                                                         
         CLC   KEYWORK(22),KEY     TEST SAME ADV                 MH7507         
         BE    ALPR0020                                                         
ALPR0028 MVI   MODE,ADVLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLI   KEY,X'09'                                                        
         BE    ALPR0008                                                         
         B     ENDREQ                                                           
         EJECT                                                                  
*              READ AGENCIES IN ALPHA SEQUENCE                                  
         SPACE 3                                                                
ALPHAGY  XC    KEY,KEY                                                          
         MVI   KEY,X'8A'                                                        
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
AAGY0004 CLI   KEY,X'8A'                                                        
         BNE   ENDREQ                                                           
         CLC   KEY+25(2),=C'ZZ'                                  MH7507         
         BNE   AAGY0008                                                         
         CLI   QOPTION2,C'R'       TEST REP'S RECS ONLY                         
         B     AAGY0016            **FORCE NO ZZ'S**                            
         BE    AAGY0016                                                         
         B     AAGY0012                                                         
*                                                                               
AAGY0008 CLC   KEY+25(2),QREP                                                   
         BNE   AAGY0016                                                         
         CLI   QOPTION2,C'S'                                                    
         BE    AAGY0016                                                         
*                                                                               
AAGY0012 GOTO1 =V(REPFINT),DMCB,AGYEQU                                          
         BNZ   ENDREQ                                                           
         TM    RAGYCNTL,X'80'                                                   
         BO    AAGY0016                                                         
         MVI   MODE,PROCAGY                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
AAGY0016 EQU   *                                                                
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
         B     AAGY0004                                                         
         EJECT                                                                  
*              READ AGENCIES IN CODE SEQUENCE                                   
         SPACE 3                                                                
CODEAGY  XC    KEY,KEY                                                          
         MVI   KEY,X'0A'                                                        
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
CAGY0004 CLI   KEY,X'0A'                                                        
         BNE   ENDREQ                                                           
         CLC   KEY+25(2),=C'ZZ'                                  MH7507         
         BNE   CAGY0008                                                         
         CLI   QOPTION2,C'R'       REP'S ONLY                                   
         B     CAGY0016            **FORCE NO ZZ'S**                            
         BE    CAGY0016                                                         
         B     CAGY0012                                                         
*                                                                               
CAGY0008 CLC   KEY+25(2),QREP                                                   
         BNE   CAGY0016                                                         
         CLI   QOPTION2,C'S'                                                    
         BE    CAGY0016                                                         
*                                                                               
CAGY0012 GOTO1 =V(REPFINT),DMCB,AGYEQU                                          
         BNZ   ENDREQ                                                           
         TM    RAGYCNTL,X'80'                                                   
         BO    CAGY0016                                                         
         MVI   MODE,PROCAGY                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
CAGY0016 EQU   *                                                                
         MVC   KEY+25(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
         B     CAGY0004                                                         
         EJECT                                                                  
*              READ SALESMEN FOR REP                                            
         SPACE 3                                                                
READMAN  XC    KEY,KEY                                                          
         MVI   KEY,X'06'                                                        
         MVC   KEY+22(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
REMA0004 CLC   KEY(24),KEYSAVE                                                  
         BNE   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,MANEQU                                          
         BNZ   ENDREQ                                                           
         TM    RSALCNTL,X'80'                                                   
         BO    REMA0024                                                         
         L     R2,ASPACND4                                                      
         SR    R3,R3                                                            
         SPACE 2                                                                
*                                                                               
*   FIND THE DIVISION/TEAM NAME                                                 
*                                                                               
REMA0008 CLI   0(R2),0                                                          
         BE    REMA0020                                                         
         CLI   0(R2),X'05'                                                      
         BNE   REMA0012                                                         
         CLC   4(2,R2),RSALTEAM                                                 
         BE    REMA0016                                                         
         SPACE 2                                                                
REMA0012 IC    R3,1(R2)                                                         
         AR    R2,R3                                                            
         B     REMA0008                                                         
         SPACE 2                                                                
REMA0016 MVC   RTEMDVNM(20),6(R2)                                               
         SPACE 2                                                                
REMA0020 DS    0H                                                               
         MVI   MODE,PROCMAN                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
REMA0024 GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
         B     REMA0004                                                         
         EJECT                                                                  
*              READ STATIONS FOR REP                                            
         SPACE 3                                                                
READSTAT XC    KEY,KEY                                                          
         MVI   KEY,X'02'                                                        
         MVC   KEY+20(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
RESA0004 CLC   KEY(22),KEYSAVE                                                  
         BNE   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,STATEQU                                         
         BNZ   ENDREQ                                                           
         TM    RSTACNTL,X'80'                                                   
         BO    RESA0012                                                         
         CLI   FCGTOWN,C'Y'                                                     
         BNE   RESA0008                                                         
         OC    RSTAOWN,RSTAOWN                                                  
         BZ    RESA0008                                                         
         MVC   KEYWORK,KEY                                                      
         XC    KEY,KEY                                                          
         MVI   KEY,X'2A'                                                        
         MVC   KEY+22(2),QREP                                                   
         MVC   KEY+24(3),RSTAOWN                                                
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,OWNEREQU                                        
         BNZ   ENDREQ                                                           
         MVC   KEY,KEYWORK                                                      
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
RESA0008 MVI   MODE,PROCSTAT                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
RESA0012 GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
         B     RESA0004                                                         
         EJECT                                                                  
*              READ CONTRACTS IN GROUP/STATION ORDER               V 13         
         SPACE 3                                                                
STATCONT EQU   *                                                                
*                                                                               
*   POSTTEST                                                                    
*        MVC   P+1(08),=C'STATCONT'                                             
*        MVC   P+10(4),RCONKCON                                                 
*        GOTO1 REPORT                                                           
*   POSTTEST END                                                                
*                                                                               
         XC    KEY,KEY             BUILD KEY                                    
         MVI   KEY,X'0C'                                                        
         MVC   SKPKY,KOC           SKIP KEY PROFILE                             
         MVC   KEY+2(2),QREP                                                    
         LA    R2,3                MINIMUM COMPARE LENGTH                       
         CLC   QGROUP,SPACES                                                    
         BE    STAC0004                                                         
         MVC   KEY+4(1),QGROUP                                                  
         LA    R2,4                                                             
         CLC   QSBGROUP,SPACES                                                  
         BE    STAC0004                                                         
         MVC   KEY+5(1),QSBGROUP                                                
         LA    R2,5                                                             
         CLC   QSTATION,SPACES                                                  
         BE    STAC0004                                                         
         LA    R2,10                                                            
         MVC   KEY+6(5),QSTATION                                                
         CLC   QOFFICE,SPACES                                                   
         BE    STAC0004                                                         
         LA    R2,12                                                            
         MVC   KEY+11(2),QOFFICE                                                
         SPACE 2                                                                
STAC0004 GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         B     STAC0012                                                         
         SPACE 2                                                                
STAC0008 EQU   *                                                                
         BAS   RE,SKIPPER                                                       
         SPACE 1                                                                
STAC0012 EX    R2,KEYCOMP                                                       
         BNE   ENDREQ                                                           
         BAS   RE,DIRFILTS                                                      
         BNE   STAC0008                                                         
         GOTO1 =V(REPFINT),DMCB,CONTEQU                                         
         BNZ   ENDREQ                                                           
         CLC   QPROG,=C'8A'     PASS ALL CONTRACTS FOR 8A                       
         BE    STAC0016                                                         
         CLI   QPROG,C'8'       TEST FOR SPL REPORT                             
         BNE   STAC0016                                                         
         BAS   RE,TSTSPL                                                        
         BNE   STAC0008                                                         
*                                                                               
STAC0016 BAS   RE,FILTERS                                                       
         BNE   STAC0008                                                         
         SPACE 2                                                                
STAC0020 MVI   MODE,GRUPFRST                                                    
         GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     STAC0028                                                         
         SPACE 2                                                                
STAC0024 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
STAC0028 MVI   MODE,SUBFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     STAC0036                                                         
         SPACE 2                                                                
STAC0032 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
STAC0036 MVI   MODE,STAFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     STAC0044                                                         
         SPACE 2                                                                
STAC0040 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
STAC0044 MVI   MODE,OFFFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     STAC0052                                                         
         SPACE 2                                                                
STAC0048 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
STAC0052 CLC   QPROG,=C'10'        CONTRACTS DONT NEED POSTMNTH                 
         BE    STAC0056                                                         
         CLI   QPROG,C'8'                                                       
         BE    *+8                                                              
         BAS   RE,POSTMNTH                                                      
STAC0056 EQU   *                                                                
         MVI   MODE,PROCCONT                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLI   MODE,0                                                           
         BNE   STAC0060                                                         
         GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
         B     STAC0056                                                         
*                                                                               
STAC0060 EQU   *                                                                
         BAS   RE,ANYBUYS                                                       
*                                                                               
         SPACE 2                                                                
STAC0064 BAS   RE,SKIPPER          SEQ READS AFTER FIRST GOOD CONTRACT          
         EX    R2,KEYCOMP                                                       
         BE    STAC0068                                                         
         MVI   MODE,OFFLAST        LAST TIME                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,STALAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,SUBLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,GRUPLAST                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         B     ENDREQ                                                           
         SPACE 2                                                                
STAC0068 BAS   RE,DIRFILTS                                                      
         BNE   STAC0064                                                         
         GOTO1 =V(REPFINT),DMCB,CONTEQU                                         
         BNZ   ENDREQ                                                           
         CLC   QPROG,=C'8A'     PASS ALL CONTRACTS FOR 8A                       
         BE    STAC0072                                                         
         CLI   QPROG,C'8'                                                       
         BNE   STAC0072                                                         
         BAS   RE,TSTSPL                                                        
         BNE   STAC0064                                                         
*                                                                               
STAC0072 BAS   RE,FILTERS                                                       
         BNE   STAC0064                                                         
         CLC   QPROG,=C'10'        CONTRACTS DONT NEED THESE BREAKS             
         BE    STAC0048                                                         
         CLC   KEY(13),KEYSAVE                                                  
         BE    STAC0048                                                         
         MVI   MODE,OFFLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(11),KEYSAVE                                                  
         BE    STAC0040                                                         
         MVI   MODE,STALAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(6),KEYSAVE                                                   
         BE    STAC0032                                                         
         MVI   MODE,SUBLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(5),KEYSAVE                                                   
         BE    STAC0024                                                         
         MVI   MODE,GRUPLAST                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     STAC0020                                                         
         SPACE 2                                                                
KEYCOMP  CLC   KEY(0),KEYSAVE                                                   
         EJECT                                                                  
*              READ CONTRACTS IN OFFICE ORDER                                   
         SPACE 3                                                                
OFFCONT  EQU   *                                                                
         XC    KEY,KEY             BUILD ORIGINAL KEY                           
         MVC   SKPKY,K9C           SKIP KEY PROFILE                             
         MVI   KEY,X'9C'                                                        
         MVC   KEY+2(2),QREP                                                    
         LA    R2,3                                                             
         CLC   QOFFICE,SPACES                                                   
         BE    OFCO0004                                                         
         MVC   KEY+4(2),QOFFICE                                                 
         LA    R2,5                                                             
         CLC   QGROUP,SPACES                                                    
         BE    OFCO0004                                                         
         LA    R2,6                                                             
         MVC   KEY+6(1),QGROUP                                                  
         CLC   QSBGROUP,SPACES                                                  
         BE    OFCO0004                                                         
         MVC   KEY+7(1),QSBGROUP                                                
         LA    R2,7                                                             
         CLC   QSTATION,SPACES                                                  
         BE    OFCO0004                                                         
         MVC   KEY+8(5),QSTATION                                                
         LA    R2,12                                                            
         SPACE 2                                                                
         SPACE 2                                                                
OFCO0004 GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         B     OFCO0012                                                         
         SPACE 2                                                                
OFCO0008 BAS   RE,SKIPPER                                                       
         SPACE 2                                                                
OFCO0012 EX    R2,KEYCOMP                                                       
         BNE   ENDREQ                                                           
         BAS   RE,DIRFILTS                                                      
         BNE   OFCO0008                                                         
         GOTO1 =V(REPFINT),DMCB,CONTEQU                                         
         BNZ   ENDREQ                                                           
         CLI   QPROG,C'8'                                                       
         BNE   OFCO0016                                                         
         BAS   RE,TSTSPL                                                        
         BNE   OFCO0008                                                         
OFCO0016 EQU   *                                                                
         BAS   RE,FILTERS                                                       
         BNE   OFCO0008                                                         
         SPACE 2                                                                
OFCO0020 MVI   MODE,OFFFRST                                                     
         GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     OFCO0028                                                         
         SPACE 2                                                                
OFCO0024 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
OFCO0028 MVI   MODE,GRUPFRST                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     OFCO0036                                                         
         SPACE 2                                                                
OFCO0032 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
OFCO0036 MVI   MODE,SUBFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     OFCO0044                                                         
         SPACE 2                                                                
OFCO0040 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
OFCO0044 MVI   MODE,STAFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     OFCO0052                                                         
         SPACE 2                                                                
OFCO0048 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
OFCO0052 CLI   QPROG,C'8'                                                       
         BE    *+8                                                              
         BAS   RE,POSTMNTH                                                      
OFCO0056 MVI   MODE,PROCCONT                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLI   MODE,0                                                           
         BNE   OFCO0060                                                         
         GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
         B     OFCO0056                                                         
OFCO0060 EQU   *                                                                
         BAS   RE,ANYBUYS                                                       
         SPACE 2                                                                
OFCO0064 BAS   RE,SKIPPER                                                       
         EX    R2,KEYCOMP                                                       
         BE    OFCO0068                                                         
         MVI   MODE,STALAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,SUBLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,GRUPLAST                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,OFFLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         B     ENDREQ                                                           
         SPACE 2                                                                
OFCO0068 BAS   RE,DIRFILTS                                                      
         BNE   OFCO0064                                                         
         GOTO1 =V(REPFINT),DMCB,CONTEQU                                         
         BNZ   ENDREQ                                                           
         CLI   QPROG,C'8'                                                       
         BNE   *+12                                                             
         BAS   RE,TSTSPL                                                        
         BNE   OFCO0064                                                         
         BAS   RE,FILTERS                                                       
         BNE   OFCO0064                                                         
         CLC   KEY(13),KEYSAVE                                                  
         BE    OFCO0048                                                         
         MVI   MODE,STALAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(8),KEYSAVE                                                   
         BE    OFCO0040                                                         
         MVI   MODE,SUBLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(7),KEYSAVE                                                   
         BE    OFCO0032                                                         
         MVI   MODE,GRUPLAST                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(6),KEYSAVE                                                   
         BE    OFCO0024                                                         
         MVI   MODE,OFFLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     OFCO0020                                                         
         EJECT                                                                  
*              READ CONTRACTS IN SALESMAN ORDER                                 
         SPACE 3                                                                
SALECONT EQU   *                                                                
*                                                                               
*   POSTTEST                                                                    
*        MVC   P+1(08),=C'SALECONT'                                             
*        MVC   P+10(4),RCONKCON                                                 
*        GOTO1 REPORT                                                           
*   POSTTEST END                                                                
*                                                                               
         XC    KEY,KEY                                                          
         MVC   INT2,INT2SV                                                      
         MVC   INT3,INT3SV                                                      
         CLI   QMAN+2,X'40'      3RD POSITION BLANK                             
         BNE   *+12               NO,USE QMAN+2,QMAN,QMAN+1                     
         MVI   INT3,X'1E'         YES, USE QMAN+1,QMAN,QMAN+2                   
         MVI   INT2,X'1F'                                                       
         MVC   SKPKY,KAC           SKIP KEY PROFILE                             
         MVI   KEY,X'AC'                                                        
         MVC   KEY+1(2),QREP                                                    
         LA    R2,2                                                             
         CLC   QOFFICE,SPACES                                                   
         BE    SACO0004                                                         
         MVC   KEY+3(2),QOFFICE                                                 
         LA    R2,4                                                             
         CLC   QDIV,SPACES                                                      
         BE    SACO0004                                                         
         MVC   KEY+5(1),QDIV                                                    
         LA    R2,5                                                             
         CLC   QTEAM,SPACES                                                     
         BE    SACO0004                                                         
         MVC   KEY+6(1),QTEAM                                                   
         LA    R2,6                                                             
         CLC   QMAN,SPACES                                                      
         BE    SACO0004                                                         
         OC    KEY+7(3),SPACES                                                  
         CLI   QMAN+2,C' '                                                      
         BE    *+20                                                             
         MVC   KEY+7(1),QMAN+2                                                  
         MVC   KEY+8(2),QMAN                                                    
         B     *+16                                                             
         MVC   KEY+7(1),QMAN+1                                                  
         MVC   KEY+8(1),QMAN                                                    
         LA    R2,9                                                             
         CLC   QSTATION,SPACES                                                  
         BE    SACO0004                                                         
         MVC   KEY+10(5),QSTATION                                               
         LA    R2,14                                                            
         SPACE 2                                                                
SACO0004 GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         B     SACO0012                                                         
         SPACE 2                                                                
SACO0008 BAS   RE,SKIPPER                                                       
         SPACE 2                                                                
SACO0012 EX    R2,KEYCOMP                                                       
         BNE   ENDREQ                                                           
         BAS   RE,DIRFILTS                                                      
         BNE   SACO0008                                                         
         GOTO1 =V(REPFINT),DMCB,CONTEQU                                         
         BNZ   ENDREQ                                                           
         CLI   QPROG,C'8'                                                       
         BNE   *+12                                                             
         BAS   RE,TSTSPL                                                        
         BNE   SACO0008                                                         
         BAS   RE,FILTERS                                                       
         BNE   SACO0008                                                         
         SPACE 2                                                                
SACO0016 MVI   MODE,OFFFRST                                                     
         GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     SACO0024                                                         
         SPACE 2                                                                
SACO0020 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
SACO0024 MVI   MODE,DIVFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     SACO0032                                                         
         SPACE 2                                                                
SACO0028 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
SACO0032 MVI   MODE,TEAMFRST                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     SACO0040                                                         
         SPACE 2                                                                
SACO0036 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
SACO0040 MVI   MODE,MANFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     SACO0048                                                         
         SPACE 2                                                                
SACO0044 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
SACO0048 MVI   MODE,STAFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     SACO0056                                                         
         SPACE 2                                                                
SACO0052 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
SACO0056 CLI   QPROG,C'8'                                                       
         BE    *+8                                                              
         BAS   RE,POSTMNTH                                                      
SACO0060 MVI   MODE,PROCCONT                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLI   MODE,0                                                           
         BNE   SACO0064                                                         
         GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
         B     SACO0060                                                         
*                                                                               
SACO0064 EQU   *                                                                
         BAS   RE,ANYBUYS                                                       
         SPACE 2                                                                
SACO0068 BAS   RE,SKIPPER                                                       
         EX    R2,KEYCOMP                                                       
         BE    SACO0072                                                         
         MVI   MODE,STALAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,MANLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,TEAMLAST                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,DIVLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,OFFLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         B     ENDREQ                                                           
         SPACE 2                                                                
SACO0072 BAS   RE,DIRFILTS                                                      
         BNE   SACO0068                                                         
         GOTO1 =V(REPFINT),DMCB,CONTEQU                                         
         BNZ   ENDREQ                                                           
         CLI   QPROG,C'8'                                                       
         BNE   *+12                                                             
         BAS   RE,TSTSPL                                                        
         BNE   SACO0068                                                         
         BAS   RE,FILTERS                                                       
         BNE   SACO0068                                                         
         CLC   KEY(15),KEYSAVE                                                  
         BE    SACO0052                                                         
         MVI   MODE,STALAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(10),KEYSAVE                                                  
         BE    SACO0044                                                         
         MVI   MODE,MANLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(7),KEYSAVE                                                   
         BE    SACO0036                                                         
         MVI   MODE,TEAMLAST                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(6),KEYSAVE                                                   
         BE    SACO0028                                                         
         MVI   MODE,DIVLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(5),KEYSAVE                                                   
         BE    SACO0020                                                         
         MVI   MODE,OFFLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     SACO0016                                                         
         EJECT                                                                  
*              READ CONTRACTS IN STATION/SALESPERSON ORDER                      
         SPACE 3                                                                
CCCONT   EQU   *                                                                
*                                                                               
*   POSTTEST                                                                    
*        MVC   P+1(08),=C'CCCONT  '                                             
*        MVC   P+10(4),RCONKCON                                                 
*        GOTO1 REPORT                                                           
*   POSTTEST END                                                                
*                                                                               
         XC    KEY,KEY                                                          
         MVC   INTT2,INTT2SV                                                    
         MVC   INTT3,INTT3SV                                                    
         CLI   QMAN+2,X'40'       3RD POS BLANK                                 
         BNE   *+12       NO,USE QMAN+2,QMAN,QMAN+1                             
         MVI   INTT3,X'1E'      USE QMAN+1,QMAN,QMAN+2                          
         MVI   INTT2,X'1F'                                                      
         MVC   SKPKY,KCC           SKIP KEY PROFILE                             
         MVI   KEY,X'CC'                                                        
         MVC   KEY+1(2),QREP                                                    
         LA    R2,2                                                             
         CLC   QSTATION,SPACES                                                  
         BE    CCCO0004                                                         
         MVC   KEY+3(5),QSTATION                                                
         LA    R2,7                                                             
         CLC   QOFFICE,SPACES                                                   
         BE    CCCO0004                                                         
         MVC   KEY+8(2),QOFFICE                                                 
         LA    R2,9                                                             
         CLC   QDIV,SPACES                                                      
         BE    CCCO0004                                                         
         MVC   KEY+10(1),QDIV                                                   
         LA    R2,10                                                            
         CLC   QTEAM,SPACES                                                     
         BE    CCCO0004                                                         
         MVC   KEY+11(1),QTEAM                                                  
         LA    R2,11                                                            
         CLC   QMAN,SPACES                                                      
         BE    CCCO0004                                                         
         OC    KEY+12(3),SPACES                                                 
         CLI   QMAN+2,C' '                                                      
         BE    *+20                                                             
         MVC   KEY+12(1),QMAN+2                                                 
         MVC   KEY+13(2),QMAN                                                   
         B     *+16                                                             
         MVC   KEY+12(1),QMAN+1                                                 
         MVC   KEY+13(1),QMAN                                                   
         LA    R2,14                                                            
         SPACE 2                                                                
CCCO0004 GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         B     CCCO0012                                                         
         SPACE 1                                                                
CCCO0008 BAS   RE,SKIPPER                                                       
         SPACE 1                                                                
CCCO0012 EX    R2,KEYCOMP                                                       
         BNE   ENDREQ                                                           
         BAS   RE,DIRFILTS                                                      
         BNE   CCCO0008                                                         
         GOTO1 =V(REPFINT),DMCB,CONTEQU                                         
         BNZ   ENDREQ                                                           
         CLI   QPROG,C'8'                                                       
         BNE   *+12                                                             
         BAS   RE,TSTSPL                                                        
         BNE   CCCO0008                                                         
         BAS   RE,FILTERS                                                       
         BNE   CCCO0008                                                         
         SPACE 2                                                                
CCCO0016 MVI   MODE,STAFRST                                                     
         GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     CCCO0024                                                         
         SPACE 2                                                                
CCCO0020 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
CCCO0024 MVI   MODE,OFFFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     CCCO0032                                                         
         SPACE 2                                                                
CCCO0028 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
CCCO0032 MVI   MODE,DIVFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     CCCO0040                                                         
         SPACE 2                                                                
CCCO0036 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
CCCO0040 MVI   MODE,TEAMFRST                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     CCCO0048                                                         
         SPACE 2                                                                
CCCO0044 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
CCCO0048 MVI   MODE,MANFRST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     CCCO0056                                                         
         SPACE 2                                                                
CCCO0052 GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
CCCO0056 CLI   QPROG,C'8'       TEST FOR SPL REPORT                             
         BE    *+8                                                              
         BAS   RE,POSTMNTH                                                      
CCCO0060 MVI   MODE,PROCCONT                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLI   MODE,0                                                           
         BNE   CCCO0064                                                         
         GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
         B     CCCO0060                                                         
*                                                                               
CCCO0064 EQU   *                                                                
         BAS   RE,ANYBUYS                                                       
         SPACE 2                                                                
CCCO0068 BAS   RE,SKIPPER                                                       
         EX    R2,KEYCOMP                                                       
         BE    CCCO0072                                                         
         MVI   MODE,MANLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,TEAMLAST                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,DIVLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,OFFLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         MVI   MODE,STALAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         B     ENDREQ                                                           
         SPACE 2                                                                
CCCO0072 BAS   RE,DIRFILTS                                                      
         BNE   CCCO0068                                                         
         GOTO1 =V(REPFINT),DMCB,CONTEQU                                         
         BNZ   ENDREQ                                                           
         CLI   QPROG,C'8'                                                       
         BNE   *+12                                                             
         BAS   RE,TSTSPL                                                        
         BNE   CCCO0068                                                         
         BAS   RE,FILTERS                                                       
         BNE   CCCO0068                                                         
*                                                                               
         CLC   KEY(15),KEYSAVE                                                  
         BE    CCCO0052                                                         
         MVI   MODE,MANLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(12),KEYSAVE                                                  
         BE    CCCO0044                                                         
         MVI   MODE,TEAMLAST                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(11),KEYSAVE                                                  
         BE    CCCO0036                                                         
         MVI   MODE,DIVLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(10),KEYSAVE                                                  
         BE    CCCO0028                                                         
         MVI   MODE,OFFLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLC   KEY(8),KEYSAVE                                                   
         BE    CCCO0020                                                         
         MVI   MODE,STALAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     CCCO0016                                                         
         EJECT                                                                  
*              HANDLE A SINGLE CONTRACT                                         
         SPACE 3                                                                
ONECONT  EQU   *                                                                
*                                                                               
*   POSTTEST                                                                    
*        MVC   P+1(08),=C'ONECONT '                                             
*        MVC   P+10(4),RCONKCON                                                 
*        GOTO1 REPORT                                                           
*   POSTTEST END                                                                
*                                                                               
         XC    KEY,KEY                                                          
         MVI   KEY,X'8C'                                                        
         MVC   KEY+21(2),QREP                                                   
         PACK  WORK(8),QCONT                                                    
         ZAP   DUB,=P'99999999'                                                 
         SP    DUB,WORK(8)                                                      
         UNPK  WORK(8),DUB                                                      
         OI    WORK+7,X'F0'                                                     
         PACK  DUB(5),WORK(9)                                                   
         MVC   KEY+23(4),DUB                                                    
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         CLC   KEY(27),KEYSAVE                                                  
         BNE   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,CONTEQU                                         
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
ONEC0004 MVI   MODE,PROCCONT                                                    
         GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
         BAS   RE,POSTMNTH                                                      
ONEC0008 MVI   MODE,PROCCONT                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLI   MODE,0                                                           
         BNE   ONEC0012                                                         
         GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
         B     ONEC0008                                                         
*                                                                               
ONEC0012 EQU   *                                                                
         BAS   RE,ANYBUYS                                                       
         B     ENDREQ                                                           
         EJECT                                                                  
*              READ CONTRACTS USING BOP KEY                                     
         SPACE 1                                                                
DCCONT   EQU   *                                                                
*                                                                               
*   POSTTEST                                                                    
*        MVC   P+1(08),=C'DCCONT  '                                             
*        MVC   P+10(4),RCONKCON                                                 
*        GOTO1 REPORT                                                           
*   POSTTEST END                                                                
*                                                                               
         XC    DCDATE,DCDATE                                                    
         GOTO1 DATCON,DMCB,(4,RCDATE),(3,DCDATE)                                
         CLC   QSTART,SPACES                                                    
         BE    DCCO0004                                                         
         GOTO1 DATCON,DMCB,(0,QSTART),(3,DCDATE)                                
         SPACE 1                                                                
DCCO0004 XC    KEY,KEY                                                          
         MVI   KEY,X'DC'                                                        
         MVC   KEY+5(2),QREP                                                    
         LA    R2,6                                                             
         CLC   QADV,SPACES                                                      
         BE    DCCO0008                                                         
         MVC   KEY+7(4),QADV                                                    
         LA    R2,10                                                            
         SPACE 1                                                                
DCCO0008 GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         B     DCCO0016                                                         
         SPACE 1                                                                
DCCO0012 GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
DCCO0016 EX    R2,KEYCOMP                                                       
         BNE   ENDREQ                                                           
         SPACE 1                                                                
         CLC   QPROG,=C'8H'        PASS ALL CONTRACTS FOR 8H                    
         BE    DCCO0020                                                         
         SPACE 1                                                                
         CLC   KEY+11(3),DCDATE                                                 
         BNL   DCCO0020                                                         
         MVC   KEY+11(3),DCDATE                                                 
         XC    KEY+14(13),KEY+14                                                
         B     DCCO0008                                                         
         SPACE 1                                                                
DCCO0020 GOTO1 =V(REPFINT),DMCB,CONTEQU                                         
         BNZ   ENDREQ                                                           
         TM    RCONCNTL,X'80'      NO DELETED CONTRACTS                         
         BO    DCCO0012                                                         
         GOTO1 =A(FILTER2),DMCB,(RC),1    CONTRACT FILTER                       
         BNE   DCCO0012            REJECTED - KICK IT OUT                       
         SPACE 1                                                                
         MVI   MODE,PROCCONT                                                    
         GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         B     DCCO0012                                                         
         SPACE 1                                                                
DCDATE   DS    CL3                                                              
         EJECT                                                                  
*              READ CONTRACTS USING SAR KEY                                     
         SPACE 1                                                                
         DS    0F                                                               
ECCONT   EQU   *                                                                
*                                                                               
*   POSTTEST                                                                    
*        MVC   P+1(08),=C'ECCONT  '                                             
*        MVC   P+10(4),RCONKCON                                                 
*        GOTO1 REPORT                                                           
*   POSTTEST END                                                                
*                                                                               
         XC    KEY,KEY                                                          
         MVI   KEY,X'EC'                                                        
         MVC   KEY+21(2),QREP                                                   
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         SPACE 1                                                                
ECCO0004 CLC   KEY(23),KEYSAVE                                                  
         BNE   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,CONTEQU                                         
         BNZ   ENDREQ                                                           
         TM    RCONCNTL,X'80'                                                   
         BO    ECCO0008            NO DELETED CONTRACTS                         
         SPACE 1                                                                
         GOTO1 =A(FILTER2),DMCB,(RC),1   CONTRACT FILTER                        
         BNE   ECCO0008                  REJECTED - KICK IT OUT                 
         SPACE 1                                                                
         MVI   MODE,PROCCONT                                                    
         GOTO1 =A(GETINFO),DMCB,(RC),RR=RELO                                    
         BNZ   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 1                                                                
ECCO0008 GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
         B     ECCO0004                                                         
         EJECT                                                                  
*              SKIP THRU DIRECTORY LOOKING FOR NEXT APPLICABLE RECORD           
*                                                                               
SKIPPER  NTR1                                                                   
         MVC   SKSVKY,FILTKEY     SAVE LAST FILTER KEY                          
         GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
         EX    R2,KEYCOMP                                                       
         BNE   SKPR0099                                                         
SKPR0004 SR    R5,R5                                                            
         LA    R3,SKPKY-1     POINT R3 TO PROFILE KEY                           
         IC    R5,1(R3)       DISP. TO START FIELD IN KEY                       
         LA    R4,KEY(R5)          POINT R4 TO FIRST KEY ITEM                   
         LA    R5,7                7 FIELDS TO CHECK                            
         CLI   KEY,X'AC'        SALESMAN KEY                                    
         BNE   *+8                                                              
         LA    R5,2(R5)    2 EXTRA POSITIONS TO CHECK                           
         CLI   KEY,X'CC'                                                        
         BNE   SKPR0008                                                         
         LA    R5,2(R5)                                                         
*                                                                               
*   SET R3  TO NEXT ITEM IN SKPKY                                               
*   SET R1  TO LENGTH OF NEXT ITEM                                              
*   SET R6  TO QRECORD ITEM                                                     
*                                                                               
SKPR0008 LA    R3,2(R3)            NEXT FIELD IN SKPKY                          
         SR    R6,R6                                                            
         IC    R6,0(R3)            DISP IN QRECORD                              
         LA    R6,QRECORD(R6)      POINT R6 TO QRECORD FIELD                    
         SR    R1,R1                                                            
         IC    R1,1(R3)            R1 TO LENGTH FOR EX                          
         EX    R1,QSPA             QRECORD ITEM SPACES                          
         BE    SKPR0012            YES, NO FILTER ON THIS FIELD                 
         EX    R1,QKY              KEY ITEM EQ QRECORD                          
         BE    SKPR0012            YES, CONTINUE TO NEXT FIELD                  
         BL    SKPR0016            KEY LOW BUILD A HIGHER KEY                   
         B     SKPR0024            KEY HIGH - MUST SKIP TO NEXT                 
*                                                                               
SKPR0012 LA    R4,1(R1,R4)         R4 TO NEXT KEY ITEM                          
         BCT   R5,SKPR0008         SKIP TO NEXT FIELD                           
         B     SKPR0099                                                         
*                                                                               
*                                                                               
*              KEY IS LOW BUILD A HIGHER KEY                                    
*                                                                               
SKPR0016 EX    R1,MVCQ             MOVE TO KEY QRECORD                          
         LA    R4,1(R1,R4)                                                      
         LA    R1,KEY+26                                                        
         SR    R1,R4                                                            
         EX    R1,XCKY                                                          
SKPR0020 GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         EX    R2,KEYCOMP          SAME AS START KEY                            
         BNE   SKPR0099            FINISHED                                     
         B     SKPR0004                                                         
*                                                                               
SKPR0024 LA    R4,1(R1,R4)         POINT TO NEXT FIELD                          
         LA    R1,KEY+25           END OF KEY                                   
         SR    R1,R4                                                            
         MVI   0(R4),X'FF'                                                      
         EX    R1,MVCF                                                          
         B     SKPR0020                                                         
*                                                                               
SKPR0099 MVC   KEYSAVE,SKSVKY    RESTORE LAST FILTER KEY                        
         MVC   FILTKEY,SKSVKY                                                   
         XIT1                                                                   
*                                                                               
*                                                                               
QSPA     CLC   0(0,R6),SPACES      QRECORD FOR SPACES                           
QKY      CLC   0(0,R4),0(R6)       KEY EQ REQUEST                               
MVCQ     MVC   0(0,R4),0(R6)                                                    
MVCF     MVC   1(0,R4),0(R4)                                                    
XCKY     XC    0(0,R4),0(R4)                                                    
*                                                                               
         EJECT                                                                  
*              FILTER AT THE DIRECTORY LEVEL                                    
         SPACE 3                                                                
DIRFILTS CLI   RCTIMER,C'Y'                                                     
         BNE   DF2                                                              
         LR    R3,RE                                                            
         GOTO1 =V(TIMER2),DMCB,(11,0)                                           
         LR    RE,R3                                                            
DF2      TM    KEY+27,X'80'                                                     
         BO    DIRNO                                                            
         SPACE 1                                                                
         XC    KEYWORK,KEYWORK                                                  
         MVC   KEYWORK(23),KEY     SET AC TYPE DIRECTORY ITEM UP                
         CLI   KEY,X'AC'                                                        
         BE    FC144                                                            
         XC    KEYWORK,KEYWORK                                                  
         CLI   KEY,X'9C'                                                        
         BE    DF4                                                              
         CLI   KEY,X'CC'                                                        
         BE    DF6                                                              
*                                  SET 0C TYPE                                  
         MVC   KEYWORK+01(2),KEY+2      REP                                     
         MVC   KEYWORK+03(2),KEY+11     OFFICE                                  
         MVC   KEYWORK+10(5),KEY+6      STATION                                 
         MVC   KEYWORK+15(4),KEY+13     AGENCY                                  
         MVC   KEYWORK+19(4),KEY+19     ADV                                     
         MVC   KEYWORK+23(2),KEY+17     AGY OFF                                 
         MVC   KEYWORK+25(2),KEY+4      GROUP                                   
         B     FC144                                                            
*                                  SET 9C TYPE                                  
DF4      MVC   KEYWORK+01(2),KEY+2      REP                                     
         MVC   KEYWORK+03(2),KEY+4      OFFICE                                  
         MVC   KEYWORK+10(5),KEY+8      STATION                                 
         MVC   KEYWORK+15(4),KEY+17     AGY                                     
         MVC   KEYWORK+19(4),KEY+13     ADV                                     
         MVC   KEYWORK+23(2),KEY+21     AGY OFF                                 
         MVC   KEYWORK+25(2),KEY+6      GROUP                                   
         B     FC144                                                            
         SPACE 1                                                                
*                                  SET CC TYPE                                  
DF6      MVC   KEYWORK+01(2),KEY+1      REP                                     
         MVC   KEYWORK+03(2),KEY+8      OFFICE                                  
         MVC   KEYWORK+10(5),KEY+3      STATION                                 
         MVC   KEYWORK+15(4),KEY+19     AGY                                     
         MVC   KEYWORK+19(4),KEY+15     ADV                                     
         MVC   KEYWORK+05(5),KEY+10     DIV/TEM/SAL                             
         SPACE 2                                                                
FC144    EQU   *                                                                
DIRYES   MVI   DMCB,11             FOR TIMER                                    
DIRYES2  SR    R3,R3                                                            
         LR    R4,RE                                                            
         CLI   RCTIMER,C'Y'                                                     
         BNE   DIRYES4                                                          
         GOTO1 =V(TIMER2),DMCB                                                  
DIRYES4  LTR   R3,R3                                                            
         BR    R4                                                               
         SPACE 2                                                                
DIRNO    MVI   DMCB,11                                                          
DIRNO2   LA    R3,1                                                             
         LR    R4,RE                                                            
         MVC   KEY,FILTKEY                                                      
         CLI   RCTIMER,C'Y'                                                     
         BNE   DIRNO4                                                           
         GOTO1 =V(TIMER2),DMCB                                                  
DIRNO4   LTR   R3,R3                                                            
         BR    R4                                                               
         EJECT                                                                  
*              FILTER AT THE RECORD LEVEL                                       
         SPACE 3                                                                
*                                                                               
*   NOTE:  R2 CANNOT BE USED WITHIN THIS ROUTINE.  CHANGING THE VALUE           
*        CHANGES THE LENGTH OF THE COMPARISON FOR SEQUENTIALLY PRO-             
*        CESSING THE RECORDS.  HEAVEN FORBID THIS ROUTINE, WITH ITS             
*        NINETY-TWO EXITS, SHOULD CONTAIN A STORE MULTIPLE ENTRY.               
*                                                                               
FILTERS  CLI   RCTIMER,C'Y'                                                     
         BNE   FL2                                                              
         LR    R3,RE                                                            
         GOTO1 =V(TIMER2),DMCB,(12,0)                                           
         LR    RE,R3                                                            
FL2      EQU   *                                                                
*                                                                               
         LR    R3,RE                                                            
         GOTO1 =A(FILTER2),DMCB,(RC),0                                          
         LR    RE,R3                                                            
         BNE   FILTNO              CC NOT = ZERO: FILTERED OUT                  
*                                                                               
RECYES   EQU   *                                                                
*                                                                               
         CLI   RCTRACE,C'C'        CONTRACT TRACE ONLY?                         
         BNE   RECYES2                                                          
         MVC   P+1(8),=C'CON: YES'                                              
*                                                                               
         MVC   P+10(23),RCONKEY                                                 
         LR    R3,RE                                                            
         GOTO1 HEXOUT,P1,RCONKCON,P+35,4,=C'N'                                  
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 =V(REREPORT),RR=RELO                                             
         LR    RE,R3                                                            
RECYES2  EQU   *                                                                
         MVC   FILTKEY,KEY                                                      
         MVI   DMCB,12                                                          
         B     DIRYES2                                                          
         SPACE 1                                                                
*                                                                               
FILTNO   EQU   *                                                                
*                                                                               
         CLI   RCTRACE,C'C'        CONTRACT TRACE ONLY?                         
         BNE   FILTNO2                                                          
         MVC   P+1(8),=C'CON: NO '                                              
*                                                                               
         MVC   P+10(23),RCONKEY                                                 
         LR    R3,RE                                                            
         GOTO1 HEXOUT,P1,RCONKCON,P+35,4,=C'N'                                  
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 =V(REREPORT),RR=RELO                                             
         LR    RE,R3                                                            
         B     FILTNO2A                                                         
FILTNO2  EQU   *                                                                
         CLI   RCTRACE,C'Y'                                                     
         BNE   FILTNOX                                                          
FILTNO2A EQU   *                                                                
         L     R3,DUB              PASSED-BACK VALUE OF R3                      
         MVC   P+25(6),=C'FILTNO'                                               
         EDIT  (R3),(3,P+35)                                                    
*                                                                               
         LR    R3,RE                                                            
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 =V(REREPORT),RR=RELO                                             
         LR    RE,R3                                                            
*                                                                               
FILTNOX  EQU   *                                                                
         MVI   DMCB,12                                                          
         B     DIRNO2                                                           
         EJECT                                                                  
*                                  CHECK FOR SPL ELEMENT                        
TSTSPL   LA    R4,RCONELEM                                                      
         XC    FULL,FULL           CLEAR TEMPORARY STORAGE                      
         CLI   RCONTYPE,C'X'                                                    
         BE    DIRNO                                                            
         CLC   QPROG,=C'82'                                                     
         BE    TSPL0024                                                         
         CLC   QPROG,=C'88'        82 SPL WORKSHEET/ 88 EPL WORKSHEET           
         BE    TSPL0024            PASS ONLY CONTRACTS WITHOUT SPL/EPL          
TSPL0004 ZIC   R5,1(R4)                                                         
         AR    R4,R5                                                            
         CLI   0(R4),6             SPL ELEMENT FOUND?                           
         BE    TSPL0012            YES -                                        
         CLI   0(R4),8             NO  - AUTOCLOSE ELEMENT FOUND?               
         BNE   *+8                 NO                                           
         ST    R4,FULL             YES - SAVE A(X'08' ELEMENT)                  
         CLI   0(R4),0             END OF RECORD?                               
         BNE   TSPL0004            NO  - GO BACK FOR NEXT                       
         OC    FULL,FULL           YES - X'08' ELEMENT FOUND?                   
         BZ    TSPL0008            NO                                           
         L     R4,FULL             YES - SET A(X'08' ELEMENT)                   
         USING RCONACEL,R4                                                      
         OC    RCONACAC,RCONACAC   ANY AUTOCLOSE DATE?                          
         BZ    TSPL0008            NO                                           
         ST    RE,DUB              SAVE RE, RETURN ADDRESS                      
         GOTO1 DATCON,DMCB,(5,WORK),(3,WORK)                                    
         L     RE,DUB              RESTORE RE, RETURN ADDRESS                   
         CLC   WORK(3),RCONACAC    IS TODAY BEFORE AUTOCLOSE?                   
         BL    TSPL0008            YES - EXIT WITH DON'T USE                    
         ST    RE,DUB              SAVE RE, RETURN ADDRESS                      
         GOTO1 DATCON,DMCB,(3,RCONACAC),(0,WORK+6)                              
*                                  AUTOCLOSE DATE:  EBCDIC                      
         GOTO1 ADDAY,DMCB,WORK+6,WORK+12,30                                     
*                                  DATE 30 DAYS LATER                           
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,WORK+3)                               
*                                  CONVERT TO EBCDIC                            
         L     RE,DUB              RESTORE RE, RETURN ADDRESS                   
         CLC   WORK(3),WORK+3      TODAY VS AUTOCLOSE+30                        
*                                  ALLOWS 30-DAY AUTOCLOSE SPAN                 
         BH    TSPL0008            AFTER - EXIT WITH DON'T USE                  
*                                                                               
         CLC   RCONACAC,RCONACAC   WITHIN  - EXIT WITH USE IT                   
*                                  SET CC =                                     
         BER   RE                                                               
         DC    H'0'                CAN'T GET HERE                               
         DROP  R4                                                               
*                                                                               
TSPL0008 MVC   KEY,FILTKEY         RESTORE ORDER                                
         LTR   RE,RE                                                            
         BR    RE                                                               
         SPACE 1                                                                
TSPL0012 L     R3,AMONINFO         A(MONTH INFO TABLE)                          
         LA    R5,24                                                            
         MVC   FULL(2),2(R4)       MOVE DATE TO COMMON WORK AREA                
*                                                                               
         USING RCONSPEL,R4         MAKE LIFE EASIER                             
*                                                                               
         TM    RCONSPES,X'08'      NEW FORMAT DATE?                             
         BNO   TSPL0016            NO  - USE OLD FORMAT                         
         ST    RE,DUB              SAVE RE, WHICH IS THE                        
*                                    RETURN ADDRESS FROM ROUTINE                
         GOTO1 DATCON,DMCB,(2,RCONSPYR),WORK                                    
*                                  YES - CONVERT TO YYMMDD                      
         GOTO1 GETBROAD,DMCB,(1,WORK),WORK+6,GETDAY,ADDAY                       
*                                  GET BROADCAST DATES FOR DATE                 
         GOTO1 DATCON,DMCB,WORK+12,(3,WORK)                                     
*                                  CONVERT FROM YYMMDD TO YMD BINARY            
         MVC   FULL(2),WORK        TAKE YYMM FROM END DATE OF                   
*                                     BROADCAST MONTH                           
         L     RE,DUB              RESTORE RE FOR BRANCH BACK                   
*                                                                               
         DROP  R4                                                               
*                                                                               
TSPL0016 CLC   FULL(2),0(R3)       COMPARE FOR SPL MONTH                        
         BER   RE                                                               
         LA    R3,NXMONINF(R3)     BUMP TO NEXT ENTRY                           
         CLI   0(R3),0                                                          
         BE    TSPL0008                                                         
         BCT   R5,TSPL0016                                                      
TSPL0020 B     TSPL0008                                                         
         SPACE 2                                                                
TSPL0024 CLI   RCONKSTA+4,C' '                                                  
         BE    TSPL0028            TV                                           
         CLC   RCONDATE(3),=X'510701'                                           
         BL    TSPL0008            SKIP RADIO BEFORE 7/1/81                     
         B     TSPL0036                                                         
         SPACE 1                                                                
TSPL0028 LA    R3,STDATE           TV START DATE                                
         CLC   RCONKOFF,=C'SL'     EXCEPT ST. LOUIS                             
         BNE   TSPL0032                                                         
         LA    R3,SLSTDATE                                                      
         SPACE 1                                                                
TSPL0032 CLC   RCONCREA,0(R3)                                                   
         BL    TSPL0008                                                         
TSPL0036 IC    R5,1(R4)            BUMP TO NEXT ELEMENT                         
         AR    R4,R5                                                            
         CLI   0(R4),0             END OF RECORD?                               
         BER   RE                  YES - RETURN                                 
         CLI   0(R4),6             NO  - SPL ELEMENT?                           
         BE    TSPL0008            YES - RETURN WITH 'DON'T USE'                
         CLI   0(R4),8             NO  - AUTOCLOSE ELEMENT FOUND?               
         BNE   TSPL0036            NO - GO BACK FOR NEXT                        
         USING RCONACEL,R4                                                      
         OC    RCONACAC,RCONACAC   ANY AUTOCLOSE DATE?                          
         BZ    TSPL0036            NO  - GO BACK FOR NEXT                       
         ST    RE,DUB              SAVE RE, RETURN ADDRESS                      
         GOTO1 DATCON,DMCB,(5,WORK),(3,WORK)                                    
*                                  GET TODAY'S DATE                             
         L     RE,DUB              RESTORE RE, RETURN ADDRESS                   
         CLC   WORK(3),RCONACAC    IS TODAY BEFORE AUTOCLOSE?                   
         BL    TSPL0036            YES - CONSIDER IT 'NO SPL FOUND'             
         B     TSPL0008            NO  - CONSIDER IT 'SPL FOUND'                
         DROP  R4                                                               
*                                                                               
SLSTDATE DC    X'4C0B1C'                                                        
STDATE   DC    X'4C0C1A'                                                        
         EJECT                                                                  
*              CHECK TO SEE IF WE NEED TO HANDLE BUYS FOR CONTRACT              
         SPACE 3                                                                
ANYBUYS  EQU   *                                                                
         LR    R3,RE                                                            
         MVC   KEYWORK,KEY                                                      
         CLI   FCRDBUY,C'Y'                                                     
         BCR   7,RE                                                             
         CLC   QPROG,=C'10'        CONTRACTS                                    
         BE    *+14                                                             
         CLC   QPROG,=C'11'                                                     
         BNE   *+8                                                              
         OI    DMINBTS,X'08'       PASS DELETES                                 
         XC    KEY,KEY                                                          
         MVI   KEY,X'0B'                                                        
         MVC   KEY+16(2),QREP                                                   
         ZAP   WORK(8),=P'0'                                                    
         MVO   WORK(8),RCONKCON                                                 
         ZAP   DUB,=P'99999999'                                                 
         SP    DUB,WORK(8)                                                      
         UNPK  WORK(8),DUB                                                      
         OI    WORK+7,X'F0'                                                     
         PACK  DUB(5),WORK(9)                                                   
         MVC   KEY+18(4),DUB                                                    
         PACK  KEY+18(1),DUB+3(1)       REVERSE THE COMPLIMENT                  
         PACK  KEY+19(1),DUB+2(1)                                               
         PACK  KEY+20(1),DUB+1(1)                                               
         PACK  KEY+21(1),DUB(1)                                                 
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         MVI   MODE,CONTFRST                                                    
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
FC210    CLC   KEY(22),KEYSAVE                                                  
         BNE   FC214                                                            
         GOTO1 =V(REPFINT),DMCB,BUYEQU                                          
         BNZ   ENDREQ                                                           
         CLC   KEY(27),RBUYREC                                                  
         BNE   FC212                                                            
         MVI   MODE,PROCBUY                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         SPACE 2                                                                
FC212    GOTO1 =V(REPFINT),DMCB,SEQEQU                                          
         BNZ   ENDREQ                                                           
         B     FC210                                                            
         SPACE 2                                                                
FC214    MVI   MODE,CONTLAST                                                    
         NI    DMINBTS,X'F7'       TURN OFF PASS DELETES                        
         MVC   LASTDA,CONTDA                                                    
         MVC   LASTIO,CONTIO                                                    
         MVC   LASTLEN,CONTLEN                                                  
         MVC   DMWORK(96),CONTDMWK                                              
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
         CLI   QSEQ,C'1'                                                        
         BCR   8,R3                                                             
         MVC   KEY,KEYWORK                                                      
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         BR    R3                                                               
         EJECT                                                                  
*              ROUTINES TO POST MONTH TABLE                                     
         SPACE 3                                                                
POSTMNTH NTR1                                                                   
         L     R2,ANEWMON          A(NEW MONTH TABLE)                           
         SR    R4,R4               SET UP PARAMETERS FOR VALUEMON               
         CLI   QBASIS,C' '                                                      
         BE    *+8                                                              
         IC    R4,QBASIS                                                        
         SR    R5,R5                                                            
         XC    DMCB(24),DMCB                                                    
         LA    R1,KEYMONTH                                                      
         ST    R1,DMCB+20                                                       
POSTMN1  CLC   QSTART+4(2),SPACES  FULL DATES MEANS ACTIVITY REPORT             
         BE    POSTMN2                                                          
         LA    R1,MONACT                                                        
         ST    R1,DMCB+16          SO SET UP PARA 5 WITH A(START-END)           
         SPACE 2                                                                
POSTMN2  MVC   DMCB+16(1),QACCTOPT ACCOUNTING -- PENNIES OPTION                 
*                                  QACCTOPT T=TAPE FOR NETWORK                  
*                                  ACCOUNTING AND PENNIES                       
         SPACE 2                                                                
POSTMN4  EQU   *                                                                
         L     R6,AMONINFO         A(MONTH INFO TABLE)                          
         L     R3,AMONFORC         A(MONTH FORECAST TABLE)                      
         PRINT GEN                                                              
         GOTO1 =V(VALU2NEW),DMCB,RCONREC,(R2),((R4),(R6)),(R3)                  
         L     R3,=V(REPSREP)     GET ADDRESSIBILITY TO SUB REPS                
         USING RSREPD,R3                                                        
*                                                                               
         CLI   REPCLOSD,C'Y'       REP DEFAULTS TO INV CLOSE DATE?              
         BNE   XIT                 NO  - DON'T EVEN CHECK                       
*                                                                               
         DROP  R3                                                               
*                                  R2 -> ANEWMON TABLE                          
*                                  RCONREC -> STATION IN QUESTION               
         GOTO1 =A(SETVALU2),DMCB,(RC),(R2)                                      
         B     XIT                                                              
         PRINT NOGEN                                                            
         EJECT                                                                  
* IF DEALING WITH MORE THAN ONE SUB REP GO WITH MODE-REPLAST                    
* IF NO MORE REPS GO READ NEXT REQUEST CARD                                     
         SPACE                                                                  
ENDREQ   DS    0H                                                               
         L     R3,=V(REPSREP)     GET ADDRESSIBILITY TO SUB REPS                
         USING RSREPD,R3                                                        
*                                                                               
*   IF REP IS NOT A MASTER, THE REQUEST IS FINISHED.                            
*   IF REP IS A MASTER, THE RUN MAY BE EITHER A MULTI-USER                      
*      REPORTER RUN, IN WHICH CASE EACH OF THE SUBSIDIARY REPS                  
*      IS TO BE PROCESSED, OR                                                   
*      A MULTI-USER RRG RUN, IN WHICH CASE REQUEST IS FINISHED                  
*                                                                               
         CLI   MASTREP,0          MASTER REP?                                   
         BE    ENDR100            NO                                            
*                                                                               
         L     RF,=V(RQSTCARD)     A(CARD INPUT)                                
         CLI   RRGFLAG(RF),C'Y'    RRG REQUEST?                                 
         BE    ENDR100             YES - FINISHED                               
*                                                                               
         MVI   MODE,REPLAST       YES - LAST REP  HOOK                          
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         BNZ   ENDREQ                                                           
*                                                                               
         L     R2,ASUBREPT        IS THERE A NEXT REP?                          
         CLC   0(2,R2),=X'FFFF'      FINISHED ALL SLAVE REPS?                   
         BE    ENDR100               YES - READ NEXT CARD                       
*                                                                               
ENDR50   DS    0H                                                               
         MVC   RCREPFL,0(R2)      MOVE NEXT REP TO BE PROCESSED                 
         MVC   QREP,0(R2)                                                       
         LA    R2,LSUBREP(R2)     A(NEXT REP CODE TO PROCESS)                   
         ST    R2,ASUBREPT        AND SAVE IT                                   
* READ REP RECORD FOR NEW REP                                                   
         XC    RREPKEY,RREPKEY                                                  
         MVI   RREPKTYP,X'01'                                                   
         MVC   RREPKREP,RCREPFL                                                 
         MVC   KEY,RREPKEY                                                      
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   ENDREQ                                                           
         GOTO1 =V(REPFINT),DMCB,REPEQU                                          
         BNZ   ENDREQ                                                           
*                                                                               
         SP    RCRQTOT,=P'1'      STILL ONE REQUEST CARD                        
         MVI   FRSTMREP,1         DON'T GET CALLED WITH REQFRST AGAIN           
         B     REQCON                                                           
         EJECT                                                                  
ENDR100  MVI   MODE,REQLAST                                                     
         GOTO1 =V(REPFINT),DMCB,GOEQU                                           
         SR    R2,R2                                                            
         BZ    ENDR110            NOW TEST THE RETURN C.C.                      
         LA    R2,1                                                             
ENDR110  EQU   *                                                                
         L     RE,=V(RCDOWNLD)                                                  
         ZICM  RF,0(RE),1                                                       
         BZ    ENDR120                                                          
         GOTO1 REPORT,DMCB,WORKC,=C'END'  END THE DOWNLOAD                      
ENDR120  EQU   *                                                                
         LTR   R2,R2                                                            
         BNZ   ENDREQ                                                           
         MVI   FRSTMREP,0         RESET FOR NEXT REQUEST CARD                   
         B     READREQ                                                          
         SPACE 2                                                                
         DROP  R3                                                               
XIT      XIT1                                                                   
         EJECT                                                                  
*              PROFILE KEYS FOR SKIPPER                                         
KOC      DC    X'04'                                                            
         DC    AL1(QGROUP-QRECORD),AL1(L'QGROUP-1)                              
         DC    AL1(QSBGROUP-QRECORD),AL1(L'QSBGROUP-1)                          
         DC    AL1(QSTATION-QRECORD),AL1(L'QSTATION-1)                          
         DC    AL1(QOFFICE-QRECORD),AL1(L'QOFFICE-1)                            
         DC    AL1(QAGENCY-QRECORD),AL1(L'QAGENCY-1)                            
         DC    AL1(QAGYOFF-QRECORD),AL1(L'QAGYOFF-1)                            
         DC    AL1(QADV-QRECORD),AL1(L'QADV-1)                                  
*                                                                               
K9C      DC    X'04'                                                            
         DC    AL1(QOFFICE-QRECORD),AL1(L'QOFFICE-1)                            
         DC    AL1(QGROUP-QRECORD),AL1(L'QGROUP-1)                              
         DC    AL1(QSBGROUP-QRECORD),AL1(L'QSBGROUP-1)                          
         DC    AL1(QSTATION-QRECORD),AL1(L'QSTATION-1)                          
         DC    AL1(QADV-QRECORD),AL1(L'QADV-1)                                  
         DC    AL1(QAGENCY-QRECORD),AL1(L'QAGENCY-1)                            
         DC    AL1(QAGYOFF-QRECORD),AL1(L'QAGYOFF-1)                            
*                                                                               
KAC      DC    X'03'                                                            
         DC    AL1(QOFFICE-QRECORD),AL1(L'QOFFICE-1)                            
         DC    AL1(QDIV-QRECORD),AL1(L'QDIV-1)                                  
         DC    AL1(QTEAM-QRECORD),AL1(L'QTEAM-1)                                
INT3     DC    AL1(QMAN-QRECORD+2),AL1(L'QMAN-3)                                
INT1     DC    AL1(QMAN-QRECORD),AL1(L'QMAN-3)                                  
INT2     DC    AL1(QMAN-QRECORD+1),AL1(L'QMAN-3)                                
         DC    AL1(QSTATION-QRECORD),AL1(L'QSTATION-1)                          
         DC    AL1(QAGENCY-QRECORD),AL1(L'QAGENCY-1)                            
         DC    AL1(QADV-QRECORD),AL1(L'QADV-1)                                  
*                                                                               
*                                                                               
KCC      DC    X'03'                                                            
         DC    AL1(QSTATION-QRECORD),AL1(L'QSTATION-1)                          
         DC    AL1(QOFFICE-QRECORD),AL1(L'QOFFICE-1)                            
         DC    AL1(QDIV-QRECORD),AL1(L'QDIV-1)                                  
         DC    AL1(QTEAM-QRECORD),AL1(L'QTEAM-1)                                
INTT3    DC    AL1(QMAN-QRECORD+2),AL1(L'QMAN-3)                                
INTT1    DC    AL1(QMAN-QRECORD),AL1(L'QMAN-3)                                  
INTT2    DC    AL1(QMAN-QRECORD+1),AL1(L'QMAN-3)                                
         DC    AL1(QADV-QRECORD),AL1(L'QADV-1)                                  
         DC    AL1(QAGENCY-QRECORD),AL1(L'QAGENCY-1)                            
*                                                                               
* SAVE ORIGINAL DISPLACEMENTS FOR SALESPERSON IN AC KEY                         
*                                                                               
INT3SV   DC    AL1(QMAN-QRECORD+2),AL1(L'QMAN-3)                                
INT1SV   DC    AL1(QMAN-QRECORD),AL1(L'QMAN-3)                                  
INT2SV   DC    AL1(QMAN-QRECORD+1),AL1(L'QMAN-3)                                
*                                                                               
* SAVE ORIGINAL DISPLACEMENTS FOR SALESPERSON IN CC KEY                         
*                                                                               
INTT3SV  DC    AL1(QMAN-QRECORD+2),AL1(L'QMAN-3)                                
INTT1SV  DC    AL1(QMAN-QRECORD),AL1(L'QMAN-3)                                  
INTT2SV  DC    AL1(QMAN-QRECORD+1),AL1(L'QMAN-3)                                
         EJECT                                                                  
*                                                                               
*  DCB                                                                          
*                                                                               
*                   LITERAL POOL FOR PROGRAM                                    
         SPACE 3                                                                
RELO     DS    F                                                                
         LTORG                                                                  
         EJECT                                                                  
       ++INCLUDE REREPRGEQA                                                     
*                                                                               
***********************************************************************         
* DETACH FROM PRINT QUEUE SHARED MEMORY                                         
***********************************************************************         
MDETACH  NTR1  BASE=*,LABEL=*                                                   
         GOTO1 =V(DMSHMUSS),DMCB,(0,=CL8'DETACH'),(0,=CL8'PRTQ')                
         XIT1                                                                   
         LTORG                                                                  
                                                                                
***********************************************************************         
*                                                                               
*   SETMASTR:  OUT-OF-LINE SETTING OF MASTER/SUBSIDIARY RELATIONS               
*                                                                               
SETMASTR NMOD1 0,**SMAS**                                                       
         L     RC,0(R1)            RESET A(WORKSPACE)                           
         L     R3,=V(REPSREP)     GET ADDRESSIBILITY TO SUB REPS                
         USING RSREPD,R3                                                        
*                                                                               
         PRINT GEN                                                              
         LA    RF,LSUBREPS                                                      
         XCEF  SUBREPTB,(RF)       CLEAR AREA TO ZERO                           
         PRINT NOGEN                                                            
*                                                                               
         L     RE,VXADDR                                                        
         USING VXADDRD,RE                                                       
         ST    R3,VXSREP                                                        
         DROP  RE                                                               
*                                                                               
         LA    R2,SUBREPTB        REP SUB TABLE                                 
         ST    R2,ASUBREPT        ADDRESS OF NEXT ENTRY                         
         MVC   0(2,R2),=X'FFFF'   END OF TABLE MARKER                           
         MVI   FRSTMREP,0         FIRST TIME FOR CARD                           
*                                                                               
         XC    RREPKEY,RREPKEY                                                  
         MVI   RREPKTYP,X'01'                                                   
         MVC   RREPKREP,RCREPFL                                                 
         MVC   KEY,RREPKEY                                                      
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   SMAS0200                                                         
         GOTO1 =V(REPFINT),DMCB,REPEQU                                          
         BNZ   SMAS0200                                                         
         MVC   REPCLOSD,RREPPROF+10                                             
*                                  SAVE CLOSE MONTH PROFILE FLAG                
         MVC   NO$CON10,RREPPROF+22                                             
*                                  SAVE $0 CONTRACTS TO R10 FLAG                
         MVC   DAILYFLG,RREPPROF+27                                             
*                                  SAVE DAILY PACING FLAG                       
*                                                                               
*   TEST DAILY PACING FLAG                                                      
***      MVC   P+1(13),=C'DAILY PACING:'                                        
***      MVC   P+15(1),DAILYFLG                                                 
***      GOTO1 REPORT                                                           
*   TEST DAILY PACING FLAG END                                                  
*                                                                               
         CLC   RREPMAST,=X'FFFF'    IS THIS A MASTER REP?                       
         BE    SMAS0020             YES --READ ALL SUB REPS INTO TABLE          
         MVI   MASTREP,0            0=NOT MASTER REP                            
         OC    RREPMAST,RREPMAST   SUBSIDIARY?                                  
         BZ    SMAS0220            NO                                           
         CLC   RREPMAST,=C'  '     SUBSIDIARY?                                  
         BE    SMAS0220            NO                                           
         MVI   SUBREPIN,C'Y'       YES - SET FLAG TO INDICATE                   
         MVC   SUBMASTR,RREPMAST   SAVE SUB-REP'S MASTER REP                    
         B     SMAS0220                                                         
*                                                                               
SMAS0020 DS    0H                                                               
*                                  FOR MASTER REP:                              
         MVI   SUBREPIN,C'Y'       SET FLAG TO INDICATE THAT MASTER             
*                                     REP MUST BE USED                          
         MVC   SUBMASTR,RCREPFL    SAVE SUB-REP'S MASTER REP                    
         MVC   MASTRREP,RCREPFL    SAVE MASTER REP ID                           
         SR    R0,R0                                                            
         LA    R1,RREPELEM         GET SUB REPS FROM REP RECORD                 
SMAS0040 IC    R0,1(R1)            SEARCH FOR '02' ELEMENT                      
         AR    R1,R0                                                            
         CLI   0(R1),0                                                          
         BE    SMAS0180                                                         
         CLI   0(R1),2                                                          
         BNE   SMAS0040                                                         
*                                                                               
*  '02' ELEMENT FOUND:  EXTRACT COUNT, STORE CODES IN TABLE                     
*                                                                               
         ZIC   RF,2(R1)           RREPSCNT: # SUB REPS FOR MASTER               
         LR    R5,RF               SAVE FOR LOOP                                
         LA    R4,10(R1)           A(SUBSID REP CODES)                          
*                                                                               
*  SORT THE CODES IN THE REP RECORD BEFORE TABLING                              
*                                                                               
         GOTO1 XSORT,DMCB,(0,0(R4)),(RF),2,2,0                                  
*                                                                               
SMAS0060 EQU   *                                                                
         MVC   0(2,R2),0(R4)       MOVE CODE TO TABLE                           
         LA    R4,2(R4)            NEXT CODE IN REP REC                         
         LA    R2,LSUBREP(R2)      NEXT TABLE ENTRY                             
         BCT   R5,SMAS0060         LOAD ALL CODES                               
*                                                                               
SMAS0080 DS    0H                                                               
         MVC   0(2,R2),=X'FFFF'    END MARKER - FOR REP TABLE                   
         LA    R2,SUBREPTB         PT BACK TO BEGINNING OF TABLE                
SMAS0100 EQU   *                                                                
         CLC   0(2,R2),=X'FFFF'    END OF TABLE?                                
         BE    SMAS0160            YES                                          
         XC    RREPKEY,RREPKEY     RETRIEVE SHORT NAME FOR REP                  
         MVI   RREPKTYP,X'01'                                                   
         MVC   RREPKREP,0(R2)                                                   
         MVC   KEY,RREPKEY                                                      
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   SMAS0120                                                         
         GOTO1 =V(REPFINT),DMCB,REPEQU                                          
         BZ    SMAS0140                                                         
SMAS0120 DC    H'0'                                                             
*                                                                               
*   REP RECORD RETURNED:  LOAD SHORT NAME INTO TABLE ENTRY OF                   
*     CODE                                                                      
*                                                                               
SMAS0140 EQU   *                                                                
         MVC   2(20,R2),RREPSHRT   LOAD SHORT NAME                              
         LA    R2,LSUBREP(R2)                                                   
         B     SMAS0100                                                         
*                                                                               
SMAS0160 EQU   *                                                                
         LA    R2,SUBREPTB        PT BACK TO BEGINNING OF TABLE                 
         MVC   RCREPFL,0(R2)      MOVE IN FIRST REP FOR GOTO1                   
         MVI   MASTREP,1          1=THIS IS A MASTER REP                        
         LA    R2,LSUBREP(R2)                                                   
         ST    R2,ASUBREPT         ADDRESS OF NEXT REP IN TABLE                 
*                                                                               
*    READ THE REP RECORD FOR 'MASTER' REP                                       
*                                                                               
SMAS0180 EQU   *                                                                
         MVC   RCREPFL,MASTRREP    RESTORE REQUEST REP ID                       
         XC    RREPKEY,RREPKEY                                                  
         MVI   RREPKTYP,X'01'                                                   
         MVC   RREPKREP,RCREPFL                                                 
         MVC   KEY,RREPKEY                                                      
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   SMAS0200                                                         
         GOTO1 =V(REPFINT),DMCB,REPEQU                                          
         BNZ   SMAS0200                                                         
*                                                                               
         B     SMAS0220                                                         
SMAS0200 EQU   *                                                                
         LTR   RB,RB               SET CC NOT ZERO                              
         B     SMAS0240                                                         
SMAS0220 EQU   *                                                                
         SR    R0,R0                                                            
SMAS0240 EQU   *                                                                
         XIT1                                                                   
         DROP  R3                                                               
         LTORG                                                                  
         EJECT                                                                  
*              ADDITIONAL INFORMATION TO OPTIMISE VALUEMON                      
         SPACE 3                                                                
SETUPMON NMOD1 0,*SETUPMON*                                                     
         L     RC,0(R1)                                                         
*                                                                               
*   TEST SETUPMON                                                               
***      MVC   P+1(15),=C'SETUPMON: QASAT'                                      
***      MVC   P+18(6),QASAT                                                    
***      GOTO1 REPORT                                                           
*        TEST END                                                               
*                                                                               
         L     RF,ANEWMON          INITIALIZE NEW MONTH TABLE                   
         XCEFL 0(RF),31936         TO LOW VALUE (32,000 - 64)                   
*                                     64 REPRESENTS L(CONTROL AREA)             
         CLC   QPROG,=C'80'        SPL ONLY NEEDS MONINFO                       
         BE    SETUP4                                                           
         BAS   RE,ASATPROC         SET UP AS AT DATES                           
*                                                                               
         CLC   QSTART+4(2),SPACES                                               
         BE    SETUP3                                                           
         MVC   WORK(6),QSTART                                                   
         MVC   WORK+6(6),QEND                                                   
         PACK  DUB(2),WORK(2)      REQUEST START DATE                           
         SP    DUB(2),=P'1'        SUBTRACT 1 FROM REQ START DATE               
         UNPK  WORK(2),DUB(2)                                                   
         OI    WORK+1,X'F0'                                                     
         PACK  DUB(2),WORK+6(2)    REQUEST END DATE                             
         SP    DUB(2),=P'1'        SUBTRACT 1 FROM REQ END   DATE               
         UNPK  WORK+6(2),DUB(2)                                                 
         OI    WORK+7,X'F0'                                                     
*                                                                               
*   FOUR MONTH ACTIVITY DATES ARE CALCULATED:  THIS YEAR START/END,             
*     LAST YEAR START/END                                                       
*                                                                               
         GOTO1 GETMDAY,DMCB,QSTART,MONACT                                       
         GOTO1 (RF),(R1),QEND,MONACT+2                                          
         GOTO1 (RF),(R1),WORK,MONACT+4                                          
         GOTO1 (RF),(R1),WORK+6,MONACT+6                                        
         SPACE 4                                                                
SETUP3   CLC   QPROG,=C'20'        SET UP START-END OF KEYMONTH                 
         BE    SETUP3A              FOR 20/21/34/35/47                          
         CLC   QPROG,=C'21'                                                     
         BE    SETUP3A                                                          
         CLC   QPROG,=C'34'                                                     
         BE    SETUP3A                                                          
         CLC   QPROG,=C'35'                                                     
         BE    SETUP3A                                                          
         CLC   QPROG,=C'47'                                                     
         BNE   SETUP4                                                           
*                                                                               
SETUP3A  CLC   QEND,SPACES                                                      
         BE    SETUP4                                                           
         MVC   DUB(4),QEND                                                      
         MVC   DUB+4(2),=C'01'                                                  
         GOTO1 DATCON,DMCB,DUB,(3,THREE)                                        
         XC    KEY,KEY             BUILD EOM KEY                                
         MVI   KEY,X'18'                                                        
         MVC   KEY+24(2),QREP                                                   
         MVC   KEY+26(1),THREE                                                  
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   ENDREQ                                                           
         CLC   KEY(27),KEYSAVE                                                  
         BE    SETUP3B                                                          
         MVC   P+1(36),=C'NO EOM RECORD FOUND:  REPORT SKIPPED '                
         MVC   FULL,HEADHOOK       SAVE A(HEADHOOK ROUTINE)                     
         XC    HEADHOOK,HEADHOOK   WIPE IT OUT                                  
         GOTO1 REPORT                                                           
         MVC   HEADHOOK,FULL       RESTORE A(HEADHOOK ROUTINE)                  
         MVC   QUESTOR(6),=C'NO EOM'                                            
*                                     SET 'SKIP REPORT' FLAG                    
         B     SETUPXT2                                                         
SETUP3B  EQU   *                                                                
         GOTO1 =V(REPFINT),DMCB,EOMEQU                                          
         BNZ   ENDREQ                                                           
         ZIC   R2,THREE+1                                                       
         BCTR  R2,0                                                             
         SPACE 1                                                                
         CLC   QPROG,=C'47'           IF 47 AND                                 
         BE    SETUP3D                                                          
         CLC   QPROG,=C'35'                                                     
         BNE   SETUP3L                                                          
*                                                                               
SETUP3D  CLI   QOPTION4,C'A'          ASAT NEEDED FOR EST REPORT,THEN           
         BNE   SETUP3L                                                          
         BCTR  R2,0                   USE MONTH BEFORE QEND AS QEND             
         SPACE 1                                                                
SETUP3L  SLL   R2,1                                                             
         LA    R2,REOMDATE(R2)                 GET MONTH BEFORE                 
         MVC   HALF,0(R2)                      END OF 'MONTH BEFORE'            
*                                                                               
*   IF REQUESTOR BEGINS WITH 'EOM=', THE SIX BYTES FOLLOWING CONTAIN            
*     AN EOM OVERRIDE DATE WHICH MUST BE CONVERTED TO TWO-BYTE                  
*     FORMAT BEFORE REPLACING THE VALUE TAKEN FROM THE EOM RECORD.              
*     THIS VALUE IS THE END-OF-MONTH DATE OF THE MONTH BEFORE THAT              
*     WITH WHICH THE REPORT IS CONCERNED.                                       
*     THIS IS FOLLOWED BY '/#', WHERE # IS NUMBER OF WEEKS IN THE               
*     PERIOD.  THIS IS USED TO CALCULATE THE END DATE                           
*                                                                               
         CLC   QUESTOR(4),=C'EOM='              EOM OVERRIDE?                   
         BNE   SETUP3M                          NO                              
         GOTO1 DATCON,DMCB,QUESTOR+4,(2,HALF)                                   
SETUP3M  EQU   *                                                                
*                                                                               
*   CONVERT 'END DATE OF MONTH BEFORE'                                          
*                                                                               
         GOTO1 DATCON,DMCB,(2,HALF),WORK                                        
*                                                                               
*   ADD 1 DAY TO GET DATE OF 1ST DATE OF NEXT MONTH                             
*                                                                               
         GOTO1 ADDAY,(R1),WORK,WORK+6,1                                         
         GOTO1 DATCON,(R1),WORK+6,(2,KEYMONTH)                                  
*                                                                               
*   IF REQUESTOR = 'EOM=', THE END OF THE 'NEXT MONTH' IS CALCULATED            
*      FROM THE VALUE ENTERED AS '/#', WHERE # IS THE NUMBER OF WEEKS           
*      IN THE PERIOD.                                                           
*                                                                               
         CLC   QUESTOR(4),=C'EOM='              EOM OVERRIDE?                   
         BNE   SETUP3Q                          NO                              
         ZIC   R1,QUESTOR+11       YES - GET # OF WEEKS                         
         SLL   R1,28               DROP ZONE BITS                               
         SRL   R1,28                                                            
         SR    R3,R3               INITIALIZE DAY COUNTER                       
SETUP3N  EQU   *                                                                
         LA    R3,7(R3)            ADD 1 WEEK'S DAYS                            
         BCT   R1,SETUP3N          LOOP NUMBER OF WEEKS                         
         GOTO1 ADDAY,DMCB,WORK,WORK+6,(R3)                                      
         GOTO1 DATCON,(R1),WORK+6,(2,KEYMONTH+2)                                
         B     SETUP3R                                                          
SETUP3Q  EQU   *                                                                
         MVC   KEYMONTH+2(2),2(R2)              END OF THIS MONTH               
SETUP3R  EQU   *                                                                
*                                                                               
*                                                                               
*   BUILD MONTHLY INFORMATION LIST                                              
*     EACH ENTRY CONSISTS OF 16 BYTES:                                          
*        BYTES   1-2   -  CURRENT YEAR MONTH (START-END DATES USED)             
*        BYTE    3     -  28/35 DAYS (4/5 WEEK MONTH)                           
*        BYTE    4     -  # DAYS IN MONTH                                       
*        BYTES   5-6   -  PRIOR   YEAR MONTH (START-END DATES USED)             
*        BYTE    7     -  28/35 DAYS (4/5 WEEK MONTH)                           
*        BYTE    8     -  # DAYS IN MONTH                                       
*        BYTES   9-10  -  2YR PRI YEAR MONTH (START-END DATES USED)             
*        BYTE    11    -  28/35 DAYS (4/5 WEEK MONTH)                           
*        BYTE    12    -  # DAYS IN MONTH                                       
*        BYTES   13-14 -  NEXT    YEAR MONTH (START-END DATES USED)             
*        BYTE    15    -  28/35 DAYS (4/5 WEEK MONTH)                           
*        BYTE    16    -  # DAYS IN MONTH                                       
*                                                                               
SETUP4   EQU   *                                                                
         L     R3,AMONINFO         A(MONTH INFO TABLE)                          
         LA    R4,24                                                            
         BAS   RE,SETDATES         ESTABLISH DATE RANGE FOR REQUEST             
         BNZ   SETUP8              NO DATES - SKIP SETUP                        
         MVC   WORK+40(4),WORK+32  SET START DATE FOR LOOP                      
         MVC   WORK+44(2),=C'01'   SET DAY TO 01                                
         MVC   WORK+46(4),WORK+36  SET END   DATE FOR LOOP                      
         MVC   WORK+50(2),=C'01'   SET DAY TO 01                                
*                                                                               
         LA    R2,WORK+40                                                       
*                                                                               
         GOTO1 DATCON,DMCB,(0,WORK+40),(3,WORK+54)                              
*                                  CONVERT START DATE TO BINARY                 
         GOTO1 DATCON,DMCB,(0,WORK+46),(3,WORK+57)                              
*                                  CONVERT END   DATE TO BINARY                 
*                                                                               
SETUP6   EQU   *                                                                
*                                                                               
         CLC   WORK+54(3),WORK+57  HAS LAST MONTH BEEN DONE?                    
         BH    SETUP8              YES                                          
*   CURRENT YEAR'S MONTH                                                        
*                                                                               
         GOTO1 DATCON,DMCB,(0,(R2)),(3,(R3))   YYMMDD->YMD (BINARY)             
         GOTO1 GETBROAD,DMCB,(R2),WORK         BDCST MONTH DATES                
         MVI   2(R3),28            SET # DAYS = 4 WEEKS                         
         CLI   DMCB,5              FIVE-WEEK BDCST MONTH?                       
         BNE   *+8                 NO                                           
         MVI   2(R3),35            YES - SET # DAYS = 5 WEEKS                   
*                                                                               
*   PRIOR YEAR'S MONTH                                                          
*                                                                               
         MVC   WORK(6),0(R2)       CONVERT DATE'S YEAR                          
         GOTO1 DATCON,DMCB,(0,WORK),(3,WORK+60)                                 
*                                  CONVERT DATE FOR ARITHMETIC USE              
         ZIC   RF,WORK+60          STRIP OUT YEAR                               
         BCTR  RF,0                CALCULATE PRIOR YEAR                         
         STC   RF,WORK+60          PUT IT BACK                                  
         GOTO1 DATCON,DMCB,(3,WORK+60),(X'20',WORK)                             
*                                  CONVERT DATE BACK TO EBCDIC                  
         GOTO1 DATCON,DMCB,(0,WORK),(3,4(R3))  YYMMDD->YMD (BINARY)             
         GOTO1 GETBROAD,DMCB,WORK,WORK+6       BDCST MONTH DATES                
         MVI   6(R3),28            SET # DAYS = 4 WEEKS                         
         CLI   DMCB,5              FIVE-WEEK BDCST MONTH?                       
         BNE   *+8                 NO                                           
         MVI   6(R3),35            YES - SET # DAYS = 5 WEEKS                   
*                                                                               
*   2 YRS PRIOR  MONTH                                                          
*                                                                               
         ZIC   RF,WORK+60          SUBTRACT 1 MORE YEAR                         
         BCTR  RF,0                CALCULATE 2 YRS PRIOR                        
         STC   RF,WORK+60                                                       
         GOTO1 DATCON,DMCB,(3,WORK+60),(X'20',WORK)                             
*                                  CONVERT DATE BACK TO EBCDIC                  
         GOTO1 DATCON,DMCB,(0,WORK),(3,8(R3))  YYMMDD->YMD (BINARY)             
         GOTO1 GETBROAD,DMCB,WORK,WORK+6       BDCST MONTH DATES                
         MVI   10(R3),28           SET # DAYS = 4 WEEKS                         
         CLI   DMCB,5              FIVE-WEEK BDCST MONTH?                       
         BNE   *+8                 NO                                           
         MVI   10(R3),35           YES - SET # DAYS = 5 WEEKS                   
*                                                                               
*   NEXT YEAR'S  MONTH                                                          
*                                                                               
         ZIC   RF,WORK+60          STRIP YEAR AGAIN                             
         LA    RF,3(RF)            ADD 3 YRS TO CALC NEXT YEAR                  
         STC   RF,WORK+60                                                       
         GOTO1 DATCON,DMCB,(3,WORK+60),(X'20',WORK)                             
*                                  CONVERT DATE BACK TO EBCDIC                  
         GOTO1 DATCON,DMCB,(0,WORK),(3,12(R3)) YYMMDD->YMD (BINARY)             
         GOTO1 GETBROAD,DMCB,WORK,WORK+6       BDCST MONTH DATES                
         MVI   14(R3),28           SET # DAYS = 4 WEEKS                         
         CLI   DMCB,5              FIVE-WEEK BDCST MONTH?                       
         BNE   *+8                 NO                                           
         MVI   14(R3),35           YES - SET # DAYS = 5 WEEKS                   
*                                                                               
         SR    R5,R5               DAYS IN CAL. MONTH                           
         IC    R5,1(R3)                                                         
         LA    R5,DPMTABLE-1(R5)                                                
         MVC   3(1,R3),0(R5)       CURRENT YEAR                                 
         MVC   7(1,R3),0(R5)       PRIOR YEAR                                   
         MVC   11(1,R3),0(R5)      2 YRS PRIOR                                  
         MVC   15(1,R3),0(R5)      NEXT YEAR                                    
         GOTO1 ADDAY,DMCB,(R2),(X'20',0(R2)),45                                 
*                                  BUMP START DATE 1 MONTH                      
*                                                                               
*   TEST ADDAY                                                                  
*        MVC   P+1(08),=C'ADDAY:  '                                             
*        MVC   P+10(20),WORK+40                                                 
*        MVC   P+40(20),0(R2)                                                   
*        GOTO1 REPORT                                                           
*   TEST ADDAY END                                                              
*                                                                               
         MVC   4(2,R2),=C'01'      RESET DAY TO 1                               
         GOTO1 DATCON,DMCB,(0,0(R2)),(3,WORK+54)                                
*                                  CONVERT NEXT MONTH DATE TO BINARY            
         LA    R3,NXMONINF(R3)     A(NEXT MONINFO ENTRY)                        
         BCT   R4,SETUP6                                                        
         SPACE 3                                                                
SETUP8   EQU   *                                                                
         L     R2,AMONINFO         SET UP DATE PARAMS FOR K FILTERS             
         MVC   CURDTST,0(R2)       LOAD 1ST SET OF DATES                        
         MVC   PRIDTST,4(R2)                                                    
         MVC   CURDTEND,0(R2)                                                   
         MVC   PRIDTEND,4(R2)                                                   
SETUP8A  CLI   16(R2),0            NEXT ENTRY EMPTY?                            
         BE    SETUP9              YES                                          
*                                                                               
         LA    R2,16(R2)                                                        
         CLC   CURDTST,0(R2)                                                    
         BL    SETUP8B                                                          
         MVC   CURDTST,0(R2)                                                    
         MVC   PRIDTST,4(R2)                                                    
         B     SETUP8A                                                          
SETUP8B  CLC   CURDTEND,0(R2)                                                   
         BH    SETUP8A                                                          
         MVC   CURDTEND,0(R2)                                                   
         MVC   PRIDTEND,4(R2)                                                   
         B     SETUP8A                                                          
         SPACE 1                                                                
*                                  TEST IF LAST YEAR'S DATA NEEDED              
SETUP9   EQU   *                                                                
         LA    R2,SPRPTTBL                                                      
SETUP10  CLI   0(R2),C' '                                                       
         BE    SETUPXIT                                                         
         CLC   QPROG,0(R2)                                                      
         BE    *+12                                                             
         LA    R2,2(R2)                                                         
         B     SETUP10                                                          
         XC    PRIDTST(4),PRIDTST                                               
         SPACE 2                                                                
SETUPXIT EQU   *                                                                
         CLC   QSTART(12),SPACES   ANY DATES?                                   
         BE    SETUPXT2            NO                                           
         BAS   RE,SETMONTB         SET MAIN VALUENEW TABLE                      
SETUPXT2 EQU   *                                                                
         XIT1                                                                   
         SPACE 2                                                                
DPMTABLE DC    AL1(31,28,31,30,31,30,31,31,30,31,30,31)                         
         EJECT                                                                  
*                                                                               
*   ROUTINE TO USE REQUEST DATES TO ESTABLISH A MONTH TABLE WHICH               
*     HOLDS 5-6 YEARS DOLLAR INFORMATION                                        
* !!!   NOTE    !!!                                                             
*       IF START AND END DATES ARE MORE THAN 6 YEARS APART (72 MOS)             
*       THERE IS A PROBLEM:  TABLE WON'T HANDLE THIS RANGE.  72 MOS,            
*       BEGINNING WITH JANUARY OF THE EARLIEST YEAR REQUESTED, WILL             
*       BE LOADED, AND THE REMAINDER WILL FALL INTO NEVER-NEVER LAND.           
*       IF NO END DATE ENTERED, DEFAULT END DATE TO START DATE IN               
*       WORK AREA ONLY                                                          
*                                                                               
SETMONTB NTR1                                                                   
*                                                                               
         MVC   WORK+32(6),QSTART   SET START DATE                               
         MVC   WORK+38(6),QEND     SET END   DATE                               
         CLC   QEND(6),SPACES      ANY END DATE ENTERED?                        
         BNE   SETM0000            YES                                          
         MVC   WORK+38(6),QSTART   NO  - DEFAULT END TO START                   
SETM0000 EQU   *                                                                
         MVC   WORK+36(2),=C'01'   SET START DATE DAY = 01                      
         MVC   WORK+42(2),=C'01'   SET END   DATE DAY = 01                      
         GOTO1 DATCON,DMCB,(0,WORK+32),(3,WORK+60)                              
*                                  CONVERT START DATE TO 3-BYTE BINARY          
         ZIC   RF,WORK+60          TAKE YEAR FROM DATE                          
         SH    RF,=H'3'            CALCULATE START = 3 YRS PRIOR                
         STC   RF,WORK+60          REPLACE YEAR IN DATE                         
****>>>  GOTO1 DATCON,DMCB,(3,WORK+60),(X'20',WORK+32)                          
*                                                                               
*   TEST                                                                        
*        MVC   P+1(09),=C'X20 CALL:'                                            
*        GOTO1 HEXOUT,DMCB,WORK+60,P+12,3,=C'TOG'                               
*        MVC   P+24(6),WORK+32                                                  
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
         GOTO1 DATCON,DMCB,(3,WORK+60),(0,WORK+32)                              
*                                                                               
*   TEST                                                                        
*        MVC   P+1(09),=C'000 CALL:'                                            
*        GOTO1 HEXOUT,DMCB,WORK+60,P+12,3,=C'TOG'                               
*        MVC   P+24(6),WORK+32                                                  
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
*                                                                               
         GOTO1 DATCON,DMCB,(0,WORK+38),(3,WORK+60)                              
*                                  CONVERT END   DATE TO 3-BYTE BINARY          
         ZIC   RF,WORK+60          TAKE YEAR FROM DATE                          
         LA    RF,1(RF)            CALCULATE END   = 3 YR HENCE                 
         STC   RF,WORK+60          REPLACE YEAR IN DATE                         
***>>>   GOTO1 DATCON,DMCB,(3,WORK+60),(X'20',WORK+38)                          
         GOTO1 DATCON,DMCB,(3,WORK+60),(0,WORK+38)                              
*                                                                               
         L     R4,ANEWMON          A(NEW MONTH TABLE)                           
         MVC   WORK+34(4),=C'0101' SET EARLIEST DATE TO JAN/1                   
         MVC   0(6,R4),WORK+32     LOAD EARLIEST DATE                           
         LA    R5,71               72 BUCKETS TOTAL: 1ST LOADED                 
*                                                                               
*   TEST                                                                        
*        MVC   P+1(12),=C'ARRAY RANGE:'                                         
*        MVC   P+15(12),WORK+32                                                 
*        GOTO1 REPORT                                                           
*   TEST END                                                                    
*                                                                               
SETM0004 EQU   *                                                                
         CLC   0(4,R4),WORK+38     ALL DATES LOADED?                            
         BE    SETM0008            YES - NOW SEED OTHER DATES                   
         LA    R6,NEXTBUCK(R4)     SET A(NEXT DATE ENTRY)                       
         GOTO1 ADDAY,DMCB,(R4),(R6),45    CALC MIDDLE OF NEXT MONTH             
***      GOTO1 DATCON,DMCB,(0,0(R6)),(X'20',WORK+58)                            
***                                DROP SPECIAL 2000 SETUP                      
***      MVC   0(6,R6),WORK+58     MOVE TO NEWMON                               
         MVC   4(2,R6),=C'01'      SET DAY OF NEXT MONTH                        
         LR    R4,R6                                                            
         BCT   R5,SETM0004         DO NEXT DATE                                 
SETM0008 EQU   *                                                                
         L     R4,ANEWMON          RESET START OF TABLE                         
         GOTO1 DATCON,DMCB,(0,WORK+32),(3,WORK+44) YYMMDD->YMD (BIN)            
         GOTO1 DATCON,DMCB,(0,WORK+38),(3,WORK+47) YYMMDD->YMD (BIN)            
         MVC   WORK(2),WORK+44     CURRENT START DATE (2-BYTE)                  
SETM0012 EQU   *                                                                
         MVC   8(2,R4),WORK        SET CURRENT START DATE                       
         ZIC   RF,WORK                                                          
         BCTR  RF,0                DECREMENT YEAR BY 1                          
         STC   RF,WORK             TO CALCULATE PRIOR YEAR                      
         MVC   10(2,R4),WORK       SET PRIOR DATE                               
         BCTR  RF,0                SUBTRACT ANOTHER TO CALCULATE                
         STC   RF,WORK             2 YEARS PRIOR                                
         MVC   12(2,R4),WORK       SET 2 YEARS PRIOR                            
         LA    RF,3(RF)            CALCULATE NEXT YEARS DATE                    
         STC   RF,WORK                                                          
         MVC   14(2,R4),WORK       SET NEXT YEARS DATE                          
         CLI   WORK+1,12           IS IT DECEMBER?                              
         BL    SETM0016            NO                                           
         MVI   WORK+1,1            YES - SET MONTH TO JAN                       
*                                  YEAR IS ALREADY SET TO NEXT YEAR             
         B     SETM0020                                                         
SETM0016 EQU   *                                                                
         BCTR  RF,0                DECREMENT NEXT YEAR TO THIS YEAR             
         STC   RF,WORK             RESET YEAR TO CURRENT                        
         ZIC   RF,WORK+1           INCREMENT MONTH                              
         LA    RF,1(RF)                                                         
         STC   RF,WORK+1           RESTORE NEW MONTH                            
SETM0020 EQU   *                                                                
         CLC   WORK+47(2),WORK     END REACHED?                                 
         BL    SETM0024            YES                                          
         LA    R4,NEXTBUCK(R4)     NO  - NEXT TABLE ENTRY                       
         B     SETM0012            GO BACK AND DO NEXT                          
SETM0024 EQU   *                                                                
*                                                                               
*   TEST                                                                        
         CLC   =C'DUMPARRAY',QUESTOR                                            
         BNE   SETM0030                                                         
         L     R4,ANEWMON                                                       
TESTSM20 EQU   *                                                                
         OC    0(16,R4),0(R4)      ANY ENTRY                                    
         BZ    XIT                                                              
         MVC   P+1(07),=C'NEWMON:'                                              
         MVC   P+10(20),0(R4)                                                   
         GOTO1 REPORT                                                           
         LA    R4,NEXTBUCK(R4)                                                  
         B     TESTSM20            GO BACK FOR NEXT                             
*   END TEST                                                                    
*                                                                               
SETM0030 EQU   *                                                                
         B     XIT                                                              
         EJECT                                                                  
*                                                                               
SPRPTTBL DC    C'10',C'16',C'17',C'18',C'19'                                    
         DC    C'1B',C'1D',C'20',C'21',C'25'                                    
         DC    C'34',C'35',C'37',C'40',C'42'                                    
         DC    C'47',C'90'                                                      
*  THESE REPORTS DON'T NEED PRIOR DATA                                          
**       ROUTINE RETURNS MONDAY DATE FOR WEEK GIVEN                             
*         INPUT = YYMMDD                                                        
*         OUTPUT= 2-BYTE BINARY                                                 
         SPACE 3                                                                
GETMDAY  NTR1                                                                   
         LM    R5,R6,0(R1)         R5=A(INPUT), R6=A(OUTPUT)                    
         CLC   0(6,R5),=C'940229' ****2YR PRIOR OF LEAP YR 96 ****              
         BE    GETM10                                                           
         CLC   0(6,R5),=C'950229' ****PRIOR YEAR FOR LEAP YR 96 ****            
         BE    GETM10                                                           
         CLC   0(6,R5),=C'970229' ****NEXT YEAR FOR LEAP YR 96 ****             
         BE    GETM10                                                           
         CLC   0(6,R5),=C'980229' ****2YR PRIOR OF LEAP YR 00 ****              
         BE    GETM10                                                           
         CLC   0(6,R5),=C'990229' ****PRIOR YEAR FOR LEAP YR 00 ****            
         BE    GETM10                                                           
         CLC   0(6,R5),=C'010229' ****NEXT YEAR FOR LEAP YR 00 ****             
         BE    GETM10                                                           
         CLC   0(6,R5),=C'020229' ****2YR PRIOR OF LEAP YR 04 ****              
         BE    GETM10                                                           
         CLC   0(6,R5),=C'030229' ****PRIOR YEAR FOR LEAP YR 04 ****            
         BE    GETM10                                                           
         CLC   0(6,R5),=C'050229' ****NEXT YEAR FOR LEAP YR 04 ****             
         BNE   GETM12                                                           
GETM10   EQU   *                                                                
         MVC   3(3,R5),=C'301'     ***PREVIOUS YEAR MUST BE MARCH 01***         
GETM12   EQU   *                                                                
         GOTO1 GETDAY,DMCB,(R5),FULL                                            
         CLC   FULL(3),SPACES                                                   
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         SR    RE,RE                                                            
         IC    RE,DMCB             DAY NUMBER                                   
         BCTR  RE,R0                                                            
         LNR   RE,RE                                                            
*                                                                               
         L     R3,=V(REPSREP)                                                   
         USING RSREPD,R3                                                        
*                                                                               
         CLI   DAILYFLG,C'Y'       DAILY PACING?                                
         BNE   GETM0030            NO                                           
         SR    RE,RE               CLEAR DAY ADJUSTMENT                         
GETM0030 EQU   *                                                                
         ST    RE,DMCB+8           PUT IN NUMBER OF DAYS TO SUBTRACT            
*                                                                               
         GOTO1 ADDAY,DMCB,(R5),DUB                                              
*                                                                               
         GOTO1 DATCON,(R1),DUB,(2,(R6))                                         
*                                                                               
*                                                                               
*   TEST DAILY PACING FLAG                                                      
**       MVC   P+1(13),=C'DAILY GETM  :'                                        
**       MVC   P+15(1),DAILYFLG                                                 
**       MVI   P+16,C'/'                                                        
**       MVC   P+17(6),DUB                                                      
**       MVI   P+23,C'/'                                                        
**       MVC   P+24(2),0(R6)                                                    
**       GOTO1 REPORT                                                           
*   TEST DAILY PACING FLAG END                                                  
*                                                                               
         XIT1                                                                   
         DROP  R3                                                               
         EJECT                                                                  
*                                                                               
*  THIS ROUTINE SETS 'FORECAST' DATE BUCKETS USING AS AT DATES.  IF             
*     AN AS-AT TO-DATE HAS BEEN ENTERED, INDICATING A REQUEST FOR               
*     AS-AT RANGE TESTING, FOUR ADDITIONAL DATES ARE GENERATED.                 
*                                                                               
ASATPROC NTR1                                                                   
         GOTO1 DATCON,DMCB,(4,RCDATE),(0,WORK)                                  
         CLC   QASAT,SPACES                                                     
         BE    *+10                                                             
         MVC   WORK(6),QASAT                                                    
         L     R6,AMONFORC         A(MONTH FORECAST DATE TABLE)                 
         XC    0(16,R6),0(R6)      INITIALIZE EIGHT ENTRIES                     
*                                                                               
*   SET 'CURRENT AS-AT DATE' (FROM), AND THREE DATES BASED ON IT                
*                                                                               
         GOTO1 SET4DATS,DMCB,(R6)                                               
*                                                                               
*   CHECK FOR AN AS-AT TO-DATE.  IF PRESENT, INSERT FOUR DATES                  
*                                                                               
         L     RF,=V(RQSTNUM)      HOW MANY REQUEST CARDS?                      
         CLI   0(RF),1             SINGLE CARD?                                 
         BE    ASPO0000            YES - FINISHED                               
         L     RF,=V(RQSTCARD)     A(REQUEST CARD)                              
         CLC   ASATTODT(6,RF),SPACES     ANY AS-AT TO-DATE?                     
         BE    ASPO0000            NO  - FINISHED                               
         MVC   WORK(6),ASATTODT(RF)      LOAD AS-AT TO-DATE                     
         L     R6,AMONFORC                                                      
         LA    R6,8(R6)            A(MON FCST TABLE: TO-DATES)                  
*                                                                               
*   SET 'CURRENT AS-AT DATE' (TO), AND THREE DATES BASED ON IT                  
*                                                                               
         GOTO1 SET4DATS,DMCB,(R6)                                               
*                                                                               
ASPO0000 EQU   *                                                                
         CLC   =C'DUMPMONFOR',QUESTOR    REQUEST FOR TABLE DUMP?                
         BNE   ASPO0099            NO  - FINISHED                               
*                                                                               
*   SPECIAL REQUEST TO DISPLAY THE TABLE, THEN DUMP RUN                         
*                                                                               
         LA    R6,P                SET A(PRINT LINE)                            
         L     R5,AMONFORC         A(MONTH FORECAST TABLE)                      
         LA    R0,8                LOOP CONTROL                                 
ASPO0004 EQU   *                                                                
         CLC   0(2,R5),=X'0000'    ANY ENTRY?                                   
         BE    ASPO0008            NO                                           
         GOTO1 DATCON,DMCB,(2,(R5)),(0,(R6))                                    
         LA    R6,8(R6)            A(PRINT ENTRY)                               
ASPO0008 EQU   *                                                                
         LA    R5,2(R5)            A(NEXT MONFOR ENTRY)                         
         BCT   R0,ASPO0004         GO BACK FOR NEXT                             
         GOTO1 REPORT              PRINT OUT THE LINE                           
ASPO0099 EQU   *                                                                
         B     XIT                                                              
         EJECT                                                                  
*                                                                               
*  THIS ROUTINE SETS THE SET OF FOUR DATES FOR AS-AT PROCESSING.                
*                                                                               
SET4DATS NTR1                                                                   
         L     R6,0(R1)            RESET A(TABLE ENTRIES)                       
         GOTO1 GETMDAY,DMCB,WORK,(R6)    CURRENT AS-AT DATE                     
         LA    R6,2(R6)            A(PRIOR AS-AT DATE)                          
*                                                                               
* GET BROADCAST YEAR OF AS-AT DATE:  MAY NOT BE SAME - IE:                      
*    DEC30/91 IS BROADCAST YEAR 92.  (CHECK THE CALENDAR).                      
*    TAKE THE YEAR FROM THE TO-DATE PORTION, FOR SAME REASON.                   
*                                                                               
         GOTO1 GETBROAD,DMCB,WORK,WORK+12                                       
         MVC   WORK+6(2),WORK+18   CALCULATE START BDCST YEAR                   
         MVC   WORK+8(4),=C'0115'  SET JAN15 OF YEAR                            
         GOTO1 GETBROAD,DMCB,WORK+6,WORK+12                                     
*                                                                               
*  CALCULATE WEEK # FROM BDCAST YEAR START THRU CURR AS AT DATE                 
*                                                                               
         GOTO1 =V(PERVERT),DMCB,WORK+12,WORK                                    
         ZICM  RF,DMCB+12,2        SAVE WEEK# OF CURR AS AT DATE                
         OC    DMCB+10(2),DMCB+10  ANY PERVERT DAYS REMAINING?                  
         BNZ   S4DA0004            YES - DON'T ADJUST WEEK #                    
         BCTR  RF,0                NO  - DECREMENT WEEK #                       
S4DA0004 EQU   *                                                                
         STCM  RF,3,WORK+32        SAVE WEEK# OF CURR AS AT DATE                
         GOTO1 DATCON,DMCB,(0,WORK+6),(3,DOUBLE)                                
         ZIC   RF,DOUBLE           EXTRACT YEAR FROM DATE                       
         BCTR  RF,0                SUBTRACT 1 FROM YEAR                         
         STC   RF,DOUBLE           PUT YEAR BACK                                
         GOTO1 DATCON,DMCB,(3,DOUBLE),(0,WORK+6)                                
         GOTO1 SETASAT,DMCB,(R6)                                                
         LA    R6,2(R6)            A(2YR PRIOR AS AT DATE)                      
         GOTO1 DATCON,DMCB,(0,WORK+6),(3,DOUBLE)                                
         ZIC   RF,DOUBLE           EXTRACT YEAR FROM DATE                       
         BCTR  RF,0                SUBTRACT 1 FROM YEAR                         
         STC   RF,DOUBLE           PUT YEAR BACK                                
         GOTO1 DATCON,DMCB,(3,DOUBLE),(0,WORK+6)                                
         GOTO1 SETASAT,DMCB,(R6)                                                
         LA    R6,2(R6)            A(NEXT YEAR AS AT DATE)                      
         GOTO1 DATCON,DMCB,(0,WORK+6),(3,DOUBLE)                                
         ZIC   RF,DOUBLE           EXTRACT YEAR FROM DATE                       
         LA    RF,3(RF)            ADD 3:  CALCULATE NEXT YEAR                  
         STC   RF,DOUBLE           PUT YEAR BACK                                
         GOTO1 DATCON,DMCB,(3,DOUBLE),(0,WORK+6)                                
         GOTO1 SETASAT,DMCB,(R6)                                                
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*  THIS ROUTINE CALCULATES THE MONDAY DATE OF THE NTH WEEK OF THE               
*     BROADCAST YEAR                                                            
*                                                                               
SETASAT  NTR1                                                                   
         L     R6,0(R1)            RESET A(MONFORC TABLE ENTRY)                 
         GOTO1 GETBROAD,DMCB,WORK+6,WORK+12                                     
         ZICM  R2,WORK+32,2        INSERT WEEK# OF CURRENT DATE                 
         CH    R2,=H'52'           IS CURRENT WEEK # 53?                        
*                                                                               
*   WEEK # IS UNDERSTATED BY 1.  DAYS 1-7 ARE WEEK 1, BUT PERVERT               
*    CALCULATION RETURNS 0.                                                     
*                                                                               
         BNE   SASA0004            NO                                           
         BCTR  R2,0                YES - SET IT TO 52 FOR OTHER YEARS           
SASA0004 EQU   *                                                                
         MH    R2,=H'7'            MULT BY 7 = # OF DAYS                        
         PRINT GEN                                                              
         GOTO1 ADDAY,DMCB,WORK+12,WORK+18,(R2)                                  
         PRINT NOGEN                                                            
         GOTO1 GETMDAY,DMCB,WORK+18,(R6)                                        
*                                                                               
*   FINAL CALL INSERTS MONDAY DATE OF WEEK# INTO MONFOR TABLE                   
*                                                                               
         XIT1                                                                   
         EJECT                                                                  
*                                                                               
*  ESTABLISH DATES BASED ON REQUEST DATES TO FACILITATE LOADING                 
*    TABLES.                                                                    
*      RETURN:  CC NOT = ZERO - NO DATES                                        
*               WORK+32: START DATE                                             
*               WORK+36: END   DATE                                             
*      IF START DATE ONLY ENTERED:  END DATE = START DATE                       
*      IF END   DATE ONLY ENTERED:  START DATE = 2 YEARS MINUS ONE              
*              MONTH PRIOR TO END DATE                                          
*          EXAMPLES:  (END=DEC/91 - START -> JAN/90)                            
*                     (END=AUG/89 - START -> SEP/87)                            
*                                                                               
SETDATES NTR1                                                                   
         XC    WORK+32(8),WORK+32                                               
         CLC   QSTART(12),SPACES   ANY DATES                                    
         BE    SETD0096            NO  - EXIT CC NOT = ZERO                     
         CLC   QSTART,SPACES       ANY START DATE?                              
         BNE   SETD0008            YES                                          
*                                                                               
*  END DATE ONLY ENTERED:  CALCULATE START PER ABOVE EXPLANATION                
*                                                                               
         GOTO1 DATCON,DMCB,(0,QEND),(3,WORK+60)                                 
         ZIC   RF,WORK+60          STRIP OUT YEAR                               
         CLC   QEND+2(2),=C'12'    END DATE DECEMBER?                           
         BNE   SETD0002            NO  - SUBTRACT 2 YEARS                       
         BCTR  RF,0                YES - SUBTRACT 1 YR, SET MON = 1             
         STC   RF,WORK+60                                                       
         GOTO1 DATCON,DMCB,(3,WORK+60),(X'20',WORK+32)                          
*                                  PUT DATE BACK                                
         MVC   WORK+34(2),=C'01'   MONTH = JANUARY                              
         B     SETD0012                                                         
SETD0002 EQU   *                                                                
         SH    RF,=H'2'            SUBTRACT 2 YEARS                             
         STC   RF,WORK+60                                                       
         ZIC   RF,WORK+61          ADD 1 TO MONTH                               
         LA    RF,1(RF)                                                         
         STC   RF,WORK+61                                                       
         GOTO1 DATCON,DMCB,(3,WORK+60),(X'20',WORK+32)                          
*                                  PUT DATE BACK                                
         B     SETD0012                                                         
SETD0008 EQU   *                                                                
         MVC   WORK+32(4),QSTART   START ENTERED:  SET IT                       
SETD0012 EQU   *                                                                
         MVC   WORK+36(4),WORK+32  SET END DATE = START DATE                    
         CLC   QEND,SPACES         ANY END DATE?                                
         BE    SETD0098            NO                                           
         MVC   WORK+36(4),QEND     YES - SET END DATE                           
         B     SETD0098                                                         
SETD0096 EQU   *                                                                
         LTR   RB,RB               SET CC NOT = ZERO                            
         B     SETD0099                                                         
SETD0098 EQU   *                                                                
         SR    RF,RF               SET CC = ZERO                                
SETD0099 EQU   *                                                                
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         EJECT                                                                  
*              GET SUBSIDIARY INFORMATION FOR CONTRACT                          
         SPACE 3                                                                
         DS    0H                                                               
GETINFO  NMOD1 0,*GETINF*                                                       
         L     RC,0(R1)                                                         
         CLI   RCTRACE,C'C'        CONTRACT TRACE ONLY?                         
         BNE   GNFO0010                                                         
         LR    R3,RE               SAVE RE                                      
         TIME  DEC                                                              
         STCM  R0,15,P+50          INSERT TIME RETURNED                         
         GOTO1 HEXOUT,DMCB,P+50,P+20,4,=C'TOG'                                  
         MVC   P+1(14),=C'ENTER GETINFO:'                                       
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 =V(REREPORT),RR=RELO                                             
         LR    RE,R3               RESTORE RE                                   
GNFO0010 EQU   *                                                                
         SPACE                                                                  
         CLI   RCTIMER,C'Y'                                                     
         BNE   GNFO0020                                                         
         GOTO1 =V(TIMER2),DMCB,(13,0)                                           
GNFO0020 MVC   KEYWORK,KEY                                                      
         MVI   LST2,0                                                           
         CLI   MODE,0                                                           
         BE    GNFO0350                                                         
         SR    R5,R5                                                            
         SPACE 2                                                                
GNFO0030 EQU   *                   GET STATION RECORD FIRST                     
         CLI   FCGTSTAT,C'Y'                                                    
         BNE   GNFO0040                                                         
         XC    KEY,KEY        IF READING STATION                                
         MVI   KEY,X'02'        DO IT NOW AND BYPASS TABLE LOOKUP               
         MVC   KEY+20(2),QREP                                                   
         MVC   KEY+22(5),RCONKSTA                                               
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   FENDREQ                                                          
         GOTO1 =V(REPFINT),DMCB,STATEQU                                         
         BNZ   FENDREQ                                                          
         MVI   LST2,1      SET TO BYPASS NEXT READ                              
         B     GNFO0090                                                         
GNFO0040 EQU   *                                                                
         CLC   RCONKREP,RSTAKREP   SAME REP IN STORAGE?                         
         BNE   GNFO0050            NO  - NEED TO SEARCH                         
         CLC   RCONKSTA,RSTAKSTA   YES - SAME STATION IN STORAGE?               
         BE    GNFO0090            YES - DON'T LOOK AGAIN                       
GNFO0050 EQU   *                                                                
         L     RE,ADCONLST                                                      
         USING ADCONSD,RE                                                       
         L     RF,VSPNDCTL                                                      
         LA    RF,8(RF)            SKIP FLAGS                                   
         DROP  RE                                                               
         LA    R4,2                STATION RECORD TYPE                          
         SLA   R4,2                SET DISPLACEMENT                             
         AR    R4,RF               ADD A(SPACEND CNTRL)                         
*                                     = A(1ST STATION ENTRY IN TABLE)           
         L     R4,0(R4)            LOAD ADDRESS                                 
GNFO0060 EQU   *                                                                
         CLI   0(R4),X'02'         STATION RECORD?                              
         BNE   GNFO0085            NO  - FORMERLY ABORT                         
         CLC   RCONKREP,2(R4)      SAME REP?                                    
         BNE   GNFO0070                                                         
         CLC   RCONKSTA,4(R4)      SAME STATION?                                
         BE    GNFO0080                                                         
GNFO0070 EQU   *                                                                
         IC    R5,1(R4)            BUMP TO NEXT ENTRY                           
         AR    R4,R5                                                            
         B     GNFO0060            GO BACK FOR NEXT                             
GNFO0080 EQU   *                                                                
         MVC   RSTAKREP,2(R4)      INSERT REP CODE                              
         MVC   RSTASTRT,9(R4)                                                   
         MVC   RSTAEND,12(R4)                                                   
         MVC   RSTAMKT,17(R4)                                                   
         MVC   RSTAGRUP(2),37(R4)                                  V 13         
         MVC   RSTAKSTA,RCONKSTA                                                
         MVC   RSTAOWN,46(R4)                                                   
         B     GNFO0090                                                         
GNFO0085 EQU   *                                                                
*                                  HANDLING MISSING RECORDS:                    
         MVC   RSTAKREP,RCONKREP                                                
         MVC   RSTASTRT,=X'C00C19' INSERT DUMMY START                           
         MVC   RSTAEND,=X'C00C19'  INSERT DUMMY END                             
         MVC   RSTAMKT(7),=C'MISSING'                                           
         MVC   RSTAGRUP(2),RCONKGRP                                V 13         
         MVC   RSTAKSTA,RCONKSTA                                                
         MVC   RSTAOWN,=C'***'                                                  
         B     GNFO0090                                                         
         SPACE 2                                                                
GNFO0090 EQU   *                   GET OFFICE RECORD NEXT                       
         CLC   RCONKREP,ROFFKREP   SAME REP IN STORAGE?                         
         BNE   GNFO0100            NO  - NEED TO SEARCH                         
         CLC   RCONKOFF,ROFFKOFF   YES - SAME OFFICE IN STORAGE?                
         BE    GNFO0140            YES - DON'T LOOK AGAIN                       
GNFO0100 EQU   *                                                                
         L     RE,ADCONLST                                                      
         USING ADCONSD,RE                                                       
         L     RF,VSPNDCTL                                                      
         LA    RF,8(RF)            SKIP FLAGS                                   
         DROP  RE                                                               
         LA    R4,4                OFFICE RECORD TYPE                           
         SLA   R4,2                SET DISPLACEMENT                             
         AR    R4,RF               ADD A(SPACEND CNTRL)                         
*                                     = A(1ST REGION ENTRY IN TABLE)            
         L     R4,0(R4)            LOAD ADDRESS                                 
GNFO0110 EQU   *                                                                
         CLI   0(R4),X'04'         OFFICE  RECORD?                              
         BNE   GNFO0135            NO  - FORMERLY ABORT                         
         CLC   RCONKREP,2(R4)      SAME REP?                                    
         BNE   GNFO0120                                                         
         CLC   RCONKOFF,6(R4)                                                   
         BE    GNFO0130                                                         
GNFO0120 EQU   *                                                                
         IC    R5,1(R4)            BUMP TO NEXT ENTRY                           
         AR    R4,R5                                                            
         B     GNFO0110            GO BACK FOR NEXT                             
GNFO0130 EQU   *                                                                
         MVC   ROFFKREP,2(R4)      INSERT REP CODE                              
         MVC   ROFFNAME,8(R4)                                                   
         MVC   ROFFREG,4(R4)                                                    
         MVC   ROFFADD1(38),28(R4)                                              
         MVC   ROFFSTT(2),66(R4)                                                
         MVC   ROFFZIP(10),68(R4)                                               
         MVC   ROFFKOFF,RCONKOFF                                                
         B     GNFO0140                                                         
         SPACE 2                                                                
GNFO0135 EQU   *                                                                
*                                  HANDLING MISSING RECORDS:                    
         MVC   ROFFKREP,RCONKREP                                                
         MVC   ROFFNAME,SPACES                                                  
         MVC   ROFFNAME(7),=C'MISSING'                                          
         MVC   ROFFREG,=C'**'                                                   
         MVC   ROFFADD1(07),=C'MISSING'                                         
         MVC   ROFFSTT(2),=C'**'                                                
         MVC   ROFFZIP(07),=C'MISSING'                                          
         MVC   ROFFKOFF,RCONKOFF                                                
         SPACE 2                                                                
GNFO0140 EQU   *                   GET REGION RECORD NEXT                       
         CLC   ROFFREG,=C'  '      ANY REGION?                                  
         BE    GNFO0180            NO  - DON'T LOOK FOR ONE                     
         OC    ROFFREG,ROFFREG     ANY REGION?                                  
         BZ    GNFO0180            NO  - DON'T LOOK FOR ONE                     
         CLC   RCONKREP,ROFFKREP   SAME REP IN STORAGE?                         
         BNE   GNFO0150            NO  - NEED TO SEARCH                         
         CLC   RREGKREG,ROFFREG    YES - SAME REGION IN STORAGE?                
         BE    GNFO0180            YES - DON'T LOOK AGAIN                       
GNFO0150 EQU   *                                                                
         L     RE,ADCONLST                                                      
         USING ADCONSD,RE                                                       
         L     RF,VSPNDCTL                                                      
         LA    RF,8(RF)            SKIP FLAGS                                   
         DROP  RE                                                               
         LA    R4,3                REGION RECORD TYPE                           
         SLA   R4,2                SET DISPLACEMENT                             
         AR    R4,RF               ADD A(SPACEND CNTRL)                         
*                                     = A(1ST REGION ENTRY IN TABLE)            
         L     R4,0(R4)            LOAD ADDRESS                                 
GNFO0160 EQU   *                                                                
         CLI   0(R4),X'03'         REGION?                                      
         BNE   GNFO0175            NO  - FORMERLY ABORT                         
         CLC   ROFFKREP,2(R4)      SAME REP?                                    
         BNE   GNFO0170                                                         
         CLC   ROFFREG,4(R4)                                                    
         BNE   GNFO0170                                                         
         MVC   RREGNAME,6(R4)                                                   
         MVC   RREGKREG,ROFFREG                                                 
         B     GNFO0180                                                         
GNFO0170 EQU   *                                                                
         IC    R5,1(R4)            BUMP TO NEXT ENTRY                           
         AR    R4,R5                                                            
         B     GNFO0160            GO BACK FOR NEXT                             
         SPACE 2                                                                
GNFO0175 EQU   *                   GET CATEGORY RECORD NEXT                     
         MVC   RREGNAME,SPACES                                                  
         MVC   RREGNAME(7),=C'MISSING'                                          
         MVC   RREGKREG,ROFFREG                                                 
GNFO0180 EQU   *                   GET CATEGORY RECORD NEXT                     
         CLC   RCTGKCTG,RCONCTGY   SAME CATEGORY IN STORAGE?                    
         BE    GNFO0240            YES - DON'T LOOK AGAIN                       
*                                     ALSO SKIP CLASS LOOKUP                    
         L     RE,ADCONLST                                                      
         USING ADCONSD,RE                                                       
         L     RF,VSPNDCTL                                                      
         LA    RF,8(RF)            SKIP FLAGS                                   
         DROP  RE                                                               
         LA    R4,15               CATEGORY RECORD TYPE (X'0F')                 
         SLA   R4,2                SET DISPLACEMENT                             
         AR    R4,RF               ADD A(SPACEND CNTRL)                         
*                                     = A(1ST CATGRY ENTRY IN TABLE)            
         L     R4,0(R4)            LOAD ADDRESS                                 
GNFO0190 EQU   *                                                                
         CLI   0(R4),X'0F'         CATEGORY?                                    
         BNE   GNFO0205            NO  - FORMERLY ABORT                         
         CLC   RCONCTGY,2(R4)      CATEGORY FOUND?                              
         BNE   GNFO0200            NO                                           
         MVC   RCTGKCTG,2(R4)      YES - LOAD INFO                              
         MVC   RCTGCLSS,4(R4)                                                   
         MVC   RCTGNAME,6(R4)                                                   
         XC    RCLSNAME,RCLSNAME   CLEAR CLASS NAME                             
         B     GNFO0210                                                         
GNFO0200 EQU   *                                                                
         IC    R5,1(R4)            BUMP TO NEXT ENTRY                           
         AR    R4,R5                                                            
         B     GNFO0190            GO BACK FOR NEXT                             
         SPACE 2                                                                
GNFO0205 EQU   *                                                                
*                                  HANDLING MISSING DATA:                       
         MVC   RCTGKCTG,RCONCTGY                                                
         MVC   RCTGCLSS,=C'**'                                                  
         MVC   RCTGNAME,SPACES                                                  
         MVC   RCTGNAME(7),=C'MISSING'                                          
         MVC   RCLSNAME,SPACES                                                  
         MVC   RCLSNAME(7),=C'MISSING'                                          
         B     GNFO0240                                                         
GNFO0210 EQU   *                   GET CLASS RECORD NEXT                        
*                                     BASED ON CATEGORY RECORD,                 
*                                      WHICH IS SET BEFORE THIS ONE             
         OC    RCLSNAME,RCLSNAME   SAME CLASS IN STORAGE?                       
         BNZ   GNFO0240            YES - DON'T LOOK AGAIN                       
         L     RE,ADCONLST                                                      
         USING ADCONSD,RE                                                       
         L     RF,VSPNDCTL                                                      
         LA    RF,8(RF)            SKIP FLAGS                                   
         DROP  RE                                                               
         LA    R4,13               CLASS RECORD TYPE (X'0D')                    
         SLA   R4,2                SET DISPLACEMENT                             
         AR    R4,RF               ADD A(SPACEND CNTRL)                         
*                                     = A(1ST CLASS ENTRY IN TABLE)             
         L     R4,0(R4)            LOAD ADDRESS                                 
GNFO0220 EQU   *                                                                
         CLI   0(R4),X'0D'         CLASS?                                       
         BNE   GNFO0235            NO  - FORMERLY ABORT                         
         CLC   RCTGCLSS,2(R4)                                                   
         BNE   GNFO0230                                                         
         MVC   RCLSKCLS,2(R4)                                                   
         MVC   RCLSNAME,4(R4)                                                   
         B     GNFO0240                                                         
GNFO0230 EQU   *                                                                
         IC    R5,1(R4)            BUMP TO NEXT ENTRY                           
         AR    R4,R5                                                            
         B     GNFO0220            GO BACK FOR NEXT                             
         SPACE 2                                                                
GNFO0235 EQU   *                                                                
*                                  HANDLING MISSING DATA:                       
         MVC   RCLSKCLS,=C'**'                                                  
         MVC   RCLSNAME,SPACES                                                  
         MVC   RCLSNAME(7),=C'MISSING'                                          
GNFO0240 EQU   *                   GET DIVISION/TEAM NEXT                       
         CLC   RCONTEM,RTEMKTEM    SAME TEAM IN STORAGE?                        
         BE    GNFO0270            YES - DON'T LOOK AGAIN                       
         L     RE,ADCONLST                                                      
         USING ADCONSD,RE                                                       
         L     RF,VSPNDCTL                                                      
         LA    RF,8(RF)            SKIP FLAGS                                   
         DROP  RE                                                               
         LA    R4,5                TEAM RECORD TYPE                             
         SLA   R4,2                SET DISPLACEMENT                             
         AR    R4,RF               ADD A(SPACEND CNTRL)                         
*                                     = A(1ST TEAM ENTRY IN TABLE)              
         L     R4,0(R4)            LOAD ADDRESS                                 
GNFO0250 EQU   *                                                                
         CLI   0(R4),X'05'         TEAM?                                        
         BNE   GNFO0265            NO  - FORMERLY ABORT                         
         CLC   =C'**',2(R4)        SKIP REP CHECK FLAG SET?                     
         BE    GNFO0255            YES                                          
         CLC   RCONKREP,2(R4)      NO  - SAME REP?                              
         BNE   GNFO0260            NO                                           
GNFO0255 EQU   *                                                                
         CLC   RCONTEM,4(R4)       SAME DIV/TEAM?                               
         BNE   GNFO0260            NO                                           
         MVC   RTEMDVNM,6(R4)      YES - GET DIVISION NAME                      
         MVC   RTEMNAME,16(R4)     GET TEAM NAME                                
         MVC   RTEMKTEM,RCONTEM                                                 
         B     GNFO0270                                                         
GNFO0260 EQU   *                                                                
         IC    R5,1(R4)            BUMP TO NEXT ENTRY                           
         AR    R4,R5                                                            
         B     GNFO0250            GO BACK FOR NEXT                             
         SPACE 2                                                                
GNFO0265 EQU   *                                                                
*                                  HANDLING MISSING DATA:                       
         MVC   RTEMDVNM,SPACES                                                  
         MVC   RTEMDVNM(7),=C'MISSING'                                          
         MVC   RTEMNAME,SPACES                                                  
         MVC   RTEMNAME(7),=C'MISSING'                                          
         MVC   RTEMKTEM,RCONTEM                                                 
*                                                                               
GNFO0270 EQU   *                                                                
         CLC   RSALKREP,RCONKREP   SAME REP?                                    
         BNE   GNFO0280            NO  -                                        
         CLC   RSALKSAL,RCONSAL    YES - SAME S/P IN STORAGE                    
         BE    GNFO0320            YES - DON'T LOOK AGAIN                       
GNFO0280 EQU   *                                                                
         L     RE,ADCONLST                                                      
         USING ADCONSD,RE                                                       
         L     RF,VSPNDCTL                                                      
         LA    RF,8(RF)            SKIP FLAGS                                   
         DROP  RE                                                               
         LA    R4,6                S/P  RECORD TYPE                             
         SLA   R4,2                SET DISPLACEMENT                             
         AR    R4,RF               ADD A(SPACEND CNTRL)                         
*                                     = A(1ST S/P ENTRY IN TABLE)               
         L     R4,0(R4)            LOAD ADDRESS                                 
GNFO0290 EQU   *                                                                
         CLI   0(R4),X'06'         SALESMAN?                                    
         BE    GNFO0295                                                         
         B     GNFO0320            NO  - SKIP SALESPERSON SETUP                 
****>>>  DC    H'0'                                                             
GNFO0295 EQU   *                                                                
         CLC   =C'**',2(R4)        SKIP REP CHECK FLAG SET?                     
         BE    GNFO0297            YES                                          
         CLC   RCONKREP,2(R4)      SAME REP?                                    
         BNE   GNFO0300                                                         
GNFO0297 EQU   *                                                                
         CLC   RCONSAL,6(R4)       SAME S/P IN STORAGE?                         
         BE    GNFO0310                                                         
GNFO0300 EQU   *                                                                
         IC    R5,1(R4)            BUMP TO NEXT ENTRY                           
         AR    R4,R5                                                            
         B     GNFO0290            GO BACK FOR NEXT                             
GNFO0310 EQU   *                                                                
         MVC   RSALKREP,2(R4)      INSERT REP CODE                              
         MVC   RSALNAME,9(R4)                                                   
         MVC   RSALTEAM,4(R4)                                                   
         MVC   RSALKSAL,6(R4)                                                   
         MVC   RSALTEL,29(R4)                                                   
         SPACE 2                                                                
GNFO0320 EQU   *                   GET GROUP RECORD NEXT                        
         CLC   RSTAGRUP,RGRPKGRP   SAME GROUP IN STORAGE?                       
         BE    GNFO0350            YES - DON'T LOOK AGAIN                       
         L     RE,ADCONLST                                                      
         USING ADCONSD,RE                                                       
         L     RF,VSPNDCTL                                                      
         LA    RF,8(RF)            SKIP FLAGS                                   
         DROP  RE                                                               
         LA    R4,7                GROUP RECORD TYPE                            
         SLA   R4,2                SET DISPLACEMENT                             
         AR    R4,RF               ADD A(SPACEND CNTRL)                         
*                                     = A(1ST TEAM ENTRY IN TABLE)              
         L     R4,0(R4)            LOAD ADDRESS                                 
GNFO0330 EQU   *                                                                
         CLI   0(R4),7             GROUP                                        
         BNE   GNFO0345            NO  - FORMERLY ABORT                         
         CLC   =C'**',2(R4)        SKIP REP CHECK FLAG SET?                     
         BE    GNFO0332                                                         
         CLC   RCONKREP,2(R4)      SAME REP?                                    
         BNE   GNFO0340                                                         
GNFO0332 EQU   *                                                                
         CLC   RSTAGRUP,4(R4)                                                   
         BNE   GNFO0340                                                         
         MVC   RGRPKGRP,4(R4)                                                   
         MVC   RGRPNAME(20),6(R4)                                               
         B     GNFO0350                                                         
GNFO0340 EQU   *                                                                
         IC    R5,1(R4)            BUMP TO NEXT ENTRY                           
         AR    R4,R5                                                            
         B     GNFO0330            GO BACK FOR NEXT                             
*                                                                               
GNFO0345 EQU   *                                                                
*                                  HANDLING MISSING DATA:                       
         MVC   RGRPKGRP,=C'**'                                                  
         MVC   RGRPNAME,SPACES                                                  
         MVC   RGRPNAME(07),=C'MISSING'                                         
GNFO0350 EQU   *                                                                
*                                                                               
         CLI   RCTRACE,C'C'        CONTRACT TRACE ONLY?                         
         BNE   GNFO0360                                                         
         LR    R3,RE               SAVE RE                                      
         TIME  DEC                                                              
         STCM  R0,15,P+50          INSERT TIME RETURNED                         
         GOTO1 HEXOUT,DMCB,P+50,P+20,4,=C'TOG'                                  
         MVC   P+1(14),=C'TABLE LU DONE:'                                       
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 =V(REREPORT),RR=RELO                                             
         LR    RE,R3               RESTORE RE                                   
*                                                                               
GNFO0360 EQU   *                                                                
         LA    R4,RCONELEM         CHECK FOR A PRODUCT NAME                     
         SR    R5,R5                                                            
         SPACE 2                                                                
GNFO0370 IC    R5,1(R4)                                                         
         AR    R4,R5                                                            
         CLI   0(R4),0                                                          
         BE    GNFO0380                                                         
         CLI   0(R4),X'05'                                                      
         BNE   GNFO0370                                                         
         USING RCONEXEL,R4                                                      
         MVC   RPRDNAME,RCONEXPR                                                
         XC    RPRDKPRD,RPRDKPRD                                                
         DROP  R4                                                               
         SPACE 2                                                                
GNFO0380 CLI   FCGTADV,C'Y'        NEED AN ADVERTISER ?                         
         BNE   GNFO0400                                                         
         CLC   RADVKADV,RCONKADV                                                
         BE    GNFO0400                                                         
         MVC   RADVKADV,RCONKADV                                                
         XC    KEY,KEY                                                          
         MVI   KEY,X'08'                                                        
         MVC   KEY+21(4),RCONKADV                                               
         MVC   KEY+25(2),RCONKREP                                MH7507         
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   FENDREQ                                                          
         CLC   KEYSAVE(27),KEY                                   MH7507         
         BE    GNFO0390                                          MH7507         
         MVC   KEYSAVE+25(2),=C'ZZ'                              MH7507         
         CLC   KEYSAVE(27),KEY                                   MH7507         
         BE    GNFO0390                                          MH7507         
         MVC   KEY,KEYSAVE                                       MH7507         
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   FENDREQ                                                          
GNFO0390 GOTO1 =V(REPFINT),DMCB,ADVEQU                                          
         BNZ   FENDREQ                                                          
         SPACE 2                                                                
GNFO0400 CLI   FCGTPROD,C'Y'       HOW ABOUT A PRODUCT ?                        
         BNE   GNFO0420                                                         
         CLC   RCONPRD,SPACES                                                   
         BE    GNFO0420                                                         
         CLC   RPRDKPRD,RCONPRD                                                 
         BNE   *+14                                                             
         CLC   RPRDKADV,RCONKADV                                                
         BE    GNFO0420                                                         
         XC    KEY,KEY                                           MH7507         
         MVI   KEY,X'09'                                         MH7507         
         MVC   KEY+18(4),RCONKADV                                MH7507         
         MVC   KEY+22(3),RCONPRD                                 MH7507         
         MVC   KEY+25(2),RCONKREP                                MH7507         
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   FENDREQ                                                          
         CLC   KEYSAVE(27),KEY                                   MH7507         
         BE    GNFO0410                                          MH7507         
         MVC   KEYSAVE+25(2),=C'ZZ'                              MH7507         
         CLC   KEYSAVE(27),KEY                                   MH7507         
         BE    GNFO0410                                          MH7507         
         MVC   KEY,KEYSAVE                                       MH7507         
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   FENDREQ                                                          
GNFO0410 GOTO1 =V(REPFINT),DMCB,PRODEQU                                         
         BNZ   FENDREQ                                                          
         SPACE 2                                                                
GNFO0420 CLI   FCGTAGY,C'Y'        NOW SEE IF WE NEED TO READ                   
         BNE   GNFO0450            SUBSIDIARY RECORDS                           
         CLC   RAGYKAGY,RCONKAGY                                                
         BNE   GNFO0430                                                         
         CLC   RAGYKAOF,RCONKAOF                                                
         BE    GNFO0450                                                         
         SPACE 2                                                                
GNFO0430 XC    KEY,KEY             GET AN AGENCY                                
         MVI   KEY,X'0A'                                                        
         MVC   KEY+19(6),RCONKAGY                                MH7507         
         MVC   KEY+25(2),RCONKREP                                MH7507         
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   FENDREQ                                                          
         CLC   KEYSAVE(27),KEY                                   MH7507         
         BE    GNFO0440                                          MH7507         
         MVC   KEYSAVE+25(2),=C'ZZ'                              MH7507         
         CLC   KEYSAVE(27),KEY                                   MH7507         
         BE    GNFO0440                                          MH7507         
         MVC   KEY,KEYSAVE                                       MH7507         
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   FENDREQ                                                          
GNFO0440 GOTO1 =V(REPFINT),DMCB,AGYEQU                                          
         BNZ   FENDREQ                                                          
         SPACE 2                                                                
GNFO0450 CLI   FCGTMAN,C'Y'        DO WE NEED A SALESMAN ?                      
         BNE   GNFO0460                                                         
         MVC   RSALKSAL,RCONSAL                                                 
         XC    KEY,KEY                                                          
         MVI   KEY,X'06'                                                        
         MVC   KEY+22(2),QREP                                                   
         MVC   KEY+24(3),RCONSAL                                                
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   FENDREQ                                                          
         GOTO1 =V(REPFINT),DMCB,MANEQU                                          
         BNZ   FENDREQ                                                          
         CLI   RCTRACE,C'C'        CONTRACT TRACE ONLY?                         
         BNE   GNFO0460                                                         
         LR    R3,RE               SAVE RE                                      
         MVC   P+1(11),=C'S/P: GETSP:'                                          
         MVC   P+20(3),RSALKSAL                                                 
         MVC   P+24(20),RSALNAME                                                
         MVC   P+45(2),RSALKREP                                                 
         MVC   P+48(2),RSALTEAM                                                 
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 =V(REREPORT),RR=RELO                                             
         LR    RE,R3               RESTORE RE                                   
         SPACE 2                                                                
GNFO0460 CLI   FCGTSTAT,C'Y'       OR A STATION ?                               
         BNE   GNFO0470                                                         
         CLI   LST2,1          THIS STATION PREVIOUSLY READ                     
         BE    GNFO0470      YES,  BYPASS THIS READ                             
         XC    KEY,KEY                                                          
         MVI   KEY,X'02'                                                        
         MVC   KEY+20(2),QREP                                                   
         MVC   KEY+22(5),RCONKSTA                                               
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   FENDREQ                                                          
         GOTO1 =V(REPFINT),DMCB,STATEQU                                         
         BNZ   FENDREQ                                                          
         SPACE 2                                                                
GNFO0470 MVI   LST2,0                                                           
         CLI   FCGTOFF,C'Y'                                                     
         BNE   GNFO0480                                                         
         XC    KEY,KEY                                                          
         MVI   KEY,X'04'                                                        
         MVC   KEY+23(2),QREP                                                   
         MVC   KEY+25(2),RCONKOFF                                               
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   FENDREQ                                                          
         GOTO1 =V(REPFINT),DMCB,OFFEQU                                          
         BNZ   FENDREQ                                                          
         SPACE 2                                                                
GNFO0480 CLI   FCGTTEAM,C'Y'                                                    
         BNE   GNFO0490                                                         
         XC    KEY,KEY                                                          
         MVI   KEY,5                                                            
         MVC   KEY+23(2),QREP                                                   
         MVC   KEY+25(2),RCONTEM                                                
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   FENDREQ                                                          
         GOTO1 =V(REPFINT),DMCB,TEAMEQU                                         
         BNZ   FENDREQ                                                          
         SPACE 2                                                                
GNFO0490 CLI   FCGTGRUP,C'Y'                                                    
         BNE   GNFO0500                                                         
         XC    KEY,KEY                                                          
         MVI   KEY,7                                                            
         MVC   KEY+23(2),QREP                                                   
         MVC   KEY+25(2),RSTAGRUP                                               
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   FENDREQ                                                          
         GOTO1 =V(REPFINT),DMCB,GROUPEQU                                        
         BNZ   FENDREQ                                                          
         SPACE 2                                                                
GNFO0500 CLI   FCGTREGN,C'Y'                                                    
         BNE   GNFO0510                                                         
         XC    KEY,KEY                                                          
         MVI   KEY,3                                                            
         MVC   KEY+23(2),QREP                                                   
         MVC   KEY+25(2),ROFFREG                                                
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   FENDREQ                                                          
         GOTO1 =V(REPFINT),DMCB,REGEQU                                          
         BNZ   FENDREQ                                                          
         SPACE 1                                                                
GNFO0510 CLI   FCGTCATG,C'Y'                                                    
         BNE   GNFO0520                                                         
         XC    KEY,KEY                                                          
         MVI   KEY,X'0F'                                                        
         MVC   KEY+23(2),QREP                                                   
         MVC   KEY+25(2),RCONCTGY                                               
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   FENDREQ                                                          
         GOTO1 =V(REPFINT),DMCB,CATGYEQU                                        
         BNZ   FENDREQ                                                          
         SPACE 2                                                                
GNFO0520 CLI   FCGTCLSS,C'Y'                                                    
         BNE   GNFO0530                                                         
         XC    KEY,KEY                                                          
         MVI   KEY,X'0D'                                                        
         MVC   KEY+23(2),QREP                                                   
         MVC   KEY+25(2),RCTGCLSS                                               
         GOTO1 =V(REPFINT),DMCB,READEQU                                         
         BNZ   FENDREQ                                                          
         GOTO1 =V(REPFINT),DMCB,CLASSEQU                                        
         BNZ   FENDREQ                                                          
         SPACE 2                                                                
GNFO0530 CLC   KEY(27),KEYWORK                                                  
         BE    GNFO0540                                                         
         MVC   KEY(27),KEYWORK     RE-ESTABLISH SEQUENCE                        
GNFO0540 GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   FENDREQ                                                          
         CLI   RCTIMER,C'Y'                                                     
         BNE   GNFO0550                                                         
         GOTO1 =V(TIMER2),DMCB,(13,0)                                           
*                                                                               
GNFO0550 DS    0H                                                               
         CLI   RCTRACE,C'C'        CONTRACT TRACE ONLY?                         
         BNE   GETINF4                                                          
         LR    R3,RE               SAVE RE                                      
         TIME  DEC                                                              
         STCM  R0,15,P+50          INSERT TIME RETURNED                         
         GOTO1 HEXOUT,DMCB,P+50,P+20,4,=C'TOG'                                  
         MVC   P+1(14),=C'LEAVE GETINFO:'                                       
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 =V(REREPORT),RR=RELO                                             
         LR    RE,R3               RESTORE RE                                   
GETINF4  EQU   *                                                                
         LA    R0,0                                                             
GNFO0560 LTR   R0,R0                                                            
         XIT1                                                                   
*                                                                               
FENDREQ  DS    0H                                                               
         LA    R0,1                                                             
         B     GNFO0560                                                         
         SPACE                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*   DATA SET RESETVAL:                                                          
*                                                                               
       ++INCLUDE RESETVAL                                                       
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*  ROUTINE TO RETRIEVE THE PRODUCT RECORD, WHEN NEEDED                          
*                                                                               
RETPROD  NMOD1 0,*RETPRD*                                                       
*                                                                               
         L     RC,0(R1)                                                         
         XC    KEY,KEY                                                          
         MVI   KEY,X'09'                                                        
         MVC   KEY+18(4),RCONKADV                                               
         MVC   KEY+22(3),RCONPRD                                                
         MVC   KEY+25(2),RCONKREP                                               
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   RETP0098                                                         
         CLC   KEYSAVE(27),KEY                                                  
         BE    RETP0010                                                         
         MVC   KEYSAVE+25(2),=C'ZZ'                                             
         CLC   KEYSAVE(27),KEY                                                  
         BE    RETP0010                                                         
         MVC   KEY,KEYSAVE                                                      
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         BNZ   RETP0098                                                         
RETP0010 EQU   *                                                                
         GOTO1 =V(REPFINT),DMCB,PRODEQU                                         
         BNZ   RETP0098                                                         
         SR    R3,R3               SET CONDITION CODE = ZERO                    
         B     RETP0099                                                         
RETP0098 EQU   *                                                                
         LTR   R3,R3               SET CONDITION CODE NOT = ZERO                
RETP0099 EQU   *                                                                
         XIT1                                                                   
         SPACE                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*  CONTRACT FILTER CODE, SWUNG OUT OF ORIGINAL FILTER ROUTINE                   
*      FLAG INDICATES WHETHER ALL FILTERING IS TO BE DONE, OR                   
*        AN ABBREVIATED FILTERING FOR CONTRACT                                  
*                                                                               
FILTER2  NMOD1 0,*FILTR2*                                                       
*                                                                               
         L     RC,0(R1)            RESTORE RC                                   
         OC    4(4,R1),4(R1)       ANY FLAG (CONTRACT FILTER)?                  
         BNZ   FILT0060            YES - BEGIN AT STATION                       
         LA    R3,1                                                             
*                                                                               
         TM    RCONCNTL,X'80'      DONT WANT DELETES                            
         BO    FILT1160                                                         
         SPACE 1                                                                
*                                                                               
         LA    R3,2                                                             
*                                                                               
         CLC   RCONKOFF,KEYWORK+3  MAKE SURE THAT THE VALUES IN THE             
         BNE   FILT1160             KEYS EQUAL VALUES IN THE RECORDS            
         CLI   KEYWORK+5,0                                                      
         BE    FILT0020                                                         
*                                                                               
         LA    R3,3                                                             
*                                                                               
         CLC   RCONTEM,KEYWORK+5                                                
         BNE   FILT1160                                                         
         MVC   FULL,SPACES                                                      
         CLI   RCONSAL+2,C' '                                                   
         BE    *+20                                                             
         MVC   FULL(1),RCONSAL+2                                                
         MVC   FULL+1(2),RCONSAL                                                
         B     *+16                                                             
         MVC   FULL(1),RCONSAL+1                                                
         MVC   FULL+1(1),RCONSAL                                                
*                                                                               
         LA    R3,4                                                             
*                                                                               
         CLC   FULL(3),KEYWORK+7                                                
         BNE   FILT1160                                                         
         SPACE 2                                                                
FILT0020 EQU   *                                                                
*                                                                               
         LA    R3,5                                                             
*                                                                               
         CLC   RCONKSTA,KEYWORK+10                                              
         BNE   FILT1160                                                         
*                                                                               
         LA    R3,6                                                             
*                                                                               
         CLC   RCONKAGY,KEYWORK+15                                              
         BNE   FILT1160                                                         
*                                                                               
         LA    R3,7                                                             
*                                                                               
         CLC   RCONKADV,KEYWORK+19                                              
         BNE   FILT1160                                                         
*                                                                               
         LA    R3,8                                                             
*                                                                               
         CLI   KEYWORK+23,0                                                     
         BE    FILT0040                                                         
*                                                                               
         LA    R3,9                                                             
*                                                                               
         CLC   RCONKAOF,KEYWORK+23                                              
         BNE   FILT1160                                                         
         SPACE 2                                                                
FILT0040 CLI   KEYWORK+25,0                                                     
         BE    FILT0060                                                         
*                                                                               
         LA    R3,10                                                            
*                                                                               
         CLC   RCONKGRP(2),KEYWORK+25                                           
         BNE   FILT1160                                                         
         SPACE 2                                                                
FILT0060 CLC   QSTATION,SPACES                                                  
         BE    FILT0080                                                         
*                                                                               
         LA    R3,11                                                            
*                                                                               
         CLC   QSTATION,RCONKSTA                                                
         BNE   FILT1160                                                         
         SPACE 2                                                                
FILT0080 CLC   QOFFICE,SPACES                                                   
         BE    FILT0100                                                         
*                                                                               
         LA    R3,12                                                            
*                                                                               
         CLC   QOFFICE,RCONKOFF                                                 
         BNE   FILT1160                                                         
         SPACE 2                                                                
FILT0100 CLC   QAGENCY,SPACES                                                   
         BE    FILT0120                                                         
*                                                                               
         LA    R3,13                                                            
*                                                                               
         CLC   QAGENCY,RCONKAGY                                                 
         BNE   FILT1160                                                         
         SPACE 2                                                                
FILT0120 CLC   QADV,SPACES                                                      
         BE    FILT0140                                                         
*                                                                               
         LA    R3,14                                                            
*                                                                               
         CLC   QADV,RCONKADV                                                    
         BNE   FILT1160                                                         
FILT0140 CLI   QDIV,C' '           NOW THE OTHER FILTERS                        
         BE    FILT0160                                                         
*                                                                               
         LA    R3,15                                                            
*                                                                               
         CLC   QDIV,RCONTEM        DIVISION                                     
         BNE   FILT1160                                                         
         SPACE 2                                                                
FILT0160 CLI   QTEAM,C' '                                                       
         BE    FILT0180                                                         
*                                                                               
         LA    R3,16                                                            
*                                                                               
         CLC   QTEAM,RCONTEM+1     TEAM                                         
         BNE   FILT1160                                                         
         SPACE 2                                                                
FILT0180 CLC   QMAN,SPACES                                                      
         BE    FILT0200                                                         
*                                                                               
         LA    R3,17                                                            
*                                                                               
         CLC   QMAN,RCONSAL                                                     
         BNE   FILT1160                                                         
FILT0200 CLC   QAGYOFF,SPACES                                                   
         BE    FILT0220                                                         
*                                                                               
         LA    R3,18                                                            
*                                                                               
         CLC   QAGYOFF,RCONKAOF    AGENCY OFFICE                                
         BNE   FILT1160                                                         
         SPACE 2                                                                
FILT0220 CLC   QCONTYPE,SPACES                                                  
         BE    FILT0260                                                         
*                                                                               
         LA    R3,19                                                            
*                                                                               
         CLI   QCONTYPE,X'C0'      LOWER CASE MEANS EXCLUDE                     
         BL    FILT0240                                                         
         CLC   QCONTYPE,RCONTYPE   IF REQ=CONTRACT                              
         BE    FILT0260            TAKE IT                                      
**                                                                              
**       LA    R3,20                                                            
**                                                                              
**       CLI   QCONTYPE,C'R'       IF REQ=R (REGULAR)                           
**       BNE   FILT1160                                                         
**                                                                              
**       LA    R3,21                                                            
**                                                                              
**       CLI   RCONTYPE,0          TAKE RCONTYPE=0                              
**       BNE   FILT1160                                                         
**       B     FILT0260                                                         
**                                                                              
         BNE   FILT1160                                                         
         SPACE 2                                                                
FILT0240 MVC   BYTE,QCONTYPE       IF EXCLUDE                                   
         OI    BYTE,X'40'          MAKE IT UPPER CASE FOR COMPARE               
*                                                                               
         LA    R3,22                                                            
*                                                                               
         CLC   BYTE,RCONTYPE                                                    
         BE    FILT1160            EXCLUDE IF REQ=CONTRACT                      
**       CLI   BYTE,C'R'                                                        
**       BNE   FILT0260                                                         
**                                                                              
**       LA    R3,23                                                            
**                                                                              
**       CLI   RCONTYPE,0          OR REQ=R AND CONTRACT=0                      
**       BE    FILT1160                                                         
         SPACE 2                                                                
FILT0260 CLC   QCLASS,SPACES                                                    
         BE    FILT0320                                                         
         L     R4,ASPACND4                                                      
         SR    R5,R5                                                            
         SPACE 2                                                                
FILT0280 EQU   *                                                                
*                                                                               
         LA    R3,24                                                            
*                                                                               
         CLI   0(R4),0                                                          
         BE    FILT1160                                                         
         CLI   0(R4),X'0F'                                                      
         BNE   FILT0300                                                         
         CLC   2(2,R4),RCONCTGY    FIND CATG RECORD                             
         BNE   FILT0300                                                         
*                                                                               
         LA    R3,25                                                            
*                                                                               
         CLC   QCLASS,4(R4)                                                     
         BNE   FILT1160                                                         
         B     FILT0320                                                         
         SPACE 2                                                                
FILT0300 IC    R5,1(R4)                                                         
         AR    R4,R5                                                            
         B     FILT0280                                                         
         SPACE 2                                                                
FILT0320 CLC   QCATY,SPACES        PRODUCT CATEGORY                             
         BE    FILT0340                                                         
*                                                                               
         LA    R3,26                                                            
*                                                                               
         CLC   QCATY,RCONCTGY                                                   
         BNE   FILT1160                                                         
FILT0340 CLC   QREGION,SPACES      OFFICE REGION                                
         BE    FILT0400                                                         
         LA    R4,SPACEND+4                                                     
         SR    R5,R5                                                            
         SPACE 2                                                                
FILT0360 EQU   *                                                                
*                                                                               
         LA    R3,27                                                            
*                                                                               
         CLI   0(R4),0                                                          
         BE    FILT1160                                                         
         CLI   0(R4),X'04'                                                      
         BNE   FILT0380                                                         
*                                                                               
         CLC   RCONKREP,2(R4)      YES - SAME REP?                              
         BNE   FILT0380            NO  - SKIP THIS OFFICE RECORD                
         CLC   6(2,R4),RCONKOFF    CHECK OFFICE W/NEW SPACEND                   
         BNE   FILT0380                                                         
         LA    R3,28                                                            
         CLC   QREGION,4(R4)                                                    
         BNE   FILT1160                                                         
         B     FILT0400                                                         
         SPACE 2                                                                
FILT0380 IC    R5,1(R4)                                                         
         AR    R4,R5                                                            
         B     FILT0360                                                         
         SPACE 2                                                                
FILT0400 CLC   QGROUP,SPACES                                                    
         BE    FILT0420                                                         
*                                                                               
         LA    R3,29                                                            
*                                                                               
         CLC   QGROUP,RCONKGRP                                                  
         BNE   FILT1160                                                         
         SPACE 2                                                                
FILT0420 CLC   QSBGROUP,SPACES                                                  
         BE    FILT0440                                                         
*                                                                               
         LA    R3,30                                                            
*                                                                               
         CLC   QSBGROUP,RCONKGRP+1                                              
         BNE   FILT1160                                                         
         SPACE 2                                                                
FILT0440 CLC   QPRODUCT,SPACES                                                  
         BE    FILT0460                                                         
*                                                                               
         LA    R3,31                                                            
*                                                                               
         CLC   QPRODUCT,RCONPRD                                                 
         BNE   FILT1160                                                         
         SPACE 2                                                                
*                                                                               
*   NEW FILTERS FROM SECOND REQUEST CARD, IF ENTERED                            
*                                                                               
FILT0460 EQU   *                                                                
         CLC   =C'1C',QPROG        1C ALLOC SPREADER?                           
         BE    FILT0820            YES - SKIP ADDITIONAL FILTERING              
*                                                                               
         L     RF,=V(RQSTNUM)      HOW MANY REQUEST CARDS?                      
         CLI   0(RF),1             SINGLE CARD?                                 
         BE    FILT0820            YES - SKIP SUBSEQUENT TESTING                
*                                                                               
*  EQUATES FOR SECOND REQUEST CARD                                              
*                                                                               
OWNRDISP EQU   80+Q2OWNER-QREC2                                                 
SRNKDISP EQU   80+Q2RANK-QREC2                                                  
TVBDISP  EQU   80+Q2TVB-QREC2                                                   
MKTDISP  EQU   80+Q2MARKET-QREC2                                                
AFFLDISP EQU   80+Q2AFFIL-QREC2                                                 
NCONDISP EQU   80+Q2NCNUM-QREC2                                                 
PPERDISP EQU   80+Q2PPSON-QREC2                                                 
ASATTODT EQU   80+Q2ASAT2-QREC2                                                 
*                                                                               
*  EQUATES FOR SPACEND:  BASED ON STATION ENTRY SETUP IN 'FINT'                 
*   THESE ARE 'NEW/RRG' SPACEND DISPLACEMENTS                                   
*                                                                               
SPACSTAT EQU   4                                                                
SPACAFFL EQU   39                                                               
SPACTVB  EQU   44                                                               
SPACOWNR EQU   46                                                               
SPACRANK EQU   49                                                               
SPACMARK EQU   54                                                               
*                                                                               
         L     RF,=V(RQSTCARD)     A(CARD INPUT)                                
         CLC   81(32,RF),SPACES    ANY CARD2 FILTERS ENTERED:                   
         BE    FILT0820            NO  - SKIP SUBSEQUENT PROCESSING             
         L     R4,ASPACND4                                                      
         SR    R3,R3                                                            
*                                                                               
*  FIND STATION RECORD IN SPACEND                                               
*                                                                               
FILT0480 EQU   *                                                                
         CLI   0(R4),0             END OF SPACEND?                              
         BNE   FILT0500            NO                                           
         DC    H'0'                                                             
FILT0500 EQU   *                                                                
         CLI   0(R4),X'02'               STATION ENTRY?                         
         BNE   FILT0520                  NO                                     
         CLC   RCONKSTA,SPACSTAT(R4)     SAME STATION?                          
         BE    FILT0560                  YES - USE IT                           
FILT0520 EQU   *                                                                
         IC    R3,1(R4)                  GO TO NEXT SPACEND ENTRY               
         AR    R4,R3                                                            
         B     FILT0500                                                         
FILT0560 EQU   *                                                                
         CLC   OWNRDISP(3,RF),SPACES     ANY OWNER FILTER?                      
         BE    FILT0580                  NO                                     
*                                                                               
         LA    R3,200                                                           
*                                                                               
         CLC   OWNRDISP(3,RF),SPACOWNR(R4)                                      
         BNE   FILT1160                                                         
FILT0580 EQU   *                                                                
         CLC   SRNKDISP(1,RF),SPACES     ANY STATION RANK FILTER?               
         BE    FILT0600                  NO                                     
*                                                                               
         LA    R3,201                                                           
*                                                                               
         CLC   SRNKDISP(1,RF),SPACRANK(R4)                                      
         BNE   FILT1160                                                         
FILT0600 EQU   *                                                                
         CLC   TVBDISP(1,RF),SPACES      ANY TVB FILTER?                        
         BE    FILT0620                  NO                                     
*                                                                               
         LA    R3,202                                                           
*                                                                               
         CLC   TVBDISP(1,RF),SPACTVB(R4)                                        
         BNE   FILT1160                                                         
FILT0620 EQU   *                                                                
         CLC   MKTDISP(4,RF),SPACES      ANY MKT FILTER?                        
         BE    FILT0660                  NO                                     
*                                                                               
         CLI   MKTDISP+3(RF),X'40'       REPLACE TRAILING SPACES                
         BNE   FILT0640                                                         
         MVI   MKTDISP+3(RF),X'00'                                              
*                                                                               
         CLI   MKTDISP+2(RF),X'40'       REPLACE TRAILING SPACES                
         BNE   FILT0640                                                         
         MVI   MKTDISP+2(RF),X'00'                                              
*                                                                               
         CLI   MKTDISP+1(RF),X'40'       REPLACE TRAILING SPACES                
         BNE   FILT0640                                                         
         MVI   MKTDISP+1(RF),X'00'                                              
FILT0640 EQU   *                                                                
         LA    R3,203                                                           
*                                                                               
         CLC   MKTDISP(4,RF),SPACMARK(R4)                                       
         BNE   FILT1160                                                         
*                                                                               
FILT0660 EQU   *                                                                
         CLC   AFFLDISP(3,RF),SPACES     ANY AFFILIATE FILTER?                  
         BE    FILT0680                  NO                                     
*                                                                               
         LA    R3,204                                                           
*                                                                               
         CLC   AFFLDISP(3,RF),SPACAFFL(R4)                                      
         BNE   FILT1160                                                         
FILT0680 EQU   *                                                                
         CLC   PPERDISP(3,RF),SPACES     ANY POINT PERSON FILTER?               
         BH    FILT0700                  YES - RETRIEVE PRODUCT REC             
         CLC   NCONDISP(8,RF),SPACES     ANY NET CON NUMBER FILTER?             
         BNH   FILT0820                  NO                                     
FILT0700 EQU   *                                                                
         LA    R3,205                                                           
*                                                                               
         CLC   RCONPRD,SPACES            PRODUCT CODE IN CONTRACT?              
         BNH   FILT1160                  NO  - SKIP IT                          
*                                                                               
*   FORCE A READ OF THE PRODUCT RECORD.  THE LAST PART MAY HAVE BEEN            
*        OVERLAID BY THE AGENCY RECORD                                          
*                                                                               
         B     FILT0720                                                         
*                                                                               
         CLC   RPRDKPRD,RCONPRD          PRODUCT RECORD ALREADY FOUND?          
         BNE   FILT0720                                                         
         CLC   RPRDKADV,RCONKADV                                                
         BE    FILT0740                                                         
FILT0720 EQU   *                                                                
         LR    R3,RF                     SAVE A(REQUEST CARD)                   
         LR    R4,RE                     SAVE A(RETURN)                         
         MVC   FILTKYSV,KEY              SAVE CONTRACT KEY                      
         GOTO1 =A(RETPROD),DMCB,(RC)     RETRIEVE PRODUCT RECORD                
         MVC   KEY,FILTKYSV              RESTORE CONTRACT KEY                   
         GOTO1 =V(REPFINT),DMCB,HIGHEQU                                         
         LR    RF,R3                     RESET A(REQUEST CARD)                  
         LR    RE,R4                     RESET A(RETURN)                        
         LA    R3,210                    SET ERROR EXIT                         
*                                                                               
*   RESET OF A(REQUEST CARD + RETURN) PLACED BEFORE TEST FOR BRANCH.            
*                                                                               
         BNZ   FILT1160                  NOT FOUND - SKIP IT                    
FILT0740 EQU   *                                                                
         CLC   PPERDISP(3,RF),SPACES     ANY POINT PERSON FILTER?               
         BNH   FILT0800                  NO                                     
         LA    R1,RPRDELEM               X01 ELEMENT OF PRODUCT                 
         SR    R0,R0                                                            
FILT0760 EQU   *                                                                
         LA    R3,211                    SET ERROR EXIT                         
         CLI   0(R1),0                                                          
         BE    FILT1160                                                         
         CLI   0(R1),2                                                          
         BE    FILT0780                                                         
         IC    R0,1(R1)                                                         
         AR    R1,R0                                                            
         B     FILT0760                  GO BACK FOR NEXT                       
FILT0780 EQU   *                                                                
         LA    R3,212                    SET ERROR EXIT                         
*                                                                               
         CLC   PPERDISP(3,RF),RPRDNPNT-RPRDNELM(R1)                             
         BNE   FILT1160                                                         
FILT0800 EQU   *                                                                
         LA    R3,213                    SET ERROR EXIT                         
*                                                                               
         CLC   NCONDISP(8,RF),SPACES ANY NETWK CON# FILTER?                     
         BNH   FILT0820            NO                                           
         CLC   RCONPRD,SPACES                                                   
         BNH   FILT1160                                                         
         LA    R3,213                    SET ERROR EXIT                         
*                                                                               
         CLC   NCONDISP(8,RF),RPRDNET#                                          
         BNE   FILT1160                                                         
         B     FILT0820                                                         
         EJECT                                                                  
*                                                                               
FILT0820 EQU   *                                                                
*                                                                               
*   SPECIAL FLIGHT FILTERING FOR CONTRACT PRINT (10) REPORT                     
*     FLIGHT OF CONTRACT MUST OVERLAP THE REQUEST PERIOD, ELSE                  
*        CONTRACT IS TO BE SKIPPED.                                             
*                                                                               
         CLC   =C'10',QPROG        CONTRACT PRINT?                              
         BNE   FILT0840            NO                                           
         CLC   RCONDATE(2),CURDTEND   CONTRACT START VS REQ END                 
         BH    FILT1160            STARTED AFTER REQUEST PERIOD                 
         CLC   CURDTST(2),RCONDATE+3  CONTRACT END   VS REQ START               
         BH    FILT1160            REQ PERIOD AFTER CONTR ENDED                 
*                                                                               
FILT0840 EQU   *                                                                
         CLI   QPROG,C'8'          TEST FOR SPL REPORTS                         
         BE    FILT1140            EXIT: RECORD OKAY                            
*                                                                               
         CLC   =C'16',QPROG        NO ACTIVITY FILTER ON 16 REPORT              
         BE    FILT1140            EXIT: RECORD OKAY                            
*                                                                               
         CLC   QPROG,=C'20'                                                     
         BE    FILT1140            EXIT: RECORD OKAY                            
         CLC   QPROG,=C'21'                                                     
         BE    FILT1140            EXIT: RECORD OKAY                            
         CLC   QPROG,=C'34'                                                     
         BE    FILT1140            EXIT: RECORD OKAY                            
         CLC   QPROG,=C'37'                                                     
         BE    FILT1140            EXIT: RECORD OKAY                            
         CLC   QPROG,=C'3L'        KATZ 1640 REPORT                             
         BE    FILT1140            EXIT: RECORD OKAY                            
         CLC   QPROG,=C'47'                                                     
         BE    FILT1140            EXIT: RECORD OKAY                            
         CLC   QPROG,=C'1K'        STRATEGY SEEDER PROGRAM?                     
         BNE   FILT0900            NO                                           
         CLC   =C'FCST',RCONKAGY   'FORECAST' CONTRACT?                         
         BE    FILT1140            YES - RECORD OKAY                            
         LA    RF,RCONELEM         NO  - LOOK FOR SAR ELEMENT                   
FILT0860 EQU   *                                                                
         CLI   0(RF),0             END OF RECORD?                               
         BE    FILT0900            YES - CONTINUE PROCESSING                    
         CLI   0(RF),X'06'         SPL ELEMENT?                                 
         BE    FILT0900            YES - CONTINUE PROCESSING                    
         CLI   0(RF),X'12'         SAR ELEMENT?                                 
         BE    FILT0880            YES - LOOK AT IT                             
         ZIC   RE,1(RF)            NO  - BUMP TO NEXT ELEMENT                   
         AR    RF,RE                                                            
         B     FILT0860            GO BACK FOR NEXT                             
FILT0880 EQU   *                                                                
         TM    RSARXFLG-RSARXEL(RF),X'10'                                       
*                                  'FORECAST' ORDER?                            
         BO    FILT1140            YES - NO BUYS, NO SPL - USE IT               
*                                  NO  - CONTINUE PROCESSING                    
FILT0900 EQU   *                                                                
*                                                                               
         CLI   RCTRACE,C'Y'                                                     
         BNE   FILT0920                                                         
         MVC   P+25(8),=C'CON TEST'                                             
*                                                                               
         LR    R3,RE                                                            
         GOTO1 HEXOUT,P1,RCONKCON,P+35,4,=C'N'                                  
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 =V(REREPORT),RR=RELO                                             
         LR    RE,R3                                                            
FILT0920 EQU   *                                                                
*                                                                               
         CLC   QPROG,=C'10'        CONTRACT PRINT?                              
         BNE   FILT0930            NO                                           
*                                                                               
*   CHECK IF $0 ORDERS ARE TO BE PASSED TO R10 REPORT                           
*                                                                               
         L     RF,=V(REPSREP)     GET ADDRESSIBILITY TO SUB REPS                
         USING RSREPD,RF                                                        
         CLI   NO$CON10,C'Y'       INCLUDE ZERO $$?                             
         BE    FILT1140            YES - PASS ALL ORDERS                        
         DROP  RF                                                               
FILT0930 EQU   *                                                                
         LA    R4,RCONELEM                                                      
         SR    R5,R5                                                            
FILT0940 IC    R5,1(R4)                                                         
         AR    R4,R5                                                            
         CLI   0(R4),0             TEST END OF K                                
         BNE   FILT0980                                                         
         SPACE 1                                                                
*                                                                               
         LA    R3,32                                                            
*                                                                               
         CLC   QPROG,=C'20'        PASS THE DISCREPANCY REPORT                  
         BE    FILT0960                                                         
         CLC   QPROG,=C'21'                                                     
         BNE   FILT1160            ALL CONTRACTS WITH NO ACTIVITY               
*                                                                               
FILT0960 EQU   *                                                                
         LA    R3,33                                                            
*                                                                               
         CLI   QOPTIONS,C'D'       UNLESS THEY HAVE ASKED FOR                   
         BE    FILT1160            DISCREPANCIES ONLY                           
         B     FILT1140            EXIT: RECORD OKAY                            
         SPACE 1                                                                
FILT0980 CLI   0(R4),3             LOOK FOR BUCKETS                             
         BE    *+12                                                             
         CLI   0(R4),4                                                          
         BNE   FILT0940                                                         
FILT0990 EQU   *                                                                
*                                                                               
         MVI   BYTE,C'N'                                                        
         CLC   QPROG,=C'20'        FOR 20, 21, 34 OR 35                         
         BE    FILT1000                                                         
         CLC   QPROG,=C'21'                                                     
         BE    FILT1000                                                         
         CLC   QPROG,=C'34'                                                     
         BE    FILT1000                                                         
         CLC   QPROG,=C'35'        ACCOUNTING OPTION OR TAPE                    
         BNE   FILT1020                                                         
FILT1000 EQU   *                                                                
         CLI   QACCTOPT,C'A'       LOOK FOR ACTIVITY IN KEYMONTH                
         BE    *+12                                                             
         CLI   QACCTOPT,C'T'                                                    
         BNE   FILT1020                                                         
         MVI   BYTE,C'Y'                                                        
         CLC   4(2,R4),KEYMONTH+2  TEST ACTIVITY AFTER KEY MONTH END            
         BH    FILT0940                                                         
*                                  TEST LAST YEAR                               
FILT1020 EQU   *                                                                
*                                                                               
         OC    PRIDTST(4),PRIDTST                                               
         BZ    FILT1060                                                         
*                                                                               
         CLI   RCTRACE,C'Y'                                                     
         BNE   FILT1040                                                         
         MVC   P+25(13),=C'PRIDTST/END/K'                                       
*                                                                               
         LR    R3,RE                                                            
         GOTO1 HEXOUT,P1,PRIDTST,P+40,2,=C'N'                                   
         GOTO1 HEXOUT,P1,PRIDTEND,P+50,2,=C'N'                                  
         GOTO1 HEXOUT,P1,(R4),P+60,4,=C'N'                                      
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 =V(REREPORT),RR=RELO                                             
         LR    RE,R3                                                            
FILT1040 EQU   *                                                                
         CLC   2(2,R4),PRIDTST                                                  
         BL    FILT0940                                                         
         CLC   PRIDTEND,2(R4)                                                   
         BNL   FILT1140            EXIT: RECORD OKAY                            
*                                  TEST AGAINST THIS YEAR                       
FILT1060 EQU   *                                                                
         CLI   RCTRACE,C'Y'                                                     
         BNE   FILT1080                                                         
         MVC   P+25(13),=C'CURDTST/END/K'                                       
*                                                                               
         LR    R3,RE                                                            
         GOTO1 HEXOUT,P1,CURDTST,P+40,2,=C'N'                                   
         GOTO1 HEXOUT,P1,CURDTEND,P+50,2,=C'N'                                  
         GOTO1 HEXOUT,P1,(R4),P+60,4,=C'N'                                      
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 =V(REREPORT),RR=RELO                                             
         LR    RE,R3                                                            
FILT1080 EQU   *                                                                
         CLC   CURDTST,2(R4)                                                    
         BH    FILT1100                                                         
         CLC   CURDTEND,2(R4)                                                   
         BNL   FILT1140            EXIT: RECORD OKAY                            
FILT1100 CLI   BYTE,C'Y'           20/21/34/35 ACCTING OPTION OR TAPE           
         BNE   FILT0940                                                         
FILT1120 EQU   *                                                                
         CLC   4(2,R4),KEYMONTH    KEY MONTH START                              
         BL    FILT0940                                                         
         B     FILT1140            EXIT: RECORD OKAY                            
FILT1140 EQU   *                                                                
         SR    R3,R3               SET CC = ZERO                                
         XC    DUB,DUB                                                          
         B     FILT1180                                                         
FILT1160 EQU   *                                                                
         LTR   R3,R3               SET CC NOT = ZERO                            
         ST    R3,DUB              PASS OUT VALUE                               
FILT1180 EQU   *                                                                
         XIT1                                                                   
*                                                                               
FILTKYSV DS    CL27                LOCAL SAVE FOR KEY                           
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
STAPOOL CSECT                                                                   
         DC    F'0'                                                             
         ENTRY TYPETBL                                                          
         CNOP  2,4                                                              
TYPETBL  DC    H'8'                                                             
         DC    A(TYPETBLX-1)                                                    
         DC    CL8'AARK NET'                                                    
         DC    CL8'BPENDING'                                                    
         DC    CL8'CCOMBIND'                                                    
         DC    CL8'DCUT-INS'                                                    
         DC    CL8'ETYPE E '                                                    
         DC    CL8'FTYPE F '                                                    
         DC    CL8'GTYPE G '                                                    
         DC    CL8'HTYPE H '                                                    
         DC    CL8'ITYPE I '                                                    
         DC    CL8'JTYPE J '                                                    
         DC    CL8'KTYPE K '                                                    
         DC    CL8'LTYPE L '                                                    
         DC    CL8'MTYPE M '                                                    
         DC    CL8'NNETWORK'                                                    
         DC    CL8'OTYPE O '                                                    
         DC    CL8'PNON-OPP'                                                    
         DC    CL8'QTYPE Q'                                                     
         DC    CL8'RREGULAR'                                                    
         DC    CL8'STYPE S '                                                    
         DC    CL8'TTEX NET'                                                    
         DC    CL8'UTYPE U '                                                    
         DC    CL8'VTYPE V '                                                    
         DC    CL8'WTYPE W '                                                    
         DC    CL8'XNON-SPL'                                                    
         DC    CL8'YTYPE Y '                                                    
         DC    CL8'ZTYPE Z '                                                    
TYPETBLX EQU   *                                                                
         EJECT                                                                  
*                                                                               
*- MULTIPLE CARD SUPPORT AREAS                                                  
*                                                                               
         DS    0D                                                               
         DC    CL8'*RQSTNUM'                                                    
         ENTRY RQSTNUM                                                          
RQSTNUM  CSECT                                                                  
         DS    X                   NUMBER OF RQST CARDS IN 'RQSTCARD'           
         SPACE 2                                                                
         DS    0D                                                               
         DC    CL8'RQSTCARD'                                                    
         ENTRY RQSTCARD                                                         
RQSTCARD CSECT                                                                  
         DS    1000X               'N' 80 BYTE RQST CARDS                       
         EJECT                                                                  
*                                                                               
*- DOWNLOADING SUPPORT AREAS                                                    
*                                                                               
         DS    0D                                                               
         DC    CL8'RCDOWNLD'                                                    
         ENTRY RCDOWNLD                                                         
RCDOWNLD CSECT                                                                  
         DS    X                   DOWNLOAD FLAG                                
         SPACE 2                                                                
         DS    0D                                                               
         DC    CL8'DOWNDONE'                                                    
         ENTRY DOWNDONE                                                         
DOWNDONE CSECT                                                                  
         DS    X                   DOWNLOAD DATA PRODUCED FLAG                  
         SPACE 2                                                                
         DS    0D                                                               
         DC    CL8'DOWNDEF*'                                                    
         ENTRY DOWNDEF                                                          
DOWNDEF  CSECT                                                                  
         DS    400X                200 ENTRIES, CL1 TYPE, CL1 LEN               
         SPACE 2                                                                
REFILCON CSECT                                                                  
         EJECT                                                                  
*        DSECT FOR EXTRA INFORMATION BLOCK                                      
XTRAINFD DSECT                                                                  
XTRAINFO DS    0XL32               EXTRA INFO PASSED TO APPLICATION             
XIAGCOPT DS    X                   AGENCY COUNTRY OPTIONS                       
XIAGCTRY DS    X                   AGENCY COUNTRY                               
XICTRY   DS    X                   ACTUAL COUNTRY (WHERE TERMINAL IS)           
XILANG   DS    X                   AGENCY LANGUAGE CODE                         
XIAGCURR DS    CL3                 AGENCY CURRENCY CODE                         
XIFLAG1  DS    X                   CONNECT INFO FLAG                            
XIROSYS  EQU   X'80'               CONNECTED TO READ ONLY SYSTEM                
XIROMODE EQU   X'40'               CONNECTED IN READ ONLY MODE                  
XIWRONGF EQU   X'20'               CONNECTED TO WRONG FACPAK                    
XITSTADV EQU   X'10'               CONNECTED TO TEST FACPAK                     
XIDDSPER EQU   X'08'               DDS PERSON                                   
XIDDSTRM EQU   X'04'               DDS TERMINAL                                 
XIPPSAGY EQU   X'02'               PPS AGENCY                                   
XIDDSPOV EQU   X'01'               DDS PERSON OVERRIDE ON AGYPER                
*                                                                               
XIUSER   DS    XL2                 USER ID                                      
XIUPDFAC DS    CL4                 UPDATIVE FACPAK ID                           
XIAGYALP DS    CL2                 AGENCY ALPHA                                 
XIAGYSEC DS    CL2                 AGENCY SECURITY ALPHA                        
*              DSECT FOR MONARCH                                                
         SPACE 1                                                                
MONARCHD DSECT                                                                  
TRACEKEY DS    CL32                                                             
FILTKEY  DS    CL32                                                             
MONINFO  DS    CL192                                                            
MONFORC  DS    CL4                                                              
MONACT   DS    CL8                                                              
CONTDA   DS    CL4                                                              
CONTIO   DS    CL4                                                              
CONTLEN  DS    CL2                                                              
CONTRET  DS    F                                                                
TRACEDM8 DS    CL1                                                              
FT1      DS    CL1                                                              
FT2      DS    CL1                                                              
FT3      DS    CL1                                                              
FTA      DS    CL1                                                              
FTC      DS    CL1                                                              
FTS      DS    CL1                                                              
DEPTH    DS    CL1                                                              
SVGROUP  DS    CL2                                                 V 12         
STANUM   DS    F                                                   V 12         
KEYMONTH DS    CL4                                                              
LASTMON  DS    CL4                                                              
CURDTST  DS    CL2                                                              
CURDTEND DS    CL2                                                              
PRIDTST  DS    CL2                                                              
PRIDTEND DS    CL2                                                              
         EJECT                                                                  
****     INCLUDE REREPWORKD                                                     
****     INCLUDE DDMASTD                                                        
****     INCLUDE REGENALLB1                                                     
****     INCLUDE REREPMODES                                                     
****     INCLUDE REREPFMODE                                                     
         SPACE 2                                                                
       ++INCLUDE REREPWORKD                                                     
         EJECT                                                                  
       ++INCLUDE DDMASTD                                                        
         EJECT                                                                  
       ++INCLUDE REGENALLB1                                                     
         EJECT                                                                  
       ++INCLUDE REREPMODES                                                     
         EJECT                                                                  
       ++INCLUDE REREPFMODE                                                     
         EJECT                                                                  
       ++INCLUDE REXADDRD                                                       
         EJECT                                                                  
       ++INCLUDE RESUBREPS                                                      
         EJECT                                                                  
       ++INCLUDE REGENREQ2                                                      
         EJECT                                                                  
       ++INCLUDE DDTSARD                                                        
         EJECT                                                                  
       ++INCLUDE DDCOMFACS                                                      
CCFACLEN EQU   *                                                                
         EJECT                                                                  
       ++INCLUDE DDCOREQUS                                                      
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'002REFILCON  01/07/14'                                      
         END                                                                    

*          DATA SET PZLOAD     AT LEVEL 030 AS OF 05/01/02                      
*CATALP PZLOAD                                                                  
*INCLUDE QSORT                                                                  
*        TITLE 'PZLOAD - TAPE TO WORKER FILE'                                   
***********************************************************************         
*                                                                     *         
*  REGISTER USAGE                                                     *         
*  R0 - OS & WORK                                                     *         
*  R1 - OS & WORK                                                     *         
*  R2 - WORK                                                          *         
*  R3 - WORK                                                          *         
*  R4 - WORK                                                          *         
*  R5 - WORK                                                          *         
*  R6 - WORK                                                          *         
*  R7 - WORK                                                          *         
*  R8 -               NOT USED                                        *         
*  R9 - SECOND BASE                                                   *         
*  RA - DPRINT                                                        *         
*  RB - FIRST BASE REG                                                *         
*  RC - EZLDWKD DSECT FROM NMOD CHAIN                                 *         
*  RD - STD REG SAVE CHAIN                                            *         
*  RE - OS & WORK                                                     *         
*  RF - OS & WORK                                                     *         
*                                                                     *         
***********************************************************************         
*                                                                     *         
* NOTES-                                                                        
*   1) THROUGHOUT, READ 'STATION' AS 'PUBLICATION'                              
*   2) LOGIC FOR TOTALS BY MEDIA LEFT IN, MORE OR LESS                          
*      -MEDIA TABLE CREATE AND PRINT NOOPD                                      
*   3) 'HOLD' FILE LOGIC LEFT IN PLACE                                          
*                                                                               
* LEVEL                                                                         
*                                                                     *         
***********************************************************************         
         TITLE 'EASI - TAPE TO WORKER FILE'                                     
PZLOAD   CSECT                                                                  
         ENTRY UTL                                                              
*                                                                               
         PRINT NOGEN                                                            
         NBASE EZLDWKL,**EZLD,=A(REGSAVE),R9,CLEAR=YES                          
         USING EZLDWKD,RC                                                       
         L     RA,=V(CPRINT)                                                    
         USING DPRINT,RA                                                        
         GOTO1 =A(INIT),DMCB,(RC)                                               
         SPACE                                                                  
         BE    EZREAD                                                           
         SPACE                                                                  
EOJ      GOTO1 =V(PRINT),DMCB,=C'CLOSE'                                         
         CLI   ABNDOPT,C'Y'                                                     
         BNE   *+6                                                              
         DC    H'0'                                                             
         XBASE                                                                  
*                                                                               
EXIT     XIT1                                                                   
         EJECT                                                                  
*              READ INPUT DATA SET                                              
         SPACE 2                                                                
EZREAD   DS    0H                                                               
         MVI   FDELIM,X'5E'        FIELD DELIMITER - SEMI COLON                 
         MVI   RDELIM,X'15'        RECORD DELIMITER - NEW LINE                  
         LA    RE,RFVALS                                                        
         LA    RF,RFVALSL                                                       
         XCEF                                                                   
*                                                                               
         L     RE,=A(EZOTREC)                                                   
         ST    RE,WRCURPOS                                                      
         ST    RE,WRECST                                                        
         LA    RF,EZOTRECL                                                      
         XCEF                                                                   
*                                                                               
EZR010   DS    0H                                                               
         GOTO1 =A(GETFLD),DMCB,(RC)                                             
         BAS   RE,TRCRET           TRACE GETFLD RETURNS                         
*                                                                               
         TM    RFCTL,RFCTLEOF      TEST EOFILE                                  
         BNZ   EZR090                                                           
*                                                                               
         TM    RFCTL,RFCTLEOR      TEST END OF A RECORD                         
         BZ    EZR014                                                           
         BAS   RE,ENDREC                                                        
         L     RE,=A(EZOTREC)                                                   
         ST    RE,WRCURPOS                                                      
         ST    RE,WRECST                                                        
         LA    RF,EZOTRECL                                                      
         XCEF                                                                   
         B     EZR010                                                           
*                                                                               
*                                  HANDLE FIELD                                 
*                                  ------------                                 
*        NOTE- THIS CODE INVOLVING RECORD TYPES AND                             
*              FIELD NUMBERS IS NOT EXACTLY SOFT                                
*                                                                               
*                                                                               
EZR014   DS    0H                                                               
         CLI   RFFLDNO,1           FLD 1 IS RECORD TYPE                         
         BNE   EZR030                                                           
         CLI   RFLEN,2             RECORD TYPE MUST BE 2 CHARS LONG             
         BNE   TYPLENER                                                         
         LA    R0,TYPETLEN                                                      
         LA    R1,TYPETABL                                                      
EZR016   CLC   RFDATA(2),0(R1)                                                  
         BE    EZR018                                                           
         LA    R1,2(,R1)                                                        
         BCT   R0,EZR016                                                        
         DC    H'0'                                                             
         SPACE                                                                  
EZR018   MVC   RFRECST,RFFLDST     SET START OF RECORD                          
         MVC   RECTYP,RFDATA       SAVE RECORD TYPE                             
         EJECT                                                                  
         CLC   RECTYP,SCTRTYP      STANDARD TOP COMMENT                         
         BNE   EZR020                                                           
         SPACE                                                                  
* WILL READ AND SAVE UP TO 5 STD TOP COMMENTS                                   
* IF ANOTHER SET IS READ, THE SAVED ONES ARE CLEARED,                           
* AND THE NEW SET IS SAVED                                                      
         SPACE                                                                  
         TM    STDCMTSW,STDCMTOP   READING STD TOP COMMENTS                     
         BO    EZR010                                                           
         L     RE,=A(SAVSCT)                                                    
         LA    RF,SAVSCTLN         GET LENGTH                                   
         XCEF                                                                   
         OI    STDCMTSW,STDCMTOP   SET ON READING STD TOP COMMENTS              
         B     EZR010                                                           
*                                                                               
EZR020   DS    0H                                                               
         CLC   RECTYP,SCBRTYP      STANDARD BOTTOM COMMENT                      
         BNE   EZR021                                                           
         SPACE                                                                  
         TM    STDCMTSW,STDCMBOT   READING STD TOP COMMENTS                     
         BO    EZR010                                                           
         L     RE,=A(SAVSCB)                                                    
         LA    RF,SAVSCBLN         GET LENGTH                                   
         XCEF                                                                   
         OI    STDCMTSW,STDCMBOT   SET ON READING STD BOTTOM COMMENTS           
         B     EZR010                                                           
*                                                                               
EZR021   DS    0H                                                               
         NI    STDCMTSW,X'FF'-STDCMTOP-STDCMBOT  SET OFF STD COMMENT SW         
         SPACE                                                                  
         CLC   RECTYP,STARTYP      FOR STATION RECORD                           
         BNE   EZR022                                                           
         XC    STAFLDS,STAFLDS     CLEAR STATION FIELDS                         
         XC    STAFLDSA,STAFLDSA                                                
         B     EZR010                                                           
*                                                                               
EZR022   DS    0H                                                               
         CLC   RECTYP,AGYRTYP      FOR AGENCY RECORD                            
         BNE   EZR024                                                           
         XC    AGYFLDS,AGYFLDS     CLEAR AGENCY FIELDS                          
         B     EZR010                                                           
*                                                                               
EZR024   DS    0H                                                               
         CLC   RECTYP,TRTOTYP      TEST TRANSMISSION TOTAL REC                  
         BNE   EZR026                                                           
         XC    TOTINVS,TOTINVS     CLEAR BOTH TOTAL INVOICES & DOLLARS          
         ZAP   TOTDOLS,=P'0'                                                    
         B     EZR010                                                           
*                                                                               
EZR026   DS    0H                                                               
         CLC   RECTYP,INVRTYP      TEST INVOICE HEADER                          
         BNE   EZR029                                                           
         BAS   RE,ENDINV           FINISH OLD INVOICE                           
         SPACE                                                                  
         CLC   STAFLDS,OLDSTA      TEST CHANGE OF STATION                       
         BNE   EZR028                                                           
         SPACE                                                                  
         CLI   NEWBATSW,C'Y'       FORCED NEW BATCH (READING HOLD FILE)         
         BE    EZR028               YES, CHANGED DATE OR SOURCE                 
         SPACE                                                                  
         CLC   AGYFLDS,OLDAGY      OR AGENCY                                    
         BE    EZR010                                                           
*                                                                               
EZR028   DS    0H                     NEW BATCH                                 
         MVI   NEWBATSW,C'N'          SET OFF AGAIN                             
         SPACE                                                                  
         GOTO1 =A(ENDBTCH),DMCB,(RC)  PROCESS END OF BATCH                      
         GOTO1 =A(NEWIND),DMCB,(RC)   SET NEW WORKER INDEX AND PRINT            
         B     EZR010                                                           
         SPACE                                                                  
EZR029   CLC   RECTYP,SRCETYP      THIS A SOURCE RECORD                         
         BNE   EZR029B                                                          
         SPACE                                                                  
         OC    SVSRCE,SVSRCE       MUST BE WORKING ON HOLD FILE                 
         BNZ   EZR010               OK                                          
         DC    H'0'                                                             
         SPACE                                                                  
EZR029B  CLC   RECTYP,SPTRTYP      THIS A SPOT DETAIL RECORD                    
         BNE   EZR010                                                           
         L     RF,ISPTS            BUMP SPOT COUNT                              
         LA    RF,1(,RF)                                                        
         ST    RF,ISPTS                                                         
         SPACE                                                                  
         B     EZR010               OK                                          
*                                                                               
*                                  SPECIAL FIELD HANDLING                       
*                                  ----------------------                       
EZR030   DS    0H                                                               
         CLI   RFFLDNO,2           TEST FIELD 2                                 
         BNE   EZR032                                                           
         CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR030B                                                          
         MVC   STATION,RFDATA      SAVE STATION                                 
         OC    STATION,SPACES                                                   
         BAS   RE,FNDMED           AND GET STAMEDIA                             
         B     EZR010                                                           
*                                                                               
EZR030B  DS    0H                                                               
         CLC   RECTYP,AGYRTYP      TEST AGENCY RECORD                           
         BNE   EZR031                                                           
         MVC   AGYCODE,RFDATA      SAVE AGENCY CODE                             
         OC    AGYCODE,SPACES                                                   
         B     EZR010                                                           
*                                                                               
EZR031   DS    0H                                                               
         CLC   RECTYP,TRTOTYP      TEST TRANSMISSION TOTAL REC                  
         BNE   EZR031A                                                          
         SPACE                                                                  
         CLI   RFLEN,0             IF NO INPUT                                  
         BE    EZR010               BYPASS                                      
         SPACE                                                                  
         ZIC   RF,RFLEN                                                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,RFDATA(0)                                                    
         CVB   R0,DUB                                                           
         ST    R0,TOTINVS                                                       
         B     EZR010                                                           
*                                                                               
EZR031A  DS    0H                                                               
         CLC   RECTYP,INVRTYP      TEST INVOICE RECORD                          
         BNE   EZR031B                                                          
         MVC   ADVCD,RFDATA       SAVE ADVERTISER CODE                          
         B     EZR010                                                           
*                                                                               
EZR031B  DS    0H                                                               
         CLC   RECTYP,SRCETYP      THIS A SOURCE RECORD                         
         BNE   EZR031C                                                          
         SPACE                                                                  
         CLI   RFLEN,0             IF NO INPUT                                  
         BNE   *+6                  BIG PROBLEM                                 
         DC    H'0'                                                             
         OC    SVSRCE,SVSRCE       MUST BE WORKING ON HOLD FILE                 
         BNZ   *+6                  OK                                          
         DC    H'0'                                                             
         CLC   SOURCE,RFDATA                                                    
         BE    EZR010                                                           
         SPACE                                                                  
         MVC   SOURCE,RFDATA                                                    
         B     EZR010                                                           
*                                                                               
EZR031C  DS    0H                                                               
         B     EZR010                                                           
         SPACE                                                                  
*                                                                               
EZR032   DS    0H                                                               
         CLI   RFFLDNO,3           TEST FIELD 3                                 
         BNE   EZR040                                                           
         CLC   RECTYP,AGYRTYP      TEST AGENCY RECORD                           
         BNE   EZR034                                                           
         MVC   AGYNAME,RFDATA      SAVE AGENCY NAME                             
         B     EZR010                                                           
*                                                                               
EZR034   DS    0H                                                               
         CLC   RECTYP,INVRTYP      TEST INVOICE RECORD                          
         BNE   EZR036                                                           
         MVC   ADVNAM,RFDATA       SAVE ADVERTISER NAME                         
         B     EZR010                                                           
*                                                                               
EZR036   DS    0H                                                               
         CLC   RECTYP,INTRTYP      TEST INVOICE TOTAL                           
         BNE   EZR038                                                           
         CLI   RFLEN,0             IF NO INPUT                                  
         BE    EZR010               BYPASS                                      
         SPACE                                                                  
         BAS   RE,CKMINUS          CHECK FOR MINUS SIGN                         
         SPACE                                                                  
         ZIC   RF,RFLEN                                                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,RFDATA(0)                                                    
         SPACE                                                                  
         CLI   HOLDSIGN,C'-'       WAS THERE A MINUS                            
         BNE   *+8                  NO                                          
         XI    DUB+7,X'02'         FORCE TO MINUS VALUE                         
         SPACE                                                                  
         CVB   R0,DUB                                                           
         ST    R0,IDOLG                                                         
         B     EZR010                                                           
         SPACE                                                                  
EZR038   DS    0H                                                               
         CLC   RECTYP,TRTOTYP      TEST TRANSMISSION TOTAL REC                  
         BNE   EZR039                                                           
         SPACE                                                                  
         CLI   RFLEN,0             IF NO INPUT                                  
         BE    EZR010               BYPASS                                      
         SPACE                                                                  
         ZIC   RF,RFLEN                                                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,RFDATA(0)                                                    
         AP    TOTDOLS,DUB                                                      
         B     EZR010                                                           
         SPACE                                                                  
EZR039   CLC   RECTYP,SRCETYP      THIS A SOURCE RECORD                         
         BNE   EZR039B                                                          
         SPACE                                                                  
         CLI   RFLEN,0             IF NO INPUT                                  
         BNE   *+6                  BIG PROBLEM                                 
         DC    H'0'                                                             
         OC    SVSRCE,SVSRCE       MUST BE WORKING ON HOLD FILE                 
         BNZ   *+6                  OK                                          
         DC    H'0'                                                             
         CLC   HOLDDATE,RFDATA     DIFFERENT DATE?                              
         BE    EZR010                                                           
         SPACE                                                                  
         MVI   NEWBATSW,C'Y'       FORCE NEW BATCH                              
         MVC   HOLDDATE,RFDATA     SAVE ORIGINAL DATE                           
         B     EZR010                                                           
*                                                                               
EZR039B  DS    0H                                                               
         CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR010                                                           
         MVC   STANAME,RFDATA      SAVE STATION NAME                            
         B     EZR010                                                           
         SPACE                                                                  
*                                                                               
EZR040   DS    0H                                                               
         CLI   RFFLDNO,4           TEST FIELD 4                                 
         BNE   EZR050                                                           
         CLC   RECTYP,AGYRTYP      TEST AGENCY RECORD                           
         BNE   EZR044                                                           
         MVC   AGYLIN1,RFDATA      SAVE AGENCY ADDR 1                           
         B     EZR010                                                           
*                                                                               
EZR044   DS    0H                                                               
         CLC   RECTYP,INVRTYP      INVOICE RECORD                               
         BNE   EZR045                                                           
         MVC   PRDCD,RFDATA        SAVE PRODUCT CODE                            
         B     EZR010                                                           
EZR045   DS    0H                                                               
         CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR010                                                           
         MVC   STALIN1,RFDATA      SAVE STATION ADDR LINE 1                     
         B     EZR010                                                           
*                                                                               
EZR050   DS    0H                                                               
         CLI   RFFLDNO,5           FIELD 5                                      
         BNE   EZR056                                                           
         CLC   RECTYP,AGYRTYP      AGENCY RECORD                                
         BNE   EZR052                                                           
         MVC   AGYLIN2,RFDATA      SAVE AGENCY ADDR 2                           
         B     EZR010                                                           
*                                                                               
EZR052   DS    0H                                                               
         CLC   RECTYP,INVRTYP      INVOICE RECORD                               
         BNE   EZR054                                                           
         MVC   PRDNAM,RFDATA       SAVE PRODUCT NAME                            
         B     EZR010                                                           
         SPACE                                                                  
EZR054   DS    0H                                                               
         SPACE                                                                  
EZR055   DS    0H                                                               
         CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR010                                                           
         MVC   STALIN2,RFDATA      SAVE STATION ADDR LINE 2                     
         B     EZR010                                                           
         SPACE                                                                  
EZR056   DS    0H                                                               
         CLI   RFFLDNO,6           FIELD 6                                      
         BNE   EZR058                                                           
         CLC   RECTYP,AGYRTYP      AGENCY RECORD                                
         BNE   EZR057                                                           
         MVC   AGYLIN3,RFDATA      SAVE AGENCY ADDR 3                           
         B     EZR010                                                           
         SPACE                                                                  
EZR057   DS    0H                                                               
         CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR057B                                                          
         MVC   STALIN3,RFDATA      SAVE STATION ADDR LINE 3                     
         B     EZR010                                                           
EZR057B  DS    0H                                                               
         CLC   RECTYP,INVRTYP      INVOICE RECORD                               
         BNE   EZR057C                                                          
         MVC   ESTNO,RFDATA        SAVE ESTIMATE NUMBER                         
         B     EZR010                                                           
EZR057C  DS    0H                                                               
         CLC   RECTYP,INTRTYP      TEST INVOICE TOTAL                           
         BNE   EZR010                                                           
         SPACE                                                                  
         CLI   RFLEN,0             IF NO INPUT                                  
         BE    EZR010               BYPASS                                      
         SPACE                                                                  
         BAS   RE,CKMINUS          CHECK FOR MINUS SIGN                         
         SPACE                                                                  
         ZIC   RF,RFLEN                                                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,RFDATA(0)                                                    
         SPACE                                                                  
         CLI   HOLDSIGN,C'-'       WAS THERE A MINUS                            
         BNE   *+8                  NO                                          
         XI    DUB+7,X'02'         FORCE TO MINUS VALUE                         
         SPACE                                                                  
         CVB   R0,DUB                                                           
         ST    R0,IDOLN                                                         
         B     EZR010                                                           
*                                                                               
EZR058   DS    0H                                                               
         CLI   RFFLDNO,7           FIELD 7                                      
         BNE   EZR060                                                           
         CLC   RECTYP,AGYRTYP      AGENCY RECORD                                
         BNE   EZR059                                                           
         MVC   AGYLIN4,RFDATA      SAVE AGENCY ADDR 4                           
         B     EZR010                                                           
         SPACE                                                                  
EZR059   DS    0H                                                               
         CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR010                                                           
         MVC   STALIN4,RFDATA      SAVE STATION ADDR LINE 4                     
         B     EZR010                                                           
*                                                                               
EZR060   DS    0H                                                               
EZR066   DS    0H                                                               
         CLI   RFFLDNO,15          FIELD 15                                     
         BNE   EZR067                                                           
         CLC   RECTYP,INVRTYP      INVOICE HEADER RECORD                        
         BNE   EZR010                                                           
         MVC   INVMOS,RFDATA       SAVE MONTH OF SERVICE                        
         B     EZR010                                                           
*                                                                               
EZR067   DS    0H                                                               
         CLI   RFFLDNO,14          FIELD 14                                     
         BNE   EZR068                                                           
         CLC   RECTYP,INVRTYP      INVOICE HEADER RECORD                        
         BNE   EZR010                                                           
         MVC   INVNO,RFDATA        SAVE INVOICE NUMBER                          
         B     EZR010                                                           
*                                                                               
EZR068   DS    0H                                                               
         CLI   RFFLDNO,22          FIELD 22   BILLING INSTRUCTIONS              
         BNE   EZR070                                                           
         CLC   RECTYP,INVRTYP      INVOICE HEADER RECORD                        
         BNE   EZR010                                                           
         CLC   =C'BILLING INVOICE REVERSAL',RFDATA  THIS DELETE PRE INV         
         BNE   EZR010                                NO                         
         MVI   INVDEL,C'Y'         SET AS DELETE PREV INV                       
         L     RF,TDELINV          BUMP DEL PREV INVOICE COUNT                  
         LA    RF,1(,RF)                                                        
         ST    RF,TDELINV                                                       
         B     EZR010                                                           
*                                                                               
EZR070   DS    0H                                                               
EZR074   DS    0H                                                               
EZR076   DS    0H                                                               
EZR080   DS    0H                                                               
         CLI   RFFLDNO,100         FIELD 100 MAX EXPECTED                       
         BL    EZR010                                                           
         DC    H'0'                                                             
         EJECT                                                                  
* END OF INPUT EZHOLDR FILE, THEN EASI TAPE *                                   
         SPACE                                                                  
EZR090   DS    0H                  EOFILE                                       
         SPACE                                                                  
* PUT CHECK HERE FOR EZHOLD FILE, IF SO CLOSE IT,                               
* RESET SOURCE, AND START READING AEZINPT                                       
         SPACE                                                                  
         OC    SVSRCE,SVSRCE       ARE WE WORKING ON HOLD FILE                  
         BZ    EZR096                                                           
         MVC   SOURCE,SVSRCE                                                    
         XC    SVSRCE,SVSRCE       ZERO OUT SOURCE                              
         XC    HOLDDATE,HOLDDATE        AND DATE                                
         XC    OLDSTA,OLDSTA       FORCE CHANGE OF STATION                      
         XC    OLDAGY,OLDAGY       AND AGENCY                                   
         SPACE                                                                  
         L     R2,=A(EZHOLDR)                                                   
         CLOSE ((R2),)                                                          
         SPACE                                                                  
         NI    RFCTL2,X'FF'-RFCTL2EF     SET OFF DO EOFILE AFTER                
         NI    RFCTL,X'FF'-RFCTLEOF      SET OFF EOFILE                         
         OI    SVRECSW,SVRECSRC          SET NEED TO SAVE SOURCE & DATE         
         B     EZREAD                                                           
         SPACE                                                                  
EZR096   DS    0H                  EOFILE                                       
         BAS   RE,ENDINV           FINISH ANY OLD INVOICE                       
         SPACE                                                                  
         GOTO1 =A(ENDBTCH),DMCB,(RC)  PROCESS END OF BATCH                      
         SPACE                                                                  
         L     R2,AEZINPT                                                       
         CLOSE ((R2),)                                                          
         SPACE                                                                  
         MVC   LINE,=PL2'200'      FORCE NEW PAGE                               
         SPACE                                                                  
         SR    R2,R2                                                            
         CLI   TEST,C'Y'           THIS A TEST RUN                              
         BE    EZR110                                                           
         B     EZR110          ******WHATEVER THIS IS, NOOP                     
*                              ******IT FOR EPIC                                
         L     R2,=A(EZBILLF)                                                   
         CLOSE ((R2),)                                                          
         SPACE                                                                  
         L     R2,=A(EZWORKW)                                                   
         CLOSE ((R2),)                                                          
         FREEPOOL (R2)                                                          
         SPACE                                                                  
         SR    R2,R2                                                            
         LM    R3,R4,=A(EZWORKR,EZHOLDW)                                        
         SPACE                                                                  
         OPEN  ((R3),(INPUT))                                                   
         LTR   RF,RF               WAS OPEN GOOD                                
         BZ    *+6                                                              
         DC    H'0'                                                             
         OPEN  ((R4),(OUTPUT))                                                  
         LTR   RF,RF               WAS OPEN GOOD                                
         BZ    *+6                                                              
         DC    H'0'                                                             
         L     R5,=A(EZINREC)                                                   
         XC    0(256,R5),0(R5)                                                  
*                                                                               
EZR100   DS   0H                                                                
         GET   (R3),(R5)                                                        
         SPACE                                                                  
         LA    R2,1(,R2)                                                        
         SPACE                                                                  
         CLI   TRACEHLD,C'Y'                                                    
         BNE   EZR104                                                           
         CVD   R2,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+1(4),DUB                                                       
         LH    R0,0(R5)                                                         
         SH    R0,=H'4'                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         CH    R0,=H'372'                                                       
         BNH   *+6                                                              
         DC    H'0'                                                             
         UNPK  P+6(3),DUB                                                       
         MVC   P+10(3),=C'LEN'                                                  
         MVI   P+14,C'H'                                                        
         MVC   P+16(80),4(R5)                                                   
         OC    P+16(80),SPACES                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR104   DS   0H                                                                
         PUT   (R4),(R5)                                                        
         XC    0(256,R5),0(R5)                                                  
         B     EZR100                                                           
         SPACE                                                                  
EOFWORK  DS    0H                                                               
         CLOSE ((R3),)                                                          
         SPACE                                                                  
         LTR   R2,R2               ANY HOLD RECS                                
         BZ    EZR108               NO                                          
         SPACE                                                                  
* WRITE OUT '12' TOTALS RECORD FOR CONTENTS OF HOLD FILE *                      
         SPACE                                                                  
         XC    0(256,R5),0(R5)                                                  
         MVI   1(R5),26                                                         
         MVC   4(2,R5),=X'F1F2'                                                 
         MVC   6(1,R5),FDELIM                                                   
         SPACE                                                                  
         L     RF,HOINVS                                                        
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  7(5,R5),DUB                                                      
         MVI   12(R5),X'5E'                                                     
         SPACE                                                                  
         OI    HODOLG+7,X'0F'                                                   
         UNPK  13(11,R5),HODOLG                                                 
         MVC   24(1,R5),FDELIM                                                  
         MVC   25(1,R5),RDELIM                                                  
         SPACE                                                                  
         CLI   TRACEHLD,C'Y'                                                    
         BNE   EZR106                                                           
         LA    RF,1(,R2)                                                        
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+1(4),DUB                                                       
         LH    R0,0(R5)                                                         
         SH    R0,=H'4'                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         CH    R0,=H'372'                                                       
         BNH   *+6                                                              
         DC    H'0'                                                             
         UNPK  P+6(3),DUB                                                       
         MVC   P+10(3),=C'LEN'                                                  
         MVI   P+14,C'H'                                                        
         MVC   P+16(80),4(R5)                                                   
         OC    P+16(80),SPACES                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR106   DS   0H                                                                
         PUT   (R4),(R5)                                                        
         SPACE                                                                  
EZR108   DS   0H                                                                
         CLOSE ((R4),)                                                          
         SPACE                                                                  
         L     R1,WORKCT                                                        
         A     R1,WORKCT9                                                       
         CR    R2,R1                                                            
         BE    *+6                                                              
         DC    H'0'                                                             
EZR110   DS   0H                                                                
         GOTO1 =A(RUNTOT),DMCB,(RC)                                             
         SPACE                                                                  
         B     EOJ                                                              
         EJECT                                                                  
*        ENDREC - ROUTINE AT END OF RECORD                                      
*                                                                               
         DS    0H                                                               
ENDREC   NTR1                                                                   
         L     RF,WRCURPOS         CURRENT POS                                  
         S     RF,WRECST           LESS REC START                               
         BNP   ENDRX               = RECORD LENGTH (SKIP IF NONE)               
         ST    RF,RECLEN                                                        
*                                                                               
         BAS   RE,SAVREC           SAVE SOME RECORDS                            
         CLI   SAVSW,C'Y'          IF SAVED THIS REC, DONE                      
         BE    ENDRX                YES                                         
*                                                                               
*                                  ELSE WRITE TO FILE                           
*                                                                               
         CLC   STAFLDS,OLDSTA      TEST CHANGE OF STATION                       
         BNE   ENDR4                                                            
         CLI   NEWBATSW,C'Y'       FORCED NEW BATCH (READING HOLD FILE)         
         BE    ENDR4                                                            
         CLC   AGYFLDS,OLDAGY      OR AGENCY                                    
         BE    ENDR6                                                            
*                                                                               
ENDR4    DS    0H                  NEW BATCH                                    
         MVI   NEWBATSW,C'N'       SET OFF AGAIN                                
         SPACE                                                                  
         L     RF,WRECST           UNLESS TRIGGERED BY NEW INVOICE              
         CLC   0(2,RF),INVRTYP                                                  
         BE    *+8                                                              
         BAS   RE,ENDINV           FINISH ANY OLD INVOICE                       
         SPACE                                                                  
         GOTO1 =A(ENDBTCH),DMCB,(RC)  PROCESS END OF BATCH                      
         GOTO1 =A(NEWIND),DMCB,(RC)  SET NEW WORKER INDEX AND PRINT             
*                                                                               
ENDR6    DS    0H                                                               
         BAS   RE,PUTSAV           DO SAVED RECORDS FIRST                       
         L     R1,WKRREC           THEN THIS ONE                                
         BAS   RE,SAVRN            MOVE TO RECORD AREA                          
         BAS   RE,INVPROC          HANDLE INVOICE HEADER REC                    
*                                  (ALSO INSERT DETAIL REC)                     
         CLC   RECTYP,TRTOTYP      TEST TRANSMISSION TOTAL REC                  
         BE    ENDRX                DON'T PUT IT TO WORKER FILE                 
         SPACE                                                                  
         BAS   RE,ADDWKR                                                        
*                                                                               
ENDRX    DS    0H                                                               
         B     EXIT                                                             
         EJECT                                                                  
*        SAVREC - SAVE CERTAIN RECORDS                                          
*                                                                               
SAVREC   DS    0H                                                               
         MVI   SAVSW,C'Y'          SET HAVE SAVED                               
*                                                                               
         CLC   RECTYP,SRCETYP      THIS A SOURCE RECORD (HOLD FILE)             
         BER   RE                   ALREADY SAVED, DO NOT PROCESS               
*                                                                               
         CLC   RECTYP,STARTYP      STATION RECORD                               
         BNE   SAVR20                                                           
         L     R1,=A(SAVSTA)                                                    
         OI    SVRECSW,SVRECSTA                                                 
         B     SAVRN                                                            
*                                                                               
SAVR20   DS    0H                                                               
         CLC   RECTYP,PAYRTYP      PAYEE                                        
         BNE   SAVR40                                                           
         L     R1,=A(SAVPAY)                                                    
         OI    SVRECSW,SVRECPAY                                                 
         B     SAVRN                                                            
*                                                                               
SAVR40   DS    0H                                                               
         CLC   RECTYP,AGYRTYP      AGENCY                                       
         BNE   SAVR60                                                           
         L     R1,=A(SAVAGY)                                                    
         OI    SVRECSW,SVRECAGY                                                 
         B     SAVRN                                                            
*                                                                               
SAVR60   DS    0H                                                               
         CLC   RECTYP,SCTRTYP      STANDARD COMMENT TOP                         
         BNE   SAVR70                                                           
         CLC   RECLEN,=F'136'      FROM LENGTH                                  
         BNH   *+6                                                              
         DC    H'0'                                                             
         L     R1,=A(SAVSCT)                                                    
         LA    R0,5                SAVE 5 MAX                                   
SAVR66   OC    0(136,R1),0(R1)                                                  
         BZ    SAVR68                                                           
         LA    R1,136(,R1)                                                      
         BCT   R0,SAVR66                                                        
         SH    R1,=H'136'          STORE ALL OVER 5 IN LAST SLOT                
         SPACE                                                                  
SAVR68   OI    SVRECSW,SVRECSCT                                                 
         B     SAVRN                                                            
*                                                                               
SAVR70   DS    0H                                                               
         CLC   RECTYP,SCBRTYP      STANDARD COMMENT BOTTOM                      
         BNE   SAVR80                                                           
         CLC   RECLEN,=F'136'      FROM LENGTH                                  
         BNH   *+6                                                              
         DC    H'0'                                                             
         L     R1,=A(SAVSCB)                                                    
         LA    R0,5                SAVE 5 MAX                                   
SAVR76   OC    0(136,R1),0(R1)                                                  
         BZ    SAVR78                                                           
         LA    R1,136(,R1)                                                      
         BCT   R0,SAVR76                                                        
         SH    R1,=H'136'          STORE ALL OVER 5 IN LAST SLOT                
         SPACE                                                                  
SAVR78   OI    SVRECSW,SVRECSCB                                                 
         B     SAVRN                                                            
*                                                                               
SAVR80   DS    0H                                                               
         MVI   SAVSW,C'N'          SET NOT SAVED                                
         BR    RE                                                               
*                                                                               
         DS    0H                                                               
SAVRN    NTR1                                                                   
         L     RE,WRECST           START OF RECORD = FROM ADDRESS               
         L     RF,RECLEN           FROM LENGTH                                  
         LA    RF,4(RF)                                                         
         CH    RF,=H'1024'         CANNOT BE MORE THAN 1024                     
         BNH   *+6                                                              
         DC    H'0'                FOR NOW BLOW UP                              
         STH   RF,0(R1)                                                         
         SH    RF,=H'4'                                                         
         LA    R0,4(R1)            TO ADDRESS                                   
         LA    R1,1020             TO LENGTH                                    
         SPACE                                                                  
         CLC   RECTYP,SCBRTYP      STANDARD COMMENT BOTTOM                      
         BE    SAVRN10                                                          
         CLC   RECTYP,SCTRTYP      STANDARD COMMENT TOP                         
         BNE   SAVRN20                                                          
         SPACE                                                                  
SAVRN10  LA    R1,134              TO LENGTH                                    
         SPACE                                                                  
SAVRN20  MVCL  R0,RE                                                            
         SPACE                                                                  
         CR    RD,RD               SET CC =                                     
         B     EXIT                                                             
         EJECT                                                                  
*        PUTSAV - PUT SAVED RECORDS                                             
*                                                                               
         DS    0H                                                               
PUTSAV   NTR1                                                                   
         TM    SVRECSW,SVRECAGY    TEST NEED AGENCY                             
         BZ    PSV20                                                            
         NI    SVRECSW,X'FF'-SVRECAGY                                           
         L     R2,=A(SAVAGY)       AGENCY - FROM ADDRESS                        
         LH    R3,0(R2)            FROM LENGTH                                  
         L     R0,WKRREC           TO ADDRESS                                   
         LA    R1,1024             TO LENGTH                                    
         MVCL  R0,R2                                                            
         BAS   RE,ADDWKR                                                        
*                                                                               
PSV20    DS    0H                                                               
         TM    SVRECSW,SVRECSTA    TEST NEED STATION                            
         BZ    PSV40                                                            
         NI    SVRECSW,X'FF'-SVRECSTA                                           
         L     R2,=A(SAVSTA)       STATION - FROM ADDRESS                       
         LH    R3,0(R2)            FROM LENGTH                                  
         L     R0,WKRREC           TO ADDRESS                                   
         LA    R1,1024             TO LENGTH                                    
         MVCL  R0,R2                                                            
         BAS   RE,ADDWKR                                                        
*                                                                               
PSV40    DS    0H                                                               
         TM    SVRECSW,SVRECPAY    TEST NEED PAYEE                              
         BZ    PSV60                                                            
         NI    SVRECSW,X'FF'-SVRECPAY                                           
         L     R2,=A(SAVPAY)       PAYEE - FROM ADDRESS                         
         LH    R3,0(R2)            FROM LENGTH                                  
         L     R0,WKRREC           TO ADDRESS                                   
         LA    R1,1024             TO LENGTH                                    
         MVCL  R0,R2                                                            
         BAS   RE,ADDWKR                                                        
*                                                                               
PSV60    DS    0H                                                               
         TM    SVRECSW,SVRECSCT    TEST NEED STD CMT TOP                        
         BZ    PSV70                                                            
         NI    SVRECSW,X'FF'-SVRECSCT                                           
         L     R2,=A(SAVSCT)       STD CMT TOP - FROM ADDRESS                   
         LA    R4,5                MAX RECS                                     
         SPACE                                                                  
PSV64    LR    R6,R2                                                            
         LH    R3,0(R2)            FROM LENGTH                                  
         L     R0,WKRREC           TO ADDRESS                                   
         LA    R1,136              TO LENGTH                                    
         MVCL  R0,R2                                                            
         BAS   RE,ADDWKR                                                        
         SPACE                                                                  
         LA    R2,136(R6)                                                       
         OC    0(136,R2),0(R2)     ANOTHER REC                                  
         BZ    PSV70                NO                                          
         BCT   R4,PSV64                                                         
*                                                                               
PSV70    DS    0H                                                               
         TM    SVRECSW,SVRECSCB    TEST NEED STD CMT BOTTOM                     
         BZ    PSV80                                                            
         NI    SVRECSW,X'FF'-SVRECSCB                                           
         L     R2,=A(SAVSCB)       STD CMT BOT - FROM ADDRESS                   
         LA    R4,5                MAX RECS                                     
         SPACE                                                                  
PSV74    LR    R6,R2                                                            
         LH    R3,0(R2)            FROM LENGTH                                  
         L     R0,WKRREC           TO ADDRESS                                   
         LA    R1,136              TO LENGTH                                    
         MVCL  R0,R2                                                            
         BAS   RE,ADDWKR                                                        
         SPACE                                                                  
         LA    R2,136(R6)                                                       
         OC    0(136,R2),0(R2)     ANOTHER REC                                  
         BZ    PSV80                NO                                          
         BCT   R4,PSV74                                                         
*                                                                               
PSV80    B     EXIT                                                             
         EJECT                                                                  
*        INVPROC - HANDLE INVOICE HEADER RECORD                                 
*                (ADD 12 BYTE STATUS FIELD + DELIMITER, AND PRINT)              
*                                                                               
INVPROC  DS    0H                                                               
         CLC   RECTYP,INVRTYP      TEST INVOICE HEADER                          
         BE    INVP                                                             
         CLC   RECTYP,SPTRTYP      ALSO HANDLES INSERT DETAIL RECS              
         BE    INSP                                                             
         BR    RE                                                               
*                                                                               
         DS    0H                                                               
INVP     NTR1                                                                   
         L     RF,BINVS            BUMP INVOICE COUNT                           
         LA    RF,1(RF)                                                         
         ST    RF,BINVS                                                         
*                                                                               
         L     R2,WKRREC           FROM WKRREC                                  
         LH    R3,0(R2)            FROM LENGTH                                  
         CH    R3,=H'1024'         MAX LENGTH                                   
         BL    *+6                                                              
         DC    H'0'                                                             
         L     R0,=A(RECWRK)       TO WORK AREA                                 
         LR    R1,R3               TO LENGTH                                    
         MVCL  R0,R2                                                            
*                                                                               
         L     R2,WKRREC                                                        
         CLC   6(1,R2),FDELIM      FIELD DELIMITER AFTER REC CODE               
         BE    *+6                 AT END OF REC CODE                           
         DC    H'0'                BAD RECORD                                   
*                                                                               
         XC    7(20,R2),7(R2)      SET 20 BYTE STATUS FIELD                     
         OI    7(R2),X'80'         EZMOD TO DROP LEADING BLANKS                 
         MVC   27(1,R2),FDELIM                                                  
*                                                                               
         LH    RF,0(R2)            BUMP RECORD LENGTH                           
         LA    RF,21(RF)                                                        
         STH   RF,0(R2)                                                         
*                                                                               
         LA    R0,28(R2)           TO ADDRESS                                   
         L     R2,=A(RECWRK)                                                    
         LH    R3,0(R2)                                                         
         LA    R2,7(,R2)           FROM ADDRESS                                 
         SH    R3,=H'7'            FROM LENGTH                                  
         LR    R1,R3               TO LENGTH = FROM LENGTH                      
         CH    R3,=H'1024'                                                      
         BL    *+6                                                              
         DC    H'0'                                                             
         MVCL  R0,R2                                                            
*                                                                               
         B     EXIT                                                             
         SPACE 2                                                                
INSP     NTR1                                                                   
         L     R2,WKRREC           FROM WKRREC                                  
         LH    R3,0(R2)            FROM LENGTH                                  
         CH    R3,=H'1024'         MAX LENGTH                                   
         BL    *+6                                                              
         DC    H'0'                                                             
         L     R0,=A(RECWRK)       TO WORK AREA                                 
         LR    R1,R3               TO LENGTH                                    
         MVCL  R0,R2                                                            
*                                                                               
         L     R2,WKRREC                                                        
         CLC   6(1,R2),FDELIM      FIELD DELIMITER AFTER REC CODE               
         BE    *+6                 AT END OF REC CODE                           
         DC    H'0'                BAD RECORD                                   
*                                                                               
         XC    7(10,R2),7(R2)      SET 10 BYTE STATUS FIELD                     
         OI    7(R2),X'80'         EZMOD TO DROP LEADING BLANKS                 
         MVC   17(1,R2),FDELIM                                                  
*                                                                               
         LH    RF,0(R2)            BUMP RECORD LENGTH                           
         LA    RF,11(RF)                                                        
         STH   RF,0(R2)                                                         
*                                                                               
         LA    R0,18(R2)           TO ADDRESS                                   
         L     R2,=A(RECWRK)                                                    
         LH    R3,0(R2)                                                         
         LA    R2,7(,R2)           FROM ADDRESS                                 
         SH    R3,=H'7'            FROM LENGTH                                  
         LR    R1,R3               TO LENGTH = FROM LENGTH                      
         CH    R3,=H'1024'                                                      
         BL    *+6                                                              
         DC    H'0'                                                             
         MVCL  R0,R2                                                            
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
*        ENDINV  - END OF AN INVOICE                                            
*                                                                               
ENDINV   DS    0H                                                               
         OC    INVFLDS,INVFLDS                                                  
         BZR   RE                                                               
*                                                                               
         DS    0H                                                               
ENDI     NTR1                                                                   
         CLI   EXCLSW,C'Y'         SKIP EXPRESSLY EXCLUDED BATCHES              
         BE    ENDI40                                                           
*                                                                               
         MVC   ILADV,ADVNAM                                                     
         MVC   ILPRD,PRDNAM                                                     
         MVC   ILINV,INVNO                                                      
         MVC   ILMOS,INVMOS                                                     
         SPACE                                                                  
         CLI   INVDEL,C'Y'         SET AS DELETE PREV INV                       
         BNE   ENDI02                                                           
         MVC   ERRLINE(32),=C'* NOTE * DELETE PREVIOUS INVOICE'                 
         SPACE                                                                  
ENDI02   OC    ADVCD,ADVCD         ANY ADVERTISER CODE                          
         BZ    ENDI10                                                           
         MVC   ILADVCD,ADVCD                                                    
         SPACE                                                                  
* CHECK FOR OBVIOUS ERRORS *                                                    
         SPACE                                                                  
         CLI   ADVCD,C'A'                                                       
         BL    ENDI08                                                           
         CLI   ADVCD,C'Z'                                                       
         BH    ENDI08                                                           
         CLI   ADVCD+1,C'A'                                                     
         BL    ENDI08                                                           
         CLI   ADVCD+1,C'Z'                                                     
         BH    ENDI08                                                           
         CLI   ADVCD+2,0                                                        
         BE    ENDI06                                                           
         CLI   ADVCD+2,C' '                                                     
         BE    ENDI06                                                           
         CLI   ADVCD+3,C' '                                                     
         BH    ENDI08                                                           
         CLI   ADVCD+2,C'A'                                                     
         BL    ENDI08                                                           
         CLI   ADVCD+2,C'9'                                                     
         BH    ENDI08                                                           
ENDI06   L     R1,TCLTCDS                                                       
         LA    R1,1(,R1)                                                        
         ST    R1,TCLTCDS                                                       
         B     ENDI10                                                           
ENDI08   MVC   ERRLINE+ILADVCD-P(3),=C'***'                                     
*                                                                               
ENDI10   OC    PRDCD,PRDCD         ANY PRODUCT CODE(S)                          
         BZ    ENDI20                                                           
         MVC   ILPRDCD,PRDCD                                                    
         SPACE                                                                  
* CHECK FOR OBVIOUS ERRORS *                                                    
         SPACE                                                                  
         CLI   PRDCD,C'A'                                                       
         BL    ENDI12                                                           
         CLI   PRDCD,C'Z'                                                       
         BH    ENDI12                                                           
         CLI   PRDCD+1,C'A'                                                     
         BL    ENDI12                                                           
         CLI   PRDCD+1,C'Z'                                                     
         BH    ENDI12                                                           
         CLI   PRDCD+2,0                                                        
         BE    ENDI11                                                           
         CLI   PRDCD+2,C' '                                                     
         BE    ENDI11                                                           
         CLI   PRDCD+3,C' '                                                     
         BH    ENDI12                                                           
         CLI   PRDCD+2,C'A'                                                     
         BL    ENDI12                                                           
         CLI   PRDCD+2,C'Z'                                                     
         BH    ENDI12                                                           
ENDI11   L     R1,TPRDCDS                                                       
         LA    R1,1(,R1)                                                        
         ST    R1,TPRDCDS                                                       
         B     ENDI13                                                           
ENDI12   MVC   ERRLINE+ILPRDCD-P(3),=C'***'                                     
*                                                                               
ENDI13   LA    R0,8                                                             
         LA    RF,PRDCD                                                         
ENDI14   CLI   0(RF),C' '          LOOK FOR BLANK SEPARATOR                     
         BNH   *+16                                                             
         LA    RF,1(,RF)                                                        
         BCT   R0,ENDI14                                                        
         B     ENDI20                                                           
         LA    RF,1(,RF)                                                        
         BCTR  R0,0                                                             
         LTR   R0,R0                                                            
         BZ    ENDI20           GET OUT IF END OF FIELD                         
*                                                                               
ENDI16   CLI   0(RF),C' '          LOOK FOR NON-BLK PROD2                       
         BH    *+16                                                             
         LA    RF,1(,RF)                                                        
         BCT   R0,ENDI16                                                        
         B     ENDI20                                                           
*                                                                               
         XC    WORK,WORK                                                        
         LA    RE,WORK                                                          
         MVC   0(1,RE),0(RF)                                                    
         LA    RE,1(,RE)                                                        
         LA    RF,1(,RF)                                                        
         BCT   R0,*-14                                                          
*                                                                               
         CLI   WORK,C'A'                                                        
         BL    ENDI18                                                           
         CLI   WORK,C'Z'                                                        
         BH    ENDI18                                                           
         CLI   WORK+1,C'A'                                                      
         BL    ENDI18                                                           
         CLI   WORK+1,C'Z'                                                      
         BH    ENDI18                                                           
         CLI   WORK+2,0                                                         
         BE    ENDI20                                                           
         CLI   WORK+2,C' '                                                      
         BE    ENDI20                                                           
         CLI   WORK+2,C'A'                                                      
         BL    ENDI18                                                           
         CLI   WORK+2,C'Z'                                                      
         BNH   ENDI20                                                           
ENDI18   MVC   ERRLINE+ILPRDCD-P(3),=C'***'                                     
*                                                                               
ENDI20   OC    ESTNO,ESTNO         ANY ESTIMATE                                 
         BZ    ENDI30                                                           
         MVC   ILEST,ESTNO                                                      
         XC    FULL,FULL                                                        
         LA    R0,10                                                            
         LA    R1,FULL                                                          
         LA    RE,ESTNO                                                         
         LA    RF,3                                                             
         MVI   BYTE,0                                                           
         SPACE                                                                  
         CLI   0(RE),C' '                                                       
         BH    ENDI21                                                           
         LA    RE,1(,RE)                                                        
         BCT   R0,*-12                                                          
         DC    H'0'                                                             
ENDI21   CLI   0(RE),C'0'                                                       
         BNE   ENDI22                                                           
         LA    RE,1(,RE)                                                        
         BCT   R0,*-12                                                          
         MVI   BYTE,1                                                           
         B     ENDI26                                                           
         SPACE                                                                  
ENDI22   CLI   0(RE),C'0'                                                       
         BL    ENDI24                                                           
         CLI   0(RE),C'9'                                                       
         BH    ENDI25                                                           
         MVC   0(1,R1),0(RE)                                                    
         LA    R1,1(,R1)                                                        
         LA    RE,1(,RE)                                                        
         BCT   RF,*+8              GET FIRST 3 DIGITS ONLY                      
         B     ENDI24                                                           
         BCT   R0,ENDI22           ALLOW MAX EST FIELD LENGTH                   
ENDI24   LA    R0,3                                                             
         LA    R1,FULL                                                          
         SR    RF,RF                                                            
         CLI   0(R1),0                                                          
         BE    *+14                                                             
         LA    R1,1(,R1)                                                        
         BCTR  RF,0                                                             
         BCT   R0,*-14                                                          
         LPR   RF,RF                                                            
         BZ    ENDI28                                                           
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,FULL(0)                                                      
         CVB   R0,DUB                                                           
         CH    R0,=H'256'                                                       
         BL    ENDI26                                                           
         SPACE                                                                  
ENDI25   MVI   BYTE,1                                                           
         SPACE                                                                  
ENDI26   DS    0H                                                               
         CLI   BYTE,1                                                           
         BNE   ENDI29                                                           
ENDI28   MVC   ERRLINE+ILEST-P(3),=C'***'                                       
         B     ENDI30                                                           
ENDI29   L     R1,TESTCDS                                                       
         LA    R1,1(,R1)                                                        
         ST    R1,TESTCDS                                                       
         SPACE                                                                  
ENDI30   DS    0H                                                               
         L     R2,ISPTS                                                         
         LA    R3,ILSPTS                                                        
         BAS   RE,EDIT0                                                         
         SPACE                                                                  
         L     R2,IDOLN                                                         
         LA    R3,ILDOLS                                                        
         BAS   RE,EDIT2                                                         
         SPACE                                                                  
         MVC   ILNET,STANET                                                     
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         CLI   INVDEL,C'Y'         SET AS DELETE PREV INV                       
         BNE   ENDI34                                                           
         OC    IDOLG,IDOLG         WAS THIS ZERO INVOICE                        
         BZ    ENDI34               YES                                         
         MVC   ERRLINE+ILDOLS-P-14(26),=C'ERROR-DEL INV MUST BE ZERO'           
         SPACE                                                                  
ENDI34   OC    ERRLINE,ERRLINE                                                  
         BZ    ENDI40                                                           
         MVC   P,ERRLINE                                                        
         XC    ERRLINE,ERRLINE                                                  
*                                                                               
         GOTO1 =V(PRINTER)                                                      
*                                                                               
ENDI40   DS    0H                                                               
         CLI   TEST,C'Y'           SKIP BILLING IF TEST RUN                     
         BE    ENDI200                                                          
         CLI   EXCLSW,C'N'         SKIP BILLING IF EXCLUDE                      
         BNE   ENDI200                                                          
*                                                                               
* BUILD AND WRITE EZ BILLING RECORD TO SEQUENTIAL FILE                          
*                                                                               
         XC    EZBILL(256),EZBILL                                               
         XC    EZBILL+256(256),EZBILL+256                                       
         LA    R2,EZBILL                                                        
         USING EZBILLD,R2                                                       
         SPACE                                                                  
         MVC   EZBAGY,USID                                                      
         MVC   EZBSRC,SOURCE                                                    
         MVC   EZBCALL,BILSTA                                                   
         MVC   EZBNET,STANET                                                    
         MVC   EZBMOS,INVMOS                                                    
         MVC   EZBTODAY,TODAY                                                   
         MVC   EZBADVNM,ADVNAM                                                  
         MVC   EZBPRDNM,PRDNAM                                                  
         MVC   EZBINVNO,INVNO                                                   
         L     R0,ISPTS                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  EZBNSPTS,DUB                                                     
         L     R0,IDOLG                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  EZBGDOL,DUB                                                      
         L     R0,IDOLN                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  EZBNDOL,DUB                                                      
         MVC   EZBAGYNM(150),SVAGYFL                                            
         MVC   EZBSTADR,OLDSTAD                                                 
         SPACE                                                                  
         L     R0,=A(EZBILLF)                                                   
         PUT   (0),EZBILL                                                       
         DROP  R2                                                               
         XC    EZBILL(256),EZBILL                                               
         XC    EZBILL+256(256),EZBILL+256                                       
         SPACE                                                                  
ENDI200  DS    0H                                                               
         XC    INVFLDS,INVFLDS                                                  
         L     RF,ISPTS            ROLL UP TO BATCH TOTALS                      
         A     RF,BSPTS                                                         
         ST    RF,BSPTS                                                         
         L     RF,IDOLN            ROLL UP TO BATCH TOTALS                      
         A     RF,BDOLN                                                         
         ST    RF,BDOLN                                                         
         L     RF,IDOLG            ROLL UP TO BATCH TOTALS                      
         A     RF,BDOLG                                                         
         ST    RF,BDOLG                                                         
         SPACE                                                                  
         BAS   RE,ADDSTA           ADD TO STATION COUNTERS                      
         SPACE                                                                  
         BAS   RE,ADDAGY           ADD TO AGENCY COUNTERS                       
         SPACE                                                                  
         XC    IDOLN,IDOLN                                                      
         XC    IDOLG,IDOLG                                                      
         XC    ISPTS,ISPTS                                                      
         SPACE                                                                  
         B     EXIT                                                             
EDIT0    NTR1                                                                   
         EDIT  ((R2)),(5,(R3)),ZERO=NOBLANK                                     
         B     EXIT                                                             
EDIT2    NTR1                                                                   
         EDIT  ((R2)),(14,(R3)),2,COMMAS=YES,ZERO=NOBLANK,MINUS=YES             
         B     EXIT                                                             
         EJECT                                                                  
*        ADDWKR - ADD RECORD TO WORKER FILE                                     
*                                                                               
         DS    0H                                                               
ADDWKR   NTR1                                                                   
         L     R4,WKRREC                                                        
         LH    R5,0(R4)            LENGTH                                       
         CH    R5,=H'6'            SKIP IF NO REAL RECORD                       
         BNH   ADDWKRX                                                          
         CH    R5,=H'1020'         MAX REC SIZE                                 
         BNH   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         CLI   EXCLSW,C'N'         SKIP ADDS IF EXCLUDE                         
         BNE   ADDW20                                                           
         CLI   TEST,C'Y'           SKIP ADDS IF TESTING                         
         BE    ADDW30                                                           
ADDW10   DS    0H                                                               
         GOTO1 =V(DATAMGR),DMCB,=C'ADD',WKRFIL,0,WKRREC,WKRBUF                  
         B     ADDW30                                                           
         SPACE                                                                  
* WRITE TO HOLD FILE HERE IF UNKNOWN AGENCY OR FULL WORKER FILE *               
         SPACE                                                                  
ADDW20   DS    0H                                                               
         CLI   EXCLSW,C'Y'         SKIP EXPRESSLY EXCLUDED BATCHES              
         BE    ADDW30                                                           
         SPACE                                                                  
         CLI   EXCLSW,C'*'         SET TO EXCLUDE WORKER FILE FULL              
         BE    *+6                                                              
         DC    H'0'                                                             
         SPACE                                                                  
         TM    SVRECSW,SVRECSRC                                                 
         BZ    ADDW24                                                           
         NI    SVRECSW,X'FF'-SVRECSRC                                           
         L     R2,=A(HLDREC)                                                    
         XC    0(256,R2),0(R2)                                                  
         MVI   1(R2),20                                                         
         MVC   4(3,R2),=X'F9F95E'                                               
         MVC   7(4,R2),SOURCE                                                   
         MVI   11(R2),X'5E'                                                     
         MVC   12(6,R2),HOLDDATE                                                
         SPACE                                                                  
         OC    HOLDDATE,HOLDDATE   IS THIS AN OLD BATCH?                        
         BNZ   *+10                 YES                                         
         MVC   12(6,R2),TODAY                                                   
         SPACE                                                                  
         MVC   18(2,R2),=X'5E15'                                                
         SPACE                                                                  
         L     RF,WORKCT9                                                       
         LA    RF,1(,RF)                                                        
         ST    RF,WORKCT9                                                       
         SPACE                                                                  
         CLI   TRACEWRK,C'Y'       PRINT OUT WORK FILE                          
         BNE   ADDW22                                                           
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+1(4),DUB                                                       
         LH    R0,0(R2)                                                         
         SH    R0,=H'4'                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         CH    R0,=H'372'                                                       
         BNH   *+6                                                              
         DC    H'0'                                                             
         UNPK  P+6(3),DUB                                                       
         MVC   P+10(3),=C'LEN'                                                  
         MVI   P+14,C'W'                                                        
         MVC   P+16(80),4(R2)                                                   
         OC    P+16(80),SPACES                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
ADDW22   DS    0H                                                               
         CLI   TEST,C'Y'           THIS A TEST RUN                              
         BE    ADDW24                                                           
         SPACE                                                                  
         L     R0,=A(EZWORKW)                                                   
         PUT   (0),(R2)                                                         
         SPACE                                                                  
* MOVE TO WRITE RECORD AREA, ADD 2 TO LEN, SAVE IT, ZERO NEXT 2 BYTES           
* MOVE REST OF RECORD TO +4                                                     
         SPACE                                                                  
ADDW24   L     R1,=A(HLDREC)                                                    
         XC    0(256,R1),0(R1)                                                  
         LR    R2,R1                                                            
         LA    R5,2(,R5)            ADD 2 TO LENGTH                             
         STH   R5,0(,R1)                                                        
         LA    R0,4(,R1)                                                        
         SH    R5,=H'4'                                                         
         LA    R4,2(,R4)            MOVE RECORD ONLY                            
         LR    R1,R5                                                            
         SPACE                                                                  
         CLC   =X'F3F15E',0(R4)    THIS INVOICE HEADER REC                      
         BNE   ADDW26               NOPE                                        
         SPACE                                                                  
         SH    R5,=H'21'                                                        
         STH   R5,0(,R2)           STORE NEW LENGTH                             
         LR    RF,R0                                                            
         MVC   0(3,RF),0(R4)       DROP                                         
         LA    R0,3(,RF)                INTERNAL                                
         LA    R4,24(,R4)                        20 BYTE FIELD                  
         SH    R5,=H'3'                                                         
         LR    R1,R5                                                            
         SPACE                                                                  
ADDW26   MVCL  (R0),(R4)                                                        
         SPACE                                                                  
         L     RF,WORKCT                                                        
         LA    RF,1(,RF)                                                        
         ST    RF,WORKCT                                                        
         SPACE                                                                  
         CLI   TRACEWRK,C'Y'       PRINT OUT WORK FILE                          
         BNE   ADDW28                                                           
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+1(4),DUB                                                       
         LH    R0,0(R2)                                                         
         SH    R0,=H'4'                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         CH    R0,=H'372'                                                       
         BNH   *+6                                                              
         DC    H'0'                                                             
         UNPK  P+6(3),DUB                                                       
         MVC   P+10(3),=C'LEN'                                                  
         MVI   P+14,C'W'                                                        
         MVC   P+16(80),4(R2)                                                   
         OC    P+16(80),SPACES                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
ADDW28   DS   0H                                                                
         CLI   TEST,C'Y'           THIS A TEST RUN                              
         BE    ADDW30                                                           
         SPACE                                                                  
         L     R0,=A(EZWORKW)                                                   
         PUT   (0),(R2)                                                         
         SPACE                                                                  
ADDW30   BAS   RE,DMPREC                                                        
*                                                                               
ADDWKRX  DS    0H                                                               
         B     EXIT                                                             
         SPACE 2                                                                
*        DMPREC - RECORD ADDED TO WORKER FILE                                   
*                                                                               
DMPREC   CLI   TRACEWKR,C'Y'                                                    
         BNER  RE                                                               
*                                                                               
         DS    0H                                                               
DMP      NTR1                                                                   
         L     R6,WKRREC                                                        
         MVC   P(4),=C'WRKR'                                                    
         EDIT  (B2,0(R6)),(4,P+6),FILL=0                                        
         MVC   P+12(120),2(R6)                                                  
         GOTO1 =V(PRINTER)                                                      
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
*        CKMINUS - CHECK FOR MINUS AT START OR END OF RFDATA                    
*                                                                               
         SPACE                                                                  
CKMINUS  MVI   HOLDSIGN,0                                                       
         ZIC   RF,RFLEN                                                         
         CLI   RFDATA,C'-'         PRECEDED BY MINUS                            
         BNE   CKMIN10                                                          
         SPACE                                                                  
         EX    RF,CKMMVC                                                        
         BCTR  RF,0                                                             
         B     CKMIN20                                                          
         SPACE                                                                  
CKMIN10  BCTR  RF,0                                                             
         LA    R1,RFDATA(RF)                                                    
         CLI   0(R1),C'-'          LAST CHAR A MINUS                            
         BNE   CKMINX                                                           
         MVI   0(R1),0             BLANK MINUS                                  
CKMIN20  STC   RF,RFLEN                                                         
         MVI   HOLDSIGN,C'-'                                                    
         SPACE                                                                  
CKMINX   BR    RE                                                               
         SPACE                                                                  
CKMMVC   MVC   RFDATA(0),RFDATA+1                                               
*                                                                               
*        FNDMED - FIND MEDIA IN PUB TRANSLATE TABLE                             
*                                                                               
FNDMED   DS    0H                                                               
         L     RF,=V(PTRTAB)                                                    
         USING PTRTABD,RF                                                       
         MVI   STAMEDIA,C'X'                                                    
*                                                                               
FNDM2    DS    0H                                                               
         CLI   0(RF),X'FF'         EOL                                          
         BE    FNDMX                                                            
         CLC   USCODE,PTRUSCOD     RIGHT AGENCY?                                
         BNE   FNDM6                                                            
         CLC   STATION,PTRPZPUB    AND PUB                                      
         BNE   FNDM6                                                            
         MVC   STAMEDIA,PTRMED                                                  
         B     FNDMX                                                            
*                                                                               
FNDM6    DS    0H                                                               
         LA    RF,PTRTABL(RF)                                                   
         B     FNDM2                                                            
*                                                                               
FNDMX    DS    0H                                                               
         BR    RE                                                               
         EJECT                                                                  
*        ADDSTA - ADD TO STATION TABLE - 1 FOR INVOICE, SPOTS, $                
*                                                                               
ADDSTA   LA    R0,EZSTALEN-1                                                    
         L     R1,=A(EZSTATAB)                                                  
ADDSTA10 OC    0(5,R1),0(R1)       EMPTY ENTRY                                  
         BZ    ADDSTA20                                                         
         CLC   OLDSTA(5),0(R1)                                                  
         BE    ADDSTA24                                                         
         LA    R1,21(R1)                                                        
         BCT   R0,ADDSTA10                                                      
         SPACE                                                                  
         MVC   0(5,R1),=C'*****'                                                
         B     ADDSTA24                                                         
         SPACE                                                                  
ADDSTA20 MVC   0(5,R1),OLDSTA                                                   
         SPACE                                                                  
ADDSTA24 DS   0H                                                                
         CLI   EXCLSW,C'N'         IF EXCLSW NE N, NOT LOADED                   
         BNER  RE                   SKIP COUNTS                                 
         SPACE                                                                  
         ICM   RF,15,5(R1)                                                      
         LA    RF,1(,RF)                                                        
         STCM  RF,15,5(R1)                                                      
         ICM   RF,15,9(R1)                                                      
         A     RF,ISPTS                                                         
         STCM  RF,15,9(R1)                                                      
         ICM   RF,15,13(R1)                                                     
         A     RF,IDOLN                                                         
         STCM  RF,15,13(R1)                                                     
         ICM   RF,15,17(R1)                                                     
         A     RF,IDOLG                                                         
         STCM  RF,15,17(R1)                                                     
         BR    RE                                                               
         EJECT                                                                  
*        ADDAGY - ADD TO AGENCY TABLE - 1 FOR INVOICE, SPOTS, $                 
*                                                                               
ADDAGY   LA    R0,100                                                           
         L     R1,=A(EZAGYCTB)                                                  
ADDAGY10 OC    0(8,R1),0(R1)       EMPTY ENTRY                                  
         BZ    ADDAGY20                                                         
         CLC   USID,0(R1)                                                       
         BE    ADDAGY24                                                         
         LA    R1,24(,R1)                                                       
         BCT   R0,ADDAGY10                                                      
         DC    H'0'                                                             
         SPACE                                                                  
ADDAGY20 MVC   0(8,R1),USID                                                     
         SPACE                                                                  
ADDAGY24 DS   0H                                                                
         CLI   EXCLSW,C'N'         IF EXCLSW NE N, NOT LOADED                   
         BNE   ADDAGY26             SKIP COUNTS                                 
         SPACE                                                                  
         ICM   RF,15,8(R1)                                                      
         LA    RF,1(,RF)                                                        
         STCM  RF,15,8(R1)                                                      
         ICM   RF,15,12(R1)                                                     
         A     RF,ISPTS                                                         
         STCM  RF,15,12(R1)                                                     
         ICM   RF,15,16(R1)                                                     
         A     RF,IDOLN                                                         
         STCM  RF,15,16(R1)                                                     
         ICM   RF,15,20(R1)                                                     
         A     RF,IDOLG                                                         
         STCM  RF,15,20(R1)                                                     
         SPACE                                                                  
*        ADDAGY - ADD TO AGENCY NAME TABLE - 1 FOR INVOICE, SPOTS, $            
*                                                                               
ADDAGY26 LA    R0,100                                                           
         L     R1,=A(EZAGYNTB)                                                  
         OC    SVAGYFL(130),SPACES                                              
         OC    SVAGYFL+130(20),SPACES                                           
ADDAGY30 OC    0(170,R1),0(R1)      EMPTY ENTRY                                 
         BZ    ADDAGY40                                                         
         SPACE                                                                  
         CLC   SVAGYFL,0(R1)                                                    
         BE    ADDAGY44                                                         
         LA    R1,170(,R1)                                                      
         BCT   R0,ADDAGY30                                                      
         DC    H'0'                                                             
         SPACE                                                                  
ADDAGY40 MVC   0(150,R1),SVAGYFL                                                
         SPACE                                                                  
ADDAGY44 DS   0H                                                                
         CLI   EXCLSW,C'N'         IF EXCLSW NE N, NOT LOADED                   
         BNE   ADDAGY46             SKIP COUNTS                                 
         SPACE                                                                  
         ICM   RF,15,152(R1)                                                    
         LA    RF,1(,RF)                                                        
         STCM  RF,15,152(R1)                                                    
         ICM   RF,15,156(R1)                                                    
         A     RF,ISPTS                                                         
         STCM  RF,15,156(R1)                                                    
         ICM   RF,15,160(R1)                                                    
         A     RF,IDOLN                                                         
         STCM  RF,15,160(R1)                                                    
         ICM   RF,15,164(R1)                                                    
         A     RF,IDOLG                                                         
         STCM  RF,15,164(R1)                                                    
         SPACE                                                                  
ADDAGY46 MVC   168(2,R1),USIDNO     USE FOR UNKNOWN AGENCY (ZEROS)              
         LA    R0,10                                                            
         LA    RF,MEDBITAB                                                      
ADDAGY50 CLC   0(1,RF),SVMEDIA                                                  
         BE    ADDAGY54                                                         
         LA    RF,2(,RF)                                                        
         BCT   R0,ADDAGY50                                                      
         DC    H'0'                                                             
ADDAGY54 OC    150(1,R1),1(RF)     SET ON MEDIA BIT                             
         EJECT                                                                  
*        ADDMED - ADD TO MEDIA TABLE - 1 FOR INVOICE, SPOTS, $                  
*                                                                               
         BR    RE                  NOOP MEDIA TABLE                             
*                                                                               
         LA    R0,10                                                            
         L     R1,=A(EZMEDCTB)                                                  
ADDMED10 CLI   0(R1),0              EMPTY ENTRY                                 
         BE    ADDMED20                                                         
         SPACE                                                                  
         CLC   SVMEDIA(1),0(R1)                                                 
         BE    ADDMED24                                                         
         LA    R1,21(,R1)                                                       
         BCT   R0,ADDMED10                                                      
         DC    H'0'                                                             
         SPACE                                                                  
ADDMED20 MVC   0(1,R1),SVMEDIA                                                  
         SPACE                                                                  
ADDMED24 DS   0H                                                                
         CLI   EXCLSW,C'N'         IF EXCLSW NE N, NOT LOADED                   
         BNER  RE                   SKIP COUNTS                                 
         SPACE                                                                  
         ICM   RF,15,1(R1)                                                      
         LA    RF,1(,RF)                                                        
         STCM  RF,15,1(R1)                                                      
         ICM   RF,15,5(R1)                                                      
         A     RF,ISPTS                                                         
         STCM  RF,15,5(R1)                                                      
         SPACE                                                                  
         L     RF,IDOLN                                                         
         CVD   RF,DUB                                                           
         AP    9(6,R1),DUB                                                      
         SPACE                                                                  
         L     RF,IDOLG                                                         
         CVD   RF,DUB                                                           
         AP    15(6,R1),DUB                                                     
         SPACE                                                                  
         BR    RE                                                               
         SPACE                                                                  
MEDBITAB DC    X'D401D502D604E208E310E7204000'                                  
*                M   N   O   S   T   X                                          
         EJECT                                                                  
*        TRCRET- ROUTINE TO TRACE GETFLD RETURNS                                
*                                                                               
TRCRET   TM    RFCTL,RFCTLFER      FIELD ERROR                                  
         BNZ   TRCRETN                                                          
         CLI   TRACEFLD,C'Y'     TEST TRACING FIELDS                            
         BNER  RE                                                               
         CLI   EXCLSW,C'Y'       SKIP EXPRESSLY EXCLUDED BATCHES                
         BER   RE                                                               
*                                                                               
         DS    0H                                                               
TRCRETN  NTR1                                                                   
         MVC   P,SPACES                                                         
         TM    RFCTL,RFCTLFER       FIELD ERROR                                 
         BZ    TRCRETN1                                                         
         OC    RFERRMSG,RFERRMSG                                                
         BNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   P+7(L'RFERRMSG),RFERRMSG                                         
         GOTO1 =V(PRINTER)                                                      
         MVC   P,SPACES                                                         
TRCRETN1 MVC   P(6),=C'GETFLD'                                                  
         GOTO1 =V(HEXOUT),DMCB,RFCTL,P+7,1,=C'N'                                
         GOTO1 =V(HEXOUT),DMCB,RFCTL2,P+10,1,=C'N'                              
         EDIT  (B1,RFFLDNO),(3,P+13),FILL=0                                     
         EDIT  (B1,RFLEN),(3,P+17),FILL=0                                       
         MVC   P+21(100),RFDATA                                                 
         GOTO1 =V(PRINTER)                                                      
         MVC   P,SPACES                                                         
*                                                                               
         B     EXIT                                                             
         SPACE                                                                  
* FOUND TYPE CODE WITH LENGTH OTHER THAN 2 *                                    
         SPACE                                                                  
TYPLENER MVC   P(26),=C'REC CODE ERR-LEN=XXX, REC='                             
         ZIC   RF,RFLEN                                                         
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+17(3),DUB                                                      
         MVC   P+26(30),RFDATA                                                  
         GOTO1 =V(PRINTER)                                                      
         DC    H'0'                                                             
         EJECT                                                                  
*        CONSTANTS FOR SOME RECORD TYPES                                        
*                                                                               
TYPETABL DS    0CL2                                                             
TRTOTYP  DC    CL2'12'                                                          
AGYRTYP  DC    CL2'21'                                                          
STARTYP  DC    CL2'22'                                                          
PAYRTYP  DC    CL2'23'                                                          
SCTRTYP  DC    CL2'24'                                                          
SCBRTYP  DC    CL2'25'                                                          
INVRTYP  DC    CL2'31'                                                          
         DC    CL2'32'                                                          
         DC    CL2'33'                                                          
INTRTYP  DC    CL2'34'                                                          
         DC    CL2'41'                                                          
         DC    CL2'42'                                                          
SPTRTYP  DC    CL2'51'                                                          
         DC    CL2'52'                                                          
         DC    CL2'53'                                                          
SRCETYP  DC    CL2'99'             SOURCE - ONLY ON UNKNOWN AGENCY FILE         
TYPETLEN EQU   (*-TYPETABL)/2                                                   
         SPACE 2                                                                
UNKAGNCY DS    CL14'UNKNOWN AGENCY'                                             
         LTORG                                                                  
         SPACE                                                                  
         DROP  R9,RB,RC                                                         
         EJECT                                                                  
* INITIALIZE PROGRAM                                                            
         SPACE                                                                  
         DS    0H                                                               
INIT     NMOD1 0,**INIT**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         LA    RE,EZLDWKD          CLEAR WORK                                   
         LA    RF,EZLDWKL                                                       
         XCEF                                                                   
*                                                                               
         MVI   SPACES,C' '                                                      
         MVC   SPACES+1(L'SPACES-1),SPACES                                      
*                                                                               
         L     RF,=A(WKRBUFC)                                                   
         ST    RF,WKRBUF                                                        
         L     RF,=A(WKRRECC)                                                   
         ST    RF,WKRREC                                                        
*                                                                               
         MVC   TIMEP,=X'0100'      DEFAULT TIME                                 
         MVC   WKRFIL,=CL8'EASIWK'                                              
         MVC   WKRFIL,=CL8'WRKF  '                                              
         MVC   TITLE(36),=C'PZLOAD - INPUT TAPE TO WORKER FILES'                
         MVI   DASHES,C'-'                                                      
         MVC   DASHES+1(L'DASHES-1),DASHES                                      
         XC    COUNTS,COUNTS                                                    
*                                                                               
         ZAP   TOTDOLS,=P'0'                                                    
         ZAP   TDOLN,=P'0'                                                      
         ZAP   TDOLG,=P'0'                                                      
         ZAP   HODOLN,=P'0'                                                     
         ZAP   HODOLG,=P'0'                                                     
         ZAP   HIDOLN,=P'0'                                                     
         ZAP   HIDOLG,=P'0'                                                     
         ZAP   CDOLN,=P'0'                                                      
         ZAP   CDOLG,=P'0'                                                      
         ZAP   LDOLN,=P'0'                                                      
         ZAP   LDOLG,=P'0'                                                      
         ZAP   IBYTS,=P'0'                                                      
         ZAP   OBYTS,=P'0'                                                      
*                                                                               
         MVC   ID-8(8),=C'*WKINDX*'                                             
*                                                                               
         XC    INVFLDS,INVFLDS                                                  
         MVI   STMODE,C'+'         SET MODES AT INCLUDE                         
         MVI   IDMODE,C'+'                                                      
         MVI   RECFM,C'U'          DEFAULT TO UNDEFINED RECORD FORMAT           
*                                                                               
         SR    R0,R0               INITIALIZE ID TABLE BINSRCH PARS             
         L     R1,=A(IDTAB)                                                     
         SR    R2,R2                                                            
         LA    R3,8                                                             
         LA    R4,8                                                             
         LA    R5,IDTABMX                                                       
         STM   R0,R5,IDTPARS                                                    
*                                                                               
         SR    R0,R0               INITIALIZE STATION TAB BNSRCH PARS           
         L     R1,=A(STTAB)                                                     
         SR    R2,R2                                                            
         LA    R3,5                                                             
         LA    R4,5                                                             
         LA    R5,STTABMX                                                       
         STM   R0,R5,STTPARS                                                    
*                                                                               
         SPACE 3                                                                
*              READ PARAMETER CARDS                                             
         SPACE                                                                  
         MVC   P(13),=C'CONTROL CARDS'                                          
         GOTO1 =V(PRINTER)                                                      
         MVC   P(13),DASHES                                                     
         GOTO1 =V(PRINTER)                                                      
         SPACE 2                                                                
EZL10    DS    0H                                                               
         GOTO1 =V(CARDS),DMCB,CARD,=C'RE00'                                     
         CLC   =C'/*',CARD                                                      
         BE    EZL60                                                            
         MVC   P(80),CARD                                                       
         GOTO1 =V(PRINTER)                                                      
*                                                                               
         CLC   =C'TRACE=',CARD                                                  
         BNE   EZL14                                                            
         MVC   TRACES,CARD+6     RECORDS,FIELDS,WORKER RECS                     
         B     EZL10                                                            
*                                                                               
EZL14    DS    0H                                                               
         CLC   =C'DUMP=',CARD                                                   
         BNE   EZL16                                                            
         MVC   ABNDOPT,CARD+5                                                   
         B     EZL10                                                            
*                                                                               
EZL16    DS    0H                                                               
         CLC   =C'DMGR=',CARD                                                   
         BNE   EZL18                                                            
         MVC   DMGOPT,CARD+5                                                    
         B     EZL10                                                            
*                                                                               
EZL18    DS    0H                                                               
         CLC   =C'DDSIO=',CARD                                                  
         BNE   EZL20                                                            
         ICM   RF,15,VDDSIO                                                     
         BZ    EZL10                                                            
         MVC   0(8,RF),CARD+6                                                   
         B     EZL10                                                            
*                                                                               
EZL20    DS    0H                                                               
         CLC   =C'TEST=',CARD                                                   
         BNE   EZL24                                                            
         MVC   TEST,CARD+5                                                      
         B     EZL10                                                            
*                                                                               
EZL24    DS    0H                                                               
         CLC   =C'DATE=',CARD                                                   
         BNE   EZL26                                                            
         MVC   TODAY,CARD+5                                                     
         B     EZL10                                                            
*                                                                               
EZL26    DS    0H                                                               
         CLC   =C'TIME=',CARD                                                   
         BNE   EZL30                                                            
         PACK  WORK(3),CARD+5(5)  PWOS TIME                                     
         MVC   TIMEP,WORK                                                       
         B     EZL10                                                            
*                                                                               
EZL30    DS    0H                                                               
         CLC   =C'RERUN=',CARD                                                  
         BNE   EZL34                                                            
         MVC   RERUN,CARD+6                                                     
         B     EZL10                                                            
*                                                                               
EZL34    DS    0H                                                               
         CLC   =C'STXIT',CARD                                                   
         BNE   EZL36                                                            
         L     RF,=A(PZLOAD)                                                    
         ST    RF,WORK                                                          
         L     RF,=A(PZLOADX)                                                   
         LA    RF,24(,RF)          SHOW LEVEL=, DATE=                           
         ST    RF,WORK+4                                                        
         OI    WORK+4,X'80'        EOL                                          
         GOTO1 =V(STXITER),DMCB,WORK                                            
         B     EZL10                                                            
*                                                                               
EZL36    DS    0H                                                               
         CLC   =C'PUB=',CARD                                                    
         BNE   EZL44                                                            
         CLI   CARD+4,C'+'         MODE SETTERS                                 
         BE    EZL40                                                            
         CLI   CARD+4,C'-'                                                      
         BE    EZL40                                                            
*                                                                               
         MVC   WORK(5),CARD+8                                                   
         GOTO1 =V(BINSRCH),STTPARS,(1,WORK)                                     
         OC    1(3,R1),1(R1)       TEST ROOM                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
         B     EZL10                                                            
*                                                                               
EZL40    DS    0H                  MODE SETTERS                                 
         CLI   CARD+9,C' '         MUST NOT BE FOLLOWED BY STATION              
         BNE   EZL56                                                            
         MVC   STMODE,CARD+8                                                    
         B     EZL10                                                            
*                                                                               
EZL44    DS    0H                                                               
         CLC   =C'USERID=',CARD                                                 
         BNE   EZL50                                                            
         CLI   CARD+7,C'+'         MODE SETTERS                                 
         BE    EZL46                                                            
         CLI   CARD+7,C'-'                                                      
         BE    EZL46                                                            
*                                                                               
         MVC   WORK(8),CARD+7                                                   
         GOTO1 =V(BINSRCH),IDTPARS,(1,WORK)                                     
         OC    1(3,R1),1(R1)       TEST ROOM                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
         B     EZL10                                                            
*                                                                               
EZL46    DS    0H                  MODE SETTERS                                 
         CLI   CARD+8,C' '         MUST NOT BE FOLLOWED BY STATION              
         BNE   EZL56                                                            
         MVC   IDMODE,CARD+7                                                    
         B     EZL10                                                            
*                                                                               
EZL50    DS    0H                                                               
         CLC   =C'SOURCE=',CARD                                                 
         BNE   EZL54                                                            
         MVC   SOURCE,CARD+7                                                    
         B     EZL10                                                            
*                                                                               
EZL54    DS    0H                                                               
         CLC   =C'RECFM=',CARD                                                  
         BNE   EZL56                                                            
         MVC   RECFM,CARD+6                                                     
         CLI   RECFM,C'F'                                                       
         BE    EZL10                                                            
         CLI   RECFM,C'U'                                                       
         BE    EZL10                                                            
         CLI   RECFM,C'V'                                                       
         BE    EZL10                                                            
         MVC   P(15),=C'MUST BE F, U, V'                                        
         GOTO1 =V(PRINTER)                                                      
         B     BADINIT                                                          
*                                                                               
EZL56    DS    0H                                                               
         MVC   P(8),=C'BAD CARD'                                                
         GOTO1 =V(PRINTER)                                                      
         B     BADINIT                                                          
         SPACE 3                                                                
EZL60    DS    0H                                                               
         CLI   TODAY,0             TEST DATE GIVEN                              
         BNE   EZL64                                                            
         GOTO1 =V(DATCON),DMCB,(5,0),(0,TODAY)                                  
*                                                                               
EZL64    DS    0H                                                               
         GOTO1 =V(DATCON),DMCB,(0,TODAY),(2,TODAYC)                             
         SPACE                                                                  
         OC    SOURCE,SOURCE       WAS THERE A SOURCE CARD                      
         BZ    SRCERR                                                           
         SPACE                                                                  
         CLI   DMGOPT,C'N'                                                      
         BE    EZL70                                                            
         GOTO1 =V(DATAMGR),DMCB,=C'DMOPEN',=C'CONTROL',A(FILIST),WKRBUF         
EZL70    DS    0H                                                               
         L     R2,=A(EZINPUTF)     FIXED BLOCKED DCF                            
         CLI   RECFM,C'F'                                                       
         BE    EZL80                                                            
         L     R2,=A(EZINPUTU)     UNDEFINED DCF                                
         CLI   RECFM,C'U'                                                       
         BE    EZL80                                                            
         L     R2,=A(EZINPUTV)     VARIABLE DCF                                 
         CLI   RECFM,C'V'                                                       
         BE    EZL80                                                            
         DC    H'0'                                                             
*                                                                               
EZL80    DS    0H                                                               
         ST    R2,AEZINPT                                                       
         SPACE                                                                  
         OPEN  ((R2),(INPUT))                                                   
         SPACE                                                                  
         LTR   RF,RF               GOOD OPEN                                    
         BZ    EZL84                YES                                         
         SPACE                                                                  
         MVC   P(19),=C'EZINPUT OPEN FAILED'                                    
         GOTO1 =V(PRINTER)                                                      
         B     BADINIT                                                          
         SPACE                                                                  
EZL84    DS   0H                                                                
         XC    SVSRCE,SVSRCE       SET SVSRCE ZERO (USED AS FLAG)               
         CLI   TEST,C'Y'           IS THIS A TEST RUN                           
         BE    EZL90                YES, HOLD/WORK FILES                        
         SPACE                                                                  
         MVC   SVSRCE,SOURCE                                                    
         SPACE                                                                  
         OPEN  (EZHOLDR,(INPUT))                                                
         SPACE                                                                  
         LTR   RF,RF               GOOD OPEN                                    
         BZ    EZL86                YES                                         
         SPACE                                                                  
         MVC   P(19),=C'EZHOLDR OPEN FAILED'                                    
         GOTO1 =V(PRINTER)                                                      
         B     BADINIT                                                          
         SPACE                                                                  
EZL86    OPEN  (EZWORKW,(OUTPUT))                                               
         SPACE                                                                  
         LTR   RF,RF               GOOD OPEN                                    
         BZ    EZL90                YES                                         
         SPACE                                                                  
         MVC   P(19),=C'EZWORKW OPEN FAILED'                                    
         GOTO1 =V(PRINTER)                                                      
         B     BADINIT                                                          
         SPACE                                                                  
EZL90    CLI   TEST,C'Y'           IS THIS A TEST RUN                           
         BE    EZL96                YES, NO BILLING                             
         SPACE                                                                  
         OPEN  (EZBILLF,(OUTPUT))                                               
         SPACE                                                                  
         LTR   RF,RF               GOOD OPEN                                    
         BZ    EZL96                YES                                         
         SPACE                                                                  
         MVC   P(18),=C'EZBILL OPEN FAILED'                                     
         GOTO1 =V(PRINTER)                                                      
         B     BADINIT                                                          
         SPACE                                                                  
SRCERR   MVC   P(19),=C'NO SOURCE PARM CARD'                                    
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
BADINIT  CR    RB,RD               SET BAD COND CODE FOR INIT                   
         SPACE                                                                  
EZL96    XIT1                                                                   
VDDSIO   DC    V(DDSIO)                                                         
         LTORG                                                                  
         DROP  RB,RC                                                            
         EJECT                                                                  
*        GETFLD- RETURN A SINGLE FIELD                                          
*                                                                               
*        REGS - R2 = FIELD LENGTH                                               
*               R3 = CURRENT BYTE POINTER                                       
*               R4 = START OF FIELD                                             
*               R5 = WORK REG FOR TRAILING BLANKS                               
*               R6 = OUTPUT FIELD POINTER                                       
*                                                                               
         DS    0H                                                               
GETFLD   NMOD1 0,**GETF**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         SPACE                                                                  
         XC    RFDATA,RFDATA                                                    
         MVI   RFLEN,0                                                          
         XC    WLEN,WLEN                                                        
         XC    WDATA,WDATA                                                      
         SPACE                                                                  
         TM    RFCTL2,RFCTL2RD     TEST NEED READ NEXT REC                      
         BO    *+14                                                             
         SPACE                                                                  
         OC    RFCURPOS,RFCURPOS   TEST FIRST TIME                              
         BNZ   GETF10               NO                                          
*                                                                               
*  GET INPUT BLOCK OR RECORD FROM TAPE *                                        
*                                                                               
GETF00   DS    0H                                                               
         BAS   RE,GBL              YES- GET INPUT FILE BLOCK                    
*                                                                               
         L     R3,RFCURPOS         START WITH NEW BLOCK                         
*                                                                               
GETF10   DS    0H                                                               
         TM    RFCTL2,RFCTL2ER        TEST NEED TO SEND EOR                     
         BZ    GETF12                                                           
         NI    RFCTL2,X'FF'-RFCTL2ER  SET OFF END OF RECORD                     
         B     GETF36                  SET UP FOR EOR                           
*                                                                               
GETF12   DS    0H                                                               
         TM    RFCTL2,RFCTL2EF     TEST NEED TO SEND END OF FILE                
         BZ    GETF14                                                           
         NI    RFCTL2,X'FF'-RFCTL2EF-RFCTL2ER SET OFF EOF AND EOR               
         SPACE                                                                  
         OI    RFCTL,RFCTLEOF      SET END OF FILE                              
         B     GETFX               RETURN                                       
*                                                                               
GETF14   DS    0H                                                               
         TM    RFCTL,RFCTLEOF      END OF FILE SET                              
         BNZ   GETFX               RETURN                                       
*                                                                               
         TM    RFCTL,RFCTLEOR      AFTER EOR                                    
         BZ    GETF16                                                           
         MVI   RFFLDNO,0           RESET FIELD NUMBER                           
*                                                                               
GETF16   DS    0H                                                               
         L     R3,RFCURPOS                                                      
         ST    R3,RFFLDST          SAVE START OF FIELD                          
         SR    R2,R2               BYTE COUNTER                                 
         LA    R6,WDATA                                                         
         LR    R4,R6                                                            
         EJECT                                                                  
GETF20   DS    0H                                                               
         C     R3,EOR              TEST AT END OF PHYS BLOCK                    
         BL    GETF30               NO                                          
         SPACE                                                                  
*                                                                               
         OI    RFCTL2,RFCTL2RD     SET NEED TO READ NEXT REC                    
*                                                                               
         LTR   R2,R2               TEST HAVE FIELD TO HANDLE                    
         BZ    GETF24               NO, CK END OF RECORD                        
*                                                                               
         OI    RFCTL2,RFCTL2ER     SET DO EOR LATER                             
*                                                                               
         OI    RFCTL,X'10'         SET END OF FIELD                             
         B     GETF70              RETURN FIELD                                 
*                                                                               
GETF24   DS    0H                                                               
         TM    RFCTL,RFCTLEOR      TEST HAVE SENT EOR                           
         BZ    GETF36                                                           
         SPACE                                                                  
         TM    RFCTL2,RFCTL2EF     TEST NEED TO SEND END OF FILE                
         BZ    GETF26                                                           
         NI    RFCTL2,X'FF'-RFCTL2EF-RFCTL2ER SET OFF EOF AND EOR               
         OI    RFCTL,RFCTLEOF      SET END OF FILE                              
         B     GETFX               RETURN                                       
*                                                                               
GETF26   DS    0H                                                               
         TM    RFCTL,RFCTLEOF      END OF FILE SET                              
         BNZ   GETFX               RETURN                                       
         B     GETF00                                                           
*                                                                               
GETF30   CLC   RDELIM,0(R3)        TEST HAVE RECORD DELIM                       
         BNE   GETF40                                                           
*                                                                               
         LA    R3,L'RDELIM(,R3)    BUMP PAST RECORD DELIMITER                   
         ST    R3,RFCURPOS                                                      
*                                                                               
         CLI   RECFM,C'F'          FIXED BLOCKED RECS                           
         BNE   GETF32                                                           
         MVC   RFCURPOS,EOR        FORCE END OF RECORD                          
*                                                                               
GETF32   LTR   R2,R2               TEST HAVE FIELD TO HANDLE                    
         BZ    GETF34               NO                                          
*                                                                               
         OI    RFCTL2,RFCTL2ER     SET TO DO EOR LATER                          
         B     GETF70              RETURN FIELD                                 
*                                                                               
GETF34   DS    0H                  NO FIELD TO HANDLE                           
         CLI   RFFLDNO,0           HAVE THERE BEEN ANY FLDS                     
         BE    GETF20              NO- IGNORE                                   
*                                                                               
GETF36   DS    0H                                                               
         OI    RFCTL,RFCTLEOR      SEND EOR                                     
         L     RF,WRCURPOS                                                      
         MVC   0(L'RDELIM,RF),RDELIM                                            
         LA    RF,L'RDELIM(,RF)                                                 
         ST    RF,WRCURPOS                                                      
         B     GETFX                                                            
*                                                                               
GETF40   DS    0H                                                               
         CLC   FDELIM,0(R3)        TEST HAVE FIELD DELIM                        
         BE    GETF60                                                           
*                                  NO DELIMITER, CONTINUE                       
         LTR   R2,R2               IF HAVE NO DATA YET                          
         BP    GETF50                                                           
         SPACE                                                                  
* DO NOT STRIP BLANKS FROM DAY OF WEEK FIELD OF SCHEDULE LINE *                 
         SPACE                                                                  
         CLI   RFFLDNO,2           TEST FIELD 3 (BUT STILL SET AS 2)            
         BNE   GETF44                                                           
         CLC   RECTYP,SCHDTYP      TEST SCHEDULE LINE RECORD                    
         BE    GETF50               LEAVE BLANKS THERE                          
         SPACE                                                                  
GETF44   CLI   0(R3),C' '          IGNORE LEADING BLANKS                        
         BNH   GETF54                                                           
*                                                                               
GETF50   DS    0H                                                               
         MVC   0(1,R6),0(R3)                                                    
         LA    R2,1(,R2)           BUMP FIELD LENGTH                            
         LA    R6,1(,R6)           BUMP OUTPUT POINTER                          
         AP    OBYTS,=P'1'         ADD TO OUTPUT BYTES                          
GETF54   DS    0H                                                               
         LA    R3,1(,R3)           NEXT POS                                     
         AP    IBYTS,=P'1'         ADD TO INPUT BYTES                           
         B     GETF20                                                           
SCHDTYP  DC    CL2'41'                                                          
*                                                                               
GETF60   DS    0H                                                               
         LA    R3,L'FDELIM(,R3)    BUMP PAST FIELD DELIM                        
         ST    R3,RFCURPOS         SET NEW POS                                  
*                                                                               
GETF70   DS    0H                                                               
         LTR   R2,R2                                                            
         BNP   GETF80                                                           
         SPACE                                                                  
* DO NOT STRIP BLANKS FROM DAY OF WEEK FIELD OF SCHEDULE LINE *                 
         SPACE                                                                  
         CLI   RFFLDNO,2           TEST FIELD 3 (BUT STILL SET AS 2)            
         BNE   GETF72                                                           
         CLC   RECTYP,=C'41'       TEST SCHEDULE LINE RECORD                    
         BE    GETF76               LEAVE BLANKS THERE                          
         SPACE                                                                  
*                                  STRIP TRAILING BLANKS                        
GETF72   DS    0H                                                               
         LA    R5,0(R2,R4)                                                      
         BCTR  R5,0                R5 AT LAST BYTE                              
*                                                                               
GETF74   DS    0H                                                               
         CLI   0(R5),C' '                                                       
         BH    GETF76                                                           
         BCTR  R2,0                DECR LENGTH                                  
         BCT   R5,GETF74           PREVIOUS BYTE                                
*                                                                               
GETF76   DS    0H                                                               
         CH    R2,=H'255'                                                       
         BNH   GETF80                                                           
         OI    RFCTL,RFCTLFER      SET FIELD ERROR                              
         MVC   RFERRMSG,=CL20'ERR FLD LEN = XXXX'                               
         CVD   R2,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  RFERRMSG+14(4),DUB                                               
         L     R1,TMAXERRS                                                      
         LA    R1,1(,R1)                                                        
         ST    R1,TMAXERRS                                                      
         LA    R2,255                                                           
*                                                                               
GETF80   DS    0H                                                               
         NI    RFCTL,X'3F'         CLEAR END CONTROLS                           
         ZIC   RF,RFFLDNO          BUMP FIELD NUMBER                            
         LA    RF,1(RF)                                                         
         STC   RF,RFFLDNO                                                       
         STC   R2,RFLEN            SET FIELD LENGTH                             
*                                                                               
         LTR   R2,R2                                                            
         BNP   GETF84                                                           
         LR    RF,R2                                                            
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   RFDATA(0),0(R4)                                                  
*                                                                               
GETF84   DS    0H                                                               
         LTR   R2,R2                                                            
         BP    *+6                                                              
         SR    R2,R2                                                            
         LA    R6,WDATA(R2)                                                     
         MVC   0(L'FDELIM,R6),FDELIM                                            
         LA    R2,L'FDELIM(,R2)      ADD LENGTH                                 
         STH   R2,WLEN               SET WORK FIELD LENGTH                      
*                                                                               
* NOW BUILD RECORD ITSELF                                                       
*                                                                               
         LH    RE,WLEN                                                          
         BCTR  RE,0                                                             
         L     RF,WRCURPOS                                                      
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,RF),WDATA                                                    
         LA    RE,1(RE,RF)                                                      
         ST    RE,WRCURPOS                                                      
*                                                                               
GETFX    DS    0H                                                               
         XIT1                                                                   
         EJECT                                                                  
* GET BLOCK FROM TAPE *                                                         
*                                                                               
         DS    0H                                                               
GBL      NTR1                                                                   
         SPACE                                                                  
         NI    RFCTL2,X'FF'-RFCTL2RD  SET OFF NEED READ NEXT REC                
         SPACE                                                                  
         L     R2,AEZINPT                                                       
         SPACE                                                                  
         OC    SVSRCE,SVSRCE       MUST BE WORKING ON HOLD FILE                 
         BZ    *+8                  NO                                          
         L     R2,=A(EZHOLDR)                                                   
         SPACE                                                                  
         L     R6,=A(EZINREC)                                                   
         XC    0(256,R6),0(R6)                                                  
*                                                                               
         GET   (R2),(R6)                                                        
         SPACE                                                                  
         OI    RFCTL,RFCTLREC      SET RECORD READ                              
         SPACE                                                                  
         OC    SVSRCE,SVSRCE       MUST BE WORKING ON HOLD FILE                 
         BZ    GBL04                NO                                          
         SPACE                                                                  
         MVI   HOLDSW,C'H'         H=HOLD FILE FOR BATCH TOTALS                 
         SPACE                                                                  
         CLC   =X'F9F95E',4(R6)    DO NOT COUNT SOURCE/DATE RECS                
         BE    GBL06                                                            
         CLC   =X'F1F25E',4(R6)    DO NOT COUNT FILE TOTALS RECS                
         BE    GBL06                                                            
         L     RF,HDRDCT                                                        
         LA    RF,1(,RF)                                                        
         ST    RF,HDRDCT                                                        
         B     GBL06                                                            
         SPACE                                                                  
GBL04    CLC   =X'F1F25E',4(R6)    DO NOT COUNT FILE TOTALS RECS                
         BE    GBL06                                                            
         L     RF,EZRDCT                                                        
         LA    RF,1(,RF)                                                        
         ST    RF,EZRDCT                                                        
*                                                                               
* CHECK IF FIXED (BLOCKED) UNDEFINED OR VARIABLE BLOCK FORMAT *                 
*                                                                               
GBL06    LR    RF,R6               SET STARTING POS                             
         SPACE                                                                  
         OC    SVSRCE,SVSRCE       WORKING ON HOLD FILE                         
         BZ    GBL10                TREAT AS VAR BLK (IT IS, TOO)               
         LA    RF,4(,RF)           SKIP PAST LENGTH                             
         ST    RF,RFCURPOS                                                      
         B     GBL16                                                            
         SPACE                                                                  
GBL10    CLI   RECFM,C'V'          IF VARIABLE FMT                              
         BNE   *+8                                                              
         LA    RF,4(,RF)           SKIP PAST LENGTH                             
         ST    RF,RFCURPOS                                                      
*                                                                               
         LH    RE,DCBLRECL-IHADCB(,R2)  REC LEN-FIXED/UNDEFINED FMT             
         CLI   RECFM,C'U'                                                       
         BE    GBL20                                                            
         LH    RE,82(,R2)          LENGTH OF RECORD IF FIXED BLOCKED            
         SPACE                                                                  
         CLI   RECFM,C'F'                                                       
         BE    GBL20                                                            
         CLI   RECFM,C'V'                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
GBL16    LH    RE,0(,R6)           LENGTH IF VARIABLE FMT                       
         SH    RE,=H'4'                                                         
         SPACE                                                                  
GBL20    DS    0H                                                               
         AR    RF,RE                                                            
         ST    RF,EOR              SET EOR                                      
         BAS   RE,TRCREAD          TRACE WORKER FILE RECORD                     
*                                                                               
* FIX SET END OF RECORD AND END OF FILE                                         
*                                                                               
         B     GETFX                                                            
         EJECT                                                                  
* END OF FILE ROUTINE FOR LOAD TAPE *                                           
         SPACE                                                                  
GETEOF   DS    0H                  END OF FILE                                  
         SPACE                                                                  
         TM    RFCTL,RFCTLREC      WAS A RECORD READ                            
         BZ    GETEOF20             NO                                          
         SPACE                                                                  
         TM    RFCTL,RFCTLEOR       TEST HAVE SENT EOR                          
         BNZ   GETEOF30                                                         
         SPACE                                                                  
         TM    RFCTL2,RFCTL2ER      IS SEND EOR NEXT SET                        
         BO    GETEOF10                                                         
*                                                                               
* TEST HERE FOR FOUND DELIMITER                                                 
*                                                                               
*                                                                               
* FIX SET END OF RECORD AND END OF FILE                                         
*                                                                               
         OI    RFCTL,RFCTLFER       SET FIELD ERROR                             
         MVC   RFERRMSG,=CL20'ERR NO REC DELIMITER'                             
         TM    RFCTL,RFCTLEFL       END OF FIELD SET                            
         BZ    *+10                                                             
         MVC   RFERRMSG,=CL20'ERR NO FLD/REC DELIM'                             
         L     R1,TMAXERRS                                                      
         LA    R1,1(,R1)                                                        
         ST    R1,TMAXERRS                                                      
*                                                                               
         OI    RFCTL,RFCTLEOR       SET EOR NOW                                 
         OI    RFCTL2,RFCTL2EF      AND DO EOFILE AFTER                         
         B     GETFX                                                            
*                                                                               
GETEOF10 OI    RFCTL,RFCTLEOR         SET EOR NOW                               
         NI    RFCTL2,X'FF'-RFCTL2ER  SET OFF EOR LATER                         
         OI    RFCTL2,RFCTL2EF        AND DO EOFILE AFTER                       
         B     GETFX                                                            
         SPACE                                                                  
GETEOF20 DS    0H                                                               
         OI    RFCTL2,RFCTL2RD        SET ON NEED READ NEXT REC                 
         SPACE                                                                  
GETEOF30 DS    0H                                                               
         OI    RFCTL,RFCTLEOF      SET EOFILE                                   
         B     GETFX                                                            
         EJECT                                                                  
*        TRCREAD- ROUTINE TO TRACE INPUT FILE READS                             
*                                                                               
TRCREAD  CLI   TRACEREC,C'Y'       TEST TRACING FIELDS                          
         BNER  RE                                                               
*                                                                               
         DS    0H                                                               
TRCREADN NTR1                                                                   
         MVC   P,SPACES                                                         
         GOTO1 =V(PRINTER)                                                      
         L     R6,=A(EZINREC)                                                   
         SPACE                                                                  
         OC    SVSRCE,SVSRCE       READING HOLD FILE                            
         BNZ   TRD3                 YES                                         
         SPACE                                                                  
         L     R2,AEZINPT                                                       
         LH    R2,82(R2)           LENGTH IF UNDEFINED                          
         CLI   RECFM,C'U'                                                       
         BE    TRD5                                                             
TRD3     LH    R2,0(R6)            LENGTH IF VARIABLE FMT                       
*                                                                               
TRD5     DS    0H                                                               
         MVC   P(5),=C'INPUT'                                                   
         EDIT  (R2),(4,P+6),FILL=0                                              
         LA    R3,0(R6,R2)         EOR                                          
*                                                                               
TRD6     LR    R4,R3                                                            
         SR    R4,R6                                                            
         BNP   TRD8                                                             
         CH    R4,=H'100'                                                       
         BNH   *+8                                                              
         LA    R4,100                                                           
*                                                                               
         BCTR  R4,R0                                                            
         EX    R4,*+8                                                           
         B     *+10                                                             
         MVC   P+11(0),0(R6)                                                    
         LA    R4,1(R4)                                                         
         GOTO1 =V(PRINTER)                                                      
         MVC   P,SPACES                                                         
         LA    R6,0(R6,R4)                                                      
         B     TRD6                                                             
*                                                                               
TRD8     DS    0H                                                               
         GOTO1 =V(PRINTER)                                                      
         MVC   P,SPACES                                                         
         XIT1                                                                   
         DROP  RB,RC                                                            
         EJECT                                                                  
*        ENDBTCH - END OF BATCH ROUTINE                                         
*                                                                               
         DS    0H                                                               
ENDBTCH  NMOD1 0,**ENDB**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         SPACE                                                                  
         OC    BINVS,BINVS         IF NO INVOICES, NO NEED                      
         BZ    ENDB10              TO FINISH UP BATCH                           
*                                                                               
* ROLL INVOICE COUNTS AND DOLLARS FOR POSSIBLE TOT REC CHECK                    
         SPACE                                                                  
         L     RF,BDOLG            BATCH SPOT DOLLARS (GROSS)                   
         CVD   RF,DUB                                                           
         AP    CDOLG,DUB                                                        
         L     RF,BDOLN            BATCH SPOT DOLLARS (GROSS)                   
         CVD   RF,DUB                                                           
         AP    CDOLN,DUB                                                        
         L     RF,BINVS            AND INVOICE COUNT FOR TOTAL CK               
         A     RF,CINVS                                                         
         ST    RF,CINVS                                                         
         SPACE                                                                  
         OC    ID,ID                                                            
         BZ    ENDB24                                                           
         CLI   EXCLSW,C'Y'         SKIP EXPRESSLY EXCLUDED BATCHES              
         BE    ENDB10                                                           
*                                                                               
         GOTO1 =V(PRINTER)                                                      
         MVC   P(17),=C'INVOICES IN BATCH'                                      
         SPACE                                                                  
         EDIT  (B4,BINVS),(5,P+24),ZERO=NOBLANK                                 
         GOTO1 =V(PRINTER)                                                      
         MVC   P(5),=C'SPOTS'                                                   
         SPACE                                                                  
         EDIT  (B4,BSPTS),(5,P+24),ZERO=NOBLANK                                 
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P(7),=C'DOLLARS'                                                 
         SPACE                                                                  
         EDIT  (B4,BDOLN),(14,P+16),2,COMMAS=YES,ZERO=NOBLANK,MINUS=YES         
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
*                                                                               
ENDB10   DS   0H                                                                
         CLI   TEST,C'Y'           IF TEST RUN                                  
         BE    ENDB20               SKIP CLOSE AND COUNTS                       
         CLI   EXCLSW,C'N'         IF EXCLSW NE N, NOT LOADED                   
         BNE   ENDB16               SKIP CLOSE AND COUNTS                       
*                                                                               
         L     RF,LBTCHS           BUMP LOADED BATCH TOTAL                      
         LA    RF,1(RF)                                                         
         ST    RF,LBTCHS                                                        
*                                                                               
         L     RF,BINVS            ROLL UP LOADED INV COUNT                     
         A     RF,LINVS                                                         
         ST    RF,LINVS                                                         
         L     RF,BSPTS            AND LOADED SPOT COUNT                        
         A     RF,LSPTS                                                         
         ST    RF,LSPTS                                                         
         L     RF,BDOLN            AND LOADED SPOT DOLLARS                      
         CVD   RF,DUB                                                           
         AP    LDOLN,DUB                                                        
         L     RF,BDOLG            AND LOADED SPOT DOLLARS                      
         CVD   RF,DUB                                                           
         AP    LDOLG,DUB                                                        
*                                                                               
         GOTO1 =V(DATAMGR),DMCB,=C'CLOSE',WKRFIL,0,WKRREC,WKRBUF                
         SPACE                                                                  
         B     ENDB20                                                           
*                                                                               
ENDB16   DS   0H                   ADD TO HELD TOTALS                           
         L     RF,HOBAT                                                         
         LA    RF,1(RF)                                                         
         ST    RF,HOBAT                                                         
         L     RF,BINVS                                                         
         A     RF,HOINVS                                                        
         ST    RF,HOINVS                                                        
         L     RF,BSPTS                                                         
         A     RF,HOSPTS                                                        
         ST    RF,HOSPTS                                                        
         L     RF,BDOLN                                                         
         CVD   RF,DUB                                                           
         AP    HODOLN,DUB                                                       
         L     RF,BDOLG                                                         
         CVD   RF,DUB                                                           
         AP    HODOLG,DUB                                                       
         SPACE                                                                  
ENDB20   DS   0H                                                                
         CLI   HOLDSW,C'H'         H=HOLD FILE FOR BATCH TOTALS                 
         BNE   ENDB22               NO                                          
         SPACE                                                                  
         MVI   HOLDSW,0            RESET                                        
         L     RF,BINVS            ROLL UP TO HOLD INPUT TOTALS                 
         A     RF,HIINVS                                                        
         ST    RF,HIINVS                                                        
         L     RF,BSPTS                                                         
         A     RF,HISPTS                                                        
         ST    RF,HISPTS                                                        
         L     RF,BDOLN                                                         
         CVD   RF,DUB                                                           
         AP    HIDOLN,DUB                                                       
         L     RF,BDOLG                                                         
         CVD   RF,DUB                                                           
         AP    HIDOLG,DUB                                                       
         SPACE                                                                  
         L     RF,HIBAT            BUMP HOLD INPUT BATCH COUNT                  
         LA    RF,1(RF)                                                         
         ST    RF,HIBAT                                                         
         B     ENDB23                                                           
         SPACE                                                                  
ENDB22   L     RF,BINVS            ROLL UP INVOICE COUNT                        
         A     RF,TINVS                                                         
         ST    RF,TINVS                                                         
         L     RF,BSPTS            ROLL UP SPOT COUNT                           
         A     RF,TSPTS                                                         
         ST    RF,TSPTS                                                         
         L     RF,BDOLN            ROLL UP SPOT DOLLARS                         
         CVD   RF,DUB                                                           
         AP    TDOLN,DUB                                                        
         L     RF,BDOLG            ROLL UP SPOT DOLLARS                         
         CVD   RF,DUB                                                           
         AP    TDOLG,DUB                                                        
*                                                                               
         L     RF,TBTCHS           BUMP TOTAL BATCH COUNT                       
         LA    RF,1(RF)                                                         
         ST    RF,TBTCHS                                                        
         SPACE                                                                  
ENDB23   XC    BINVS,BINVS                                                      
         XC    BSPTS,BSPTS                                                      
         XC    BDOLN,BDOLN                                                      
         XC    BDOLG,BDOLG                                                      
*                                                                               
ENDB24   MVC   OLDSTA,STAFLDS                                                   
         MVC   OLDSTAD,STAFLDSA                                                 
         MVC   OLDAGY,AGYFLDS                                                   
         SPACE 2                                                                
* SEE IF THERE WAS A TOTAL RECORD                                               
         SPACE                                                                  
         OC    TOTINVS,TOTINVS     ANY TRANS TOTALS                             
         BNZ   ENDB200              NO                                          
         CP    TOTDOLS,=P'0'       ANY TRANS TOT REC                            
         BE    ENDB400              NO                                          
         SPACE                                                                  
ENDB200  LA    R2,TOTFILES                                                      
         LA    R0,L'TOTFILES                                                    
ENDB204  CLI   0(R2),0                                                          
         BE    ENDB206                                                          
         LA    R2,1(,R2)                                                        
         BCT   R0,ENDB204                                                       
         DC    H'0'                MAKE TOTFILES LARGER AREA (NOW 512)          
ENDB206  OI    0(R2),X'80'                                                      
*                                                                               
         OC    TOTINVS,TOTINVS     ANY TRANS TOTALS                             
         BZ    ENDB210              NO                                          
         CLC   CINVS,TOTINVS       WE FIND ALL THE INVOICES                     
         BNE   ENDB300              YES                                         
*                                                                               
ENDB210  CP    TOTDOLS,=P'0'       ANY TRANS TOT REC                            
         BE    ENDB360              NO                                          
*                                                                               
         CP    CDOLG,TOTDOLS       WE FIND ALL THE DOLLARS                      
         BE    ENDB360              YES                                         
*                                                                               
ENDB300  DS    0H                                                               
         OI    0(R2),X'08'          SET BAD FLAG                                
         MVI   P+1,C'*'                                                         
         MVC   P+2(99),P+1                                                      
         GOTO1 =V(PRINTER)                                                      
*                                                                               
         L     R2,CINVS                                                         
         LA    R3,P+1                                                           
         BAS   RE,EDIT0B                                                        
         SPACE                                                                  
         MVC   P+8(13),=C'INVOICES READ'                                        
         SPACE                                                                  
         LA    R2,CDOLG                                                         
         LA    R3,P+40                                                          
         BAS   RE,EDIT2AB                                                       
         SPACE                                                                  
         MVC   P+55(12),=C'DOLLARS READ'                                        
         GOTO1 =V(PRINTER)                                                      
         L     R2,TOTINVS                                                       
         LA    R3,P+1                                                           
         BAS   RE,EDIT0B                                                        
         SPACE                                                                  
         MVC   P+8(20),=C'STATED INVOICES SENT'                                 
         SPACE                                                                  
         LA    R2,TOTDOLS                                                       
         LA    R3,P+40                                                          
         BAS   RE,EDIT2AB                                                       
         SPACE                                                                  
         MVC   P+55(19),=C'STATED DOLLARS SENT'                                 
         GOTO1 =V(PRINTER)                                                      
         MVI   P+1,C'*'                                                         
         MVC   P+2(99),P+1                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
ENDB360  XC    CINVS,CINVS                                                      
         ZAP   CDOLN,=P'0'                                                      
         ZAP   CDOLG,=P'0'                                                      
         XC    TOTINVS,TOTINVS     CLEAR BOTH TOTAL INVOICES & DOLLARS          
         ZAP   TOTDOLS,=P'0'                                                    
*                                                                               
ENDB400  DS    0H                                                               
         XIT1                                                                   
         SPACE                                                                  
         DS    0H                                                               
EDIT0B   NTR1                                                                   
         EDIT  ((R2)),(5,(R3)),ZERO=NOBLANK                                     
EDITXB   XIT1                                                                   
         SPACE                                                                  
         DS    0H                                                               
EDIT2AB  NTR1                                                                   
         EDIT  (P8,0(R2)),(14,(R3)),2,COMMAS=YES,ZERO=NOBLANK,MINUS=YES         
         B     EDITXB                                                           
         DROP  RB,RC                                                            
         LTORG                                                                  
         EJECT                                                                  
*              GET AGENCY ID                                                    
         SPACE 2                                                                
         DS    0H                                                               
GETUID   NMOD1 0,**GETU**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         CLI   DMGOPT,C'N'         FOR TESTING                                  
         BNE   GU4                                                              
GU3      DS    0H                                                               
         MVC   USIDNO,=X'0011'       SJR                                        
         MVC   USID,=CL8'SJR'                                                   
         MVC   USCODE,=CL2'SJ'                                                  
         MVI   EXCLSW,C'N'                                                      
         B     GETUIDX                                                          
*                                                                               
GU4      XC    USIDNO,USIDNO                                                    
         MVC   USID,=CL8'*UNKNOWN'                                              
         MVI   EXCLSW,C'*'         SET TO EXCLUDE BECAUSE NOT FOUND             
*                                                                               
         L     RF,=V(AIDTAB)       AGENCY ID TABLE                              
         USING AIDTABD,RF                                                       
*                                                                               
GU5      DS    0H                                                               
         CLI   0(RF),X'FF'         EOT                                          
         BE    GU30                NOT FOUND                                    
         CLC   ADTSRC,AGYCODE                                                   
         BE    GU5D                                                             
*                                                                               
         LA    RF,AIDTABL(RF)                                                   
         B     GU5                                                              
*                                                                               
GU5D     DS    0H                                                               
         MVC   USID,ADTDDS         DDS AGENCY ID                                
         MVC   USIDNO,ADTUID       USER ID NUMBER                               
         MVC   USCODE,ADTCODE      2-BYTE AGENCY                                
*                                                                               
*                                  NOW CHECK FOR INCLUSION/EXCLUSION            
*                                                                               
GU20     DS    0H                                                               
         OC    USIDNO,USIDNO       TEST ID FOUND                                
         BZ    GU30                                                             
         MVI   EXCLSW,C'N'                                                      
         OC    IDTPARS+8(4),IDTPARS+8  TEST HAVE ANY ID LIST                    
         BZ    GETUIDX                  NO, OK                                  
*                                                                               
         MVC   WORK(8),USID        SEE IF THIS ONE IN LIST                      
         GOTO1 =V(BINSRCH),IDTPARS,WORK                                         
         CLI   0(R1),0                                                          
         BNE   GU22                                                             
*                                  ID IS IN LIST                                
         CLI   IDMODE,C'+'       TEST TO INCLUDE ONLY THOSE IN LIST             
         BE    *+8                                                              
         MVI   EXCLSW,C'Y'                                                      
         B     GETUIDX                                                          
*                                                                               
GU22     DS    0H                  ID NOT IN LIST                               
         CLI   IDMODE,C'+'         TEST TO INCLUDE ONLY THOSE IN LIST           
         BNE   *+8                                                              
         MVI   EXCLSW,C'Y'                                                      
         B     GETUIDX                                                          
*                                                                               
GU30     DS    0H                                                               
         L     R1,TUNKBAT          ADD TO UNKNOWN BATCH TOTAL                   
         LA    R1,1(,R1)                                                        
         ST    R1,TUNKBAT                                                       
*                                                                               
GETUIDX  DS    0H                                                               
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
*        NEWIND - BUILD NEW WORKER INDEX AND PRINT HEADLINES                    
         SPACE 2                                                                
         DS    0H                                                               
NEWIND   NMOD1 0,**NEWI**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         MVI   SVRECSW,X'FF'       SET NEED TO PUT ALL SAVES                    
         XC    ID,ID                                                            
         LA    R4,ID                                                            
         USING EZWKRIXD,R4                                                      
*                                                                               
         MVC   EZWISTN,STATION     CALL LETTERS                                 
         MVI   EZWIDAY,X'98'       DAY = 98 (IDENTIFIES AS PZ)                  
         MVC   EZWIMED,STAMEDIA                                                 
*                                                                               
NI10     DS    0H                      TEST FOR STATION INCL/EXCL               
         MVC   BILSTA(4),EZWISTN                                                
         SPACE                                                                  
         MVI   EXCLSW,C'N'                                                      
         OC    STTPARS+8(4),STTPARS+8  TEST HAVE ANY STATION LIST               
         BZ    NI24                NO, OK                                       
         MVC   WORK(4),EZWISTN     SEE IF THIS ONE IN LIST                      
         OI    WORK+3,X'40'                                                     
         MVI   WORK+4,C' '         WAS MEDIA                                    
         GOTO1 =V(BINSRCH),STTPARS,WORK                                         
         CLI   0(R1),0                                                          
         BNE   NI20                                                             
*                                  STATION IS IN LIST                           
         CLI   STMODE,C'+'       TEST TO INCLUDE ONLY THOSE IN LIST             
         BE    NI24                                                             
         MVI   EXCLSW,C'Y'                                                      
         B     NIX                                                              
*                                                                               
NI20     DS    0H                  STATION NOT IN LIST                          
         CLI   STMODE,C'+'         TEST TO INCLUDE ONLY THOSE IN LIST           
         BNE   NI24                                                             
         MVI   EXCLSW,C'Y'                                                      
         B     NIX                                                              
*                                                                               
NI24     DS    0H                                                               
         SPACE                                                                  
         MVC   LINE,=PL2'200'      FORCE NEW PAGE                               
         MVC   P(6),=C'SOURCE'                                                  
         MVC   P+10(4),SOURCE                                                   
         SPACE                                                                  
         OC    HOLDDATE,HOLDDATE   IS THIS AN OLD BATCH                         
         BZ    NI30                 NO                                          
         MVC   P+20(9),=C'PZLOAD OF'                                            
         GOTO1 =V(DATCON),DMCB,(0,HOLDDATE),(5,P+30)                            
NI30     DS    0H                                                               
         CLI   TEST,C'Y'                                                        
         BNE   NI34                                                             
         MVC   P+47(10),=C'(TEST RUN)'                                          
NI34     DS    0H                                                               
         SPACE                                                                  
         GOTO1 =A(GETUID),DMCB,(RC)                                             
         CLI   EXCLSW,C'N'         EXCLUDE SWITCH                               
         BNE   NI50                DON'T OPEN                                   
         BAS   RE,CHKPUB                                                        
         CLI   EXCLSW,C'N'         EXCLUDE SWITCH                               
         BNE   NI50                DON'T OPEN                                   
         CLI   TEST,C'Y'                                                        
         BE    NI50                                                             
         SPACE                                                                  
         MVC   ID(2),USIDNO                                                     
         MVC   SVID,ID                                                          
         SPACE                                                                  
         GOTO1 =V(DATAMGR),DMCB,(0,=C'GFILE'),=C'WRKFIL',ID,WKRREC,    C        
               WKRBUF                                                           
         SPACE                                                                  
         USING UKRECD,R4                                                        
         MVC   WKRFIL,UKUSRINF                                                  
         DROP  R4                                                               
         SPACE                                                                  
         MVC   ID,SVID                                                          
         SPACE                                                                  
         L     R5,WKRREC                                                        
         MVC   0(L'ID,R5),ID                                                    
         XC    0(WLSOFEND-WLHDRD,R5),0(R5)                                      
         USING WLHDRD,R5                                                        
         SPACE                                                                  
         MVC   WLINDEX,SVID                                                     
         SPACE                                                                  
         MVC   WLAGELD,TODAYC                                                   
         MVC   WLAGEDD,=X'FFFF'                                                 
         MVC   WLAGELT,=X'FFFF'                                                 
         MVC   WLRETNL,=X'FFFF'                                                 
         MVC   WLRETND,=X'FFFF'                                                 
*                                                                               
         LA    R5,WLDESC           COMMENT AREA                                 
         USING EZWKRCMD,R5                                                      
*                                  NO COMMENT DATA AT THIS POINT                
         XC    EZWCMNT,EZWCMNT                                                  
         MVC   EZWCSRCE,SOURCE                                                  
         SPACE                                                                  
         GOTO1 =V(DATAMGR),DMCB,=C'OPEN',WKRFIL,0,WKRREC,WKRBUF                 
         SPACE                                                                  
         CLI   DMCB+8,0            ANY ERROR                                    
         BE    NI40                 NO                                          
         MVI   EXCLSW,C'*'         SET TO EXCLUDE WORKER FILE FULL              
         SPACE                                                                  
         TM    8(R1),X'80'         WORKER FILE FULL                             
         BZ    NI36                                                             
         SPACE                                                                  
         MVC   P+40(38),=C'* WORKER FILE FULL, BATCH NOT LOADED *'              
         SPACE                                                                  
         L     RF,TFULBAT                                                       
         LA    RF,1(,RF)                                                        
         ST    RF,TFULBAT                                                       
         B     NI50                                                             
         SPACE                                                                  
NI36     TM    8(R1),X'41'         FORMAT ERROR                                 
         BNO   NI38                                                             
         SPACE                                                                  
         DC    H'0'                BAD, BAD ERROR                               
         SPACE                                                                  
NI38     TM    8(R1),X'40'         DISK ERROR                                   
         BO    *+6                                                              
         DC    H'0'                DO NOT KNOW WHAT IS UP, DIE                  
         SPACE                                                                  
         MVC   P+40(37),=C'* WORKER FILE ERR, BATCH NOT LOADED *'               
         SPACE                                                                  
         B     NI50                                                             
         SPACE                                                                  
NI40     L     R1,WKRBUF                                                        
         SPACE                                                                  
         LA    R5,W_DESC-W_RECD(,R1)                                            
         USING EZWKRCMD,R5                                                      
*                                  FIX SPACED OUT AREA                          
         XC    EZWCMNT,EZWCMNT                                                  
         MVC   EZWCSRCE,SOURCE                                                  
         DROP  R5                                                               
         SPACE                                                                  
         MVC   ID,0(R1)                                                         
         SR    R0,R0                                                            
         ICM   R0,3,ID+W_FILENO-W_RECD                                          
         BNZ   *+6                                                              
         DC    H'0'                                                             
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         MVC   P+20(8),=C'WKR SEQ='                                             
         UNPK  P+28(4),DUB                                                      
         SPACE                                                                  
NI50     DS    0H                                                               
         GOTO1 =V(PRINTER)                                                      
         MVC   P(3),=C'PUB'                                                     
         MVC   P+10(4),STATION                                                  
         MVC   P+16(30),STANAME                                                 
         CLI   STASTAT,C'U'        PUB 'UNKNOWN'                                
         BNE   NI52                                                             
         LA    RF,P+45                                                          
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         MVC   2(11,RF),=C'**UNKNOWN**'                                         
*                                                                               
NI52     DS    0H                                                               
         USING EZWKRIXD,R4                                                      
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P(7),=C'USER ID'                                                 
         MVC   P+10(8),USID                                                     
         MVI   P+19,C'('                                                        
         MVI   P+24,C')'                                                        
         EDIT  (B2,USIDNO),(4,P+20),FILL=0                                      
         GOTO1 =V(PRINTER)                                                      
         MVC   P(7),=C'AGENCY '                                                 
         MVC   P+10(25),AGYNAME                                                 
         LA    RF,P+35                                                          
*                                                                               
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         MVI   2(RF),C'-'                                                       
         MVC   4(8,RF),AGYCODE     PZ AGENCY CODE                               
*                                                                               
         OC    P+10(35),SPACES                                                  
         SPACE                                                                  
         MVC   SVAGYFL,AGYFLDS     SAVE FOR ADDING TO AGENCY NAME TABLE         
         MVC   SVMEDIA,STAMEDIA                                                 
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
*                                                                               
         LA    R4,AGYLIN1          AGENCY ADDRESS LINES                         
         LA    R5,4                                                             
*                                                                               
NI60     DS    0H                                                               
         CLI   0(R4),C' '                                                       
         BNH   NI64                                                             
         MVC   P+10(30),0(R4)                                                   
         OC    P+10(30),SPACES                                                  
         GOTO1 =V(PRINTER)                                                      
NI64     DS    0H                                                               
         LA    R4,30(R4)                                                        
         BCT   R5,NI60                                                          
*                                                                               
         CLI   EXCLSW,C'N'                                                      
         BE    NI70                                                             
         GOTO1 =V(PRINTER)                                                      
         MVC   P(36),=C'** BATCH NOT ADDED TO WORKER FILE **'                   
         GOTO1 =V(PRINTER)                                                      
*                                                                               
NI70     DS    0H                                                               
         GOTO1 =V(PRINTER)                                                      
         L     R4,=A(COLHDS1)                                                   
         MVC   P,0(R4)             COLUMN HEADINGS                              
         GOTO1 =V(PRINTER)                                                      
         MVC   P,132(R4)                                                        
         GOTO1 =V(PRINTER)                                                      
*                                                                               
NIX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        CHKPUB - FIND PUB IN PUB TRANSLATE TABLE                               
*                                                                               
CHKPUB   DS    0H                                                               
         L     RF,=V(PTRTAB)                                                    
         USING PTRTABD,RF                                                       
         MVI   EXCLSW,C'*'         EXCLUDE BECAUSE NOT FOUND                    
         MVI   STASTAT,C'U'                                                     
         MVI   STAMEDIA,C' '                                                    
*                                                                               
CKP2     DS    0H                                                               
         CLI   0(RF),X'FF'         EOL                                          
         BE    CKPX                                                             
         CLC   USCODE,PTRUSCOD     RIGHT AGENCY?                                
         BNE   CKP6                                                             
         CLC   STATION,PTRPZPUB    AND PUB                                      
         BNE   CKP6                                                             
         MVI   EXCLSW,C'N'                                                      
         MVI   STASTAT,C' '                                                     
         MVC   STAMEDIA,PTRMED                                                  
         B     CKPX                                                             
*                                                                               
CKP6     DS    0H                                                               
         LA    RF,PTRTABL(RF)                                                   
         B     CKP2                                                             
*                                                                               
CKPX     DS    0H                                                               
         BR    RE                                                               
         LTORG                                                                  
         DROP  R4,RF                                                            
         EJECT                                                                  
*        RUNTOT - PRINT ALL RUN TOTALS *                                        
         SPACE 2                                                                
         DS    0H                                                               
RUNTOT   NMOD1 0,**RUNT**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         SPACE                                                                  
         MVC   P+2(10),=C'RUN TOTALS'                                           
         GOTO1 =V(PRINTER)                                                      
         MVC   P+2(10),DASHES                                                   
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+15(9),=C'**INPUT**'                                            
         GOTO1 =V(PRINTER)                                                      
         MVC   P+10(19),DASHES                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+2(7),=C'EZINPUT'                                               
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+2(14),=C'TOTAL INVOICES'                                       
         L     R2,TINVS                                                         
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         SPACE                                                                  
         MVC   P+35(12),=C'CLIENT CODES'                                        
         L     R2,TCLTCDS                                                       
         LA    R3,P+47                                                          
         BAS   RE,EDIT0R                                                        
         SPACE                                                                  
         MVC   P+60(13),=C'PRODUCT CODES'                                       
         L     R2,TPRDCDS                                                       
         LA    R3,P+74                                                          
         BAS   RE,EDIT0R                                                        
         SPACE                                                                  
         MVC   P+90(14),=C'ESTIMATE CODES'                                      
         L     R2,TESTCDS                                                       
         LA    R3,P+104                                                         
         BAS   RE,EDIT0R                                                        
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+8(5),=C'SPOTS'                                                 
         L     R2,TSPTS                                                         
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+8(7),=C'DOLLARS'                                               
         LA    R2,TDOLN                                                         
         LA    R3,P+16                                                          
         BAS   RE,EDIT2A                                                        
         LA    R2,TDOLG                                                         
         LA    R3,P+30                                                          
         BAS   RE,EDIT2A                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+8(7),=C'BATCHES'                                               
         L     R2,TBTCHS                                                        
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         SPACE                                                                  
         MVC   P+8(7),=C'RECORDS'                                               
         L     R2,EZRDCT           EZINPUT FILE RECORD COUNT                    
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         LA    R2,IBYTS            INPUT BYTES                                  
         LA    R3,P+40                                                          
         BAS   RE,EDIT8                                                         
         MVC   P+54(14),=C'RECEIVED BYTES'                                      
         LA    R2,OBYTS            OUTPUT BYTES                                 
         LA    R3,P+70                                                          
         BAS   RE,EDIT8                                                         
         MVC   P+84(12),=C'WORKER BYTES'                                        
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+2(10),=C'HOLD INPUT'                                           
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         MVC   P+2(14),=C'TOTAL INVOICES'                                       
         L     R2,HIINVS                                                        
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         MVC   P+8(5),=C'SPOTS'                                                 
         L     R2,HISPTS                                                        
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+8(7),=C'DOLLARS'                                               
         LA    R2,HIDOLN                                                        
         LA    R3,P+16                                                          
         BAS   RE,EDIT2A                                                        
         LA    R2,HIDOLG                                                        
         LA    R3,P+30                                                          
         BAS   RE,EDIT2A                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+8(7),=C'BATCHES'                                               
         L     R2,HIBAT                                                         
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+8(7),=C'RECORDS'                                               
         L     R2,HDRDCT           INPUT HOLD FILE RECORD COUNT                 
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         OC    TDELINV,TDELINV     WERE THERE ANY DEL PREV INVOICES             
         BZ    EZR140               NO                                          
         SPACE                                                                  
         MVC   P(13),=C'TOTAL DEL INV'                                          
         L     R2,TDELINV                                                       
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
EZR140   GOTO1 =V(PRINTER)                                                      
         CLI   TEST,C'Y'           IF TEST RUN                                  
         BE    EZR150               SKIP OUTPUT COUNTS                          
         SPACE                                                                  
* PRINT OUTPUT TOTALS HERE (NONE FOR TEST RUN) *                                
         SPACE                                                                  
         MVC   P+15(10),=C'**OUTPUT**'                                          
         GOTO1 =V(PRINTER)                                                      
         MVC   P+10(20),DASHES                                                  
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+2(15),=C'LOADED INVOICES'                                      
         L     R2,LINVS                                                         
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+9(5),=C'SPOTS'                                                 
         L     R2,LSPTS                                                         
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         MVC   P+9(7),=C'DOLLARS'                                               
         LA    R2,LDOLN                                                         
         LA    R3,P+16                                                          
         BAS   RE,EDIT2A                                                        
         SPACE                                                                  
         LA    R2,LDOLG                                                         
         LA    R3,P+32                                                          
         BAS   RE,EDIT2A                                                        
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+9(7),=C'BATCHES'                                               
         L     R2,LBTCHS                                                        
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+2(11),=C'HOLD OUTPUT'                                          
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         MVC   P+2(13),=C'HELD INVOICES'                                        
         L     R2,HOINVS                                                        
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+7(5),=C'SPOTS'                                                 
         L     R2,HOSPTS                                                        
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+7(7),=C'DOLLARS'                                               
         LA    R2,HODOLN                                                        
         LA    R3,P+16                                                          
         BAS   RE,EDIT2A                                                        
         LA    R2,HODOLG                                                        
         LA    R3,P+32                                                          
         BAS   RE,EDIT2A                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+7(7),=C'BATCHES'                                               
         L     R2,TUNKBAT                                                       
         A     R2,TFULBAT                                                       
         C     R2,HOBAT                                                         
         B     *+6              ** USED TO DUMP HERE, MOSTLY I THINK            
         DC    H'0'             ** IF THERE WERE AGY OR PUB CODE ERRS           
         LA    R3,P+24                                                          
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+7(7),=C'RECORDS'                                               
         L     R2,WORKCT           OUTPUT HOLD FILE RECORD COUNT                
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
* PRINT STATION AND AGENCY TOTALS                                               
         SPACE                                                                  
EZR150   DS   0H                                                                
         LA    R0,EZSTALEN                                                      
         L     R4,=A(EZSTATAB)                                                  
         SPACE                                                                  
         LR    R1,R4                                                            
         SR    R5,R5                                                            
         OC    0(5,R1),0(R1)                                                    
         BZ    *+16                                                             
         LA    R5,1(,R5)                                                        
         LA    R1,21(,R1)                                                       
         BCT   R0,*-18                                                          
         LR    R6,R5                                                            
         GOTO1 =V(QSORT),DMCB,(R4),(R5),21,5,0                                  
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+4(3),=C'PUB'                                                   
         MVC   P+12(8),=C'INVOICES'                                             
         MVC   P+23(5),=C'SPOTS'                                                
         MVC   P+42(19),=C'NET - DOLLARS - GRS'                                 
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR160   OC    0(5,R4),0(R4)       END OF ENTRIES                               
         BZ    EZR161                                                           
         MVC   P+4(4),0(R4)                                                     
         SPACE                                                                  
         ICM   R2,15,5(R4)                                                      
         LA    R3,P+15                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R4),(5,P+15),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,9(R4)                                                      
         LA    R3,P+23                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R4),(5,P+23),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,13(R4)                                                     
         LA    R3,P+32                                                          
         BAS   RE,EDIT2R                                                        
*        EDIT  (R4),(13,P+32),2,COMMAS=YES                                      
         SPACE                                                                  
         ICM   R2,15,17(R4)                                                     
         LA    R3,P+48                                                          
         BAS   RE,EDIT2R                                                        
*        EDIT  (R4),(13,P+48),2,COMMAS=YES                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         LA    R4,21(,R4)                                                       
         BCT   R5,EZR160                                                        
         SPACE                                                                  
EZR161   MVC   P+16(4),=C'PUBS'                                                 
         LR    R2,R6                                                            
         LA    R3,P+10                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R5),(13,P+2),COMMAS=YES                                         
         GOTO1 =V(PRINTER)                                                      
EZR162   DS    0H                                                               
         LA    R0,100                                                           
         L     R4,=A(EZAGYCTB)                                                  
         SPACE                                                                  
         LR    R1,R4                                                            
         SR    R5,R5                                                            
         OC    0(8,R1),0(R1)                                                    
         BZ    *+16                                                             
         LA    R5,1(,R5)                                                        
         LA    R1,24(,R1)                                                       
         BCT   R0,*-18                                                          
         GOTO1 =V(QSORT),DMCB,(R4),(R5),24,8,0                                  
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+4(6),AGENCY                                                    
         MVC   P+12(8),=C'INVOICES'                                             
         MVC   P+23(5),=C'SPOTS'                                                
         MVC   P+42(19),=C'NET - DOLLARS - GRS'                                 
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR164   OC    0(8,R4),0(R4)       END OF ENTRIES                               
         BZ    EZR165                                                           
         MVC   P+4(8),0(R4)                                                     
         ICM   R2,15,8(R4)                                                      
         LA    R3,P+15                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R4),(5,P+15),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,12(R4)                                                     
         LA    R3,P+23                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R4),(5,P+23),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,16(R4)                                                     
         LA    R3,P+32                                                          
         BAS   RE,EDIT2R                                                        
*        EDIT  (R4),(13,P+32),2,COMMAS=YES                                      
         SPACE                                                                  
         ICM   R2,15,20(R4)                                                     
         LA    R3,P+48                                                          
         BAS   RE,EDIT2R                                                        
*        EDIT  (R4),(13,P+48),2,COMMAS=YES                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         LA    R4,24(,R4)                                                       
         BCT   R5,EZR164                                                        
         SPACE                                                                  
EZR165   LA    R0,100                                                           
         L     R4,=A(EZAGYNTB)                                                  
         SPACE                                                                  
         LR    R1,R4                                                            
         SR    R5,R5                                                            
         SR    R6,R6               UNKNOWN AGENCY COUNTER                       
         OC    0(150,R1),0(R1)                                                  
         BZ    *+16                                                             
         LA    R5,1(,R5)                                                        
         LA    R1,170(,R1)                                                      
         BCT   R0,*-18                                                          
         GOTO1 =V(QSORT),DMCB,(R4),(R5),170,150,0                               
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+4(6),AGENCY                                                    
         MVC   P+11(4),=C'NAME'                                                 
         MVC   P+40(8),=C'INVOICES'                                             
         MVC   P+51(5),=C'SPOTS'                                                
         MVC   P+66(19),=C'NET - DOLLARS - GRS'                                 
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR166   OC    0(30,R4),0(R4)      END OF ENTRIES                               
         BZ    EZR168                                                           
         MVC   P+4(30),0(R4)                                                    
         ICM   R2,15,152(R4)                                                    
         LA    R3,P+43                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R4),(5,P+43),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,156(R4)                                                    
         LA    R3,P+51                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R4),(5,P+51),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,160(R4)                                                    
         LA    R3,P+60                                                          
         BAS   RE,EDIT2R                                                        
*        EDIT  (R4),(13,P+60),2,COMMAS=YES                                      
         SPACE                                                                  
         ICM   R2,15,164(R4)                                                    
         LA    R3,P+76                                                          
         BAS   RE,EDIT2R                                                        
*        EDIT  (R4),(13,P+76),2,COMMAS=YES                                      
         SPACE                                                                  
         OC    168(2,R4),168(R4)     WAS THIS A UNKNOWN AGENCY                  
         BNZ   *+14                                                             
         MVC   P+36(7),=C'UNKNOWN'                                              
         LA    R6,1(,R6)             ADD TO UNKNOWN AGENCY COUNT                
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+4(30),30(R4)                                                   
         LA    R0,6                                                             
         LA    R1,P+36                                                          
         L     RE,=A(MEDBITAB)                                                  
EZR166A  ZIC   RF,1(RE)                                                         
         EX    RF,EZRTM            EXEC TM INST                                 
         BZ    EZR166B                                                          
         MVC   0(1,R1),0(RE)                                                    
         LA    R1,2(,R1)                                                        
EZR166B  LA    RE,2(,RE)                                                        
         BCT   R0,EZR166A                                                       
         B     *+8                                                              
EZRTM    TM    150(R4),0                                                        
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         CLC   60(30,R4),SPACES                                                 
         BE    EZR166E                                                          
         MVC   P+4(30),60(R4)                                                   
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR166E  CLC   90(30,R4),SPACES                                                 
         BE    EZR166G                                                          
         MVC   P+4(30),90(R4)                                                   
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR166G  CLC   120(30,R4),SPACES                                                
         BE    EZR166I                                                          
         MVC   P+4(30),120(R4)                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR166I  GOTO1 =V(PRINTER)                                                      
         LA    R4,170(,R4)                                                      
         BCT   R5,EZR166                                                        
         SPACE                                                                  
EZR168   DS    0H                                                               
         B     EZR170              NOOP PRINT OF MEDIA TABLE                    
         LA    R0,10                                                            
         L     R4,=A(EZMEDCTB)                                                  
         SPACE                                                                  
         LR    R1,R4                                                            
         SR    R5,R5                                                            
         CLI   0(R1),0                                                          
         BE    *+16                                                             
         LA    R5,1(,R5)                                                        
         LA    R1,21(,R1)                                                       
         BCT   R0,*-16                                                          
         GOTO1 =V(QSORT),DMCB,(R4),(R5),21,1,0                                  
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+4(5),=C'MEDIA'                                                 
         MVC   P+10(8),=C'INVOICES'                                             
         MVC   P+22(5),=C'SPOTS'                                                
         MVC   P+38(19),=C'NET - DOLLARS - GRS'                                 
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR169   CLI   0(R4),0             END OF ENTRIES                               
         BE    EZR170                                                           
         MVC   P+6(1),0(R4)                                                     
         ICM   R2,15,1(R4)                                                      
         LA    R3,P+11                                                          
         BAS   RE,EDIT7                                                         
*        EDIT  (R4),(7,P+11),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,5(R4)                                                      
         LA    R3,P+20                                                          
         BAS   RE,EDIT7                                                         
*        EDIT  (R4),(7,P+20),COMMAS=YES                                         
         SPACE                                                                  
         LA    R2,OBYTS                                                         
         ZAP   OBYTS,9(6,R4)                                                    
         LA    R3,P+32                                                          
         BAS   RE,EDIT2A                                                        
*        EDIT  (P6,9(R3)),(13,P+32),2,COMMAS=YES                                
         SPACE                                                                  
         ZAP   OBYTS,15(6,R4)                                                   
         LA    R3,P+48                                                          
         BAS   RE,EDIT2A                                                        
*        EDIT  (P6,15(R3)),(13,P+48),2,COMMAS=YES                               
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         LA    R4,21(,R4)                                                       
         BCT   R5,EZR169                                                        
         SPACE                                                                  
EZR170   SR    R4,R4                                                            
         SR    R5,R5                                                            
         OC    TUNKBAT,TUNKBAT     ANY BAD BATCH TOTAL                          
         BZ    EZR174                                                           
         GOTO1 =V(PRINTER)                                                      
         L     R2,TUNKBAT                                                       
         LA    R3,P+3                                                           
         BAS   RE,EDIT0R                                                        
         MVC   P+9(7),=C'BATCHES'                                               
         LR    R2,R6                                                            
         LA    R3,P+20                                                          
         BAS   RE,EDIT0R                                                        
         MVC   P+26(16),=C'UNKNOWN AGENCIES'                                    
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         LA    R4,UNKAGYMS                                                      
         SPACE                                                                  
EZR174   OC    TMAXERRS,TMAXERRS   ANY BAD ERRORS                               
         BZ    EZR180                                                           
         SPACE                                                                  
EZR176   MVC   P(11),=C'DATA ERRORS'                                            
         L     R2,TMAXERRS                                                      
         LA    R3,P+30                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         LA    R5,BADATMS                                                       
         SPACE                                                                  
EZR180   LTR   R4,R4                                                            
         BNZ   EZR182                                                           
         LTR   R5,R5                                                            
         BZ    EZR190                                                           
EZR182   MVI   P+40,C'*'                                                        
         MVC   P+41(30),P+40                                                    
         GOTO1 =V(PRINTER)                                                      
         MVI   P+40,C'*'                                                        
         MVI   P+70,C'*'                                                        
         GOTO1 =V(PRINTER)                                                      
         LTR   R4,R4                                                            
         BZ    EZR184                                                           
         MVC   P+40(31),0(R4)                                                   
         GOTO1 =V(PRINTER)                                                      
EZR184   LTR   R5,R5                                                            
         BZ    EZR186                                                           
         MVC   P+40(31),0(R5)                                                   
         GOTO1 =V(PRINTER)                                                      
EZR186   MVI   P+40,C'*'                                                        
         MVI   P+70,C'*'                                                        
         GOTO1 =V(PRINTER)                                                      
         MVI   P+40,C'*'                                                        
         MVC   P+41(30),P+40                                                    
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR190   LA    R4,TOTFILES                                                      
         LA    R5,L'TOTFILES                                                    
         SPACE                                                                  
EZR194   CLI   0(R4),0                                                          
         BE    EZR200                                                           
         TM    0(R4),X'08'         WAS THIS A BAD FILE                          
         BZ    EZR196               NOPE                                        
         LR    R1,R4                                                            
         LA    R0,TOTFILES-1                                                    
         SR    R1,R0                                                            
         CVD   R1,DUB                                                           
         MVC   P+8(23),=C'FILE 000 HAD BAD TOTALS'                              
         OI    DUB+7,X'0F'                                                      
         UNPK  P+13(3),DUB                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR196   LA    R4,1(,R4)                                                        
         BCT   R5,EZR194                                                        
EZR200   XIT1                                                                   
         DS    0H                                                               
EDIT0R   NTR1                                                                   
         EDIT  ((R2)),(5,(R3)),ZERO=NOBLANK                                     
         B     EZR200                                                           
         SPACE                                                                  
         DS    0H                                                               
EDIT7    NTR1                                                                   
         EDIT  (R2),(7,(R3)),COMMAS=YES                                         
         B     EZR200                                                           
         SPACE                                                                  
         DS    0H                                                               
EDIT2R   NTR1                                                                   
         EDIT  ((R2)),(14,(R3)),2,COMMAS=YES,ZERO=NOBLANK,MINUS=YES             
         B     EZR200                                                           
         DS    0H                                                               
EDIT2A   NTR1                                                                   
         EDIT  (P8,0(R2)),(14,(R3)),2,COMMAS=YES,ZERO=NOBLANK,MINUS=YES         
         B     EZR200                                                           
         DS    0H                                                               
EDIT8    NTR1                                                                   
         EDIT  (P8,IBYTS),(13,P+40),ZERO=NOBLANK,COMMAS=YES                     
         B     EZR200                                                           
         SPACE                                                                  
         LTORG                                                                  
AGENCY   DC    C'AGENCY '                                                       
UNKAGYMS DC    CL31'* UNKNOWN AGENCY - NOT LOADED *'                            
BADATMS  DC    CL31'* BAD DATA ERROR - NOT LOADED *'                            
         DROP  RB,RC                                                            
         EJECT                                                                  
* DCB DSECT WITH ADRESSABLE LABELS *                                            
         SPACE 2                                                                
*        PRINT GEN                                                              
         DCBD  DSORG=PS,DEVD=DA,TA                                              
         PRINT NOGEN                                                            
         SPACE                                                                  
*              DSECT FOR PROGRAM                                                
         SPACE 2                                                                
EZLDWKD  DSECT                                                                  
DUB      DS    D                                                                
DOUBLE   DS    D                                                                
FULL     DS    F                                                                
DMCB     DS    6F                                                               
HALF     DS    H                                                                
BYTE     DS    X                                                                
         DS    0F                                                               
IDTPARS  DS    6F                                                               
STTPARS  DS    6F                                                               
ERRLINE  DS    XL132                                                            
         DS    XL124                                                            
WORK     DS    XL64                                                             
CARD     DS    CL80                                                             
SVID     DS    CL42                                                             
         DS    CL8                                                              
ID       DS    CL42                                                             
WKRFIL   DS    CL8                                                              
TODAY    DS    CL6                                                              
TODAYC   DS    XL2                                                              
TIMEP    DS    XL2                                                              
HOLDDATE DS    CL6                                                              
         SPACE                                                                  
WKRBUF   DS    A                                                                
WKRREC   DS    A                                                                
EOR      DS    A                                                                
AEZINPT  DS    A                                                                
TRACES   DS    0CL5                                                             
TRACEREC DS    CL1                                                              
TRACEFLD DS    CL1                                                              
TRACEWKR DS    CL1                                                              
TRACEHLD DS    CL1                 HOLD FILE                                    
TRACEWRK DS    CL1                 WORK FILE FOR UNKNOWNS/WORKER FULL           
TEST     DS    CL1                                                              
ABNDOPT  DS    CL1                                                              
DMGOPT   DS    CL1                                                              
RERUN    DS    CL1                                                              
SVRECSW  DS    XL1                                                              
SVRECSTA EQU   X'80'                                                            
SVRECPAY EQU   X'40'                                                            
SVRECAGY EQU   X'20'                                                            
SVRECSRC EQU   X'10'                                                            
SVRECSCT EQU   X'08'                                                            
SVRECSCB EQU   X'04'                                                            
         SPACE                                                                  
STDCMTSW DS    XL1                                                              
STDCMTOP EQU   X'80'                                                            
STDCMBOT EQU   X'40'                                                            
         SPACE                                                                  
NEWBATSW DS    CL1                 READING HOLD FILE,                           
*                                  READ DIFFERENT DATE OR SOURCE                
*                                  NEED TO FORCE END OF BATCH                   
SAVSW    DS    CL1                                                              
         SPACE                                                                  
USIDNO   DS    XL2                                                              
USID     DS    CL8                                                              
USCODE   DS    CL2                 2-BYTE AGENCY CODE                           
STMODE   DS    CL1                                                              
IDMODE   DS    CL1                                                              
EXCLSW   DS    CL1                 SET TO N IF GOOD BATCH                       
*                                  SET TO * FOR UNKNOWN AGENCY                  
*                                           OR FULL WORKER FILE                 
*                                  SET TO Y IF EXPRESSLY EXCLUDED               
*                                  (STATION=+/- USERID=+/-)                     
STASTAT  DS    CL1                 STATION STATUS - U=UNKNOWN                   
SOURCE   DS    CL4                                                              
SVSRCE   DS    CL4                 SOURCE SAVED HERE WHEN READING HOLD          
HOLDSW   DS    CL1                 H=HOLD FILE, 0=EZINPUT                       
RECFM    DS    CL1                                                              
SVIDSTA  DS    CL5                                                              
DASHES   DS    CL60                                                             
KEY      DS    XL64                                                             
KEYSAVE  DS    XL64                                                             
DMWORK   DS    12D                                                              
*                                                                               
         DS    0F                                                               
COUNTS   DS    0XL(ENDCTS)                                                      
*                                                                               
* COUNTS FOR 1 INVOICE (CURRENT)                                                
*                                                                               
ISPTS    DS    F                   INVOICE SPOTS                                
IDOLN    DS    F                           DOLLARS (NET)                        
IDOLG    DS    F                           DOLLARS (GROSS)                      
         SPACE                                                                  
*                                                                               
* COUNTS FOR 1 BATCH (CURRENT)                                                  
*                                                                               
BSPTS    DS    F                   BATCH SPOTS                                  
BDOLN    DS    F                         DOLLARS (NET)                          
BDOLG    DS    F                         DOLLARS (GROSS)                        
BINVS    DS    F                         INVOICES                               
         SPACE                                                                  
*                                                                               
* COUNTS FOR 1 BATCH (CURRENT)                                                  
*                                                                               
TSPTS    DS    F                   TOTAL FOR NEW DATA SET                       
TDOLN    DS    PL8                                                              
TDOLG    DS    PL8                                                              
TINVS    DS    F                                                                
EZRDCT   DS    F                   RECORDS READ FROM EZINPUT FILE               
         SPACE                                                                  
*                                                                               
* COUNTS FOR INPUT HOLD FILE *                                                  
*                                                                               
HIBAT    DS    F                   TOTAL ON HOLD FILE (UNKNOWS OR FULL)         
HISPTS   DS    F                                                                
HIDOLN   DS    PL8                                                              
HIDOLG   DS    PL8                                                              
HIINVS   DS    F                                                                
HDRDCT   DS    F                   RECORDS READ FROM HOLD FILE                  
         SPACE                                                                  
*                                                                               
* COUNTS FOR OUTPUT HOLD FILE *                                                 
*                                                                               
HOBAT    DS    F                   TOTAL ON HOLD FILE (UNKNOWS OR FULL)         
HOSPTS   DS    F                                                                
HODOLN   DS    PL8                                                              
HODOLG   DS    PL8                                                              
HOINVS   DS    F                                                                
*                                                                               
* COUNT OF RECORDS ON THE WORK FILE - UNKNOWN OR FULL EASIWK *                  
* THIS WILL BE THE COUNT OF RECORDS ON NEW HOLD FILE         *                  
*                                                                               
WORKCT   DS    F                   COUNT OF RECORDS ON WORK FILE                
WORKCT9  DS    F                   COUNT OF 99 RECORDS ON WORK FILE             
         SPACE                                                                  
TBTCHS   DS    F                   TOTAL BATCHES                                
TUNKBAT  DS    F                   TOTAL BAD BATCHES (UNKNOWN AGENCY)           
TFULBAT  DS    F                   TOTAL WORKER FILE FULL BATCHES               
*                                                                               
TDELINV  DS    F                   TOTAL DELETE PREVIOUS INVOICE RECS           
TMAXERRS DS    F                   TOTAL BAD ERRORS FOUND ON TAPE               
TCLTCDS  DS    F                                                                
TPRDCDS  DS    F                                                                
TESTCDS  DS    F                                                                
*                                                                               
* LOADED BATCH TOTALS                                                           
*                                                                               
LBTCHS   DS    F                   LOADED BATCHES                               
LINVS    DS    F                          INVOICES                              
LSPTS    DS    F                          SPOTS                                 
ENDCTS   EQU   *-ISPTS                                                          
LDOLN    DS    PL8                                                              
LDOLG    DS    PL8                                                              
*                                                                               
* LOADED BATCH TOTALS                                                           
*                                                                               
IBYTS    DS    PL8                 INPUT BYTES REC                              
OBYTS    DS    PL8                 OUTPUT BYTES REC                             
*                                                                               
RDELIM   DS    CL1                 RECORD DELIMITER                             
FDELIM   DS    CL1                 FIELD DELIMITER                              
HOLDSIGN DS    CL1                                                              
*                                                                               
* RECORD FIELD DATA AREA - EACH FIELD BUILT HERE TO PRINT IF NEEDED *           
*                                                                               
RFVALS   DS    0D                                                               
RFDATA   DS    XL256                                                            
RFLEN    DS    XL1                                                              
RFCTL    DS    X                   EXTERNAL SWITCHES                            
RFCTLEOF EQU   X'80' - END OF FILE                                              
RFCTLEOR EQU   X'40' - END OF RECORD                                            
RFCTLFER EQU   X'20' - FIELD ERROR                                              
RFCTLEFL EQU   X'10' - END OF FIELD                                             
RFCTLREC EQU   X'08' - RECORD WAS READ FROM FILE                                
         SPACE                                                                  
RFCTL2   DS    X                   INTERNAL SWITCHES                            
RFCTL2RD EQU   X'04' - NEED TO READ NEXT TAPE BLOCK/RECORD                      
RFCTL2EF EQU   X'02' - END OF FILE                                              
RFCTL2ER EQU   X'01' - END OF RECORD                                            
RFFLDNO  DS    X                                                                
RFCURPOS DS    F                                                                
RFFLDST  DS    F                                                                
RFRECST  DS    F                                                                
RFERRMSG DS    CL20                                                             
RFVALSL  EQU   *-RFVALS                                                         
*                                                                               
RECLEN   DS    F                                                                
RECTYP   DS    CL2                                                              
*                                                                               
* WORKER RECORD POINTERS *                                                      
*                                                                               
WFVALS   DS    0D                                                               
WRECST   DS    F                   WORKER RECORD START                          
WRCURPOS DS    F                   WORKER RECORD NEXT FIELD PTR                 
WFVALSL  EQU   *-WFVALS                                                         
*                                  INVOICE FIELDS                               
INVFLDS  DS    0CL95                                                            
INVNO    DS    CL10                                                             
INVMOS   DS    CL4                                                              
INVDEL   DS    CL1                                                              
ADVNAM   DS    CL25                                                             
ADVCD    DS    CL8                                                              
PRDNAM   DS    CL25                                                             
PRDCD    DS    CL8                                                              
ESTNO    DS    CL10                                                             
STANET   DS    CL4                                                              
*                                  SAVED DATA FIELDS                            
STAFLDS  DS    0CL5                                                             
STATION  DS    CL4                                                              
STAMEDIA DS    CL1                                                              
STAFLDSA DS    0CL150                                                           
STANAME  DS    CL30                                                             
STALIN1  DS    CL30                                                             
STALIN2  DS    CL30                                                             
STALIN3  DS    CL30                                                             
STALIN4  DS    CL30                                                             
*                                                                               
*                                                                               
BILSTA   DS    CL5                                                              
*                                                                               
AGYFLDS  DS    0CL150                                                           
AGYCODE  DS    CL8                                                              
AGYNAME  DS    CL30                                                             
AGYLIN1  DS    CL30                                                             
AGYLIN2  DS    CL30                                                             
AGYLIN3  DS    CL30                                                             
AGYLIN4  DS    CL30                                                             
*                                                                               
SVAGYFL  DS    0CL150                                                           
SVAGYNM  DS    CL30                                                             
         DS    CL120                                                            
SVMEDIA  DS    CL1                                                              
*                                                                               
* 1 BYTE EACH FILE - 80 SET ON FOR EACH FILE, 08 IF TOTALS UNEQUAL              
*                                                                               
         DS    0F                                                               
TOTFILES DS    CL512                                                            
*                                                                               
* TOTALS FROM INPUT DATA SET 12 TOTALS RECORD                                   
*                                                                               
TOTINVS  DS    F                                                                
TOTDOLS  DS    PL8                                                              
*                                                                               
*                  TOTALS FROM START OF RUN OR SINCE LAST TOTAL RECORD          
*                                                                               
CFLDS    DS    0F                                                               
CINVS    DS    F                                                                
CDOLN    DS    PL8                                                              
CDOLG    DS    PL8                                                              
*                                                                               
OLDSTA   DS    CL(L'STAFLDS)                                                    
OLDSTAD  DS    CL150                                                            
OLDAGY   DS    CL150                                                            
         SPACE                                                                  
* WORK AREA TO ALLOW FIELDS TO SPAN RECORDS *                                   
* EACH FIELD IS BUILT HERE                  *                                   
         SPACE                                                                  
WLEN     DS    H                                                                
WDATA    DS    CL256                                                            
EZBILL   DS    CL512               BUFFER FOR SLOPPY INPUT                      
*                                                                               
EZLDWKL  EQU   *-EZLDWKD                                                        
         SPACE 3                                                                
         EJECT                                                                  
*                                                                               
       ++INCLUDE DMWRKFD                                                        
       ++INCLUDE DMWRKFK                                                        
       ++INCLUDE DMWRKFL                                                        
*                                                                               
       ++INCLUDE PPGENPZ                                                        
*                                                                               
         EJECT                                                                  
       ++INCLUDE DDDPRINT                                                       
         ORG   P                                                                
ILADV    DS    CL25                                                             
         DS    CL1                                                              
ILADVCD  DS    CL8                                                              
         DS    CL1                                                              
ILPRD    DS    CL25                                                             
         DS    CL2                                                              
ILPRDCD  DS    CL8                                                              
         DS    CL2                                                              
ILEST    DS    CL10                                                             
         DS    CL1                                                              
ILINV    DS    CL10                                                             
         DS    CL2                                                              
ILMOS    DS    CL4                                                              
         DS    CL3                                                              
ILSPTS   DS    CL5                                                              
ILDOLS   DS    CL12                                                             
         DS    CL3                                                              
ILNET    DS    CL4                                                              
*                                                                               
         EJECT                                                                  
PZLOAD   CSECT                                                                  
         DS    0D                                                               
FILIST   DC    CL8'NGENDIR'                                                     
         DC    CL8'NGENFIL'                                                     
         DC    CL10'X'                                                          
*                                                                               
COLHDS1  DC    CL132'ADVERTISER NAME           CODE     PRODUCT NAME   C        
                           CODE      EST        INVOICE    MONTH   SPOTC        
               S       NET'                                                     
COLHDS2  DC    CL132'---------------           ----     ------------   C        
                           -------   ---        -------    -----   ----C        
               -    ---------'                                                  
         SPACE 3                                                                
         DS    0D                                                               
EZINPUTF DCB   DDNAME=EZINPUT,DSORG=PS,RECFM=FB,MACRF=GM,EODAD=GETEOF           
         DS    0D                                                               
EZINPUTU DCB   DDNAME=EZINPUT,DSORG=PS,RECFM=U,MACRF=GM,EODAD=GETEOF            
         DS    0D                                                               
EZINPUTV DCB   DDNAME=EZINPUT,DSORG=PS,RECFM=VB,MACRF=GM,EODAD=GETEOF           
         DS    0D                                                               
EZBILLF  DCB   DDNAME=EZBILL,                                          C        
               DSORG=PS,                                               C        
               LRECL=512,                                              C        
               RECFM=FB,                                               C        
               MACRF=PM                                                         
         SPACE                                                                  
         DS    0D                                                               
EZHOLDR  DCB   DDNAME=EZHOLD,                                          C        
               DSORG=PS,                                               C        
               EODAD=GETEOF,                                           C        
               LRECL=512,                                              C        
               RECFM=VB,                                               C        
               MACRF=GM                                                         
         SPACE                                                                  
         DS    0D                                                               
EZHOLDW  DCB   DDNAME=EZHOLD,                                          C        
               DSORG=PS,                                               C        
               LRECL=512,                                              C        
               RECFM=VB,                                               C        
               MACRF=PM                                                         
         SPACE                                                                  
         DS    0D                                                               
EZWORKW  DCB   DDNAME=EZWORK,                                          C        
               DSORG=PS,                                               C        
               LRECL=512,                                              C        
               RECFM=VB,                                               C        
               MACRF=PM                                                         
         SPACE                                                                  
         DS    0D                                                               
EZWORKR  DCB   DDNAME=EZWORK,                                          C        
               DSORG=PS,                                               C        
               EODAD=EOFWORK,                                          C        
               LRECL=512,                                              C        
               RECFM=VB,                                               C        
               MACRF=GM                                                         
         SPACE                                                                  
UTL      DS    0D                                                               
         DC    F'0'                                                             
         DC    X'0A'               CONTROL SYSTEM                               
*                                                                               
         DS    0D                                                               
         DC    CL8'*WKRBUF*'                                                    
WKRBUFC  DS    14336X                                                           
*                                                                               
         DC    CL8'*WKRREC*'                                                    
WKRRECC  DS    4096X                                                            
*                                                                               
         DC    CL8'*RECWRK*'                                                    
RECWRK   DS    1024X                                                            
*                                                                               
         DS    0D                                                               
         DC    CL8'*SAVSTA*'                                                    
SAVSTA   DS    1024X                                                            
*                                                                               
         DS    0D                                                               
         DC    CL8'*SAVPAY*'                                                    
SAVPAY   DS    1024X                                                            
*                                                                               
         DS    0D                                                               
         DC    CL8'*SAVAGY*'                                                    
SAVAGY   DS    1024X                                                            
*                                                                               
         DS    0D                                                               
         DC    CL8'*SAVSCT*'       STANDARD COMMENT TOP                         
SAVSCT   DS    5XL136                                                           
SAVSCTLN EQU   *-SAVSCT                                                         
*                                                                               
         DS    0D                                                               
         DC    CL8'*SAVSCB*'       STANDARD COMMENT BOTTOM                      
SAVSCB   DS    5XL136                                                           
SAVSCBLN EQU   *-SAVSCB                                                         
*                                                                               
         DS    0D                                                               
         DC    CL8'*GENREC*'                                                    
GENREC   DS    1024X                                                            
*                                                                               
         DS    0D                                                               
         DC    CL8'*HLDREC*'                                                    
HLDREC   DS    1024X                                                            
*                                                                               
         DS    0D                                                               
         DC    CL8'*STTAB**'                                                    
STTAB    DS    50CL5                                                            
STTABMX  EQU   50                                                               
*                                                                               
         DS    0D                                                               
         DC    CL8'*IDTAB**'                                                    
IDTAB    DS    50CL8                                                            
IDTABMX  EQU   50                                                               
*                                                                               
         DS    0D                                                               
         DC    CL8'**EZIN**'                                                    
         DC    F'0'                                                             
EZINREC  DS    CL33000                                                          
         DC    64X'00'             MAY USE TO MARK EOR                          
         DC    CL8'**EOR***'                                                    
         SPACE                                                                  
         DS    0D                                                               
         DC    CL8'*STATAB*'                                                    
         DC    F'0'                                                             
EZSTATAB DC 300XL21'00'        STATION TABLE                                    
EZSTALEN EQU   300                                                              
         DC    CL8'*ENDSTA*'  5-STA, 4 #INV, 4 #SPTS, 4 NET DOLS, 4 GRS         
         SPACE                                                                  
         DS    0D                                                               
         DC    CL8'*AGYCTB*'                                                    
         DC    F'0'                                                             
EZAGYCTB DC 100XL24'00'        AGENCY TABLE                                     
         DC    CL8'*ENDAGY*'    8-USID, 4 #INV, 4 #SPTS, 4 NET, 4 GRS           
         DS    0D                                                               
         DC    CL8'*AGYNTB*'                                                    
         DC    F'0'                                                             
EZAGYNTB DC 100XL170'00'           AGENCY NAME TABLE                            
         DC    CL8'*ENDAGY*' 150-NAME & ADDRESS                                 
*                              1 FOR MEDIA BITS                                 
*                              1 SPARE                                          
*                              16 - 4 EACH FOR # INV, SPTS, NET, GROSS          
*                              2-USID (UNKNOWN INDICATOR)                       
         DS    0D                                                               
         DC    CL8'*MEDCTB*'                                                    
         DC    F'0'                                                             
* MEDIA TABLE                                                                   
         SPACE                                                                  
EZMEDCTB DC  10XL21'00000000000000000000000000000F00000000000F'                 
         DC    CL8'*ENDMED*'   1-MEDIA 4 # INV, 4 #SPTS, 6 NET, 6 GRS           
* BINARY  BINARY  PACKED                                                        
* RECORD BUILT HERE (TO ALLOW SPANNED FIELDS/RECORDS FROM BLOCK TO              
*                    BLOCK)                                                     
*                                                                               
         DS    0D                                                               
         DC    CL8'**EZOT**'                                                    
EZOTREC  DS    CL1024                                                           
EZOTRECL EQU   1024                                                             
*                                                                               
         DS    0D                                                               
         DC    CL8'*REGSAV*'                                                    
REGSAVE  DS    XL30000                                                          
*                                                                               
PZLOADX  DS    0D                                                               
         SPACE 3                                                                
EZBILLD  DSECT                                                                  
EZBAGY   DS    CL8                                                              
EZBSRC   DS    CL4                                                              
EZBCALL  DS    CL5                                                              
EZBNET   DS    CL4                                                              
EZBMOS   DS    CL4                                                              
EZBTODAY DS    CL6                                                              
EZBADVNM DS    CL25                                                             
EZBPRDNM DS    CL25                                                             
EZBINVNO DS    CL10                                                             
EZBNSPTS DS    CL5                                                              
EZBGDOL  DS    CL11                                                             
EZBNDOL  DS    CL11                                                             
EZBAGYNM DS    CL30                                                             
EZBAGYAD DS    CL120                                                            
EZBSTADR DS    CL150                                                            
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'030PZLOAD    05/01/02'                                      
         END                                                                    

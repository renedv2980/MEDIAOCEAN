*          DATA SET DDVEMAIL   AT LEVEL 006 AS OF 05/15/20                      
*CATALP VEMAIL                                                                  
         TITLE 'Validate email address'                                         
***********************************************************************         
*                                                                               
* PARAMETER:                                                                    
* ----------                                                                    
*      1      X'80' If on then case sensitive                                   
*             AL1(0)                                                            
*             AL3(Field header with e-mail address)                             
*                          or                                                   
*             AL1(Length of e-mail string)                                      
*             AL3(String)                                                       
*                                                                               
*      2      AL1(Language# or zero (Default))                                  
*             AL3(0)                                                            
*                                                                               
*      3      AL1(0)                                                            
*             AL3(Domain Record)                                                
*                                                                               
*      4      AL4(0)                                                            
*                                                                               
* Return      AL1(Error#)                                                       
*             AL3(Start of data that is a problem)                              
***********************************************************************         
VEMAIL   CSECT                                                                  
         PRINT NOGEN                                                            
         USING EMAILD,RC                                                        
         NMOD1 EMAILQ,**EMAIL*,RR=R2                                            
         ST    R2,ARELO                                                         
         ST    R1,APARMS                                                        
         MVC   PARMS(PARMLNQ),0(R1)                                             
         L     R4,0(,R1)           Address of data to verify                    
                                                                                
         XC    AUCASE,AUCASE                                                    
         TM    0(R1),X'80'         Case sesitive ?                              
         BO    VEMAIL02            Yes                                          
         LLC   RF,4(,R1)           Get language code                            
         MHI   RF,16                                                            
         L     RE,=A(CTRYXLAT)                                                  
         A     RE,ARELO                                                         
         AR    RE,RF                                                            
         L     RF,8(,RE)                                                        
         A     RF,ARELO                                                         
         ST    RF,AUCASE          Upper case                                    
                                                                                
         USING FLDHDRD,R4                                                       
VEMAIL02 NI    0(R1),TURNOFF-X'80'                                              
         SR    RF,RF                                                            
         ICM   RF,1,0(R1)          Any length supplied                          
         BNZ   EMAIL12             Yes, so length of data                       
         SR    RF,RF                                                            
         ICM   RF,1,FLDLEN         Length of field and hdr+trl                  
         JZ    *+2                                                              
                                                                                
         SHI   RF,8                Less length of field hdr                     
         TM    FLDATB,FATBXHDR     Has trailer ?                                
         BZ    *+8                 No                                           
         SHI   RF,8                Yes                                          
         LA    R4,FLDDATA                                                       
                                                                                
EMAIL12  STC   RF,FLEN             Remove trailing spaces                       
         LA    R5,0(RF,R4)         R5 = A(One beyound end of text)              
         SHI   R5,1                R5 = Last character                          
         ZIC   RF,FLEN                                                          
EMAIL10  CLI   0(R5),C' '                                                       
         BH    EMAIL20                                                          
         BCTR  R5,0                                                             
         BCT   RF,EMAIL10                                                       
         B     EMERR0                                                           
                                                                                
EMAIL20  STC   RF,FLEN             Save new length                              
         LA    R5,0(RF,R4)         A(End of data)                               
                                                                                
         BCTR  RF,0                Less one for execute                         
         EX    RF,*+8                                                           
         B     *+10                                                             
         TRT   0(0,R4),VALCHAR                                                  
         BNZ   EMERR1              Invalid character                            
                                                                                
         ICM   RE,15,AUCASE        Make upper case ?                            
         BZ    EMAIL21             No                                           
         EX    RF,*+8                                                           
         B     *+10                                                             
         TR    0(0,R4),0(RE)       Make upper case                              
                                                                                
EMAIL21  XC    TRTAB,TRTAB         If not passed use local area                 
         MVI   TRTAB+C'@',X'FF'                                                 
         EX    RF,*+8                                                           
         B     *+10                                                             
         TRT   0(0,R4),TRTAB                                                    
         BZ    EMERR2              No C'@'                                      
                                                                                
         MVI   ISPERIOD,NO                                                      
         LA    R4,1(,R1)           R4 = A(One beyond @)                         
         ST    R4,ADOMAIN          A(DOMAIN)                                    
         LR    RF,R5                                                            
         SR    RF,R4                                                            
         ST    RF,LDOMAIN          L'DOMAIN                                     
         BNP   EMERR3              Missing extension                            
                                                                                
         SHI   RF,1                One for EX instr.                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         TRT   0(0,R4),TRTAB       Make sure only one C'@'                      
         BNZ   EMERR7              Too many C'@'                                
         AHI   RF,1                Add back                                     
                                                                                
         MVI   TRTAB+C'@',X'00'                                                 
         MVI   TRTAB+C'.',X'FF'    Switch to C'.'                               
                                                                                
EMAIL22  SHI   RF,1                Less one for execute                         
         BNP   EMERR4              Not enough room for an extension             
         EX    RF,*+8                                                           
         B     *+10                                                             
         TRT   0(0,R4),TRTAB                                                    
         BZ    EMERR4              No ".", so missing extension                 
         MVI   ISPERIOD,YES                                                     
         AHI   RF,1                Add back for now                             
                                                                                
         LA    R4,1(,R1)           R4 = A(One beyound .)                        
         LR    RF,R5                                                            
         SR    RF,R4                                                            
         BNP   EMERR5              Invalid extension                            
*&&DO                                                                           
         USING EMATRIXD,R7                                                      
         L     R7,=A(EXTMATRX)                                                  
         A     R7,ARELO                                                         
EMAIL24  CLI   0(R7),EOT           End of table ?                               
         BE    EMAIL22             May have another "."                         
         SR    R6,R6                                                            
         IC    R6,EMXLEN           Length of extension                          
         CR    RF,R6               Needs to be same length                      
         BE    EMAIL26             Matched, so use this entry                   
         AHI   R7,EMXLNQ                                                        
         B     EMAIL24                                                          
                                                                                
EMAIL26  SR    R0,R0                                                            
         IC    R0,EMX#OF           # of entries                                 
         SR    R1,R1                                                            
         ICM   R1,3,EMXDISP                                                     
         L     R2,=A(EXTTAB)                                                    
         A     R2,ARELO                                                         
         AR    R2,R1               A(Table we want)                             
         BCTR  R6,0                For EX                                       
EMAIL28  EXCLC R6,0(R4),0(R2)      Is it in table ?                             
         BE    VALDOM                                                           
         LA    R2,1(R6,R2)         Bump up to next entry                        
         BRCT  R0,EMAIL28                                                       
         DROP  R7                                                               
*&&                                                                             
         CHI   RF,2                If two see if country code                   
         BL    EMERR5                                                           
         BE    EXTCNTRY                                                         
         B     VALDOM              All extensions are valid nowadays            
*                                                                               
         EJECT ,                                                                
***********************************************************************         
* See if special two character country code                           *         
***********************************************************************         
EXTCNTRY MVC   CTRYCODE,0(R4)                                                   
         TR    CTRYCODE,IDXCHAR                                                 
         SR    R6,R6                                                            
         ICM   R6,1,CTRYCODE       Get index value                              
         BZ    EMERR6              Invalid index value                          
         BCTR  R6,0                                                             
         MHI   R6,26               # of letters in the alphabet                 
         L     R5,=A(COUNTRY)                                                   
         A     R5,ARELO                                                         
         AR    R5,R6               A(Valid country values)                      
                                                                                
         SR    R6,R6                                                            
         ICM   R6,1,CTRYCODE+1     Get index value                              
         BZ    EMERR6              Invalid index value                          
         BCTR  R6,0                                                             
         AR    R5,R6               A(2nd character of country code)             
         CLI   0(R5),C' '                                                       
         BE    EMERR6              Unknown country code                         
                                                                                
***********************************************************************         
* See if we are restricting the domain                                          
***********************************************************************         
VALDOM   ICM    R4,15,ADOMAIN      A(DOMAIN)                                    
         BZ     EMOKAY             no domain to validate                        
         ICM    R5,15,LDOMAIN      L'DOMAIN                                     
         BZ     EMOKAY             no domain to validate                        
         XR     R6,R6                                                           
         ICM    R6,B'0111',P3+1    A(DOMAIN RECORD)                             
         BZ     EMOKAY             No domain record provided                    
         USING  DOMRECD,R6                                                      
         CLI    DOMKMAJ,DOMKMAQ                                                 
         BNE    EMOKAY             Didn't pass a domain record                  
         CLI    DOMKMIN,DOMKMIQ                                                 
         BNE    EMOKAY             Didn't pass a domain record                  
         LA     R7,DOMFIRST(,R6)                                                
         USING  DOMELD,R7                                                       
VD010    CLI    DOMEL,0                                                         
         BE     EMERR8             Domain not in list, invalid domain           
         CLI    DOMEL,DOMELQ                                                    
         BE     VD030                                                           
VD020    LLC    RF,DOMELL                                                       
         AR     R7,RF                                                           
         B      VD010                                                           
VD030    LLC    RF,DOMELL                                                       
         AHI    RF,-DOMELLQ                                                     
         CR     RF,R5              Same length as requested domain?             
         BNE    VD020              No: try the next one on the record           
         AHI    RF,-1                                                           
         EX     RF,*+8                                                          
         B      *+10                                                            
         CLC    DOMEDOM(0),0(R4)   Valid domain?                                
         BE     EMOKAY             Yes                                          
         B      VD020              No: try the next one on the record           
                                                                                
***********************************************************************         
* EXITS                                                                         
***********************************************************************         
EMOKAY   MVI   ERROR#,ERRNONE                                                   
         L     R4,P1               Load to set to being again                   
         CLI   0(R4),0             Header or string                             
         BNE   EMERRX              A(E-mail address)                            
         AHI   R4,8                Point to data                                
         B     EMERRX                                                           
*                                                                               
EMERR0   MVI   ERROR#,ERRNOINP     No input                                     
         B     EMERRX                                                           
EMERR1   MVI   ERROR#,ERRICHAR     Invalid character                            
         LR    R4,R1               R1 = A(Bad character)                        
         B     EMERRX                                                           
EMERR2   MVI   ERROR#,ERRNO@       No @ sign found                              
         B     EMERRX                                                           
EMERR3   MVI   ERROR#,ERRMEXT      Missing extension                            
         B     EMERRX                                                           
EMERR4   MVI   ERROR#,ERRNOPRD     No "."                                       
         CLI   ISPERIOD,YES        Has "." ?                                    
         BNE   EMERRX              No                                           
         MVI   ERROR#,ERRMEXT      Missing extension                            
         B     EMERRX                                                           
EMERR5   MVI   ERROR#,ERRIEXT      Invalid extension                            
         LR    R4,R1               R1 = A(Invalid extension)                    
         B     EMERRX                                                           
EMERR6   MVI   ERROR#,ERRICTRY     Not valid contry code                        
         B     EMERRX                                                           
EMERR7   MVI   ERROR#,ERR2MANY     Too many C'@'                                
         B     EMERRX                                                           
EMERR8   MVI   ERROR#,ERRIDOM      Invalid Domain                               
         LR    R4,R1                                                            
                                                                                
EMERRX   L     R1,APARMS                                                        
         ST    R4,0(,R1)                                                        
         MVC   0(1,R1),ERROR#                                                   
         LTR   RE,RE                                                            
XIT      XIT1                                                                   
         EJECT ,                                                                
         LTORG                                                                  
         EJECT ,                                                                
***********************************************************************         
* Valid characters for e-mail addresses                                         
***********************************************************************         
*@1234567890-_.'µ~abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ          
*                   0.1.2.3.4.5.6.7.8.9.A.B.C.D.E.F.                            
VALCHAR  DC    XL16'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF' 00-0F                     
         DC    XL16'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF' 10-1F                     
         DC    XL16'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF' 20-2F                     
         DC    XL16'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF' 30-3F                     
         DC    XL16'FFFFFFFFFFFFFFFFFFFFFF00FFFFFFFF' 40-4F                     
         DC    XL16'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF' 50-5F                     
         DC    XL16'00FFFFFFFFFFFFFFFFFFFFFFFF00FFFF' 60-6F                     
         DC    XL16'FFFFFFFFFFFFFFFFFFFFFFFF0000FFFF' 70-7F                     
         DC    XL16'FF000000000000000000FFFFFFFFFFFF' 80-8F                     
         DC    XL16'FF000000000000000000FFFFFFFFFFFF' 90-9F                     
         DC    XL16'FF000000000000000000FFFFFFFFFFFF' A0-AF                     
         DC    XL16'00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF' B0-BF                     
         DC    XL16'FF000000000000000000FFFFFFFFFFFF' C0-CF                     
         DC    XL16'FF000000000000000000FFFFFFFFFFFF' D0-DF                     
         DC    XL16'FFFF0000000000000000FFFFFFFFFFFF' E0-EF                     
         DC    XL16'00000000000000000000FFFFFFFFFFFF' F0-FF                     
         EJECT ,                                                                
*******************************************************************             
* Index by the letter of the alphabet                                           
*******************************************************************             
*                   0.1.2.3.4.5.6.7.8.9.A.B.C.D.E.F.                            
IDXCHAR  DC    XL16'00000000000000000000000000000000' 00-0F                     
         DC    XL16'00000000000000000000000000000000' 10-1F                     
         DC    XL16'00000000000000000000000000000000' 20-2F                     
         DC    XL16'00000000000000000000000000000000' 30-3F                     
         DC    XL16'00000000000000000000000000000000' 40-4F                     
         DC    XL16'00000000000000000000000000000000' 50-5F                     
         DC    XL16'00000000000000000000000000000000' 60-6F                     
         DC    XL16'00000000000000000000000000000000' 70-7F                     
         DC    XL16'00010203040506070809000000000000' 80-8F                     
         DC    XL16'000A0B0C0D0E0F101112000000000000' 90-9F                     
         DC    XL16'0000131415161718191A000000000000' A0-AF                     
         DC    XL16'00000000000000000000000000000000' B0-BF                     
         DC    XL16'00010203040506070809000000000000' C0-CF                     
         DC    XL16'000A0B0C0D0E0F101112000000000000' D0-DF                     
         DC    XL16'0000131415161718191A000000000000' E0-EF                     
         DC    XL16'00000000000000000000000000000000' F0-FF                     
         EJECT ,                                                                
***********************************************************************         
* Valid extentions                                                              
***********************************************************************         
EXTMATRX DC    AL1(2,EXT2Q),AL2(EXT2-EXTTAB)                                    
         DC    AL1(3,EXT3Q),AL2(EXT3-EXTTAB)                                    
         DC    AL1(4,EXT4Q),AL2(EXT4-EXTTAB)                                    
         DC    AL1(6,EXT6Q),AL2(EXT6-EXTTAB)                                    
         DC    AL1(EOT)                                                         
*---------------------------------------------------------------------*         
EXTTAB   DS    0C                                                               
EXT2     DC    C'TV'               Small island of Tuvalu in the South          
         DC    C'CC'               Clear channel comummunications, US           
         DC    C'FM'               broadcasting and Internet Industries         
EXT2Q    EQU   (*-EXT2)/2                                                       
                                                                                
EXT3     DC    C'COM'              Most common-US                               
         DC    C'NET'              2nd most common-US                           
         DC    C'ORG'              Non-profit organizations                     
         DC    C'BIZ'              For business and Corporations                
         DC    C'PRO'              Professionals, lawyers, medical, etc         
         DC    C'GOV'              US Government                                
         DC    C'EDU'              Education                                    
EXT3Q    EQU   (*-EXT3)/3                                                       
                                                                                
EXT4     DC    C'INFO'             newspapers, magazines, etc.                  
         DC    C'AERO'             air travel such as airlines                  
         DC    C'NAME'             individuals or personal web sites            
         DC    C'COOP'             co-operative organizations                   
EXT4Q    EQU   (*-EXT4)/4                                                       
                                                                                
EXT6     DC    C'MUSEUM'            museums, archival and exhibit               
EXT6Q    EQU   (*-EXT6)/6                                                       
         EJECT ,                                                                
***********************************************************************         
* Specail country table.                                              *         
* Each line represents a letter of the alphabet and 1st letter of     *         
*    the extension. The letter in the table represents the vaild 2nd  *         
*    letter extension                                                 *         
* See below this table for all the valid entries and what they are    *         
***********************************************************************         
COUNTRY  DC    C'   DEFG I  LMNO QRSTU W  Z'          A                         
         DC    C'AB DEFGHIJ  MNO  RST VW YZ'          B                         
         DC    C'A CD FGHI KLMNO  R  UV XYZ'          C                         
         DC    C'    E    JK M O          Z'          D                         
         DC    C'  C E GH         RST      '          E                         
         DC    C'        IJK M O  R        '          F                         
         DC    C'AB DEF HI  LMN PQRSTU W Y '          G                         
         DC    C'          K MN   R TU     '          H                         
         DC    C'   DE      L NO QRST      '          I                         
         DC    C'            M OP          '          J                         
         DC    C'    E GHI   MN P R    W YZ'          K                         
         DC    C'ABC     I K      RSTUV  Y '          L                         
         DC    C'A CDE GH  KLMNOPQRSTUVWXYZ'          M                         
         DC    C'A C EFG I  L  OP R  U    Z'          N                         
         DC    C'            M             '          O                         
         DC    C'A   EFGH  KLMN   RST  W Y '          P                         
         DC    C'A                         '          Q                         
         DC    C'    E         O     U W   '          R                         
         DC    C'ABCDE GHIJKLMNO  R T V  YZ'          S                         
         DC    C'  CD FGH JK MNOP R T VW  Z'          T                         
         DC    C'A     G   K M     S     YZ'          U                         
         DC    C'A C E G I    N      U     '          V                         
         DC    C'     F            S       '          W                         
         DC    C'                          '          X                         
         DC    C'    E              TU     '          Y                         
         DC    C'A           M         W   '          Z                         
         EJECT ,                                                                
*&&DO                                                                           
CNTRTAB  DS    0D                                                               
CNTR_A   DC    C'AD'               ANDORRA                                      
         DC    C'AE'               UNITED ARAB EMIRATES                         
         DC    C'AF'               AFGHANISTAN                                  
         DC    C'AG'               ANTIGUA AND BARBUDA                          
         DC    C'AI'               ANGUILLA                                     
         DC    C'AL'               ALBANIA                                      
         DC    C'AM'               ARMENIA                                      
         DC    C'AN'               NETHERLANDS ANTILLES                         
         DC    C'AO'               ANGOLA                                       
         DC    C'AQ'               ANTARCTICA                                   
         DC    C'AR'               ARGENTINA                                    
         DC    C'AS'               AMERICAN SAMOA                               
         DC    C'AT'               AUSTRIA                                      
         DC    C'AU'               AUSTRALIA                                    
         DC    C'AW'               ARUBA                                        
         DC    C'AZ'               AZERBAIJAN                                   
CNTR_AQ  EQU   (*-CNTR_A)/2                                                     
                                                                                
CNTR_B   DC    C'BA'               BOSNIA AND HERZEGOVINA                       
         DC    C'BB'               BARBADOS                                     
         DC    C'BD'               BANGLADESH                                   
         DC    C'BE'               BELGIUM                                      
         DC    C'BF'               BURKINA FASO                                 
         DC    C'BG'               BULGARIA                                     
         DC    C'BH'               BAHRAIN                                      
         DC    C'BI'               BURUNDI                                      
         DC    C'BJ'               BENIN                                        
         DC    C'BM'               BERMUDA                                      
         DC    C'BN'               BRUNEI DARUSSALAM                            
         DC    C'BO'               BOLIVIA                                      
         DC    C'BR'               BRAZIL                                       
         DC    C'BS'               BAHAMAS                                      
         DC    C'BT'               BHUTAN                                       
         DC    C'BV'               BOUVET ISLAND                                
         DC    C'BW'               BOTSWANA                                     
         DC    C'BY'               BELARUS                                      
         DC    C'BZ'               BELIZE                                       
CNTR_BQ  EQU   (*-CNTR_B)/2                                                     
                                                                                
CNTR_C   DC    C'CA'                CANADA                                      
         DC    C'CC'                COCOS (KEELING) ISLANDS                     
         DC    C'CD'                THE DEMOCRATIC REPUBLIC OF CANGO            
         DC    C'CF'                CENTRAL AFRICAN REPUBLIC                    
         DC    C'CG'                CONGO                                       
         DC    C'CH'                SWITZERLAND                                 
         DC    C'CI'                CTE D'IVOIRE                               
         DC    C'CK'                COOK ISLANDS                                
         DC    C'CL'                CHILE                                       
         DC    C'CM'                CAMEROON                                    
         DC    C'CN'                CHINA                                       
         DC    C'CO'                COLOMBIA                                    
         DC    C'CR'                COSTA RICA                                  
         DC    C'CU'                CUBA                                        
         DC    C'CV'                CAPE VERDE                                  
         DC    C'CX'                CHRISTMAS ISLAND                            
         DC    C'CY'                CYPRUS                                      
         DC    C'CZ'                CZECH REPUBLIC                              
CNTR_CQ  EQU   (*-CNTR_C)/2                                                     
                                                                                
CNTR_D   DC    C'DE'               GERMANY                                      
         DC    C'DJ'               DJIBOUTI                                     
         DC    C'DK'               DENMARK                                      
         DC    C'DM'               DOMINICA                                     
         DC    C'DO'               DOMINICAN REPUBLIC                           
         DC    C'DZ'               ALGERIA                                      
CNTR_DQ  EQU   (*-CNTR_D)/2                                                     
                                                                                
CNTR_E   DC    C'EC'               ECUADOR                                      
         DC    C'EE'               ESTONIA                                      
         DC    C'EG'               EGYPT                                        
         DC    C'EH'               WESTERN SAHARA                               
         DC    C'ER'               ERITREA                                      
         DC    C'ES'               SPAIN                                        
         DC    C'ET'               ETHIOPIA                                     
CNTR_EQ  EQU   (*-CNTR_E)/2                                                     
                                                                                
CNTR_F   DC    C'FI'               FINLAND                                      
         DC    C'FJ'               FIJI                                         
         DC    C'FK'               FALKLAND ISLANDS (MALVINAS)                  
         DC    C'FM'               MICRONESIA, FEDERATED STATES OF              
         DC    C'FO'               FAROE ISLANDS                                
         DC    C'FR'               FRANCE                                       
CNTR_FQ  EQU   (*-CNTR_F)/2                                                     
                                                                                
CNTR_G   DC    C'GA'               GABON                                        
         DC    C'GB'               UNITED KINGDOM                               
         DC    C'GD'               GRENADA                                      
         DC    C'GE'               GEORGIA                                      
         DC    C'GF'               FRENCH GUIANA                                
         DC    C'GH'               GHANA                                        
         DC    C'GI'               GIBRALTAR                                    
         DC    C'GL'               GREENLAND                                    
         DC    C'GM'               GAMBIA                                       
         DC    C'GN'               GUINEA                                       
         DC    C'GP'               GUADELOUPE                                   
         DC    C'GQ'               EQUATORIAL GUINEA                            
         DC    C'GR'               GREECE                                       
         DC    C'GS'       SOUTH GEORGIA AND THE SOUTH SANDWICH ISLANDS         
         DC    C'GT'               GUATEMALA                                    
         DC    C'GU'               GUAM                                         
         DC    C'GW'               GUINEA-BISSAU                                
         DC    C'GY'               GUYANA                                       
CNTR_GQ  EQU   (*-CNTR_G)/2                                                     
                                                                                
CNTR_H   DC    C'HK'               HONG KONG                                    
         DC    C'HM'               HEARD ISLAND AND MCDONALD ISLANDS            
         DC    C'HN'               HONDURAS                                     
         DC    C'HR'               CROATIA                                      
         DC    C'HT'               HAITI                                        
         DC    C'HU'               HUNGARY                                      
CNTR_HQ  EQU   (*-CNTR_H)/2                                                     
                                                                                
CNTR_I   DC    C'ID'               INDONESIA                                    
         DC    C'IE'               IRELAND                                      
         DC    C'IL'               ISRAEL                                       
         DC    C'IN'               INDIA                                        
         DC    C'IO'               BRITISH INDIAN OCEAN TERRITORY               
         DC    C'IQ'               IRAQ                                         
         DC    C'IR'               IRAN, ISLAMIC REPUBLIC OF                    
         DC    C'IS'               ICELAND                                      
         DC    C'IT'               ITALY                                        
CNTR_IQ  EQU   (*-CNTR_I)/2                                                     
                                                                                
CNTR_J   DC    C'JM'               JAMAICA                                      
         DC    C'JO'               JORDAN                                       
         DC    C'JP'               JAPAN                                        
CNTR_JQ  EQU   (*-CNTR_J)/2                                                     
                                                                                
CNTR_K   DC    C'KE'               KENYA                                        
         DC    C'KG'               KYRGYZSTAN                                   
         DC    C'KH'               CAMBODIA                                     
         DC    C'KI'               KIRIBATI                                     
         DC    C'KM'               COMOROS                                      
         DC    C'KN'               SAINT KITTS AND NEVIS                        
         DC    C'KP'               DEMOCRATIC PEOPLES REPUBLIC OF KOREA         
         DC    C'KR'               REPUBLIC OF KOREA                            
         DC    C'KW'               KUWAIT                                       
         DC    C'KY'               CAYMAN ISLANDS                               
         DC    C'KZ'               KAZAKSTAN                                    
CNTR_KQ  EQU   (*-CNTR_K)/2                                                     
                                                                                
CNTR_L   DC    C'LA'               LAO PEOPLE'S DEMOCRATIC REPUBLIC             
         DC    C'LB'               LEBANON                                      
         DC    C'LC'               SAINT LUCIA                                  
         DC    C'LI'               LIECHTENSTEIN                                
         DC    C'LK'               SRI LANKA                                    
         DC    C'LV'               LATVIA                                       
         DC    C'LR'               LIBERIA                                      
         DC    C'LS'               LESOTHO                                      
         DC    C'LT'               LITHUANIA                                    
         DC    C'LU'               LUXEMBOURG                                   
         DC    C'LY'               LIBYAN ARAB JAMAHIRIYA  LY                   
CNTR_LQ  EQU   (*-CNTR_L)/2                                                     
                                                                                
CNTR_M   DC    C'MA'               MOROCCO                                      
         DC    C'MC'               MONACO                                       
         DC    C'MD'               MOLDAVIA, REPUBLIC OF                        
         DC    C'ME'               MONTENEGRO                                   
         DC    C'MG'               MADAGASCAR                                   
         DC    C'MH'               MARSHALL ISLANDS                             
         DC    C'MK'        MACEDONIA, THE FORMER YUGOSLAV REPUBLIC OF          
         DC    C'ML'               MALI                                         
         DC    C'MM'               MYANMAR                                      
         DC    C'MN'               MONGOLIA                                     
         DC    C'MO'               MACAU                                        
         DC    C'MP'               NORTHERN MARIANA ISLANDS                     
         DC    C'MQ'               MARTINIQUE                                   
         DC    C'MR'               MAURITANIA                                   
         DC    C'MS'               MONTSERRAT                                   
         DC    C'MT'               MALTA                                        
         DC    C'MU'               MAURITIUS                                    
         DC    C'MV'               MALDIVES                                     
         DC    C'MW'               MALAWI                                       
         DC    C'MX'               MEXICO                                       
         DC    C'MY'               MALAYSIA                                     
         DC    C'MZ'               MOZAMBIQUE                                   
CNTR_MQ  EQU   (*-CNTR_M)/2                                                     
                                                                                
CNTR_N   DC    C'NA'               NAMIBIA                                      
         DC    C'NC'               NEW CALEDONIA                                
         DC    C'NE'               NIGER                                        
         DC    C'NF'               NORFOLK ISLAND                               
         DC    C'NG'               NIGERIA                                      
         DC    C'NI'               NICARAGUA                                    
         DC    C'NL'               NETHERLANDS                                  
         DC    C'NO'               NORWAY                                       
         DC    C'NP'               NEPAL                                        
         DC    C'NR'               NAURU                                        
         DC    C'NU'               NIUE                                         
         DC    C'NZ'               NEW ZEALAND                                  
CNTR_NQ  EQU   (*-CNTR_N)/2                                                     
                                                                                
CNTR_O   DC    C'OM'               OMAN                                         
CNTR_OQ  EQU   (*-CNTR_O)/2                                                     
                                                                                
CNTR_P   DC    C'PA'               PANAMA                                       
         DC    C'PE'               PERU                                         
         DC    C'PF'               FRENCH POLYNESIA                             
         DC    C'PG'               PAPUA NEW GUINEA                             
         DC    C'PH'               PHILIPPINES                                  
         DC    C'PK'               PAKISTAN                                     
         DC    C'PL'               POLAND                                       
         DC    C'PM'               SAINT PIERRE AND MIQUELON                    
         DC    C'PN'               PITCAIRN                                     
         DC    C'PR'               PUERTO RICO                                  
         DC    C'PS'               PALESTINIAN TERRITORY, OCCUPIED  PS          
         DC    C'PT'               PORTUGAL                                     
         DC    C'PW'               PALAU                                        
         DC    C'PY'               PARAGUAY                                     
CNTR_PQ  EQU   (*-CNTR_P)/2                                                     
                                                                                
CNTR_Q   DC    C'QA'               QATAR                                        
CNTR_QQ  EQU   (*-CNTR_Q)/2                                                     
                                                                                
CNTR_R   DC    C'RE'               RUNION                                      
         DC    C'RO'               ROMANIA                                      
         DC    C'RU'               RUSSIAN FEDERATION                           
         DC    C'RW'               RWANDA                                       
CNTR_RQ  EQU   (*-CNTR_R)/2                                                     
                                                                                
CNTR_S   DC    C'SA'               SAUDI ARABIA                                 
         DC    C'SB'               SOLOMON ISLANDS                              
         DC    C'SC'               SEYCHELLES                                   
         DC    C'SD'               SUDAN                                        
         DC    C'SE'               SWEDEN                                       
         DC    C'SG'               SINGAPORE                                    
         DC    C'SH'               SAINT HELENA                                 
         DC    C'SI'               SLOVENIA                                     
         DC    C'SJ'               SVALBARD AND JAN MAYEN  SJ                   
         DC    C'SK'               SLOVAKIA                                     
         DC    C'SL'               SIERRA LEONE                                 
         DC    C'SM'               SAN MARINO                                   
         DC    C'SN'               SENEGAL                                      
         DC    C'SO'               SOMALIA                                      
         DC    C'SR'               SURINAME                                     
         DC    C'ST'               SAO TOME AND PRINCIPE                        
         DC    C'SV'               EL SALVADOR                                  
         DC    C'SY'               SYRIAN ARAB REPUBLIC                         
         DC    C'SZ'               SWAZILAND                                    
CNTR_SQ  EQU   (*-CNTR_S)/2                                                     
                                                                                
CNTR_T   DC    C'TC'               TURKS AND CAICOS ISLANDS                     
         DC    C'TD'               CHAD                                         
         DC    C'TF'               FRENCH SOUTHERN TERRITORIES                  
         DC    C'TG'               TOGO                                         
         DC    C'TH'               THAILAND                                     
         DC    C'TJ'               TAJIKISTAN                                   
         DC    C'TK'               TOKELAU                                      
         DC    C'TM'               TURKMENISTAN                                 
         DC    C'TN'               TUNISIA                                      
         DC    C'TO'               TONGA                                        
         DC    C'TP'               EAST TIMOR                                   
         DC    C'TR'               TURKEY                                       
         DC    C'TT'               TRINIDAD AND TOBAGO                          
         DC    C'TV'               TUVALU                                       
         DC    C'TW'               TAIWAN, PROVINCE OF CHINA                    
         DC    C'TZ'               TANZANIA, UNITED REPUBLIC OF                 
CNTR_TQ  EQU   (*-CNTR_T)/2                                                     
                                                                                
CNTR_U   DC    C'UA'               UKRAINE                                      
         DC    C'UG'               UGANDA                                       
         DC    C'UK'               United Kingdom                               
         DC    C'UM'               UNITED STATES MINOR OUTLYING ISLANDS         
         DC    C'US'               UNITED STATES                                
         DC    C'UY'               URUGUAY                                      
         DC    C'UZ'               UZBEKISTAN                                   
CNTR_UQ  EQU   (*-CNTR_U)/2                                                     
                                                                                
CNTR_V   DC    C'VA'               HOLY SEE (VATICAN CITY STATE)                
         DC    C'VC'               SAINT VINCENT AND THE GRENADINES             
         DC    C'VE'               VENEZUELA                                    
         DC    C'VG'               VIRGIN ISLANDS, BRITISH                      
         DC    C'VI'               VIRGIN ISLANDS, U.S.                         
         DC    C'VN'               VIETNAM                                      
         DC    C'VU'               VANUATU                                      
CNTR_VQ  EQU   (*-CNTR_V)/2                                                     
                                                                                
CNTR_W   DC    C'WF'               WALLIS AND FUTUNA                            
         DC    C'WS'               SAMOA                                        
CNTR_WQ  EQU   (*-CNTR_W)/2                                                     
                                                                                
CNTR_Y   DC    C'YE'               YEMEN                                        
         DC    C'YT'               MAYOTTE                                      
         DC    C'YU'               YUGOSLAVIA                                   
CNTR_YQ  EQU   (*-CNTR_Y)/2                                                     
                                                                                
CNTR_Z   DC    C'ZA'               SOUTH AFRICA                                 
         DC    C'ZM'               ZAMBIA                                       
         DC    C'ZW'               ZIMBABWE                                     
CNTR_ZQ  EQU   (*-CNTR_Z)/2                                                     
*&&                                                                             
*                                                                               
       ++INCLUDE FACTRYXLAT                                                     
       ++INCLUDE DDFLDHDR                                                       
       ++INCLUDE GEGENDOM                                                       
*                                                                               
***********************************************************************         
* Local working storage                                                         
***********************************************************************         
EMAILD   DSECT                                                                  
YES      EQU   C'Y'                                                             
NO       EQU   C'N'                                                             
EOT      EQU   X'FF'                                                            
TURNOFF  EQU   X'FF'                                                            
                                                                                
ARELO    DS    A                                                                
AUCASE   DS    A                                                                
APARMS   DS    A                                                                
PARMS    DS    0F                                                               
P1       DS    F                                                                
P2       DS    F                                                                
P3       DS    F                                                                
P4       DS    F                                                                
P5       DS    F                                                                
P6       DS    F                                                                
PARMLNQ  EQU   *-PARMS                                                          
                                                                                
ADOMAIN  DS    A                   Start of the Domain                          
LDOMAIN  DS    F                   Length of the Domain                         
                                                                                
FLEN     DS    XL1                                                              
ISPERIOD DS    CL1                 Yes/No                                       
CTRYCODE DS    CL2                 Save off country code                        
TRTAB    DS    XL256                                                            
ERROR#   DS    X                                                                
ERRNONE  EQU   0                   No errors                                    
ERRNOINP EQU   1                   No input                                     
ERRICHAR EQU   2                   Invalid character                            
ERRNO@   EQU   3                   No @ sign                                    
ERRNOPRD EQU   4                   No . sign                                    
ERRMEXT  EQU   5                   Missing extension                            
ERRIEXT  EQU   6                   Invalid extension                            
ERRICTRY EQU   7                   Invalid country extension                    
ERR2MANY EQU   8                   Too many @                                   
ERRIDOM  EQU   9                   Invalid Domain                               
EMAILQ   EQU   *-EMAILD                                                         
                                                                                
EMATRIXD DSECT                                                                  
EMXLEN   DS    AL1                 Length of extension                          
EMX#OF   DS    AL1                 Number of entries in table                   
EMXDISP  DS    AL2                 Displacement to table                        
EMXLNQ   EQU   *-EMATRIXD                                                       
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'006DDVEMAIL  05/15/20'                                      
         END                                                                    

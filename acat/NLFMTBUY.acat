*          DATA SET NLFMTBUY   AT LEVEL 036 AS OF 06/05/12                      
*CATALP NLFMTBUY                                                                
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         TITLE 'INSERTION ORDERS - BUY DESCRIPTION'                             
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* KWAN 06/05/12 CHECK COLUMN DATA FOR SPACES BEFORE CALLING CHOPPER             
*                                                                               
* SMYE 04/12/07 INCLUDE STANDARD COLUMNS IN CCOLRTN                             
*                                                                               
* SMYE  06/05   UNCONDITIONALLY SHOW AD ID IN PLACE OF ADCODE (AD NO)           
*                                                                               
* SMYE  01/05   CONDITIONALLY SHOW AD ID IN PLACE OF ADCODE (AD NO)             
*                                                                               
* SMYE  03/04   SHOW CUSTOM COLUMNS (CCOLRTN)                                   
*                                                                               
* KWAN 05/02/02 SHOW INTERNET SITE LOCATION (REGCOMM)                           
*                                                                               
* KWAN 04/16/02 SHOW ADDITIONAL CHARGES (ACHARGE)                               
*                                                                               
* KWAN 08/22/01 REGIONAL COMMENTS (X'66' AND BEGIN WITH REG=)                   
*                                                                               
* KWAN 06/25/01 ROUTINE FOR LEGAL WARNING & QUARTERLY COMMENT CODES             
*                                                                               
* KWAN 02/05/01 PRINT EXT DAYS OR EXT DATE AFTER MAT CLOSE DATE                 
*                                                                               
* BPLA 11/00    FIX ANOTHER BUG IN BLDCTAB                                      
*                                                                               
* BPLA 10/00    DON'T SAVE "REAL" PBDELEM IN SPACEND                            
*               THAT MAY BE CLOBBERED IN BLDCTAB                                
*                                                                               
* BPLA 09/00    TAXOPT AND DSPOPT CODE                                          
*                                                                               
* BPLA 06/00    NEW P72B PROFILE AOPTION (AIMPSOPT) DISPLAY OF AIMPS?           
*                                                                               
* BPLA 06/00    NOW LIVE SOURCE (WAS NLFMTBUB) CATALP AND ++INCL T413           
*                                                                               
* BPLA 02/00    COPY OF NLFMTBUY AT LEVEL 59 MADE FEB04/00                      
*               MULTIPLE AD CODE CHANGES T413WKAB FOR T413WKA                   
*                                                                               
* SMYE 04/16/99 "JULJUI" CHANGED TO "JULJUL" IN DATETAB AND BDATETAB            
*                                                                               
* SMYE 04/99    ADD IMPRESSION DISPLAY (LIKE CLICK THRUS)                       
*                                                                               
* BPLA 02/99    NEW PVCTOPT TO SUPPRESS THE NEW PAGEVIEW                        
*               AND CLICK-THRU DATA DISPLAY                                     
*                                                                               
* BPLA 01/99    NEW VALUE ($) FOR ACOPT AND CDOPT TO                            
*               SHOW AMOUNTS RATHER THAN PERCENTAGES (Y)                        
*               ALSO NOW DISPLAY PAGEVIEW AND CLICK THRU DATA                   
*                                                                               
* BPLA 12/98    CHANGE CLOOPT TO "SPACE CLOSING"                                
*               AND SHOW BEFORE MATERIALS CLOSING DATE                          
*                                                                               
* BPLA 10/98    NEW OPTIONS DOWOPT - SHOW DAY OF WEEK                           
*                           CLOOPT - SHOW CLOSING DATE                          
*               NEW VALUE FOR COSTOPT - B TO SHOW BOTH GROSS AND NET            
*                                                                               
* BPLA 11/95    CHANGES FOR IO'S IN FRENCH                                      
*                                                                               
* BPLA 11/11/93 NEW OPTION TO PRINT ON-SALE DATE (ONSOPT)                       
*               ALSO MOVE MAT CLOSE AND ON-SALE AFTER ZONE                      
*                                                                               
* BPLA 02/02/93 DISPLAY REF ELEM DATA (X'83')                                   
*                                                                               
* BPLA 12/30/92 DISPLAY FSI DATA                                                
*                                                                               
* BPLA 07/31/92 FIX BUG PJOBCAP2 WAS CLOBBERING COMMENT FROM                    
*               FNDIOC                                                          
*                                                                               
* BPLA 04/24/92 CHANGES TO NOT CHOP IC= AND PI= COMMENTS                        
*                                                                               
* BPLA 04/14/92 CHANGES FOR LARGE IC= COMMENTS                                  
*                                                                               
* BPLA 02/03/92 NEW OPTIONS FORM P72A PROFILE - ACOPT AND CDOPT                 
*                                                                               
* BPLA 01/22/92 TREAT "S" RATE BUYS AS NET                                      
*                                                                               
* BPLA 01/21/92 VALUES FOR COSTOPT REDONE AGAIN                                 
*               "Y" (OLD) NOW WORKS LIKE "I" DID                                
*               "N" (OLD) NO CHANGE                                             
*               "T" (NEW) ALWAYS SHOW NET                                       
*               "G" (NEW) ALWAYS SHOW GROSS                                     
*                                                                               
* BPLA 01/20/92 RE-ADD VALUE "I" FOR COSTOPT - SHOW (NET)                       
*               ONLY IF INPUT AS NET                                            
*                                                                               
* BPLA 12/16/91 NEW MEANING FOR COSTOPT                                         
*               "Y" NOW MEANS SHOW GROSS AND INDICATE WITH (GROSS)              
*               "T" (NEW) MEANS SHOW NET AND INDICATE WITH (NET)                
*                                                                               
* BPLA 09/20/91 YET ANOTHER VALUE FOR COSTOPT - "H" MEANS NET COST              
*               AND (NET) FOR ALL INSERTIONS                                    
* BPLA 08/30/91 NEW VALUE FOR COSTOPT - "I" MEANS ADD (NET)                     
*               WHEN DISPLAYING INSERTIONS BOUGHT AS NET - THEY                 
*               PREVIOUSLY SHOWED NET COST WITH NO INDICATOR                    
*                                                                               
* ROSA 03/28/91 CORRECT ERROR IN CHOPPER                                        
*                                                                               
* ROSA 01/18/91 ALLOW PRINTING OF MILLIONS IN COST                              
*                                                                               
* ROSA 07/24/90 COPY DITTO LOGIC INCORRECTLY CLEARING OUT MATERIAL              
*               CLOSING COMMENT                                                 
*                                                                               
* ROSA 12/14/89 PRINT MATERIALS CLOSING DATE                                    
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FMTBUY   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,FMTBUY,RR=R5                                                   
*                                                                               
         ST    R5,RELO                                                          
         B     *+8                                                              
RELO     DC    F'0'                                                             
*                                                                               
         USING POLWRKD,R9                                                       
         USING T413FFD,RA                                                       
         USING IOWORKD,R8                                                       
         L     RC,PPFILEC                                                       
         USING POLFILED,RC                                                      
*                                                                               
         L     R5,=V(CHOPPER)                                                   
         A     R5,RELO                                                          
         ST    R5,ACHOPPER                                                      
*                                                                               
         L     R5,=A(DICSECTF)                                                  
         A     R5,RELO                                                          
         USING DICSECTF,R5                                                      
         XC    DMCB,DMCB                                                        
         LA    R1,DMCB                                                          
         USING DICTATED,R1                                                      
         MVI   DDACTN,DDACTNL      TRANSLATE LIST                               
         MVI   DDRETN,DDCASEU                                                   
         MVI   DDSYS,4                                                          
         MVI   DDLANG,0            DEFAULT TO ENGLISH                           
*                                                                               
         CLI   LANG,C'F'           FRENCH?                                      
         BNE   *+8                                                              
         MVI   DDLANG,4                                                         
*                                                                               
         LA    RF,DCLIST                                                        
         STCM  RF,7,DDIADR                                                      
         LA    RF,DSLIST                                                        
         STCM  RF,7,DDOADR                                                      
         L     RF,VCOMFACS                                                      
         USING COMFACSD,RF                                                      
*                                                                               
         GOTO1 CDICTATE                                                         
*                                                                               
         DROP  R1,R5,RF                                                         
*                                                                               
         L     R6,=A(DICSECTF)                                                  
         A     R6,RELO                                                          
         USING DICSECTF,R6                                                      
*                                                                               
         BRAS  RE,LEGALW           LOOK UP LW AND QU COMMENT CODES              
*                                                                               
         MVC   THISBUY,SPACES                                                   
         L     R2,LASTIOEL                                                      
         USING PIOELEM,R2                                                       
         CLI   CHANGSW,C'D'                                                     
         BNE   FB2                                                              
*                                                                               
* IF DELETE USE LAST IO ELEM                                                    
* - MOVE FIELDS INTO PBDELEM                                                    
* - SAVE REAL  PBDELEM                                                          
*                                                                               
         LA    R4,SAVEBEL                                                       
         MVC   0(256,R4),PBDELEM                                                
         MVC   PBDSPACE,PIOSPACE                                                
         CLI   QMEDIA,C'N'                                                      
         BNE   FB2                                                              
         MVC   PBDCL,PIOPRM                                                     
         ZAP   PBDUNITS,PIOUNITS                                                
         ZAP   PBDCLMS,PIOCLMS                                                  
         MVC   PBDUIND,PIOUIND                                                  
         MVC   PBDSPACE(6),PIOSAU                                               
         XC    PBDSPACE+6(11),PBDSPACE+6                                        
         OC    PBDSPACE,SPACES                                                  
*                                                                               
FB2      DS    0H                                                               
         MVC   DAYOFWK,SPACES                                                   
         CLI   DOWOPT,C'Y'         SEE IF SHOWING DAY OF WEEK                   
         BNE   FB2X                                                             
         CLI   PBDFREQ,C'M'                                                     
         BE    FB2X                                                             
         CLI   PBDBFD,C'B'         DON'T DO FOR BEST FOOD DAY                   
         BE    FB2X                                                             
         CLI   PBDBFD,C'W'         OR WEEK OF                                   
         BE    FB2X                                                             
         GOTO1 DATCON,DMCB,(3,PBUYKDAT),(0,WORK)                                
         GOTO1 GETDAY,DMCB,WORK,WORK+6                                          
         MVC   DAYOFWK,WORK+6                                                   
         CLI   LANG,C'F'           FRENCH I/O?                                  
         BNE   FB2X                                                             
         BAS   RE,BFRDAY                                                        
         MVC   DAYOFWK,WORK+6      FRENCH DAY OF WEEK                           
*                                                                               
FB2X     DS    0H                                                               
         LA    R7,BUYOUTA                                                       
         USING PPBYOUTD,R7                                                      
         XC    PBYOINPT(24),PBYOINPT                                            
         LA    R3,PBUYREC                                                       
         L     R4,DATCON                                                        
         LA    R5,GROSS                                                         
         STM   R3,R5,PBYOINPT                                                   
         OI    PBYOCTL,X'03'       NO LINE NO. + NET RATES                      
*                                                                               
         CLI   LANG,C'F'           SEE IF FRENCH LANG I/O                       
         BNE   *+8                                                              
         OI    PBYOCLT2,X'40'      FRENCH DATA                                  
*                                                                               
         MVC   SVCTYP,PBDCTYP      SAVE REAL COST TYPE                          
         MVI   NETSW,C'N'                                                       
         CLI   COSTOPT,C'Y'        SHOWING NET ONLY IF INPUT AS NET?            
         BNE   FB3A2                                                            
         CLI   PBDCOSIN,C'S'       SHOW NET FOR "S" RATE BUYS?                  
         BE    FB3A1                                                            
         CLI   PBDCTYP,C'N'                                                     
         BNE   FB3A8                                                            
FB3A1    MVI   NETSW,C'Y'                                                       
         B     FB3A8                                                            
*                                                                               
FB3A2    CLI   COSTOPT,C'T'        SEE IF SHOWING NET                           
         BNE   FB3A4                                                            
FB3A3    MVI   PBDCTYP,C'N'        FOOL PPBYOUT TO RETURN NET RATE              
         MVI   NETSW,C'Y'                                                       
         B     FB3A8                                                            
*                                                                               
FB3A4    DS    0H                                                               
         CLI   COSTOPT,C'B'        SHOWING GROSS AND NET?                       
         BE    FB3A5                                                            
         CLI   COSTOPT,C'B'        SEE IF SHOWING GROSS                         
         BNE   *+8                                                              
FB3A5    MVI   PBDCTYP,C' '        FOOL PPBYOUT TO RETURN GROSS RATE            
*                                                                               
FB3A8    GOTO1 APPBYOUT,DMCB,BUYOUTA                                            
*                                                                               
         MVC   PBDCTYP,SVCTYP      RESTORE SAVED COST TYPE                      
*                                                                               
         IC    RF,LINE                                                          
         LA    RF,8(RF)                                                         
         STC   RF,BYTE                                                          
         CLC   BYTE,MAXLINES                                                    
         BL    *+10                                                             
         XC    LASTBUY,LASTBUY                                                  
*                                                                               
         OC    LASTBUY,LASTBUY                                                  
         BNZ   FB3A15                                                           
*--->    MVC   P(80),BUYHD1                                                     
*--->    MVC   PSECOND(80),BUYHD2                                               
         MVC   P(L'PP@IOF1),PP@IOF1                                             
         MVC   PSECOND(L'PP@IOF2),PP@IOF2                                       
*                                                                               
         CLI   COPYOPT,C'Y'        SUPPRESSING COPY?                            
         BNE   FB3A12                                                           
         MVC   P+33(11),SPACES                                                  
         MVC   PSECOND+33(11),SPACES                                            
*                                                                               
FB3A12   CLI   QMEDIA,C'O'                                                      
         BNE   FB3A12C                                                          
*--->    MVC   P+1(11),=C'  DATE     '                                          
*--->    MVC   PSECOND+9(3),SPACES                                              
         MVC   P+1(13),SPACES                                                   
         MVC   PSECOND+1(13),SPACES                                             
         MVC   P+3(L'PP@DATE),PP@DATE                                           
         MVC   PSECOND+3(L'PP@DATE),DASHES                                      
FB3A12C  MVI   LINENEED,8                                                       
         B     FB3A18                                                           
*                                                                               
FB3A15   MVI   LINENEED,6                                                       
FB3A18   GOTO1 AIOPRNT                                                          
         CLI   PBDBFD,C'W'                                                      
         BNE   FB3B                                                             
*--->    MVC   P+1(9),=C'WEEK OF -'                                             
         MVC   P+1(L'PP@WKOF),PP@WKOF                                           
         B     FB3B10                                                           
*                                                                               
FB3B     CLI   PBDBFD,C'B'                                                      
         BNE   FB3D                                                             
*--->    MVC   P+1(13),=C'BEST FOOD DAY'                                        
*--->    MVC   PSECOND+1(9),=C'WEEK OF -'                                       
         MVC   P+1(L'PP@BFD),PP@BFD                                             
         MVC   PSECOND+1(L'PP@WKOF),PP@WKOF                                     
*                                                                               
FB3B10   DS    0H                                                               
         GOTO1 AIOPRNT                                                          
*                                                                               
FB3D     DS    0H                                                               
         MVI   LINENEED,3                                                       
         CLI   CHANGSW,C'D'                                                     
         BNE   FB3D10                                                           
         LA    R5,PIOIDATE                                                      
         GOTO1 DATCON,DMCB,(3,0(R5)),(5,WORK)                                   
*                                                                               
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BAS   RE,FRDATE                                                        
*                                                                               
         MVC   P+1(8),WORK         MMMDD/YY                                     
         CLI   PBDFREQ,C'M'                                                     
         BNE   *+10                                                             
         MVC   P+4(5),P+6          MMM/YY                                       
         B     FB3D10B             THEN DO 2ND DATE IF ANY                      
*                                  (NOTE - 2ND DATE FROM CURRENT REC)           
FB3D10   DS    0H                                                               
         MVC   WORK(8),PBYOMDY                                                  
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BAS   RE,FRDATE                                                        
*                                                                               
         MVC   P+1(8),WORK                                                      
*                                                                               
FB3D10B  DS    0H                                                               
         CLI   PBYOMDY2,C' '                                                    
         BE    FB3D20                                                           
         MVI   PSECOND+1,C'-'                                                   
         MVC   WORK(8),PBYOMDY2                                                 
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BAS   RE,FRDATE                                                        
         MVC   PSECOND+2(8),WORK                                                
*                                                                               
         CLI   QMEDIA,C'N'         MMM/YY, -MMM/YY FOR NON-NEWS?                
         BNE   FB3D25                                                           
         MVI   PSECOND,C'+'                                                     
         MVC   PSECOND+1(8),WORK                                                
         MVI   PSECOND+9,C' '                                                   
         CLI   PBUYKLIN,1          LINE 1?                                      
         BH    *+16                                                             
*                                  SET E/M INDS                                 
         MVC   P+9(2),PBYOINS+5                                                 
         MVC   PSECOND+9(2),PBYOINS2+5                                          
         B     FB3D25                                                           
*                                                                               
FB3D20   DS    0H                                                               
         CLC   PBYOISNM,SPACES                                                  
         BE    FB3D25                                                           
         MVC   PSECOND+2(11),PBYOISNM                                           
         B     FB3D25                                                           
*                                                                               
FB3D25   DS    0H                  SPACE/LINES                                  
         BRAS  RE,BLDCTAB                                                       
*                                                                               
         CLI   QMEDIA,C'N'                                                      
         BNE   FB3D30                                                           
*                                  NON-NEWS SPACES                              
         CLI   PBYOSPC,C' '                                                     
         BE    FB4                                                              
*                                                                               
* FOR OUTDORR PAINT AND ROTARY, USED TO SUPPRESS PBYOSPC DISPLAY                
*                                                                               
FB3D30   DS    0H                                                               
         MVC   P+15(17),PBYOSPC                                                 
         MVC   PSECOND+15(20),PBYOSPC2                                          
         CLI   QMEDIA,C'N'                                                      
         BNE   FB3F10                                                           
         CLI   PBDCL,C' '                                                       
         BNH   FB3F10                                                           
         LA    R3,PSECOND+15                                                    
         CLI   0(R3),C' '                                                       
         BE    FB3F5                                                            
         LA    R4,1(R3)                                                         
         LA    R3,3(R3)                                                         
         LA    R5,19                                                            
FB3F2    CLI   0(R4),C' '                                                       
         BE    FB3F5                                                            
         LA    R4,1(R4)                                                         
         LA    R3,1(R3)                                                         
         BCT   R5,FB3F2                                                         
*                                                                               
FB3F5    MVC   0(1,R3),PBDCL                                                    
         MVI   1(R3),C'C'                                                       
*                                                                               
FB3F10   DS    0H                                                               
         MVC   W,SPACES                                                         
         CLI   PSECOND+15,C' '                                                  
         BNE   FB6                                                              
*                                                                               
         CLI   DSPOPT,C'Y'         SEE IF DOUBLE SPACING                        
         BE    FB6                 DON'T USE PSECOND FOR COMTAB DATA            
*                                                                               
         CLC   PJOBCAP2,SPACES     SEE IF I HAVE SECOND CAPTION LINE            
         BH    FB6                 YES - IT USES PSECOND SO I CAN'T             
*                                                                               
* YES I KNOW I'M NOT CHECKING HERE FOR CAP= OVERRIDES                           
*                                                                               
         CLI   COPYOPT,C'Y'        SEE IF SUPPRESSING COPY                      
         BE    FB3F20              YES - CAN USE PSECOND                        
         CLC   QPROG,=C'73'        PROOF RUN SHOWS AD NUMBER                    
         BE    FB6                                                              
         CLI   ADOPT,C'Y'          SHOWING AD NUMBER                            
         BE    FB6                 AD NUMBER USES PSECOND                       
FB3F20   BAS   RE,FNDIOC                                                        
         OC    W(5),W              FIRST CHECK FOR ZEROS                        
         BZ    FB3F22                                                           
         CLC   W(5),SPACES                                                      
         BNE   FB3F24                                                           
FB3F22   MVC   PSECOND+15(65),W+5                                               
         MVC   W,SPACES                                                         
         B     FB6                                                              
*                                                                               
FB3F24   DS    0H                                                               
         MVC   PSECOND+10(70),W                                                 
         MVC   W,SPACES                                                         
         B     FB6                                                              
*                                  NEWS                                         
FB4      DS    0H                                                               
         LA    R4,W                                                             
         MVC   W,SPACES                                                         
         CP    PBDUNITS,=P'0'                                                   
         BE    FB4D                                                             
         MVI   0(R4),C'0'                                                       
         LA    R0,1                                                             
         ZAP   DUB,PBDUNITS                                                     
         BZ    *+8                                                              
         BAS   RE,FBEDL                                                         
         AR    R4,R0                                                            
         MVI   0(R4),C'L'          LINES                                        
         CLI   PBDUIND,C'L'                                                     
         BE    FB4D                                                             
*--->    MVC   0(2,R4),=C'IN'      INCHES                                       
         MVC   0(L'PP@INCH,R4),PP@INCH                                          
         LA    R4,1(R4)                                                         
*                                                                               
FB4D     CLI   PBDCL,C' '          PREM                                         
         BNH   *+14                                                             
         MVC   2(1,R4),PBDCL                                                    
         MVI   3(R4),C'C'                                                       
         MVC   P+15(17),W                                                       
*                                                                               
         MVC   PSECOND+15(17),PBYOLBC                                           
         MVC   W,SPACES                                                         
*                                                                               
FB5      DS    0H                                                               
         CLI   PSECOND+15,C' '                                                  
         BNE   FB6                                                              
*                                                                               
         CLI   DSPOPT,C'Y'         SEE IF DOUBLE SPACING                        
         BE    FB6                 DON'T USE PSECOND FOR COMTAB DATA            
*                                                                               
         CLC   PJOBCAP2,SPACES                                                  
         BH    FB6                 CAN'T USE PSECOND                            
*                                                                               
* YES,I KNOW I'M NOT CHECKING HERE FOR CAP= OVERRIDES                           
*                                                                               
         CLI   COPYOPT,C'Y'        SEE IF SUPPRESSING COPY                      
         BE    FB5C                YES - CAN USE PSECOND                        
         CLC   QPROG,=C'73'        PROOF RUN SHOWS AD NUMBER                    
         BE    FB6                                                              
         CLI   ADOPT,C'Y'          SHOWING AD NUMBER                            
         BE    FB6                                                              
FB5C     BAS   RE,FNDIOC                                                        
         OC    W(5),W              FIRST CHECK FOR ZEROS                        
         BZ    FB5E                                                             
         CLC   W(5),SPACES                                                      
         BNE   FB5G                                                             
FB5E     MVC   PSECOND+15(65),W+5                                               
         MVC   W,SPACES                                                         
         B     FB6                                                              
*                                                                               
FB5G     DS    0H                                                               
         MVC   PSECOND+10(70),W                                                 
         MVC   W,SPACES                                                         
*                                  COPY NUMBER                                  
FB6      DS    0H                                                               
         MVI   BYTE,0                                                           
         CLI   CHANGSW,C'D'                                                     
         BNE   FB6B                                                             
         CLC   PBDJOB,PIOJOB       DIFFERENT JOBS                               
         BNE   FB6D                                                             
*                                  COPY NUMBER                                  
FB6B     DS    0H                                                               
         CLI   COPYOPT,C'Y'        SEE IF SUPPRESSING COPY                      
         BE    FB6B4                                                            
         MVC   P+33(17),PJOBCPY                                                 
*                                                                               
* SEE IF OVERRIDING COPY WITH COPY= COMMENT ELEMENT IN BUY                      
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'66'                                                     
FB6B2    BRAS  RE,NXTEL                                                         
         BNE   FB6B4                                                            
         CLC   2(5,R2),=C'COPY='                                                
         BNE   FB6B2               KEEP LOOKING                                 
         MVC   P+33(17),SPACES                                                  
         ZIC   R1,1(R2)                                                         
         AHI   R1,-8                                                            
         BNP   FB6B4                                                            
         CHI   R5,16                                                            
         BNH   *+8                                                              
         LHI   R5,16               MAX IS 17 CHARS                              
         EX    R1,*+8                                                           
         B     *+10                                                             
*                                                                               
         MVC   P+33(0),7(R2)       EXECUTED                                     
         OI    DITTOSW,X'01'       TO SUPPRESS DITTOS - COPY                    
         OI    BYTE,X'01'          COPY OVERRIDE                                
*                                                                               
FB6B4    CLI   ADOPT,C'Y'          SEE IF SHOWING AD NUMBER                     
         BE    FB6B5                                                            
*                                                                               
         CLC   QPROG,=C'73'        TEST PROOF RUN                               
         BNE   FB6C                                                             
*                                                                               
FB6B5    DS    0H                                                               
         LA    RE,PJOBREC                                                       
         USING PJOBREC,RE                                                       
*                                                                               
         CLI   PJOBADID,C' '       ANYTHING THERE ?                             
         BNH   FB6B5X              NO - USE AD CODE                             
*                                                                               
         CLI   COPYOPT,C'Y'       SEE IF SUPPRESSING COPY                       
         BNE   FB6B5B             IF YES  - USE P                               
         MVC   P+33(17),=C'ADID=            '                                   
         MVC   P+38(L'PJOBADID),PJOBADID                                        
*                                                                               
         B     FB6C                                                             
*                                                                               
FB6B5B   DS    0H                                                               
         MVC   PSECOND+33(17),=C'ADID=            '                             
         MVC   PSECOND+38(L'PJOBADID),PJOBADID                                  
*                                                                               
         B     FB6C                                                             
*                                                                               
         DROP  RE                                                               
*                                                                               
FB6B5X   DS    0H                                                               
*                                                                               
*                                  AD NO INSTEAD OF AD ID                       
         CLI   COPYOPT,C'Y'        SEE IF SUPPRESSING COPY                      
         BNE   FB6B6               IF YES USE P INSTEAD OF PSECOND              
*--->    MVC   P+33(17),=C'(AD NO. =       )'                                   
         MVI   P+33,C'('                                                        
         MVC   P+34(L'PP@ADNO),PP@ADNO                                          
         MVC   P+43(6),PBDJOB      OK SINCE FRENCH AND ENGLISH ARE              
         MVI   P+49,C')'           SAME LENGTH                                  
         LA    R1,P+48                                                          
         B     FB6B7                                                            
*                                                                               
*--->    MVC   PSECOND+33(17),=C'(AD NO. =       )'                             
FB6B6    MVI   PSECOND+33,C'('                                                  
         MVC   PSECOND+34(L'PP@ADNO),PP@ADNO                                    
         MVC   PSECOND+43(6),PBDJOB                                             
         MVI   PSECOND+49,C')'                                                  
*                                                                               
         LA    R1,PSECOND+48                                                    
FB6B7    LA    R2,5                FOR BCT                                      
FB6B8    CLI   0(R1),C' '                                                       
         BNE   FB6C                                                             
         MVI   0(R1),C')'          MOVE )                                       
         MVI   1(R1),C' '          BLANK OLD                                    
         BCTR  R1,0                                                             
         BCT   R2,FB6B8                                                         
*                                                                               
*                                  CAPTION                                      
FB6C     DS    0H                                                               
*                                                                               
* SEE IF OVERRIDING CAPTION WITH CAP= COMMENT ELEMENT IN BUY                    
*                                                                               
         LA    R1,P+52                                                          
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'66'                                                     
FB6C2    BRAS  RE,NXTEL                                                         
         BNE   FB6D                                                             
         CLC   2(4,R2),=C'CAP='                                                 
         BNE   FB6C2               KEEP LOOKING                                 
         ZIC   R5,1(R2)                                                         
         AHI   R5,-7                                                            
         BNP   FB6C4                                                            
         CHI   R5,24                                                            
         BNH   *+8                                                              
         LHI   R5,24               MAX IS 25 CHARS                              
         EX    R5,*+8                                                           
         B     *+10                                                             
*                                                                               
         MVC   0(0,R1),6(R2)       EXECUTED                                     
*                                                                               
FB6C4    LA    R1,132(R1)                                                       
         OI    BYTE,X'02'                                                       
         OI    DITTOSW,X'02'       SUPPRESS DITTOS CAPTION                      
         B     FB6C2               DO MORE ELEMENTS                             
*                                                                               
FB6D     DS    0H                                                               
         TM    BYTE,2              SEE IF CAP= ELEMENTS FOUND                   
         BO    FB6D3                                                            
         LA    R1,P+52                                                          
         MVC   0(25,R1),PJOBCAP1                                                
         CLC   PJOBCAP2,SPACES     SEE IF THERE IS A SECOND CAPTION             
         BNH   FB6D3               NO- SO I WON'T CLOBBER COMMENT IN            
*                                  PSECOND                                      
         MVC   132(25,R1),PJOBCAP2                                              
*                                                                               
FB6D3    DS    0H                                                               
*                                                                               
         MVC   THISBUY(17),P+15                                                 
         MVC   THISBUY+17(17),PSECOND+15                                        
*                                                                               
         MVC   THISBUY(6),PBDJOB   SAVE JOB SO I CAN CHECK CHANGE               
*                                                                               
         OC    LASTBUY,LASTBUY     TEST IF FIRST FOR THIS IO OR PAGE            
         BZ    FB6H                YES                                          
*                                                                               
         CLC   LASTBUY(6),THISBUY  CHECK FOR CHANGE OF JOB                      
         BNE   FB6H                YES  - CAN'T DO DITTOS                       
*                                                                               
         CLC   LASTBUY,THISBUY                                                  
         BNE   FB6F                                                             
         CLI   THISBUY+34,C'C'     TEST IOC'S THIS TIME OR LAST TIME            
         BE    FB6F                NO DITTOS HERE                               
*                                                                               
         TM    DITTOSW,X'01'       COPY OVERRIDE                                
         BO    FB6F                - NO DITTOS                                  
*                                                                               
         CLI   COSTOPT,C'N'        SHOWING COST?                                
         BNE   FB6E                                                             
         CLI   ACOPT,C'Y'          OR AC                                        
         BE    FB6E                                                             
         CLI   ACOPT,C'$'          OR AC $                                      
         BE    FB6E                                                             
         CLI   CDOPT,C'Y'          OR CD                                        
         BE    FB6E                                                             
         CLI   CDOPT,C'$'          OR CD $                                      
         BE    FB6E                                                             
*                                                                               
* THEN DITTOS ONLY FOR COPY AND CAPTION, LEAVE SPACE ALONE                      
*                                                                               
         MVC   P+15(17),SPACES                                                  
*--->    CLC   PSECOND+15(3),=C'*MA'                                            
         CLC   PSECOND+15(3),PP@MATCD                                           
         BE    *+10                                                             
         MVC   PSECOND+15(17),SPACES                                            
         MVC   W,SPACES                                                         
         MVC   P+15+1(2),DITTOS                                                 
*                                                                               
FB6E     DS    0H                                                               
         MVC   P+33(17),SPACES                                                  
         MVC   P+33+4(2),DITTOS                                                 
*                                                                               
FB6F     DS    0H                                                               
         TM    DITTOSW,X'02'       CAPTION OVERRIDE                             
         BO    FB6H                                                             
         MVC   P+52(25),SPACES                                                  
         MVC   PSECOND+52(25),SPACES                                            
         MVC   P+52+4(2),DITTOS                                                 
*                                                                               
FB6H     DS    0H                                                               
         CLI   BYTE,0                                                           
         BNE   *+8                                                              
         MVI   DITTOSW,0                                                        
*                                                                               
* IF BUY JUST PRINTED OVERRODE, COPY OR CAPTION                                 
* - YES, LEAVE DITTOSW                                                          
* - NO,  RESET TO X'00' SO DITTOS APPEAR                                        
*                                                                               
         CLC   DAYOFWK,SPACES                                                   
         BE    FB6HX5                                                           
         CLC   PSECOND+1(6),SPACES                                              
         BNE   FB6HX5                                                           
         MVC   PSECOND+1(3),DAYOFWK                                             
         MVC   DAYOFWK,SPACES                                                   
*                                                                               
FB6HX5   DS    0H                                                               
         GOTO1 AIOPRNT                                                          
*                                                                               
         CLC   W,SPACES            MAY STILL NEED TO PRINT W                    
         BE    FB7                                                              
         MVC   P+15(45),W                                                       
         CLC   DAYOFWK,SPACES      SEE IF PRINTED YET                           
         BE    FB6HX7                                                           
         MVC   P+1(3),DAYOFWK      PRINT AND CLEAR                              
         MVC   DAYOFWK,SPACES                                                   
*                                                                               
FB6HX7   DS    0H                                                               
         GOTO1 AIOPRNT                                                          
*                                                                               
FB7      DS    0H                                                               
         BAS   RE,FNDIOC                                                        
         CLC   W(70),SPACES                                                     
         BE    FB8                                                              
         MVC   P+10(70),W                                                       
*                                                                               
         CLC   DAYOFWK,SPACES                                                   
         BE    FB7BX                                                            
         MVC   P+1(3),DAYOFWK   PRINT AND CLEAR                                 
         MVC   DAYOFWK,SPACES                                                   
FB7BX    DS    0H                                                               
         GOTO1 AIOPRNT                                                          
         B     FB7                                                              
FB8      DS    0H                                                               
*                                                                               
* IT IS POSSIBLE THAT DAY OF WEEK NOT YET PRINTED, THIS ENSURES IT              
*                                                                               
         CLC   DAYOFWK,SPACES                                                   
         BE    FB8X                                                             
         MVC   P+1(3),DAYOFWK      PRINT AND CLEAR                              
         MVC   DAYOFWK,SPACES                                                   
         GOTO1 AIOPRNT                                                          
*                                                                               
FB8X     DS    0H                                                               
         MVC   LASTBUY,THISBUY                                                  
         CLI   CHANGSW,C'D'                                                     
         BNE   FMTBUYX                                                          
*                                  RESTORE "REAL" PBDELEM IF DELETE             
         LA    R4,SAVEBEL                                                       
         SR    R5,R5                                                            
         IC    R5,1(R4)                                                         
         BCTR  R5,R0                                                            
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   PBDELEM(0),0(R4)                                                 
*                                                                               
FMTBUYX  XIT1                                                                   
*                                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FNDIOC   DS    0H                  GET IOC COMMENT                              
         MVC   W(70),SPACES                                                     
         L     R3,ANXTCOM                                                       
         CLI   0(R3),X'FF'         END OF TABLE                                 
         BER   RE                                                               
*                                                                               
         MVC   W(70),0(R3)                                                      
         LA    R3,70(R3)                                                        
         ST    R3,ANXTCOM                                                       
         BR    RE                                                               
*                                                                               
FBEDL    DS    0H                                                               
         CLI   PBDUIND,X'89'       INCHES - 2 DECIMALS                          
         BNE   FBEDL5                                                           
         EDIT  (P8,DUB),(10,(R4)),2,ALIGN=LEFT                                  
         B     FBEDLX                                                           
*                                                                               
FBEDL5   EDIT  (P8,DUB),(10,(R4)),ALIGN=LEFT                                    
*                                                                               
FBEDLX   BR    RE                                                               
*                                                                               
NXTEL    ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLC   ELCODE,0(R2)                                                     
         JE    NXTELX              CC IS EQUAL                                  
         CLI   0(R2),0                                                          
         JNE   NXTEL                                                            
         LTR   R2,R2               CC IS NOT EQUAL                              
NXTELX   BR    RE                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FRDATE   NTR1                      CONVERT DATE IN WORK (MMMDD/YY)              
         LA    R1,DATETAB                                                       
FRDAT2   CLI   0(R1),X'FF'         END OF TABLE                                 
         BNE   *+6                                                              
         DC    H'0'                SOMETHING VERY WRONG                         
*                                                                               
         CLC   WORK(3),0(R1)                                                    
         BE    FRDAT10                                                          
         LA    R1,6(R1)                                                         
         B     FRDAT2                                                           
*                                   TO FRENCH                                   
FRDAT10  MVC   WORK(3),3(R1)                                                    
         J     FMTBUYX                                                          
*                                                                               
DATETAB  DC    C'JANJAN'                                                        
         DC    C'FEBFEV'                                                        
         DC    C'MARMAR'                                                        
         DC    C'APRAVR'                                                        
         DC    C'MAYMAI'                                                        
         DC    C'JUNJUN'                                                        
         DC    C'JULJUL'                                                        
         DC    C'AUGAOU'                                                        
         DC    C'SEPSEP'                                                        
         DC    C'OCTOCT'                                                        
         DC    C'NOVNOV'                                                        
         DC    C'DECDEC'                                                        
         DC    X'FF'                                                            
         EJECT                                                                  
*                                                                               
BFRDAY   NTR1                      CONVERT DAY IN WORK+6                        
*                                                                               
         LA    R1,BDAYTAB                                                       
BFRDAY2  CLI   0(R1),X'FF'         END OF TABLE                                 
         BNE   *+6                                                              
         DC    H'0'                SOMETHING VERY WRONG                         
*                                                                               
         CLC   WORK+6(3),0(R1)                                                  
         BE    BFRDAY10                                                         
         LA    R1,6(R1)                                                         
         B     BFRDAY2                                                          
*                                  TO FRENCH                                    
BFRDAY10 MVC   WORK+6(3),3(R1)                                                  
         J     FMTBUYX                                                          
*                                                                               
BDAYTAB  DC    C'SUNDIM'                                                        
         DC    C'MONLUN'                                                        
         DC    C'TUEMAR'                                                        
         DC    C'WEDMER'                                                        
         DC    C'THUJEU'                                                        
         DC    C'FRIVEN'                                                        
         DC    C'SATSAM'                                                        
         DC    X'FF'                                                            
*                                                                               
         LTORG                                                                  
*                                                                               
DAYOFWK  DS    CL3                                                              
*                                                                               
SVCTYP   DS    CL1                                                              
*                                                                               
DITTOS   DC    C''''''                                                          
*                                                                               
SAVEBEL  DS    256C                                                             
*                                                                               
BUYOUTA  DS    600C                                                             
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
LEGALW   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVI   LWCCODE,0           WILL PASS BACK LW CODE IF FOUND              
         MVI   QUCCODE,0           WILL PASS BACK QU CODE IF FOUND              
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'94'        LEGAL WARNINGS ELEM IN BUY REC               
         BRAS  RE,NXTEL                                                         
         BNE   LEGW50              OVERRIDE NOT FOUND IN BUY, CK PRD            
*                                                                               
         CLI   2(R2),C'X'          X=NONE FOR LEGAL WARNINGS COMMENT?           
         BE    LEGALWX                                                          
         MVC   LWCCODE,2(R2)       SAVE LW COMENT CODE                          
*                                                                               
         CLI   3(R2),C'X'          X=NONE FOR QUARTERLY COMMENT?                
         BE    LEGALWX                                                          
         CLI   3(R2),0             USE QUARTER FROM INSERTION DATE?             
         BE    LEGW40                                                           
         MVC   QUCCODE,3(R2)       SAVE QUARTERLY COMENT CODE                   
         B     LEGALWX                                                          
LEGW40   BAS   RE,LWQUARTR         GET QUARTER NUMBER                           
         MVC   QUCCODE,LWINSDT     QUARTERLY COMMENT CODE (COMPUTED)            
         B     LEGALWX                                                          
*                                                                               
LEGW50   LA    R2,PPRDREC+33                                                    
         MVI   ELCODE,X'40'        LEGAL WARNINGS ELEM IN PRD REC               
         BRAS  RE,NXTEL                                                         
         BNE   LEGALWX             LEGAL WARNINGS NOT FOUND IN PRD              
         MVC   LWSVPRDC,2(R2)                                                   
*                                                                               
         BAS   RE,LWQUARTR         GET QUARTER NUMBER                           
         CLI   LWINSDT,C'1'        QUARTER 1?                                   
         BNE   *+14                                                             
         MVC   LWCCODE,LWSVPRDC+0                                               
         B     LEGW60                                                           
         CLI   LWINSDT,C'2'        QUARTER 2?                                   
         BNE   *+14                                                             
         MVC   LWCCODE,LWSVPRDC+1                                               
         B     LEGW60                                                           
         CLI   LWINSDT,C'3'        QUARTER 3?                                   
         BNE   *+14                                                             
         MVC   LWCCODE,LWSVPRDC+2                                               
         B     LEGW60                                                           
         CLI   LWINSDT,C'4'        QUARTER 4?                                   
         BNE   *+14                                                             
         MVC   LWCCODE,LWSVPRDC+3                                               
         B     LEGW60                                                           
         DC    H'0'                THERE ARE ONLY 4 QUARTERS IN A YEAR!         
*                                                                               
LEGW60   DS    0H                                                               
         MVC   QUCCODE,LWINSDT                                                  
*                                                                               
LEGALWX  J     FMTBUYX                                                          
*                                                                               
LWQUARTR DS    0H                  DETERMING QUARTER FROM INS DATE              
         CLI   PBUYKDAT+1,X'03'    MONTH IS GREATER THAN MARCH?                 
         BH    *+10                                                             
         MVI   LWINSDT,C'1'        QUARTER 1                                    
         BR    RE                                                               
         CLI   PBUYKDAT+1,X'06'    MONTH IS GREATER THAN JUNE?                  
         BH    *+10                                                             
         MVI   LWINSDT,C'2'        QUARTER 2                                    
         BR    RE                                                               
         CLI   PBUYKDAT+1,X'09'    MONTH IS GREATER THAN SEPTEMBER?             
         BH    *+10                                                             
         MVI   LWINSDT,C'3'        QUARTER 3                                    
         BR    RE                                                               
         CLI   PBUYKDAT+1,X'0C'    MONTH IS GREATER THAN DECEMBER?              
         BH    *+10                                                             
         MVI   LWINSDT,C'4'        QUARTER 4                                    
         BR    RE                                                               
         DC    H'0'                GREATER THAN DECEMBER, BAD!                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
LWSVPRDC DS    CL4                 LW & QUARTERLY COM CODE (PRD REC)            
LWINSDT  DS    C                   QUARTER COMPUTED FROM INS DATE               
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
BLDCTAB  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING PPBYOUTD,R7                                                      
*                                                                               
         L     R4,ACOMTAB                                                       
         ST    R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
*                                                                               
         CLI   ZEOPT,C'Y'          TEST MULTI Z/E                               
         BNE   BCTB8                                                            
*                                  YES- SET ZONE AS FIRST COMMENT LINE          
         CLC   SVZONNM,SPACES                                                   
         BH    BCTB2                                                            
*--->    MVC   SVZONNM(19),=C'**NO EDITION NAME**'                              
         MVC   5(L'PP@NOEDN,R4),PP@NOEDN                                        
         B     BCTB2C                                                           
*                                                                               
BCTB2    MVC   5(20,R4),SVZONNM                                                 
BCTB2C   LA    R5,25(R4)                                                        
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
*                                  (ZZ,EDT)                                     
         MVI   2(R5),C'('                                                       
         XC    DUB,DUB                                                          
         UNPK  DUB(3),SVZON(2)                                                  
         MVC   3(2,R5),DUB                                                      
         CLI   SVEDIT,0                                                         
         BNE   BCTB6                                                            
         MVI   5(R5),C')'                                                       
         B     BCTB7                                                            
*                                                                               
BCTB6    DS    0H                                                               
         MVI   5(R5),C','                                                       
         XC    DUB,DUB             SET FOR PUBEDIT                              
         MVI   DUB+4,1                                                          
         MVC   DUB+5(1),SVEDIT                                                  
         GOTO1 APUBEDIT,DMCB,(8,DUB),WORK                                       
         MVC   6(3,R5),WORK+14     EDT FROM N-NNN-NNNN,ZZ,EDT                   
         LA    R5,9(R5)                                                         
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
         MVI   1(R5),C')'                                                       
*                                                                               
BCTB7    DS    0H                                                               
         BAS   RE,CHKDUB           CHECKING DOUBLE SPACE OPTION                 
*                                                                               
BCTB8    DS    0H                                                               
         BRAS  RE,DATEPRT                                                       
*                                                                               
         CLI   COSTOPT,C'B'        BOTH GROSS AND NET                           
         BE    BCTB9                                                            
         CLI   COSTOPT,C'T'        SEE IF SHOWING NET COST                      
         BE    BCTB9                                                            
         CLI   COSTOPT,C'G'        SEE IF SHOWING GROSS                         
         BE    BCTB9                                                            
         CLI   COSTOPT,C'Y'        SEE IF SHOWING COST                          
         BNE   BC2                                                              
*                                                                               
* I WILL RETURN HERE IF COSTOPT IS B                                            
*                                                                               
BCTB9    LA    R4,SAVEP            BUILD COST AS FIRST COMMENT LINE             
         MVC   0(70,R4),SPACES                                                  
*--->    MVC   0(5,R4),=C'COST='                                                
         MVC   0(L'PP@COST,R4),PP@COST                                          
         MVI   4(R4),C'='                                                       
         L     R0,GROSS                                                         
         CLI   NETSW,C'Y'          SEE IF SHOWING NET                           
         BE    BCTB9C                                                           
         B     BCTB9D                                                           
*                                                                               
BCTB9C   S     R0,AGYCOM                                                        
*                                                                               
BCTB9D   EDIT  (R0),(14,5(R4)),2,ALIGN=LEFT,MINUS=YES,COMMAS=YES                
         CLI   LANG,C'F'           SEE IF FRENCH                                
         BNE   BCTB9DX                                                          
         LA    R1,5(R4)                                                         
         LA    RE,14               FOR BCT                                      
BCTB9D2  CLI   0(R1),C','                                                       
         BNE   BCTB9D4                                                          
         MVI   0(R1),C' '          CHANGE COMMA TO SPACE                        
BCTB9D4  LA    R1,1(R1)                                                         
         BCT   RE,BCTB9D2                                                       
*                                                                               
         LA    R1,5(R4)                                                         
         LA    RE,14               FOR BCT                                      
BCTB9D6  CLI   0(R1),C'.'                                                       
         BNE   BCTB9D8                                                          
         MVI   0(R1),C','          CHANGE PERIOD TO COMMA                       
BCTB9D8  LA    R1,1(R1)                                                         
         BCT   RE,BCTB9D6                                                       
*                                                                               
* CAN'T USE CURED SINCE IT GETS COUNTRY AND LANGUAGE FROM =V(SSB)               
*                                                                               
BCTB9DX  DS    0H                                                               
         CLI   QMEDIA,C'N'                                                      
         BE    BLDC2                                                            
*                                                                               
BCTB9E   LA    R4,22(R4)           SCAN BACKWARDS FOR LAST DIGIT                
         CLI   0(R4),C' '                                                       
         BH    *+8                                                              
         BCT   R4,*-8                                                           
*                                                                               
         MVI   THISBUY+34,C'C'      CAN'T USE DITTOS                            
*                                                                               
*--->    MVC   2(5,R4),=C'(NET)'                                                
         MVC   2(L'PP@NETP,R4),PP@NETP                                          
         CLI   NETSW,C'Y'                                                       
         BE    BCTBC                                                            
*--->    MVC   2(7,R4),=C'(GROSS)'                                              
         MVC   2(L'PP@GROSP,R4),PP@GROSP                                        
*                                                                               
BCTBC    L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(35,R4),SAVEP                                                   
         B     BC1                                                              
*                                                                               
BLDC2    DS    0H                  FOR NEWSPAPERS SHOW RATE AND PREMIUM         
         LR    R5,R4               SAVE R4                                      
         MVI   THISBUY+34,C'C'     CAN'T USE DITTOS                             
         LA    R4,22(R4)                                                        
         CLI   0(R4),C' '                                                       
         BH    *+8                                                              
         BCT   R4,*-8                                                           
*                                                                               
*--->    MVC   2(5,R4),=C'(NET)'                                                
         MVC   2(L'PP@NETP,R4),PP@NETP                                          
         LA    R4,6(R4)                                                         
         CLI   NETSW,C'Y'                                                       
         BE    BCTB9H                                                           
         AHI   R4,-6               BACK UP R4                                   
*--->    MVC   2(7,R4),=C'(GROSS)'                                              
         MVC   2(L'PP@GROSP,R4),PP@GROSP                                        
         LA    R4,8(R4)                                                         
*                                                                               
BCTB9H   DS    0H                                                               
         MVI   2(R4),C'('                                                       
         CLI   PBDCOSTY,C'U'       TEST UNIT RATE                               
         BNE   BC0C2               SKIP TO PREMIUM                              
*                                                                               
         MVC   3(6,R4),PBYOUR+2                                                 
         CLC   PBYOUR(2),=C'  '    SEE IF STARTS WITH 2 SPACES                  
         BNH   BCTB9H2             YES - THEN JUST MOVE 6 CHARS                 
         MVC   3(7,R4),PBYOUR+1                                                 
         CLI   PBYOUR,C' '         SEE IF STARTS WITH ONE SPACE                 
         BNH   *+10                YES - THE JUST MOVE 7 CHARS                  
         MVC   3(8,R4),PBYOUR                                                   
*                                                                               
BCTB9H2  DS    0H                                                               
         LA    R4,11(R4)                                                        
*                                                                               
         CLI   0(R4),C' '                                                       
         BH    *+8                                                              
         BCT   R4,*-8                                                           
*                                                                               
         MVC   1(3,R4),=C'/LI'                                                  
         CLI   PBDUIND,C'L'                                                     
         BE    *+10                                                             
*--->    MVC   2(2,R4),=C'IN'                                                   
         MVC   2(L'PP@INCH,R4),PP@INCH                                          
         LA    R4,2(R4)                                                         
BC0C     DS    0H                                                               
         CLI   NETSW,C'Y'          SEE IF SHOWING NET                           
         BE    BC0C1                                                            
         B     BC0C2               I DON'T NEED TO SHOW (GROSS)                 
*                                  NEXT TO LINE RATES                           
BC0C1    MVC   3(4,R4),=C'NET)'                                                 
         LA    R4,6(R4)                                                         
         MVI   2(R4),C'('                                                       
*                                                                               
BC0C2    MVC   3(11,R4),PBYOPRM                                                 
         LA    R4,18(R4)                                                        
         CLI   0(R4),C' '                                                       
         BH    *+8                                                              
         BCT   R4,*-8                                                           
         MVI   1(R4),C')'                                                       
*                                                                               
         CLI   0(R4),C'('                                                       
         BNE   BC0C4                                                            
         MVC   0(2,R4),SPACES                                                   
         AHI   R4,-2                                                            
         B     BC0C5                                                            
*                                                                               
BC0C4    DS    0H                                                               
         LA    R4,1(R4)            FOR LAST ")"                                 
*                                                                               
BC0C5    LR    RF,R4                                                            
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(35,R4),SAVEP                                                   
*                                                                               
         SR    RE,RE               SEE IF I CAN FIT ON ONE LINE                 
         LA    RE,SAVEP                                                         
         SR    RF,RE                                                            
         CHI   RF,35                                                            
         BNH   BC1                                                              
*                                  MUST USE TWO LINES, BREAK AFTER COST         
         LA    R5,SAVEP                                                         
         LR    R2,R4                                                            
         LA    R2,5(R2)                                                         
         MVC   0(35,R2),SPACES                                                  
*                                                                               
BC0C8    CLC   0(2,R5),=C' ('      MEANS I'M AT END OF COST                     
         BE    BC0C8X              NOTE THAT COST IS ALWAYS FOLLOWED            
*                                  BY (NET) OR (GROSS)                          
         MVC   0(1,R2),0(R5)                                                    
         LA    R5,1(R5)                                                         
         LA    R2,1(R2)                                                         
         B     BC0C8                                                            
*                                                                               
* IF SPLITTING - SHOW (NET) OR (GROSS) HERE                                     
*                                                                               
BC0C8X   DS    0H                                                               
*--->    MVC   1(5,R2),=C'(NET)'                                                
         MVC   1(L'PP@NETP,R2),PP@NETP                                          
         LA    R5,6(R5)                                                         
         CLI   NETSW,C'Y'                                                       
         BE    BC0C9                                                            
         LA    R5,2(R5)                                                         
*--->    MVC   1(7,R2),=C'(GROSS)'                                              
         MVC   1(L'PP@GROSP,R2),PP@GROSP                                        
*                                                                               
BC0C9    LA    R4,70(R4)                                                        
         XC    0(70,R4),0(R4)                                                   
         MVC   5(35,R4),1(R5)                                                   
         MVI   THISBUY+34,C' '     MAY USE DITTOS                               
         B     BC1                                                              
*                                                                               
BC1      DS    0H                                                               
         BAS   RE,CHKDUB           CHECKING DOUBLE SPACE OPTION                 
*                                                                               
         CLI   COSTOPT,C'B'        SEE IF DOING BOTH GROSS AND NET              
         BNE   BC2                                                              
         CLI   NETSW,C'Y'          DID I JUST DO NET?                           
         BE    BC1X                YES - THEN DONE                              
*                                                                               
         MVC   BSVCTYP,PBDCTYP     SAVE REAL PBDCTYP                            
         MVI   PBDCTYP,C'N'        FOOL PPBYOUT TO HAVE IT RETURN NET           
         MVI   NETSW,C'Y'                                                       
*                                  GO TO PPBYOUT AGAIN                          
         GOTO1 APPBYOUT,DMCB,0(R7)                                              
         MVC   PBYOPRM,SPACES      CLEAR PREMIUM FOR NET LINES                  
         B     BCTB9               NOW GO DO NET                                
*                                                                               
BC1X     MVC   PBDCTYP,BSVCTYP     RESTORE PBDCTYP                              
*                                                                               
BC2      DS    0H                                                               
         LA    R5,SAVEP                                                         
         MVC   0(35,R5),SPACES                                                  
         CLI   ACOPT,C'$'          SEE IF SHOWING AC $                          
         BE    BC2A                                                             
         CLI   ACOPT,C'Y'          SEE IF SHOWING AC                            
         BNE   BC3                                                              
*--->    MVC   0(3,R5),=C'AC='                                                  
BC2A     MVC   0(L'PP@AGYCM,R5),PP@AGYCM                                        
         MVI   2(R5),C'='                                                       
*                                                                               
         CLI   ACOPT,C'$'          SEE IF SHOWING AC $                          
         BE    BC2D2                                                            
         ZAP   MYDUB,PBDACP                                                     
         CP    PBDACP,=P'-1'                                                    
         BNE   BC2B                                                             
         ZAP   MYDUB,=P'100000'                                                 
BC2B     EDIT  (P4,MYDUB),(7,3(R5)),3,ALIGN=LEFT,DROP=2                         
*                                                                               
         LA    RE,11(R5)           SCAN BACKWARD FOR FIRST NON-SPACE            
BC2C     CLI   0(RE),C' '                                                       
         BNE   BC2D                                                             
         BCT   RE,BC2C                                                          
*                                                                               
BC2D     MVC   2(4,RE),=C'PCT,'                                                 
         B     BC2DX                                                            
*                                                                               
BC2D2    DS    0H                                                               
         EDIT  (B4,AGYCOM),(10,3(R5)),2,ALIGN=LEFT,FLOAT=$                      
*                                                                               
         LA    RE,12(R5)           SCAN BACKWARD FOR FIRST NON-SPACE            
BC2D4    CLI   0(RE),C' '                                                       
         BNE   BC2D6                                                            
         BCT   RE,BC2D4                                                         
*                                                                               
BC2D6    MVI   1(RE),C','                                                       
         LR    R5,RE                                                            
         LA    R5,3(R5)                                                         
         CLI   CDOPT,C'Y'                                                       
         BE    BC3D                                                             
         CLI   CDOPT,C'$'                                                       
         BE    BC3D                                                             
         MVI   1(RE),C' '          BLANK OUT LAST COMMA                         
         B     BC2DX5                                                           
*                                                                               
BC2DX    DS    0H                                                               
         LR    R5,RE                                                            
         LA    R5,7(R5)                                                         
         CLI   CDOPT,C'Y'                                                       
         BE    BC3D                                                             
         CLI   CDOPT,C'$'          OR CD $                                      
         BE    BC3D                                                             
         MVI   5(RE),C' '          BLANK OUT COMMA IF NOT SHOWING CD            
*                                                                               
BC2DX5   DS    0H                                                               
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(35,R4),SAVEP                                                   
*                                                                               
         BAS   RE,CHKDUB           CHECKING DOUBLE SPACE OPTION                 
*                                                                               
         B     BC3E                                                             
*                                                                               
BC3      DS    0H                                                               
         CLI   CDOPT,C'Y'                                                       
         BE    BC3D                                                             
         CLI   CDOPT,C'$'          SEE IF SHOWING CD $                          
         BNE   BC3E                                                             
*--->    MVC   0(3,R5),=C'CD='     BC3D                                         
BC3D     MVC   0(L'PP@CD,R5),PP@CD 2 BYTES                                      
         MVI   2(R5),C'='                                                       
         CLI   CDOPT,C'$'          SEE IF SHOWING $                             
         BE    BC3D2                                                            
*                                                                               
         EDIT  (P2,PBDCD),(4,3(R5)),1,ALIGN=LEFT                                
*                                                                               
         LA    RE,3(R5)                                                         
         AR    RE,R0               ADD LENGTH OF OUTPUT                         
         MVC   1(3,RE),=C'PCT'                                                  
         B     BC3DX                                                            
*                                                                               
BC3D2    EDIT  (B4,CSHDSC),(10,3(R5)),2,ALIGN=LEFT,FLOAT=$                      
*                                                                               
BC3DX    L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(35,R4),SAVEP                                                   
*                                                                               
         BAS   RE,CHKDUB           CHECKING DOUBLE SPACE OPTION                 
*                                                                               
BC3E     DS    0H                                                               
         OC    PYBLDT(4),PYBLDT    REALLY TAX                                   
         BZ    BC3E30                                                           
         CLI   TAXOPT,C'N'                                                      
         BE    BC3E30                                                           
         CLI   PBDELEM+1,105       BE SURE NOT "SMALL" ELEM                     
         BL    BC3E30              CAN'T HAVE TAX                               
         OC    PBDTAX,PBDTAX       CHECK TAX PERCENTAGE                         
         BZ    BC3E30                                                           
         CLI   TAXOPT,C'%'         SEE IF JUST SHOWING TAX PERCENT              
         BE    BC3E05                                                           
         CLI   TAXOPT,C'B'         OR PERCENT AND $                             
         BE    BC3E05                                                           
         CLI   TAXOPT,C'$'         ONLY TAX $                                   
         BNE   BC3E20              UNKNOWN VALUE - SKIP                         
         L     R3,ANXTCOM                                                       
         XC    0(70,R3),0(R3)                                                   
         LA    R3,5(R3)                                                         
         B     BC3E10                                                           
*                                                                               
BC3E05   DS    0H                  TAX PERCENT                                  
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         CLI   LANG,C'F'           SEE IF FRENCH I/O                            
         BE    BC3E05F                                                          
         MVC   5(5,R4),=C'TAX%='                                                
         EDIT  (B3,PBDTAX),(8,11(R4)),4,ALIGN=LEFT                              
         CLI   TAXOPT,C'B'                                                      
         BNE   BC3E20                                                           
         LA    R3,20(R4)                                                        
         B     BC3E10                                                           
*                                                                               
BC3E05F  DS    0H                                                               
         MVC   5(6,R4),=C'TAXE%='                                               
         EDIT  (B3,PBDTAX),(8,12(R4)),4,ALIGN=LEFT                              
         CLI   TAXOPT,C'B'                                                      
         BNE   BC3E20                                                           
         LA    R3,21(R4)                                                        
*                                                                               
BC3E10   DS    0H                                                               
         CLI   LANG,C'F'           SEE IF FRENCH I/O                            
         BE    BC3E10F                                                          
         MVC   0(5,R3),=C'TAX$='                                                
         EDIT  (B4,PYBLDT),(11,6(R3)),2,ALIGN=LEFT                              
         CLI   COSTOPT,C'N'        SEE IF SHOWING COST                          
         BE    BC3E20                                                           
         B     BC3E15                                                           
*                                                                               
BC3E10F  DS    0H                                                               
         MVC   0(6,R3),=C'TAXE$='                                               
         EDIT  (B4,PYBLDT),(11,7(R3)),2,ALIGN=LEFT                              
         CLI   COSTOPT,C'N'        SEE IF SHOWING COST                          
         BE    BC3E20                                                           
*                                                                               
BC3E15   LA    R4,70(R4)                                                        
         XC    0(70,R4),0(R4)                                                   
         MVC   5(16,R4),=C'(INCLUS EN COUT)'                                    
         CLI   LANG,C'F'           SEE IF FRENCH I/O                            
         BE    *+10                                                             
         MVC   5(18,R4),=C'(INCLUDED IN COST)'                                  
*                                                                               
BC3E20   DS    0H                                                               
         BAS   RE,CHKDUB           CHECKING DOUBLE SPACE OPTION                 
*                                                                               
BC3E30   DS    0H                                                               
         CLI   PVCTOPT,C'Y'        SEE IF SUPPRESSING PAGEVIEWS AND             
         BE    BC3FX               CLICK THRUS AND IMPRESSIONS                  
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'87'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   BC3F                                                             
         USING PPAGED,R2                                                        
         CP    PPAGEVS,=P'0'                                                    
         BE    BC3F                                                             
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(11,R4),=C'PAGE VIEWS='                                         
         EDIT  PPAGEVS,(11,16(R4)),0,ALIGN=LEFT,COMMAS=YES                      
*                                                                               
         BAS   RE,CHKDUB           CHECKING DOUBLE SPACE OPTION                 
         DROP  R2                                                               
*                                                                               
BC3F     DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'88'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   BC3F5                                                            
         USING PCLICKD,R2                                                       
         CP    PCLCKTS,=P'0'                                                    
         BE    BC3F5                                                            
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(12,R4),=C'CLICK THRUS='                                        
         EDIT  PCLCKTS,(11,17(R4)),0,ALIGN=LEFT,COMMAS=YES                      
*                                                                               
         BAS   RE,CHKDUB           CHECKING DOUBLE SPACE OPTION                 
         DROP  R2                                                               
*                                                                               
BC3F5    DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'92'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   BC3FX                                                            
         USING PIMPRSD,R2                                                       
         CP    PIMPRS,=P'0'                                                     
         BE    BC3FX                                                            
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(22,R4),=C'ESTIMATED IMPRESSIONS='                              
         EDIT  PIMPRS,(11,27(R4)),0,ALIGN=LEFT,COMMAS=YES                       
*                                                                               
         BAS   RE,CHKDUB           CHECKING DOUBLE SPACE OPTION                 
         DROP  R2                                                               
*                                                                               
BC3FX    DS    0H                                                               
         CLI   AIMPSOPT,C'Y'       DISPLAY ACTUAL IMPS?                         
         BNE   BC3G                                                             
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'93'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   BC3G                                                             
         USING PAIMPRSD,R2                                                      
         CP    PAIMPRS,=P'0'                                                    
         BE    BC3G                                                             
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(19,R4),=C'ACTUAL IMPRESSIONS='                                 
         EDIT  PAIMPRS,(11,24(R4)),0,ALIGN=LEFT,COMMAS=YES                      
*                                                                               
         BAS   RE,CHKDUB           CHECKING DOUBLE SPACE OPTION                 
         DROP  R2                                                               
*                                                                               
BC3G     DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'82'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   BC3H                                                             
         USING PBFSIELD,R2                                                      
         CP    PBFSI,=P'0'                                                      
         BE    BC3H                                                             
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(4,R4),=C'FSI='                                                 
         EDIT  PBFSI,(8,9(R4)),0,ALIGN=LEFT                                     
*                                                                               
         BAS   RE,CHKDUB           CHECKING DOUBLE SPACE OPTION                 
         DROP  R2                                                               
*                                                                               
BC3H     DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'83'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   BC3I                                                             
         USING PBREFELD,R2                                                      
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(4,R4),=C'REF='                                                 
         MVC   9(L'PBREFNO,R4),PBREFNO                                          
*                                                                               
         BAS   RE,CHKDUB           CHECKING DOUBLE SPACE OPTION                 
         DROP  R2                                                               
*                                                                               
BC3I     DS    0H                                                               
         BRAS  RE,ACHARGE          CHECK FOR ADDITIONAL CHARGES                 
*                                                                               
         BRAS  RE,CCOLRTN    CHECK FOR AND PROCESS CUSTOM COLUMNS               
*                                                                               
         L     R4,ANXTCOM                                                       
         LA    R4,70(R4)                                                        
         ST    R4,ANXTCOM                                                       
*                                                                               
BC3X00   DS    0H                                                               
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
*                                                                               
*                                       OUTPUT COMMENT FROM INS SCREEN          
         CLC   INSCOMM(50),SPACES       CHECK IF ANYTHING THERE                 
         BNH   BC3X01                                                           
         MVC   0(50,R4),INSCOMM          FIRST LINE                             
         LA    R4,70(R4)                                                        
BC3X01   DS    0H                                                               
*                                                                               
         XC    0(70,R4),0(R4)                                                   
         CLC   INSCOMM+50(50),SPACES    CHECK IF ANYTHING THERE                 
         BNH   BC3X02                                                           
         MVC   0(50,R4),INSCOMM+50      SECOND LINE                             
         LA    R4,70(R4)                                                        
*                                                                               
BC3X02   DS    0H                                                               
         XC    0(70,R4),0(R4)                                                   
         CLC   INSCOMM+100(50),SPACES    CHECK IF ANYTHING THERE                
         BNH   BC3X03                                                           
         MVC   0(50,R4),INSCOMM+100      THIRD LINE                             
         LA    R4,70(R4)                                                        
BC3X03   DS    0H                                                               
*                                                                               
         ST    R4,ANXTCOM                                                       
*                                                                               
         BRAS  RE,REGCOMM          CHECK FOR REGIONAL COMMENT                   
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'67'                                                     
*                                                                               
BC4      BRAS  RE,NXTEL                                                         
         BNE   BC20                                                             
         CLI   1(R2),2                                                          
         BE    BC4                                                              
*                                                                               
BC5      DS    0H                  CAN GET HERE FROM BC22                       
         MVI   THISBUY+34,C'C'     CAN'T USE DITTOS                             
         CLC   2(4,R2),=C'COM='                                                 
         BE    BC8                 STANDARD COMMENT                             
*                                                                               
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   SAVEP,SPACES                                                     
         ZIC   R5,1(R2)                                                         
         AHI   R5,-3                                                            
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   SAVEP(0),2(R2)                                                   
         L     R3,ANXTCOM                                                       
         MVC   0(70,R3),SAVEP                                                   
         LA    R3,70(R3)                                                        
*                                                                               
* NOTE - COMMENTS NOT DOUBLE SPACED                                             
*                                                                               
BC5H     ST    R3,ANXTCOM                                                       
         B     BC4                                                              
*                                                                               
BC8      DS    0H                                                               
         ST    R2,SAVER2           SAVE BUYREC'S R2                             
         MVC   SVELCOD,ELCODE      MUST SAVE ELCODE                             
         MVC   SVBUYKEY,KEY                                                     
         XC    KEY,KEY                                                          
         MVC   KEY(3),QAGENCY                                                   
         MVI   KEY+3,X'40'                                                      
         ZIC   R5,1(R2)                                                         
         AHI   R5,-6                                                            
         LTR   R5,R5                                                            
         BZ    BC8X                NO NUMBER                                    
         MVC   WORK(10),SPACES                                                  
         LA    R7,WORK+6                                                        
         SR    R7,R5                                                            
         BCTR  R5,0                                                             
         EX    R5,*+8                                                           
         B     *+10                                                             
*                                                                               
         MVC   0(0,R7),6(R2)                                                    
*                                                                               
         MVC   KEY+4(6),WORK                                                    
         GOTO1 DATAMGR,DMCB,DMREAD,PRTDIR,KEY,KEY                               
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DC    H'0'                STND COMMENT NOT FOUND                       
*                                                                               
         GOTO1 (RF),(R1),GETREC,PRTFILE,KEY+27,PLISREC,DMWORK                   
*                                                                               
         LA    R2,PLISREC+33                                                    
         MVI   ELCODE,X'40'                                                     
         CLI   0(R2),X'40'                                                      
         BE    BC8D                                                             
*                                                                               
BC8C     BRAS  RE,NXTEL                                                         
         BNE   BC8X                                                             
*                                                                               
BC8D     DS    0H                                                               
         CLC   2(5,R2),=C'SHIP='                                                
         BE    BC8C                                                             
         CLC   2(6,R2),=C'LABEL='                                               
         BE    BC8C                                                             
         CLC   2(4,R2),=C'MAT='                                                 
         BE    BC8C                                                             
         CLC   2(3,R2),=C'RC='                                                  
         BE    BC8C                                                             
         LA    R4,2(R2)                                                         
         LR    R1,R4                                                            
         ZIC   R5,1(R2)                                                         
         AHI   R5,-3                                                            
         BM    BC8C                                                             
*                                                                               
         CLI   0(R4),C'+'                                                       
         BNE   *+8                                                              
         LA    R1,2(R1)                                                         
         SR    RF,RF                                                            
         CLC   0(3,R1),=C'DC='     ONLY DC= COMMNTS                             
         BNE   *+8                 ON CANCELS                                   
         LA    RF,1                                                             
         CLI   TSCHGSW-STATDIF,C'D'                                             
         BNE   *+6                                                              
         BCTR  RF,R0                                                            
         LTR   RF,RF                                                            
         BNZ   BC8C                                                             
*                                                                               
         CLI   0(R4),C'+'                                                       
         BNE   BC8F                                                             
         CLI   1(R4),C'1'          ONLY PACK IF NUMERIC                         
         BL    BC8F                ELSE TREAT AS REGULAR LINE                   
         PACK  DUB,1(1,R4)                                                      
         CVB   R7,DUB                                                           
         L     R3,ANXTCOM                                                       
BC8E     XC    0(70,R3),0(R3)      CAN'T USE SPACES                             
         LA    R3,70(R3)                                                        
         BCT   R7,BC8E                                                          
         ST    R3,ANXTCOM                                                       
         LA    R4,2(R4)                                                         
         AHI   R5,-2                                                            
*                                                                               
BC8F     DS    0H                                                               
         LTR   R5,R5                                                            
         BM    BC8C                                                             
         MVC   SAVEP,SPACES                                                     
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   SAVEP(0),0(R4)                                                   
         L     R3,ANXTCOM                                                       
         MVC   0(70,R3),SAVEP                                                   
         LA    R3,70(R3)                                                        
BC8H     ST    R3,ANXTCOM                                                       
         MVC   SAVEP,SPACES                                                     
         B     BC8C                                                             
*                                                                               
BC8X     MVC   ELCODE,SVELCOD      RESTORE ELCODE                               
         MVC   KEY,SVBUYKEY                                                     
         L     R2,SAVER2           RESTORE BUYREC'S R2                          
         B     BC4                                                              
*                                                                               
BC20     CLI   ELCODE,X'68'                                                     
         BE    BCX                                                              
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'68'                                                     
*                                                                               
BC22     BRAS  RE,NXTEL                                                         
         BNE   BCX                                                              
         CLI   1(R2),2                                                          
         BE    BC22                                                             
         L     R3,ANXTCOM                                                       
         XC    0(70,R3),0(R3)                                                   
         LA    R3,70(R3)                                                        
         XC    0(70,R3),0(R3)                                                   
*--->    MVC   0(29,R3),=C'*** POSITION INSTRUCTIONS ***'                       
         MVC   0(L'PP@POSI,R3),PP@POSI                                          
         LA    R3,70(R3)                                                        
         ST    R3,ANXTCOM                                                       
         B     BC5                 NOW GO PROCESS ELEM                          
*                                                                               
BCX      DS    0H                                                               
         L     R3,ANXTCOM                                                       
         CLC   ANXTCOM,ACOMTAB     SEE IF NO ENTRIES                            
         BE    BCX5                                                             
         AHI   R3,-70              SEE IF LAST LINE EMPTY                       
         OC    0(70,R3),0(R3)                                                   
         BZ    BCX5                                                             
         LA    R3,70(R3)           RESET TO LAST                                
BCX5     DS    0H                                                               
         MVI   0(R3),X'FF'         SET END OF TABLE                             
         L     R3,ACOMTAB                                                       
         ST    R3,ANXTCOM          INITIALIZE ANXTCOM TO FIRST                  
*                                                                               
         J     FMTBUYX                                                          
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
CHKDUB   DS    0H                                                               
         LA    R4,70(R4)                                                        
         CLI   DSPOPT,C'Y'                                                      
         BNE   *+14                                                             
         XC    0(70,R4),0(R4)                                                   
         LA    R4,70(R4)           DOUBLE SPACE INS. INFO                       
         XC    0(70,R4),0(R4)      CLR CURRENT PRINT LINE TO BE USED            
         ST    R4,ANXTCOM                                                       
         BR    RE                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
SAVER2   DS    F                                                                
SVELCOD  DS    CL1                                                              
*                                                                               
MYDUB    DS    PL4                                                              
*                                                                               
BSVCTYP  DS    CL1                                                              
SVBUYKEY DS    CL32                                                             
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
ACHARGE  NTR1  BASE=*,LABEL=*      ROUTINE FOR ADDITIONAL CHARGES               
*                                                                               
         CLI   COSTOPT,C'N'        SHOW INSERTION COST OPTION IS NO?            
         JE    FMTBUYX                                                          
         CLI   SHWACHGR,C'Y'       PROFILE IS SET TO SHOW CHARGES?              
         JNE   FMTBUYX                                                          
*                                                                               
         MVC   ACHSVKEY(L'KEY),KEY                                              
         MVC   ACHPRD,PBUYKPRD                                                  
*                                                                               
         GOTO1 APPGETCG,DMCB,(C'T',PBUYREC),VDATAMGR,GETINS,ACHPRD              
         CLI   0(R1),X'FF'         ERROR IN CALL ?                              
         BNE   *+6                 NO                                           
         DC    H'0'                                                             
*                                                                               
         CLI   0(R1),X'00'         ANY ADD'L. CHARGES FOUND ?                   
         BE    ACHRGX              NO                                           
*                                                                               
         ZIC   R3,0(R1)            NUMBER OF LINES IN BLOCK                     
         STC   R3,NUMACLNS         SAVE IT FOR PRINT MANIPULATIONS              
*                                                                               
         ICM   RE,15,0(R1)         RE POINTING TO DATA BLOCK                    
         BNZ   *+6                                                              
         DC    H'0'                DATA BLOCK HAS TO BE THERE                   
*                                                                               
         LA    RF,ACHWORK          ADDRESS OF AREA FOR ADD'L. CHGS.             
         LA    R1,ADCDLNTH         LENGTH OF BLOCK                              
         MOVE  ((RF),(R1)),(RE)    MOVE BLOCK TO WORKING STORAGE AREA           
*                                                                               
         LA    R2,ACHWORK          POINT TO WORKING STORAGE AREA                
         USING ADDCHGD,R2                                                       
*                                                                               
         L     R4,ANXTCOM                                                       
         MVC   0(70,R4),SPACES                                                  
         MVC   0(24,R4),=C'** ADDITIONAL CHARGES **'                            
         LA    R4,70(R4)                                                        
         ST    R4,ANXTCOM          NOTE - ACHRGS ARE NOT DOUBLE SPACED          
*                                                                               
ACHRG30  L     R4,ANXTCOM                                                       
         MVC   0(ADCLNLEN,R4),ADCCOD1                                           
         LA    R4,70(R4)                                                        
         ST    R4,ANXTCOM          NOTE - ACHRGS ARE NOT DOUBLE SPACED          
         LA    R2,ADCLNLEN(R2)     BUMP TO NEXT LINE IN BLOCK                   
         BCT   R3,ACHRG30                                                       
         DROP  R2                                                               
*                                                                               
ACHRGX   MVC   KEY,ACHSVKEY        RESTORE PPG SEQ                              
         MVC   KEYSAVE,KEY                                                      
*                                                                               
         J     FMTBUYX                                                          
*                                                                               
ACHSVKEY DS    XL(L'KEY)                                                        
ACHWORK  DS    CL(ADCDLNTH)                                                     
ACHPRD   DS    CL(L'PBUYKPRD)                                                   
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* ROUTINE FOR REGIONAL COMMENTS, INTERNET SITE LOCATION                         
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
REGCOMM  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         CLC   QAGENCY,=C'SJ'                                                   
         BE    REGCM10                                                          
         CLC   QAGENCY,=C'H9'      STARCOM?                                     
         BNE   REGCOMX                                                          
*                                                                               
REGCM10  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'66'        BUY COMMENT ELEM CODE                        
REGCM15  BRAS  RE,NXTEL                                                         
         BNE   REGCOMX                                                          
         CLI   1(R2),6             LENGTH AT LEAST 6 (REG= +2)?                 
         BNH   REGCM15                                                          
         CLC   2(3,R2),=C'REG='    REGIONAL COMMENT NOTATION?                   
         BNE   REGCM15                                                          
*                                                                               
         MVC   SAVEP,SPACES                                                     
         MVC   SAVEP(8),=C'REGION: '                                            
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
*                                                                               
         ZIC   R5,1(R2)                                                         
         AHI   R5,-7               MINUS OVERHEAD (6) AND 1 FOR EX INS          
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   SAVEP+8(0),6(R2)                                                 
         L     R3,ANXTCOM                                                       
         MVC   0(70,R3),SAVEP                                                   
         LA    R3,70(R3)           NOTE - COMMENTS NOT DOUBLE SPACED            
         ST    R3,ANXTCOM                                                       
         B     REGCM15             LOOK FOR MORE X'66' ELEM                     
*                                                                               
REGCOMX  DS    0H                  END OF REGINAL COMMENT                       
*                                                                               
* CHECKING FOR INTERNET SITE LOCATION                                           
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'98'        INTERNET SITE LOCATION ELEM                  
ISITL20  BRAS  RE,NXTEL                                                         
         BNE   ISITELX                                                          
         MVC   SAVEP,SPACES                                                     
         MVC   SAVEP(15),=C'SITE LOCATION: '                                    
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   SAVEP+15(20),2(R2)                                               
         L     R3,ANXTCOM                                                       
         MVC   0(70,R3),SAVEP                                                   
         LA    R3,70(R3)           NOTE - SITE LOC IS NOT DOUBLE SPACED         
         ST    R3,ANXTCOM                                                       
         B     ISITL20             THERE SHOULDN'T BE ANOTHER ONE               
*                                                                               
ISITELX  DS    0H                  END OF INTERNET SITE LOCATION                
*                                                                               
         J     FMTBUYX                                                          
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
DATEPRT  NTR1  BASE=*,LABEL=*      ROUTINE FOR PRINT DATES                      
*                                                                               
         CLI   CLOOPT,C'Y'         PRINT CLOSING DATE                           
         BNE   NOCLOSED                                                         
         OC    PBDCDATE,PBDCDATE   ANYTHING THERE                               
         BZ    NOCLOSED                                                         
         CLI   LANG,C'F'           SEE IF FRENCH I/O                            
         BE    CLOS5                                                            
         MVC   5(20,R4),=C'*SPACE CLOSING DATE '                                
         B     CLOS10                                                           
*                                                                               
CLOS5    MVC   5(19,R4),=C'*DATE DE FERMETURE '                                 
*                                                                               
CLOS10   DS    0H                                                               
         LA    R5,25(R4)           SCAN BACKWARD FOR NON-SAPCE                  
CLOS11   CLI   0(R5),C' '                                                       
         BH    CLOS12                                                           
         BCT   R5,CLOS11                                                        
*                                                                               
CLOS12   DS    0H                                                               
         GOTO1 DATCON,DMCB,(3,PBDCDATE),(8,WORK)                                
*                                                                               
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BAS   RE,DBFRDATE                                                      
         MVC   2(8,R5),WORK                                                     
*                                                                               
         MVI   10(R5),C'*'                                                      
         BAS   RE,DCHKDUB          CHECKING DOUBLE SPACE OPTION                 
*                                                                               
NOCLOSED DS    0H                                                               
         CLI   MATEOPT,C'Y'        PRINT MATERIALS CL DATE                      
         BNE   NOMATCL                                                          
         OC    PBDMDATE,PBDMDATE   ANY MAT CLOSE DATE TO PRINT?                 
         BZ    PRTEXDS             NO, GO CHECK EXT DAYS AND DATE               
*                                                                               
*--->    MVC   5(24,R4),=C'*MATERIALS CLOSING DATE='                            
*--->    GOTO1 DATCON,DMCB,(3,PBDMDATE),(8,29(R4))                              
*--->    MVI   37(R4),C'*'                                                      
         MVI   5(R4),C'*'                                                       
         MVC   6(L'PP@MATCD,R4),PP@MATCD                                        
         LA    R5,6+L'PP@MATCD(R4) SCAN BACKWARD FOR NON-SAPCE                  
BCTB8B   CLI   0(R5),C' '                                                       
         BH    BCTB8C                                                           
         BCT   R5,BCTB8B                                                        
*                                                                               
BCTB8C   DS    0H                                                               
         GOTO1 DATCON,DMCB,(3,PBDMDATE),(8,WORK)                                
*                                                                               
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BAS   RE,DBFRDATE                                                      
         MVC   2(8,R5),WORK                                                     
*                                                                               
         MVI   10(R5),C'*'                                                      
*                                                                               
         BAS   RE,DCHKDUB          CHECKING DOUBLE SPACE OPTION                 
*                                                                               
* PRINTING EXTENSION DAYS OR EXTENSION DATE                                     
*                                                                               
PRTEXDS  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'89'        EXTENSION DAYS ELEM FOUND?                   
         BRAS  RE,NXTEL                                                         
         BNE   NOEXDAYS                                                         
         USING PEXDAYEL,R2                                                      
         CP    PEXDAYS,=P'0'       ZERO EXT DAYS?                               
         BE    NOEXDAYS            YES, DONOT PRINT                             
         MVC   5(17,R4),=C'EXTENSION DAYS = '                                   
         EDIT  (P2,PEXDAYS),(3,22(R4)),0,ALIGN=LEFT                             
         BAS   RE,DCHKDUB                                                       
         B     NOEXDATE            DONE                                         
         DROP  R2                                                               
*                                                                               
NOEXDAYS DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'96'        EXTENSION DATE ELEM FOUND?                   
         BRAS  RE,NXTEL                                                         
         BNE   NOEXDATE                                                         
         USING PEXDATEL,R2                                                      
         MVC   5(17,R4),=C'EXTENSION DATE = '                                   
         GOTO1 DATCON,DMCB,(3,PEXDATE),(8,WORK)                                 
         DROP  R2                                                               
*                                                                               
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BAS   RE,DBFRDATE                                                      
         MVC   22(8,R4),WORK                                                    
         BAS   RE,DCHKDUB                                                       
NOEXDATE DS    0H                                                               
         LA    R2,PBUYREC+33       POINT TO FIRST ELEM AGAIN                    
*                                                                               
NOMATCL  DS    0H                                                               
         CLI   ONSOPT,C'Y'         PRINT ON-SALE DATE                           
         BNE   NOONSALE                                                         
         OC    PBDSDATE,PBDSDATE   ANYTHING THERE                               
         BZ    NOONSALE                                                         
*--->    MVC   5(14,R4),=C'*ON-SALE DATE='                                      
*--->    GOTO1 DATCON,DMCB,(3,PBDSDATE),(8,19(R4))                              
*--->    MVI   27(R4),C'*'                                                      
         MVI   5(R4),C'*'                                                       
         MVC   6(L'PP@OSDAT,R4),PP@OSDAT                                        
         LA    R5,6+L'PP@OSDAT(R4) SACN BACKWARD FOR NON-SAPCE                  
MATB8B   CLI   0(R5),C' '                                                       
         BH    MATB8C                                                           
         BCT   R5,MATB8B                                                        
*                                                                               
MATB8C   DS    0H                                                               
         GOTO1 DATCON,DMCB,(3,PBDSDATE),(8,WORK)                                
*                                                                               
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BAS   RE,DBFRDATE                                                      
         MVC   2(8,R5),WORK                                                     
*                                                                               
         MVI   10(R5),C'*'                                                      
*                                                                               
         BAS   RE,DCHKDUB          CHECKING DOUBLE SPACE OPTION                 
*                                                                               
NOONSALE DS    0H                  FOR FUTURE DATE USES                         
         J     FMTBUYX                                                          
*                                                                               
DCHKDUB  DS    0H                                                               
         LA    R4,70(R4)                                                        
         CLI   DSPOPT,C'Y'                                                      
         BNE   *+14                                                             
         XC    0(70,R4),0(R4)                                                   
         LA    R4,70(R4)           DOUBLE SPACE INS. INFO                       
         ST    R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)      CLR CURRENT PRINT LINE TO BE USED            
         BR    RE                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
DBFRDATE NTR1                      CONVERT DATE IN WORK (MMMDD/YY)              
         LA    R1,BDATETAB                                                      
DBFRDAT2 CLI   0(R1),X'FF'         END OF TABLE                                 
         BNE   *+6                                                              
         DC    H'0'                SOMETHING VERY WRONG                         
*                                                                               
         CLC   WORK(3),0(R1)                                                    
         BE    DBFRDAT5                                                         
         LA    R1,6(R1)                                                         
         B     DBFRDAT2                                                         
*                                  TO FRENCH                                    
DBFRDAT5 MVC   WORK(3),3(R1)                                                    
         J     FMTBUYX                                                          
*                                                                               
BDATETAB DC    C'JANJAN'                                                        
         DC    C'FEBFEV'                                                        
         DC    C'MARMAR'                                                        
         DC    C'APRAVR'                                                        
         DC    C'MAYMAI'                                                        
         DC    C'JUNJUN'                                                        
         DC    C'JULJUL'                                                        
         DC    C'AUGAOU'                                                        
         DC    C'SEPSEP'                                                        
         DC    C'OCTOCT'                                                        
         DC    C'NOVNOV'                                                        
         DC    C'DECDEC'                                                        
         DC    X'FF'                                                            
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
* * * * * *         OUTPUT CUSTOM COLUMN ROUTINE                                
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
CCOLRTN  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   CCSVKEY,KEY         SAVE BUY KEY                                 
*                                                                               
         LA    R2,PBUYREC+33                                                    
         USING BYCCELD,R2          BUY CUSTOM COLUMN ELEMENT                    
         MVI   ELCODE,X'CC'                                                     
CCOL02   DS    0H                                                               
         BRAS  RE,NXTEL                                                         
         BNE   CCOLX               DONE WITH CUSTOM COLUMNS                     
*                                                                               
         CLC   BYCCSQN,=X'2000'    IF LESS THAN THIS                            
         BL    CCOL10                 NORMAL CUSTOM COLUMN                      
*                                                                               
*                                  ELSE STANDARD COLUMN AND ON GENFIL           
*                                                                               
*        READ PASSIVE POINTER VIA INTERNAL SQN NUMBER                           
*                                                                               
         XC    GKEY,GKEY                                                        
C        USING GCOLPKEY,GKEY                                                    
*                                                                               
         MVC   C.GCOLPRID,=AL3(GCOLPRIQ)  SET GENDIR PASSIVE KEY ID             
         MVI   C.GCOLPMED,C'A'       MEDIA ALWAYS A FOR CUST COL'S              
         MVI   C.GCOLPRCD,GCOLPRCQ   RECORD CODE FOR PASSIVE KEY                
         MVC   C.GCOLPSQN,BYCCSQN    SEQUENCE NUMBER                            
         XC    C.GCOLPSQN,=X'FFFF'   COMPLEMENT SEQUENCE NUMBER                 
*                                                                               
         MVC   GKEYSAVE,GKEY                                                    
*                                                                               
         GOTOR VDATAMGR,DMCB,(DMINBTS,=C'DMRDHI'),=C'GENDIR',          X        
               GKEY,GKEY,(TERMNAL,0)                                            
*                                                                               
         CLC   C.GCOLPKEY,GKEYSAVE                                              
         BE    *+6                                                              
         DC    H'0'                MUST BE THERE                                
*                                                                               
         DROP  C                                                                
*                                                                               
*                                                                               
         GOTOR VDATAMGR,DMCB,(DMINBTS,=C'GETREC'),=C'GENFILE',         X        
               GKEY+36,PLISREC,(TERMNAL,DMWORK)                                 
*                                                                               
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DC    H'0'                NO ERRORS TOLERATED                          
*                                                                               
         LA    R5,PLISREC          USE PLISREC FOR STANDARD COLUMN REC          
         LA    R5,GCOLFRST-GCOLKEY(R5)   POINT TO ELEMENT                       
         USING PCOLELEM,R5                                                      
*                                                                               
         TM    PCOLINS,X'80'       USE IN INSERTION ORDERS ?                    
         BNO   CCOLBK              NO - SKIP THIS ELEMENT                       
*                                                                               
         B     CCOL20              PROCESS THIS ELEMENT                         
*                                                                               
CCOL10   DS    0H                                                               
*                                                                               
         XC    KEY,KEY             GET CUSTOM COL RECORD                        
C        USING PCOLRECD,KEY                                                     
         MVC   C.PCOLPAGY,QAGENCY  AGENCY                                       
         MVI   C.PCOLPMED,C'A'     MEDIA ALWAYS A FOR CUST COL'S                
         MVI   C.PCOLPRCD,X'D1'    RECORD CODE FOR PASSIVE KEY                  
         MVC   C.PCOLPSQN,BYCCSQN  SEQUENCE NUMBER                              
         XC    C.PCOLPSQN,=X'FFFF'    COMPLEMENT SEQUENCE NUMBER                
*                                                                               
         DROP  C                                                                
*                                                                               
         GOTO1 DATAMGR,DMCB,DMREAD,PRTDIR,KEY,KEY                               
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DC    H'0'                NO ERRORS TOLERATED                          
*                                  USE PLISREC FOR CUSTOM COLUMN REC            
         GOTO1 (RF),(R1),GETREC,PRTFILE,KEY+27,PLISREC,DMWORK                   
*                                                                               
         LA    R5,PLISREC                                                       
         LA    R5,PCOLFRST-PCOLKEY(R5)                                          
         USING PCOLELEM,R5                                                      
*                                                                               
         TM    PCOLINS,X'80'       USE IN INSERTION ORDERS ?                    
         BNO   CCOLBK              NO - SKIP THIS ELEMENT                       
*                                                                               
CCOL20   DS    0H                  OUTPUT CUSTOM COLUMN DATA                    
         L     R4,ANXTCOM                                                       
         LA    R4,70(R4)                                                        
         ST    R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         LR    R3,R4               LEAVE R4 POINTING TO NXTCOM                  
         MVC   0(12,R3),PCOLHDR1   COLUMN HEADER 1                              
*                                                                               
         LA    R3,11(R3)           POINT R3 TO LAST POSSIBLE CHARACTER          
CCOL22   DS    0H                  IN PCOLHDR1                                  
         CLI   0(R3),C' '          ANYTHING THERE ?                             
         BH    CCOL24              YES                                          
         AHI   R3,-1               MOVE 1 "LEFT" ON LINE                        
         B     CCOL22              TEST AGAIN                                   
*                                                                               
CCOL24   DS    0H                  R3 POINTING TO END OF "HDR 1"                
         CLI   PCOLHDR2,C' '       ANYTHING IN HEADER 2                         
         BNH   CCOL26X             NO                                           
         LA    R3,2(R3)            MOVE 2 "RIGHT" ON LINE                       
         MVC   0(12,R3),PCOLHDR2   COLUMN HEADER 2                              
*                                                                               
         LA    R3,11(R3)           POINT R3 TO LAST POSSIBLE CHARACTER          
CCOL26   DS    0H                  IN PCOLHDR2                                  
         CLI   0(R3),C' '          ANYTHING THERE ?                             
         BH    CCOL26X             YES                                          
         AHI   R3,-1               MOVE 1 "LEFT" ON LINE                        
         B     CCOL26              TEST AGAIN                                   
*                                                                               
CCOL26X  DS    0H                                                               
         LA    R3,1(R3)            MOVE 1 "RIGHT" ON LINE                       
         MVI   0(R3),C':'          PLACE A COLON                                
         LA    R3,2(R3)            MOVE 2 "RIGHT" ON LINE                       
*                                  AND OUTPUT CUSTOM COLUMN DATA                
*                                                                               
         CLI   PCOLTYP,C'D'        DATE ?                                       
         BE    CCOL50              YES                                          
         CLI   PCOLTYP,C'P'        PERIOD ?                                     
         BE    CCOL60              YES                                          
         CLI   PCOLTYP,C'T'        TEXT ?                                       
         BNE   CCOL70              NO - MUST BE 1 OF 3 NUMERIC "TYPES"          
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
**    THE FOLLOWING CODE PROVIDES FOR PLACING VARIABLE LENGTH TEXT    *         
**             IN A VARIABLE LENGTH PRINT "BLOCK"                     *         
*NTRY R4-> BEGINNING OF NEXT DATA "LINE"                                        
*NTRY R3-> BEGINNING OF VARIABLE LENGTH OUTPUT ON "LINE"                        
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         LA    RE,69(R4)           POINT RE TO LINE END                         
         SR    RE,R3               RE HAS MAXIMUM LINE LENGTH                   
         STC   RE,MAXLNTH          SAVE                                         
*                                                                               
         ZICM  RF,BYCCLEN          TOTAL ELEMENT LENGTH                         
         LA    R1,BYCCHDRL         HEADER LENGTH (OVERHEAD)                     
         SR    RF,R1               RF HAS LENGTH OF CUST COL DATA               
         LTR   RF,RF                                                            
         BNP   CCOLBK              NO DATA - NEXT ELEMENT                       
*                                                                               
         BCTR  RF,0                FOR EX INSTRUCTION                           
         EX    RF,*+8                                                           
         J     *+10                                                             
         CLC   BYCCDATA(0),SPACES  HAVE DATA FOR CHOPPER?                       
         JE    CCOLBK              NO DATA - NEXT ELEMENT                       
         AHI   RF,1                ADJUST LENGTH FOR CHOPPER                    
*                                                                               
*                                  USE PLISREC FOR THE OUTPUT BLOCK             
         GOTOR ACHOPPER,DMCB,((RF),BYCCDATA),(MAXLNTH,PLISREC),(70,7)           
*                                                                               
         L     RF,8(R1)            SET RF TO NUMBER OF LINES IN BLOCK           
         LTR   RF,RF                                                            
         BNZ   *+6                                                              
         DC    H'0'                SHOULD NOT HAPPEN                            
*                                                                               
         LA    R5,PLISREC          POINT R5 TO PLISREC (OUTPUT BLOCK)           
*                                                                               
CCOL30   DS    0H                                                               
         ZIC   R1,MAXLNTH          PREP FOR EXECUTED MOVE                       
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),0(R5)       EXEC MOVE OF 1 LINE OF TEXT                  
         BCT   RF,CCOL36                                                        
*                                                                               
         B     CCOLBK              DONE WITH THIS TEXT - NEXT ELEM              
*                                                                               
CCOL36   DS    0H                                                               
         L     R4,ANXTCOM          NEXT REPORT LINE                             
         LA    R4,70(R4)                                                        
         ST    R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         LA    R3,70(R3)           NEXT TEXT AREA                               
         LA    R5,70(R5)           NEXT CHOPPER LINE                            
         B     CCOL30              OUTPUT THE LINE                              
*                                                                               
*                                                                               
CCOL50   DS    0H                  OUTPUT A SINGLE DATE                         
         GOTOR DATCON,DMCB,(X'03',BYCCDATA),(5,0(R3))                           
         B     CCOLBK              NEXT ELEMENT                                 
*                                                                               
CCOL60   DS    0H                  OUTPUT A DATE RANGE (PERIOD)                 
         GOTOR DATCON,DMCB,(X'13',BYCCDATA),(5,0(R3))                           
         B     CCOLBK              NEXT ELEMENT                                 
*                                                                               
CCOL70   DS    0H                  OUTPUT A NUMERIC FIELD (N, $, OR %)          
*                                                                               
         XC    DUB,DUB             DUMMY CURRENCY DEFINITION FLD                
         MVC   DUB+3(1),PCOLDECS                                                
         LA    RF,DUB                                                           
         CURED (P8,BYCCDATA),(20,0(R3)),(RF),ALIGN=LEFT,FLOAT=-,       X        
               COMMAS=YES                                                       
*                                                                               
         DROP  R2,R5                                                            
*                                                                               
CCOLBK   DS    0H                                                               
         B     CCOL02              NEXT CUSTOM COLUMN BUY ELEMENT               
*                                                                               
*                                                                               
CCOLX    DS    0H                                                               
         MVC   KEY,CCSVKEY                                                      
         GOTO1 DATAMGR,DMCB,DMREAD,PRTDIR,KEY,KEY         RESTORE               
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DC    H'0'                NO ERRORS TOLERATED                          
*                                                                               
         XIT1                                                                   
*                                                                               
CCSVKEY  DS    CL32                BUY KEY SAVE                                 
MAXLNTH  DS    XL1                 MAX AVAILABLE O/P LNTH (CCOL "LINE")         
GKEY     DS    XL48                GENDIR KEYS                                  
GKEYSAVE DS    XL48                                                             
*                                                                               
         DROP                                                                   
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
         PRINT OFF                                                              
*                                                                               
       ++INCLUDE PPBYOUTD                                                       
         EJECT                                                                  
*                                                                               
* DICTIONARY FOR PP72FMT AND NLFMTBUY                                           
*                                                                               
       ++INCLUDE PPIOFMTD                                                       
         EJECT                                                                  
       ++INCLUDE T413WKA                                                        
         EJECT                                                                  
       ++INCLUDE POLFILE                                                        
         EJECT                                                                  
       ++INCLUDE T413WKB                                                        
         EJECT                                                                  
*                                                                               
PBFSIELD DSECT                                                                  
       ++INCLUDE PBFSIEL                                                        
         EJECT                                                                  
*                                                                               
PBREFELD DSECT                                                                  
       ++INCLUDE PBREFEL                                                        
         EJECT                                                                  
*                                                                               
PPAGED   DSECT                                                                  
       ++INCLUDE PPAGEVEL                                                       
         EJECT                                                                  
*                                                                               
PCLICKD  DSECT                                                                  
       ++INCLUDE PCLICKTEL                                                      
*                                                                               
PIMPRSD  DSECT                                                                  
       ++INCLUDE PIMPRSEL                                                       
         EJECT                                                                  
*                                                                               
PAIMPRSD DSECT                                                                  
       ++INCLUDE PAIMPRSEL                                                      
         EJECT                                                                  
*                                                                               
PEXDAYED DSECT                                                                  
       ++INCLUDE PEXDAYEL                                                       
         EJECT                                                                  
*                                                                               
PEXDATED DSECT                                                                  
       ++INCLUDE PEXDATEL                                                       
         EJECT                                                                  
*                                                                               
       ++INCLUDE PPGETCGD                                                       
         EJECT                                                                  
*                                                                               
PCOLRECD DSECT                    CUSTOM COLUMN RECORD                          
       ++INCLUDE PCOLREC                                                        
         EJECT                                                                  
*                                                                               
**BYCCELD                         BUY CUSTOM COLUMN ELEMENT DSECT               
       ++INCLUDE PPGENBYCC        (BYCCELD)                                     
         EJECT                                                                  
*                                                                               
         PRINT ON                                                               
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'036NLFMTBUY  06/05/12'                                      
         END                                                                    
